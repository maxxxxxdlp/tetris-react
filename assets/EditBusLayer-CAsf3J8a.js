import{fQ as R,U,_ as j,c1 as H,e as T,c as x,eu as k,bq as p}from"./index-Bv0Hohk0.js";const P=R(),w=new Map,E=new Map;async function B(e,s,d){if(!e||!d)return!1;if(!s)return!0;const r=new URL(e).host;let t=w.get(r);if(!t){const n=e.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,"");t=(await U(n,{responseType:"json",query:{f:"json"}})).data.defaultVersionName}return t===s}async function N(e,s,d=!1){var n,a;if(!e||!s)return!0;const r=e.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,""),t=(n=E.get(r))==null?void 0:n.entries();if(t){for(const[l,c]of t)if(c.name===s){const u=!((a=c.stack)!=null&&a.hasForwardEdits());if(!u&&d){const[{deleteForwardEdits:m},{default:h}]=await Promise.all([j(()=>import("./deleteForwardEdits-DaM2y7-R.js"),__vite__mapDeps([0,1,2])),j(()=>import("./DeleteForwardEditsParameters-BFuZHtQs.js"),__vite__mapDeps([3,1,2]))]);return m(r,l,new h({sessionId:P,moment:c.moment}))}return u}}return!0}function q(e,s){var t;if(!e)return!1;const d=e.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,""),r=(t=E.get(d))==null?void 0:t.entries();if(r){for(const[n,a]of r)if(a.name===s)return a.lockType==="edit"}return!1}const g=new H.EventEmitter;function D(e){return g.on("apply-edits",new WeakRef(e))}function O(e){return g.on("update-moment",new WeakRef(e))}function Q(e,s,d=null,r=!1){const t=k();return r=s==null||r,g.emit("apply-edits",{serviceUrl:e,layerId:s,gdbVersion:d,mayReceiveServiceEdits:r,result:t.promise}),t}const V="esri.layers.mixins.EditBusLayer",$=Symbol(V);function z(e){return e!=null&&typeof e=="object"&&$ in e}function f(e){return e!=null&&typeof e=="object"&&"gdbVersion"in e}function F(e,s,d){const r=new URL(e).host,t=w.get(r),n=a=>!a||a===t;return n(s)&&n(d)||s===d}const C=e=>{var s;let d=class extends e{constructor(...r){super(...r),this[s]=!0,this._applyEditsHandler=t=>{const{serviceUrl:n,layerId:a,gdbVersion:l,mayReceiveServiceEdits:c,result:u}=t,m=n===this.url,h=a!=null&&this.layerId!=null&&a===this.layerId,A=f(this),S=f(this)&&F(n,l,this.gdbVersion);if(!m||A&&!S||!h&&!c)return;const L=u.then(i=>{var y;if(h&&(i.addedFeatures.length||i.updatedFeatures.length||i.deletedFeatures.length||i.addedAttachments.length||i.updatedAttachments.length||i.deletedAttachments.length))return this.emit("edits",p(i)),i;const I=(y=i.editedFeatures)==null?void 0:y.find(({layerId:b})=>b===this.layerId);if(I){const{adds:b,updates:M,deletes:v}=I.editedFeatures,_={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:b?b.map(({attributes:o})=>({objectId:this.objectIdField&&o[this.objectIdField],globalId:this.globalIdField&&o[this.globalIdField]})):[],deletedFeatures:v?v.map(({attributes:o})=>({objectId:this.objectIdField&&o[this.objectIdField],globalId:this.globalIdField&&o[this.globalIdField]})):[],updatedFeatures:M?M.map(({current:{attributes:o}})=>({objectId:this.objectIdField&&o[this.objectIdField],globalId:this.globalIdField&&o[this.globalIdField]})):[],editedFeatures:p(i.editedFeatures),exceededTransferLimit:!1,historicMoment:p(i.historicMoment)};return this.emit("edits",_),_}return{edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:[],deletedFeatures:[],updatedFeatures:[],editedFeatures:p(i.editedFeatures),exceededTransferLimit:!1,historicMoment:p(i.historicMoment)}}).then(i=>("historicMoment"in this&&this.historicMoment!==i.historicMoment&&q(n,l)&&(this.historicMoment=i.historicMoment),i));this.emit("apply-edits",{result:L})},this._updateMomentHandler=t=>{const{serviceUrl:n,gdbVersion:a,moment:l}=t,c=n===this.url,u=f(this),m=f(this)&&F(n,a,this.gdbVersion),h=f(this)&&!F(n,this.gdbVersion,null);c&&u&&m&&h&&"historicMoment"in this&&this.historicMoment!==l&&(this.historicMoment=l)},this.when().then(()=>{this.addHandles(D(this._applyEditsHandler)),"historicMoment"in this&&this.addHandles(O(this._updateMomentHandler))},()=>{})}};return s=$,d=T([x(V)],d),d};export{C as F,B as a,q as c,Q as h,N as i,z as p,P as t};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/deleteForwardEdits-DaM2y7-R.js","assets/index-Bv0Hohk0.js","assets/index-85K7yr-5.css","assets/DeleteForwardEditsParameters-BFuZHtQs.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
