import{gl as da,H as pa,q$ as ha,r0 as fa,bS as gn,r1 as ga,d0 as Ne,hc as bt,d4 as K,d5 as m,r2 as zi,af as ma,r3 as _a,r4 as ya,e$ as L,ki as b,r5 as va,r6 as Hi,gI as Vi,e_ as Ii,f3 as D,d2 as ue,nx as O,m8 as Kn,ig as dt,d3 as Jn,fj as ei,hb as R,r7 as ct,nC as ki,gL as mt,nF as nn,e as p,y as f,c as I,S as te,r8 as mn,Y as ce,A as w,J as G,fK as _n,q as yn,aj as J,r9 as Ms,mp as Sa,ms as Es,mr as Os,kh as Ue,lK as At,ra as Te,aF as Cs,P as pt,rb as wa,aD as _e,gZ as Fn,kg as P,rc as Pa,gy as Ts,kj as Ds,k7 as $,k6 as ye,eX as Z,ba as Je,o_ as tt,oW as q,eY as Ae,o$ as Nn,$ as $a,a0 as Ge,a1 as Fi,p3 as ti,d$ as ba,rd as xa,hf as Ma,kQ as Ea,mg as En,re as ut,ke as Et,a2 as Rs,hg as Ni,rf as Oa,oZ as Ca,rg as Ta,rh as Da,ri as Ra,a4 as Gn,rj as rt,eZ as As,lA as Aa,lz as Se,kS as Gi,lF as On,gT as Ls,lE as kt,lZ as W,kX as zs,mw as La,lB as za,hj as Re,rk as C,bp as Hs,ma as sn,aw as Ha,cK as ni,rl as Va,l1 as Ia,rm as ka,X as Fa,rn as Vs,lJ as Is,kc as Cn,g5 as ji,ro as Na,oR as qi,gP as Ga,iU as Ui,V as je,fd as ja,oV as Ot,oU as Lt,oT as xt,rp as qa,rq as ht,p2 as Ua,rr as Za,l_ as Jt,rs as jn,rt as ks,p4 as Fs,ru as qn,lY as Ns,lH as Wa,rv as Ba,rw as Gs,cF as Ya,fc as Xa,o6 as Qa,rx as Ka,ry as Ja,rz as eo,rA as nt,rB as to,rC as no,nh as io,rD as so,rE as ro,gs as ao,lq as Ft,d6 as oo,rF as Tn,h as js,rG as lo,fm as co,g as Dn,c2 as qs,bR as uo,_ as Nt,oN as ii,rH as po,rI as ho,rJ as fo,rK as Us,c1 as go,B as Ct,ah as Zi,ag as mo,M as _o,Q as si,rL as yo,d9 as Zs,mh as Ws,L as Tt,iQ as ri,lr as Un,O as Bs,lD as Ys,rM as rn,u as ai,w as oi,rN as Zn,rO as vo,rP as So,k8 as wo,rQ as Xs,ka as Po,kb as $o,rR as bo,rS as St,rT as xo,rU as Mo}from"./index-Bv0Hohk0.js";import{b as Qs,f as Xe,s as Eo,r as Oo,a as Co}from"./LineVisualElement-BA2FWRBH.js";import{t as E,r as To,u as Do}from"./LengthDimension-3241MIUx.js";import{j as li,z as Ks,m as it,e as Ro,l as Ao,d as F,A as Wn,b as Lo,f as zo,h as Ho}from"./Segment-CNSGf7Bh.js";import{i as zt,c as Js,a as er,s as tr,l as nr}from"./unitFormatUtils-CrXkRIq7.js";import{geodesicLength as Vo}from"./geometryEngine-DM06toa8.js";import{t as Io,r as ir,a as sr,z as ko}from"./RightAngleQuadVisualElement-BIwVXGBk.js";import{e as vn,d as Fo,a as ve,j as rr,x as Ht,w as ci,h as Gt,M as ui,c as No,Y as ar,f as Wi,o as Go,b as jo,v as qo,l as Uo}from"./ShadedColorMaterial.glsl-Cak3Vz2U.js";import{z as Zo,O as or,q as di,l as Wo,t as Bo}from"./ToolIntersector-DHrjlBzv.js";import{T as lr}from"./ImageMaterial.glsl-B_fxTFoc.js";import{r as an,t as cr}from"./vec4f32-CjrfB-0a.js";import{c as Yo,x as Bi}from"./Laserlines.glsl-CW436qzp.js";import{j as V,d as Xo,I as Rn,N as Qo,V as Ko,p as Jo,P as el}from"./EditGeometryOperations-DfElYoDB.js";import{d as en}from"./FeatureFilter-x-ktONiu.js";import{o as tl}from"./floorFilterUtils-DZ5C6FQv.js";import{a as nl}from"./dehydratedFeatureComparison-BQojOjzo.js";function il(n){return n!=null&&typeof n=="object"&&"declaredClass"in n&&n.declaredClass==="esri.WebMap"}function sl(n){const e=da(n),t=e===ha?fa:e;return pa(n,t)?t:n}var et;function rl(n,e){const{spatialReference:t}=n;return gn(t,e.spatialReference)?(ke[0]=n.x,ke[1]=n.y,ke[2]=n.hasZ?n.z:0,Fe[0]=e.x,Fe[1]=e.y,Fe[2]=e.hasZ?e.z:0,ur(ke,Fe,t)):null}function al(n,e){const{spatialReference:t}=n;return gn(t,e.spatialReference)?(ke[0]=n.x,ke[1]=n.y,ke[2]=n.hasZ?n.z:0,Fe[0]=e.x,Fe[1]=e.y,Fe[2]=e.hasZ?e.z:0,ol(ke,Fe,t)):null}function ur(n,e,t){const i=dr(n,e,t,et.Direct);return i!=null?zt(i.direct,i.unit):null}function ol(n,e,t){const i=dr(n,e,t,et.Horizontal);return i!=null?zt(i.horizontal,i.unit):null}function dr(n,e,t,i){const s=sl(t),r=ga(s);if(r==null)return null;const a=e[2]-n[2];if(i===et.Vertical)return{verticalSigned:a,unit:r};if(!Ne(n,t,An,s)||!Ne(e,t,jt,s))return null;if(i===et.Direct)return{direct:bt(jt,An),unit:r};if(K(qt,n[0],n[1],e[2]),!Ne(qt,t,qt,s))return null;const o=bt(qt,jt);return i===et.Horizontal?{horizontal:o,unit:r}:{direct:bt(jt,An),horizontal:o,vertical:Math.abs(a),unit:r}}(function(n){n[n.Direct=0]="Direct",n[n.Horizontal=1]="Horizontal",n[n.Vertical=2]="Vertical"})(et||(et={}));const ke=m(),Fe=m(),An=m(),jt=m(),qt=m();function ll(n,e){if(!gn(n.spatialReference,e.spatialReference))return null;const{spatialReference:t}=n;return Ut[0]=n.x,Ut[1]=n.y,Ut[2]=n.hasZ?n.z:0,Zt[0]=e.x,Zt[1]=e.y,Zt[2]=e.hasZ?e.z:0,pi(Ut,Zt,t)}function pi(n,e,t){return Io(t,cl,ul,dl,n,e,t)}function cl(n,e,t){return zt(li(pr,n,e,t).distance,"meters")}function ul(n,e,t){return zt(Vo(pl(n,e,t),"meters"),"meters")}function dl(n,e,t){return zi(n,t,Yi)&&zi(e,t,Xi)?zt(li(pr,Yi,Xi,ma.WGS84).distance,"meters"):null}function pl(n,e,t){return{type:"polyline",spatialReference:t,paths:[[[...n],[...e]]]}}const pr=new Ks,Ut=m(),Zt=m(),Yi=m(),Xi=m();function hl(n,e){return ll(n,e)??al(n,e)}function fl(n,e,t){if(n==null)return null;let i;if(e===E.Horizontal)i=hl(n.elevationAlignedStartPoint,n.elevationAlignedEndPoint);else{const{startRenderSpace:r,endRenderSpace:a}=n.dimensionSegment;i=ur(r,a,n.spatialReference)}if(i==null)return null;const s=e===E.Vertical?_a(i.value,i.unit,t):ya(i.value,i.unit,t);return Js(i,s)}function on(n){const{elevationAlignedStartPoint:e,elevationAlignedEndPoint:t,dimension:{offset:i,measureType:s,orientation:r}}=n;return{elevationAlignedStartPoint:e,elevationAlignedEndPoint:t,offset:i,measureType:s,orientation:r}}function ln({elevationAlignedStartPoint:n,elevationAlignedEndPoint:e,offset:t,measureType:i,orientation:s},r,a=null){if(n==null||e==null)return null;const o=fr((a==null?void 0:a.directSegment)??new it,{elevationAlignedStartPoint:n,elevationAlignedEndPoint:e},r),l=(a==null?void 0:a.primaryOffsetAxis)??m();Sn(l,{measureType:i,elevationAlignedStartPoint:n,elevationAlignedEndPoint:e,directSegment:o,orientation:s,renderCoordsHelper:r});const c=(a==null?void 0:a.dimensionSegment)??new it;return hi({elevationAlignedStartPoint:n,elevationAlignedEndPoint:e})&&i===E.Vertical?(L(c.startRenderSpace,o.startRenderSpace),L(c.endRenderSpace,o.endRenderSpace)):gr(c,{offsetAxis:l,offset:t,relativeToSegment:o,renderCoordsHelper:r}),{elevationAlignedStartPoint:n,elevationAlignedEndPoint:e,directSegment:o,dimensionSegment:c,primaryOffsetAxis:l,spatialReference:r.spatialReference}}function Qi(n,e,t,i){return e===Dt.Start?(L(n.startRenderSpace,t.startRenderSpace),L(n.endRenderSpace,i.startRenderSpace)):(L(n.startRenderSpace,t.endRenderSpace),L(n.endRenderSpace,i.endRenderSpace)),n}var Dt;function gl(n,e,t,i){R(n.startRenderSpace,e.startRenderSpace,t,i),R(n.endRenderSpace,e.endRenderSpace,t,i)}function hr(n,e,t,i){switch(e){case E.Direct:return fr(n,t,i);case E.Horizontal:case E.Vertical:{const{elevationAlignedStartPoint:s,elevationAlignedEndPoint:r,dimension:a,geometry:o}=t;let l;a.measureType===E.Direct?(l=ml(o,i)===s.z>r.z,e===E.Horizontal&&(l=!l)):l=!_l(o);const[c,u]=l?[s,r]:[r,s],d=ct(u,yl);return e===E.Horizontal?d.z=c.z:(d.x=c.x,d.y=c.y),i.toRenderCoords(c,n.startRenderSpace),i.toRenderCoords(d,n.endRenderSpace),n}}}function fr(n,e,t){return t.toRenderCoords(e.elevationAlignedStartPoint,n.startRenderSpace),t.toRenderCoords(e.elevationAlignedEndPoint,n.endRenderSpace),n}function ml(n,e){const t=n.directSegment.eval(.5,b.get()),i=e.worldUpAtPosition(t,b.get()),s=n.dimensionSegment.eval(.5,b.get()),r=D(b.get(),s,t);return!Kn(r,dt)&&O(r,i)>0}function _l(n){const{startRenderSpace:e,endRenderSpace:t}=n.dimensionSegment,{startRenderSpace:i,endRenderSpace:s}=n.directSegment;return ki(i,e)<ki(s,t)}(function(n){n[n.Start=0]="Start",n[n.End=1]="End"})(Dt||(Dt={}));const yl=mt(0,0,0,null);function vl(n,e,t,i){const{directSegment:s}=t,r=Sn(b.get(),{measureType:e,directSegment:s,renderCoordsHelper:i}),a=gr(Sl,{offsetAxis:r,offset:0,relativeToSegment:s,renderCoordsHelper:i}).eval(.5,b.get()),o=D(b.get(),n,a);return O(o,r)*i.unitInMeters}const Sl=new it;function Sn(n,e){const{measureType:t,elevationAlignedStartPoint:i,elevationAlignedEndPoint:s,directSegment:{startRenderSpace:r,endRenderSpace:a},directSegment:o,renderCoordsHelper:l}=e,c=o.eval(.5,b.get()),u=l.worldUpAtPosition(c,b.get()),d=l.worldBasisAtPosition(c,va.Y,b.get());switch(t){case E.Horizontal:L(n,u);break;case E.Vertical:O(r,u)<O(a,u)?D(n,a,r):D(n,r,a),ue(n,n,u),ue(n,n,u);break;case E.Direct:{const h=e.orientation??0;if(hi({elevationAlignedStartPoint:i,elevationAlignedEndPoint:s}))Hi(Wt,-Vi(h),u),Ii(n,d,Wt);else{const g=D(b.get(),a,r),_=ue(b.get(),g,u);ue(_,_,g),Hi(Wt,Vi(h),g),Ii(n,_,Wt)}break}}return Kn(n,dt)?L(n,d):Jn(n,n)}const Wt=ei();function hi({elevationAlignedStartPoint:n,elevationAlignedEndPoint:e}){return n!=null&&e!=null&&n.x===e.x&&n.y===e.y}function gr(n,e){const{offsetAxis:t,offset:i,relativeToSegment:{startRenderSpace:s,endRenderSpace:r},relativeToSegment:a,renderCoordsHelper:o}=e,l=i/o.unitInMeters,[c,u]=wl(s,r,t,l);return R(n.startRenderSpace,a.startRenderSpace,t,c),R(n.endRenderSpace,a.endRenderSpace,t,u),n}function wl(n,e,t,i=0){const s=O(e,t),r=O(n,t),a=Math.abs(s-r)+i;return s>r?[a,i]:[i,a]}function wn(n,e,t){const i=e.directSegment.eval(.5,b.get());return t.worldUpAtPosition(i,n)}function fi(n,e){const{startRenderSpace:t,endRenderSpace:i}=e.directSegment;return D(n,i,t)}function gi(n,e,t={invert:!1}){const{startRenderSpace:i,endRenderSpace:s}=e.dimensionSegment;return t.invert?D(n,i,s):D(n,s,i)}function Bn(n,e){const t=n.directSegment.eval(.5,b.get());return e.headingAtPosition(t,n.primaryOffsetAxis)}function Pl(n,e){return nn(gi($l,n))/e**2}const $l=m();function mr(n){const{elevationAlignedStartPoint:e,elevationAlignedEndPoint:t}=n;if(e==null||t==null)return!1;const i=rl(e,t);return i!=null&&Js(i,"meters").value>ir}function Rt(n){return n.geometry!=null}let Qe=class extends te{constructor(e){super(e)}initialize(){const e=mn(()=>this.analysisViewData.computations,({computation:t})=>this._watchComputation(t));this.addHandles(ce(e))}get analysis(){return this.analysisViewData.analysis}get _defaultUnit(){return Ro(this.view)}_watchComputation(e){return w(()=>on(e),t=>{const{measureType:i}=t;if(mr(t)&&i!==E.Direct){const r=Math.round(_n(ir,"meters","kilometers"));return yn.getLogger(this).warnOnce(`A ${i} dimension in the analysis (id: '${this.analysis.id}') will not display, because only direct dimensions can measure lengths greater than ${r} km. Update the measureType of the affected dimension to "direct" to display it.`),void(e.geometry=null)}const s=ln(t,this.view.renderCoordsHelper,e.geometry);e.geometry=s,e.result.length=fl(s,i,this._defaultUnit)},G)}};p([f({constructOnly:!0})],Qe.prototype,"analysisViewData",void 0),p([f({constructOnly:!0})],Qe.prototype,"view",void 0),p([f()],Qe.prototype,"analysis",null),p([f()],Qe.prototype,"_defaultUnit",null),Qe=p([I("esri.views.3d.analysis.Dimension.support.DimensionController")],Qe);function cn(n){return Ms(n.accentColor,.5)}function bl(n){return Sa(n.accentColor)}const _r=5,xl=new J([127,127,127,.5]),yr=.8,Ml=4,El=6,Ol=.1,vr=.5,Cl=18,Tl=2,Dl=.3,Rl=2,Al=.25,Ll=20,zl=5,Ki=5,Ji=10,Hl=2500,Vl=50,Il=2;class kl{constructor(e){this.start=e.start,this.end=e.end,this.offset=e.offset,this.heading=e.heading,this.rotation=e.rotation,this.direct=e.direct,this.horizontal=e.horizontal,this.vertical=e.vertical}manipulatorName(e){return Object.keys(this).find(t=>this.hasOwnProperty(t)&&e===this[t])}values(){return[this.start,this.end,this.offset,this.heading,this.rotation,this.direct,this.horizontal,this.vertical]}forEachMeasureTypeManipulator(e){for(const t of To)e(this.manipulatorForMeasureType(t),t)}manipulatorForMeasureType(e){switch(e){case E.Direct:return this.direct;case E.Horizontal:return this.horizontal;case E.Vertical:return this.vertical}}}let Fl=class extends vn{constructor(e,t){const i=Fo(J.toUnitRGBA(cn(e.effectiveTheme))),s=[new ve(Os(i,1,32,32),De)];super({view:e,renderObjects:s,metadata:t.metadata,available:!1,grabCursor:"crosshair",radius:_r,collisionPriority:1}),this._themeHandle=w(()=>({color:J.toUnitRGBA(cn(e.effectiveTheme))}),r=>i.setParameters(r))}destroy(){this._themeHandle.remove(),super.destroy()}};function Nl(n,e){const t=[Z(-.5,0,0),Z(.5,0,0)],i=Ue(e.unfocusedMaterial,t.map(r=>At(m(),r,vr))),s=i.instantiate({material:e.focusedMaterial});return new vn({view:n,renderObjects:[new ve(i,Te.Unfocused|Te.Selected|De),new ve(s,Te.Focused|De)],collisionType:{type:"line",paths:[t]},radius:mi(e.lineSizePt)/2,metadata:e.metadata,available:!1,...rr})}class es extends vn{constructor(e,{lineSizePt:t,material:i,metadata:s}){super({view:e,autoScaleRenderObjects:!1,collisionPriority:1,metadata:s}),this._options={calloutColor:Cs(),lineSizePt:t,material:i},this._themeHandle=w(()=>J.toUnitRGBA(cn(e.effectiveTheme)),r=>{this._options.calloutColor=r,ns(this,ts({...this._options,metadata:this.metadata}))},pt)}update({lineSizePt:e,material:t}){this._options.lineSizePt=e,this._options.material=t,ns(this,ts({...this._options,metadata:this.metadata}))}destroy(){this._themeHandle.remove(),super.destroy()}}function ts({calloutColor:n,lineSizePt:e,material:t,metadata:i}){return{calloutLength:.25*wa*yr*_e(e)+Cl,calloutColor:n,calloutWidth:Tl,customStateMask:De,discScale:Dl,focusMultiplier:Rl,material:t,metadata:i}}function Gl(n,e){const t=[Z(-.5,0,0),Z(.5,0,0)],i=Ue(e.thinOffsetManipulatorMaterial,t),s=Ue(e.unfocusedMaterial,t.map(a=>At(m(),a,vr))),r=s.instantiate({material:e.focusedMaterial});return new vn({view:n,renderObjects:[new ve(s,Te.Unfocused|De),new ve(r,Te.Focused|De),new ve(i,De)],collisionType:{type:"line",paths:[t]},radius:mi(e.lineSizePt)/2,available:!1,metadata:e.metadata,...rr})}function jl(n,{isStart:e,createSnappingPipelineStep:t,dimension:i,onUpdate:s,view:r}){const a=e?"startPoint":"endPoint";return[Ht(n,(l,c,u,d)=>{const h=di(l),{snappingStep:g,cancelSnapping:_}=t(d);u=u.next(h).next(ui(i,[a,"measureType","orientation"])).next(_),c.next(h).next(Zo(r)).next(...g).next(y=>{const v=ct(y.mapEnd,new Je);s(a==="startPoint"?{startPoint:v}:{endPoint:v})})})]}function ql(n,{computation:e,view:t}){return[Ht(n,(i,s,r)=>{if(!Rt(e)||!i.selected)return;const{geometry:a,dimension:o}=e,l=di(i);s.next(l).next(wr(t,o,a.dimensionSegment,a.primaryOffsetAxis)),r.next(l).next(ui(o,["offset"]))})]}function Ul(n,{computation:e,view:t}){return[Ht(n,(i,s,r)=>{Sr({cancel:r,computation:e,settingHeading:!0,steps:s,view:t})})]}function Zl(n,{computation:e,view:t}){return[Ht(n,(i,s,r)=>{Sr({cancel:r,computation:e,settingHeading:!1,steps:s,view:t})}),n.events.on("immediate-click",i=>{Wl(i,e,t)})]}function Wl(n,e,t){const{dimension:i,geometry:s}=e;if(i.orientation===90||i.orientation===270)return i.orientation=0,void n.stopPropagation();if(s==null)return;const{renderCoordsHelper:r}=t,a=ln({...on(e),orientation:90},r),o=ln({...on(e),orientation:270},r);if(a==null||o==null)return;const l=Bn(a,r),c=Bn(o,r),u=Pr(s,t),d=Fn.shortestSignedDiff(u,l),h=Fn.shortestSignedDiff(u,c);i.orientation=Math.abs(d)<Math.abs(h)?90:270,n.stopPropagation()}function Sr(n){const{cancel:e,computation:t,settingHeading:i,steps:s,view:r}=n;if(!Rt(t))return;const{renderCoordsHelper:a}=r,{dimension:o,geometry:l}=t,c=m(),u=br(m(),l,l.directSegment,a),d=xr(b.get(),{forHeading:i,geometry:l,renderCoordsHelper:a}),h=tt(u,d,q()),g=i?o.orientation??Bn(l,r.renderCoordsHelper):o.orientation??0;s.next(or(r,h)).next(_=>{_.action==="start"&&L(c,_.renderStart);const y=ti(h),v=No(c,_.renderEnd,u,y);let S=g-ba(v);i||(S=Bl(S)),o.orientation=S}),e.next(ui(o,["orientation"]))}function Bl(n){const e=Fn.normalize(n)%90;return e<Ki?n-e:90-e<Ki?n+(90-e):n}function Yl(n,{computation:e,manipulatorMeasureType:t,view:i}){let s=E.Direct,r=0,a=0;return[n.events.on("grab-changed",o=>{if(o.action!=="start"||!Rt(e))return;const{dimension:l,geometry:c}=e;s=l.measureType,r=l.offset,a=l.orientation;const u=L(b.get(),n.renderLocation);l.measureType=t,l.offset=vl(u,t,c,i.renderCoordsHelper),l.orientation=0}),Ht(n,(o,l,c)=>{if(!Rt(e))return;const{geometry:u,dimension:d}=e,{renderCoordsHelper:h}=i,g=hr(Mr,t,e,h),_=Sn(b.get(),{measureType:t,directSegment:u.directSegment,renderCoordsHelper:h}),y=di(o);l.next(y).next(wr(i,d,g,_)),c.next(y).next(v=>(d.measureType=s,d.offset=r,d.orientation=a,v))})]}function wr(n,e,t,i){const s=Ae(b.get(),t.endRenderSpace,t.startRenderSpace);ue(s,s,i);const r=tt(t.startRenderSpace,s,q()),a=tt(t.startRenderSpace,i,q()),o=e.offset;let l,c=0;const u=new ar;return u.next(or(n,r)).next(d=>{d.action==="start"&&(c=Nn(a,d.renderStart));const h=(Nn(a,d.renderEnd)-c)*n.renderCoordsHelper.unitInMeters;e.offset=o+h,l=d}),d=>(u.execute(d),l)}function Pr(n,e){const{directSegment:t}=n,{renderCoordsHelper:i}=e,s=wn(b.get(),n,i),r=fi(b.get(),n),a=ue(b.get(),r,s),{viewForward:o}=e.state.camera;O(a,o)>0&&At(a,a,-1);const l=t.eval(.5,b.get());return i.headingAtPosition(l,a)}function Xl(n,e,t){const{dimensionSegment:i,primaryOffsetAxis:s}=e,r=gi(Mt,e),a=P(r,dt)?Pa(un):ci(r,s,dt,un),o=Math.max(Ts(r),Ol/t.unitInMeters);Ds(a,a,K(Mt,o,o,o)),n.modelTransform=a,n.renderLocation=i.eval(.5,Mt)}function Ql(n,e,t){$r(n,e,t,{forHeading:!0})}function Kl(n,e,t){$r(n,e,t,{forHeading:!1})}function $r(n,e,t,{forHeading:i}){const{dimension:s,geometry:r}=e,{primaryOffsetAxis:a}=r,o=At(Jl,a,s.offset>=0?1:-1),l=xr(ec,{forHeading:i,geometry:r,renderCoordsHelper:t});ue(l,l,o);const c=ci(o,l,dt,un);n.modelTransform=c,n.renderLocation=br(Mt,r,r.dimensionSegment,t)}const Jl=m(),ec=m();function tc(n,e,t,i){const{geometry:s}=e,r=hr(Mr,t,e,i),a=Sn(Mt,{measureType:t,directSegment:s.directSegment,renderCoordsHelper:i}),o=D(Ln,r.endRenderSpace,r.startRenderSpace),l=ci(o,a,dt,un),c=Ts(o);Ds(l,l,K(Ln,c,c,c)),n.modelTransform=l,n.renderLocation=r.eval(.5,Ln)}function br(n,e,t,i){const{startRenderSpace:s,endRenderSpace:r}=t,a=nc(e,i)?s:r;return L(n,a)}function xr(n,{forHeading:e,geometry:t,renderCoordsHelper:i}){return e?wn(n,t,i):gi(n,t,{invert:!0})}function nc(n,e){const t=fi(ic,n),i=wn(sc,n,e);return O(t,i)>0}const ic=m(),sc=m();function rc(n){return _e(n)+Ml}function mi(n){return _e(n)+El}function ns(n,e){var g;const t=e.material??new lr({transparent:!0,writeDepth:!1,textureId:(g=e.texture)==null?void 0:g.id,renderOccluded:$.Opaque,isDecoration:!0}),i=e.focusMultiplier??Gt.focusMultiplier,s=e.calloutLength??Gt.calloutLength,r=Gt.discRadius*(e.discScale??1),a=r*i,o=(_,y)=>{const v=[0,1,2,2,3,0];return new $a(y,[[Ge.POSITION,new Fi([s-_,-_,0,s+_,-_,0,s+_,_,0,s-_,_,0],v,3,!0)],[Ge.UV0,new Fi([0,0,1,0,1,1,0,1],v,2,!0)]])},l=e.calloutWidth??Gt.calloutWidth,c=new ye({width:l,color:e.calloutColor,renderOccluded:$.OccludeAndTransparent,isDecoration:!0}),u=Ue(c,[[0,0,0],[s-r,0,0]]),d=Ue(c,[[0,0,0],[s-a,0,0]]),h=e.customStateMask??Es.None;n.collisionType={type:"disc",direction:[0,0,1],offset:[s,0,0]},n.focusMultiplier=i,n.metadata=e.metadata,n.radius=r,n.renderObjects=[new ve(o(r,t),Te.Unfocused|h),new ve(u,Te.Unfocused|h),new ve(o(a,t),Te.Focused|h),new ve(d,Te.Focused|h)]}const De=Es.Custom1,Mt=m(),Ln=m(),un=ei(),Mr=new it;function ac(n){let e,t,i=[],s=!1;function r(...a){return s&&e===this&&oc(a,i)||(t=n.apply(this,a),e=this,i=a,s=!0),t}return r}function oc(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;++t)if(n[t]!==e[t])return!1;return!0}var se;function lc(n,e){return{enabled:e.effectiveFeatureEnabled,elevationAlignedStartPoint:n.elevationAlignedStartPoint,elevationAlignedEndPoint:n.elevationAlignedEndPoint,geometry:n.geometry}}function cc(n,e){if(mr(n))return se.Direct;if(!n.enabled)return null;const{geometry:t}=n;if(t==null||P(t.directSegment.startRenderSpace,t.directSegment.endRenderSpace))return null;const{camera:i}=e.state,s=wn(b.get(),t,e.renderCoordsHelper),r=fi(b.get(),t),a=At(b.get(),s,O(r,s)),o=Ae(b.get(),r,a),l=nn(o),c=nn(a),{startRenderSpace:u,endRenderSpace:d}=t.directSegment,h=Math.max(i.computeScreenPixelSizeAt(u)*Ji,i.computeScreenPixelSizeAt(d)*Ji)**2;return l<h?se.Vertical:c<h?se.Horizontal:null}function uc(n,e,{constraint:t,view:i}){const{unconstrainedGeometry:s}=n;if(s==null)return;const{renderCoordsHelper:r,spatialReference:a}=i,{startRenderSpace:o,endRenderSpace:l}=s.directSegment,c=r.fromRenderCoords(o,new Je({spatialReference:a})),u=r.fromRenderCoords(l,new Je({spatialReference:a}));let d;d=e==="start"?{startPoint:c}:{endPoint:u},Er(n,d,{constraint:t,elevationAlignedStartPoint:n.elevationAlignedStartPoint,elevationAlignedEndPoint:n.elevationAlignedEndPoint,unconstrainedGeometry:s,view:i})}function Er(n,e,t){const{constraint:i,elevationAlignedStartPoint:s,elevationAlignedEndPoint:r,unconstrainedGeometry:a,view:o}=t,{dimension:l,previousConstraint:c,preConstraintProperties:u}=n;if(s==null||r==null)return;const d=()=>{"startPoint"in e?l.startPoint=e.startPoint:"endPoint"in e&&(l.endPoint=e.endPoint)};if(i==null)d(),c!=null&&u!=null&&(l.measureType=u.measureType,l.orientation=u.orientation);else switch(l.measureType=E.Direct,i){case se.Horizontal:if(i!==c&&(l.orientation=0),"startPoint"in e){const h=e.startPoint;h!=null&&(h.z=r.z),l.startPoint=h}else if("endPoint"in e){const h=e.endPoint;h!=null&&(h.z=s.z),l.endPoint=h}break;case se.Vertical:if(i!==c&&(l.orientation=Pr(a,o)),"startPoint"in e){const h=e.startPoint;h!=null&&(h.x=r.x,h.y=r.y),l.startPoint=h}else if("endPoint"in e){const h=e.endPoint;h!=null&&(h.x=s.x,h.y=s.y),l.endPoint=h}break;case se.Direct:i!==c&&u!=null&&(l.orientation=u.orientation),d()}n.previousConstraint=i,n.unconstrainedGeometry=a}(function(n){n[n.Horizontal=0]="Horizontal",n[n.Vertical=1]="Vertical",n[n.Direct=2]="Direct"})(se||(se={}));let dc=class extends sr{constructor(e){super(e),this._ray=Ea(),this._isWorldDown=!1,this._start=m(),this._end=Z(1,0,0),this._width=1,this._color=an(1,0,1,1),this._polygonOffset=!1,this._writeDepthEnabled=!0,this._innerWidth=0,this._innerColor=an(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._stipplePreferContinuous=!0,this._falloff=0,this._extensionType=le.LINE,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=$.OccludeAndTransparent,this._fadedExtensions=rs,this._laserline=new Yo({view:this.view,isDecoration:e.isDecoration}),this.applyProperties(e)}destroy(){this._laserline.destroy(),super.destroy()}createObject3DResourceFactory(e){return{view:e,createResources:t=>this._createObject3DResources(t),destroyResources:t=>this._destroyExternalResources(t),recreateGeometry:(t,i)=>this._recreateObject3DGeometry(t,i),cameraChanged:()=>this._updateGeometry()}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:t=>this._destroyExternalResources(t),recreateGeometry:t=>this._recreateDrapedGeometry(t)}}updateVisibility(e){super.updateVisibility(e),this._laserline.visible=e}onAttachedChange(){this._laserline.attached=this._laserlineAttached}setStartEndFromWorldDownAtLocation(e){this._isWorldDown=!0,L(this._start,e),this.view.renderCoordsHelper.worldUpAtPosition(e,this._end),Ae(this._end,e,this._end),En(this._start,this._end,this._ray),this._updateGeometry()}get start(){return this._start}set start(e){this._isWorldDown=!1,P(this._start,e)||(L(this._start,e),En(this._start,this._end,this._ray),this._updateGeometry())}get end(){return this._end}set end(e){this._isWorldDown=!1,P(this._end,e)||(L(this._end,e),En(this._start,this._end,this._ray),this._updateGeometry())}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){ut(e,this._color)||(Et(this._color,e),this._updateMaterial())}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){e!==this._polygonOffset&&(this._polygonOffset=e,this._updateMaterial())}get writeDepthEnabled(){return this._writeDepthEnabled}set writeDepthEnabled(e){this._writeDepthEnabled!==e&&(this._writeDepthEnabled=e,this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){ut(e,this._innerColor)||(Et(this._innerColor,e),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=e!=null!=(this._stipplePattern!=null);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){e!=null&&this._stippleOffColor!=null&&ut(e,this._stippleOffColor)||(this._stippleOffColor=e!=null?cr(e):null,this._updateMaterial())}get stipplePreferContinuous(){return this._stipplePreferContinuous}set stipplePreferContinuous(e){e!==this._stipplePreferContinuous&&(this._stipplePreferContinuous=e,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get extensionType(){return this._extensionType}set extensionType(e){e!==this._extensionType&&(this._extensionType=e,this.recreateGeometry())}get _laserlineAttached(){return this._laserlineEnabled&&this._laserlineStyle!=null&&this.attached&&!this.isDraped}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,this._laserline.attached=this._laserlineAttached,e!=null&&(this._laserline.style=e)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this._laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get _normalizedRenderOccluded(){return this.isDraped&&this._renderOccluded===$.OccludeAndTransparentStencil?$.OccludeAndTransparent:this._renderOccluded}get fadedExtensions(){return this._fadedExtensions}set fadedExtensions(e){this._fadedExtensions=e??rs,this.recreateGeometry()}_updateMaterial(){var t,i;const{materialParameters:e}=this;(t=this.object3dResources.resources)==null||t.material.setParameters(e),(i=this.drapedResources.resources)==null||i.material.setParameters(e)}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:this._stipplePreferContinuous,innerWidth:this._innerWidth,innerColor:this._innerColor,falloff:this._falloff,hasPolygonOffset:this._polygonOffset,renderOccluded:this._normalizedRenderOccluded,isDecoration:this.isDecoration,writeDepth:this._writeDepthEnabled}}_createObject3DResources(e){const t=new ye(this.materialParameters),i=new Array;return this._createObject3DGeometry(t,e,i),{material:t,geometries:i,forEach:s=>{s(t),i.forEach(s)}}}_destroyExternalResources(e){e.geometries=[]}_recreateObject3DGeometry(e,t){e.geometries.length=0,this._createObject3DGeometry(e.material,t,e.geometries)}_createObject3DGeometry(e,t,i){const s=this._createGeometry(e);i.push(s),t.addGeometry(s),this._updateVerticesObject3D(t)}_createDrapedResources(){const e=new ye(this.materialParameters);return{material:e,geometries:[this._createDrapedGeometry(e)]}}_recreateDrapedGeometry(e){e.geometries=[this._createDrapedGeometry(e.material)]}_createDrapedGeometry(e){const t=this._createGeometry(e);return this._updateVerticesDraped(t),new Rs(t)}_createGeometry(e){const t=this.extensionType===le.FADED,i=t?[m(),m(),m(),m()]:[m(),m()];return Ue(e,i,null,t?[1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0]:null)}_updateGeometry(){if(this.isDraped)this.drapedResources.recreateGeometry();else{const e=this.object3dResources.object;e&&this._updateVerticesObject3D(e)}}_updateVerticesObject3D(e){const t=this._lineSegment;this._updateVertexAttributesObject3D(e,t),this._laserline.intersectsLine=t}_updateVerticesDraped(e){this._updateVertexAttributesDraped(e,this._lineSegment)}get _lineSegment(){return this._extensionType===le.FADED?this._updateLineSegmentFinite(is):this._updateLineSegmentInfinite(this._extensionType,is)}_updateLineSegmentFinite(e){return Ni(this._start,this._end,e)}_updateLineSegmentInfinite(e,t){const i=this.view.state.camera;switch(Oa(this._ray,ze),e){case le.LINE:ze.c0=-Number.MAX_VALUE;break;case le.RAY:case le.GROUND_RAY:{const a=this._ray.origin,o=this.view.elevationProvider.getElevation(a[0],a[1],a[2],this.view.renderCoordsHelper.spatialReference,"ground")??0,l=this.view.renderCoordsHelper.getAltitude(a);this._isWorldDown&&l<o&&Ca(ze.ray.direction,ze.ray.direction),this._extensionType===le.GROUND_RAY&&o!=null&&(ze.c1=Math.abs(l-o));break}}if(!Ta(i.frustum,ze))return this._updateLineSegmentFinite(t);const s=Da(ze,We),r=Ra(ze,pc);return Ni(s,r,t)}_updateVertexAttributesObject3D(e,t){var r;const i=(r=e.geometries[0].getMutableAttribute(Ge.POSITION))==null?void 0:r.data;if(!i)return;let s=0;for(const a of this._lineVertices(t))i[s++]=a[0],i[s++]=a[1],i[s++]=a[2];e.geometryVertexAttributeUpdated(e.geometries[0],Ge.POSITION)}_updateVertexAttributesDraped(e,t){var r;const i=(r=e.getMutableAttribute(Ge.POSITION))==null?void 0:r.data;if(!i)return;let s=0;for(const a of this._lineVertices(t))i[s++]=a[0],i[s++]=a[1],i[s++]=Gn;e.invalidateBoundingInfo()}*_lineVertices(e){this.extensionType===le.FADED?(yield rt(e,-this.fadedExtensions.start,We),yield rt(e,0,We),yield rt(e,1,We),yield rt(e,1+this.fadedExtensions.end,We)):(yield rt(e,0,We),yield rt(e,1,We))}};const ze=xa(),We=m(),pc=m(),is=Ma();var le;(function(n){n[n.LINE=0]="LINE",n[n.RAY=1]="RAY",n[n.GROUND_RAY=2]="GROUND_RAY",n[n.FADED=3]="FADED"})(le||(le={}));const ss=1/3,rs={start:ss,end:ss};let hc=class extends sr{constructor(e){super(e),this._location=m(),this._direction=Z(1,0,0),this._width=1,this._offset=1,this._length=18,this._color=an(1,0,1,1),this._renderOccluded=$.OccludeAndTransparent,this.applyProperties(e)}createObject3DResourceFactory(e){return{view:e,createResources:t=>this._createObject3DResources(t),destroyResources:t=>this._destroyObject3DResources(t),recreateGeometry:(t,i)=>this._recreateObject3DGeometry(t,i),cameraChanged:()=>this._updateGeometry()}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:t=>this._destroyDrapedResources(t),recreateGeometry:t=>this._recreateDrapedGeometry(t)}}get location(){return this._location}set location(e){P(this._location,e)||(L(this._location,e),this._updateGeometry())}get direction(){return this._direction}set direction(e){P(this._direction,e)||(L(this._direction,e),this._updateGeometry())}setDirectionFromPoints(e,t){Jn(this._direction,Ae(this._direction,t,e)),this._updateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get offset(){return this._offset}set offset(e){e!==this._offset&&(this._offset=e,this._updateGeometry())}get length(){return this._length}set length(e){e!==this._length&&(this._length=e,this._updateGeometry())}get color(){return this._color}set color(e){ut(e,this._color)||(Et(this._color,e),this._updateMaterial())}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}_createObject3DResources(e){const t=new ye(this.materialParameters),i=new Array;return this._createObject3DGeometry(t,e,i),{material:t,geometries:i,forEach:s=>{s(t),i.forEach(s)}}}_destroyObject3DResources(e){e.geometries.length=0}_recreateObject3DGeometry(e,t){e.geometries.length=0,this._createObject3DGeometry(e.material,t,e.geometries)}_createObject3DGeometry(e,t,i){const[s,r]=this._createGeometries(e);t.addGeometry(s),t.addGeometry(r),i.push(s),i.push(r),this._updateVerticesObject3D(t)}_createDrapedResources(){const e=new ye(this.materialParameters),t=w(()=>this.view.state.contentPixelRatio,()=>{this.drapedResources.recreateGeometry()});return{material:e,geometries:this._createDrapedGeometry(e),pixelRatioHandle:t}}_destroyDrapedResources(e){e.pixelRatioHandle.remove(),e.geometries=[]}_recreateDrapedGeometry(e){e.geometries=this._createDrapedGeometry(e.material)}_createDrapedGeometry(e){const t=this._createGeometries(e);return this._updateVerticesDraped(t),t.map(i=>new Rs(i))}_createGeometries(e){return[Ue(e,[m(),m()]),Ue(e,[m(),m()])]}_updateMaterial(){var t,i;const{materialParameters:e}=this;(t=this.object3dResources.resources)==null||t.material.setParameters(e),(i=this.drapedResources.resources)==null||i.material.setParameters(e)}get materialParameters(){return{width:this._width,color:this._color,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateGeometry(){if(this.isDraped)this.drapedResources.recreateGeometry();else{const e=this.object3dResources.object;e&&this._updateVerticesObject3D(e)}}_updateVerticesObject3D(e){const t=this.view.state.camera;t.projectToScreen(this.location,Yt),As(he,this.location,this.direction),t.projectToScreen(he,at),Aa(at,Se(at,at,Yt)),this._updateVertexAttributesObject3D(t,e,0,Yt,at,1),this._updateVertexAttributesObject3D(t,e,1,Yt,at,-1)}_updateVertexAttributesObject3D(e,t,i,s,r,a){var d;const o=t.geometries[i],l=(d=o.getMutableAttribute(Ge.POSITION))==null?void 0:d.data;if(!l)return;const{start:c,end:u}=this._computeStartEnd(r,s,a,this.offset,this.width,this.length);e.unprojectFromScreen(Gi(c),he),l[0]=he[0],l[1]=he[1],l[2]=he[2],e.unprojectFromScreen(Gi(u),he),l[3]=he[0],l[4]=he[1],l[5]=he[2],t.geometryVertexAttributeUpdated(o,Ge.POSITION)}_updateVerticesDraped(e){const{view:{basemapTerrain:{overlayManager:t},state:{contentPixelRatio:i}}}=this,{location:s,width:r,length:a,offset:o}=this,l=fc;l.spatialReference=t.renderer.spatialReference,l.x=s[0],l.y=s[1];const c=this.view.overlayPixelSizeInMapUnits(l)*i,u=r*c,d=a*c,h=o*c;this._updateVertexAttributesDraped(e[0],u,d,h,-1),this._updateVertexAttributesDraped(e[1],u,d,h,1)}_updateVertexAttributesDraped(e,t,i,s,r){var d;const a=(d=e.getMutableAttribute(Ge.POSITION))==null?void 0:d.data;if(!a)return;const{location:o,direction:l}=this,{start:c,end:u}=this._computeStartEnd(l,o,r,s,t,i);a[0]=c[0],a[1]=c[1],a[2]=Gn,a[3]=u[0],a[4]=u[1],a[5]=Gn,e.invalidateBoundingInfo()}_computeStartEnd(e,t,i,s,r,a){const o=On(as,Ls(as,e[1]*i,e[0]*-i),s+r/2),l=kt(Bt,kt(Bt,kt(Bt,t,On(Bt,e,a/2)),o),o);return{start:l,end:kt(os,l,On(os,e,-a))}}};const he=m(),as=W(),Bt=W(),os=W(),Yt=zs(),at=zs(),fc=mt(0,0,void 0,null);function gc(n,e,t){return Z(n,e,t)}function rd(n){return n}function we(n,e,t){return Z(n,e,t)}function ft(n){return Re(n)}function A(n,e,{coordinateHelper:t,elevationInfo:i}){return n?Pt(t.vectorToDehydratedPoint(n,mc),e,i):null}function Pt(n,e,t){if(n==null)return null;if(e==null)return Z(n.x,n.y,n.z??0);if(e.type==="2d")return Z(n.x,n.y,0);const i=La(e,n,t,C)??0;return Z(n.x,n.y,i)}function ls(n,e){return mt(n[0],n[1],n[2],e)}function cs(n,e,{z:t,m:i},s){const{spatialReference:r,elevationInfo:a}=s;let o;t==null&&i==null?o=void 0:e==null||e.type==="2d"?o=t??void 0:o=za(e,n,r,C,a)??0;const l=mt(n[0],n[1],o,r);return i!=null&&(l.m=i,l.hasM=!0),l}const mc=mt(0,0,0,null);let de=class extends Hs{constructor(){super(...arguments),this.enabled=!0}};p([f({type:Boolean})],de.prototype,"enabled",void 0),de=p([I("esri.views.interactive.snapping.Settings.DefaultSnappingAlgorithm")],de);let M=class extends Hs{constructor(e){super(e),this.lineSnapper=new de,this.parallelLineSnapper=new de,this.rightAngleSnapper=new de,this.rightAngleTriangleSnapper=new de,this.shortLineThreshold=15,this.distance=5,this.pointThreshold=1e-6,this.intersectionParallelLineThreshold=1e-6,this.parallelLineThreshold=1e-6,this.verticalLineThresholdMeters=.3,this.touchSensitivityMultiplier=1.5,this.pointOnLineThreshold=1e-6,this.orange=new J([255,127,0]),this.orangeTransparent=new J([255,127,0,.5]),this.lineHintWidthReference=3,this.lineHintWidthTarget=3,this.lineHintFadedExtensions=.3,this.parallelLineHintWidth=2,this.parallelLineHintLength=24,this.parallelLineHintOffset=1.5,this.rightAngleHintSize=24,this.rightAngleHintOutlineSize=1.5,this.satisfiesConstraintScreenThreshold=1}};p([f({type:de,constructOnly:!0,nonNullable:!0,json:{write:!0}})],M.prototype,"lineSnapper",void 0),p([f({type:de,constructOnly:!0,nonNullable:!0,json:{write:!0}})],M.prototype,"parallelLineSnapper",void 0),p([f({type:de,constructOnly:!0,nonNullable:!0,json:{write:!0}})],M.prototype,"rightAngleSnapper",void 0),p([f({type:de,constructOnly:!0,nonNullable:!0,json:{write:!0}})],M.prototype,"rightAngleTriangleSnapper",void 0),p([f({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],M.prototype,"shortLineThreshold",void 0),p([f({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],M.prototype,"distance",void 0),p([f({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],M.prototype,"pointThreshold",void 0),p([f({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],M.prototype,"intersectionParallelLineThreshold",void 0),p([f({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],M.prototype,"parallelLineThreshold",void 0),p([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],M.prototype,"verticalLineThresholdMeters",void 0),p([f({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],M.prototype,"touchSensitivityMultiplier",void 0),p([f({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],M.prototype,"pointOnLineThreshold",void 0),p([f({type:J,nonNullable:!0})],M.prototype,"orange",void 0),p([f({type:J,nonNullable:!0})],M.prototype,"orangeTransparent",void 0),p([f({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],M.prototype,"lineHintWidthReference",void 0),p([f({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],M.prototype,"lineHintWidthTarget",void 0),p([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],M.prototype,"lineHintFadedExtensions",void 0),p([f({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],M.prototype,"parallelLineHintWidth",void 0),p([f({type:Number,nonNullable:!0,range:{min:0,max:50},json:{write:!0}})],M.prototype,"parallelLineHintLength",void 0),p([f({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],M.prototype,"parallelLineHintOffset",void 0),p([f({type:Number,nonNullable:!0,range:{min:0,max:46},json:{write:!0}})],M.prototype,"rightAngleHintSize",void 0),p([f({type:Number,nonNullable:!0,range:{min:0,max:6},json:{write:!0}})],M.prototype,"rightAngleHintOutlineSize",void 0),p([f({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],M.prototype,"satisfiesConstraintScreenThreshold",void 0),M=p([I("esri.views.interactive.snapping.Settings.Defaults")],M);const T=new M;var H;(function(n){n[n.FEATURE=1]="FEATURE",n[n.SELF=2]="SELF",n[n.ALL=3]="ALL"})(H||(H={}));const us={redo:"r",undo:"z",center:"Alt",constraint:"Shift",cancel:"Escape",delete:["Backspace","Delete"],complete:"Enter",vertexAdd:"f",pan:" "},ds={toggle:"Control"};function st(n,e){const t=n.x-e.x,i=n.y-e.y;return t*t+i*i}function _c(n,e){return Math.sqrt(st(n,e))}function _i(n,e){e.sort((t,i)=>sn(t.targetPoint,n)-sn(i.targetPoint,n))}var j;function ld({point:n,distance:e,returnEdge:t,vertexMode:i,coordinateHelper:{spatialReference:s},filter:r},a,o){return o=o!=null?o.clone():new Ha({where:"1=1"}),r&&(o.geometry=r.geometry,o.distance=r.distance,o.spatialRelationship=r.spatialRelationship,o.where=ni(o.where,r.where),o.timeExtent=Va(o.timeExtent,r.timeExtent),o.objectIds=yc(o.objectIds,r.objectIds)),{point:mt(n[0],n[1],n[2],s.toJSON()),mode:a,distance:e,returnEdge:t,vertexMode:i,query:o.toJSON()}}function yc(n,e){return n||e?e?n?Array.from(Ia(new Set(n),new Set(e))):e:n:null}function dn(n,e,t){return{left:A(n.leftVertex.pos,e,t),right:A(n.rightVertex.pos,e,t)}}function cd(n){return n.createQuery()}(function(n){n[n.TARGET=0]="TARGET",n[n.REFERENCE=1]="REFERENCE",n[n.REFERENCE_EXTENSION=2]="REFERENCE_EXTENSION"})(j||(j={}));const ps=Symbol("snapping-toggle");function vc(n,e=()=>{}){const t=w(()=>({view:n.view,snappingOptions:n.snappingOptions}),({view:i,snappingOptions:s})=>{if(n.removeHandles(ps),!i||!s)return;const r=ka.TOOL,a=[i.on("key-down",o=>{o.key!==ds.toggle||o.repeat||(s.enabledToggled=!0,e())},r),i.on("key-up",o=>{o.key===ds.toggle&&(s.enabledToggled=!1,e())},r),i.on("pointer-move",o=>{const l=o.native.ctrlKey;s.enabledToggled!==l&&(s.enabledToggled=l,e())},r)];n.addHandles(a,ps)},G);n.addHandles(t)}function hs(n){var e;return il(n)&&"utilityNetworks"in n&&!!((e=n.utilityNetworks)!=null&&e.length)}let Vt=class{constructor(e,t){this.isDraped=e,this.domain=t}},Or=class Cr extends Vt{constructor(e,t,i=H.ALL){super(t,i),this.intersectionPoint=e}equals(e){return e instanceof Cr&&P(this.intersectionPoint,e.intersectionPoint)}},ee=class Tr extends Vt{constructor(e,t,i,s,r=H.ALL,a=!0,o=!0){super(s,r),this.type=e,this.lineStart=t,this.lineEnd=i,this.fadeLeft=a,this.fadeRight=o}equals(e){return e instanceof Tr&&this.type===e.type&&P(this.lineStart,e.lineStart)&&P(this.lineEnd,e.lineEnd)&&this.fadeLeft===e.fadeLeft&&this.fadeRight===e.fadeRight}get length(){return bt(this.lineStart,this.lineEnd)}},Dr=class Rr extends Vt{constructor(e,t,i,s=H.ALL){super(i,s),this.lineStart=e,this.lineEnd=t}equals(e){return e instanceof Rr&&P(this.lineStart,e.lineStart)&&P(this.lineEnd,e.lineEnd)}},Sc=class Ar extends Vt{constructor(e,t,i){super(t,i),this.point=e}equals(e){return e instanceof Ar&&P(this.point,e.point)}},yi=class Lr extends Vt{constructor(e,t,i,s,r=H.ALL){super(s,r),this.previousVertex=e,this.centerVertex=t,this.nextVertex=i}equals(e){return e instanceof Lr&&P(this.previousVertex,e.previousVertex)&&P(this.centerVertex,e.centerVertex)&&P(this.nextVertex,e.nextVertex)}},wc=class{draw(e,t){const i=this._getUniqueHints(e),s=this.sortUniqueHints(i),r=[];for(const a of s)a instanceof Or&&r.push(this.visualizeIntersectionPoint(a,t)),a instanceof ee&&r.push(this.visualizeLine(a,t)),a instanceof Dr&&r.push(this.visualizeParallelSign(a,t)),a instanceof yi&&r.push(this.visualizeRightAngleQuad(a,t)),a instanceof Sc&&r.push(this.visualizePoint(a,t));return Fa(r)}sortUniqueHints(e){return e}_getUniqueHints(e){const t=[];for(const i of e){let s=!0;for(const r of t)if(i.equals(r)){s=!1;break}s&&t.push(i)}return t}},Pc=class extends wc{sortUniqueHints(e){return e.sort((t,i)=>(i instanceof ee?i.length:0)-(t instanceof ee?t.length:0))}visualizeIntersectionPoint(e,t){const{spatialReference:i,view:s}=t,r=wt(t);return ce(new Bi({view:s,primitive:"circle",geometry:ls(e.intersectionPoint,i),elevationInfo:e.isDraped?Vs:C,size:20,outlineSize:2,color:r.intersectionPointColor,outlineColor:r.intersectionPointOutlineColor,pixelSnappingEnabled:!1,isDecoration:!0,attached:!0}))}visualizePoint(e,t){const{view:i,spatialReference:s}=t,r=wt(t),a=He(e.point,e.domain,t);return ce(new Bi({view:i,primitive:"circle",geometry:ls(a,s),elevationInfo:Xt(e,t),size:20,outlineSize:2,color:r.pointColor,outlineColor:r.pointOutlineColor,pixelSnappingEnabled:!1,isDecoration:!0,attached:!0}))}visualizeLine(e,t){const{view:i,spatialReference:s}=t,r=wt(t),a=He(e.lineStart,e.domain,t),o=He(e.lineEnd,e.domain,t);return ce(this._createLineSegmentHint(e.type,a,o,s,Xt(e,t),i,r,e.isDraped,e.fadeLeft,e.fadeRight))}visualizeParallelSign(e,t){const{view:i,spatialReference:s}=t,r=wt(t),{isDraped:a}=e,o=Xt(e,t),l=He(e.lineStart,e.domain,t),c=He(e.lineEnd,e.domain,t),u=Be(l,s,o,i,a),d=Be(c,s,o,i,a),h=Is(d,u,d,.5),g=new hc({view:i,attached:!1,offset:T.parallelLineHintOffset,length:T.parallelLineHintLength,width:T.parallelLineHintWidth,color:r.parallelSignColor,location:h,renderOccluded:a?$.OccludeAndTransparent:$.Opaque,isDraped:a,renderGroup:Cn.SnappingHint,isDecoration:!0});return g.setDirectionFromPoints(u,h),g.attached=!0,ce(g)}visualizeRightAngleQuad(e,t){const{view:i,spatialReference:s}=t,r=wt(t),a=Xt(e,t),{isDraped:o}=e,l=He(e.previousVertex,e.domain,t),c=He(e.centerVertex,e.domain,t),u=He(e.nextVertex,e.domain,t),d=Be(l,s,a,i,o),h=Be(c,s,a,i,o),g=Be(u,s,a,i,o);return ce(new ko({view:i,attached:!0,color:o?r.rightAngleColorDraped:r.rightAngleColor,renderOccluded:o?$.OccludeAndTransparent:$.Transparent,outlineRenderOccluded:o?$.OccludeAndTransparent:$.Opaque,outlineColor:r.rightAngleOutlineColor,outlineSize:T.rightAngleHintOutlineSize,size:T.rightAngleHintSize,isDraped:o,geometry:{previous:d,center:h,next:g},renderGroup:Cn.SnappingHint,isDecoration:!0}))}_createLineSegmentHint(e,t,i,s,r,a,o,l=!1,c=!0,u=!0){const d=Be(t,s,r,a,l),h=Be(i,s,r,a,l),g=new dc({view:a,extensionType:le.FADED,start:d,end:h,isDraped:l,color:o.lineColor,renderOccluded:l?$.OccludeAndTransparent:$.Opaque,renderGroup:Cn.SnappingHint,isDecoration:!0});switch(e){case j.TARGET:g.width=T.lineHintWidthTarget,g.fadedExtensions={start:0,end:T.lineHintFadedExtensions};break;case j.REFERENCE_EXTENSION:g.width=T.lineHintWidthReference,g.fadedExtensions={start:0,end:0};break;case j.REFERENCE:g.width=T.lineHintWidthReference,g.fadedExtensions={start:c?T.lineHintFadedExtensions:0,end:u?T.lineHintFadedExtensions:0}}return g.attached=!0,g}};function wt(n){const{effectiveTheme:e}=n.view,t=J.toUnitRGBA(e.accentColor),i=[0,0,0,0];return{intersectionPointColor:i,intersectionPointOutlineColor:t,pointColor:i,pointOutlineColor:t,lineColor:t,lineOutlineColor:void 0,parallelSignColor:t,rightAngleColor:t,rightAngleColorDraped:J.toUnitRGBA(Ms(e.accentColor,.5)),rightAngleOutlineColor:t}}function He(n,e,t){const i=zr(e,t);return i==null?n:gc(n[0],n[1],i)}function Xt(n,e){return zr(n.domain,e)!=null?e.selfSnappingZ.elevationInfo:n.isDraped?Vs:C}function zr(n,{selfSnappingZ:e}){return n===H.SELF&&e!=null?e.value:null}function Be(n,e,t,i,s){const r=m();if(s){const a=i.basemapTerrain.overlayManager.renderer.spatialReference;Ne(n,e,r,a)}else Ao(n,e,t,i,r);return r}function $c(n,e,t,i,s){const r=ji(3*n.length),a=ji(r.length);n.forEach((c,u)=>{r[3*u]=c[0],r[3*u+1]=c[1],r[3*u+2]=c.length>2?c[2]:0});const o=Na(r,e,0,a,0,r,0,r.length/3,t,i,s),l=o!=null;return{numVertices:n.length,position:r,mapPositions:a,projectionSuccess:l,sampledElevation:o}}let bc=class extends Qs{constructor(e){super(e),this.view=null,this._renderOccluded=$.OccludeAndTransparent,this._vertices=null,this._spatialReference=null,this._color=qi([1,127/255,0,1]),this._size=11,this._outlineColor=qi([0,0,0,.5]),this._outlineSize=1,this._elevationInfo=null,this.applyProperties(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial(),this._updateOutlineMaterial())}get vertices(){return this._vertices}set vertices(e){this._vertices=e,this.recreateGeometry()}get spatialReference(){return this._spatialReference}set spatialReference(e){this._spatialReference=e,this.recreateGeometry()}get color(){return this._color}set color(e){ut(e,this._color)||(Et(this._color,e),this._updateMaterial())}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){ut(e,this._outlineColor)||(Et(this._outlineColor,e),this._updateOutlineMaterial())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this._updateOutlineMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}get _vertexMaterialParameters(){return{color:this._color,screenSizeScale:this.size,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}get _vertexOutlineMaterialParameters(){return{color:this._outlineColor,screenSizeScale:this.size+2*this.outlineSize,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateMaterial(){this.attached&&this._vertexMaterial.setParameters(this._vertexMaterialParameters)}_updateOutlineMaterial(){this.attached&&this._vertexOutlineMaterial.setParameters(this._vertexOutlineMaterialParameters)}_createRenderGeometries(){const e=this.vertices;if(e==null||e.length===0)return[];const t=.5,i=.5,s=$c(e,this.spatialReference,this.view.elevationProvider,this.view.renderCoordsHelper,Ga.fromElevationInfo(this.elevationInfo)),r=[],a=s.numVertices,o=s.position;for(let l=0;l<a;++l){const c=K(xc,o[3*l],o[3*l+1],o[3*l+2]),u=fs(this._vertexMaterial,t,c),d=fs(this._vertexOutlineMaterial,i,c);r.push({vertexGeometry:u,vertexOutlineGeometry:d})}return r}createGeometries(e){const t=this._createRenderGeometries();for(const{vertexGeometry:i,vertexOutlineGeometry:s}of t)e.addGeometry(i),e.addGeometry(s)}createExternalResources(){this._vertexMaterial=new Wi({...this._vertexMaterialParameters,writeDepth:!0,cullFace:Ui.Back,screenSizeEnabled:!0}),this._vertexOutlineMaterial=new Wi({...this._vertexOutlineMaterialParameters,forceTransparentMode:!0,writeDepth:!0,cullFace:Ui.Front,screenSizeEnabled:!0,shadingEnabled:!1})}destroyExternalResources(){this._vertexMaterial=null,this._vertexOutlineMaterial=null}forEachExternalMaterial(e){e(this._vertexMaterial),e(this._vertexOutlineMaterial)}};const xc=m();function fs(n,e,t){return Os(n,e,16,16,{offset:t})}let Ve=class extends te{constructor(e){super(e),this.layer=null,this.enabled=!0,this.updating=!1,this.availability=1,this.sublayerSources=new je}};p([f({constructOnly:!0})],Ve.prototype,"layer",void 0),p([f()],Ve.prototype,"enabled",void 0),p([f()],Ve.prototype,"updating",void 0),p([f()],Ve.prototype,"availability",void 0),p([f()],Ve.prototype,"sublayerSources",void 0),Ve=p([I("esri.views.interactive.snapping.FeatureSnappingLayerSource")],Ve);const vi=Ve;let k=class extends te{constructor(e){super(e),this.enabled=!1,this.enabledToggled=!1,this.forceDisabled=!1,this.selfEnabled=!0,this.featureEnabled=!0,this.featureSources=new je,this.distance=T.distance,this.touchSensitivityMultiplier=T.touchSensitivityMultiplier,this.constraintsActive=!1}get effectiveEnabled(){return!this.forceDisabled&&(this.enabledToggled?!this.enabled:this.enabled)}get effectiveSelfEnabled(){return this.effectiveEnabled&&this.selfEnabled}get effectiveFeatureEnabled(){return this.effectiveEnabled&&this.featureEnabled}get _effectiveFeatureSources(){var l;const e=this.featureSources;e.some(gs)&&yn.getLogger(this).warnOnce("Do not configure SubtypeGroupLayer sources in SnappingOptions.featureSources directly. Create a FeatureSnappingLayerSource for each SubtypeSublayer.");const t=e.filter(Ec),i=((l=this._get("_effectiveFeatureSources"))==null?void 0:l.filter(gs))??new je;for(const c of t){const u=i.find(d=>d.layer===c.layer.parent);if(u)u.sublayerSources.includes(c)||u.sublayerSources.add(c);else if(c.layer.parent){const d=new vi({layer:c.layer.parent});d.sublayerSources.add(c),i.add(d)}}for(const c of i){const u=c.sublayerSources.filter(d=>!t.includes(d));c.sublayerSources.removeMany(u)}i.removeMany(i.filter(c=>c.sublayerSources.length===0));const s=e.filter(Mc),r=this._get("_effectiveFeatureSources")??new je,{added:a,removed:o}=ja(r.toArray(),[...s,...i]);return r.removeMany(o),r.addMany(a),r}};p([f()],k.prototype,"enabled",void 0),p([f()],k.prototype,"enabledToggled",void 0),p([f()],k.prototype,"forceDisabled",void 0),p([f()],k.prototype,"selfEnabled",void 0),p([f()],k.prototype,"featureEnabled",void 0),p([f({type:je.ofType(vi)})],k.prototype,"featureSources",void 0),p([f()],k.prototype,"distance",void 0),p([f()],k.prototype,"touchSensitivityMultiplier",void 0),p([f()],k.prototype,"constraintsActive",void 0),p([f({readOnly:!0})],k.prototype,"effectiveEnabled",null),p([f({readOnly:!0})],k.prototype,"effectiveSelfEnabled",null),p([f({readOnly:!0})],k.prototype,"effectiveFeatureEnabled",null),p([f({readOnly:!0})],k.prototype,"_effectiveFeatureSources",null),k=p([I("esri.views.interactive.snapping.SnappingOptions")],k);const Hr=k;function gs(n){return n.layer.type==="subtype-group"}function Mc(n){return n.layer.type!=="subtype-group"}function Ec(n){return n.layer.type==="subtype-sublayer"}function Oc(n,e){const t=new Hr({enabled:!0,selfEnabled:!1,featureEnabled:!0,distance:(e==null?void 0:e.distance)??T.distance,touchSensitivityMultiplier:(e==null?void 0:e.touchSensitivityMultiplier)??T.touchSensitivityMultiplier});return{...w(()=>{var i,s;return((s=(i=n.map)==null?void 0:i.allLayers)==null?void 0:s.toArray())??[]},i=>{t.featureSources=new je(i.map(s=>new vi({layer:s,enabled:!0})))},pt),options:t}}function Si({start:n,end:e,type:t},i,s){const r=[],a=Se(It,e,n),o=Se(Pn,n,i),l=Ot(a),c=2*Lt(a,o),u=c*c-4*l*(Ot(o)-s*s);if(u===0){const d=-c/(2*l);(t===Q.PLANE||d>=0)&&r.push(xt(W(),n,a,d))}else if(u>0){const d=Math.sqrt(u),h=(-c+d)/(2*l);(t===Q.PLANE||h>=0)&&r.push(xt(W(),n,a,h));const g=(-c-d)/(2*l);(t===Q.PLANE||g>=0)&&r.push(xt(W(),n,a,g))}return r}function Vr(n,e){const t=n.start,i=n.end,s=Se(It,i,t),r=K(bn,-s[1],s[0],0),a=e.start,o=e.end,l=D($i,o,a),c=O(l,r),u=K(qr,t[0],t[1],0),d=D(Ur,u,a),h=O(d,r),g=ht();if(Math.abs(c)<g)return[];const _=R(Zr,a,l,h/c);if(e.type===V.RAY){const y=D(Yn,_,a);if(O(y,l)<-g)return[]}if(n.type===Q.HALF_PLANE){const y=Za(Pn,_,t);if(Lt(y,s)<-g)return[]}return[Re(_)]}function Cc(n,e){return Dc(pn(bi,e[2],n),e)}function Ir(n,e){return Gr(pn(bi,0,n),pn(zc,0,e)).map(([i,s])=>Jt(i,s))}function kr(n,e){return wi(n,pn(bi,n[2],e))}function Fr(n,e,t){const i=Se(It,n,e),s=Wa(i),r=s===0?1:t/s,a=m();return xt(a,e,i,r),a[2]=n[2],a}function wi(n,{start:e,end:t,type:i},s=m()){const r=D($n,n,e),a=D(bn,t,e),o=O(r,a)/O(a,a);return R(s,e,a,i===V.RAY?Math.max(o,0):o)}const Tc=(()=>{const n=m(),e=m(),t=m();return({start:i,end:s},{center:r,radius:a,normal:o,slicePlane:l})=>{const c=tt(r,o,Lc);if(x(jn(c,i),0)&&x(jn(c,s),0)){ks(o,n,e);const d=(_,y)=>(Ae(t,y,r),Ls(_,O(t,n),O(t,e)),_),h=Xo({start:d(It,i),end:d(Pn,s),type:V.LINE},Ba,a),g=[];for(const[_,y]of h){const v=L(m(),r);R(v,v,n,_),R(v,v,e,y),l&&!qe(l,v)||g.push(v)}return g}const u=m();return Fs(c,i,s,u)?!x(bt(u,r),a)||l&&!qe(l,u)?[]:[u]:[]}})();function Nr({start:n,end:e,type:t},i,s){const r=[],a=Ae($n,e,n),o=Se(Pn,n,i),l=Ot(a),c=2*Lt(a,o),u=c*c-4*l*(Ot(o)-s*s);if(u===0){const d=-c/(2*l);(t===V.LINE||d>=0)&&r.push(R(m(),n,a,d))}else if(u>0){const d=Math.sqrt(u),h=(-c+d)/(2*l);(t===V.LINE||h>=0)&&r.push(R(m(),n,a,h));const g=(-c-d)/(2*l);(t===V.LINE||g>=0)&&r.push(R(m(),n,a,g))}return r}function Gr(n,e){const t=n.start,i=n.end,s=e.start,r=e.end,a=D($n,i,t),o=D(bn,r,s),l=D($i,s,t),c=ue(qr,a,o);if(!x(O(l,c),0))return[];const u=qn(c);if(x(u,0))return[];const d=ue(Ur,l,o),h=O(d,c)/u,g=R(Zr,t,a,h);if(n.type===V.RAY){const _=D(Yn,g,t);if(O(a,_)<-ht())return[]}if(e.type===V.RAY){const _=D(Yn,g,s);if(O(o,_)<-ht())return[]}return[Re(g)]}function Dc({start:n,end:e,type:t},i){const s=D($n,i,n),r=D(bn,e,n),a=ue($i,r,s),o=qn(a)/qn(r),l=ht();if(o<l)switch(t){case V.LINE:return[Re(i)];case V.RAY:return O(r,s)<-l?[]:[Re(i)]}return[]}function Pi(n,e,t,i){const[s,r]=n,[a,o]=t,l=a-s,c=o-r,u=l*l+c*c,d=Math.sqrt(u);if(d>e+i)return[];if(d<Math.abs(e-i))return[];if(x(d,0)&&x(e,i))return[];const h=(e*e-i*i+u)/(2*d),g=Math.sqrt(e*e-h*h),_=g*c/d,y=g*l/d,[v,S]=Ns(It,n,t,h/d);return x(_,y)?[Jt(v,S)]:[Jt(v+_,S-y),Jt(v-_,S+y)]}function pn(n,e,{start:t,end:i,type:s}){return K(n.start,t[0],t[1],e),K(n.end,i[0],i[1],e),n.type=Ac[s],n}function jr(n,e){return x(n[2],e[2])}function x(n,e){return qa(Math.abs(n-e),0,ht())}function Rc(n,e){return e.filter(t=>qe(n,t))}function qe(n,e){return Ua(n,e)}var Q;(function(n){n[n.PLANE=0]="PLANE",n[n.HALF_PLANE=1]="HALF_PLANE"})(Q||(Q={}));const Ac={[Q.PLANE]:V.LINE,[Q.HALF_PLANE]:V.RAY},It=W(),Pn=W(),$n=m(),bn=m(),$i=m(),qr=m(),Ur=m(),Zr=m(),Yn=m(),Lc=q(),bi={start:m(),end:m(),type:V.LINE},zc={start:m(),end:m(),type:V.LINE};class Pe{intersect(e){return $e(this,e)}closestPoints(e){return[this.closestTo(e)]}}class _t extends Pe{constructor(e){super(),this.point=e}equals(e){return this===e||oe(e)&&P(this.point,e.point)}closestTo(){return ft(this.point)}}let xi=class extends Pe{constructor(e,t,i){super(),this.start=e,this.end=t,this.lineLike={start:e,end:t,type:i}}equals(e){return this===e||fe(e)&&this.lineLike.type===e.lineLike.type&&P(this.start,e.start)&&P(this.end,e.end)}closestTo(e){const t=wi(e,this.lineLike);return t}};class Mi extends xi{constructor(e,t){super(e,t,V.LINE)}}class Hc extends xi{constructor(e,t){super(e,t,V.RAY)}}class Wr extends Pe{constructor(e){super(),this.constraints=e}equals(e){return this===e||Xn(e)&&Xa(this.constraints,e.constraints,(t,i)=>t.equals(i))}closestTo(e){let t,i=1/0;for(const s of this.constraints){const r=s.closestTo(e),a=sn(e,r);a<i&&(i=a,t=r)}return t?ft(t):e}closestPoints(e){return this.constraints.flatMap(t=>t===this?[]:t.closestPoints(e))}}class Br extends Pe{constructor(e,t){super(),this.center=e,this.radius=t}equals(e){return this===e||me(e)&&this.center[0]===e.center[0]&&this.center[1]===e.center[1]&&this.radius===e.radius}closestTo(e){const t=Fr(e,this.center,this.radius);return t}}class Ei extends Pe{constructor(e,t){super(),this.center=e,this.radius=t}equals(e){return this===e||xe(e)&&P(this.center,e.center)&&this.radius===e.radius}closestTo(e){const t=Fr(e,this.center,this.radius);return t[2]=this.center[2],t}asCircle(){return new Oi(ft(this.center),this.radius,we(0,0,1))}}class Oi extends Pe{constructor(e,t,i,s=void 0){super(),this.center=e,this.radius=t,this.normal=i,this.slicePlane=s}equals(e){return this===e||Ie(e)&&P(this.center,e.center)&&P(this.normal,e.normal)&&this.radius===e.radius}closestTo(e){const{center:t,radius:i}=this;Gs(this.getPlane(Vc),e,zn);const s=D(zn,zn,t),r=nn(s);if(x(r,0))return ft(e);const a=i/Math.sqrt(r),o=R(m(),t,s,a),{slicePlane:l}=this;if(l&&!qe(l,o)){const c=Ti(l,this);return(c==null?void 0:c.closestTo(e))??ft(e)}return o}getPlane(e=q()){return tt(this.center,this.normal,e)}}const zn=m(),Vc=q();class Ic extends Pe{constructor(e){super(),this.z=e}equals(e){return this===e||be(e)&&this.z===e.z}closestTo(e){return Z(e[0],e[1],this.z)}getPlane(e=q()){return K(ms,0,0,this.z),tt(ms,to,e)}}const ms=m();class Ci extends Pe{constructor(e,t,i){super(),this.start=e,this.end=t,this.planeLike={start:e,end:t,type:i}}equals(e){return this===e||ge(e)&&this.planeLike.type===e.planeLike.type&&P(this.start,e.start)&&P(this.end,e.end)}closestTo(e){return kr(e,this.planeLike)}closestEndTo(e){const{start:t,end:i}=this.planeLike;return Math.sign(Lt(Se(kc,i,t),Se(Fc,e,t)))>0?this.end:this.start}getPlane(e=q()){const t=L(_s,this.end);return t[2]+=1,no(this.start,this.end,t,e)}getSlicePlane(e=q()){const{start:t,end:i,type:s}=this.planeLike;if(s===Q.PLANE)return;const r=K(_s,t[0],t[1],0),a=K(ys,i[0],i[1],0),o=Ae(ys,a,r);return tt(r,o,e),e}}const kc=W(),Fc=W(),_s=m(),ys=m();class Yr extends Ci{constructor(e,t){super(e,t,Q.HALF_PLANE)}}class Xr extends Ci{constructor(e,t){super(e,t,Q.PLANE)}}class Nc extends Pe{constructor(e,t){super(),this.sphere=io(e,t)}equals(e){return this===e||Me(e)&&so(this.sphere,e.sphere)}closestTo(e){const t=ro(this.sphere,e,m());return t}get center(){return ao(this.sphere)}get radius(){return this.sphere[3]}}class Qr extends Pe{constructor(e,t,i){super(),this.start=e,this.end=t,this.getZ=i,this.planeLike={start:e,end:t,type:Q.PLANE}}equals(e){return this===e||hn(e)&&P(this.start,e.start)&&P(this.end,e.end)&&this.getZ===e.getZ}closestTo(e){return Gc(this,e)}addIfOnTheGround(e,t){for(const i of t){const s=this.getZ(i[0],i[1])??0;x(i[2],s)&&(i[2]=s,e.push(i))}}}function Gc(n,e){const t=kr(e,n.planeLike);return t[2]=n.getZ(t[0],t[1])??Jr,t}function $e(n,e){if(Xn(n)){const t=[];for(const i of n.constraints){const s=i.intersect(e);s&&t.push(s)}return Di(t)}if(Xn(e))return $e(e,n);if(hn(n))return vs(n,e);if(hn(e))return vs(e,n);if(oe(n)){const{point:t}=n;if(oe(e))return P(t,e.point)?n:void 0;const i=e.closestTo(t);return Kn(i,t)?n:void 0}if(fe(n)){if(oe(e))return $e(e,n);if(fe(e))return pe(Gr(n.lineLike,e.lineLike));if(be(e))return jc(n,e);if(ge(e))return pe(Vr(e.planeLike,n.lineLike));if(me(e))return pe(Nr(n.lineLike,e.center,e.radius));if(Ie(e))return pe(Tc(n.lineLike,e));if(xe(e))return qc(n,e);if(Me(e))return Uc(n,e)}else if(be(n)){if(oe(e)||fe(e))return $e(e,n);if(be(e))return Zc(n,e);if(ge(e))return Wc(n,e);if(me(e))return Bc(n,e);if(Ie(e))return Xc(n,e);if(xe(e))return Yc(n,e);if(Me(e))return Qc(n,e)}else if(ge(n)){if(oe(e)||fe(e)||be(e))return $e(e,n);if(ge(e))return Hn(Ir(n.planeLike,e.planeLike));if(me(e))return Hn(Si(n.planeLike,e.center,e.radius));if(Ie(e))return Jc(n,e);if(xe(e))return Kc(n,e);if(Me(e))return eu(n,e)}else if(me(n)){if(oe(e)||fe(e)||be(e)||ge(e))return $e(e,n);if(me(e))return Hn(Pi(n.center,n.radius,e.center,e.radius));if(Ie(e))return void 0;if(xe(e))return tu(n,e);if(Me(e))return void 0}else if(Ie(n)){if(oe(e)||fe(e)||be(e)||ge(e)||me(e))return $e(e,n);if(Ie(e))return void 0;if(xe(e))return e.asCircle(),void 0;if(Me(e))return void 0}else if(xe(n)){if(oe(e)||fe(e)||be(e)||ge(e)||me(e)||Ie(e))return $e(e,n);if(xe(e))return nu(e,n);if(Me(e))return void 0}else if(Me(n)){if(oe(e)||fe(e)||be(e)||ge(e)||me(e)||xe(e))return $e(e,n);if(Me(e))return void 0}}const jc=(()=>{const n=q();return(e,t)=>{const{start:i,end:s}=e;if(jr(i,s)&&x(i[2],t.z))return e;const r=m();return Fs(t.getPlane(n),i,s,r)?new _t(r):void 0}})();function qc({lineLike:n},{center:e,radius:t}){const i=e[2];return pe(Nr(n,e,t).filter(s=>x(s[2],i)))}function Uc({lineLike:n},{sphere:e}){return pe(Ja(e,n.start,n.end))}const Ti=(()=>{const n=Cs(),e=m(),t=m();return(i,s,r)=>{const{normal:a,center:o,radius:l}=s;ks(a,e,t);const c=ti(i),u=l*O(c,e),d=l*O(c,t);Qa(n,o[0],o[1],o[2],1);const h=Ka(i,n),g=Math.hypot(u,d),_=x(g,0);if(x(jn(i,o),0)){if(_)return s;if(x(l,0))return!r||qe(r,o)?new _t(ft(o)):void 0;ue(e,c,a),Jn(e,e);const vt=new Array,Le=Re(o);R(Le,Le,e,l),r&&!qe(r,Le)||vt.push(Le);const Ze=Re(o);return R(Ze,Ze,e,-l),r&&!qe(r,Ze)||vt.push(Ze),pe(vt)}if(_)return;const y=-h/g;if(Math.abs(y)>1||x(y,1))return;const v=Math.atan(u/d),S=eo(y)-v,re=Math.PI-S,z=new Array,ne=m();R(ne,o,e,l*Math.cos(S)),R(ne,ne,t,l*Math.sin(S)),z.push(ne);const B=m();return R(B,o,e,l*Math.cos(re)),R(B,B,t,l*Math.sin(re)),z.push(B),pe(r?Rc(r,z):z)}})();function Zc(n,e){return x(n.z,e.z)?n:void 0}function Wc({z:n},{planeLike:e}){const[t,i]=e.start,[s,r]=e.end,a=we(t,i,n),o=we(s,r,n);return e.type===Q.PLANE?new Mi(a,o):new Hc(a,o)}function Bc(n,e){const[t,i]=e.center;return new Ei(we(t,i,n.z),e.radius)}function Yc(n,e){return x(e.center[2],n.z)?e:void 0}const Xc=(()=>{const n=q();return(e,t)=>Ti(e.getPlane(n),t,t.slicePlane)})();function Qc(n,{center:e,radius:t}){const i=Math.abs(e[2]-n.z);if(i>t&&!x(i,t))return;const s=we(e[0],e[1],n.z),r=Math.sqrt(t**2-i**2);return x(r,0)?void 0:new Ei(s,r)}const Kc=(()=>{const n=q();return(e,{center:t,radius:i})=>{const s=Si(e.planeLike,t,i),r=t[2];e.getSlicePlane(n);const a=new Array;for(const[o,l]of s){const c=[o,l,r];qe(n,c)&&a.push(c)}return pe(a)}})(),Jc=(()=>{const n=q(),e=q();return(t,i)=>Ti(t.getPlane(n),i,t.getSlicePlane(e))})(),eu=(()=>{const n=q();return(e,{center:t,radius:i})=>{const s=e.getPlane(n),r=Nn(s,t),a=Math.abs(r);if(a>i&&!x(a,i))return;const o=Re(ti(s)),l=R(m(),t,o,r),c=Math.sqrt(i**2-r**2);return x(c,0)?new _t(Gs(s,t,m())):new Oi(l,c,o,e.getSlicePlane())}})();function tu(n,e){const t=nt(n.center,e.center);return x(t,0)&&x(n.radius,e.radius)?e:Kr(Pi(n.center,n.radius,e.center,e.radius),e.center[2])}function nu(n,e){if(!jr(n.center,e.center))return;const t=nt(n.center,e.center);return x(t,0)&&x(n.radius,e.radius)?n:Kr(Pi(n.center,n.radius,e.center,e.radius),n.center[2])}function vs(n,e){const{planeLike:t,getZ:i}=n,s=new Array;if(oe(e))n.addIfOnTheGround(s,Cc(t,e.point));else if(fe(e))n.addIfOnTheGround(s,Vr(t,e.lineLike));else if(me(e))for(const[r,a]of Si(t,e.center,e.radius)){const o=i(r,a);o!=null&&s.push(Z(r,a,o))}else if(ge(e)||hn(e))for(const[r,a]of Ir(t,e.planeLike)){const o=i(r,a)??Jr;s.push(Z(r,a,o))}return pe(s)}function Hn(n){return Di(n.map(([e,t])=>{const i=we(e,t,0),s=we(e,t,1);return new Mi(i,s)}))}function pe(n){return Di(n.map(e=>e?new _t(e):void 0))}function Kr(n,e){return pe(n.map(([t,i])=>[t,i,e]))}function Di(n){if(n.length!==0)return n.length===1?n[0]??void 0:new Wr(n.filter(Ya))}function Xn(n){return n instanceof Wr}function oe(n){return n instanceof _t}function fe(n){return n instanceof xi}function be(n){return n instanceof Ic}function ge(n){return n instanceof Ci}function me(n){return n instanceof Br}function xe(n){return n instanceof Ei}function Ie(n){return n instanceof Oi}function Me(n){return n instanceof Nc}function hn(n){return n instanceof Qr}const Jr=0;let ie=class extends te{get layerView(){var e,t;return(t=(e=this.view)==null?void 0:e.allLayerViews)==null?void 0:t.find(i=>i.layer===this.layer)}get valid(){return this._valid}get subtypeFilter(){var r,a;const{layer:e,snappingSource:t}=this;if(!Ft(e)||!((r=e.subtypes)!=null&&r.length))return{mode:"not-in-use",filter:null};const i=t.layerSource.sublayerSources.filter(o=>{var l;return o.enabled&&o.layer.visible&&oo((l=this.view)==null?void 0:l.scale,o.layer.effectiveScaleRange.minScale,o.layer.effectiveScaleRange.maxScale)}).map(o=>o.layer.subtypeCode);if(!i.length)return{mode:"none-visible",filter:null};if(i.length===e.subtypes.length)return{mode:"all-visible",filter:null};const s=((a=e.fieldsIndex.get(e.subtypeField))==null?void 0:a.name)??e.subtypeField;return i.length===1?{mode:"in-use",filter:`${s} = ${i.getItemAt(0)}`}:{mode:"in-use",filter:`${s} IN (${i.join(", ")})`}}get floorFilter(){const{view:e,layer:t}=this;return e&&t?tl({view:e,layer:t}):null}constructor(e){super(e),this.rulesTable=null,this._valid=!1}initialize(){if(!this.snappingSource||!this.layer)return;const{layer:e,snappingSource:t}=this;if("refresh"in e){const i=e;this.addHandles(i.on("refresh",()=>t.refresh()))}this.loadRules(),this.addHandles([w(()=>t.updating,i=>t.layerSource.updating=i,G),w(()=>t.availability,i=>t.layerSource.availability=i,G)])}getFetchCandidatesParameters(e,t,i){var h,g,_,y,v;if(!this.valid)return[];const{layer:s,layerView:r,floorFilter:a,rulesTable:o,subtypeFilter:l}=this,c={distance:i,mode:((h=this.view)==null?void 0:h.type)??"2d",point:e,coordinateHelper:t.coordinateHelper,...this._types,filter:r&&"filter"in r?r.filter:null};if(a&&(c.filter=Vn(c.filter,a)),l.mode!=="not-in-use"&&l.mode!=="all-visible"){if(l.mode==="none-visible")return[];c.filter?c.filter.where=ni(c.filter.where,l.mode):c.filter=new en({where:l.filter})}const u=t.feature,d=((g=u==null?void 0:u.sourceLayer)==null?void 0:g.type)==="subtype-sublayer"?u.sourceLayer.parent:u==null?void 0:u.sourceLayer;if(o&&u&&hs((_=this.view)==null?void 0:_.map)&&(Tn(s)||Ft(s))&&s.layerId&&(Tn(d)||Ft(d))&&((y=this.view.map.utilityNetworks)!=null&&y.find(S=>S.isUtilityLayer(d)))){if(o.loadStatus!=="loaded")return[];const S=[],re=s.layerId,z=(v=o.getFeatureSQL(d,u))==null?void 0:v[re];if(!z)return[];const ne=z.anyVertex;let B=z.endVertex;return B&&ne&&B===ne&&(B=""),B&&S.push({...c,returnEdge:!1,vertexMode:"ends",filter:Vn(c.filter,B)}),ne&&S.push({...c,returnEdge:!1,vertexMode:"all",filter:Vn(c.filter,ne)}),S}return[c]}async loadRules(){var i,s;const{layer:e,view:t}=this;if(e&&t&&hs(t==null?void 0:t.map)&&(Tn(e)||Ft(e))){const r=(i=t.map.utilityNetworks)==null?void 0:i.find(a=>a.isUtilityLayer(e));if(r)try{this.rulesTable=await r.getRulesTable(),await((s=this.rulesTable)==null?void 0:s.load())}catch{return void yn.getLogger("esri.views.interactive.snapping.FeatureSnappingSourceInfo").error("Failed to load rules table for snapping source",e.title)}}this._valid=!0}get _types(){return{returnEdge:!0,vertexMode:"all"}}remove(){this.destroy()}destroy(){var e;(e=this.snappingSource)==null||e.destroy()}};function Vn(n,e){return n==null?new en({where:e}):n.where?new en({where:ni(n.where,e)}):new en({where:e})}p([f({constructOnly:!0})],ie.prototype,"layer",void 0),p([f({constructOnly:!0})],ie.prototype,"snappingSource",void 0),p([f({constructOnly:!0})],ie.prototype,"view",void 0),p([f()],ie.prototype,"layerView",null),p([f()],ie.prototype,"rulesTable",void 0),p([f()],ie.prototype,"valid",null),p([f()],ie.prototype,"subtypeFilter",null),p([f()],ie.prototype,"floorFilter",null),p([f()],ie.prototype,"_valid",void 0),ie=p([I("esri.views.interactive.snapping.FeatureSnappingSourceInfo")],ie);let yt=class{constructor(e,t,i,s){this.targetPoint=e,this.constraint=t,this.isDraped=i,this.domain=s}},Ri=class extends yt{constructor({targetPoint:e,objectId:t,constraint:i,isDraped:s}){super(e,i,s,H.FEATURE),this.objectId=t}},iu=class extends Ri{constructor(e){super({...e,isDraped:!0,constraint:new Qr(e.edgeStart,e.edgeEnd,e.getGroundElevation)})}get hints(){return[new ee(j.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}},ea=class extends Ri{constructor(e){super({...e,constraint:new Mi(e.edgeStart,e.edgeEnd)})}get hints(){return[new ee(j.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}};class Ai extends yt{constructor({targetPoint:e,constraint:t,previousVertex:i,otherVertex:s,otherVertexType:r,objectId:a,isDraped:o}){super(e,t,o,H.SELF),this.previousVertex=i,this.otherVertex=s,this.otherVertexType=r,this.objectId=a}get hints(){const e=this.previousVertex,t=this.otherVertexType===gt.CENTER?this.otherVertex:this.targetPoint,i=this.otherVertexType===gt.CENTER?this.targetPoint:this.otherVertex;return[new ee(j.TARGET,t,i,this.isDraped,this.domain),new ee(j.REFERENCE,e,t,this.isDraped,this.domain),new yi(this.previousVertex,t,i,this.isDraped,this.domain)]}}var gt;(function(n){n[n.NEXT=0]="NEXT",n[n.CENTER=1]="CENTER"})(gt||(gt={}));let Oe=class extends te{get updating(){return this._snappingSources.some(e=>e==null||e.valid&&e.snappingSource.updating)||this._updatingHandles.updating}constructor(e){super(e),this.options=null,this._domain=H.FEATURE,this._updatingHandles=new js,this._sourceModules={featureService:{module:null,loader:null},featureCollection:{module:null,loader:null},graphics:{module:null,loader:null},notes:{module:null,loader:null},scene:{module:null,loader:null}}}initialize(){const e=lo(()=>{var t;return(t=this.options)==null?void 0:t._effectiveFeatureSources},(t,i)=>this._createSourceInfo(t,i));this._snappingSources=e,this.addHandles(ce(e))}destroy(){this._set("options",null),this._updatingHandles.destroy()}async fetchCandidates(e,t,i,s){var l;if(!(t&this._domain&&this.options!=null&&this.options.effectiveFeatureEnabled))return[];const r=[],a=this._computeScreenSizeDistanceParameters(e,i);for(const c of this._snappingSources){if(c==null||!c.valid||!c.snappingSource.layerSource.enabled||(l=c.layerView)!=null&&l.suspended)continue;const u=c.getFetchCandidatesParameters(e,i,a);for(const d of u)r.push(c.snappingSource.fetchCandidates(d,s).then(h=>h.filter(g=>!this._candidateIsExcluded(c.snappingSource,g,i.excludeFeature))))}const o=(await co(r)).flat();return this._addRightAngleCandidates(o,e,a,i),Dn(s),_i(e,o),o}_addRightAngleCandidates(e,t,i,s){var d,h,g,_,y,v,S,re;const r=s.vertexHandle!=null?(h=(d=s.vertexHandle.rightEdge)==null?void 0:d.rightVertex)==null?void 0:h.pos:s.editGeometryOperations!=null&&s.editGeometryOperations.data.type==="polygon"?(_=(g=s.editGeometryOperations.data.components[0])==null?void 0:g.getFirstVertex())==null?void 0:_.pos:null,a=s.vertexHandle!=null?(v=(y=s.vertexHandle.leftEdge)==null?void 0:y.leftVertex)==null?void 0:v.pos:s.editGeometryOperations!=null?(re=(S=s.editGeometryOperations.data.components[0])==null?void 0:S.getLastVertex())==null?void 0:re.pos:null,{view:o}=this,l=A(r,o,s),c=A(a,o,s),u=e.length;for(let z=0;z<u;z++)this._addRightAngleCandidate(e[z],c,t,i,e),this._addRightAngleCandidate(e[z],l,t,i,e)}_addRightAngleCandidate(e,t,i,s,r){if(t==null||!su(e))return;const a=e.constraint.closestTo(t),o=(a[0]-i[0])/s.x,l=(a[1]-i[1])/s.y,{start:c,end:u}=e.constraint;if(o*o+l*l<=1){const d=new Ai({targetPoint:a,otherVertex:t,otherVertexType:gt.NEXT,previousVertex:nt(a,c)>nt(a,u)?c:u,constraint:new Yr(t,a),objectId:e.objectId,isDraped:e.isDraped});r.push(d)}}_computeScreenSizeDistanceParameters(e,t){let i=this.options!=null?this.options.distance*(t.pointer==="touch"?this.options.touchSensitivityMultiplier:1):0;return this.view==null?{x:i,y:i,z:i,distance:i}:this.view.type==="2d"?(i*=this.view.resolution,{x:i,y:i,z:i,distance:i}):this._computeScreenSizeDistanceParameters3D(e,i,this.view,t)}_computeScreenSizeDistanceParameters3D(e,t,i,s){const{spatialReference:r}=s;i.renderCoordsHelper.toRenderCoords(e,r,Ss);const a=i.state.camera.computeScreenPixelSizeAt(Ss),o=a*i.renderCoordsHelper.unitInMeters,l=o/qs(r),c=o/uo(r),u=t*l,d=t*c,h=F(e,r,C,i),g=h?In(h,e,l,0,0,i,s):0,_=h?In(h,e,0,l,0,i,s):0,y=h?In(h,e,0,0,c,i,s):0;return{x:g===0?0:u/g,y:_===0?0:u/_,z:y===0?0:d/y,distance:a*t}}_candidateIsExcluded(e,t,i){if(i==null)return!1;const s=this._getCandidateObjectId(t);if(s==null)return!1;const r=e.layerSource.layer;return r.type==="graphics"?i.uid===s:i.sourceLayer===r&&!(!i.attributes||!("objectIdField"in r))&&i.attributes[r.objectIdField]===s}_getCandidateObjectId(e){return e instanceof Ri?e.objectId:null}async _createSourceInfo(e,t){const i=e.layer;i.loaded||(await i.load(),Dn(t));const{view:s}=this,r=await this._createFeatureSnappingSourceType(e);return Dn(t),new ie(r==null?{}:{snappingSource:r,view:s,layer:i})}async _createFeatureSnappingSourceType(e){switch(e.layer.type){case"feature":case"geojson":case"csv":case"oriented-imagery":case"subtype-group":case"wfs":return this._createFeatureSnappingSourceFeatureLayer(e);case"graphics":return this._createFeatureSnappingSourceGraphicsLayer(e);case"map-notes":return this._createFeatureSnappingSourceMapNotesLayer(e);case"scene":case"building-scene":return this._createFeatureSnappingSourceSceneLayer(e)}return null}async _createFeatureSnappingSourceSceneLayer(e){const{view:t}=this;return t==null||t.type!=="3d"?null:new(await this._getSourceModule("scene")).SceneLayerSnappingSource({layerSource:e,view:t})}async _createFeatureSnappingSourceFeatureLayer(e){var t;switch((t=e.layer.source)==null?void 0:t.type){case"feature-layer":case"oriented-imagery":return new(await this._getSourceModule("featureService")).FeatureServiceSnappingSource({spatialReference:this.spatialReference,view:this.view,layerSource:e});case"memory":case"csv":case"geojson":case"wfs":return e.layer.geometryType==="mesh"?null:new(await this._getSourceModule("featureCollection")).FeatureCollectionSnappingSource({layerSource:e,view:this.view})}return null}async _createFeatureSnappingSourceGraphicsLayer(e){return new(await this._getSourceModule("graphics")).GraphicsSnappingSource({getGraphicsLayers:()=>[e.layer],spatialReference:this.spatialReference,view:this.view,layerSource:e})}async _createFeatureSnappingSourceMapNotesLayer(e){return new(await this._getSourceModule("notes")).GraphicsSnappingSource({getGraphicsLayers:()=>{var t;return((t=e.layer.sublayers)==null?void 0:t.toArray())??[]},spatialReference:this.spatialReference,view:this.view,layerSource:e})}async _getSourceModule(e){const t=this._sourceModules[e];if(t.loader==null){const i=this._loadSourceModule(e),s={module:null,loader:i};this._sourceModules[e]=s;const r=await i,a={module:r,loader:i};return this._sourceModules[e]=a,r}return t.module==null?t.loader:t.module}_loadSourceModule(e){const t=this._updatingHandles;switch(e){case"featureService":return t.addPromise(Nt(()=>import("./FeatureServiceSnappingSource-CI_QLDU7.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22])));case"featureCollection":return t.addPromise(Nt(()=>import("./FeatureCollectionSnappingSource-DksMmbCh.js"),__vite__mapDeps([23,1,2,3,4,24,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22])));case"graphics":case"notes":return t.addPromise(Nt(()=>import("./GraphicsSnappingSource-BAepIgqW.js"),__vite__mapDeps([25,1,2,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,3,4,24,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22])));case"scene":return t.addPromise(Nt(()=>import("./SceneLayerSnappingSource-D1pKVu4l.js"),__vite__mapDeps([44,1,2,4,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22])))}}get test(){return{snappingSources:this._snappingSources}}};function su(n){return(n instanceof ea||n instanceof iu)&&!ru(n)}function ru({constraint:{start:n,end:e}}){const t=sn(n,e),i=nt(n,e);return t<ht()||i/t<ou}function In(n,e,t,i,s,r,{spatialReference:a}){const o=L(au,e);o[0]+=t,o[1]+=i,o[2]+=s;const l=F(o,a,C,r);return l?_c(l,n):1/0}p([f({constructOnly:!0})],Oe.prototype,"spatialReference",void 0),p([f({constructOnly:!0})],Oe.prototype,"view",void 0),p([f()],Oe.prototype,"options",void 0),p([f({readOnly:!0})],Oe.prototype,"updating",null),p([f()],Oe.prototype,"_snappingSources",void 0),Oe=p([I("esri.views.interactive.snapping.FeatureSnappingEngine")],Oe);const Ss=m(),au=m(),ou=1e-4;let xn=class{constructor(e,t){this.view=e,this.options=t,this.squaredShortLineThreshold=T.shortLineThreshold*T.shortLineThreshold}snap(e,t){return t.vertexHandle!=null?t.vertexHandle.type!=="vertex"?[]:this.snapExistingVertex(e,t):this.snapNewVertex(e,t)}edgeExceedsShortLineThreshold(e,t){return this.exceedsShortLineThreshold(A(e.leftVertex.pos,this.view,t),A(e.rightVertex.pos,this.view,t),t)}exceedsShortLineThreshold(e,t,{spatialReference:i}){return this.squaredShortLineThreshold===0||st(F(t,i,C,this.view),F(e,i,C,this.view))>this.squaredShortLineThreshold}isVertical(e,t,{spatialReference:i}){const s=qs(i);return ii(e,t)*s<T.verticalLineThresholdMeters}squaredProximityThreshold(e){return e==="touch"?this._squaredTouchProximityThreshold:this._squaredMouseProximityThreshold}get _squaredMouseProximityThreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,i=e*t;return i*i}},ta=class extends yt{constructor({lineStart:e,lineEnd:t,targetPoint:i,isDraped:s}){super(i,new Xr(e,t),s,H.SELF),this._referenceLineHint=new ee(j.REFERENCE_EXTENSION,e,t,s,this.domain)}get hints(){return[this._referenceLineHint,new ee(j.TARGET,this._lineEndClosestToTarget(),this.targetPoint,this.isDraped,this.domain)]}_lineEndClosestToTarget(){return this.constraint.closestEndTo(this.targetPoint)}};var ws;(function(n){n.Absolute="absolute",n.Relative="relative",n.RelativeBilateral="relative-bilateral"})(ws||(ws={}));const fn=(()=>{const n=W(),e=m(),t=m();return(i,s,r,a)=>{if(P(i,s))return;const o=Wn(r),l=Wn(a);if(o&&l&&gn(o,l)&&Ne(i,r,e,o)&&Ne(s,a,t,l)){const{azimuth:u}=li(cu,e,t,o);return u!=null?_n(u,"degrees","radians"):void 0}n[0]=s[0]-i[0],n[1]=s[1]-i[1];let c=po(ho,n);return n[0]<0&&(c=uu-c),c}})(),na=(()=>{const n=m();return(e,t,i,s,r,a="geodesic")=>{L(n,t);const o=lu(r);if(a==="geodesic"){const g=Wn(i);if(g&&Ne(n,i,n,g))return Lo(e,n,o,s,g),e[2]=t[2],!!Ne(e,g,e,i)}const l=er(o,"geographic","arithmetic"),c=_n(l,"degrees","radians"),u=t[0]+s*Math.cos(c),d=t[1]+s*Math.sin(c),h=t[2];return K(e,u,d,h),!0}})();function lu(n){return n!=null?er(_n(n.value,n.unit,"degrees"),n.rotationType,"geographic"):void 0}const cu=new Ks,uu=2*Math.PI;let du=class extends xn{snapNewVertex(e,t){const i=t.editGeometryOperations.data.components[0],s=i.edges.length,r=[];if(s<1)return r;const{spatialReference:a}=t,o=F(e,a,C,this.view),{view:l}=this,c=i.edges[s-1];let u=c;do{if(this.edgeExceedsShortLineThreshold(u,t)){const d=dn(u,l,t);this._processCandidateProposal(d.left,d.right,e,o,t,r)}u=u.leftVertex.leftEdge}while(u&&u!==c);return r}snapExistingVertex(e,t){const i=[],s=t.vertexHandle,r=s.component;if(r.edges.length<2)return i;const{view:a}=this,{spatialReference:o}=t,l=F(e,o,C,a),c=s.leftEdge,u=s.rightEdge;c&&u&&this.edgeExceedsShortLineThreshold(c,t)&&this.edgeExceedsShortLineThreshold(u,t)&&this._processCandidateProposal(A(c.leftVertex.pos,a,t),A(u.rightVertex.pos,a,t),e,l,t,i);const d=r.edges[0];let h=d;do{if(h!==s.leftEdge&&h!==s.rightEdge&&this.edgeExceedsShortLineThreshold(h,t)){const g=dn(h,a,t);this._processCandidateProposal(g.left,g.right,e,l,t,i)}h=h.rightVertex.rightEdge}while(h&&h!==d);return i}_processCandidateProposal(e,t,i,s,r,a){var d;const{spatialReference:o,pointer:l}=r,c=m();this._projectedLine(c,e,t,i,r);const u=c;st(s,F(u,o,C,this.view))<this.squaredProximityThreshold(l)&&a.push(new ta({lineStart:e,lineEnd:t,targetPoint:u,isDraped:((d=r.elevationInfo)==null?void 0:d.mode)==="on-the-ground"}))}_projectedLine(e,t,i,s,r){this._projectToLineGeodesic(e,t,i,s,r)||this._projectToLinePlanar(e,s,t,i)}_projectToLineGeodesic(e,t,i,s,{spatialReference:r}){const a=fn(t,i,r,r);if(a==null)return!1;const o=fn(i,s,r,r);if(o==null)return!1;const l=pi(i,s,r);if(l==null)return!1;const c=Math.abs(fo.shortestSignedDiff(a,o))>Math.PI/2?Us.normalize(a+Math.PI):a;return na(e,i,r,tr(l,"meters"),nr(c,"radians","geographic"),"geodesic"),e[2]=s[2],!0}_projectToLinePlanar(e,t,i,s){wi(t,{start:i,end:s,type:V.LINE},e),e[2]=t[2]}},ia=class extends yt{constructor({referenceLine:e,lineStart:t,targetPoint:i,isDraped:s}){const r=Re(t),{left:a,right:o}=e;Ae(r,As(r,r,o),a),super(i,new Xr(t,r),s,H.SELF),this._referenceLines=[{edge:e,fadeLeft:!0,fadeRight:!0}]}get hints(){return[new ee(j.TARGET,this.constraint.start,this.targetPoint,this.isDraped,this.domain),new Dr(this.constraint.start,this.targetPoint,this.isDraped,this.domain),...this._referenceLines.map(e=>new ee(j.REFERENCE,e.edge.left,e.edge.right,this.isDraped,this.domain,e.fadeLeft,e.fadeRight))]}addReferenceLine(e){const t={edge:e,fadeLeft:!0,fadeRight:!0};this._referenceLines.forEach(i=>{P(e.right,i.edge.left)&&(i.fadeLeft=!1,t.fadeRight=!1),P(e.right,i.edge.right)&&(i.fadeRight=!1,t.fadeRight=!1),P(e.left,i.edge.right)&&(i.fadeRight=!1,t.fadeLeft=!1),P(e.left,i.edge.left)&&(i.fadeLeft=!1,t.fadeLeft=!1)}),this._referenceLines.push(t)}},pu=class extends xn{snapNewVertex(e,t){const i=t.editGeometryOperations.data.components[0],s=i.edges.length,r=i.vertices.length,a=[];if(s<2)return a;const{view:o}=this,l=F(e,t.spatialReference,C,o),c=A(i.vertices[r-1].pos,o,t),u=A(i.vertices[0].pos,o,t),d=i.edges[s-1];let h=d;do{if(this.edgeExceedsShortLineThreshold(h,t)){const g=dn(h,o,t);this._checkEdgeForParallelLines(g,c,e,l,t,a),this._checkEdgeForParallelLines(g,u,e,l,t,a)}h=h.leftVertex.leftEdge}while(h&&h!==d);return a}snapExistingVertex(e,t){const i=[],s=t.vertexHandle,r=s.component;if(r.edges.length<3)return i;const{view:a}=this,o=F(e,t.spatialReference,C,a),l=s.leftEdge,c=s.rightEdge,u=r.vertices[0],d=A(u.pos,a,t),h=r.vertices.length,g=r.vertices[h-1],_=A(g.pos,a,t),y=r.edges[0];let v=y;do{if(v!==l&&v!==c&&this.edgeExceedsShortLineThreshold(v,t)){const S=dn(v,a,t);l&&this._checkEdgeForParallelLines(S,A(l.leftVertex.pos,a,t),e,o,t,i),c&&this._checkEdgeForParallelLines(S,A(c.rightVertex.pos,a,t),e,o,t,i),s===u?this._checkEdgeForParallelLines(S,_,e,o,t,i):s===g&&this._checkEdgeForParallelLines(S,d,e,o,t,i)}v=v.rightVertex.rightEdge}while(v&&v!==y);return i}_checkEdgeForParallelLines(e,t,i,s,r,a){var h;const o=e.left,l=e.right;if(Rn(Ye,t,o,l),nt(Ye,t)<T.parallelLineThreshold)return;Rn(Ye,i,o,l,t);const{spatialReference:c,pointer:u}=r,d=we(Ye[0],Ye[1],i[2]);if(st(s,F(d,c,C,this.view))<this.squaredProximityThreshold(u)){if(this.isVertical(d,t,r)||this.isVertical(o,l,r)||this._parallelToPreviousCandidate(e,a))return;a.push(new ia({referenceLine:e,lineStart:t,targetPoint:d,isDraped:((h=r.elevationInfo)==null?void 0:h.mode)==="on-the-ground"}))}}_parallelToPreviousCandidate(e,t){const i=e.left,s=e.right;for(const r of t)if(Rn(Ye,s,r.constraint.start,r.constraint.end,i),nt(Ye,s)<T.parallelLineThreshold)return r.addReferenceLine(e),!0;return!1}};const Ye=W();class hu extends xn{snapNewVertex(e,t){const i=t.editGeometryOperations.data.components[0],s=[];if(i.vertices.length<2)return s;const{view:r}=this,a=F(e,t.spatialReference,C,r),o=i.vertices.at(-1);this._checkForSnappingCandidate(s,o.leftEdge,o,o.leftEdge.leftVertex,e,a,t);const l=i.vertices[0];return this._checkForSnappingCandidate(s,l.rightEdge,l,l.rightEdge.rightVertex,e,a,t),s}snapExistingVertex(e,t){const i=[],s=t.vertexHandle;if(s.component.vertices.length<3)return i;const{view:r}=this,a=F(e,t.spatialReference,C,r),o=s.leftEdge,l=s.rightEdge;if(o!=null&&o.leftVertex.leftEdge){const c=o.leftVertex.leftEdge;this._checkForSnappingCandidate(i,c,c.rightVertex,c.leftVertex,e,a,t)}if(l!=null&&l.rightVertex.rightEdge){const c=l.rightVertex.rightEdge;this._checkForSnappingCandidate(i,c,c.leftVertex,c.rightVertex,e,a,t)}return i}_checkForSnappingCandidate(e,t,i,s,r,a,o){if(!this.edgeExceedsShortLineThreshold(t,o))return;const l=this.view,c=A(i.pos,l,o),u=A(s.pos,l,o);this._checkForSnappingCandidateNormalized(e,u,c,r,a,o)}_checkForSnappingCandidateNormalized(e,t,i,s,r,a){this._projectionRay(Ps,t,i,s,a),this._checkForSnappingCandidateAlongProjectedRay(e,t,i,Ps,s,r,a)}_projectionRay(e,t,i,s,r){this._projectionRayGeodesic(e,t,i,s,r)||this._projectionRayPlanar(e,t,i)}_projectionRayGeodesic(e,t,i,s,{spatialReference:r}){const a=fn(t,i,r,r);if(a==null)return!1;const o=fn(i,s,r,r);if(o==null)return!1;const l=Math.sign(Us.shortestSignedDiff(a,o))*Math.PI*.5,c=nr(a+l,"radians","geographic"),u=m(),d=pi(i,s,r);return d!=null&&(na(u,i,r,tr(d,"meters"),c,"geodesic"),Ae(e,u,i),!0)}_projectionRayPlanar(e,t,i){const s=Se(kn,i,t);K(e,s[1],-s[0],0)}_checkForSnappingCandidateAlongProjectedRay(e,t,i,s,r,a,o){var y;const{spatialReference:l,pointer:c}=o,u=Se(kn,r,i),d=Lt(s,u)/Ot(s),h=xt(kn,i,s,d),g=we(h[0],h[1],r[2]);if(st(a,F(g,l,C,this.view))>this.squaredProximityThreshold(c)||this.isVertical(g,i,o)||this.isVertical(i,t,o))return;const _=R(m(),i,s,Math.sign(d));e.push(new Ai({targetPoint:g,constraint:new Yr(i,_),previousVertex:t,otherVertex:i,otherVertexType:gt.CENTER,isDraped:((y=o.elevationInfo)==null?void 0:y.mode)==="on-the-ground"}))}}const kn=W(),Ps=m();let fu=class extends yt{constructor({targetPoint:e,point1:t,point2:i,isDraped:s}){super(e,new Br(Is(m(),t,i,.5),.5*ii(t,i)),s,H.SELF),this._p1=t,this._p2=i}get hints(){return[new ee(j.REFERENCE,this.targetPoint,this._p1,this.isDraped,this.domain),new ee(j.REFERENCE,this.targetPoint,this._p2,this.isDraped,this.domain),new yi(this._p1,this.targetPoint,this._p2,this.isDraped,this.domain)]}},gu=class extends xn{snapNewVertex(e,t){const i=t.editGeometryOperations.data.components[0],s=[],r=i.vertices.length;if(t.editGeometryOperations.data.type!=="polygon"||r<2)return s;const{view:a}=this,o=i.vertices[0],l=i.vertices[r-1],c=A(o.pos,a,t),u=A(l.pos,a,t);return this._processCandidateProposal(c,u,e,t,s),s}snapExistingVertex(e,t){const i=[],s=t.vertexHandle,r=s.component;if(r.edges.length<2||t.editGeometryOperations.data.type==="polyline"&&(s.index===0||s.index===r.vertices.length-1))return i;const{view:a}=this,o=A(s.leftEdge.leftVertex.pos,a,t),l=A(s.rightEdge.rightVertex.pos,a,t);return this._processCandidateProposal(o,l,e,t,i),i}_processCandidateProposal(e,t,i,s,r){var g;if(!this.exceedsShortLineThreshold(e,t,s))return;const a=Ns($s,e,t,.5),o=.5*ii(e,t),l=Qo($s,i,a,o),c=we(l[0],l[1],i[2]),{spatialReference:u,pointer:d}=s,h=F(i,u,C,this.view);if(st(h,F(c,u,C,this.view))<this.squaredProximityThreshold(d)){if(this.isVertical(e,c,s)||this.isVertical(c,t,s))return;r.push(new fu({targetPoint:c,point1:e,point2:t,isDraped:((g=s.elevationInfo)==null?void 0:g.mode)==="on-the-ground"}))}}};const $s=W();let ot=class extends te{constructor(e){super(e),this.updating=!1,this._snappers=new je,this._domain=H.SELF}initialize(){this._snappers.push(new pu(this.view,this.options),new du(this.view,this.options),new hu(this.view,this.options),new gu(this.view,this.options))}set options(e){this._set("options",e);for(const t of this._snappers)t.options=e}async fetchCandidates(e,t,i){if(!(t&this._domain&&this.options.effectiveSelfEnabled))return[];const s=[];for(const r of this._snappers.items)for(const a of r.snap(e,i))s.push(a);return _i(e,s),s}};p([f({readOnly:!0})],ot.prototype,"updating",void 0),p([f({constructOnly:!0})],ot.prototype,"view",void 0),p([f()],ot.prototype,"options",null),ot=p([I("esri.views.interactive.snapping.SelfSnappingEngine")],ot);function mu(n,e){return[new ot({view:n,options:e}),new Oe({view:n,options:e,spatialReference:n.spatialReference})]}let Qt=class extends yt{constructor(e,t,i,s){super(e,new _t(e),s,H.ALL),this.first=t,this.second=i}get hints(){return this.first.targetPoint=this.targetPoint,this.second.targetPoint=this.targetPoint,[...this.first.hints,...this.second.hints,new Or(this.targetPoint,this.isDraped,this.domain)]}},ae=class extends go.EventedMixin(te){constructor(e){super(e),this.options=new Hr,this.snappingEnginesFactory=mu,this._engines=[],this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=Ce.MAIN}initialize(){this.addHandles([w(()=>{const{effectiveFeatureEnabled:e,effectiveSelfEnabled:t,touchSensitivityMultiplier:i,distance:s,constraintsActive:r}=this.options;return{effectiveFeatureEnabled:e,effectiveSelfEnabled:t,touchSensitivityMultiplier:i,distance:s,constraintsActive:r}},()=>{this.doneSnapping(),this.emit("changed")},Ct),w(()=>this.options,e=>{for(const t of this._engines)t.options=e},Ct),w(()=>({viewReady:this.view.ready,viewSpatialReference:this.view.spatialReference,snappingEnginesFactory:this.snappingEnginesFactory}),({viewReady:e,snappingEnginesFactory:t})=>this._recreateEngines(e,t),G)])}destroy(){this._destroyEngines()}get updating(){return this._engines.some(e=>e.updating)}_recreateEngines(e,t){if(this._destroyEngines(),!e)return;const{view:i,options:s}=this;this._engines=t(i,s)}_destroyEngines(){for(const e of this._engines)e.destroy();this._engines=[]}get _squaredMouseProximityThreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,i=e*t;return i*i}get _squaredSatisfiesConstraintThreshold(){return T.satisfiesConstraintScreenThreshold*T.satisfiesConstraintScreenThreshold}snap(e){return _u(e)?this._snapMultiPoint(e):this._snapSinglePoint(e)}update(e){const{point:t,context:i}=e;this._removeVisualization();const s=this._currentMainCandidate;if(s==null)return t;const r=this._selectUpdateInput(e);if(r==null)return t;const{spatialReference:a}=i,o=Zi(r,a);if(o==null)return t;const{view:l}=this,{elevationInfo:c,visualizer:u}=i,d=[],h=Pt(o,l,c),g=s.constraint.closestTo(h);if(!this._arePointsWithinScreenThreshold(h,g,i))return this._resetSnappingState(),t;s.targetPoint=g,d.push(...s.hints);for(const _ of this._currentOtherActiveCandidates)_.targetPoint=g,d.push(..._.hints);return u!=null&&this.addHandles(u.draw(d,{spatialReference:a,elevationInfo:yu(i),view:l,selfSnappingZ:i.selfSnappingZ}),Kt),cs(g,l,t,i)}doneSnapping(){this._removeVisualization(),this._resetSnappingState()}_selectUpdateInput({point:e,scenePoint:t}){switch(this._currentSnappedType){case Ce.MAIN:return e;case Ce.SCENE:return t}}_resetSnappingState(){this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=Ce.MAIN}_removeVisualization(){this.removeHandles(Kt)}async _snapSinglePoint({point:e,context:t,signal:i}){const{view:s}=this,{elevationInfo:r}=t,a=Pt(e,s,r),o=await this._fetchCandidates(a,H.ALL,t,i);return this._createSnapResult(a,Ce.MAIN,o,s,e,t,i)}async _snapMultiPoint({point:e,scenePoint:t,context:i,signal:s}){const{view:r}=this,{coordinateHelper:a,elevationInfo:o,spatialReference:l}=i;await mo(t.spatialReference,l);const c=Zi(t,l),u=Pt(c,r,o),d=await this._fetchCandidates(u,H.FEATURE,i,s);if(d.length>0){const _=await this._fetchCandidates(u,H.SELF,i,s);return this._createSnapResult(u,Ce.SCENE,[...d,..._],r,c,i,s)}const h=Pt(e,r,o),g=await this._fetchCandidates(h,H.SELF,i,s);return this._createSnapResult(h,Ce.MAIN,g,r,{z:a.hasZ()&&e.hasZ?e.z??0:void 0,m:a.hasM()&&e.hasM?e.m??0:void 0},i,s)}async _fetchCandidates(e,t,i,s){return(await Promise.all(this._engines.map(r=>r.fetchCandidates(e,t,i,s)))).flat()}_createSnapResult(e,t,i,s,r,a,o){return{get valid(){return!_o(o)},apply:()=>{const{spatialReference:l}=a,{snappedPoint:c,hints:u}=this._processCandidates(e,t,i,a);return this._removeVisualization(),a.visualizer!=null&&this.addHandles(a.visualizer.draw(u,{spatialReference:l,elevationInfo:C,view:s,selfSnappingZ:a.selfSnappingZ}),Kt),cs(c,s,r,a)}}}_processCandidates(e,t,i,s){if(i.length<1)return this.doneSnapping(),{snappedPoint:e,hints:[]};this._currentSnappedType!==t&&this._resetSnappingState(),_i(e,i);const r=this._currentMainCandidate;if(r!=null){const a=this._findOldConstraintInNewCandidates(r,i);if(a>=0){if(!(i[a]instanceof Qt))return this._intersectWithOtherCandidates(a,i,e,t,s);if(this._arePointsWithinScreenThreshold(e,r.targetPoint,s))return this._updateSnappingCandidate(r,t,i,s)}}return this._intersectWithOtherCandidates(0,i,e,t,s)}_findOldConstraintInNewCandidates(e,t){return e instanceof Qt?this._findOldCandidateIndex(t,e.first)>=0&&this._findOldCandidateIndex(t,e.second)>=0?0:-1:this._findOldCandidateIndex(t,e)}_intersectWithOtherCandidates(e,t,i,s,r){const{coordinateHelper:a}=r,o=t[e],l=[];for(let c=0;c<t.length;++c){if(c===e)continue;const u=t[c],d=o.constraint.intersect(u.constraint);if(d)for(const h of d.closestPoints(o.targetPoint))l.push([new Qt(h,o,u,u.isDraped),this._squaredScreenDistance(i,h,a)])}return l.length>0&&(l.sort((c,u)=>c[1]-u[1]),l[0][1]<this._squaredPointProximityThreshold(r.pointer))?this._updateSnappingCandidate(l[0][0],s,t,r):this.options.constraintsActive&&(o instanceof ta||o instanceof ea||o instanceof Ai||o instanceof ia)?{snappedPoint:i,hints:[]}:this._updateSnappingCandidate(o,s,t,r)}_updateSnappingCandidate(e,t,i,s){this.doneSnapping(),this._currentMainCandidate=e,this._currentSnappedType=t;const r=this._currentMainCandidate.targetPoint,a=[];a.push(...e.hints);for(const o of i){if(e instanceof Qt){if(o.constraint.equals(e.first.constraint)||o.constraint.equals(e.second.constraint))continue}else if(o.constraint.equals(e.constraint))continue;const l=o.constraint.closestTo(r);this._squaredScreenDistance(l,r,s.coordinateHelper)<this._squaredSatisfiesConstraintThreshold&&(o.targetPoint=r,this._currentOtherActiveCandidates.push(o),a.push(...o.hints))}return{snappedPoint:r,hints:a}}_squaredPointProximityThreshold(e){return e==="touch"?this._squaredTouchProximityThreshold:this._squaredMouseProximityThreshold}_arePointsWithinScreenThreshold(e,t,i){return this._squaredScreenDistance(e,t,i.coordinateHelper)<this._squaredPointProximityThreshold(i.pointer)}_squaredScreenDistance(e,t,i){return st(this._toScreen(e,i),this._toScreen(t,i))}_toScreen(e,t){return F(e,t.spatialReference,C,this.view)}_findOldCandidateIndex(e,t){let i=-1;for(let s=0;s<e.length;++s)if(t.constraint.equals(e[s].constraint)){i=s;break}return i}get test(){return{visualizationsActive:this.hasHandles(Kt),engines:this._engines}}};var Ce;p([f({constructOnly:!0})],ae.prototype,"view",void 0),p([f()],ae.prototype,"options",void 0),p([f({readOnly:!0})],ae.prototype,"updating",null),p([f()],ae.prototype,"snappingEnginesFactory",void 0),p([f()],ae.prototype,"_engines",void 0),p([f()],ae.prototype,"_squaredMouseProximityThreshold",null),p([f()],ae.prototype,"_squaredTouchProximityThreshold",null),p([f()],ae.prototype,"_squaredSatisfiesConstraintThreshold",null),ae=p([I("esri.views.interactive.snapping.SnappingManager")],ae),function(n){n[n.MAIN=0]="MAIN",n[n.SCENE=1]="SCENE"}(Ce||(Ce={}));const Kt="visualization-handle";function _u(n){return n.scenePoint!=null}function yu({coordinateHelper:n,elevationInfo:e}){return n.hasZ()?C:e}const tn=new Map;function vu(n){if(!tn.has(n)){const i=Oc(n,{distance:10}),s=wu(n,i.options);tn.set(n,{referenceCount:0,snappingManager:s,remove:()=>{i.remove(),s.destroy()}})}const e=tn.get(n);e.referenceCount++;const t=si(()=>Su(n,e));return{snappingManager:e.snappingManager,...t}}function Su(n,e){e.referenceCount--,e.referenceCount>0||yo(()=>{e.referenceCount===0&&(e.remove(),tn.delete(n))})}function wu(n,e){return new ae({view:n,options:e,snappingEnginesFactory:(t,i)=>[new Oe({view:n,spatialReference:n.spatialReference,options:i})]})}class sa{constructor(e){this.vertexHandle=null,this.excludeFeature=null,this.visualizer=null,this.selfSnappingZ=null,this.editGeometryOperations=e.editGeometryOperations,this.elevationInfo=e.elevationInfo,this.pointer=e.pointer,this.vertexHandle=e.vertexHandle,this.excludeFeature=e.excludeFeature,this.feature=e.feature,this.visualizer=e.visualizer,this.selfSnappingZ=e.selfSnappingZ}get coordinateHelper(){return this.editGeometryOperations.data.coordinateHelper}get spatialReference(){return this.coordinateHelper.spatialReference}}function Pu({predicate:n=()=>!0,snappingManager:e,snappingContext:t,updatingHandles:i,useZ:s=!0}){const r=new ar;if(e==null)return{snappingStep:[bs,r],cancelSnapping:bs};let a,o=null,l=null,c=null;const u=()=>{o=Tt(o),e.doneSnapping(),l==null||l.frameTask.remove(),l=null,a=ri(a),c=null},d=$u(e,s,r);let h=null,g=null,_=null;return{snappingStep:[y=>{if(!n(y))return y;const{action:v}=y;if(v==="start"){const{info:S}=y,re=bu(e.view);if(l=xu(t,y,re),l.context.selfSnappingZ=null,!s&&S!=null){const z=Eu(t.coordinateHelper,S.handle.component);z!=null&&(l.context.selfSnappingZ={value:z,elevationInfo:t.elevationInfo??C})}}if(l!=null){const{context:S,originalScenePos:re,originalPos:z}=l,{mapEnd:ne,mapStart:B,scenePoints:vt}=y,Le=ra(z,Qn(ne,B)),Ze=Qn(B,z),oa={...y,action:"update"},la=l.context,Mn=Mu(re,vt),Li=e.update({point:Le,scenePoint:Mn,context:S});if(_=Li,aa(ne,Li,Ze,s),h=Le,g=Mn,v!=="end"){const{frameTask:ca}=l;o==null&&(o=new AbortController),c=ua=>{i.addPromise(Un(d({frameTask:ca,event:oa,context:la,point:Le,scenePoint:Mn,delta:Ze,getLastState:()=>({point:h,scenePoint:g,updatePoint:ua.forceUpdate?null:_})},o.signal)))},c({forceUpdate:!1}),a==null&&(a=w(()=>e.options.effectiveEnabled,()=>c==null?void 0:c({forceUpdate:!0})))}}return v==="end"&&u(),y},r],cancelSnapping:y=>(u(),y)}}function $u(n,e,t){return Bs(async({frameTask:i,point:s,scenePoint:r,context:a,event:o,delta:l,getLastState:c},u)=>{const d=await i.schedule(()=>n.snap({point:s,scenePoint:r,context:a,signal:u}),u);if(d.valid){let h=await i.schedule(()=>d.apply(),u);const g=c();g.point!=null&&s!==g.point&&(h=n.update({point:g.point,scenePoint:g.scenePoint,context:a})),g.updatePoint!=null&&nl(h,g.updatePoint)||(aa(o.mapEnd,h,l,e),t.execute(o))}})}function bu(n){return n.type==="3d"?n.resourceController.scheduler.registerTask(Zs.SNAPPING):Ws}function xu(n,e,t){return{context:new sa({editGeometryOperations:n.editGeometryOperations,elevationInfo:n.elevationInfo,pointer:n.pointer,vertexHandle:e.info!=null?e.info.handle:null,excludeFeature:n.excludeFeature,feature:n.feature,visualizer:n.visualizer}),originalPos:e.snapOrigin!=null?n.coordinateHelper.vectorToDehydratedPoint(e.snapOrigin):e.mapStart,originalScenePos:e.scenePoints!=null?e.scenePoints.sceneStart:null,frameTask:t}}function ra(n,[e,t,i]){const s=ct(n);return s.x+=e,s.y+=t,s.hasZ&&(s.z+=i),s}function Mu(n,e){return n==null||e==null?null:ra(n,Qn(e.sceneEnd,e.sceneStart))}function Qn(n,e){const t=n.hasZ&&e.hasZ?n.z-e.z:0;return[n.x-e.x,n.y-e.y,t]}function aa(n,e,[t,i,s],r){n.x=e.x+t,n.y=e.y+i,r&&n.hasZ&&e.hasZ&&(n.z=e.z+s)}function Eu(n,e){if(!n.hasZ())return null;const t=e.vertices;let i=null;for(const s of t){const r=n.getZ(s.pos);if(i!=null&&r!=null&&Math.abs(r-i)>1e-6)return null;i==null&&(i=r)}return i}function bs(n){return n}let Ke=class extends te{constructor(n){super(n),this.constrainResult=e=>e,this._snapPoints=null,this._frameTask=null,this._abortController=null,this._stagedPoint=null,this._snap=Bs(async(e,t,i,s)=>{const r=this._frameTask;if(r==null)return;const a=await r.schedule(()=>t.snap({...e,context:i,signal:s}),s);a.valid&&await r.schedule(()=>{this.stagedPoint=a.apply(),e!==this._snapPoints&&this._snapPoints!=null&&(this.stagedPoint=t.update({...this._snapPoints,context:i}))},s)})}get stagedPoint(){return this._stagedPoint}set stagedPoint(n){this._stagedPoint=this.constrainResult(n)}initialize(){var e,t;const n=this.view.type==="3d"?(t=(e=this.view)==null?void 0:e.resourceController)==null?void 0:t.scheduler:null;this._frameTask=n!=null?n.registerTask(Zs.SNAPPING):Ws}destroy(){this._abortController=Tt(this._abortController),this._frameTask=ri(this._frameTask)}update(n,e,t){this._snapPoints=n;const{point:i,scenePoint:s}=n,r=e.update({point:i,scenePoint:s,context:t});return this.stagedPoint=r,r}async snap(n,e,t){const{point:i,scenePoint:s}=n;return this.stagedPoint=e.update({point:i,scenePoint:s,context:t}),this._snapPoints=n,this._abortController==null&&(this._abortController=new AbortController),this._snap(n,e,t,this._abortController.signal)}async snapAgainNearPreviousMapPoint(n,e){this._snapPoints!=null&&await this.snap(this._snapPoints,n,e)}abort(){this._abortController=Tt(this._abortController),this._snapPoints=null}};p([f({constructOnly:!0})],Ke.prototype,"view",void 0),p([f()],Ke.prototype,"stagedPoint",null),p([f()],Ke.prototype,"constrainResult",void 0),p([f()],Ke.prototype,"_stagedPoint",void 0),Ke=p([I("esri.views.interactive.snapping.SnappingOperation")],Ke);let N=class extends te{constructor(n){super(n),this._stagedDimension=null,this._computationManipulators=new Map,this._computationHandles=new Ys,this._orientationManipulatorTexture=null,this._updatingHandles=new js,this._getSnappingContext=ac(i=>new sa({elevationInfo:{mode:"absolute-height",offset:0},pointer:i,editGeometryOperations:new Ko(new Jo("point",el(!0,!1,this.view.spatialReference))),visualizer:new Pc}));const{view:e}=n;this._snappingManagerResult=vu(e),this.addHandles(this._snappingManagerResult),this._unfocusedOffsetManipulatorMaterial=this._createOffsetManipulatorMaterial(),this._focusedOffsetManipulatorMaterial=this._createOffsetManipulatorMaterial(),this._thinOffsetManipulatorMaterial=this._createOffsetManipulatorMaterial(),this._thinOffsetManipulatorMaterial.setParameters({stipplePattern:rn(2)}),this._constraintSnappingIndicator=new Xe({view:e,attached:!0,width:1,renderOccluded:$.OccludeAndTransparent,stipplePattern:rn(5),isDecoration:!0});const t=J.toUnitRGBA(xl);this._stagedStartIndicator=new bc({view:e,attached:!1,elevationInfo:{mode:"absolute-height",offset:0},spatialReference:n.view.renderCoordsHelper.spatialReference,color:t,size:2*_r,outlineSize:0,renderOccluded:$.OccludeAndTransparent,isDecoration:!0})}initialize(){var i;const{view:n}=this;this._snappingOperation=new Ke({view:n});const e=!((i=n._stage)!=null&&i.renderView.renderingContext.driverTest.svgPremultipliesAlpha.result);this._orientationManipulatorMaterial=new lr({transparent:!0,writeDepth:!1,renderOccluded:$.Opaque,isDecoration:!0}),this.addHandles(w(()=>({accentColor:cn(n.effectiveTheme),contrastColor:bl(n.effectiveTheme)}),({accentColor:s,contrastColor:r})=>{const a=this._orientationManipulatorTexture,o=Wo(n.textures,{accentColor:s,contrastColor:r,preMultiplyAlpha:e});this._orientationManipulatorMaterial.setParameters({textureId:o.texture.id}),this._orientationManipulatorTexture=o,a==null||a.release();const l=J.toUnitRGBA(s);this._unfocusedOffsetManipulatorMaterial.setParameters({color:l}),this._focusedOffsetManipulatorMaterial.setParameters({color:l}),this._thinOffsetManipulatorMaterial.setParameters({color:l}),this._constraintSnappingIndicator.color=l},pt));const t=mn(()=>this.analysisViewData.computations,({computation:s})=>this._createManipulators(s));this.addHandles(ce(t)),this.addHandles([w(()=>({stagedPoint:this._snappingOperation.stagedPoint,stagedComputation:this._stagedComputation}),({stagedPoint:s,stagedComputation:r})=>{if(r==null||s==null)return;const a=ct(s,new Je);this._applyPointUpdate(r,{endPoint:a})},Ct),w(()=>({stagedDimension:this._stagedDimension,selectedComputation:this.analysisViewData.selectedComputation,firstGrabbedManipulator:this.firstGrabbedManipulator}),(s,r)=>{const{stagedDimension:a,selectedComputation:o,firstGrabbedManipulator:l}=s;if(a===(r==null?void 0:r.stagedDimension)&&l===(r==null?void 0:r.firstGrabbedManipulator)){for(const c of[o,r==null?void 0:r.selectedComputation])if(c!=null){const u=this._computationManipulators.get(c);u!=null&&this._updateManipulators(c,u,s)}}else for(const[c,u]of this._computationManipulators)this._updateManipulators(c,u,s)},G),w(()=>this.analysis.style.lineSize,s=>{this._updateManipulatorStyle(s)},pt),w(()=>this.view.state.camera,()=>{this._stagedComputation!=null&&this._updateStagedDimensionOffset(this._stagedComputation)}),w(()=>{const s=this._stagedComputation;if(!s)return null;const r=s.elevationAlignedStartPoint,a=m();return r!=null&&this.view.renderCoordsHelper.toRenderCoords(r,a)?a:null},s=>{s!=null?(this._stagedStartIndicator.vertices=[s],this._stagedStartIndicator.attached=!0):this._stagedStartIndicator.attached=!1})]),this.addHandles(this._constraintHandles),this.addHandles(this._snappingIndicatorHandles),vc(this,()=>{const s=this._activeComputation,r=this._stagedComputation;if(s==null||r!=null){const a=this.view.inputManager.latestPointerType??"mouse",o=this._getSnappingContext(a);this._updatingHandles.addPromise(Un(this._snappingOperation.snapAgainNearPreviousMapPoint(this._snappingManager,o)))}if(s!=null){const{start:a,end:o}=this._computationManipulators.get(s);if(a.grabbing||o.grabbing){const l=a.grabbing?"start":"end",c=this._computeConstraint(s);uc(s,l,{constraint:c,view:this.view})}}})}destroy(){var n;this._snappingOperation=ai(this._snappingOperation),this._computationHandles.destroy(),this._constraintSnappingIndicator.destroy(),this._stagedStartIndicator.destroy(),(n=this._orientationManipulatorTexture)==null||n.release()}get updating(){return this._updatingHandles.updating||this._snappingManager.updating}get firstGrabbedManipulator(){return this.parentTool.firstGrabbedManipulator}get hasGrabbedManipulators(){return this.parentTool.hasGrabbedManipulators}get snappingOptions(){return this._snappingManager.options}get _snappingManager(){return this._snappingManagerResult.snappingManager}get _activeComputation(){if(this._stagedComputation!=null)return this._stagedComputation;const{selectedComputation:n}=this.analysisViewData;return this.hasGrabbedManipulators&&n!=null?n:null}get _stagedComputation(){var t;const n=this._stagedDimension,e=(t=this.analysisViewData.computations.at(-1))==null?void 0:t.computation;return n==null||e==null||e.dimension!==n?null:e}get _constraintHandles(){return[oi(()=>this.analysisViewData.selectedComputation,n=>{n.previousConstraint=this._computeConstraint(n)},{...G,equals:Zn}),w(()=>{const n=this._activeComputation;if(n==null)return null;const{measureType:e,orientation:t}=n.dimension;return{measureType:e,orientation:t,computation:n}},(n,e)=>{if(n!=null&&e==null){const{measureType:t,orientation:i,computation:s}=n;switch(s.previousConstraint){case se.Horizontal:s.preConstraintProperties={measureType:E.Horizontal,orientation:0};break;case se.Vertical:s.preConstraintProperties={measureType:E.Vertical,orientation:0};break;case se.Direct:s.preConstraintProperties={measureType:E.Direct,orientation:i};break;default:s.preConstraintProperties={measureType:t,orientation:i}}}n==null&&e!=null&&(e.computation.preConstraintProperties=null)},Ct)]}get _snappingIndicatorHandles(){const n="snapping-indicator-event-handles";return[w(()=>({stagedComputation:this._stagedComputation,activeComputation:this._activeComputation}),({stagedComputation:e,activeComputation:t})=>{const i=this._constraintSnappingIndicator;if(this.removeHandles(n),t!=null)if(t===e)i.attached=!0;else{const{start:s,end:r}=this._computationManipulators.get(t),a=()=>{i.attached=s.grabbing||r.grabbing};a(),this.addHandles([s.events.on("grab-changed",a),r.events.on("grab-changed",a)],n)}else i.attached=!1}),w(()=>{const e=this._activeComputation;return e!=null?{geometry:e.geometry,constraint:e.previousConstraint}:{}},({geometry:e,constraint:t})=>{const i=this._constraintSnappingIndicator;e!=null&&t!=null&&t!==se.Direct?(i.visible=!0,i.setGeometryFromSegment(e.directSegment)):i.visible=!1})]}removeStaged(){return this._stagedDimension!=null&&(this.analysis.dimensions.remove(this._stagedDimension),this._stagedDimension=null,!0)}onDeactivate(){this.removeStaged(),this._resetSnappingState()}onClick(n){const{_stagedDimension:e}=this;if(e==null){const t=this._onUnstagedClick(n);return this.analysis.dimensions.add(t),null}return this._onStagedClick(n),e}onPointerMove({mapPoint:n,pointerType:e}){if(e==="touch")return;const t=this._getSnappingContext(e);this._updatingHandles.addPromise(Un(this._snappingOperation.snap({point:n},this._snappingManager,t)))}onManipulatorSelectionChanged(){this.analysisViewData.selectedComputation!=null&&(this._computationManipulators.get(this.analysisViewData.selectedComputation).offset.selected||(this.analysisViewData.selectedDimension=null))}_onUnstagedClick({mapPoint:n,pointerType:e}){let t=n;if(e==="mouse"){const s=this._getSnappingContext(e);t=this._snappingManager.update({point:n,context:s})}const i=new Do({startPoint:ct(t,new Je),endPoint:null,measureType:E.Horizontal});return this._stagedDimension=i,this._resetSnappingState(),i}_onStagedClick({mapPoint:n,pointerType:e}){const t=this._stagedComputation;if(t==null)return;let i=n;if(e==="mouse"){const r=this._getSnappingContext(e);i=this._snappingManager.update({point:n,context:r})}const s=ct(i,new Je);this._applyPointUpdate(t,{endPoint:s}),this._stagedDimension=null,this._resetSnappingState()}_resetSnappingState(){this._snappingManager.doneSnapping(),this._snappingOperation.abort(),this._snappingOperation.stagedPoint=null}_createManipulators(n){const e=this._setupPointManipulator(n,{isStart:!0}),t=this._setupPointManipulator(n,{isStart:!1}),i=this._setupOffsetManipulator(n),s=this._setupHeadingManipulator(n),r=this._setupRotationManipulator(n),a=this._setupMeasureTypeManipulator(n,E.Direct),o=this._setupMeasureTypeManipulator(n,E.Horizontal),l=this._setupMeasureTypeManipulator(n,E.Vertical),c=new kl({start:e,end:t,offset:i,heading:s,rotation:r,direct:a,horizontal:o,vertical:l});return this._setupComputationToManipulatorsSync(n,c),this._computationManipulators.set(n,c),this.manipulators.addMany(c.values()),{manipulators:c,remove:()=>{this._computationHandles.remove(n),this._computationManipulators.delete(n);for(const u of c.values())this.manipulators.remove(u)}}}_setupComputationToManipulatorsSync(n,e){this._computationHandles.add([w(()=>n.geometry,()=>this._updateManipulators(n,e),{...G,equals:Zn})],n)}_setupPointManipulator(n,e){const{view:t}=this,{dimension:i}=n,s=new Fl(t,{metadata:i}),r=jl(s,{isStart:e.isStart,createSnappingPipelineStep:a=>Pu({snappingContext:this._getSnappingContext(a),snappingManager:this._snappingManager,updatingHandles:this._updatingHandles}),dimension:i,onUpdate:a=>this._applyPointUpdate(n,a),view:t});return this._computationHandles.add(r,n),s}_setupOffsetManipulator(n){const{view:e}=this,t=Nl(e,{lineSizePt:this.analysis.style.lineSize,unfocusedMaterial:this._unfocusedOffsetManipulatorMaterial,focusedMaterial:this._focusedOffsetManipulatorMaterial,metadata:n.dimension}),i=ql(t,{computation:n,view:e});return this._computationHandles.add(i,n),t}_setupHeadingManipulator(n){const{view:e}=this,t=new es(e,{lineSizePt:this.analysis.style.lineSize,material:this._orientationManipulatorMaterial,metadata:n.dimension}),i=Ul(t,{computation:n,view:e});return this._computationHandles.add(i,n),t}_setupRotationManipulator(n){const{view:e}=this,t=new es(e,{lineSizePt:this.analysis.style.lineSize,material:this._orientationManipulatorMaterial,metadata:n.dimension}),i=Zl(t,{computation:n,view:e});return this._computationHandles.add(i,n),t}_setupMeasureTypeManipulator(n,e){const{view:t}=this,i=Gl(t,{lineSizePt:this.analysis.style.lineSize,unfocusedMaterial:this._unfocusedOffsetManipulatorMaterial,focusedMaterial:this._focusedOffsetManipulatorMaterial,thinOffsetManipulatorMaterial:this._thinOffsetManipulatorMaterial,metadata:n.dimension}),s=Yl(i,{computation:n,manipulatorMeasureType:e,view:t});return this._computationHandles.add(s,n),i}_updateManipulators(n,e,t={stagedDimension:this._stagedDimension,selectedComputation:this.analysisViewData.selectedComputation,firstGrabbedManipulator:this.firstGrabbedManipulator}){const{stagedDimension:i,selectedComputation:s,firstGrabbedManipulator:r}=t,{start:a,end:o,offset:l,heading:c,rotation:u}=e,d=s===n,h=Rt(n),{dimension:g}=n;for(const v of e.values()){const S=h&&i==null&&(r==null||v===r);v===l?(v.available=S,v.selected=d):v.available=S&&d}if(!h)return;this._computeConstraint(n)!=null?e.forEachMeasureTypeManipulator(v=>v.available=!1):e.manipulatorForMeasureType(g.measureType).available=!1;for(const v of[c,u])g.measureType===E.Direct&&g.offset!==0||(v.available=!1);hi(n)?u.available=!1:c.available=!1;const{geometry:_}=n;a.renderLocation=_.directSegment.startRenderSpace,o.renderLocation=_.directSegment.endRenderSpace;const{renderCoordsHelper:y}=this.view;Xl(l,_,y),c.available&&Ql(c,n,y),u.available&&Kl(u,n,y),e.forEachMeasureTypeManipulator((v,S)=>{v.available&&tc(v,n,S,y)})}_updateManipulatorStyle(n){const e=rc(n),t=mi(n),i={lineSizePt:n,material:this._orientationManipulatorMaterial};for(const{offset:s,heading:r,rotation:a}of this._computationManipulators.values())s.radius=t/2,r.update(i),a.update(i);this._unfocusedOffsetManipulatorMaterial.setParameters({width:e}),this._focusedOffsetManipulatorMaterial.setParameters({width:t})}_applyPointUpdate(n,e){const{view:t}=this,i=on(n);"startPoint"in e&&(i.elevationAlignedStartPoint=e.startPoint),"endPoint"in e&&(i.elevationAlignedEndPoint=e.endPoint);const s=ln(i,t.renderCoordsHelper);if(s==null)return;const r=this._computeConstraint({...i,geometry:s});Er(n,e,{...i,constraint:r,unconstrainedGeometry:s,view:t}),n===this._stagedComputation&&this._updateStagedDimensionOffset(n)}_updateStagedDimensionOffset(n){if(n.geometry==null)return;n.geometry.directSegment.eval(.5,xs);const e=this.view.state.camera.computeScreenPixelSizeAt(xs);n.dimension.offset=Vl*e}_computeConstraint(n){return cc(lc(n,this._snappingManager.options),this.view)}_createOffsetManipulatorMaterial(){return new ye({width:1,renderOccluded:$.OccludeAndTransparent,writeDepth:!1,hasPolygonOffset:!0,isDecoration:!0})}get testInfo(){const n=e=>{var t;return(t=this.analysisViewData.computations.find(({computation:i})=>i.dimension===e))==null?void 0:t.computation};return{disableManipulatorPartialOcclusion:()=>{this._stagedStartIndicator.renderOccluded=$.Occlude,this.manipulators.forEach(({manipulator:e})=>{for(const{geometry:t}of e.renderObjects)t.material.setParameters({renderOccluded:$.Occlude})})},getManipulatorsForDimension:e=>this._computationManipulators.get(n(e)),getComputationForDimension:e=>n(e),getConstraintForDimension:e=>{const t=n(e);return t!=null?this._computeConstraint(t):null},stagedDimension:this._stagedDimension,stagedStartIndicator:this._stagedStartIndicator,constraintSnappingIndicator:this._constraintSnappingIndicator,snappingManager:this._snappingManager}}};p([f({constructOnly:!0})],N.prototype,"analysis",void 0),p([f({constructOnly:!0})],N.prototype,"analysisViewData",void 0),p([f({constructOnly:!0})],N.prototype,"manipulators",void 0),p([f({constructOnly:!0})],N.prototype,"parentTool",void 0),p([f({constructOnly:!0,nonNullable:!0})],N.prototype,"view",void 0),p([f({readOnly:!0})],N.prototype,"updating",null),p([f()],N.prototype,"firstGrabbedManipulator",null),p([f()],N.prototype,"hasGrabbedManipulators",null),p([f()],N.prototype,"snappingOptions",null),p([f()],N.prototype,"_stagedDimension",void 0),p([f()],N.prototype,"_activeComputation",null),p([f()],N.prototype,"_stagedComputation",null),N=p([I("esri.views.3d.analysis.Dimension.LengthDimensionSubTool")],N);const xs=m();var lt;(function(n){n.Ready="ready",n.Creating="creating",n.Created="created"})(lt||(lt={}));let Y=class extends Go{constructor(n){super(n),this.automaticManipulatorSelection=!1,this.removeIncompleteOnCancel=!1,this._pointerMoveTimerMs=Hl,this._prevPointerMoveTimeout=null}initialize(){this._intersector=Bo(this.view.state.viewingMode),this._lengthDimensionSubTool=new N({analysis:this.analysis,analysisViewData:this.analysisViewData,manipulators:this.manipulators,parentTool:this,view:this.view}),this.addHandles([ce(this._lengthDimensionSubTool),si(()=>this._clearPointerMoveTimeout()),w(()=>this.state,n=>{n===lt.Created&&this.finishToolCreation()},G),oi(()=>this.firstGrabbedManipulator,n=>{this.selectedDimension=n.metadata},G),w(()=>this.selectedDimension,()=>this._resetPointerMoveTimeout(),G)])}get state(){return this.analysis.dimensions.some(n=>n.type==="length")?this._activeSubTool!=null?lt.Creating:lt.Created:lt.Ready}get updating(){return this._lengthDimensionSubTool.updating}get cursor(){return this.active?"crosshair":null}get selectedDimension(){return this.analysisViewData.selectedDimension}set selectedDimension(n){this.analysisViewData.selectedDimension=n}onInputEvent(n){switch(n.type){case"immediate-click":this._clickHandler(n);break;case"immediate-double-click":this._doubleClickHandler(n);break;case"pointer-move":this._pointerMoveHandler(n);break;case"key-down":if(us.cancel===n.key){if(this._activeSubTool!=null&&this._activeSubTool.removeStaged())return void n.stopPropagation();this.active||(this.selectedDimension=null)}else us.delete.includes(n.key)&&this._deleteKeyHandler()}}onActivate(){this._activeSubTool=this._lengthDimensionSubTool}onDeactivate(){this._activeSubTool!=null&&(this._activeSubTool.onDeactivate(),this._activeSubTool=null)}onShow(){this._resetPointerMoveTimeout()}onManipulatorSelectionChanged(){this._lengthDimensionSubTool.onManipulatorSelectionChanged()}onHide(){this.selectedDimension=null}_clickHandler(n){if(this.hasFocusedManipulators)return void n.stopPropagation();if(this._activeSubTool==null)return;const e=this._intersectScreen(n);e!=null&&(this.selectedDimension=this._activeSubTool.onClick({mapPoint:e,pointerType:n.pointerType}),n.stopPropagation())}_doubleClickHandler(n){this.active&&(this.view.activeTool=null,n.stopPropagation())}_pointerMoveHandler(n){if(this._resetPointerMoveTimeout(),this._activeSubTool==null||this.hasFocusedManipulators)return;const e=this._intersectScreen(n);e!=null&&this._activeSubTool.onPointerMove({mapPoint:e,pointerType:n.pointerType})}_deleteKeyHandler(){this._activeSubTool!=null&&this._activeSubTool.removeStaged(),this._removeSelected()}_intersectScreen(n){const e=vo(n);this.view.sceneIntersectionHelper.intersectToolIntersectorScreen(e,this._intersector);const t=this._intersector.results.min,i=b.get();return t.getIntersectionPoint(i)?this.view.renderCoordsHelper.fromRenderCoords(i,new Je({spatialReference:this.view.spatialReference})):null}_removeSelected(){this.selectedDimension!=null&&(this.analysis.dimensions.remove(this.selectedDimension),this.selectedDimension=null)}_clearPointerMoveTimeout(){this._prevPointerMoveTimeout=ri(this._prevPointerMoveTimeout)}_resetPointerMoveTimeout(){this._clearPointerMoveTimeout(),this.manipulators.forEach(n=>n.manipulator.state|=De),this._prevPointerMoveTimeout=So.setTimeout(()=>{this.manipulators.forEach(n=>n.manipulator.state&=~De)},this._pointerMoveTimerMs)}get testInfo(){return{...this._lengthDimensionSubTool.testInfo,setManipulatorAutoHideDelay:n=>{this._pointerMoveTimerMs=n,this._resetPointerMoveTimeout()}}}};p([f({constructOnly:!0})],Y.prototype,"view",void 0),p([f({constructOnly:!0})],Y.prototype,"analysis",void 0),p([f({readOnly:!0})],Y.prototype,"state",null),p([f({readOnly:!0})],Y.prototype,"updating",null),p([f({readOnly:!0})],Y.prototype,"cursor",null),p([f({constructOnly:!0})],Y.prototype,"analysisViewData",void 0),p([f()],Y.prototype,"selectedDimension",null),p([f()],Y.prototype,"automaticManipulatorSelection",void 0),p([f()],Y.prototype,"_activeSubTool",void 0),p([f()],Y.prototype,"_lengthDimensionSubTool",void 0),Y=p([I("esri.views.3d.analysis.Dimension.DimensionTool")],Y);class Ou extends Qs{constructor(e,t){super(e),this._hasExternalMaterial=!1,this._renderOccluded=$.OccludeAndTransparent,this._width=1,this._color=an(1,0,1,1),this._placement="end",this._markerPrimitive="arrow",this._material=t,this._hasExternalMaterial=t!=null,this.applyProperties(e)}setGeometryFromSegment(e,t){const i=e.endRenderSpace;this.transform=wo(Cu,i),this._normal=t;const{points:s}=e.createRenderGeometry(i,this.view.renderCoordsHelper);this.geometry=[s]}get renderOccluded(){return this._material!=null?this._material.parameters.renderOccluded:this._renderOccluded}set renderOccluded(e){this._renderOccluded=e,this._material!=null&&this._material.setParameters({renderOccluded:e})}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.recreateGeometry()}get normal(){return this._normal}set normal(e){this._normal=e,this.recreateGeometry()}get width(){return this._material!=null?this._material.parameters.width:this._width}set width(e){this._width=e,this._material!=null&&this._material.setParameters({width:e})}get color(){return this._material!=null?this._material.parameters.color:this._color}set color(e){this._color=cr(e),this._material!=null&&this._material.setParameters({color:this._color})}get placement(){return this._material!=null?this._material.parameters.placement:this._placement}set placement(e){this._placement=e,this._material!=null&&this._material.setParameters({placement:this._placement})}get markerPrimitive(){var e;return((e=this._material)==null?void 0:e.parameters.markerPrimitive)??this._markerPrimitive}set markerPrimitive(e){this._markerPrimitive=e,this._material!=null&&this._material.setParameters({markerPrimitive:e})}createExternalResources(){this._hasExternalMaterial||(this._material=new Xs({width:this._width,color:this._color,placement:this._placement,renderOccluded:this._renderOccluded,markerPrimitive:this._markerPrimitive,isDecoration:this.isDecoration}))}destroyExternalResources(){this._hasExternalMaterial||(this._material=null)}createGeometries(e){for(const t of Po(this.geometry,this.normal)){const i=$o(this._material,t);e.addGeometry(i)}}forEachExternalMaterial(e){this._hasExternalMaterial||e(this._material)}}const Cu=ei();class Tu{set visible(e){for(const t of this._visualElements.values())t.attached=e}constructor(e){this.destroyed=!1,this._handles=new Ys,this._messages=null,this._labelSegment=new it;const{analysis:t,computation:i,view:s,messages:r,isDecoration:a}=e;this.analysis=t,this.computation=i,this.view=s,this._messages=r;const o=e.visible,l={view:s,attached:o,isDecoration:a},{fontSize:c,textColor:u,textBackgroundColor:d}=t.style;this._visualElements=new Lu({marker:new Ou(l,e.markerMaterial),dimension:new Xe(l,e.dimensionLineMaterial),startOffset:new Xe(l,e.offsetLineMaterial),endOffset:new Xe(l,e.offsetLineMaterial),dimensionSmall:new Xe(l,e.smallDimensionLineMaterial),startOffsetSmall:new Xe(l,e.smallOffsetLineMaterial),endOffsetSmall:new Xe(l,e.smallOffsetLineMaterial),label:new zo({view:s,attached:o,distance:0,geometry:{type:"segment",sampleLocation:"center",segment:this._labelSegment,callout:!1},fontSize:_e(c),textColor:u.clone(),backgroundColor:d.clone(),isDecoration:a})}),this._handles.add([w(()=>i.geometry,h=>{this.updateCameraDependentElements(s.state.camera,h,t.style),i.geometry!=null&&this._updateLines(i.geometry)},{...pt,equals:Zn}),w(()=>i.length,h=>this._updateLabelContent(h),pt)])}destroy(){this.destroyed=!0,this._handles=ai(this._handles);for(const e of this._visualElements.values())e.destroy()}get testInfo(){return{dimensionVisualElement:this._visualElements.dimension,label:this._visualElements.label}}_updateLines(e){const t=Qi(Du,Dt.Start,e.directSegment,e.dimensionSegment),i=Qi(Ru,Dt.End,e.directSegment,e.dimensionSegment),s=this._visualElements;s.marker.setGeometryFromSegment(e.dimensionSegment,e.primaryOffsetAxis),s.dimension.setGeometryFromSegment(e.dimensionSegment),s.startOffset.setGeometryFromSegment(t),s.endOffset.setGeometryFromSegment(i),s.dimensionSmall.setGeometryFromSegment(e.dimensionSegment),s.startOffsetSmall.setGeometryFromSegment(t),s.endOffsetSmall.setGeometryFromSegment(i)}updateCameraDependentElements(e,t,i){const s=this._visualElements;if(t==null){for(const y of s.values())y.visible=!1;return}const r=e.computeScreenPixelSizeAt(t.dimensionSegment.eval(.5,Au)),a=Pl(t,r),o=a<(_e(i.lineSize)*Il)**2,l=!o;s.marker.visible=l,s.dimension.visible=l,s.startOffset.visible=l,s.endOffset.visible=l,s.dimensionSmall.visible=o,s.startOffsetSmall.visible=o,s.endOffsetSmall.visible=o;const c=_e(i.fontSize)*zl,{label:u}=s;if(u.visible=a>=c**2,!u.visible)return;const{dimensionSegment:d,primaryOffsetAxis:h}=t,{offset:g}=this.computation.dimension,_=(Math.sign(g)>=0?1:-1)*this._labelOffsetPx(i)*r;gl(this._labelSegment,d,h,_),u.updateLabelPosition()}updateLabelStyle(e){const{label:t}=this._visualElements;t.fontSize=_e(e.fontSize),t.textColor=e.textColor,t.backgroundColor=e.textBackgroundColor}updateUnitsMessages(e){this._messages=e;const{length:t}=this.computation;this._updateLabelContent(t)}_updateLabelContent(e){const{label:t}=this._visualElements;e!=null&&this._messages!=null?t.text=Ho(this._messages,e,e.unit):t.text=""}_labelOffsetPx(e){return 1.5*_e(e.fontSize)+Ll+_e(e.lineSize/2)}}const Du=new it,Ru=new it,Au=m();class Lu{constructor(e){this.marker=e.marker,this.dimension=e.dimension,this.startOffset=e.startOffset,this.endOffset=e.endOffset,this.dimensionSmall=e.dimensionSmall,this.startOffsetSmall=e.startOffsetSmall,this.endOffsetSmall=e.endOffsetSmall,this.label=e.label}values(){return[this.marker,this.dimension,this.startOffset,this.endOffset,this.dimensionSmall,this.startOffsetSmall,this.endOffsetSmall,this.label]}}let Ee=class extends te{get analysis(){return this.analysisViewData.analysis}get visible(){return this.analysisViewData.visible}constructor(n){super(n),this.loadingMessages=!1,this._messages=null}initialize(){const n=this.isDecoration;this._markerMaterial=new Xs({width:1,anchor:bo.Tip,color:St,placement:"begin-end",worldSpace:!0,hideOnShortSegments:!0,hasTip:!0,renderOccluded:$.OccludeAndTransparent,markerPrimitive:"triangle",isDecoration:n}),this._dimensionLineMaterial=new ye({width:1,color:St,renderOccluded:$.OccludeAndTransparent,markerParameters:this._markerMaterial.parameters,isDecoration:n}),this._offsetLineMaterial=new ye({width:1,color:St,renderOccluded:$.OccludeAndTransparent,stipplePattern:rn(5),isDecoration:n}),this._smallDimensionLineMaterial=new ye({width:1,color:St,renderOccluded:$.OccludeAndTransparent,isDecoration:n}),this._smallOffsetLineMaterial=new ye({width:1,color:St,renderOccluded:$.OccludeAndTransparent,stipplePattern:rn(5),isDecoration:n});for(const t of this._lineMaterials())this.view._stage.add(t),this.addHandles(si(()=>{var i;(i=this.view._stage)==null||i.remove(t)}));const e=mn(()=>this.analysisViewData.computations,({computation:t})=>this._createVisualization(t));this._dimensionVisualizations=e,this.addHandles([ce(e),w(()=>J.toUnitRGBA(this.analysis.style.color),t=>{for(const i of this._lineMaterials())i.setParameters({color:t})},G),w(()=>this.analysis.style.lineSize,t=>{const i=_e(t);this._markerMaterial.setParameters({width:i*yr}),this._dimensionLineMaterial.setParameters({width:i,markerParameters:this._markerMaterial.parameters});const s=Math.max(i*Al,1);this._offsetLineMaterial.setParameters({width:s})},G),w(()=>({camera:this.view.state.camera,style:zu(this.analysis)}),({camera:t,style:i})=>{for(const{visualization:s}of this._dimensionVisualizations)s.updateCameraDependentElements(t,s.computation.geometry,i),s.updateLabelStyle(i)}),w(()=>this.visible,t=>{for(const{visualization:i}of this._dimensionVisualizations)i.visible=t})]),this.addHandles([xo(()=>this._updateMessageBundle()),oi(()=>!this.loadingMessages,()=>{for(const{visualization:t}of this._dimensionVisualizations)t.updateUnitsMessages(this._messages)},Ct)]),this._updateMessageBundle()}get testInfo(){return{visualizations:this._dimensionVisualizations.items.map(({visualization:n})=>n),disablePartialOcclusion:()=>{for(const n of this._lineMaterials())n.setParameters({renderOccluded:$.Occlude})}}}_createVisualization(n){const e=new Tu({analysis:this.analysis,computation:n,view:this.view,visible:this.visible,markerMaterial:this._markerMaterial,dimensionLineMaterial:this._dimensionLineMaterial,offsetLineMaterial:this._offsetLineMaterial,smallDimensionLineMaterial:this._smallDimensionLineMaterial,smallOffsetLineMaterial:this._smallOffsetLineMaterial,messages:this._messages,isDecoration:this.isDecoration});return{visualization:e,remove:()=>e.destroy()}}_lineMaterials(){return[this._markerMaterial,this._dimensionLineMaterial,this._offsetLineMaterial,this._smallDimensionLineMaterial,this._smallOffsetLineMaterial]}async _updateMessageBundle(){this.loadingMessages=!0;try{this._messages=await Mo("esri/core/t9n/Units")}finally{this.loadingMessages=!1}}};function zu(n){const{fontSize:e,lineSize:t,textColor:i,textBackgroundColor:s}=n.style;return{fontSize:e,lineSize:t,textBackgroundColor:s.clone(),textColor:i.clone()}}p([f({constructOnly:!0})],Ee.prototype,"analysisViewData",void 0),p([f({constructOnly:!0,nonNullable:!0})],Ee.prototype,"view",void 0),p([f({constructOnly:!0})],Ee.prototype,"isDecoration",void 0),p([f()],Ee.prototype,"analysis",null),p([f()],Ee.prototype,"visible",null),p([f()],Ee.prototype,"loadingMessages",void 0),Ee=p([I("esri.views.3d.analysis.Dimension.DimensionVisualization")],Ee);let $t=class extends te{constructor(n){super(n),this.dimension=null,this.length=null}};p([f({constructOnly:!0,nonNullable:!0})],$t.prototype,"dimension",void 0),p([f()],$t.prototype,"length",void 0),$t=p([I("esri.views.3d.analysis.LengthDimensionResult")],$t);const Hu=$t;let X=class extends te{constructor(n){super(n),this.geometry=null,this.unconstrainedGeometry=null,this.elevationAlignedStartPoint=null,this.elevationAlignedEndPoint=null}normalizeCtorArgs(n){const{dimension:e,...t}=n;return{result:new Hu({dimension:e}),...t}}initialize(){this.addHandles([w(()=>this.dimension.startPoint,n=>this.elevationAlignedStartPoint=this.projectAndAlignPoint(n),G),w(()=>this.dimension.endPoint,n=>this.elevationAlignedEndPoint=this.projectAndAlignPoint(n),G)])}get dimension(){return this.result.dimension}get length(){return this.result.length}};p([f({constructOnly:!0,nonNullable:!0})],X.prototype,"result",void 0),p([f({constructOnly:!0,nonNullable:!0})],X.prototype,"projectAndAlignPoint",void 0),p([f()],X.prototype,"dimension",null),p([f()],X.prototype,"length",null),p([f()],X.prototype,"geometry",void 0),p([f()],X.prototype,"unconstrainedGeometry",void 0),p([f()],X.prototype,"elevationAlignedStartPoint",void 0),p([f()],X.prototype,"elevationAlignedEndPoint",void 0),p([f()],X.prototype,"preConstraintProperties",void 0),p([f()],X.prototype,"previousConstraint",void 0),X=p([I("esri.views.3d.analysis.LengthDimensionComputation")],X);const Vu=n=>{let e=class extends n{constructor(...t){super(...t),this.analysis=null,this.tool=null,this.selectedDimension=null,this.interactive=!1,this.visible=null}get results(){return new je}createLengthDimensions(t){throw new Error("Method not implemented.")}};return p([f({constructOnly:!0})],e.prototype,"view",void 0),p([f({constructOnly:!0,nonNullable:!0})],e.prototype,"analysis",void 0),p([f()],e.prototype,"tool",void 0),p([f({readOnly:!0})],e.prototype,"results",null),p([f()],e.prototype,"selectedDimension",void 0),p([f()],e.prototype,"interactive",void 0),p([f()],e.prototype,"visible",void 0),e=p([I("esri.views.analysis.DimensionAnalysisView")],e),e};let U=class extends Vu(Eo(te)){constructor(n){super(n),this.type="dimension-view-3d",this.tool=null,this.selectedDimension=null,this._dimensionsToComputations=new Map,this._placementTask=null,this._projectAndAlignPoint=null}initialize(){this._projectAndAlignPoint=e=>{if(e==null)return null;const{spatialReference:t,elevationProvider:i}=this.view,s=Oo(e,t,i);return s==null&&Co(this.analysis,e.spatialReference,yn.getLogger(this)),s};const n=mn(()=>this.analysis.dimensions,e=>this._createComputation(e));this.computations=n,this.addHandles([jo(this,Y),ce(n)]),this._analysisVisualization=new Ee({analysisViewData:this,view:this.view,isDecoration:!this.parent}),this._analysisController=new Qe({analysisViewData:this,view:this.view})}destroy(){this._placementTask=Tt(this._placementTask),this._analysisVisualization=ai(this._analysisVisualization),qo(this)}get updating(){var n;return((n=this._analysisVisualization)==null?void 0:n.loadingMessages)??!1}get results(){return this.analysis.dimensions.map(n=>this._dimensionsToComputations.get(n).result)}get selectedComputation(){const{selectedDimension:n}=this;return n==null?null:this._dimensionsToComputations.get(n)}get testInfo(){return{visualization:this._analysisVisualization,controller:this._analysisController}}async createLengthDimensions(n){return this.selectedDimension=null,this._placementTask=Tt(this._placementTask),this._placementTask=Uo(this,n),this._placementTask.promise}_createComputation(n){const{_dimensionsToComputations:e}=this,t=new X({dimension:n,projectAndAlignPoint:this._projectAndAlignPoint});return e.set(n,t),{computation:t,remove:()=>this._removeComputation(t)}}_removeComputation(n){const{dimension:e}=n;e===this.selectedDimension&&(this.selectedDimension=null),this._dimensionsToComputations.delete(e),n.destroy()}};p([f({readOnly:!0})],U.prototype,"type",void 0),p([f()],U.prototype,"tool",void 0),p([f()],U.prototype,"updating",null),p([f({readOnly:!0})],U.prototype,"results",null),p([f()],U.prototype,"computations",void 0),p([f()],U.prototype,"selectedDimension",void 0),p([f()],U.prototype,"selectedComputation",null),p([f()],U.prototype,"_analysisVisualization",void 0),p([f()],U.prototype,"_analysisController",void 0),p([f()],U.prototype,"_dimensionsToComputations",void 0),p([f()],U.prototype,"_placementTask",void 0),U=p([I("esri.views.3d.analysis.DimensionAnalysisView3D")],U);const Iu=U,Ad=Object.freeze(Object.defineProperty({__proto__:null,default:Iu},Symbol.toStringTag,{value:"Module"}));export{Ad as D,ea as a,Sc as b,_i as f,cd as j,rd as l,_t as m,Ri as n,iu as r,we as s,ac as t,hs as v,ld as y};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/FeatureServiceSnappingSource-CI_QLDU7.js","assets/index-Bv0Hohk0.js","assets/index-85K7yr-5.css","assets/queryEngineUtils-CQ4WW713.js","assets/VertexSnappingCandidate-21jrbxKo.js","assets/TileTreeDebugger-Csj5aKb9.js","assets/LineVisualElement-BA2FWRBH.js","assets/LengthDimension-3241MIUx.js","assets/Segment-CNSGf7Bh.js","assets/unitFormatUtils-CrXkRIq7.js","assets/geometryEngine-DM06toa8.js","assets/geometryEngineBase-DlPZ98f0.js","assets/hydrated-k8s1tmfD.js","assets/RightAngleQuadVisualElement-BIwVXGBk.js","assets/ShadedColorMaterial.glsl-Cak3Vz2U.js","assets/ToolIntersector-DHrjlBzv.js","assets/ImageMaterial.glsl-B_fxTFoc.js","assets/vec4f32-CjrfB-0a.js","assets/Laserlines.glsl-CW436qzp.js","assets/EditGeometryOperations-DfElYoDB.js","assets/FeatureFilter-x-ktONiu.js","assets/floorFilterUtils-DZ5C6FQv.js","assets/dehydratedFeatureComparison-BQojOjzo.js","assets/FeatureCollectionSnappingSource-DksMmbCh.js","assets/symbologySnappingCandidates-C4o1y5aC.js","assets/GraphicsSnappingSource-BAepIgqW.js","assets/normalizeUtilsSync-hw6TMy5M.js","assets/FeatureStore-DfMqUozf.js","assets/BoundsStore-sO8GTsfn.js","assets/PooledRBush-1Fb0hpVC.js","assets/quickselect-BfFUODyN.js","assets/QueryEngine-DfAP_JpM.js","assets/WhereClause-DN7niXzF.js","assets/TimeOnly-B0m-iz0l.js","assets/UnknownTimeZone-81r46adS.js","assets/json-Wa8cmqdu.js","assets/QueryEngineCapabilities-CTDe3LlQ.js","assets/utils-DpxLp-CG.js","assets/heatmapUtils-CpfvS1IE.js","assets/utils-DuuxkxDB.js","assets/utils-CNh-hAjn.js","assets/ClassBreaksDefinition-BI_2pPxM.js","assets/FieldsIndex-j25pkYvJ.js","assets/optimizedFeatureQueryEngineAdapter-DJZQbCrA.js","assets/SceneLayerSnappingSource-D1pKVu4l.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
