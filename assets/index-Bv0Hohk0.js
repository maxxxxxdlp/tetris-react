(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function r(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(n){if(n.ep)return;n.ep=!0;const s=r(n);fetch(n.href,s)}})();function mke(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var D_e={exports:{}},cz={},N_e={exports:{}},ci={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var pI=Symbol.for("react.element"),gke=Symbol.for("react.portal"),yke=Symbol.for("react.fragment"),_ke=Symbol.for("react.strict_mode"),vke=Symbol.for("react.profiler"),bke=Symbol.for("react.provider"),wke=Symbol.for("react.context"),xke=Symbol.for("react.forward_ref"),Tke=Symbol.for("react.suspense"),Ske=Symbol.for("react.memo"),Cke=Symbol.for("react.lazy"),bse=Symbol.iterator;function Eke(t){return t===null||typeof t!="object"?null:(t=bse&&t[bse]||t["@@iterator"],typeof t=="function"?t:null)}var F_e={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},k_e=Object.assign,z_e={};function S3(t,e,r){this.props=t,this.context=e,this.refs=z_e,this.updater=r||F_e}S3.prototype.isReactComponent={};S3.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};S3.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function U_e(){}U_e.prototype=S3.prototype;function xQ(t,e,r){this.props=t,this.context=e,this.refs=z_e,this.updater=r||F_e}var TQ=xQ.prototype=new U_e;TQ.constructor=xQ;k_e(TQ,S3.prototype);TQ.isPureReactComponent=!0;var wse=Array.isArray,B_e=Object.prototype.hasOwnProperty,SQ={current:null},V_e={key:!0,ref:!0,__self:!0,__source:!0};function G_e(t,e,r){var i,n={},s=null,o=null;if(e!=null)for(i in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)B_e.call(e,i)&&!V_e.hasOwnProperty(i)&&(n[i]=e[i]);var a=arguments.length-2;if(a===1)n.children=r;else if(1<a){for(var l=Array(a),c=0;c<a;c++)l[c]=arguments[c+2];n.children=l}if(t&&t.defaultProps)for(i in a=t.defaultProps,a)n[i]===void 0&&(n[i]=a[i]);return{$$typeof:pI,type:t,key:s,ref:o,props:n,_owner:SQ.current}}function Pke(t,e){return{$$typeof:pI,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function CQ(t){return typeof t=="object"&&t!==null&&t.$$typeof===pI}function Ake(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(r){return e[r]})}var xse=/\/+/g;function hB(t,e){return typeof t=="object"&&t!==null&&t.key!=null?Ake(""+t.key):e.toString(36)}function V4(t,e,r,i,n){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case pI:case gke:o=!0}}if(o)return o=t,n=n(o),t=i===""?"."+hB(o,0):i,wse(n)?(r="",t!=null&&(r=t.replace(xse,"$&/")+"/"),V4(n,e,r,"",function(c){return c})):n!=null&&(CQ(n)&&(n=Pke(n,r+(!n.key||o&&o.key===n.key?"":(""+n.key).replace(xse,"$&/")+"/")+t)),e.push(n)),1;if(o=0,i=i===""?".":i+":",wse(t))for(var a=0;a<t.length;a++){s=t[a];var l=i+hB(s,a);o+=V4(s,e,r,l,n)}else if(l=Eke(t),typeof l=="function")for(t=l.call(t),a=0;!(s=t.next()).done;)s=s.value,l=i+hB(s,a++),o+=V4(s,e,r,l,n);else if(s==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function TL(t,e,r){if(t==null)return t;var i=[],n=0;return V4(t,i,"","",function(s){return e.call(r,s,n++)}),i}function Mke(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(r){(t._status===0||t._status===-1)&&(t._status=1,t._result=r)},function(r){(t._status===0||t._status===-1)&&(t._status=2,t._result=r)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var sc={current:null},G4={transition:null},Oke={ReactCurrentDispatcher:sc,ReactCurrentBatchConfig:G4,ReactCurrentOwner:SQ};ci.Children={map:TL,forEach:function(t,e,r){TL(t,function(){e.apply(this,arguments)},r)},count:function(t){var e=0;return TL(t,function(){e++}),e},toArray:function(t){return TL(t,function(e){return e})||[]},only:function(t){if(!CQ(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};ci.Component=S3;ci.Fragment=yke;ci.Profiler=vke;ci.PureComponent=xQ;ci.StrictMode=_ke;ci.Suspense=Tke;ci.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Oke;ci.cloneElement=function(t,e,r){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var i=k_e({},t.props),n=t.key,s=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=SQ.current),e.key!==void 0&&(n=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(l in e)B_e.call(e,l)&&!V_e.hasOwnProperty(l)&&(i[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)i.children=r;else if(1<l){a=Array(l);for(var c=0;c<l;c++)a[c]=arguments[c+2];i.children=a}return{$$typeof:pI,type:t.type,key:n,ref:s,props:i,_owner:o}};ci.createContext=function(t){return t={$$typeof:wke,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:bke,_context:t},t.Consumer=t};ci.createElement=G_e;ci.createFactory=function(t){var e=G_e.bind(null,t);return e.type=t,e};ci.createRef=function(){return{current:null}};ci.forwardRef=function(t){return{$$typeof:xke,render:t}};ci.isValidElement=CQ;ci.lazy=function(t){return{$$typeof:Cke,_payload:{_status:-1,_result:t},_init:Mke}};ci.memo=function(t,e){return{$$typeof:Ske,type:t,compare:e===void 0?null:e}};ci.startTransition=function(t){var e=G4.transition;G4.transition={};try{t()}finally{G4.transition=e}};ci.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};ci.useCallback=function(t,e){return sc.current.useCallback(t,e)};ci.useContext=function(t){return sc.current.useContext(t)};ci.useDebugValue=function(){};ci.useDeferredValue=function(t){return sc.current.useDeferredValue(t)};ci.useEffect=function(t,e){return sc.current.useEffect(t,e)};ci.useId=function(){return sc.current.useId()};ci.useImperativeHandle=function(t,e,r){return sc.current.useImperativeHandle(t,e,r)};ci.useInsertionEffect=function(t,e){return sc.current.useInsertionEffect(t,e)};ci.useLayoutEffect=function(t,e){return sc.current.useLayoutEffect(t,e)};ci.useMemo=function(t,e){return sc.current.useMemo(t,e)};ci.useReducer=function(t,e,r){return sc.current.useReducer(t,e,r)};ci.useRef=function(t){return sc.current.useRef(t)};ci.useState=function(t){return sc.current.useState(t)};ci.useSyncExternalStore=function(t,e,r){return sc.current.useSyncExternalStore(t,e,r)};ci.useTransition=function(){return sc.current.useTransition()};ci.version="18.2.0";N_e.exports=ci;var EQ=N_e.exports;const Si=mke(EQ);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Rke=EQ,$ke=Symbol.for("react.element"),Ike=Symbol.for("react.fragment"),Lke=Object.prototype.hasOwnProperty,Dke=Rke.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Nke={key:!0,ref:!0,__self:!0,__source:!0};function j_e(t,e,r){var i,n={},s=null,o=null;r!==void 0&&(s=""+r),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(i in e)Lke.call(e,i)&&!Nke.hasOwnProperty(i)&&(n[i]=e[i]);if(t&&t.defaultProps)for(i in e=t.defaultProps,e)n[i]===void 0&&(n[i]=e[i]);return{$$typeof:$ke,type:t,key:s,ref:o,props:n,_owner:Dke.current}}cz.Fragment=Ike;cz.jsx=j_e;cz.jsxs=j_e;D_e.exports=cz;var yt=D_e.exports,Yj={},H_e={exports:{}},rh={},W_e={exports:{}},q_e={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(I,F){var G=I.length;I.push(F);e:for(;0<G;){var H=G-1>>>1,Z=I[H];if(0<n(Z,F))I[H]=F,I[G]=Z,G=H;else break e}}function r(I){return I.length===0?null:I[0]}function i(I){if(I.length===0)return null;var F=I[0],G=I.pop();if(G!==F){I[0]=G;e:for(var H=0,Z=I.length,te=Z>>>1;H<te;){var me=2*(H+1)-1,Me=I[me],it=me+1,Et=I[it];if(0>n(Me,G))it<Z&&0>n(Et,Me)?(I[H]=Et,I[it]=G,H=it):(I[H]=Me,I[me]=G,H=me);else if(it<Z&&0>n(Et,G))I[H]=Et,I[it]=G,H=it;else break e}}return F}function n(I,F){var G=I.sortIndex-F.sortIndex;return G!==0?G:I.id-F.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var l=[],c=[],u=1,h=null,p=3,f=!1,g=!1,_=!1,v=typeof setTimeout=="function"?setTimeout:null,b=typeof clearTimeout=="function"?clearTimeout:null,w=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function x(I){for(var F=r(c);F!==null;){if(F.callback===null)i(c);else if(F.startTime<=I)i(c),F.sortIndex=F.expirationTime,e(l,F);else break;F=r(c)}}function S(I){if(_=!1,x(I),!g)if(r(l)!==null)g=!0,le(E);else{var F=r(c);F!==null&&D(S,F.startTime-I)}}function E(I,F){g=!1,_&&(_=!1,b(L),L=-1),f=!0;var G=p;try{for(x(F),h=r(l);h!==null&&(!(h.expirationTime>F)||I&&!q());){var H=h.callback;if(typeof H=="function"){h.callback=null,p=h.priorityLevel;var Z=H(h.expirationTime<=F);F=t.unstable_now(),typeof Z=="function"?h.callback=Z:h===r(l)&&i(l),x(F)}else i(l);h=r(l)}if(h!==null)var te=!0;else{var me=r(c);me!==null&&D(S,me.startTime-F),te=!1}return te}finally{h=null,p=G,f=!1}}var A=!1,O=null,L=-1,z=5,k=-1;function q(){return!(t.unstable_now()-k<z)}function B(){if(O!==null){var I=t.unstable_now();k=I;var F=!0;try{F=O(!0,I)}finally{F?J():(A=!1,O=null)}}else A=!1}var J;if(typeof w=="function")J=function(){w(B)};else if(typeof MessageChannel<"u"){var W=new MessageChannel,Y=W.port2;W.port1.onmessage=B,J=function(){Y.postMessage(null)}}else J=function(){v(B,0)};function le(I){O=I,A||(A=!0,J())}function D(I,F){L=v(function(){I(t.unstable_now())},F)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(I){I.callback=null},t.unstable_continueExecution=function(){g||f||(g=!0,le(E))},t.unstable_forceFrameRate=function(I){0>I||125<I?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):z=0<I?Math.floor(1e3/I):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return r(l)},t.unstable_next=function(I){switch(p){case 1:case 2:case 3:var F=3;break;default:F=p}var G=p;p=F;try{return I()}finally{p=G}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(I,F){switch(I){case 1:case 2:case 3:case 4:case 5:break;default:I=3}var G=p;p=I;try{return F()}finally{p=G}},t.unstable_scheduleCallback=function(I,F,G){var H=t.unstable_now();switch(typeof G=="object"&&G!==null?(G=G.delay,G=typeof G=="number"&&0<G?H+G:H):G=H,I){case 1:var Z=-1;break;case 2:Z=250;break;case 5:Z=1073741823;break;case 4:Z=1e4;break;default:Z=5e3}return Z=G+Z,I={id:u++,callback:F,priorityLevel:I,startTime:G,expirationTime:Z,sortIndex:-1},G>H?(I.sortIndex=G,e(c,I),r(l)===null&&I===r(c)&&(_?(b(L),L=-1):_=!0,D(S,G-H))):(I.sortIndex=Z,e(l,I),g||f||(g=!0,le(E))),I},t.unstable_shouldYield=q,t.unstable_wrapCallback=function(I){var F=p;return function(){var G=p;p=F;try{return I.apply(this,arguments)}finally{p=G}}}})(q_e);W_e.exports=q_e;var Fke=W_e.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Y_e=EQ,Ju=Fke;function Ne(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,r=1;r<arguments.length;r++)e+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var X_e=new Set,kR={};function S2(t,e){gE(t,e),gE(t+"Capture",e)}function gE(t,e){for(kR[t]=e,t=0;t<e.length;t++)X_e.add(e[t])}var W0=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Xj=Object.prototype.hasOwnProperty,kke=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Tse={},Sse={};function zke(t){return Xj.call(Sse,t)?!0:Xj.call(Tse,t)?!1:kke.test(t)?Sse[t]=!0:(Tse[t]=!0,!1)}function Uke(t,e,r,i){if(r!==null&&r.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return i?!1:r!==null?!r.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function Bke(t,e,r,i){if(e===null||typeof e>"u"||Uke(t,e,r,i))return!0;if(i)return!1;if(r!==null)switch(r.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function oc(t,e,r,i,n,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=i,this.attributeNamespace=n,this.mustUseProperty=r,this.propertyName=t,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var Da={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Da[t]=new oc(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Da[e]=new oc(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Da[t]=new oc(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Da[t]=new oc(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Da[t]=new oc(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Da[t]=new oc(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Da[t]=new oc(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Da[t]=new oc(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Da[t]=new oc(t,5,!1,t.toLowerCase(),null,!1,!1)});var PQ=/[\-:]([a-z])/g;function AQ(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(PQ,AQ);Da[e]=new oc(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(PQ,AQ);Da[e]=new oc(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(PQ,AQ);Da[e]=new oc(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Da[t]=new oc(t,1,!1,t.toLowerCase(),null,!1,!1)});Da.xlinkHref=new oc("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Da[t]=new oc(t,1,!1,t.toLowerCase(),null,!0,!0)});function MQ(t,e,r,i){var n=Da.hasOwnProperty(e)?Da[e]:null;(n!==null?n.type!==0:i||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(Bke(e,r,n,i)&&(r=null),i||n===null?zke(e)&&(r===null?t.removeAttribute(e):t.setAttribute(e,""+r)):n.mustUseProperty?t[n.propertyName]=r===null?n.type===3?!1:"":r:(e=n.attributeName,i=n.attributeNamespace,r===null?t.removeAttribute(e):(n=n.type,r=n===3||n===4&&r===!0?"":""+r,i?t.setAttributeNS(i,e,r):t.setAttribute(e,r))))}var hy=Y_e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,SL=Symbol.for("react.element"),jS=Symbol.for("react.portal"),HS=Symbol.for("react.fragment"),OQ=Symbol.for("react.strict_mode"),Zj=Symbol.for("react.profiler"),Z_e=Symbol.for("react.provider"),J_e=Symbol.for("react.context"),RQ=Symbol.for("react.forward_ref"),Jj=Symbol.for("react.suspense"),Qj=Symbol.for("react.suspense_list"),$Q=Symbol.for("react.memo"),H_=Symbol.for("react.lazy"),Q_e=Symbol.for("react.offscreen"),Cse=Symbol.iterator;function lP(t){return t===null||typeof t!="object"?null:(t=Cse&&t[Cse]||t["@@iterator"],typeof t=="function"?t:null)}var ys=Object.assign,dB;function EA(t){if(dB===void 0)try{throw Error()}catch(r){var e=r.stack.trim().match(/\n( *(at )?)/);dB=e&&e[1]||""}return`
`+dB+t}var pB=!1;function fB(t,e){if(!t||pB)return"";pB=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var i=c}Reflect.construct(t,[],e)}else{try{e.call()}catch(c){i=c}t.call(e.prototype)}else{try{throw Error()}catch(c){i=c}t()}}catch(c){if(c&&i&&typeof c.stack=="string"){for(var n=c.stack.split(`
`),s=i.stack.split(`
`),o=n.length-1,a=s.length-1;1<=o&&0<=a&&n[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(n[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||n[o]!==s[a]){var l=`
`+n[o].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}while(1<=o&&0<=a);break}}}finally{pB=!1,Error.prepareStackTrace=r}return(t=t?t.displayName||t.name:"")?EA(t):""}function Vke(t){switch(t.tag){case 5:return EA(t.type);case 16:return EA("Lazy");case 13:return EA("Suspense");case 19:return EA("SuspenseList");case 0:case 2:case 15:return t=fB(t.type,!1),t;case 11:return t=fB(t.type.render,!1),t;case 1:return t=fB(t.type,!0),t;default:return""}}function Kj(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case HS:return"Fragment";case jS:return"Portal";case Zj:return"Profiler";case OQ:return"StrictMode";case Jj:return"Suspense";case Qj:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case J_e:return(t.displayName||"Context")+".Consumer";case Z_e:return(t._context.displayName||"Context")+".Provider";case RQ:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case $Q:return e=t.displayName||null,e!==null?e:Kj(t.type)||"Memo";case H_:e=t._payload,t=t._init;try{return Kj(t(e))}catch{}}return null}function Gke(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Kj(e);case 8:return e===OQ?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function J1(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function K_e(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function jke(t){var e=K_e(t)?"checked":"value",r=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),i=""+t[e];if(!t.hasOwnProperty(e)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var n=r.get,s=r.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return n.call(this)},set:function(o){i=""+o,s.call(this,o)}}),Object.defineProperty(t,e,{enumerable:r.enumerable}),{getValue:function(){return i},setValue:function(o){i=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function CL(t){t._valueTracker||(t._valueTracker=jke(t))}function e1e(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var r=e.getValue(),i="";return t&&(i=K_e(t)?t.checked?"true":"false":t.value),t=i,t!==r?(e.setValue(t),!0):!1}function ik(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function eH(t,e){var r=e.checked;return ys({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??t._wrapperState.initialChecked})}function Ese(t,e){var r=e.defaultValue==null?"":e.defaultValue,i=e.checked!=null?e.checked:e.defaultChecked;r=J1(e.value!=null?e.value:r),t._wrapperState={initialChecked:i,initialValue:r,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function t1e(t,e){e=e.checked,e!=null&&MQ(t,"checked",e,!1)}function tH(t,e){t1e(t,e);var r=J1(e.value),i=e.type;if(r!=null)i==="number"?(r===0&&t.value===""||t.value!=r)&&(t.value=""+r):t.value!==""+r&&(t.value=""+r);else if(i==="submit"||i==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?rH(t,e.type,r):e.hasOwnProperty("defaultValue")&&rH(t,e.type,J1(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function Pse(t,e,r){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!(i!=="submit"&&i!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,r||e===t.value||(t.value=e),t.defaultValue=e}r=t.name,r!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,r!==""&&(t.name=r)}function rH(t,e,r){(e!=="number"||ik(t.ownerDocument)!==t)&&(r==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+r&&(t.defaultValue=""+r))}var PA=Array.isArray;function OC(t,e,r,i){if(t=t.options,e){e={};for(var n=0;n<r.length;n++)e["$"+r[n]]=!0;for(r=0;r<t.length;r++)n=e.hasOwnProperty("$"+t[r].value),t[r].selected!==n&&(t[r].selected=n),n&&i&&(t[r].defaultSelected=!0)}else{for(r=""+J1(r),e=null,n=0;n<t.length;n++){if(t[n].value===r){t[n].selected=!0,i&&(t[n].defaultSelected=!0);return}e!==null||t[n].disabled||(e=t[n])}e!==null&&(e.selected=!0)}}function iH(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Ne(91));return ys({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Ase(t,e){var r=e.value;if(r==null){if(r=e.children,e=e.defaultValue,r!=null){if(e!=null)throw Error(Ne(92));if(PA(r)){if(1<r.length)throw Error(Ne(93));r=r[0]}e=r}e==null&&(e=""),r=e}t._wrapperState={initialValue:J1(r)}}function r1e(t,e){var r=J1(e.value),i=J1(e.defaultValue);r!=null&&(r=""+r,r!==t.value&&(t.value=r),e.defaultValue==null&&t.defaultValue!==r&&(t.defaultValue=r)),i!=null&&(t.defaultValue=""+i)}function Mse(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function i1e(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function nH(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?i1e(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var EL,n1e=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,r,i,n){MSApp.execUnsafeLocalFunction(function(){return t(e,r,i,n)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(EL=EL||document.createElement("div"),EL.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=EL.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function zR(t,e){if(e){var r=t.firstChild;if(r&&r===t.lastChild&&r.nodeType===3){r.nodeValue=e;return}}t.textContent=e}var RO={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Hke=["Webkit","ms","Moz","O"];Object.keys(RO).forEach(function(t){Hke.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),RO[e]=RO[t]})});function s1e(t,e,r){return e==null||typeof e=="boolean"||e===""?"":r||typeof e!="number"||e===0||RO.hasOwnProperty(t)&&RO[t]?(""+e).trim():e+"px"}function o1e(t,e){t=t.style;for(var r in e)if(e.hasOwnProperty(r)){var i=r.indexOf("--")===0,n=s1e(r,e[r],i);r==="float"&&(r="cssFloat"),i?t.setProperty(r,n):t[r]=n}}var Wke=ys({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function sH(t,e){if(e){if(Wke[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Ne(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Ne(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(Ne(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Ne(62))}}function oH(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var aH=null;function IQ(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var lH=null,RC=null,$C=null;function Ose(t){if(t=gI(t)){if(typeof lH!="function")throw Error(Ne(280));var e=t.stateNode;e&&(e=fz(e),lH(t.stateNode,t.type,e))}}function a1e(t){RC?$C?$C.push(t):$C=[t]:RC=t}function l1e(){if(RC){var t=RC,e=$C;if($C=RC=null,Ose(t),e)for(t=0;t<e.length;t++)Ose(e[t])}}function c1e(t,e){return t(e)}function u1e(){}var mB=!1;function h1e(t,e,r){if(mB)return t(e,r);mB=!0;try{return c1e(t,e,r)}finally{mB=!1,(RC!==null||$C!==null)&&(u1e(),l1e())}}function UR(t,e){var r=t.stateNode;if(r===null)return null;var i=fz(r);if(i===null)return null;r=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(t=t.type,i=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!i;break e;default:t=!1}if(t)return null;if(r&&typeof r!="function")throw Error(Ne(231,e,typeof r));return r}var cH=!1;if(W0)try{var cP={};Object.defineProperty(cP,"passive",{get:function(){cH=!0}}),window.addEventListener("test",cP,cP),window.removeEventListener("test",cP,cP)}catch{cH=!1}function qke(t,e,r,i,n,s,o,a,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(r,c)}catch(u){this.onError(u)}}var $O=!1,nk=null,sk=!1,uH=null,Yke={onError:function(t){$O=!0,nk=t}};function Xke(t,e,r,i,n,s,o,a,l){$O=!1,nk=null,qke.apply(Yke,arguments)}function Zke(t,e,r,i,n,s,o,a,l){if(Xke.apply(this,arguments),$O){if($O){var c=nk;$O=!1,nk=null}else throw Error(Ne(198));sk||(sk=!0,uH=c)}}function C2(t){var e=t,r=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(r=e.return),t=e.return;while(t)}return e.tag===3?r:null}function d1e(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function Rse(t){if(C2(t)!==t)throw Error(Ne(188))}function Jke(t){var e=t.alternate;if(!e){if(e=C2(t),e===null)throw Error(Ne(188));return e!==t?null:t}for(var r=t,i=e;;){var n=r.return;if(n===null)break;var s=n.alternate;if(s===null){if(i=n.return,i!==null){r=i;continue}break}if(n.child===s.child){for(s=n.child;s;){if(s===r)return Rse(n),t;if(s===i)return Rse(n),e;s=s.sibling}throw Error(Ne(188))}if(r.return!==i.return)r=n,i=s;else{for(var o=!1,a=n.child;a;){if(a===r){o=!0,r=n,i=s;break}if(a===i){o=!0,i=n,r=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===r){o=!0,r=s,i=n;break}if(a===i){o=!0,i=s,r=n;break}a=a.sibling}if(!o)throw Error(Ne(189))}}if(r.alternate!==i)throw Error(Ne(190))}if(r.tag!==3)throw Error(Ne(188));return r.stateNode.current===r?t:e}function p1e(t){return t=Jke(t),t!==null?f1e(t):null}function f1e(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=f1e(t);if(e!==null)return e;t=t.sibling}return null}var m1e=Ju.unstable_scheduleCallback,$se=Ju.unstable_cancelCallback,Qke=Ju.unstable_shouldYield,Kke=Ju.unstable_requestPaint,Ws=Ju.unstable_now,e6e=Ju.unstable_getCurrentPriorityLevel,LQ=Ju.unstable_ImmediatePriority,g1e=Ju.unstable_UserBlockingPriority,ok=Ju.unstable_NormalPriority,t6e=Ju.unstable_LowPriority,y1e=Ju.unstable_IdlePriority,uz=null,Bm=null;function r6e(t){if(Bm&&typeof Bm.onCommitFiberRoot=="function")try{Bm.onCommitFiberRoot(uz,t,void 0,(t.current.flags&128)===128)}catch{}}var Hp=Math.clz32?Math.clz32:s6e,i6e=Math.log,n6e=Math.LN2;function s6e(t){return t>>>=0,t===0?32:31-(i6e(t)/n6e|0)|0}var PL=64,AL=4194304;function AA(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function ak(t,e){var r=t.pendingLanes;if(r===0)return 0;var i=0,n=t.suspendedLanes,s=t.pingedLanes,o=r&268435455;if(o!==0){var a=o&~n;a!==0?i=AA(a):(s&=o,s!==0&&(i=AA(s)))}else o=r&~n,o!==0?i=AA(o):s!==0&&(i=AA(s));if(i===0)return 0;if(e!==0&&e!==i&&!(e&n)&&(n=i&-i,s=e&-e,n>=s||n===16&&(s&4194240)!==0))return e;if(i&4&&(i|=r&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=i;0<e;)r=31-Hp(e),n=1<<r,i|=t[r],e&=~n;return i}function o6e(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function a6e(t,e){for(var r=t.suspendedLanes,i=t.pingedLanes,n=t.expirationTimes,s=t.pendingLanes;0<s;){var o=31-Hp(s),a=1<<o,l=n[o];l===-1?(!(a&r)||a&i)&&(n[o]=o6e(a,e)):l<=e&&(t.expiredLanes|=a),s&=~a}}function hH(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function _1e(){var t=PL;return PL<<=1,!(PL&4194240)&&(PL=64),t}function gB(t){for(var e=[],r=0;31>r;r++)e.push(t);return e}function fI(t,e,r){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Hp(e),t[e]=r}function l6e(t,e){var r=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var i=t.eventTimes;for(t=t.expirationTimes;0<r;){var n=31-Hp(r),s=1<<n;e[n]=0,i[n]=-1,t[n]=-1,r&=~s}}function DQ(t,e){var r=t.entangledLanes|=e;for(t=t.entanglements;r;){var i=31-Hp(r),n=1<<i;n&e|t[i]&e&&(t[i]|=e),r&=~n}}var an=0;function v1e(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var b1e,NQ,w1e,x1e,T1e,dH=!1,ML=[],R1=null,$1=null,I1=null,BR=new Map,VR=new Map,s1=[],c6e="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Ise(t,e){switch(t){case"focusin":case"focusout":R1=null;break;case"dragenter":case"dragleave":$1=null;break;case"mouseover":case"mouseout":I1=null;break;case"pointerover":case"pointerout":BR.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":VR.delete(e.pointerId)}}function uP(t,e,r,i,n,s){return t===null||t.nativeEvent!==s?(t={blockedOn:e,domEventName:r,eventSystemFlags:i,nativeEvent:s,targetContainers:[n]},e!==null&&(e=gI(e),e!==null&&NQ(e)),t):(t.eventSystemFlags|=i,e=t.targetContainers,n!==null&&e.indexOf(n)===-1&&e.push(n),t)}function u6e(t,e,r,i,n){switch(e){case"focusin":return R1=uP(R1,t,e,r,i,n),!0;case"dragenter":return $1=uP($1,t,e,r,i,n),!0;case"mouseover":return I1=uP(I1,t,e,r,i,n),!0;case"pointerover":var s=n.pointerId;return BR.set(s,uP(BR.get(s)||null,t,e,r,i,n)),!0;case"gotpointercapture":return s=n.pointerId,VR.set(s,uP(VR.get(s)||null,t,e,r,i,n)),!0}return!1}function S1e(t){var e=ix(t.target);if(e!==null){var r=C2(e);if(r!==null){if(e=r.tag,e===13){if(e=d1e(r),e!==null){t.blockedOn=e,T1e(t.priority,function(){w1e(r)});return}}else if(e===3&&r.stateNode.current.memoizedState.isDehydrated){t.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}t.blockedOn=null}function j4(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var r=pH(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(r===null){r=t.nativeEvent;var i=new r.constructor(r.type,r);aH=i,r.target.dispatchEvent(i),aH=null}else return e=gI(r),e!==null&&NQ(e),t.blockedOn=r,!1;e.shift()}return!0}function Lse(t,e,r){j4(t)&&r.delete(e)}function h6e(){dH=!1,R1!==null&&j4(R1)&&(R1=null),$1!==null&&j4($1)&&($1=null),I1!==null&&j4(I1)&&(I1=null),BR.forEach(Lse),VR.forEach(Lse)}function hP(t,e){t.blockedOn===e&&(t.blockedOn=null,dH||(dH=!0,Ju.unstable_scheduleCallback(Ju.unstable_NormalPriority,h6e)))}function GR(t){function e(n){return hP(n,t)}if(0<ML.length){hP(ML[0],t);for(var r=1;r<ML.length;r++){var i=ML[r];i.blockedOn===t&&(i.blockedOn=null)}}for(R1!==null&&hP(R1,t),$1!==null&&hP($1,t),I1!==null&&hP(I1,t),BR.forEach(e),VR.forEach(e),r=0;r<s1.length;r++)i=s1[r],i.blockedOn===t&&(i.blockedOn=null);for(;0<s1.length&&(r=s1[0],r.blockedOn===null);)S1e(r),r.blockedOn===null&&s1.shift()}var IC=hy.ReactCurrentBatchConfig,lk=!0;function d6e(t,e,r,i){var n=an,s=IC.transition;IC.transition=null;try{an=1,FQ(t,e,r,i)}finally{an=n,IC.transition=s}}function p6e(t,e,r,i){var n=an,s=IC.transition;IC.transition=null;try{an=4,FQ(t,e,r,i)}finally{an=n,IC.transition=s}}function FQ(t,e,r,i){if(lk){var n=pH(t,e,r,i);if(n===null)EB(t,e,i,ck,r),Ise(t,i);else if(u6e(n,t,e,r,i))i.stopPropagation();else if(Ise(t,i),e&4&&-1<c6e.indexOf(t)){for(;n!==null;){var s=gI(n);if(s!==null&&b1e(s),s=pH(t,e,r,i),s===null&&EB(t,e,i,ck,r),s===n)break;n=s}n!==null&&i.stopPropagation()}else EB(t,e,i,null,r)}}var ck=null;function pH(t,e,r,i){if(ck=null,t=IQ(i),t=ix(t),t!==null)if(e=C2(t),e===null)t=null;else if(r=e.tag,r===13){if(t=d1e(e),t!==null)return t;t=null}else if(r===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return ck=t,null}function C1e(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(e6e()){case LQ:return 1;case g1e:return 4;case ok:case t6e:return 16;case y1e:return 536870912;default:return 16}default:return 16}}var p1=null,kQ=null,H4=null;function E1e(){if(H4)return H4;var t,e=kQ,r=e.length,i,n="value"in p1?p1.value:p1.textContent,s=n.length;for(t=0;t<r&&e[t]===n[t];t++);var o=r-t;for(i=1;i<=o&&e[r-i]===n[s-i];i++);return H4=n.slice(t,1<i?1-i:void 0)}function W4(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function OL(){return!0}function Dse(){return!1}function ih(t){function e(r,i,n,s,o){this._reactName=r,this._targetInst=n,this.type=i,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(r=t[a],this[a]=r?r(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?OL:Dse,this.isPropagationStopped=Dse,this}return ys(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=OL)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=OL)},persist:function(){},isPersistent:OL}),e}var C3={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},zQ=ih(C3),mI=ys({},C3,{view:0,detail:0}),f6e=ih(mI),yB,_B,dP,hz=ys({},mI,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:UQ,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==dP&&(dP&&t.type==="mousemove"?(yB=t.screenX-dP.screenX,_B=t.screenY-dP.screenY):_B=yB=0,dP=t),yB)},movementY:function(t){return"movementY"in t?t.movementY:_B}}),Nse=ih(hz),m6e=ys({},hz,{dataTransfer:0}),g6e=ih(m6e),y6e=ys({},mI,{relatedTarget:0}),vB=ih(y6e),_6e=ys({},C3,{animationName:0,elapsedTime:0,pseudoElement:0}),v6e=ih(_6e),b6e=ys({},C3,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),w6e=ih(b6e),x6e=ys({},C3,{data:0}),Fse=ih(x6e),T6e={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},S6e={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},C6e={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function E6e(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=C6e[t])?!!e[t]:!1}function UQ(){return E6e}var P6e=ys({},mI,{key:function(t){if(t.key){var e=T6e[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=W4(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?S6e[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:UQ,charCode:function(t){return t.type==="keypress"?W4(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?W4(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),A6e=ih(P6e),M6e=ys({},hz,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),kse=ih(M6e),O6e=ys({},mI,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:UQ}),R6e=ih(O6e),$6e=ys({},C3,{propertyName:0,elapsedTime:0,pseudoElement:0}),I6e=ih($6e),L6e=ys({},hz,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),D6e=ih(L6e),N6e=[9,13,27,32],BQ=W0&&"CompositionEvent"in window,IO=null;W0&&"documentMode"in document&&(IO=document.documentMode);var F6e=W0&&"TextEvent"in window&&!IO,P1e=W0&&(!BQ||IO&&8<IO&&11>=IO),zse=" ",Use=!1;function A1e(t,e){switch(t){case"keyup":return N6e.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function M1e(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var WS=!1;function k6e(t,e){switch(t){case"compositionend":return M1e(e);case"keypress":return e.which!==32?null:(Use=!0,zse);case"textInput":return t=e.data,t===zse&&Use?null:t;default:return null}}function z6e(t,e){if(WS)return t==="compositionend"||!BQ&&A1e(t,e)?(t=E1e(),H4=kQ=p1=null,WS=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return P1e&&e.locale!=="ko"?null:e.data;default:return null}}var U6e={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Bse(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!U6e[t.type]:e==="textarea"}function O1e(t,e,r,i){a1e(i),e=uk(e,"onChange"),0<e.length&&(r=new zQ("onChange","change",null,r,i),t.push({event:r,listeners:e}))}var LO=null,jR=null;function B6e(t){B1e(t,0)}function dz(t){var e=XS(t);if(e1e(e))return t}function V6e(t,e){if(t==="change")return e}var R1e=!1;if(W0){var bB;if(W0){var wB="oninput"in document;if(!wB){var Vse=document.createElement("div");Vse.setAttribute("oninput","return;"),wB=typeof Vse.oninput=="function"}bB=wB}else bB=!1;R1e=bB&&(!document.documentMode||9<document.documentMode)}function Gse(){LO&&(LO.detachEvent("onpropertychange",$1e),jR=LO=null)}function $1e(t){if(t.propertyName==="value"&&dz(jR)){var e=[];O1e(e,jR,t,IQ(t)),h1e(B6e,e)}}function G6e(t,e,r){t==="focusin"?(Gse(),LO=e,jR=r,LO.attachEvent("onpropertychange",$1e)):t==="focusout"&&Gse()}function j6e(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return dz(jR)}function H6e(t,e){if(t==="click")return dz(e)}function W6e(t,e){if(t==="input"||t==="change")return dz(e)}function q6e(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var rf=typeof Object.is=="function"?Object.is:q6e;function HR(t,e){if(rf(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var r=Object.keys(t),i=Object.keys(e);if(r.length!==i.length)return!1;for(i=0;i<r.length;i++){var n=r[i];if(!Xj.call(e,n)||!rf(t[n],e[n]))return!1}return!0}function jse(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Hse(t,e){var r=jse(t);t=0;for(var i;r;){if(r.nodeType===3){if(i=t+r.textContent.length,t<=e&&i>=e)return{node:r,offset:e-t};t=i}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=jse(r)}}function I1e(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?I1e(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function L1e(){for(var t=window,e=ik();e instanceof t.HTMLIFrameElement;){try{var r=typeof e.contentWindow.location.href=="string"}catch{r=!1}if(r)t=e.contentWindow;else break;e=ik(t.document)}return e}function VQ(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function Y6e(t){var e=L1e(),r=t.focusedElem,i=t.selectionRange;if(e!==r&&r&&r.ownerDocument&&I1e(r.ownerDocument.documentElement,r)){if(i!==null&&VQ(r)){if(e=i.start,t=i.end,t===void 0&&(t=e),"selectionStart"in r)r.selectionStart=e,r.selectionEnd=Math.min(t,r.value.length);else if(t=(e=r.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var n=r.textContent.length,s=Math.min(i.start,n);i=i.end===void 0?s:Math.min(i.end,n),!t.extend&&s>i&&(n=i,i=s,s=n),n=Hse(r,s);var o=Hse(r,i);n&&o&&(t.rangeCount!==1||t.anchorNode!==n.node||t.anchorOffset!==n.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(n.node,n.offset),t.removeAllRanges(),s>i?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=r;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<e.length;r++)t=e[r],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var X6e=W0&&"documentMode"in document&&11>=document.documentMode,qS=null,fH=null,DO=null,mH=!1;function Wse(t,e,r){var i=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;mH||qS==null||qS!==ik(i)||(i=qS,"selectionStart"in i&&VQ(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),DO&&HR(DO,i)||(DO=i,i=uk(fH,"onSelect"),0<i.length&&(e=new zQ("onSelect","select",null,e,r),t.push({event:e,listeners:i}),e.target=qS)))}function RL(t,e){var r={};return r[t.toLowerCase()]=e.toLowerCase(),r["Webkit"+t]="webkit"+e,r["Moz"+t]="moz"+e,r}var YS={animationend:RL("Animation","AnimationEnd"),animationiteration:RL("Animation","AnimationIteration"),animationstart:RL("Animation","AnimationStart"),transitionend:RL("Transition","TransitionEnd")},xB={},D1e={};W0&&(D1e=document.createElement("div").style,"AnimationEvent"in window||(delete YS.animationend.animation,delete YS.animationiteration.animation,delete YS.animationstart.animation),"TransitionEvent"in window||delete YS.transitionend.transition);function pz(t){if(xB[t])return xB[t];if(!YS[t])return t;var e=YS[t],r;for(r in e)if(e.hasOwnProperty(r)&&r in D1e)return xB[t]=e[r];return t}var N1e=pz("animationend"),F1e=pz("animationiteration"),k1e=pz("animationstart"),z1e=pz("transitionend"),U1e=new Map,qse="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Mv(t,e){U1e.set(t,e),S2(e,[t])}for(var TB=0;TB<qse.length;TB++){var SB=qse[TB],Z6e=SB.toLowerCase(),J6e=SB[0].toUpperCase()+SB.slice(1);Mv(Z6e,"on"+J6e)}Mv(N1e,"onAnimationEnd");Mv(F1e,"onAnimationIteration");Mv(k1e,"onAnimationStart");Mv("dblclick","onDoubleClick");Mv("focusin","onFocus");Mv("focusout","onBlur");Mv(z1e,"onTransitionEnd");gE("onMouseEnter",["mouseout","mouseover"]);gE("onMouseLeave",["mouseout","mouseover"]);gE("onPointerEnter",["pointerout","pointerover"]);gE("onPointerLeave",["pointerout","pointerover"]);S2("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));S2("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));S2("onBeforeInput",["compositionend","keypress","textInput","paste"]);S2("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));S2("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));S2("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var MA="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Q6e=new Set("cancel close invalid load scroll toggle".split(" ").concat(MA));function Yse(t,e,r){var i=t.type||"unknown-event";t.currentTarget=r,Zke(i,e,void 0,t),t.currentTarget=null}function B1e(t,e){e=(e&4)!==0;for(var r=0;r<t.length;r++){var i=t[r],n=i.event;i=i.listeners;e:{var s=void 0;if(e)for(var o=i.length-1;0<=o;o--){var a=i[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==s&&n.isPropagationStopped())break e;Yse(n,a,c),s=l}else for(o=0;o<i.length;o++){if(a=i[o],l=a.instance,c=a.currentTarget,a=a.listener,l!==s&&n.isPropagationStopped())break e;Yse(n,a,c),s=l}}}if(sk)throw t=uH,sk=!1,uH=null,t}function Bn(t,e){var r=e[bH];r===void 0&&(r=e[bH]=new Set);var i=t+"__bubble";r.has(i)||(V1e(e,t,2,!1),r.add(i))}function CB(t,e,r){var i=0;e&&(i|=4),V1e(r,t,i,e)}var $L="_reactListening"+Math.random().toString(36).slice(2);function WR(t){if(!t[$L]){t[$L]=!0,X_e.forEach(function(r){r!=="selectionchange"&&(Q6e.has(r)||CB(r,!1,t),CB(r,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[$L]||(e[$L]=!0,CB("selectionchange",!1,e))}}function V1e(t,e,r,i){switch(C1e(e)){case 1:var n=d6e;break;case 4:n=p6e;break;default:n=FQ}r=n.bind(null,e,r,t),n=void 0,!cH||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(n=!0),i?n!==void 0?t.addEventListener(e,r,{capture:!0,passive:n}):t.addEventListener(e,r,!0):n!==void 0?t.addEventListener(e,r,{passive:n}):t.addEventListener(e,r,!1)}function EB(t,e,r,i,n){var s=i;if(!(e&1)&&!(e&2)&&i!==null)e:for(;;){if(i===null)return;var o=i.tag;if(o===3||o===4){var a=i.stateNode.containerInfo;if(a===n||a.nodeType===8&&a.parentNode===n)break;if(o===4)for(o=i.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===n||l.nodeType===8&&l.parentNode===n))return;o=o.return}for(;a!==null;){if(o=ix(a),o===null)return;if(l=o.tag,l===5||l===6){i=s=o;continue e}a=a.parentNode}}i=i.return}h1e(function(){var c=s,u=IQ(r),h=[];e:{var p=U1e.get(t);if(p!==void 0){var f=zQ,g=t;switch(t){case"keypress":if(W4(r)===0)break e;case"keydown":case"keyup":f=A6e;break;case"focusin":g="focus",f=vB;break;case"focusout":g="blur",f=vB;break;case"beforeblur":case"afterblur":f=vB;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":f=Nse;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":f=g6e;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":f=R6e;break;case N1e:case F1e:case k1e:f=v6e;break;case z1e:f=I6e;break;case"scroll":f=f6e;break;case"wheel":f=D6e;break;case"copy":case"cut":case"paste":f=w6e;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":f=kse}var _=(e&4)!==0,v=!_&&t==="scroll",b=_?p!==null?p+"Capture":null:p;_=[];for(var w=c,x;w!==null;){x=w;var S=x.stateNode;if(x.tag===5&&S!==null&&(x=S,b!==null&&(S=UR(w,b),S!=null&&_.push(qR(w,S,x)))),v)break;w=w.return}0<_.length&&(p=new f(p,g,null,r,u),h.push({event:p,listeners:_}))}}if(!(e&7)){e:{if(p=t==="mouseover"||t==="pointerover",f=t==="mouseout"||t==="pointerout",p&&r!==aH&&(g=r.relatedTarget||r.fromElement)&&(ix(g)||g[q0]))break e;if((f||p)&&(p=u.window===u?u:(p=u.ownerDocument)?p.defaultView||p.parentWindow:window,f?(g=r.relatedTarget||r.toElement,f=c,g=g?ix(g):null,g!==null&&(v=C2(g),g!==v||g.tag!==5&&g.tag!==6)&&(g=null)):(f=null,g=c),f!==g)){if(_=Nse,S="onMouseLeave",b="onMouseEnter",w="mouse",(t==="pointerout"||t==="pointerover")&&(_=kse,S="onPointerLeave",b="onPointerEnter",w="pointer"),v=f==null?p:XS(f),x=g==null?p:XS(g),p=new _(S,w+"leave",f,r,u),p.target=v,p.relatedTarget=x,S=null,ix(u)===c&&(_=new _(b,w+"enter",g,r,u),_.target=x,_.relatedTarget=v,S=_),v=S,f&&g)t:{for(_=f,b=g,w=0,x=_;x;x=q2(x))w++;for(x=0,S=b;S;S=q2(S))x++;for(;0<w-x;)_=q2(_),w--;for(;0<x-w;)b=q2(b),x--;for(;w--;){if(_===b||b!==null&&_===b.alternate)break t;_=q2(_),b=q2(b)}_=null}else _=null;f!==null&&Xse(h,p,f,_,!1),g!==null&&v!==null&&Xse(h,v,g,_,!0)}}e:{if(p=c?XS(c):window,f=p.nodeName&&p.nodeName.toLowerCase(),f==="select"||f==="input"&&p.type==="file")var E=V6e;else if(Bse(p))if(R1e)E=W6e;else{E=j6e;var A=G6e}else(f=p.nodeName)&&f.toLowerCase()==="input"&&(p.type==="checkbox"||p.type==="radio")&&(E=H6e);if(E&&(E=E(t,c))){O1e(h,E,r,u);break e}A&&A(t,p,c),t==="focusout"&&(A=p._wrapperState)&&A.controlled&&p.type==="number"&&rH(p,"number",p.value)}switch(A=c?XS(c):window,t){case"focusin":(Bse(A)||A.contentEditable==="true")&&(qS=A,fH=c,DO=null);break;case"focusout":DO=fH=qS=null;break;case"mousedown":mH=!0;break;case"contextmenu":case"mouseup":case"dragend":mH=!1,Wse(h,r,u);break;case"selectionchange":if(X6e)break;case"keydown":case"keyup":Wse(h,r,u)}var O;if(BQ)e:{switch(t){case"compositionstart":var L="onCompositionStart";break e;case"compositionend":L="onCompositionEnd";break e;case"compositionupdate":L="onCompositionUpdate";break e}L=void 0}else WS?A1e(t,r)&&(L="onCompositionEnd"):t==="keydown"&&r.keyCode===229&&(L="onCompositionStart");L&&(P1e&&r.locale!=="ko"&&(WS||L!=="onCompositionStart"?L==="onCompositionEnd"&&WS&&(O=E1e()):(p1=u,kQ="value"in p1?p1.value:p1.textContent,WS=!0)),A=uk(c,L),0<A.length&&(L=new Fse(L,t,null,r,u),h.push({event:L,listeners:A}),O?L.data=O:(O=M1e(r),O!==null&&(L.data=O)))),(O=F6e?k6e(t,r):z6e(t,r))&&(c=uk(c,"onBeforeInput"),0<c.length&&(u=new Fse("onBeforeInput","beforeinput",null,r,u),h.push({event:u,listeners:c}),u.data=O))}B1e(h,e)})}function qR(t,e,r){return{instance:t,listener:e,currentTarget:r}}function uk(t,e){for(var r=e+"Capture",i=[];t!==null;){var n=t,s=n.stateNode;n.tag===5&&s!==null&&(n=s,s=UR(t,r),s!=null&&i.unshift(qR(t,s,n)),s=UR(t,e),s!=null&&i.push(qR(t,s,n))),t=t.return}return i}function q2(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function Xse(t,e,r,i,n){for(var s=e._reactName,o=[];r!==null&&r!==i;){var a=r,l=a.alternate,c=a.stateNode;if(l!==null&&l===i)break;a.tag===5&&c!==null&&(a=c,n?(l=UR(r,s),l!=null&&o.unshift(qR(r,l,a))):n||(l=UR(r,s),l!=null&&o.push(qR(r,l,a)))),r=r.return}o.length!==0&&t.push({event:e,listeners:o})}var K6e=/\r\n?/g,e8e=/\u0000|\uFFFD/g;function Zse(t){return(typeof t=="string"?t:""+t).replace(K6e,`
`).replace(e8e,"")}function IL(t,e,r){if(e=Zse(e),Zse(t)!==e&&r)throw Error(Ne(425))}function hk(){}var gH=null,yH=null;function _H(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var vH=typeof setTimeout=="function"?setTimeout:void 0,t8e=typeof clearTimeout=="function"?clearTimeout:void 0,Jse=typeof Promise=="function"?Promise:void 0,r8e=typeof queueMicrotask=="function"?queueMicrotask:typeof Jse<"u"?function(t){return Jse.resolve(null).then(t).catch(i8e)}:vH;function i8e(t){setTimeout(function(){throw t})}function PB(t,e){var r=e,i=0;do{var n=r.nextSibling;if(t.removeChild(r),n&&n.nodeType===8)if(r=n.data,r==="/$"){if(i===0){t.removeChild(n),GR(e);return}i--}else r!=="$"&&r!=="$?"&&r!=="$!"||i++;r=n}while(r);GR(e)}function L1(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function Qse(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var r=t.data;if(r==="$"||r==="$!"||r==="$?"){if(e===0)return t;e--}else r==="/$"&&e++}t=t.previousSibling}return null}var E3=Math.random().toString(36).slice(2),xm="__reactFiber$"+E3,YR="__reactProps$"+E3,q0="__reactContainer$"+E3,bH="__reactEvents$"+E3,n8e="__reactListeners$"+E3,s8e="__reactHandles$"+E3;function ix(t){var e=t[xm];if(e)return e;for(var r=t.parentNode;r;){if(e=r[q0]||r[xm]){if(r=e.alternate,e.child!==null||r!==null&&r.child!==null)for(t=Qse(t);t!==null;){if(r=t[xm])return r;t=Qse(t)}return e}t=r,r=t.parentNode}return null}function gI(t){return t=t[xm]||t[q0],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function XS(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(Ne(33))}function fz(t){return t[YR]||null}var wH=[],ZS=-1;function Ov(t){return{current:t}}function Yn(t){0>ZS||(t.current=wH[ZS],wH[ZS]=null,ZS--)}function Nn(t,e){ZS++,wH[ZS]=t.current,t.current=e}var Q1={},bl=Ov(Q1),qc=Ov(!1),Ux=Q1;function yE(t,e){var r=t.type.contextTypes;if(!r)return Q1;var i=t.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var n={},s;for(s in r)n[s]=e[s];return i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=n),n}function Yc(t){return t=t.childContextTypes,t!=null}function dk(){Yn(qc),Yn(bl)}function Kse(t,e,r){if(bl.current!==Q1)throw Error(Ne(168));Nn(bl,e),Nn(qc,r)}function G1e(t,e,r){var i=t.stateNode;if(e=e.childContextTypes,typeof i.getChildContext!="function")return r;i=i.getChildContext();for(var n in i)if(!(n in e))throw Error(Ne(108,Gke(t)||"Unknown",n));return ys({},r,i)}function pk(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Q1,Ux=bl.current,Nn(bl,t),Nn(qc,qc.current),!0}function eoe(t,e,r){var i=t.stateNode;if(!i)throw Error(Ne(169));r?(t=G1e(t,e,Ux),i.__reactInternalMemoizedMergedChildContext=t,Yn(qc),Yn(bl),Nn(bl,t)):Yn(qc),Nn(qc,r)}var _0=null,mz=!1,AB=!1;function j1e(t){_0===null?_0=[t]:_0.push(t)}function o8e(t){mz=!0,j1e(t)}function Rv(){if(!AB&&_0!==null){AB=!0;var t=0,e=an;try{var r=_0;for(an=1;t<r.length;t++){var i=r[t];do i=i(!0);while(i!==null)}_0=null,mz=!1}catch(n){throw _0!==null&&(_0=_0.slice(t+1)),m1e(LQ,Rv),n}finally{an=e,AB=!1}}return null}var JS=[],QS=0,fk=null,mk=0,kh=[],zh=0,Bx=null,E0=1,P0="";function kb(t,e){JS[QS++]=mk,JS[QS++]=fk,fk=t,mk=e}function H1e(t,e,r){kh[zh++]=E0,kh[zh++]=P0,kh[zh++]=Bx,Bx=t;var i=E0;t=P0;var n=32-Hp(i)-1;i&=~(1<<n),r+=1;var s=32-Hp(e)+n;if(30<s){var o=n-n%5;s=(i&(1<<o)-1).toString(32),i>>=o,n-=o,E0=1<<32-Hp(e)+n|r<<n|i,P0=s+t}else E0=1<<s|r<<n|i,P0=t}function GQ(t){t.return!==null&&(kb(t,1),H1e(t,1,0))}function jQ(t){for(;t===fk;)fk=JS[--QS],JS[QS]=null,mk=JS[--QS],JS[QS]=null;for(;t===Bx;)Bx=kh[--zh],kh[zh]=null,P0=kh[--zh],kh[zh]=null,E0=kh[--zh],kh[zh]=null}var Vu=null,Uu=null,ss=!1,Cp=null;function W1e(t,e){var r=Xh(5,null,null,0);r.elementType="DELETED",r.stateNode=e,r.return=t,e=t.deletions,e===null?(t.deletions=[r],t.flags|=16):e.push(r)}function toe(t,e){switch(t.tag){case 5:var r=t.type;return e=e.nodeType!==1||r.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,Vu=t,Uu=L1(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,Vu=t,Uu=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(r=Bx!==null?{id:E0,overflow:P0}:null,t.memoizedState={dehydrated:e,treeContext:r,retryLane:1073741824},r=Xh(18,null,null,0),r.stateNode=e,r.return=t,t.child=r,Vu=t,Uu=null,!0):!1;default:return!1}}function xH(t){return(t.mode&1)!==0&&(t.flags&128)===0}function TH(t){if(ss){var e=Uu;if(e){var r=e;if(!toe(t,e)){if(xH(t))throw Error(Ne(418));e=L1(r.nextSibling);var i=Vu;e&&toe(t,e)?W1e(i,r):(t.flags=t.flags&-4097|2,ss=!1,Vu=t)}}else{if(xH(t))throw Error(Ne(418));t.flags=t.flags&-4097|2,ss=!1,Vu=t}}}function roe(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Vu=t}function LL(t){if(t!==Vu)return!1;if(!ss)return roe(t),ss=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!_H(t.type,t.memoizedProps)),e&&(e=Uu)){if(xH(t))throw q1e(),Error(Ne(418));for(;e;)W1e(t,e),e=L1(e.nextSibling)}if(roe(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(Ne(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var r=t.data;if(r==="/$"){if(e===0){Uu=L1(t.nextSibling);break e}e--}else r!=="$"&&r!=="$!"&&r!=="$?"||e++}t=t.nextSibling}Uu=null}}else Uu=Vu?L1(t.stateNode.nextSibling):null;return!0}function q1e(){for(var t=Uu;t;)t=L1(t.nextSibling)}function _E(){Uu=Vu=null,ss=!1}function HQ(t){Cp===null?Cp=[t]:Cp.push(t)}var a8e=hy.ReactCurrentBatchConfig;function pp(t,e){if(t&&t.defaultProps){e=ys({},e),t=t.defaultProps;for(var r in t)e[r]===void 0&&(e[r]=t[r]);return e}return e}var gk=Ov(null),yk=null,KS=null,WQ=null;function qQ(){WQ=KS=yk=null}function YQ(t){var e=gk.current;Yn(gk),t._currentValue=e}function SH(t,e,r){for(;t!==null;){var i=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),t===r)break;t=t.return}}function LC(t,e){yk=t,WQ=KS=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Vc=!0),t.firstContext=null)}function ad(t){var e=t._currentValue;if(WQ!==t)if(t={context:t,memoizedValue:e,next:null},KS===null){if(yk===null)throw Error(Ne(308));KS=t,yk.dependencies={lanes:0,firstContext:t}}else KS=KS.next=t;return e}var nx=null;function XQ(t){nx===null?nx=[t]:nx.push(t)}function Y1e(t,e,r,i){var n=e.interleaved;return n===null?(r.next=r,XQ(e)):(r.next=n.next,n.next=r),e.interleaved=r,Y0(t,i)}function Y0(t,e){t.lanes|=e;var r=t.alternate;for(r!==null&&(r.lanes|=e),r=t,t=t.return;t!==null;)t.childLanes|=e,r=t.alternate,r!==null&&(r.childLanes|=e),r=t,t=t.return;return r.tag===3?r.stateNode:null}var W_=!1;function ZQ(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function X1e(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function $0(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function D1(t,e,r){var i=t.updateQueue;if(i===null)return null;if(i=i.shared,Ei&2){var n=i.pending;return n===null?e.next=e:(e.next=n.next,n.next=e),i.pending=e,Y0(t,r)}return n=i.interleaved,n===null?(e.next=e,XQ(i)):(e.next=n.next,n.next=e),i.interleaved=e,Y0(t,r)}function q4(t,e,r){if(e=e.updateQueue,e!==null&&(e=e.shared,(r&4194240)!==0)){var i=e.lanes;i&=t.pendingLanes,r|=i,e.lanes=r,DQ(t,r)}}function ioe(t,e){var r=t.updateQueue,i=t.alternate;if(i!==null&&(i=i.updateQueue,r===i)){var n=null,s=null;if(r=r.firstBaseUpdate,r!==null){do{var o={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};s===null?n=s=o:s=s.next=o,r=r.next}while(r!==null);s===null?n=s=e:s=s.next=e}else n=s=e;r={baseState:i.baseState,firstBaseUpdate:n,lastBaseUpdate:s,shared:i.shared,effects:i.effects},t.updateQueue=r;return}t=r.lastBaseUpdate,t===null?r.firstBaseUpdate=e:t.next=e,r.lastBaseUpdate=e}function _k(t,e,r,i){var n=t.updateQueue;W_=!1;var s=n.firstBaseUpdate,o=n.lastBaseUpdate,a=n.shared.pending;if(a!==null){n.shared.pending=null;var l=a,c=l.next;l.next=null,o===null?s=c:o.next=c,o=l;var u=t.alternate;u!==null&&(u=u.updateQueue,a=u.lastBaseUpdate,a!==o&&(a===null?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l))}if(s!==null){var h=n.baseState;o=0,u=c=l=null,a=s;do{var p=a.lane,f=a.eventTime;if((i&p)===p){u!==null&&(u=u.next={eventTime:f,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var g=t,_=a;switch(p=e,f=r,_.tag){case 1:if(g=_.payload,typeof g=="function"){h=g.call(f,h,p);break e}h=g;break e;case 3:g.flags=g.flags&-65537|128;case 0:if(g=_.payload,p=typeof g=="function"?g.call(f,h,p):g,p==null)break e;h=ys({},h,p);break e;case 2:W_=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,p=n.effects,p===null?n.effects=[a]:p.push(a))}else f={eventTime:f,lane:p,tag:a.tag,payload:a.payload,callback:a.callback,next:null},u===null?(c=u=f,l=h):u=u.next=f,o|=p;if(a=a.next,a===null){if(a=n.shared.pending,a===null)break;p=a,a=p.next,p.next=null,n.lastBaseUpdate=p,n.shared.pending=null}}while(!0);if(u===null&&(l=h),n.baseState=l,n.firstBaseUpdate=c,n.lastBaseUpdate=u,e=n.shared.interleaved,e!==null){n=e;do o|=n.lane,n=n.next;while(n!==e)}else s===null&&(n.shared.lanes=0);Gx|=o,t.lanes=o,t.memoizedState=h}}function noe(t,e,r){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var i=t[e],n=i.callback;if(n!==null){if(i.callback=null,i=r,typeof n!="function")throw Error(Ne(191,n));n.call(i)}}}var Z1e=new Y_e.Component().refs;function CH(t,e,r,i){e=t.memoizedState,r=r(i,e),r=r==null?e:ys({},e,r),t.memoizedState=r,t.lanes===0&&(t.updateQueue.baseState=r)}var gz={isMounted:function(t){return(t=t._reactInternals)?C2(t)===t:!1},enqueueSetState:function(t,e,r){t=t._reactInternals;var i=ec(),n=F1(t),s=$0(i,n);s.payload=e,r!=null&&(s.callback=r),e=D1(t,s,n),e!==null&&(Wp(e,t,n,i),q4(e,t,n))},enqueueReplaceState:function(t,e,r){t=t._reactInternals;var i=ec(),n=F1(t),s=$0(i,n);s.tag=1,s.payload=e,r!=null&&(s.callback=r),e=D1(t,s,n),e!==null&&(Wp(e,t,n,i),q4(e,t,n))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var r=ec(),i=F1(t),n=$0(r,i);n.tag=2,e!=null&&(n.callback=e),e=D1(t,n,i),e!==null&&(Wp(e,t,i,r),q4(e,t,i))}};function soe(t,e,r,i,n,s,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(i,s,o):e.prototype&&e.prototype.isPureReactComponent?!HR(r,i)||!HR(n,s):!0}function J1e(t,e,r){var i=!1,n=Q1,s=e.contextType;return typeof s=="object"&&s!==null?s=ad(s):(n=Yc(e)?Ux:bl.current,i=e.contextTypes,s=(i=i!=null)?yE(t,n):Q1),e=new e(r,s),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=gz,t.stateNode=e,e._reactInternals=t,i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=n,t.__reactInternalMemoizedMaskedChildContext=s),e}function ooe(t,e,r,i){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(r,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(r,i),e.state!==t&&gz.enqueueReplaceState(e,e.state,null)}function EH(t,e,r,i){var n=t.stateNode;n.props=r,n.state=t.memoizedState,n.refs=Z1e,ZQ(t);var s=e.contextType;typeof s=="object"&&s!==null?n.context=ad(s):(s=Yc(e)?Ux:bl.current,n.context=yE(t,s)),n.state=t.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(CH(t,e,s,r),n.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof n.getSnapshotBeforeUpdate=="function"||typeof n.UNSAFE_componentWillMount!="function"&&typeof n.componentWillMount!="function"||(e=n.state,typeof n.componentWillMount=="function"&&n.componentWillMount(),typeof n.UNSAFE_componentWillMount=="function"&&n.UNSAFE_componentWillMount(),e!==n.state&&gz.enqueueReplaceState(n,n.state,null),_k(t,r,n,i),n.state=t.memoizedState),typeof n.componentDidMount=="function"&&(t.flags|=4194308)}function pP(t,e,r){if(t=r.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(Ne(309));var i=r.stateNode}if(!i)throw Error(Ne(147,t));var n=i,s=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=n.refs;a===Z1e&&(a=n.refs={}),o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof t!="string")throw Error(Ne(284));if(!r._owner)throw Error(Ne(290,t))}return t}function DL(t,e){throw t=Object.prototype.toString.call(e),Error(Ne(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function aoe(t){var e=t._init;return e(t._payload)}function Q1e(t){function e(b,w){if(t){var x=b.deletions;x===null?(b.deletions=[w],b.flags|=16):x.push(w)}}function r(b,w){if(!t)return null;for(;w!==null;)e(b,w),w=w.sibling;return null}function i(b,w){for(b=new Map;w!==null;)w.key!==null?b.set(w.key,w):b.set(w.index,w),w=w.sibling;return b}function n(b,w){return b=k1(b,w),b.index=0,b.sibling=null,b}function s(b,w,x){return b.index=x,t?(x=b.alternate,x!==null?(x=x.index,x<w?(b.flags|=2,w):x):(b.flags|=2,w)):(b.flags|=1048576,w)}function o(b){return t&&b.alternate===null&&(b.flags|=2),b}function a(b,w,x,S){return w===null||w.tag!==6?(w=DB(x,b.mode,S),w.return=b,w):(w=n(w,x),w.return=b,w)}function l(b,w,x,S){var E=x.type;return E===HS?u(b,w,x.props.children,S,x.key):w!==null&&(w.elementType===E||typeof E=="object"&&E!==null&&E.$$typeof===H_&&aoe(E)===w.type)?(S=n(w,x.props),S.ref=pP(b,w,x),S.return=b,S):(S=K4(x.type,x.key,x.props,null,b.mode,S),S.ref=pP(b,w,x),S.return=b,S)}function c(b,w,x,S){return w===null||w.tag!==4||w.stateNode.containerInfo!==x.containerInfo||w.stateNode.implementation!==x.implementation?(w=NB(x,b.mode,S),w.return=b,w):(w=n(w,x.children||[]),w.return=b,w)}function u(b,w,x,S,E){return w===null||w.tag!==7?(w=bx(x,b.mode,S,E),w.return=b,w):(w=n(w,x),w.return=b,w)}function h(b,w,x){if(typeof w=="string"&&w!==""||typeof w=="number")return w=DB(""+w,b.mode,x),w.return=b,w;if(typeof w=="object"&&w!==null){switch(w.$$typeof){case SL:return x=K4(w.type,w.key,w.props,null,b.mode,x),x.ref=pP(b,null,w),x.return=b,x;case jS:return w=NB(w,b.mode,x),w.return=b,w;case H_:var S=w._init;return h(b,S(w._payload),x)}if(PA(w)||lP(w))return w=bx(w,b.mode,x,null),w.return=b,w;DL(b,w)}return null}function p(b,w,x,S){var E=w!==null?w.key:null;if(typeof x=="string"&&x!==""||typeof x=="number")return E!==null?null:a(b,w,""+x,S);if(typeof x=="object"&&x!==null){switch(x.$$typeof){case SL:return x.key===E?l(b,w,x,S):null;case jS:return x.key===E?c(b,w,x,S):null;case H_:return E=x._init,p(b,w,E(x._payload),S)}if(PA(x)||lP(x))return E!==null?null:u(b,w,x,S,null);DL(b,x)}return null}function f(b,w,x,S,E){if(typeof S=="string"&&S!==""||typeof S=="number")return b=b.get(x)||null,a(w,b,""+S,E);if(typeof S=="object"&&S!==null){switch(S.$$typeof){case SL:return b=b.get(S.key===null?x:S.key)||null,l(w,b,S,E);case jS:return b=b.get(S.key===null?x:S.key)||null,c(w,b,S,E);case H_:var A=S._init;return f(b,w,x,A(S._payload),E)}if(PA(S)||lP(S))return b=b.get(x)||null,u(w,b,S,E,null);DL(w,S)}return null}function g(b,w,x,S){for(var E=null,A=null,O=w,L=w=0,z=null;O!==null&&L<x.length;L++){O.index>L?(z=O,O=null):z=O.sibling;var k=p(b,O,x[L],S);if(k===null){O===null&&(O=z);break}t&&O&&k.alternate===null&&e(b,O),w=s(k,w,L),A===null?E=k:A.sibling=k,A=k,O=z}if(L===x.length)return r(b,O),ss&&kb(b,L),E;if(O===null){for(;L<x.length;L++)O=h(b,x[L],S),O!==null&&(w=s(O,w,L),A===null?E=O:A.sibling=O,A=O);return ss&&kb(b,L),E}for(O=i(b,O);L<x.length;L++)z=f(O,b,L,x[L],S),z!==null&&(t&&z.alternate!==null&&O.delete(z.key===null?L:z.key),w=s(z,w,L),A===null?E=z:A.sibling=z,A=z);return t&&O.forEach(function(q){return e(b,q)}),ss&&kb(b,L),E}function _(b,w,x,S){var E=lP(x);if(typeof E!="function")throw Error(Ne(150));if(x=E.call(x),x==null)throw Error(Ne(151));for(var A=E=null,O=w,L=w=0,z=null,k=x.next();O!==null&&!k.done;L++,k=x.next()){O.index>L?(z=O,O=null):z=O.sibling;var q=p(b,O,k.value,S);if(q===null){O===null&&(O=z);break}t&&O&&q.alternate===null&&e(b,O),w=s(q,w,L),A===null?E=q:A.sibling=q,A=q,O=z}if(k.done)return r(b,O),ss&&kb(b,L),E;if(O===null){for(;!k.done;L++,k=x.next())k=h(b,k.value,S),k!==null&&(w=s(k,w,L),A===null?E=k:A.sibling=k,A=k);return ss&&kb(b,L),E}for(O=i(b,O);!k.done;L++,k=x.next())k=f(O,b,L,k.value,S),k!==null&&(t&&k.alternate!==null&&O.delete(k.key===null?L:k.key),w=s(k,w,L),A===null?E=k:A.sibling=k,A=k);return t&&O.forEach(function(B){return e(b,B)}),ss&&kb(b,L),E}function v(b,w,x,S){if(typeof x=="object"&&x!==null&&x.type===HS&&x.key===null&&(x=x.props.children),typeof x=="object"&&x!==null){switch(x.$$typeof){case SL:e:{for(var E=x.key,A=w;A!==null;){if(A.key===E){if(E=x.type,E===HS){if(A.tag===7){r(b,A.sibling),w=n(A,x.props.children),w.return=b,b=w;break e}}else if(A.elementType===E||typeof E=="object"&&E!==null&&E.$$typeof===H_&&aoe(E)===A.type){r(b,A.sibling),w=n(A,x.props),w.ref=pP(b,A,x),w.return=b,b=w;break e}r(b,A);break}else e(b,A);A=A.sibling}x.type===HS?(w=bx(x.props.children,b.mode,S,x.key),w.return=b,b=w):(S=K4(x.type,x.key,x.props,null,b.mode,S),S.ref=pP(b,w,x),S.return=b,b=S)}return o(b);case jS:e:{for(A=x.key;w!==null;){if(w.key===A)if(w.tag===4&&w.stateNode.containerInfo===x.containerInfo&&w.stateNode.implementation===x.implementation){r(b,w.sibling),w=n(w,x.children||[]),w.return=b,b=w;break e}else{r(b,w);break}else e(b,w);w=w.sibling}w=NB(x,b.mode,S),w.return=b,b=w}return o(b);case H_:return A=x._init,v(b,w,A(x._payload),S)}if(PA(x))return g(b,w,x,S);if(lP(x))return _(b,w,x,S);DL(b,x)}return typeof x=="string"&&x!==""||typeof x=="number"?(x=""+x,w!==null&&w.tag===6?(r(b,w.sibling),w=n(w,x),w.return=b,b=w):(r(b,w),w=DB(x,b.mode,S),w.return=b,b=w),o(b)):r(b,w)}return v}var vE=Q1e(!0),K1e=Q1e(!1),yI={},Vm=Ov(yI),XR=Ov(yI),ZR=Ov(yI);function sx(t){if(t===yI)throw Error(Ne(174));return t}function JQ(t,e){switch(Nn(ZR,e),Nn(XR,t),Nn(Vm,yI),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:nH(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=nH(e,t)}Yn(Vm),Nn(Vm,e)}function bE(){Yn(Vm),Yn(XR),Yn(ZR)}function eve(t){sx(ZR.current);var e=sx(Vm.current),r=nH(e,t.type);e!==r&&(Nn(XR,t),Nn(Vm,r))}function QQ(t){XR.current===t&&(Yn(Vm),Yn(XR))}var hs=Ov(0);function vk(t){for(var e=t;e!==null;){if(e.tag===13){var r=e.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var MB=[];function KQ(){for(var t=0;t<MB.length;t++)MB[t]._workInProgressVersionPrimary=null;MB.length=0}var Y4=hy.ReactCurrentDispatcher,OB=hy.ReactCurrentBatchConfig,Vx=0,ms=null,Lo=null,ta=null,bk=!1,NO=!1,JR=0,l8e=0;function Ya(){throw Error(Ne(321))}function eK(t,e){if(e===null)return!1;for(var r=0;r<e.length&&r<t.length;r++)if(!rf(t[r],e[r]))return!1;return!0}function tK(t,e,r,i,n,s){if(Vx=s,ms=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Y4.current=t===null||t.memoizedState===null?d8e:p8e,t=r(i,n),NO){s=0;do{if(NO=!1,JR=0,25<=s)throw Error(Ne(301));s+=1,ta=Lo=null,e.updateQueue=null,Y4.current=f8e,t=r(i,n)}while(NO)}if(Y4.current=wk,e=Lo!==null&&Lo.next!==null,Vx=0,ta=Lo=ms=null,bk=!1,e)throw Error(Ne(300));return t}function rK(){var t=JR!==0;return JR=0,t}function ym(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ta===null?ms.memoizedState=ta=t:ta=ta.next=t,ta}function ld(){if(Lo===null){var t=ms.alternate;t=t!==null?t.memoizedState:null}else t=Lo.next;var e=ta===null?ms.memoizedState:ta.next;if(e!==null)ta=e,Lo=t;else{if(t===null)throw Error(Ne(310));Lo=t,t={memoizedState:Lo.memoizedState,baseState:Lo.baseState,baseQueue:Lo.baseQueue,queue:Lo.queue,next:null},ta===null?ms.memoizedState=ta=t:ta=ta.next=t}return ta}function QR(t,e){return typeof e=="function"?e(t):e}function RB(t){var e=ld(),r=e.queue;if(r===null)throw Error(Ne(311));r.lastRenderedReducer=t;var i=Lo,n=i.baseQueue,s=r.pending;if(s!==null){if(n!==null){var o=n.next;n.next=s.next,s.next=o}i.baseQueue=n=s,r.pending=null}if(n!==null){s=n.next,i=i.baseState;var a=o=null,l=null,c=s;do{var u=c.lane;if((Vx&u)===u)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),i=c.hasEagerState?c.eagerState:t(i,c.action);else{var h={lane:u,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(a=l=h,o=i):l=l.next=h,ms.lanes|=u,Gx|=u}c=c.next}while(c!==null&&c!==s);l===null?o=i:l.next=a,rf(i,e.memoizedState)||(Vc=!0),e.memoizedState=i,e.baseState=o,e.baseQueue=l,r.lastRenderedState=i}if(t=r.interleaved,t!==null){n=t;do s=n.lane,ms.lanes|=s,Gx|=s,n=n.next;while(n!==t)}else n===null&&(r.lanes=0);return[e.memoizedState,r.dispatch]}function $B(t){var e=ld(),r=e.queue;if(r===null)throw Error(Ne(311));r.lastRenderedReducer=t;var i=r.dispatch,n=r.pending,s=e.memoizedState;if(n!==null){r.pending=null;var o=n=n.next;do s=t(s,o.action),o=o.next;while(o!==n);rf(s,e.memoizedState)||(Vc=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),r.lastRenderedState=s}return[s,i]}function tve(){}function rve(t,e){var r=ms,i=ld(),n=e(),s=!rf(i.memoizedState,n);if(s&&(i.memoizedState=n,Vc=!0),i=i.queue,iK(sve.bind(null,r,i,t),[t]),i.getSnapshot!==e||s||ta!==null&&ta.memoizedState.tag&1){if(r.flags|=2048,KR(9,nve.bind(null,r,i,n,e),void 0,null),la===null)throw Error(Ne(349));Vx&30||ive(r,e,n)}return n}function ive(t,e,r){t.flags|=16384,t={getSnapshot:e,value:r},e=ms.updateQueue,e===null?(e={lastEffect:null,stores:null},ms.updateQueue=e,e.stores=[t]):(r=e.stores,r===null?e.stores=[t]:r.push(t))}function nve(t,e,r,i){e.value=r,e.getSnapshot=i,ove(e)&&ave(t)}function sve(t,e,r){return r(function(){ove(e)&&ave(t)})}function ove(t){var e=t.getSnapshot;t=t.value;try{var r=e();return!rf(t,r)}catch{return!0}}function ave(t){var e=Y0(t,1);e!==null&&Wp(e,t,1,-1)}function loe(t){var e=ym();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:QR,lastRenderedState:t},e.queue=t,t=t.dispatch=h8e.bind(null,ms,t),[e.memoizedState,t]}function KR(t,e,r,i){return t={tag:t,create:e,destroy:r,deps:i,next:null},e=ms.updateQueue,e===null?(e={lastEffect:null,stores:null},ms.updateQueue=e,e.lastEffect=t.next=t):(r=e.lastEffect,r===null?e.lastEffect=t.next=t:(i=r.next,r.next=t,t.next=i,e.lastEffect=t)),t}function lve(){return ld().memoizedState}function X4(t,e,r,i){var n=ym();ms.flags|=t,n.memoizedState=KR(1|e,r,void 0,i===void 0?null:i)}function yz(t,e,r,i){var n=ld();i=i===void 0?null:i;var s=void 0;if(Lo!==null){var o=Lo.memoizedState;if(s=o.destroy,i!==null&&eK(i,o.deps)){n.memoizedState=KR(e,r,s,i);return}}ms.flags|=t,n.memoizedState=KR(1|e,r,s,i)}function coe(t,e){return X4(8390656,8,t,e)}function iK(t,e){return yz(2048,8,t,e)}function cve(t,e){return yz(4,2,t,e)}function uve(t,e){return yz(4,4,t,e)}function hve(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function dve(t,e,r){return r=r!=null?r.concat([t]):null,yz(4,4,hve.bind(null,e,t),r)}function nK(){}function pve(t,e){var r=ld();e=e===void 0?null:e;var i=r.memoizedState;return i!==null&&e!==null&&eK(e,i[1])?i[0]:(r.memoizedState=[t,e],t)}function fve(t,e){var r=ld();e=e===void 0?null:e;var i=r.memoizedState;return i!==null&&e!==null&&eK(e,i[1])?i[0]:(t=t(),r.memoizedState=[t,e],t)}function mve(t,e,r){return Vx&21?(rf(r,e)||(r=_1e(),ms.lanes|=r,Gx|=r,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Vc=!0),t.memoizedState=r)}function c8e(t,e){var r=an;an=r!==0&&4>r?r:4,t(!0);var i=OB.transition;OB.transition={};try{t(!1),e()}finally{an=r,OB.transition=i}}function gve(){return ld().memoizedState}function u8e(t,e,r){var i=F1(t);if(r={lane:i,action:r,hasEagerState:!1,eagerState:null,next:null},yve(t))_ve(e,r);else if(r=Y1e(t,e,r,i),r!==null){var n=ec();Wp(r,t,i,n),vve(r,e,i)}}function h8e(t,e,r){var i=F1(t),n={lane:i,action:r,hasEagerState:!1,eagerState:null,next:null};if(yve(t))_ve(e,n);else{var s=t.alternate;if(t.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,r);if(n.hasEagerState=!0,n.eagerState=a,rf(a,o)){var l=e.interleaved;l===null?(n.next=n,XQ(e)):(n.next=l.next,l.next=n),e.interleaved=n;return}}catch{}finally{}r=Y1e(t,e,n,i),r!==null&&(n=ec(),Wp(r,t,i,n),vve(r,e,i))}}function yve(t){var e=t.alternate;return t===ms||e!==null&&e===ms}function _ve(t,e){NO=bk=!0;var r=t.pending;r===null?e.next=e:(e.next=r.next,r.next=e),t.pending=e}function vve(t,e,r){if(r&4194240){var i=e.lanes;i&=t.pendingLanes,r|=i,e.lanes=r,DQ(t,r)}}var wk={readContext:ad,useCallback:Ya,useContext:Ya,useEffect:Ya,useImperativeHandle:Ya,useInsertionEffect:Ya,useLayoutEffect:Ya,useMemo:Ya,useReducer:Ya,useRef:Ya,useState:Ya,useDebugValue:Ya,useDeferredValue:Ya,useTransition:Ya,useMutableSource:Ya,useSyncExternalStore:Ya,useId:Ya,unstable_isNewReconciler:!1},d8e={readContext:ad,useCallback:function(t,e){return ym().memoizedState=[t,e===void 0?null:e],t},useContext:ad,useEffect:coe,useImperativeHandle:function(t,e,r){return r=r!=null?r.concat([t]):null,X4(4194308,4,hve.bind(null,e,t),r)},useLayoutEffect:function(t,e){return X4(4194308,4,t,e)},useInsertionEffect:function(t,e){return X4(4,2,t,e)},useMemo:function(t,e){var r=ym();return e=e===void 0?null:e,t=t(),r.memoizedState=[t,e],t},useReducer:function(t,e,r){var i=ym();return e=r!==void 0?r(e):e,i.memoizedState=i.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},i.queue=t,t=t.dispatch=u8e.bind(null,ms,t),[i.memoizedState,t]},useRef:function(t){var e=ym();return t={current:t},e.memoizedState=t},useState:loe,useDebugValue:nK,useDeferredValue:function(t){return ym().memoizedState=t},useTransition:function(){var t=loe(!1),e=t[0];return t=c8e.bind(null,t[1]),ym().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,r){var i=ms,n=ym();if(ss){if(r===void 0)throw Error(Ne(407));r=r()}else{if(r=e(),la===null)throw Error(Ne(349));Vx&30||ive(i,e,r)}n.memoizedState=r;var s={value:r,getSnapshot:e};return n.queue=s,coe(sve.bind(null,i,s,t),[t]),i.flags|=2048,KR(9,nve.bind(null,i,s,r,e),void 0,null),r},useId:function(){var t=ym(),e=la.identifierPrefix;if(ss){var r=P0,i=E0;r=(i&~(1<<32-Hp(i)-1)).toString(32)+r,e=":"+e+"R"+r,r=JR++,0<r&&(e+="H"+r.toString(32)),e+=":"}else r=l8e++,e=":"+e+"r"+r.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},p8e={readContext:ad,useCallback:pve,useContext:ad,useEffect:iK,useImperativeHandle:dve,useInsertionEffect:cve,useLayoutEffect:uve,useMemo:fve,useReducer:RB,useRef:lve,useState:function(){return RB(QR)},useDebugValue:nK,useDeferredValue:function(t){var e=ld();return mve(e,Lo.memoizedState,t)},useTransition:function(){var t=RB(QR)[0],e=ld().memoizedState;return[t,e]},useMutableSource:tve,useSyncExternalStore:rve,useId:gve,unstable_isNewReconciler:!1},f8e={readContext:ad,useCallback:pve,useContext:ad,useEffect:iK,useImperativeHandle:dve,useInsertionEffect:cve,useLayoutEffect:uve,useMemo:fve,useReducer:$B,useRef:lve,useState:function(){return $B(QR)},useDebugValue:nK,useDeferredValue:function(t){var e=ld();return Lo===null?e.memoizedState=t:mve(e,Lo.memoizedState,t)},useTransition:function(){var t=$B(QR)[0],e=ld().memoizedState;return[t,e]},useMutableSource:tve,useSyncExternalStore:rve,useId:gve,unstable_isNewReconciler:!1};function wE(t,e){try{var r="",i=e;do r+=Vke(i),i=i.return;while(i);var n=r}catch(s){n=`
Error generating stack: `+s.message+`
`+s.stack}return{value:t,source:e,stack:n,digest:null}}function IB(t,e,r){return{value:t,source:null,stack:r??null,digest:e??null}}function PH(t,e){try{console.error(e.value)}catch(r){setTimeout(function(){throw r})}}var m8e=typeof WeakMap=="function"?WeakMap:Map;function bve(t,e,r){r=$0(-1,r),r.tag=3,r.payload={element:null};var i=e.value;return r.callback=function(){Tk||(Tk=!0,FH=i),PH(t,e)},r}function wve(t,e,r){r=$0(-1,r),r.tag=3;var i=t.type.getDerivedStateFromError;if(typeof i=="function"){var n=e.value;r.payload=function(){return i(n)},r.callback=function(){PH(t,e)}}var s=t.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(r.callback=function(){PH(t,e),typeof i!="function"&&(N1===null?N1=new Set([this]):N1.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),r}function uoe(t,e,r){var i=t.pingCache;if(i===null){i=t.pingCache=new m8e;var n=new Set;i.set(e,n)}else n=i.get(e),n===void 0&&(n=new Set,i.set(e,n));n.has(r)||(n.add(r),t=M8e.bind(null,t,e,r),e.then(t,t))}function hoe(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function doe(t,e,r,i,n){return t.mode&1?(t.flags|=65536,t.lanes=n,t):(t===e?t.flags|=65536:(t.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(e=$0(-1,1),e.tag=2,D1(r,e,1))),r.lanes|=1),t)}var g8e=hy.ReactCurrentOwner,Vc=!1;function Hl(t,e,r,i){e.child=t===null?K1e(e,null,r,i):vE(e,t.child,r,i)}function poe(t,e,r,i,n){r=r.render;var s=e.ref;return LC(e,n),i=tK(t,e,r,i,s,n),r=rK(),t!==null&&!Vc?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~n,X0(t,e,n)):(ss&&r&&GQ(e),e.flags|=1,Hl(t,e,i,n),e.child)}function foe(t,e,r,i,n){if(t===null){var s=r.type;return typeof s=="function"&&!dK(s)&&s.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(e.tag=15,e.type=s,xve(t,e,s,i,n)):(t=K4(r.type,null,i,e,e.mode,n),t.ref=e.ref,t.return=e,e.child=t)}if(s=t.child,!(t.lanes&n)){var o=s.memoizedProps;if(r=r.compare,r=r!==null?r:HR,r(o,i)&&t.ref===e.ref)return X0(t,e,n)}return e.flags|=1,t=k1(s,i),t.ref=e.ref,t.return=e,e.child=t}function xve(t,e,r,i,n){if(t!==null){var s=t.memoizedProps;if(HR(s,i)&&t.ref===e.ref)if(Vc=!1,e.pendingProps=i=s,(t.lanes&n)!==0)t.flags&131072&&(Vc=!0);else return e.lanes=t.lanes,X0(t,e,n)}return AH(t,e,r,i,n)}function Tve(t,e,r){var i=e.pendingProps,n=i.children,s=t!==null?t.memoizedState:null;if(i.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Nn(tC,Pu),Pu|=r;else{if(!(r&1073741824))return t=s!==null?s.baseLanes|r:r,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,Nn(tC,Pu),Pu|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=s!==null?s.baseLanes:r,Nn(tC,Pu),Pu|=i}else s!==null?(i=s.baseLanes|r,e.memoizedState=null):i=r,Nn(tC,Pu),Pu|=i;return Hl(t,e,n,r),e.child}function Sve(t,e){var r=e.ref;(t===null&&r!==null||t!==null&&t.ref!==r)&&(e.flags|=512,e.flags|=2097152)}function AH(t,e,r,i,n){var s=Yc(r)?Ux:bl.current;return s=yE(e,s),LC(e,n),r=tK(t,e,r,i,s,n),i=rK(),t!==null&&!Vc?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~n,X0(t,e,n)):(ss&&i&&GQ(e),e.flags|=1,Hl(t,e,r,n),e.child)}function moe(t,e,r,i,n){if(Yc(r)){var s=!0;pk(e)}else s=!1;if(LC(e,n),e.stateNode===null)Z4(t,e),J1e(e,r,i),EH(e,r,i,n),i=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,c=r.contextType;typeof c=="object"&&c!==null?c=ad(c):(c=Yc(r)?Ux:bl.current,c=yE(e,c));var u=r.getDerivedStateFromProps,h=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";h||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==i||l!==c)&&ooe(e,o,i,c),W_=!1;var p=e.memoizedState;o.state=p,_k(e,i,o,n),l=e.memoizedState,a!==i||p!==l||qc.current||W_?(typeof u=="function"&&(CH(e,r,u,i),l=e.memoizedState),(a=W_||soe(e,r,a,i,p,l,c))?(h||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=l),o.props=i,o.state=l,o.context=c,i=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{o=e.stateNode,X1e(t,e),a=e.memoizedProps,c=e.type===e.elementType?a:pp(e.type,a),o.props=c,h=e.pendingProps,p=o.context,l=r.contextType,typeof l=="object"&&l!==null?l=ad(l):(l=Yc(r)?Ux:bl.current,l=yE(e,l));var f=r.getDerivedStateFromProps;(u=typeof f=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==h||p!==l)&&ooe(e,o,i,l),W_=!1,p=e.memoizedState,o.state=p,_k(e,i,o,n);var g=e.memoizedState;a!==h||p!==g||qc.current||W_?(typeof f=="function"&&(CH(e,r,f,i),g=e.memoizedState),(c=W_||soe(e,r,c,i,p,g,l)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(i,g,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(i,g,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&p===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&p===t.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=g),o.props=i,o.state=g,o.context=l,i=c):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&p===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&p===t.memoizedState||(e.flags|=1024),i=!1)}return MH(t,e,r,i,s,n)}function MH(t,e,r,i,n,s){Sve(t,e);var o=(e.flags&128)!==0;if(!i&&!o)return n&&eoe(e,r,!1),X0(t,e,s);i=e.stateNode,g8e.current=e;var a=o&&typeof r.getDerivedStateFromError!="function"?null:i.render();return e.flags|=1,t!==null&&o?(e.child=vE(e,t.child,null,s),e.child=vE(e,null,a,s)):Hl(t,e,a,s),e.memoizedState=i.state,n&&eoe(e,r,!0),e.child}function Cve(t){var e=t.stateNode;e.pendingContext?Kse(t,e.pendingContext,e.pendingContext!==e.context):e.context&&Kse(t,e.context,!1),JQ(t,e.containerInfo)}function goe(t,e,r,i,n){return _E(),HQ(n),e.flags|=256,Hl(t,e,r,i),e.child}var OH={dehydrated:null,treeContext:null,retryLane:0};function RH(t){return{baseLanes:t,cachePool:null,transitions:null}}function Eve(t,e,r){var i=e.pendingProps,n=hs.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(n&2)!==0),a?(s=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(n|=1),Nn(hs,n&1),t===null)return TH(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=i.children,t=i.fallback,s?(i=e.mode,s=e.child,o={mode:"hidden",children:o},!(i&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=bz(o,i,0,null),t=bx(t,i,r,null),s.return=e,t.return=e,s.sibling=t,e.child=s,e.child.memoizedState=RH(r),e.memoizedState=OH,t):sK(e,o));if(n=t.memoizedState,n!==null&&(a=n.dehydrated,a!==null))return y8e(t,e,o,i,a,n,r);if(s){s=i.fallback,o=e.mode,n=t.child,a=n.sibling;var l={mode:"hidden",children:i.children};return!(o&1)&&e.child!==n?(i=e.child,i.childLanes=0,i.pendingProps=l,e.deletions=null):(i=k1(n,l),i.subtreeFlags=n.subtreeFlags&14680064),a!==null?s=k1(a,s):(s=bx(s,o,r,null),s.flags|=2),s.return=e,i.return=e,i.sibling=s,e.child=i,i=s,s=e.child,o=t.child.memoizedState,o=o===null?RH(r):{baseLanes:o.baseLanes|r,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=t.childLanes&~r,e.memoizedState=OH,i}return s=t.child,t=s.sibling,i=k1(s,{mode:"visible",children:i.children}),!(e.mode&1)&&(i.lanes=r),i.return=e,i.sibling=null,t!==null&&(r=e.deletions,r===null?(e.deletions=[t],e.flags|=16):r.push(t)),e.child=i,e.memoizedState=null,i}function sK(t,e){return e=bz({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function NL(t,e,r,i){return i!==null&&HQ(i),vE(e,t.child,null,r),t=sK(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function y8e(t,e,r,i,n,s,o){if(r)return e.flags&256?(e.flags&=-257,i=IB(Error(Ne(422))),NL(t,e,o,i)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(s=i.fallback,n=e.mode,i=bz({mode:"visible",children:i.children},n,0,null),s=bx(s,n,o,null),s.flags|=2,i.return=e,s.return=e,i.sibling=s,e.child=i,e.mode&1&&vE(e,t.child,null,o),e.child.memoizedState=RH(o),e.memoizedState=OH,s);if(!(e.mode&1))return NL(t,e,o,null);if(n.data==="$!"){if(i=n.nextSibling&&n.nextSibling.dataset,i)var a=i.dgst;return i=a,s=Error(Ne(419)),i=IB(s,i,void 0),NL(t,e,o,i)}if(a=(o&t.childLanes)!==0,Vc||a){if(i=la,i!==null){switch(o&-o){case 4:n=2;break;case 16:n=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:n=32;break;case 536870912:n=268435456;break;default:n=0}n=n&(i.suspendedLanes|o)?0:n,n!==0&&n!==s.retryLane&&(s.retryLane=n,Y0(t,n),Wp(i,t,n,-1))}return hK(),i=IB(Error(Ne(421))),NL(t,e,o,i)}return n.data==="$?"?(e.flags|=128,e.child=t.child,e=O8e.bind(null,t),n._reactRetry=e,null):(t=s.treeContext,Uu=L1(n.nextSibling),Vu=e,ss=!0,Cp=null,t!==null&&(kh[zh++]=E0,kh[zh++]=P0,kh[zh++]=Bx,E0=t.id,P0=t.overflow,Bx=e),e=sK(e,i.children),e.flags|=4096,e)}function yoe(t,e,r){t.lanes|=e;var i=t.alternate;i!==null&&(i.lanes|=e),SH(t.return,e,r)}function LB(t,e,r,i,n){var s=t.memoizedState;s===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:r,tailMode:n}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=i,s.tail=r,s.tailMode=n)}function Pve(t,e,r){var i=e.pendingProps,n=i.revealOrder,s=i.tail;if(Hl(t,e,i.children,r),i=hs.current,i&2)i=i&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&yoe(t,r,e);else if(t.tag===19)yoe(t,r,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}i&=1}if(Nn(hs,i),!(e.mode&1))e.memoizedState=null;else switch(n){case"forwards":for(r=e.child,n=null;r!==null;)t=r.alternate,t!==null&&vk(t)===null&&(n=r),r=r.sibling;r=n,r===null?(n=e.child,e.child=null):(n=r.sibling,r.sibling=null),LB(e,!1,n,r,s);break;case"backwards":for(r=null,n=e.child,e.child=null;n!==null;){if(t=n.alternate,t!==null&&vk(t)===null){e.child=n;break}t=n.sibling,n.sibling=r,r=n,n=t}LB(e,!0,r,null,s);break;case"together":LB(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Z4(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function X0(t,e,r){if(t!==null&&(e.dependencies=t.dependencies),Gx|=e.lanes,!(r&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(Ne(153));if(e.child!==null){for(t=e.child,r=k1(t,t.pendingProps),e.child=r,r.return=e;t.sibling!==null;)t=t.sibling,r=r.sibling=k1(t,t.pendingProps),r.return=e;r.sibling=null}return e.child}function _8e(t,e,r){switch(e.tag){case 3:Cve(e),_E();break;case 5:eve(e);break;case 1:Yc(e.type)&&pk(e);break;case 4:JQ(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,n=e.memoizedProps.value;Nn(gk,i._currentValue),i._currentValue=n;break;case 13:if(i=e.memoizedState,i!==null)return i.dehydrated!==null?(Nn(hs,hs.current&1),e.flags|=128,null):r&e.child.childLanes?Eve(t,e,r):(Nn(hs,hs.current&1),t=X0(t,e,r),t!==null?t.sibling:null);Nn(hs,hs.current&1);break;case 19:if(i=(r&e.childLanes)!==0,t.flags&128){if(i)return Pve(t,e,r);e.flags|=128}if(n=e.memoizedState,n!==null&&(n.rendering=null,n.tail=null,n.lastEffect=null),Nn(hs,hs.current),i)break;return null;case 22:case 23:return e.lanes=0,Tve(t,e,r)}return X0(t,e,r)}var Ave,$H,Mve,Ove;Ave=function(t,e){for(var r=e.child;r!==null;){if(r.tag===5||r.tag===6)t.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===e)break;for(;r.sibling===null;){if(r.return===null||r.return===e)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};$H=function(){};Mve=function(t,e,r,i){var n=t.memoizedProps;if(n!==i){t=e.stateNode,sx(Vm.current);var s=null;switch(r){case"input":n=eH(t,n),i=eH(t,i),s=[];break;case"select":n=ys({},n,{value:void 0}),i=ys({},i,{value:void 0}),s=[];break;case"textarea":n=iH(t,n),i=iH(t,i),s=[];break;default:typeof n.onClick!="function"&&typeof i.onClick=="function"&&(t.onclick=hk)}sH(r,i);var o;r=null;for(c in n)if(!i.hasOwnProperty(c)&&n.hasOwnProperty(c)&&n[c]!=null)if(c==="style"){var a=n[c];for(o in a)a.hasOwnProperty(o)&&(r||(r={}),r[o]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(kR.hasOwnProperty(c)?s||(s=[]):(s=s||[]).push(c,null));for(c in i){var l=i[c];if(a=n!=null?n[c]:void 0,i.hasOwnProperty(c)&&l!==a&&(l!=null||a!=null))if(c==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(r||(r={}),r[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(r||(r={}),r[o]=l[o])}else r||(s||(s=[]),s.push(c,r)),r=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(s=s||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(kR.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&Bn("scroll",t),s||a===l||(s=[])):(s=s||[]).push(c,l))}r&&(s=s||[]).push("style",r);var c=s;(e.updateQueue=c)&&(e.flags|=4)}};Ove=function(t,e,r,i){r!==i&&(e.flags|=4)};function fP(t,e){if(!ss)switch(t.tailMode){case"hidden":e=t.tail;for(var r=null;e!==null;)e.alternate!==null&&(r=e),e=e.sibling;r===null?t.tail=null:r.sibling=null;break;case"collapsed":r=t.tail;for(var i=null;r!==null;)r.alternate!==null&&(i=r),r=r.sibling;i===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:i.sibling=null}}function Xa(t){var e=t.alternate!==null&&t.alternate.child===t.child,r=0,i=0;if(e)for(var n=t.child;n!==null;)r|=n.lanes|n.childLanes,i|=n.subtreeFlags&14680064,i|=n.flags&14680064,n.return=t,n=n.sibling;else for(n=t.child;n!==null;)r|=n.lanes|n.childLanes,i|=n.subtreeFlags,i|=n.flags,n.return=t,n=n.sibling;return t.subtreeFlags|=i,t.childLanes=r,e}function v8e(t,e,r){var i=e.pendingProps;switch(jQ(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Xa(e),null;case 1:return Yc(e.type)&&dk(),Xa(e),null;case 3:return i=e.stateNode,bE(),Yn(qc),Yn(bl),KQ(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(t===null||t.child===null)&&(LL(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Cp!==null&&(UH(Cp),Cp=null))),$H(t,e),Xa(e),null;case 5:QQ(e);var n=sx(ZR.current);if(r=e.type,t!==null&&e.stateNode!=null)Mve(t,e,r,i,n),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(e.stateNode===null)throw Error(Ne(166));return Xa(e),null}if(t=sx(Vm.current),LL(e)){i=e.stateNode,r=e.type;var s=e.memoizedProps;switch(i[xm]=e,i[YR]=s,t=(e.mode&1)!==0,r){case"dialog":Bn("cancel",i),Bn("close",i);break;case"iframe":case"object":case"embed":Bn("load",i);break;case"video":case"audio":for(n=0;n<MA.length;n++)Bn(MA[n],i);break;case"source":Bn("error",i);break;case"img":case"image":case"link":Bn("error",i),Bn("load",i);break;case"details":Bn("toggle",i);break;case"input":Ese(i,s),Bn("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!s.multiple},Bn("invalid",i);break;case"textarea":Ase(i,s),Bn("invalid",i)}sH(r,s),n=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?i.textContent!==a&&(s.suppressHydrationWarning!==!0&&IL(i.textContent,a,t),n=["children",a]):typeof a=="number"&&i.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&IL(i.textContent,a,t),n=["children",""+a]):kR.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&Bn("scroll",i)}switch(r){case"input":CL(i),Pse(i,s,!0);break;case"textarea":CL(i),Mse(i);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(i.onclick=hk)}i=n,e.updateQueue=i,i!==null&&(e.flags|=4)}else{o=n.nodeType===9?n:n.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=i1e(r)),t==="http://www.w3.org/1999/xhtml"?r==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof i.is=="string"?t=o.createElement(r,{is:i.is}):(t=o.createElement(r),r==="select"&&(o=t,i.multiple?o.multiple=!0:i.size&&(o.size=i.size))):t=o.createElementNS(t,r),t[xm]=e,t[YR]=i,Ave(t,e,!1,!1),e.stateNode=t;e:{switch(o=oH(r,i),r){case"dialog":Bn("cancel",t),Bn("close",t),n=i;break;case"iframe":case"object":case"embed":Bn("load",t),n=i;break;case"video":case"audio":for(n=0;n<MA.length;n++)Bn(MA[n],t);n=i;break;case"source":Bn("error",t),n=i;break;case"img":case"image":case"link":Bn("error",t),Bn("load",t),n=i;break;case"details":Bn("toggle",t),n=i;break;case"input":Ese(t,i),n=eH(t,i),Bn("invalid",t);break;case"option":n=i;break;case"select":t._wrapperState={wasMultiple:!!i.multiple},n=ys({},i,{value:void 0}),Bn("invalid",t);break;case"textarea":Ase(t,i),n=iH(t,i),Bn("invalid",t);break;default:n=i}sH(r,n),a=n;for(s in a)if(a.hasOwnProperty(s)){var l=a[s];s==="style"?o1e(t,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&n1e(t,l)):s==="children"?typeof l=="string"?(r!=="textarea"||l!=="")&&zR(t,l):typeof l=="number"&&zR(t,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(kR.hasOwnProperty(s)?l!=null&&s==="onScroll"&&Bn("scroll",t):l!=null&&MQ(t,s,l,o))}switch(r){case"input":CL(t),Pse(t,i,!1);break;case"textarea":CL(t),Mse(t);break;case"option":i.value!=null&&t.setAttribute("value",""+J1(i.value));break;case"select":t.multiple=!!i.multiple,s=i.value,s!=null?OC(t,!!i.multiple,s,!1):i.defaultValue!=null&&OC(t,!!i.multiple,i.defaultValue,!0);break;default:typeof n.onClick=="function"&&(t.onclick=hk)}switch(r){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Xa(e),null;case 6:if(t&&e.stateNode!=null)Ove(t,e,t.memoizedProps,i);else{if(typeof i!="string"&&e.stateNode===null)throw Error(Ne(166));if(r=sx(ZR.current),sx(Vm.current),LL(e)){if(i=e.stateNode,r=e.memoizedProps,i[xm]=e,(s=i.nodeValue!==r)&&(t=Vu,t!==null))switch(t.tag){case 3:IL(i.nodeValue,r,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&IL(i.nodeValue,r,(t.mode&1)!==0)}s&&(e.flags|=4)}else i=(r.nodeType===9?r:r.ownerDocument).createTextNode(i),i[xm]=e,e.stateNode=i}return Xa(e),null;case 13:if(Yn(hs),i=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(ss&&Uu!==null&&e.mode&1&&!(e.flags&128))q1e(),_E(),e.flags|=98560,s=!1;else if(s=LL(e),i!==null&&i.dehydrated!==null){if(t===null){if(!s)throw Error(Ne(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(Ne(317));s[xm]=e}else _E(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Xa(e),s=!1}else Cp!==null&&(UH(Cp),Cp=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=r,e):(i=i!==null,i!==(t!==null&&t.memoizedState!==null)&&i&&(e.child.flags|=8192,e.mode&1&&(t===null||hs.current&1?ko===0&&(ko=3):hK())),e.updateQueue!==null&&(e.flags|=4),Xa(e),null);case 4:return bE(),$H(t,e),t===null&&WR(e.stateNode.containerInfo),Xa(e),null;case 10:return YQ(e.type._context),Xa(e),null;case 17:return Yc(e.type)&&dk(),Xa(e),null;case 19:if(Yn(hs),s=e.memoizedState,s===null)return Xa(e),null;if(i=(e.flags&128)!==0,o=s.rendering,o===null)if(i)fP(s,!1);else{if(ko!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=vk(t),o!==null){for(e.flags|=128,fP(s,!1),i=o.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=r,r=e.child;r!==null;)s=r,t=i,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=t,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,t=o.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),r=r.sibling;return Nn(hs,hs.current&1|2),e.child}t=t.sibling}s.tail!==null&&Ws()>xE&&(e.flags|=128,i=!0,fP(s,!1),e.lanes=4194304)}else{if(!i)if(t=vk(o),t!==null){if(e.flags|=128,i=!0,r=t.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),fP(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!ss)return Xa(e),null}else 2*Ws()-s.renderingStartTime>xE&&r!==1073741824&&(e.flags|=128,i=!0,fP(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(r=s.last,r!==null?r.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=Ws(),e.sibling=null,r=hs.current,Nn(hs,i?r&1|2:r&1),e):(Xa(e),null);case 22:case 23:return uK(),i=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==i&&(e.flags|=8192),i&&e.mode&1?Pu&1073741824&&(Xa(e),e.subtreeFlags&6&&(e.flags|=8192)):Xa(e),null;case 24:return null;case 25:return null}throw Error(Ne(156,e.tag))}function b8e(t,e){switch(jQ(e),e.tag){case 1:return Yc(e.type)&&dk(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return bE(),Yn(qc),Yn(bl),KQ(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return QQ(e),null;case 13:if(Yn(hs),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(Ne(340));_E()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Yn(hs),null;case 4:return bE(),null;case 10:return YQ(e.type._context),null;case 22:case 23:return uK(),null;case 24:return null;default:return null}}var FL=!1,pl=!1,w8e=typeof WeakSet=="function"?WeakSet:Set,wt=null;function eC(t,e){var r=t.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(i){$s(t,e,i)}else r.current=null}function IH(t,e,r){try{r()}catch(i){$s(t,e,i)}}var _oe=!1;function x8e(t,e){if(gH=lk,t=L1e(),VQ(t)){if("selectionStart"in t)var r={start:t.selectionStart,end:t.selectionEnd};else e:{r=(r=t.ownerDocument)&&r.defaultView||window;var i=r.getSelection&&r.getSelection();if(i&&i.rangeCount!==0){r=i.anchorNode;var n=i.anchorOffset,s=i.focusNode;i=i.focusOffset;try{r.nodeType,s.nodeType}catch{r=null;break e}var o=0,a=-1,l=-1,c=0,u=0,h=t,p=null;t:for(;;){for(var f;h!==r||n!==0&&h.nodeType!==3||(a=o+n),h!==s||i!==0&&h.nodeType!==3||(l=o+i),h.nodeType===3&&(o+=h.nodeValue.length),(f=h.firstChild)!==null;)p=h,h=f;for(;;){if(h===t)break t;if(p===r&&++c===n&&(a=o),p===s&&++u===i&&(l=o),(f=h.nextSibling)!==null)break;h=p,p=h.parentNode}h=f}r=a===-1||l===-1?null:{start:a,end:l}}else r=null}r=r||{start:0,end:0}}else r=null;for(yH={focusedElem:t,selectionRange:r},lk=!1,wt=e;wt!==null;)if(e=wt,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,wt=t;else for(;wt!==null;){e=wt;try{var g=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(g!==null){var _=g.memoizedProps,v=g.memoizedState,b=e.stateNode,w=b.getSnapshotBeforeUpdate(e.elementType===e.type?_:pp(e.type,_),v);b.__reactInternalSnapshotBeforeUpdate=w}break;case 3:var x=e.stateNode.containerInfo;x.nodeType===1?x.textContent="":x.nodeType===9&&x.documentElement&&x.removeChild(x.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Ne(163))}}catch(S){$s(e,e.return,S)}if(t=e.sibling,t!==null){t.return=e.return,wt=t;break}wt=e.return}return g=_oe,_oe=!1,g}function FO(t,e,r){var i=e.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var n=i=i.next;do{if((n.tag&t)===t){var s=n.destroy;n.destroy=void 0,s!==void 0&&IH(e,r,s)}n=n.next}while(n!==i)}}function _z(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var r=e=e.next;do{if((r.tag&t)===t){var i=r.create;r.destroy=i()}r=r.next}while(r!==e)}}function LH(t){var e=t.ref;if(e!==null){var r=t.stateNode;switch(t.tag){case 5:t=r;break;default:t=r}typeof e=="function"?e(t):e.current=t}}function Rve(t){var e=t.alternate;e!==null&&(t.alternate=null,Rve(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[xm],delete e[YR],delete e[bH],delete e[n8e],delete e[s8e])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function $ve(t){return t.tag===5||t.tag===3||t.tag===4}function voe(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||$ve(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function DH(t,e,r){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?r.nodeType===8?r.parentNode.insertBefore(t,e):r.insertBefore(t,e):(r.nodeType===8?(e=r.parentNode,e.insertBefore(t,r)):(e=r,e.appendChild(t)),r=r._reactRootContainer,r!=null||e.onclick!==null||(e.onclick=hk));else if(i!==4&&(t=t.child,t!==null))for(DH(t,e,r),t=t.sibling;t!==null;)DH(t,e,r),t=t.sibling}function NH(t,e,r){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?r.insertBefore(t,e):r.appendChild(t);else if(i!==4&&(t=t.child,t!==null))for(NH(t,e,r),t=t.sibling;t!==null;)NH(t,e,r),t=t.sibling}var ba=null,gp=!1;function $y(t,e,r){for(r=r.child;r!==null;)Ive(t,e,r),r=r.sibling}function Ive(t,e,r){if(Bm&&typeof Bm.onCommitFiberUnmount=="function")try{Bm.onCommitFiberUnmount(uz,r)}catch{}switch(r.tag){case 5:pl||eC(r,e);case 6:var i=ba,n=gp;ba=null,$y(t,e,r),ba=i,gp=n,ba!==null&&(gp?(t=ba,r=r.stateNode,t.nodeType===8?t.parentNode.removeChild(r):t.removeChild(r)):ba.removeChild(r.stateNode));break;case 18:ba!==null&&(gp?(t=ba,r=r.stateNode,t.nodeType===8?PB(t.parentNode,r):t.nodeType===1&&PB(t,r),GR(t)):PB(ba,r.stateNode));break;case 4:i=ba,n=gp,ba=r.stateNode.containerInfo,gp=!0,$y(t,e,r),ba=i,gp=n;break;case 0:case 11:case 14:case 15:if(!pl&&(i=r.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){n=i=i.next;do{var s=n,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&IH(r,e,o),n=n.next}while(n!==i)}$y(t,e,r);break;case 1:if(!pl&&(eC(r,e),i=r.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=r.memoizedProps,i.state=r.memoizedState,i.componentWillUnmount()}catch(a){$s(r,e,a)}$y(t,e,r);break;case 21:$y(t,e,r);break;case 22:r.mode&1?(pl=(i=pl)||r.memoizedState!==null,$y(t,e,r),pl=i):$y(t,e,r);break;default:$y(t,e,r)}}function boe(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var r=t.stateNode;r===null&&(r=t.stateNode=new w8e),e.forEach(function(i){var n=R8e.bind(null,t,i);r.has(i)||(r.add(i),i.then(n,n))})}}function Md(t,e){var r=e.deletions;if(r!==null)for(var i=0;i<r.length;i++){var n=r[i];try{var s=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:ba=a.stateNode,gp=!1;break e;case 3:ba=a.stateNode.containerInfo,gp=!0;break e;case 4:ba=a.stateNode.containerInfo,gp=!0;break e}a=a.return}if(ba===null)throw Error(Ne(160));Ive(s,o,n),ba=null,gp=!1;var l=n.alternate;l!==null&&(l.return=null),n.return=null}catch(c){$s(n,e,c)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)Lve(e,t),e=e.sibling}function Lve(t,e){var r=t.alternate,i=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Md(e,t),xf(t),i&4){try{FO(3,t,t.return),_z(3,t)}catch(_){$s(t,t.return,_)}try{FO(5,t,t.return)}catch(_){$s(t,t.return,_)}}break;case 1:Md(e,t),xf(t),i&512&&r!==null&&eC(r,r.return);break;case 5:if(Md(e,t),xf(t),i&512&&r!==null&&eC(r,r.return),t.flags&32){var n=t.stateNode;try{zR(n,"")}catch(_){$s(t,t.return,_)}}if(i&4&&(n=t.stateNode,n!=null)){var s=t.memoizedProps,o=r!==null?r.memoizedProps:s,a=t.type,l=t.updateQueue;if(t.updateQueue=null,l!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&t1e(n,s),oH(a,o);var c=oH(a,s);for(o=0;o<l.length;o+=2){var u=l[o],h=l[o+1];u==="style"?o1e(n,h):u==="dangerouslySetInnerHTML"?n1e(n,h):u==="children"?zR(n,h):MQ(n,u,h,c)}switch(a){case"input":tH(n,s);break;case"textarea":r1e(n,s);break;case"select":var p=n._wrapperState.wasMultiple;n._wrapperState.wasMultiple=!!s.multiple;var f=s.value;f!=null?OC(n,!!s.multiple,f,!1):p!==!!s.multiple&&(s.defaultValue!=null?OC(n,!!s.multiple,s.defaultValue,!0):OC(n,!!s.multiple,s.multiple?[]:"",!1))}n[YR]=s}catch(_){$s(t,t.return,_)}}break;case 6:if(Md(e,t),xf(t),i&4){if(t.stateNode===null)throw Error(Ne(162));n=t.stateNode,s=t.memoizedProps;try{n.nodeValue=s}catch(_){$s(t,t.return,_)}}break;case 3:if(Md(e,t),xf(t),i&4&&r!==null&&r.memoizedState.isDehydrated)try{GR(e.containerInfo)}catch(_){$s(t,t.return,_)}break;case 4:Md(e,t),xf(t);break;case 13:Md(e,t),xf(t),n=t.child,n.flags&8192&&(s=n.memoizedState!==null,n.stateNode.isHidden=s,!s||n.alternate!==null&&n.alternate.memoizedState!==null||(lK=Ws())),i&4&&boe(t);break;case 22:if(u=r!==null&&r.memoizedState!==null,t.mode&1?(pl=(c=pl)||u,Md(e,t),pl=c):Md(e,t),xf(t),i&8192){if(c=t.memoizedState!==null,(t.stateNode.isHidden=c)&&!u&&t.mode&1)for(wt=t,u=t.child;u!==null;){for(h=wt=u;wt!==null;){switch(p=wt,f=p.child,p.tag){case 0:case 11:case 14:case 15:FO(4,p,p.return);break;case 1:eC(p,p.return);var g=p.stateNode;if(typeof g.componentWillUnmount=="function"){i=p,r=p.return;try{e=i,g.props=e.memoizedProps,g.state=e.memoizedState,g.componentWillUnmount()}catch(_){$s(i,r,_)}}break;case 5:eC(p,p.return);break;case 22:if(p.memoizedState!==null){xoe(h);continue}}f!==null?(f.return=p,wt=f):xoe(h)}u=u.sibling}e:for(u=null,h=t;;){if(h.tag===5){if(u===null){u=h;try{n=h.stateNode,c?(s=n.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=h.stateNode,l=h.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=s1e("display",o))}catch(_){$s(t,t.return,_)}}}else if(h.tag===6){if(u===null)try{h.stateNode.nodeValue=c?"":h.memoizedProps}catch(_){$s(t,t.return,_)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===t)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===t)break e;for(;h.sibling===null;){if(h.return===null||h.return===t)break e;u===h&&(u=null),h=h.return}u===h&&(u=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:Md(e,t),xf(t),i&4&&boe(t);break;case 21:break;default:Md(e,t),xf(t)}}function xf(t){var e=t.flags;if(e&2){try{e:{for(var r=t.return;r!==null;){if($ve(r)){var i=r;break e}r=r.return}throw Error(Ne(160))}switch(i.tag){case 5:var n=i.stateNode;i.flags&32&&(zR(n,""),i.flags&=-33);var s=voe(t);NH(t,s,n);break;case 3:case 4:var o=i.stateNode.containerInfo,a=voe(t);DH(t,a,o);break;default:throw Error(Ne(161))}}catch(l){$s(t,t.return,l)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function T8e(t,e,r){wt=t,Dve(t)}function Dve(t,e,r){for(var i=(t.mode&1)!==0;wt!==null;){var n=wt,s=n.child;if(n.tag===22&&i){var o=n.memoizedState!==null||FL;if(!o){var a=n.alternate,l=a!==null&&a.memoizedState!==null||pl;a=FL;var c=pl;if(FL=o,(pl=l)&&!c)for(wt=n;wt!==null;)o=wt,l=o.child,o.tag===22&&o.memoizedState!==null?Toe(n):l!==null?(l.return=o,wt=l):Toe(n);for(;s!==null;)wt=s,Dve(s),s=s.sibling;wt=n,FL=a,pl=c}woe(t)}else n.subtreeFlags&8772&&s!==null?(s.return=n,wt=s):woe(t)}}function woe(t){for(;wt!==null;){var e=wt;if(e.flags&8772){var r=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:pl||_z(5,e);break;case 1:var i=e.stateNode;if(e.flags&4&&!pl)if(r===null)i.componentDidMount();else{var n=e.elementType===e.type?r.memoizedProps:pp(e.type,r.memoizedProps);i.componentDidUpdate(n,r.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&noe(e,s,i);break;case 3:var o=e.updateQueue;if(o!==null){if(r=null,e.child!==null)switch(e.child.tag){case 5:r=e.child.stateNode;break;case 1:r=e.child.stateNode}noe(e,o,r)}break;case 5:var a=e.stateNode;if(r===null&&e.flags&4){r=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&r.focus();break;case"img":l.src&&(r.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var c=e.alternate;if(c!==null){var u=c.memoizedState;if(u!==null){var h=u.dehydrated;h!==null&&GR(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Ne(163))}pl||e.flags&512&&LH(e)}catch(p){$s(e,e.return,p)}}if(e===t){wt=null;break}if(r=e.sibling,r!==null){r.return=e.return,wt=r;break}wt=e.return}}function xoe(t){for(;wt!==null;){var e=wt;if(e===t){wt=null;break}var r=e.sibling;if(r!==null){r.return=e.return,wt=r;break}wt=e.return}}function Toe(t){for(;wt!==null;){var e=wt;try{switch(e.tag){case 0:case 11:case 15:var r=e.return;try{_z(4,e)}catch(l){$s(e,r,l)}break;case 1:var i=e.stateNode;if(typeof i.componentDidMount=="function"){var n=e.return;try{i.componentDidMount()}catch(l){$s(e,n,l)}}var s=e.return;try{LH(e)}catch(l){$s(e,s,l)}break;case 5:var o=e.return;try{LH(e)}catch(l){$s(e,o,l)}}}catch(l){$s(e,e.return,l)}if(e===t){wt=null;break}var a=e.sibling;if(a!==null){a.return=e.return,wt=a;break}wt=e.return}}var S8e=Math.ceil,xk=hy.ReactCurrentDispatcher,oK=hy.ReactCurrentOwner,rd=hy.ReactCurrentBatchConfig,Ei=0,la=null,bo=null,Ia=0,Pu=0,tC=Ov(0),ko=0,e$=null,Gx=0,vz=0,aK=0,kO=null,Ic=null,lK=0,xE=1/0,h0=null,Tk=!1,FH=null,N1=null,kL=!1,f1=null,Sk=0,zO=0,kH=null,J4=-1,Q4=0;function ec(){return Ei&6?Ws():J4!==-1?J4:J4=Ws()}function F1(t){return t.mode&1?Ei&2&&Ia!==0?Ia&-Ia:a8e.transition!==null?(Q4===0&&(Q4=_1e()),Q4):(t=an,t!==0||(t=window.event,t=t===void 0?16:C1e(t.type)),t):1}function Wp(t,e,r,i){if(50<zO)throw zO=0,kH=null,Error(Ne(185));fI(t,r,i),(!(Ei&2)||t!==la)&&(t===la&&(!(Ei&2)&&(vz|=r),ko===4&&o1(t,Ia)),Xc(t,i),r===1&&Ei===0&&!(e.mode&1)&&(xE=Ws()+500,mz&&Rv()))}function Xc(t,e){var r=t.callbackNode;a6e(t,e);var i=ak(t,t===la?Ia:0);if(i===0)r!==null&&$se(r),t.callbackNode=null,t.callbackPriority=0;else if(e=i&-i,t.callbackPriority!==e){if(r!=null&&$se(r),e===1)t.tag===0?o8e(Soe.bind(null,t)):j1e(Soe.bind(null,t)),r8e(function(){!(Ei&6)&&Rv()}),r=null;else{switch(v1e(i)){case 1:r=LQ;break;case 4:r=g1e;break;case 16:r=ok;break;case 536870912:r=y1e;break;default:r=ok}r=Gve(r,Nve.bind(null,t))}t.callbackPriority=e,t.callbackNode=r}}function Nve(t,e){if(J4=-1,Q4=0,Ei&6)throw Error(Ne(327));var r=t.callbackNode;if(DC()&&t.callbackNode!==r)return null;var i=ak(t,t===la?Ia:0);if(i===0)return null;if(i&30||i&t.expiredLanes||e)e=Ck(t,i);else{e=i;var n=Ei;Ei|=2;var s=kve();(la!==t||Ia!==e)&&(h0=null,xE=Ws()+500,vx(t,e));do try{P8e();break}catch(a){Fve(t,a)}while(!0);qQ(),xk.current=s,Ei=n,bo!==null?e=0:(la=null,Ia=0,e=ko)}if(e!==0){if(e===2&&(n=hH(t),n!==0&&(i=n,e=zH(t,n))),e===1)throw r=e$,vx(t,0),o1(t,i),Xc(t,Ws()),r;if(e===6)o1(t,i);else{if(n=t.current.alternate,!(i&30)&&!C8e(n)&&(e=Ck(t,i),e===2&&(s=hH(t),s!==0&&(i=s,e=zH(t,s))),e===1))throw r=e$,vx(t,0),o1(t,i),Xc(t,Ws()),r;switch(t.finishedWork=n,t.finishedLanes=i,e){case 0:case 1:throw Error(Ne(345));case 2:zb(t,Ic,h0);break;case 3:if(o1(t,i),(i&130023424)===i&&(e=lK+500-Ws(),10<e)){if(ak(t,0)!==0)break;if(n=t.suspendedLanes,(n&i)!==i){ec(),t.pingedLanes|=t.suspendedLanes&n;break}t.timeoutHandle=vH(zb.bind(null,t,Ic,h0),e);break}zb(t,Ic,h0);break;case 4:if(o1(t,i),(i&4194240)===i)break;for(e=t.eventTimes,n=-1;0<i;){var o=31-Hp(i);s=1<<o,o=e[o],o>n&&(n=o),i&=~s}if(i=n,i=Ws()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*S8e(i/1960))-i,10<i){t.timeoutHandle=vH(zb.bind(null,t,Ic,h0),i);break}zb(t,Ic,h0);break;case 5:zb(t,Ic,h0);break;default:throw Error(Ne(329))}}}return Xc(t,Ws()),t.callbackNode===r?Nve.bind(null,t):null}function zH(t,e){var r=kO;return t.current.memoizedState.isDehydrated&&(vx(t,e).flags|=256),t=Ck(t,e),t!==2&&(e=Ic,Ic=r,e!==null&&UH(e)),t}function UH(t){Ic===null?Ic=t:Ic.push.apply(Ic,t)}function C8e(t){for(var e=t;;){if(e.flags&16384){var r=e.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var i=0;i<r.length;i++){var n=r[i],s=n.getSnapshot;n=n.value;try{if(!rf(s(),n))return!1}catch{return!1}}}if(r=e.child,e.subtreeFlags&16384&&r!==null)r.return=e,e=r;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function o1(t,e){for(e&=~aK,e&=~vz,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var r=31-Hp(e),i=1<<r;t[r]=-1,e&=~i}}function Soe(t){if(Ei&6)throw Error(Ne(327));DC();var e=ak(t,0);if(!(e&1))return Xc(t,Ws()),null;var r=Ck(t,e);if(t.tag!==0&&r===2){var i=hH(t);i!==0&&(e=i,r=zH(t,i))}if(r===1)throw r=e$,vx(t,0),o1(t,e),Xc(t,Ws()),r;if(r===6)throw Error(Ne(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,zb(t,Ic,h0),Xc(t,Ws()),null}function cK(t,e){var r=Ei;Ei|=1;try{return t(e)}finally{Ei=r,Ei===0&&(xE=Ws()+500,mz&&Rv())}}function jx(t){f1!==null&&f1.tag===0&&!(Ei&6)&&DC();var e=Ei;Ei|=1;var r=rd.transition,i=an;try{if(rd.transition=null,an=1,t)return t()}finally{an=i,rd.transition=r,Ei=e,!(Ei&6)&&Rv()}}function uK(){Pu=tC.current,Yn(tC)}function vx(t,e){t.finishedWork=null,t.finishedLanes=0;var r=t.timeoutHandle;if(r!==-1&&(t.timeoutHandle=-1,t8e(r)),bo!==null)for(r=bo.return;r!==null;){var i=r;switch(jQ(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&dk();break;case 3:bE(),Yn(qc),Yn(bl),KQ();break;case 5:QQ(i);break;case 4:bE();break;case 13:Yn(hs);break;case 19:Yn(hs);break;case 10:YQ(i.type._context);break;case 22:case 23:uK()}r=r.return}if(la=t,bo=t=k1(t.current,null),Ia=Pu=e,ko=0,e$=null,aK=vz=Gx=0,Ic=kO=null,nx!==null){for(e=0;e<nx.length;e++)if(r=nx[e],i=r.interleaved,i!==null){r.interleaved=null;var n=i.next,s=r.pending;if(s!==null){var o=s.next;s.next=n,i.next=o}r.pending=i}nx=null}return t}function Fve(t,e){do{var r=bo;try{if(qQ(),Y4.current=wk,bk){for(var i=ms.memoizedState;i!==null;){var n=i.queue;n!==null&&(n.pending=null),i=i.next}bk=!1}if(Vx=0,ta=Lo=ms=null,NO=!1,JR=0,oK.current=null,r===null||r.return===null){ko=1,e$=e,bo=null;break}e:{var s=t,o=r.return,a=r,l=e;if(e=Ia,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,u=a,h=u.tag;if(!(u.mode&1)&&(h===0||h===11||h===15)){var p=u.alternate;p?(u.updateQueue=p.updateQueue,u.memoizedState=p.memoizedState,u.lanes=p.lanes):(u.updateQueue=null,u.memoizedState=null)}var f=hoe(o);if(f!==null){f.flags&=-257,doe(f,o,a,s,e),f.mode&1&&uoe(s,c,e),e=f,l=c;var g=e.updateQueue;if(g===null){var _=new Set;_.add(l),e.updateQueue=_}else g.add(l);break e}else{if(!(e&1)){uoe(s,c,e),hK();break e}l=Error(Ne(426))}}else if(ss&&a.mode&1){var v=hoe(o);if(v!==null){!(v.flags&65536)&&(v.flags|=256),doe(v,o,a,s,e),HQ(wE(l,a));break e}}s=l=wE(l,a),ko!==4&&(ko=2),kO===null?kO=[s]:kO.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var b=bve(s,l,e);ioe(s,b);break e;case 1:a=l;var w=s.type,x=s.stateNode;if(!(s.flags&128)&&(typeof w.getDerivedStateFromError=="function"||x!==null&&typeof x.componentDidCatch=="function"&&(N1===null||!N1.has(x)))){s.flags|=65536,e&=-e,s.lanes|=e;var S=wve(s,a,e);ioe(s,S);break e}}s=s.return}while(s!==null)}Uve(r)}catch(E){e=E,bo===r&&r!==null&&(bo=r=r.return);continue}break}while(!0)}function kve(){var t=xk.current;return xk.current=wk,t===null?wk:t}function hK(){(ko===0||ko===3||ko===2)&&(ko=4),la===null||!(Gx&268435455)&&!(vz&268435455)||o1(la,Ia)}function Ck(t,e){var r=Ei;Ei|=2;var i=kve();(la!==t||Ia!==e)&&(h0=null,vx(t,e));do try{E8e();break}catch(n){Fve(t,n)}while(!0);if(qQ(),Ei=r,xk.current=i,bo!==null)throw Error(Ne(261));return la=null,Ia=0,ko}function E8e(){for(;bo!==null;)zve(bo)}function P8e(){for(;bo!==null&&!Qke();)zve(bo)}function zve(t){var e=Vve(t.alternate,t,Pu);t.memoizedProps=t.pendingProps,e===null?Uve(t):bo=e,oK.current=null}function Uve(t){var e=t;do{var r=e.alternate;if(t=e.return,e.flags&32768){if(r=b8e(r,e),r!==null){r.flags&=32767,bo=r;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{ko=6,bo=null;return}}else if(r=v8e(r,e,Pu),r!==null){bo=r;return}if(e=e.sibling,e!==null){bo=e;return}bo=e=t}while(e!==null);ko===0&&(ko=5)}function zb(t,e,r){var i=an,n=rd.transition;try{rd.transition=null,an=1,A8e(t,e,r,i)}finally{rd.transition=n,an=i}return null}function A8e(t,e,r,i){do DC();while(f1!==null);if(Ei&6)throw Error(Ne(327));r=t.finishedWork;var n=t.finishedLanes;if(r===null)return null;if(t.finishedWork=null,t.finishedLanes=0,r===t.current)throw Error(Ne(177));t.callbackNode=null,t.callbackPriority=0;var s=r.lanes|r.childLanes;if(l6e(t,s),t===la&&(bo=la=null,Ia=0),!(r.subtreeFlags&2064)&&!(r.flags&2064)||kL||(kL=!0,Gve(ok,function(){return DC(),null})),s=(r.flags&15990)!==0,r.subtreeFlags&15990||s){s=rd.transition,rd.transition=null;var o=an;an=1;var a=Ei;Ei|=4,oK.current=null,x8e(t,r),Lve(r,t),Y6e(yH),lk=!!gH,yH=gH=null,t.current=r,T8e(r),Kke(),Ei=a,an=o,rd.transition=s}else t.current=r;if(kL&&(kL=!1,f1=t,Sk=n),s=t.pendingLanes,s===0&&(N1=null),r6e(r.stateNode),Xc(t,Ws()),e!==null)for(i=t.onRecoverableError,r=0;r<e.length;r++)n=e[r],i(n.value,{componentStack:n.stack,digest:n.digest});if(Tk)throw Tk=!1,t=FH,FH=null,t;return Sk&1&&t.tag!==0&&DC(),s=t.pendingLanes,s&1?t===kH?zO++:(zO=0,kH=t):zO=0,Rv(),null}function DC(){if(f1!==null){var t=v1e(Sk),e=rd.transition,r=an;try{if(rd.transition=null,an=16>t?16:t,f1===null)var i=!1;else{if(t=f1,f1=null,Sk=0,Ei&6)throw Error(Ne(331));var n=Ei;for(Ei|=4,wt=t.current;wt!==null;){var s=wt,o=s.child;if(wt.flags&16){var a=s.deletions;if(a!==null){for(var l=0;l<a.length;l++){var c=a[l];for(wt=c;wt!==null;){var u=wt;switch(u.tag){case 0:case 11:case 15:FO(8,u,s)}var h=u.child;if(h!==null)h.return=u,wt=h;else for(;wt!==null;){u=wt;var p=u.sibling,f=u.return;if(Rve(u),u===c){wt=null;break}if(p!==null){p.return=f,wt=p;break}wt=f}}}var g=s.alternate;if(g!==null){var _=g.child;if(_!==null){g.child=null;do{var v=_.sibling;_.sibling=null,_=v}while(_!==null)}}wt=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,wt=o;else e:for(;wt!==null;){if(s=wt,s.flags&2048)switch(s.tag){case 0:case 11:case 15:FO(9,s,s.return)}var b=s.sibling;if(b!==null){b.return=s.return,wt=b;break e}wt=s.return}}var w=t.current;for(wt=w;wt!==null;){o=wt;var x=o.child;if(o.subtreeFlags&2064&&x!==null)x.return=o,wt=x;else e:for(o=w;wt!==null;){if(a=wt,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:_z(9,a)}}catch(E){$s(a,a.return,E)}if(a===o){wt=null;break e}var S=a.sibling;if(S!==null){S.return=a.return,wt=S;break e}wt=a.return}}if(Ei=n,Rv(),Bm&&typeof Bm.onPostCommitFiberRoot=="function")try{Bm.onPostCommitFiberRoot(uz,t)}catch{}i=!0}return i}finally{an=r,rd.transition=e}}return!1}function Coe(t,e,r){e=wE(r,e),e=bve(t,e,1),t=D1(t,e,1),e=ec(),t!==null&&(fI(t,1,e),Xc(t,e))}function $s(t,e,r){if(t.tag===3)Coe(t,t,r);else for(;e!==null;){if(e.tag===3){Coe(e,t,r);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(N1===null||!N1.has(i))){t=wE(r,t),t=wve(e,t,1),e=D1(e,t,1),t=ec(),e!==null&&(fI(e,1,t),Xc(e,t));break}}e=e.return}}function M8e(t,e,r){var i=t.pingCache;i!==null&&i.delete(e),e=ec(),t.pingedLanes|=t.suspendedLanes&r,la===t&&(Ia&r)===r&&(ko===4||ko===3&&(Ia&130023424)===Ia&&500>Ws()-lK?vx(t,0):aK|=r),Xc(t,e)}function Bve(t,e){e===0&&(t.mode&1?(e=AL,AL<<=1,!(AL&130023424)&&(AL=4194304)):e=1);var r=ec();t=Y0(t,e),t!==null&&(fI(t,e,r),Xc(t,r))}function O8e(t){var e=t.memoizedState,r=0;e!==null&&(r=e.retryLane),Bve(t,r)}function R8e(t,e){var r=0;switch(t.tag){case 13:var i=t.stateNode,n=t.memoizedState;n!==null&&(r=n.retryLane);break;case 19:i=t.stateNode;break;default:throw Error(Ne(314))}i!==null&&i.delete(e),Bve(t,r)}var Vve;Vve=function(t,e,r){if(t!==null)if(t.memoizedProps!==e.pendingProps||qc.current)Vc=!0;else{if(!(t.lanes&r)&&!(e.flags&128))return Vc=!1,_8e(t,e,r);Vc=!!(t.flags&131072)}else Vc=!1,ss&&e.flags&1048576&&H1e(e,mk,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;Z4(t,e),t=e.pendingProps;var n=yE(e,bl.current);LC(e,r),n=tK(null,e,i,t,n,r);var s=rK();return e.flags|=1,typeof n=="object"&&n!==null&&typeof n.render=="function"&&n.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Yc(i)?(s=!0,pk(e)):s=!1,e.memoizedState=n.state!==null&&n.state!==void 0?n.state:null,ZQ(e),n.updater=gz,e.stateNode=n,n._reactInternals=e,EH(e,i,t,r),e=MH(null,e,i,!0,s,r)):(e.tag=0,ss&&s&&GQ(e),Hl(null,e,n,r),e=e.child),e;case 16:i=e.elementType;e:{switch(Z4(t,e),t=e.pendingProps,n=i._init,i=n(i._payload),e.type=i,n=e.tag=I8e(i),t=pp(i,t),n){case 0:e=AH(null,e,i,t,r);break e;case 1:e=moe(null,e,i,t,r);break e;case 11:e=poe(null,e,i,t,r);break e;case 14:e=foe(null,e,i,pp(i.type,t),r);break e}throw Error(Ne(306,i,""))}return e;case 0:return i=e.type,n=e.pendingProps,n=e.elementType===i?n:pp(i,n),AH(t,e,i,n,r);case 1:return i=e.type,n=e.pendingProps,n=e.elementType===i?n:pp(i,n),moe(t,e,i,n,r);case 3:e:{if(Cve(e),t===null)throw Error(Ne(387));i=e.pendingProps,s=e.memoizedState,n=s.element,X1e(t,e),_k(e,i,null,r);var o=e.memoizedState;if(i=o.element,s.isDehydrated)if(s={element:i,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){n=wE(Error(Ne(423)),e),e=goe(t,e,i,r,n);break e}else if(i!==n){n=wE(Error(Ne(424)),e),e=goe(t,e,i,r,n);break e}else for(Uu=L1(e.stateNode.containerInfo.firstChild),Vu=e,ss=!0,Cp=null,r=K1e(e,null,i,r),e.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(_E(),i===n){e=X0(t,e,r);break e}Hl(t,e,i,r)}e=e.child}return e;case 5:return eve(e),t===null&&TH(e),i=e.type,n=e.pendingProps,s=t!==null?t.memoizedProps:null,o=n.children,_H(i,n)?o=null:s!==null&&_H(i,s)&&(e.flags|=32),Sve(t,e),Hl(t,e,o,r),e.child;case 6:return t===null&&TH(e),null;case 13:return Eve(t,e,r);case 4:return JQ(e,e.stateNode.containerInfo),i=e.pendingProps,t===null?e.child=vE(e,null,i,r):Hl(t,e,i,r),e.child;case 11:return i=e.type,n=e.pendingProps,n=e.elementType===i?n:pp(i,n),poe(t,e,i,n,r);case 7:return Hl(t,e,e.pendingProps,r),e.child;case 8:return Hl(t,e,e.pendingProps.children,r),e.child;case 12:return Hl(t,e,e.pendingProps.children,r),e.child;case 10:e:{if(i=e.type._context,n=e.pendingProps,s=e.memoizedProps,o=n.value,Nn(gk,i._currentValue),i._currentValue=o,s!==null)if(rf(s.value,o)){if(s.children===n.children&&!qc.current){e=X0(t,e,r);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var l=a.firstContext;l!==null;){if(l.context===i){if(s.tag===1){l=$0(-1,r&-r),l.tag=2;var c=s.updateQueue;if(c!==null){c=c.shared;var u=c.pending;u===null?l.next=l:(l.next=u.next,u.next=l),c.pending=l}}s.lanes|=r,l=s.alternate,l!==null&&(l.lanes|=r),SH(s.return,r,e),a.lanes|=r;break}l=l.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(Ne(341));o.lanes|=r,a=o.alternate,a!==null&&(a.lanes|=r),SH(o,r,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}Hl(t,e,n.children,r),e=e.child}return e;case 9:return n=e.type,i=e.pendingProps.children,LC(e,r),n=ad(n),i=i(n),e.flags|=1,Hl(t,e,i,r),e.child;case 14:return i=e.type,n=pp(i,e.pendingProps),n=pp(i.type,n),foe(t,e,i,n,r);case 15:return xve(t,e,e.type,e.pendingProps,r);case 17:return i=e.type,n=e.pendingProps,n=e.elementType===i?n:pp(i,n),Z4(t,e),e.tag=1,Yc(i)?(t=!0,pk(e)):t=!1,LC(e,r),J1e(e,i,n),EH(e,i,n,r),MH(null,e,i,!0,t,r);case 19:return Pve(t,e,r);case 22:return Tve(t,e,r)}throw Error(Ne(156,e.tag))};function Gve(t,e){return m1e(t,e)}function $8e(t,e,r,i){this.tag=t,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Xh(t,e,r,i){return new $8e(t,e,r,i)}function dK(t){return t=t.prototype,!(!t||!t.isReactComponent)}function I8e(t){if(typeof t=="function")return dK(t)?1:0;if(t!=null){if(t=t.$$typeof,t===RQ)return 11;if(t===$Q)return 14}return 2}function k1(t,e){var r=t.alternate;return r===null?(r=Xh(t.tag,e,t.key,t.mode),r.elementType=t.elementType,r.type=t.type,r.stateNode=t.stateNode,r.alternate=t,t.alternate=r):(r.pendingProps=e,r.type=t.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=t.flags&14680064,r.childLanes=t.childLanes,r.lanes=t.lanes,r.child=t.child,r.memoizedProps=t.memoizedProps,r.memoizedState=t.memoizedState,r.updateQueue=t.updateQueue,e=t.dependencies,r.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},r.sibling=t.sibling,r.index=t.index,r.ref=t.ref,r}function K4(t,e,r,i,n,s){var o=2;if(i=t,typeof t=="function")dK(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case HS:return bx(r.children,n,s,e);case OQ:o=8,n|=8;break;case Zj:return t=Xh(12,r,e,n|2),t.elementType=Zj,t.lanes=s,t;case Jj:return t=Xh(13,r,e,n),t.elementType=Jj,t.lanes=s,t;case Qj:return t=Xh(19,r,e,n),t.elementType=Qj,t.lanes=s,t;case Q_e:return bz(r,n,s,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case Z_e:o=10;break e;case J_e:o=9;break e;case RQ:o=11;break e;case $Q:o=14;break e;case H_:o=16,i=null;break e}throw Error(Ne(130,t==null?t:typeof t,""))}return e=Xh(o,r,e,n),e.elementType=t,e.type=i,e.lanes=s,e}function bx(t,e,r,i){return t=Xh(7,t,i,e),t.lanes=r,t}function bz(t,e,r,i){return t=Xh(22,t,i,e),t.elementType=Q_e,t.lanes=r,t.stateNode={isHidden:!1},t}function DB(t,e,r){return t=Xh(6,t,null,e),t.lanes=r,t}function NB(t,e,r){return e=Xh(4,t.children!==null?t.children:[],t.key,e),e.lanes=r,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function L8e(t,e,r,i,n){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=gB(0),this.expirationTimes=gB(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gB(0),this.identifierPrefix=i,this.onRecoverableError=n,this.mutableSourceEagerHydrationData=null}function pK(t,e,r,i,n,s,o,a,l){return t=new L8e(t,e,r,a,l),e===1?(e=1,s===!0&&(e|=8)):e=0,s=Xh(3,null,null,e),t.current=s,s.stateNode=t,s.memoizedState={element:i,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},ZQ(s),t}function D8e(t,e,r){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:jS,key:i==null?null:""+i,children:t,containerInfo:e,implementation:r}}function jve(t){if(!t)return Q1;t=t._reactInternals;e:{if(C2(t)!==t||t.tag!==1)throw Error(Ne(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Yc(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(Ne(171))}if(t.tag===1){var r=t.type;if(Yc(r))return G1e(t,r,e)}return e}function Hve(t,e,r,i,n,s,o,a,l){return t=pK(r,i,!0,t,n,s,o,a,l),t.context=jve(null),r=t.current,i=ec(),n=F1(r),s=$0(i,n),s.callback=e??null,D1(r,s,n),t.current.lanes=n,fI(t,n,i),Xc(t,i),t}function wz(t,e,r,i){var n=e.current,s=ec(),o=F1(n);return r=jve(r),e.context===null?e.context=r:e.pendingContext=r,e=$0(s,o),e.payload={element:t},i=i===void 0?null:i,i!==null&&(e.callback=i),t=D1(n,e,o),t!==null&&(Wp(t,n,o,s),q4(t,n,o)),o}function Ek(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function Eoe(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var r=t.retryLane;t.retryLane=r!==0&&r<e?r:e}}function fK(t,e){Eoe(t,e),(t=t.alternate)&&Eoe(t,e)}function N8e(){return null}var Wve=typeof reportError=="function"?reportError:function(t){console.error(t)};function mK(t){this._internalRoot=t}xz.prototype.render=mK.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(Ne(409));wz(t,e,null,null)};xz.prototype.unmount=mK.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;jx(function(){wz(null,t,null,null)}),e[q0]=null}};function xz(t){this._internalRoot=t}xz.prototype.unstable_scheduleHydration=function(t){if(t){var e=x1e();t={blockedOn:null,target:t,priority:e};for(var r=0;r<s1.length&&e!==0&&e<s1[r].priority;r++);s1.splice(r,0,t),r===0&&S1e(t)}};function gK(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Tz(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function Poe(){}function F8e(t,e,r,i,n){if(n){if(typeof i=="function"){var s=i;i=function(){var c=Ek(o);s.call(c)}}var o=Hve(e,i,t,0,null,!1,!1,"",Poe);return t._reactRootContainer=o,t[q0]=o.current,WR(t.nodeType===8?t.parentNode:t),jx(),o}for(;n=t.lastChild;)t.removeChild(n);if(typeof i=="function"){var a=i;i=function(){var c=Ek(l);a.call(c)}}var l=pK(t,0,!1,null,null,!1,!1,"",Poe);return t._reactRootContainer=l,t[q0]=l.current,WR(t.nodeType===8?t.parentNode:t),jx(function(){wz(e,l,r,i)}),l}function Sz(t,e,r,i,n){var s=r._reactRootContainer;if(s){var o=s;if(typeof n=="function"){var a=n;n=function(){var l=Ek(o);a.call(l)}}wz(e,o,t,n)}else o=F8e(r,e,t,n,i);return Ek(o)}b1e=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var r=AA(e.pendingLanes);r!==0&&(DQ(e,r|1),Xc(e,Ws()),!(Ei&6)&&(xE=Ws()+500,Rv()))}break;case 13:jx(function(){var i=Y0(t,1);if(i!==null){var n=ec();Wp(i,t,1,n)}}),fK(t,1)}};NQ=function(t){if(t.tag===13){var e=Y0(t,134217728);if(e!==null){var r=ec();Wp(e,t,134217728,r)}fK(t,134217728)}};w1e=function(t){if(t.tag===13){var e=F1(t),r=Y0(t,e);if(r!==null){var i=ec();Wp(r,t,e,i)}fK(t,e)}};x1e=function(){return an};T1e=function(t,e){var r=an;try{return an=t,e()}finally{an=r}};lH=function(t,e,r){switch(e){case"input":if(tH(t,r),e=r.name,r.type==="radio"&&e!=null){for(r=t;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<r.length;e++){var i=r[e];if(i!==t&&i.form===t.form){var n=fz(i);if(!n)throw Error(Ne(90));e1e(i),tH(i,n)}}}break;case"textarea":r1e(t,r);break;case"select":e=r.value,e!=null&&OC(t,!!r.multiple,e,!1)}};c1e=cK;u1e=jx;var k8e={usingClientEntryPoint:!1,Events:[gI,XS,fz,a1e,l1e,cK]},mP={findFiberByHostInstance:ix,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},z8e={bundleType:mP.bundleType,version:mP.version,rendererPackageName:mP.rendererPackageName,rendererConfig:mP.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:hy.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=p1e(t),t===null?null:t.stateNode},findFiberByHostInstance:mP.findFiberByHostInstance||N8e,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var zL=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!zL.isDisabled&&zL.supportsFiber)try{uz=zL.inject(z8e),Bm=zL}catch{}}rh.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=k8e;rh.createPortal=function(t,e){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!gK(e))throw Error(Ne(200));return D8e(t,e,null,r)};rh.createRoot=function(t,e){if(!gK(t))throw Error(Ne(299));var r=!1,i="",n=Wve;return e!=null&&(e.unstable_strictMode===!0&&(r=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onRecoverableError!==void 0&&(n=e.onRecoverableError)),e=pK(t,1,!1,null,null,r,!1,i,n),t[q0]=e.current,WR(t.nodeType===8?t.parentNode:t),new mK(e)};rh.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(Ne(188)):(t=Object.keys(t).join(","),Error(Ne(268,t)));return t=p1e(e),t=t===null?null:t.stateNode,t};rh.flushSync=function(t){return jx(t)};rh.hydrate=function(t,e,r){if(!Tz(e))throw Error(Ne(200));return Sz(null,t,e,!0,r)};rh.hydrateRoot=function(t,e,r){if(!gK(t))throw Error(Ne(405));var i=r!=null&&r.hydratedSources||null,n=!1,s="",o=Wve;if(r!=null&&(r.unstable_strictMode===!0&&(n=!0),r.identifierPrefix!==void 0&&(s=r.identifierPrefix),r.onRecoverableError!==void 0&&(o=r.onRecoverableError)),e=Hve(e,null,t,1,r??null,n,!1,s,o),t[q0]=e.current,WR(t),i)for(t=0;t<i.length;t++)r=i[t],n=r._getVersion,n=n(r._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[r,n]:e.mutableSourceEagerHydrationData.push(r,n);return new xz(e)};rh.render=function(t,e,r){if(!Tz(e))throw Error(Ne(200));return Sz(null,t,e,!1,r)};rh.unmountComponentAtNode=function(t){if(!Tz(t))throw Error(Ne(40));return t._reactRootContainer?(jx(function(){Sz(null,null,t,!1,function(){t._reactRootContainer=null,t[q0]=null})}),!0):!1};rh.unstable_batchedUpdates=cK;rh.unstable_renderSubtreeIntoContainer=function(t,e,r,i){if(!Tz(r))throw Error(Ne(200));if(t==null||t._reactInternals===void 0)throw Error(Ne(38));return Sz(t,e,r,!1,i)};rh.version="18.2.0-next-9e3b772b8-20220608";function qve(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(qve)}catch(t){console.error(t)}}qve(),H_e.exports=rh;var U8e=H_e.exports,Aoe=U8e;Yj.createRoot=Aoe.createRoot,Yj.hydrateRoot=Aoe.hydrateRoot;const B8e=t=>t.filter(e=>e!==void 0),Yve=([t,e,r])=>`hsl(${t} ${e}% ${r}%)`;function Cz(t,e=10){let r=t.flatMap(i=>Array.from({length:e},()=>i));return()=>{const i=Moe(r),n=r.indexOf(i);return r.splice(n,1,Moe(t)),i}}const Moe=t=>t[Math.floor(Math.random()*t.length)],_I=10,yK=20,V8e=1e3,Xve=100,vI={I:{color:[180,100,50],definition:[["1"],["1"],["1"],["1"]],spawn:!0},O:{color:[200,100,50],definition:[["1","1"],["1","1"]],spawn:!0},T:{color:[300,100,50],definition:[["1","0"],["1","1"],["1","0"]],spawn:!0},S:{color:[120,100,50],definition:[["0","1","1"],["1","1","0"]],spawn:!0},J:{color:[240,100,50],definition:[["1","0","0"],["1","1","1"]],spawn:!0},Z:{color:[0,100,50],definition:[["1","1","0"],["0","1","1"]],spawn:!0},L:{color:[38.82,100,50],definition:[["1","0"],["1","0"],["1","1"]],spawn:!0},_:{color:[0,0,0],definition:[],spawn:!1}},e5=Cz(Object.entries(vI).filter(([,{spawn:t}])=>t).map(([t])=>t));var ns=(t=>(t.UP="UP",t.DOWN="DOWN",t.LEFT="LEFT",t.RIGHT="RIGHT",t))(ns||{});const Ooe=t=>Object.entries(t).flatMap(([e,r])=>Object.keys(r).map(i=>[Number.parseInt(e),Number.parseInt(i)])),TE=(t,e,r=1)=>e===ns.UP?G8e(t,r):Object.fromEntries(Object.entries(t).map(([i,n])=>[e===ns.DOWN?Number.parseInt(i)+r:i,e===ns.DOWN?n:Object.fromEntries(Object.keys(n).map(s=>[Number.parseInt(s)+(e===ns.RIGHT?1:-1)*r,!0]))])),G8e=(t,e=1)=>j8e(t,r=>q8e(Y8e(X8e(e,K8e(r))))),j8e=(t,e)=>[t].map(r=>({shape:r,shapeXOffset:Pk(r,"x"),shapeYOffset:Pk(r,"y")})).map(({shape:r,shapeXOffset:i,shapeYOffset:n})=>W8e(e(Zve(r,i,n)),i,n))[0],Pk=(t,e)=>H8e((e==="x"?Object.values(t).flatMap(r=>Object.keys(r)):Object.keys(t)).map(r=>Number.parseInt(r))),H8e=t=>t.reduce((e,r)=>Number.isNaN(e)||r<e?r:e,Number.NaN),W8e=(t,e,r)=>TE(TE(t,ns.DOWN,r),ns.RIGHT,e),Zve=(t,e,r)=>TE(TE(t,ns.DOWN,-r),ns.LEFT,e),q8e=t=>Zve(t,Pk(t,"x"),Pk(t,"y")),Y8e=t=>Object.fromEntries(t.map((e,r)=>[r,Object.fromEntries(e.map((i,n)=>({cell:i,cellIndex:n})).filter(({cell:i})=>i).map(({cellIndex:i})=>[i,!0]))]).filter(([,e])=>Object.keys(e).length>0)),X8e=(t,e)=>Array.from(Array.from({length:t%4})).reduce(r=>Z8e(r),e),Z8e=t=>Q8e(J8e(t)),J8e=t=>t[0].map((e,r)=>t.map(i=>i[r])),Q8e=t=>t.map(e=>e.slice().reverse()),K8e=t=>[t].map(e=>({shape:e,size:Math.max(Roe(e,"x"),Roe(e,"y"))})).map(({shape:e,size:r})=>Array.from(new Array(r)).reduce((i,n,s)=>[...i,Array.from(new Array(r)).reduce((o,a,l)=>{var c;return[...o,(c=e[s])!=null&&c[l]?1:0]},[])],[]))[0],Roe=(t,e)=>eze((e==="y"?Object.keys(t):Object.values(t).flatMap(r=>Object.keys(r))).map(r=>Number.parseInt(r)+1)),eze=t=>t.reduce((e,r)=>Number.isNaN(e)||r>e?r:e,Number.NaN);function tze(t,e){const r=t.nextShapes[0],i=vI[r].definition,n=i[0].length,s=Math.round((_I-n)/2),o=t.board.some((c,u)=>c.some((h,p)=>{var f;return((f=i[u])==null?void 0:f[p-s])==="1"&&h!=="_"})),a={};function l(c,u){return a[c]??(a[c]={}),a[c][u]=!0,r}return{...t,isGameOver:o,currentShape:r,nextShapes:[...t.nextShapes.slice(1),e],currentShapeLocation:a,board:t.board.map((c,u)=>c.map((h,p)=>{var f;return((f=i[u])==null?void 0:f[p-s])==="1"?l(u,p):h}))}}function $oe(t,e){return Ooe(e).some(([,r])=>r<0||r>=_I)?t:Ooe(e).some(([r])=>r>=yK)||t.board.some((r,i)=>r.some((n,s)=>{var o,a;return((o=e[i])==null?void 0:o[s])&&!((a=t.currentShapeLocation[i])!=null&&a[s])&&n!=="_"}))?rze({...t,currentShapeLocation:{}},ize(t.board)):{...t,currentShapeLocation:e,board:t.board.map((r,i)=>r.map((n,s)=>{var o,a;return(o=e[i])!=null&&o[s]?t.currentShape:(a=t.currentShapeLocation[i])!=null&&a[s]?"_":n}))}}const rze=(t,e)=>e.length===0?t:{...t,score:t.score+Xve*2^e.length-1,board:[...Array.from({length:e.length}).fill(new Array(_I).fill("_")),...t.board.filter((r,i)=>!e.includes(i))]},ize=t=>t.map((e,r)=>({isCompleted:e.every(i=>i!=="_"),index:r})).filter(({isCompleted:e})=>e).map(({index:e})=>e),q_={initial:t=>({board:Array.from({length:yK}).fill(Array.from({length:_I}).fill("_")),currentShapeLocation:{},currentShape:"_",nextShapes:t,score:0,isPaused:!1}),togglePause:t=>({...t,isPaused:!t.isPaused}),move:(t,e)=>Object.keys(t.currentShapeLocation).length===0||t.isPaused&&e!==ns.DOWN?t:$oe(t,TE(t.currentShapeLocation,e,t.isPaused?-1:1)),hardDrop(t){let e=t,r=t;for(;Object.keys(e.currentShapeLocation).length>0;)e=r,r=q_.move(e,ns.DOWN);return r},gravity(t,e){return t.isPaused?t:Object.keys(t.currentShapeLocation).length===0?tze(t,e):$oe(t,TE(t.currentShapeLocation,ns.DOWN))}},UL="tetris-react-";function Jve(t,e){const[r,i]=Si.useState(()=>{const s=localStorage.getItem(`${UL}${t}`);return s===null?e:JSON.parse(s)}),n=Si.useCallback(s=>{localStorage.setItem(`${UL}${t}`,JSON.stringify(s)),i(s)},[t]);return Si.useEffect(()=>{globalThis.addEventListener("storage",({storageArea:s,key:o,newValue:a})=>{s!==globalThis.localStorage||o===null||!o.startsWith(UL)||a===null||o.slice(UL.length)!==t||JSON.stringify(r)===a||i(JSON.parse(a))})},[]),[r,n]}const Qve=()=>Jve("bestScore",0),nze=()=>Jve("gameState",q_.initial(Array.from({length:5},e5))),qs={title:"Tetris React",paused:"Game is paused",esc:"ESC",pressKeyToResume:t=>yt.jsxs(yt.Fragment,{children:["Press ",t," to resume"]}),instructions:"Control the game using WSAD or arrow keys. Pause using the ESC key",score:"Score: ",gameOver:"Game Over!",yourScore:"Your score was: ",yourBestScore:"Your best score is: ",playAgain:"Play Again?",saveGame:"Save Game",loadGame:"Load Game",panoramaRenderer:"Panorama World",sceneryRenderer:"Scenery World",gridRenderer:"Grid World",changeMap:"Change Map",nextSong:"Next Song",inspiredBy:t=>yt.jsxs(yt.Fragment,{children:["Inspired by ",t("Tetris Effect")]}),sourceCode:"Source Code"};function Kve({score:t,nextShapes:e}){const[r]=Qve();return yt.jsxs("div",{className:"p-2 overflow-hidden",children:[yt.jsxs("span",{className:"text-4xl",children:[qs.score,yt.jsx("span",{className:t>r?"text-red-500":void 0,children:t})]}),yt.jsx("br",{}),yt.jsx("span",{className:"pt-2 text-4xl font-mono",children:e.map((i,n)=>yt.jsx("span",{style:{color:Yve(vI[i].color),colorScheme:"white only"},children:i},n))})]})}function sze({board:t,score:e,nextShapes:r}){return yt.jsxs("div",{className:"grid grid-cols-4",style:{width:"100vmin",height:"100vmin"},children:[yt.jsx("span",{}),yt.jsx(oze,{board:t}),yt.jsx(Kve,{score:e,nextShapes:r})]})}function oze({board:t}){return yt.jsx("div",{className:"bg-gradient-to-tr from-yellow-400 to-purple-400 col-span-2 p-2",children:yt.jsx("div",{className:"h-full grid grid-cols-10 gap-0.5",children:t.map((e,r)=>yt.jsx(Si.Fragment,{children:e.map((i,n)=>yt.jsx("div",{style:{backgroundColor:Yve(vI[i].color)}},n))},r))})})}const aze="modulepreload",lze=function(t){return"/tetris-react/"+t},Ioe={},ge=function(e,r,i){let n=Promise.resolve();if(r&&r.length>0){const s=document.getElementsByTagName("link");n=Promise.all(r.map(o=>{if(o=lze(o),o in Ioe)return;Ioe[o]=!0;const a=o.endsWith(".css"),l=a?'[rel="stylesheet"]':"";if(!!i)for(let h=s.length-1;h>=0;h--){const p=s[h];if(p.href===o&&(!a||p.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${o}"]${l}`))return;const u=document.createElement("link");if(u.rel=a?"stylesheet":aze,a||(u.as="script",u.crossOrigin=""),u.href=o,document.head.appendChild(u),a)return new Promise((h,p)=>{u.addEventListener("load",h),u.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${o}`)))})}))}return n.then(()=>e()).catch(s=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=s,window.dispatchEvent(o),!o.defaultPrevented)throw s})};function d(t,e,r,i){var n,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(s<3?n(o):s>3?n(e,r,o):n(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o}function b4t(t,e){return function(r,i){e(r,i,t)}}function w4t(t,e,r,i){function n(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function a(u){try{c(i.next(u))}catch(h){o(h)}}function l(u){try{c(i.throw(u))}catch(h){o(h)}}function c(u){u.done?s(u.value):n(u.value).then(a,l)}c((i=i.apply(t,e||[])).next())})}let m1;function se(t){return typeof m1[t]=="function"?m1[t]=m1[t](globalThis):m1[t]}var P_e,A_e,M_e,O_e;m1=(P_e=globalThis.dojoConfig)!=null&&P_e.has||(A_e=globalThis.esriConfig)!=null&&A_e.has?{...(M_e=globalThis.dojoConfig)==null?void 0:M_e.has,...(O_e=globalThis.esriConfig)==null?void 0:O_e.has}:{},se.add=(t,e,r,i)=>((i||m1[t]===void 0)&&(m1[t]=e),r&&se(t)),se.cache=m1,se.add("big-integer-warning-enabled",!0),se.add("esri-deprecation-warnings",!0),se.add("esri-tests-disable-screenshots",!1),se.add("esri-tests-use-full-window",!1),se.add("esri-tests-post-to-influx",!0),(()=>{var e;se.add("host-webworker",globalThis.WorkerGlobalScope!==void 0&&self instanceof globalThis.WorkerGlobalScope);const t=typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document;if(se.add("host-browser",t),se.add("host-node",typeof globalThis.process=="object"&&((e=globalThis.process.versions)==null?void 0:e.node)&&globalThis.process.versions.v8),se.add("dom",t),se("host-browser")){const r=navigator,i=r.userAgent,n=r.appVersion,s=parseFloat(n);if(se.add("wp",parseFloat(i.split("Windows Phone")[1])||void 0),se.add("msapp",parseFloat(i.split("MSAppHost/")[1])||void 0),se.add("khtml",n.includes("Konqueror")?s:void 0),se.add("edge",parseFloat(i.split("Edge/")[1])||void 0),se.add("opr",parseFloat(i.split("OPR/")[1])||void 0),se.add("webkit",!se("wp")&&!se("edge")&&parseFloat(i.split("WebKit/")[1])||void 0),se.add("chrome",!se("edge")&&!se("opr")&&parseFloat(i.split("Chrome/")[1])||void 0),se.add("android",!se("wp")&&parseFloat(i.split("Android ")[1])||void 0),se.add("safari",!n.includes("Safari")||se("wp")||se("chrome")||se("android")||se("edge")||se("opr")?void 0:parseFloat(n.split("Version/")[1])),se.add("mac",n.includes("Macintosh")),!se("wp")&&/(iPhone|iPod|iPad)/.test(i)){const o=RegExp.$1.replace(/P/,"p"),a=/OS ([\d_]+)/.test(i)?RegExp.$1:"1",l=parseFloat(a.replace(/_/,".").replaceAll("_",""));se.add(o,l),se.add("ios",l)}se("webkit")||(!i.includes("Gecko")||se("wp")||se("khtml")||se("edge")||se.add("mozilla",s),se("mozilla")&&se.add("ff",parseFloat(i.split("Firefox/")[1]||i.split("Minefield/")[1])||void 0))}})(),(()=>{if(globalThis.navigator){const t=navigator.userAgent,e=/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i.test(t),r=/iPhone/i.test(t);e&&se.add("esri-mobile",e),r&&se.add("esri-iPhone",r),se.add("esri-geolocation",!!navigator.geolocation)}se.add("esri-wasm","WebAssembly"in globalThis),se.add("esri-performance-mode-frames-between-render",20),se.add("esri-force-performance-mode",!1),se.add("esri-shared-array-buffer",()=>{const t="SharedArrayBuffer"in globalThis,e=globalThis.crossOriginIsolated===!1;return t&&!e}),se.add("wasm-simd",()=>{const t=[0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11];return WebAssembly.validate(new Uint8Array(t))}),se.add("esri-atomics","Atomics"in globalThis),se.add("esri-workers","Worker"in globalThis),se.add("web-feat:cache","caches"in globalThis),se.add("esri-workers-arraybuffer-transfer",!se("safari")||Number(se("safari"))>=12),se.add("workers-pool-size",8),se.add("featurelayer-simplify-thresholds",[.5,.5,.5,.5]),se.add("featurelayer-simplify-payload-size-factors",[1,1,4]),se.add("featurelayer-fast-triangulation-enabled",!0),se.add("featurelayer-animation-enabled",!0),se.add("featurelayer-snapshot-enabled",!0),se.add("featurelayer-snapshot-point-min-threshold",8e4),se.add("featurelayer-snapshot-point-max-threshold",4e5),se.add("featurelayer-snapshot-point-coverage",.1),se.add("featurelayer-query-max-depth",4),se.add("featurelayer-query-pausing-enabled",!1),se.add("hittest-2d-mobile-tolerance",3),se.add("hittest-2d-desktop-tolerance",1),se.add("hittest-2d-small-symbol-tolerance",3),se.add("hittest-2d-small-symbol-tolerance-threshold",3),se.add("featurelayer-advanced-symbols",!1),se.add("featurelayer-pbf",!0),se.add("featurelayer-pbf-statistics",!1),se.add("feature-layers-workers",!0),se.add("feature-polyline-generalization-factor",1),se.add("mapview-transitions-duration",200),se.add("mapview-srswitch-adjust-rotation-scale-threshold",24e6),se.add("mapserver-pbf-version-support",10.81),se.add("mapservice-popup-identify-max-tolerance",20),se("host-webworker")||se("host-browser")&&(se.add("esri-csp-restrictions",()=>{try{new Function}catch{return!0}return!1}),se.add("esri-image-decode",()=>{if("decode"in new Image){const t=new Image;return t.src='data:image/svg+xml;charset=UTF-8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg"></svg>',void t.decode().then(()=>{se.add("esri-image-decode",!0,!0,!0)}).catch(()=>{se.add("esri-image-decode",!1,!0,!0)})}return!1}),se.add("esri-url-encodes-apostrophe",()=>{const t=window.document.createElement("a");return t.href="?'",t.href.includes("?%27")}))})();let wx=class Ub{constructor(e=1){this._seed=e}set seed(e){this._seed=e??Math.random()*Ub._m}getInt(){return this._seed=(Ub._a*this._seed+Ub._c)%Ub._m,this._seed}getFloat(){return this.getInt()/(Ub._m-1)}getIntRange(e,r){return Math.round(this.getFloatRange(e,r))}getFloatRange(e,r){const i=r-e;return e+this.getInt()/Ub._m*i}};wx._m=2147483647,wx._a=48271,wx._c=0;const Ez=1.5,cze=1/Ez,uze=.5;function x4t(t,e){for(let r=t.length-1;r>=0;r--){const i=t[r];if(e(i))return i}}function Pz(t,e){return e?t.filter((r,i,n)=>n.findIndex(e.bind(null,r))===i):Array.from(new Set(t))}function tg(t,e,r){if(t==null&&e==null)return!0;if(t==null||e==null||t.length!==e.length)return!1;if(r){for(let i=0;i<t.length;i++)if(!r(t[i],e[i]))return!1}else for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}function ebe(t,e){let r=t.length!==e.length;r&&(t.length=e.length);for(let i=0;i<e.length;++i)t[i]!==e[i]&&(t[i]=e[i],r=!0);return r}function BH(t,e,r){let i,n;return r?(i=e.filter(s=>!t.some(o=>r(o,s))),n=t.filter(s=>!e.some(o=>r(o,s)))):(i=e.filter(s=>!t.includes(s)),n=t.filter(s=>!e.includes(s))),{added:i,removed:n}}function hze(t){return t&&typeof t.length=="number"}function T4t(t,e){const r=t.length;if(r===0)return[];const i=[];for(let n=0;n<r;n+=e)i.push(t.slice(n,n+e));return i}const dze=!!Array.prototype.fill;function S4t(t,e){if(dze)return new Array(t).fill(e);const r=new Array(t);for(let i=0;i<t;i++)r[i]=e;return r}function pze(t,e){e===void 0&&(e=t,t=0);const r=new Array(e-t);for(let i=t;i<e;i++)r[i-t]=i;return r}function fze(t,e,r){const i=t.length;let n=0,s=i-1;for(;n<s;){const a=n+Math.floor((s-n)/2);e>t[a]?n=a+1:s=a}const o=t[n];return r?e>=t[i-1]?-1:o===e?n:n-1:o===e?n:-1}let tbe=class{constructor(){this.last=0}};const rbe=new tbe;function VH(t,e,r,i){i=i||rbe;const n=Math.max(0,i.last-10);for(let o=n;o<r;++o)if(t[o]===e)return i.last=o,o;const s=Math.min(n,r);for(let o=0;o<s;++o)if(t[o]===e)return i.last=o,o;return-1}function t$(t,e,r,i){const n=r??t.length,s=VH(t,e,n,i);if(s!==-1)return t[s]=t[n-1],r==null&&t.pop(),e}const Od=new Set;function mze(t,e,r=t.length,i=e.length,n,s){if(i===0||r===0)return r;Od.clear();for(let a=0;a<i;++a)Od.add(e[a]);n=n||rbe;const o=Math.max(0,n.last-10);for(let a=o;a<r;++a)if(Od.has(t[a])&&(s==null||s.push(t[a]),Od.delete(t[a]),t[a]=t[r-1],--r,--a,Od.size===0||r===0))return Od.clear(),r;for(let a=0;a<o;++a)if(Od.has(t[a])&&(s==null||s.push(t[a]),Od.delete(t[a]),t[a]=t[r-1],--r,--a,Od.size===0||r===0))return Od.clear(),r;return Od.clear(),r}function gze(t,e){let r=0;for(let i=0;i<t.length;++i){const n=t[i];e(n,i)&&(t[r]=n,r++)}t.length=r}function yze(t){return t?(Loe.seed=t,()=>Loe.getFloat()):Math.random}function E4t(t,e){const r=yze(e);for(let i=t.length-1;i>0;i--){const n=Math.floor(r()*(i+1)),s=t[i];t[i]=t[n],t[n]=s}return t}const Loe=new wx;function _K(t,e){const r=t.indexOf(e);return r!==-1?(t.splice(r,1),e):null}function P4t(t,e){const r=new Map,i=t.length;for(let n=0;n<i;n++){const s=t[n],o=e(s,n,t),a=r.get(o);a?a.push(s):r.set(o,[s])}return r}function P3(t,e){return t!=null}const _ze=[];function ibe(t){return 32+t.length}function vK(){return 16}function nbe(t){if(!t)return 0;let e=abe;for(const r in t)if(t.hasOwnProperty(r)){const i=t[r];switch(typeof i){case"string":e+=ibe(i);break;case"number":e+=vK();break;case"boolean":e+=4}}return e}function sbe(t){if(!t)return 0;if(Array.isArray(t))return vze(t);let e=abe;for(const r in t)t.hasOwnProperty(r)&&(e+=obe(t[r]));return e}function vze(t){const e=t.length;if(e===0||typeof t[0]=="number")return 32+8*e;let r=lbe;for(let i=0;i<e;i++)r+=obe(t[i]);return r}function obe(t){switch(typeof t){case"object":return sbe(t);case"string":return ibe(t);case"number":return vK();case"boolean":return 4;default:return 8}}function bze(t,e){return lbe+t.length*e}const abe=32,lbe=16;function OA(t){return t instanceof ArrayBuffer}function bK(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Int8Array"}function g1(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Uint8Array"}function cbe(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Uint8ClampedArray"}function wK(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Int16Array"}function Az(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Uint16Array"}function xK(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Int32Array"}function Mz(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Uint32Array"}function bI(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Float32Array"}function wI(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Float64Array"}function cd(t){return!("buffer"in t)}function K1(...t){return t.reduce((e,r)=>e+(r?cd(r)?bze(r,vK()):r.byteLength+ube:0),0)}const ube=145,Qu=1024;function wze(t){return wI(t)||bI(t)||xK(t)||wK(t)||bK(t)}function xze(t){return wI(t)||bI(t)}function Tze(t){return wI(t)?179769e303:bI(t)?3402823e32:Mz(t)?4294967295:Az(t)?65535:g1(t)||cbe(t)?255:xK(t)?2147483647:wK(t)?32767:bK(t)?127:256}function hbe(t,e){let r;if(e)for(r in t)t.hasOwnProperty(r)&&(t[r]===void 0?delete t[r]:t[r]instanceof Object&&hbe(t[r],!0));else for(r in t)t.hasOwnProperty(r)&&t[r]===void 0&&delete t[r];return t}function _e(t){if(!t||typeof t!="object"||typeof t=="function")return t;const e=fbe(t);if(e!=null)return e;if(Ak(t))return t.clone();if(dbe(t))return t.map(_e);if(pbe(t))return t.clone();const r={};for(const i of Object.getOwnPropertyNames(t))r[i]=_e(t[i]);return r}function GH(t){if(!t||typeof t!="object"||typeof t=="function"||"HTMLElement"in globalThis&&t instanceof HTMLElement)return t;const e=fbe(t);if(e!=null)return e;if(dbe(t)){let r=!0;const i=t.map(n=>{const s=GH(n);return n!=null&&s==null&&(r=!1),s});return r?i:null}if(Ak(t))return t.clone();if(t instanceof File||t instanceof Blob)return t;if(!pbe(t)){const r=new(Object.getPrototypeOf(t)).constructor;for(const i of Object.getOwnPropertyNames(t)){const n=t[i],s=GH(n);if(n!=null&&s==null)return null;r[i]=s}return r}return null}function Ak(t){return typeof t.clone=="function"}function dbe(t){return typeof t.map=="function"&&typeof t.forEach=="function"}function pbe(t){return typeof t.notifyChange=="function"&&typeof t.watch=="function"}function Doe(t){if(Object.prototype.toString.call(t)!=="[object Object]")return!1;const e=Object.getPrototypeOf(t);return e===null||e===Object.prototype}function fbe(t){if(bK(t)||g1(t)||cbe(t)||wK(t)||Az(t)||xK(t)||Mz(t)||bI(t)||wI(t))return t.slice();if(t instanceof Date)return new Date(t.getTime());if(t instanceof ArrayBuffer)return t.slice(0,t.byteLength);if(t instanceof Map){const e=new Map;for(const[r,i]of t)e.set(r,_e(i));return e}if(t instanceof Set){const e=new Set;for(const r of t)e.add(_e(r));return e}return null}function TK(t,e){return t===e||typeof t=="number"&&isNaN(t)&&typeof e=="number"&&isNaN(e)||typeof(t==null?void 0:t.getTime)=="function"&&typeof(e==null?void 0:e.getTime)=="function"&&t.getTime()===e.getTime()||!1}function mbe(t,e){return t===e||(t==null||typeof t=="string"?t===e:typeof t=="number"?t===e||typeof e=="number"&&isNaN(t)&&isNaN(e):t instanceof Date?e instanceof Date&&t.getTime()===e.getTime():Array.isArray(t)?Array.isArray(e)&&tg(t,e):t instanceof Set?e instanceof Set&&Cze(t,e):t instanceof Map?e instanceof Map&&Eze(t,e):!!Doe(t)&&Doe(e)&&Sze(t,e))}function Sze(t,e){if(t===null||e===null)return!1;const r=Object.keys(t);if(e===null||Object.keys(e).length!==r.length)return!1;for(const i of r)if(t[i]!==e[i]||!Object.prototype.hasOwnProperty.call(e,i))return!1;return!0}function Cze(t,e){if(t.size!==e.size)return!1;for(const r of t)if(!e.has(r))return!1;return!0}function Eze(t,e){if(t.size!==e.size)return!1;for(const[r,i]of t){const n=e.get(r);if(n!==i||n===void 0&&!e.has(r))return!1}return!0}function gbe(t,e,r=!1){return _be(t,e,r)}function Oz(t,e){if(e!=null)return e[t]||ybe(t.split("."),!1,e)}function E2(t,e,r){const i=t.split("."),n=i.pop(),s=ybe(i,!0,r);s&&n&&(s[n]=e)}function ybe(t,e,r){let i=r;for(const n of t){if(i==null)return;if(!(n in i)){if(!e)return;i[n]={}}i=i[n]}return i}function _be(t,e,r){return e?Object.keys(e).reduce((i,n)=>{let s=i[n],o=e[n];return s===o?i:s===void 0?(i[n]=_e(o),i):(Array.isArray(o)||Array.isArray(i)?(s=s?Array.isArray(s)?i[n]=s.concat():i[n]=[s]:i[n]=[],o&&(Array.isArray(o)||(o=[o]),r?o.forEach(a=>{s.includes(a)||s.push(a)}):i[n]=o.concat())):o&&typeof o=="object"?i[n]=_be(s,o,r):i.hasOwnProperty(n)&&!e.hasOwnProperty(n)||(i[n]=o),i)},t||{}):t}var R_e;const mi={apiKey:void 0,applicationName:"",applicationUrl:(R_e=globalThis.location)==null?void 0:R_e.href,assetsPath:"",fontsUrl:"https://static.arcgis.com/fonts",geometryServiceUrl:"https://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",geoRSSServiceUrl:"https://utility.arcgis.com/sharing/rss",kmlServiceUrl:"https://utility.arcgis.com/sharing/kml",userPrivilegesApplied:!0,portalUrl:"https://www.arcgis.com",routeServiceUrl:"https://route-api.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",workers:{loaderConfig:{has:{},paths:{},map:{},packages:[]}},request:{crossOriginNoCorsDomains:null,httpsDomains:["arcgis.com","arcgisonline.com","esrikr.com","premiumservices.blackbridge.com","esripremium.accuweather.com","gbm.digitalglobe.com","firstlook.digitalglobe.com","msi.digitalglobe.com"],interceptors:[],maxUrlLength:2e3,priority:"high",proxyRules:[],proxyUrl:null,timeout:6e4,trustedServers:[],useIdentity:!0},log:{interceptors:[],level:null}};if(globalThis.esriConfig&&(gbe(mi,globalThis.esriConfig,!0),delete mi.has),!mi.assetsPath){{const t="4.29";mi.assetsPath=`https://js.arcgis.com/${t}/@arcgis/core/assets`}mi.defaultAssetsPath=mi.assetsPath}const Pze=/\{([^\}]+)\}/g;function Noe(t){return t??""}function SK(t,e){return e?t.replaceAll(Pze,typeof e=="object"?(r,i)=>Noe(Oz(i,e)):(r,i)=>Noe(e(i))):t}function A4t(t,e){return t.replaceAll(/([\.$?*|{}\(\)\[\]\\\/\+\-^])/g,r=>e&&e.includes(r)?r:`\\${r}`)}function CK(t){let e=0;for(let r=0;r<t.length;r++)e=(e<<5)-e+t.charCodeAt(r),e|=0;return e}function M4t(t){return new DOMParser().parseFromString(t||"","text/html").body.innerText||""}function O4t(t,e){return new RegExp(`{${e}}`,"ig").test(t)}const Foe={info:0,warn:1,error:2,none:3};let re=class Ka{constructor(e){this.level=null,this._module="",this._parent=null,this.writer=null,this._loggedMessages={error:new Map,warn:new Map,info:new Map},e.level!=null&&(this.level=e.level),e.writer!=null&&(this.writer=e.writer),this._module=e.module,Ka._loggers.set(this.module,this);const r=this.module.lastIndexOf(".");r!==-1&&(this._parent=Ka.getLogger(this.module.slice(0,r)))}get module(){return this._module}get parent(){return this._parent}error(...e){this._log("error","always",...e)}warn(...e){this._log("warn","always",...e)}info(...e){this._log("info","always",...e)}errorOnce(...e){this._log("error","once",...e)}warnOnce(...e){this._log("warn","once",...e)}infoOnce(...e){this._log("info","once",...e)}errorOncePerTick(...e){this._log("error","oncePerTick",...e)}warnOncePerTick(...e){this._log("warn","oncePerTick",...e)}infoOncePerTick(...e){this._log("info","oncePerTick",...e)}get test(){const e=this;return{loggedMessages:e._loggedMessages,clearLoggedWarnings:()=>e._loggedMessages.warn.clear()}}static get test(){return{resetLoggers(e=new Map){const r=Ka._loggers;return Ka._loggers=e,r},set throttlingDisabled(e){Ka._throttlingDisabled=e}}}static getLogger(e){return e=typeof e!="string"?e.declaredClass:e,Ka._loggers.get(e)||new Ka({module:e})}_log(e,r,...i){if(this._matchLevel(e)){if(r!=="always"&&!Ka._throttlingDisabled){const n=this._argsToKey(i),s=this._loggedMessages[e].get(n);if(r==="once"&&s!=null||r==="oncePerTick"&&s&&s>=Ka._tickCounter)return;this._loggedMessages[e].set(n,Ka._tickCounter),Ka._scheduleTickCounterIncrement()}for(const n of mi.log.interceptors)if(n(e,this.module,...i))return;this._inheritedWriter()(e,this.module,...i)}}_parentWithMember(e,r){let i=this;for(;i!=null;){const n=i[e];if(n!=null)return n;i=i.parent}return r}_inheritedWriter(){return this._parentWithMember("writer",this._consoleWriter)}_consoleWriter(e,r,...i){console[e](`[${r}]`,...i)}_matchLevel(e){const r=mi.log.level||"warn";return Foe[this._parentWithMember("level",r)]<=Foe[e]}_argsToKey(...e){return CK(JSON.stringify(e,(i,n)=>typeof n!="object"||Array.isArray(n)?n:"[Object]"))}static _scheduleTickCounterIncrement(){Ka._tickCounterScheduled||(Ka._tickCounterScheduled=!0,Promise.resolve().then(()=>{Ka._tickCounter++,Ka._tickCounterScheduled=!1}))}};re._loggers=new Map,re._tickCounter=0,re._tickCounterScheduled=!1,re._throttlingDisabled=!1;function Aze(t,e){return t.replaceAll(/\$\{([^\s\:\}]*)(?:\:([^\s\:\}]+))?\}/g,(r,i)=>i===""?"$":(Oz(i,e)??"").toString())}let vbe=class{constructor(e,r,i){this.name=e,this.details=i,this.message=(r&&Aze(r,i))??""}toString(){return"["+this.name+"]: "+this.message}},K=class bbe extends vbe{constructor(e,r,i){super(e,r,i)}toJSON(){if(this.details!=null)try{return{name:this.name,message:this.message,details:JSON.parse(JSON.stringify(this.details,(e,r)=>{if(r&&typeof r=="object"&&typeof r.toJSON=="function")return r;try{return _e(r)}catch{return"[object]"}}))}}catch(e){throw re.getLogger("esri.core.Error").error(e),e}return{name:this.name,message:this.message,details:this.details}}static fromJSON(e){return new bbe(e.name,e.message,e.details)}};K.prototype.type="error";const koe=new WeakMap;function Mze(t,e,r=!1){const i=`🛑 DEPRECATED - ${e}`;if(!r)return void t.warn(i);let n=koe.get(t);n||(n=new Set,koe.set(t,n)),n.has(e)||(n.add(e),t.warn(i))}function EK(t,e,r={}){if(se("esri-deprecation-warnings")){const{moduleName:i}=r;ev(t,`Function: ${(i?i+"::":"")+e+"()"}`,r)}}function y1(t,e,r={}){if(se("esri-deprecation-warnings")){const{moduleName:i}=r;ev(t,`Property: ${(i?i+"::":"")+e}`,r)}}function ev(t,e,r={}){if(se("esri-deprecation-warnings")){const{replacement:i,version:n,see:s,warnOnce:o}=r;let a=e;i&&(a+=`
	🛠️ Replacement: ${i}`),n&&(a+=`
	⚙️ Version: ${n}`),s&&(a+=`
	🔗 See ${s} for more details.`),Mze(t,a,o)}}function $4t(t){const e=[];return function*(){yield*e;for(const r of t)e.push(r),yield r}}function Oze(t,e){for(const r of t)if(r!=null&&e(r))return r}function jH(t){return t!=null&&typeof t[Symbol.iterator]=="function"}let $v=class HH{constructor(){this._groups=new Map}destroy(){this.removeAll()}get size(){let e=0;return this._groups.forEach(r=>{e+=r.length}),e}add(e,r){if(jH(e)){const i=this._getOrCreateGroup(r);for(const n of e)this._isHandle(n)&&i.push(n)}else this._isHandle(e)&&this._getOrCreateGroup(r).push(e);return this}forEach(e,r){if(typeof e=="function")this._groups.forEach(i=>i.forEach(e));else{const i=this._getGroup(e);i&&r&&i.forEach(r)}}has(e){return this._groups.has(this._ensureGroupKey(e))}remove(e){if(typeof e!="string"&&jH(e)){for(const r of e)this.remove(r);return this}return this.has(e)?(this._removeAllFromGroup(this._getGroup(e)),this._groups.delete(this._ensureGroupKey(e)),this):this}removeAll(){return this._groups.forEach(e=>this._removeAllFromGroup(e)),this._groups.clear(),this}_isHandle(e){return e&&(!!e.remove||e instanceof HH)}_getOrCreateGroup(e){if(this.has(e))return this._getGroup(e);const r=[];return this._groups.set(this._ensureGroupKey(e),r),r}_getGroup(e){return this._groups.get(this._ensureGroupKey(e))}_ensureGroupKey(e){return e||"_default_"}_removeAllFromGroup(e){for(const r of e)r instanceof HH?r.removeAll():r.remove()}};function Rz(t,e){if(t==null)throw new Error(e??"value is None")}function Pe(t){return t==null||t.destroy(),null}function gt(t){return t==null||t.dispose(),null}function wi(t){return t==null||t.remove(),null}function wl(t){return t==null||t.abort(),null}function tr(t){return t==null||t.release(),null}function Rze(t,e,r){return t!=null&&e!=null?r!=null?r(t,e):t.equals(e):t===e}function zoe(t,e){return t==null?void 0:t[e]}function $ze(t,e){let r;return t.some((i,n)=>(r=e(i,n),r!=null)),r??void 0}const wbe=Symbol("Accessor-beforeDestroy"),Ize={remove:()=>{}};function Zr(t){return t?{remove(){t&&(t(),t=void 0)}}:Ize}function Lze(t){t.forEach(e=>e==null?void 0:e.remove())}function Hx(t){return Zr(()=>Lze(t))}function xbe(t){return Zr(t!=null?()=>t.destroy():void 0)}function rg(t){return t.__accessor__??null}function Dze(t,e){var r;return((r=t==null?void 0:t.metadata)==null?void 0:r[e])!=null}function t5(t,e,r){return r?Mk(t,e,{policy:r,path:""}):Mk(t,e,null)}function Mk(t,e,r){return e?Object.keys(e).reduce((i,n)=>{const s=n;let o=null,a="merge";if(r&&(o=r.path?`${r.path}.${n}`:n,a=r.policy(o)),a==="replace"||a==="replace-arrays"&&Array.isArray(i[s]))return i[s]=e[s],i;if(i[s]===void 0)return i[s]=_e(e[s]),i;let l=i[s],c=e[s];if(l===c)return i;if(Array.isArray(c)||Array.isArray(i))l=l?Array.isArray(l)?i[s]=l.concat():i[s]=[l]:i[s]=[],c&&(Array.isArray(c)||(c=[c]),c.forEach(u=>{l.includes(u)||l.push(u)}));else if(c&&typeof c=="object")if(r){const u=r.path;r.path=o,i[s]=Mk(l,c,r),r.path=u}else i[s]=Mk(l,c,null);else i.hasOwnProperty(n)&&!e.hasOwnProperty(n)||(i[s]=c);return i},t||{}):t}function Tbe(t){return Array.isArray(t)?t:t.split(".")}function Uoe(t){return t.includes(",")?t.split(",").map(e=>e.trim()):[t.trim()]}function Nze(t){if(Array.isArray(t)){const e=[];for(const r of t)e.push(...Uoe(r));return e}return Uoe(t)}function Sbe(t,e,r,i){const n=Nze(e);if(n.length!==1){const s=n.map(o=>i(t,o,r));return Hx(s)}return i(t,n[0],r)}function Cbe(t,e){const r=t[t.length-1]==="?"?t.slice(0,-1):t;if(e.getItemAt!=null||Array.isArray(e)){const n=parseInt(r,10);if(!isNaN(n))return Array.isArray(e)?e[n]:e.at(n)}const i=rg(e);return Dze(i,r)?i.get(r):e[r]}function Ebe(t,e,r){if(t==null)return t;const i=Cbe(e[r],t);return!i&&r<e.length-1?void 0:r===e.length-1?i:Ebe(i,e,r+1)}function xI(t,e,r=0){return typeof e!="string"||e.includes(".")?Ebe(t,Tbe(e),r):Cbe(e,t)}function Gm(t,e){return xI(t,e)}function Boe(t,e){return xI(e,t)!==void 0}var Lc;(function(t){t[t.INITIALIZING=0]="INITIALIZING",t[t.CONSTRUCTING=1]="CONSTRUCTING",t[t.CONSTRUCTED=2]="CONSTRUCTED",t[t.DESTROYED=3]="DESTROYED"})(Lc||(Lc={}));function TI(t){let e=t.constructor.__accessorMetadata__;const r=Object.prototype.hasOwnProperty.call(t.constructor,"__accessorMetadata__");if(e){if(!r){e=Object.create(e);for(const i in e)e[i]=_e(e[i]);Object.defineProperty(t.constructor,"__accessorMetadata__",{value:e,enumerable:!1,configurable:!0,writable:!0})}}else e={},Object.defineProperty(t.constructor,"__accessorMetadata__",{value:e,enumerable:!1,configurable:!0,writable:!0});return t.constructor.__accessorMetadata__}function $z(t,e){const r=TI(t);let i=r[e];return i||(i=r[e]={}),i}function Fze(t,e){return t5(t,e,zze)}const kze=/^(?:[^.]+\.)?(?:value|type|(?:json\.type|json\.origins\.[^.]\.type))$/;function zze(t){return kze.test(t)?"replace":"merge"}function Uze(t){return(t==null?void 0:t.release)&&typeof t.release=="function"}function Bze(t){return(t==null?void 0:t.acquire)&&typeof t.acquire=="function"}let ua=class WH{constructor(e,r,i,n=1,s=0){if(this._ctor=e,this._acquireFunction=r,this._releaseFunction=i,this.allocationSize=n,this._pool=new Array(s),this._initialSize=s,this._ctor)for(let o=0;o<s;o++)this._pool[o]=new this._ctor;this.allocationSize=Math.max(n,1)}destroy(){this.prune(0)}acquire(...e){let r;if(WH.test.disabled)r=new this._ctor;else{if(this._pool.length===0){const i=this.allocationSize;for(let n=0;n<i;n++)this._pool[n]=new this._ctor}r=this._pool.pop()}return this._acquireFunction?this._acquireFunction(r,...e):Bze(r)&&r.acquire(...e),r}release(e){e&&!WH.test.disabled&&(this._releaseFunction?this._releaseFunction(e):Uze(e)&&e.release(),this._pool.push(e))}prune(e=this._initialSize){if(!(e>=this._pool.length)){for(let r=e;r<this._pool.length;++r){const i=this._pool[r];this._dispose(i)}this._pool.length=e}}_dispose(e){e.dispose&&typeof e.dispose=="function"&&e.dispose()}};ua.test={disabled:!1};let Vze=class{constructor(e,r){this._observers=e,this._observer=r}remove(){_K(this._observers,this._observer)}},Pbe=class{constructor(){this._observers=null,this.destroyed=!1}observe(e){if(this.destroyed||e.destroyed)return Gze;this._observers==null&&(this._observers=[]);const r=this._observers;let i=!1,n=!1;const s=r.length;for(let o=0;o<s;++o){const a=r[o];if(a.destroyed)n=!0;else if(a===e){i=!0;break}}return i||(r.push(e),n&&this._removeDestroyedObservers()),new Vze(r,e)}_removeDestroyedObservers(){const e=this._observers;if(!e||e.length===0)return;const r=e.length;let i=0;for(let n=0;n<r;++n){for(;n+i<r&&e[n+i].destroyed;)++i;if(i>0){if(!(n+i<r))break;e[n]=e[n+i]}}e.length=r-i}destroy(){if(this.destroyed)return;this.destroyed=!0;const e=this._observers;if(e!=null){for(const r of e)r.onCommitted();this._observers=null}}};const Gze=Zr();var oi;(function(t){t[t.DEFAULTS=0]="DEFAULTS",t[t.COMPUTED=1]="COMPUTED",t[t.SERVICE=2]="SERVICE",t[t.PORTAL_ITEM=3]="PORTAL_ITEM",t[t.WEB_SCENE=4]="WEB_SCENE",t[t.WEB_MAP=5]="WEB_MAP",t[t.LINK_CHART=6]="LINK_CHART",t[t.USER=7]="USER"})(oi||(oi={}));const D4t=oi.USER+1;function Abe(t){switch(t){case"defaults":return oi.DEFAULTS;case"service":return oi.SERVICE;case"portal-item":return oi.PORTAL_ITEM;case"web-scene":return oi.WEB_SCENE;case"web-map":return oi.WEB_MAP;case"link-chart":return oi.LINK_CHART;case"user":return oi.USER;default:return null}}function qH(t){switch(t){case oi.DEFAULTS:return"defaults";case oi.SERVICE:return"service";case oi.PORTAL_ITEM:return"portal-item";case oi.WEB_SCENE:return"web-scene";case oi.WEB_MAP:return"web-map";case oi.LINK_CHART:return"link-chart";case oi.USER:return"user"}}function jze(t){return qH(t)}var Wi;(function(t){t[t.Dirty=1]="Dirty",t[t.Overridden=2]="Overridden",t[t.Computing=4]="Computing",t[t.NonNullable=8]="NonNullable",t[t.HasDefaultValue=16]="HasDefaultValue",t[t.DepTrackingInitialized=32]="DepTrackingInitialized",t[t.AutoTracked=64]="AutoTracked",t[t.ExplicitlyTracking=128]="ExplicitlyTracking"})(Wi||(Wi={}));const Ok={onObservableAccessed:()=>{},onTrackingEnd:()=>{}},RA=[];let UO=Ok;function Lt(t){UO.onObservableAccessed(t)}let r5=!1,i5=!1;function Z0(t,e,r){if(r5)return PK(t,e,r);Mbe(t);const i=e.call(r);return Obe(),i}function Hze(t,e){return Z0(Ok,t,e)}function PK(t,e,r){const i=r5;r5=!0,Mbe(t);let n=null;try{n=e.call(r)}catch(s){i5&&re.getLogger("esri.core.accessorSupport.tracking").error(s)}return Obe(),r5=i,n}function Mbe(t){UO=t,RA.push(t)}function Obe(){const t=RA.length;if(t>1){const e=RA.pop();UO=RA[t-2],e.onTrackingEnd()}else if(t===1){const e=RA.pop();UO=Ok,e.onTrackingEnd()}else UO=Ok}function Rbe(t,e){if(e.flags&Wi.DepTrackingInitialized)return;const r=i5;i5=!1,e.flags&Wi.AutoTracked?PK(e,e.metadata.get,t):$be(t,e),i5=r}const Wze=[];function $be(t,e){e.flags&Wi.ExplicitlyTracking||(e.flags|=Wi.ExplicitlyTracking,PK(e,()=>{const r=e.metadata.dependsOn||Wze;for(const i of r)if(typeof i!="string"||i.includes(".")){const n=Tbe(i);for(let s=0,o=t;s<n.length&&o!=null&&typeof o=="object";++s)o=Voe(o,n[s],s!==n.length-1)}else Voe(t,i,!1)}),e.flags&=~Wi.ExplicitlyTracking)}function Voe(t,e,r){const i=e[e.length-1]==="?"?e.slice(0,-1):e;if(t.getItemAt!=null||Array.isArray(t)){const s=parseInt(i,10);if(!isNaN(s))return Array.isArray(t)?t[s]:t.at(s)}const n=rg(t);if(n){const s=n.propertiesByName.get(i);s&&(Lt(s),Rbe(t,s))}return r?t[i]:void 0}let Goe=class extends Pbe{constructor(e,r){super(),this.propertyName=e,this.metadata=r,this._accessed=null,this._handles=null,this.flags=0,this.flags=Wi.Dirty|(r.nonNullable?Wi.NonNullable:0)|(r.hasOwnProperty("value")?Wi.HasDefaultValue:0)|(r.get===void 0?Wi.DepTrackingInitialized:0)|(r.dependsOn===void 0?Wi.AutoTracked:0)}destroy(){this.flags&Wi.Dirty&&this.onCommitted(),super.destroy(),this._accessed=null,this._clearObservationHandles()}getComputed(e){Lt(this);const r=e.store,i=this.propertyName,n=this.flags,s=r.get(i);if(n&Wi.Computing||~n&Wi.Dirty&&r.has(i))return s;this.flags|=Wi.Computing;const o=e.host;let a;n&Wi.AutoTracked?a=Z0(this,this.metadata.get,o):($be(o,this),a=this.metadata.get.call(o)),r.set(i,a,oi.COMPUTED);const l=r.get(i);return l===s?this.flags&=~Wi.Dirty:Hze(this.commit,this),this.flags&=~Wi.Computing,l}onObservableAccessed(e){if(e===this)return;let r=this._accessed;if(r==null)r=[],this._accessed=r;else if(r.includes(e))return;r.push(e)}onTrackingEnd(){this._clearObservationHandles(),this.flags|=Wi.DepTrackingInitialized;const e=this._accessed;if(e==null||e.length===0)return;let r=this._handles;r==null&&(r=[],this._handles=r);for(let i=0;i<e.length;++i)r.push(e[i].observe(this));e.length=0}notifyChange(){this.onInvalidated(),this.onCommitted()}invalidate(){this.onInvalidated()}commit(){this.flags&=~Wi.Dirty,this.onCommitted()}_clearObservationHandles(){const e=this._handles;if(e!==null){for(let r=0;r<e.length;++r)e[r].remove();e.length=0}}onInvalidated(){~this.flags&Wi.Overridden&&(this.flags|=Wi.Dirty);const e=this._observers;if(e&&e.length>0)for(const r of e)r.onInvalidated()}onCommitted(){const e=this._observers;if(e&&e.length>0){const r=e.slice();for(const i of r)i.onCommitted()}}},qze=class Ibe{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const r=new Ibe;return this._values.forEach((i,n)=>{e&&e.has(n)||r.set(n,_e(i))}),r}get(e){return this._values.get(e)}originOf(){return oi.USER}keys(){return[...this._values.keys()]}set(e,r){this._values.set(e,r)}delete(e){this._values.delete(e)}has(e){return this._values.has(e)}forEach(e){this._values.forEach(e)}};function BL(t,e,r){return t!==void 0}function joe(t,e,r,i){return t!==void 0&&(!(r==null&&t.flags&Wi.NonNullable)||(i.lifecycle,Lc.INITIALIZING,!1))}let Yze=class{constructor(e){this.host=e,this.propertiesByName=new Map,this.ctorArgs=null,this.lifecycle=Lc.INITIALIZING,this.store=new qze,this._origin=oi.USER;const r=this.host.constructor.__accessorMetadata__;for(const i in r){const n=new Goe(i,r[i]);this.propertiesByName.set(i,n)}this.metadata=r}initialize(){this.lifecycle=Lc.CONSTRUCTING}constructed(){this.lifecycle=Lc.CONSTRUCTED}destroy(){this.lifecycle=Lc.DESTROYED,this.propertiesByName.forEach(e=>e.destroy())}get initialized(){return this.lifecycle!==Lc.INITIALIZING}get(e){const r=this.propertiesByName.get(e);if(r.metadata.get)return r.getComputed(this);Lt(r);const i=this.store;return i.has(e)?i.get(e):r.metadata.value}originOf(e){const r=this.store.originOf(e);if(r===void 0){const i=this.propertiesByName.get(e);if(i!==void 0&&i.flags&Wi.HasDefaultValue)return"defaults"}return qH(r)}has(e){return this.propertiesByName.has(e)&&this.store.has(e)}keys(){return[...this.propertiesByName.keys()]}internalGet(e){const r=this.propertiesByName.get(e);if(BL(r))return this.store.has(e)?this.store.get(e):r.metadata.value}internalSet(e,r){const i=this.propertiesByName.get(e);BL(i)&&this._internalSet(i,r)}getDependsInfo(e,r,i){const n=this.propertiesByName.get(r);if(!BL(n))return"";const s=new Set,o=Z0({onObservableAccessed:l=>s.add(l),onTrackingEnd:()=>{}},()=>{var l;return(l=n.metadata.get)==null?void 0:l.call(e)});let a=`${i}${e.declaredClass.split(".").pop()}.${r}: ${o}
`;if(s.size===0)return a;i+="  ";for(const l of s)l instanceof Goe&&(a+=`${i}${l.propertyName}: undefined
`);return a}setAtOrigin(e,r,i){const n=this.propertiesByName.get(e);if(BL(n))return this._setAtOrigin(n,r,i)}isOverridden(e){const r=this.propertiesByName.get(e);return r!==void 0&&!!(r.flags&Wi.Overridden)}clearOverride(e){const r=this.propertiesByName.get(e);r&&r.flags&Wi.Overridden&&(r.flags&=~Wi.Overridden,r.notifyChange())}override(e,r){const i=this.propertiesByName.get(e);if(!joe(i,e,r,this))return;const n=i.metadata.cast;if(n){const s=this._cast(n,r),{valid:o,value:a}=s;if(FB.release(s),!o)return;r=a}i.flags|=Wi.Overridden,this._internalSet(i,r)}set(e,r){const i=this.propertiesByName.get(e);if(!joe(i,e,r,this))return;const n=i.metadata.cast;if(n){const o=this._cast(n,r),{valid:a,value:l}=o;if(FB.release(o),!a)return;r=l}const s=i.metadata.set;s?s.call(this.host,r):this._internalSet(i,r)}setDefaultOrigin(e){this._origin=Abe(e)}getDefaultOrigin(){return qH(this._origin)}notifyChange(e){const r=this.propertiesByName.get(e);r!==void 0&&r.notifyChange()}invalidate(e){const r=this.propertiesByName.get(e);r!==void 0&&r.invalidate()}commit(e){const r=this.propertiesByName.get(e);r!==void 0&&r.commit()}_internalSet(e,r){const i=this.lifecycle!==Lc.INITIALIZING?this._origin:oi.DEFAULTS;this._setAtOrigin(e,r,i)}_setAtOrigin(e,r,i){const n=this.store,s=e.propertyName;n.has(s,i)&&TK(r,n.get(s))&&~e.flags&Wi.Overridden&&i===n.originOf(s)||(e.invalidate(),n.set(s,r,i),e.commit(),Rbe(this.host,e))}_cast(e,r){const i=FB.acquire();return i.valid=!0,i.value=r,e&&(i.value=e.call(this.host,r,i)),i}},Xze=class{constructor(){this.value=null,this.valid=!0}acquire(){this.valid=!0}release(){this.value=null}};const FB=new ua(Xze);function Rk(t,e,r){if(t&&e)if(typeof e=="object")for(const i of Object.getOwnPropertyNames(e))Rk(t,i,e[i]);else{if(e.includes(".")){const n=e.split("."),s=n.splice(-1,1)[0];return void Rk(Gm(t,n),s,r)}const i=t.__accessor__;i!=null&&Zze(e,i),t[e]=r}}function Zze(t,e){if(se("esri-unknown-property-errors")&&!Jze(t,e))throw new K("set:unknown-property",Qze(t,e))}function Jze(t,e){return e.metadata[t]!=null}function Qze(t,e){return"setting unknown property '"+t+"' on instance of "+e.host.declaredClass}let Kze;function e9e(){return Kze}var Hoe;(function(t){t[t.Ignore=0]="Ignore",t[t.Destroy=1]="Destroy",t[t.ThrowError=2]="ThrowError"})(Hoe||(Hoe={}));function t9e(t){t.length=0}let Dc=class{constructor(e=50,r=50){this._pool=new ua(Array,void 0,t9e,r,e)}acquire(){return this._pool.acquire()}release(e){this._pool.release(e)}prune(){this._pool.prune(0)}static acquire(){return kB.acquire()}static release(e){return kB.release(e)}static prune(){kB.prune()}};const kB=new Dc(100);let Lbe=class extends ua{constructor(){super(...arguments),this._set=new Set}destroy(){super.destroy(),this._set=null}acquire(...e){const r=super.acquire(...e);return this._set.delete(r),r}release(e){e&&!this._set.has(e)&&(super.release(e),this._set.add(e))}_dispose(e){this._set.delete(e),super._dispose(e)}};const VL=[];function SE(t){VL.push(t),VL.length===1&&queueMicrotask(()=>{const e=VL.slice();VL.length=0;for(const r of e)r()})}let A0=class{constructor(e,r=30){this.name=e,this._counter=0,this._samples=new Array(r)}record(e){e!=null&&(this._samples[++this._counter%this._samples.length]=e)}get median(){return this._samples.slice().sort((e,r)=>e-r)[Math.floor(this._samples.length/2)]}get average(){return this._samples.reduce((e,r)=>e+r,0)/this._samples.length}get last(){return this._samples[this._counter%this._samples.length]}};var YH;(function(t){const e=(s,o,a,l)=>{let c=o,u=o;const h=a>>>1,p=s[c-1];for(;u<=h;){u=c<<1,u<a&&l(s[u-1],s[u])<0&&++u;const f=s[u-1];if(l(f,p)<=0)break;s[c-1]=f,c=u}s[c-1]=p},r=(s,o)=>s<o?-1:s>o?1:0;function i(s,o,a,l){o===void 0&&(o=0),a===void 0&&(a=s.length),l===void 0&&(l=r);for(let u=a>>>1;u>o;u--)e(s,u,a,l);const c=o+1;for(let u=a-1;u>o;u--){const h=s[o];s[o]=s[u],s[u]=h,e(s,c,u,l)}}function*n(s,o,a,l){o===void 0&&(o=0),a===void 0&&(a=s.length),l===void 0&&(l=r);for(let u=a>>>1;u>o;u--)e(s,u,a,l),yield;const c=o+1;for(let u=a-1;u>o;u--){const h=s[o];s[o]=s[u],s[u]=h,e(s,c,u,l),yield}}t.sort=i,t.iterableSort=n})(YH||(YH={}));const Woe=YH,r9e=1.5,i9e=1.1;let Vt=class{constructor(e){this.data=[],this._length=0,this._allocator=void 0,this._deallocator=()=>null,this._shrink=()=>{},this._hint=new tbe,e&&(e.initialSize&&(this.data=new Array(e.initialSize)),e.allocator&&(this._allocator=e.allocator),e.deallocator!==void 0&&(this._deallocator=e.deallocator),e.shrink&&(this._shrink=()=>qoe(this)))}toArray(){return this.data.slice(0,this.length)}filter(e){const r=new Array;for(let i=0;i<this._length;i++){const n=this.data[i];e(n)&&r.push(n)}return r}at(e){if((e=Math.trunc(e)||0)<0&&(e+=this._length),!(e<0||e>=this._length))return this.data[e]}includes(e,r){const i=this.data.indexOf(e,r);return i!==-1&&i<this.length}get length(){return this._length}set length(e){if(e>this._length){if(this._allocator){for(;this._length<e;)this.data[this._length++]=this._allocator(this.data[this._length]);return}this._length=e}else{if(this._deallocator)for(let r=e;r<this._length;++r)this.data[r]=this._deallocator(this.data[r]);this._length=e,this._shrink()}}clear(){this.length=0}prune(){this.clear(),this.data=[]}push(e){this.data[this._length++]=e}pushArray(e,r=e.length){for(let i=0;i<r;i++)this.data[this._length++]=e[i]}fill(e,r){for(let i=0;i<r;i++)this.data[this._length++]=e}pushNew(){this._allocator&&(this.data[this.length]=this._allocator(this.data[this.length]));const e=this.data[this._length];return++this._length,e}unshift(e){this.data.unshift(e),this._length++,qoe(this)}pop(){if(this.length===0)return;const e=this.data[this.length-1];return this.length=this.length-1,this._shrink(),e}remove(e){const r=VH(this.data,e,this.length,this._hint);if(r!==-1)return this.data.splice(r,1),this.length=this.length-1,e}removeUnordered(e){return this.removeUnorderedIndex(VH(this.data,e,this.length,this._hint))}removeUnorderedIndex(e){if(!(e>=this.length||e<0))return this.swapElements(e,this.length-1),this.pop()}removeUnorderedMany(e,r=e.length,i){this.length=mze(this.data,e,this.length,r,this._hint,i),this._shrink()}front(){if(this.length!==0)return this.data[0]}back(){if(this.length!==0)return this.data[this.length-1]}swapElements(e,r){if(e>=this.length||r>=this.length||e===r)return;const i=this.data[e];this.data[e]=this.data[r],this.data[r]=i}sort(e){Woe.sort(this.data,0,this.length,e)}iterableSort(e){return Woe.iterableSort(this.data,0,this.length,e)}some(e,r){for(let i=0;i<this.length;++i)if(e.call(r,this.data[i],i,this.data))return!0;return!1}find(e,r){for(let i=0;i<this.length;++i){const n=this.data[i];if(e.call(r,n,i))return n}}filterInPlace(e,r){let i=0;for(let n=0;n<this._length;++n){const s=this.data[n];e.call(r,s,n,this.data)&&(this.data[n]=this.data[i],this.data[i]=s,i++)}if(this._deallocator)for(let n=i;n<this._length;n++)this.data[n]=this._deallocator(this.data[n]);return this._length=i,this._shrink(),this}forAll(e,r){const{data:i,length:n}=this;for(let s=0;s<n;++s)e.call(r,i[s],s,i)}forEach(e,r){this.data.slice(0,this.length).forEach(e,r)}map(e,r){const i=new Array(this.length);for(let n=0;n<this.length;++n)i[n]=e.call(r,this.data[n],n,this.data);return i}reduce(e,r){let i=r;for(let n=0;n<this.length;++n)i=e(i,this.data[n],n,this.data);return i}has(e){const r=this.length,i=this.data;for(let n=0;n<r;++n)if(i[n]===e)return!0;return!1}*[Symbol.iterator](){for(let e=0;e<this.length;e++)yield this.data[e]}};function qoe(t){t.data.length>r9e*t.length&&(t.data.length=Math.floor(t.length*i9e))}function n9e(t){return{setTimeout:(e,r)=>{const i=t.setTimeout(e,r);return Zr(()=>t.clearTimeout(i))}}}const SI=n9e(globalThis);function Iz(t){return s9e(t)||Dbe(t)}function s9e(t){return t!=null&&typeof t=="object"&&"on"in t&&typeof t.on=="function"}function Dbe(t){return t!=null&&typeof t=="object"&&"addEventListener"in t&&typeof t.addEventListener=="function"}function A3(t,e,r){if(!Iz(t))throw new TypeError("target is not a Evented or EventTarget object");return Dbe(t)?o9e(t,e,r):t.on(e,r)}function o9e(t,e,r,i){if(Array.isArray(e)){const n=e.slice();for(const s of n)t.addEventListener(s,r,i);return Zr(()=>{for(const s of n)t.removeEventListener(s,r,i)})}return t.addEventListener(e,r,i),Zr(()=>t.removeEventListener(e,r,i))}function Nbe(t,e,r){if(!Iz(t))throw new TypeError("target is not a Evented or EventTarget object");if("once"in t)return t.once(e,r);const i=A3(t,e,n=>{i.remove(),r.call(t,n)});return i}function dr(t="Aborted"){return new K("AbortError",t)}function vt(t,e="Aborted"){if(Ls(t))throw dr(e)}function Lz(t){return t instanceof AbortSignal?t:t==null?void 0:t.signal}function Ls(t){const e=Lz(t);return e!=null&&e.aborted}function J0(t){if(_s(t))throw t}function Yoe(t){if(!_s(t))throw t}function ca(t,e){const r=Lz(t);if(r!=null){if(!r.aborted)return Nbe(r,"abort",()=>e());e()}}function Dz(t,e){const r=Lz(t);if(r!=null)return vt(r),Nbe(r,"abort",()=>e(dr()))}function AK(t,e){return Lz(e)==null?t:new Promise((r,i)=>{let n=ca(e,()=>i(dr()));const s=()=>{n=wi(n)};t.then(s,s),t.then(r,i)})}function _s(t){return(t==null?void 0:t.name)==="AbortError"}async function r$(t){try{return await t}catch(e){if(!_s(e))throw e;return}}async function G4t(t,e=re.getLogger("esri")){try{return await t}catch(r){_s(r)||e.error(r)}}async function MK(t){if(!t)return;if(typeof t.forEach!="function"){const r=Object.keys(t),i=r.map(o=>t[o]),n=await MK(i),s={};return r.map((o,a)=>s[o]=n[a]),s}const e=t;return Promise.allSettled(e).then(r=>Array.from(e,(i,n)=>{const s=r[n];return s.status==="fulfilled"?{promise:i,value:s.value}:{promise:i,error:s.reason}}))}async function $k(t){return(await Promise.allSettled(t)).filter(e=>e.status==="fulfilled").map(e=>e.value)}async function j4t(t){return(await Promise.allSettled(t)).filter(e=>e.status==="rejected").map(e=>e.reason)}function i$(t,e=void 0,r){const i=new AbortController;return ca(r,()=>i.abort()),new Promise((n,s)=>{let o=setTimeout(()=>{o=0,n(e)},t);ca(i,()=>{o&&(clearTimeout(o),s(dr()))})})}function a9e(t,e){const r=new AbortController,i=setTimeout(()=>r.abort(),e);return ca(t,()=>{r.abort(),clearTimeout(i)}),{...t,signal:r.signal}}function nu(t){return t&&typeof t.then=="function"}function XH(t){return nu(t)?t:Promise.resolve(t)}function Fbe(t,e=-1){let r,i,n,s,o=null;const a=(...l)=>{if(r){i=l,s&&s.reject(dr()),s=ha();const p=s.promise;if(o){const f=o;o=null,f.abort()}return p}if(n=s||ha(),s=null,e>0){const p=new AbortController;r=XH(t(...l,p.signal));const f=r;i$(e).then(()=>{r===f&&(s?p.abort():o=p)})}else r=1,r=XH(t(...l));const c=()=>{const p=i;i=n=r=o=null,p!=null&&a(...p)},u=r,h=n;return u.then(c,c),u.then(h.resolve,h.reject),h.promise};return a}function ha(){let t,e;const r=new Promise((n,s)=>{t=n,e=s}),i=n=>{t(n)};return i.resolve=n=>t(n),i.reject=n=>e(n),i.timeout=(n,s)=>SI.setTimeout(()=>i.reject(s),n),i.promise=r,i}function H4t(t,e){return t.then(e,e)}async function Xoe(t){await Promise.resolve(),vt(t)}function W4t(t){return t}function kbe(t){return 1e3*t}function q4t(t){return t}function OK(t){return .001*t}let l9e=class{constructor(e){this.phases=e,this.paused=!1,this.ticks=-1,this.removed=!1}},c9e=class{constructor(e){this.callback=e,this.isActive=!0}remove(){this.isActive=!1}},ZH=0,JH=0;const gP={time:0,deltaTime:0,elapsedFrameTime:0,frameDuration:0},QH=["prepare","preRender","render","postRender","update","finish"],KH=[],Wx=new Vt;let u9e=class{constructor(e){this._task=e}remove(){this._task.removed=!0}pause(){this._task.paused=!0}resume(){this._task.paused=!1}};function h9e(){xx!=null&&(cancelAnimationFrame(xx),xx=requestAnimationFrame(RK))}const Ik={frameTasks:Wx,willDispatch:!1,clearFrameTasks:d9e,dispatch:Ube,executeFrameTasks:f9e,reschedule:h9e};function M3(t){const e=new c9e(t);return KH.push(e),Ik.willDispatch||(Ik.willDispatch=!0,SE(Ube)),e}function qx(t){const e=new l9e(t);return Wx.push(e),xx==null&&(ZH=performance.now(),xx=requestAnimationFrame(RK)),new u9e(e)}let xx=null;function d9e(t=!1){Wx.forAll(e=>{e.removed=!0}),t&&zbe()}function p9e(t){JH=Math.max(0,t)}function RK(){const t=performance.now();xx=null,xx=Wx.length>0?requestAnimationFrame(RK):null,Ik.executeFrameTasks(t)}function f9e(t){const e=t-ZH;ZH=t;const r=JH>0?JH:1e3/60,i=Math.max(0,e-r);gP.time=t,gP.frameDuration=r-i;for(let n=0;n<QH.length;n++){const s=performance.now(),o=QH[n];Wx.forAll(a=>{var l;a.paused||a.removed||(n===0&&a.ticks++,a.phases[o]&&(gP.elapsedFrameTime=performance.now()-t,gP.deltaTime=a.ticks===0?0:e,(l=a.phases[o])==null||l.call(a,gP)))}),m9e[n].record(performance.now()-s)}zbe(),g9e.record(performance.now()-t)}const GL=new Vt;function zbe(){Wx.forAll(t=>{t.removed&&GL.push(t)}),Wx.removeUnorderedMany(GL.data,GL.length),GL.clear()}function Ube(){for(;KH.length;){const t=KH.shift();t.isActive&&t.callback()}Ik.willDispatch=!1}function J4t(t=1,e){const r=ha(),i=()=>{Ls(e)?r.reject(dr()):t===0?r():(--t,SE(()=>i()))};return i(),r.promise}const m9e=QH.map(t=>new A0(t)),g9e=new A0("total");function n5(t,e){for(const r of t.entries())if(e(r[0]))return!0;return!1}function Zoe(t,e){if(!e)return t;for(const r of e)t.add(r);return t}function Bbe(t,e){const r=new Set;return Zoe(r,t),Zoe(r,e),r}function y9e(t,e){const r=new Set;for(const i of e)t.has(i)&&r.add(i);return r}function Q4t(t,e){if(!t||!e)return!1;if(t===e)return!0;for(const r of t)if(!e.has(r))return!1;return!0}function K4t(t,e){if(t==null&&e==null)return!0;if(t==null||e==null||t.size!==e.size)return!1;for(const r of t)if(!e.has(r))return!1;return!0}function _9e(t,e){const r=new Set(t);for(const i of e)r.delete(i);return r}function v9e(t,e){return _9e(Bbe(t,e),y9e(t,e))}let b9e=0;const w9e=0;function Gu(){return++b9e}let Nz=class{constructor(e){this._accessed=[],this._handles=[],this._observerObject=new x9e(e),Joe.register(this,new WeakRef(this._observerObject),this)}destroy(){var e;Joe.unregister(this._observerObject),this._accessed.length=0,(e=this._observerObject)==null||e.destroy(),this.clear()}onObservableAccessed(e){const r=this._accessed;r.includes(e)||r.push(e)}onTrackingEnd(){const e=this._handles,r=this._accessed,i=this._observerObject;for(let n=0;n<r.length;++n)e.push(r[n].observe(i));r.length=0}clear(){const e=this._handles;for(let r=0;r<e.length;++r)e[r].remove();e.length=0}},x9e=class{constructor(e){this._notify=e,this._invalidCount=0,this.destroyed=!1}onInvalidated(){this._invalidCount++}onCommitted(){if(this.destroyed)return;const e=this._invalidCount;if(e===1)return this._invalidCount=0,void this._notify();this._invalidCount=e>0?e-1:0}destroy(){this.destroyed=!0,this._notify=T9e}};const Joe=new FinalizationRegistry(t=>{var e;(e=t.deref())==null||e.destroy()});function T9e(){}let NC=!1;const Lk=[];function Vbe(t,e){let r=new Nz(s),i=null,n=!1;function s(){if(!r||n)return;if(NC)return void Hbe(s);const a=i;r.clear(),NC=!0,n=!0,i=Z0(r,t),n=!1,NC=!1,e(i,a),Wbe()}function o(){r&&(r.destroy(),r=null,i=null)}return n=!0,i=Z0(r,t),n=!1,Zr(o)}function Gbe(t,e){let r=new Nz(n),i=null;function n(){e(i,o)}function s(){r&&(r.destroy(),r=null),i=null}function o(){return r?(r.clear(),i=Z0(r,t),i):null}return o(),Zr(s)}function jbe(t){let e=new Nz(i),r=!1;function i(){e&&!r&&(NC?Hbe(i):(e.clear(),NC=!0,r=!0,Z0(e,t),r=!1,NC=!1,Wbe()))}function n(){e&&(e.destroy(),e=null)}return r=!0,Z0(e,t),r=!1,Zr(n)}function Hbe(t){Lk.includes(t)||Lk.unshift(t)}function Wbe(){for(;Lk.length;)Lk.pop()()}var BO;(function(t){t[t.Untracked=0]="Untracked",t[t.Tracked=1]="Tracked"})(BO||(BO={}));let n$=class{constructor(){this.uid=Gu(),this.removed=!1,this.type=null,this.oldValue=null,this.callback=null,this.getValue=null,this.target=null,this.path=null,this.equals=null}static acquireUntracked(e,r,i,n,s){return this.pool.acquire(BO.Untracked,e,r,i,n,s,TK)}static acquireTracked(e,r,i,n){return this.pool.acquire(BO.Tracked,e,r,i,null,null,n)}notify(e,r){this.type===BO.Untracked?this.callback.call(this.target,e,r,this.path,this.target):this.callback.call(null,e,r,void 0,void 0)}acquire(e,r,i,n,s,o,a){this.uid=Gu(),this.removed=!1,this.type=e,this.oldValue=r,this.callback=i,this.getValue=n,this.target=s,this.path=o,this.equals=a}release(){this.target=this.path=this.oldValue=this.callback=this.getValue=null,this.uid=Gu(),this.removed=!0}};n$.pool=new Lbe(n$);const s5=new Dc,I0=new Set;let Dk;function Nk(t){I0.delete(t),I0.add(t),Dk||(Dk=M3(E9e))}function S9e(t){if(t.removed)return;const e=t.oldValue,r=t.getValue();t.equals(e,r)||(t.oldValue=r,t.notify(r,e))}function C9e(t){for(const e of I0.values())e.target===t&&(e.removed=!0)}function E9e(){let t=10;for(;Dk&&t--;){Dk=null;const e=P9e(),r=s5.acquire();for(const i of e){const n=i.uid;S9e(i),n===i.uid&&i.removed&&r.push(i)}for(const i of I0)i.removed&&(r.push(i),I0.delete(i));for(const i of r)n$.pool.release(i);s5.release(r),s5.release(e),eW.forEach(i=>i())}}function P9e(){const t=s5.acquire();t.length=I0.size;let e=0;for(const r of I0)t[e]=r,++e;return I0.clear(),t}const eW=new Set;function qbe(t){return eW.add(t),Zr(()=>eW.delete(t))}function A9e(t,e,r){let i=Sbe(t,e,r,(n,s,o)=>{let a,l,c=Gbe(()=>xI(n,s),(u,h)=>{var p;((p=n.__accessor__)==null?void 0:p.lifecycle)===Lc.DESTROYED||a&&a.uid!==l?i.remove():(a||(a=n$.acquireUntracked(u,o,h,n,s),l=a.uid),Nk(a))});return Zr(()=>{c.remove(),a&&(a.uid!==l||a.removed||(a.removed=!0,Nk(a)),a=null),i=c=null})});return i}function M9e(t,e,r){const i=Sbe(t,e,r,(n,s,o)=>{let a=!1;return Vbe(()=>xI(n,s),(l,c)=>{n.__accessor__.lifecycle!==Lc.DESTROYED?a||(a=!0,TK(c,l)||o.call(n,l,c,s,n),a=!1):i.remove()})});return i}function O9e(t,e,r,i=!1){return t.__accessor__&&t.__accessor__.lifecycle!==Lc.DESTROYED?i?M9e(t,e,r):A9e(t,e,r):Zr()}function R9e(t,e,r){let i,n,s=Gbe(t,(o,a)=>{i&&i.uid!==n?s.remove():(i||(i=n$.acquireTracked(o,e,a,r),n=i.uid),Nk(i))});return Zr(()=>{s.remove(),i&&(i.uid!==n||i.removed||(i.removed=!0,Nk(i)),i=null),s=null})}function $9e(t,e,r){let i=!1;return Vbe(t,(n,s)=>{i||(i=!0,r(s,n)||e(n,s),i=!1)})}function I9e(t,e,r=!1,i=mbe){return r?$9e(t,e,i):R9e(t,e,i)}function Qoe(t){return n5(I0,e=>e.oldValue===t)}function Zh(t,e){for(const[r,i]of t)if(e(i,r))return!0;return!1}function i5t(t,e){for(const[r,i]of t)if(e(i,r))return i;return null}function $K(t,e,r){const i=t.get(e);if(i!==void 0)return i;const n=r();return t.set(e,n),n}function n5t(t){const e=new Map;return r=>(e.has(r)||e.set(r,t(r)),e.get(r))}const FC=()=>re.getLogger("esri.core.accessorSupport.ensureTypes");function L9e(t){return t==null?t:new Date(t)}function D9e(t){return t==null?t:!!t}function Ybe(t){return t==null?t:t.toString()}function Ep(t){return t==null?t:(t=parseFloat(t),isNaN(t)?0:t)}function IK(t){return t==null?t:Math.round(parseFloat(t))}function Xbe(t){return(t==null?void 0:t.constructor)&&t.constructor.__accessorMetadata__!==void 0}function Fk(t,e){return e!=null&&t&&!(e instanceof t)}function Zbe(t){return t&&"isCollection"in t}function Koe(t){return t!=null&&t.Type?typeof t.Type=="function"?t.Type:t.Type.base:null}function N9e(t,e){if(!(e!=null&&e.constructor)||!Zbe(e.constructor))return tW(t,e)?e:new t(e);const r=Koe(t.prototype.itemType),i=Koe(e.constructor.prototype.itemType);return r?i?r===i?e:r.prototype.isPrototypeOf(i.prototype)?new t(e):(tW(t,e),e):new t(e):e}function tW(t,e){return!!Xbe(e)&&(FC().error("Accessor#set","Assigning an instance of '"+(e.declaredClass||"unknown")+"' which is not a subclass of '"+Fz(t)+"'"),!0)}function Yx(t,e){return e==null?e:Zbe(t)?N9e(t,e):Fk(t,e)?tW(t,e)?e:new t(e):e}function Fz(t){var e;return((e=t==null?void 0:t.prototype)==null?void 0:e.declaredClass)||"unknown"}const F9e=new WeakMap;function k9e(t){switch(t){case Number:return Ep;case fn:return IK;case Boolean:return D9e;case String:return Ybe;case Date:return L9e;default:return $K(F9e,t,()=>Yx.bind(null,t))}}function Na(t,e){const r=k9e(t);return arguments.length===1?r:r(e)}function s$(t,e,r){return arguments.length===1?s$.bind(null,t):e&&(Array.isArray(e)?e.map(i=>t(i,r)):[t(e,r)])}function z9e(t,e){return arguments.length===1?s$(r=>Na(t,r)):s$(r=>Na(t,r),e)}function Jbe(t,e,r){return e!==0&&Array.isArray(r)?r.map(i=>Jbe(t,e-1,i)):t(r)}function kk(t,e,r){if(arguments.length===2)return s=>kk(t,e,s);if(!r)return r;r=Jbe(t,e,r);let i=e,n=r;for(;i>0&&Array.isArray(n);)i--,n=n[0];if(n!==void 0)for(let s=0;s<i;s++)r=[r];return r}function U9e(t,e,r){return arguments.length===2?kk(i=>Na(t,i),e):kk(i=>Na(t,i),e,r)}function Qbe(t){return!!Array.isArray(t)&&!t.some(e=>{const r=typeof e;return!(r==="string"||r==="number"||r==="function"&&t.length>1)})}function rW(t,e){if(arguments.length===2)return rW(t).call(null,e);const r=new Set,i=t.filter(a=>typeof a!="function"),n=t.filter(a=>typeof a=="function");for(const a of t)typeof a!="string"&&typeof a!="number"||r.add(a);let s=null,o=null;return(a,l)=>{if(a==null)return a;const c=typeof a,u=c==="string"||c==="number";return u&&(r.has(a)||n.some(h=>c==="string"&&h===String||c==="number"&&h===Number))||c==="object"&&n.some(h=>!Fk(a,h))?a:(u&&i.length?(s||(s=i.map(h=>typeof h=="string"?`'${h}'`:`${h}`).join(", ")),FC().error("Accessor#set",`'${a}' is not a valid value for this property, only the following values are valid: ${s}`)):typeof a=="object"&&n.length?(o||(o=n.map(h=>Fz(h)).join(", ")),FC().error("Accessor#set",`'${a}' is not a valid value for this property, value must be one of ${o}`)):FC().error("Accessor#set",`'${a}' is not a valid value for this property`),l&&(l.valid=!1),null)}}function ig(t,e){if(arguments.length===2)return ig(t).call(null,e);const r={},i=[],n=[];for(const l in t.typeMap){const c=t.typeMap[l];r[l]=Na(c),i.push(Fz(c)),n.push(l)}const s=()=>`'${i.join("', '")}'`,o=()=>`'${n.join("', '")}'`,a=typeof t.key=="string"?l=>l[t.key]:t.key;return l=>{if(t.base&&!Fk(t.base,l)||l==null)return l;const c=a(l)||t.defaultKeyValue,u=r[c];if(!u)return FC().error("Accessor#set",`Invalid property value, value needs to be one of ${s()}, or a plain object that can autocast (having .type = ${o()})`),null;if(!Fk(t.typeMap[c],l))return l;if(typeof t.key=="string"&&!Xbe(l)){const h={};for(const p in l)p!==t.key&&(h[p]=l[p]);return u(h)}return u(l)}}let fn=class{};const o5t={native:t=>({type:"native",value:t}),array:t=>({type:"array",value:t}),oneOf:t=>({type:"one-of",values:t})};function B9e(t){if(!t||!("type"in t))return!1;switch(t.type){case"native":case"array":case"one-of":return!0}return!1}function Kbe(t){switch(t.type){case"native":return Na(t.value);case"array":return s$(Kbe(t.value));case"one-of":return V9e(t);default:return null}}function V9e(t){let e=null;return(r,i)=>nW(r,t)?r:(e==null&&(e=iW(t)),FC().error("Accessor#set",`Invalid property value, value needs to be of type ${e}`),i&&(i.valid=!1),null)}function iW(t){switch(t.type){case"native":switch(t.value){case Number:return"number";case String:return"string";case Boolean:return"boolean";case fn:return"integer";case Date:return"date";default:return Fz(t.value)}case"array":return`array of ${iW(t.value)}`;case"one-of":{const e=t.values.map(r=>iW(r));return`one of ${e.slice(0,-1)} or ${e[e.length-1]}`}}return"unknown"}function nW(t,e){if(t==null)return!0;switch(e.type){case"native":switch(e.value){case Number:case fn:return typeof t=="number";case Boolean:return typeof t=="boolean";case String:return typeof t=="string"}return t instanceof e.value;case"array":return!!Array.isArray(t)&&!t.some(r=>!nW(r,e.value));case"one-of":return e.values.some(r=>nW(t,r))}}function m(t={}){return(e,r)=>{if(e===Function.prototype)throw new Error(`Inappropriate use of @property() on a static field: ${e.name}.${r}. Accessor does not support static properties.`);const i=Object.getOwnPropertyDescriptor(e,r),n=$z(e,r);i&&(i.get||i.set?(n.get=i.get||n.get,n.set=i.set||n.set):"value"in i&&("value"in t&&re.getLogger("esri.core.accessorSupport.decorators.property").warn(`@property() will redefine the value of "${r}" on "${e.constructor.name}" already defined in the metadata`,t),n.value=t.value=i.value)),t.readOnly!=null&&(n.readOnly=t.readOnly);const s=t.aliasOf;if(s){const l=typeof s=="string"?s:s.source,c=typeof s=="string"?null:s.overridable===!0;let u;n.dependsOn=[l],n.get=function(){let h=Gm(this,l);if(typeof h=="function"){u||(u=l.split(".").slice(0,-1).join("."));const p=Gm(this,u);p&&(h=h.bind(p))}return h},n.readOnly||(n.set=c?function(h){this._override(r,h)}:function(h){Rk(this,l,h)})}const o=t.type,a=t.types;n.cast||(o?n.cast=G9e(o):a&&(Array.isArray(a)?n.cast=s$(ig(a[0])):n.cast=ig(a))),Fze(n,t),t.range&&(n.cast=j9e(n.cast,t.range))}}function ewe(t,e,r){const i=$z(t,r);i.json||(i.json={});let n=i.json;return e!==void 0&&(n.origins||(n.origins={}),n.origins[e]||(n.origins[e]={}),n=n.origins[e]),n}function G9e(t){let e=0,r=t;if(B9e(t))return Kbe(t);for(;Array.isArray(r)&&r.length===1&&typeof r[0]!="string"&&typeof r[0]!="number";)r=r[0],e++;const i=r;if(Qbe(i))return e===0?rW(i):kk(rW(i),e);if(e===1)return z9e(i);if(e>1)return U9e(i,e);const n=t;return n.from?n.from:Na(n)}function j9e(t,e){return r=>{let i=+t(r);return e.step!=null&&(i=Math.round(i/e.step)*e.step),e.min!=null&&(i=Math.max(e.min,i)),e.max!=null&&(i=Math.min(e.max,i)),i}}function H9e(t){if(t.json&&t.json.origins){const e=t.json.origins,r={"web-document":["web-scene","web-map"]};for(const i in r)if(e[i]){const n=e[i];r[i].forEach(s=>{e[s]=n}),delete e[i]}}}let tv=class extends vbe{constructor(e,r,i){super(e,r,i)}};tv.prototype.type="warning";function twe(t){var e;return!!t&&((e=t.prototype)==null?void 0:e.declaredClass)&&t.prototype.declaredClass.indexOf("esri.core.Collection")===0}const sW=()=>re.getLogger("esri.core.accessorSupport.extensions.serializableProperty.reader");function eae(t,e,r){var i,n;t&&(!r&&!e.read||(i=e.read)!=null&&i.reader||((n=e.read)==null?void 0:n.enabled)===!1||Y9e(t)&&E2("read.reader",kz(t),e))}function kz(t){var r,i;const e=t.ndimArray??0;if(e>1)return q9e(t);if(e===1)return tae(t);if("type"in t&&iwe(t.type)){const n=(i=(r=t.type.prototype)==null?void 0:r.itemType)==null?void 0:i.Type,s=tae(typeof n=="function"?{type:n}:{types:n});return(o,a,l)=>{const c=s(o,a,l);return c&&new t.type(c)}}return LK(t)}function LK(t){return"type"in t?W9e(t.type):X9e(t.types)}function W9e(t){return t.prototype.read?(e,r,i)=>{if(e==null)return e;const n=typeof e;if(n!=="object")return void sW().error(`Expected JSON value of type 'object' to deserialize type '${t.prototype.declaredClass}', but got '${n}'`);const s=new t;return s.read(e,i),s}:t.fromJSON}function rwe(t,e,r,i){return i!==0&&Array.isArray(e)?e.map(n=>rwe(t,n,r,i-1)):t(e,void 0,r)}function q9e(t){const e=LK(t),r=rwe.bind(null,e),i=t.ndimArray??0;return(n,s,o)=>{if(n==null)return n;n=r(n,o,i);let a=i,l=n;for(;a>0&&Array.isArray(l);)a--,l=l[0];if(l!==void 0)for(let c=0;c<a;c++)n=[n];return n}}function tae(t){const e=LK(t);return(r,i,n)=>{if(r==null)return r;if(Array.isArray(r)){const o=[];for(const a of r){const l=e(a,void 0,n);l!==void 0&&o.push(l)}return o}const s=e(r,void 0,n);return s!==void 0?[s]:void 0}}function iwe(t){if(!twe(t))return!1;const e=t.prototype.itemType;return!(!e||!e.Type)&&(typeof e.Type=="function"?DK(e.Type):nwe(e.Type))}function Y9e(t){return"types"in t?nwe(t.types):DK(t.type)}function DK(t){return!Array.isArray(t)&&!!t&&t.prototype&&("read"in t.prototype||"fromJSON"in t||iwe(t))}function nwe(t){for(const e in t.typeMap)if(!DK(t.typeMap[e]))return!1;return!0}function X9e(t){let e=null;const r=t.errorContext??"type",i=t.validate;return(n,s,o)=>{if(n==null)return n;const a=typeof n;if(a!=="object")return void sW().error(`Expected JSON value of type 'object' to deserialize, but got '${a}'`);e||(e=Z9e(t));const l=t.key;if(typeof l!="string")return;const c=n[l],u=c?e[c]:t.defaultKeyValue?t.typeMap[t.defaultKeyValue]:void 0;if(!u){const p=`Type '${c||"unknown"}' is not supported`;return o!=null&&o.messages&&n&&o.messages.push(new tv(`${r}:unsupported`,p,{definition:n,context:o})),void sW().error(p)}const h=new u;return h.read(n,o),i?i(h):h}}function Z9e(t){var r,i;const e={};for(const n in t.typeMap){const s=t.typeMap[n],o=TI(s.prototype);if(typeof t.key=="function")continue;const a=o[t.key];if(!a)continue;(r=a.json)!=null&&r.type&&Array.isArray(a.json.type)&&a.json.type.length===1&&typeof a.json.type[0]=="string"&&(e[a.json.type[0]]=s);const l=(i=a.json)==null?void 0:i.write;if(!(l!=null&&l.writer)){e[n]=s;continue}const c=l.target,u=typeof c=="string"?c:t.key,h={};l.writer(n,h,u),h[u]&&(e[h[u]]=s)}return e}function J9e(t){if(t.json||(t.json={}),iae(t.json),nae(t.json),rae(t.json),t.json.origins)for(const e in t.json.origins)iae(t.json.origins[e]),nae(t.json.origins[e]),rae(t.json.origins[e]);return!0}function rae(t){t.name&&(t.read&&typeof t.read=="object"?t.read.source===void 0&&(t.read.source=t.name):t.read={source:t.name},t.write&&typeof t.write=="object"?t.write.target===void 0&&(t.write.target=t.name):t.write={target:t.name})}function iae(t){typeof t.read=="boolean"?t.read={enabled:t.read}:typeof t.read=="function"?t.read={enabled:!0,reader:t.read}:t.read&&typeof t.read=="object"&&t.read.enabled===void 0&&(t.read.enabled=!0)}function nae(t){typeof t.write=="boolean"?t.write={enabled:t.write}:typeof t.write=="function"?t.write={enabled:!0,writer:t.write}:t.write&&typeof t.write=="object"&&t.write.enabled===void 0&&(t.write.enabled=!0)}function sae(t,e){if(!e.write||e.write.writer||e.write.enabled===!1&&!e.write.overridePolicy)return;const r=(t==null?void 0:t.ndimArray)??0;t&&(r===1||"type"in t&&twe(t.type))?e.write.writer=eUe:r>1?e.write.writer=tUe(r):e.types?Array.isArray(e.types)?e.write.writer=K9e(e.types[0]):e.write.writer=Q9e(e.types):e.write.writer=o$}function Q9e(t){return(e,r,i,n)=>e?swe(e,t,n)?o$(e,r,i,n):void 0:o$(e,r,i,n)}function swe(t,e,r){for(const i in e.typeMap)if(t instanceof e.typeMap[i])return!0;if(r!=null&&r.messages){const i=e.errorContext??"type",n=`Values of type '${(typeof e.key!="function"?t[e.key]:t.declaredClass)??"Unknown"}' cannot be written`;r&&r.messages&&t&&r.messages.push(new K(`${i}:unsupported`,n,{definition:t,context:r})),re.getLogger("esri.core.accessorSupport.extensions.serializableProperty.writer").error(n)}return!1}function K9e(t){return(e,r,i,n)=>!e||!Array.isArray(e)?o$(e,r,i,n):o$(e.filter(s=>swe(s,t,n)),r,i,n)}function o$(t,e,r,i){E2(r,zk(t,i),e)}function zk(t,e){return t&&typeof t.write=="function"?t.write({},e):t&&typeof t.toJSON=="function"?t.toJSON():typeof t=="number"?Uk(t):t}function Uk(t){return t===-1/0?-Number.MAX_VALUE:t===1/0?Number.MAX_VALUE:isNaN(t)?null:t}function eUe(t,e,r,i){let n;t===null?n=null:t&&typeof t.map=="function"?(n=t.map(s=>zk(s,i)),typeof n.toArray=="function"&&(n=n.toArray())):n=[zk(t,i)],E2(r,n,e)}function owe(t,e,r){return r!==0&&Array.isArray(t)?t.map(i=>owe(i,e,r-1)):zk(t,e)}function tUe(t){return(e,r,i,n)=>{let s;if(e===null)s=null;else{s=owe(e,n,t);let o=t,a=s;for(;o>0&&Array.isArray(a);)o--,a=a[0];if(a!==void 0)for(let l=0;l<o;l++)s=[s]}E2(i,s,r)}}function rUe(t,e){return NK(t,"any",e==null?void 0:e.origin)}function oW(t,e){return NK(t,"read",e==null?void 0:e.origin)}function awe(t,e){return NK(t,"write",e==null?void 0:e.origin)}function NK(t,e,r){let i=t==null?void 0:t.json;if(i!=null&&i.origins&&r){let n;n=r==="link-chart"?i.origins[r]&&(e==="any"||e in i.origins[r])?i.origins[r]:i.origins["web-map"]:i.origins[r],n&&(e==="any"||e in n)&&(i=n)}return i}function iUe(t){const e=nUe(t);if(t.json.origins)for(const r in t.json.origins){const i=t.json.origins[r],n=i.types?sUe(i):e;eae(n,i,!1),i.types&&!i.write&&t.json.write&&t.json.write.enabled&&(i.write={...t.json.write}),sae(n,i)}eae(e,t.json,!0),sae(e,t.json)}function nUe(t){return t.json.types?aW(t.json):t.type?lwe(t):aW(t)}function sUe(t){return t.type?lwe(t):aW(t)}function lwe(t){if(!t.type)return;let e=0,r=t.type;for(;Array.isArray(r)&&!Qbe(r);)r=r[0],e++;return{type:r,ndimArray:e}}function aW(t){if(!t.types)return;let e=0,r=t.types;for(;Array.isArray(r);)r=r[0],e++;return{types:r,ndimArray:e}}function oUe(t){J9e(t)&&(H9e(t),iUe(t))}const zB=new Set,UB=new Set;function V(t){return e=>{t??(t="esri.core.Accessor"),e.prototype.declaredClass=t,lUe(e);const r=[],i=[];let n=e.prototype;for(;n;)n.hasOwnProperty("initialize")&&!zB.has(n.initialize)&&(zB.add(n.initialize),r.push(n.initialize)),n.hasOwnProperty("destroy")&&!UB.has(n.destroy)&&(UB.add(n.destroy),i.push(n.destroy)),n=Object.getPrototypeOf(n);zB.clear(),UB.clear();const s=class extends e{constructor(...a){if(super(...a),this.constructor===s&&typeof this.postscript=="function"){if(r.length&&Object.defineProperty(this,"initialize",{enumerable:!1,configurable:!0,value(){for(let l=r.length-1;l>=0;l--)r[l].call(this)}}),i.length){let l=!1;const c=this[wbe];Object.defineProperty(this,"destroy",{enumerable:!1,configurable:!0,value(){if(!l){l=!0,c.call(this);for(let u=0;u<i.length;u++)i[u].call(this)}}})}Object.defineProperty(this,Symbol.dispose,{enumerable:!1,configurable:!0,value(){this.destroy()}}),this.postscript(...a)}}};s.__accessorMetadata__=TI(e.prototype),s.prototype.declaredClass=t;const o=(t||"AccessorSubclass").split(".").slice(-1)[0];return Object.defineProperty(s,"name",{value:o,configurable:!0}),s}}function aUe(t,e){return e.get==null?function(){const r=this.__accessor__,i=r.propertiesByName.get(t);if(i===void 0)return;Lt(i);const n=r.store;return n.has(t)?n.get(t):i.metadata.value}:function(){const r=this.__accessor__,i=r.propertiesByName.get(t);if(i!==void 0)return i.getComputed(r)}}function lUe(t){const e=t.prototype,r=TI(e),i={};for(const n of Object.getOwnPropertyNames(r)){const s=r[n];oUe(s),i[n]={enumerable:!0,configurable:!0,get:aUe(n,s),set(o){const a=this.__accessor__;if(a!==void 0){if(!Object.isFrozen(this)){if(a.initialized&&s.readOnly)throw new TypeError(`[accessor] cannot assign to read-only property '${n}' of ${this.declaredClass}`);if(a.lifecycle===Lc.CONSTRUCTED&&s.constructOnly)throw new TypeError(`[accessor] cannot assign to construct-only property '${n}' of ${this.declaredClass}`);a.set(n,o)}}else Object.defineProperty(this,n,{enumerable:!0,configurable:!0,writable:!0,value:o})}}}Object.defineProperties(t.prototype,i)}var cwe,uwe;function cUe(t){var e;if(t==null)return{value:t};if(Array.isArray(t))return{type:[t[0]],value:null};switch(typeof t){case"object":return(e=t.constructor)!=null&&e.__accessorMetadata__||t instanceof Date?{type:t.constructor,value:t}:t;case"boolean":return{type:Boolean,value:t};case"string":return{type:String,value:t};case"number":return{type:Number,value:t};case"function":return{type:t,value:null};default:return}}const g_=Symbol("Accessor-Handles"),lW=Symbol("Accessor-Initialized");let Ae=class hwe{static createSubclass(e={}){if(Array.isArray(e))throw new Error("Multi-inheritance unsupported since 4.16");const{properties:r,declaredClass:i,constructor:n}=e;delete e.declaredClass,delete e.properties,delete e.constructor;const s=this;class o extends s{constructor(...l){super(...l),this.inherited=null,n&&n.apply(this,l)}}TI(o.prototype);for(const a in e){const l=e[a];o.prototype[a]=typeof l=="function"?function(...c){const u=this.inherited;let h;this.inherited=function(...p){if(s.prototype[a])return s.prototype[a].apply(this,p)};try{h=l.apply(this,c)}catch(p){throw this.inherited=u,p}return this.inherited=u,h}:e[a]}for(const a in r){const l=cUe(r[a]);m(l)(o.prototype,a)}return V(i)(o)}constructor(...e){if(this[cwe]=null,this[uwe]=!1,this.constructor===hwe)throw new Error("[accessor] cannot instantiate Accessor. This can be fixed by creating a subclass of Accessor");const r=new Yze(this);Object.defineProperty(this,"__accessor__",{enumerable:!1,value:r}),e.length>0&&this.normalizeCtorArgs&&(r.ctorArgs=this.normalizeCtorArgs.apply(this,e))}postscript(e){const r=this.__accessor__,i=r.ctorArgs||e;r.initialize(),i&&(this.set(i),r.ctorArgs=null),r.constructed(),this.initialize(),this[lW]=!0}initialize(){}[wbe](){this[g_]=Pe(this[g_])}destroy(){var e;this.destroyed||(C9e(this),this.__accessor__.destroy(),(e=e9e())==null||e.onInstanceDestroy(this))}[Symbol.dispose](){this.destroy()}get constructed(){return this.__accessor__&&this.__accessor__.initialized||!1}get initialized(){return this[lW]}get destroyed(){var e;return((e=this.__accessor__)==null?void 0:e.lifecycle)===Lc.DESTROYED||!1}commitProperty(e){Gm(this,e)}get(e){return EK(re.getLogger(this),"`Accessor.get` is deprecated in favor of using optional chaining",{version:"4.28",see:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Optional_chaining"}),Gm(this,e)}hasOwnProperty(e){return this.__accessor__?this.__accessor__.has(e):Object.prototype.hasOwnProperty.call(this,e)}keys(){return this.__accessor__?this.__accessor__.keys():[]}set(e,r){return Rk(this,e,r),this}watch(e,r,i){return O9e(this,e,r,i)}addHandles(e,r){if(this.destroyed){const n=Array.isArray(e)?e:[e];for(const s of n)s.remove();return}let i=this[g_];i==null&&(i=this[g_]=new $v),i.add(e,r)}removeHandles(e){const r=this[g_];r!=null&&r.remove(e)}removeAllHandles(){const e=this[g_];e!=null&&e.removeAll()}hasHandles(e){const r=this[g_];return r!=null&&r.has(e)}_override(e,r){r===void 0?this.__accessor__.clearOverride(e):this.__accessor__.override(e,r)}_clearOverride(e){return this.__accessor__.clearOverride(e)}_overrideIfSome(e,r){r==null?this.__accessor__.clearOverride(e):this.__accessor__.override(e,r)}_isOverridden(e){return this.__accessor__.isOverridden(e)}notifyChange(e){this.__accessor__.notifyChange(e)}_get(e){return this.__accessor__.internalGet(e)}_set(e,r){return this.__accessor__.internalSet(e,r),this}};cwe=g_,uwe=lW;let uUe=class dwe{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const r=new dwe;return this._values.forEach((i,n)=>{e&&e.has(n)||r.set(n,_e(i.value),i.origin)}),r}get(e,r){r=this._normalizeOrigin(r);const i=this._values.get(e);return r==null||(i==null?void 0:i.origin)===r?i==null?void 0:i.value:void 0}originOf(e){var r;return((r=this._values.get(e))==null?void 0:r.origin)??oi.USER}keys(e){e=this._normalizeOrigin(e);const r=[...this._values.keys()];return e==null?r:r.filter(i=>{var n;return((n=this._values.get(i))==null?void 0:n.origin)===e})}set(e,r,i){if((i=this._normalizeOrigin(i))===oi.DEFAULTS){const n=this._values.get(e);if((n==null?void 0:n.origin)!=null&&n.origin>i)return}this._values.set(e,new hUe(r,i))}delete(e,r){var i;(r=this._normalizeOrigin(r))!=null&&((i=this._values.get(e))==null?void 0:i.origin)!==r||this._values.delete(e)}has(e,r){var i;return(r=this._normalizeOrigin(r))!=null?((i=this._values.get(e))==null?void 0:i.origin)===r:this._values.has(e)}forEach(e){this._values.forEach(({value:r},i)=>e(r,i))}_normalizeOrigin(e){if(e!=null)return e===oi.DEFAULTS?e:oi.USER}},hUe=class{constructor(e,r){this.value=e,this.origin=r}};function dUe(t,e,r){e.keys().forEach(n=>{r.set(n,e.get(n),oi.DEFAULTS)});const i=t.metadata;Object.keys(i).forEach(n=>{t.internalGet(n)&&r.set(n,t.internalGet(n),oi.DEFAULTS)})}function pUe(t,e,r){if(!(t!=null&&t.read)||t.read.enabled===!1||!t.read.source)return!1;const i=t.read.source;if(typeof i=="string"){if(i===e||i.includes(".")&&i.indexOf(e)===0&&Boe(i,r))return!0}else for(const n of i)if(n===e||n.includes(".")&&n.indexOf(e)===0&&Boe(n,r))return!0;return!1}function fUe(t){return t&&(!t.read||t.read.enabled!==!1&&!t.read.source)}function mUe(t,e,r,i,n){let s=oW(e[r],n);fUe(s)&&(t[r]=!0);for(const o of Object.getOwnPropertyNames(e))s=oW(e[o],n),pUe(s,r,i)&&(t[o]=!0)}function gUe(t,e,r,i){const n=r.metadata,s=rUe(n[e],i),o=s==null?void 0:s.default;if(o===void 0)return;const a=typeof o=="function"?o.call(t,e,i):o;a!==void 0&&r.set(e,a)}const pwe={origin:"service"};function yUe(t,e,r=pwe){if(!e||typeof e!="object")return;const i=rg(t),n=i.metadata,s={};for(const o of Object.getOwnPropertyNames(e))mUe(s,n,o,e,r);i.setDefaultOrigin(r.origin);for(const o of Object.getOwnPropertyNames(s)){const a=oW(n[o],r).read,l=a==null?void 0:a.source;let c;c=l&&typeof l=="string"?xI(e,l):e[o],a!=null&&a.reader&&(c=a.reader.call(t,c,e,r)),c!==void 0&&i.set(o,c)}if(!r||!r.ignoreDefaults){i.setDefaultOrigin("defaults");for(const o of Object.getOwnPropertyNames(n))s[o]||gUe(t,o,i,r)}i.setDefaultOrigin("user")}function c5t(t,e,r,i=pwe){var s;const n={...i,messages:[]};r(n),(s=n.messages)==null||s.forEach(o=>{o.type!=="warning"||t.loaded?i!=null&&i.messages&&i.messages.push(o):t.loadWarnings.push(o)})}function _Ue(t,e,r,i,n){var o,a;const s={};return(a=(o=e.write)==null?void 0:o.writer)==null||a.call(t,i,s,r,n),s}function fwe(t,e,r,i,n,s){if(!(i!=null&&i.write))return!1;const o=Gm(t,r);if(!n&&i.write.overridePolicy){const a=i.write.overridePolicy.call(t,o,r,s??void 0);a!==void 0&&(n=a)}if(n||(n=i.write),!n||n.enabled===!1||n.layerContainerTypes&&(s!=null&&s.layerContainerType)&&!n.layerContainerTypes.includes(s.layerContainerType))return!1;if((o===null&&!n.allowNull&&!n.writerEnsuresNonNull||o===void 0)&&n.isRequired){const a=new K("web-document-write:property-required",`Missing value for required property '${r}' on '${t.declaredClass}'`,{propertyName:r,target:t});return a&&(s!=null&&s.messages)?s.messages.push(a):a&&!s&&re.getLogger("esri.core.accessorSupport.write").error(a.name,a.message),!1}return!(o===void 0||o===null&&!n.allowNull&&!n.writerEnsuresNonNull||!n.alwaysWriteDefaults&&(!e.store.multipleOriginsSupported||e.store.originOf(r)===oi.DEFAULTS)&&vUe(t,r,s,i,o)||!n.ignoreOrigin&&(s!=null&&s.origin)&&e.store.multipleOriginsSupported&&e.store.originOf(r)<Abe(s.origin))}function vUe(t,e,r,i,n){const s=i.default;if(s===void 0)return!1;if(i.defaultEquals!=null)return i.defaultEquals(n);if(typeof s=="function"){if(Array.isArray(n)){const o=s.call(t,e,r??void 0);return tg(o,n)}return!1}return s===n}function u5t(t,e,r,i){const n=rg(t),s=n.metadata,o=awe(s[e],i);return!!o&&fwe(t,n,e,o,r,i)}function bUe(t,e,r){var s,o;if(t&&typeof t.toJSON=="function"&&(!t.toJSON.isDefaultToJSON||!t.write))return t5(e,t.toJSON(r));const i=rg(t),n=i.metadata;for(const a in n){const l=awe(n[a],r);if(!fwe(t,i,a,l,void 0,r))continue;const c=Gm(t,a),u=_Ue(t,l,l.write&&typeof l.write.target=="string"?l.write.target:a,c,r);Object.keys(u).length>0&&(e=t5(e,u),(o=(s=r==null?void 0:r.resources)==null?void 0:s.pendingOperations)!=null&&o.length&&r.resources.pendingOperations.push(Promise.all(r.resources.pendingOperations).then(()=>t5(e,u,()=>"replace-arrays"))),r!=null&&r.writtenProperties&&r.writtenProperties.push({target:t,propName:a,oldOrigin:jze(i.store.originOf(a)),newOrigin:r.origin}))}return e}const CI=t=>{let e=class extends t{constructor(...r){super(...r);const i=rg(this),n=i.store,s=new uUe;i.store=s,dUe(i,n,s)}read(r,i){yUe(this,r,i)}write(r,i){return bUe(this,r??{},i)}toJSON(r){return this.write({},r)}static fromJSON(r,i){return wUe.call(this,r,i)}};return e=d([V("esri.core.JSONSupport")],e),e.prototype.toJSON.isDefaultToJSON=!0,e};function wUe(t,e){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const r=new this;return r.read(t,e),r}function cW(t){return t&&typeof t=="object"&&"toJSON"in t&&typeof t.toJSON=="function"}let ze=class extends CI(Ae){};ze=d([V("esri.core.JSONSupport")],ze);const xUe=/^https:\/\/([a-z\d-]+)(\.maps([^.]*))?\.arcgis\.com/i,TUe={devext:{customBaseUrl:"mapsdevext.arcgis.com",portalHostname:"devext.arcgis.com"},qaext:{customBaseUrl:"mapsqa.arcgis.com",portalHostname:"qaext.arcgis.com"},www:{customBaseUrl:"maps.arcgis.com",portalHostname:"www.arcgis.com"}};function oae(t){const e=t==null?void 0:t.match(xUe);if(!e)return null;const[,r,i,n]=e;if(!r)return null;let s=null,o=null,a=null;const{devext:l,qaext:c,www:u}=TUe;if(i)if(s=r,n)switch(n.toLowerCase()){case"devext":({customBaseUrl:o,portalHostname:a}=l);break;case"qa":({customBaseUrl:o,portalHostname:a}=c);break;default:return null}else({customBaseUrl:o,portalHostname:a}=u);else switch(r.toLowerCase()){case"devext":({customBaseUrl:o,portalHostname:a}=l);break;case"qaext":({customBaseUrl:o,portalHostname:a}=c);break;case"www":({customBaseUrl:o,portalHostname:a}=u);break;default:return null}return{customBaseUrl:o,isPortal:!1,portalHostname:a,urlKey:s}}function SUe(t){return/\/(sharing|usrsvcs)\/(appservices|servers)\//i.test(t)}function mwe(t){const e=atob(t),r=new Uint8Array(e.length);for(let i=0;i<e.length;i++)r[i]=e.charCodeAt(i);return r.buffer}function CUe(t){const e=new Uint8Array(t);let r="";for(let i=0;i<e.length;i++)r+=String.fromCharCode(e[i]);return btoa(r)}const EUe=()=>re.getLogger("esri.core.urlUtils"),O3=mi.request,aae="esri/config: esriConfig.request.proxyUrl is not set.",gwe=/^\s*[a-z][a-z0-9-+.]*:(?![0-9])/i,ywe=/^\s*http:/i,PUe=/^\s*https:/i,AUe=/^\s*file:/i,MUe=/:\d+$/,OUe=/^https?:\/\/[^/]+\.arcgis.com\/sharing(\/|$)/i,RUe=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$"),$Ue=new RegExp("^((([^\\[:]+):)?([^@]+)@)?(\\[([^\\]]+)\\]|([^\\[:]*))(:([0-9]+))?$");let kC=class{constructor(e=""){this.uri=e,this.scheme=null,this.authority=null,this.path=null,this.query=null,this.fragment=null,this.user=null,this.password=null,this.host=null,this.port=null;let r=this.uri.match(RUe);this.scheme=r[2]||(r[1]?"":null),this.authority=r[4]||(r[3]?"":null),this.path=r[5],this.query=r[7]||(r[6]?"":null),this.fragment=r[9]||(r[8]?"":null),this.authority!=null&&(r=this.authority.match($Ue),this.user=r[3]||null,this.password=r[4]||null,this.host=r[6]||r[7],this.port=r[9]||null)}toString(){return this.uri}};const jL={},IUe=new kC(mi.applicationUrl);let ml=IUe;const LUe=DUe();let FK=LUe;const kK=()=>ml,p5t=()=>FK;function DUe(){const t=ml.path,e=t.substring(0,t.lastIndexOf(t.split("/")[t.split("/").length-1]));return`${`${ml.scheme}://${ml.host}${ml.port!=null?`:${ml.port}`:""}`}${e}`}function da(t){if(!t)return null;const e={path:null,query:null},r=new kC(t),i=t.indexOf("?");return r.query===null?e.path=t:(e.path=t.substring(0,i),e.query=zK(r.query)),r.fragment&&(e.hash=r.fragment,r.query===null&&(e.path=e.path.substring(0,e.path.length-(r.fragment.length+1)))),e}function zK(t){const e=t.split("&"),r={};for(const i of e){if(!i)continue;const n=i.indexOf("=");let s,o;n<0?(s=decodeURIComponent(i),o=""):(s=decodeURIComponent(i.slice(0,n)),o=decodeURIComponent(i.slice(n+1)));let a=r[s];typeof a=="string"&&(a=r[s]=[a]),Array.isArray(a)?a.push(o):r[s]=o}return r}function a$(t,e){return t?e&&typeof e=="function"?Object.keys(t).map(r=>encodeURIComponent(r)+"="+encodeURIComponent(e(r,t[r]))).join("&"):Object.keys(t).map(r=>{const i=t[r];if(i==null)return"";const n=encodeURIComponent(r)+"=",s=e==null?void 0:e[r];return s?n+encodeURIComponent(s(i)):Array.isArray(i)?i.map(o=>cW(o)?n+encodeURIComponent(JSON.stringify(o)):n+encodeURIComponent(o)).join("&"):cW(i)?n+encodeURIComponent(JSON.stringify(i)):n+encodeURIComponent(i)}).filter(r=>r).join("&"):""}function NUe(t=!1){let e,r=O3.proxyUrl;if(typeof t=="string"){e=VUe(t);const i=zz(t);i&&(r=i.proxyUrl)}else e=!!t;if(!r)throw EUe().warn(aae),new K("urlUtils:proxy-not-set",aae);return e&&uW()&&(r=jK(r)),da(r)}function f5t(t){const e=zz(t);let r,i;if(e){const n=UK(e.proxyUrl);r=n.path,i=n.query?zK(n.query):null}if(r){const n=da(t);t=r+"?"+n.path;const s=a$({...i,...n.query});s&&(t=`${t}?${s}`)}return t}const yP={path:"",query:""};function UK(t){const e=t.indexOf("?");return e!==-1?(yP.path=t.slice(0,e),yP.query=t.slice(e+1)):(yP.path=t,yP.query=null),yP}function _we(t){return t=(t=Vk(t=qUe(t=UK(t).path),!0)).toLowerCase()}function FUe(t){const e={proxyUrl:t.proxyUrl,urlPrefix:_we(t.urlPrefix)},r=O3.proxyRules,i=e.urlPrefix;let n=r.length;for(let s=0;s<r.length;s++){const o=r[s].urlPrefix;if(i.indexOf(o)===0){if(i.length===o.length)return-1;n=s;break}o.indexOf(i)===0&&(n=s+1)}return r.splice(n,0,e),n}function zz(t){const e=O3.proxyRules,r=_we(t);for(let i=0;i<e.length;i++)if(r.indexOf(e[i].urlPrefix)===0)return e[i]}function m5t(t,e){if(!t||!e)return!1;t=Bk(t),e=Bk(e);const r=oae(t),i=oae(e);return r!=null&&i!=null?r.portalHostname===i.portalHostname:r==null&&i==null&&CE(t,e,!0)}function kUe(t,e){return t=Bk(t),e=Bk(e),Vk(t)===Vk(e)}function Bk(t){const e=(t=L0(t)).indexOf("/sharing");return e>0?t.substring(0,e):t.replace(/\/+$/,"")}function vwe(t){const e=i=>i==null||i instanceof RegExp&&i.test(t)||typeof i=="string"&&t.startsWith(i),r=O3.interceptors;if(r){for(const i of r)if(Array.isArray(i.urls)){if(i.urls.some(e))return i}else if(e(i.urls))return i}return null}function CE(t,e,r=!1){if(!t||!e)return!1;const i=dW(t),n=dW(e);return!(!r&&i.scheme!==n.scheme)&&i.host!=null&&n.host!=null&&i.host.toLowerCase()===n.host.toLowerCase()&&i.port===n.port}function BK(t){if(typeof t=="string"){if(!ju(t))return!0;t=dW(t)}if(CE(t,ml))return!0;const e=O3.trustedServers||[];for(let r=0;r<e.length;r++){const i=zUe(e[r]);for(let n=0;n<i.length;n++)if(CE(t,i[n]))return!0}return!1}function zUe(t){return jL[t]||(GK(t)||ng(t)?jL[t]=[new kC(Du(t))]:jL[t]=[new kC(`http://${t}`),new kC(`https://${t}`)]),jL[t]}function Du(t,e=FK,r){return ng(t)?r&&r.preserveProtocolRelative?t:ml.scheme==="http"&&ml.authority===qp(t).slice(2)?`http:${t}`:`https:${t}`:GK(t)?t:Bz(t[0]==="/"?WUe(e):e,t)}function Uz(t,e=FK,r){if(t==null||!ju(t))return t;const i=L0(t),n=i.toLowerCase(),s=L0(e).toLowerCase().replace(/\/+$/,""),o=r?L0(r).toLowerCase().replace(/\/+$/,""):null;if(o&&s.indexOf(o)!==0)return t;const a=(h,p,f)=>(f=h.indexOf(p,f))===-1?h.length:f;let l=a(n,"/",n.indexOf("//")+2),c=-1;for(;n.slice(0,l+1)===s.slice(0,l)+"/"&&(c=l+1,l!==n.length);)l=a(n,"/",l+1);if(c===-1||o&&c<o.length)return t;t=i.slice(c);const u=s.slice(c-1).replaceAll(/[^/]+/g,"").length;if(u>0)for(let h=0;h<u;h++)t=`../${t}`;else t=`./${t}`;return t}function L0(t){return t=ZUe(t=XUe(t=YUe(t=Du(t=t.trim()))))}function Bz(...t){const e=t.filter(P3);if(!(e!=null&&e.length))return;const r=[];if(ju(e[0])){const n=e[0],s=n.indexOf("//");s!==-1&&(r.push(n.slice(0,s+1)),jUe(e[0])&&(r[0]+="/"),e[0]=n.slice(s+2))}else e[0][0]==="/"&&r.push("");const i=e.reduce((n,s)=>s?n.concat(s.split("/")):n,[]);for(let n=0;n<i.length;n++){const s=i[n];s===".."&&r.length>0&&r[r.length-1]!==".."?r.pop():(!s&&n===i.length-1||s&&(s!=="."||r.length===0))&&r.push(s)}return r.join("/")}function qp(t,e=!1){if(t==null||l$(t)||mg(t))return null;let r=t.indexOf("://");if(r===-1&&ng(t))r=2;else{if(r===-1)return null;r+=3}const i=t.indexOf("/",r);return i!==-1&&(t=t.slice(0,i)),e&&(t=Vk(t,!0)),t}function ju(t){return ng(t)||GK(t)}function l$(t){return t!=null&&t.slice(0,5)==="blob:"}function mg(t){return t!=null&&t.slice(0,5)==="data:"}function VK(t){const e=rv(t);return e&&e.isBase64?mwe(e.data):null}function g5t(t){return CUe(t).replaceAll("+","-").replaceAll("/","_").replace(/=+$/,"")}const UUe=/^data:(.*?)(;base64)?,(.*)$/;function rv(t){const e=t.match(UUe);if(!e)return null;const[,r,i,n]=e;return{mediaType:r,isBase64:!!i,data:n}}function bwe(t){return t.isBase64?`data:${t.mediaType};base64,${t.data}`:`data:${t.mediaType},${t.data}`}async function y5t(t){return(await fetch(t)).blob()}function _5t(t){const e=VK(t);if(!e)return null;const r=rv(t);return new Blob([e],{type:r.mediaType})}function v5t(t,e){BUe(t,e)}function BUe(t,e){if(!t)return!1;const r=document.createElement("a");if(!("download"in r))return!1;const i=URL.createObjectURL(t);return r.download=e,r.href=i,r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(i),!0}function ng(t){return t!=null&&t[0]==="/"&&t[1]==="/"}function GK(t){return t!=null&&gwe.test(t)}function VUe(t){return t!=null&&PUe.test(t)||ml.scheme==="https"&&ng(t)}function GUe(t){return t!=null&&ywe.test(t)||ml.scheme==="http"&&ng(t)}function jUe(t){return t!=null&&AUe.test(t)}function jK(t){return ng(t)?`https:${t}`:t.replace(ywe,"https:")}function HUe(){return ml.scheme==="http"}function uW(){return ml.scheme==="https"}function Vk(t,e=!1){return ng(t)?t.slice(2):(t=t.replace(gwe,""),e&&t.length>1&&t[0]==="/"&&t[1]==="/"&&(t=t.slice(2)),t)}function WUe(t){const e=t.indexOf("//"),r=t.indexOf("/",e+2);return r===-1?t:t.slice(0,r)}function Vz(t){let e=0;if(ju(t)){const i=t.indexOf("//");i!==-1&&(e=i+2)}const r=t.lastIndexOf("/");return r<e?t:t.slice(0,r+1)}function b5t(t,e){if(!t)return"";const r=da(t).path.replace(/\/+$/,""),i=r.substring(r.lastIndexOf("/")+1);if(!(e!=null&&e.length))return i;const n=new RegExp(`.(${e.join("|")})$`,"ig");return i.replace(n,"")}function qUe(t){return t.endsWith("/")?t:`${t}/`}function wwe(t){return t.replace(/\/+$/,"")}function YUe(t){if(/^https?:\/\//i.test(t)){const e=UK(t);t=(t=e.path.replaceAll(/\/{2,}/g,"/")).replace("/","//"),e.query&&(t+=`?${e.query}`)}return t}function XUe(t){return t.replace(/^(https?:\/\/)(arcgis\.com)/i,"$1www.$2")}function ZUe(t){const e=O3.httpsDomains;if(!GUe(t))return t;const r=t.indexOf("/",7);let i;if(i=r===-1?t:t.slice(0,r),i=i.toLowerCase().slice(7),MUe.test(i)){if(!i.endsWith(":80"))return t;i=i.slice(0,-3),t=t.replace(":80","")}return HUe()&&i===ml.authority&&!OUe.test(t)||(uW()&&i===ml.authority||e&&e.some(n=>i===n||i.endsWith(`.${n}`))||uW()&&!zz(t))&&(t=jK(t)),t}function hW(t,e,r){if(!(e&&r&&t&&ju(t)))return t;const i=t.indexOf("//"),n=t.indexOf("/",i+2),s=t.indexOf(":",i+2),o=Math.min(n<0?t.length:n,s<0?t.length:s);return t.slice(i+2,o).toLowerCase()!==e.toLowerCase()?t:`${t.slice(0,i+2)}${r}${t.slice(o)}`}function dW(t){return typeof t=="string"?new kC(Du(t)):(t.scheme||(t.scheme=ml.scheme),t)}function xwe(t){return QUe.test(t)}function Twe(t,e){const r=da(t),i=Object.keys(r.query||{});return i.length>0&&e&&e.warn("removeQueryParameters()",`Url query parameters are not supported, the following parameters have been removed: ${i.join(", ")}.`),r.path}function JUe(t,e,r){const i=da(t),n=i.query||{};return n[e]=String(r),`${i.path}?${a$(n)}`}function BB(t,e){if(!e)return t;const r=da(t),i=r.query||{};for(const[s,o]of Object.entries(e))o!=null&&(i[s]=o);const n=a$(i);return n?`${r.path}?${n}`:r.path}function w5t(t){if(t==null)return null;const e=t.match(Swe);return e?e[2]:null}function lae(t){if(t==null)return null;const e=t.match(Swe);return e?{path:e[1],extension:e[2]}:{path:t,extension:null}}async function x5t(t){return typeof t=="string"?rv(t)??{data:t}:new Promise((e,r)=>{const i=new FileReader;i.readAsDataURL(t),i.onload=()=>e(rv(i.result)),i.onerror=n=>r(n)})}const Swe=/([^.]*)\.([^\/]*)$/,QUe=/(^data:image\/svg|\.svg$)/i,Cwe="20240301",Ewe="a93df9da562fc7a65201b235bcc4eee5367b63dc";Symbol.dispose??(Symbol.dispose=Symbol("Symbol.dispose")),Symbol.asyncDispose??(Symbol.asyncDispose=Symbol("Symbol.asyncDispose"));const KUe="4.29";let Gi,HK=KUe;HK="4.29.3";function T5t(t){Gi=t}function S5t(t){const e=Gi==null?void 0:Gi.findCredential(t);return e!=null&&e.token?JUe(t,"token",e.token):t}se("host-webworker");const eBe=new Set(["elevation3d.arcgis.com","js.arcgis.com","jsdev.arcgis.com","jsqa.arcgis.com","static.arcgis.com"]);function Pwe(t){const e=qp(t,!0);return!!e&&e.endsWith(".arcgis.com")&&!eBe.has(e)&&!t.endsWith("/sharing/rest/generateToken")}function Awe(t,e,r=!1,i){return new Promise((n,s)=>{if(Ls(i))return void s(cae());let o=()=>{c(),s(new Error(`Unable to load ${e}`))},a=()=>{const u=t;c(),n(u)},l=()=>{if(!t)return;const u=t;c(),u.src="",s(cae())};const c=()=>{se("esri-image-decode")||(t.removeEventListener("error",o),t.removeEventListener("load",a)),o=null,a=null,t=null,i!=null&&i.removeEventListener("abort",l),l=null,r&&URL.revokeObjectURL(e)};i!=null&&i.addEventListener("abort",l),se("esri-image-decode")?t.decode().then(a,o):(t.addEventListener("error",o),t.addEventListener("load",a))})}function cae(){try{return new DOMException("Aborted","AbortError")}catch{const t=new Error;return t.name="AbortError",t}}const Mwe="Timeout exceeded";function tBe(){return new Error(Mwe)}function C5t(t){return typeof t=="object"&&!!t&&"message"in t&&t.message===Mwe}function rBe(t){mi.request.crossOriginNoCorsDomains||(mi.request.crossOriginNoCorsDomains={});const e=mi.request.crossOriginNoCorsDomains;for(let r of t)r=r.toLowerCase(),/^https?:\/\//.test(r)?e[qp(r)??""]=0:(e[qp("http://"+r)??""]=0,e[qp("https://"+r)??""]=0)}function iBe(t){const e=mi.request.crossOriginNoCorsDomains;if(e){let r=qp(t);if(r)return r=r.toLowerCase(),!CE(r,kK())&&e[r]<Date.now()-36e5}return!1}async function nBe(t){var n;const e=mi.request.crossOriginNoCorsDomains,r=qp(t);e&&r&&(e[r.toLowerCase()]=Date.now());const i=da(t);t=i.path,((n=i.query)==null?void 0:n.f)==="json"&&(t+="?f=json");try{await fetch(t,{mode:"no-cors",credentials:"include"})}catch{}}async function Xi(t,e){var c;t instanceof URL&&(t=t.toString()),(e==null?void 0:e.query)instanceof URLSearchParams&&(e.query=zK(e.query.toString().replaceAll("+"," ")));const r=mg(t),i=l$(t);i||r||(t=L0(t));const n={url:t,requestOptions:{...e}};let s=vwe(t);if(s){const u=await dBe(s,n);if(u!=null)return{data:u,getAllHeaders:EE,getHeader:EE,httpStatus:200,requestOptions:n.requestOptions,url:n.url};s.after||s.error||(s=null)}if(t=n.url,(e=n.requestOptions).responseType==="image"&&(se("host-webworker")||se("host-node")))throw jm("request:invalid-parameters",new Error("responseType 'image' is not supported in Web Workers or Node environment"),n);if(e.method==="head"){if(e.body)throw jm("request:invalid-parameters",new Error("body parameter cannot be set when method is 'head'"),n);if(r||i)throw jm("request:invalid-parameters",new Error("data and blob URLs are not supported for method 'head'"),n)}if(await cBe(),Gk)return Gk.execute(t,e);const o=new AbortController;ca(e,()=>o.abort());const a={controller:o,credential:void 0,credentialToken:void 0,fetchOptions:void 0,hasToken:!1,interceptor:s,params:n,redoRequest:!1,useIdentity:yp.useIdentity,useProxy:!1,useSSL:!1,withCredentials:!1},l=await fBe(a);return(c=s==null?void 0:s.after)==null||c.call(s,l),l}let Gk;const yp=mi.request,Owe="FormData"in globalThis,sBe=new Set([499,498,403,401]),oBe=new Set(["COM_0056","COM_0057","SB_0008"]),aBe=[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,/\/rest\/info/i],EE=()=>null,jk=Symbol();function lBe(t){const e=qp(t);e&&!Xi._corsServers.includes(e)&&Xi._corsServers.push(e)}function uae(t){const e=qp(t);return!e||e.endsWith(".arcgis.com")||Xi._corsServers.includes(e)||BK(e)}function jm(t,e,r,i){let n="Error";const s={url:r.url,requestOptions:r.requestOptions,getAllHeaders:EE,getHeader:EE,ssl:!1};if(e instanceof K)return e.details?(e.details=_e(e.details),e.details.url=r.url,e.details.requestOptions=r.requestOptions):e.details=s,e;if(e){const o=i&&(()=>Array.from(i.headers)),a=i&&(u=>i.headers.get(u)),l=i==null?void 0:i.status,c=e.message;c&&(n=c),o&&a&&(s.getAllHeaders=o,s.getHeader=a),s.httpStatus=(e.httpCode!=null?e.httpCode:e.code)||l||0,s.subCode=e.subcode,s.messageCode=e.messageCode,typeof e.details=="string"?s.messages=[e.details]:s.messages=e.details,s.raw=jk in e?e[jk]:e}return _s(e)?dr():new K(t,n,s)}async function cBe(){se("host-webworker")&&!Gk&&(Gk=await ge(()=>import("./request-DKppPF5F.js"),__vite__mapDeps([])))}async function pW(){Gi||await ge(()=>import("./IdentityManager-D0o8fAjj.js"),__vite__mapDeps([0,1]))}async function uBe(t){var a;const e=t.params.url,r=t.params.requestOptions,i=t.controller.signal,n=r.body;let s=null,o=null;if(Owe&&"HTMLFormElement"in globalThis&&(n instanceof FormData?s=n:n instanceof HTMLFormElement&&(s=new FormData(n))),typeof n=="string"&&(o=n),t.fetchOptions={cache:r.cacheBust?"no-cache":"default",credentials:"same-origin",headers:r.headers||{},method:r.method==="head"?"HEAD":"GET",mode:"cors",priority:yp.priority,redirect:"follow",signal:i},(s||o)&&(t.fetchOptions.body=s||o),r.authMode==="anonymous"&&(t.useIdentity=!1),t.hasToken=!!(/token=/i.test(e)||(a=r.query)!=null&&a.token||s!=null&&s.get("token")),!t.hasToken&&mi.apiKey&&Pwe(e)&&(r.query||(r.query={}),r.query.token=mi.apiKey,t.hasToken=!0),t.useIdentity&&!t.hasToken&&!t.credentialToken&&!Rwe(e)&&!Ls(i)){let l;r.authMode==="immediate"?(await pW(),l=await Gi.getCredential(e,{signal:i}),t.credential=l):r.authMode==="no-prompt"?(await pW(),l=await Gi.getCredential(e,{prompt:!1,signal:i}).catch(()=>{}),t.credential=l):Gi&&(l=Gi.findCredential(e)),l&&(t.credentialToken=l.token,t.useSSL=!!l.ssl)}}function Rwe(t){return aBe.some(e=>e.test(t))}async function hBe(t){let e=t.params.url;const r=t.params.requestOptions,i=t.fetchOptions??{},n=l$(e)||mg(e),s=r.responseType||"json",o=n?0:r.timeout!=null?r.timeout:yp.timeout;let a=!1;if(!n){t.useSSL&&(e=jK(e));let p={...r.query};t.credentialToken&&(p.token=t.credentialToken);let f=a$(p);se("esri-url-encodes-apostrophe")&&(f=f.replaceAll("'","%27"));const g=e.length+1+f.length;let _;a=r.method==="delete"||r.method==="post"||r.method==="put"||!!r.body||g>yp.maxUrlLength;const v=r.useProxy||!!zz(e);if(v){const b=NUe(e);_=b.path,!a&&_.length+1+g>yp.maxUrlLength&&(a=!0),b.query&&(p={...b.query,...p})}if(i.method==="HEAD"&&(a||v)){if(a)throw g>yp.maxUrlLength?jm("request:invalid-parameters",new Error("URL exceeds maximum length"),t.params):jm("request:invalid-parameters",new Error("cannot use POST request when method is 'head'"),t.params);if(v)throw jm("request:invalid-parameters",new Error("cannot use proxy when method is 'head'"),t.params)}if(a?(i.method=r.method==="delete"?"DELETE":r.method==="put"?"PUT":"POST",r.body?e=BB(e,p):(i.body=a$(p),i.headers||(i.headers={}),i.headers["Content-Type"]="application/x-www-form-urlencoded")):e=BB(e,p),v&&(t.useProxy=!0,e=`${_}?${e}`),p.token&&Owe&&i.body instanceof FormData&&!SUe(e)&&i.body.set("token",p.token),r.hasOwnProperty("withCredentials"))t.withCredentials=r.withCredentials;else if(!CE(e,kK())){if(BK(e))t.withCredentials=!0;else if(Gi){const b=Gi.findServerInfo(e);b!=null&&b.webTierAuth&&(t.withCredentials=!0)}}t.withCredentials&&(i.credentials="include",iBe(e)&&await nBe(a?BB(e,p):e))}let l,c,u=0,h=!1;o>0&&(u=setTimeout(()=>{h=!0,t.controller.abort()},o));try{if(r.responseType==="native-request-init")c=i,c.url=e;else if(r.responseType!=="image"||i.cache!=="default"||i.method!=="GET"||a||pBe(r.headers)||!n&&!t.useProxy&&yp.proxyUrl&&!uae(e)){if(Xi._beforeFetch&&await Xi._beforeFetch(e,i),l=await fetch(e,i),Xi._afterFetch&&await Xi._afterFetch(l),t.useProxy||lBe(e),r.responseType==="native")c=l;else if(i.method!=="HEAD")if(l.ok){switch(s){case"array-buffer":c=await l.arrayBuffer();break;case"blob":case"image":c=await l.blob();break;default:c=await l.text()}if(u&&(clearTimeout(u),u=0),s==="json"||s==="xml"||s==="document")if(c)switch(s){case"json":c=JSON.parse(c);break;case"xml":c=hae(c,"application/xml");break;case"document":c=hae(c,"text/html")}else c=null;if(c){if(s==="array-buffer"||s==="blob"){const p=l.headers.get("Content-Type");if(p&&/application\/json|text\/plain/i.test(p)&&c[s==="blob"?"size":"byteLength"]<=750)try{const f=await new Response(c).json();f.error&&(c=f)}catch{}}s==="image"&&c instanceof Blob&&(c=await dae(URL.createObjectURL(c),t,!0))}}else{c=await l.text();try{c=JSON.parse(c)}catch{}}}else c=await dae(e,t)}catch(p){if(p.name==="AbortError")throw h?tBe():dr("Request canceled");if(!(!l&&p instanceof TypeError&&yp.proxyUrl)||r.body||r.method==="delete"||r.method==="head"||r.method==="post"||r.method==="put"||t.useProxy||uae(e))throw p;t.redoRequest=!0,FUe({proxyUrl:yp.proxyUrl,urlPrefix:qp(e)??""})}finally{u&&clearTimeout(u)}return[l,c]}async function dBe(t,e){if(t.responseData!=null)return t.responseData;if(t.headers&&(e.requestOptions.headers={...e.requestOptions.headers,...t.headers}),t.query&&(e.requestOptions.query={...e.requestOptions.query,...t.query}),t.before){let r,i;try{i=await t.before(e)}catch(n){r=jm("request:interceptor",n,e)}if((i instanceof Error||i instanceof K)&&(r=jm("request:interceptor",i,e)),r)throw t.error&&t.error(r),r;return i}}function pBe(t){if(t){for(const e of Object.getOwnPropertyNames(t))if(t[e])return!0}return!1}function hae(t,e){let r;try{r=new DOMParser().parseFromString(t,e)}catch{}if(!r||r.getElementsByTagName("parsererror").length)throw new SyntaxError("XML Parse error");return r}async function fBe(t){var s,o;let e,r;await uBe(t);try{do[e,r]=await hBe(t);while(!await mBe(t,e,r))}catch(a){const l=jm("request:server",a,t.params,e);throw l.details.ssl=t.useSSL,(s=t.interceptor)!=null&&s.error&&t.interceptor.error(l),l}const i=t.params.url;if(r&&/\/sharing\/rest\/(accounts|portals)\/self/i.test(i)){if(!t.hasToken&&!t.credentialToken&&((o=r.user)!=null&&o.username)&&!BK(i)){const a=qp(i,!0);a&&yp.trustedServers.push(a)}Array.isArray(r.authorizedCrossOriginNoCorsDomains)&&rBe(r.authorizedCrossOriginNoCorsDomains)}const n=t.credential;if(n&&Gi){const a=Gi.findServerInfo(n.server);let l=a==null?void 0:a.owningSystemUrl;if(l){l=l.replace(/\/?$/,"/sharing");const c=Gi.findCredential(l,n.userId);c&&Gi._getIdenticalSvcIdx(l,c)===-1&&c.resources.unshift(l)}}return{data:r,getAllHeaders:e?()=>Array.from(e.headers):EE,getHeader:e?a=>e.headers.get(a):EE,httpStatus:(e==null?void 0:e.status)??200,requestOptions:t.params.requestOptions,ssl:t.useSSL,url:t.params.url}}async function mBe(t,e,r){var c;if(t.redoRequest)return t.redoRequest=!1,!1;const i=t.params.requestOptions;if(!e||i.responseType==="native"||i.responseType==="native-request-init")return!0;let n,s;if(r&&(r.error?n=r.error:r.status==="error"&&Array.isArray(r.messages)&&(n={...r},n[jk]=r,n.details=r.messages)),!n&&!e.ok)throw n=new Error(`Unable to load ${e.url} status: ${e.status}`),n[jk]=r,n;let o,a=null;n&&(s=Number(n.code),a=n.hasOwnProperty("subcode")?Number(n.subcode):null,o=n.messageCode,o=o==null?void 0:o.toUpperCase());const l=i.authMode;if(s===403&&(a===4||(c=n.message)!=null&&c.toLowerCase().includes("ssl")&&!n.message.toLowerCase().includes("permission"))){if(!t.useSSL)return t.useSSL=!0,!1}else if(!t.hasToken&&t.useIdentity&&(l!=="no-prompt"||s===498)&&s!==void 0&&sBe.has(s)&&!Rwe(t.params.url)&&(s!==403||(!o||!oBe.has(o))&&(a==null||a===2&&t.credentialToken))){await pW();try{const u=await Gi.getCredential(t.params.url,{error:jm("request:server",n,t.params),prompt:l!=="no-prompt",signal:t.controller.signal,token:t.credentialToken});return t.credential=u,t.credentialToken=u.token,t.useSSL=t.useSSL||u.ssl,!1}catch(u){if(l==="no-prompt")return t.credential=void 0,t.credentialToken=void 0,!1;n=u}}if(n)throw n;return!0}function dae(t,e,r=!1){const i=e.controller.signal,n=new Image;return e.withCredentials?n.crossOrigin="use-credentials":n.crossOrigin="anonymous",n.alt="",n.fetchPriority=yp.priority,n.src=t,Awe(n,t,r,i)}Xi._corsServers=["https://server.arcgisonline.com","https://services.arcgisonline.com"],Xi._beforeFetch=void 0,Xi._afterFetch=void 0;let o5=class $we{constructor(){this._emitter=new $we.EventEmitter(this)}emit(e,r){return this._emitter.emit(e,r)}on(e,r){return this._emitter.on(e,r)}once(e,r){return this._emitter.once(e,r)}hasEventListener(e){return this._emitter.hasEventListener(e)}};(function(t){class e{constructor(n=null){this._target=n,this._listenersMap=null}clear(){var n;(n=this._listenersMap)==null||n.clear(),this._listenersMap=null}destroy(){this.clear()}emit(n,s){var c;let o=(c=this._listenersMap)==null?void 0:c.get(n);if(!o)return!1;const a=this._target||this;let l=!1;for(const u of o.slice()){const h="deref"in u?u.deref():u;h?h==null||h.call(a,s):l=!0}return l&&(o=o.filter(u=>!("deref"in u)||u.deref()!=null),this._listenersMap.set(n,o)),o.length>0}on(n,s){if(Array.isArray(n)){const a=n.map(l=>this.on(l,s));return Hx(a)}if(n.includes(","))throw new TypeError("Evented.on() with a comma delimited string of event types is not supported");this._listenersMap??(this._listenersMap=new Map);const o=this._listenersMap.get(n)||[];return o.push(s),this._listenersMap.set(n,o),Zr(()=>{var c;const a=(c=this._listenersMap)==null?void 0:c.get(n),l=(a==null?void 0:a.indexOf(s))??-1;l>=0&&a.splice(l,1)})}once(n,s){const o=this.on(n,a=>{o.remove();const l="deref"in s?s.deref():s;l==null||l.call(null,a)});return o}hasEventListener(n){var o;const s=(o=this._listenersMap)==null?void 0:o.get(n);return s!=null&&s.length>0}}t.EventEmitter=e,t.EventedMixin=i=>{let n=class extends i{constructor(){super(...arguments),this._emitter=new e}destroy(){this._emitter.clear()}emit(s,o){return this._emitter.emit(s,o)}on(s,o){return this._emitter.on(s,o)}once(s,o){return this._emitter.once(s,o)}hasEventListener(s){return this._emitter.hasEventListener(s)}};return n=d([V("esri.core.Evented")],n),n};let r=class extends Ae{constructor(){super(...arguments),this._emitter=new o5.EventEmitter(this)}destroy(){this._emitter.clear()}emit(i,n){return this._emitter.emit(i,n)}on(i,n){return this._emitter.on(i,n)}once(i,n){return this._emitter.once(i,n)}hasEventListener(i){return this._emitter.hasEventListener(i)}};r=d([V("esri.core.Evented")],r),t.EventedAccessor=r})(o5||(o5={}));const Qn=o5;var vi;(function(t){t[t.ADD=1]="ADD",t[t.REMOVE=2]="REMOVE",t[t.MOVE=4]="MOVE"})(vi||(vi={}));function Iwe(t){return(e,r)=>{e[r]=t}}let EI=class extends Pbe{notify(){const e=this._observers;if(e&&e.length>0){const r=e.slice();for(const i of r)i.onInvalidated(),i.onCommitted()}}};var v0;let gBe=class{constructor(){this.target=null,this.cancellable=!1,this.defaultPrevented=!1,this.item=void 0,this.type=void 0}preventDefault(){this.cancellable&&(this.defaultPrevented=!0)}reset(e){this.defaultPrevented=!1,this.item=e}},yBe=class{constructor(e,r,i,n,s){this.target=e,this.added=r,this.removed=i,this.start=n,this.deleteCount=s}};const oh=new ua(gBe,void 0,t=>{t.item=null,t.target=null,t.defaultPrevented=!1,t.cancellable=!1});function VB(t){return t?t instanceof d0?t.toArray():t.length?Array.prototype.slice.apply(t):[]:[]}function GB(t){if(t!=null&&t.length)return t[0]}function _Be(t,e,r,i){const n=Math.min(t.length-r,e.length-i);let s=0;for(;s<n&&t[r+s]===e[i+s];)s++;return s}function Lwe(t,e,r,i){e&&e.forEach((n,s,o)=>{t.push(n),Lwe(t,r.call(i,n,s,o),r,i)})}const Iy=new Set,Ly=new Set,Dy=new Set,jB=new Map;let vBe=0,d0=v0=class extends Qn.EventedAccessor{static isCollection(t){return t!=null&&t instanceof v0}constructor(t){super(t),this._chgListeners=[],this._notifications=null,this._updating=!1,this._timer=null,this._observable=new EI,this.length=0,this._items=[],Object.defineProperty(this,"uid",{value:vBe++})}normalizeCtorArgs(t){return t?Array.isArray(t)||t instanceof v0?{items:t}:t:{}}destroy(){this._removeAllRaw()}*[Symbol.iterator](){yield*this.items}get items(){return Lt(this._observable),this._items}set items(t){this._emitBeforeChanges(vi.ADD)||(this._splice(0,this.length,VB(t)),this._emitAfterChanges(vi.ADD))}hasEventListener(t){return t==="change"?this._chgListeners.length>0:this._emitter.hasEventListener(t)}on(t,e){if(t==="change"){const r=this._chgListeners,i={removed:!1,callback:e};return r.push(i),this._notifications&&this._notifications.push({listeners:r.slice(),items:this._items.slice(),changes:[]}),Zr(()=>{i.removed=!0,r.splice(r.indexOf(i),1)})}return this._emitter.on(t,e)}once(t,e){const r="deref"in e?()=>e.deref():()=>e,i=this.on(t,n=>{var s;(s=r())==null||s.call(null,n),i.remove()});return i}add(t,e){if(Lt(this._observable),this._emitBeforeChanges(vi.ADD))return this;const r=this.getNextIndex(e??null);return this._splice(r,0,[t]),this._emitAfterChanges(vi.ADD),this}addMany(t,e=this._items.length){if(Lt(this._observable),!(t!=null&&t.length))return this;if(this._emitBeforeChanges(vi.ADD))return this;const r=this.getNextIndex(e);return this._splice(r,0,VB(t)),this._emitAfterChanges(vi.ADD),this}at(t){if(Lt(this._observable),(t=Math.trunc(t)||0)<0&&(t+=this.length),!(t<0||t>=this.length))return this._items[t]}removeAll(){if(Lt(this._observable),!this.length||this._emitBeforeChanges(vi.REMOVE))return[];const t=this._removeAllRaw();return this._emitAfterChanges(vi.REMOVE),t}_removeAllRaw(){return this.length===0?[]:this._splice(0,this.length)||[]}clone(){return Lt(this._observable),this._createNewInstance({items:this._items.map(_e)})}concat(...t){Lt(this._observable);const e=t.map(VB);return this._createNewInstance({items:this._items.concat(...e)})}drain(t,e){if(Lt(this._observable),!this.length||this._emitBeforeChanges(vi.REMOVE))return;const r=this._splice(0,this.length),i=r.length;for(let n=0;n<i;n++)t.call(e,r[n],n,r);this._emitAfterChanges(vi.REMOVE)}every(t,e){return Lt(this._observable),this._items.every(t,e)}filter(t,e){let r;return Lt(this._observable),r=arguments.length===2?this._items.filter(t,e):this._items.filter(t),this._createNewInstance({items:r})}find(t,e){return Lt(this._observable),this._items.find(t,e)}findIndex(t,e){return Lt(this._observable),this._items.findIndex(t,e)}flatten(t,e){Lt(this._observable);const r=[];return Lwe(r,this,t,e),new v0(r)}forEach(t,e){return Lt(this._observable),this._items.forEach(t,e)}getItemAt(t){return Lt(this._observable),this._items[t]}getNextIndex(t){Lt(this._observable);const e=this.length;return(t=t??e)<0?t=0:t>e&&(t=e),t}includes(t,e=0){return Lt(this._observable),this._items.includes(t,e)}indexOf(t,e=0){return Lt(this._observable),this._items.indexOf(t,e)}join(t=","){return Lt(this._observable),this._items.join(t)}lastIndexOf(t,e=this.length-1){return Lt(this._observable),this._items.lastIndexOf(t,e)}map(t,e){Lt(this._observable);const r=this._items.map(t,e);return new v0({items:r})}reorder(t,e=this.length-1){Lt(this._observable);const r=this.indexOf(t);if(r!==-1){if(e<0?e=0:e>=this.length&&(e=this.length-1),r!==e){if(this._emitBeforeChanges(vi.MOVE))return t;this._splice(r,1),this._splice(e,0,[t]),this._emitAfterChanges(vi.MOVE)}return t}}pop(){if(Lt(this._observable),!this.length||this._emitBeforeChanges(vi.REMOVE))return;const t=GB(this._splice(this.length-1,1));return this._emitAfterChanges(vi.REMOVE),t}push(...t){return Lt(this._observable),this._emitBeforeChanges(vi.ADD)||(this._splice(this.length,0,t),this._emitAfterChanges(vi.ADD)),this.length}reduce(t,e){Lt(this._observable);const r=this._items;return arguments.length===2?r.reduce(t,e):r.reduce(t)}reduceRight(t,e){Lt(this._observable);const r=this._items;return arguments.length===2?r.reduceRight(t,e):r.reduceRight(t)}remove(t){return Lt(this._observable),this.removeAt(this.indexOf(t))}removeAt(t){if(Lt(this._observable),t<0||t>=this.length||this._emitBeforeChanges(vi.REMOVE))return;const e=GB(this._splice(t,1));return this._emitAfterChanges(vi.REMOVE),e}removeMany(t){if(Lt(this._observable),!(t!=null&&t.length)||this._emitBeforeChanges(vi.REMOVE))return[];const e=t instanceof v0?t.toArray():t,r=this._items,i=[],n=e.length;for(let s=0;s<n;s++){const o=e[s],a=r.indexOf(o);if(a>-1){const l=1+_Be(e,r,s+1,a+1),c=this._splice(a,l);c&&c.length>0&&i.push.apply(i,c),s+=l-1}}return this._emitAfterChanges(vi.REMOVE),i}reverse(){if(Lt(this._observable),this._emitBeforeChanges(vi.MOVE))return this;const t=this._splice(0,this.length);return t&&(t.reverse(),this._splice(0,0,t)),this._emitAfterChanges(vi.MOVE),this}shift(){if(Lt(this._observable),!this.length||this._emitBeforeChanges(vi.REMOVE))return;const t=GB(this._splice(0,1));return this._emitAfterChanges(vi.REMOVE),t}slice(t=0,e=this.length){return Lt(this._observable),this._createNewInstance({items:this._items.slice(t,e)})}some(t,e){return Lt(this._observable),this._items.some(t,e)}sort(t){if(Lt(this._observable),!this.length||this._emitBeforeChanges(vi.MOVE))return this;const e=this._splice(0,this.length);return arguments.length?e.sort(t):e.sort(),this._splice(0,0,e),this._emitAfterChanges(vi.MOVE),this}splice(t,e,...r){Lt(this._observable);const i=(e?vi.REMOVE:0)|(r.length?vi.ADD:0);if(this._emitBeforeChanges(i))return[];const n=this._splice(t,e,r)||[];return this._emitAfterChanges(i),n}toArray(){return Lt(this._observable),this._items.slice()}toJSON(){return Lt(this._observable),this.toArray()}toLocaleString(){return Lt(this._observable),this._items.toLocaleString()}toString(){return Lt(this._observable),this._items.toString()}unshift(...t){return Lt(this._observable),!t.length||this._emitBeforeChanges(vi.ADD)||(this._splice(0,0,t),this._emitAfterChanges(vi.ADD)),this.length}_createNewInstance(t){return new this.constructor(t)}_splice(t,e,r){const i=this._items,n=this.itemType;let s,o;if(!this._notifications&&this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._updating=!0,this._timer=M3(()=>this._dispatchChange())),t<0&&(t+=this.length),e){if(o=i.splice(t,e),this.hasEventListener("before-remove")){const a=oh.acquire();a.target=this,a.cancellable=!0;for(let l=0,c=o.length;l<c;l++)s=o[l],a.reset(s),this.emit("before-remove",a),a.defaultPrevented&&(o.splice(l,1),i.splice(t,0,s),t+=1,l-=1,c-=1);oh.release(a)}if(this.length=this._items.length,this.hasEventListener("after-remove")){const a=oh.acquire();a.target=this,a.cancellable=!1;const l=o.length;for(let c=0;c<l;c++)a.reset(o[c]),this.emit("after-remove",a);oh.release(a)}}if(r!=null&&r.length){if(n){const u=[];for(const h of r){const p=n.ensureType(h);p==null&&h!=null||u.push(p)}r=u}const a=this.hasEventListener("before-add"),l=this.hasEventListener("after-add"),c=t===this.length;if(a||l){const u=oh.acquire();u.target=this,u.cancellable=!0;const h=oh.acquire();h.target=this,h.cancellable=!1;for(const p of r)a?(u.reset(p),this.emit("before-add",u),u.defaultPrevented||(c?i.push(p):i.splice(t++,0,p),this._set("length",i.length),l&&(h.reset(p),this.emit("after-add",h)))):(c?i.push(p):i.splice(t++,0,p),this._set("length",i.length),h.reset(p),this.emit("after-add",h));oh.release(h),oh.release(u)}else{if(c)for(const u of r)i.push(u);else i.splice(t,0,...r);this._set("length",i.length)}}if((r!=null&&r.length||o!=null&&o.length)&&this._notifyChangeEvent(r,o),this.hasEventListener("after-splice")){const a=new yBe(this,r,o,t,e);this.emit("after-splice",a)}return o}_emitBeforeChanges(t){let e=!1;if(this.hasEventListener("before-changes")){const r=oh.acquire();r.target=this,r.cancellable=!0,r.type=t,this.emit("before-changes",r),e=r.defaultPrevented,oh.release(r)}return e}_emitAfterChanges(t){if(this.hasEventListener("after-changes")){const e=oh.acquire();e.target=this,e.cancellable=!1,e.type=t,this.emit("after-changes",e),oh.release(e)}this._observable.notify()}_notifyChangeEvent(t,e){this.hasEventListener("change")&&this._notifications&&this._notifications[this._notifications.length-1].changes.push({added:t,removed:e})}get updating(){return this._updating}_dispatchChange(){if(this._timer&&(this._timer.remove(),this._timer=null),this._updating=!1,!this._notifications)return;const t=this._notifications;this._notifications=null;for(const e of t){const r=e.changes;Iy.clear(),Ly.clear(),Dy.clear();for(const{added:l,removed:c}of r){if(l)if(Dy.size===0&&Ly.size===0)for(const u of l)Iy.add(u);else for(const u of l)Ly.has(u)?(Dy.add(u),Ly.delete(u)):Dy.has(u)||Iy.add(u);if(c)if(Dy.size===0&&Iy.size===0)for(const u of c)Ly.add(u);else for(const u of c)Iy.has(u)?Iy.delete(u):(Dy.delete(u),Ly.add(u))}const i=Dc.acquire();Iy.forEach(l=>{i.push(l)});const n=Dc.acquire();Ly.forEach(l=>{n.push(l)});const s=this._items,o=e.items,a=Dc.acquire();if(Dy.forEach(l=>{o.indexOf(l)!==s.indexOf(l)&&a.push(l)}),e.listeners&&(i.length||n.length||a.length)){const l={target:this,added:i,removed:n,moved:a},c=e.listeners.length;for(let u=0;u<c;u++){const h=e.listeners[u];h.removed||h.callback.call(this,l)}}Dc.release(i),Dc.release(n),Dc.release(a)}Iy.clear(),Ly.clear(),Dy.clear()}};d0.ofType=t=>{if(!t)return v0;if(jB.has(t))return jB.get(t);let e=null;if(typeof t=="function")e=t.prototype.declaredClass;else if(t.base)e=t.base.prototype.declaredClass;else for(const i in t.typeMap){const n=t.typeMap[i].prototype.declaredClass;e?e+=` | ${n}`:e=n}let r=class extends v0{};return d([Iwe({Type:t,ensureType:typeof t=="function"?Na(t):ig(t)})],r.prototype,"itemType",void 0),r=d([V(`esri.core.Collection<${e}>`)],r),jB.set(t,r),r},d([m()],d0.prototype,"_updating",void 0),d([m()],d0.prototype,"length",void 0),d([m()],d0.prototype,"items",null),d([m({readOnly:!0})],d0.prototype,"updating",null),d0=v0=d([V("esri.core.Collection")],d0);const $t=d0;function Xx(t,e,r=$t){return e||(e=new r),e===t||(e.removeAll(),bBe(t)?e.addMany(t):t&&e.add(t)),e}function Dwe(t){return t}function bBe(t){return t&&(Array.isArray(t)||"items"in t&&Array.isArray(t.items))}var Y_;(function(t){t[t.PENDING=0]="PENDING",t[t.RESOLVED=1]="RESOLVED",t[t.REJECTED=2]="REJECTED"})(Y_||(Y_={}));let wBe=class{constructor(){this._resolver=ha(),this._status=Y_.PENDING,this._resolvingPromises=[],this._resolver.promise.then(()=>{this._status=Y_.RESOLVED,this._cleanUp()},()=>{this._status=Y_.REJECTED,this._cleanUp()}),this.promise=this._resolver.promise}destroy(){this._cleanUp()}addResolvingPromise(e){this._resolvingPromises.push(e),this._tryResolve()}isResolved(){return this._status===Y_.RESOLVED}isRejected(){return this._status===Y_.REJECTED}isFulfilled(){return this._status!==Y_.PENDING}abort(){this._resolver.reject(dr())}_cleanUp(){this._allPromise=null,this._resolvingPromises=null}_tryResolve(){if(this.isFulfilled())return;const e=ha(),r=[...this._resolvingPromises,e.promise],i=this._allPromise=Promise.all(r);i.then(()=>{this.isFulfilled()||this._allPromise!==i||this._resolver.resolve()},n=>{this.isFulfilled()||this._allPromise!==i||_s(n)||this._resolver.reject(n)}),e.resolve()}};const Gz=t=>{let e=class extends t{constructor(...r){super(...r),this._promiseProps=new wBe,this.addResolvingPromise(Promise.resolve())}destroy(){this._promiseProps.destroy()}isResolved(){return this._promiseProps.isResolved()}isRejected(){return this._promiseProps.isRejected()}isFulfilled(){return this._promiseProps.isFulfilled()}when(r,i){return this._promiseProps.promise.then(()=>this).then(r,i)}catch(r){return this.when(null,r)}addResolvingPromise(r){r&&!this._promiseProps.isFulfilled()&&this._promiseProps.addResolvingPromise("_promiseProps"in r?r.when():r)}};return e=d([V("esri.core.Promise")],e),e};let Hk=class extends Gz(Ae){};Hk=d([V("esri.core.Promise")],Hk);const xBe="not-loaded",TBe="loading",SBe="failed",pae="loaded",Nwe=t=>{let e=class extends t{constructor(...r){super(...r),this._loadController=null,this.loadError=null,this.loadStatus="not-loaded",this._set("loadWarnings",[]),this.addResolvingPromise(new Promise(i=>{const n=this.load.bind(this);this.load=s=>{const o=new Promise((a,l)=>{const c=Dz(s,l);this.destroyed&&l(new K("load:instance-destroyed",`Instance of '${this.declaredClass||this.constructor.name}' is already destroyed`,{instance:this})),this.when(a,l).finally(()=>{c&&c.remove()})});if(this.loadStatus===xBe){this._set("loadStatus",TBe);const a=this._loadController=new AbortController;n({signal:a.signal})}return i(),o}})),this.when(()=>{this._set("loadStatus",pae),this._loadController=null},i=>{this._set("loadStatus",SBe),this._set("loadError",i),this._loadController=null})}destroy(){this._loadController&&(this._loadController=wl(this._loadController),this._promiseProps.abort()),this._set("loadError",null),this._set("loadWarnings",[])}get loaded(){return this.loadStatus===pae}get loadWarnings(){return this._get("loadWarnings")}load(){return null}cancelLoad(){var r;return this.isFulfilled()||(this._set("loadError",new K("load:cancelled","Cancelled")),(r=this._loadController)==null||r.abort(),this._promiseProps.abort()),this}};return d([m({readOnly:!0})],e.prototype,"loaded",null),d([m({readOnly:!0})],e.prototype,"loadError",void 0),d([m({clonable:!1})],e.prototype,"loadStatus",void 0),d([m({type:[tv],readOnly:!0})],e.prototype,"loadWarnings",null),e=d([V("esri.core.Loadable")],e),e};let $A=class extends Nwe(Hk){};$A=d([V("esri.core.Loadable")],$A),function(t){function e(r){return!(!r||!r.load)}t.LoadableMixin=Nwe,t.isLoadable=e}($A||($A={}));const Q0=$A;function jz(t,e,r){return MK(t.map((i,n)=>e.apply(r,[i,n])))}async function CBe(t,e,r){return(await MK(t.map((i,n)=>e.apply(r,[i,n])))).map(i=>i.value)}function WK(t){return{ok:!0,value:t}}function qK(t){return{ok:!1,error:t}}function EBe(t){return t!=null&&t.ok===!0?t.value:null}function PBe(t){return t!=null&&t.ok===!1?t.error:null}async function sg(t){if(t==null)return{ok:!1,error:new Error("no promise provided")};try{return WK(await t)}catch(e){return qK(e)}}async function $5t(t){try{return WK(await t)}catch(e){return J0(e),qK(e)}}function I5t(t){if(t.ok===!0)return t.value;throw t.error}function dy(t,e){return new y_(t,e)}let y_=class extends Ae{get value(){return EBe(this._result)}get error(){return PBe(this._result)}get finished(){return this._result!=null}constructor(e,r){super({}),this._result=null,this._abortHandle=null,this.abort=()=>{this._abortController=wl(this._abortController)},this.remove=this.abort,this._abortController=new AbortController;const{signal:i}=this._abortController;this.promise=e(i),this.promise.then(n=>{this._result=WK(n),this._cleanup()},n=>{this._result=qK(n),this._cleanup()}),this._abortHandle=ca(r,this.abort)}normalizeCtorArgs(){return{}}destroy(){this.abort()}_cleanup(){this._abortHandle=wi(this._abortHandle),this._abortController=null}};d([m()],y_.prototype,"value",null),d([m()],y_.prototype,"error",null),d([m()],y_.prototype,"finished",null),d([m()],y_.prototype,"promise",void 0),d([m()],y_.prototype,"_result",void 0),y_=d([V("esri.core.asyncUtils.ReactiveTask")],y_);async function Fwe(t,e){return await t.load(),ABe(t,e)}async function ABe(t,e){const r=[],i=(...s)=>{for(const o of s)o!=null&&(Array.isArray(o)?i(...o):$t.isCollection(o)?o.forEach(a=>i(a)):Q0.isLoadable(o)&&r.push(o))};e(i);let n=null;if(await CBe(r,async s=>{const o=await sg(MBe(s)?s.loadAll():s.load());o.ok!==!1||n||(n=o)}),n)throw n.error;return t}function MBe(t){return"loadAll"in t&&typeof t.loadAll=="function"}function hr(t,e,r){let i,n;return e===void 0?(n=t,i=[void 0]):typeof e!="string"?(n=t,i=[void 0],r=e):(n=e,i=Array.isArray(t)?t:[t]),(s,o)=>{const a=s.constructor.prototype;for(const l of i){const c=ewe(s,l,n);c.write&&typeof c.write=="object"||(c.write={}),r&&(c.write.target=r),c.write.writer=a[o]}}}let yn=class{constructor(e,r={ignoreUnknown:!1,useNumericKeys:!1}){this._jsonToAPI=e,this._options=r,this.apiValues=[],this.jsonValues=[],this._apiToJSON=this._invertMap(e),this.apiValues=this._getKeysSorted(this._apiToJSON),this.jsonValues=this._getKeysSorted(this._jsonToAPI),this.read=i=>this.fromJSON(i),this.write=(i,n,s)=>{const o=this.toJSON(i);o!==void 0&&E2(s,o,n)},this.write.isJSONMapWriter=!0}toJSON(e){if(e==null)return null;if(this._apiToJSON.hasOwnProperty(e)){const r=this._apiToJSON[e];return this._options.useNumericKeys?+r:r}return this._options.ignoreUnknown?void 0:e}fromJSON(e){return e!=null&&this._jsonToAPI.hasOwnProperty(e)?this._jsonToAPI[e]:this._options.ignoreUnknown?void 0:e}_invertMap(e){const r={};for(const i in e)r[e[i]]=i;return r}_getKeysSorted(e){const r=[];for(const i in e)r.push(i);return r.sort(),r}};function ac(){return function(t,e){return new yn(t,{ignoreUnknown:!0,...e})}}let YK=class{constructor(e,r,i,n){this.semiMajorAxis=e,this.flattening=r,this.outerAtmosphereRimWidth=i;const s=1-this.flattening;this.semiMinorAxis=this.semiMajorAxis*s,this.halfSemiMajorAxis=this.semiMajorAxis/2,this.halfCircumference=Math.PI*this.semiMajorAxis,this.metersPerDegree=this.halfCircumference/180,this.inverseFlattening=1/(1-this.flattening)-1,this.eccentricitySquared=n||2*this.flattening-this.flattening*this.flattening,this.meanRadiusSemiAxes=(2*this.semiMajorAxis+this.semiMinorAxis)/3}get radius(){return this.semiMajorAxis}};const Yr=new YK(6378137,1/298.257223563,3e5,.006694379990137799),Yp=new YK(3396190,1/169.8944472236118,23e4),K0=new YK(1737400,0,0);function OBe(t,e){return Xi(ii(t),e)}function ii(t){if(!mi.assetsPath)throw re.getLogger("esri.assets").errorOnce("The API assets location needs to be set using config.assetsPath. More information: https://arcg.is/1OzLe50"),new K("assets:path-not-set","config.assetsPath is not set");return Bz(mi.assetsPath,t)}let HB,oe=null;function kwe(){return!!oe}function RBe(){return!!se("esri-wasm")}function zwe(){return HB||(HB=ge(()=>import("./pe-wasm-CX9fkHAh.js"),__vite__mapDeps([])).then(t=>t.p).then(({default:t})=>t({locateFile:e=>ii(`esri/geometry/support/${e}`)})).then(t=>{Bwe(t)}),HB)}var fW,Hn,mW;(function(t){function e(s,o,a){oe.ensureCache.prepare();const l=kw(a),c=a===l,u=oe.ensureFloat64(l),h=oe._pe_geog_to_proj(oe.getPointer(s),o,u);return h&&a1(a,o,u,c),h}function r(s,o,a,l){switch(l){case Hn.PE_TRANSFORM_P_TO_G:return i(s,o,a);case Hn.PE_TRANSFORM_G_TO_P:return e(s,o,a)}return 0}function i(s,o,a){return n(s,o,a,0)}function n(s,o,a,l){oe.ensureCache.prepare();const c=kw(a),u=a===c,h=oe.ensureFloat64(c),p=oe._pe_proj_to_geog_center(oe.getPointer(s),o,h,l);return p&&a1(a,o,h,u),p}t.geogToProj=e,t.projGeog=r,t.projToGeog=i,t.projToGeogCenter=n})(fW||(fW={})),function(t){function e(){t.PE_BUFFER_MAX=oe.PeDefs.prototype.PE_BUFFER_MAX,t.PE_NAME_MAX=oe.PeDefs.prototype.PE_NAME_MAX,t.PE_MGRS_MAX=oe.PeDefs.prototype.PE_MGRS_MAX,t.PE_USNG_MAX=oe.PeDefs.prototype.PE_USNG_MAX,t.PE_DD_MAX=oe.PeDefs.prototype.PE_DD_MAX,t.PE_DDM_MAX=oe.PeDefs.prototype.PE_DDM_MAX,t.PE_DMS_MAX=oe.PeDefs.prototype.PE_DMS_MAX,t.PE_UTM_MAX=oe.PeDefs.prototype.PE_UTM_MAX,t.PE_PARM_MAX=oe.PeDefs.prototype.PE_PARM_MAX,t.PE_TYPE_NONE=oe.PeDefs.prototype.PE_TYPE_NONE,t.PE_TYPE_GEOGCS=oe.PeDefs.prototype.PE_TYPE_GEOGCS,t.PE_TYPE_PROJCS=oe.PeDefs.prototype.PE_TYPE_PROJCS,t.PE_TYPE_GEOGTRAN=oe.PeDefs.prototype.PE_TYPE_GEOGTRAN,t.PE_TYPE_COORDSYS=oe.PeDefs.prototype.PE_TYPE_COORDSYS,t.PE_TYPE_UNIT=oe.PeDefs.prototype.PE_TYPE_UNIT,t.PE_TYPE_LINUNIT=oe.PeDefs.prototype.PE_TYPE_LINUNIT,t.PE_STR_OPTS_NONE=oe.PeDefs.prototype.PE_STR_OPTS_NONE,t.PE_STR_AUTH_NONE=oe.PeDefs.prototype.PE_STR_AUTH_NONE,t.PE_STR_AUTH_TOP=oe.PeDefs.prototype.PE_STR_AUTH_TOP,t.PE_STR_NAME_CANON=oe.PeDefs.prototype.PE_STR_NAME_CANON,t.PE_STR_FMT_WKT=oe.PeDefs.prototype.PE_STR_FMT_WKT,t.PE_STR_FMT_WKT2=oe.PeDefs.prototype.PE_STR_FMT_WKT2,t.PE_PARM_X0=oe.PeDefs.prototype.PE_PARM_X0,t.PE_PARM_ND=oe.PeDefs.prototype.PE_PARM_ND,t.PE_TRANSFORM_1_TO_2=oe.PeDefs.prototype.PE_TRANSFORM_1_TO_2,t.PE_TRANSFORM_2_TO_1=oe.PeDefs.prototype.PE_TRANSFORM_2_TO_1,t.PE_TRANSFORM_P_TO_G=oe.PeDefs.prototype.PE_TRANSFORM_P_TO_G,t.PE_TRANSFORM_G_TO_P=oe.PeDefs.prototype.PE_TRANSFORM_G_TO_P,t.PE_HORIZON_RECT=oe.PeDefs.prototype.PE_HORIZON_RECT,t.PE_HORIZON_POLY=oe.PeDefs.prototype.PE_HORIZON_POLY,t.PE_HORIZON_LINE=oe.PeDefs.prototype.PE_HORIZON_LINE,t.PE_HORIZON_DELTA=oe.PeDefs.prototype.PE_HORIZON_DELTA}t.init=e}(Hn||(Hn={})),function(t){const e={},r={},i=f=>{if(f){const g=f.getType();switch(g){case Hn.PE_TYPE_GEOGCS:f=oe.castObject(f,oe.PeGeogcs);break;case Hn.PE_TYPE_PROJCS:f=oe.castObject(f,oe.PeProjcs);break;case Hn.PE_TYPE_GEOGTRAN:f=oe.castObject(f,oe.PeGeogtran);break;default:g&Hn.PE_TYPE_UNIT&&(f=oe.castObject(f,oe.PeUnit))}}return f};function n(){oe.PeFactory.prototype.initialize(null)}function s(f){return o(Hn.PE_TYPE_COORDSYS,f)}function o(f,g){let _=null,v=e[f];if(v||(v={},e[f]=v),v.hasOwnProperty(String(g)))_=v[g];else{const b=oe.PeFactory.prototype.factoryByType(f,g);oe.compare(b,oe.NULL)||(_=b,v[g]=_)}return _=i(_),_}function a(f,g){let _=null,v=r[f];if(v||(v={},r[f]=v),v.hasOwnProperty(g))_=v[g];else{const b=oe.PeFactory.prototype.fromString(f,g);oe.compare(b,oe.NULL)||(_=b,v[g]=_)}return _=i(_),_}function l(f){return o(Hn.PE_TYPE_GEOGCS,f)}function c(f){return o(Hn.PE_TYPE_GEOGTRAN,f)}function u(f){return oe.PeFactory.prototype.getCode(f)}function h(f){return o(Hn.PE_TYPE_PROJCS,f)}function p(f){return o(Hn.PE_TYPE_UNIT,f)}t.initialize=n,t.coordsys=s,t.factoryByType=o,t.fromString=a,t.geogcs=l,t.geogtran=c,t.getCode=u,t.projcs=h,t.unit=p}(mW||(mW={}));let Uwe=null;var Wk,gW,yW,_W,qk,vW,Yk,Xk,bW;function Bwe(t){function e(s,o,a){s[o]=a(s[o])}oe=t,Hn.init(),Wk.init(),qk.init(),Yk.init(),Xk.init(),Uwe=class extends oe.PeGCSExtent{destroy(){oe.destroy(this)}};const r=[oe.PeDatum,oe.PeGeogcs,oe.PeGeogtran,oe.PeObject,oe.PeParameter,oe.PePrimem,oe.PeProjcs,oe.PeSpheroid,oe.PeUnit];for(const s of r)e(s.prototype,"getName",o=>function(){return o.call(this,new Array(Hn.PE_NAME_MAX))});for(const s of[oe.PeGeogtran,oe.PeProjcs])e(s.prototype,"getParameters",o=>function(){const a=new Array(Hn.PE_PARM_MAX);let l=o.call(this);for(let c=0;c<a.length;c++){const u=oe.getValue(l,"*");a[c]=u?oe.wrapPointer(u,oe.PeParameter):null,l+=Int32Array.BYTES_PER_ELEMENT}return a});e(oe.PeHorizon.prototype,"getCoord",s=>function(){const o=this.getSize();if(!o)return null;const a=[];return a1(a,o,s.call(this)),a}),e(oe.PeGTlistExtendedEntry.prototype,"getEntries",s=>{const o=oe._pe_getPeGTlistExtendedGTsSize();return function(){let a=null;const l=s.call(this);if(!oe.compare(l,oe.NULL)){a=[l];const c=this.getSteps();if(c>1){const u=oe.getPointer(l);for(let h=1;h<c;h++)a.push(oe.wrapPointer(u+o*h,oe.PeGTlistExtendedGTs))}}return a}});const i=oe._pe_getPeHorizonSize(),n=s=>function(){let o=this._cache;if(o||(o=new Map,this._cache=o),o.has(s))return o.get(s);let a=null;const l=s.call(this);if(!oe.compare(l,oe.NULL)){a=[l];const c=l.getNump();if(c>1){const u=oe.getPointer(l);for(let h=1;h<c;h++)a.push(oe.wrapPointer(u+i*h,oe.PeHorizon))}}return o.set(s,a),a};e(oe.PeProjcs.prototype,"horizonGcsGenerate",n),e(oe.PeProjcs.prototype,"horizonPcsGenerate",n),oe.PeObject.prototype.toString=function(s=Hn.PE_STR_OPTS_NONE){oe.ensureCache.prepare();const o=oe.getPointer(this),a=oe.ensureInt8(new Array(Hn.PE_BUFFER_MAX));return oe.UTF8ToString(oe._pe_object_to_string_ext(o,s,a))}}function Pg(t){if(!t)return;const e=oe.getClass(t);if(!e)return;const r=oe.getCache(e);if(!r)return;const i=oe.getPointer(t);i&&delete r[i]}function HL(t,e){const r=[],i=new Array(e);for(let n=0;n<t;n++)r.push(oe.ensureInt8(i));return r}function kw(t){let e;return Array.isArray(t[0])?(e=[],t.forEach(r=>{e.push(r[0],r[1])})):e=t,e}function a1(t,e,r,i=!1){if(i)for(let n=0;n<2*e;n++)t[n]=oe.getValue(r+n*Float64Array.BYTES_PER_ELEMENT,"double");else{const n=t.length===0;for(let s=0;s<e;s++)n&&(t[s]=new Array(2)),t[s][0]=oe.getValue(r,"double"),t[s][1]=oe.getValue(r+Float64Array.BYTES_PER_ELEMENT,"double"),r+=2*Float64Array.BYTES_PER_ELEMENT}}(function(t){let e;function r(){t.PE_GTLIST_OPTS_COMMON=oe.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON,e=oe._pe_getPeGTlistExtendedEntrySize()}function i(n,s,o,a,l,c){let u=null;const h=new oe.PeInteger(c);try{const p=oe.PeGTlistExtended.prototype.getGTlist(n,s,o,a,l,h);if((c=h.val)&&(u=[p],c>1)){const f=oe.getPointer(p);for(let g=1;g<c;g++)u.push(oe.wrapPointer(f+e*g,oe.PeGTlistExtendedEntry))}}finally{oe.destroy(h)}return u}t.init=r,t.getGTlist=i})(Wk||(Wk={})),function(t){function e(r){if(r!=null&&r.length){for(const i of r)Pg(i),i.getEntries().forEach(n=>{Pg(n);const s=n.getGeogtran();Pg(s),s.getParameters().forEach(Pg),[s.getGeogcs1(),s.getGeogcs2()].forEach(o=>{Pg(o);const a=o.getDatum();Pg(a),Pg(a.getSpheroid()),Pg(o.getPrimem()),Pg(o.getUnit())})});oe.PeGTlistExtendedEntry.prototype.Delete(r[0])}}t.destroy=e}(gW||(gW={})),function(t){function e(r,i,n,s,o){oe.ensureCache.prepare();const a=kw(n),l=n===a,c=oe.ensureFloat64(a);let u=0;s&&(u=oe.ensureFloat64(s));const h=oe._pe_geog_to_geog(oe.getPointer(r),i,c,u,o);return h&&a1(n,i,c,l),h}t.geogToGeog=e}(yW||(yW={})),function(t){const e=(c,u,h,p,f,g)=>{let _,v;switch(oe.ensureCache.prepare(),c){case"dd":_=oe._pe_geog_to_dd,v=Hn.PE_DD_MAX;break;case"ddm":_=oe._pe_geog_to_ddm,v=Hn.PE_DDM_MAX;break;case"dms":_=oe._pe_geog_to_dms,v=Hn.PE_DMS_MAX}let b=0;u&&(b=oe.getPointer(u));const w=kw(p),x=oe.ensureFloat64(w),S=HL(h,v),E=_(b,h,x,f,oe.ensureInt32(S));if(E)for(let A=0;A<h;A++)g[A]=oe.UTF8ToString(S[A]);return E},r=(c,u,h,p,f)=>{let g;switch(oe.ensureCache.prepare(),c){case"dd":g=oe._pe_dd_to_geog;break;case"ddm":g=oe._pe_ddm_to_geog;break;case"dms":g=oe._pe_dms_to_geog}let _=0;u&&(_=oe.getPointer(u));const v=p.map(S=>oe.ensureString(S)),b=oe.ensureInt32(v),w=oe.ensureFloat64(new Array(2*h)),x=g(_,h,b,w);return x&&a1(f,h,w),x};function i(c,u,h,p,f){return e("dms",c,u,h,p,f)}function n(c,u,h,p){return r("dms",c,u,h,p)}function s(c,u,h,p,f){return e("ddm",c,u,h,p,f)}function o(c,u,h,p){return r("ddm",c,u,h,p)}function a(c,u,h,p,f){return e("dd",c,u,h,p,f)}function l(c,u,h,p){return r("dd",c,u,h,p)}t.geogToDms=i,t.dmsToGeog=n,t.geogToDdm=s,t.ddmToGeog=o,t.geogToDd=a,t.ddToGeog=l}(_W||(_W={})),function(t){function e(){t.PE_MGRS_STYLE_NEW=oe.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW,t.PE_MGRS_STYLE_OLD=oe.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD,t.PE_MGRS_STYLE_AUTO=oe.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO,t.PE_MGRS_180_ZONE_1_PLUS=oe.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS,t.PE_MGRS_ADD_SPACES=oe.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES}function r(n,s,o,a,l,c,u){oe.ensureCache.prepare();let h=0;n&&(h=oe.getPointer(n));const p=kw(o),f=oe.ensureFloat64(p),g=HL(s,Hn.PE_MGRS_MAX),_=oe.ensureInt32(g),v=oe._pe_geog_to_mgrs_extended(h,s,f,a,l,c,_);if(v)for(let b=0;b<s;b++)u[b]=oe.UTF8ToString(g[b]);return v}function i(n,s,o,a,l){oe.ensureCache.prepare();let c=0;n&&(c=oe.getPointer(n));const u=o.map(g=>oe.ensureString(g)),h=oe.ensureInt32(u),p=oe.ensureFloat64(new Array(2*s)),f=oe._pe_mgrs_to_geog_extended(c,s,h,a,p);return f&&a1(l,s,p),f}t.init=e,t.geogToMgrsExtended=r,t.mgrsToGeogExtended=i}(qk||(qk={})),function(t){function e(i,n,s,o,a,l,c){oe.ensureCache.prepare();let u=0;i&&(u=oe.getPointer(i));const h=kw(s),p=oe.ensureFloat64(h),f=HL(n,Hn.PE_MGRS_MAX),g=oe.ensureInt32(f),_=oe._pe_geog_to_usng(u,n,p,o,a,l,g);if(_)for(let v=0;v<n;v++)c[v]=oe.UTF8ToString(f[v]);return _}function r(i,n,s,o){oe.ensureCache.prepare();let a=0;i&&(a=oe.getPointer(i));const l=s.map(p=>oe.ensureString(p)),c=oe.ensureInt32(l),u=oe.ensureFloat64(new Array(2*n)),h=oe._pe_usng_to_geog(a,n,c,u);return h&&a1(o,n,u),h}t.geogToUsng=e,t.usngToGeog=r}(vW||(vW={})),function(t){function e(){t.PE_UTM_OPTS_NONE=oe.PeNotationUtm.prototype.PE_UTM_OPTS_NONE,t.PE_UTM_OPTS_ADD_SPACES=oe.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES,t.PE_UTM_OPTS_NS=oe.PeNotationUtm.prototype.PE_UTM_OPTS_NS}function r(n,s,o,a,l){oe.ensureCache.prepare();let c=0;n&&(c=oe.getPointer(n));const u=kw(o),h=oe.ensureFloat64(u),p=HL(s,Hn.PE_UTM_MAX),f=oe.ensureInt32(p),g=oe._pe_geog_to_utm(c,s,h,a,f);if(g)for(let _=0;_<s;_++)l[_]=oe.UTF8ToString(p[_]);return g}function i(n,s,o,a,l){oe.ensureCache.prepare();let c=0;n&&(c=oe.getPointer(n));const u=o.map(g=>oe.ensureString(g)),h=oe.ensureInt32(u),p=oe.ensureFloat64(new Array(2*s)),f=oe._pe_utm_to_geog(c,s,h,a,p);return f&&a1(l,s,p),f}t.init=e,t.geogToUtm=r,t.utmToGeog=i}(Yk||(Yk={})),function(t){const e=new Map;function r(){t.PE_PCSINFO_OPTION_NONE=oe.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE,t.PE_PCSINFO_OPTION_DOMAIN=oe.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN,t.PE_POLE_OUTSIDE_BOUNDARY=oe.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY,t.PE_POLE_POINT=oe.PePCSInfo.prototype.PE_POLE_POINT}function i(n,s=t.PE_PCSINFO_OPTION_DOMAIN){let o=null,a=null;return e.has(n)&&(a=e.get(n),a[s]&&(o=a[s])),o||(o=oe.PePCSInfo.prototype.generate(n,s),a||(a=[],e.set(n,a)),a[s]=o),o}t.init=r,t.generate=i}(Xk||(Xk={})),function(t){function e(){return oe.PeVersion.prototype.version_string()}t.versionString=e}(bW||(bW={}));const $Be=Object.freeze(Object.defineProperty({__proto__:null,get PeCSTransformations(){return fW},get PeDefs(){return Hn},get PeFactory(){return mW},get PeGCSExtent(){return Uwe},get PeGTTransformations(){return yW},get PeGTlistExtended(){return Wk},get PeGTlistExtendedEntry(){return gW},get PeNotationDms(){return _W},get PeNotationMgrs(){return qk},get PeNotationUsng(){return vW},get PeNotationUtm(){return Yk},get PePCSInfo(){return Xk},get PeVersion(){return bW},_init:Bwe,get _pe(){return oe},isLoaded:kwe,isSupported:RBe,load:zwe},Symbol.toStringTag,{value:"Module"}));var Wh;(function(t){t[t.CGCS2000=4490]="CGCS2000",t[t.GCSMARS2000=104971]="GCSMARS2000",t[t.GCSMARS2000_SPHERE=104905]="GCSMARS2000_SPHERE",t[t.GCSMOON2000=104903]="GCSMOON2000"})(Wh||(Wh={}));let y;const N={values:[1,.3048,.3048006096012192,.3047972654,.9143917962,.201166195164,.9143984146160287,.3047994715386762,20.11676512155263,20.11678249437587,.9143985307444408,.91439523,.3047997101815088,20.1168,20.116756,5e4,15e4],units:["Meter","Foot","Foot_US","Foot_Clarke","Yard_Clarke","Link_Clarke","Yard_Sears","Foot_Sears","Chain_Sears","Chain_Benoit_1895_B","Yard_Indian","Yard_Indian_1937","Foot_Gold_Coast","Chain","Chain_Sears_1922_Truncated","50_Kilometers","150_Kilometers"],2066:5,2136:12,2155:2,2157:0,2158:0,2159:12,2160:12,2204:2,2219:0,2220:0,2254:2,2255:2,2256:1,2265:1,2266:1,2267:2,2268:2,2269:1,2270:1,2271:2,2272:2,2273:1,2294:0,2295:0,2314:3,2899:2,2900:2,2901:1,2909:1,2910:1,2911:2,2912:2,2913:1,2914:1,2992:1,2993:0,2994:1,3080:1,3089:2,3090:0,3091:2,3102:2,3141:0,3142:0,3167:14,3359:2,3360:0,3361:1,3362:0,3363:2,3364:0,3365:2,3366:3,3404:2,3405:0,3406:0,3407:3,3439:0,3440:0,3479:1,3480:0,3481:1,3482:0,3483:1,3484:0,3485:2,3486:0,3487:2,3488:0,3489:0,3490:2,3491:0,3492:2,3493:0,3494:2,3495:0,3496:2,3497:0,3498:2,3499:0,3500:2,3501:0,3502:2,3503:0,3504:2,3505:0,3506:2,3507:0,3508:2,3509:0,3510:2,3511:0,3512:2,3513:0,3514:0,3515:2,3516:0,3517:2,3518:0,3519:2,3520:0,3521:2,3522:0,3523:2,3524:0,3525:2,3526:0,3527:2,3528:0,3529:2,3530:0,3531:2,3532:0,3533:2,3534:0,3535:2,3536:0,3537:2,3538:0,3539:2,3540:0,3541:2,3542:0,3543:2,3544:0,3545:2,3546:0,3547:2,3548:0,3549:2,3550:0,3551:2,3552:0,3553:2,3582:2,3583:0,3584:2,3585:0,3586:2,3587:0,3588:1,3589:0,3590:1,3591:0,3592:0,3593:1,3598:2,3599:0,3600:2,3605:1,3606:0,3607:0,3608:2,3609:0,3610:2,3611:0,3612:2,3613:0,3614:2,3615:0,3616:2,3617:0,3618:2,3619:0,3620:2,3621:0,3622:2,3623:0,3624:2,3625:0,3626:2,3627:0,3628:2,3629:0,3630:2,3631:0,3632:2,3633:0,3634:1,3635:0,3636:1,3640:2,3641:0,3642:2,3643:0,3644:1,3645:0,3646:1,3647:0,3648:1,3649:0,3650:2,3651:0,3652:2,3653:0,3654:2,3655:0,3656:1,3657:0,3658:2,3659:0,3660:2,3661:0,3662:2,3663:0,3664:2,3668:2,3669:0,3670:2,3671:0,3672:2,3673:0,3674:2,3675:0,3676:1,3677:2,3678:0,3679:1,3680:2,3681:0,3682:1,3683:2,3684:0,3685:0,3686:2,3687:0,3688:2,3689:0,3690:2,3691:0,3692:2,3696:2,3697:0,3698:2,3699:0,3700:2,3793:0,3794:0,3812:0,3854:0,3857:0,3920:0,3978:0,3979:0,3991:2,3992:2,4026:0,4037:0,4038:0,4071:0,4082:0,4083:0,4087:0,4088:0,4217:2,4414:0,4415:0,4417:0,4434:0,4437:0,4438:2,4439:2,4462:0,4467:0,4471:0,4474:0,4559:0,4647:0,4822:0,4826:0,4839:0,5018:0,5041:0,5042:0,5048:0,5221:0,5223:0,5234:0,5235:0,5243:0,5247:0,5266:0,5316:0,5320:0,5321:0,5325:0,5337:0,5361:0,5362:0,5367:0,5382:0,5383:0,5396:0,5456:0,5457:0,5469:0,5472:4,5490:0,5513:0,5514:0,5523:0,5559:0,5588:1,5589:3,5596:0,5627:0,5629:0,5641:0,5643:0,5644:0,5646:2,5654:2,5655:2,5659:0,5700:0,5825:0,5836:0,5837:0,5839:0,5842:0,5844:0,5858:0,5879:0,5880:0,5887:0,5890:0,6128:1,6129:1,6141:1,6204:0,6210:0,6211:0,6307:0,6312:0,6316:0,6362:0,6391:1,6405:1,6406:0,6407:1,6408:0,6409:1,6410:0,6411:2,6412:0,6413:2,6414:0,6415:0,6416:2,6417:0,6418:2,6419:0,6420:2,6421:0,6422:2,6423:0,6424:2,6425:0,6426:2,6427:0,6428:2,6429:0,6430:2,6431:0,6432:2,6433:0,6434:2,6435:0,6436:2,6437:0,6438:2,6439:0,6440:0,6441:2,6442:0,6443:2,6444:0,6445:2,6446:0,6447:2,6448:0,6449:2,6450:0,6451:2,6452:0,6453:2,6454:0,6455:2,6456:0,6457:2,6458:0,6459:2,6460:0,6461:2,6462:0,6463:2,6464:0,6465:2,6466:0,6467:2,6468:0,6469:2,6470:0,6471:2,6472:0,6473:2,6474:0,6475:2,6476:0,6477:2,6478:0,6479:2,6484:2,6485:0,6486:2,6487:0,6488:2,6489:0,6490:2,6491:0,6492:2,6493:0,6494:1,6495:0,6496:1,6497:0,6498:0,6499:1,6500:0,6501:2,6502:0,6503:2,6504:0,6505:2,6506:0,6507:2,6508:0,6509:0,6510:2,6515:1,6516:0,6518:0,6519:2,6520:0,6521:2,6522:0,6523:2,6524:0,6525:2,6526:0,6527:2,6528:0,6529:2,6530:0,6531:2,6532:0,6533:2,6534:0,6535:2,6536:0,6537:2,6538:0,6539:2,6540:0,6541:2,6542:0,6543:2,6544:0,6545:1,6546:0,6547:1,6548:0,6549:2,6550:0,6551:2,6552:0,6553:2,6554:0,6555:2,6556:0,6557:1,6558:0,6559:1,6560:0,6561:1,6562:0,6563:2,6564:0,6565:2,6566:0,6567:0,6568:2,6569:0,6570:1,6571:0,6572:2,6573:0,6574:2,6575:0,6576:2,6577:0,6578:2,6582:2,6583:0,6584:2,6585:0,6586:2,6587:0,6588:2,6589:0,6590:2,6591:0,6592:0,6593:2,6594:0,6595:2,6596:0,6597:2,6598:0,6599:2,6600:0,6601:2,6602:0,6603:2,6605:2,6606:0,6607:2,6608:0,6609:2,6610:0,6611:0,6612:2,6613:0,6614:2,6615:0,6616:2,6617:0,6618:2,6633:2,6646:0,6703:0,6784:0,6785:1,6786:0,6787:1,6788:0,6789:1,6790:0,6791:1,6792:0,6793:1,6794:0,6795:1,6796:0,6797:1,6798:0,6799:1,6800:0,6801:1,6802:0,6803:1,6804:0,6805:1,6806:0,6807:1,6808:0,6809:1,6810:0,6811:1,6812:0,6813:1,6814:0,6815:1,6816:0,6817:1,6818:0,6819:1,6820:0,6821:1,6822:0,6823:1,6824:0,6825:1,6826:0,6827:1,6828:0,6829:1,6830:0,6831:1,6832:0,6833:1,6834:0,6835:1,6836:0,6837:1,6838:0,6839:1,6840:0,6841:1,6842:0,6843:1,6844:0,6845:1,6846:0,6847:1,6848:0,6849:1,6850:0,6851:1,6852:0,6853:1,6854:0,6855:1,6856:0,6857:1,6858:0,6859:1,6860:0,6861:1,6862:0,6863:1,6867:0,6868:1,6870:0,6875:0,6876:0,6879:0,6880:2,6884:0,6885:1,6886:0,6887:1,6915:0,6922:0,6923:2,6924:0,6925:2,6962:0,6984:0,6991:0,7128:2,7131:0,7132:2,7142:0,7257:0,7258:2,7259:0,7260:2,7261:0,7262:2,7263:0,7264:2,7265:0,7266:2,7267:0,7268:2,7269:0,7270:2,7271:0,7272:2,7273:0,7274:2,7275:0,7276:2,7277:0,7278:2,7279:0,7280:2,7281:0,7282:2,7283:0,7284:2,7285:0,7286:2,7287:0,7288:2,7289:0,7290:2,7291:0,7292:2,7293:0,7294:2,7295:0,7296:2,7297:0,7298:2,7299:0,7300:2,7301:0,7302:2,7303:0,7304:2,7305:0,7306:2,7307:0,7308:2,7309:0,7310:2,7311:0,7312:2,7313:0,7314:2,7315:0,7316:2,7317:0,7318:2,7319:0,7320:2,7321:0,7322:2,7323:0,7324:2,7325:0,7326:2,7327:0,7328:2,7329:0,7330:2,7331:0,7332:2,7333:0,7334:2,7335:0,7336:2,7337:0,7338:2,7339:0,7340:2,7341:0,7342:2,7343:0,7344:2,7345:0,7346:2,7347:0,7348:2,7349:0,7350:2,7351:0,7352:2,7353:0,7354:2,7355:0,7356:2,7357:0,7358:2,7359:0,7360:2,7361:0,7362:2,7363:0,7364:2,7365:0,7366:2,7367:0,7368:2,7369:0,7370:2,7877:0,7878:0,7882:0,7883:0,7887:0,7899:0,7991:0,7992:0,8035:2,8036:2,8058:0,8059:0,8082:0,8083:0,8088:0,8090:0,8091:2,8092:0,8093:2,8095:0,8096:2,8097:0,8098:2,8099:0,8100:2,8101:0,8102:2,8103:0,8104:2,8105:0,8106:2,8107:0,8108:2,8109:0,8110:2,8111:0,8112:2,8113:0,8114:2,8115:0,8116:2,8117:0,8118:2,8119:0,8120:2,8121:0,8122:2,8123:0,8124:2,8125:0,8126:2,8127:0,8128:2,8129:0,8130:2,8131:0,8132:2,8133:0,8134:2,8135:0,8136:2,8137:0,8138:2,8139:0,8140:2,8141:0,8142:2,8143:0,8144:2,8145:0,8146:2,8147:0,8148:2,8149:0,8150:2,8151:0,8152:2,8153:0,8154:2,8155:0,8156:2,8157:0,8158:2,8159:0,8160:2,8161:0,8162:2,8163:0,8164:2,8165:0,8166:2,8167:0,8168:2,8169:0,8170:2,8171:0,8172:2,8173:0,8177:2,8179:0,8180:2,8181:0,8182:2,8184:0,8185:2,8187:0,8189:2,8191:0,8193:2,8196:0,8197:2,8198:0,8200:2,8201:0,8202:2,8203:0,8204:2,8205:0,8206:2,8207:0,8208:2,8209:0,8210:2,8212:0,8213:2,8214:0,8216:2,8218:0,8220:2,8222:0,8224:2,8225:0,8226:2,8311:0,8312:1,8313:0,8314:1,8315:0,8316:1,8317:0,8318:1,8319:0,8320:1,8321:0,8322:1,8323:0,8324:1,8325:0,8326:1,8327:0,8328:1,8329:0,8330:1,8331:0,8332:1,8333:0,8334:1,8335:0,8336:1,8337:0,8338:1,8339:0,8340:1,8341:0,8342:1,8343:0,8344:1,8345:0,8346:1,8347:0,8348:1,8352:0,8353:0,8379:0,8380:2,8381:0,8382:2,8383:0,8384:2,8385:0,8387:2,8391:0,8395:0,8433:0,8441:0,8455:0,8456:0,8531:2,8682:0,8686:0,8687:0,8692:0,8693:0,8826:0,8903:0,8950:0,8951:0,9039:0,9040:0,9141:0,9149:0,9150:0,9191:0,9221:0,9222:0,9249:0,9250:0,9252:0,9254:0,9265:0,9284:0,9285:0,9300:0,9354:0,9367:0,9373:0,9377:0,9387:0,9391:0,9456:0,9473:0,9498:0,9674:0,9678:0,9680:0,9709:0,9712:0,9713:0,9716:0,9741:0,9748:2,9749:2,9761:0,9766:0,9793:0,9794:0,9869:0,9874:0,9875:0,9880:0,9895:0,9943:0,9945:0,9947:0,9967:0,9972:0,9977:0,10160:0,10183:0,10188:0,10194:0,10199:0,10207:0,10212:0,10217:0,10222:0,10227:0,10235:0,10240:0,10250:0,10254:0,10270:0,10275:0,10280:0,10306:0,10329:0,10471:0,20002:0,20042:0,20050:1,20499:0,20538:0,20539:0,20790:0,20791:0,21291:0,21292:0,21500:0,21817:0,21818:0,22032:0,22033:0,22091:0,22092:0,22239:0,22240:0,22332:0,22337:0,22338:0,22391:0,22392:0,22639:0,22700:0,22739:0,22770:0,22780:0,22832:0,23090:0,23095:0,23239:0,23240:0,23433:0,23700:0,24047:0,24048:0,24100:3,24200:0,24305:0,24306:0,24382:10,24383:0,24500:0,24547:0,24548:0,24571:9,24600:0,25e3:0,25231:0,25884:0,25932:0,26237:0,26331:0,26332:0,26432:0,26591:0,26592:0,26632:0,26692:0,27120:0,27200:0,27291:6,27292:6,27429:0,27492:0,27493:0,27500:0,27700:0,28232:0,28600:0,28991:0,28992:0,29100:0,29101:0,29220:0,29221:0,29333:0,29635:0,29636:0,29701:0,29738:0,29739:0,29849:0,29850:0,29871:8,29872:7,29873:0,29874:0,30200:5,30339:0,30340:0,30591:0,30592:0,30791:0,30792:0,30800:0,31028:0,31121:0,31154:0,31170:0,31171:0,31370:0,31528:0,31529:0,31600:0,31700:0,31838:0,31839:0,31900:0,31901:0,32061:0,32062:0,32098:0,32099:2,32100:0,32104:0,32161:0,32766:0,53048:0,53049:0,54090:0,54091:0,65061:2,65062:2,65161:0,65163:0,102041:2,102064:11,102068:15,102069:16,102118:2,102119:1,102120:2,102121:2,102217:2,102218:0,102219:2,102220:2,102378:1,102379:1,102380:0,102381:1,102589:2,102599:2,102600:2,102604:2,102647:0,102704:2,102705:2,102706:0,102731:0,102732:0,102759:1,102760:1,102761:2,102762:0,102763:2,102764:0,102765:0,102766:2,102970:1,102974:2,102993:0,102994:0,102995:2,102996:2,103015:0,103016:2,103017:0,103018:2,103025:0,103026:0,103027:2,103028:2,103035:0,103036:0,103037:2,103038:2,103039:0,103040:0,103041:2,103042:2,103043:0,103044:0,103045:2,103046:2,103047:0,103048:0,103049:2,103050:2,103051:0,103052:2,103053:0,103054:2,103055:0,103056:2,103057:0,103058:0,103059:2,103060:2,103061:0,103062:0,103063:2,103064:2,103069:2,103070:0,103071:0,103072:2,103073:2,103086:0,103087:0,103088:2,103089:2,103094:1,103095:0,103096:2,103103:0,103104:2,103105:0,103106:2,103121:0,103122:2,103123:0,103124:0,103125:1,103126:1,103127:0,103128:0,103129:2,103130:2,103131:0,103132:0,103133:2,103134:2,103135:0,103136:0,103137:1,103138:1,103139:0,103140:2,103141:0,103142:2,103143:0,103144:2,103145:0,103146:1,103147:0,103148:0,103149:2,103150:2,103151:0,103152:2,103172:0,103173:2,103174:0,103175:0,103176:2,103177:2,103178:0,103179:0,103180:2,103181:2,103182:0,103183:0,103184:2,103185:2,103228:0,103229:0,103230:2,103231:2,103250:0,103251:2,103252:0,103253:2,103260:0,103261:0,103262:2,103263:2,103270:0,103271:0,103272:2,103273:2,103274:0,103275:0,103276:2,103277:2,103278:0,103279:0,103280:2,103281:2,103282:0,103283:0,103284:2,103285:2,103286:0,103287:2,103288:0,103289:2,103290:0,103291:2,103292:0,103293:0,103294:2,103295:2,103296:0,103297:0,103298:2,103299:2,103376:2,103377:0,103378:0,103379:2,103380:2,103393:0,103394:0,103395:2,103396:2,103472:0,103473:1,103474:0,103475:2,103482:0,103483:2,103484:0,103485:2,103500:0,103501:2,103502:0,103503:0,103504:1,103505:1,103506:0,103507:0,103508:2,103509:2,103510:0,103511:0,103512:2,103513:2,103514:0,103515:2,103516:0,103517:2,103518:0,103519:2,103520:0,103521:1,103522:0,103523:0,103524:2,103525:2,103526:0,103527:2,103561:2,103562:2,103563:0,103564:0,103565:2,103566:2,103567:0,103568:0,103569:2,103570:2,103584:0,103585:2,103586:0,103587:2,103588:1,103589:0,103590:2,103591:1,103592:0,103593:2,103594:1,103695:2,103897:1};for(y=2e3;y<=2045;y++)N[y]=0;for(y=2056;y<=2065;y++)N[y]=0;for(y=2067;y<=2135;y++)N[y]=0;for(y=2137;y<=2154;y++)N[y]=0;for(y=2161;y<=2170;y++)N[y]=0;for(y=2172;y<=2193;y++)N[y]=0;for(y=2195;y<=2198;y++)N[y]=0;for(y=2200;y<=2203;y++)N[y]=0;for(y=2205;y<=2217;y++)N[y]=0;for(y=2222;y<=2224;y++)N[y]=1;for(y=2225;y<=2250;y++)N[y]=2;for(y=2251;y<=2253;y++)N[y]=1;for(y=2257;y<=2264;y++)N[y]=2;for(y=2274;y<=2279;y++)N[y]=2;for(y=2280;y<=2282;y++)N[y]=1;for(y=2283;y<=2289;y++)N[y]=2;for(y=2290;y<=2292;y++)N[y]=0;for(y=2308;y<=2313;y++)N[y]=0;for(y=2315;y<=2491;y++)N[y]=0;for(y=2494;y<=2866;y++)N[y]=0;for(y=2867;y<=2869;y++)N[y]=1;for(y=2870;y<=2888;y++)N[y]=2;for(y=2891;y<=2895;y++)N[y]=2;for(y=2896;y<=2898;y++)N[y]=1;for(y=2902;y<=2908;y++)N[y]=2;for(y=2915;y<=2920;y++)N[y]=2;for(y=2921;y<=2923;y++)N[y]=1;for(y=2924;y<=2930;y++)N[y]=2;for(y=2931;y<=2962;y++)N[y]=0;for(y=2964;y<=2968;y++)N[y]=2;for(y=2969;y<=2973;y++)N[y]=0;for(y=2975;y<=2991;y++)N[y]=0;for(y=2995;y<=3051;y++)N[y]=0;for(y=3054;y<=3079;y++)N[y]=0;for(y=3081;y<=3088;y++)N[y]=0;for(y=3092;y<=3101;y++)N[y]=0;for(y=3106;y<=3138;y++)N[y]=0;for(y=3146;y<=3151;y++)N[y]=0;for(y=3153;y<=3166;y++)N[y]=0;for(y=3168;y<=3172;y++)N[y]=0;for(y=3174;y<=3203;y++)N[y]=0;for(y=3294;y<=3358;y++)N[y]=0;for(y=3367;y<=3403;y++)N[y]=0;for(y=3408;y<=3416;y++)N[y]=0;for(y=3417;y<=3438;y++)N[y]=2;for(y=3441;y<=3446;y++)N[y]=2;for(y=3447;y<=3450;y++)N[y]=0;for(y=3451;y<=3459;y++)N[y]=2;for(y=3460;y<=3478;y++)N[y]=0;for(y=3554;y<=3559;y++)N[y]=0;for(y=3560;y<=3570;y++)N[y]=2;for(y=3571;y<=3581;y++)N[y]=0;for(y=3594;y<=3597;y++)N[y]=0;for(y=3601;y<=3604;y++)N[y]=0;for(y=3637;y<=3639;y++)N[y]=0;for(y=3665;y<=3667;y++)N[y]=0;for(y=3693;y<=3695;y++)N[y]=0;for(y=3701;y<=3727;y++)N[y]=0;for(y=3728;y<=3739;y++)N[y]=2;for(y=3740;y<=3751;y++)N[y]=0;for(y=3753;y<=3760;y++)N[y]=2;for(y=3761;y<=3773;y++)N[y]=0;for(y=3775;y<=3777;y++)N[y]=0;for(y=3779;y<=3781;y++)N[y]=0;for(y=3783;y<=3785;y++)N[y]=0;for(y=3788;y<=3791;y++)N[y]=0;for(y=3797;y<=3802;y++)N[y]=0;for(y=3814;y<=3816;y++)N[y]=0;for(y=3825;y<=3829;y++)N[y]=0;for(y=3832;y<=3841;y++)N[y]=0;for(y=3844;y<=3852;y++)N[y]=0;for(y=3873;y<=3885;y++)N[y]=0;for(y=3890;y<=3893;y++)N[y]=0;for(y=3907;y<=3912;y++)N[y]=0;for(y=3942;y<=3950;y++)N[y]=0;for(y=3968;y<=3970;y++)N[y]=0;for(y=3973;y<=3976;y++)N[y]=0;for(y=3986;y<=3989;y++)N[y]=0;for(y=3994;y<=3997;y++)N[y]=0;for(y=4048;y<=4051;y++)N[y]=0;for(y=4056;y<=4063;y++)N[y]=0;for(y=4093;y<=4096;y++)N[y]=0;for(y=4390;y<=4398;y++)N[y]=0;for(y=4399;y<=4413;y++)N[y]=2;for(y=4418;y<=4433;y++)N[y]=2;for(y=4455;y<=4457;y++)N[y]=2;for(y=4484;y<=4489;y++)N[y]=0;for(y=4491;y<=4554;y++)N[y]=0;for(y=4568;y<=4589;y++)N[y]=0;for(y=4652;y<=4656;y++)N[y]=0;for(y=4766;y<=4800;y++)N[y]=0;for(y=5014;y<=5016;y++)N[y]=0;for(y=5069;y<=5072;y++)N[y]=0;for(y=5105;y<=5130;y++)N[y]=0;for(y=5167;y<=5188;y++)N[y]=0;for(y=5253;y<=5259;y++)N[y]=0;for(y=5269;y<=5275;y++)N[y]=0;for(y=5292;y<=5311;y++)N[y]=0;for(y=5329;y<=5331;y++)N[y]=0;for(y=5343;y<=5349;y++)N[y]=0;for(y=5355;y<=5357;y++)N[y]=0;for(y=5387;y<=5389;y++)N[y]=0;for(y=5459;y<=5463;y++)N[y]=0;for(y=5479;y<=5482;y++)N[y]=0;for(y=5518;y<=5520;y++)N[y]=0;for(y=5530;y<=5539;y++)N[y]=0;for(y=5550;y<=5552;y++)N[y]=0;for(y=5562;y<=5583;y++)N[y]=0;for(y=5623;y<=5625;y++)N[y]=2;for(y=5631;y<=5639;y++)N[y]=0;for(y=5649;y<=5653;y++)N[y]=0;for(y=5663;y<=5680;y++)N[y]=0;for(y=5682;y<=5685;y++)N[y]=0;for(y=5875;y<=5877;y++)N[y]=0;for(y=5896;y<=5899;y++)N[y]=0;for(y=5921;y<=5940;y++)N[y]=0;for(y=6050;y<=6125;y++)N[y]=0;for(y=6244;y<=6275;y++)N[y]=0;for(y=6328;y<=6348;y++)N[y]=0;for(y=6350;y<=6356;y++)N[y]=0;for(y=6366;y<=6372;y++)N[y]=0;for(y=6381;y<=6387;y++)N[y]=0;for(y=6393;y<=6404;y++)N[y]=0;for(y=6480;y<=6483;y++)N[y]=0;for(y=6511;y<=6514;y++)N[y]=0;for(y=6579;y<=6581;y++)N[y]=0;for(y=6619;y<=6624;y++)N[y]=0;for(y=6625;y<=6627;y++)N[y]=2;for(y=6628;y<=6632;y++)N[y]=0;for(y=6634;y<=6637;y++)N[y]=0;for(y=6669;y<=6692;y++)N[y]=0;for(y=6707;y<=6709;y++)N[y]=0;for(y=6720;y<=6723;y++)N[y]=0;for(y=6732;y<=6738;y++)N[y]=0;for(y=6931;y<=6933;y++)N[y]=0;for(y=6956;y<=6959;y++)N[y]=0;for(y=7005;y<=7007;y++)N[y]=0;for(y=7057;y<=7070;y++)N[y]=2;for(y=7074;y<=7082;y++)N[y]=0;for(y=7109;y<=7118;y++)N[y]=0;for(y=7119;y<=7127;y++)N[y]=1;for(y=7374;y<=7376;y++)N[y]=0;for(y=7528;y<=7586;y++)N[y]=0;for(y=7587;y<=7645;y++)N[y]=2;for(y=7692;y<=7696;y++)N[y]=0;for(y=7755;y<=7787;y++)N[y]=0;for(y=7791;y<=7795;y++)N[y]=0;for(y=7799;y<=7801;y++)N[y]=0;for(y=7803;y<=7805;y++)N[y]=0;for(y=7825;y<=7831;y++)N[y]=0;for(y=7845;y<=7859;y++)N[y]=0;for(y=8013;y<=8032;y++)N[y]=0;for(y=8065;y<=8068;y++)N[y]=1;for(y=8518;y<=8529;y++)N[y]=2;for(y=8533;y<=8536;y++)N[y]=2;for(y=8538;y<=8540;y++)N[y]=2;for(y=8677;y<=8679;y++)N[y]=0;for(y=8836;y<=8840;y++)N[y]=0;for(y=8857;y<=8859;y++)N[y]=0;for(y=8908;y<=8910;y++)N[y]=0;for(y=9154;y<=9159;y++)N[y]=0;for(y=9205;y<=9218;y++)N[y]=0;for(y=9271;y<=9273;y++)N[y]=0;for(y=9295;y<=9297;y++)N[y]=0;for(y=9356;y<=9360;y++)N[y]=0;for(y=9404;y<=9407;y++)N[y]=0;for(y=9476;y<=9482;y++)N[y]=0;for(y=9487;y<=9494;y++)N[y]=0;for(y=9697;y<=9699;y++)N[y]=0;for(y=9821;y<=9865;y++)N[y]=0;for(y=10285;y<=10291;y++)N[y]=0;for(y=10314;y<=10317;y++)N[y]=0;for(y=10448;y<=10465;y++)N[y]=0;for(y=11114;y<=11118;y++)N[y]=0;for(y=20004;y<=20032;y++)N[y]=0;for(y=20047;y<=20049;y++)N[y]=0;for(y=20062;y<=20092;y++)N[y]=0;for(y=20135;y<=20138;y++)N[y]=0;for(y=20248;y<=20258;y++)N[y]=0;for(y=20348;y<=20358;y++)N[y]=0;for(y=20436;y<=20440;y++)N[y]=0;for(y=20822;y<=20824;y++)N[y]=0;for(y=20904;y<=20932;y++)N[y]=0;for(y=20934;y<=20936;y++)N[y]=0;for(y=21004;y<=21032;y++)N[y]=0;for(y=21035;y<=21037;y++)N[y]=0;for(y=21095;y<=21097;y++)N[y]=0;for(y=21148;y<=21150;y++)N[y]=0;for(y=21207;y<=21264;y++)N[y]=0;for(y=21307;y<=21364;y++)N[y]=0;for(y=21413;y<=21423;y++)N[y]=0;for(y=21453;y<=21463;y++)N[y]=0;for(y=21473;y<=21483;y++)N[y]=0;for(y=21780;y<=21782;y++)N[y]=0;for(y=21891;y<=21894;y++)N[y]=0;for(y=21896;y<=21899;y++)N[y]=0;for(y=22171;y<=22177;y++)N[y]=0;for(y=22181;y<=22187;y++)N[y]=0;for(y=22191;y<=22197;y++)N[y]=0;for(y=22207;y<=22222;y++)N[y]=0;for(y=22229;y<=22232;y++)N[y]=0;for(y=22234;y<=22236;y++)N[y]=0;for(y=22243;y<=22250;y++)N[y]=0;for(y=22262;y<=22265;y++)N[y]=0;for(y=22307;y<=22322;y++)N[y]=0;for(y=22348;y<=22357;y++)N[y]=0;for(y=22407;y<=22422;y++)N[y]=0;for(y=22462;y<=22465;y++)N[y]=0;for(y=22521;y<=22525;y++)N[y]=0;for(y=22607;y<=22622;y++)N[y]=0;for(y=22641;y<=22646;y++)N[y]=0;for(y=22648;y<=22657;y++)N[y]=0;for(y=22707;y<=22722;y++)N[y]=0;for(y=22762;y<=22765;y++)N[y]=0;for(y=22807;y<=22822;y++)N[y]=0;for(y=22991;y<=22994;y++)N[y]=0;for(y=23028;y<=23038;y++)N[y]=0;for(y=23301;y<=23333;y++)N[y]=2;for(y=23830;y<=23853;y++)N[y]=0;for(y=23866;y<=23872;y++)N[y]=0;for(y=23877;y<=23884;y++)N[y]=0;for(y=23886;y<=23894;y++)N[y]=0;for(y=23946;y<=23948;y++)N[y]=0;for(y=24311;y<=24313;y++)N[y]=0;for(y=24342;y<=24347;y++)N[y]=0;for(y=24370;y<=24374;y++)N[y]=10;for(y=24375;y<=24381;y++)N[y]=0;for(y=24718;y<=24721;y++)N[y]=0;for(y=24817;y<=24821;y++)N[y]=0;for(y=24877;y<=24882;y++)N[y]=0;for(y=24891;y<=24893;y++)N[y]=0;for(y=25391;y<=25395;y++)N[y]=0;for(y=25828;y<=25838;y++)N[y]=0;for(y=26191;y<=26195;y++)N[y]=0;for(y=26391;y<=26393;y++)N[y]=0;for(y=26701;y<=26722;y++)N[y]=0;for(y=26729;y<=26799;y++)N[y]=2;for(y=26801;y<=26803;y++)N[y]=2;for(y=26811;y<=26813;y++)N[y]=2;for(y=26847;y<=26870;y++)N[y]=2;for(y=26891;y<=26899;y++)N[y]=0;for(y=26901;y<=26923;y++)N[y]=0;for(y=26929;y<=26946;y++)N[y]=0;for(y=26948;y<=26998;y++)N[y]=0;for(y=27037;y<=27040;y++)N[y]=0;for(y=27205;y<=27232;y++)N[y]=0;for(y=27258;y<=27260;y++)N[y]=0;for(y=27391;y<=27398;y++)N[y]=0;for(y=27561;y<=27564;y++)N[y]=0;for(y=27571;y<=27574;y++)N[y]=0;for(y=27581;y<=27584;y++)N[y]=0;for(y=27591;y<=27594;y++)N[y]=0;for(y=28191;y<=28193;y++)N[y]=0;for(y=28348;y<=28358;y++)N[y]=0;for(y=28402;y<=28432;y++)N[y]=0;for(y=28462;y<=28492;y++)N[y]=0;for(y=29118;y<=29122;y++)N[y]=0;for(y=29168;y<=29172;y++)N[y]=0;for(y=29177;y<=29185;y++)N[y]=0;for(y=29187;y<=29195;y++)N[y]=0;for(y=29900;y<=29903;y++)N[y]=0;for(y=30161;y<=30179;y++)N[y]=0;for(y=30491;y<=30494;y++)N[y]=0;for(y=30729;y<=30732;y++)N[y]=0;for(y=31251;y<=31259;y++)N[y]=0;for(y=31265;y<=31268;y++)N[y]=0;for(y=31275;y<=31279;y++)N[y]=0;for(y=31281;y<=31297;y++)N[y]=0;for(y=31461;y<=31469;y++)N[y]=0;for(y=31491;y<=31495;y++)N[y]=0;for(y=31917;y<=31922;y++)N[y]=0;for(y=31965;y<=32e3;y++)N[y]=0;for(y=32001;y<=32003;y++)N[y]=2;for(y=32005;y<=32031;y++)N[y]=2;for(y=32033;y<=32060;y++)N[y]=2;for(y=32064;y<=32067;y++)N[y]=2;for(y=32074;y<=32077;y++)N[y]=2;for(y=32081;y<=32086;y++)N[y]=0;for(y=32107;y<=32130;y++)N[y]=0;for(y=32133;y<=32159;y++)N[y]=0;for(y=32164;y<=32167;y++)N[y]=2;for(y=32180;y<=32199;y++)N[y]=0;for(y=32201;y<=32260;y++)N[y]=0;for(y=32301;y<=32360;y++)N[y]=0;for(y=32401;y<=32460;y++)N[y]=0;for(y=32501;y<=32560;y++)N[y]=0;for(y=32601;y<=32662;y++)N[y]=0;for(y=32664;y<=32667;y++)N[y]=2;for(y=32701;y<=32761;y++)N[y]=0;for(y=53001;y<=53004;y++)N[y]=0;for(y=53008;y<=53019;y++)N[y]=0;for(y=53021;y<=53032;y++)N[y]=0;for(y=53034;y<=53037;y++)N[y]=0;for(y=53042;y<=53046;y++)N[y]=0;for(y=53074;y<=53080;y++)N[y]=0;for(y=54001;y<=54004;y++)N[y]=0;for(y=54008;y<=54019;y++)N[y]=0;for(y=54021;y<=54032;y++)N[y]=0;for(y=54034;y<=54037;y++)N[y]=0;for(y=54042;y<=54046;y++)N[y]=0;for(y=54048;y<=54053;y++)N[y]=0;for(y=54074;y<=54080;y++)N[y]=0;for(y=54098;y<=54101;y++)N[y]=0;for(y=102001;y<=102040;y++)N[y]=0;for(y=102042;y<=102063;y++)N[y]=0;for(y=102065;y<=102067;y++)N[y]=0;for(y=102070;y<=102117;y++)N[y]=0;for(y=102122;y<=102216;y++)N[y]=0;for(y=102221;y<=102377;y++)N[y]=0;for(y=102382;y<=102388;y++)N[y]=0;for(y=102389;y<=102398;y++)N[y]=2;for(y=102399;y<=102444;y++)N[y]=0;for(y=102445;y<=102447;y++)N[y]=2;for(y=102448;y<=102458;y++)N[y]=0;for(y=102459;y<=102468;y++)N[y]=2;for(y=102469;y<=102499;y++)N[y]=0;for(y=102500;y<=102519;y++)N[y]=1;for(y=102520;y<=102524;y++)N[y]=0;for(y=102525;y<=102529;y++)N[y]=2;for(y=102530;y<=102588;y++)N[y]=0;for(y=102590;y<=102598;y++)N[y]=0;for(y=102601;y<=102603;y++)N[y]=0;for(y=102605;y<=102628;y++)N[y]=0;for(y=102629;y<=102646;y++)N[y]=2;for(y=102648;y<=102700;y++)N[y]=2;for(y=102701;y<=102703;y++)N[y]=0;for(y=102707;y<=102730;y++)N[y]=2;for(y=102733;y<=102758;y++)N[y]=2;for(y=102767;y<=102900;y++)N[y]=0;for(y=102901;y<=102933;y++)N[y]=2;for(y=102934;y<=102950;y++)N[y]=13;for(y=102951;y<=102955;y++)N[y]=0;for(y=102961;y<=102963;y++)N[y]=0;for(y=102965;y<=102969;y++)N[y]=0;for(y=102971;y<=102973;y++)N[y]=0;for(y=102975;y<=102989;y++)N[y]=0;for(y=102990;y<=102992;y++)N[y]=1;for(y=102997;y<=103002;y++)N[y]=0;for(y=103003;y<=103008;y++)N[y]=2;for(y=103009;y<=103011;y++)N[y]=0;for(y=103012;y<=103014;y++)N[y]=2;for(y=103019;y<=103021;y++)N[y]=0;for(y=103022;y<=103024;y++)N[y]=2;for(y=103029;y<=103031;y++)N[y]=0;for(y=103032;y<=103034;y++)N[y]=2;for(y=103065;y<=103068;y++)N[y]=0;for(y=103074;y<=103076;y++)N[y]=0;for(y=103077;y<=103079;y++)N[y]=1;for(y=103080;y<=103082;y++)N[y]=0;for(y=103083;y<=103085;y++)N[y]=2;for(y=103090;y<=103093;y++)N[y]=0;for(y=103097;y<=103099;y++)N[y]=0;for(y=103100;y<=103102;y++)N[y]=2;for(y=103107;y<=103109;y++)N[y]=0;for(y=103110;y<=103112;y++)N[y]=2;for(y=103113;y<=103116;y++)N[y]=0;for(y=103117;y<=103120;y++)N[y]=2;for(y=103153;y<=103157;y++)N[y]=0;for(y=103158;y<=103162;y++)N[y]=2;for(y=103163;y<=103165;y++)N[y]=0;for(y=103166;y<=103168;y++)N[y]=1;for(y=103169;y<=103171;y++)N[y]=2;for(y=103186;y<=103188;y++)N[y]=0;for(y=103189;y<=103191;y++)N[y]=2;for(y=103192;y<=103195;y++)N[y]=0;for(y=103196;y<=103199;y++)N[y]=2;for(y=103200;y<=103224;y++)N[y]=0;for(y=103225;y<=103227;y++)N[y]=1;for(y=103232;y<=103237;y++)N[y]=0;for(y=103238;y<=103243;y++)N[y]=2;for(y=103244;y<=103246;y++)N[y]=0;for(y=103247;y<=103249;y++)N[y]=2;for(y=103254;y<=103256;y++)N[y]=0;for(y=103257;y<=103259;y++)N[y]=2;for(y=103264;y<=103266;y++)N[y]=0;for(y=103267;y<=103269;y++)N[y]=2;for(y=103300;y<=103375;y++)N[y]=0;for(y=103381;y<=103383;y++)N[y]=0;for(y=103384;y<=103386;y++)N[y]=1;for(y=103387;y<=103389;y++)N[y]=0;for(y=103390;y<=103392;y++)N[y]=2;for(y=103397;y<=103399;y++)N[y]=0;for(y=103400;y<=103471;y++)N[y]=2;for(y=103476;y<=103478;y++)N[y]=0;for(y=103479;y<=103481;y++)N[y]=2;for(y=103486;y<=103488;y++)N[y]=0;for(y=103489;y<=103491;y++)N[y]=2;for(y=103492;y<=103495;y++)N[y]=0;for(y=103496;y<=103499;y++)N[y]=2;for(y=103528;y<=103543;y++)N[y]=0;for(y=103544;y<=103548;y++)N[y]=2;for(y=103549;y<=103551;y++)N[y]=0;for(y=103552;y<=103554;y++)N[y]=1;for(y=103555;y<=103557;y++)N[y]=2;for(y=103558;y<=103560;y++)N[y]=0;for(y=103571;y<=103573;y++)N[y]=0;for(y=103574;y<=103576;y++)N[y]=2;for(y=103577;y<=103580;y++)N[y]=0;for(y=103581;y<=103583;y++)N[y]=2;for(y=103595;y<=103694;y++)N[y]=0;for(y=103696;y<=103699;y++)N[y]=0;for(y=103700;y<=103793;y++)N[y]=2;for(y=103794;y<=103890;y++)N[y]=0;for(y=103891;y<=103896;y++)N[y]=2;for(y=103900;y<=103971;y++)N[y]=2;for(y=103972;y<=103977;y++)N[y]=0;for(y=112e3;y<=112101;y++)N[y]=0;const Vwe=[102100,102113,3857,3785],IBe=[104905,104971],LBe=[4326,...Vwe,...IBe],fae='PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]',WL=[-20037508342788905e-9,20037508342788905e-9],qL=[-20037508342787e-6,20037508342787e-6],Gwe={102113:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:WL,origin:qL,dx:1e-5},102100:{wkTemplate:fae,valid:WL,origin:qL,dx:1e-5},3785:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:WL,origin:qL,dx:1e-5},3857:{wkTemplate:fae,valid:WL,origin:qL,dx:1e-5},4326:{wkTemplate:'GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",{Central_Meridian}],UNIT["Degree",0.0174532925199433]]',altTemplate:'PROJCS["WGS_1984_Plate_Carree",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Plate_Carree"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],UNIT["Degrees",111319.491]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104971:{wkTemplate:'GEOGCS["Mars_2000_(Sphere)",DATUM["Mars_2000_(Sphere)",SPHEROID["Mars_2000_(Sphere)",3396190.0,0.0]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104905:{wkTemplate:'GEOGCS["GCS_Mars_2000",DATUM["D_Mars_2000",SPHEROID["Mars_2000_IAU_IAG",3396190.0,169.8944472236118]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5}};function To(t,e){if(t===e)return!0;if(t==null||e==null)return!1;const r=t.wkid,i=e.wkid;if(r!=null||i!=null){if(r===i||Zx(t)&&Zx(e))return!0;const o=t.latestWkid;if(o!=null&&i===o)return!0;const a=e.latestWkid;return a!=null&&r===a}let n,s;return t.wkt2&&e.wkt2?(n=t.wkt2,s=e.wkt2):t.wkt&&e.wkt&&(n=t.wkt,s=e.wkt),!(!n||!s)&&n.toUpperCase()===s.toUpperCase()}function Xp(t){const e=t==null?void 0:t.wkid;return e!=null&&e>=2e3&&Gwe[e]||null}function Zk(t){if(!t)return;const{wkid:e,vcsWkid:r}=t;if(e)return r?JSON.stringify({wkid:e,vcsWkid:r}):String(e);const i=t.wkt||t.wkt2;return JSON.stringify(i?r?{wkt:i,vcsWkid:r}:{wkt:i}:{})}function XK(t){if(!$m(t))return!1;const{wkid:e}=t;if(e)return N[e]==null;const r=t.wkt2||t.wkt;return!!r&&/^\s*(?:GEOGCS|GEOGCRS|GEOGRAPHICCRS)/i.test(r)}function c$(t){return!(Iv(t)||Lv(t))}function u$(t){return(t==null?void 0:t.wkid)===4326}function F5t(t){return/^\s*(?:GEOD|GEODETIC|GEOG|GEOGRAPHIC|PROJ|PROJECTED|VERT|VERTICAL|ENG|ENGINEERING|PARAMETRIC|TIME|DERIVEDPROJ|COMPOUND|BOUND)CRS/i.test(t)}function jwe(t){return(t==null?void 0:t.wkid)===Wh.CGCS2000}function Zx(t){const e=t==null?void 0:t.wkid;return e!=null&&e>=2e3&&Vwe.includes(e)}function h$(t){return(t==null?void 0:t.wkid)===32662}function PE(t){return t===Wh.GCSMARS2000||t===Wh.GCSMARS2000_SPHERE}function Iv(t){return PE(t==null?void 0:t.wkid)}function AE(t){return t===Wh.GCSMOON2000}function Lv(t){return AE(t==null?void 0:t.wkid)}function DBe(t){const e=t==null?void 0:t.wkid;return e!=null&&e>=2e3&&LBe.includes(e)}function $m(t){if(t==null)return!1;const e=t.wkid;return e!=null&&e>=2e3||t.wkt2!=null||t.wkt!=null}const Hwe={wkid:4326,wkt:SK(Gwe[4326].wkTemplate,{Central_Meridian:"0.0"})},Wwe={wkid:102100,latestWkid:3857},NBe={wkid:32662};function ZK(t){return{wkt:`GEOCCS["Spherical geocentric",
    DATUM["Not specified",
      SPHEROID["Sphere",${t.radius},0]],
    PRIMEM["Greenwich",0.0,
      AUTHORITY["EPSG","8901"]],
    UNIT["m",1.0],
    AXIS["Geocentric X",OTHER],
    AXIS["Geocentric Y",EAST],
    AXIS["Geocentric Z",NORTH]
  ]`}}const qwe=ZK(Yr),Hz=ZK(Yp),Wz=ZK(K0),Ywe={wkt:`GEOCCS["WGS 84",
  DATUM["WGS_1984",
    SPHEROID["WGS 84",${Yr.radius},298.257223563,
      AUTHORITY["EPSG","7030"]],
    AUTHORITY["EPSG","6326"]],
  PRIMEM["Greenwich",0,
    AUTHORITY["EPSG","8901"]],
  UNIT["m",1.0,
    AUTHORITY["EPSG","9001"]],
  AXIS["Geocentric X",OTHER],
  AXIS["Geocentric Y",OTHER],
  AXIS["Geocentric Z",NORTH],
  AUTHORITY["EPSG","4978"]
]`},FBe=Hz.wkt.toUpperCase(),kBe=Wz.wkt.toUpperCase();function Br(t){if(t!=null&&$m(t)){const e=t.wkid,r=t.wkt2??t.wkt;if(PE(e))return Yp;const i=r==null?void 0:r.toUpperCase();if(r&&i===FBe)return Yp;if(AE(e)||i&&i===kBe)return K0}return Yr}function k5t(t){return PE(t)?Yp:AE(t)?K0:Yr}function Jk(t){return To(t,qwe)}function iv(t){return Jk(t)||To(t,Hz)||To(t,Wz)}const JK=39.37,zBe=Yr.radius*Math.PI/200,Xwe=/(?:LENGTH)?UNIT\[([^\]]+)]]$/i,Tx=N,Zwe=/UNIT\[([^\]]+)]/i,UBe=new Set([4261,4305,4807,4810,4811,4812,4816,4819,4821,4901,4902,37225,104139,104140]),BBe=ac()({meter:"meters",foot:"feet",foot_us:"us-feet",foot_clarke:"clarke-feet",yard_clarke:"clarke-yards",link_clarke:"clarke-links",yard_sears:"sears-yards",foot_sears:"sears-feet",chain_sears:"sears-chains",chain_benoit_1895_b:"benoit-1895-b-chains",yard_indian:"indian-yards",yard_indian_1937:"indian-1937-yards",foot_gold_coast:"gold-coast-feet",chain_sears_1922_truncated:"sears-1922-truncated-chains","50_kilometers":"50-kilometers","150_kilometers":"150-kilometers"}),Tf=t=>t*t,Ny=t=>t*t*t,d$={length:{baseUnit:"meters",units:{millimeters:{inBaseUnits:.001},centimeters:{inBaseUnits:.01},decimeters:{inBaseUnits:.1},meters:{inBaseUnits:1},kilometers:{inBaseUnits:1e3},inches:{inBaseUnits:.0254},feet:{inBaseUnits:.3048},yards:{inBaseUnits:.9144},miles:{inBaseUnits:1609.344},"nautical-miles":{inBaseUnits:1852},"us-feet":{inBaseUnits:1200/3937}}},area:{baseUnit:"square-meters",units:{"square-millimeters":{inBaseUnits:Tf(.001)},"square-centimeters":{inBaseUnits:Tf(.01)},"square-decimeters":{inBaseUnits:Tf(.1)},"square-meters":{inBaseUnits:1},"square-kilometers":{inBaseUnits:Tf(1e3)},"square-inches":{inBaseUnits:Tf(.0254)},"square-feet":{inBaseUnits:Tf(.3048)},"square-yards":{inBaseUnits:Tf(.9144)},"square-miles":{inBaseUnits:Tf(1609.344)},"square-us-feet":{inBaseUnits:Tf(1200/3937)},acres:{inBaseUnits:.0015625*Tf(1609.344)},ares:{inBaseUnits:100},hectares:{inBaseUnits:1e4}}},volume:{baseUnit:"liters",units:{liters:{inBaseUnits:1},"cubic-millimeters":{inBaseUnits:1e3*Ny(.001)},"cubic-centimeters":{inBaseUnits:1e3*Ny(.01)},"cubic-decimeters":{inBaseUnits:1e3*Ny(.1)},"cubic-meters":{inBaseUnits:1e3},"cubic-kilometers":{inBaseUnits:1e3*Ny(1e3)},"cubic-inches":{inBaseUnits:1e3*Ny(.0254)},"cubic-feet":{inBaseUnits:1e3*Ny(.3048)},"cubic-yards":{inBaseUnits:1e3*Ny(.9144)},"cubic-miles":{inBaseUnits:1e3*Ny(1609.344)}}},angle:{baseUnit:"radians",units:{radians:{inBaseUnits:1},degrees:{inBaseUnits:Math.PI/180}}}},VBe=(()=>{const t={};for(const e in d$)for(const r in d$[e].units)t[r]=e;return t})();function GBe(t,e,r){return t*d$[r].units[e].inBaseUnits}function jBe(t,e,r){return t/d$[r].units[e].inBaseUnits}const Jwe=["metric","imperial","inches","feet","yards","miles","nautical-miles","us-feet","meters","kilometers"];function wW(t){const e=VBe[t];if(!e)throw new Error("unknown type");return e}function mae(t,e=null){return e=e||wW(t),d$[e].baseUnit===t}function mo(t,e,r){if(e===r)return t;const i=wW(e);if(i!==wW(r))throw new Error("incompatible units");const n=mae(e,i)?t:GBe(t,e,i);return mae(r,i)?n:jBe(n,r,i)}function z5t(t,e,r){switch(r){case"metric":return HBe(t,e);case"imperial":return qBe(t,e);default:return r}}function U5t(t,e,r){switch(r){case"metric":return WBe(t,e);case"imperial":return YBe(t,e);default:return r}}function HBe(t,e){const r=mo(t,e,"meters");return Math.abs(r)<3e3?"meters":"kilometers"}function WBe(t,e){const r=mo(t,e,"meters");return Math.abs(r)<1e5?"meters":"kilometers"}function qBe(t,e){const r=mo(t,e,"feet");return Math.abs(r)<1e3?"feet":"miles"}function YBe(t,e){const r=mo(t,e,"feet");return Math.abs(r)<1e5?"feet":"miles"}function B5t(t,e){const r=mo(t,e,"square-meters");return Math.abs(r)<3e6?"square-meters":"square-kilometers"}function V5t(t,e){const r=mo(t,e,"square-feet");return Math.abs(r)<1e6?"square-feet":"square-miles"}function XBe(t,e,r){return mo(t,e,"meters")/(r*Math.PI/180)}function Qwe(t){return BBe.fromJSON(t.toLowerCase())||null}function p$(t){if(t!=null&&!c$(t))return 1;const e=Ba(t);return e>1e5?1:e}function Kwe(t){return Ba(t)>=Br(t).metersPerDegree?"meters":qz(t)}function Ba(t,e=Yr.metersPerDegree){return ZBe(t,!0)??e}function ZBe(t,e=!1){const r=(t==null?void 0:t.wkid)??null,i=(t==null?void 0:t.wkt2)??(t==null?void 0:t.wkt)??null;let n=null;if(r){if(PE(r))return Yp.metersPerDegree;if(AE(r))return K0.metersPerDegree;n=Tx.values[Tx[r]],!n&&e&&UBe.has(r)&&(n=zBe)}else i&&(rxe(i)?n=gae(Xwe.exec(i),n):txe(i)&&(n=gae(Zwe.exec(i),n)));return n}function xW(t){return XK(t)?1:Ba(t)}function gae(t,e){return t!=null&&t[1]?exe(t[1]):e}function exe(t){return parseFloat(t.split(",")[1])}function qz(t){const e=(t==null?void 0:t.wkid)??null,r=(t==null?void 0:t.wkt2)??(t==null?void 0:t.wkt)??null;let i=null;if(e)i=Tx.units[Tx[e]];else if(r){const n=rxe(r)?Xwe:txe(r)?Zwe:null;if(n){const s=n.exec(r);s!=null&&s[1]&&(i=KBe(s[1]))}}return i!=null?Qwe(i):null}function G5t(t){const e=qz(t);return e!=null&&Jwe.includes(e)?e:null}function JBe(t){const e=Kwe(t);return e!=null&&Jwe.includes(e)?e:null}function txe(t){return/^GEOCCS/i.test(t)}function rxe(t){return/^\s*(?:PROJCS|PROJCRS|PROJECTEDCRS)/i.test(t)}const QBe=1e-7;function KBe(t){const e=/[\\"']{1}([^\\"']+)/.exec(t);let r=e==null?void 0:e[1];if(!r||!Tx.units.includes(r)){const i=exe(t);r=null;const n=Tx.values;for(let s=0;s<n.length;++s)if(Math.abs(i-n[s])<QBe){r=Tx.units[s];break}}return r}function j5t(t){const e=qz(t);if(e==null)return null;switch(e){case"feet":case"us-feet":case"clarke-feet":case"clarke-yards":case"clarke-links":case"sears-yards":case"sears-feet":case"sears-chains":case"benoit-1895-b-chains":case"indian-yards":case"indian-1937-yards":case"gold-coast-feet":case"sears-1922-truncated-chains":return"imperial";case"50-kilometers":case"150-kilometers":case"meters":return"metric"}return null}const eVe={esriAcres:"acres",esriAres:"ares",esriHectares:"hectares",esriSquareCentimeters:"square-centimeters",esriSquareDecimeters:"square-decimeters",esriSquareFeet:"square-feet",esriSquareInches:"square-inches",esriSquareKilometers:"square-kilometers",esriSquareMeters:"square-meters",esriSquareMiles:"square-miles",esriSquareMillimeters:"square-millimeters",esriSquareUsFeet:"square-us-feet",esriSquareYards:"square-yards"},tVe={esriCentimeters:"centimeters",esriDecimeters:"decimeters",esriFeet:"feet",esriInches:"inches",esriKilometers:"kilometers",esriMeters:"meters",esriMiles:"miles",esriMillimeters:"millimeters",esriNauticalMiles:"nautical-miles",esriYards:"yards"},rVe={esriDUDecimalDegrees:"degrees",esriDURadians:"radians"},H5t=ac()(eVe),W5t=ac()(tVe),q5t=ac()(rVe);var qf;let _i=qf=class extends ze{static fromJSON(t){if(!t)return null;if(t.wkid){if(t.wkid===102100)return qf.WebMercator;if(t.wkid===4326)return qf.WGS84}const e=new qf;return e.read(t),e}constructor(t){super(t),this.latestWkid=null,this.wkid=null,this.wkt=null,this.wkt2=null,this.vcsWkid=null,this.latestVcsWkid=null,this.imageCoordinateSystem=null}normalizeCtorArgs(t){return t&&typeof t=="object"?t:{[typeof t=="string"?"wkt":"wkid"]:t}}get isWGS84(){return u$(this)}get isWebMercator(){return Zx(this)}get isGeographic(){return XK(this)}get isWrappable(){return DBe(this)}get metersPerUnit(){return Ba(this)}get unit(){return qz(this)||(this.isGeographic?"degrees":null)}writeWkt(t,e){this.wkid||(e.wkt=t)}clone(){if(this===qf.WGS84)return new qf(Hwe);if(this===qf.WebMercator)return new qf(Wwe);const t=new qf;return this.wkid!=null?(t.wkid=this.wkid,this.latestWkid!=null&&(t.latestWkid=this.latestWkid),this.vcsWkid!=null&&(t.vcsWkid=this.vcsWkid),this.latestVcsWkid!=null&&(t.latestVcsWkid=this.latestVcsWkid)):(this.wkt!=null&&(t.wkt=this.wkt),this.wkt2!=null&&(t.wkt2=this.wkt2)),this.imageCoordinateSystem&&(t.imageCoordinateSystem=_e(this.imageCoordinateSystem)),t}equals(t){if(t==null)return!1;if(this.imageCoordinateSystem||t.imageCoordinateSystem){if(this.imageCoordinateSystem==null||t.imageCoordinateSystem==null)return!1;const{id:e,referenceServiceName:r}=t.imageCoordinateSystem,{geodataXform:i}=t.imageCoordinateSystem,n=this.imageCoordinateSystem;return e==null||i?JSON.stringify(n)===JSON.stringify(t.imageCoordinateSystem):r?n.id===e&&n.referenceServiceName===r:n.id===e}return To(this,t)}toJSON(t){return this.write(void 0,t)}};_i.GCS_NAD_1927=null,_i.WGS84=null,_i.WebMercator=null,_i.PlateCarree=null,d([m({readOnly:!0})],_i.prototype,"isWGS84",null),d([m({readOnly:!0})],_i.prototype,"isWebMercator",null),d([m({readOnly:!0})],_i.prototype,"isGeographic",null),d([m({readOnly:!0})],_i.prototype,"isWrappable",null),d([m({type:fn,json:{write:!0}})],_i.prototype,"latestWkid",void 0),d([m({readOnly:!0})],_i.prototype,"metersPerUnit",null),d([m({readOnly:!0})],_i.prototype,"unit",null),d([m({type:fn,json:{write:!0,origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkt==null}}}}}}})],_i.prototype,"wkid",void 0),d([m({type:String,json:{origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkid==null}}}}}}})],_i.prototype,"wkt",void 0),d([hr("wkt"),hr("web-scene","wkt")],_i.prototype,"writeWkt",null),d([m({type:String,json:{write:!1}})],_i.prototype,"wkt2",void 0),d([m({type:fn,json:{write:!0}})],_i.prototype,"vcsWkid",void 0),d([m({type:fn,json:{write:!0}})],_i.prototype,"latestVcsWkid",void 0),d([m()],_i.prototype,"imageCoordinateSystem",void 0),_i=qf=d([V("esri.geometry.SpatialReference")],_i),_i.prototype.toJSON.isDefaultToJSON=!0,_i.GCS_NAD_1927=new _i({wkid:4267,wkt:'GEOGCS["GCS_North_American_1927",DATUM["D_North_American_1927",SPHEROID["Clarke_1866",6378206.4,294.9786982]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]]'}),_i.WGS84=new _i(Hwe),_i.WebMercator=new _i(Wwe),_i.PlateCarree=new _i(NBe),Object.freeze&&(Object.freeze(_i.GCS_NAD_1927),Object.freeze(_i.WGS84),Object.freeze(_i.WebMercator),Object.freeze(_i.PlateCarree));const lt=_i;function Tr(t,e,r){let i,n;return e===void 0||Array.isArray(e)?(n=t,r=e,i=[void 0]):(n=e,i=Array.isArray(t)?t:[t]),(s,o)=>{const a=s.constructor.prototype;i.forEach(l=>{const c=ewe(s,l,n);c.read&&typeof c.read=="object"||(c.read={}),c.read.reader=a[o],r&&(c.read.source=(c.read.source||[]).concat(r))})}}let Yf=class extends ze{constructor(...e){super(...e),this.type=null,this.hasM=!1,this.hasZ=!1,this.spatialReference=lt.WGS84}get cache(){return this.commitProperty("spatialReference"),{}}get extent(){return null}readSpatialReference(e,r){if(e instanceof lt)return e;if(e!=null){const i=new lt;return i.read(e,r),i}return e}clone(){return console.warn(".clone() is not implemented for "+this.declaredClass),null}clearCache(){this.notifyChange("cache")}getCacheValue(e){return this.cache[e]}setCacheValue(e,r){this.cache[e]=r}};d([m()],Yf.prototype,"type",void 0),d([m({readOnly:!0})],Yf.prototype,"cache",null),d([m({readOnly:!0})],Yf.prototype,"extent",null),d([m({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Yf.prototype,"hasM",void 0),d([m({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Yf.prototype,"hasZ",void 0),d([m({type:lt,json:{write:!0},value:lt.WGS84})],Yf.prototype,"spatialReference",void 0),d([Tr("spatialReference")],Yf.prototype,"readSpatialReference",null),Yf=d([V("esri.geometry.Geometry")],Yf);const py=Yf,iVe=Object.prototype.toString;function nVe(t){const e="__accessorMetadata__"in t?Na(t):t;return function(...r){if(r.push(e),typeof r[2]=="number")throw new Error("Using @cast has parameter decorator is not supported since 4.16");return sVe.apply(this,r)}}function sVe(t,e,r,i){$z(t,e).cast=i}function oVe(t){return(e,r)=>{$z(e,t).cast=e[r]}}function ai(...t){if(t.length!==3||typeof t[1]!="string")return t.length===1&&iVe.call(t[0])==="[object Function]"?nVe(t[0]):t.length===1&&typeof t[0]=="string"?oVe(t[0]):void 0}function aVe(t,e){const r=t.x-e.x,i=t.y-e.y,n=t.hasZ&&e.hasZ?t.z-e.z:0;return Math.sqrt(r*r+i*i+n*n)}const lVe=57.29577951308232,cVe=.017453292519943;function yae(t){return t*lVe}function _ae(t){return t*cVe}function vae(t){return t/Yr.radius}function Qk(t){return Math.PI/2-2*Math.atan(Math.exp(-t/Yr.radius))}function TW(t){return t.wkid!=null||t.wkt!=null}const WB=[0,0];function Kk(t,e,r,i,n){const s=t,o=n;if(o.spatialReference=r,"x"in s&&"x"in o)[o.x,o.y]=e(s.x,s.y,WB,i);else if("xmin"in s&&"xmin"in o)[o.xmin,o.ymin]=e(s.xmin,s.ymin,WB,i),[o.xmax,o.ymax]=e(s.xmax,s.ymax,WB,i);else if("paths"in s&&"paths"in o||"rings"in s&&"rings"in o){const a="paths"in s?s.paths:s.rings,l=[];let c;for(let u=0;u<a.length;u++){const h=a[u];c=[],l.push(c);for(let p=0;p<h.length;p++)c.push(e(h[p][0],h[p][1],[0,0],i)),h[p].length>2&&c[p].push(h[p][2]),h[p].length>3&&c[p].push(h[p][3])}"paths"in o?o.paths=l:o.rings=l}else if("points"in s&&"points"in o){const a=s.points,l=[];for(let c=0;c<a.length;c++)l[c]=e(a[c][0],a[c][1],[0,0],i),a[c].length>2&&l[c].push(a[c][2]),a[c].length>3&&l[c].push(a[c][3]);o.points=l}return n}function a5(t,e){const r=t&&(TW(t)?t:t.spatialReference),i=e&&(TW(e)?e:e.spatialReference);return!(t&&"type"in t&&t.type==="mesh"||e&&"type"in e&&e.type==="mesh"||!r||!i)&&(!!To(i,r)||Zx(i)&&u$(r)||Zx(r)&&u$(i))}function PI(t,e){if(t==null)return null;const r=t.spatialReference,i=e&&(TW(e)?e:e.spatialReference);return a5(r,i)?To(r,i)?_e(t):Zx(i)?Kk(t,rC,lt.WebMercator,!1,_e(t)):u$(i)?Kk(t,VO,lt.WGS84,!1,_e(t)):null:null}function rC(t,e,r=[0,0]){e>89.99999?e=89.99999:e<-89.99999&&(e=-89.99999);const i=_ae(e);return r[0]=_ae(t)*Yr.radius,r[1]=Yr.halfSemiMajorAxis*Math.log((1+Math.sin(i))/(1-Math.sin(i))),r}function VO(t,e,r=[0,0],i=!1){const n=yae(t/Yr.radius);return r[0]=i?n:n-360*Math.floor((n+180)/360),r[1]=yae(Math.PI/2-2*Math.atan(Math.exp(-e/Yr.radius))),r}function z1(t,e=!1,r=_e(t)){return Kk(t,rC,lt.WebMercator,e,r)}function IA(t,e=!1,r=_e(t)){return Kk(t,VO,lt.WGS84,e,r)}var l5;const _P=[0,0];function bae(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}let Dl=l5=class extends py{static copy(t,e){e._set("x",t._get("x")),e._set("y",t._get("y")),e._set("z",t._get("z")),e._set("m",t._get("m"));const r=t._get("spatialReference");e._set("spatialReference",Object.isFrozen(r)?r:r.clone())}constructor(...t){super(...t),this.x=0,this.y=0,this.z=void 0,this.m=void 0,this.type="point"}normalizeCtorArgs(t,e,r,i,n){let s;if(Array.isArray(t))s=t,n=e,t=s[0],e=s[1],r=s[2],i=s[3];else if(t&&typeof t=="object"){if(s=t,t=s.x!=null?s.x:s.longitude,e=s.y!=null?s.y:s.latitude,r=s.z,i=s.m,(n=s.spatialReference)&&n.declaredClass!=="esri.geometry.SpatialReference"&&(n=new lt(n)),s.longitude!=null||s.latitude!=null){if(s.longitude==null)re.getLogger(this).warn(".longitude=","Latitude was defined without longitude");else if(s.latitude==null)re.getLogger(this).warn(".latitude=","Longitude was defined without latitude");else if(!s.declaredClass&&n&&n.isWebMercator){const a=rC(s.longitude,s.latitude,_P);t=a[0],e=a[1]}}}else bae(r)?(n=r,r=null):bae(i)&&(n=i,i=null);const o={x:t,y:e};return o.x==null&&o.y!=null?re.getLogger(this).warn(".y=","Y coordinate was defined without an X coordinate"):o.y==null&&o.x!=null&&re.getLogger(this).warn(".x=","X coordinate was defined without a Y coordinate"),n!=null&&(o.spatialReference=n),r!=null&&(o.z=r),i!=null&&(o.m=i),o}get cache(){return this.commitProperty("x"),this.commitProperty("y"),this.commitProperty("z"),this.commitProperty("m"),this.commitProperty("spatialReference"),{}}get hasM(){return this.m!==void 0}set hasM(t){t!==(this._get("m")!==void 0)&&(this._set("m",t?0:void 0),this._set("hasM",t))}get hasZ(){return this.z!==void 0}set hasZ(t){t!==(this._get("z")!==void 0)&&(this._set("z",t?0:void 0),this._set("hasZ",t))}get latitude(){const{spatialReference:t,x:e,y:r}=this;if(t){if(t.isWebMercator)return VO(e,r,_P)[1];if(t.isGeographic)return r}return null}set latitude(t){const{spatialReference:e,x:r}=this;t!=null&&e&&(e.isWebMercator?this._set("y",rC(r,t,_P)[1]):e.isGeographic&&this._set("y",t),this._set("latitude",t))}get longitude(){const{x:t,y:e,spatialReference:r}=this;if(r){if(r.isWebMercator)return VO(t,e,_P)[0];if(r.isGeographic)return t}return null}set longitude(t){const{y:e,spatialReference:r}=this;t!=null&&r&&(r.isWebMercator?this._set("x",rC(t,e,_P)[0]):r.isGeographic&&this._set("x",t),this._set("longitude",t))}writeX(t,e,r){e[r]=isNaN(t)?"NaN":t}readX(t){return typeof t=="string"?NaN:t}clone(){const t=new l5;return t.x=this.x,t.y=this.y,t.z=this.z,t.m=this.m,t.spatialReference=this.spatialReference,t}copy(t){return l5.copy(t,this),this}equals(t){if(t==null)return!1;const{x:e,y:r,z:i,m:n,spatialReference:s}=this,{z:o,m:a}=t;let{x:l,y:c,spatialReference:u}=t;if(!s.equals(u))if(s.isWebMercator&&u.isWGS84)[l,c]=rC(l,c),u=s;else{if(!s.isWGS84||!u.isWebMercator)return!1;[l,c]=VO(l,c),u=s}return e===l&&r===c&&i===o&&n===a&&s.wkid===u.wkid}offset(t,e,r){return this.x+=t,this.y+=e,r!=null&&(this.z=(this.z??0)+r),this}normalize(){if(!this.spatialReference)return this;const t=Xp(this.spatialReference);if(!t)return this;let e=this.x;const[r,i]=t.valid,n=2*i;let s;return e>i?(s=Math.ceil(Math.abs(e-i)/n),e-=s*n):e<r&&(s=Math.ceil(Math.abs(e-r)/n),e+=s*n),this._set("x",e),this}distance(t){return aVe(this,t)}toArray(){const t=this.hasZ,e=this.hasM;return t&&e?[this.x,this.y,this.z,this.m]:t?[this.x,this.y,this.z]:e?[this.x,this.y,this.m]:[this.x,this.y]}toJSON(t){return this.write({},t)}};d([m({readOnly:!0})],Dl.prototype,"cache",null),d([m({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],Dl.prototype,"hasM",null),d([m({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],Dl.prototype,"hasZ",null),d([m({type:Number})],Dl.prototype,"latitude",null),d([m({type:Number})],Dl.prototype,"longitude",null),d([m({type:Number,json:{type:[Number,String],write:{isRequired:!0,allowNull:!0}}}),ai(t=>isNaN(t)?t:Ep(t))],Dl.prototype,"x",void 0),d([hr("x")],Dl.prototype,"writeX",null),d([Tr("x")],Dl.prototype,"readX",null),d([m({type:Number,json:{write:!0}})],Dl.prototype,"y",void 0),d([m({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Dl.prototype,"z",void 0),d([m({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasM}}}}})],Dl.prototype,"m",void 0),Dl=l5=d([V("esri.geometry.Point")],Dl),Dl.prototype.toJSON.isDefaultToJSON=!0;const ke=Dl,qB=[0,0];function QK(t,e){return e!=null&&al(t,e.x,e.y,e.z)}function X5t(t,e){if(!e.points||e.points.length)return!1;for(const r of e.points)if(!ME(t,r))return!1;return!0}function uVe(t,e){const{xmin:r,ymin:i,zmin:n,xmax:s,ymax:o,zmax:a}=e;return t.hasZ&&e.hasZ?al(t,r,i,n)&&al(t,r,o,n)&&al(t,s,o,n)&&al(t,s,i,n)&&al(t,r,i,a)&&al(t,r,o,a)&&al(t,s,o,a)&&al(t,s,i,a):al(t,r,i)&&al(t,r,o)&&al(t,s,o)&&al(t,s,i)}function ME(t,e){return al(t,e[0],e[1])}function hVe(t,e){return al(t,e[0],e[1],e[2])}function al(t,e,r,i){return e>=t.xmin&&e<=t.xmax&&r>=t.ymin&&r<=t.ymax&&(i==null||!t.hasZ||i>=t.zmin&&i<=t.zmax)}function dVe(t,e){return qB[1]=e.y,qB[0]=e.x,pVe(t,qB)}function pVe(t,e){return ixe(t.rings,e)}function ixe(t,e){if(!t)return!1;if(fVe(t))return wae(!1,t,e);let r=!1;for(let i=0,n=t.length;i<n;i++)r=wae(r,t[i],e);return r}function fVe(t){return!Array.isArray(t[0][0])}function wae(t,e,r){const[i,n]=r;let s=t,o=0;for(let a=0,l=e.length;a<l;a++){o++,o===l&&(o=0);const[c,u]=e[a],[h,p]=e[o];(u<n&&p>=n||p<n&&u>=n)&&c+(n-u)/(p-u)*(h-c)<i&&(s=!s)}return s}function mVe(t,e){return QK(t,e)}function gVe(t,e){const r=t.hasZ&&e.hasZ;let i,n,s;if(t.xmin<=e.xmin){if(i=e.xmin,t.xmax<i)return!1}else if(i=t.xmin,e.xmax<i)return!1;if(t.ymin<=e.ymin){if(n=e.ymin,t.ymax<n)return!1}else if(n=t.ymin,e.ymax<n)return!1;if(r&&e.hasZ){if(t.zmin<=e.zmin){if(s=e.zmin,t.zmax<s)return!1}else if(s=t.zmin,e.zmax<s)return!1}return!0}function yVe(t,e){const{points:r,hasZ:i}=e,n=i?hVe:ME;for(const s of r)if(n(t,s))return!0;return!1}const Jx=[0,0],Qx=[0,0],Kx=[0,0],e2=[0,0],_Ve=[Jx,Qx,Kx,e2],nxe=[[Kx,Jx],[Jx,Qx],[Qx,e2],[e2,Kx]];function vVe(t,e){return bVe(t,e.rings)}function bVe(t,e){Jx[0]=t.xmin,Jx[1]=t.ymax,Qx[0]=t.xmax,Qx[1]=t.ymax,Kx[0]=t.xmin,Kx[1]=t.ymin,e2[0]=t.xmax,e2[1]=t.ymin;for(const r of _Ve)if(ixe(e,r))return!0;for(const r of e){if(!r.length)continue;let i=r[0];if(ME(t,i))return!0;for(let n=1;n<r.length;n++){const s=r[n];if(ME(t,s)||sxe(i,s,nxe))return!0;i=s}}return!1}function wVe(t,e){Jx[0]=t.xmin,Jx[1]=t.ymax,Qx[0]=t.xmax,Qx[1]=t.ymax,Kx[0]=t.xmin,Kx[1]=t.ymin,e2[0]=t.xmax,e2[1]=t.ymin;const r=e.paths;for(const i of r){if(!r.length)continue;let n=i[0];if(ME(t,n))return!0;for(let s=1;s<i.length;s++){const o=i[s];if(ME(t,o)||sxe(n,o,nxe))return!0;n=o}}return!1}const Yo=[0,0];function xVe(t){for(let e=0;e<t.length;e++){const r=t[e];for(let n=0;n<r.length-1;n++){const s=r[n],o=r[n+1];for(let a=e+1;a<t.length;a++)for(let l=0;l<t[a].length-1;l++){const c=t[a][l],u=t[a][l+1];if(e6(s,o,c,u,Yo)&&!(Yo[0]===s[0]&&Yo[1]===s[1]||Yo[0]===c[0]&&Yo[1]===c[1]||Yo[0]===o[0]&&Yo[1]===o[1]||Yo[0]===u[0]&&Yo[1]===u[1]))return!0}}const i=r.length;if(!(i<=4))for(let n=0;n<i-3;n++){let s=i-1;n===0&&(s=i-2);const o=r[n],a=r[n+1];for(let l=n+2;l<s;l++){const c=r[l],u=r[l+1];if(e6(o,a,c,u,Yo)&&!(Yo[0]===o[0]&&Yo[1]===o[1]||Yo[0]===c[0]&&Yo[1]===c[1]||Yo[0]===a[0]&&Yo[1]===a[1]||Yo[0]===u[0]&&Yo[1]===u[1]))return!0}}}return!1}function sxe(t,e,r){for(let i=0;i<r.length;i++)if(e6(t,e,r[i][0],r[i][1]))return!0;return!1}function e6(t,e,r,i,n){const[s,o]=t,[a,l]=e,[c,u]=r,[h,p]=i,f=h-c,g=s-c,_=a-s,v=p-u,b=o-u,w=l-o,x=v*_-f*w;if(x===0)return!1;const S=(f*b-v*g)/x,E=(_*b-w*g)/x;return S>=0&&S<=1&&E>=0&&E<=1&&(n&&(n[0]=s+S*(a-s),n[1]=o+S*(l-o)),!0)}function TVe(t){switch(t){case"esriGeometryEnvelope":case"extent":return gVe;case"esriGeometryMultipoint":case"multipoint":return yVe;case"esriGeometryPoint":case"point":return mVe;case"esriGeometryPolygon":case"polygon":return vVe;case"esriGeometryPolyline":case"polyline":return wVe}}var gh;function SVe(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}function Fy(t,e,r){return e==null?r:r==null?e:t(e,r)}let Ao=gh=class extends py{constructor(...t){super(...t),this.type="extent",this.xmin=0,this.ymin=0,this.mmin=void 0,this.zmin=void 0,this.xmax=0,this.ymax=0,this.mmax=void 0,this.zmax=void 0}normalizeCtorArgs(t,e,r,i,n){return SVe(t)?{spatialReference:t,xmin:0,ymin:0,xmax:0,ymax:0}:typeof t=="object"?(t.spatialReference=t.spatialReference==null?lt.WGS84:t.spatialReference,t):{xmin:t,ymin:e,xmax:r,ymax:i,spatialReference:n??lt.WGS84}}static fromBounds(t,e){return new gh({xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3],spatialReference:e})}static fromPoint(t){return new gh({xmin:t.x,ymin:t.y,zmin:t.z,xmax:t.x,ymax:t.y,zmax:t.z,spatialReference:t.spatialReference})}get cache(){return this.commitProperty("xmin"),this.commitProperty("ymin"),this.commitProperty("zmin"),this.commitProperty("mmin"),this.commitProperty("xmax"),this.commitProperty("ymax"),this.commitProperty("zmax"),this.commitProperty("mmax"),this.commitProperty("spatialReference"),{}}get center(){const t=new ke({x:.5*(this.xmin+this.xmax),y:.5*(this.ymin+this.ymax),spatialReference:this.spatialReference});return this.hasZ&&(t.z=.5*(this.zmin+this.zmax)),this.hasM&&(t.m=.5*(this.mmin+this.mmax)),t}get extent(){return this.clone()}get hasM(){return this.mmin!=null&&this.mmax!=null}get hasZ(){return this.zmin!=null&&this.zmax!=null}get height(){return Math.abs(this.ymax-this.ymin)}get width(){return Math.abs(this.xmax-this.xmin)}centerAt(t){const e=this.center;return t.z!=null&&this.hasZ?this.offset(t.x-e.x,t.y-e.y,t.z-e.z):this.offset(t.x-e.x,t.y-e.y)}clone(){const t=new gh;return t.xmin=this.xmin,t.ymin=this.ymin,t.xmax=this.xmax,t.ymax=this.ymax,t.spatialReference=this.spatialReference,this.zmin!=null&&(t.zmin=this.zmin,t.zmax=this.zmax),this.mmin!=null&&(t.mmin=this.mmin,t.mmax=this.mmax),t}contains(t){if(!t)return!1;const e=this.spatialReference,r=t.spatialReference;return e&&r&&!e.equals(r)&&a5(e,r)&&(t=e.isWebMercator?z1(t):IA(t,!0)),t.type==="point"?QK(this,t):t.type==="extent"&&uVe(this,t)}equals(t){if(this===t)return!0;if(t==null)return!1;const e=this.spatialReference,r=t.spatialReference;return e&&r&&!e.equals(r)&&a5(e,r)&&(t=e.isWebMercator?z1(t):IA(t,!0)),this.xmin===t.xmin&&this.ymin===t.ymin&&this.zmin===t.zmin&&this.mmin===t.mmin&&this.xmax===t.xmax&&this.ymax===t.ymax&&this.zmax===t.zmax&&this.mmax===t.mmax}expand(t){const e=.5*(1-t),r=this.width*e,i=this.height*e;if(this.xmin+=r,this.ymin+=i,this.xmax-=r,this.ymax-=i,this.hasZ){const n=(this.zmax-this.zmin)*e;this.zmin+=n,this.zmax-=n}if(this.hasM){const n=(this.mmax-this.mmin)*e;this.mmin+=n,this.mmax-=n}return this}intersects(t){if(t==null)return!1;t.type==="mesh"&&(t=t.extent);const e=this.spatialReference,r=t.spatialReference;return e&&r&&!To(e,r)&&a5(e,r)&&(t=e.isWebMercator?z1(t):IA(t,!0)),TVe(t.type)(this,t)}normalize(){const t=this._normalize(!1,!0);return Array.isArray(t)?t:[t]}offset(t,e,r){return this.xmin+=t,this.ymin+=e,this.xmax+=t,this.ymax+=e,r!=null&&(this.zmin+=r,this.zmax+=r),this}shiftCentralMeridian(){return this._normalize(!0)}union(t){return this===t||(this.xmin=Math.min(this.xmin,t.xmin),this.ymin=Math.min(this.ymin,t.ymin),this.xmax=Math.max(this.xmax,t.xmax),this.ymax=Math.max(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=Fy(Math.min,this.zmin,t.zmin),this.zmax=Fy(Math.max,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=Fy(Math.min,this.mmin,t.mmin),this.mmax=Fy(Math.max,this.mmax,t.mmax))),this}intersection(t){return this===t?this:t!=null&&this.intersects(t)?(this.xmin=Math.max(this.xmin,t.xmin),this.ymin=Math.max(this.ymin,t.ymin),this.xmax=Math.min(this.xmax,t.xmax),this.ymax=Math.min(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=Fy(Math.max,this.zmin,t.zmin),this.zmax=Fy(Math.min,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=Fy(Math.max,this.mmin,t.mmin),this.mmax=Fy(Math.min,this.mmax,t.mmax)),this):null}toJSON(t){return this.write({},t)}_shiftCM(t=Xp(this.spatialReference)){if(!t||!this.spatialReference)return this;const e=this.spatialReference,r=this._getCM(t);if(r){const i=e.isWebMercator?IA(r):r;this.xmin-=r.x,this.xmax-=r.x,e.isWebMercator||(i.x=this._normalizeX(i.x,t).x),this.spatialReference=new lt(SK((e.isWGS84?t.altTemplate:null)??t.wkTemplate,{Central_Meridian:i.x}))}return this}_getCM(t){let e=null;const[r,i]=t.valid,n=this.xmin,s=this.xmax;return n>=r&&n<=i&&s>=r&&s<=i||(e=this.center),e}_normalize(t,e,r){const i=this.spatialReference;if(!i)return this;const n=r??Xp(i);if(n==null)return this;const s=this._getParts(n).map(l=>l.extent);if(s.length<2)return s[0]||this;if(s.length>2)return t?this._shiftCM(n):this.set({xmin:n.valid[0],xmax:n.valid[1]});if(t)return this._shiftCM(n);if(e)return s;let o=!0,a=!0;return s.forEach(l=>{l.hasZ||(o=!1),l.hasM||(a=!1)}),{rings:s.map(l=>{const c=[[l.xmin,l.ymin],[l.xmin,l.ymax],[l.xmax,l.ymax],[l.xmax,l.ymin],[l.xmin,l.ymin]];if(o){const u=(l.zmax-l.zmin)/2;for(let h=0;h<c.length;h++)c[h].push(u)}if(a){const u=(l.mmax-l.mmin)/2;for(let h=0;h<c.length;h++)c[h].push(u)}return c}),hasZ:o,hasM:a,spatialReference:i}}_getParts(t){let e=this.cache._parts;if(!e){e=[];const{ymin:n,ymax:s,spatialReference:o}=this,a=this.width,l=this.xmin,c=this.xmax;let u;t=t||Xp(o);const[h,p]=t.valid;u=this._normalizeX(this.xmin,t);const f=u.x,g=u.frameId;u=this._normalizeX(this.xmax,t);const _=u.x,v=u.frameId,b=f===_&&a>0;if(a>2*p){const w=new gh(l<c?f:_,n,p,s,o),x=new gh(h,n,l<c?_:f,s,o),S=new gh(0,n,p,s,o),E=new gh(h,n,0,s,o),A=[],O=[];w.contains(S)&&A.push(g),w.contains(E)&&O.push(g),x.contains(S)&&A.push(v),x.contains(E)&&O.push(v);for(let L=g+1;L<v;L++)A.push(L),O.push(L);e.push({extent:w,frameIds:[g]},{extent:x,frameIds:[v]},{extent:S,frameIds:A},{extent:E,frameIds:O})}else f>_||b?e.push({extent:new gh(f,n,p,s,o),frameIds:[g]},{extent:new gh(h,n,_,s,o),frameIds:[v]}):e.push({extent:new gh(f,n,_,s,o),frameIds:[g]});this.cache._parts=e}const r=this.hasZ,i=this.hasM;if(r||i){const n={};r&&(n.zmin=this.zmin,n.zmax=this.zmax),i&&(n.mmin=this.mmin,n.mmax=this.mmax);for(let s=0;s<e.length;s++)e[s].extent.set(n)}return e}_normalizeX(t,e){const[r,i]=e.valid,n=2*i;let s,o=0;return t>i?(s=Math.ceil(Math.abs(t-i)/n),t-=s*n,o=s):t<r&&(s=Math.ceil(Math.abs(t-r)/n),t+=s*n,o=-s),{x:t,frameId:o}}};d([m({readOnly:!0})],Ao.prototype,"cache",null),d([m({readOnly:!0})],Ao.prototype,"center",null),d([m({readOnly:!0})],Ao.prototype,"extent",null),d([m({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],Ao.prototype,"hasM",null),d([m({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],Ao.prototype,"hasZ",null),d([m({readOnly:!0})],Ao.prototype,"height",null),d([m({readOnly:!0})],Ao.prototype,"width",null),d([m({type:Number,json:{type:[Number,String],write:{enabled:!0,allowNull:!0}}})],Ao.prototype,"xmin",void 0),d([m({type:Number,json:{write:!0}})],Ao.prototype,"ymin",void 0),d([m({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],Ao.prototype,"mmin",void 0),d([m({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Ao.prototype,"zmin",void 0),d([m({type:Number,json:{write:!0}})],Ao.prototype,"xmax",void 0),d([m({type:Number,json:{write:!0}})],Ao.prototype,"ymax",void 0),d([m({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],Ao.prototype,"mmax",void 0),d([m({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Ao.prototype,"zmax",void 0),Ao=gh=d([V("esri.geometry.Extent")],Ao),Ao.prototype.toJSON.isDefaultToJSON=!0;const ei=Ao;let GO;var $_e,I_e;const CVe=(($_e=globalThis.esriConfig)==null?void 0:$_e.locale)??((I_e=globalThis.dojoConfig)==null?void 0:I_e.locale);function oxe(){var t;return CVe??((t=globalThis.navigator)==null?void 0:t.language)??"en"}function Hu(){return GO===void 0&&(GO=oxe()),GO}function EVe(t=Hu()){const e=/^([a-zA-Z]{2,3})(?:[_\-]\w+)*$/.exec(t);return e==null?void 0:e[1].toLowerCase()}const jO=[];function KK(t){return jO.push(t),Zr(()=>jO.splice(jO.indexOf(t),1))}const SW=[];function eee(t){return SW.push(t),Zr(()=>jO.splice(SW.indexOf(t),1))}function PVe(){const t=oxe();GO!==t&&(GO=t,[...SW].forEach(e=>{e.call(null,t)}),[...jO].forEach(e=>{e.call(null,t)}))}var L_e;(L_e=globalThis.addEventListener)==null||L_e.call(globalThis,"languagechange",PVe);let YL;function AVe(t){return YL&&!YL.destroyed||(YL=t()),YL}var CW;const MVe=new yn({avgRating:"avg-rating",numRatings:"num-ratings",numComments:"num-comments",numViews:"num-views"});let yh=CW=class extends Ae{constructor(t){super(t),this.categories=null,this.disableExtraQuery=!1,this.extent=null,this.filter=null,this.num=10,this.query=null,this.sortField=null,this.start=1}get sortOrder(){return this._get("sortOrder")||"asc"}set sortOrder(t){t!=="asc"&&t!=="desc"||this._set("sortOrder",t)}clone(){return new CW({categories:this.categories?_e(this.categories):null,disableExtraQuery:this.disableExtraQuery,extent:this.extent?this.extent.clone():null,filter:this.filter,num:this.num,query:this.query,sortField:this.sortField,sortOrder:this.sortOrder,start:this.start})}toRequestOptions(t,e){let r=[];this.categories&&(r=this.categories.map(o=>Array.isArray(o)?JSON.stringify(o):o));let i="";if(this.extent){const o=PI(this.extent,lt.WGS84);o!=null&&(i=`${o.xmin},${o.ymin},${o.xmax},${o.ymax}`)}let n=this.query;!this.disableExtraQuery&&t.extraQuery&&(n="("+n+")"+t.extraQuery);const s={categories:r,bbox:i,q:n,filter:this.filter,num:this.num,sortField:null,sortOrder:null,start:this.start};return this.sortField&&(s.sortField=this.sortField.split(",").map(o=>MVe.toJSON(o.trim())).join(","),s.sortOrder=this.sortOrder),{query:{...e,...s}}}};d([m()],yh.prototype,"categories",void 0),d([m()],yh.prototype,"disableExtraQuery",void 0),d([m({type:ei})],yh.prototype,"extent",void 0),d([m()],yh.prototype,"filter",void 0),d([m()],yh.prototype,"num",void 0),d([m()],yh.prototype,"query",void 0),d([m()],yh.prototype,"sortField",void 0),d([m()],yh.prototype,"sortOrder",null),d([m()],yh.prototype,"start",void 0),yh=CW=d([V("esri.portal.PortalQueryParams")],yh);const Tm=yh;var EW;let oo=EW=class extends ze{constructor(t){super(t),this.access=null,this.created=null,this.description=null,this.id=null,this.isInvitationOnly=!1,this.modified=null,this.owner=null,this.portal=null,this.snippet=null,this.sortField=null,this.sortOrder=null,this.sourceJSON=null,this.tags=null,this.title=null}get thumbnailUrl(){var r;const t=this.url,e=this.thumbnail;return t&&e&&this.portal?(r=this.portal)==null?void 0:r.normalizeUrl(`${t}/info/${e}?f=json`):null}get url(){var e;const t=(e=this.portal)==null?void 0:e.restUrl;return t?t+"/community/groups/"+this.id:null}fetchCategorySchema(t){return this.portal.request(this.url+"/categorySchema",t).then(e=>{const r=e.categorySchema||[];return r.some(i=>i.source==="contentCategorySetsGroupQuery.LivingAtlas")?this._fetchCategorySchemaSet("LivingAtlas",t):r})}fetchMembers(t){return this.portal.request(this.url+"/users",t)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}toJSON(){throw new K("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const e=new EW;return e.sourceJSON=t,e.read(t),e}queryItems(t,e){let r=Na(Tm,t);const i=this.portal;return parseFloat(i.currentVersion)>5?(r=r||new Tm,i.queryPortal(`/content/groups/${this.id}/search`,r,"PortalItem",e)):(r=r?r.clone():new Tm,r.query="group:"+this.id+(r.query?" "+r.query:""),i.queryItems(r,e))}_fetchCategorySchemaSet(t,e){const r=this.portal;return r.fetchSelf(r.authMode,!0,e).then(i=>{const n=i.contentCategorySetsGroupQuery;if(n){const s=new Tm;return s.disableExtraQuery=!0,s.num=1,s.query=n,r.queryGroups(s,e)}throw new K("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery value not found")}).then(i=>{if(i.total){const n=i.results[0],s=new Tm;return s.num=1,s.query=`typekeywords:"${t}"`,n.queryItems(s,e)}throw new K("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery group not found")}).then(i=>i.total?i.results[0].fetchData("json",e).then(n=>{const s=n==null?void 0:n.categorySchema;return s!=null&&s.length?s:[]}):[])}};d([m()],oo.prototype,"access",void 0),d([m({type:Date})],oo.prototype,"created",void 0),d([m()],oo.prototype,"description",void 0),d([m()],oo.prototype,"id",void 0),d([m()],oo.prototype,"isInvitationOnly",void 0),d([m({type:Date})],oo.prototype,"modified",void 0),d([m()],oo.prototype,"owner",void 0),d([m()],oo.prototype,"portal",void 0),d([m()],oo.prototype,"snippet",void 0),d([m()],oo.prototype,"sortField",void 0),d([m()],oo.prototype,"sortOrder",void 0),d([m()],oo.prototype,"sourceJSON",void 0),d([m()],oo.prototype,"tags",void 0),d([m()],oo.prototype,"thumbnail",void 0),d([m({readOnly:!0})],oo.prototype,"thumbnailUrl",null),d([m()],oo.prototype,"title",void 0),d([m({readOnly:!0})],oo.prototype,"url",null),oo=EW=d([V("esri.portal.PortalGroup")],oo);const PW=oo;let Bb=class extends Ae{constructor(e){super(e),this.nextQueryParams=null,this.queryParams=null,this.results=null,this.total=null}};d([m()],Bb.prototype,"nextQueryParams",void 0),d([m()],Bb.prototype,"queryParams",void 0),d([m()],Bb.prototype,"results",void 0),d([m()],Bb.prototype,"total",void 0),Bb=d([V("esri.portal.PortalQueryResult")],Bb);const OVe=Bb;let Wg=class extends ze{constructor(e){super(e),this.created=null,this.id=null,this.portal=null,this.title=null,this.username=null}get url(){var r;const e=(r=this.portal)==null?void 0:r.restUrl;return e?`${e}/content/users/${this.username}/${this.id}`:null}toJSON(){throw new K("internal:not-yet-implemented","PortalFolder.toJSON is not yet implemented")}};d([m({type:Date})],Wg.prototype,"created",void 0),d([m()],Wg.prototype,"id",void 0),d([m()],Wg.prototype,"portal",void 0),d([m()],Wg.prototype,"title",void 0),d([m({readOnly:!0})],Wg.prototype,"url",null),d([m()],Wg.prototype,"username",void 0),Wg=d([V("esri.portal.PortalFolder")],Wg);const RVe=Wg;var AW;let Mn=AW=class extends ze{constructor(...t){super(...t),this.access=null,this.created=null,this.culture=null,this.description=null,this.email=null,this.fullName=null,this.modified=null,this.orgId=null,this.portal=null,this.preferredView=null,this.privileges=null,this.region=null,this.role=null,this.roleId=null,this.sourceJSON=null,this.units=null,this.username=null,this.userType=null}get thumbnailUrl(){const t=this.url,e=this.thumbnail;return t&&e?this.portal.normalizeUrl(`${t}/info/${e}?f=json`):null}get userContentUrl(){var e;const t=(e=this.portal)==null?void 0:e.restUrl;return t?`${t}/content/users/${this.username}`:null}get url(){var e;const t=(e=this.portal)==null?void 0:e.restUrl;return t?`${t}/community/users/${this.username}`:null}addItem(t){const e=t&&t.item,r=t==null?void 0:t.data,i=t==null?void 0:t.folder,n={method:"post"};e&&(n.query=e.createPostQuery(),r!=null&&(typeof r=="string"?n.query.text=r:typeof r=="object"&&(n.query.text=JSON.stringify(r))));let s=this.userContentUrl;return i&&(s+="/"+(typeof i=="string"?i:i.id)),this.portal.request(s+"/addItem",n).then(o=>(e.id=o.id,e.portal=this.portal,e.loaded?e.reload():e.load()))}deleteItem(t){let e=this.userContentUrl;return t.ownerFolder&&(e+="/"+t.ownerFolder),this.portal.request(e+`/items/${t.id}/delete`,{method:"post"}).then(()=>{t.id=null,t.portal=null})}deleteItems(t){const e=this.userContentUrl+"/deleteItems",r=t.map(i=>i.id);if(r.length){const i={method:"post",query:{items:r.join(",")}};return this.portal.request(e,i).then(()=>{t.forEach(n=>{n.id=null,n.portal=null})})}return Promise.resolve(void 0)}fetchFolders(){const t={query:{num:1}};return this.portal.request(this.userContentUrl??"",t).then(e=>{let r;return r=e&&e.folders?e.folders.map(i=>{const n=RVe.fromJSON(i);return n.portal=this.portal,n}):[],r})}fetchGroups(){return this.portal.request(this.url??"").then(t=>{let e;return e=t&&t.groups?t.groups.map(r=>{const i=PW.fromJSON(r);return i.portal=this.portal,i}):[],e})}fetchItems(t){const e=t??{};let r,i=this.userContentUrl??"";return e.folder&&(i+="/"+e.folder.id),ge(()=>Promise.resolve().then(()=>hxe),void 0).then(({default:n})=>{r=n;const s={folders:!1,num:e.num||10,start:e.start||1,sortField:e.sortField||"created",sortOrder:e.sortOrder||"asc"};return this.portal.request(i,{query:s})}).then(n=>{let s;return n!=null&&n.items?(s=n.items.map(o=>{const a=r.fromJSON(o);return a.portal=this.portal,a}),Promise.all(s.map(o=>o.load())).catch(o=>o).then(()=>({items:s,nextStart:n.nextStart,total:n.total}))):{items:[],nextStart:-1,total:0}})}fetchTags(){return this.portal.request(this.url+"/tags").then(t=>t.tags)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}queryFavorites(t){return this.favGroupId?(this._favGroup||(this._favGroup=new PW({id:this.favGroupId,portal:this.portal})),this._favGroup.queryItems(t)):Promise.reject(new K("internal:unknown","Unknown internal error",{internalError:"Unknown favGroupId"}))}toJSON(){throw new K("internal:not-yet-implemented","PortalUser.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const e=new AW;return e.sourceJSON=t,e.read(t),e}};d([m()],Mn.prototype,"access",void 0),d([m({type:Date})],Mn.prototype,"created",void 0),d([m()],Mn.prototype,"culture",void 0),d([m()],Mn.prototype,"description",void 0),d([m()],Mn.prototype,"email",void 0),d([m()],Mn.prototype,"favGroupId",void 0),d([m()],Mn.prototype,"fullName",void 0),d([m({type:Date})],Mn.prototype,"modified",void 0),d([m()],Mn.prototype,"orgId",void 0),d([m()],Mn.prototype,"portal",void 0),d([m()],Mn.prototype,"preferredView",void 0),d([m()],Mn.prototype,"privileges",void 0),d([m()],Mn.prototype,"region",void 0),d([m()],Mn.prototype,"role",void 0),d([m()],Mn.prototype,"roleId",void 0),d([m()],Mn.prototype,"sourceJSON",void 0),d([m()],Mn.prototype,"thumbnail",void 0),d([m({readOnly:!0})],Mn.prototype,"thumbnailUrl",null),d([m()],Mn.prototype,"units",void 0),d([m({readOnly:!0})],Mn.prototype,"userContentUrl",null),d([m({readOnly:!0})],Mn.prototype,"url",null),d([m()],Mn.prototype,"username",void 0),d([m()],Mn.prototype,"userType",void 0),Mn=AW=d([V("esri.portal.PortalUser")],Mn);const axe=Mn;var gu;let XL;const xae={PortalGroup:()=>Promise.resolve({default:PW}),PortalItem:()=>ge(()=>Promise.resolve().then(()=>hxe),void 0),PortalUser:()=>Promise.resolve({default:axe})};let Fe=gu=class extends CI(Q0){constructor(t){super(t),this._esriIdCredentialCreateHandle=null,this.access=null,this.allSSL=!1,this.authMode="auto",this.authorizedCrossOriginDomains=null,this.basemapGalleryGroupQuery=null,this.basemapGalleryGroupQuery3D=null,this.bingKey=null,this.canListApps=!1,this.canListData=!1,this.canListPreProvisionedItems=!1,this.canProvisionDirectPurchase=!1,this.canSearchPublic=!0,this.canShareBingPublic=!1,this.canSharePublic=!1,this.canSignInArcGIS=!1,this.canSignInIDP=!1,this.colorSetsGroupQuery=null,this.commentsEnabled=!1,this.created=null,this.culture=null,this.customBaseUrl=null,this.defaultBasemap=null,this.defaultDevBasemap=null,this.defaultExtent=null,this.defaultVectorBasemap=null,this.description=null,this.devBasemapGalleryGroupQuery=null,this.eueiEnabled=null,this.featuredGroups=null,this.featuredItemsGroupQuery=null,this.galleryTemplatesGroupQuery=null,this.layoutGroupQuery=null,this.livingAtlasGroupQuery=null,this.hasCategorySchema=!1,this.helperServices=null,this.homePageFeaturedContent=null,this.homePageFeaturedContentCount=null,this.httpPort=null,this.httpsPort=null,this.id=null,this.ipCntryCode=null,this.isPortal=!1,this.isReadOnly=!1,this.layerTemplatesGroupQuery=null,this.maxTokenExpirationMinutes=null,this.modified=null,this.name=null,this.portalHostname=null,this.portalMode=null,this.portalProperties=null,this.region=null,this.rotatorPanels=null,this.showHomePageDescription=!1,this.sourceJSON=null,this.supportsHostedServices=!1,this.symbolSetsGroupQuery=null,this.templatesGroupQuery=null,this.units=null,this.url=mi.portalUrl,this.urlKey=null,this.user=null,this.use3dBasemaps=!0,this.useStandardizedQuery=!1,this.useVectorBasemaps=!1,this.vectorBasemapGalleryGroupQuery=null}normalizeCtorArgs(t){return typeof t=="string"?{url:t}:t}destroy(){Tae.unregister(this),this.defaultBasemap=Pe(this.defaultBasemap),this.defaultDevBasemap=Pe(this.defaultDevBasemap),this.defaultVectorBasemap=Pe(this.defaultVectorBasemap),this._esriIdCredentialCreateHandle=wi(this._esriIdCredentialCreateHandle)}readAuthorizedCrossOriginDomains(t){if(t)for(const e of t)mi.request.trustedServers.includes(e)||mi.request.trustedServers.push(e);return t}readDefaultBasemap(t){return this._readBasemap(t)}readDefaultDevBasemap(t){return this._readBasemap(t)}readDefaultVectorBasemap(t){return this._readBasemap(t)}get extraQuery(){var r;const t=(r=this.user)==null?void 0:r.orgId,e=!t||this.canSearchPublic;return this.id&&!e?` AND orgid:${this.id}`:null}get isOrganization(){return!!this.access}get itemPageUrl(){return this.url?`${this.url}/home/item.html`:null}get restUrl(){let t=this.url;if(t){const e=t.indexOf("/sharing");t=e>0?t.substring(0,e):this.url.replace(/\/+$/,""),t+="/sharing/rest"}return t}get thumbnailUrl(){const t=this.restUrl,e=this.thumbnail;return t&&e?this._normalizeSSL(t+"/portals/self/resources/"+e):null}readUrlKey(t){return t&&t.toLowerCase()}readUser(t){let e=null;return t&&(e=axe.fromJSON(t),e.portal=this),e}load(t){const e=ge(()=>Promise.resolve().then(()=>h7e),void 0).then(({default:r})=>{vt(t),XL=r}).then(()=>this.sourceJSON?this.sourceJSON:this.fetchSelf(this.authMode,!1,t)).then(r=>{var i;if(Gi){const n=Gi;this.credential=n.findCredential(this.restUrl),this.credential||this.authMode!==gu.AUTH_MODE_AUTO&&this.authMode!==gu.AUTH_MODE_NO_PROMPT||((i=this._esriIdCredentialCreateHandle)==null||i.remove(),this._esriIdCredentialCreateHandle=n.on("credential-create",$Ve(new WeakRef(this))),Tae.register(this,this._esriIdCredentialCreateHandle,this))}this.sourceJSON=r,this.read(r)});return this.addResolvingPromise(e),Promise.resolve(this)}async createElevationLayers(){await this.load();const t=this._getHelperService("defaultElevationLayers"),e=(await ge(()=>import("./ElevationLayer-CmzccZP2.js"),__vite__mapDeps([2,3,4,5,6,7,8,9,10,11]))).default;return t?t.map(r=>new e({id:r.id,url:r.url})):[]}async fetchBasemaps(t,e){const r=await this._fetchBasemaps(t,e);if((e==null?void 0:e.include3d)===!0&&this.use3dBasemaps!==!1){const i=await this._fetchBasemaps3D(t,e);r.unshift(...i)}return r}fetchCategorySchema(t){return this.hasCategorySchema?this.request(this.restUrl+"/portals/self/categorySchema",t).then(e=>e.categorySchema):Ls(t)?Promise.reject(dr()):Promise.resolve([])}fetchFeaturedGroups(t){const e=this.featuredGroups,r=new Tm;if(r.num=100,r.sortField="title",e&&e.length){const i=[];for(const n of e)i.push(`(title:"${n.title}" AND owner:${n.owner})`);return r.query=i.join(" OR "),this.queryGroups(r,t).then(n=>n.results)}return Ls(t)?Promise.reject(dr()):Promise.resolve([])}fetchRegions(t){var r;const e=((r=this.user)==null?void 0:r.culture)||this.culture||Hu();return this.request(this.restUrl+"/portals/regions",{...t,query:{culture:e}})}fetchSettings(t){var r;const e=((r=this.user)==null?void 0:r.culture)||this.culture||Hu();return this.request(this.restUrl+"/portals/self/settings",{...t,query:{culture:e}})}static getDefault(){return AVe(()=>new gu)}queryGroups(t,e){return this.queryPortal("/community/groups",t,"PortalGroup",e)}queryItems(t,e){return this.queryPortal("/search",t,"PortalItem",e)}queryUsers(t,e){return t.sortField||(t.sortField="username"),this.queryPortal("/community/users",t,"PortalUser",e)}fetchSelf(t=this.authMode,e=!1,r){const i=this.restUrl+"/portals/self",n={authMode:t,query:{culture:Hu().toLowerCase()},withCredentials:!0,...r};return n.authMode==="auto"&&(n.authMode="no-prompt"),e&&(n.query.default=!0),this.request(i,n)}queryPortal(t,e,r,i){const n=Na(Tm,e),s=o=>this.request(this.restUrl+t,{...n.toRequestOptions(this),...i}).then(a=>{const l=n.clone();return l.start=a.nextStart,new OVe({nextQueryParams:l,queryParams:n,total:a.total,results:gu._resultsToTypedArray(o,{portal:this},a,i)})}).then(a=>Promise.all(a.results.map(l=>typeof l.when=="function"?l.when():a)).then(()=>a,l=>(J0(l),a)));return r&&xae[r]?xae[r]().then(({default:o})=>(vt(i),s(o))):s()}signIn(){if(this.authMode===gu.AUTH_MODE_ANONYMOUS||this.authMode===gu.AUTH_MODE_NO_PROMPT&&!Gi)return Promise.reject(new K("portal:invalid-auth-mode",`Current "authMode"' is "${this.authMode}"`));if(this.loadStatus==="failed")return Promise.reject(this.loadError);const t=e=>Promise.resolve().then(()=>this.loadStatus==="not-loaded"?(e||(this.authMode="immediate"),this.load().then(()=>null)):this.loadStatus==="loading"?this.load().then(()=>this.credential?null:(this.credential=e,this.fetchSelf("immediate"))):this.user&&this.credential===e?null:(this.credential=e,this.fetchSelf("immediate"))).then(r=>{r&&(this.sourceJSON=r,this.read(r))});return Gi?Gi.getCredential(this.restUrl,{prompt:this.authMode!==gu.AUTH_MODE_NO_PROMPT}).then(e=>t(e)):t(this.credential)}normalizeUrl(t){var r;const e=(r=this.credential)==null?void 0:r.token;return this._normalizeSSL(e?t+(t.includes("?")?"&":"?")+"token="+e:t)}requestToTypedArray(t,e,r){return this.request(t,e).then(i=>{const n=gu._resultsToTypedArray(r,{portal:this},i);return Promise.all(n.map(s=>typeof s.when=="function"?s.when():i)).then(()=>n,()=>n)})}request(t,e={}){const r={f:"json",...e.query},{authMode:i=this.authMode===gu.AUTH_MODE_ANONYMOUS||this.authMode===gu.AUTH_MODE_NO_PROMPT?this.authMode:"auto",body:n=null,cacheBust:s=!1,method:o="auto",responseType:a="json",signal:l}=e,c={authMode:i,body:n,cacheBust:s,method:o,query:r,responseType:a,timeout:0,signal:l};return e.withCredentials&&(c.withCredentials=!0),Xi(this._normalizeSSL(t),c).then(u=>u.data)}toJSON(){throw new K("internal:not-yet-implemented","Portal.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");return new gu({sourceJSON:t})}_getHelperService(t){const e=this.helperServices&&this.helperServices[t];if(!e)throw new K("portal:service-not-found",`The \`helperServices\` do not include an entry named "${t}"`);return e}async _fetchBasemaps(t,e){const r=new Tm;r.query=t||(mi.apiKey&&Pwe(this.url)?this.devBasemapGalleryGroupQuery:this.useVectorBasemaps?this.vectorBasemapGalleryGroupQuery:this.basemapGalleryGroupQuery),r.disableExtraQuery=!0;const i=await this.queryGroups(r,e);if(!i.total)return[];const n=i.results[0];r.num=100,r.query='type:"Web Map" -type:"Web Application"',r.sortField=n.sortField||"name",r.sortOrder=n.sortOrder||"desc";const s=await n.queryItems(r,e);return s.total?s.results.filter(o=>o.type==="Web Map").map(o=>new XL({portalItem:o})):[]}async _fetchBasemaps3D(t,e){const r=t||this.basemapGalleryGroupQuery3D;if(!r)return[];const i=new Tm({query:r,disableExtraQuery:!0}),n=await this.queryGroups(i,e);if(!n.total)return[];const s=n.results[0];i.num=100,i.query='type:"Web Scene"',i.sortField=s.sortField||"name",i.sortOrder=s.sortOrder||"desc";const o=await s.queryItems(i,e);return o.total?o.results.filter(a=>a.type==="Web Scene").map(a=>new XL({portalItem:a})):[]}_normalizeSSL(t){return t.replace(/^http:/i,"https:").replace(":7080",":7443")}_readBasemap(t){if(t){const e=XL.fromJSON(t);return e.portalItem={portal:this},e}return null}static _resultsToTypedArray(t,e,r,i){let n=[];if(r){const s=i!=null?i.signal:null;n=r.listings||r.notifications||r.userInvitations||r.tags||r.items||r.groups||r.comments||r.provisions||r.results||r.relatedItems||r,(t||e)&&(n=n.map(o=>{const a=Object.assign(t?t.fromJSON(o):o,e);return typeof a.load=="function"&&a.load(s),a}))}else n=[];return n}};Fe.AUTH_MODE_ANONYMOUS="anonymous",Fe.AUTH_MODE_AUTO="auto",Fe.AUTH_MODE_IMMEDIATE="immediate",Fe.AUTH_MODE_NO_PROMPT="no-prompt",d([m()],Fe.prototype,"access",void 0),d([m()],Fe.prototype,"allSSL",void 0),d([m()],Fe.prototype,"authMode",void 0),d([m()],Fe.prototype,"authorizedCrossOriginDomains",void 0),d([Tr("authorizedCrossOriginDomains")],Fe.prototype,"readAuthorizedCrossOriginDomains",null),d([m()],Fe.prototype,"basemapGalleryGroupQuery",void 0),d([m({json:{name:"3DBasemapGalleryGroupQuery"}})],Fe.prototype,"basemapGalleryGroupQuery3D",void 0),d([m()],Fe.prototype,"bingKey",void 0),d([m()],Fe.prototype,"canListApps",void 0),d([m()],Fe.prototype,"canListData",void 0),d([m()],Fe.prototype,"canListPreProvisionedItems",void 0),d([m()],Fe.prototype,"canProvisionDirectPurchase",void 0),d([m()],Fe.prototype,"canSearchPublic",void 0),d([m()],Fe.prototype,"canShareBingPublic",void 0),d([m()],Fe.prototype,"canSharePublic",void 0),d([m()],Fe.prototype,"canSignInArcGIS",void 0),d([m()],Fe.prototype,"canSignInIDP",void 0),d([m()],Fe.prototype,"colorSetsGroupQuery",void 0),d([m()],Fe.prototype,"commentsEnabled",void 0),d([m({type:Date})],Fe.prototype,"created",void 0),d([m()],Fe.prototype,"credential",void 0),d([m()],Fe.prototype,"culture",void 0),d([m()],Fe.prototype,"currentVersion",void 0),d([m()],Fe.prototype,"customBaseUrl",void 0),d([m()],Fe.prototype,"defaultBasemap",void 0),d([Tr("defaultBasemap")],Fe.prototype,"readDefaultBasemap",null),d([m()],Fe.prototype,"defaultDevBasemap",void 0),d([Tr("defaultDevBasemap")],Fe.prototype,"readDefaultDevBasemap",null),d([m({type:ei})],Fe.prototype,"defaultExtent",void 0),d([m()],Fe.prototype,"defaultVectorBasemap",void 0),d([Tr("defaultVectorBasemap")],Fe.prototype,"readDefaultVectorBasemap",null),d([m()],Fe.prototype,"description",void 0),d([m()],Fe.prototype,"devBasemapGalleryGroupQuery",void 0),d([m()],Fe.prototype,"eueiEnabled",void 0),d([m({readOnly:!0})],Fe.prototype,"extraQuery",null),d([m()],Fe.prototype,"featuredGroups",void 0),d([m()],Fe.prototype,"featuredItemsGroupQuery",void 0),d([m()],Fe.prototype,"galleryTemplatesGroupQuery",void 0),d([m()],Fe.prototype,"layoutGroupQuery",void 0),d([m()],Fe.prototype,"livingAtlasGroupQuery",void 0),d([m()],Fe.prototype,"hasCategorySchema",void 0),d([m()],Fe.prototype,"helpBase",void 0),d([m()],Fe.prototype,"helperServices",void 0),d([m()],Fe.prototype,"helpMap",void 0),d([m()],Fe.prototype,"homePageFeaturedContent",void 0),d([m()],Fe.prototype,"homePageFeaturedContentCount",void 0),d([m()],Fe.prototype,"httpPort",void 0),d([m()],Fe.prototype,"httpsPort",void 0),d([m()],Fe.prototype,"id",void 0),d([m()],Fe.prototype,"ipCntryCode",void 0),d([m({readOnly:!0})],Fe.prototype,"isOrganization",null),d([m()],Fe.prototype,"isPortal",void 0),d([m()],Fe.prototype,"isReadOnly",void 0),d([m({readOnly:!0})],Fe.prototype,"itemPageUrl",null),d([m()],Fe.prototype,"layerTemplatesGroupQuery",void 0),d([m()],Fe.prototype,"maxTokenExpirationMinutes",void 0),d([m({type:Date})],Fe.prototype,"modified",void 0),d([m()],Fe.prototype,"name",void 0),d([m()],Fe.prototype,"portalHostname",void 0),d([m()],Fe.prototype,"portalMode",void 0),d([m()],Fe.prototype,"portalProperties",void 0),d([m()],Fe.prototype,"region",void 0),d([m({readOnly:!0})],Fe.prototype,"restUrl",null),d([m()],Fe.prototype,"rotatorPanels",void 0),d([m()],Fe.prototype,"showHomePageDescription",void 0),d([m()],Fe.prototype,"sourceJSON",void 0),d([m()],Fe.prototype,"staticImagesUrl",void 0),d([m({json:{name:"2DStylesGroupQuery"}})],Fe.prototype,"stylesGroupQuery2d",void 0),d([m({json:{name:"stylesGroupQuery"}})],Fe.prototype,"stylesGroupQuery3d",void 0),d([m()],Fe.prototype,"supportsHostedServices",void 0),d([m()],Fe.prototype,"symbolSetsGroupQuery",void 0),d([m()],Fe.prototype,"templatesGroupQuery",void 0),d([m()],Fe.prototype,"thumbnail",void 0),d([m({readOnly:!0})],Fe.prototype,"thumbnailUrl",null),d([m()],Fe.prototype,"units",void 0),d([m()],Fe.prototype,"url",void 0),d([m()],Fe.prototype,"urlKey",void 0),d([Tr("urlKey")],Fe.prototype,"readUrlKey",null),d([m()],Fe.prototype,"user",void 0),d([Tr("user")],Fe.prototype,"readUser",null),d([m()],Fe.prototype,"use3dBasemaps",void 0),d([m()],Fe.prototype,"useStandardizedQuery",void 0),d([m()],Fe.prototype,"useVectorBasemaps",void 0),d([m()],Fe.prototype,"vectorBasemapGalleryGroupQuery",void 0),Fe=gu=d([V("esri.portal.Portal")],Fe);const ud=Fe,Tae=new FinalizationRegistry(t=>{t.remove()});function $Ve(t){const e=Gi;return()=>{const r=t.deref();r&&e.findCredential(r.restUrl)&&r.signIn().catch(()=>{})}}let qg=class extends Ae{constructor(e){super(e),this.portalItem=null}normalizeCtorArgs(e){return e!=null&&e.portalItem&&e.path?{...e,path:this._normalizePath(e.path,e.portalItem)}:e}set path(e){e!=null&&ju(e)?re.getLogger(this).error("portalitemresource:invalid-path","A portal item resource path must be relative"):this._set("path",e)}_castPath(e){return this._normalizePath(e,this.portalItem)}get url(){return this.portalItem&&this.path?`${this.portalItem.itemUrl}/resources/${this.path}`:null}get cdnUrl(){return this.portalItem&&this.path?`${this.portalItem.itemCdnUrl}/resources/${this.path}`:null}get itemRelativeUrl(){return this.portalItem&&this.path?`./resources/${this.path}`:null}fetch(e="json",r){const i=this.cdnUrl;if(i==null)throw new K("portal-item-resource:fetch","Portal item resource does not refer to a valid item or path");return this.portalItem.portal.request(i,{responseType:e,query:{token:this.portalItem.apiKey},signal:r==null?void 0:r.signal})}async update(e,r){const{addOrUpdateResources:i}=await ge(()=>import("./resourceUtils-yTEArpxg.js"),__vite__mapDeps([]));return await i(this.portalItem,[{resource:this,content:e,compress:r==null?void 0:r.compress,access:r==null?void 0:r.access}],"update",r),this}hasPath(){return this.path!=null}_normalizePath(e,r){return e==null?e:(e=e.replace(/^\/+/,""),r!=null&&ju(e)&&(e=Uz(e,r.itemUrl)),e==null?void 0:e.replace(/^\/+/,"").replace(/^(\.\/)?resources\//,""))}};d([m()],qg.prototype,"portalItem",void 0),d([m({type:String,value:null})],qg.prototype,"path",null),d([ai("path")],qg.prototype,"_castPath",null),d([m({type:String,readOnly:!0})],qg.prototype,"url",null),d([m({type:String,readOnly:!0})],qg.prototype,"cdnUrl",null),d([m({type:String,readOnly:!0})],qg.prototype,"itemRelativeUrl",null),qg=d([V("esri.portal.PortalItemResource")],qg);const IVe=qg;let LA=class extends Ae{constructor(e){super(e),this.created=null,this.rating=null}};d([m()],LA.prototype,"created",void 0),d([m()],LA.prototype,"rating",void 0),LA=d([V("esri.portal.PortalRating")],LA);const YB=LA;function t2(t,e){var i;const r=(i=e==null?void 0:e.url)==null?void 0:i.path;if(t&&r&&(t=Du(t,r,{preserveProtocolRelative:!0}),e.portalItem&&e.readResourcePaths)){const n=Uz(t,e.portalItem.itemUrl);n!=null&&LVe.test(n)&&e.readResourcePaths.push(e.portalItem.resourceFromPath(n).path)}return(t=MW(t,e==null?void 0:e.portal))&&Yz.test(t)?ree(t):t}function OE(t,e,r=f$.YES){var n,s;if((t=t&&Yz.test(t)?cxe(t):t)==null)return t;!ju(t)&&(e!=null&&e.blockedRelativeUrls)&&e.blockedRelativeUrls.push(t);let i=Du(t);if(e){const o=((n=e.verifyItemRelativeUrls)==null?void 0:n.rootPath)||((s=e.url)==null?void 0:s.path);if(o){const a=MW(o,e.portal),l=MW(i,e.portal);i=Uz(l,a,a),i!=null&&i!==l&&i!==t&&e.verifyItemRelativeUrls&&e.verifyItemRelativeUrls.writtenUrls.push(i)}}return i=lxe(i,e==null?void 0:e.portal),ju(i)&&(i=L0(i)),e!=null&&e.resources&&(e!=null&&e.portalItem)&&!ju(i)&&!mg(i)&&r===f$.YES&&e.resources.toKeep.push({resource:e.portalItem.resourceFromPath(i),compress:!1}),i}function tee(t,e,r){return t2(t,r)}function r2(t,e,r,i){const n=OE(t,i);n!==void 0&&(e[r]=n)}const Yz=/\/items\/([^\/]+)\/resources\/(.*)/,LVe=/^\.\/resources\//;function DVe(t){const e=(t==null?void 0:t.match(Yz))??null;return(e==null?void 0:e[1])??null}function NVe(t){const e=(t==null?void 0:t.match(Yz))??null;if(e==null)return null;const r=e[2],i=r.lastIndexOf("/");if(i===-1){const{path:o,extension:a}=lae(r);return{prefix:null,filename:o,extension:a}}const{path:n,extension:s}=lae(r.slice(i+1));return{prefix:r.slice(0,i),filename:n,extension:s}}function lxe(t,e){return e&&!e.isPortal&&e.urlKey&&e.customBaseUrl?hW(t,`${e.urlKey}.${e.customBaseUrl}`,e.portalHostname):t}function MW(t,e){if(!e||e.isPortal||!e.urlKey||!e.customBaseUrl)return t;const r=`${e.urlKey}.${e.customBaseUrl}`,i=kK();return CE(i,`${i.scheme}://${r}`)?hW(t,e.portalHostname,r):hW(t,r,e.portalHostname)}function ree(t){if(!t)return t||null;let e=t;return e&&Gi&&!Gi.findCredential(e)&&(e=Gi._normalizeAGOLorgDomain(e),e=e.replace(/^https?:\/\/www\.arcgis\.com/,"https://cdn.arcgis.com"),e=e.replace(/^https?:\/\/devext\.arcgis\.com/,"https://cdndev.arcgis.com"),e=e.replace(/^https?:\/\/qaext\.arcgis\.com/,"https://cdnqa.arcgis.com")),e}function cxe(t){if(!t)return t||null;let e=t;return e=e.replace(/^https?:\/\/cdn\.arcgis\.com/,"https://www.arcgis.com"),e=e.replace(/^https?:\/\/cdndev\.arcgis\.com/,"https://devext.arcgis.com"),e=e.replace(/^https?:\/\/cdnqa\.arcgis\.com/,"https://qaext.arcgis.com"),e&&Gi&&!Gi.findCredential(e)&&(e=Gi._normalizeAGOLorgDomain(e)),e}var f$;(function(t){t[t.YES=0]="YES",t[t.NO=1]="NO"})(f$||(f$={}));const eFt=Object.freeze(Object.defineProperty({__proto__:null,get MarkKeep(){return f$},ensureMainOnlineDomain:lxe,fromCDNUrl:cxe,fromJSON:t2,itemIdFromResourceUrl:DVe,prefixAndFilenameFromResourceUrl:NVe,read:tee,toCDNUrl:ree,toJSON:OE,write:r2},Symbol.toStringTag,{value:"Module"}));var Vb;const FVe=new Set(["3DTiles Service","CSV","Feature Collection","Feature Service","Feed","GeoJson","Group Layer","Image Service","KML","Map Service","Media Layer","Scene Service","Stream Service","Vector Tile Service","WFS","WMS","WMTS"]),kVe=new Set(["KML","GeoJson","CSV"]);let ar=Vb=class extends CI(Q0){static from(t){return Yx(Vb,t)}constructor(t){super(t),this.access=null,this.accessInformation=null,this.apiKey=null,this.applicationProxies=null,this.avgRating=null,this.categories=null,this.created=null,this.culture=null,this.description=null,this.extent=null,this.groupCategories=null,this.id=null,this.isOrgItem=!1,this.itemControl=null,this.licenseInfo=null,this.modified=null,this.name=null,this.numComments=null,this.numRatings=null,this.numViews=null,this.owner=null,this.ownerFolder=null,this.portal=null,this.screenshots=null,this.size=null,this.snippet=null,this.sourceJSON=null,this.sourceUrl=null,this.spatialReference=null,this.tags=null,this.title=null,this.type=null,this.typeKeywords=null,this.url=null}destroy(){this.portal=null}get displayName(){const t=this.type,e=this.typeKeywords||[];let r=t;return t==="Feature Service"||t==="Feature Collection"?r=e.includes("Table")?"Table":e.includes("Route Layer")?"Route Layer":e.includes("Markup")?"Markup":"Feature Layer":t==="Image Service"?r=e.includes("Elevation 3D Layer")?"Elevation Layer":e.includes("Tiled Imagery")?"Tiled Imagery Layer":"Imagery Layer":t==="Scene Service"?r="Scene Layer":t==="Video Service"?r="Video Layer":t==="Scene Package"?r="Scene Layer Package":t==="Stream Service"?r="Feature Layer":t==="Geoprocessing Service"?r=e.includes("Web Tool")?"Tool":"Geoprocessing Service":t==="Geoenrichment Service"?r="GeoEnrichment Service":t==="Geocoding Service"?r="Locator":t==="Microsoft Powerpoint"?r="Microsoft PowerPoint":t==="GeoJson"?r="GeoJSON":t==="Globe Service"?r="Globe Layer":t==="Vector Tile Service"?r="Tile Layer":t==="netCDF"?r="NetCDF":t==="Map Service"?r=e.includes("Spatiotemporal")||!e.includes("Hosted Service")&&!e.includes("Tiled")||e.includes("Relational")?"Map Image Layer":"Tile Layer":t&&t.toLowerCase().includes("add in")?r=t.replaceAll(/(add in)/gi,"Add-In"):t==="datastore catalog service"?r="Big Data File Share":t==="Compact Tile Package"?r="Tile Package (tpkx)":t==="Raster function template"?r="Raster Function Template":t==="OGCFeatureServer"?r="OGC Feature Layer":t==="web mapping application"&&e.includes("configurableApp")?r="Instant App":t==="Insights Page"?r="Insights Report":t==="Excalibur Imagery Project"?r="Excalibur Project":t==="3DTiles Service"?r="3D tiles layer":t==="3DTiles Package"&&(r="3D tiles package"),r}readExtent(t){return t&&t.length?new ei(t[0][0],t[0][1],t[1][0],t[1][1]):null}get iconUrl(){var f;const t=((f=this.type)==null?void 0:f.toLowerCase())||"",e=this.typeKeywords||[],r="esri/images/portal/",i="16";let n,s=!1,o=!1,a=!1,l=!1,c=!1,u=!1,h=!1,p=!1;return t.indexOf("service")>0||t==="feature collection"||t==="kml"||t==="wms"||t==="wmts"||t==="wfs"?(s=e.includes("Hosted Service"),t==="feature service"||t==="feature collection"||t==="kml"||t==="wfs"?(o=e.includes("Table"),a=e.includes("Route Layer"),l=e.includes("Markup"),c=e.includes("Spatiotemporal"),u=e.includes("UtilityNetwork"),n=c&&o?"spatiotemporaltable":o?"table":a?"routelayer":l?"markup":c?"spatiotemporal":u?"utilitynetwork":s?"featureshosted":"features"):t==="map service"||t==="wms"||t==="wmts"?(c=e.includes("Spatiotemporal"),h=e.includes("Relational"),n=c||h?"mapimages":s||e.includes("Tiled")||t==="wmts"?"maptiles":"mapimages"):n=t==="scene service"?e.includes("Line")?"sceneweblayerline":e.includes("3DObject")?"sceneweblayermultipatch":e.includes("Point")?"sceneweblayerpoint":e.includes("IntegratedMesh")?"sceneweblayermesh":e.includes("PointCloud")?"sceneweblayerpointcloud":e.includes("Polygon")?"sceneweblayerpolygon":e.includes("Building")?"sceneweblayerbuilding":e.includes("Voxel")?"sceneweblayervoxel":"sceneweblayer":t==="image service"?e.includes("Elevation 3D Layer")?"elevationlayer":e.includes("Tiled Imagery")?"tiledimagerylayer":"imagery":t==="stream service"?"streamlayer":t==="vector tile service"?"vectortile":t==="datastore catalog service"?"datastorecollection":t==="geocoding service"?"geocodeservice":t==="video service"?e.includes("Live Stream")?"livestreamvideolayer":"videolayer":t==="geoprocessing service"?e.includes("Web Tool")?"tool":"layers":t==="geodata service"?"geodataservice":t==="3dtiles service"?e.includes("3DObject")?"3dobjecttileslayer":e.includes("IntegratedMesh")?"integratedmeshtileslayer":"3dtileslayer":"layers"):t==="web map"||t==="cityengine web scene"?n="maps":t==="web scene"?n=e.includes("ViewingMode-Local")?"webscenelocal":"websceneglobal":t==="web mapping application"&&e.includes("configurableApp")?n="instantapps":t==="web mapping application"||t==="mobile application"||t==="application"||t==="operation view"||t==="desktop application"?n="apps":t==="map document"||t==="map package"||t==="published map"||t==="scene document"||t==="globe document"||t==="basemap package"||t==="mobile basemap package"||t==="mobile map package"||t==="project package"||t==="project template"||t==="pro map"||t==="layout"||t==="layer"&&e.includes("ArcGIS Pro")||t==="explorer map"&&e.indexOf("Explorer Document")?n="mapsgray":t==="service definition"||t==="shapefile"||t==="cad drawing"||t==="geojson"||t==="netcdf"||t==="administrative report"?n="datafiles":t==="360 vr experience"?n="360vr":t==="explorer add in"||t==="desktop add in"||t==="windows viewer add in"||t==="windows viewer configuration"?n="appsgray":t==="arcgis pro add in"||t==="arcgis pro configuration"?n="addindesktop":t==="pdf"?n="pdf":t==="microsoft word"?n="word":t==="microsoft excel"?n="excel":t==="microsoft powerpoint"?n="ppt":t==="rule package"||t==="file geodatabase"||t==="sqlite geodatabase"||t==="csv collection"||t==="kml collection"||t==="windows mobile package"||t==="map template"||t==="desktop application template"||t==="gml"||t==="arcpad package"||t==="code sample"||t==="document link"||t==="earth configuration"||t==="operations dashboard add in"||t==="rules package"||t==="workflow manager package"||t==="explorer map"&&e.includes("Explorer Mapping Application")||e.includes("Document")?n="datafilesgray":t==="network analysis service"||t==="geoprocessing service"||t==="geodata service"||t==="geometry service"||t==="geoprocessing package"||t==="locator package"||t==="geoprocessing sample"||t==="workflow manager service"?n="toolsgray":t==="layer"||t==="layer package"||t==="explorer layer"?n="layersgray":t==="scene package"?n="scenepackage":t==="3dtiles package"?n="3dtileslayerpackage":t==="3dtiles service"?n="3dtileslayer":t==="mobile scene package"?n="mobilescenepackage":t==="tile package"||t==="compact tile package"?n="tilepackage":t==="task file"?n="taskfile":t==="report template"?n="report-template":t==="statistical data collection"?n="statisticaldatacollection":t==="insights workbook"?n="workbook":t==="insights model"?n="insightsmodel":t==="insights page"?n="insightspage":t==="insights theme"?n="insightstheme":t==="hub initiative"?n="hubinitiative":t==="hub page"?n="hubpage":t==="hub site application"?n="hubsite":t==="hub event"?n="hubevent":t==="hub project"?n="hubproject":t==="relational database connection"?n="relationaldatabaseconnection":t==="big data file share"?n="datastorecollection":t==="image collection"?n="imagecollection":t==="desktop style"?n="desktopstyle":t==="style"?n="style":t==="dashboard"?n="dashboard":t==="raster function template"?n="rasterprocessingtemplate":t==="vector tile package"?n="vectortilepackage":t==="ortho mapping project"?n="orthomappingproject":t==="ortho mapping template"?n="orthomappingtemplate":t==="solution"?n="solutions":t==="geopackage"?n="geopackage":t==="deep learning package"?n="deeplearningpackage":t==="real time analytic"?n="realtimeanalytics":t==="big data analytic"?n="bigdataanalytics":t==="feed"?n="feed":t==="excalibur imagery project"?n="excaliburimageryproject":t==="notebook"?n="notebook":t==="storymap"?n="storymap":t==="survey123 add in"?n="survey123addin":t==="mission"?n="mission":t==="mission report"?n="missionreport":t==="mission template"?n="missiontemplate":t==="quickcapture project"?n="quickcaptureproject":t==="pro report"?n="proreport":t==="pro report template"?n="proreporttemplate":t==="urban model"?n="urbanmodel":t==="web experience"?n="experiencebuilder":t==="web experience template"?n="webexperiencetemplate":t==="experience builder widget"?n="experiencebuilderwidget":t==="experience builder widget package"?n="experiencebuilderwidgetpackage":t==="workflow"?n="workflow":t==="kernel gateway connection"?n="kernelgatewayconnection":t==="insights script"?n="insightsscript":t==="hub initiative template"?n="hubinitiativetemplate":t==="storymap theme"?n="storymaptheme":t==="knowledge graph"?n="knowledgegraph":t==="knowledge studio project"?n="knowledgestudio":t==="native application"?n="nativeapp":t==="native application installer"?n="nativeappinstaller":t==="web link chart"?n="linkchart":t==="knowledge graph web investigation"?n="investigation":t==="ogcfeatureserver"?n="features":t==="pro project"?n="proproject":t==="insights workbook package"?n="insightsworkbookpackage":t==="apache parquet"?n="apacheparquet":t==="notebook code snippets"||t==="notebook code snippet library"?n="notebookcodesnippets":t==="suitability model"?n="suitabilitymodel":t==="esri classifier definition"?n="classifierdefinition":t==="esri classification schema"?n="classificationschema":t==="insights data engineering workbook"?n="dataengineeringworkbook":t==="insights data engineering model"?n="dataengineeringmodel":t==="deep learning studio project"?n="deeplearningproject":t==="discussion"?n="discussion":t==="allsource project"?n="allsourceproject":t==="api key"?n="apikey":t==="data pipeline"?n="datapipelines":t==="group layer"?(p=e.includes("Map"),n=p?"layergroup2d":"layergroup"):n=t==="media layer"?"onlinemedialayer":t==="form"?e.includes("Survey123")?"survey":"datafilesgray":t==="csv"?"csv":t==="image"?"image":"maps",n?ii(r+n+i+".png"):null}get isLayer(){return this.type!=null&&FVe.has(this.type)}get itemCdnUrl(){return ree(this.itemUrl)}get itemPageUrl(){var e;const t=(e=this.portal)==null?void 0:e.itemPageUrl;return t&&this.id?`${t}?id=${this.id}`:null}get itemUrl(){var e;const t=(e=this.portal)==null?void 0:e.restUrl;return t&&this.id?`${t}/content/items/${this.id}`:null}get thumbnailUrl(){var r;const t=this.itemUrl,e=this.thumbnail;return t&&e?((r=this.portal)==null?void 0:r.normalizeUrl(`${t}/info/${e}?f=json`))??null:null}get userItemUrl(){var r,i,n;const t=(r=this.portal)==null?void 0:r.restUrl;if(!t)return null;const e=this.owner||((n=(i=this.portal)==null?void 0:i.user)==null?void 0:n.username);return e?`${t}/content/users/${this.ownerFolder?`${e}/${this.ownerFolder}`:e}/items/${this.id}`:null}load(t){const e=this.portal??(this.portal=ud.getDefault()),r=e.load(t).then(()=>this.sourceJSON?this.sourceJSON:this.id&&this.itemUrl?e.request(this.itemUrl,{signal:t!=null?t.signal:null,query:{token:this.apiKey}}):{}).then(i=>{this.sourceJSON=i,this.read(i)});return this.addResolvingPromise(r),Promise.resolve(this)}async addRating(t){const e={method:"post",query:{}};return t instanceof YB&&(t=t.rating),t==null||isNaN(t)||typeof t!="number"||(e.query.rating=t),this.portal?(await this.portal.request(this.itemUrl+"/addRating",e),new YB({rating:t,created:new Date})):null}clone(){const t={access:this.access,accessInformation:this.accessInformation,applicationProxies:_e(this.applicationProxies),avgRating:this.avgRating,categories:_e(this.categories),created:_e(this.created),culture:this.culture,description:this.description,extent:_e(this.extent),groupCategories:_e(this.groupCategories),id:this.id,itemControl:this.itemControl,licenseInfo:this.licenseInfo,modified:_e(this.modified),name:this.name,numComments:this.numComments,numRatings:this.numRatings,numViews:this.numViews,owner:this.owner,ownerFolder:this.ownerFolder,portal:this.portal,screenshots:_e(this.screenshots),size:this.size,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:_e(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:_e(this.typeKeywords),url:this.url};this.loaded&&(t.loadStatus="loaded");const e=new Vb({sourceJSON:this.sourceJSON}).set(t);return e._set("isOrgItem",this.isOrgItem),e}createPostQuery(){var r;const t=this.toJSON();for(const i of["tags","typeKeywords","categories"])t[i]=(r=t[i])==null?void 0:r.join(", ");const{extent:e}=t;return e&&(t.extent=JSON.stringify(e)),t}async deleteRating(){await this.portal.request(this.itemUrl+"/deleteRating",{method:"post"})}fetchData(t="json",e){return this.portal.request(this.itemUrl+"/data",{responseType:t,...e,query:{token:this.apiKey}})}async fetchRating(t){const e=await this.portal.request(this.itemUrl+"/rating",{query:{token:this.apiKey},...t});return e.rating!=null?(e.created=new Date(e.created),new YB(e)):null}fetchRelatedItems(t,e){return this.portal.requestToTypedArray(this.itemUrl+"/relatedItems",{query:{...t,token:this.apiKey},...e},Vb)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}reload(){return this.portal.request(this.itemUrl??"",{cacheBust:!0,query:{token:this.apiKey}}).then(t=>(this.sourceJSON=t,this.read(t),this))}update(t){return this.id?this.load().then(()=>this.portal.signIn()).then(()=>{const e=t==null?void 0:t.data,r={method:"post"};r.query=this.createPostQuery();for(const i in r.query)r.query[i]===null&&(r.query[i]="");return r.query.clearEmptyFields=!0,e!=null&&(typeof e=="string"?r.query.text=e:typeof e=="object"&&(r.query.text=JSON.stringify(e))),this.portal.request(`${this.userItemUrl}/update`,r).then(()=>this.reload())}):Promise.reject(new K("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async copy(t){if(!this.id)throw new K("portal:item-does-not-exist","The item does not exist yet");await this.load();const{portal:e,itemUrl:r}=this;await e.signIn();const{copyResources:i,folder:n,tags:s,title:o}=t||{},a={method:"post",query:{copyPrivateResources:i==="all",folder:typeof n=="string"?n:n==null?void 0:n.id,includeResources:!!i,tags:s==null?void 0:s.join(","),title:o}},{itemId:l}=await e.request(`${r}/copy`,a);return new Vb({id:l,portal:e})}updateThumbnail(t){return this.id?this.load().then(()=>this.portal.signIn()).then(()=>{const e=t.thumbnail,r=t.filename,i={method:"post"};if(typeof e=="string")mg(e)?i.query={data:e}:i.query={url:Du(e)},r!=null&&(i.query.filename=r);else{const n=new FormData;r!=null?n.append("file",e,r):n.append("file",e),i.body=n}return this.portal.request(`${this.userItemUrl}/updateThumbnail`,i).then(()=>this.reload())}):Promise.reject(new K("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async fetchResources(t={},e){const{fetchResources:r}=await ge(()=>import("./resourceUtils-yTEArpxg.js"),__vite__mapDeps([]));return r(this,t,e)}async addResource(t,e,r){const{addOrUpdateResources:i}=await ge(()=>import("./resourceUtils-yTEArpxg.js"),__vite__mapDeps([]));return t.portalItem=this,await i(this,[{resource:t,content:e,compress:r==null?void 0:r.compress,access:r==null?void 0:r.access}],"add",r),t}async removeResource(t,e){const{removeResource:r}=await ge(()=>import("./resourceUtils-yTEArpxg.js"),__vite__mapDeps([]));if(t.portalItem&&t.portalItem.itemUrl!==this.itemUrl)throw new K("removeresource:portal-item-mismatch","The portal item associated with the provided resource does not match the item");return r(this,t,e)}async removeAllResources(t){const{removeAllResources:e}=await ge(()=>import("./resourceUtils-yTEArpxg.js"),__vite__mapDeps([]));return e(this,t)}resourceFromPath(t){return new IVe({portalItem:this,path:t})}toJSON(){var r,i;const t=this.extent,e={accessInformation:this.accessInformation,categories:_e(this.categories),created:(r=this.created)==null?void 0:r.getTime(),description:this.description,extent:t&&[[t.xmin,t.ymin],[t.xmax,t.ymax]],id:this.id,isOrgItem:this.isOrgItem,licenseInfo:this.licenseInfo,modified:(i=this.modified)==null?void 0:i.getTime(),name:this.name,owner:this.owner,ownerFolder:this.ownerFolder,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:_e(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:_e(this.typeKeywords),url:this.url};return hbe(e)}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");return new Vb({sourceJSON:t})}_getPostQuery(){const t=this.toJSON();for(const e in t)e==="tags"&&t[e]!==null&&(t[e]=t[e].join(", ")),e==="typeKeywords"&&t[e]!==null&&(t[e]=t[e].join(", ")),e==="extent"&&t[e]&&(t[e]=JSON.stringify(t[e]));return t}};d([m({type:["private","shared","org","public"]})],ar.prototype,"access",void 0),d([m()],ar.prototype,"accessInformation",void 0),d([m({type:String})],ar.prototype,"apiKey",void 0),d([m({json:{read:{source:"appProxies"}}})],ar.prototype,"applicationProxies",void 0),d([m()],ar.prototype,"avgRating",void 0),d([m()],ar.prototype,"categories",void 0),d([m({type:Date})],ar.prototype,"created",void 0),d([m()],ar.prototype,"culture",void 0),d([m()],ar.prototype,"description",void 0),d([m({readOnly:!0})],ar.prototype,"displayName",null),d([m({type:ei})],ar.prototype,"extent",void 0),d([Tr("extent")],ar.prototype,"readExtent",null),d([m()],ar.prototype,"groupCategories",void 0),d([m({readOnly:!0})],ar.prototype,"iconUrl",null),d([m()],ar.prototype,"id",void 0),d([m({readOnly:!0})],ar.prototype,"isLayer",null),d([m({type:Boolean,readOnly:!0})],ar.prototype,"isOrgItem",void 0),d([m()],ar.prototype,"itemControl",void 0),d([m({readOnly:!0})],ar.prototype,"itemPageUrl",null),d([m({readOnly:!0})],ar.prototype,"itemUrl",null),d([m()],ar.prototype,"licenseInfo",void 0),d([m({type:Date})],ar.prototype,"modified",void 0),d([m()],ar.prototype,"name",void 0),d([m()],ar.prototype,"numComments",void 0),d([m()],ar.prototype,"numRatings",void 0),d([m()],ar.prototype,"numViews",void 0),d([m()],ar.prototype,"owner",void 0),d([m()],ar.prototype,"ownerFolder",void 0),d([m({type:ud})],ar.prototype,"portal",void 0),d([m()],ar.prototype,"screenshots",void 0),d([m()],ar.prototype,"size",void 0),d([m()],ar.prototype,"snippet",void 0),d([m()],ar.prototype,"sourceJSON",void 0),d([m({type:String})],ar.prototype,"sourceUrl",void 0),d([m({type:String})],ar.prototype,"spatialReference",void 0),d([m()],ar.prototype,"tags",void 0),d([m()],ar.prototype,"thumbnail",void 0),d([m({readOnly:!0})],ar.prototype,"thumbnailUrl",null),d([m()],ar.prototype,"title",void 0),d([m()],ar.prototype,"type",void 0),d([m()],ar.prototype,"typeKeywords",void 0),d([m({type:String,json:{read(t,e){var r;if(kVe.has(e.type)){const i=(r=this.portal)==null?void 0:r.restUrl;t||(t=i&&this.id?`${i}/content/items/${this.id}/data`:null)}return t}}})],ar.prototype,"url",void 0),d([m({readOnly:!0})],ar.prototype,"userItemUrl",null),ar=Vb=d([V("esri.portal.PortalItem")],ar);const uxe=ar,hxe=Object.freeze(Object.defineProperty({__proto__:null,default:uxe},Symbol.toStringTag,{value:"Module"})),Sae=/^([a-z]{2})(?:[-_]([A-Za-z]{2}))?$/,zVe={ar:!0,bg:!0,bs:!0,ca:!0,cs:!0,da:!0,de:!0,el:!0,en:!0,es:!0,et:!0,fi:!0,fr:!0,he:!0,hr:!0,hu:!0,id:!0,it:!0,ja:!0,ko:!0,lt:!0,lv:!0,nb:!0,nl:!0,pl:!0,"pt-BR":!0,"pt-PT":!0,ro:!0,ru:!0,sk:!0,sl:!0,sr:!0,sv:!0,th:!0,tr:!0,uk:!0,vi:!0,"zh-CN":!0,"zh-HK":!0,"zh-TW":!0};function Cae(t){return t in zVe}const DA=[],zC=new Map;function Eae(t){for(const e of zC.keys())dxe(t.pattern,e)&&zC.delete(e)}function UVe(t){return DA.includes(t)||(Eae(t),DA.unshift(t)),Zr(()=>{const e=DA.indexOf(t);e>-1&&(DA.splice(e,1),Eae(t))})}async function iee(t){const e=Hu();zC.has(t)||zC.set(t,VVe(t,e));const r=zC.get(t);return r&&await GVe.add(r),r}function BVe(t){if(!Sae.test(t))return null;const e=Sae.exec(t);if(e===null)return null;const[,r,i]=e,n=r+(i?"-"+i.toUpperCase():"");return Cae(n)?n:Cae(r)?r:null}async function VVe(t,e){const r=[];for(const i of DA)if(dxe(i.pattern,t))try{return await i.fetchMessageBundle(t,e)}catch(n){r.push(n)}throw r.length?new K("intl:message-bundle-error",`Errors occurred while loading "${t}"`,{errors:r}):new K("intl:no-message-bundle-loader",`No loader found for message bundle "${t}"`)}function dxe(t,e){return typeof t=="string"?e.startsWith(t):t.test(e)}eee(()=>{zC.clear()});const GVe=new class{constructor(){this._numLoading=0,this._dfd=null}async waitForAll(){this._dfd&&await this._dfd.promise}add(t){return this._increase(),t.then(()=>this._decrease(),()=>this._decrease()),this.waitForAll()}_increase(){this._numLoading++,this._dfd||(this._dfd=ha())}_decrease(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&this._numLoading===0&&(this._dfd.resolve(),this._dfd=null)}};async function jVe(t){if(!t)return;const e=t.includes("-vector")?t.slice(0,t.indexOf("-vector")):t.includes("-3d")?t.slice(0,t.indexOf("-3d")):t,r=await iee("esri/t9n/basemaps");return r[t]||r[e]}const OW={satellite:{id:"satellite",classic:!0,get thumbnailUrl(){return ii("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",classic:!0,get thumbnailUrl(){return ii("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/30d6b8271e1849cd9c3042060001f425/resources/styles/root.json",layerType:"VectorTileLayer",title:"Hybrid Reference Layer",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",classic:!0,get thumbnailUrl(){return ii("esri/images/basemap/terrain.jpg")},baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",classic:!0,get thumbnailUrl(){return ii("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},osm:{id:"osm",classic:!0,get thumbnailUrl(){return ii("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",classic:!0,get thumbnailUrl(){return ii("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get"dark-gray"(){return{...this["dark-gray-vector"],id:"dark-gray"}},"gray-vector":{id:"gray-vector",classic:!0,get thumbnailUrl(){return ii("esri/images/basemap/gray-vector.jpg")},baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get gray(){return{...this["gray-vector"],id:"gray"}},"streets-vector":{id:"streets-vector",classic:!0,get thumbnailUrl(){return ii("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},get streets(){return{...this["streets-vector"],id:"streets"}},"topo-vector":{id:"topo-vector",classic:!0,get thumbnailUrl(){return ii("esri/images/basemap/topo-vector.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},get topo(){return{...this["topo-vector"],id:"topo"}},"streets-night-vector":{id:"streets-night-vector",classic:!0,get thumbnailUrl(){return ii("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",classic:!0,get thumbnailUrl(){return ii("esri/images/basemap/streets-relief.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",classic:!0,get thumbnailUrl(){return ii("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},"topo-3d":{id:"topo-3d",is3d:!0,get thumbnailUrl(){return ii("esri/images/basemap/topo-3d.png")},baseMapLayers:[{id:"topo-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/1e7d1784d1ef4b79ba6764d0bd6c3150/resources/styles/root.json",layerType:"VectorTileLayer",title:"Topographic",visibility:!0,opacity:1},{id:"topo-3d-trees",title:"Trees",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Trees_Thematic_v1/SceneServer",itemId:"f75fef56b2d944fe92ef9f7737b4f953",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"navigation-3d":{id:"navigation-3d",is3d:!0,get thumbnailUrl(){return ii("esri/images/basemap/navigation-3d.jpg")},baseMapLayers:[{id:"navigation-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/ccc904ff872b4144b94934e55e32784b/resources/styles/root.json",layerType:"VectorTileLayer",title:"Navigation",visibility:!0,opacity:1},{id:"navigation-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"navigation-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"streets-3d":{id:"streets-3d",is3d:!0,get thumbnailUrl(){return ii("esri/images/basemap/streets-3d.png")},baseMapLayers:[{id:"streets-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/198298c4c64c4cb19de5b46aa00c198d/resources/styles/root.json",layerType:"VectorTileLayer",title:"Streets",visibility:!0,opacity:1},{id:"streets-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"streets-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"osm-3d":{id:"osm-3d",is3d:!0,get thumbnailUrl(){return ii("esri/images/basemap/osm-3d.png")},baseMapLayers:[{id:"osm-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/8628d259c9d14bdc848771c23c513940/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap",visibility:!0,opacity:1},{id:"osm-3d-trees",title:"Trees",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Trees_Thematic_v1/SceneServer",itemId:"f75fef56b2d944fe92ef9f7737b4f953",layerType:"ArcGISSceneServiceLayer"},{id:"osm-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"osm-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"gray-3d":{id:"gray-3d",is3d:!0,get thumbnailUrl(){return ii("esri/images/basemap/gray-3d.png")},baseMapLayers:[{id:"gray-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/01a14b466345455ba4176d2e6390db92/resources/styles/root.json",layerType:"VectorTileLayer",title:"Streets",visibility:!0,opacity:1},{id:"gray-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"gray-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"navigation-dark-3d":{id:"navigation-dark-3d",itemId:"5a1365328b4943f09a54cf5fd1205707",is3d:!0,baseMapLayers:[{id:"navigation-dark-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/451a1777ab3f4bf095fae24a117439d9/resources/styles/root.json",layerType:"VectorTileLayer",title:"Navigation Dark"},{id:"navigation-dark-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer/layers/0",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"navigation-dark-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"streets-dark-3d":{id:"streets-dark-3d",itemId:"8a4efa2c20484ec9b4557895e65736ff",is3d:!0,baseMapLayers:[{id:"streets-dark-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/bc599b6d741a4ac084b7eea7bf8c5938/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap Streets Night (for 3D)"},{id:"streets-dark-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"streets-dark-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"dark-gray-3d":{id:"dark-gray-3d",itemId:"a8b7322a5fe94002bb0f5e0eeb0c5c18",is3d:!0,baseMapLayers:[{id:"dark-gray-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/4178f71acb934fb89f169e7d667c20c6/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap Dark Gray Canvas (for 3D)"},{id:"dark-gray-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer/layers/0",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"dark-gray-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"arcgis-imagery":{get thumbnailUrl(){return ii("esri/images/basemap/hybrid.jpg")},title:"Imagery Hybrid",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-imagery-standard":{get thumbnailUrl(){return ii("esri/images/basemap/satellite.jpg")},title:"Imagery",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"}]},"arcgis-imagery-labels":{title:"Hybrid [Reference]",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-light-gray":{get thumbnailUrl(){return ii("esri/images/basemap/gray-vector.jpg")},title:"Light Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Base",title:"Light Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Labels",title:"Light Gray Canvas Labels",isReference:!0}]},"arcgis-dark-gray":{get thumbnailUrl(){return ii("esri/images/basemap/dark-gray.jpg")},title:"Dark Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Base",title:"Dark Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Labels",title:"Dark Gray Canvas Labels",isReference:!0}]},"arcgis-navigation":{get thumbnailUrl(){return ii("esri/images/basemap/streets-navigation.jpg")},title:"Navigation",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Navigation",title:"World Navigation Map"}]},"arcgis-navigation-night":{title:"Navigation (Dark Mode)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:NavigationNight",title:"World Navigation Map (Dark Mode)"}]},"arcgis-streets":{get thumbnailUrl(){return ii("esri/images/basemap/streets-vector.jpg")},title:"Streets",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Streets",title:"World Street Map"}]},"arcgis-streets-night":{get thumbnailUrl(){return ii("esri/images/basemap/streets-night.jpg")},title:"Streets (Night)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsNight",title:"World Street Map (Night)"}]},"arcgis-streets-relief":{get thumbnailUrl(){return ii("esri/images/basemap/streets-relief.jpg")},title:"Streets (with Relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsRelief:Base",title:"World Street Map (with Relief)"}]},"arcgis-topographic":{get thumbnailUrl(){return ii("esri/images/basemap/topo.jpg")},title:"Topographic",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Topographic:Base",title:"World Topographic Map"}]},"arcgis-oceans":{get thumbnailUrl(){return ii("esri/images/basemap/oceans.jpg")},title:"Oceans",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Ocean Base",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Oceans:Labels",title:"World Ocean Reference",isReference:!0}]},"osm-standard":{title:"OpenStreetMap",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Standard",title:"OpenStreetMap"}]},"osm-standard-relief":{title:"OpenStreetMap (with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StandardRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-streets":{title:"OpenStreetMap (Streets)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Streets",title:"OpenStreetMap (Streets)"}]},"osm-streets-relief":{title:"OpenStreetMap (Streets with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StreetsRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-light-gray":{title:"OpenStreetMap (Light Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Base",title:"OSM (Light Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Labels",title:"OSM (Light Gray Reference)",isReference:!0}]},"osm-dark-gray":{title:"OpenStreetMap (Dark Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Base",title:"OSM (Dark Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Labels",title:"OSM (Dark Gray Reference)",isReference:!0}]},"arcgis-terrain":{title:"Terrain with Labels",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Base",title:"World Terrain Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Detail",title:"World Terrain Reference",isReference:!0}]},"arcgis-community":{title:"Community",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Community",title:"Community"}]},"arcgis-charted-territory":{title:"Charted Territory",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ChartedTerritory:Base",title:"Charted Territory"}]},"arcgis-colored-pencil":{title:"Colored Pencil",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ColoredPencil",title:"Colored Pencil"}]},"arcgis-nova":{title:"Nova",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Nova",title:"Nova"}]},"arcgis-modern-antique":{title:"Modern Antique",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ModernAntique:Base",title:"Modern Antique"}]},"arcgis-midcentury":{title:"Mid-Century",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Midcentury",title:"Mid-Century"}]},"arcgis-newspaper":{title:"Newspaper",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Newspaper",title:"Newspaper"}]},"arcgis-hillshade-light":{title:"Hillshade",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"}]},"arcgis-hillshade-dark":{title:"Hillshade (Dark)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade (Dark)",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade_Dark/MapServer"}]},"arcgis-human-geography":{title:"Human Geography",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Base",title:"Human Geography Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Detail",title:"Human Geography Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Label",title:"Human Geography Label",isReference:!0}]},"arcgis-human-geography-dark":{title:"Human Geography (Dark)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Base",title:"Human Geography Dark Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Detail",title:"Human Geography Dark Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Label",title:"Human Geography Dark Label",isReference:!0}]}},HVe=new Set(["ar","bs","ca","hr","cs","da","nl","en","et","fi","fr","de","el","he","hu","id","it","ja","ko","lv","lt","nb","pl","ro","ru","sr","es","sv","th","tr","uk","vi"]);let __=class extends Ae{constructor(e){super(e),this.id=null,this.language=null,this.places=null,this.serviceUrl="https://basemapstyles-api.arcgis.com/arcgis/rest/services/styles/v2/webmaps",this.worldview=null}getLanguageParamValue(){if(this.language)return this.language;const e=Hu().toLowerCase();switch(e){case"pt-br":return"pt-BR";case"pt-pt":return"pt-PT";case"zh-cn":return"zh-CN";case"zh-hk":return"zh-HK";case"zh-tw":return"zh-TW"}const r=EVe(e);return r==="pt"?"pt-BR":r&&HVe.has(r)?r:"global"}};d([m()],__.prototype,"id",void 0),d([m()],__.prototype,"language",void 0),d([m()],__.prototype,"places",void 0),d([m()],__.prototype,"serviceUrl",void 0),d([m()],__.prototype,"worldview",void 0),__=d([V("esri.support.BasemapStyle")],__);const WVe=__;function rFt(t){return t!=null&&typeof t=="object"&&"type"in t&&t.type==="feature"}function qVe(t){return t!=null&&typeof t=="object"&&"type"in t&&t.type==="subtype-group"&&"sublayers"in t}function Y2(t){return(t==null?void 0:t.type)==="subtype-sublayer"}function HO(t){const e=t==null?void 0:t.type;return e==="base-tile"||e==="tile"||e==="elevation"||e==="imagery-tile"||e==="base-elevation"||e==="open-street-map"||e==="wcs"||e==="web-tile"||e==="wmts"||e==="vector-tile"}function RE(t){return t!=null&&"type"in t&&t.type==="group"}const iFt={Point:"SceneLayer","3DObject":"SceneLayer",IntegratedMesh:"IntegratedMeshLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"};function YVe(t){const e=t==null?void 0:t.type;return e==="building-scene"||e==="integrated-mesh"||e==="point-cloud"||e==="scene"}function XVe(t){return t==="IntegratedMeshLayer"||t==="IntegratedMesh3DTilesLayer"}function m$(t){return t==="integrated-mesh"||t==="integrated-mesh-3dtiles"}function Pae(t){return(t==null?void 0:t.type)==="voxel"}function Aae(t){return(t==null?void 0:t.type)==="imagery-tile"}function c5(t){return(t==null?void 0:t.parent)!=null&&"declaredClass"in t.parent&&t.parent.declaredClass==="esri.Basemap"&&t.parent.baseLayers.includes(t)}function Xz(t){var e;return(t==null?void 0:t.type)==="feature"&&!t.url&&((e=t.source)==null?void 0:e.type)==="memory"}function nFt(t){var e;return((t==null?void 0:t.type)==="feature"||(t==null?void 0:t.type)==="subtype-group")&&((e=t.source)==null?void 0:e.type)==="feature-layer"}function ZVe(t){if(t.activeLayer){const e=t.activeLayer.tileMatrixSet;if(e)return e;const r=t.activeLayer.tileMatrixSets;if(r)return r}return null}async function sFt(t,e){const r=Gi==null?void 0:Gi.findServerInfo(t);if((r==null?void 0:r.currentVersion)!=null)return r.owningSystemUrl||null;const i=t.toLowerCase().indexOf("/rest/services");if(i===-1)return null;const n=`${t.substring(0,i)}/rest/info`,s=e!=null?e.signal:null,{data:o}=await Xi(n,{query:{f:"json"},responseType:"json",signal:s});return(o==null?void 0:o.owningSystemUrl)||null}function JVe(t){if(!("capabilities"in t))return!1;switch(t.type){case"catalog":case"csv":case"feature":case"geojson":case"imagery":case"knowledge-graph-sublayer":case"ogc-feature":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":case"wfs":return!0;default:return!1}}function QVe(t){return JVe(t)?"effectiveCapabilities"in t?t.effectiveCapabilities:t.capabilities:null}function KVe(t){if(!("editingEnabled"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":return!0;default:return!1}}function e7e(t){return!!KVe(t)&&("effectiveEditingEnabled"in t?t.effectiveEditingEnabled:t.editingEnabled)}const t7e=new Set(["bing-maps","imagery","imagery-tile","map-image","open-street-map","tile","unknown","unsupported","vector-tile","web-tile","wms","wmts"]),r7e=new Set(["csv","feature","geo-rss","geojson","group","imagery","imagery-tile","kml","map-image","map-notes","media","ogc-feature","oriented-imagery","route","stream","subtype-group","tile","unknown","unsupported","vector-tile","web-tile","wfs","wms","wmts"]);function i7e(t){return t.layerContainerType==="basemap"?t7e:t.layerContainerType==="operational-layers"?r7e:null}function n7e(t,e){if(e.restrictedWebMapWriting){const r=i7e(e);return r==null||r.has(t.type)&&!Xz(t)}return!0}function s7e(t,e){var r;if(e)if(Xz(t)){const i=Oz("featureCollection.layers",e),n=(r=i==null?void 0:i[0])==null?void 0:r.layerDefinition;n&&Mae(t,n)}else t.type!=="group"&&Mae(t,e)}function Mae(t,e){"maxScale"in t&&(e.maxScale=Uk(t.maxScale)??void 0),"minScale"in t&&(e.minScale=Uk(t.minScale)??void 0)}function o7e(t,e){if(s7e(t,e),e&&(e.id=t.id,"blendMode"in t&&(e.blendMode=t.blendMode,e.blendMode==="normal"&&delete e.blendMode),e.opacity=Uk(t.opacity)??void 0,e.title=t.title||"Layer",e.visibility=t.visible,"legendEnabled"in t&&t.type!=="wmts"))if(Xz(t)){const r=e.featureCollection;r&&(r.showLegend=t.legendEnabled)}else e.showLegend=t.legendEnabled}function Oae(t,e,r){if(!t.persistenceEnabled)return null;if(!("write"in t)||!t.write)return r!=null&&r.messages&&r.messages.push(new K("layer:unsupported",`Layers (${t.title}, ${t.id}) of type '${t.declaredClass}' cannot be persisted`,{layer:t})),null;if(Xz(t)&&!t.isTable)e=t.resourceInfo;else if(n7e(t,r)){const i={};return t.write(i,r)?i:null}return e!=null&&o7e(t,e=_e(e)),e}var NA;let a7e=0;const l7e="esri.Basemap";let yu=NA=class extends CI(Q0){constructor(t){super(t),this.id=null,this.portalItem=null,this.spatialReference=null,this.style=null,this.thumbnailUrl=null,this.title="Basemap",this.id=Date.now().toString(16)+"-basemap-"+a7e++,this.baseLayers=new $t,this.referenceLayers=new $t;const e=i=>{i.parent&&i.parent!==this&&"remove"in i.parent&&i.parent.remove(i),i.parent=this,i.type==="elevation"&&re.getLogger(this).error(`Layer '${i.title}, id:${i.id}' of type '${i.type}' is not supported as a basemap layer and will therefore be ignored.`)},r=i=>{i.parent=null};this.addHandles([this.baseLayers.on("after-add",i=>e(i.item)),this.referenceLayers.on("after-add",i=>e(i.item)),this.baseLayers.on("after-remove",i=>r(i.item)),this.referenceLayers.on("after-remove",i=>r(i.item))])}initialize(){this.when().catch(t=>{re.getLogger(this).error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,t)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const t=this.baseLayers.toArray();for(const r of t)r.destroy();const e=this.referenceLayers.toArray();for(const r of e)r.destroy();this.baseLayers.destroy(),this.referenceLayers.destroy(),this.portalItem=Pe(this.portalItem)}normalizeCtorArgs(t){return t&&"resourceInfo"in t&&(this._set("resourceInfo",t.resourceInfo),delete(t={...t}).resourceInfo),t}set baseLayers(t){this._set("baseLayers",Xx(t,this._get("baseLayers")))}_writeBaseLayers(t,e,r){const i=[];t&&(r={...r,layerContainerType:"basemap"},this.baseLayers.forEach(n=>{const s=Oae(n,r.webmap?r.webmap.getLayerJSONFromResourceInfo(n):null,r);s!=null&&i.push(s)}),this.referenceLayers.forEach(n=>{const s=Oae(n,r.webmap?r.webmap.getLayerJSONFromResourceInfo(n):null,r);s!=null&&(n.type!=="scene"&&(s.isReference=!0),i.push(s))})),e.baseMapLayers=i}set referenceLayers(t){this._set("referenceLayers",Xx(t,this._get("referenceLayers")))}writeTitle(t,e){e.title=t||"Basemap"}load(t){return this.addResolvingPromise(this._loadFromSource(t)),Promise.resolve(this)}loadAll(){return Fwe(this,t=>{t(this.baseLayers,this.referenceLayers)})}clone(){const t={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.map(e=>Ak(e)?e.clone():e),referenceLayers:this.referenceLayers.map(e=>Ak(e)?e.clone():e)};return this.loaded&&(t.loadStatus="loaded"),new NA({resourceInfo:this.resourceInfo}).set(t)}read(t,e){this.resourceInfo||this._set("resourceInfo",{data:t,context:e}),super.read(t,e)}write(t,e){var r;return t=t||{},e!=null&&e.origin||(e={origin:"web-map",...e}),super.write(t,e),!this.loaded&&((r=this.resourceInfo)!=null&&r.data.baseMapLayers)&&(t.baseMapLayers=this.resourceInfo.data.baseMapLayers.map(i=>{const n=_e(i);return n.url&&ng(n.url)&&(n.url=`https:${n.url}`),n.templateUrl&&ng(n.templateUrl)&&(n.templateUrl=`https:${n.templateUrl}`),n})),t}async _loadFromSource(t){const{resourceInfo:e,portalItem:r,style:i}=this;vt(t);const n=[];if(e){const s=e.context?e.context.url:null;if(n.push(this._loadLayersFromJSON(e.data,s,t)),e.data.id&&!e.data.title){const o=e.data.id;n.push(jVe(o).then(a=>{a&&this.read({title:a},e.context)}))}}else r?n.push(this._loadFromItem(r,t)):i&&n.push(this._loadFromStylesService(i,t));await Promise.all(n)}async _loadLayersFromJSON(t,e,r){var l,c;const i=(l=this.resourceInfo)==null?void 0:l.context,n=((c=this.portalItem)==null?void 0:c.portal)||(i==null?void 0:i.portal)||null,s=u7e[(i==null?void 0:i.origin)||""]??"web-map",{populateOperationalLayers:o}=await ge(()=>import("./layersCreator-KYKl-zWh.js"),__vite__mapDeps([12,13,14,15,11,16])),a=[];if(vt(r),t.baseMapLayers&&Array.isArray(t.baseMapLayers)){const u={context:{...i,origin:s,url:e,portal:n,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"},h=g=>s==="web-scene"&&g.layerType==="ArcGISSceneServiceLayer"||g.isReference,p=o(this.baseLayers,t.baseMapLayers.filter(g=>!h(g)),u);a.push(p);const f=o(this.referenceLayers,t.baseMapLayers.filter(h),u);a.push(f)}await Promise.allSettled(a)}async _loadFromItem(t,e){const r=await t.load(e),i=await r.fetchData("json",e),n=da(t.itemUrl??"");return this._set("resourceInfo",{data:i.baseMap??{},context:{origin:c7e[t.type||""]??"web-map",portal:t.portal||ud.getDefault(),url:n}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:i.spatialReference},this.resourceInfo.context),this.read({title:t.title,thumbnailUrl:t.thumbnailUrl},{origin:"portal-item",portal:t.portal||ud.getDefault(),url:n}),this._loadLayersFromJSON(this.resourceInfo.data,n,e)}async _loadFromStylesService(t,e){const r=`${t.serviceUrl}/${t.id}`,i=(await Xi(r,{query:{language:t.getLanguageParamValue(),places:t.places,worldview:t.worldview},signal:e==null?void 0:e.signal})).data,n=da(r);return this._set("resourceInfo",{data:i.baseMap??{},context:{origin:"web-map",url:n}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:i.spatialReference},this.resourceInfo.context),this._loadLayersFromJSON(this.resourceInfo.data,n,e)}static fromId(t){const e=OW[t];return e?e.itemId?new NA({portalItem:{id:e.itemId,portal:{url:"https://www.arcgis.com"}}}):NA.fromJSON(e,{origin:e.is3d?"web-scene":"web-map"}):null}};d([m({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(t,e,r,i){this._writeBaseLayers(t,e,i)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:$t}},writer(t,e,r,i){this._writeBaseLayers(t,e,i)}}}}}})],yu.prototype,"baseLayers",null),d([m({type:String,json:{origins:{"web-scene":{write:!0}}}})],yu.prototype,"id",void 0),d([m({type:uxe})],yu.prototype,"portalItem",void 0),d([m()],yu.prototype,"referenceLayers",null),d([m({readOnly:!0})],yu.prototype,"resourceInfo",void 0),d([m({type:lt})],yu.prototype,"spatialReference",void 0),d([m({type:WVe})],yu.prototype,"style",void 0),d([m()],yu.prototype,"thumbnailUrl",void 0),d([m({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],yu.prototype,"title",void 0),d([hr("title")],yu.prototype,"writeTitle",null),yu=NA=d([V(l7e)],yu);const c7e={"Web Scene":"web-scene","Web Map":"web-map","Link Chart":"link-chart"},u7e={"web-scene":"web-scene","web-map":"web-map","link-chart":"link-chart"},UC=yu,h7e=Object.freeze(Object.defineProperty({__proto__:null,default:UC},Symbol.toStringTag,{value:"Module"})),t6={transparent:[0,0,0,0],black:[0,0,0,1],silver:[192,192,192,1],gray:[128,128,128,1],white:[255,255,255,1],maroon:[128,0,0,1],red:[255,0,0,1],purple:[128,0,128,1],fuchsia:[255,0,255,1],green:[0,128,0,1],lime:[0,255,0,1],olive:[128,128,0,1],yellow:[255,255,0,1],navy:[0,0,128,1],blue:[0,0,255,1],teal:[0,128,128,1],aqua:[0,255,255,1],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],blanchedalmond:[255,235,205,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],oldlace:[253,245,230,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],rebeccapurple:[102,51,153,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],whitesmoke:[245,245,245,1],yellowgreen:[154,205,50,1]};function pxe(t){return!!t6[t]||!!t6[t.toLowerCase()]}function nee(t){return t6[t]??t6[t.toLowerCase()]}function d7e(t){return[...nee(t)]}function XB(t,e,r){r<0&&++r,r>1&&--r;const i=6*r;return i<1?t+(e-t)*i:2*r<1?e:3*r<2?t+(e-t)*(2/3-r)*6:t}function fxe(t,e,r,i=1){const n=(t%360+360)%360/360,s=r<=.5?r*(e+1):r+e-r*e,o=2*r-s;return[Math.round(255*XB(o,s,n+1/3)),Math.round(255*XB(o,s,n)),Math.round(255*XB(o,s,n-1/3)),i]}function p7e(t){const e=t.length>5,r=e?8:4,i=(1<<r)-1,n=e?1:17,s=e?t.length===9:t.length===5;let o=+("0x"+t.substr(1));if(isNaN(o))return null;const a=[0,0,0,1];let l;return s&&(l=o&i,o>>=r,a[3]=n*l/255),l=o&i,o>>=r,a[2]=n*l,l=o&i,o>>=r,a[1]=n*l,l=o&i,o>>=r,a[0]=n*l,a}function C(){return[0,0,0]}function Zi(t){return[t[0],t[1],t[2]]}function Ce(t,e,r){return[t,e,r]}function Ea(t,e=C()){const r=Math.min(3,t.length);for(let i=0;i<r;++i)e[i]=t[i];return e}function f7e(t,e){return new Float64Array(t,e,3)}function mxe(){return C()}function gxe(){return Ce(1,1,1)}function yxe(){return Ce(1,0,0)}function _xe(){return Ce(0,1,0)}function see(){return Ce(0,0,1)}const zn=mxe(),Im=gxe(),oee=yxe(),aee=_xe(),$E=see();Object.freeze(Object.defineProperty({__proto__:null,ONES:Im,UNIT_X:oee,UNIT_Y:aee,UNIT_Z:$E,ZEROS:zn,clone:Zi,create:C,createView:f7e,fromArray:Ea,fromValues:Ce,ones:gxe,unitX:yxe,unitY:_xe,unitZ:see,zeros:mxe},Symbol.toStringTag,{value:"Module"}));let lee=1e-6;function Va(){return lee}function m7e(t){lee=t}const AI=Math.random,g7e=Math.PI/180,y7e=180/Math.PI;function Zz(t){return t*g7e}function _7e(t){return t*y7e}function v7e(t,e){return Math.abs(t-e)<=lee*Math.max(1,Math.abs(t),Math.abs(e))}Object.freeze(Object.defineProperty({__proto__:null,RANDOM:AI,equals:v7e,getEpsilon:Va,setEpsilon:m7e,toDegree:_7e,toRadian:Zz},Symbol.toStringTag,{value:"Module"}));function Te(t){const e=t[0],r=t[1],i=t[2];return Math.sqrt(e*e+r*r+i*i)}function ce(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function ie(t,e,r,i){return t[0]=e,t[1]=r,t[2]=i,t}function fe(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function ye(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function Jz(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function r6(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t}function b7e(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function vxe(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function IE(t,e){return t[0]=Math.abs(e[0]),t[1]=Math.abs(e[1]),t[2]=Math.abs(e[2]),t}function bxe(t,e){return t[0]=Math.sign(e[0]),t[1]=Math.sign(e[1]),t[2]=Math.sign(e[2]),t}function wxe(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t}function xxe(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t}function w7e(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function ne(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function Xs(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t}function Di(t,e){const r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2];return Math.sqrt(r*r+i*i+n*n)}function Uo(t,e){const r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2];return r*r+i*i+n*n}function Ra(t){const e=t[0],r=t[1],i=t[2];return e*e+r*r+i*i}function Bo(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function cee(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function pe(t,e){const r=e[0],i=e[1],n=e[2];let s=r*r+i*i+n*n;return s>0&&(s=1/Math.sqrt(s),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s),t}function de(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Je(t,e,r){const i=e[0],n=e[1],s=e[2],o=r[0],a=r[1],l=r[2];return t[0]=n*l-s*a,t[1]=s*o-i*l,t[2]=i*a-n*o,t}function ni(t,e,r,i){const n=e[0],s=e[1],o=e[2];return t[0]=n+i*(r[0]-n),t[1]=s+i*(r[1]-s),t[2]=o+i*(r[2]-o),t}function x7e(t,e,r,i,n,s){const o=s*s,a=o*(2*s-3)+1,l=o*(s-2)+s,c=o*(s-1),u=o*(3-2*s);return t[0]=e[0]*a+r[0]*l+i[0]*c+n[0]*u,t[1]=e[1]*a+r[1]*l+i[1]*c+n[1]*u,t[2]=e[2]*a+r[2]*l+i[2]*c+n[2]*u,t}function T7e(t,e,r,i,n,s){const o=1-s,a=o*o,l=s*s,c=a*o,u=3*s*a,h=3*l*o,p=l*s;return t[0]=e[0]*c+r[0]*u+i[0]*h+n[0]*p,t[1]=e[1]*c+r[1]*u+i[1]*h+n[1]*p,t[2]=e[2]*c+r[2]*u+i[2]*h+n[2]*p,t}function S7e(t,e){e=e||1;const r=AI,i=2*r()*Math.PI,n=2*r()-1,s=Math.sqrt(1-n*n)*e;return t[0]=Math.cos(i)*s,t[1]=Math.sin(i)*s,t[2]=n*e,t}function Ge(t,e,r){const i=e[0],n=e[1],s=e[2];return t[0]=r[0]*i+r[4]*n+r[8]*s+r[12],t[1]=r[1]*i+r[5]*n+r[9]*s+r[13],t[2]=r[2]*i+r[6]*n+r[10]*s+r[14],t}function Zs(t,e,r){const i=e[0],n=e[1],s=e[2];return t[0]=i*r[0]+n*r[3]+s*r[6],t[1]=i*r[1]+n*r[4]+s*r[7],t[2]=i*r[2]+n*r[5]+s*r[8],t}function Oc(t,e,r){const i=r[0],n=r[1],s=r[2],o=r[3],a=e[0],l=e[1],c=e[2],u=n*c-s*l,h=s*a-i*c,p=i*l-n*a,f=n*p-s*h,g=s*u-i*p,_=i*h-n*u,v=2*o;return t[0]=a+u*v+2*f,t[1]=l+h*v+2*g,t[2]=c+p*v+2*_,t}function C7e(t,e,r,i){const n=[],s=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],s[0]=n[0],s[1]=n[1]*Math.cos(i)-n[2]*Math.sin(i),s[2]=n[1]*Math.sin(i)+n[2]*Math.cos(i),t[0]=s[0]+r[0],t[1]=s[1]+r[1],t[2]=s[2]+r[2],t}function E7e(t,e,r,i){const n=[],s=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],s[0]=n[2]*Math.sin(i)+n[0]*Math.cos(i),s[1]=n[1],s[2]=n[2]*Math.cos(i)-n[0]*Math.sin(i),t[0]=s[0]+r[0],t[1]=s[1]+r[1],t[2]=s[2]+r[2],t}function P7e(t,e,r,i){const n=[],s=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],s[0]=n[0]*Math.cos(i)-n[1]*Math.sin(i),s[1]=n[0]*Math.sin(i)+n[1]*Math.cos(i),s[2]=n[2],t[0]=s[0]+r[0],t[1]=s[1]+r[1],t[2]=s[2]+r[2],t}function Txe(t,e){pe(Rae,t),pe($ae,e);const r=de(Rae,$ae);return r>1?0:r<-1?Math.PI:Math.acos(r)}const Rae=C(),$ae=C();function A7e(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function zo(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function i2(t,e){if(t===e)return!0;const r=t[0],i=t[1],n=t[2],s=e[0],o=e[1],a=e[2],l=Va();return Math.abs(r-s)<=l*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-o)<=l*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(n-a)<=l*Math.max(1,Math.abs(n),Math.abs(a))}function fy(t,e,r){const i=r[0]-e[0],n=r[1]-e[1],s=r[2]-e[2];let o=i*i+n*n+s*s;return o>0?(o=1/Math.sqrt(o),t[0]=i*o,t[1]=n*o,t[2]=s*o,t):(t[0]=0,t[1]=0,t[2]=0,t)}const Yi=ye,M7e=Jz,O7e=r6,D0=Di,g$=Uo,Pc=Te,i6=Ra,Iae=Object.freeze(Object.defineProperty({__proto__:null,abs:IE,add:fe,angle:Txe,bezier:T7e,ceil:b7e,copy:ce,cross:Je,direction:fy,dist:D0,distance:Di,div:O7e,divide:r6,dot:de,equals:i2,exactEquals:zo,floor:vxe,hermite:x7e,inverse:cee,len:Pc,length:Te,lerp:ni,max:xxe,min:wxe,mul:M7e,multiply:Jz,negate:Bo,normalize:pe,random:S7e,rotateX:C7e,rotateY:E7e,rotateZ:P7e,round:w7e,scale:ne,scaleAndAdd:Xs,set:ie,sign:bxe,sqrDist:g$,sqrLen:i6,squaredDistance:Uo,squaredLength:Ra,str:A7e,sub:Yi,subtract:ye,transformMat3:Zs,transformMat4:Ge,transformQuat:Oc},Symbol.toStringTag,{value:"Module"})),Lae=new Float32Array(1);function Sxe(t){--t;for(let e=1;e<32;e<<=1)t|=t>>e;return t+1}function we(t,e,r){return Math.min(Math.max(t,e),r)}function y$(t){return(t&t-1)==0}function oFt(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t}function aFt(t){return 10**Math.ceil(Math.LOG10E*Math.log(t))}function Rt(t,e,r){return t+(e-t)*r}function lFt(t,e,r,i,n){return Rt(i,n,(t-e)/(r-e))}function Nt(t){return t*Math.PI/180}function Fa(t){return 180*t/Math.PI}function RW(t,e=1e-6){return(t<0?-1:1)/Math.max(Math.abs(t),e)}function Ks(t){return Math.acos(we(t,-1,1))}function hd(t){return Math.asin(we(t,-1,1))}function U1(t,e,r=1e-6){return t===e?!0:!Number.isFinite(t)||!Number.isFinite(e)?!1:(t>e?t-e:e-t)<=r}const n6=new DataView(new ArrayBuffer(Float64Array.BYTES_PER_ELEMENT));function $W(t){return n6.setFloat64(0,t),n6.getBigInt64(0)}function R7e(t){return n6.setBigInt64(0,t),n6.getFloat64(0)}const u5=BigInt("1000000"),$7e=Cxe(1);function Cxe(t){const e=$W(t=Math.abs(t)),r=R7e(e<=u5?u5:e-u5);return Math.abs(t-r)}function cFt(t,e,r=$7e){if(t===e)return!0;if(!Number.isFinite(t)||!Number.isFinite(e))return!1;if(r!=null&&Cxe(Math.min(Math.abs(t),Math.abs(e)))<r)return Math.abs(t-e)<=r;const i=$W(t),n=$W(e);return i<0!=n<0?!1:!((i<n?n-i:i-n)>u5)}function I7e(t,e,r=1e-6){if(t===e)return!0;if(!Number.isFinite(t)||!Number.isFinite(e))return!1;const i=Math.abs(t-e),n=Math.abs(t),s=Math.abs(e);if(t===0||e===0||n<1e-12&&s<1e-12){if(i>.01*r)return!1}else if(i/(n+s)>r)return!1;return!0}function L7e(t){return Exe(Math.max(-IW,Math.min(t,IW)))}function Exe(t){return Lae[0]=t,Lae[0]}function _$(t,e,r){const i=we((r-t)/(e-t),0,1);return i*i*(3-2*i)}function Dae(t,e){const r=Te(t),i=hd(t[2]/r),n=Math.atan2(t[1]/r,t[0]/r);return ie(e,r,i,n),e}function uFt(t){const e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],r=t[3]*t[3]+t[4]*t[4]+t[5]*t[5],i=t[6]*t[6]+t[7]*t[7]+t[8]*t[8];return!(U1(e,1)&&U1(r,1)&&U1(i,1))}const IW=Exe(34028234663852886e22);function ZL(t){return we(IK(t),0,255)}function JL(t,e,r){return t=Number(t),isNaN(t)?r:t<e?e:t>r?r:t}function QL(t,e){const r=t.toString(16).padStart(2,"0");return e?r.substring(0,1):r}let h5=class Mo{static blendColors(e,r,i,n=new Mo){return n.r=Math.round(e.r+(r.r-e.r)*i),n.g=Math.round(e.g+(r.g-e.g)*i),n.b=Math.round(e.b+(r.b-e.b)*i),n.a=e.a+(r.a-e.a)*i,n._sanitize()}static fromRgb(e,r){const i=e.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(i){const n=i[2].split(/\s*,\s*/),s=i[1];if(s==="rgb"&&n.length===3||s==="rgba"&&n.length===4){const o=n[0];if(o.charAt(o.length-1)==="%"){const a=n.map(l=>2.56*parseFloat(l));return n.length===4&&(a[3]=parseFloat(n[3])),Mo.fromArray(a,r)}return Mo.fromArray(n.map(a=>parseFloat(a)),r)}if(s==="hsl"&&n.length===3||s==="hsla"&&n.length===4)return Mo.fromArray(fxe(parseFloat(n[0]),parseFloat(n[1])/100,parseFloat(n[2])/100,parseFloat(n[3])),r)}return null}static fromHex(e,r=new Mo){if(e[0]!=="#"||isNaN(+`0x${e.substring(1)}`))return null;switch(e.length){case 4:case 5:{const i=parseInt(e.substring(1,2),16),n=parseInt(e.substring(2,3),16),s=parseInt(e.substring(3,4),16),o=e.length===5?15:parseInt(e.substring(4),16);return Mo.fromArray([i+16*i,n+16*n,s+16*s,(o+16*o)/255],r)}case 7:case 9:{const i=parseInt(e.substring(1,3),16),n=parseInt(e.substring(3,5),16),s=parseInt(e.substring(5,7),16),o=e.length===7?255:parseInt(e.substring(7),16);return Mo.fromArray([i,n,s,o/255],r)}default:return null}}static fromArray(e,r=new Mo){return r._set(Number(e[0]),Number(e[1]),Number(e[2]),Number(e[3])),isNaN(r.a)&&(r.a=1),r._sanitize()}static fromString(e,r){const i=pxe(e)?nee(e):null;return i&&Mo.fromArray(i,r)||Mo.fromRgb(e,r)||Mo.fromHex(e,r)}static fromJSON(e){return e!=null?new Mo([e[0],e[1],e[2],(e[3]??255)/255]):void 0}static toUnitRGB(e){return e!=null?[e.r/255,e.g/255,e.b/255]:null}static toUnitRGBA(e){return e!=null?[e.r/255,e.g/255,e.b/255,e.a!=null?e.a:1]:null}constructor(e){this.r=255,this.g=255,this.b=255,this.a=1,e&&this.setColor(e)}get isBright(){return .299*this.r+.587*this.g+.114*this.b>=127}setColor(e){return typeof e=="string"?Mo.fromString(e,this):Array.isArray(e)?Mo.fromArray(e,this):(this._set(e.r??0,e.g??0,e.b??0,e.a??1),e instanceof Mo||this._sanitize()),this}toRgb(){return[this.r,this.g,this.b]}toRgba(){return[this.r,this.g,this.b,this.a]}toHex(e){const r=(e==null?void 0:e.capitalize)??!1,i=(e==null?void 0:e.digits)??6,n=i===3||i===4,s=i===4||i===8,o=`#${QL(this.r,n)}${QL(this.g,n)}${QL(this.b,n)}${s?QL(Math.round(255*this.a),n):""}`;return r?o.toUpperCase():o}toCss(e=!1){const r=this.r+", "+this.g+", "+this.b;return e?`rgba(${r}, ${this.a})`:`rgb(${r})`}toString(){return this.toCss(!0)}toJSON(){return this.toArray()}toArray(e=Mo.AlphaMode.ALWAYS){const r=ZL(this.r),i=ZL(this.g),n=ZL(this.b);return e===Mo.AlphaMode.ALWAYS||this.a!==1?[r,i,n,ZL(255*this.a)]:[r,i,n]}clone(){return new Mo(this.toRgba())}hash(){return this.r<<24|this.g<<16|this.b<<8|255*this.a}equals(e){return e!=null&&e.r===this.r&&e.g===this.g&&e.b===this.b&&e.a===this.a}_sanitize(){return this.r=Math.round(JL(this.r,0,255)),this.g=Math.round(JL(this.g,0,255)),this.b=Math.round(JL(this.b,0,255)),this.a=JL(this.a,0,1),this}_set(e,r,i,n){this.r=e,this.g=r,this.b=i,this.a=n}};h5.prototype.declaredClass="esri.Color",function(t){var e;(e=t.AlphaMode||(t.AlphaMode={}))[e.ALWAYS=0]="ALWAYS",e[e.UNLESS_OPAQUE=1]="UNLESS_OPAQUE"}(h5||(h5={}));const Xe=h5;function hFt(t){}function D7e(t){return()=>t}function It(t,e={}){const r=t instanceof yn?t:new yn(t,e),i={type:(e==null?void 0:e.ignoreUnknown)??1?r.apiValues:String,json:{type:r.jsonValues,read:!(e!=null&&e.readOnly)&&{reader:r.read},write:{writer:r.write}}};return(e==null?void 0:e.readOnly)!==void 0&&(i.readOnly=!!e.readOnly),(e==null?void 0:e.default)!==void 0&&(i.json.default=e.default),(e==null?void 0:e.name)!==void 0&&(i.json.name=e.name),(e==null?void 0:e.nonNullable)!==void 0&&(i.nonNullable=e.nonNullable),m(i)}var LW;let d5=LW=class extends ze{constructor(t){super(t),this.type="none"}clone(){return new LW({type:this.type})}};d([It({none:"none",stayAbove:"stay-above"})],d5.prototype,"type",void 0),d5=LW=d([V("esri.ground.NavigationConstraint")],d5);function uee(t){const e=IK(100*(1-t));return Math.max(0,Math.min(e,100))}function hee(t){const e=1-t/100;return Math.max(0,Math.min(e,1))}var DW;let Yg=DW=class extends CI(Q0){constructor(t){super(t),this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new $t;const e=i=>{i.parent&&i.parent!==this&&"remove"in i.parent&&i.parent.remove(i),i.parent=this,i.type!=="elevation"&&i.type!=="base-elevation"&&re.getLogger(this).error(`Layer '${i.title}, id:${i.id}' of type '${i.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},r=i=>{i.parent=null};this.addHandles([this.layers.on("after-add",i=>e(i.item)),this.layers.on("after-remove",i=>r(i.item))])}initialize(){this.when().catch(t=>{_s(t)||re.getLogger(this).error("#load()","Failed to load ground",t)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const t=this.layers.removeAll();for(const e of t)Pe(e);this.layers.destroy()}normalizeCtorArgs(t){return t&&"resourceInfo"in t&&(this._set("resourceInfo",t.resourceInfo),delete(t={...t}).resourceInfo),t}set layers(t){this._set("layers",Xx(t,this._get("layers")))}writeLayers(t,e,r,i){const n=[];t&&(i={...i,layerContainerType:"ground"},t.forEach(s=>{if("write"in s){const o={};D7e(s)().write(o,i)&&n.push(o)}else i!=null&&i.messages&&i.messages.push(new K("layer:unsupported",`Layers (${s.title}, ${s.id}) of type '${s.declaredClass}' cannot be persisted in the ground`,{layer:s}))})),e.layers=n}load(t){return this.addResolvingPromise(this._loadFromSource(t)),Promise.resolve(this)}loadAll(){return Fwe(this,t=>{t(this.layers)})}async queryElevation(t,e){await this.load({signal:e==null?void 0:e.signal});const{ElevationQuery:r}=await ge(()=>import("./ElevationQuery-gDO4k76j.js"),__vite__mapDeps([]));vt(e);const i=new r,n=this.layers.filter(Nae).toArray();return i.queryAll(n,t,e)}async createElevationSampler(t,e){await this.load({signal:e==null?void 0:e.signal});const{ElevationQuery:r}=await ge(()=>import("./ElevationQuery-gDO4k76j.js"),__vite__mapDeps([]));vt(e);const i=new r,n=this.layers.filter(Nae).toArray();return i.createSamplerAll(n,t,e)}clone(){const t={opacity:this.opacity,surfaceColor:_e(this.surfaceColor),navigationConstraint:_e(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(t.loadStatus="loaded"),new DW({resourceInfo:this.resourceInfo}).set(t)}read(t,e){this.resourceInfo||this._set("resourceInfo",{data:t,context:e}),super.read(t,e)}_loadFromSource(t){const e=this.resourceInfo;return e?this._loadLayersFromJSON(e.data,e.context,t):Promise.resolve()}async _loadLayersFromJSON(t,e,r){const i=(e==null?void 0:e.origin)||"web-scene",n=(e==null?void 0:e.portal)||null,s=(e==null?void 0:e.url)||null,{populateOperationalLayers:o}=await ge(()=>import("./layersCreator-KYKl-zWh.js"),__vite__mapDeps([12,13,14,15,11,16]));vt(r);const a=[];if(t.layers&&Array.isArray(t.layers)){const l={context:{origin:i,url:s,portal:n,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};a.push(o(this.layers,t.layers,l))}await Promise.allSettled(a)}};function N7e(t){return t&&"createElevationSampler"in t}function Nae(t){return t.type==="elevation"||N7e(t)}d([m({json:{read:!1}})],Yg.prototype,"layers",null),d([hr("layers")],Yg.prototype,"writeLayers",null),d([m({readOnly:!0})],Yg.prototype,"resourceInfo",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:fn,read:{reader:hee,source:"transparency"},write:{writer:(t,e)=>{e.transparency=uee(t)},target:"transparency"}}})],Yg.prototype,"opacity",void 0),d([m({type:Xe,json:{type:[fn],write:(t,e)=>{e.surfaceColor=t.toJSON().slice(0,3)}}})],Yg.prototype,"surfaceColor",void 0),d([m({type:d5,json:{write:!0}})],Yg.prototype,"navigationConstraint",void 0),Yg=DW=d([V("esri.Ground")],Yg);const s6=Yg;let sS=class extends $t{constructor(e){super(e),this.getCollections=null}initialize(){this.addHandles(jbe(()=>this._refresh()))}destroy(){this.getCollections=null}_refresh(){const e=this.getCollections!=null?this.getCollections():null;if(e==null)return void this.removeAll();let r=0;for(const i of e)i!=null&&(r=this._processCollection(r,i));this.splice(r,this.length)}_createNewInstance(e){return new $t(e)}_processCollection(e,r){if(!r)return e;const i=this.itemFilterFunction??(n=>!!n);for(const n of r)if(n){if(i(n)){const s=this.indexOf(n,e);s>=0?s!==e&&this.reorder(n,e):this.add(n,e),++e}if(this.getChildrenFunction){const s=this.getChildrenFunction(n);if(Array.isArray(s))for(const o of s)e=this._processCollection(e,o);else e=this._processCollection(e,s)}}return e}};d([m()],sS.prototype,"getCollections",void 0),d([m()],sS.prototype,"getChildrenFunction",void 0),d([m()],sS.prototype,"itemFilterFunction",void 0),sS=d([V("esri.core.CollectionFlattener")],sS);const v$=sS;function F7e(t){var e,r;return!(!(t&&typeof t=="object"&&"loaded"in t&&t.loaded&&((r=(e=QVe(t))==null?void 0:e.operations)!=null&&r.supportsEditing)&&"type"in t)||"editingEnabled"in t&&!e7e(t))}const k7e=/^-?(\d+(\.\d+)?)\s*((px)|(pt))?$/i,z7e="screenUtils.toPt: input not recognized!",Pxe=96;function fs(t){return t?t/72*Pxe:0}function xl(t){return t?72*t/Pxe:0}function kn(t){if(typeof t=="string"){const e=t.match(k7e);if(e){const r=Number(e[1]),i=e[3]&&e[3].toLowerCase(),n=t.charAt(0)==="-",s=i==="px"?xl(r):r;return n?-s:s}return console.warn(z7e),null}return t}function dd(t=0,e=0){return{x:t,y:e}}function pn(t=0,e=0){return[t,e]}function Axe(t=0,e=0){return[t,e]}function oa(t=0,e=0,r=0){return[t,e,r]}function pFt(t){return t}function fFt(t){return t}function mFt(t){return t}function Rp(t,e){return e?(e[0]=t.x,e[1]=t.y,e.length>2&&(e[2]=0),e):[t.x,t.y]}function Qz(){const t=new Float32Array(16);return t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function U7e(t){const e=new Float32Array(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function B7e(t,e,r,i,n,s,o,a,l,c,u,h,p,f,g,_){const v=new Float32Array(16);return v[0]=t,v[1]=e,v[2]=r,v[3]=i,v[4]=n,v[5]=s,v[6]=o,v[7]=a,v[8]=l,v[9]=c,v[10]=u,v[11]=h,v[12]=p,v[13]=f,v[14]=g,v[15]=_,v}function V7e(t,e){return new Float32Array(t,e,16)}const G7e=Qz();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:G7e,clone:U7e,create:Qz,createView:V7e,fromValues:B7e},Symbol.toStringTag,{value:"Module"}));function Zn(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function gg(t,e,r,i,n,s,o,a,l,c,u,h,p,f,g,_,v){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t[4]=s,t[5]=o,t[6]=a,t[7]=l,t[8]=c,t[9]=u,t[10]=h,t[11]=p,t[12]=f,t[13]=g,t[14]=_,t[15]=v,t}function pd(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Qc(t,e){if(t===e){const r=e[1],i=e[2],n=e[3],s=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=s,t[11]=e[14],t[12]=n,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function R3(t,e){return os(t,e)||pd(t),t}function os(t,e){const r=e[0],i=e[1],n=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],p=e[10],f=e[11],g=e[12],_=e[13],v=e[14],b=e[15],w=r*a-i*o,x=r*l-n*o,S=r*c-s*o,E=i*l-n*a,A=i*c-s*a,O=n*c-s*l,L=u*_-h*g,z=u*v-p*g,k=u*b-f*g,q=h*v-p*_,B=h*b-f*_,J=p*b-f*v;let W=w*J-x*B+S*q+E*k-A*z+O*L;return W?(W=1/W,t[0]=(a*J-l*B+c*q)*W,t[1]=(n*B-i*J-s*q)*W,t[2]=(_*O-v*A+b*E)*W,t[3]=(p*A-h*O-f*E)*W,t[4]=(l*k-o*J-c*z)*W,t[5]=(r*J-n*k+s*z)*W,t[6]=(v*S-g*O-b*x)*W,t[7]=(u*O-p*S+f*x)*W,t[8]=(o*B-a*k+c*L)*W,t[9]=(i*k-r*B-s*L)*W,t[10]=(g*A-_*S+b*w)*W,t[11]=(h*S-u*A-f*w)*W,t[12]=(a*z-o*q-l*L)*W,t[13]=(r*q-i*z+n*L)*W,t[14]=(_*x-g*E-v*w)*W,t[15]=(u*E-h*x+p*w)*W,t):null}function j7e(t,e){const r=e[0],i=e[1],n=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],p=e[10],f=e[11],g=e[12],_=e[13],v=e[14],b=e[15];return t[0]=a*(p*b-f*v)-h*(l*b-c*v)+_*(l*f-c*p),t[1]=-(i*(p*b-f*v)-h*(n*b-s*v)+_*(n*f-s*p)),t[2]=i*(l*b-c*v)-a*(n*b-s*v)+_*(n*c-s*l),t[3]=-(i*(l*f-c*p)-a*(n*f-s*p)+h*(n*c-s*l)),t[4]=-(o*(p*b-f*v)-u*(l*b-c*v)+g*(l*f-c*p)),t[5]=r*(p*b-f*v)-u*(n*b-s*v)+g*(n*f-s*p),t[6]=-(r*(l*b-c*v)-o*(n*b-s*v)+g*(n*c-s*l)),t[7]=r*(l*f-c*p)-o*(n*f-s*p)+u*(n*c-s*l),t[8]=o*(h*b-f*_)-u*(a*b-c*_)+g*(a*f-c*h),t[9]=-(r*(h*b-f*_)-u*(i*b-s*_)+g*(i*f-s*h)),t[10]=r*(a*b-c*_)-o*(i*b-s*_)+g*(i*c-s*a),t[11]=-(r*(a*f-c*h)-o*(i*f-s*h)+u*(i*c-s*a)),t[12]=-(o*(h*v-p*_)-u*(a*v-l*_)+g*(a*p-l*h)),t[13]=r*(h*v-p*_)-u*(i*v-n*_)+g*(i*p-n*h),t[14]=-(r*(a*v-l*_)-o*(i*v-n*_)+g*(i*l-n*a)),t[15]=r*(a*p-l*h)-o*(i*p-n*h)+u*(i*l-n*a),t}function H7e(t){const e=t[0],r=t[1],i=t[2],n=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=t[9],h=t[10],p=t[11],f=t[12],g=t[13],_=t[14],v=t[15];return(e*o-r*s)*(h*v-p*_)-(e*a-i*s)*(u*v-p*g)+(e*l-n*s)*(u*_-h*g)+(r*a-i*o)*(c*v-p*f)-(r*l-n*o)*(c*_-h*f)+(i*l-n*a)*(c*g-u*f)}function Hr(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],p=e[9],f=e[10],g=e[11],_=e[12],v=e[13],b=e[14],w=e[15];let x=r[0],S=r[1],E=r[2],A=r[3];return t[0]=x*i+S*a+E*h+A*_,t[1]=x*n+S*l+E*p+A*v,t[2]=x*s+S*c+E*f+A*b,t[3]=x*o+S*u+E*g+A*w,x=r[4],S=r[5],E=r[6],A=r[7],t[4]=x*i+S*a+E*h+A*_,t[5]=x*n+S*l+E*p+A*v,t[6]=x*s+S*c+E*f+A*b,t[7]=x*o+S*u+E*g+A*w,x=r[8],S=r[9],E=r[10],A=r[11],t[8]=x*i+S*a+E*h+A*_,t[9]=x*n+S*l+E*p+A*v,t[10]=x*s+S*c+E*f+A*b,t[11]=x*o+S*u+E*g+A*w,x=r[12],S=r[13],E=r[14],A=r[15],t[12]=x*i+S*a+E*h+A*_,t[13]=x*n+S*l+E*p+A*v,t[14]=x*s+S*c+E*f+A*b,t[15]=x*o+S*u+E*g+A*w,t}function ic(t,e,r){const i=r[0],n=r[1],s=r[2];if(e===t)t[12]=e[0]*i+e[4]*n+e[8]*s+e[12],t[13]=e[1]*i+e[5]*n+e[9]*s+e[13],t[14]=e[2]*i+e[6]*n+e[10]*s+e[14],t[15]=e[3]*i+e[7]*n+e[11]*s+e[15];else{const o=e[0],a=e[1],l=e[2],c=e[3],u=e[4],h=e[5],p=e[6],f=e[7],g=e[8],_=e[9],v=e[10],b=e[11];t[0]=o,t[1]=a,t[2]=l,t[3]=c,t[4]=u,t[5]=h,t[6]=p,t[7]=f,t[8]=g,t[9]=_,t[10]=v,t[11]=b,t[12]=o*i+u*n+g*s+e[12],t[13]=a*i+h*n+_*s+e[13],t[14]=l*i+p*n+v*s+e[14],t[15]=c*i+f*n+b*s+e[15]}return t}function P2(t,e,r){const i=r[0],n=r[1],s=r[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Gc(t,e,r,i){let n,s,o,a,l,c,u,h,p,f,g,_,v,b,w,x,S,E,A,O,L,z,k,q,B=i[0],J=i[1],W=i[2],Y=Math.sqrt(B*B+J*J+W*W);return Y<Va()?null:(Y=1/Y,B*=Y,J*=Y,W*=Y,n=Math.sin(r),s=Math.cos(r),o=1-s,a=e[0],l=e[1],c=e[2],u=e[3],h=e[4],p=e[5],f=e[6],g=e[7],_=e[8],v=e[9],b=e[10],w=e[11],x=B*B*o+s,S=J*B*o+W*n,E=W*B*o-J*n,A=B*J*o-W*n,O=J*J*o+s,L=W*J*o+B*n,z=B*W*o+J*n,k=J*W*o-B*n,q=W*W*o+s,t[0]=a*x+h*S+_*E,t[1]=l*x+p*S+v*E,t[2]=c*x+f*S+b*E,t[3]=u*x+g*S+w*E,t[4]=a*A+h*O+_*L,t[5]=l*A+p*O+v*L,t[6]=c*A+f*O+b*L,t[7]=u*A+g*O+w*L,t[8]=a*z+h*k+_*q,t[9]=l*z+p*k+v*q,t[10]=c*z+f*k+b*q,t[11]=u*z+g*k+w*q,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function LE(t,e,r){const i=Math.sin(r),n=Math.cos(r),s=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u=e[9],h=e[10],p=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*n+c*i,t[5]=o*n+u*i,t[6]=a*n+h*i,t[7]=l*n+p*i,t[8]=c*n-s*i,t[9]=u*n-o*i,t[10]=h*n-a*i,t[11]=p*n-l*i,t}function Kz(t,e,r){const i=Math.sin(r),n=Math.cos(r),s=e[0],o=e[1],a=e[2],l=e[3],c=e[8],u=e[9],h=e[10],p=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*n-c*i,t[1]=o*n-u*i,t[2]=a*n-h*i,t[3]=l*n-p*i,t[8]=s*i+c*n,t[9]=o*i+u*n,t[10]=a*i+h*n,t[11]=l*i+p*n,t}function DE(t,e,r){const i=Math.sin(r),n=Math.cos(r),s=e[0],o=e[1],a=e[2],l=e[3],c=e[4],u=e[5],h=e[6],p=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*n+c*i,t[1]=o*n+u*i,t[2]=a*n+h*i,t[3]=l*n+p*i,t[4]=c*n-s*i,t[5]=u*n-o*i,t[6]=h*n-a*i,t[7]=p*n-l*i,t}function MI(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function W7e(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Kc(t,e,r){if(e===0)return pd(t);let i,n,s,o=r[0],a=r[1],l=r[2],c=Math.sqrt(o*o+a*a+l*l);return c<Va()?null:(c=1/c,o*=c,a*=c,l*=c,i=Math.sin(e),n=Math.cos(e),s=1-n,t[0]=o*o*s+n,t[1]=a*o*s+l*i,t[2]=l*o*s-a*i,t[3]=0,t[4]=o*a*s-l*i,t[5]=a*a*s+n,t[6]=l*a*s+o*i,t[7]=0,t[8]=o*l*s+a*i,t[9]=a*l*s-o*i,t[10]=l*l*s+n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function Mxe(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function q7e(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Oxe(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Rxe(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=i+i,l=n+n,c=s+s,u=i*a,h=i*l,p=i*c,f=n*l,g=n*c,_=s*c,v=o*a,b=o*l,w=o*c;return t[0]=1-(f+_),t[1]=h+w,t[2]=p-b,t[3]=0,t[4]=h-w,t[5]=1-(u+_),t[6]=g+v,t[7]=0,t[8]=p+b,t[9]=g-v,t[10]=1-(u+f),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function Y7e(t,e){const r=X7e,i=-e[0],n=-e[1],s=-e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=i*i+n*n+s*s+o*o;return h>0?(r[0]=2*(a*o+u*i+l*s-c*n)/h,r[1]=2*(l*o+u*n+c*i-a*s)/h,r[2]=2*(c*o+u*s+a*n-l*i)/h):(r[0]=2*(a*o+u*i+l*s-c*n),r[1]=2*(l*o+u*n+c*i-a*s),r[2]=2*(c*o+u*s+a*n-l*i)),Rxe(t,e,r),t}const X7e=C();function NE(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function e9(t,e){const r=e[0],i=e[1],n=e[2],s=e[4],o=e[5],a=e[6],l=e[8],c=e[9],u=e[10];return t[0]=Math.sqrt(r*r+i*i+n*n),t[1]=Math.sqrt(s*s+o*o+a*a),t[2]=Math.sqrt(l*l+c*c+u*u),t}function $xe(t,e){const r=e[0]+e[5]+e[10];let i=0;return r>0?(i=2*Math.sqrt(r+1),t[3]=.25*i,t[0]=(e[6]-e[9])/i,t[1]=(e[8]-e[2])/i,t[2]=(e[1]-e[4])/i):e[0]>e[5]&&e[0]>e[10]?(i=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/i,t[0]=.25*i,t[1]=(e[1]+e[4])/i,t[2]=(e[8]+e[2])/i):e[5]>e[10]?(i=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/i,t[0]=(e[1]+e[4])/i,t[1]=.25*i,t[2]=(e[6]+e[9])/i):(i=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[3]=(e[1]-e[4])/i,t[0]=(e[8]+e[2])/i,t[1]=(e[6]+e[9])/i,t[2]=.25*i),t}function Ixe(t,e,r,i){const n=e[0],s=e[1],o=e[2],a=e[3],l=n+n,c=s+s,u=o+o,h=n*l,p=n*c,f=n*u,g=s*c,_=s*u,v=o*u,b=a*l,w=a*c,x=a*u,S=i[0],E=i[1],A=i[2];return t[0]=(1-(g+v))*S,t[1]=(p+x)*S,t[2]=(f-w)*S,t[3]=0,t[4]=(p-x)*E,t[5]=(1-(h+v))*E,t[6]=(_+b)*E,t[7]=0,t[8]=(f+w)*A,t[9]=(_-b)*A,t[10]=(1-(h+g))*A,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function dee(t,e,r,i,n){const s=e[0],o=e[1],a=e[2],l=e[3],c=s+s,u=o+o,h=a+a,p=s*c,f=s*u,g=s*h,_=o*u,v=o*h,b=a*h,w=l*c,x=l*u,S=l*h,E=i[0],A=i[1],O=i[2],L=n[0],z=n[1],k=n[2],q=(1-(_+b))*E,B=(f+S)*E,J=(g-x)*E,W=(f-S)*A,Y=(1-(p+b))*A,le=(v+w)*A,D=(g+x)*O,I=(v-w)*O,F=(1-(p+_))*O;return t[0]=q,t[1]=B,t[2]=J,t[3]=0,t[4]=W,t[5]=Y,t[6]=le,t[7]=0,t[8]=D,t[9]=I,t[10]=F,t[11]=0,t[12]=r[0]+L-(q*L+W*z+D*k),t[13]=r[1]+z-(B*L+Y*z+I*k),t[14]=r[2]+k-(J*L+le*z+F*k),t[15]=1,t}function Z7e(t,e){const r=e[0],i=e[1],n=e[2],s=e[3],o=r+r,a=i+i,l=n+n,c=r*o,u=i*o,h=i*a,p=n*o,f=n*a,g=n*l,_=s*o,v=s*a,b=s*l;return t[0]=1-h-g,t[1]=u+b,t[2]=p-v,t[3]=0,t[4]=u-b,t[5]=1-c-g,t[6]=f+_,t[7]=0,t[8]=p+v,t[9]=f-_,t[10]=1-c-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Lxe(t,e,r,i,n,s,o){const a=1/(r-e),l=1/(n-i),c=1/(s-o);return t[0]=2*s*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*s*l,t[6]=0,t[7]=0,t[8]=(r+e)*a,t[9]=(n+i)*l,t[10]=(o+s)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*s*2*c,t[15]=0,t}function J7e(t,e,r,i,n){const s=1/Math.tan(e/2);let o;return t[0]=s/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,n!=null&&n!==1/0?(o=1/(i-n),t[10]=(n+i)*o,t[14]=2*n*i*o):(t[10]=-1,t[14]=-2*i),t}function Q7e(t,e,r,i){const n=Math.tan(e.upDegrees*Math.PI/180),s=Math.tan(e.downDegrees*Math.PI/180),o=Math.tan(e.leftDegrees*Math.PI/180),a=Math.tan(e.rightDegrees*Math.PI/180),l=2/(o+a),c=2/(n+s);return t[0]=l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-(o-a)*l*.5,t[9]=(n-s)*c*.5,t[10]=i/(r-i),t[11]=-1,t[12]=0,t[13]=0,t[14]=i*r/(r-i),t[15]=0,t}function Dxe(t,e,r,i,n,s,o){const a=1/(e-r),l=1/(i-n),c=1/(s-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+r)*a,t[13]=(n+i)*l,t[14]=(o+s)*c,t[15]=1,t}function t9(t,e,r,i){const n=e[0],s=e[1],o=e[2];let a=n-r[0],l=s-r[1],c=o-r[2];const u=Va();if(Math.abs(a)<u&&Math.abs(l)<u&&Math.abs(c)<u)return void pd(t);let h=1/Math.sqrt(a*a+l*l+c*c);a*=h,l*=h,c*=h;const p=i[0],f=i[1],g=i[2];let _=f*c-g*l,v=g*a-p*c,b=p*l-f*a;h=Math.sqrt(_*_+v*v+b*b),h?(h=1/h,_*=h,v*=h,b*=h):(_=0,v=0,b=0);let w=l*b-c*v,x=c*_-a*b,S=a*v-l*_;h=Math.sqrt(w*w+x*x+S*S),h?(h=1/h,w*=h,x*=h,S*=h):(w=0,x=0,S=0),t[0]=_,t[1]=w,t[2]=a,t[3]=0,t[4]=v,t[5]=x,t[6]=l,t[7]=0,t[8]=b,t[9]=S,t[10]=c,t[11]=0,t[12]=-(_*n+v*s+b*o),t[13]=-(w*n+x*s+S*o),t[14]=-(a*n+l*s+c*o),t[15]=1}function Nxe(t,e,r,i){const n=e[0],s=e[1],o=e[2],a=i[0],l=i[1],c=i[2];let u=n-r[0],h=s-r[1],p=o-r[2],f=u*u+h*h+p*p;f>0&&(f=1/Math.sqrt(f),u*=f,h*=f,p*=f);let g=l*p-c*h,_=c*u-a*p,v=a*h-l*u;return f=g*g+_*_+v*v,f>0&&(f=1/Math.sqrt(f),g*=f,_*=f,v*=f),t[0]=g,t[1]=_,t[2]=v,t[3]=0,t[4]=h*v-p*_,t[5]=p*g-u*v,t[6]=u*_-h*g,t[7]=0,t[8]=u,t[9]=h,t[10]=p,t[11]=0,t[12]=n,t[13]=s,t[14]=o,t[15]=1,t}function K7e(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function eGe(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+t[6]**2+t[7]**2+t[8]**2+t[9]**2+t[10]**2+t[11]**2+t[12]**2+t[13]**2+t[14]**2+t[15]**2)}function tGe(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t}function Fxe(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t}function rGe(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t}function iGe(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t[6]=e[6]+r[6]*i,t[7]=e[7]+r[7]*i,t[8]=e[8]+r[8]*i,t[9]=e[9]+r[9]*i,t[10]=e[10]+r[10]*i,t[11]=e[11]+r[11]*i,t[12]=e[12]+r[12]*i,t[13]=e[13]+r[13]*i,t[14]=e[14]+r[14]*i,t[15]=e[15]+r[15]*i,t}function pee(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function r9(t,e){if(t===e)return!0;const r=t[0],i=t[1],n=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=t[9],p=t[10],f=t[11],g=t[12],_=t[13],v=t[14],b=t[15],w=e[0],x=e[1],S=e[2],E=e[3],A=e[4],O=e[5],L=e[6],z=e[7],k=e[8],q=e[9],B=e[10],J=e[11],W=e[12],Y=e[13],le=e[14],D=e[15],I=Va();return Math.abs(r-w)<=I*Math.max(1,Math.abs(r),Math.abs(w))&&Math.abs(i-x)<=I*Math.max(1,Math.abs(i),Math.abs(x))&&Math.abs(n-S)<=I*Math.max(1,Math.abs(n),Math.abs(S))&&Math.abs(s-E)<=I*Math.max(1,Math.abs(s),Math.abs(E))&&Math.abs(o-A)<=I*Math.max(1,Math.abs(o),Math.abs(A))&&Math.abs(a-O)<=I*Math.max(1,Math.abs(a),Math.abs(O))&&Math.abs(l-L)<=I*Math.max(1,Math.abs(l),Math.abs(L))&&Math.abs(c-z)<=I*Math.max(1,Math.abs(c),Math.abs(z))&&Math.abs(u-k)<=I*Math.max(1,Math.abs(u),Math.abs(k))&&Math.abs(h-q)<=I*Math.max(1,Math.abs(h),Math.abs(q))&&Math.abs(p-B)<=I*Math.max(1,Math.abs(p),Math.abs(B))&&Math.abs(f-J)<=I*Math.max(1,Math.abs(f),Math.abs(J))&&Math.abs(g-W)<=I*Math.max(1,Math.abs(g),Math.abs(W))&&Math.abs(_-Y)<=I*Math.max(1,Math.abs(_),Math.abs(Y))&&Math.abs(v-le)<=I*Math.max(1,Math.abs(v),Math.abs(le))&&Math.abs(b-D)<=I*Math.max(1,Math.abs(b),Math.abs(D))}function fee(t){const e=Va(),r=t[0],i=t[1],n=t[2],s=t[4],o=t[5],a=t[6],l=t[8],c=t[9],u=t[10];return Math.abs(1-(r*r+s*s+l*l))<=e&&Math.abs(1-(i*i+o*o+c*c))<=e&&Math.abs(1-(n*n+a*a+u*u))<=e}function i9(t){return t[0]===1&&t[1]===0&&t[2]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[8]===0&&t[9]===0&&t[10]===1}const nGe=Hr,sGe=Fxe;Object.freeze(Object.defineProperty({__proto__:null,add:tGe,adjoint:j7e,copy:Zn,determinant:H7e,equals:r9,exactEquals:pee,frob:eGe,fromQuat:Z7e,fromQuat2:Y7e,fromRotation:Kc,fromRotationTranslation:Rxe,fromRotationTranslationScale:Ixe,fromRotationTranslationScaleOrigin:dee,fromScaling:W7e,fromTranslation:MI,fromXRotation:Mxe,fromYRotation:q7e,fromZRotation:Oxe,frustum:Lxe,getRotation:$xe,getScaling:e9,getTranslation:NE,hasIdentityRotation:i9,identity:pd,invert:os,invertOrIdentity:R3,isOrthoNormal:fee,lookAt:t9,mul:nGe,multiply:Hr,multiplyScalar:rGe,multiplyScalarAndAdd:iGe,ortho:Dxe,perspective:J7e,perspectiveFromFieldOfView:Q7e,rotate:Gc,rotateX:LE,rotateY:Kz,rotateZ:DE,scale:P2,set:gg,str:K7e,sub:sGe,subtract:Fxe,targetTo:Nxe,translate:ic,transpose:Qc},Symbol.toStringTag,{value:"Module"}));const oGe=(t,e)=>{const r=gg(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1);return Qc(r,r)},aGe=(t,e)=>{const r=gg(t,e,0,0,.5-.5*e,0,e,0,.5-.5*e,0,0,e,.5-.5*e,0,0,0,1);return Qc(r,r)},lGe=(t,e)=>{const r=1-e,i=gg(t,.2126+.7874*r,.7152-.7152*r,.0722-.0722*r,0,.2126-.2126*r,.7152+.2848*r,.0722-.0722*r,0,.2126-.2126*r,.7152-.7152*r,.0722+.9278*r,0,0,0,0,1);return Qc(i,i)},cGe=(t,e)=>{const r=Math.sin(e*Math.PI/180),i=Math.cos(e*Math.PI/180),n=gg(t,.213+.787*i-.213*r,.715-.715*i-.715*r,.072-.072*i+.928*r,0,.213-.213*i+.143*r,.715+.285*i+.14*r,.072-.072*i-.283*r,0,.213-.213*i-.787*r,.715-.715*i+.715*r,.072+.928*i+.072*r,0,0,0,0,1);return Qc(n,n)},uGe=(t,e)=>{const r=1-2*e,i=gg(t,r,0,0,e,0,r,0,e,0,0,r,e,0,0,0,1);return Qc(i,i)},hGe=(t,e)=>{const r=gg(t,.213+.787*e,.715-.715*e,.072-.072*e,0,.213-.213*e,.715+.285*e,.072-.072*e,0,.213-.213*e,.715-.715*e,.072+.928*e,0,0,0,0,1);return Qc(r,r)},dGe=(t,e)=>{const r=1-e,i=gg(t,.393+.607*r,.769-.769*r,.189-.189*r,0,.349-.349*r,.686+.314*r,.168-.168*r,0,.272-.272*r,.534-.534*r,.131+.869*r,0,0,0,0,1);return Qc(i,i)};let kxe=class zxe{constructor(e,r,i){this.strength=e,this.radius=r,this.threshold=i,this.type="bloom"}interpolate(e,r,i){this.strength=Rc(e.strength,r.strength,i),this.radius=Rc(e.radius,r.radius,i),this.threshold=Rc(e.threshold,r.threshold,i)}clone(){return new zxe(this.strength,this.radius,this.threshold)}toJSON(){return{type:"bloom",radius:WO(this.radius),strength:this.strength,threshold:this.threshold}}},Uxe=class Bxe{constructor(e){this.radius=e,this.type="blur"}interpolate(e,r,i){this.radius=Math.round(Rc(e.radius,r.radius,i))}clone(){return new Bxe(this.radius)}toJSON(){return{type:"blur",radius:WO(this.radius)}}},NW=class Vxe{constructor(e,r){this.type=e,this.amount=r,this.type!=="invert"&&this.type!=="grayscale"&&this.type!=="sepia"||(this.amount=Math.min(this.amount,1))}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,r,i){this.amount=Rc(e.amount,r.amount,i),this._updateMatrix()}clone(){return new Vxe(this.type,this.amount)}toJSON(){return{type:this.type,amount:this.amount}}_updateMatrix(){const e=this._colorMatrix||Qz();switch(this.type){case"brightness":this._colorMatrix=oGe(e,this.amount);break;case"contrast":this._colorMatrix=aGe(e,this.amount);break;case"grayscale":this._colorMatrix=lGe(e,this.amount);break;case"invert":this._colorMatrix=uGe(e,this.amount);break;case"saturate":this._colorMatrix=hGe(e,this.amount);break;case"sepia":this._colorMatrix=dGe(e,this.amount)}}},Gxe=class jxe{constructor(e,r,i,n){this.offsetX=e,this.offsetY=r,this.blurRadius=i,this.color=n,this.type="drop-shadow"}interpolate(e,r,i){this.offsetX=Rc(e.offsetX,r.offsetX,i),this.offsetY=Rc(e.offsetY,r.offsetY,i),this.blurRadius=Rc(e.blurRadius,r.blurRadius,i),this.color[0]=Math.round(Rc(e.color[0],r.color[0],i)),this.color[1]=Math.round(Rc(e.color[1],r.color[1],i)),this.color[2]=Math.round(Rc(e.color[2],r.color[2],i)),this.color[3]=Rc(e.color[3],r.color[3],i)}clone(){return new jxe(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}toJSON(){const e=[...this.color];return e[3]*=255,{type:"drop-shadow",xoffset:WO(this.offsetX),yoffset:WO(this.offsetY),blurRadius:WO(this.blurRadius),color:e}}},Hxe=class Wxe{constructor(e){this.angle=e,this.type="hue-rotate"}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,r,i){this.angle=Rc(e.angle,r.angle,i),this._updateMatrix()}clone(){return new Wxe(this.angle)}toJSON(){return{type:"hue-rotate",angle:this.angle}}_updateMatrix(){const e=this._colorMatrix||Qz();this._colorMatrix=cGe(e,this.angle)}},qxe=class Yxe{constructor(e){this.amount=e,this.type="opacity",this.amount=Math.min(this.amount,1)}interpolate(e,r,i){this.amount=Rc(e.amount,r.amount,i)}clone(){return new Yxe(this.amount)}toJSON(){return{type:"opacity",amount:this.amount}}};function Rc(t,e,r){return t+(e-t)*r}function WO(t){return Math.round(1e3*xl(t))/1e3}function pGe(t){switch(t.type){case"grayscale":case"sepia":case"invert":return new NW(t.type,0);case"saturate":case"brightness":case"contrast":return new NW(t.type,1);case"opacity":return new qxe(1);case"hue-rotate":return new Hxe(0);case"blur":return new Uxe(0);case"drop-shadow":return new Gxe(0,0,0,[...nee("transparent")]);case"bloom":return new kxe(0,0,1)}}function fGe(t,e){const r=t.length>e.length?t:e;return(t.length>e.length?e:t).every((i,n)=>i.type===r[n].type)}function mGe(t,e){const r=t.length>e.length?t:e,i=t.length>e.length?e:t;for(let n=i.length;n<r.length;n++)i.push(pGe(r[n]))}function gGe(t){const e=t[0];return!!e&&"type"in e}const Fae=()=>re.getLogger("esri.support.basemapUtils");function yGe(){return{}}function _Ge(t){for(const e in t){const r=t[e];Pe(r),delete t[e]}}function vGe(t,e){let r;if(typeof t=="string"){const i=t in OW,n=!i&&t.includes("/");if(!i&&!n){const s=Object.entries(OW).filter(([o,a])=>mi.apiKey&&!a.classic||!mi.apiKey&&(a.classic||a.is3d)).map(([o])=>`"${o}"`).sort().join(", ");return Fae().warn(`Unable to find basemap definition for: ${t}. Try one of these: ${s}`),null}e&&(r=e[t]),r||(r=i?UC.fromId(t):new UC({style:{id:t}}),e&&(e[t]=r))}else r=Na(UC,t);return r!=null&&r.destroyed&&(Fae().warn("The provided basemap is already destroyed",{basemap:r}),r=null),r}function gFt(t,e){var r,i,n,s;return((i=(r=t.basemap)==null?void 0:r.referenceLayers)==null?void 0:i.some(o=>o.uid===e))||((s=(n=t.basemap)==null?void 0:n.baseLayers)==null?void 0:s.some(o=>o.uid===e))}function bGe(t){return new v$({getCollections:()=>[t.tables,t.layers],getChildrenFunction:e=>{const r=[];return"tables"in e&&r.push(e.tables),"layers"in e&&r.push(e.layers),r},itemFilterFunction:e=>{const r=e.parent;return!!r&&"tables"in r&&r.tables.includes(e)}})}function ZB(t){for(const e of t.values())e==null||e.destroy();t.clear()}const kae={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};function wGe(t){let e=null;if(typeof t=="string")if(t in kae){const r=kae[t];e=new s6({resourceInfo:{data:{layers:[r]}}})}else re.getLogger("esri.support.groundUtils").warn(`Unable to find ground definition for: ${t}. Try "world-elevation"`);else e=Na(s6,t);return e}function FE(t,e,r=!1){let{hasM:i,hasZ:n}=t;Array.isArray(e)?e.length!==4||i||n?e.length===3&&r&&!i?(n=!0,i=!1):e.length===3&&i&&n&&(i=!1,n=!1):(i=!0,n=!0):(n=!n&&e.hasZ&&(!i||e.hasM),i=!i&&e.hasM&&(!n||e.hasZ)),t.hasZ=n,t.hasM=i}var FW;function zae(t){return(e,r)=>e==null?r:r==null?e:t(e,r)}function xGe(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}let v_=FW=class extends py{constructor(...t){super(...t),this.points=[],this.type="multipoint"}normalizeCtorArgs(t,e){var n;if(!t&&!e)return{};const r={};Array.isArray(t)?(r.points=t,r.spatialReference=e):xGe(t)?r.spatialReference=t:(t.points&&(r.points=t.points),t.spatialReference&&(r.spatialReference=t.spatialReference),t.hasZ&&(r.hasZ=t.hasZ),t.hasM&&(r.hasM=t.hasM));const i=(n=r.points)==null?void 0:n[0];return i&&(r.hasZ===void 0&&r.hasM===void 0?(r.hasZ=i.length>2,r.hasM=!1):r.hasZ===void 0?r.hasZ=i.length>3:r.hasM===void 0&&(r.hasM=i.length>3)),r}get cache(){return this.commitProperty("points"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const t=this.points;if(!t.length)return null;const e=new ei,r=this.hasZ,i=this.hasM,n=r?3:2,s=t[0],o=zae(Math.min),a=zae(Math.max);let l,c,u,h,[p,f]=s,[g,_]=s;for(let v=0,b=t.length;v<b;v++){const w=t[v],[x,S]=w;if(p=o(p,x),f=o(f,S),g=a(g,x),_=a(_,S),r&&w.length>2){const E=w[2];l=o(l,E),u=a(u,E)}if(i&&w.length>n){const E=w[n];c=o(c,E),h=a(h,E)}}return e.xmin=p,e.ymin=f,e.xmax=g,e.ymax=_,e.spatialReference=this.spatialReference,r?(e.zmin=l,e.zmax=u):(e.zmin=void 0,e.zmax=void 0),i?(e.mmin=c,e.mmax=h):(e.mmin=void 0,e.mmax=void 0),e}writePoints(t,e){e.points=_e(this.points)}addPoint(t){return FE(this,t),Array.isArray(t)?this.points.push(t):this.points.push(t.toArray()),this.notifyChange("points"),this}clone(){const t={points:_e(this.points),spatialReference:this.spatialReference};return this.hasZ&&(t.hasZ=!0),this.hasM&&(t.hasM=!0),new FW(t)}getPoint(t){if(!this._validateInputs(t))return null;const e=this.points[t],r={x:e[0],y:e[1],spatialReference:this.spatialReference};let i=2;return this.hasZ&&(r.z=e[2],i=3),this.hasM&&(r.m=e[i]),new ke(r)}removePoint(t){if(!this._validateInputs(t))return null;const e=new ke(this.points.splice(t,1)[0],this.spatialReference);return this.notifyChange("points"),e}setPoint(t,e){return this._validateInputs(t)?(FE(this,e),Array.isArray(e)||(e=e.toArray()),this.points[t]=e,this.notifyChange("points"),this):this}toJSON(t){return this.write({},t)}_validateInputs(t){return t!=null&&t>=0&&t<this.points.length}};d([m({readOnly:!0})],v_.prototype,"cache",null),d([m()],v_.prototype,"extent",null),d([m({type:[[Number]],json:{write:{isRequired:!0}}})],v_.prototype,"points",void 0),d([hr("points")],v_.prototype,"writePoints",null),v_=FW=d([V("esri.geometry.Multipoint")],v_),v_.prototype.toJSON.isDefaultToJSON=!0;const $3=v_;function n9(t){const e=[];for(t.reset();t.nextPath();){const r=[];for(;t.nextPoint();)r.push([t.x,t.y]);e.push(r)}return t.reset(),e}function B1(t){const e=[];for(;t.nextPoint();)e.push([t.x,t.y]);return t.seekPathStart(),e}var hn;(function(t){t[t.X=0]="X",t[t.Y=1]="Y",t[t.Z=2]="Z"})(hn||(hn={}));function s9(t,e){const r=e[0]-t[0],i=e[1]-t[1];if(t.length>2&&e.length>2){const n=t[2]-e[2];return Math.sqrt(r*r+i*i+n*n)}return Math.sqrt(r*r+i*i)}function Xxe(t,e,r){const i=t[0]+r*(e[0]-t[0]),n=t[1]+r*(e[1]-t[1]);return t.length>2&&e.length>2?[i,n,t[2]+r*(e[2]-t[2])]:[i,n]}function TGe(t,e,r,i){const[n,s]=e,[o,a]=r,[l,c]=i,u=l-o,h=c-a,p=u*u+h*h,f=(n-o)*u+(s-a)*h,g=Math.min(1,Math.max(0,f/p));return t[0]=o+u*g,t[1]=a+h*g,t}function SGe(t,e,r,i,n,s){let o=r,a=i,l=n-o,c=s-a;if(l!==0||c!==0){const u=((t-o)*l+(e-a)*c)/(l*l+c*c);u>1?(o=n,a=s):u>0&&(o+=l*u,a+=c*u)}return l=t-o,c=e-a,l*l+c*c}function Zxe(t,e){return Xxe(t,e,.5)}function Jxe(t){const e=t.length;let r=0;for(let i=0;i<e-1;++i)r+=s9(t[i],t[i+1]);return r}function Qxe(t,e){if(e<=0)return t[0];const r=t.length;let i=0;for(let n=0;n<r-1;++n){const s=s9(t[n],t[n+1]);if(e-i<s){const o=(e-i)/s;return Xxe(t[n],t[n+1],o)}i+=s}return t[r-1]}function p5(t,e=hn.X,r=hn.Y){let i=0;const n=t.length;let s=t[0];for(let o=0;o<n-1;o++){const a=t[o+1];i+=(a[e]-s[e])*(a[r]+s[r]),s=a}return i>=0}function CGe(t){const e=t.length;return e>2&&tg(t[0],t[e-1])}function yFt(t){if("rings"in t)for(const e of t.rings)CGe(e)||e.push(e[0].slice())}function _Ft(t){return t?t.hasZ?[t.xmax-t.xmin/2,t.ymax-t.ymin/2,t.zmax-t.zmin/2]:[t.xmax-t.xmin/2,t.ymax-t.ymin/2]:null}function Kxe(t){return t?e2e(t.rings,t.hasZ??!1):null}function e2e(t,e){if(!(t!=null&&t.length))return null;const r=[],i=[],n=e?[1/0,-1/0,1/0,-1/0,1/0,-1/0]:[1/0,-1/0,1/0,-1/0];for(let s=0,o=t.length;s<o;s++){const a=t2e(t[s],e,n);a&&i.push(a)}if(i.sort((s,o)=>{let a=s[2]-o[2];return a===0&&e&&(a=s[4]-o[4]),a}),i.length&&(r[0]=i[0][0],r[1]=i[0][1],e&&(r[2]=i[0][3]),(r[0]<n[0]||r[0]>n[1]||r[1]<n[2]||r[1]>n[3]||e&&(r[2]<n[4]||r[2]>n[5]))&&(r.length=0)),!r.length){const s=t[0]&&t[0].length?PGe(t[0],e):null;if(!s)return null;r[0]=s[0],r[1]=s[1],e&&s.length>2&&(r[2]=s[2])}return r}function t2e(t,e,r){let i=0,n=0,s=0,o=0,a=0;const l=t.length?t[0][0]:0,c=t.length?t[0][1]:0,u=t.length&&e?t[0][2]:0;for(let p=0;p<t.length;p++){const f=t[p],g=t[(p+1)%t.length],[_,v,b]=f,w=_-l,x=v-c,[S,E,A]=g,O=S-l,L=E-c,z=w*L-O*x;if(o+=z,i+=(w+O)*z,n+=(x+L)*z,e&&f.length>2&&g.length>2){const k=b-u,q=A-u,B=w*q-O*k;s+=(k+q)*B,a+=B}_<r[0]&&(r[0]=_),_>r[1]&&(r[1]=_),v<r[2]&&(r[2]=v),v>r[3]&&(r[3]=v),e&&(b<r[4]&&(r[4]=b),b>r[5]&&(r[5]=b))}if(o>0&&(o*=-1),a>0&&(a*=-1),!o)return null;o*=.5,a*=.5;const h=[i/(6*o)+l,n/(6*o)+c,o];return e&&(r[4]===r[5]||a===0?(h[3]=(r[4]+r[5])/2,h[4]=0):(h[3]=s/(6*a)+u,h[4]=a)),h}function EGe(t,e){let r=0,i=0,n=0;t.nextPoint();const s=t.pathSize?t.x:0,o=t.pathSize?t.y:0;for(let a=0;a<t.pathSize;a++){t.seekInPath(a);const l=[t.x,t.y];t.seekInPath((a+1)%t.pathSize);const c=[t.x,t.y],[u,h]=l,p=u-s,f=h-o,[g,_]=c,v=g-s,b=_-o,w=p*b-v*f;n+=w,r+=(p+v)*w,i+=(f+b)*w,u<e[0]&&(e[0]=u),u>e[1]&&(e[1]=u),h<e[2]&&(e[2]=h),h>e[3]&&(e[3]=h)}return n>0&&(n*=-1),n?(n*=.5,[r/(6*n)+s,i/(6*n)+o,n]):null}function PGe(t,e){const r=e?[0,0,0]:[0,0],i=e?[0,0,0]:[0,0];let n=0,s=0,o=0,a=0;for(let l=0,c=t.length;l<c-1;l++){const u=t[l],h=t[l+1];if(u&&h){r[0]=u[0],r[1]=u[1],i[0]=h[0],i[1]=h[1],e&&u.length>2&&h.length>2&&(r[2]=u[2],i[2]=h[2]);const p=s9(r,i);if(p){n+=p;const f=Zxe(u,h);s+=p*f[0],o+=p*f[1],e&&f.length>2&&(a+=p*f[2])}}}return n>0?e?[s/n,o/n,a/n]:[s/n,o/n]:t.length?t[0]:null}function AGe(t){const{hasZ:e,totalSize:r}=t;if(r===0)return null;const i=[],n=[],s=e?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY];for(t.reset();t.nextPath();){const o=t2e(B1(t),t.hasZ,s);o&&n.push(o)}if(n.sort((o,a)=>{let l=o[2]-a[2];return l===0&&e&&(l=o[4]-a[4]),l}),n.length&&(i[0]=n[0][0],i[1]=n[0][1],e&&(i[2]=n[0][3]),(i[0]<s[0]||i[0]>s[1]||i[1]<s[2]||i[1]>s[3]||e&&(i[2]<s[4]||i[2]>s[5]))&&(i.length=0)),!i.length){t.reset(),t.nextPath();const o=t.pathSize?MGe(t):null;if(!o)return null;i[0]=o[0],i[1]=o[1],e&&o.length>2&&(i[2]=o[2])}return i}function MGe(t){const{hasZ:e}=t,r=e?[0,0,0]:[0,0],i=e?[0,0,0]:[0,0];let n=0,s=0,o=0,a=0;if(t.nextPoint()){let l=t.x,c=t.y,u=t.z;for(;t.nextPoint();){const h=t.x,p=t.y,f=t.z;r[0]=l,r[1]=c,i[0]=h,i[1]=p,e&&(r[2]=u,i[2]=f);const g=s9(r,i);if(g){n+=g;const _=Zxe(r,i);s+=g*_[0],o+=g*_[1],e&&_.length>2&&(a+=g*_[2])}l=h,c=p,u=f}}return n>0?e?[s/n,o/n,a/n]:[s/n,o/n]:t.pathSize?(t.seekPathStart(),t.nextPoint(),[t.x,t.y]):null}const OGe=1e-6;function RGe(t){let e=0;for(t.reset();t.nextPath();)e+=t.getCurrentRingArea();if(e<OGe){const n=AGe(t);return n?[n[0],n[1]]:null}const r=[0,0];if(t.reset(),!t.nextPath()||!t.nextPoint())return null;const i=[t.x,t.y];for(t.reset();t.nextPath();)IGe(r,i,t);return r[0]*=1/e,r[1]*=1/e,r[0]+=i[0],r[1]+=i[1],r}const $Ge=1/3;function IGe(t,e,r){if(!t||!r||r.pathSize<3)return null;r.nextPoint();const i=r.x,n=r.y;r.nextPoint();let s,o=r.x-i,a=r.y-n,l=0,c=0;for(;r.nextPoint();)l=r.x-i,c=r.y-n,s=.5*$Ge*(l*a-c*o),t[0]+=s*(o+l),t[1]+=s*(a+c),o=l,a=c;const u=r.getCurrentRingArea(),h=[i,n];return h[0]-=e[0],h[1]-=e[1],h[0]*=u,h[1]*=u,t[0]+=h[0],t[1]+=h[1],t}function Wt(t=FGe){return[t[0],t[1],t[2],t[3]]}function vFt(t){return[t[0],t[1],t[2],t[3]]}function ey(t,e){return t!==e&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3]),t}function o9(t,e,r,i,n=Wt()){return n[0]=t,n[1]=e,n[2]=r,n[3]=i,n}function r2e(t,e=Wt()){return e[0]=t.xmin,e[1]=t.ymin,e[2]=t.xmax,e[3]=t.ymax,e}function a9(t,e){return new ei({xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3],spatialReference:e})}function mee(t,e){e[0]<t[0]&&(t[0]=e[0]),e[0]>t[2]&&(t[2]=e[0]),e[1]<t[1]&&(t[1]=e[1]),e[1]>t[3]&&(t[3]=e[1])}function V1(t,e,r){if(e!=null)if("length"in e)UW(e)?(r[0]=Math.min(t[0],e[0]),r[1]=Math.min(t[1],e[1]),r[2]=Math.max(t[2],e[2]),r[3]=Math.max(t[3],e[3])):e.length!==2&&e.length!==3||(r[0]=Math.min(t[0],e[0]),r[1]=Math.min(t[1],e[1]),r[2]=Math.max(t[2],e[0]),r[3]=Math.max(t[3],e[1]));else switch(e.type){case"extent":r[0]=Math.min(t[0],e.xmin),r[1]=Math.min(t[1],e.ymin),r[2]=Math.max(t[2],e.xmax),r[3]=Math.max(t[3],e.ymax);break;case"point":r[0]=Math.min(t[0],e.x),r[1]=Math.min(t[1],e.y),r[2]=Math.max(t[2],e.x),r[3]=Math.max(t[3],e.y)}else ey(r,t)}function JB(t,e,r=t){const i=e.length;let n=t[0],s=t[1],o=t[2],a=t[3];for(let l=0;l<i;l++){const c=e[l];n=Math.min(n,c[0]),s=Math.min(s,c[1]),o=Math.max(o,c[0]),a=Math.max(a,c[1])}return r[0]=n,r[1]=s,r[2]=o,r[3]=a,r}function kW(t){for(let e=0;e<4;e++)if(!isFinite(t[e]))return!1;return!0}function $a(t){return t==null||t[0]>=t[2]?0:t[2]-t[0]}function Jl(t){return t==null||t[1]>=t[3]?0:t[3]-t[1]}function bFt(t){return $a(t)*Jl(t)}function o6(t){return $a(t)>0&&Jl(t)>0}function gee(t,e=[0,0]){return e[0]=(t[0]+t[2])/2,e[1]=(t[1]+t[3])/2,e}function i2e(t,e){return l9(t,e[0],e[1])}function Uae(t,e){const r=e[3],i=.5*(t[0]+t[2]),n=Math.abs(e[0]-i),s=.5*(t[2]-t[0]);if(n>r+s)return!1;const o=.5*(t[1]+t[3]),a=.5*(t[3]-t[1]),l=Math.abs(e[1]-o);if(l>r+a)return!1;if(n<s||l<a)return!0;const c=n-s,u=l-a;return c*c+u*u<=r*r}function wFt(t,e,r){const i=t[0],n=t[1],s=t[2],o=t[3],{x:a,y:l}=e,{x:c,y:u}=r,h=(v,b)=>(u-l)*v+(a-c)*b+(c*l-a*u)<0,p=h(i,o),f=h(s,o),g=h(s,n),_=h(i,n);return!(p===f&&f===g&&g===_&&_===p||a<i&&c<i||a>s&&c>s||l>o&&u>o||l<n&&u<n)}function xFt(t,e){return l9(t,e.x,e.y)}function l9(t,e,r){return e>=t[0]&&r>=t[1]&&e<=t[2]&&r<=t[3]}function LGe(t,e,r){return e[0]>=t[0]-r&&e[1]>=t[1]-r&&e[0]<=t[2]+r&&e[1]<=t[3]+r}function c9(t,e){return Math.max(e[0],t[0])<=Math.min(e[2],t[2])&&Math.max(e[1],t[1])<=Math.min(e[3],t[3])}function Bae(t,e){return e[0]>=t[0]&&e[2]<=t[2]&&e[1]>=t[1]&&e[3]<=t[3]}function zW(t,e,r){if(e==null)return ey(r,t);const i=e[0],n=e[1],s=e[2],o=e[3];return r[0]=we(t[0],i,s),r[1]=we(t[1],n,o),r[2]=we(t[2],i,s),r[3]=we(t[3],n,o),r}function DGe(t,e){const r=(t[0]+t[2])/2,i=(t[1]+t[3])/2,n=Math.max(Math.abs(e[0]-r)-$a(t)/2,0),s=Math.max(Math.abs(e[1]-i)-Jl(t)/2,0);return Math.sqrt(n*n+s*s)}function a6(t,e,r,i=t){return i[0]=t[0]+e,i[1]=t[1]+r,i[2]=t[2]+e,i[3]=t[3]+r,i}function Ku(t){return t?ey(t,BW):Wt(BW)}function UW(t){return t!=null&&t.length===4}function NGe(t){return!($a(t)!==0&&isFinite(t[0])||Jl(t)!==0&&isFinite(t[1]))}function Sx(t,e){return UW(t)&&UW(e)?t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]:t===e}const TFt=[-1/0,-1/0,1/0,1/0],BW=[1/0,1/0,-1/0,-1/0],FGe=[0,0,0,0];function n2e(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function s2e(t){return t.points!==void 0}function o2e(t){return t.x!==void 0&&t.y!==void 0}function a2e(t){return t.paths!==void 0}function l2e(t){return t.rings!==void 0}function c2e(t){function e(r,i){return r==null?i:i==null?r:t(r,i)}return e}const _1=c2e(Math.min),v1=c2e(Math.max);function kGe(t,e){return a2e(e)?kE(t,e.paths,!1,!1):l2e(e)?kE(t,e.rings,!1,!1):s2e(e)?yee(t,e.points,!1,!1,!1,!1):n2e(e)?h2e(t,e):(o2e(e)&&(t[0]=e.x,t[1]=e.y,t[2]=e.x,t[3]=e.y),t)}function u9(t){let e,r,i,n;for(t.reset(),e=i=1/0,r=n=-1/0;t.nextPath();){const s=u2e(t);e=Math.min(s[0],e),i=Math.min(s[1],i),r=Math.max(s[2],r),n=Math.max(s[3],n)}return Wt([e,i,r,n])}function u2e(t){let e,r,i,n;for(e=i=1/0,r=n=-1/0;t.nextPoint();)e=Math.min(t.x,e),i=Math.min(t.y,i),r=Math.max(t.x,r),n=Math.max(t.y,n);return Wt([e,i,r,n])}function SFt(t,e){return a2e(e)?kE(t,e.paths,!0,!1):l2e(e)?kE(t,e.rings,!0,!1):s2e(e)?yee(t,e.points,!0,!1,!0,!1):n2e(e)?h2e(t,e,!0,!1,!0,!1):(o2e(e)&&(t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.x,t[4]=e.y,t[5]=e.z),t)}function kE(t,e,r,i){const n=r?3:2;if(!e.length||!e[0].length)return null;let s,o,a,l,[c,u]=e[0][0],[h,p]=e[0][0];for(let f=0;f<e.length;f++){const g=e[f];for(let _=0;_<g.length;_++){const v=g[_],[b,w]=v;if(c=_1(c,b),u=_1(u,w),h=v1(h,b),p=v1(p,w),r&&v.length>2){const x=v[2];s=_1(s,x),o=v1(o,x)}if(i&&v.length>n){const x=v[n];a=_1(s,x),l=v1(o,x)}}}return r?i?(t[0]=c,t[1]=u,t[2]=s,t[3]=a,t[4]=h,t[5]=p,t[6]=o,t[7]=l,t.length=8,t):(t[0]=c,t[1]=u,t[2]=s,t[3]=h,t[4]=p,t[5]=o,t.length=6,t):i?(t[0]=c,t[1]=u,t[2]=a,t[3]=h,t[4]=p,t[5]=l,t.length=6,t):(t[0]=c,t[1]=u,t[2]=h,t[3]=p,t.length=4,t)}function h2e(t,e,r,i,n,s){const o=e.xmin,a=e.xmax,l=e.ymin,c=e.ymax;let u=e.zmin,h=e.zmax,p=e.mmin,f=e.mmax;return n?(u=u||0,h=h||0,s?(p=p||0,f=f||0,t[0]=o,t[1]=l,t[2]=u,t[3]=p,t[4]=a,t[5]=c,t[6]=h,t[7]=f,t):(t[0]=o,t[1]=l,t[2]=u,t[3]=a,t[4]=c,t[5]=h,t)):s?(p=p||0,f=f||0,t[0]=o,t[1]=l,t[2]=p,t[3]=a,t[4]=c,t[5]=f,t):(t[0]=o,t[1]=l,t[2]=a,t[3]=c,t)}function yee(t,e,r,i,n,s){const o=r?3:2,a=i&&s,l=r&&n;if(!e.length||!e[0].length)return null;let c,u,h,p,[f,g]=e[0],[_,v]=e[0];for(let b=0;b<e.length;b++){const w=e[b],[x,S]=w;if(f=_1(f,x),g=_1(g,S),_=v1(_,x),v=v1(v,S),l&&w.length>2){const E=w[2];c=_1(c,E),u=v1(u,E)}if(a&&w.length>o){const E=w[o];h=_1(c,E),p=v1(u,E)}}return n?(c=c||0,u=u||0,s?(h=h||0,p=p||0,t[0]=f,t[1]=g,t[2]=c,t[3]=h,t[4]=_,t[5]=v,t[6]=u,t[7]=p,t):(t[0]=f,t[1]=g,t[2]=c,t[3]=_,t[4]=v,t[5]=u,t)):s?(h=h||0,p=p||0,t[0]=f,t[1]=g,t[2]=h,t[3]=_,t[4]=v,t[5]=p,t):(t[0]=f,t[1]=g,t[2]=_,t[3]=v,t)}function zGe(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function UGe(t){return t.points!==void 0}function BGe(t){return t.x!==void 0&&t.y!==void 0}function VGe(t){return t.paths!==void 0}function GGe(t){return t.rings!==void 0}const _ee=[];function d2e(t,e,r,i){return{xmin:t,ymin:e,xmax:r,ymax:i}}function p2e(t,e,r,i,n,s){return{xmin:t,ymin:e,zmin:r,xmax:i,ymax:n,zmax:s}}function f2e(t,e,r,i,n,s){return{xmin:t,ymin:e,mmin:r,xmax:i,ymax:n,mmax:s}}function m2e(t,e,r,i,n,s,o,a){return{xmin:t,ymin:e,zmin:r,mmin:i,xmax:n,ymax:s,zmax:o,mmax:a}}function vee(t,e=!1,r=!1){return e?r?m2e(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7]):p2e(t[0],t[1],t[2],t[3],t[4],t[5]):r?f2e(t[0],t[1],t[2],t[3],t[4],t[5]):d2e(t[0],t[1],t[2],t[3])}function CFt(t){return t?zGe(t)?t:BGe(t)?HGe(t):GGe(t)?g2e(t):VGe(t)?y2e(t):UGe(t)?jGe(t):null:null}function jGe(t){const{hasZ:e,hasM:r,points:i}=t;return vee(yee(_ee,i,e??!1,r??!1),e,r)}function HGe(t){const{x:e,y:r,z:i,m:n}=t,s=n!=null;return i!=null?s?m2e(e,r,i,n,e,r,i,n):p2e(e,r,i,e,r,i):s?f2e(e,r,n,e,r,n):d2e(e,r,e,r)}function g2e(t){const{hasZ:e,hasM:r,rings:i}=t,n=kE(_ee,i,e??!1,r??!1);return n?vee(n,e,r):null}function y2e(t){const{hasZ:e,hasM:r,paths:i}=t,n=kE(_ee,i,e??!1,r??!1);return n?vee(n,e,r):null}var f5;function Vae(t){return!Array.isArray(t[0])}let Xf=f5=class extends py{static fromExtent(t){const e=t.clone().normalize(),r=t.spatialReference;let i=!1,n=!1;for(const o of e)o.hasZ&&(i=!0),o.hasM&&(n=!0);const s={rings:e.map(o=>{const a=[[o.xmin,o.ymin],[o.xmin,o.ymax],[o.xmax,o.ymax],[o.xmax,o.ymin],[o.xmin,o.ymin]];if(i&&o.hasZ){const l=o.zmin+.5*(o.zmax-o.zmin);for(let c=0;c<a.length;c++)a[c].push(l)}if(n&&o.hasM){const l=o.mmin+.5*(o.mmax-o.mmin);for(let c=0;c<a.length;c++)a[c].push(l)}return a}),spatialReference:r};return i&&(s.hasZ=!0),n&&(s.hasM=!0),new f5(s)}constructor(...t){super(...t),this.rings=[],this.type="polygon"}normalizeCtorArgs(t,e){var o,a;let r,i,n=null,s=null;return t&&!Array.isArray(t)?(n=t.rings??null,e||(t.spatialReference?e=t.spatialReference:t.rings||(e=t)),r=t.hasZ,i=t.hasM):n=t,n=n||[],e=e||lt.WGS84,n.length&&((o=n[0])==null?void 0:o[0])!=null&&typeof n[0][0]=="number"&&(n=[n]),s=(a=n[0])==null?void 0:a[0],s&&(r===void 0&&i===void 0?(r=s.length>2,i=s.length>3):r===void 0?r=i?s.length>3:s.length>2:i===void 0&&(i=r?s.length>3:s.length>2)),{rings:n,spatialReference:e,hasZ:r,hasM:i}}get cache(){return this.commitProperty("rings"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get centroid(){const t=Kxe(this);if(!t||isNaN(t[0])||isNaN(t[1])||this.hasZ&&isNaN(t[2]))return null;const e=new ke;return e.x=t[0],e.y=t[1],e.spatialReference=this.spatialReference,this.hasZ&&(e.z=t[2]),e}get extent(){const{spatialReference:t}=this,e=g2e(this);if(!e)return null;const r=new ei(e);return r.spatialReference=t,r}get isSelfIntersecting(){return xVe(this.rings)}writeRings(t,e){e.rings=_e(this.rings)}addRing(t){if(!t)return;const e=this.rings,r=e.length;if(Vae(t)){const i=[];for(let n=0,s=t.length;n<s;n++)i[n]=t[n].toArray();e[r]=i}else e[r]=t.concat();return this.notifyChange("rings"),this}clone(){const t=new f5;return t.spatialReference=this.spatialReference,t.rings=_e(this.rings),t.hasZ=this.hasZ,t.hasM=this.hasM,t}equals(t){if(this===t)return!0;if(t==null)return!1;const e=this.spatialReference,r=t.spatialReference;if(e!=null!=(r!=null)||e!=null&&r!=null&&!e.equals(r)||this.rings.length!==t.rings.length)return!1;const i=([n,s,o,a],[l,c,u,h])=>n===l&&s===c&&(o==null&&u==null||o===u)&&(a==null&&h==null||a===h);for(let n=0;n<this.rings.length;n++){const s=this.rings[n],o=t.rings[n];if(!tg(s,o,i))return!1}return!0}contains(t){if(!t)return!1;const e=PI(t,this.spatialReference);return dVe(this,e??t)}isClockwise(t){let e;return e=Vae(t)?t.map(r=>this.hasZ?this.hasM?[r.x,r.y,r.z,r.m]:[r.x,r.y,r.z]:[r.x,r.y]):t,p5(e)}getPoint(t,e){if(!this._validateInputs(t,e))return null;const r=this.rings[t][e],i=this.hasZ,n=this.hasM;return i&&!n?new ke(r[0],r[1],r[2],void 0,this.spatialReference):n&&!i?new ke(r[0],r[1],void 0,r[2],this.spatialReference):i&&n?new ke(r[0],r[1],r[2],r[3],this.spatialReference):new ke(r[0],r[1],this.spatialReference)}insertPoint(t,e,r){return this._validateInputs(t,e,!0)?(FE(this,r),Array.isArray(r)||(r=r.toArray()),this.rings[t].splice(e,0,r),this.notifyChange("rings"),this):this}removePoint(t,e){if(!this._validateInputs(t,e))return null;const r=new ke(this.rings[t].splice(e,1)[0],this.spatialReference);return this.notifyChange("rings"),r}removeRing(t){if(!this._validateInputs(t,null))return null;const e=this.rings.splice(t,1)[0],r=this.spatialReference,i=e.map(n=>new ke(n,r));return this.notifyChange("rings"),i}setPoint(t,e,r){return this._validateInputs(t,e)?(FE(this,r),Array.isArray(r)||(r=r.toArray()),this.rings[t][e]=r,this.notifyChange("rings"),this):this}_validateInputs(t,e,r=!1){if(t==null||t<0||t>=this.rings.length)return!1;if(e!=null){const i=this.rings[t];if(r&&(e<0||e>i.length)||!r&&(e<0||e>=i.length))return!1}return!0}toJSON(t){return this.write({},t)}};d([m({readOnly:!0})],Xf.prototype,"cache",null),d([m({readOnly:!0})],Xf.prototype,"centroid",null),d([m({readOnly:!0})],Xf.prototype,"extent",null),d([m({readOnly:!0})],Xf.prototype,"isSelfIntersecting",null),d([m({type:[[[Number]]],json:{write:{isRequired:!0}}})],Xf.prototype,"rings",void 0),d([hr("rings")],Xf.prototype,"writeRings",null),Xf=f5=d([V("esri.geometry.Polygon")],Xf),Xf.prototype.toJSON.isDefaultToJSON=!0;const nf=Xf;var VW;function WGe(t){return!Array.isArray(t[0])}let b_=VW=class extends py{constructor(...t){super(...t),this.paths=[],this.type="polyline"}normalizeCtorArgs(t,e){var o,a;let r,i,n=null,s=null;return t&&!Array.isArray(t)?(n=t.paths??null,e||(t.spatialReference?e=t.spatialReference:t.paths||(e=t)),r=t.hasZ,i=t.hasM):n=t,n=n||[],e=e||lt.WGS84,n.length&&((o=n[0])==null?void 0:o[0])!=null&&typeof n[0][0]=="number"&&(n=[n]),s=(a=n[0])==null?void 0:a[0],s&&(r===void 0&&i===void 0?(r=s.length>2,i=!1):r===void 0?r=!i&&s.length>3:i===void 0&&(i=!r&&s.length>3)),{paths:n,spatialReference:e,hasZ:r,hasM:i}}get cache(){return this.commitProperty("paths"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const{spatialReference:t}=this,e=y2e(this);if(!e)return null;const r=new ei(e);return r.spatialReference=t,r}writePaths(t,e){e.paths=_e(this.paths)}addPath(t){if(!t)return;const e=this.paths,r=e.length;if(WGe(t)){const i=[];for(let n=0,s=t.length;n<s;n++)i[n]=t[n].toArray();e[r]=i}else e[r]=t.concat();return this.notifyChange("paths"),this}clone(){const t=new VW;return t.spatialReference=this.spatialReference,t.paths=_e(this.paths),t.hasZ=this.hasZ,t.hasM=this.hasM,t}getPoint(t,e){if(!this._validateInputs(t,e))return null;const r=this.paths[t][e],i=this.hasZ,n=this.hasM;return i&&!n?new ke(r[0],r[1],r[2],void 0,this.spatialReference):n&&!i?new ke(r[0],r[1],void 0,r[2],this.spatialReference):i&&n?new ke(r[0],r[1],r[2],r[3],this.spatialReference):new ke(r[0],r[1],this.spatialReference)}insertPoint(t,e,r){return this._validateInputs(t,e,!0)?(FE(this,r),Array.isArray(r)||(r=r.toArray()),this.paths[t].splice(e,0,r),this.notifyChange("paths"),this):this}removePath(t){if(!this._validateInputs(t,null))return null;const e=this.paths.splice(t,1)[0],r=this.spatialReference,i=e.map(n=>new ke(n,r));return this.notifyChange("paths"),i}removePoint(t,e){if(!this._validateInputs(t,e))return null;const r=new ke(this.paths[t].splice(e,1)[0],this.spatialReference);return this.notifyChange("paths"),r}setPoint(t,e,r){return this._validateInputs(t,e)?(FE(this,r),Array.isArray(r)||(r=r.toArray()),this.paths[t][e]=r,this.notifyChange("paths"),this):this}_validateInputs(t,e,r=!1){if(t==null||t<0||t>=this.paths.length)return!1;if(e!=null){const i=this.paths[t];if(r&&(e<0||e>i.length)||!r&&(e<0||e>=i.length))return!1}return!0}toJSON(t){return this.write({},t)}};d([m({readOnly:!0})],b_.prototype,"cache",null),d([m({readOnly:!0})],b_.prototype,"extent",null),d([m({type:[[[Number]]],json:{write:{isRequired:!0}}})],b_.prototype,"paths",void 0),d([hr("paths")],b_.prototype,"writePaths",null),b_=VW=d([V("esri.geometry.Polyline")],b_),b_.prototype.toJSON.isDefaultToJSON=!0;const Np=b_,_2e=ac()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon"}),EFt=ac()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh"});function $p(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function Cx(t){return t.points!==void 0}function zE(t){return t.x!==void 0&&t.y!==void 0}function Ip(t){return t.paths!==void 0}function zc(t){return t.rings!==void 0}function n2(t){return t==null?null:t instanceof py?t:zE(t)?ke.fromJSON(t):Ip(t)?Np.fromJSON(t):zc(t)?nf.fromJSON(t):Cx(t)?$3.fromJSON(t):$p(t)?ei.fromJSON(t):null}function OI(t){return t?zE(t)?"esriGeometryPoint":Ip(t)?"esriGeometryPolyline":zc(t)?"esriGeometryPolygon":$p(t)?"esriGeometryEnvelope":Cx(t)?"esriGeometryMultipoint":null:null}const qGe={esriGeometryPoint:ke,esriGeometryPolyline:Np,esriGeometryPolygon:nf,esriGeometryEnvelope:ei,esriGeometryMultipoint:$3};function YGe(t){return t&&qGe[t]||null}const h9={base:py,key:"type",typeMap:{extent:ei,multipoint:$3,point:ke,polyline:Np,polygon:nf}};ig(h9);let v2e=0;const bee=t=>{let e=class extends t{constructor(...r){super(...r),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:Date.now().toString(16)+"-object-"+v2e++})}};return e=d([V("esri.core.Identifiable")],e),e},PFt=t=>{let e=class extends t{constructor(...r){super(...r),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:v2e++})}};return e=d([V("esri.core.NumericIdentifiable")],e),e};let Gae=class extends bee(class{}){};Gae=d([V("esri.core.Identifiable")],Gae);async function XGe(t){const e="portalItem"in t?t:{portalItem:t},{fromItem:r}=await ge(()=>import("./portalLayers-DI_yw6bM.js").then(i=>i.p),__vite__mapDeps([13,14,15,11]));try{return await r(e)}catch(i){const n=e&&e.portalItem,s=(n==null?void 0:n.id)||"unset",o=n&&n.portal&&n.portal.url||mi.portalUrl;throw re.getLogger("esri.layers.support.fromPortalItem").error("#fromPortalItem()","Failed to create layer from portal item (portal: '"+o+"', id: '"+s+"')",i),i}}let ZGe=0,ao=class extends Qn.EventedMixin(bee(Q0)){constructor(){super(...arguments),this.attributionDataUrl=null,this.fullExtent=new ei(-180,-90,180,90,lt.WGS84),this.id=Date.now().toString(16)+"-layer-"+ZGe++,this.legendEnabled=!0,this.listMode="show",this.opacity=1,this.parent=null,this.persistenceEnabled=!1,this.popupEnabled=!0,this.attributionVisible=!0,this.spatialReference=lt.WGS84,this.title=null,this.type=null,this.url=null,this.visible=!0}static async fromArcGISServerUrl(e){const r=typeof e=="string"?{url:e}:e;return(await ge(()=>import("./arcgisLayers-BUG19XMB.js"),__vite__mapDeps([17,14,18,15]))).fromUrl(r)}static fromPortalItem(e){return XGe(e)}initialize(){this.when().catch(e=>{_s(e)||re.getLogger(this).error("#load()",`Failed to load layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}')`,{error:e})})}destroy(){const e=this.parent;if(e){const r=this;"layers"in e&&e.layers.includes(r)?e.layers.remove(r):"tables"in e&&e.tables.includes(r)?e.tables.remove(r):"baseLayers"in e&&e.baseLayers.includes(r)?e.baseLayers.remove(r):"referenceLayers"in e&&e.referenceLayers.includes(r)&&e.referenceLayers.remove(r),this._set("parent",null)}}get hasAttributionData(){return this.attributionDataUrl!=null}get parsedUrl(){return da(this.url)}async fetchAttributionData(){const e=this.attributionDataUrl;if(this.hasAttributionData&&e)return(await Xi(e,{query:{f:"json"},responseType:"json"})).data;throw new K("layer:no-attribution-data","Layer does not have attribution data")}};d([m({type:String})],ao.prototype,"attributionDataUrl",void 0),d([m({type:ei})],ao.prototype,"fullExtent",void 0),d([m({readOnly:!0})],ao.prototype,"hasAttributionData",null),d([m({type:String,clonable:!1})],ao.prototype,"id",void 0),d([m({type:Boolean,nonNullable:!0})],ao.prototype,"legendEnabled",void 0),d([m({type:["show","hide","hide-children"]})],ao.prototype,"listMode",void 0),d([m({type:Number,range:{min:0,max:1},nonNullable:!0})],ao.prototype,"opacity",void 0),d([m({clonable:!1})],ao.prototype,"parent",void 0),d([m({readOnly:!0})],ao.prototype,"parsedUrl",null),d([m({type:Boolean,readOnly:!0})],ao.prototype,"persistenceEnabled",void 0),d([m({type:Boolean})],ao.prototype,"popupEnabled",void 0),d([m({type:Boolean})],ao.prototype,"attributionVisible",void 0),d([m({type:lt})],ao.prototype,"spatialReference",void 0),d([m({type:String})],ao.prototype,"title",void 0),d([m({readOnly:!0,json:{read:!1}})],ao.prototype,"type",void 0),d([m()],ao.prototype,"url",void 0),d([m({type:Boolean,nonNullable:!0})],ao.prototype,"visible",void 0),ao=d([V("esri.layers.Layer")],ao);const b2e=ao;function GW(t,e,r){let i,n;if(t)for(let s=0,o=t.length;s<o;s++){if(i=t.at(s),(i==null?void 0:i[e])===r)return i;if((i==null?void 0:i.type)==="group"&&(n=GW(i.layers,e,r),n))return n}}const JGe=t=>{let e=class extends t{constructor(...r){super(...r),this.layers=new $t;const i=o=>{o.parent&&"remove"in o.parent&&o.parent.remove(o)},n=o=>{o.parent=this,this.layerAdded(o),o.type!=="elevation"&&o.type!=="base-elevation"||re.getLogger(this).error(`Layer 'title:${o.title}, id:${o.id}' of type '${o.type}' is not supported as an operational layer and will therefore be ignored.`)},s=o=>{o.parent=null,this.layerRemoved(o)};this.addHandles([this.layers.on("before-add",o=>i(o.item)),this.layers.on("after-add",o=>n(o.item)),this.layers.on("after-remove",o=>s(o.item))])}destroy(){const r=this.layers.toArray();for(const i of r)i.destroy();this.layers.destroy()}set layers(r){this._set("layers",Xx(r,this._get("layers")))}add(r,i){const n=this.layers;if(i=n.getNextIndex(i),r instanceof b2e){const s=r;s.parent===this?this.reorder(s,i):n.add(s,i)}else nu(r)?r.then(s=>{this.destroyed||this.add(s,i)}):re.getLogger(this).error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(r,i){const n=this.layers;let s=n.getNextIndex(i);r.slice().forEach(o=>{o.parent!==this?(n.add(o,s),s+=1):this.reorder(o,s)})}findLayerById(r){return GW(this.layers,"id",r)}findLayerByUid(r){return GW(this.layers,"uid",r)}remove(r){return this.layers.remove(r)}removeMany(r){return this.layers.removeMany(r)}removeAll(){return this.layers.removeAll()}reorder(r,i){return this.layers.reorder(r,i)}layerAdded(r){}layerRemoved(r){}};return d([m()],e.prototype,"layers",null),e=d([V("esri.support.LayersMixin")],e),e};function jW(t,e,r){if(t)for(let i=0,n=t.length;i<n;i++){const s=t.at(i);if(s[e]===r)return s;if((s==null?void 0:s.type)==="group"){const o=jW(s.tables,e,r);if(o)return o}}}const QGe=t=>{let e=class extends t{constructor(...r){super(...r),this.tables=new $t,this.addHandles([this.tables.on("after-add",i=>{const n=i.item;n.parent&&n.parent!==this&&"tables"in n.parent&&n.parent.tables.remove(n),n.parent=this,n.type!=="feature"&&re.getLogger(this).error(`Layer 'title:${n.title}, id:${n.id}' of type '${n.type}' is not supported as a table and will therefore be ignored.`)}),this.tables.on("after-remove",i=>{i.item.parent=null})])}destroy(){const r=this.tables.toArray();for(const i of r)i.destroy();this.tables.destroy()}set tables(r){this._set("tables",Xx(r,this._get("tables")))}findTableById(r){return jW(this.tables,"id",r)}findTableByUid(r){return jW(this.tables,"uid",r)}};return d([m()],e.prototype,"tables",null),e=d([V("esri.support.TablesMixin")],e),e};let qd=class extends QGe(JGe(Qn.EventedMixin(Ae))){constructor(e){super(e),this.allLayers=new v$({getCollections:()=>{var r,i,n;return[(r=this.basemap)==null?void 0:r.baseLayers,(i=this.ground)==null?void 0:i.layers,this.layers,(n=this.basemap)==null?void 0:n.referenceLayers]},getChildrenFunction:r=>"layers"in r?r.layers:null}),this.allTables=bGe(this),this.basemap=null,this.editableLayers=new v$({getCollections:()=>[this.allLayers],itemFilterFunction:F7e}),this.ground=new s6,this._basemapCache=yGe()}destroy(){_Ge(this._basemapCache),this._basemapCache=null,this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),this.basemap=Pe(this.basemap),Pe(this.ground),this._set("ground",null)}castBasemap(e){return vGe(e,this._basemapCache)}castGround(e){return wGe(e)??this._get("ground")}findLayerById(e){return this.allLayers.find(r=>r.id===e)}findTableById(e){return this.allTables.find(r=>r.id===e)}};d([m({readOnly:!0,dependsOn:[]})],qd.prototype,"allLayers",void 0),d([m({readOnly:!0})],qd.prototype,"allTables",void 0),d([m({type:UC,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],qd.prototype,"basemap",void 0),d([ai("basemap")],qd.prototype,"castBasemap",null),d([m({readOnly:!0})],qd.prototype,"editableLayers",void 0),d([m({type:s6,nonNullable:!0})],qd.prototype,"ground",void 0),d([ai("ground")],qd.prototype,"castGround",null),d([m()],qd.prototype,"undoRedo",void 0),qd=d([V("esri.Map")],qd);const w2e=qd,nh=t=>{let e=class extends t{clone(){var l;const r=rg(this);Rz(r,"unable to clone instance of non-accessor class");const i=r.metadata,n=r.store,s={},o=new Map;for(const c in i){const u=i[c],h=n==null?void 0:n.originOf(c),p=u.clonable;if(u.readOnly||p===!1||h!==oi.USER&&h!==oi.DEFAULTS&&h!==oi.WEB_MAP&&h!==oi.WEB_SCENE)continue;const f=this[c];let g=null;g=typeof p=="function"?p(f):p==="reference"?f:GH(f),f!=null&&g==null||(h===oi.DEFAULTS?o.set(c,g):s[c]=g)}const a=new(Object.getPrototypeOf(this)).constructor(s);if(o.size){const c=(l=rg(a))==null?void 0:l.store;if(c)for(const[u,h]of o)c.set(u,h,oi.DEFAULTS)}return a}};return e=d([V("esri.core.Clonable")],e),e};let nv=class extends nh(Ae){};nv=d([V("esri.core.Clonable")],nv);let Gb=class extends nv{constructor(e){super(e),this.row=0,this.column=0,this.rows=1,this.columns=1}equals(e){return e!=null&&this.row===e.row&&this.rows===e.rows&&this.column===e.column&&this.columns===e.columns}};d([m({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],Gb.prototype,"row",void 0),d([m({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],Gb.prototype,"column",void 0),d([m({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],Gb.prototype,"rows",void 0),d([m({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],Gb.prototype,"columns",void 0),Gb=d([V("esri.CameraLayout")],Gb);const x2e=Gb;let sv=class{constructor(e,r){this.min=e,this.max=r,this.range=r-e}ndiff(e,r=0){return Math.ceil((e-r)/this.range)*this.range+r}_normalize(e,r,i,n=0,s=!1){return(i-=n)<e?i+=this.ndiff(e-i):i>r&&(i-=this.ndiff(i-r)),s&&i===r&&(i=e),i+n}normalize(e,r=0,i=!1){return this._normalize(this.min,this.max,e,r,i)}clamp(e,r=0){return we(e-r,this.min,this.max)+r}monotonic(e,r,i){return e<r?r:r+this.ndiff(e-r,i)}minimalMonotonic(e,r,i){return this._normalize(e,e+this.range,r,i)}center(e,r,i){return r=this.monotonic(e,r,i),this.normalize((e+r)/2,i)}diff(e,r,i){return this.monotonic(e,r,i)-e}shortestSignedDiff(e,r){e=this.normalize(e);const i=(r=this.normalize(r))-e,n=r<e?this.minimalMonotonic(e,r)-e:r-this.minimalMonotonic(r,e);return Math.abs(i)<Math.abs(n)?i:n}contains(e,r,i){return r=this.minimalMonotonic(e,r),(i=this.minimalMonotonic(e,i))>e&&i<r}};function wee(t){for(const e in t){const r=t[e];r instanceof Function&&(t[e]=r.bind(t))}return t}const KGe=wee(new sv(0,2*Math.PI)),ov=wee(new sv(-Math.PI,Math.PI)),xee=wee(new sv(0,360));let Zf=class extends nh(ze){constructor(...e){super(...e),this.position=new ke([0,0,0]),this.heading=0,this.tilt=0,this.fov=55,this.layout=new x2e}normalizeCtorArgs(e,r,i,n){if(e&&typeof e=="object"&&("x"in e||Array.isArray(e))){const s={position:e};return r!=null&&(s.heading=r),i!=null&&(s.tilt=i),n!=null&&(s.fov=n),s}return e}writePosition(e,r,i,n){const s=e.clone();s.x=Ep(e.x||0),s.y=Ep(e.y||0),s.z=e.hasZ?Ep(e.z||0):e.z,r[i]=s.write({},n)}readPosition(e,r){const i=new ke;return i.read(e,r),i.x=Ep(i.x||0),i.y=Ep(i.y||0),i.z=i.hasZ?Ep(i.z||0):i.z,i}equals(e){return e!=null&&this.tilt===e.tilt&&this.heading===e.heading&&this.fov===e.fov&&this.position.equals(e.position)&&this.layout.equals(e.layout)}};d([m({type:ke,json:{write:{isRequired:!0}}})],Zf.prototype,"position",void 0),d([hr("position")],Zf.prototype,"writePosition",null),d([Tr("position")],Zf.prototype,"readPosition",null),d([m({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),ai(t=>xee.normalize(Ep(t)))],Zf.prototype,"heading",void 0),d([m({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),ai(t=>we(Ep(t),-180,180))],Zf.prototype,"tilt",void 0),d([m({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],Zf.prototype,"fov",void 0),d([m({type:x2e,nonNullable:!0,json:{read:!1,write:!1}})],Zf.prototype,"layout",void 0),Zf=d([V("esri.Camera")],Zf);const eu=Zf;var HW;let w_=HW=class extends ze{constructor(t){super(t),this.rotation=0,this.scale=0,this.targetGeometry=null,this.camera=null}castRotation(t){return(t%=360)<0&&(t+=360),t}clone(){return new HW({rotation:this.rotation,scale:this.scale,targetGeometry:this.targetGeometry!=null?this.targetGeometry.clone():null,camera:this.camera!=null?this.camera.clone():null})}};function QB(){return{enabled:!this.camera}}d([m({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:QB}}}}})],w_.prototype,"rotation",void 0),d([ai("rotation")],w_.prototype,"castRotation",null),d([m({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:QB}}}}})],w_.prototype,"scale",void 0),d([m({types:h9,json:{read:n2,write:!0,origins:{"web-scene":{read:n2,write:{overridePolicy:QB}}}}})],w_.prototype,"targetGeometry",void 0),d([m({type:eu,json:{write:!0}})],w_.prototype,"camera",void 0),w_=HW=d([V("esri.Viewpoint")],w_);const sf=w_;function d9(t){return typeof t=="string"?document.getElementById(t):t??null}function T2e(t){for(;t.hasChildNodes();)t.removeChild(t.firstChild)}function jae(t,e){const r=e.parentNode;r&&r.insertBefore(t,e)}function Hae(t,e){for(;;){const r=t.firstChild;if(!r)break;e.appendChild(r)}}function he(t,e,r={}){return Tee(t,e,r,S2e)}function fd(t,e,r={}){return Tee(t,e,r,C2e)}function Tee(t,e,r={},i){let n=null;const s=r.once?(o,a)=>{i(o)&&(wi(n),e(o,a))}:(o,a)=>{i(o)&&e(o,a)};if(n=I9e(t,s,r.sync,r.equals),r.initial){const o=t();s(o,o)}return n}function Vo(t,e,r,i={}){let n=null,s=null,o=null;function a(){var u;n&&s&&(s.remove(),(u=i.onListenerRemove)==null||u.call(i,n),n=null,s=null)}function l(u){i.once&&i.once&&wi(o),r(u)}const c=he(t,(u,h)=>{var p;a(),Iz(u)&&(n=u,s=A3(u,e,l),(p=i.onListenerAdd)==null||p.call(i,u))},{sync:i.sync,initial:!0});return o=Zr(()=>{c.remove(),a()}),o}function UE(t,e){return eje(t,C2e,e)}function eje(t,e,r){if(Ls(r))return Promise.reject(dr());const i=t();if(e!=null&&e(i))return Promise.resolve(i);let n=null;function s(){n=wi(n)}return new Promise((o,a)=>{n=Hx([ca(r,()=>{s(),a(dr())}),Tee(t,l=>{s(),o(l)},{sync:!1,once:!0},e??S2e)])})}function S2e(t){return!0}function C2e(t){return!!t}function tje(t,e){const r=new $t,i=Vo(t,"after-splice",({added:n,start:s,deleteCount:o})=>{const a=r.splice(s,o);for(const l of a)l.remove();if(n!=null&&n.length){const l=n.map(e);r.addMany(l,s)}},{sync:!0,onListenerRemove:()=>r.drain(n=>n.remove()),onListenerAdd:n=>r.addMany(n.items.map(e))});return r.addHandles(i),r}function DFt(t,e){const r=new $t,i=tje(t,a=>dy(async l=>{const c=await e(a,l);if(Ls(l))throw c.remove(),dr();return c})),n=()=>null,s=async a=>{const l=await a.promise,c=i.indexOf(a);c<0||r.splice(c,1,l)};r.addMany(i.items.map(n));for(const a of i)r$(s(a));const o=i.on("after-splice",({added:a,start:l,deleteCount:c})=>{const u=r.splice(l,c);for(const h of u)h==null||h.remove();if(a!=null&&a.length){r.addMany(a.map(n),l);for(const h of a)r$(s(h))}});return r.addHandles([xbe(i),o]),r}const Qr={sync:!0},gi={initial:!0},Kr={sync:!0,initial:!0};let l6=class{constructor(e=r=>r.values().next().value){this._peeker=e,this._observable=new EI,this._items=new Set}get length(){return Lt(this._observable),this._items.size}clear(){this.length!==0&&(this._items.clear(),this._observable.notify())}last(){if(this.length===0)return;let e;for(e of this._items);return e}peek(){if(this.length!==0)return this._peeker(this._items)}push(e){this.contains(e)||(this._items.add(e),this._observable.notify())}contains(e){return Lt(this._observable),this._items.has(e)}pop(){if(this.length===0)return;const e=this.peek();return this._items.delete(e),this._observable.notify(),e}popLast(){if(this.length===0)return;const e=this.last();return this._items.delete(e),this._observable.notify(),e}remove(e){this.contains(e)&&(this._items.delete(e),this._observable.notify())}filter(e){const r=this.length;return this._items.forEach(i=>{e(i)||this._items.delete(i)}),r!==this._items.size&&this._observable.notify(),this}*[Symbol.iterator](){Lt(this._observable),yield*this._items}};const E2e=new FinalizationRegistry(t=>{t.close()});function rje(t,e){E2e.register(t,e,e)}function ije(t){E2e.unregister(t)}function P2e(t,e){return new Proxy({},{get:(r,i,n)=>(...s)=>{let o,a;const l=s[s.length-1];return nje(l)&&(o=l.signal,a=l.transferList,s.pop()),t.apply(e?`${e}.${i.toString()}`:i.toString(),s,{transferList:a,signal:o})}})}function nje(t){return typeof t=="object"&&!Array.isArray(t)&&t!=null&&("signal"in t||"transferList"in t||Object.keys(t).length===0)}const sje={statsWorker:()=>ge(()=>import("./statsWorker-Dea2Zhor.js"),__vite__mapDeps([19,20,21,22,23,24])),geometryEngineWorker:()=>ge(()=>import("./geometryEngineWorker-BikrlNW5.js"),__vite__mapDeps([25,26,27,28])),CSVSourceWorker:()=>ge(()=>import("./CSVSourceWorker-DurlFq09.js"),__vite__mapDeps([29,30,28,31,32,33,34,35,36,37,38,39,20,21,22,23,24,40,41,42,43])),EdgeProcessingWorker:()=>ge(()=>import("./EdgeProcessingWorker-N3oiQNlE.js"),__vite__mapDeps([])),ElevationSamplerWorker:()=>ge(()=>import("./ElevationSamplerWorker-CekdSq-_.js"),__vite__mapDeps([44,33,34])),FeatureServiceSnappingSourceWorker:()=>ge(()=>import("./FeatureServiceSnappingSourceWorker-CSFFIKcE.js"),__vite__mapDeps([45,31,32,33,34,35,36,37,38,28,39,20,21,22,23,24,40,41,46,47,48,49,50])),GeoJSONSourceWorker:()=>ge(()=>import("./GeoJSONSourceWorker-DblEb6od.js"),__vite__mapDeps([51,31,32,33,34,35,36,37,38,28,39,20,21,22,23,24,40,41,52,30,43,53])),LercWorker:()=>ge(()=>import("./LercWorker-DtCZf1S_.js"),__vite__mapDeps([])),MemorySourceWorker:()=>ge(()=>import("./MemorySourceWorker-D3ymhpCp.js"),__vite__mapDeps([54,55,31,32,33,34,35,36,37,38,28,39,20,21,22,23,24,40,41,43,53,30])),PBFDecoderWorker:()=>ge(()=>import("./PBFDecoderWorker-C6EZfdWz.js"),__vite__mapDeps([56,47,48])),FeaturePipelineWorker:()=>ge(()=>import("./FeaturePipelineWorker-BCPnu1XD.js"),__vite__mapDeps([57,58,59,60,61,62,35,36,37,38,28,39,20,21,22,23,24,40,41,34,49,47,48,50,63,52,30,43,53,64,65])),PointCloudWorker:()=>ge(()=>import("./PointCloudWorker-CHSwgkTf.js"),__vite__mapDeps([66,67,68,69])),RasterWorker:()=>ge(()=>import("./RasterWorker-By1CZxzv.js"),__vite__mapDeps([70,71,72,73])),SceneLayerSnappingSourceWorker:()=>ge(()=>import("./SceneLayerSnappingSourceWorker-CRbpFpGC.js"),__vite__mapDeps([])),SceneLayerWorker:()=>ge(()=>import("./SceneLayerWorker-DtoiTn-Z.js").then(t=>t.S),__vite__mapDeps([74,75,76,69])),WFSSourceWorker:()=>ge(()=>import("./WFSSourceWorker-Ce6r7QoY.js"),__vite__mapDeps([77,31,32,33,34,35,36,37,38,28,39,20,21,22,23,24,40,41,52,30,53,78,79])),WorkerTileHandler:()=>ge(()=>import("./WorkerTileHandler-Bh3X65lw.js"),__vite__mapDeps([80,61,48,59,81])),Lyr3DWorker:()=>ge(()=>import("./Lyr3DWorker-CGcjlDJZ.js"),__vite__mapDeps([82,83,84]))};var na;(function(t){t[t.HANDSHAKE=0]="HANDSHAKE",t[t.OPEN=1]="OPEN",t[t.OPENED=2]="OPENED",t[t.RESPONSE=3]="RESPONSE",t[t.INVOKE=4]="INVOKE",t[t.ABORT=5]="ABORT",t[t.CLOSE=6]="CLOSE",t[t.OPEN_PORT=7]="OPEN_PORT",t[t.ON=8]="ON"})(na||(na={}));let oje=0;function A2e(){return oje++}function aje(t){return t&&typeof t=="object"&&("result"in t||"transferList"in t)}function b$(t){return t?typeof t=="string"?JSON.stringify({name:"message",message:t}):t.toJSON?JSON.stringify(t):JSON.stringify({name:t.name,message:t.message,details:t.details||{stack:t.stack}}):null}function See(t,e,r,i){if(e.type===na.OPEN_PORT)return void t.postMessage(e,[e.port]);if(e.type!==na.INVOKE&&e.type!==na.RESPONSE)return void t.postMessage(e);let n;if(aje(r)?(n=Wae(r.transferList),e.data=r.result):(n=Wae(i),e.data=r),n){if(se("ff")){for(const s of n)if("byteLength"in s&&s.byteLength>267386880){const o="Worker call with large ArrayBuffer would crash Firefox";switch(e.type){case na.INVOKE:throw o;case na.RESPONSE:return void See(t,{type:na.RESPONSE,jobId:e.jobId,error:b$(o)})}}}t.postMessage(e,n)}else t.postMessage(e)}function w$(t){if(!t)return null;const e=t.data;return e?typeof e=="string"?JSON.parse(e):e:null}function Wae(t){if(!(t!=null&&t.length))return null;if(se("esri-workers-arraybuffer-transfer"))return t;const e=t.filter(r=>!lje(r));return e.length?e:null}function lje(t){var e;return t instanceof ArrayBuffer||((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="ArrayBuffer"}const{CLOSE:qae,ABORT:Yae,INVOKE:Xae,RESPONSE:vP,OPEN_PORT:Zae,ON:cje}=na,uje=2;let hje=class{constructor(e){this._timer=null,this._cancelledJobIds=new Set,this._invokeMessages=[],this._invoke=e,this._timer=null,this._process=this._process.bind(this)}push(e){e.type===na.ABORT?this._cancelledJobIds.add(e.jobId):(this._invokeMessages.push(e),this._timer===null&&(this._timer=setTimeout(this._process,0)))}clear(){this._invokeMessages.length=0,this._cancelledJobIds.clear(),this._timer=null}_process(){this._timer=null;for(const e of this._invokeMessages)this._cancelledJobIds.has(e.jobId)||this._invoke(e);this._cancelledJobIds.clear(),this._invokeMessages.length=0}},av=class oS{static connect(e){const r=new MessageChannel;let i;i=typeof e=="function"?new e:"default"in e&&typeof e.default=="function"?new e.default:e;const n=new oS(r.port1,{channel:r,client:i});return typeof i=="object"&&"remoteClient"in i&&(i.remoteClient=n),oS.clients.set(n,i),r.port2}static loadWorker(e){const r=sje[e];return r?r():Promise.resolve(null)}constructor(e,r,i){this._port=e,this._jobQueue=i,this._outJobs=new Map,this._inJobs=new Map,this._invokeQueue=new hje(n=>this._onInvokeMessage(n)),this._client=r.client,this._onMessage=this._onMessage.bind(this),this._channel=r.channel,this._schedule=r.schedule,this._port.addEventListener("message",this._onMessage),this._port.start()}close(){this._post({type:qae}),this._close()}isBusy(){return this._outJobs.size>0}invoke(e,r,i){return this.apply(e,[r],i)}apply(e,r,i){const n=i==null?void 0:i.signal,s=i==null?void 0:i.transferList;if(!this._port)return Promise.reject(new K("worker:port-closed",`Cannot call invoke('${e}'), port is closed`,{methodName:e,data:r}));const o=A2e();return new Promise((a,l)=>{if(Ls(n))return this._processWork(),void l(dr());const c=ca(n,()=>{const h=this._outJobs.get(o);h&&(this._outJobs.delete(o),this._processWork(),wi(h.abortHandle),this._post({type:Yae,jobId:o}),l(dr()))}),u={resolve:a,reject:l,abortHandle:c,debugInfo:e};this._outJobs.set(o,u),this._post({type:Xae,jobId:o,methodName:e,abortable:n!=null},r,s)})}createInvokeProxy(e){return P2e(this,e)}on(e,r){const i=new MessageChannel;function n(s){r(s.data)}return this._port.postMessage({type:na.ON,eventType:e,port:i.port2},[i.port2]),i.port1.addEventListener("message",n),i.port1.start(),Zr(()=>{i.port1.postMessage({type:na.CLOSE}),i.port1.close(),i.port1.removeEventListener("message",n)})}jobAdded(){this._processWork()}openPort(){const e=new MessageChannel;return this._post({type:Zae,port:e.port2}),e.port1}_processWork(){var o;if(this._outJobs.size>=uje)return;const e=(o=this._jobQueue)==null?void 0:o.pop();if(!e)return;const{methodName:r,data:i,invokeOptions:n,resolver:s}=e;this.apply(r,i,n).then(a=>s.resolve(a)).catch(a=>s.reject(a))}_close(){this._channel&&(this._channel=void 0),this._port.removeEventListener("message",this._onMessage),this._port.close(),this._outJobs.forEach(e=>{wi(e.abortHandle),e.reject(dr(`Worker closing, aborting job calling '${e.debugInfo}'`))}),this._inJobs.clear(),this._outJobs.clear(),this._invokeQueue.clear(),this._port=null,this._client=null,this._schedule=null}_onMessage(e){this._schedule!=null?this._schedule(()=>this._processMessage(e)):this._processMessage(e)}_processMessage(e){const r=w$(e);if(r)switch(r.type){case vP:this._onResponseMessage(r);break;case Xae:this._invokeQueue.push(r);break;case Yae:this._onAbortMessage(r);break;case qae:this._onCloseMessage();break;case Zae:this._onOpenPortMessage(r);break;case cje:this._onOnMessage(r)}}_onAbortMessage(e){const r=this._inJobs,i=e.jobId,n=r.get(i);this._invokeQueue.push(e),n&&(n.controller&&n.controller.abort(),r.delete(i))}_onCloseMessage(){const e=this._client;this._close(),e&&"destroy"in e&&oS.clients.get(this)===e&&e.destroy(),oS.clients.delete(this),e!=null&&e.remoteClient&&(e.remoteClient=null)}_onInvokeMessage(e){const{methodName:r,jobId:i,data:n=[],abortable:s}=e,o=s?new AbortController:null,a=this._inJobs;let l,c=this._client,u=c[r];try{if(!u&&r&&r.includes(".")){const h=r.split(".");for(let p=0;p<h.length-1;p++)c=c[h[p]],u=c[h[p+1]]}if(typeof u!="function")throw new TypeError(`${r} is not a function`);n.push({client:this,signal:o?o.signal:null}),l=u.apply(c,n)}catch(h){return void this._post({type:vP,jobId:i,error:b$(h)})}nu(l)?(a.set(i,{controller:o,promise:l}),l.then(h=>{a.has(i)&&(a.delete(i),this._post({type:vP,jobId:i},h))},h=>{a.has(i)&&(a.delete(i),_s(h)||this._post({type:vP,jobId:i,error:b$(h||{message:`Error encountered at method ${r}`})}))})):this._post({type:vP,jobId:i},l)}_onOpenPortMessage(e){new oS(e.port,{client:this._client})}_onOnMessage(e){const{port:r}=e,i=this._client.on(e.eventType,s=>{r.postMessage(s)}),n=A3(e.port,"message",s=>{const o=w$(s);(o==null?void 0:o.type)===na.CLOSE&&(n.remove(),i.remove(),r.close())})}_onResponseMessage(e){const{jobId:r,error:i,data:n}=e,s=this._outJobs;if(!s.has(r))return;const o=s.get(r);s.delete(r),this._processWork(),wi(o.abortHandle),i?o.reject(K.fromJSON(JSON.parse(i))):o.resolve(n)}_post(e,r,i){return See(this._port,e,r,i)}};av.kernelInfo={buildDate:Cwe,fullVersion:HK,revision:Ewe},av.clients=new Map;let dje=class{constructor(){this._inUseClients=new Array,this._clients=new Array,this._clientPromises=new Array,this._ongoingJobsQueue=new l6}destroy(){this.close()}get closed(){var e;return!((e=this._clients)!=null&&e.length)}open(e,r){return new Promise((i,n)=>{let s=!0;const o=a=>{vt(r.signal),s&&(s=!1,a())};this._clients.length=e.length,this._clientPromises.length=e.length,this._inUseClients.length=e.length;for(let a=0;a<e.length;++a){const l=e[a];nu(l)?this._clientPromises[a]=l.then(c=>(this._clients[a]=new av(c,r,this._ongoingJobsQueue),o(i),this._clients[a]),()=>(o(n),null)):(this._clients[a]=new av(l,r,this._ongoingJobsQueue),this._clientPromises[a]=Promise.resolve(this._clients[a]),o(i))}})}broadcast(e,r,i){const n=new Array(this._clientPromises.length);for(let s=0;s<this._clientPromises.length;++s){const o=this._clientPromises[s];n[s]=o.then(a=>a==null?void 0:a.invoke(e,r,i))}return n}close(){let e;for(;e=this._ongoingJobsQueue.pop();)e.resolver.reject(dr(`Worker closing, aborting job calling '${e.methodName}'`));for(const r of this._clientPromises)r.then(i=>i==null?void 0:i.close());this._clients.length=0,this._clientPromises.length=0,this._inUseClients.length=0,ije(this)}invoke(e,r,i){return this.apply(e,[r],i)}apply(e,r,i){const n=ha();this._ongoingJobsQueue.push({methodName:e,data:r,invokeOptions:i,resolver:n});for(let s=0;s<this._clientPromises.length;s++){const o=this._clients[s];o?o.jobAdded():this._clientPromises[s].then(a=>a==null?void 0:a.jobAdded())}return n.promise}createInvokeProxy(e){return P2e(this,e)}on(e,r){return Promise.all(this._clientPromises).then(()=>Hx(this._clients.map(i=>i.on(e,r))))}openPorts(){return new Promise(e=>{const r=new Array(this._clientPromises.length);let i=r.length;for(let n=0;n<this._clientPromises.length;++n)this._clientPromises[n].then(s=>{s&&(r[n]=s.openPort()),--i==0&&e(r)})})}get test(){return{numClients:this._clients.length}}};const pje={async request(t,e){var o,a;const r=t.options,i=r.responseType;r.signal=e==null?void 0:e.signal,r.responseType=i==="native"||i==="native-request-init"?"native-request-init":i&&["blob","json","text"].includes(i)&&((o=vwe(t.url))!=null&&o.after)?i:"array-buffer";const n=await Xi(t.url,r),s={data:n.data,httpStatus:n.httpStatus,ssl:n.ssl};switch((a=n.requestOptions)==null?void 0:a.responseType){case"native-request-init":return delete s.data.signal,s;case"blob":s.data=await s.data.arrayBuffer();break;case"json":s.data=new TextEncoder().encode(JSON.stringify(s.data)).buffer;break;case"text":s.data=new TextEncoder().encode(s.data).buffer}return{result:s,transferList:[s.data]}}},Jae=new Map([["AUS Central Standard Time","Australia/Darwin"],["AUS Eastern Standard Time","Australia/Sydney"],["Afghanistan Standard Time","Asia/Kabul"],["Alaskan Standard Time","America/Anchorage"],["Aleutian Standard Time","America/Adak"],["Altai Standard Time","Asia/Barnaul"],["Arab Standard Time","Asia/Riyadh"],["Arabian Standard Time","Asia/Dubai"],["Arabic Standard Time","Asia/Baghdad"],["Argentina Standard Time","America/Buenos_Aires"],["Astrakhan Standard Time","Europe/Astrakhan"],["Atlantic Standard Time","America/Halifax"],["Aus Central W. Standard Time","Australia/Eucla"],["Azerbaijan Standard Time","Asia/Baku"],["Azores Standard Time","Atlantic/Azores"],["Bahia Standard Time","America/Bahia"],["Bangladesh Standard Time","Asia/Dhaka"],["Belarus Standard Time","Europe/Minsk"],["Bougainville Standard Time","Pacific/Bougainville"],["Canada Central Standard Time","America/Regina"],["Cape Verde Standard Time","Atlantic/Cape_Verde"],["Caucasus Standard Time","Asia/Yerevan"],["Cen. Australia Standard Time","Australia/Adelaide"],["Central America Standard Time","America/Guatemala"],["Central Asia Standard Time","Asia/Almaty"],["Central Brazilian Standard Time","America/Cuiaba"],["Central Europe Standard Time","Europe/Budapest"],["Central European Standard Time","Europe/Warsaw"],["Central Pacific Standard Time","Pacific/Guadalcanal"],["Central Standard Time","America/Chicago"],["Central Standard Time (Mexico)","America/Mexico_City"],["Chatham Islands Standard Time","Pacific/Chatham"],["China Standard Time","Asia/Shanghai"],["Cuba Standard Time","America/Havana"],["Dateline Standard Time","Etc/GMT+12"],["E. Africa Standard Time","Africa/Nairobi"],["E. Australia Standard Time","Australia/Brisbane"],["E. Europe Standard Time","Europe/Chisinau"],["E. South America Standard Time","America/Sao_Paulo"],["Easter Island Standard Time","Pacific/Easter"],["Eastern Standard Time","America/New_York"],["Eastern Standard Time (Mexico)","America/Cancun"],["Egypt Standard Time","Africa/Cairo"],["Ekaterinburg Standard Time","Asia/Yekaterinburg"],["FLE Standard Time","Europe/Kiev"],["Fiji Standard Time","Pacific/Fiji"],["GMT Standard Time","Europe/London"],["GTB Standard Time","Europe/Bucharest"],["Georgian Standard Time","Asia/Tbilisi"],["Greenland Standard Time","America/Godthab"],["Greenwich Standard Time","Atlantic/Reykjavik"],["Haiti Standard Time","America/Port-au-Prince"],["Hawaiian Standard Time","Pacific/Honolulu"],["India Standard Time","Asia/Calcutta"],["Iran Standard Time","Asia/Tehran"],["Israel Standard Time","Asia/Jerusalem"],["Jordan Standard Time","Asia/Amman"],["Kaliningrad Standard Time","Europe/Kaliningrad"],["Korea Standard Time","Asia/Seoul"],["Libya Standard Time","Africa/Tripoli"],["Line Islands Standard Time","Pacific/Kiritimati"],["Lord Howe Standard Time","Australia/Lord_Howe"],["Magadan Standard Time","Asia/Magadan"],["Magallanes Standard Time","America/Punta_Arenas"],["Marquesas Standard Time","Pacific/Marquesas"],["Mauritius Standard Time","Indian/Mauritius"],["Middle East Standard Time","Asia/Beirut"],["Montevideo Standard Time","America/Montevideo"],["Morocco Standard Time","Africa/Casablanca"],["Mountain Standard Time","America/Denver"],["Mountain Standard Time (Mexico)","America/Mazatlan"],["Myanmar Standard Time","Asia/Rangoon"],["N. Central Asia Standard Time","Asia/Novosibirsk"],["Namibia Standard Time","Africa/Windhoek"],["Nepal Standard Time","Asia/Katmandu"],["New Zealand Standard Time","Pacific/Auckland"],["Newfoundland Standard Time","America/St_Johns"],["Norfolk Standard Time","Pacific/Norfolk"],["North Asia East Standard Time","Asia/Irkutsk"],["North Asia Standard Time","Asia/Krasnoyarsk"],["North Korea Standard Time","Asia/Pyongyang"],["Omsk Standard Time","Asia/Omsk"],["Pacific SA Standard Time","America/Santiago"],["Pacific Standard Time","America/Los_Angeles"],["Pacific Standard Time (Mexico)","America/Tijuana"],["Pakistan Standard Time","Asia/Karachi"],["Paraguay Standard Time","America/Asuncion"],["Qyzylorda Standard Time","Asia/Qyzylorda"],["Romance Standard Time","Europe/Paris"],["Russia Time Zone 10","Asia/Srednekolymsk"],["Russia Time Zone 11","Asia/Kamchatka"],["Russia Time Zone 3","Europe/Samara"],["Russian Standard Time","Europe/Moscow"],["SA Eastern Standard Time","America/Cayenne"],["SA Pacific Standard Time","America/Bogota"],["SA Western Standard Time","America/La_Paz"],["SE Asia Standard Time","Asia/Bangkok"],["Saint Pierre Standard Time","America/Miquelon"],["Sakhalin Standard Time","Asia/Sakhalin"],["Samoa Standard Time","Pacific/Apia"],["Sao Tome Standard Time","Africa/Sao_Tome"],["Saratov Standard Time","Europe/Saratov"],["Singapore Standard Time","Asia/Singapore"],["South Africa Standard Time","Africa/Johannesburg"],["South Sudan Standard Time","Africa/Juba"],["Sri Lanka Standard Time","Asia/Colombo"],["Sudan Standard Time","Africa/Khartoum"],["Syria Standard Time","Asia/Damascus"],["Taipei Standard Time","Asia/Taipei"],["Tasmania Standard Time","Australia/Hobart"],["Tocantins Standard Time","America/Araguaina"],["Tokyo Standard Time","Asia/Tokyo"],["Tomsk Standard Time","Asia/Tomsk"],["Tonga Standard Time","Pacific/Tongatapu"],["Transbaikal Standard Time","Asia/Chita"],["Turkey Standard Time","Europe/Istanbul"],["Turks And Caicos Standard Time","America/Grand_Turk"],["US Eastern Standard Time","America/Indianapolis"],["US Mountain Standard Time","America/Phoenix"],["UTC","Etc/GMT"],["UTC+01","Etc/GMT-1"],["UTC+02","Etc/GMT-2"],["UTC+03","Etc/GMT-3"],["UTC+04","Etc/GMT-4"],["UTC+05","Etc/GMT-5"],["UTC+06","Etc/GMT-6"],["UTC+07","Etc/GMT-7"],["UTC+08","Etc/GMT-8"],["UTC+09","Etc/GMT-9"],["UTC+10","Etc/GMT-10"],["UTC+11","Etc/GMT-11"],["UTC+12","Etc/GMT-12"],["UTC+13","Etc/GMT-13"],["UTC+14","Etc/GMT-14"],["UTC-01","Etc/GMT+1"],["UTC-02","Etc/GMT+2"],["UTC-03","Etc/GMT+3"],["UTC-04","Etc/GMT+4"],["UTC-05","Etc/GMT+5"],["UTC-06","Etc/GMT+6"],["UTC-07","Etc/GMT+7"],["UTC-08","Etc/GMT+8"],["UTC-09","Etc/GMT+9"],["UTC-10","Etc/GMT+10"],["UTC-11","Etc/GMT+11"],["UTC-12","Etc/GMT+12"],["Ulaanbaatar Standard Time","Asia/Ulaanbaatar"],["Venezuela Standard Time","America/Caracas"],["Vladivostok Standard Time","Asia/Vladivostok"],["Volgograd Standard Time","Europe/Volgograd"],["W. Australia Standard Time","Australia/Perth"],["W. Central Africa Standard Time","Africa/Lagos"],["W. Europe Standard Time","Europe/Berlin"],["W. Mongolia Standard Time","Asia/Hovd"],["West Asia Standard Time","Asia/Tashkent"],["West Bank Standard Time","Asia/Hebron"],["West Pacific Standard Time","Pacific/Port_Moresby"],["Yakutsk Standard Time","Asia/Yakutsk"],["Yukon Standard Time","America/Whitehorse"]]);class A2 extends Error{}class fje extends A2{constructor(e){super(`Invalid DateTime: ${e.toMessage()}`)}}class mje extends A2{constructor(e){super(`Invalid Interval: ${e.toMessage()}`)}}class gje extends A2{constructor(e){super(`Invalid Duration: ${e.toMessage()}`)}}class iC extends A2{}class M2e extends A2{constructor(e){super(`Invalid unit ${e}`)}}class Nc extends A2{}class ky extends A2{constructor(){super("Zone is an abstract class")}}const rt="numeric",of="short",Wu="long",c6={year:rt,month:rt,day:rt},O2e={year:rt,month:of,day:rt},yje={year:rt,month:of,day:rt,weekday:of},R2e={year:rt,month:Wu,day:rt},$2e={year:rt,month:Wu,day:rt,weekday:Wu},I2e={hour:rt,minute:rt},L2e={hour:rt,minute:rt,second:rt},D2e={hour:rt,minute:rt,second:rt,timeZoneName:of},N2e={hour:rt,minute:rt,second:rt,timeZoneName:Wu},F2e={hour:rt,minute:rt,hourCycle:"h23"},k2e={hour:rt,minute:rt,second:rt,hourCycle:"h23"},z2e={hour:rt,minute:rt,second:rt,hourCycle:"h23",timeZoneName:of},U2e={hour:rt,minute:rt,second:rt,hourCycle:"h23",timeZoneName:Wu},B2e={year:rt,month:rt,day:rt,hour:rt,minute:rt},V2e={year:rt,month:rt,day:rt,hour:rt,minute:rt,second:rt},G2e={year:rt,month:of,day:rt,hour:rt,minute:rt},j2e={year:rt,month:of,day:rt,hour:rt,minute:rt,second:rt},_je={year:rt,month:of,day:rt,weekday:of,hour:rt,minute:rt},H2e={year:rt,month:Wu,day:rt,hour:rt,minute:rt,timeZoneName:of},W2e={year:rt,month:Wu,day:rt,hour:rt,minute:rt,second:rt,timeZoneName:of},q2e={year:rt,month:Wu,day:rt,weekday:Wu,hour:rt,minute:rt,timeZoneName:Wu},Y2e={year:rt,month:Wu,day:rt,weekday:Wu,hour:rt,minute:rt,second:rt,timeZoneName:Wu};class RI{get type(){throw new ky}get name(){throw new ky}get ianaName(){return this.name}get isUniversal(){throw new ky}offsetName(e,r){throw new ky}formatOffset(e,r){throw new ky}offset(e){throw new ky}equals(e){throw new ky}get isValid(){throw new ky}}let KB=null;class p9 extends RI{static get instance(){return KB===null&&(KB=new p9),KB}get type(){return"system"}get name(){return new Intl.DateTimeFormat().resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(e,{format:r,locale:i}){return iTe(e,r,i)}formatOffset(e,r){return qO(this.offset(e),r)}offset(e){return-new Date(e).getTimezoneOffset()}equals(e){return e.type==="system"}get isValid(){return!0}}let m5={};function vje(t){return m5[t]||(m5[t]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:t,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"})),m5[t]}const bje={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};function wje(t,e){const r=t.format(e).replace(/\u200E/g,""),i=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(r),[,n,s,o,a,l,c,u]=i;return[o,n,s,a,l,c,u]}function xje(t,e){const r=t.formatToParts(e),i=[];for(let n=0;n<r.length;n++){const{type:s,value:o}=r[n],a=bje[s];s==="era"?i[a]=o:yr(a)||(i[a]=parseInt(o,10))}return i}let KL={};class af extends RI{static create(e){return KL[e]||(KL[e]=new af(e)),KL[e]}static resetCache(){KL={},m5={}}static isValidSpecifier(e){return this.isValidZone(e)}static isValidZone(e){if(!e)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:e}).format(),!0}catch{return!1}}constructor(e){super(),this.zoneName=e,this.valid=af.isValidZone(e)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(e,{format:r,locale:i}){return iTe(e,r,i,this.name)}formatOffset(e,r){return qO(this.offset(e),r)}offset(e){const r=new Date(e);if(isNaN(r))return NaN;const i=vje(this.name);let[n,s,o,a,l,c,u]=i.formatToParts?xje(i,r):wje(i,r);a==="BC"&&(n=-Math.abs(n)+1);const p=m9({year:n,month:s,day:o,hour:l===24?0:l,minute:c,second:u,millisecond:0});let f=+r;const g=f%1e3;return f-=g>=0?g:1e3+g,(p-f)/(60*1e3)}equals(e){return e.type==="iana"&&e.name===this.name}get isValid(){return this.valid}}let Qae={};function Tje(t,e={}){const r=JSON.stringify([t,e]);let i=Qae[r];return i||(i=new Intl.ListFormat(t,e),Qae[r]=i),i}let WW={};function qW(t,e={}){const r=JSON.stringify([t,e]);let i=WW[r];return i||(i=new Intl.DateTimeFormat(t,e),WW[r]=i),i}let YW={};function Sje(t,e={}){const r=JSON.stringify([t,e]);let i=YW[r];return i||(i=new Intl.NumberFormat(t,e),YW[r]=i),i}let XW={};function Cje(t,e={}){const{base:r,...i}=e,n=JSON.stringify([t,i]);let s=XW[n];return s||(s=new Intl.RelativeTimeFormat(t,e),XW[n]=s),s}let FA=null;function Eje(){return FA||(FA=new Intl.DateTimeFormat().resolvedOptions().locale,FA)}let Kae={};function Pje(t){let e=Kae[t];if(!e){const r=new Intl.Locale(t);e="getWeekInfo"in r?r.getWeekInfo():r.weekInfo,Kae[t]=e}return e}function Aje(t){const e=t.indexOf("-x-");e!==-1&&(t=t.substring(0,e));const r=t.indexOf("-u-");if(r===-1)return[t];{let i,n;try{i=qW(t).resolvedOptions(),n=t}catch{const l=t.substring(0,r);i=qW(l).resolvedOptions(),n=l}const{numberingSystem:s,calendar:o}=i;return[n,s,o]}}function Mje(t,e,r){return(r||e)&&(t.includes("-u-")||(t+="-u"),r&&(t+=`-ca-${r}`),e&&(t+=`-nu-${e}`)),t}function Oje(t){const e=[];for(let r=1;r<=12;r++){const i=er.utc(2009,r,1);e.push(t(i))}return e}function Rje(t){const e=[];for(let r=1;r<=7;r++){const i=er.utc(2016,11,13+r);e.push(t(i))}return e}function eD(t,e,r,i){const n=t.listingMode();return n==="error"?null:n==="en"?r(e):i(e)}function $je(t){return t.numberingSystem&&t.numberingSystem!=="latn"?!1:t.numberingSystem==="latn"||!t.locale||t.locale.startsWith("en")||new Intl.DateTimeFormat(t.intl).resolvedOptions().numberingSystem==="latn"}class Ije{constructor(e,r,i){this.padTo=i.padTo||0,this.floor=i.floor||!1;const{padTo:n,floor:s,...o}=i;if(!r||Object.keys(o).length>0){const a={useGrouping:!1,...i};i.padTo>0&&(a.minimumIntegerDigits=i.padTo),this.inf=Sje(e,a)}}format(e){if(this.inf){const r=this.floor?Math.floor(e):e;return this.inf.format(r)}else{const r=this.floor?Math.floor(e):Aee(e,3);return _o(r,this.padTo)}}}class Lje{constructor(e,r,i){this.opts=i,this.originalZone=void 0;let n;if(this.opts.timeZone)this.dt=e;else if(e.zone.type==="fixed"){const o=-1*(e.offset/60),a=o>=0?`Etc/GMT+${o}`:`Etc/GMT${o}`;e.offset!==0&&af.create(a).valid?(n=a,this.dt=e):(n="UTC",this.dt=e.offset===0?e:e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone)}else e.zone.type==="system"?this.dt=e:e.zone.type==="iana"?(this.dt=e,n=e.zone.name):(n="UTC",this.dt=e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone);const s={...this.opts};s.timeZone=s.timeZone||n,this.dtf=qW(r,s)}format(){return this.originalZone?this.formatToParts().map(({value:e})=>e).join(""):this.dtf.format(this.dt.toJSDate())}formatToParts(){const e=this.dtf.formatToParts(this.dt.toJSDate());return this.originalZone?e.map(r=>{if(r.type==="timeZoneName"){const i=this.originalZone.offsetName(this.dt.ts,{locale:this.dt.locale,format:this.opts.timeZoneName});return{...r,value:i}}else return r}):e}resolvedOptions(){return this.dtf.resolvedOptions()}}class Dje{constructor(e,r,i){this.opts={style:"long",...i},!r&&tTe()&&(this.rtf=Cje(e,i))}format(e,r){return this.rtf?this.rtf.format(e,r):tHe(r,e,this.opts.numeric,this.opts.style!=="long")}formatToParts(e,r){return this.rtf?this.rtf.formatToParts(e,r):[]}}const Nje={firstDay:1,minimalDays:4,weekend:[6,7]};class un{static fromOpts(e){return un.create(e.locale,e.numberingSystem,e.outputCalendar,e.weekSettings,e.defaultToEN)}static create(e,r,i,n,s=!1){const o=e||Gs.defaultLocale,a=o||(s?"en-US":Eje()),l=r||Gs.defaultNumberingSystem,c=i||Gs.defaultOutputCalendar,u=ZW(n)||Gs.defaultWeekSettings;return new un(a,l,c,u,o)}static resetCache(){FA=null,WW={},YW={},XW={}}static fromObject({locale:e,numberingSystem:r,outputCalendar:i,weekSettings:n}={}){return un.create(e,r,i,n)}constructor(e,r,i,n,s){const[o,a,l]=Aje(e);this.locale=o,this.numberingSystem=r||a||null,this.outputCalendar=i||l||null,this.weekSettings=n,this.intl=Mje(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=s,this.fastNumbersCached=null}get fastNumbers(){return this.fastNumbersCached==null&&(this.fastNumbersCached=$je(this)),this.fastNumbersCached}listingMode(){const e=this.isEnglish(),r=(this.numberingSystem===null||this.numberingSystem==="latn")&&(this.outputCalendar===null||this.outputCalendar==="gregory");return e&&r?"en":"intl"}clone(e){return!e||Object.getOwnPropertyNames(e).length===0?this:un.create(e.locale||this.specifiedLocale,e.numberingSystem||this.numberingSystem,e.outputCalendar||this.outputCalendar,ZW(e.weekSettings)||this.weekSettings,e.defaultToEN||!1)}redefaultToEN(e={}){return this.clone({...e,defaultToEN:!0})}redefaultToSystem(e={}){return this.clone({...e,defaultToEN:!1})}months(e,r=!1){return eD(this,e,oTe,()=>{const i=r?{month:e,day:"numeric"}:{month:e},n=r?"format":"standalone";return this.monthsCache[n][e]||(this.monthsCache[n][e]=Oje(s=>this.extract(s,i,"month"))),this.monthsCache[n][e]})}weekdays(e,r=!1){return eD(this,e,cTe,()=>{const i=r?{weekday:e,year:"numeric",month:"long",day:"numeric"}:{weekday:e},n=r?"format":"standalone";return this.weekdaysCache[n][e]||(this.weekdaysCache[n][e]=Rje(s=>this.extract(s,i,"weekday"))),this.weekdaysCache[n][e]})}meridiems(){return eD(this,void 0,()=>uTe,()=>{if(!this.meridiemCache){const e={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[er.utc(2016,11,13,9),er.utc(2016,11,13,19)].map(r=>this.extract(r,e,"dayperiod"))}return this.meridiemCache})}eras(e){return eD(this,e,hTe,()=>{const r={era:e};return this.eraCache[e]||(this.eraCache[e]=[er.utc(-40,1,1),er.utc(2017,1,1)].map(i=>this.extract(i,r,"era"))),this.eraCache[e]})}extract(e,r,i){const n=this.dtFormatter(e,r),s=n.formatToParts(),o=s.find(a=>a.type.toLowerCase()===i);return o?o.value:null}numberFormatter(e={}){return new Ije(this.intl,e.forceSimple||this.fastNumbers,e)}dtFormatter(e,r={}){return new Lje(e,this.intl,r)}relFormatter(e={}){return new Dje(this.intl,this.isEnglish(),e)}listFormatter(e={}){return Tje(this.intl,e)}isEnglish(){return this.locale==="en"||this.locale.toLowerCase()==="en-us"||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}getWeekSettings(){return this.weekSettings?this.weekSettings:rTe()?Pje(this.locale):Nje}getStartOfWeek(){return this.getWeekSettings().firstDay}getMinDaysInFirstWeek(){return this.getWeekSettings().minimalDays}getWeekendDays(){return this.getWeekSettings().weekend}equals(e){return this.locale===e.locale&&this.numberingSystem===e.numberingSystem&&this.outputCalendar===e.outputCalendar}}let eV=null;class _l extends RI{static get utcInstance(){return eV===null&&(eV=new _l(0)),eV}static instance(e){return e===0?_l.utcInstance:new _l(e)}static parseSpecifier(e){if(e){const r=e.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(r)return new _l(g9(r[1],r[2]))}return null}constructor(e){super(),this.fixed=e}get type(){return"fixed"}get name(){return this.fixed===0?"UTC":`UTC${qO(this.fixed,"narrow")}`}get ianaName(){return this.fixed===0?"Etc/UTC":`Etc/GMT${qO(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(e,r){return qO(this.fixed,r)}get isUniversal(){return!0}offset(){return this.fixed}equals(e){return e.type==="fixed"&&e.fixed===this.fixed}get isValid(){return!0}}class Fje extends RI{constructor(e){super(),this.zoneName=e}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function l1(t,e){if(yr(t)||t===null)return e;if(t instanceof RI)return t;if(Uje(t)){const r=t.toLowerCase();return r==="default"?e:r==="local"||r==="system"?p9.instance:r==="utc"||r==="gmt"?_l.utcInstance:_l.parseSpecifier(r)||af.create(t)}else return Ex(t)?_l.instance(t):typeof t=="object"&&"offset"in t&&typeof t.offset=="function"?t:new Fje(t)}let ele=()=>Date.now(),tle="system",rle=null,ile=null,nle=null,sle=60,ole,ale=null;class Gs{static get now(){return ele}static set now(e){ele=e}static set defaultZone(e){tle=e}static get defaultZone(){return l1(tle,p9.instance)}static get defaultLocale(){return rle}static set defaultLocale(e){rle=e}static get defaultNumberingSystem(){return ile}static set defaultNumberingSystem(e){ile=e}static get defaultOutputCalendar(){return nle}static set defaultOutputCalendar(e){nle=e}static get defaultWeekSettings(){return ale}static set defaultWeekSettings(e){ale=ZW(e)}static get twoDigitCutoffYear(){return sle}static set twoDigitCutoffYear(e){sle=e%100}static get throwOnInvalid(){return ole}static set throwOnInvalid(e){ole=e}static resetCaches(){un.resetCache(),af.resetCache()}}class Fp{constructor(e,r){this.reason=e,this.explanation=r}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}const X2e=[0,31,59,90,120,151,181,212,243,273,304,334],Z2e=[0,31,60,91,121,152,182,213,244,274,305,335];function Jh(t,e){return new Fp("unit out of range",`you specified ${e} (of type ${typeof e}) as a ${t}, which is invalid`)}function Cee(t,e,r){const i=new Date(Date.UTC(t,e-1,r));t<100&&t>=0&&i.setUTCFullYear(i.getUTCFullYear()-1900);const n=i.getUTCDay();return n===0?7:n}function J2e(t,e,r){return r+($I(t)?Z2e:X2e)[e-1]}function Q2e(t,e){const r=$I(t)?Z2e:X2e,i=r.findIndex(s=>s<e),n=e-r[i];return{month:i+1,day:n}}function Eee(t,e){return(t-e+7)%7+1}function u6(t,e=4,r=1){const{year:i,month:n,day:s}=t,o=J2e(i,n,s),a=Eee(Cee(i,n,s),r);let l=Math.floor((o-a+14-e)/7),c;return l<1?(c=i-1,l=x$(c,e,r)):l>x$(i,e,r)?(c=i+1,l=1):c=i,{weekYear:c,weekNumber:l,weekday:a,...y9(t)}}function lle(t,e=4,r=1){const{weekYear:i,weekNumber:n,weekday:s}=t,o=Eee(Cee(i,1,e),r),a=BC(i);let l=n*7+s-o-7+e,c;l<1?(c=i-1,l+=BC(c)):l>a?(c=i+1,l-=BC(i)):c=i;const{month:u,day:h}=Q2e(c,l);return{year:c,month:u,day:h,...y9(t)}}function tV(t){const{year:e,month:r,day:i}=t,n=J2e(e,r,i);return{year:e,ordinal:n,...y9(t)}}function cle(t){const{year:e,ordinal:r}=t,{month:i,day:n}=Q2e(e,r);return{year:e,month:i,day:n,...y9(t)}}function ule(t,e){if(!yr(t.localWeekday)||!yr(t.localWeekNumber)||!yr(t.localWeekYear)){if(!yr(t.weekday)||!yr(t.weekNumber)||!yr(t.weekYear))throw new iC("Cannot mix locale-based week fields with ISO-based week fields");return yr(t.localWeekday)||(t.weekday=t.localWeekday),yr(t.localWeekNumber)||(t.weekNumber=t.localWeekNumber),yr(t.localWeekYear)||(t.weekYear=t.localWeekYear),delete t.localWeekday,delete t.localWeekNumber,delete t.localWeekYear,{minDaysInFirstWeek:e.getMinDaysInFirstWeek(),startOfWeek:e.getStartOfWeek()}}else return{minDaysInFirstWeek:4,startOfWeek:1}}function kje(t,e=4,r=1){const i=f9(t.weekYear),n=Qh(t.weekNumber,1,x$(t.weekYear,e,r)),s=Qh(t.weekday,1,7);return i?n?s?!1:Jh("weekday",t.weekday):Jh("week",t.weekNumber):Jh("weekYear",t.weekYear)}function zje(t){const e=f9(t.year),r=Qh(t.ordinal,1,BC(t.year));return e?r?!1:Jh("ordinal",t.ordinal):Jh("year",t.year)}function K2e(t){const e=f9(t.year),r=Qh(t.month,1,12),i=Qh(t.day,1,h6(t.year,t.month));return e?r?i?!1:Jh("day",t.day):Jh("month",t.month):Jh("year",t.year)}function eTe(t){const{hour:e,minute:r,second:i,millisecond:n}=t,s=Qh(e,0,23)||e===24&&r===0&&i===0&&n===0,o=Qh(r,0,59),a=Qh(i,0,59),l=Qh(n,0,999);return s?o?a?l?!1:Jh("millisecond",n):Jh("second",i):Jh("minute",r):Jh("hour",e)}function yr(t){return typeof t>"u"}function Ex(t){return typeof t=="number"}function f9(t){return typeof t=="number"&&t%1===0}function Uje(t){return typeof t=="string"}function Bje(t){return Object.prototype.toString.call(t)==="[object Date]"}function tTe(){try{return typeof Intl<"u"&&!!Intl.RelativeTimeFormat}catch{return!1}}function rTe(){try{return typeof Intl<"u"&&!!Intl.Locale&&("weekInfo"in Intl.Locale.prototype||"getWeekInfo"in Intl.Locale.prototype)}catch{return!1}}function Vje(t){return Array.isArray(t)?t:[t]}function hle(t,e,r){if(t.length!==0)return t.reduce((i,n)=>{const s=[e(n),n];return i&&r(i[0],s[0])===i[0]?i:s},null)[1]}function Gje(t,e){return e.reduce((r,i)=>(r[i]=t[i],r),{})}function BE(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function ZW(t){if(t==null)return null;if(typeof t!="object")throw new Nc("Week settings must be an object");if(!Qh(t.firstDay,1,7)||!Qh(t.minimalDays,1,7)||!Array.isArray(t.weekend)||t.weekend.some(e=>!Qh(e,1,7)))throw new Nc("Invalid week settings");return{firstDay:t.firstDay,minimalDays:t.minimalDays,weekend:Array.from(t.weekend)}}function Qh(t,e,r){return f9(t)&&t>=e&&t<=r}function jje(t,e){return t-e*Math.floor(t/e)}function _o(t,e=2){const r=t<0;let i;return r?i="-"+(""+-t).padStart(e,"0"):i=(""+t).padStart(e,"0"),i}function X_(t){if(!(yr(t)||t===null||t===""))return parseInt(t,10)}function Qv(t){if(!(yr(t)||t===null||t===""))return parseFloat(t)}function Pee(t){if(!(yr(t)||t===null||t==="")){const e=parseFloat("0."+t)*1e3;return Math.floor(e)}}function Aee(t,e,r=!1){const i=10**e;return(r?Math.trunc:Math.round)(t*i)/i}function $I(t){return t%4===0&&(t%100!==0||t%400===0)}function BC(t){return $I(t)?366:365}function h6(t,e){const r=jje(e-1,12)+1,i=t+(e-r)/12;return r===2?$I(i)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][r-1]}function m9(t){let e=Date.UTC(t.year,t.month-1,t.day,t.hour,t.minute,t.second,t.millisecond);return t.year<100&&t.year>=0&&(e=new Date(e),e.setUTCFullYear(t.year,t.month-1,t.day)),+e}function dle(t,e,r){return-Eee(Cee(t,1,e),r)+e-1}function x$(t,e=4,r=1){const i=dle(t,e,r),n=dle(t+1,e,r);return(BC(t)-i+n)/7}function JW(t){return t>99?t:t>Gs.twoDigitCutoffYear?1900+t:2e3+t}function iTe(t,e,r,i=null){const n=new Date(t),s={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};i&&(s.timeZone=i);const o={timeZoneName:e,...s},a=new Intl.DateTimeFormat(r,o).formatToParts(n).find(l=>l.type.toLowerCase()==="timezonename");return a?a.value:null}function g9(t,e){let r=parseInt(t,10);Number.isNaN(r)&&(r=0);const i=parseInt(e,10)||0,n=r<0||Object.is(r,-0)?-i:i;return r*60+n}function nTe(t){const e=Number(t);if(typeof t=="boolean"||t===""||Number.isNaN(e))throw new Nc(`Invalid unit value ${t}`);return e}function d6(t,e){const r={};for(const i in t)if(BE(t,i)){const n=t[i];if(n==null)continue;r[e(i)]=nTe(n)}return r}function qO(t,e){const r=Math.trunc(Math.abs(t/60)),i=Math.trunc(Math.abs(t%60)),n=t>=0?"+":"-";switch(e){case"short":return`${n}${_o(r,2)}:${_o(i,2)}`;case"narrow":return`${n}${r}${i>0?`:${i}`:""}`;case"techie":return`${n}${_o(r,2)}${_o(i,2)}`;default:throw new RangeError(`Value format ${e} is out of range for property format`)}}function y9(t){return Gje(t,["hour","minute","second","millisecond"])}const Hje=["January","February","March","April","May","June","July","August","September","October","November","December"],sTe=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],Wje=["J","F","M","A","M","J","J","A","S","O","N","D"];function oTe(t){switch(t){case"narrow":return[...Wje];case"short":return[...sTe];case"long":return[...Hje];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const aTe=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],lTe=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],qje=["M","T","W","T","F","S","S"];function cTe(t){switch(t){case"narrow":return[...qje];case"short":return[...lTe];case"long":return[...aTe];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const uTe=["AM","PM"],Yje=["Before Christ","Anno Domini"],Xje=["BC","AD"],Zje=["B","A"];function hTe(t){switch(t){case"narrow":return[...Zje];case"short":return[...Xje];case"long":return[...Yje];default:return null}}function Jje(t){return uTe[t.hour<12?0:1]}function Qje(t,e){return cTe(e)[t.weekday-1]}function Kje(t,e){return oTe(e)[t.month-1]}function eHe(t,e){return hTe(e)[t.year<0?0:1]}function tHe(t,e,r="always",i=!1){const n={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},s=["hours","minutes","seconds"].indexOf(t)===-1;if(r==="auto"&&s){const h=t==="days";switch(e){case 1:return h?"tomorrow":`next ${n[t][0]}`;case-1:return h?"yesterday":`last ${n[t][0]}`;case 0:return h?"today":`this ${n[t][0]}`}}const o=Object.is(e,-0)||e<0,a=Math.abs(e),l=a===1,c=n[t],u=i?l?c[1]:c[2]||c[1]:l?n[t][0]:t;return o?`${a} ${u} ago`:`in ${a} ${u}`}function ple(t,e){let r="";for(const i of t)i.literal?r+=i.val:r+=e(i.val);return r}const rHe={D:c6,DD:O2e,DDD:R2e,DDDD:$2e,t:I2e,tt:L2e,ttt:D2e,tttt:N2e,T:F2e,TT:k2e,TTT:z2e,TTTT:U2e,f:B2e,ff:G2e,fff:H2e,ffff:q2e,F:V2e,FF:j2e,FFF:W2e,FFFF:Y2e};class gl{static create(e,r={}){return new gl(e,r)}static parseFormat(e){let r=null,i="",n=!1;const s=[];for(let o=0;o<e.length;o++){const a=e.charAt(o);a==="'"?(i.length>0&&s.push({literal:n||/^\s+$/.test(i),val:i}),r=null,i="",n=!n):n||a===r?i+=a:(i.length>0&&s.push({literal:/^\s+$/.test(i),val:i}),i=a,r=a)}return i.length>0&&s.push({literal:n||/^\s+$/.test(i),val:i}),s}static macroTokenToFormatOpts(e){return rHe[e]}constructor(e,r){this.opts=r,this.loc=e,this.systemLoc=null}formatWithSystemDefault(e,r){return this.systemLoc===null&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(e,{...this.opts,...r}).format()}dtFormatter(e,r={}){return this.loc.dtFormatter(e,{...this.opts,...r})}formatDateTime(e,r){return this.dtFormatter(e,r).format()}formatDateTimeParts(e,r){return this.dtFormatter(e,r).formatToParts()}formatInterval(e,r){return this.dtFormatter(e.start,r).dtf.formatRange(e.start.toJSDate(),e.end.toJSDate())}resolvedOptions(e,r){return this.dtFormatter(e,r).resolvedOptions()}num(e,r=0){if(this.opts.forceSimple)return _o(e,r);const i={...this.opts};return r>0&&(i.padTo=r),this.loc.numberFormatter(i).format(e)}formatDateTimeFromString(e,r){const i=this.loc.listingMode()==="en",n=this.loc.outputCalendar&&this.loc.outputCalendar!=="gregory",s=(f,g)=>this.loc.extract(e,f,g),o=f=>e.isOffsetFixed&&e.offset===0&&f.allowZ?"Z":e.isValid?e.zone.formatOffset(e.ts,f.format):"",a=()=>i?Jje(e):s({hour:"numeric",hourCycle:"h12"},"dayperiod"),l=(f,g)=>i?Kje(e,f):s(g?{month:f}:{month:f,day:"numeric"},"month"),c=(f,g)=>i?Qje(e,f):s(g?{weekday:f}:{weekday:f,month:"long",day:"numeric"},"weekday"),u=f=>{const g=gl.macroTokenToFormatOpts(f);return g?this.formatWithSystemDefault(e,g):f},h=f=>i?eHe(e,f):s({era:f},"era"),p=f=>{switch(f){case"S":return this.num(e.millisecond);case"u":case"SSS":return this.num(e.millisecond,3);case"s":return this.num(e.second);case"ss":return this.num(e.second,2);case"uu":return this.num(Math.floor(e.millisecond/10),2);case"uuu":return this.num(Math.floor(e.millisecond/100));case"m":return this.num(e.minute);case"mm":return this.num(e.minute,2);case"h":return this.num(e.hour%12===0?12:e.hour%12);case"hh":return this.num(e.hour%12===0?12:e.hour%12,2);case"H":return this.num(e.hour);case"HH":return this.num(e.hour,2);case"Z":return o({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return o({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return o({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return e.zone.offsetName(e.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return e.zone.offsetName(e.ts,{format:"long",locale:this.loc.locale});case"z":return e.zoneName;case"a":return a();case"d":return n?s({day:"numeric"},"day"):this.num(e.day);case"dd":return n?s({day:"2-digit"},"day"):this.num(e.day,2);case"c":return this.num(e.weekday);case"ccc":return c("short",!0);case"cccc":return c("long",!0);case"ccccc":return c("narrow",!0);case"E":return this.num(e.weekday);case"EEE":return c("short",!1);case"EEEE":return c("long",!1);case"EEEEE":return c("narrow",!1);case"L":return n?s({month:"numeric",day:"numeric"},"month"):this.num(e.month);case"LL":return n?s({month:"2-digit",day:"numeric"},"month"):this.num(e.month,2);case"LLL":return l("short",!0);case"LLLL":return l("long",!0);case"LLLLL":return l("narrow",!0);case"M":return n?s({month:"numeric"},"month"):this.num(e.month);case"MM":return n?s({month:"2-digit"},"month"):this.num(e.month,2);case"MMM":return l("short",!1);case"MMMM":return l("long",!1);case"MMMMM":return l("narrow",!1);case"y":return n?s({year:"numeric"},"year"):this.num(e.year);case"yy":return n?s({year:"2-digit"},"year"):this.num(e.year.toString().slice(-2),2);case"yyyy":return n?s({year:"numeric"},"year"):this.num(e.year,4);case"yyyyyy":return n?s({year:"numeric"},"year"):this.num(e.year,6);case"G":return h("short");case"GG":return h("long");case"GGGGG":return h("narrow");case"kk":return this.num(e.weekYear.toString().slice(-2),2);case"kkkk":return this.num(e.weekYear,4);case"W":return this.num(e.weekNumber);case"WW":return this.num(e.weekNumber,2);case"n":return this.num(e.localWeekNumber);case"nn":return this.num(e.localWeekNumber,2);case"ii":return this.num(e.localWeekYear.toString().slice(-2),2);case"iiii":return this.num(e.localWeekYear,4);case"o":return this.num(e.ordinal);case"ooo":return this.num(e.ordinal,3);case"q":return this.num(e.quarter);case"qq":return this.num(e.quarter,2);case"X":return this.num(Math.floor(e.ts/1e3));case"x":return this.num(e.ts);default:return u(f)}};return ple(gl.parseFormat(r),p)}formatDurationFromString(e,r){const i=l=>{switch(l[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},n=l=>c=>{const u=i(c);return u?this.num(l.get(u),c.length):c},s=gl.parseFormat(r),o=s.reduce((l,{literal:c,val:u})=>c?l:l.concat(u),[]),a=e.shiftTo(...o.map(i).filter(l=>l));return ple(s,n(a))}}const dTe=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/;function I3(...t){const e=t.reduce((r,i)=>r+i.source,"");return RegExp(`^${e}$`)}function L3(...t){return e=>t.reduce(([r,i,n],s)=>{const[o,a,l]=s(e,n);return[{...r,...o},a||i,l]},[{},null,1]).slice(0,2)}function D3(t,...e){if(t==null)return[null,null];for(const[r,i]of e){const n=r.exec(t);if(n)return i(n)}return[null,null]}function pTe(...t){return(e,r)=>{const i={};let n;for(n=0;n<t.length;n++)i[t[n]]=X_(e[r+n]);return[i,null,r+n]}}const fTe=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,iHe=`(?:${fTe.source}?(?:\\[(${dTe.source})\\])?)?`,Mee=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,mTe=RegExp(`${Mee.source}${iHe}`),Oee=RegExp(`(?:T${mTe.source})?`),nHe=/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,sHe=/(\d{4})-?W(\d\d)(?:-?(\d))?/,oHe=/(\d{4})-?(\d{3})/,aHe=pTe("weekYear","weekNumber","weekDay"),lHe=pTe("year","ordinal"),cHe=/(\d{4})-(\d\d)-(\d\d)/,gTe=RegExp(`${Mee.source} ?(?:${fTe.source}|(${dTe.source}))?`),uHe=RegExp(`(?: ${gTe.source})?`);function VC(t,e,r){const i=t[e];return yr(i)?r:X_(i)}function hHe(t,e){return[{year:VC(t,e),month:VC(t,e+1,1),day:VC(t,e+2,1)},null,e+3]}function N3(t,e){return[{hours:VC(t,e,0),minutes:VC(t,e+1,0),seconds:VC(t,e+2,0),milliseconds:Pee(t[e+3])},null,e+4]}function II(t,e){const r=!t[e]&&!t[e+1],i=g9(t[e+1],t[e+2]),n=r?null:_l.instance(i);return[{},n,e+3]}function LI(t,e){const r=t[e]?af.create(t[e]):null;return[{},r,e+1]}const dHe=RegExp(`^T?${Mee.source}$`),pHe=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function fHe(t){const[e,r,i,n,s,o,a,l,c]=t,u=e[0]==="-",h=l&&l[0]==="-",p=(f,g=!1)=>f!==void 0&&(g||f&&u)?-f:f;return[{years:p(Qv(r)),months:p(Qv(i)),weeks:p(Qv(n)),days:p(Qv(s)),hours:p(Qv(o)),minutes:p(Qv(a)),seconds:p(Qv(l),l==="-0"),milliseconds:p(Pee(c),h)}]}const mHe={GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function Ree(t,e,r,i,n,s,o){const a={year:e.length===2?JW(X_(e)):X_(e),month:sTe.indexOf(r)+1,day:X_(i),hour:X_(n),minute:X_(s)};return o&&(a.second=X_(o)),t&&(a.weekday=t.length>3?aTe.indexOf(t)+1:lTe.indexOf(t)+1),a}const gHe=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function yHe(t){const[,e,r,i,n,s,o,a,l,c,u,h]=t,p=Ree(e,n,i,r,s,o,a);let f;return l?f=mHe[l]:c?f=0:f=g9(u,h),[p,new _l(f)]}function _He(t){return t.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}const vHe=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,bHe=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,wHe=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function fle(t){const[,e,r,i,n,s,o,a]=t;return[Ree(e,n,i,r,s,o,a),_l.utcInstance]}function xHe(t){const[,e,r,i,n,s,o,a]=t;return[Ree(e,a,r,i,n,s,o),_l.utcInstance]}const THe=I3(nHe,Oee),SHe=I3(sHe,Oee),CHe=I3(oHe,Oee),EHe=I3(mTe),yTe=L3(hHe,N3,II,LI),PHe=L3(aHe,N3,II,LI),AHe=L3(lHe,N3,II,LI),MHe=L3(N3,II,LI);function OHe(t){return D3(t,[THe,yTe],[SHe,PHe],[CHe,AHe],[EHe,MHe])}function RHe(t){return D3(_He(t),[gHe,yHe])}function $He(t){return D3(t,[vHe,fle],[bHe,fle],[wHe,xHe])}function IHe(t){return D3(t,[pHe,fHe])}const LHe=L3(N3);function DHe(t){return D3(t,[dHe,LHe])}const NHe=I3(cHe,uHe),FHe=I3(gTe),kHe=L3(N3,II,LI);function zHe(t){return D3(t,[NHe,yTe],[FHe,kHe])}const mle="Invalid Duration",_Te={weeks:{days:7,hours:7*24,minutes:7*24*60,seconds:7*24*60*60,milliseconds:7*24*60*60*1e3},days:{hours:24,minutes:24*60,seconds:24*60*60,milliseconds:24*60*60*1e3},hours:{minutes:60,seconds:60*60,milliseconds:60*60*1e3},minutes:{seconds:60,milliseconds:60*1e3},seconds:{milliseconds:1e3}},UHe={years:{quarters:4,months:12,weeks:52,days:365,hours:365*24,minutes:365*24*60,seconds:365*24*60*60,milliseconds:365*24*60*60*1e3},quarters:{months:3,weeks:13,days:91,hours:91*24,minutes:91*24*60,seconds:91*24*60*60,milliseconds:91*24*60*60*1e3},months:{weeks:4,days:30,hours:30*24,minutes:30*24*60,seconds:30*24*60*60,milliseconds:30*24*60*60*1e3},..._Te},ah=146097/400,X2=146097/4800,BHe={years:{quarters:4,months:12,weeks:ah/7,days:ah,hours:ah*24,minutes:ah*24*60,seconds:ah*24*60*60,milliseconds:ah*24*60*60*1e3},quarters:{months:3,weeks:ah/28,days:ah/4,hours:ah*24/4,minutes:ah*24*60/4,seconds:ah*24*60*60/4,milliseconds:ah*24*60*60*1e3/4},months:{weeks:X2/7,days:X2,hours:X2*24,minutes:X2*24*60,seconds:X2*24*60*60,milliseconds:X2*24*60*60*1e3},..._Te},ox=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],VHe=ox.slice(0).reverse();function zy(t,e,r=!1){const i={values:r?e.values:{...t.values,...e.values||{}},loc:t.loc.clone(e.loc),conversionAccuracy:e.conversionAccuracy||t.conversionAccuracy,matrix:e.matrix||t.matrix};return new Ti(i)}function vTe(t,e){let r=e.milliseconds??0;for(const i of VHe.slice(1))e[i]&&(r+=e[i]*t[i].milliseconds);return r}function gle(t,e){const r=vTe(t,e)<0?-1:1;ox.reduceRight((i,n)=>{if(yr(e[n]))return i;if(i){const s=e[i]*r,o=t[n][i],a=Math.floor(s/o);e[n]+=a*r,e[i]-=a*o*r}return n},null),ox.reduce((i,n)=>{if(yr(e[n]))return i;if(i){const s=e[i]%1;e[i]-=s,e[n]+=s*t[i][n]}return n},null)}function GHe(t){const e={};for(const[r,i]of Object.entries(t))i!==0&&(e[r]=i);return e}class Ti{constructor(e){const r=e.conversionAccuracy==="longterm"||!1;let i=r?BHe:UHe;e.matrix&&(i=e.matrix),this.values=e.values,this.loc=e.loc||un.create(),this.conversionAccuracy=r?"longterm":"casual",this.invalid=e.invalid||null,this.matrix=i,this.isLuxonDuration=!0}static fromMillis(e,r){return Ti.fromObject({milliseconds:e},r)}static fromObject(e,r={}){if(e==null||typeof e!="object")throw new Nc(`Duration.fromObject: argument expected to be an object, got ${e===null?"null":typeof e}`);return new Ti({values:d6(e,Ti.normalizeUnit),loc:un.fromObject(r),conversionAccuracy:r.conversionAccuracy,matrix:r.matrix})}static fromDurationLike(e){if(Ex(e))return Ti.fromMillis(e);if(Ti.isDuration(e))return e;if(typeof e=="object")return Ti.fromObject(e);throw new Nc(`Unknown duration argument ${e} of type ${typeof e}`)}static fromISO(e,r){const[i]=IHe(e);return i?Ti.fromObject(i,r):Ti.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static fromISOTime(e,r){const[i]=DHe(e);return i?Ti.fromObject(i,r):Ti.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static invalid(e,r=null){if(!e)throw new Nc("need to specify a reason the Duration is invalid");const i=e instanceof Fp?e:new Fp(e,r);if(Gs.throwOnInvalid)throw new gje(i);return new Ti({invalid:i})}static normalizeUnit(e){const r={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[e&&e.toLowerCase()];if(!r)throw new M2e(e);return r}static isDuration(e){return e&&e.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(e,r={}){const i={...r,floor:r.round!==!1&&r.floor!==!1};return this.isValid?gl.create(this.loc,i).formatDurationFromString(this,e):mle}toHuman(e={}){if(!this.isValid)return mle;const r=ox.map(i=>{const n=this.values[i];return yr(n)?null:this.loc.numberFormatter({style:"unit",unitDisplay:"long",...e,unit:i.slice(0,-1)}).format(n)}).filter(i=>i);return this.loc.listFormatter({type:"conjunction",style:e.listStyle||"narrow",...e}).format(r)}toObject(){return this.isValid?{...this.values}:{}}toISO(){if(!this.isValid)return null;let e="P";return this.years!==0&&(e+=this.years+"Y"),(this.months!==0||this.quarters!==0)&&(e+=this.months+this.quarters*3+"M"),this.weeks!==0&&(e+=this.weeks+"W"),this.days!==0&&(e+=this.days+"D"),(this.hours!==0||this.minutes!==0||this.seconds!==0||this.milliseconds!==0)&&(e+="T"),this.hours!==0&&(e+=this.hours+"H"),this.minutes!==0&&(e+=this.minutes+"M"),(this.seconds!==0||this.milliseconds!==0)&&(e+=Aee(this.seconds+this.milliseconds/1e3,3)+"S"),e==="P"&&(e+="T0S"),e}toISOTime(e={}){if(!this.isValid)return null;const r=this.toMillis();return r<0||r>=864e5?null:(e={suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended",...e,includeOffset:!1},er.fromMillis(r,{zone:"UTC"}).toISOTime(e))}toJSON(){return this.toISO()}toString(){return this.toISO()}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`Duration { values: ${JSON.stringify(this.values)} }`:`Duration { Invalid, reason: ${this.invalidReason} }`}toMillis(){return this.isValid?vTe(this.matrix,this.values):NaN}valueOf(){return this.toMillis()}plus(e){if(!this.isValid)return this;const r=Ti.fromDurationLike(e),i={};for(const n of ox)(BE(r.values,n)||BE(this.values,n))&&(i[n]=r.get(n)+this.get(n));return zy(this,{values:i},!0)}minus(e){if(!this.isValid)return this;const r=Ti.fromDurationLike(e);return this.plus(r.negate())}mapUnits(e){if(!this.isValid)return this;const r={};for(const i of Object.keys(this.values))r[i]=nTe(e(this.values[i],i));return zy(this,{values:r},!0)}get(e){return this[Ti.normalizeUnit(e)]}set(e){if(!this.isValid)return this;const r={...this.values,...d6(e,Ti.normalizeUnit)};return zy(this,{values:r})}reconfigure({locale:e,numberingSystem:r,conversionAccuracy:i,matrix:n}={}){const o={loc:this.loc.clone({locale:e,numberingSystem:r}),matrix:n,conversionAccuracy:i};return zy(this,o)}as(e){return this.isValid?this.shiftTo(e).get(e):NaN}normalize(){if(!this.isValid)return this;const e=this.toObject();return gle(this.matrix,e),zy(this,{values:e},!0)}rescale(){if(!this.isValid)return this;const e=GHe(this.normalize().shiftToAll().toObject());return zy(this,{values:e},!0)}shiftTo(...e){if(!this.isValid)return this;if(e.length===0)return this;e=e.map(o=>Ti.normalizeUnit(o));const r={},i={},n=this.toObject();let s;for(const o of ox)if(e.indexOf(o)>=0){s=o;let a=0;for(const c in i)a+=this.matrix[c][o]*i[c],i[c]=0;Ex(n[o])&&(a+=n[o]);const l=Math.trunc(a);r[o]=l,i[o]=(a*1e3-l*1e3)/1e3}else Ex(n[o])&&(i[o]=n[o]);for(const o in i)i[o]!==0&&(r[s]+=o===s?i[o]:i[o]/this.matrix[s][o]);return gle(this.matrix,r),zy(this,{values:r},!0)}shiftToAll(){return this.isValid?this.shiftTo("years","months","weeks","days","hours","minutes","seconds","milliseconds"):this}negate(){if(!this.isValid)return this;const e={};for(const r of Object.keys(this.values))e[r]=this.values[r]===0?0:-this.values[r];return zy(this,{values:e},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(e){if(!this.isValid||!e.isValid||!this.loc.equals(e.loc))return!1;function r(i,n){return i===void 0||i===0?n===void 0||n===0:i===n}for(const i of ox)if(!r(this.values[i],e.values[i]))return!1;return!0}}const Z2="Invalid Interval";function jHe(t,e){return!t||!t.isValid?Cs.invalid("missing or invalid start"):!e||!e.isValid?Cs.invalid("missing or invalid end"):e<t?Cs.invalid("end before start",`The end of an interval must be after its start, but you had start=${t.toISO()} and end=${e.toISO()}`):null}class Cs{constructor(e){this.s=e.start,this.e=e.end,this.invalid=e.invalid||null,this.isLuxonInterval=!0}static invalid(e,r=null){if(!e)throw new Nc("need to specify a reason the Interval is invalid");const i=e instanceof Fp?e:new Fp(e,r);if(Gs.throwOnInvalid)throw new mje(i);return new Cs({invalid:i})}static fromDateTimes(e,r){const i=wP(e),n=wP(r),s=jHe(i,n);return s??new Cs({start:i,end:n})}static after(e,r){const i=Ti.fromDurationLike(r),n=wP(e);return Cs.fromDateTimes(n,n.plus(i))}static before(e,r){const i=Ti.fromDurationLike(r),n=wP(e);return Cs.fromDateTimes(n.minus(i),n)}static fromISO(e,r){const[i,n]=(e||"").split("/",2);if(i&&n){let s,o;try{s=er.fromISO(i,r),o=s.isValid}catch{o=!1}let a,l;try{a=er.fromISO(n,r),l=a.isValid}catch{l=!1}if(o&&l)return Cs.fromDateTimes(s,a);if(o){const c=Ti.fromISO(n,r);if(c.isValid)return Cs.after(s,c)}else if(l){const c=Ti.fromISO(i,r);if(c.isValid)return Cs.before(a,c)}}return Cs.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static isInterval(e){return e&&e.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return this.invalidReason===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(e="milliseconds"){return this.isValid?this.toDuration(e).get(e):NaN}count(e="milliseconds",r){if(!this.isValid)return NaN;const i=this.start.startOf(e,r);let n;return r!=null&&r.useLocaleWeeks?n=this.end.reconfigure({locale:i.locale}):n=this.end,n=n.startOf(e,r),Math.floor(n.diff(i,e).get(e))+(n.valueOf()!==this.end.valueOf())}hasSame(e){return this.isValid?this.isEmpty()||this.e.minus(1).hasSame(this.s,e):!1}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(e){return this.isValid?this.s>e:!1}isBefore(e){return this.isValid?this.e<=e:!1}contains(e){return this.isValid?this.s<=e&&this.e>e:!1}set({start:e,end:r}={}){return this.isValid?Cs.fromDateTimes(e||this.s,r||this.e):this}splitAt(...e){if(!this.isValid)return[];const r=e.map(wP).filter(o=>this.contains(o)).sort((o,a)=>o.toMillis()-a.toMillis()),i=[];let{s:n}=this,s=0;for(;n<this.e;){const o=r[s]||this.e,a=+o>+this.e?this.e:o;i.push(Cs.fromDateTimes(n,a)),n=a,s+=1}return i}splitBy(e){const r=Ti.fromDurationLike(e);if(!this.isValid||!r.isValid||r.as("milliseconds")===0)return[];let{s:i}=this,n=1,s;const o=[];for(;i<this.e;){const a=this.start.plus(r.mapUnits(l=>l*n));s=+a>+this.e?this.e:a,o.push(Cs.fromDateTimes(i,s)),i=s,n+=1}return o}divideEqually(e){return this.isValid?this.splitBy(this.length()/e).slice(0,e):[]}overlaps(e){return this.e>e.s&&this.s<e.e}abutsStart(e){return this.isValid?+this.e==+e.s:!1}abutsEnd(e){return this.isValid?+e.e==+this.s:!1}engulfs(e){return this.isValid?this.s<=e.s&&this.e>=e.e:!1}equals(e){return!this.isValid||!e.isValid?!1:this.s.equals(e.s)&&this.e.equals(e.e)}intersection(e){if(!this.isValid)return this;const r=this.s>e.s?this.s:e.s,i=this.e<e.e?this.e:e.e;return r>=i?null:Cs.fromDateTimes(r,i)}union(e){if(!this.isValid)return this;const r=this.s<e.s?this.s:e.s,i=this.e>e.e?this.e:e.e;return Cs.fromDateTimes(r,i)}static merge(e){const[r,i]=e.sort((n,s)=>n.s-s.s).reduce(([n,s],o)=>s?s.overlaps(o)||s.abutsStart(o)?[n,s.union(o)]:[n.concat([s]),o]:[n,o],[[],null]);return i&&r.push(i),r}static xor(e){let r=null,i=0;const n=[],s=e.map(l=>[{time:l.s,type:"s"},{time:l.e,type:"e"}]),o=Array.prototype.concat(...s),a=o.sort((l,c)=>l.time-c.time);for(const l of a)i+=l.type==="s"?1:-1,i===1?r=l.time:(r&&+r!=+l.time&&n.push(Cs.fromDateTimes(r,l.time)),r=null);return Cs.merge(n)}difference(...e){return Cs.xor([this].concat(e)).map(r=>this.intersection(r)).filter(r=>r&&!r.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()} – ${this.e.toISO()})`:Z2}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`Interval { start: ${this.s.toISO()}, end: ${this.e.toISO()} }`:`Interval { Invalid, reason: ${this.invalidReason} }`}toLocaleString(e=c6,r={}){return this.isValid?gl.create(this.s.loc.clone(r),e).formatInterval(this):Z2}toISO(e){return this.isValid?`${this.s.toISO(e)}/${this.e.toISO(e)}`:Z2}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:Z2}toISOTime(e){return this.isValid?`${this.s.toISOTime(e)}/${this.e.toISOTime(e)}`:Z2}toFormat(e,{separator:r=" – "}={}){return this.isValid?`${this.s.toFormat(e)}${r}${this.e.toFormat(e)}`:Z2}toDuration(e,r){return this.isValid?this.e.diff(this.s,e,r):Ti.invalid(this.invalidReason)}mapEndpoints(e){return Cs.fromDateTimes(e(this.s),e(this.e))}}class tD{static hasDST(e=Gs.defaultZone){const r=er.now().setZone(e).set({month:12});return!e.isUniversal&&r.offset!==r.set({month:6}).offset}static isValidIANAZone(e){return af.isValidZone(e)}static normalizeZone(e){return l1(e,Gs.defaultZone)}static getStartOfWeek({locale:e=null,locObj:r=null}={}){return(r||un.create(e)).getStartOfWeek()}static getMinimumDaysInFirstWeek({locale:e=null,locObj:r=null}={}){return(r||un.create(e)).getMinDaysInFirstWeek()}static getWeekendWeekdays({locale:e=null,locObj:r=null}={}){return(r||un.create(e)).getWeekendDays().slice()}static months(e="long",{locale:r=null,numberingSystem:i=null,locObj:n=null,outputCalendar:s="gregory"}={}){return(n||un.create(r,i,s)).months(e)}static monthsFormat(e="long",{locale:r=null,numberingSystem:i=null,locObj:n=null,outputCalendar:s="gregory"}={}){return(n||un.create(r,i,s)).months(e,!0)}static weekdays(e="long",{locale:r=null,numberingSystem:i=null,locObj:n=null}={}){return(n||un.create(r,i,null)).weekdays(e)}static weekdaysFormat(e="long",{locale:r=null,numberingSystem:i=null,locObj:n=null}={}){return(n||un.create(r,i,null)).weekdays(e,!0)}static meridiems({locale:e=null}={}){return un.create(e).meridiems()}static eras(e="short",{locale:r=null}={}){return un.create(r,null,"gregory").eras(e)}static features(){return{relative:tTe(),localeWeek:rTe()}}}function yle(t,e){const r=n=>n.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),i=r(e)-r(t);return Math.floor(Ti.fromMillis(i).as("days"))}function HHe(t,e,r){const i=[["years",(l,c)=>c.year-l.year],["quarters",(l,c)=>c.quarter-l.quarter+(c.year-l.year)*4],["months",(l,c)=>c.month-l.month+(c.year-l.year)*12],["weeks",(l,c)=>{const u=yle(l,c);return(u-u%7)/7}],["days",yle]],n={},s=t;let o,a;for(const[l,c]of i)r.indexOf(l)>=0&&(o=l,n[l]=c(t,e),a=s.plus(n),a>e?(n[l]--,t=s.plus(n),t>e&&(a=t,n[l]--,t=s.plus(n))):t=a);return[t,n,a,o]}function WHe(t,e,r,i){let[n,s,o,a]=HHe(t,e,r);const l=e-n,c=r.filter(h=>["hours","minutes","seconds","milliseconds"].indexOf(h)>=0);c.length===0&&(o<e&&(o=n.plus({[a]:1})),o!==n&&(s[a]=(s[a]||0)+l/(o-n)));const u=Ti.fromObject(s,i);return c.length>0?Ti.fromMillis(l,i).shiftTo(...c).plus(u):u}const $ee={arab:"[٠-٩]",arabext:"[۰-۹]",bali:"[᭐-᭙]",beng:"[০-৯]",deva:"[०-९]",fullwide:"[０-９]",gujr:"[૦-૯]",hanidec:"[〇|一|二|三|四|五|六|七|八|九]",khmr:"[០-៩]",knda:"[೦-೯]",laoo:"[໐-໙]",limb:"[᥆-᥏]",mlym:"[൦-൯]",mong:"[᠐-᠙]",mymr:"[၀-၉]",orya:"[୦-୯]",tamldec:"[௦-௯]",telu:"[౦-౯]",thai:"[๐-๙]",tibt:"[༠-༩]",latn:"\\d"},_le={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},qHe=$ee.hanidec.replace(/[\[|\]]/g,"").split("");function YHe(t){let e=parseInt(t,10);if(isNaN(e)){e="";for(let r=0;r<t.length;r++){const i=t.charCodeAt(r);if(t[r].search($ee.hanidec)!==-1)e+=qHe.indexOf(t[r]);else for(const n in _le){const[s,o]=_le[n];i>=s&&i<=o&&(e+=i-s)}}return parseInt(e,10)}else return e}function Rd({numberingSystem:t},e=""){return new RegExp(`${$ee[t||"latn"]}${e}`)}const XHe="missing Intl.DateTimeFormat.formatToParts support";function ki(t,e=r=>r){return{regex:t,deser:([r])=>e(YHe(r))}}const ZHe=" ",bTe=`[ ${ZHe}]`,wTe=new RegExp(bTe,"g");function JHe(t){return t.replace(/\./g,"\\.?").replace(wTe,bTe)}function vle(t){return t.replace(/\./g,"").replace(wTe," ").toLowerCase()}function $d(t,e){return t===null?null:{regex:RegExp(t.map(JHe).join("|")),deser:([r])=>t.findIndex(i=>vle(r)===vle(i))+e}}function ble(t,e){return{regex:t,deser:([,r,i])=>g9(r,i),groups:e}}function rD(t){return{regex:t,deser:([e])=>e}}function QHe(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function KHe(t,e){const r=Rd(e),i=Rd(e,"{2}"),n=Rd(e,"{3}"),s=Rd(e,"{4}"),o=Rd(e,"{6}"),a=Rd(e,"{1,2}"),l=Rd(e,"{1,3}"),c=Rd(e,"{1,6}"),u=Rd(e,"{1,9}"),h=Rd(e,"{2,4}"),p=Rd(e,"{4,6}"),f=v=>({regex:RegExp(QHe(v.val)),deser:([b])=>b,literal:!0}),_=(v=>{if(t.literal)return f(v);switch(v.val){case"G":return $d(e.eras("short"),0);case"GG":return $d(e.eras("long"),0);case"y":return ki(c);case"yy":return ki(h,JW);case"yyyy":return ki(s);case"yyyyy":return ki(p);case"yyyyyy":return ki(o);case"M":return ki(a);case"MM":return ki(i);case"MMM":return $d(e.months("short",!0),1);case"MMMM":return $d(e.months("long",!0),1);case"L":return ki(a);case"LL":return ki(i);case"LLL":return $d(e.months("short",!1),1);case"LLLL":return $d(e.months("long",!1),1);case"d":return ki(a);case"dd":return ki(i);case"o":return ki(l);case"ooo":return ki(n);case"HH":return ki(i);case"H":return ki(a);case"hh":return ki(i);case"h":return ki(a);case"mm":return ki(i);case"m":return ki(a);case"q":return ki(a);case"qq":return ki(i);case"s":return ki(a);case"ss":return ki(i);case"S":return ki(l);case"SSS":return ki(n);case"u":return rD(u);case"uu":return rD(a);case"uuu":return ki(r);case"a":return $d(e.meridiems(),0);case"kkkk":return ki(s);case"kk":return ki(h,JW);case"W":return ki(a);case"WW":return ki(i);case"E":case"c":return ki(r);case"EEE":return $d(e.weekdays("short",!1),1);case"EEEE":return $d(e.weekdays("long",!1),1);case"ccc":return $d(e.weekdays("short",!0),1);case"cccc":return $d(e.weekdays("long",!0),1);case"Z":case"ZZ":return ble(new RegExp(`([+-]${a.source})(?::(${i.source}))?`),2);case"ZZZ":return ble(new RegExp(`([+-]${a.source})(${i.source})?`),2);case"z":return rD(/[a-z_+-/]{1,256}?/i);case" ":return rD(/[^\S\n\r]/);default:return f(v)}})(t)||{invalidReason:XHe};return _.token=t,_}const eWe={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour12:{numeric:"h","2-digit":"hh"},hour24:{numeric:"H","2-digit":"HH"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"},timeZoneName:{long:"ZZZZZ",short:"ZZZ"}};function tWe(t,e,r){const{type:i,value:n}=t;if(i==="literal"){const l=/^\s+$/.test(n);return{literal:!l,val:l?" ":n}}const s=e[i];let o=i;i==="hour"&&(e.hour12!=null?o=e.hour12?"hour12":"hour24":e.hourCycle!=null?e.hourCycle==="h11"||e.hourCycle==="h12"?o="hour12":o="hour24":o=r.hour12?"hour12":"hour24");let a=eWe[o];if(typeof a=="object"&&(a=a[s]),a)return{literal:!1,val:a}}function rWe(t){return[`^${t.map(r=>r.regex).reduce((r,i)=>`${r}(${i.source})`,"")}$`,t]}function iWe(t,e,r){const i=t.match(e);if(i){const n={};let s=1;for(const o in r)if(BE(r,o)){const a=r[o],l=a.groups?a.groups+1:1;!a.literal&&a.token&&(n[a.token.val[0]]=a.deser(i.slice(s,s+l))),s+=l}return[i,n]}else return[i,{}]}function nWe(t){const e=s=>{switch(s){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}};let r=null,i;return yr(t.z)||(r=af.create(t.z)),yr(t.Z)||(r||(r=new _l(t.Z)),i=t.Z),yr(t.q)||(t.M=(t.q-1)*3+1),yr(t.h)||(t.h<12&&t.a===1?t.h+=12:t.h===12&&t.a===0&&(t.h=0)),t.G===0&&t.y&&(t.y=-t.y),yr(t.u)||(t.S=Pee(t.u)),[Object.keys(t).reduce((s,o)=>{const a=e(o);return a&&(s[a]=t[o]),s},{}),r,i]}let rV=null;function sWe(){return rV||(rV=er.fromMillis(1555555555555)),rV}function oWe(t,e){if(t.literal)return t;const r=gl.macroTokenToFormatOpts(t.val),i=STe(r,e);return i==null||i.includes(void 0)?t:i}function xTe(t,e){return Array.prototype.concat(...t.map(r=>oWe(r,e)))}function TTe(t,e,r){const i=xTe(gl.parseFormat(r),t),n=i.map(o=>KHe(o,t)),s=n.find(o=>o.invalidReason);if(s)return{input:e,tokens:i,invalidReason:s.invalidReason};{const[o,a]=rWe(n),l=RegExp(o,"i"),[c,u]=iWe(e,l,a),[h,p,f]=u?nWe(u):[null,null,void 0];if(BE(u,"a")&&BE(u,"H"))throw new iC("Can't include meridiem when specifying 24-hour format");return{input:e,tokens:i,regex:l,rawMatches:c,matches:u,result:h,zone:p,specificOffset:f}}}function aWe(t,e,r){const{result:i,zone:n,specificOffset:s,invalidReason:o}=TTe(t,e,r);return[i,n,s,o]}function STe(t,e){if(!t)return null;const i=gl.create(e,t).dtFormatter(sWe()),n=i.formatToParts(),s=i.resolvedOptions();return n.map(o=>tWe(o,t,s))}const iV="Invalid DateTime",wle=864e13;function iD(t){return new Fp("unsupported zone",`the zone "${t.name}" is not supported`)}function nV(t){return t.weekData===null&&(t.weekData=u6(t.c)),t.weekData}function sV(t){return t.localWeekData===null&&(t.localWeekData=u6(t.c,t.loc.getMinDaysInFirstWeek(),t.loc.getStartOfWeek())),t.localWeekData}function Kv(t,e){const r={ts:t.ts,zone:t.zone,c:t.c,o:t.o,loc:t.loc,invalid:t.invalid};return new er({...r,...e,old:r})}function CTe(t,e,r){let i=t-e*60*1e3;const n=r.offset(i);if(e===n)return[i,e];i-=(n-e)*60*1e3;const s=r.offset(i);return n===s?[i,n]:[t-Math.min(n,s)*60*1e3,Math.max(n,s)]}function nD(t,e){t+=e*60*1e3;const r=new Date(t);return{year:r.getUTCFullYear(),month:r.getUTCMonth()+1,day:r.getUTCDate(),hour:r.getUTCHours(),minute:r.getUTCMinutes(),second:r.getUTCSeconds(),millisecond:r.getUTCMilliseconds()}}function g5(t,e,r){return CTe(m9(t),e,r)}function xle(t,e){const r=t.o,i=t.c.year+Math.trunc(e.years),n=t.c.month+Math.trunc(e.months)+Math.trunc(e.quarters)*3,s={...t.c,year:i,month:n,day:Math.min(t.c.day,h6(i,n))+Math.trunc(e.days)+Math.trunc(e.weeks)*7},o=Ti.fromObject({years:e.years-Math.trunc(e.years),quarters:e.quarters-Math.trunc(e.quarters),months:e.months-Math.trunc(e.months),weeks:e.weeks-Math.trunc(e.weeks),days:e.days-Math.trunc(e.days),hours:e.hours,minutes:e.minutes,seconds:e.seconds,milliseconds:e.milliseconds}).as("milliseconds"),a=m9(s);let[l,c]=CTe(a,r,t.zone);return o!==0&&(l+=o,c=t.zone.offset(l)),{ts:l,o:c}}function bP(t,e,r,i,n,s){const{setZone:o,zone:a}=r;if(t&&Object.keys(t).length!==0||e){const l=e||a,c=er.fromObject(t,{...r,zone:l,specificOffset:s});return o?c:c.setZone(a)}else return er.invalid(new Fp("unparsable",`the input "${n}" can't be parsed as ${i}`))}function sD(t,e,r=!0){return t.isValid?gl.create(un.create("en-US"),{allowZ:r,forceSimple:!0}).formatDateTimeFromString(t,e):null}function oV(t,e){const r=t.c.year>9999||t.c.year<0;let i="";return r&&t.c.year>=0&&(i+="+"),i+=_o(t.c.year,r?6:4),e?(i+="-",i+=_o(t.c.month),i+="-",i+=_o(t.c.day)):(i+=_o(t.c.month),i+=_o(t.c.day)),i}function Tle(t,e,r,i,n,s){let o=_o(t.c.hour);return e?(o+=":",o+=_o(t.c.minute),(t.c.millisecond!==0||t.c.second!==0||!r)&&(o+=":")):o+=_o(t.c.minute),(t.c.millisecond!==0||t.c.second!==0||!r)&&(o+=_o(t.c.second),(t.c.millisecond!==0||!i)&&(o+=".",o+=_o(t.c.millisecond,3))),n&&(t.isOffsetFixed&&t.offset===0&&!s?o+="Z":t.o<0?(o+="-",o+=_o(Math.trunc(-t.o/60)),o+=":",o+=_o(Math.trunc(-t.o%60))):(o+="+",o+=_o(Math.trunc(t.o/60)),o+=":",o+=_o(Math.trunc(t.o%60)))),s&&(o+="["+t.zone.ianaName+"]"),o}const ETe={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},lWe={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},cWe={ordinal:1,hour:0,minute:0,second:0,millisecond:0},PTe=["year","month","day","hour","minute","second","millisecond"],uWe=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],hWe=["year","ordinal","hour","minute","second","millisecond"];function dWe(t){const e={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[t.toLowerCase()];if(!e)throw new M2e(t);return e}function Sle(t){switch(t.toLowerCase()){case"localweekday":case"localweekdays":return"localWeekday";case"localweeknumber":case"localweeknumbers":return"localWeekNumber";case"localweekyear":case"localweekyears":return"localWeekYear";default:return dWe(t)}}function Cle(t,e){const r=l1(e.zone,Gs.defaultZone),i=un.fromObject(e),n=Gs.now();let s,o;if(yr(t.year))s=n;else{for(const c of PTe)yr(t[c])&&(t[c]=ETe[c]);const a=K2e(t)||eTe(t);if(a)return er.invalid(a);const l=r.offset(n);[s,o]=g5(t,l,r)}return new er({ts:s,zone:r,loc:i,o})}function Ele(t,e,r){const i=yr(r.round)?!0:r.round,n=(o,a)=>(o=Aee(o,i||r.calendary?0:2,!0),e.loc.clone(r).relFormatter(r).format(o,a)),s=o=>r.calendary?e.hasSame(t,o)?0:e.startOf(o).diff(t.startOf(o),o).get(o):e.diff(t,o).get(o);if(r.unit)return n(s(r.unit),r.unit);for(const o of r.units){const a=s(o);if(Math.abs(a)>=1)return n(a,o)}return n(t>e?-0:0,r.units[r.units.length-1])}function Ple(t){let e={},r;return t.length>0&&typeof t[t.length-1]=="object"?(e=t[t.length-1],r=Array.from(t).slice(0,t.length-1)):r=Array.from(t),[e,r]}class er{constructor(e){const r=e.zone||Gs.defaultZone;let i=e.invalid||(Number.isNaN(e.ts)?new Fp("invalid input"):null)||(r.isValid?null:iD(r));this.ts=yr(e.ts)?Gs.now():e.ts;let n=null,s=null;if(!i)if(e.old&&e.old.ts===this.ts&&e.old.zone.equals(r))[n,s]=[e.old.c,e.old.o];else{const a=r.offset(this.ts);n=nD(this.ts,a),i=Number.isNaN(n.year)?new Fp("invalid input"):null,n=i?null:n,s=i?null:a}this._zone=r,this.loc=e.loc||un.create(),this.invalid=i,this.weekData=null,this.localWeekData=null,this.c=n,this.o=s,this.isLuxonDateTime=!0}static now(){return new er({})}static local(){const[e,r]=Ple(arguments),[i,n,s,o,a,l,c]=r;return Cle({year:i,month:n,day:s,hour:o,minute:a,second:l,millisecond:c},e)}static utc(){const[e,r]=Ple(arguments),[i,n,s,o,a,l,c]=r;return e.zone=_l.utcInstance,Cle({year:i,month:n,day:s,hour:o,minute:a,second:l,millisecond:c},e)}static fromJSDate(e,r={}){const i=Bje(e)?e.valueOf():NaN;if(Number.isNaN(i))return er.invalid("invalid input");const n=l1(r.zone,Gs.defaultZone);return n.isValid?new er({ts:i,zone:n,loc:un.fromObject(r)}):er.invalid(iD(n))}static fromMillis(e,r={}){if(Ex(e))return e<-wle||e>wle?er.invalid("Timestamp out of range"):new er({ts:e,zone:l1(r.zone,Gs.defaultZone),loc:un.fromObject(r)});throw new Nc(`fromMillis requires a numerical input, but received a ${typeof e} with value ${e}`)}static fromSeconds(e,r={}){if(Ex(e))return new er({ts:e*1e3,zone:l1(r.zone,Gs.defaultZone),loc:un.fromObject(r)});throw new Nc("fromSeconds requires a numerical input")}static fromObject(e,r={}){e=e||{};const i=l1(r.zone,Gs.defaultZone);if(!i.isValid)return er.invalid(iD(i));const n=un.fromObject(r),s=d6(e,Sle),{minDaysInFirstWeek:o,startOfWeek:a}=ule(s,n),l=Gs.now(),c=yr(r.specificOffset)?i.offset(l):r.specificOffset,u=!yr(s.ordinal),h=!yr(s.year),p=!yr(s.month)||!yr(s.day),f=h||p,g=s.weekYear||s.weekNumber;if((f||u)&&g)throw new iC("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(p&&u)throw new iC("Can't mix ordinal dates with month/day");const _=g||s.weekday&&!f;let v,b,w=nD(l,c);_?(v=uWe,b=lWe,w=u6(w,o,a)):u?(v=hWe,b=cWe,w=tV(w)):(v=PTe,b=ETe);let x=!1;for(const k of v){const q=s[k];yr(q)?x?s[k]=b[k]:s[k]=w[k]:x=!0}const S=_?kje(s,o,a):u?zje(s):K2e(s),E=S||eTe(s);if(E)return er.invalid(E);const A=_?lle(s,o,a):u?cle(s):s,[O,L]=g5(A,c,i),z=new er({ts:O,zone:i,o:L,loc:n});return s.weekday&&f&&e.weekday!==z.weekday?er.invalid("mismatched weekday",`you can't specify both a weekday of ${s.weekday} and a date of ${z.toISO()}`):z}static fromISO(e,r={}){const[i,n]=OHe(e);return bP(i,n,r,"ISO 8601",e)}static fromRFC2822(e,r={}){const[i,n]=RHe(e);return bP(i,n,r,"RFC 2822",e)}static fromHTTP(e,r={}){const[i,n]=$He(e);return bP(i,n,r,"HTTP",r)}static fromFormat(e,r,i={}){if(yr(e)||yr(r))throw new Nc("fromFormat requires an input string and a format");const{locale:n=null,numberingSystem:s=null}=i,o=un.fromOpts({locale:n,numberingSystem:s,defaultToEN:!0}),[a,l,c,u]=aWe(o,e,r);return u?er.invalid(u):bP(a,l,i,`format ${r}`,e,c)}static fromString(e,r,i={}){return er.fromFormat(e,r,i)}static fromSQL(e,r={}){const[i,n]=zHe(e);return bP(i,n,r,"SQL",e)}static invalid(e,r=null){if(!e)throw new Nc("need to specify a reason the DateTime is invalid");const i=e instanceof Fp?e:new Fp(e,r);if(Gs.throwOnInvalid)throw new fje(i);return new er({invalid:i})}static isDateTime(e){return e&&e.isLuxonDateTime||!1}static parseFormatForOpts(e,r={}){const i=STe(e,un.fromObject(r));return i?i.map(n=>n?n.val:null).join(""):null}static expandFormat(e,r={}){return xTe(gl.parseFormat(e),un.fromObject(r)).map(n=>n.val).join("")}get(e){return this[e]}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?nV(this).weekYear:NaN}get weekNumber(){return this.isValid?nV(this).weekNumber:NaN}get weekday(){return this.isValid?nV(this).weekday:NaN}get isWeekend(){return this.isValid&&this.loc.getWeekendDays().includes(this.weekday)}get localWeekday(){return this.isValid?sV(this).weekday:NaN}get localWeekNumber(){return this.isValid?sV(this).weekNumber:NaN}get localWeekYear(){return this.isValid?sV(this).weekYear:NaN}get ordinal(){return this.isValid?tV(this.c).ordinal:NaN}get monthShort(){return this.isValid?tD.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?tD.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?tD.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?tD.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return this.isOffsetFixed?!1:this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset}getPossibleOffsets(){if(!this.isValid||this.isOffsetFixed)return[this];const e=864e5,r=6e4,i=m9(this.c),n=this.zone.offset(i-e),s=this.zone.offset(i+e),o=this.zone.offset(i-n*r),a=this.zone.offset(i-s*r);if(o===a)return[this];const l=i-o*r,c=i-a*r,u=nD(l,o),h=nD(c,a);return u.hour===h.hour&&u.minute===h.minute&&u.second===h.second&&u.millisecond===h.millisecond?[Kv(this,{ts:l}),Kv(this,{ts:c})]:[this]}get isInLeapYear(){return $I(this.year)}get daysInMonth(){return h6(this.year,this.month)}get daysInYear(){return this.isValid?BC(this.year):NaN}get weeksInWeekYear(){return this.isValid?x$(this.weekYear):NaN}get weeksInLocalWeekYear(){return this.isValid?x$(this.localWeekYear,this.loc.getMinDaysInFirstWeek(),this.loc.getStartOfWeek()):NaN}resolvedLocaleOptions(e={}){const{locale:r,numberingSystem:i,calendar:n}=gl.create(this.loc.clone(e),e).resolvedOptions(this);return{locale:r,numberingSystem:i,outputCalendar:n}}toUTC(e=0,r={}){return this.setZone(_l.instance(e),r)}toLocal(){return this.setZone(Gs.defaultZone)}setZone(e,{keepLocalTime:r=!1,keepCalendarTime:i=!1}={}){if(e=l1(e,Gs.defaultZone),e.equals(this.zone))return this;if(e.isValid){let n=this.ts;if(r||i){const s=e.offset(this.ts),o=this.toObject();[n]=g5(o,s,e)}return Kv(this,{ts:n,zone:e})}else return er.invalid(iD(e))}reconfigure({locale:e,numberingSystem:r,outputCalendar:i}={}){const n=this.loc.clone({locale:e,numberingSystem:r,outputCalendar:i});return Kv(this,{loc:n})}setLocale(e){return this.reconfigure({locale:e})}set(e){if(!this.isValid)return this;const r=d6(e,Sle),{minDaysInFirstWeek:i,startOfWeek:n}=ule(r,this.loc),s=!yr(r.weekYear)||!yr(r.weekNumber)||!yr(r.weekday),o=!yr(r.ordinal),a=!yr(r.year),l=!yr(r.month)||!yr(r.day),c=a||l,u=r.weekYear||r.weekNumber;if((c||o)&&u)throw new iC("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(l&&o)throw new iC("Can't mix ordinal dates with month/day");let h;s?h=lle({...u6(this.c,i,n),...r},i,n):yr(r.ordinal)?(h={...this.toObject(),...r},yr(r.day)&&(h.day=Math.min(h6(h.year,h.month),h.day))):h=cle({...tV(this.c),...r});const[p,f]=g5(h,this.o,this.zone);return Kv(this,{ts:p,o:f})}plus(e){if(!this.isValid)return this;const r=Ti.fromDurationLike(e);return Kv(this,xle(this,r))}minus(e){if(!this.isValid)return this;const r=Ti.fromDurationLike(e).negate();return Kv(this,xle(this,r))}startOf(e,{useLocaleWeeks:r=!1}={}){if(!this.isValid)return this;const i={},n=Ti.normalizeUnit(e);switch(n){case"years":i.month=1;case"quarters":case"months":i.day=1;case"weeks":case"days":i.hour=0;case"hours":i.minute=0;case"minutes":i.second=0;case"seconds":i.millisecond=0;break}if(n==="weeks")if(r){const s=this.loc.getStartOfWeek(),{weekday:o}=this;o<s&&(i.weekNumber=this.weekNumber-1),i.weekday=s}else i.weekday=1;if(n==="quarters"){const s=Math.ceil(this.month/3);i.month=(s-1)*3+1}return this.set(i)}endOf(e,r){return this.isValid?this.plus({[e]:1}).startOf(e,r).minus(1):this}toFormat(e,r={}){return this.isValid?gl.create(this.loc.redefaultToEN(r)).formatDateTimeFromString(this,e):iV}toLocaleString(e=c6,r={}){return this.isValid?gl.create(this.loc.clone(r),e).formatDateTime(this):iV}toLocaleParts(e={}){return this.isValid?gl.create(this.loc.clone(e),e).formatDateTimeParts(this):[]}toISO({format:e="extended",suppressSeconds:r=!1,suppressMilliseconds:i=!1,includeOffset:n=!0,extendedZone:s=!1}={}){if(!this.isValid)return null;const o=e==="extended";let a=oV(this,o);return a+="T",a+=Tle(this,o,r,i,n,s),a}toISODate({format:e="extended"}={}){return this.isValid?oV(this,e==="extended"):null}toISOWeekDate(){return sD(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:e=!1,suppressSeconds:r=!1,includeOffset:i=!0,includePrefix:n=!1,extendedZone:s=!1,format:o="extended"}={}){return this.isValid?(n?"T":"")+Tle(this,o==="extended",r,e,i,s):null}toRFC2822(){return sD(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return sD(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?oV(this,!0):null}toSQLTime({includeOffset:e=!0,includeZone:r=!1,includeOffsetSpace:i=!0}={}){let n="HH:mm:ss.SSS";return(r||e)&&(i&&(n+=" "),r?n+="z":e&&(n+="ZZ")),sD(this,n,!0)}toSQL(e={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(e)}`:null}toString(){return this.isValid?this.toISO():iV}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`DateTime { ts: ${this.toISO()}, zone: ${this.zone.name}, locale: ${this.locale} }`:`DateTime { Invalid, reason: ${this.invalidReason} }`}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(e={}){if(!this.isValid)return{};const r={...this.c};return e.includeConfig&&(r.outputCalendar=this.outputCalendar,r.numberingSystem=this.loc.numberingSystem,r.locale=this.loc.locale),r}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(e,r="milliseconds",i={}){if(!this.isValid||!e.isValid)return Ti.invalid("created by diffing an invalid DateTime");const n={locale:this.locale,numberingSystem:this.numberingSystem,...i},s=Vje(r).map(Ti.normalizeUnit),o=e.valueOf()>this.valueOf(),a=o?this:e,l=o?e:this,c=WHe(a,l,s,n);return o?c.negate():c}diffNow(e="milliseconds",r={}){return this.diff(er.now(),e,r)}until(e){return this.isValid?Cs.fromDateTimes(this,e):this}hasSame(e,r,i){if(!this.isValid)return!1;const n=e.valueOf(),s=this.setZone(e.zone,{keepLocalTime:!0});return s.startOf(r,i)<=n&&n<=s.endOf(r,i)}equals(e){return this.isValid&&e.isValid&&this.valueOf()===e.valueOf()&&this.zone.equals(e.zone)&&this.loc.equals(e.loc)}toRelative(e={}){if(!this.isValid)return null;const r=e.base||er.fromObject({},{zone:this.zone}),i=e.padding?this<r?-e.padding:e.padding:0;let n=["years","months","days","hours","minutes","seconds"],s=e.unit;return Array.isArray(e.unit)&&(n=e.unit,s=void 0),Ele(r,this.plus(i),{...e,numeric:"always",units:n,unit:s})}toRelativeCalendar(e={}){return this.isValid?Ele(e.base||er.fromObject({},{zone:this.zone}),this,{...e,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...e){if(!e.every(er.isDateTime))throw new Nc("min requires all arguments be DateTimes");return hle(e,r=>r.valueOf(),Math.min)}static max(...e){if(!e.every(er.isDateTime))throw new Nc("max requires all arguments be DateTimes");return hle(e,r=>r.valueOf(),Math.max)}static fromFormatExplain(e,r,i={}){const{locale:n=null,numberingSystem:s=null}=i,o=un.fromOpts({locale:n,numberingSystem:s,defaultToEN:!0});return TTe(o,e,r)}static fromStringExplain(e,r,i={}){return er.fromFormatExplain(e,r,i)}static get DATE_SHORT(){return c6}static get DATE_MED(){return O2e}static get DATE_MED_WITH_WEEKDAY(){return yje}static get DATE_FULL(){return R2e}static get DATE_HUGE(){return $2e}static get TIME_SIMPLE(){return I2e}static get TIME_WITH_SECONDS(){return L2e}static get TIME_WITH_SHORT_OFFSET(){return D2e}static get TIME_WITH_LONG_OFFSET(){return N2e}static get TIME_24_SIMPLE(){return F2e}static get TIME_24_WITH_SECONDS(){return k2e}static get TIME_24_WITH_SHORT_OFFSET(){return z2e}static get TIME_24_WITH_LONG_OFFSET(){return U2e}static get DATETIME_SHORT(){return B2e}static get DATETIME_SHORT_WITH_SECONDS(){return V2e}static get DATETIME_MED(){return G2e}static get DATETIME_MED_WITH_SECONDS(){return j2e}static get DATETIME_MED_WITH_WEEKDAY(){return _je}static get DATETIME_FULL(){return H2e}static get DATETIME_FULL_WITH_SECONDS(){return W2e}static get DATETIME_HUGE(){return q2e}static get DATETIME_HUGE_WITH_SECONDS(){return Y2e}}function wP(t){if(er.isDateTime(t))return t;if(t&&t.valueOf&&Ex(t.valueOf()))return er.fromJSDate(t);if(t&&typeof t=="object")return er.fromObject(t);throw new Nc(`Unknown datetime argument: ${t}, of type ${typeof t}`)}const og="system",Iee="unknown",T$="UTC",pWe=Intl.DateTimeFormat().resolvedOptions().timeZone,fWe="shortOffset";function mWe(t){return"timeZoneIANA"in t}function gWe(t){return t.startsWith("UTC")}function zFt(t,e=!1){return{json:{read:{source:t,reader:(r,i)=>i[t]?yWe(i[t]):null},write:!!e&&{allowNull:!0,writer(r,i){i[t]=r?_We(r):null}}}}}function yWe(t,e=og){return t?mWe(t)?t.timeZoneIANA:vWe(t,e):e}function _We(t){return{timeZoneIANA:t}}function vWe(t,e=og){if(!t||!Jae.has(t.timeZone))return e;const r=Jae.get(t.timeZone);return gWe(t.timeZone)||t.respectsDaylightSaving?r:bWe(r)}function bWe(t){const e=er.local().setZone(t),r=Math.min(e.set({month:1,day:1}).offset,e.set({month:5}).offset);return r===0?"Etc/UTC":`Etc/GMT${_l.instance(-r).formatOffset(0,"narrow")}`}function UFt(t,e,r,i,n){if(e&&n==="date")return{timeZone:T$,timeZoneName:void 0};const s=i.timeStyle||i.hour,o=r===Iee;return{timeZone:o?n==="timestamp-offset"?void 0:t??T$:r,timeZoneName:o&&s?fWe:void 0}}const wWe={year:void 0,month:void 0,day:void 0,weekday:void 0},xWe={hour:void 0,minute:void 0,second:void 0},ATe={timeZone:T$},Sf={year:"numeric",month:"numeric",day:"numeric"},xP={year:"numeric",month:"long",day:"numeric"},TP={year:"numeric",month:"short",day:"numeric"},SP={year:"numeric",month:"long",weekday:"long",day:"numeric"},Z_={hour:"numeric",minute:"numeric"},jb={...Z_,second:"numeric"},MTe={hourCycle:"h23"},CP={...Z_,...MTe},EP={...jb,...MTe},OTe={"short-date":Sf,"short-date-short-time":{...Sf,...Z_},"short-date-short-time-24":{...Sf,...CP},"short-date-long-time":{...Sf,...jb},"short-date-long-time-24":{...Sf,...EP},"short-date-le":Sf,"short-date-le-short-time":{...Sf,...Z_},"short-date-le-short-time-24":{...Sf,...CP},"short-date-le-long-time":{...Sf,...jb},"short-date-le-long-time-24":{...Sf,...EP},"long-month-day-year":xP,"long-month-day-year-short-time":{...xP,...Z_},"long-month-day-year-short-time-24":{...xP,...CP},"long-month-day-year-long-time":{...xP,...jb},"long-month-day-year-long-time-24":{...xP,...EP},"day-short-month-year":TP,"day-short-month-year-short-time":{...TP,...Z_},"day-short-month-year-short-time-24":{...TP,...CP},"day-short-month-year-long-time":{...TP,...jb},"day-short-month-year-long-time-24":{...TP,...EP},"long-date":SP,"long-date-short-time":{...SP,...Z_},"long-date-short-time-24":{...SP,...CP},"long-date-long-time":{...SP,...jb},"long-date-long-time-24":{...SP,...EP},"long-month-year":{month:"long",year:"numeric"},"short-month-year":{month:"short",year:"numeric"},year:{year:"numeric"},"short-time":Z_,"long-time":jb},TWe=ac()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"}),RTe={ar:"ar-u-nu-latn-ca-gregory"};let QW=new WeakMap;const _9=OTe["short-date-short-time"];function SWe(t){let e=QW.get(t);if(!e){const r=Hu(),i=RTe[r]||r,n=Lee(t.timeZone??og),s={...t,timeZone:n};e=new Intl.DateTimeFormat(i,s),QW.set(t,e)}return e}function CWe(t){return OTe[t]}function v9(t,e=_9){return SWe(e).format(t)}function BFt(t,e=_9){return v9(new Date(t),{...e,...ATe,...xWe})}function VFt(t,e=_9){return v9(new Date(`1970-01-01T${t}Z`),{...e,...ATe,...wWe})}function GFt(t,e=_9){if(e.timeZone)return v9(new Date(t),e);const r=er.fromISO(t,{setZone:!0}),i=Hu(),n=RTe[i]??i,s=r.offset===0?T$:e.timeZone,o={...e,timeZone:s};return r.toLocaleString(o,{locale:n})}function Lee(t){switch(t){case og:return pWe;case Iee:return T$;default:return t}}eee(()=>{QW=new WeakMap});const EWe={ar:"ar-u-nu-latn"};let y5=new WeakMap,$Te={};function PWe(t){const e=t||$Te;if(!y5.has(e)){const r=Hu(),i=EWe[Hu()]||r;y5.set(e,new Intl.NumberFormat(i,t))}return y5.get(e)}function jFt(t={}){const e={};return t.digitSeparator!=null&&(e.useGrouping=t.digitSeparator),t.places!=null&&(e.minimumFractionDigits=e.maximumFractionDigits=t.places),e}function AWe(t,e){return Object.is(t,-0)&&(t=0),PWe(e).format(t)}eee(()=>{y5=new WeakMap,$Te={}});async function MWe(t,e,r,i){const n=e.exec(r);if(!n)throw new K("esri-intl:invalid-bundle",`Bundle id "${r}" is not compatible with the pattern "${e}"`);const s=n[1]?`${n[1]}/`:"",o=n[2],a=BVe(i),l=`${s}${o}.json`,c=a?`${s}${o}_${a}.json`:l;let u;try{u=await Ale(t(c))}catch(h){if(c===l)throw new K("intl:unknown-bundle",`Bundle "${r}" cannot be loaded`,{error:h});try{u=await Ale(t(l))}catch(p){throw new K("intl:unknown-bundle",`Bundle "${r}" cannot be loaded`,{error:p})}}return u}async function Ale(t){if(Mle.fetchBundleAsset!=null)return Mle.fetchBundleAsset(t);const e=await Xi(t,{responseType:"text"});return JSON.parse(e.data)}let OWe=class{constructor({base:e="",pattern:r,location:i=new URL(window.location.href)}){let n;n=typeof i=="string"?s=>new URL(s,new URL(i,window.location.href)).href:i instanceof URL?s=>new URL(s,i).href:i,this.pattern=typeof r=="string"?new RegExp(`^${r}`):r,this.getAssetUrl=n,e=e?e.endsWith("/")?e:e+"/":"",this.matcher=new RegExp(`^${e}(?:(.*)/)?(.*)$`)}fetchMessageBundle(e,r){return MWe(this.getAssetUrl,this.matcher,e,r)}};function RWe(t){return new OWe(t)}const Mle={};UVe(RWe({pattern:"esri/",location:ii}));const $We={};function IWe(t){var r;const e={async:t.async,isDebug:t.isDebug,locale:t.locale,baseUrl:t.baseUrl,has:{...t.has},map:{...t.map},packages:((r=t.packages)==null?void 0:r.concat())||[],paths:{...t.paths}};return t.hasOwnProperty("async")||(e.async=!0),t.hasOwnProperty("isDebug")||(e.isDebug=!1),t.baseUrl||(e.baseUrl=$We.baseUrl),e}let LWe=class{constructor(){const e=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(r=>{this[r]=(...i)=>e[r](...i)})}},_5=class{constructor(){this._dispatcher=new LWe,this._workerPostMessage({type:na.HANDSHAKE})}terminate(){}get onmessage(){return this._onmessageHandler}set onmessage(e){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=e,e&&this.addEventListener("message",e)}get onmessageerror(){return this._onmessageerrorHandler}set onmessageerror(e){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=e,e&&this.addEventListener("messageerror",e)}get onerror(){return this._onerrorHandler}set onerror(e){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=e,e&&this.addEventListener("error",e)}postMessage(e){SE(()=>{this._workerMessageHandler(new MessageEvent("message",{data:e}))})}dispatchEvent(e){return this._dispatcher.dispatchEvent(e)}addEventListener(e,r,i){this._dispatcher.addEventListener(e,r,i)}removeEventListener(e,r,i){this._dispatcher.removeEventListener(e,r,i)}_workerPostMessage(e){SE(()=>{this.dispatchEvent(new MessageEvent("message",{data:e}))})}async _workerMessageHandler(e){const r=w$(e);if(r&&r.type===na.OPEN){const{modulePath:i,jobId:n}=r;let s=await av.loadWorker(i);s||(s=await ge(()=>import(i),__vite__mapDeps([])));const o=av.connect(s);this._workerPostMessage({type:na.OPENED,jobId:n,data:o})}}};const KW=()=>re.getLogger("esri.core.workers.workerFactory"),{HANDSHAKE:DWe}=na,NWe='let globalId=0;const outgoing=new Map,configuration=JSON.parse("{CONFIGURATION}");self.esriConfig=configuration.esriConfig;const workerPath=self.esriConfig.workers.workerPath,HANDSHAKE=0,OPEN=1,OPENED=2,RESPONSE=3,INVOKE=4,ABORT=5;function createAbortError(){const e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,o,r){const t=r&&r.signal,n=globalId++;return new Promise(((r,s)=>{if(t){if(t.aborted)return s(createAbortError());t.addEventListener("abort",(()=>{outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:ABORT,jobId:n}),s(createAbortError()))}))}outgoing.set(n,{resolve:r,reject:s}),self.postMessage({type:INVOKE,jobId:n,methodName:e,abortable:null!=t,data:o})}))}let workerRevisionChecked=!1;function checkWorkerRevision(e){if(!workerRevisionChecked&&e.kernelInfo){workerRevisionChecked=!0;const{revision:o,fullVersion:r}=configuration.kernelInfo,{revision:t,fullVersion:n,version:s}=e.kernelInfo;esriConfig.assetsPath!==esriConfig.defaultAssetsPath&&o!==t&&console.warn(`Version mismatch detected between ArcGIS Maps SDK for JavaScript modules and assets. For more information visit https://bit.ly/3QnsuSo.\\nModules version: ${r}\\nAssets version: ${n??s}\\nAssets path: ${esriConfig.assetsPath}`)}}function messageHandler(e){const o=receiveMessage(e);if(!o)return;const r=o.jobId;switch(o.type){case OPEN:let n;function t(e){const o=n.connect(e);self.postMessage({type:OPENED,jobId:r,data:o},[o])}"function"==typeof define&&define.amd?require([workerPath],(e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||new Promise((e=>{require([o.modulePath],e)})))).then(t)})):"System"in self&&"function"==typeof System.import?System.import(workerPath).then((e=>(n=e.default,checkWorkerRevision(n),n.loadWorker(o.modulePath)))).then((e=>e||System.import(o.modulePath))).then(t):esriConfig.workers.useDynamicImport?import(workerPath).then((e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||import(o.modulePath))).then(t)})):(self.RemoteClient||importScripts(workerPath),n=self.RemoteClient.default||self.RemoteClient,checkWorkerRevision(n),n.loadWorker(o.modulePath).then(t));break;case RESPONSE:if(outgoing.has(r)){const s=outgoing.get(r);outgoing.delete(r),o.error?s.reject(JSON.parse(o.error)):s.resolve(o.data)}}}self.dojoConfig=configuration.loaderConfig,esriConfig.workers.loaderUrl&&(self.importScripts(esriConfig.workers.loaderUrl),"function"==typeof require&&"function"==typeof require.config&&require.config(configuration.loaderConfig)),self.addEventListener("message",messageHandler),self.postMessage({type:0});';let oD,aD;const Ole="Failed to create Worker. Fallback to execute module in main thread";async function FWe(){if(!se("esri-workers"))return Rle(new _5);if(!oD&&!aD)try{const e=NWe.split('"{CONFIGURATION}"').join(`'${kWe()}'`);oD=URL.createObjectURL(new Blob([e],{type:"text/javascript"}))}catch(e){aD=e||{}}let t;if(oD)try{t=new Worker(oD,{name:"esri-worker-"+zWe++})}catch{KW().warn(Ole,aD),t=new _5}else KW().warn(Ole,aD),t=new _5;return Rle(t)}async function Rle(t){return new Promise(e=>{function r(n){const s=w$(n);s&&s.type===DWe&&(t.removeEventListener("message",r),t.removeEventListener("error",i),e(t))}function i(n){n.preventDefault(),t.removeEventListener("message",r),t.removeEventListener("error",i),KW().warn("Failed to create Worker. Fallback to execute module in main thread",n),(t=new _5).addEventListener("message",r),t.addEventListener("error",i)}t.addEventListener("message",r),t.addEventListener("error",i)})}function kWe(){let t;if(mi.default!=null){const n={...mi};delete n.default,t=JSON.parse(JSON.stringify(n))}else t=JSON.parse(JSON.stringify(mi));t.assetsPath=Du(t.assetsPath),t.defaultAssetsPath=t.defaultAssetsPath?Du(t.defaultAssetsPath):void 0,t.request.interceptors=[],t.log.interceptors=[],t.locale=Hu(),t.has={"esri-csp-restrictions":se("esri-csp-restrictions"),"esri-2d-debug":!1,"esri-2d-update-debug":se("esri-2d-update-debug"),"esri-2d-log-updating":se("esri-2d-log-updating"),"featurelayer-pbf":se("featurelayer-pbf"),"featurelayer-fast-triangulation-enabled":se("featurelayer-fast-triangulation-enabled"),"featurelayer-simplify-thresholds":se("featurelayer-simplify-thresholds"),"featurelayer-simplify-payload-size-factors":se("featurelayer-simplify-payload-size-factors"),"featurelayer-simplify-mobile-factor":se("featurelayer-simplify-mobile-factor"),"featurelayer-query-max-depth":se("featurelayer-query-max-depth"),"featurelayer-query-pausing-enabled":se("featurelayer-query-pausing-enabled"),"featurelayer-snapshot-enabled":se("featurelayer-snapshot-enabled"),"esri-atomics":se("esri-atomics"),"esri-shared-array-buffer":se("esri-shared-array-buffer"),"esri-tiles-debug":se("esri-tiles-debug"),"esri-workers-arraybuffer-transfer":se("esri-workers-arraybuffer-transfer"),"feature-polyline-generalization-factor":se("feature-polyline-generalization-factor"),"host-webworker":1},t.workers.loaderUrl&&(t.workers.loaderUrl=Du(t.workers.loaderUrl)),t.workers.workerPath?t.workers.workerPath=Du(t.workers.workerPath):t.workers.workerPath=Du(ii("esri/core/workers/RemoteClient.js")),t.workers.useDynamicImport=!1;const e=mi.workers.loaderConfig,r=IWe({baseUrl:e==null?void 0:e.baseUrl,locale:Hu(),has:{"csp-restrictions":1,"dojo-test-sniff":0,"host-webworker":1,...e==null?void 0:e.has},map:{...e==null?void 0:e.map},paths:{...e==null?void 0:e.paths},packages:(e==null?void 0:e.packages)||[]});return JSON.stringify({esriConfig:t,loaderConfig:r,kernelInfo:{buildDate:Cwe,fullVersion:HK,revision:Ewe}})}let zWe=0;const{ABORT:$le,INVOKE:UWe,OPEN:BWe,OPENED:VWe,RESPONSE:PP}=na;let GWe=class ITe{static async create(e){const r=await FWe();return new ITe(r,e)}constructor(e,r){this._outJobs=new Map,this._inJobs=new Map,this.worker=e,this.id=r,e.addEventListener("message",this._onMessage.bind(this)),e.addEventListener("error",i=>{i.preventDefault(),re.getLogger("esri.core.workers.WorkerOwner").error(i)})}terminate(){this.worker.terminate()}async open(e,r={}){const{signal:i}=r,n=A2e();return new Promise((s,o)=>{const a={resolve:s,reject:o,abortHandle:Dz(i,()=>{this._outJobs.delete(n),this._post({type:$le,jobId:n})})};this._outJobs.set(n,a),this._post({type:BWe,jobId:n,modulePath:e})})}_onMessage(e){const r=w$(e);if(r)switch(r.type){case VWe:this._onOpenedMessage(r);break;case PP:this._onResponseMessage(r);break;case $le:this._onAbortMessage(r);break;case UWe:this._onInvokeMessage(r)}}_onAbortMessage(e){const r=this._inJobs,i=e.jobId,n=r.get(i);n&&(n.controller&&n.controller.abort(),r.delete(i))}_onInvokeMessage(e){const{methodName:r,jobId:i,data:n,abortable:s}=e,o=s?new AbortController:null,a=this._inJobs,l=pje[r];let c;try{if(typeof l!="function")throw new TypeError(`${r} is not a function`);c=l.call(null,n,{signal:o?o.signal:null})}catch(u){return void this._post({type:PP,jobId:i,error:b$(u)})}nu(c)?(a.set(i,{controller:o,promise:c}),c.then(u=>{a.has(i)&&(a.delete(i),this._post({type:PP,jobId:i},u))},u=>{a.has(i)&&(a.delete(i),u||(u={message:"Error encountered at method"+r}),_s(u)||this._post({type:PP,jobId:i,error:b$(u||{message:`Error encountered at method ${r}`})}))})):this._post({type:PP,jobId:i},c)}_onOpenedMessage(e){const{jobId:r,data:i}=e,n=this._outJobs.get(r);n&&(this._outJobs.delete(r),wi(n.abortHandle),n.resolve(i))}_onResponseMessage(e){const{jobId:r,error:i,data:n}=e,s=this._outJobs.get(r);s&&(this._outJobs.delete(r),wi(s.abortHandle),i?s.reject(K.fromJSON(JSON.parse(i))):s.resolve(n))}_post(e,r,i){return See(this.worker,e,r,i)}};const Ile=se("host-browser")?Math.min(navigator.hardwareConcurrency-1,se("workers-pool-size")):0;let ax=se("esri-mobile")?Math.min(Ile,3):Ile;ax||(ax=se("safari")&&se("mac")?7:2);let Lle=0;const v5=[];function jWe(){LTe()}async function lD(t,e){const r=new dje,{registryTarget:i,...n}=e;return await r.open(t,n),i&&rje(i,r),r}async function HWe(t,e={}){if(typeof t!="string")throw new K("workers:undefined-module","modulePath is missing");let r=e.strategy||"distributed";if(se("host-webworker")&&!se("esri-workers")&&(r="local"),r==="local"){let i=await av.loadWorker(t);i||(i=await ge(()=>import(t),__vite__mapDeps([]))),vt(e.signal);const n=e.client||i;return lD([av.connect(i)],{...e,client:n})}if(await LTe(),vt(e.signal),r==="dedicated"){const i=Lle++%ax;return lD([await v5[i].open(t,e)],e)}if(e.maxNumWorkers&&e.maxNumWorkers>0){const i=Math.min(e.maxNumWorkers,ax);if(i<ax){const n=new Array(i);for(let s=0;s<i;++s){const o=Lle++%ax;n[s]=v5[o].open(t,e)}return lD(n,e)}}return lD(v5.map(i=>i.open(t,e)),e)}let cD=null;async function LTe(){if(cD)return cD;new AbortController;const t=[];for(let e=0;e<ax;e++){const r=GWe.create(e).then(i=>(v5[e]=i,i));t.push(r)}return cD=Promise.all(t),cD}function DTe(t,e){const r=rg(t),i=rg(e),n=r.store,s=i.store,o=i.metadata;for(const a in o){const l=o[a],c=n.originOf(a),u=s.originOf(a);if(!l.readOnly&&u!==oi.DEFAULTS)if(c===oi.DEFAULTS)t.set(a,s.get(a));else{const h=n.get(a),p=s.get(a);h&&p&&p instanceof Ae&&h instanceof Ae&&h instanceof p.constructor&&DTe(h,p)}}}let YO=class extends $t{constructor(e){super(e),this.addHandles([this.on("before-add",r=>{r.item==null&&r.preventDefault()}),this.on("after-add",r=>this._own(r.item)),this.on("after-remove",r=>this._release(r.item))])}get owner(){return this._get("owner")}set owner(e){e!==this._get("owner")&&(this._releaseAll(),this._set("owner",e),this._ownAll())}_ownAll(){for(const e of this.items)this._own(e)}_releaseAll(){for(const e of this.items)this._release(e)}_createNewInstance(e){return this.itemType?new($t.ofType(this.itemType.Type))(e):new $t(e)}};function p6(t,e){return{type:t,cast:Dwe,set(r){const i=Xx(r,this._get(e),t);i.owner=this,this._set(e,i)}}}d([m()],YO.prototype,"owner",null),YO=d([V("esri.core.support.OwningCollection")],YO);var kA;const f6=ac()({orthometric:"gravity-related-height",gravity_related_height:"gravity-related-height",ellipsoidal:"ellipsoidal"}),NTe=f6.jsonValues.slice();t$(NTe,"orthometric");const XO=ac()({meter:"meters",foot:"feet","us-foot":"us-feet","clarke-foot":"clarke-feet","clarke-yard":"clarke-yards","clarke-link":"clarke-links","sears-yard":"sears-yards","sears-foot":"sears-feet","sears-chain":"sears-chains","benoit-1895-b-chain":"benoit-1895-b-chains","indian-yard":"indian-yards","indian-1937-yard":"indian-1937-yards","gold-coast-foot":"gold-coast-feet","sears-1922-truncated-chain":"sears-1922-truncated-chains","50-kilometers":"50-kilometers","150-kilometers":"150-kilometers"});let Yd=kA=class extends ze{constructor(t){super(t),this.heightModel="gravity-related-height",this.heightUnit="meters",this.vertCRS=null}writeHeightModel(t,e,r){return f6.write(t,e,r)}readHeightModel(t,e,r){return f6.read(t)||(r!=null&&r.messages&&r.messages.push(WWe(t,{context:r})),null)}readHeightUnit(t,e,r){return XO.read(t)||(r!=null&&r.messages&&r.messages.push(Dle(t,{context:r})),null)}readHeightUnitService(t,e,r){return Qwe(t)||XO.read(t)||(r!=null&&r.messages&&r.messages.push(Dle(t,{context:r})),null)}readVertCRS(t,e){return e.vertCRS||e.ellipsoid||e.geoid}clone(){return new kA({heightModel:this.heightModel,heightUnit:this.heightUnit,vertCRS:this.vertCRS})}equals(t){return!!t&&(this===t||this.heightModel===t.heightModel&&this.heightUnit===t.heightUnit&&this.vertCRS===t.vertCRS)}static deriveUnitFromSR(t,e){const r=Kwe(e);return new kA({heightModel:t.heightModel,heightUnit:r??void 0,vertCRS:t.vertCRS})}write(t,e){return e={origin:"web-scene",...e},super.write(t,e)}static fromJSON(t){if(!t)return null;const e=new kA;return e.read(t,{origin:"web-scene"}),e}};function Dle(t,e){return new tv("height-unit:unsupported",`Height unit of value '${t}' is not supported`,e)}function WWe(t,e){return new tv("height-model:unsupported",`Height model of value '${t}' is not supported`,e)}d([m({type:f6.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:NTe,default:"ellipsoidal"}}}})],Yd.prototype,"heightModel",void 0),d([hr("web-scene","heightModel")],Yd.prototype,"writeHeightModel",null),d([Tr(["web-scene","service"],"heightModel")],Yd.prototype,"readHeightModel",null),d([m({type:XO.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:XO.jsonValues,write:XO.write}}}})],Yd.prototype,"heightUnit",void 0),d([Tr("web-scene","heightUnit")],Yd.prototype,"readHeightUnit",null),d([Tr("service","heightUnit")],Yd.prototype,"readHeightUnitService",null),d([m({type:String,constructOnly:!0,json:{origins:{"web-scene":{write:!0}}}})],Yd.prototype,"vertCRS",void 0),d([Tr("service","vertCRS",["vertCRS","ellipsoid","geoid"])],Yd.prototype,"readVertCRS",null),Yd=kA=d([V("esri.geometry.HeightModelInfo")],Yd);const DI=Yd,XFt=Math.PI/180,ZFt=/(?:SPHEROID|ELLIPSOID)\[([^\]]+)]/i,Uy=Yr.radius,Id=Yr.eccentricitySquared,qWe={a1:Uy*Id,a2:Uy*Id*Uy*Id,a3:Uy*Id*Id/2,a4:Uy*Id*Uy*Id*2.5,a5:Uy*Id+Uy*Id*Id/2,a6:1-Id},JFt={4267:{a:63782064e-1,f:1/294.9786982},4269:{a:6378137,f:1/298.257222101},4326:{a:Yr.radius,f:Yr.flattening},4490:{a:6378137,f:1/298.257222101},104900:{a:2439700,f:0},104901:{a:6051e3,f:0},104902:{a:6051800,f:0},104903:{a:K0.radius,f:K0.flattening},104904:{a:3393400,f:1/192.0430107526882},104905:{a:Yp.radius,f:Yp.flattening},104906:{a:6200,f:0},104907:{a:11100,f:0},104908:{a:71492e3,f:.06487439154031222},104909:{a:8200,f:0},104910:{a:83500,f:0},104911:{a:1e4,f:0},104912:{a:2409300,f:0},104913:{a:15e3,f:0},104914:{a:4e4,f:0},104915:{a:1562090,f:0},104916:{a:2632345,f:0},104917:{a:85e3,f:0},104918:{a:1821460,f:0},104919:{a:5e3,f:0},104920:{a:12e3,f:0},104921:{a:3e4,f:3},104922:{a:18e3,f:0},104923:{a:14e3,f:0},104924:{a:49300,f:0},104925:{a:60268e3,f:1/10.2079945799458},104926:{a:16e3,f:0},104927:{a:9500,f:0},104928:{a:56e4,f:0},104929:{a:249400,f:0},104930:{a:59500,f:0},104931:{a:16e3,f:0},104932:{a:133e3,f:0},104933:{a:718e3,f:0},104934:{a:888e3,f:0},104935:{a:1986300,f:0},104936:{a:1e4,f:0},104937:{a:41900,f:0},104938:{a:11e4,f:0},104939:{a:50100,f:0},104940:{a:764e3,f:0},104941:{a:11e3,f:0},104942:{a:529800,f:0},104943:{a:2575e3,f:0},104944:{a:25559e3,f:1/43.61604095563141},104945:{a:578900,f:0},104946:{a:33e3,f:0},104947:{a:21e3,f:0},104948:{a:13e3,f:0},104949:{a:31e3,f:0},104950:{a:27e3,f:0},104951:{a:42e3,f:0},104952:{a:235800,f:0},104953:{a:761400,f:0},104954:{a:15e3,f:0},104955:{a:54e3,f:0},104956:{a:77e3,f:0},104957:{a:27e3,f:0},104958:{a:788900,f:0},104959:{a:584700,f:0},104960:{a:24764e3,f:.01708124697141011},104961:{a:74e3,f:0},104962:{a:79e3,f:0},104963:{a:104e3,f:.14423076923076922},104964:{a:29e3,f:0},104965:{a:17e4,f:0},104966:{a:208e3,f:0},104967:{a:4e4,f:0},104968:{a:1352600,f:0},104969:{a:1195e3,f:0},104970:{a:593e3,f:0},104971:{a:Yp.radius,f:0},104972:{a:47e4,f:0},104973:{a:255e3,f:0},104974:{a:2439400,f:0}};var Q;(function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.SPHERICAL_ECEF=1]="SPHERICAL_ECEF",t[t.WGS84=2]="WGS84",t[t.WEB_MERCATOR=3]="WEB_MERCATOR",t[t.WGS84_ECEF=4]="WGS84_ECEF",t[t.CGCS2000=5]="CGCS2000",t[t.WGS84_COMPARABLE_LON_LAT=6]="WGS84_COMPARABLE_LON_LAT",t[t.SPHERICAL_MARS_PCPF=7]="SPHERICAL_MARS_PCPF",t[t.GCSMARS2000=8]="GCSMARS2000",t[t.SPHERICAL_MOON_PCPF=9]="SPHERICAL_MOON_PCPF",t[t.GCSMOON2000=10]="GCSMOON2000",t[t.LON_LAT=11]="LON_LAT",t[t.PLATE_CARREE=12]="PLATE_CARREE"})(Q||(Q={}));const nC={[Q.WGS84]:{[Q.CGCS2000]:null,[Q.GCSMARS2000]:null,[Q.GCSMOON2000]:null,[Q.LON_LAT]:zi,[Q.WGS84_COMPARABLE_LON_LAT]:zi,[Q.SPHERICAL_ECEF]:cx,[Q.SPHERICAL_MARS_PCPF]:null,[Q.SPHERICAL_MOON_PCPF]:null,[Q.UNKNOWN]:null,[Q.WEB_MERCATOR]:VE,[Q.PLATE_CARREE]:b1,[Q.WGS84]:zi,[Q.WGS84_ECEF]:x1},[Q.CGCS2000]:{[Q.CGCS2000]:zi,[Q.GCSMARS2000]:null,[Q.GCSMOON2000]:null,[Q.LON_LAT]:zi,[Q.WGS84_COMPARABLE_LON_LAT]:zi,[Q.SPHERICAL_ECEF]:cx,[Q.SPHERICAL_MARS_PCPF]:null,[Q.SPHERICAL_MOON_PCPF]:null,[Q.UNKNOWN]:null,[Q.WEB_MERCATOR]:null,[Q.PLATE_CARREE]:b1,[Q.WGS84]:null,[Q.WGS84_ECEF]:x1},[Q.GCSMARS2000]:{[Q.CGCS2000]:null,[Q.GCSMARS2000]:zi,[Q.GCSMOON2000]:null,[Q.LON_LAT]:zi,[Q.WGS84_COMPARABLE_LON_LAT]:null,[Q.SPHERICAL_ECEF]:null,[Q.SPHERICAL_MARS_PCPF]:tq,[Q.SPHERICAL_MOON_PCPF]:null,[Q.UNKNOWN]:null,[Q.WEB_MERCATOR]:null,[Q.PLATE_CARREE]:null,[Q.WGS84]:null,[Q.WGS84_ECEF]:null},[Q.GCSMOON2000]:{[Q.CGCS2000]:null,[Q.GCSMARS2000]:null,[Q.GCSMOON2000]:zi,[Q.LON_LAT]:zi,[Q.WGS84_COMPARABLE_LON_LAT]:null,[Q.SPHERICAL_ECEF]:null,[Q.SPHERICAL_MARS_PCPF]:null,[Q.SPHERICAL_MOON_PCPF]:eq,[Q.UNKNOWN]:null,[Q.WEB_MERCATOR]:null,[Q.PLATE_CARREE]:null,[Q.WGS84]:null,[Q.WGS84_ECEF]:null},[Q.WEB_MERCATOR]:{[Q.CGCS2000]:null,[Q.GCSMARS2000]:null,[Q.GCSMOON2000]:null,[Q.LON_LAT]:GC,[Q.WGS84_COMPARABLE_LON_LAT]:GC,[Q.SPHERICAL_ECEF]:kTe,[Q.SPHERICAL_MARS_PCPF]:null,[Q.SPHERICAL_MOON_PCPF]:null,[Q.UNKNOWN]:null,[Q.WEB_MERCATOR]:zi,[Q.PLATE_CARREE]:UTe,[Q.WGS84]:GC,[Q.WGS84_ECEF]:zTe},[Q.WGS84_ECEF]:{[Q.CGCS2000]:T1,[Q.GCSMARS2000]:null,[Q.GCSMOON2000]:null,[Q.LON_LAT]:T1,[Q.WGS84_COMPARABLE_LON_LAT]:T1,[Q.SPHERICAL_ECEF]:GTe,[Q.SPHERICAL_MARS_PCPF]:null,[Q.SPHERICAL_MOON_PCPF]:null,[Q.UNKNOWN]:null,[Q.WEB_MERCATOR]:jTe,[Q.PLATE_CARREE]:YWe,[Q.WGS84]:T1,[Q.WGS84_ECEF]:zi},[Q.SPHERICAL_ECEF]:{[Q.CGCS2000]:w1,[Q.GCSMARS2000]:null,[Q.GCSMOON2000]:null,[Q.LON_LAT]:w1,[Q.WGS84_COMPARABLE_LON_LAT]:w1,[Q.SPHERICAL_ECEF]:zi,[Q.SPHERICAL_MARS_PCPF]:null,[Q.SPHERICAL_MOON_PCPF]:null,[Q.UNKNOWN]:null,[Q.WEB_MERCATOR]:BTe,[Q.PLATE_CARREE]:XWe,[Q.WGS84]:w1,[Q.WGS84_ECEF]:VTe},[Q.SPHERICAL_MARS_PCPF]:{[Q.CGCS2000]:null,[Q.GCSMARS2000]:iq,[Q.GCSMOON2000]:null,[Q.LON_LAT]:iq,[Q.WGS84_COMPARABLE_LON_LAT]:null,[Q.SPHERICAL_ECEF]:null,[Q.SPHERICAL_MARS_PCPF]:zi,[Q.SPHERICAL_MOON_PCPF]:null,[Q.UNKNOWN]:null,[Q.WEB_MERCATOR]:null,[Q.PLATE_CARREE]:null,[Q.WGS84]:null,[Q.WGS84_ECEF]:null},[Q.SPHERICAL_MOON_PCPF]:{[Q.CGCS2000]:null,[Q.GCSMARS2000]:null,[Q.GCSMOON2000]:rq,[Q.LON_LAT]:rq,[Q.WGS84_COMPARABLE_LON_LAT]:null,[Q.SPHERICAL_ECEF]:null,[Q.SPHERICAL_MARS_PCPF]:null,[Q.SPHERICAL_MOON_PCPF]:zi,[Q.UNKNOWN]:null,[Q.WEB_MERCATOR]:null,[Q.PLATE_CARREE]:null,[Q.WGS84]:null,[Q.WGS84_ECEF]:null},[Q.UNKNOWN]:{[Q.CGCS2000]:null,[Q.GCSMARS2000]:null,[Q.GCSMOON2000]:null,[Q.LON_LAT]:null,[Q.WGS84_COMPARABLE_LON_LAT]:null,[Q.SPHERICAL_ECEF]:null,[Q.SPHERICAL_MARS_PCPF]:null,[Q.SPHERICAL_MOON_PCPF]:null,[Q.UNKNOWN]:zi,[Q.WEB_MERCATOR]:null,[Q.PLATE_CARREE]:null,[Q.WGS84]:null,[Q.WGS84_ECEF]:null},[Q.LON_LAT]:{[Q.CGCS2000]:zi,[Q.GCSMARS2000]:zi,[Q.GCSMOON2000]:zi,[Q.LON_LAT]:zi,[Q.WGS84_COMPARABLE_LON_LAT]:zi,[Q.SPHERICAL_ECEF]:cx,[Q.SPHERICAL_MARS_PCPF]:tq,[Q.SPHERICAL_MOON_PCPF]:eq,[Q.UNKNOWN]:null,[Q.WEB_MERCATOR]:VE,[Q.PLATE_CARREE]:b1,[Q.WGS84]:zi,[Q.WGS84_ECEF]:x1},[Q.WGS84_COMPARABLE_LON_LAT]:{[Q.CGCS2000]:null,[Q.GCSMARS2000]:null,[Q.GCSMOON2000]:null,[Q.LON_LAT]:zi,[Q.WGS84_COMPARABLE_LON_LAT]:zi,[Q.SPHERICAL_ECEF]:cx,[Q.SPHERICAL_MARS_PCPF]:null,[Q.SPHERICAL_MOON_PCPF]:null,[Q.UNKNOWN]:null,[Q.WEB_MERCATOR]:null,[Q.PLATE_CARREE]:b1,[Q.WGS84]:zi,[Q.WGS84_ECEF]:x1},[Q.PLATE_CARREE]:{[Q.CGCS2000]:lx,[Q.GCSMARS2000]:null,[Q.GCSMOON2000]:null,[Q.LON_LAT]:lx,[Q.WGS84_COMPARABLE_LON_LAT]:lx,[Q.SPHERICAL_ECEF]:ZWe,[Q.SPHERICAL_MARS_PCPF]:null,[Q.SPHERICAL_MOON_PCPF]:null,[Q.UNKNOWN]:null,[Q.WEB_MERCATOR]:JWe,[Q.PLATE_CARREE]:zi,[Q.WGS84]:lx,[Q.WGS84_ECEF]:QWe}};function FTe(t){const e=S$(t,HTe);return nC[e][Q.WGS84_COMPARABLE_LON_LAT]}function lv(t,e,r=kee()){return t==null||e==null?null:eqe(t,e,r).projector}function QFt(t,e){switch(lv(t,e,b9)){case zi:return"copy3";case cx:return"wgs84ToSphericalECEF";case VE:return"wgs84ToWebMercator";case b1:return"wgs84ToPlateCarree";case x1:return"wgs84ToWGS84ECEF";case GC:return"webMercatorToWGS84";case kTe:return"webMercatorToSphericalECEF";case zTe:return"webMercatorToWGS84ECEF";case UTe:return"webMercatorToPlateCarree";case T1:return"wgs84ECEFToWGS84";case GTe:return"wgs84ECEFToSphericalECEF";case jTe:return"wgs84ECEFToWebMercator";case w1:return"sphericalECEFToWGS84";case BTe:return"sphericalECEFToWebMercator";case iq:return"sphericalMarsPCPFToMars2000";case rq:return"sphericalMoonPCPFToMoon2000";case VTe:return"sphericalECEFToWGS84ECEF";case tq:return"mars2000ToSphericalPCPF";case eq:return"moon2000ToSphericalPCPF";default:return null}}function S$(t,e){return t?e.spatialReference===t?e.spatialReferenceId:(e.spatialReference=t,"metersPerUnit"in e&&(e.metersPerUnit=Ba(t,1)),Jk(t)?e.spatialReferenceId=Q.SPHERICAL_ECEF:u$(t)?e.spatialReferenceId=Q.WGS84:Zx(t)?e.spatialReferenceId=Q.WEB_MERCATOR:h$(t)?e.spatialReferenceId=Q.PLATE_CARREE:t.wkt===Ywe.wkt?e.spatialReferenceId=Q.WGS84_ECEF:t.wkid===Wh.CGCS2000?e.spatialReferenceId=Q.CGCS2000:t.wkt===Hz.wkt?e.spatialReferenceId=Q.SPHERICAL_MARS_PCPF:t.wkt===Wz.wkt?e.spatialReferenceId=Q.SPHERICAL_MOON_PCPF:Iv(t)?e.spatialReferenceId=Q.GCSMARS2000:Lv(t)?e.spatialReferenceId=Q.GCSMOON2000:e.spatialReferenceId=Q.UNKNOWN):Q.UNKNOWN}function zi(t,e,r,i){t!==r&&(r[i++]=t[e++],r[i++]=t[e++],r[i]=t[e])}function GC(t,e,r,i){r[i]=jE*(t[e]/Px),r[i+1]=jE*(WTe-2*Math.atan(Math.exp(-t[e+1]/Px))),r[i+2]=t[e+2]}function kTe(t,e,r,i){const n=t[e]/Px,s=WTe-2*Math.atan(Math.exp(-t[e+1]/Px)),o=Px+t[e+2],a=Math.cos(s)*o;r[i]=Math.cos(n)*a,r[i+1]=Math.sin(n)*a,r[i+2]=Math.sin(s)*o}function zTe(t,e,r,i){GC(t,e,r,i),x1(r,i,r,i)}function Dee(t,e,r,i,n){const s=.4999999*w9,o=we(GE*t[e+1],-s,s),a=Math.sin(o);r[i++]=GE*t[e]*n.radius,r[i++]=n.halfSemiMajorAxis*Math.log((1+a)/(1-a)),r[i]=t[e+2]}function VE(t,e,r,i){Dee(t,e,r,i,Yr)}function b1(t,e,r,i){r[i]=t[e]*Nle,r[i+1]=t[e+1]*Nle,r[i+2]=t[e+2]}function lx(t,e,r,i){r[i]=t[e]*Fle,r[i+1]=t[e+1]*Fle,r[i+2]=t[e+2]}function UTe(t,e,r,i){GC(t,e,r,i),b1(r,i,r,i)}function YWe(t,e,r,i){T1(t,e,r,i),b1(r,i,r,i)}function XWe(t,e,r,i){w1(t,e,r,i),b1(r,i,r,i)}function ZWe(t,e,r,i){lx(t,e,r,i),cx(r,i,r,i)}function JWe(t,e,r,i){lx(t,e,r,i),VE(r,i,r,i)}function QWe(t,e,r,i){lx(t,e,r,i),x1(r,i,r,i)}function Nee(t,e,r,i,n){const s=n+t[e+2],o=GE*t[e+1],a=GE*t[e],l=Math.cos(o)*s;r[i]=Math.cos(a)*l,r[i+1]=Math.sin(a)*l,r[i+2]=Math.sin(o)*s}function eq(t,e,r,i){Nee(t,e,r,i,K0.radius)}function tq(t,e,r,i){Nee(t,e,r,i,Yp.radius)}function cx(t,e,r,i){Nee(t,e,r,i,Yr.radius)}function Fee(t,e,r,i,n){const s=t[e],o=t[e+1],a=t[e+2],l=Math.sqrt(s*s+o*o+a*a),c=hd(a/(l===0?1:l)),u=Math.atan2(o,s);r[i++]=jE*u,r[i++]=jE*c,r[i]=l-n}function rq(t,e,r,i){Fee(t,e,r,i,K0.radius)}function iq(t,e,r,i){Fee(t,e,r,i,Yp.radius)}function w1(t,e,r,i){Fee(t,e,r,i,Yr.radius)}function BTe(t,e,r,i){w1(t,e,r,i),VE(r,i,r,i)}function VTe(t,e,r,i){w1(t,e,r,i),x1(r,i,r,i)}function KWe(t,e,r,i,n){const s=GE*t[e],o=GE*t[e+1],a=t[e+2],l=Math.sin(o),c=Math.cos(o),u=n.radius/Math.sqrt(1-n.eccentricitySquared*l*l);r[i++]=(u+a)*c*Math.cos(s),r[i++]=(u+a)*c*Math.sin(s),r[i++]=(u*(1-n.eccentricitySquared)+a)*l}function x1(t,e,r,i){KWe(t,e,r,i,Yr)}function T1(t,e,r,i){const n=qWe,s=t[e],o=t[e+1],a=t[e+2];let l,c,u,h,p,f,g,_,v,b,w,x,S,E,A,O,L,z,k,q,B;l=Math.abs(a),c=s*s+o*o,u=Math.sqrt(c),h=c+a*a,p=Math.sqrt(h),q=Math.atan2(o,s),f=a*a/h,g=c/h,E=n.a2/p,A=n.a3-n.a4/p,g>.3?(_=l/p*(1+g*(n.a1+E+f*A)/p),k=Math.asin(_),b=_*_,v=Math.sqrt(1-b)):(v=u/p*(1-f*(n.a5-E-g*A)/p),k=Math.acos(v),b=1-v*v,_=Math.sqrt(b)),w=1-Yr.eccentricitySquared*b,x=Yr.radius/Math.sqrt(w),S=n.a6*x,E=u-x*v,A=l-S*_,L=v*E+_*A,O=v*A-_*E,z=O/(S/w+L),k+=z,B=L+O*z/2,a<0&&(k=-k),r[i++]=jE*q,r[i++]=jE*k,r[i]=B}function GTe(t,e,r,i){T1(t,e,r,i),cx(r,i,r,i)}function jTe(t,e,r,i){T1(t,e,r,i),VE(r,i,r,i)}function eqe(t,e,r){if(t==null||e==null||r.source.spatialReference===t&&r.dest.spatialReference===e)return r;const i=S$(t,r.source),n=S$(e,r.dest);return i===Q.UNKNOWN&&n===Q.UNKNOWN?To(t,e)?r.projector=zi:r.projector=null:r.projector=nC[i][n],r}function kee(){return{source:{spatialReference:null,spatialReferenceId:Q.UNKNOWN,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:Q.UNKNOWN,metersPerUnit:1},projector:zi}}const HTe={spatialReference:null,spatialReferenceId:Q.UNKNOWN},tqe={spatialReference:null,spatialReferenceId:Q.UNKNOWN},b9=kee(),GE=Nt(1),jE=Fa(1),w9=Math.PI,WTe=.5*w9,Px=Yr.radius,Nle=Px*w9/180,Fle=180/(Px*w9);function Ji(t,e,r,i,n,s,o=1){const a=lv(e,n,b9);if(a==null)return!1;if(a===zi){if(t===i&&r===s)return!0;const c=r+3*o;for(let u=r,h=s;u<c;u++,h++)i[h]=t[u];return!0}const l=r+3*o;for(let c=r,u=s;c<l;c+=3,u+=3)a(t,c,i,u);return!0}const KFt=Object.freeze(Object.defineProperty({__proto__:null,projectBuffer:Ji},Symbol.toStringTag,{value:"Module"}));function kle(t,e,r,i,n,s){return uD[0]=t,uD[1]=e,uD[2]=r,Ji(uD,i,0,n,s,0,1)}const uD=C();let hD=0,aV=class nq{static fromGE(e){const r=new nq;return r._wkt=e.wkt,r._wkid=e.wkid,r._isInverse=e.isInverse,r}constructor(e){this.uid=hD++,e?(this._wkt=e.wkt!=null?e.wkt:null,this._wkid=e.wkid!=null?e.wkid:-1,this._isInverse=e.isInverse!=null&&e.isInverse===!0):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}get wkt(){return this._wkt}set wkt(e){this._wkt=e,this.uid=hD++}get wkid(){return this._wkid}set wkid(e){this._wkid=e,this.uid=hD++}get isInverse(){return this._isInverse}set isInverse(e){this._isInverse=e,this.uid=hD++}getInverse(){const e=new nq;return e._wkt=this.wkt,e._wkid=this._wkid,e._isInverse=!this.isInverse,e}},m6=class zA{static cacheKey(e,r){var i,n,s,o,a,l;return[((i=e.wkid)==null?void 0:i.toString())??"-1",((n=e.wkt)==null?void 0:n.toString())??"",((s=e.wkt2)==null?void 0:s.toString())??"",((o=r.wkid)==null?void 0:o.toString())??"-1",((a=r.wkt)==null?void 0:a.toString())??"",((l=r.wkt2)==null?void 0:l.toString())??""].join()}static fromGE(e){const r=new zA;let i="";for(const n of e.steps){const s=aV.fromGE(n);r.steps.push(s),i+=s.uid.toString()+","}return r._cachedProjection={},r._gtlistentry=null,r._chain=i,r}constructor(e){if(this.steps=[],this._cachedProjection={},this._chain="",this._gtlistentry=null,e==null?void 0:e.steps)for(const r of e.steps)r instanceof aV?this.steps.push(r):this.steps.push(new aV({wkid:r.wkid,wkt:r.wkt,isInverse:r.isInverse}))}getInverse(){const e=new zA;e.steps=[];for(let r=this.steps.length-1;r>=0;r--){const i=this.steps[r];e.steps.push(i.getInverse())}return e}getGTListEntry(){let e="";for(const r of this.steps)e+=r.uid.toString()+",";return e!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=e),this._gtlistentry}assignCachedGe(e,r,i){this._cachedProjection[zA.cacheKey(e,r)]=i}getCachedGeTransformation(e,r){let i="";for(const s of this.steps)i+=s.uid.toString()+",";i!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=i);const n=this._cachedProjection[zA.cacheKey(e,r)];return n===void 0?null:n}};function rqe(t,e,r){if(e==null||r==null||r.vcsWkid||To(e,r)||iv(e)||iv(r))return null;const i=p$(e)/p$(r);if(i===1)return null;switch(t){case"point":case"esriGeometryPoint":return n=>iqe(n,i);case"polyline":case"esriGeometryPolyline":return n=>sqe(n,i);case"polygon":case"esriGeometryPolygon":return n=>nqe(n,i);case"multipoint":case"esriGeometryMultipoint":return n=>oqe(n,i);case"extent":case"esriGeometryEnvelope":return n=>aqe(n,i);default:return null}}function iqe(t,e){(t==null?void 0:t.z)!=null&&(t.z*=e)}function nqe(t,e){if(t)for(const r of t.rings)for(const i of r)i.length>2&&(i[2]*=e)}function sqe(t,e){if(t)for(const r of t.paths)for(const i of r)i.length>2&&(i[2]*=e)}function oqe(t,e){if(t)for(const r of t.points)r.length>2&&(r[2]*=e)}function aqe(t,e){t&&t.zmin!=null&&t.zmax!=null&&(t.zmin*=e,t.zmax*=e)}let Zp=null,cv=null,ZO=null,b5={};const zee=new EI;function F3(){return!!Zp&&kwe()}function qTe(){return!!F3()||(Lt(zee),HE(),!1)}function aS(t,e){return!t||!e||md(t,e)||qTe()}function YTe(t,e){return!md(t,e)&&!F3()}function HE(t){return ZO==null&&(ZO=Promise.all([zwe(),ge(()=>import("./geometryEngineBase-DlPZ98f0.js"),__vite__mapDeps([])).then(e=>e.g),ge(()=>import("./hydrated-k8s1tmfD.js"),__vite__mapDeps([]))])),ZO.then(([,e,{hydratedAdapter:r}])=>{vt(t),cv=r,Zp=e.default,Zp._enableProjection($Be),zee.notify()})}function M2(t,e,r=null,i=null){return Array.isArray(t)?t.length===0?[]:sq(cv,t,t[0].spatialReference,e,r,i):sq(cv,[t],t.spatialReference,e,r,i)[0]}function sq(t,e,r,i,n=null,s=null){if(r==null||i==null)return e;if(md(r,i,n))return e.map(o=>JO(o,r,i));if(n==null&&Jk(r))return e.map(o=>JO(o,r,lt.WGS84)).map(o=>uv(o,i));if(n==null&&Jk(i))return e.map(o=>uv(o,lt.WGS84)).map(o=>JO(o,lt.WGS84,i));if(n==null){const o=m6.cacheKey(r,i);b5[o]!==void 0?n=b5[o]:((n=ZTe(r,i,void 0))==null&&(n=new m6),b5[o]=n)}if(Zp==null||t==null)throw new x9;return s!=null?Zp._project(t,e,r,i,n,s):Zp._project(t,e,r,i,n)}function lqe(t,e){const r=XTe([t],e);return r.pending!=null?{pending:r.pending,geometry:null}:r.geometries!=null?{pending:null,geometry:r.geometries[0]}:{pending:null,geometry:null}}function XTe(t,e){if(!F3()){for(const r of t)if(r!=null&&!To(r.spatialReference,e)&&$m(r.spatialReference)&&$m(e)&&!md(r.spatialReference,e))return Lt(zee),{pending:HE(),geometries:null}}return{pending:null,geometries:t.map(r=>r==null?null:To(r.spatialReference,e)?r:$m(r.spatialReference)&&$m(e)?uv(r,e):null)}}function ZTe(t,e,r=null){if(t==null||e==null)return null;if(Zp==null||cv==null)throw new x9;const i=Zp._getTransformation(cv,t,e,r,r==null?void 0:r.spatialReference);return i!==null?m6.fromGE(i):null}function cqe(t,e,r=null){if(Zp==null||cv==null)throw new x9;const i=Zp._getTransformationBySuitability(cv,t,e,r,r==null?void 0:r.spatialReference);if(i!==null){const n=[];for(const s of i)n.push(m6.fromGE(s));return n}return[]}let x9=class extends K{constructor(){super("projection:not-loaded","projection engine not fully loaded yet, please call load()")}};function uqe(){Zp=null,cv=null,ZO=null,b5={}}const hqe={get loadPromise(){return ZO}};function uv(t,e){try{const r=M2(t,e);if(r==null)return null;"xmin"in t&&"xmin"in r&&(r.zmin=t.zmin,r.zmax=t.zmax);const i=rqe(r.type,t.spatialReference,e);return i!=null&&i(r),r}catch(r){if(!(r instanceof x9))throw r;return null}}async function hv(t,e,r){const i=t.spatialReference;return i!=null&&e!=null&&await T9(i,e,null,r),uv(t,e)}function md(t,e,r){return!r&&(!!To(t,e)||$m(t)&&$m(e)&&!!lv(t,e,b9))}async function T9(t,e,r,i){if(F3())return Xoe(i);if(Array.isArray(t)){for(const{source:n,dest:s,geographicTransformation:o}of t)if(n&&s&&!md(n,s,o))return HE(i)}else if(t&&e&&!md(t,e,r))return HE(i);return Xoe(i)}function JO(t,e,r){return t?"x"in t?QTe(t,e,new ke,r,0):"xmin"in t?rSe(t,e,new ei,r,0):"rings"in t?tSe(t,e,new nf,r,0):"paths"in t?eSe(t,e,new Np,r,0):"points"in t?KTe(t,e,new $3,r,0):null:null}function JTe(t,e,r=e.spatialReference,i=0){return r!=null&&t.spatialReference!=null&&QTe(t,t.spatialReference,e,r,i)!=null}function QTe(t,e,r,i,n){ul[0]=t.x,ul[1]=t.y;const s=t.z;return ul[2]=s!==void 0?s:n,Ji(ul,e,0,ul,i,0,1)?(r.x=ul[0],r.y=ul[1],r.spatialReference=i,s!==void 0||iv(i)?(r.z=ul[2],r.hasZ=!0):(r.z=void 0,r.hasZ=!1),t.m===void 0?(r.m=void 0,r.hasM=!1):(r.m=t.m,r.hasM=!0),r):null}function dqe(t,e,r=e.spatialReference,i=0){return t.spatialReference!=null&&r!=null&&KTe(t,t.spatialReference,e,r,i)!=null}function KTe(t,e,r,i,n){const{points:s,hasZ:o,hasM:a}=t,l=[],c=s.length,u=[];for(const p of s)u.push(p[0],p[1],o?p[2]:n);if(!Ji(u,e,0,u,i,0,c))return null;const h=o||iv(i);for(let p=0;p<c;++p){const f=3*p,g=u[f],_=u[f+1];h&&a?l.push([g,_,u[f+2],s[p][3]]):h?l.push([g,_,u[f+2]]):a?l.push([g,_,s[p][2]]):l.push([g,_])}return r.points=l,r.spatialReference=i,r.hasZ=o,r.hasM=a,r}function pqe(t,e,r=e.spatialReference,i=0){return t.spatialReference!=null&&r!=null&&eSe(t,t.spatialReference,e,r,i)!=null}function eSe(t,e,r,i,n){const{paths:s,hasZ:o,hasM:a}=t,l=[];if(!iSe(s,o??!1,a??!1,e,l,i,n))return null;const c=o||iv(i);return r.paths=l,r.spatialReference=i,r.hasZ=c,r.hasM=a,r}function fqe(t,e,r=e.spatialReference,i=0){return t.spatialReference!=null&&r!=null&&tSe(t,t.spatialReference,e,r,i)!=null}function tSe(t,e,r,i,n){const{rings:s,hasZ:o,hasM:a}=t,l=[];if(!iSe(s,o??!1,a??!1,e,l,i,n))return null;const c=o||iv(i);return r.rings=l,r.spatialReference=i,r.hasZ=c,r.hasM=a,r}function mqe(t,e,r=e.spatialReference,i=0){return t.spatialReference!=null&&r!=null&&rSe(t,t.spatialReference,e,r,i)!=null}function rSe(t,e,r,i,n){const{xmin:s,ymin:o,xmax:a,ymax:l,hasZ:c,hasM:u}=t,h=c?t.zmin:n;if(!kle(s,o,h,e,ul,i))return null;const p=c||iv(i);r.xmin=ul[0],r.ymin=ul[1],p&&(r.zmin=ul[2]);const f=c?t.zmax:n;return kle(a,l,f,e,ul,i)?(r.xmax=ul[0],r.ymax=ul[1],p&&(r.zmax=ul[2]),u&&(r.mmin=t.mmin,r.mmax=t.mmax),r.spatialReference=i,r):null}function iSe(t,e,r,i,n,s,o=0){const a=new Array;for(const u of t)for(const h of u)a.push(h[0],h[1],e?h[2]:o);if(!Ji(a,i,0,a,s,0,a.length/3))return!1;let l=0;n.length=0;const c=e||iv(s);for(const u of t){const h=new Array;for(const p of u)c&&r?h.push([a[l++],a[l++],a[l++],p[3]]):c?h.push([a[l++],a[l++],a[l++]]):r?(h.push([a[l++],a[l++],p[2]]),l++):(h.push([a[l++],a[l++]]),l++);n.push(h)}return!0}function dv(t){return t!=null&&FTe(t)!=null}const ul=C(),tkt=Object.freeze(Object.defineProperty({__proto__:null,canProjectToWGS84ComparableLonLat:dv,canProjectWithoutEngine:md,getTransformation:ZTe,getTransformations:cqe,initializeProjection:T9,isLoaded:F3,isLoadedOrLoad:qTe,isLoadedOrLoadFor:aS,load:HE,project:M2,projectExtent:mqe,projectMany:sq,projectMultipoint:dqe,projectOrLoad:lqe,projectOrLoadMany:XTe,projectPoint:JTe,projectPolygon:fqe,projectPolyline:pqe,projectWithZConversion:hv,projectWithoutEngine:JO,requiresLoad:YTe,test:hqe,tryProjectWithZConversion:uv,unload:uqe},Symbol.toStringTag,{value:"Module"}));function S9(t,e,r,i){return t!=null&&(To(e,i)?(ey(r,t),!0):(dc[0]=t[0],dc[1]=t[1],dc[2]=0,!!Ji(dc,e,0,dc,i,0,1)&&(r[0]=dc[0],r[1]=dc[1],dc[0]=t[2],dc[1]=t[3],dc[2]=0,!!Ji(dc,e,0,dc,i,0,1)&&(r[2]=dc[0],r[3]=dc[1],!0))))}const dc=C();function _n(t,e,r,i){if(md(t.spatialReference,r)){dD[0]=t.x,dD[1]=t.y;const s=t.z;return dD[2]=s??i??0,Ji(dD,t.spatialReference,0,e,r,0,1)}const n=uv(t,r);return!!n&&(e[0]=n==null?void 0:n.x,e[1]=n==null?void 0:n.y,e[2]=(n==null?void 0:n.z)??i??0,!0)}async function g6(t,e,r,i,n){return await T9(t.spatialReference,r,null,n),_n(t,e,r,i)}const dD=C();let my=class{constructor(e){this._allocator=e,this._items=[],this._itemsPtr=0,this._grow()}get(){return this._itemsPtr===0&&SE(()=>this._reset()),this._itemsPtr===this._items.length&&this._grow(),this._items[this._itemsPtr++]}_reset(){const e=Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3*zle);this._items.length=Math.min(e,this._items.length),this._itemsPtr=0}_grow(){for(let e=0;e<Math.max(8,Math.min(this._items.length,zle));e++)this._items.push(this._allocator())}};const zle=1024;function xe(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function WE(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]]}function Uee(t,e,r,i,n,s,o,a,l,c,u,h,p,f,g,_){return[t,e,r,i,n,s,o,a,l,c,u,h,p,f,g,_]}function gqe(t,e){return new Float64Array(t,e,16)}const sn=xe();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:sn,clone:WE,create:xe,createView:gqe,fromValues:Uee},Symbol.toStringTag,{value:"Module"}));function li(){return[1,0,0,0,1,0,0,0,1]}function nSe(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8]]}function QO(t,e,r,i,n,s,o,a,l){return[t,e,r,i,n,s,o,a,l]}function yqe(t,e){return new Float64Array(t,e,9)}const O2=li();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:O2,clone:nSe,create:li,createView:yqe,fromValues:QO},Symbol.toStringTag,{value:"Module"}));function lc(){return[0,0,0,1]}function _qe(t){return[t[0],t[1],t[2],t[3]]}function vqe(t,e,r,i){return[t,e,r,i]}function bqe(t,e){return new Float64Array(t,e,4)}const C9=lc();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:C9,clone:_qe,create:lc,createView:bqe,fromValues:vqe},Symbol.toStringTag,{value:"Module"}));function He(){return[0,0]}function UA(t){return[t[0],t[1]]}function lr(t,e){return[t,e]}function sSe(t,e=He()){const r=Math.min(2,t.length);for(let i=0;i<r;++i)e[i]=t[i];return e}function wqe(t,e){return new Float64Array(t,e,2)}function oSe(){return He()}function aSe(){return lr(1,1)}function lSe(){return lr(1,0)}function cSe(){return lr(0,1)}const ty=oSe(),E9=aSe(),uSe=lSe(),xqe=cSe();Object.freeze(Object.defineProperty({__proto__:null,ONES:E9,UNIT_X:uSe,UNIT_Y:xqe,ZEROS:ty,clone:UA,create:He,createView:wqe,fromArray:sSe,fromValues:lr,ones:aSe,unitX:lSe,unitY:cSe,zeros:oSe},Symbol.toStringTag,{value:"Module"}));function Zt(){return[0,0,0,0]}function NI(t){return[t[0],t[1],t[2],t[3]]}function Bt(t,e,r,i){return[t,e,r,i]}function Bee(t,e=Zt()){const r=Math.min(4,t.length);for(let i=0;i<r;++i)e[i]=t[i];return e}function Tqe(t,e){return new Float64Array(t,e,4)}function hSe(){return Zt()}function dSe(){return Bt(1,1,1,1)}function pSe(){return Bt(1,0,0,0)}function fSe(){return Bt(0,1,0,0)}function mSe(){return Bt(0,0,1,0)}function gSe(){return Bt(0,0,0,1)}const qu=hSe(),qh=dSe(),Sqe=pSe(),Cqe=fSe(),Eqe=mSe(),Pqe=gSe();Object.freeze(Object.defineProperty({__proto__:null,ONES:qh,UNIT_W:Pqe,UNIT_X:Sqe,UNIT_Y:Cqe,UNIT_Z:Eqe,ZEROS:qu,clone:NI,create:Zt,createView:Tqe,fromArray:Bee,fromValues:Bt,ones:dSe,unitW:gSe,unitX:pSe,unitY:fSe,unitZ:mSe,zeros:hSe},Symbol.toStringTag,{value:"Module"}));let k3=class Hb{constructor(e){this._create=e,this._items=new Array,this._itemsPtr=0}get(){return this._itemsPtr===0&&SE(()=>this._reset()),this._itemsPtr>=this._items.length&&this._items.push(this._create()),this._items[this._itemsPtr++]}_reset(){const e=2*this._itemsPtr;this._items.length>e&&(this._items.length=e),this._itemsPtr=0}static createVec2f64(){return new Hb(He)}static createVec3f64(){return new Hb(C)}static createVec4f64(){return new Hb(Zt)}static createMat3f64(){return new Hb(li)}static createMat4f64(){return new Hb(xe)}static createQuatf64(){return new Hb(lc)}get test(){return{length:this._items.length}}};const ikt=k3.createVec2f64(),Be=k3.createVec3f64(),Vee=k3.createVec4f64();k3.createMat3f64();const Gee=k3.createMat4f64(),Aqe=k3.createQuatf64();function yf(t){return t?{origin:Zi(t.origin),vector:Zi(t.vector)}:{origin:C(),vector:C()}}function Mqe(t,e){const r=Rqe.get();return r.origin=t,r.vector=e,r}function nkt(t,e=yf()){return Oqe(t.origin,t.vector,e)}function Oqe(t,e,r=yf()){return ce(r.origin,t),ce(r.vector,e),r}function Ax(t,e,r=yf()){return ce(r.origin,t),ye(r.vector,e,t),r}function jee(t,e){const r=ye(Be.get(),e,t.origin),i=de(t.vector,r),n=de(t.vector,t.vector),s=we(i/n,0,1),o=ye(Be.get(),ne(Be.get(),t.vector,s),r);return de(o,o)}function skt(t,e,r){return oq(t,e,0,1,r)}function okt(t,e,r){return fe(r,t.origin,ne(r,t.vector,e))}function oq(t,e,r,i,n){const{vector:s,origin:o}=t,a=ye(Be.get(),e,o),l=de(s,a)/Ra(s);return ne(n,s,we(l,r,i)),fe(n,n,t.origin)}function akt(t,e){if(_Se(t,Mqe(e.origin,e.direction),!1,y6)){const{tA:r,pB:i,distance2:n}=y6;if(r>=0&&r<=1)return n;if(r<0)return Uo(t.origin,i);if(r>1)return Uo(fe(Be.get(),t.origin,t.vector),i)}return null}function ySe(t,e,r){return!!_Se(t,e,!0,y6)&&(ce(r,y6.pA),!0)}function _Se(t,e,r,i){const s=t.origin,o=fe(Be.get(),s,t.vector),a=e.origin,l=fe(Be.get(),a,e.vector),c=Be.get(),u=Be.get();if(c[0]=s[0]-a[0],c[1]=s[1]-a[1],c[2]=s[2]-a[2],u[0]=l[0]-a[0],u[1]=l[1]-a[1],u[2]=l[2]-a[2],Math.abs(u[0])<1e-6&&Math.abs(u[1])<1e-6&&Math.abs(u[2])<1e-6)return!1;const h=Be.get();if(h[0]=o[0]-s[0],h[1]=o[1]-s[1],h[2]=o[2]-s[2],Math.abs(h[0])<1e-6&&Math.abs(h[1])<1e-6&&Math.abs(h[2])<1e-6)return!1;const p=c[0]*u[0]+c[1]*u[1]+c[2]*u[2],f=u[0]*h[0]+u[1]*h[1]+u[2]*h[2],g=c[0]*h[0]+c[1]*h[1]+c[2]*h[2],_=u[0]*u[0]+u[1]*u[1]+u[2]*u[2],v=(h[0]*h[0]+h[1]*h[1]+h[2]*h[2])*_-f*f;if(Math.abs(v)<1e-6)return!1;let b=(p*f-g*_)/v,w=(p+f*b)/_;r&&(b=we(b,0,1),w=we(w,0,1));const x=Be.get(),S=Be.get();return x[0]=s[0]+b*h[0],x[1]=s[1]+b*h[1],x[2]=s[2]+b*h[2],S[0]=a[0]+w*u[0],S[1]=a[1]+w*u[1],S[2]=a[2]+w*u[2],i.tA=b,i.tB=w,i.pA=x,i.pB=S,i.distance2=Uo(x,S),!0}const y6={tA:0,tB:0,pA:C(),pB:C(),distance2:0},Rqe=new my(()=>yf());function Kh(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function $qe(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function nn(t,e,r,i,n){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t}function Hee(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function vSe(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function bSe(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t}function wSe(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t}function Iqe(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function Lqe(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function Dqe(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t}function Nqe(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t}function Fqe(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function s2(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function kqe(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t}function xSe(t,e){const r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2],s=e[3]-t[3];return Math.sqrt(r*r+i*i+n*n+s*s)}function _6(t,e){const r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2],s=e[3]-t[3];return r*r+i*i+n*n+s*s}function Wee(t){const e=t[0],r=t[1],i=t[2],n=t[3];return Math.sqrt(e*e+r*r+i*i+n*n)}function qee(t){const e=t[0],r=t[1],i=t[2],n=t[3];return e*e+r*r+i*i+n*n}function zqe(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function Uqe(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function TSe(t,e){const r=e[0],i=e[1],n=e[2],s=e[3];let o=r*r+i*i+n*n+s*s;return o>0&&(o=1/Math.sqrt(o),t[0]=r*o,t[1]=i*o,t[2]=n*o,t[3]=s*o),t}function SSe(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function Yee(t,e,r,i){const n=e[0],s=e[1],o=e[2],a=e[3];return t[0]=n+i*(r[0]-n),t[1]=s+i*(r[1]-s),t[2]=o+i*(r[2]-o),t[3]=a+i*(r[3]-a),t}function Bqe(t,e){const r=AI;let i,n,s,o,a,l;e=e||1;do i=2*r()-1,n=2*r()-1,a=i*i+n*n;while(a>=1);do s=2*r()-1,o=2*r()-1,l=s*s+o*o;while(l>=1);const c=Math.sqrt((1-a)/l);return t[0]=e*i,t[1]=e*n,t[2]=e*s*c,t[3]=e*o*c,t}function jc(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3];return t[0]=r[0]*i+r[4]*n+r[8]*s+r[12]*o,t[1]=r[1]*i+r[5]*n+r[9]*s+r[13]*o,t[2]=r[2]*i+r[6]*n+r[10]*s+r[14]*o,t[3]=r[3]*i+r[7]*n+r[11]*s+r[15]*o,t}function Vqe(t,e,r){const i=e[0],n=e[1],s=e[2],o=r[0],a=r[1],l=r[2],c=r[3],u=c*i+a*s-l*n,h=c*n+l*i-o*s,p=c*s+o*n-a*i,f=-o*i-a*n-l*s;return t[0]=u*c+f*-o+h*-l-p*-a,t[1]=h*c+f*-a+p*-o-u*-l,t[2]=p*c+f*-l+u*-a-h*-o,t[3]=e[3],t}function Gqe(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function jC(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function o2(t,e){const r=t[0],i=t[1],n=t[2],s=t[3],o=e[0],a=e[1],l=e[2],c=e[3],u=Va();return Math.abs(r-o)<=u*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-a)<=u*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(n-l)<=u*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(s-c)<=u*Math.max(1,Math.abs(s),Math.abs(c))}const jqe=vSe,Hqe=bSe,Wqe=wSe,qqe=xSe,Yqe=_6,Xqe=Wee,Zqe=qee,CSe=Object.freeze(Object.defineProperty({__proto__:null,add:Hee,ceil:Iqe,copy:Kh,copyVec3:$qe,dist:qqe,distance:xSe,div:Wqe,divide:wSe,dot:SSe,equals:o2,exactEquals:jC,floor:Lqe,inverse:Uqe,len:Xqe,length:Wee,lerp:Yee,max:Nqe,min:Dqe,mul:Hqe,multiply:bSe,negate:zqe,normalize:TSe,random:Bqe,round:Fqe,scale:s2,scaleAndAdd:kqe,set:nn,sqrDist:Yqe,sqrLen:Zqe,squaredDistance:_6,squaredLength:qee,str:Gqe,sub:jqe,subtract:vSe,transformMat4:jc,transformQuat:Vqe},Symbol.toStringTag,{value:"Module"}));function KO(t,e){return de(t,e)/Te(t)}function P9(t,e){const r=de(t,e)/(Te(t)*Te(e));return-Ks(r)}function ESe(t,e,r){pe(pD,t),pe(lV,e);const i=de(pD,lV),n=Ks(i),s=Je(pD,pD,lV);return de(s,r)<0?2*Math.PI-n:n}const pD=C(),lV=C();function qE(t){const e=t[0]*t[0]+t[4]*t[4]+t[8]*t[8],r=t[1]*t[1]+t[5]*t[5]+t[9]*t[9],i=t[2]*t[2]+t[6]*t[6]+t[10]*t[10];return Math.sqrt(Math.max(e,r,i))}function Jqe(t,e){const r=Math.sqrt(e[0]*e[0]+e[4]*e[4]+e[8]*e[8]),i=Math.sqrt(e[1]*e[1]+e[5]*e[5]+e[9]*e[9]),n=Math.sqrt(e[2]*e[2]+e[6]*e[6]+e[10]*e[10]);return ie(t,r,i,n),t}function lkt(t,e,r){r=r||t;const i=de(t,e);ie(r,t[0]-i*e[0],t[1]-i*e[1],t[2]-i*e[2]),pe(r,r)}function ckt(t,e,r){Math.abs(t[0])>Math.abs(t[1])?ie(e,0,1,0):ie(e,1,0,0),Je(r,t,e),Je(e,r,t),pe(r,r),pe(e,e)}function fD(t,e,r,i,n,s){const o=t+(e-t)*n;return o+(r+(i-r)*n-o)*s}function Qqe(t,e,r,i=C()){const n=Te(t),s=Te(e),o=de(t,e)/(n*s);if(o<.9999999999999999){const a=Math.acos(o),l=((1-r)*n+r*s)/Math.sin(a),c=l/n*Math.sin((1-r)*a),u=l/s*Math.sin(r*a);return ne(ux,t,c),ne(hx,e,u),fe(i,ux,hx)}return ni(i,t,e,r)}function ukt(t,e,r,i=C(),n=C()){const s=Te(t),o=Te(e),a=de(t,e)/(s*o);if(a<.9999999999999999){const l=Math.acos(a),c=Math.sin(l),u=Math.sin(r*l),h=Math.sin((1-r)*l),p=(1-r)*s+r*o;{const f=p/c,g=f/o*u;ne(ux,t,f/s*h),ne(hx,e,g),fe(i,ux,hx)}{const f=1/s*(-Math.cos((1-r)*l)*l*p+h*(-s+o));ne(ux,t,f);const g=1/o*(Math.cos(r*l)*l*p+u*(-s+o));ne(hx,e,g),fe(n,ux,hx),ne(n,n,1/c)}return n}return ni(i,t,e,r),ye(n,e,t),pe(n,n),n}function v6(t,e,r){t=pe(ux,t),e=pe(hx,e);const i=Ks(de(t,e));if(r){const n=Je(Kqe,t,e);if(de(n,r)<0)return-i}return i}function w5(t){const e=t.length;return r=>{if(r<=t[0][0])return t[0][1];if(r>=t[e-1][0])return t[e-1][1];let i=1;for(;r>t[i][0];)i++;const n=t[i-1][0],s=t[i][0],o=(s-r)/(s-n);return o*t[i-1][1]+(1-o)*t[i][1]}}function hkt(t,e,r,i){ye(Ule,e,t),ye(Ble,r,t),Je(i,Ule,Ble),pe(i,i),i[3]=-de(t,i)}function dkt(t,e){if(ie(e,0,0,0),t.length>0){for(let r=0;r<t.length;++r)fe(e,e,t[r]);ne(e,e,1/t.length)}}const Ule=C(),Ble=C(),Kqe=C(),ux=C(),hx=C();function zr(t=BA){return[t[0],t[1],t[2],t[3]]}function eYe(t=BA[0],e=BA[1],r=BA[2],i=BA[3]){return Xee(t,e,r,i,Vee.get())}function A9(t,e){return Xee(e[0],e[1],e[2],e[3],t)}function pkt(t){return t}function Xee(t,e,r,i,n=zr()){return n[0]=t,n[1]=e,n[2]=r,n[3]=i,n}function PSe(t,e,r){return ce(r,t),r[3]=e,r}function FI(t,e,r){const i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=Math.abs(i-1)>1e-5&&i>1e-12?1/Math.sqrt(i):1;return r[0]=e[0]*n,r[1]=e[1]*n,r[2]=e[2]*n,r[3]=-(r[0]*t[0]+r[1]*t[1]+r[2]*t[2]),r}function Ma(t,e,r,i=zr()){const n=r[0]-e[0],s=r[1]-e[1],o=r[2]-e[2],a=t[0]-e[0],l=t[1]-e[1],c=t[2]-e[2],u=s*c-o*l,h=o*a-n*c,p=n*l-s*a,f=u*u+h*h+p*p,g=Math.abs(f-1)>1e-5&&f>1e-12?1/Math.sqrt(f):1;return i[0]=u*g,i[1]=h*g,i[2]=p*g,i[3]=-(i[0]*t[0]+i[1]*t[1]+i[2]*t[2]),i}function Zee(t,e,r,i=0,n=Math.floor(r*(1/3)),s=Math.floor(r*(2/3))){if(r<3)return!1;e(AP,i);let o=n,a=!1;for(;o<r-1&&!a;)e(J2,o),o++,a=!zo(AP,J2);if(!a)return!1;for(o=Math.max(o,s),a=!1;o<r&&!a;)e(zw,o),o++,ye(mD,AP,J2),pe(mD,mD),ye(gD,J2,zw),pe(gD,gD),a=!zo(AP,zw)&&!zo(J2,zw)&&Math.abs(de(mD,gD))<rYe;return a?(Ma(AP,J2,zw,t),!0):(i!==0||n!==1||s!==2)&&Zee(t,e,r,0,1,2)}function tYe(t,e,r=!0){const i=e.length/3;return Zee(t,(n,s)=>ie(n,e[3*s+0],e[3*s+1],e[3*s+2]),r?i-1:i)}const rYe=.99619469809,AP=C(),J2=C(),zw=C(),mD=C(),gD=C();function aq(t,e,r){return e!==t&&A9(t,e),t[3]=-de(t,r),t}function lq(t,e){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function C$(t,e,r,i){return Je(zw,e,t),FI(r,zw,i)}function fkt(t,e,r,i){return M9(t,e,ye(Be.get(),r,e),lYe,i)}function R2(t,e,r){return e!=null&&M9(t,e.origin,e.direction,cYe,r)}function iYe(t,e,r){return M9(t,e.origin,e.vector,Hm.NONE,r)}function nYe(t,e,r){return M9(t,e.origin,e.vector,Hm.CLAMP,r)}function ASe(t,e){return bi(t,e)>=0}function sYe(t,e){const r=de(t,e.ray.direction),i=-bi(t,e.ray.origin);if(i<0&&r>=0)return!1;if(r>-1e-6&&r<1e-6)return i>0;if((i<0||r<0)&&!(i<0&&r<0))return!0;const n=i/r;return r>0?n<e.c1&&(e.c1=n):n>e.c0&&(e.c0=n),e.c0<=e.c1}function oYe(t,e){const r=de(t,e.ray.direction),i=-bi(t,e.ray.origin);if(r>-1e-6&&r<1e-6)return i>0;const n=i/r;return r>0?n<e.c1&&(e.c1=n):n>e.c0&&(e.c0=n),e.c0<=e.c1}function aYe(t,e,r){const i=ne(Be.get(),t,-t[3]),n=cq(t,ye(Be.get(),e,i),Be.get());return fe(r,n,i),r}function cq(t,e,r){const i=ne(Be.get(),t,de(t,e));return ye(r,e,i),r}function mkt(t,e){return Math.abs(bi(t,e))}function bi(t,e){return de(t,e)+t[3]}function M9(t,e,r,i,n){const s=de(t,r);if(s===0)return!1;let o=-(de(t,e)+t[3])/s;return i&Hm.CLAMP&&(o=we(o,0,1)),!(!(i&Hm.INFINITE_MIN)&&o<0||!(i&Hm.INFINITE_MAX)&&o>1)&&(fe(n,e,ne(n,r,o)),!0)}const BA=[0,0,1,0];var Hm;(function(t){t[t.NONE=0]="NONE",t[t.CLAMP=1]="CLAMP",t[t.INFINITE_MIN=4]="INFINITE_MIN",t[t.INFINITE_MAX=8]="INFINITE_MAX"})(Hm||(Hm={}));const lYe=Hm.INFINITE_MIN|Hm.INFINITE_MAX,cYe=Hm.INFINITE_MAX;function Js(t){return t?Vle(Zi(t.origin),Zi(t.direction)):Vle(C(),C())}function Vle(t,e){return{origin:t,direction:e}}function gkt(t,e){return tg(t.origin,e.origin)&&tg(t.direction,e.direction)}function eh(t,e){const r=dYe.get();return r.origin=t,r.direction=e,r}function b6(t,e=Js()){return OSe(t.origin,t.direction,e)}function MSe(t,e,r=Js()){return ce(r.origin,t),ye(r.direction,e,t),r}function OSe(t,e,r=Js()){return ce(r.origin,t),ce(r.direction,e),r}function uYe(t,e){const r=Je(Be.get(),pe(Be.get(),t.direction),ye(Be.get(),e,t.origin));return de(r,r)}function hYe(t,e,r){const i=de(t.direction,ye(r,e,t.origin));return fe(r,t.origin,ne(r,t.direction,i)),r}const dYe=new my(()=>Js()),cV=()=>re.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");let pYe=class{constructor(){this.plane=zr(),this.origin=C(),this.basis1=C(),this.basis2=C()}};const RSe=pYe;function gy(t=VSe){return{plane:zr(t.plane),origin:Zi(t.origin),basis1:Zi(t.basis1),basis2:Zi(t.basis2)}}function fYe(t,e,r){const i=EYe.get();return i.origin=t,i.basis1=e,i.basis2=r,i.plane=eYe(0,0,0,0),O9(i),i}function $2(t,e=gy()){return Jee(t.origin,t.basis1,t.basis2,e)}function mYe(t,e){ce(e.origin,t.origin),ce(e.basis1,t.basis1),ce(e.basis2,t.basis2),A9(e.plane,t.plane)}function Jee(t,e,r,i=gy()){return ce(i.origin,t),ce(i.basis1,e),ce(i.basis2,r),O9(i),SYe(i,"fromValues()"),i}function O9(t){C$(t.basis2,t.basis1,t.origin,t.plane)}function $Se(t,e,r){t!==r&&$2(t,r);const i=ne(Be.get(),ry(t),e);return fe(r.origin,r.origin,i),r.plane[3]-=e,r}function gYe(t,e,r){return ISe(e,r),$Se(r,tte(t,t.origin),r),r}function ISe(t,e=gy()){const r=(t[2]-t[0])/2,i=(t[3]-t[1])/2;return ie(e.origin,t[0]+r,t[1]+i,0),ie(e.basis1,r,0,0),ie(e.basis2,0,i,0),Xee(0,0,1,0,e.plane),e}function Qee(t,e,r){return!!R2(t.plane,e,r)&&USe(t,r)}function yYe(t,e,r){if(Qee(t,e,r))return r;const i=LSe(t,e,Be.get());return fe(r,e.origin,ne(Be.get(),e.direction,Di(e.origin,i)/Te(e.direction))),r}function LSe(t,e,r){const i=w6.get();BSe(t,e,i,w6.get());let n=Number.POSITIVE_INFINITY;for(const s of ite){const o=rte(t,s,R9.get()),a=Be.get();if(iYe(i,o,a)){const l=fy(Be.get(),e.origin,a),c=Math.abs(Ks(de(e.direction,l)));c<n&&(n=c,ce(r,a))}}return n===Number.POSITIVE_INFINITY?DSe(t,e,r):r}function DSe(t,e,r){if(Qee(t,e,r))return r;const i=w6.get(),n=w6.get();BSe(t,e,i,n);let s=Number.POSITIVE_INFINITY;for(const o of ite){const a=rte(t,o,R9.get()),l=Be.get();if(nYe(i,a,l)){const c=uYe(e,l);if(!ASe(n,l))continue;c<s&&(s=c,ce(r,l))}}return Kee(t,e.origin)<s&&NSe(t,e.origin,r),r}function NSe(t,e,r){const i=aYe(t.plane,e,Be.get()),n=oq(Gle(t,t.basis1),i,-1,1,Be.get()),s=oq(Gle(t,t.basis2),i,-1,1,Be.get());return ye(r,fe(Be.get(),n,s),t.origin),r}function FSe(t,e,r){const{origin:i,basis1:n,basis2:s}=t,o=ye(Be.get(),e,i),a=KO(n,o),l=KO(s,o),c=KO(ry(t),o);return ie(r,a,l,c)}function Kee(t,e){const r=FSe(t,e,Be.get()),{basis1:i,basis2:n}=t,s=Te(i),o=Te(n),a=Math.max(Math.abs(r[0])-s,0),l=Math.max(Math.abs(r[1])-o,0),c=r[2];return a*a+l*l+c*c}function _Ye(t,e){return Math.sqrt(Kee(t,e))}function vYe(t,e){let r=Number.NEGATIVE_INFINITY;for(const i of ite){const n=rte(t,i,R9.get()),s=jee(n,e);s>r&&(r=s)}return Math.sqrt(r)}function ete(t,e){return ASe(t.plane,e)&&USe(t,e)}function bYe(t,e,r,i){return TYe(t,r,i)}function tte(t,e){const r=-t.plane[3];return KO(ry(t),e)-r}function wYe(t,e,r,i){const n=tte(t,e),s=ne(CYe,ry(t),r-n);return fe(i,e,s),i}function kSe(t,e){return zo(t.basis1,e.basis1)&&zo(t.basis2,e.basis2)&&zo(t.origin,e.origin)}function zSe(t,e,r){return t!==r&&$2(t,r),os(Q2,e),Qc(Q2,Q2),Ge(r.basis1,t.basis1,Q2),Ge(r.basis2,t.basis2,Q2),Ge(r.plane,t.plane,Q2),Ge(r.origin,t.origin,e),aq(r.plane,r.plane,r.origin),r}function xYe(t,e,r,i){return t!==i&&$2(t,i),Kc(uV,e,r),Ge(i.basis1,t.basis1,uV),Ge(i.basis2,t.basis2,uV),O9(i),i}function ry(t){return t.plane}function TYe(t,e,r){switch(e){case hn.X:ce(r,t.basis1),pe(r,r);break;case hn.Y:ce(r,t.basis2),pe(r,r);break;case hn.Z:ce(r,ry(t))}return r}function USe(t,e){const r=ye(Be.get(),e,t.origin),i=Ra(t.basis1),n=Ra(t.basis2),s=de(t.basis1,r),o=de(t.basis2,r);return-s-i<0&&s-i<0&&-o-n<0&&o-n<0}function Gle(t,e){const r=R9.get();return ce(r.origin,t.origin),ce(r.vector,e),r}function rte(t,e,r){const{basis1:i,basis2:n,origin:s}=t,o=ne(Be.get(),i,e.origin[0]),a=ne(Be.get(),n,e.origin[1]);fe(r.origin,o,a),fe(r.origin,r.origin,s);const l=ne(Be.get(),i,e.direction[0]),c=ne(Be.get(),n,e.direction[1]);return ne(r.vector,fe(l,l,c),2),r}function SYe(t,e){Math.abs(de(t.basis1,t.basis2)/(Te(t.basis1)*Te(t.basis2)))>1e-6&&cV().warn(e,"Provided basis vectors are not perpendicular"),Math.abs(de(t.basis1,ry(t)))>1e-6&&cV().warn(e,"Basis vectors and plane normal are not perpendicular"),Math.abs(-de(ry(t),t.origin)-t.plane[3])>1e-6&&cV().warn(e,"Plane offset is not consistent with plane origin")}function BSe(t,e,r,i){const n=ry(t);C$(n,e.direction,e.origin,r),C$(r,n,e.origin,i)}const VSe={plane:zr(),origin:Ce(0,0,0),basis1:Ce(1,0,0),basis2:Ce(0,1,0)},w6=new my(zr),R9=new my(yf),CYe=C(),EYe=new my(()=>gy()),ite=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],Q2=xe(),uV=xe(),PYe=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:RSe,altitudeAt:tte,axisAt:bYe,closestPoint:DSe,closestPointOnSilhouette:LSe,copy:$2,copyWithoutVerify:mYe,create:gy,distance:_Ye,distance2:Kee,distanceToSilhouette:vYe,elevate:$Se,equals:kSe,extrusionContainsPoint:ete,fromAABoundingRect:ISe,fromValues:Jee,intersectRay:Qee,intersectRayClosestSilhouette:yYe,normal:ry,projectPoint:NSe,projectPointLocal:FSe,rotate:xYe,setAltitudeAt:wYe,setExtent:gYe,transform:zSe,up:VSe,updateUnboundedPlane:O9,wrap:fYe},Symbol.toStringTag,{value:"Module"})),AYe=new lt(qwe),VA=new lt(Hz),GA=new lt(Wz),_kt=new lt(Ywe);function nc(t){const e=jle.get(t);if(e)return e;let r=AYe;if(t)if(t===VA)r=VA;else if(t===GA)r=GA;else{const i=t.wkid,n=t.latestWkid;if(i!=null||n!=null)PE(i)||PE(n)?r=VA:(AE(i)||AE(n))&&(r=GA);else{const s=t.wkt2??t.wkt;if(s){const o=s.toUpperCase();o===MYe?r=VA:o===OYe&&(r=GA)}}}return jle.set(t,r),r}const jle=new Map,MYe=VA.wkt.toUpperCase(),OYe=GA.wkt.toUpperCase(),GSe=Jn();function Jn(){return Zt()}const RYe=o2,$Ye=o2;function a2(t,e){return Kh(e,t)}function jSe(t,e){return Bt(t[0],t[1],t[2],e)}function IYe(t){return t}function LYe(t){t[0]=t[1]=t[2]=t[3]=0}function $9(t,e){return t[0]=t[1]=t[2]=0,t[3]=e,t}function N0(t){return t[3]}function DYe(t){return t}function HSe(t,e,r,i){return Bt(t,e,r,i)}function NYe(t,e,r){return t!==r&&(r[0]=t[0],r[1]=t[1],r[2]=t[2]),r[3]=t[3]+e,r}function FYe(t,e,r){return re.getLogger("esri.geometry.support.sphere").error("sphere.setExtent is not yet supported"),t!==r&&a2(t,r),r}function Dv(t,e,r){if(e==null||!WSe(t,e,x6))return!1;let{t0:i,t1:n}=x6;if((i<0||n<i&&n>0)&&(i=n),i<0)return!1;if(r){const{origin:s,direction:o}=e;r[0]=s[0]+o[0]*i,r[1]=s[1]+o[1]*i,r[2]=s[2]+o[2]*i}return!0}function kYe(t,e,r){const i=MSe(e,r);if(!WSe(t,i,x6))return[];const{origin:n,direction:s}=i,{t0:o,t1:a}=x6,l=c=>{const u=C();return Xs(u,n,s,c),nte(t,u,u)};return Math.abs(o-a)<Va()?[l(o)]:[l(o),l(a)]}const x6={t0:0,t1:0};function WSe(t,e,r){const{origin:i,direction:n}=e,s=zYe;s[0]=i[0]-t[0],s[1]=i[1]-t[1],s[2]=i[2]-t[2];const o=n[0]*n[0]+n[1]*n[1]+n[2]*n[2];if(o===0)return!1;const a=2*(n[0]*s[0]+n[1]*s[1]+n[2]*s[2]),l=a*a-4*o*(s[0]*s[0]+s[1]*s[1]+s[2]*s[2]-t[3]*t[3]);if(l<0)return!1;const c=Math.sqrt(l);return r.t0=(-a-c)/(2*o),r.t1=(-a+c)/(2*o),!0}const zYe=C();function uq(t,e){return Dv(t,e,null)}function UYe(t,e,r){if(Dv(t,e,r))return r;const i=z3(t,e,Be.get());return fe(r,e.origin,ne(Be.get(),e.direction,Di(e.origin,i)/Te(e.direction))),r}function z3(t,e,r){const i=Be.get(),n=Gee.get();Je(i,e.origin,e.direction);const s=N0(t);Je(r,i,e.origin),ne(r,r,1/Te(r)*s);const o=YSe(t,e.origin),a=P9(e.origin,r);return Kc(n,a+o,i),Ge(r,r,n),r}function BYe(t,e,r){return Dv(t,e,r)?r:(hYe(e,t,r),nte(t,r,r))}function nte(t,e,r){const i=ye(Be.get(),e,t),n=ne(Be.get(),i,t[3]/Te(i));return fe(r,n,t)}function qSe(t,e){const r=ye(Be.get(),e,t),i=Ra(r),n=t[3]*t[3];return Math.sqrt(Math.abs(i-n))}function YSe(t,e){const r=ye(Be.get(),e,t),i=Te(r),n=N0(t),s=n+Math.abs(n-i);return Ks(n/s)}const hV=C();function XSe(t,e,r,i){const n=ye(hV,e,t);switch(r){case hn.X:{const s=Dae(n,hV)[2];return ie(i,-Math.sin(s),Math.cos(s),0)}case hn.Y:{const s=Dae(n,hV),o=s[1],a=s[2],l=Math.sin(o);return ie(i,-l*Math.cos(a),-l*Math.sin(a),Math.cos(o))}case hn.Z:return pe(i,n);default:return}}function ZSe(t,e){const r=ye(hq,e,t);return Te(r)-t[3]}function VYe(t,e,r,i){const n=ZSe(t,e),s=XSe(t,e,hn.Z,hq),o=ne(hq,s,r-n);return fe(i,e,o)}function GYe(t,e){const r=Uo(t,e),i=N0(t);return r<=i*i}function jYe(t,e,r=Zt()){const i=Di(t,e),n=t[3],s=e[3];return i+s<n?(Kh(r,t),r):i+n<s?(Kh(r,e),r):(ni(r,t,e,(i+s-n)/(2*i)),r[3]=(i+n+s)/2,r)}const hq=C(),I9=Jn(),HYe=Object.freeze(Object.defineProperty({__proto__:null,NullSphere:GSe,altitudeAt:ZSe,angleToSilhouette:YSe,axisAt:XSe,clear:LYe,closestPoint:BYe,closestPointOnSilhouette:z3,containsPoint:GYe,copy:a2,create:Jn,distanceToSilhouette:qSe,elevate:NYe,equals:$Ye,exactEquals:RYe,fromCenterAndRadius:jSe,fromRadius:$9,fromValues:HSe,getCenter:DYe,getRadius:N0,intersectLine:kYe,intersectRay:Dv,intersectRayClosestSilhouette:UYe,intersectsRay:uq,projectPoint:nte,setAltitudeAt:VYe,setExtent:FYe,tmpSphere:I9,union:jYe,wrap:IYe},Symbol.toStringTag,{value:"Module"}));function WYe(t){const{value:e,operations:r}=t;return{operations:r,value:r.create(e)}}function qYe(t,e,r){return t.operations.setExtent(t.value,e,r.value),r}function YYe(t){return{operations:t,value:t.create()}}function JSe(t,e,r=YYe(t)){return r.operations=t,t.copy(e,r.value),r}function XYe(t){return JSe(HYe,HSe(0,0,0,Br(t).radius))}const Hle=2**50;function ZYe(){return JSe(PYe,Jee([0,0,0],[Hle,0,0],[0,Hle,0]))}function JYe(t,e,r){return t.operations.axisAt(t.value,e,hn.Z,r)}function QYe(t,e,r,i){return t.operations.axisAt(t.value,e,r,i)}function KYe(t,e,r){return t.operations.intersectRay(t.value,e,r)}function eXe(t,e,r){return t.operations.intersectRayClosestSilhouette(t.value,e,r)}function tXe(t,e){return t.operations.altitudeAt(t.value,e)}function QSe(t,e,r,i){return t.operations.setAltitudeAt(t.value,e,r,i)}function rXe(t,e,r,i){return e!==i&&Zn(i,e),ie(K2,i[12],i[13],i[14]),QSe(t,K2,r,K2),i[12]=K2[0],i[13]=K2[1],i[14]=K2[2],i}function dV(t,e,r){return t.operations.elevate(t.value,e,r.value)}const K2=C();function Wle(t,e,r,i,n){return n[0]=de(t,e),n[1]=de(t,r),n[2]=de(t,i),n}function dq(t,e,r,i,n){ce(r,t),ce(yD,e),pe(yD,yD),Je(i,yD,r),Je(n,i,r)}function iXe(t,e){return t?nc(e):e.isGeographic?lt.PlateCarree:e}const yD=C(),ste=96;function vkt(t,e){const r=e||t.extent,i=t.width,n=Ba(r==null?void 0:r.spatialReference);return r&&i?r.width/i*n*JK*ste:0}function nXe(t,e){return t/(Ba(e)*JK*ste)}function sXe(t){return t/(JK*ste)}function bkt(t,e,r){return oXe(t,e)&&aXe(t,r)}function oXe(t,e){return e===0||U1(t,e)||t<e}function aXe(t,e){return e===0||U1(t,e)||t>e}let YE=class extends YO{constructor(e){super(e),this.addHandles(this.on("before-add",r=>{r.item!=null&&r.item.parent===this.owner&&(re.getLogger(this).warn("Analysis inside the collection must be unique. Not adding this element again."),r.preventDefault())}))}_own(e){e.parent=this.owner}_release(e){e.parent=null}};YE=d([V("esri.support.AnalysesCollection")],YE);const x5={widthBreakpoint:{getValue(t){const e=t.viewSize[0],r=t.breakpoints,i=this.values;return e<=r.xsmall?i.xsmall:e<=r.small?i.small:e<=r.medium?i.medium:e<=r.large?i.large:i.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(t){const e=t.viewSize[1],r=t.breakpoints,i=this.values;return e<=r.xsmall?i.xsmall:e<=r.small?i.small:e<=r.medium?i.medium:e<=r.large?i.large:i.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(t){const e=t.viewSize,r=e[0],i=e[1],n=this.values;return i>=r?n.portrait:n.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},pV={xsmall:544,small:768,medium:992,large:1200};function lXe(t){const e=t;return e&&e.xsmall<e.small&&e.small<e.medium&&e.medium<e.large}function fV(t,e){return e?x5[t].valueToClassName[e].split(" "):[]}const cXe=t=>{let e=class extends t{constructor(...r){super(...r),this.orientation=null,this.widthBreakpoint=null,this.heightBreakpoint=null,this.breakpoints=pV}initialize(){this.addHandles(he(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),gi))}destroy(){this.destroyed||this._removeActiveClassNames()}set breakpoints(r){if(r===this._get("breakpoints"))return;const i=lXe(r);if(!i){const n=JSON.stringify(pV,null,2);console.warn("provided breakpoints are not valid, using defaults:"+n)}r=i?r:pV,this._set("breakpoints",{...r})}_updateClassNames(){if(!this.container)return;const r=Dc.acquire(),i=Dc.acquire();let n,s=!1;for(n in x5){const o=this[n],a=x5[n].getValue({viewSize:this.size,breakpoints:this.breakpoints});o!==a&&(s=!0,this[n]=a,fV(n,o).forEach(l=>i.push(l)),fV(n,a).forEach(l=>r.push(l)))}s&&(this._applyClassNameChanges(r,i),Dc.release(r),Dc.release(i))}_applyClassNameChanges(r,i){const n=this.container;n&&(i.forEach(s=>n.classList.remove(s)),r.forEach(s=>n.classList.add(s)))}_removeActiveClassNames(){const r=this.container;if(!r)return;let i;for(i in x5)fV(i,this[i]).forEach(n=>r.classList.remove(n))}};return d([m()],e.prototype,"breakpoints",null),d([m()],e.prototype,"orientation",void 0),d([m()],e.prototype,"widthBreakpoint",void 0),d([m()],e.prototype,"heightBreakpoint",void 0),e=d([V("esri.views.BreakpointsOwner")],e),e};let Jp=class extends Ae{constructor(){super(...arguments),this.updating=!1,this._handleId=0,this._scheduleHandleId=0,this._pendingPromises=new Set}destroy(){this.removeAll()}add(e,r,i={}){return this._installWatch(e,r,i,he)}addWhen(e,r,i={}){return this._installWatch(e,r,i,fd)}addOnCollectionChange(e,r,{initial:i=!1,final:n=!1}={}){const s=++this._handleId;return this.addHandles([Vo(e,"after-changes",this._createSyncUpdatingCallback(),Qr),Vo(e,"change",r,{onListenerAdd:i?o=>r({added:o.toArray(),removed:[]}):void 0,onListenerRemove:n?o=>r({added:[],removed:o.toArray()}):void 0})],s),Zr(()=>this.removeHandles(s))}addPromise(e){if(e==null)return e;const r=++this._handleId;this.addHandles(Zr(()=>{this._pendingPromises.delete(e)&&(this._pendingPromises.size!==0||this.hasHandles(_D)||this._set("updating",!1))}),r),this._pendingPromises.add(e),this._set("updating",!0);const i=()=>this.removeHandles(r);return e.then(i,i),e}removeAll(){this._pendingPromises.clear(),this.removeAllHandles(),this._set("updating",!1)}_installWatch(e,r,i={},n){const s=++this._handleId;i.sync||this._installSyncUpdatingWatch(e,s);const o=n(e,r,i);return this.addHandles(o,s),Zr(()=>this.removeHandles(s))}_installSyncUpdatingWatch(e,r){const i=this._createSyncUpdatingCallback(),n=he(e,i,{sync:!0,equals:()=>!1});return this.addHandles(n,r),n}_createSyncUpdatingCallback(){return()=>{this.removeHandles(_D),++this._scheduleHandleId;const e=this._scheduleHandleId;this._get("updating")||this._set("updating",!0),this.addHandles(M3(()=>{e===this._scheduleHandleId&&(this._set("updating",this._pendingPromises.size>0),this.removeHandles(_D))}),_D)}}};d([m({readOnly:!0})],Jp.prototype,"updating",void 0),Jp=d([V("esri.core.support.UpdatingHandles")],Jp);const _D=-42;/*!
 * @esri/arcgis-html-sanitizer - v3.0.1 - Tue Nov 15 2022 09:46:54 GMT-0800 (Pacific Standard Time)
 * Copyright (c) 2022 - Environmental Systems Research Institute, Inc.
 * Apache-2.0
 * 
 * js-xss
 * Copyright (c) 2012-2018 Zongmin Lei(雷宗民) <leizongmin@gmail.com>
 * http://ucdok.com
 * MIT License, see https://github.com/leizongmin/js-xss/blob/master/LICENSE for details
 */var uXe=function(t){if(typeof t!="object"||t===null||Object.prototype.toString.call(t)!=="[object Object]")return!1;var e=Object.getPrototypeOf(t);if(e===null)return!0;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e},Uw={exports:{}},bs={},E$={exports:{}},I2={};function KSe(){var t={};return t["align-content"]=!1,t["align-items"]=!1,t["align-self"]=!1,t["alignment-adjust"]=!1,t["alignment-baseline"]=!1,t.all=!1,t["anchor-point"]=!1,t.animation=!1,t["animation-delay"]=!1,t["animation-direction"]=!1,t["animation-duration"]=!1,t["animation-fill-mode"]=!1,t["animation-iteration-count"]=!1,t["animation-name"]=!1,t["animation-play-state"]=!1,t["animation-timing-function"]=!1,t.azimuth=!1,t["backface-visibility"]=!1,t.background=!0,t["background-attachment"]=!0,t["background-clip"]=!0,t["background-color"]=!0,t["background-image"]=!0,t["background-origin"]=!0,t["background-position"]=!0,t["background-repeat"]=!0,t["background-size"]=!0,t["baseline-shift"]=!1,t.binding=!1,t.bleed=!1,t["bookmark-label"]=!1,t["bookmark-level"]=!1,t["bookmark-state"]=!1,t.border=!0,t["border-bottom"]=!0,t["border-bottom-color"]=!0,t["border-bottom-left-radius"]=!0,t["border-bottom-right-radius"]=!0,t["border-bottom-style"]=!0,t["border-bottom-width"]=!0,t["border-collapse"]=!0,t["border-color"]=!0,t["border-image"]=!0,t["border-image-outset"]=!0,t["border-image-repeat"]=!0,t["border-image-slice"]=!0,t["border-image-source"]=!0,t["border-image-width"]=!0,t["border-left"]=!0,t["border-left-color"]=!0,t["border-left-style"]=!0,t["border-left-width"]=!0,t["border-radius"]=!0,t["border-right"]=!0,t["border-right-color"]=!0,t["border-right-style"]=!0,t["border-right-width"]=!0,t["border-spacing"]=!0,t["border-style"]=!0,t["border-top"]=!0,t["border-top-color"]=!0,t["border-top-left-radius"]=!0,t["border-top-right-radius"]=!0,t["border-top-style"]=!0,t["border-top-width"]=!0,t["border-width"]=!0,t.bottom=!1,t["box-decoration-break"]=!0,t["box-shadow"]=!0,t["box-sizing"]=!0,t["box-snap"]=!0,t["box-suppress"]=!0,t["break-after"]=!0,t["break-before"]=!0,t["break-inside"]=!0,t["caption-side"]=!1,t.chains=!1,t.clear=!0,t.clip=!1,t["clip-path"]=!1,t["clip-rule"]=!1,t.color=!0,t["color-interpolation-filters"]=!0,t["column-count"]=!1,t["column-fill"]=!1,t["column-gap"]=!1,t["column-rule"]=!1,t["column-rule-color"]=!1,t["column-rule-style"]=!1,t["column-rule-width"]=!1,t["column-span"]=!1,t["column-width"]=!1,t.columns=!1,t.contain=!1,t.content=!1,t["counter-increment"]=!1,t["counter-reset"]=!1,t["counter-set"]=!1,t.crop=!1,t.cue=!1,t["cue-after"]=!1,t["cue-before"]=!1,t.cursor=!1,t.direction=!1,t.display=!0,t["display-inside"]=!0,t["display-list"]=!0,t["display-outside"]=!0,t["dominant-baseline"]=!1,t.elevation=!1,t["empty-cells"]=!1,t.filter=!1,t.flex=!1,t["flex-basis"]=!1,t["flex-direction"]=!1,t["flex-flow"]=!1,t["flex-grow"]=!1,t["flex-shrink"]=!1,t["flex-wrap"]=!1,t.float=!1,t["float-offset"]=!1,t["flood-color"]=!1,t["flood-opacity"]=!1,t["flow-from"]=!1,t["flow-into"]=!1,t.font=!0,t["font-family"]=!0,t["font-feature-settings"]=!0,t["font-kerning"]=!0,t["font-language-override"]=!0,t["font-size"]=!0,t["font-size-adjust"]=!0,t["font-stretch"]=!0,t["font-style"]=!0,t["font-synthesis"]=!0,t["font-variant"]=!0,t["font-variant-alternates"]=!0,t["font-variant-caps"]=!0,t["font-variant-east-asian"]=!0,t["font-variant-ligatures"]=!0,t["font-variant-numeric"]=!0,t["font-variant-position"]=!0,t["font-weight"]=!0,t.grid=!1,t["grid-area"]=!1,t["grid-auto-columns"]=!1,t["grid-auto-flow"]=!1,t["grid-auto-rows"]=!1,t["grid-column"]=!1,t["grid-column-end"]=!1,t["grid-column-start"]=!1,t["grid-row"]=!1,t["grid-row-end"]=!1,t["grid-row-start"]=!1,t["grid-template"]=!1,t["grid-template-areas"]=!1,t["grid-template-columns"]=!1,t["grid-template-rows"]=!1,t["hanging-punctuation"]=!1,t.height=!0,t.hyphens=!1,t.icon=!1,t["image-orientation"]=!1,t["image-resolution"]=!1,t["ime-mode"]=!1,t["initial-letters"]=!1,t["inline-box-align"]=!1,t["justify-content"]=!1,t["justify-items"]=!1,t["justify-self"]=!1,t.left=!1,t["letter-spacing"]=!0,t["lighting-color"]=!0,t["line-box-contain"]=!1,t["line-break"]=!1,t["line-grid"]=!1,t["line-height"]=!1,t["line-snap"]=!1,t["line-stacking"]=!1,t["line-stacking-ruby"]=!1,t["line-stacking-shift"]=!1,t["line-stacking-strategy"]=!1,t["list-style"]=!0,t["list-style-image"]=!0,t["list-style-position"]=!0,t["list-style-type"]=!0,t.margin=!0,t["margin-bottom"]=!0,t["margin-left"]=!0,t["margin-right"]=!0,t["margin-top"]=!0,t["marker-offset"]=!1,t["marker-side"]=!1,t.marks=!1,t.mask=!1,t["mask-box"]=!1,t["mask-box-outset"]=!1,t["mask-box-repeat"]=!1,t["mask-box-slice"]=!1,t["mask-box-source"]=!1,t["mask-box-width"]=!1,t["mask-clip"]=!1,t["mask-image"]=!1,t["mask-origin"]=!1,t["mask-position"]=!1,t["mask-repeat"]=!1,t["mask-size"]=!1,t["mask-source-type"]=!1,t["mask-type"]=!1,t["max-height"]=!0,t["max-lines"]=!1,t["max-width"]=!0,t["min-height"]=!0,t["min-width"]=!0,t["move-to"]=!1,t["nav-down"]=!1,t["nav-index"]=!1,t["nav-left"]=!1,t["nav-right"]=!1,t["nav-up"]=!1,t["object-fit"]=!1,t["object-position"]=!1,t.opacity=!1,t.order=!1,t.orphans=!1,t.outline=!1,t["outline-color"]=!1,t["outline-offset"]=!1,t["outline-style"]=!1,t["outline-width"]=!1,t.overflow=!1,t["overflow-wrap"]=!1,t["overflow-x"]=!1,t["overflow-y"]=!1,t.padding=!0,t["padding-bottom"]=!0,t["padding-left"]=!0,t["padding-right"]=!0,t["padding-top"]=!0,t.page=!1,t["page-break-after"]=!1,t["page-break-before"]=!1,t["page-break-inside"]=!1,t["page-policy"]=!1,t.pause=!1,t["pause-after"]=!1,t["pause-before"]=!1,t.perspective=!1,t["perspective-origin"]=!1,t.pitch=!1,t["pitch-range"]=!1,t["play-during"]=!1,t.position=!1,t["presentation-level"]=!1,t.quotes=!1,t["region-fragment"]=!1,t.resize=!1,t.rest=!1,t["rest-after"]=!1,t["rest-before"]=!1,t.richness=!1,t.right=!1,t.rotation=!1,t["rotation-point"]=!1,t["ruby-align"]=!1,t["ruby-merge"]=!1,t["ruby-position"]=!1,t["shape-image-threshold"]=!1,t["shape-outside"]=!1,t["shape-margin"]=!1,t.size=!1,t.speak=!1,t["speak-as"]=!1,t["speak-header"]=!1,t["speak-numeral"]=!1,t["speak-punctuation"]=!1,t["speech-rate"]=!1,t.stress=!1,t["string-set"]=!1,t["tab-size"]=!1,t["table-layout"]=!1,t["text-align"]=!0,t["text-align-last"]=!0,t["text-combine-upright"]=!0,t["text-decoration"]=!0,t["text-decoration-color"]=!0,t["text-decoration-line"]=!0,t["text-decoration-skip"]=!0,t["text-decoration-style"]=!0,t["text-emphasis"]=!0,t["text-emphasis-color"]=!0,t["text-emphasis-position"]=!0,t["text-emphasis-style"]=!0,t["text-height"]=!0,t["text-indent"]=!0,t["text-justify"]=!0,t["text-orientation"]=!0,t["text-overflow"]=!0,t["text-shadow"]=!0,t["text-space-collapse"]=!0,t["text-transform"]=!0,t["text-underline-position"]=!0,t["text-wrap"]=!0,t.top=!1,t.transform=!1,t["transform-origin"]=!1,t["transform-style"]=!1,t.transition=!1,t["transition-delay"]=!1,t["transition-duration"]=!1,t["transition-property"]=!1,t["transition-timing-function"]=!1,t["unicode-bidi"]=!1,t["vertical-align"]=!1,t.visibility=!1,t["voice-balance"]=!1,t["voice-duration"]=!1,t["voice-family"]=!1,t["voice-pitch"]=!1,t["voice-range"]=!1,t["voice-rate"]=!1,t["voice-stress"]=!1,t["voice-volume"]=!1,t.volume=!1,t["white-space"]=!1,t.widows=!1,t.width=!0,t["will-change"]=!1,t["word-break"]=!0,t["word-spacing"]=!0,t["word-wrap"]=!0,t["wrap-flow"]=!1,t["wrap-through"]=!1,t["writing-mode"]=!1,t["z-index"]=!1,t}function hXe(t,e,r){}function dXe(t,e,r){}var pXe=/javascript\s*\:/img;function fXe(t,e){return pXe.test(e)?"":e}I2.whiteList=KSe();I2.getDefaultWhiteList=KSe;I2.onAttr=hXe;I2.onIgnoreAttr=dXe;I2.safeAttrValue=fXe;var mXe={indexOf:function(t,e){var r,i;if(Array.prototype.indexOf)return t.indexOf(e);for(r=0,i=t.length;r<i;r++)if(t[r]===e)return r;return-1},forEach:function(t,e,r){var i,n;if(Array.prototype.forEach)return t.forEach(e,r);for(i=0,n=t.length;i<n;i++)e.call(r,t[i],i,t)},trim:function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(t){return String.prototype.trimRight?t.trimRight():t.replace(/(\s*$)/g,"")}},MP=mXe;function gXe(t,e){t=MP.trimRight(t),t[t.length-1]!==";"&&(t+=";");var r=t.length,i=!1,n=0,s=0,o="";function a(){if(!i){var u=MP.trim(t.slice(n,s)),h=u.indexOf(":");if(h!==-1){var p=MP.trim(u.slice(0,h)),f=MP.trim(u.slice(h+1));if(p){var g=e(n,o.length,p,f,u);g&&(o+=g+"; ")}}}n=s+1}for(;s<r;s++){var l=t[s];if(l==="/"&&t[s+1]==="*"){var c=t.indexOf("*/",s+2);if(c===-1)break;s=c+1,n=s+1,i=!1}else l==="("?i=!0:l===")"?i=!1:l===";"?i||a():l===`
`&&a()}return MP.trim(o)}var yXe=gXe,vD=I2,_Xe=yXe;function qle(t){return t==null}function vXe(t){var e={};for(var r in t)e[r]=t[r];return e}function eCe(t){t=vXe(t||{}),t.whiteList=t.whiteList||vD.whiteList,t.onAttr=t.onAttr||vD.onAttr,t.onIgnoreAttr=t.onIgnoreAttr||vD.onIgnoreAttr,t.safeAttrValue=t.safeAttrValue||vD.safeAttrValue,this.options=t}eCe.prototype.process=function(t){if(t=t||"",t=t.toString(),!t)return"";var e=this,r=e.options,i=r.whiteList,n=r.onAttr,s=r.onIgnoreAttr,o=r.safeAttrValue,a=_Xe(t,function(l,c,u,h,p){var f=i[u],g=!1;if(f===!0?g=f:typeof f=="function"?g=f(h):f instanceof RegExp&&(g=f.test(h)),g!==!0&&(g=!1),h=o(u,h),!!h){var _={position:c,sourcePosition:l,source:p,isWhite:g};if(g){var v=n(u,h,_);return qle(v)?u+":"+h:v}else{var v=s(u,h,_);if(!qle(v))return v}}});return a};var bXe=eCe;(function(t,e){var r=I2,i=bXe;function n(o,a){var l=new i(a);return l.process(o)}e=t.exports=n,e.FilterCSS=i;for(var s in r)e[s]=r[s]})(E$,E$.exports);var ote={indexOf:function(t,e){var r,i;if(Array.prototype.indexOf)return t.indexOf(e);for(r=0,i=t.length;r<i;r++)if(t[r]===e)return r;return-1},forEach:function(t,e,r){var i,n;if(Array.prototype.forEach)return t.forEach(e,r);for(i=0,n=t.length;i<n;i++)e.call(r,t[i],i,t)},trim:function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(t){var e=/\s|\n|\t/,r=e.exec(t);return r?r.index:-1}},wXe=E$.exports.FilterCSS,xXe=E$.exports.getDefaultWhiteList,T6=ote;function tCe(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}}var rCe=new wXe;function TXe(t,e,r){}function SXe(t,e,r){}function CXe(t,e,r){}function EXe(t,e,r){}function iCe(t){return t.replace(AXe,"&lt;").replace(MXe,"&gt;")}function PXe(t,e,r,i){if(r=cCe(r),e==="href"||e==="src"){if(r=T6.trim(r),r==="#")return"#";if(!(r.substr(0,7)==="http://"||r.substr(0,8)==="https://"||r.substr(0,7)==="mailto:"||r.substr(0,4)==="tel:"||r.substr(0,11)==="data:image/"||r.substr(0,6)==="ftp://"||r.substr(0,2)==="./"||r.substr(0,3)==="../"||r[0]==="#"||r[0]==="/"))return""}else if(e==="background"){if(bD.lastIndex=0,bD.test(r))return""}else if(e==="style"){if(Yle.lastIndex=0,Yle.test(r)||(Xle.lastIndex=0,Xle.test(r)&&(bD.lastIndex=0,bD.test(r))))return"";i!==!1&&(i=i||rCe,r=i.process(r))}return r=uCe(r),r}var AXe=/</g,MXe=/>/g,OXe=/"/g,RXe=/&quot;/g,$Xe=/&#([a-zA-Z0-9]*);?/gim,IXe=/&colon;?/gim,LXe=/&newline;?/gim,bD=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/gi,Yle=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,Xle=/u\s*r\s*l\s*\(.*/gi;function nCe(t){return t.replace(OXe,"&quot;")}function sCe(t){return t.replace(RXe,'"')}function oCe(t){return t.replace($Xe,function(r,i){return i[0]==="x"||i[0]==="X"?String.fromCharCode(parseInt(i.substr(1),16)):String.fromCharCode(parseInt(i,10))})}function aCe(t){return t.replace(IXe,":").replace(LXe," ")}function lCe(t){for(var e="",r=0,i=t.length;r<i;r++)e+=t.charCodeAt(r)<32?" ":t.charAt(r);return T6.trim(e)}function cCe(t){return t=sCe(t),t=oCe(t),t=aCe(t),t=lCe(t),t}function uCe(t){return t=nCe(t),t=iCe(t),t}function DXe(){return""}function NXe(t,e){typeof e!="function"&&(e=function(){});var r=!Array.isArray(t);function i(o){return r?!0:T6.indexOf(t,o)!==-1}var n=[],s=!1;return{onIgnoreTag:function(o,a,l){if(i(o))if(l.isClosing){var c="[/removed]",u=l.position+c.length;return n.push([s!==!1?s:l.position,u]),s=!1,c}else return s||(s=l.position),"[removed]";else return e(o,a,l)},remove:function(o){var a="",l=0;return T6.forEach(n,function(c){a+=o.slice(l,c[0]),l=c[1]}),a+=o.slice(l),a}}}function FXe(t){for(var e="",r=0;r<t.length;){var i=t.indexOf("<!--",r);if(i===-1){e+=t.slice(r);break}e+=t.slice(r,i);var n=t.indexOf("-->",i);if(n===-1)break;r=n+3}return e}function kXe(t){var e=t.split("");return e=e.filter(function(r){var i=r.charCodeAt(0);return i===127?!1:i<=31?i===10||i===13:!0}),e.join("")}bs.whiteList=tCe();bs.getDefaultWhiteList=tCe;bs.onTag=TXe;bs.onIgnoreTag=SXe;bs.onTagAttr=CXe;bs.onIgnoreTagAttr=EXe;bs.safeAttrValue=PXe;bs.escapeHtml=iCe;bs.escapeQuote=nCe;bs.unescapeQuote=sCe;bs.escapeHtmlEntities=oCe;bs.escapeDangerHtml5Entities=aCe;bs.clearNonPrintableCharacter=lCe;bs.friendlyAttrValue=cCe;bs.escapeAttrValue=uCe;bs.onIgnoreTagStripAll=DXe;bs.StripTagBody=NXe;bs.stripCommentTag=FXe;bs.stripBlankChar=kXe;bs.cssFilter=rCe;bs.getDefaultCSSWhiteList=xXe;var L9={},J_=ote;function zXe(t){var e=J_.spaceIndex(t),r;return e===-1?r=t.slice(1,-1):r=t.slice(1,e+1),r=J_.trim(r).toLowerCase(),r.slice(0,1)==="/"&&(r=r.slice(1)),r.slice(-1)==="/"&&(r=r.slice(0,-1)),r}function UXe(t){return t.slice(0,2)==="</"}function BXe(t,e,r){var i="",n=0,s=!1,o=!1,a=0,l=t.length,c="",u="";e:for(a=0;a<l;a++){var h=t.charAt(a);if(s===!1){if(h==="<"){s=a;continue}}else if(o===!1){if(h==="<"){i+=r(t.slice(n,a)),s=a,n=a;continue}if(h===">"){i+=r(t.slice(n,s)),u=t.slice(s,a+1),c=zXe(u),i+=e(s,i.length,c,u,UXe(u)),n=a+1,s=!1;continue}if(h==='"'||h==="'")for(var p=1,f=t.charAt(a-p);f.trim()===""||f==="=";){if(f==="="){o=h;continue e}f=t.charAt(a-++p)}}else if(h===o){o=!1;continue}}return n<t.length&&(i+=r(t.substr(n))),i}var VXe=/[^a-zA-Z0-9\\_:.-]/gim;function GXe(t,e){var r=0,i=0,n=[],s=!1,o=t.length;function a(p,f){if(p=J_.trim(p),p=p.replace(VXe,"").toLowerCase(),!(p.length<1)){var g=e(p,f||"");g&&n.push(g)}}for(var l=0;l<o;l++){var c=t.charAt(l),u,h;if(s===!1&&c==="="){s=t.slice(r,l),r=l+1,i=t.charAt(r)==='"'||t.charAt(r)==="'"?r:HXe(t,l+1);continue}if(s!==!1&&l===i){if(h=t.indexOf(c,l+1),h===-1)break;u=J_.trim(t.slice(i+1,h)),a(s,u),s=!1,l=h,r=l+1;continue}if(/\s|\n|\t/.test(c))if(t=t.replace(/\s|\n|\t/g," "),s===!1)if(h=jXe(t,l),h===-1){u=J_.trim(t.slice(r,l)),a(u),s=!1,r=l+1;continue}else{l=h-1;continue}else if(h=WXe(t,l-1),h===-1){u=J_.trim(t.slice(r,l)),u=Zle(u),a(s,u),s=!1,r=l+1;continue}else continue}return r<t.length&&(s===!1?a(t.slice(r)):a(s,Zle(J_.trim(t.slice(r))))),J_.trim(n.join(" "))}function jXe(t,e){for(;e<t.length;e++){var r=t[e];if(r!==" ")return r==="="?e:-1}}function HXe(t,e){for(;e<t.length;e++){var r=t[e];if(r!==" ")return r==="'"||r==='"'?e:-1}}function WXe(t,e){for(;e>0;e--){var r=t[e];if(r!==" ")return r==="="?e:-1}}function qXe(t){return t[0]==='"'&&t[t.length-1]==='"'||t[0]==="'"&&t[t.length-1]==="'"}function Zle(t){return qXe(t)?t.substr(1,t.length-2):t}L9.parseTag=BXe;L9.parseAttr=GXe;var YXe=E$.exports.FilterCSS,fp=bs,hCe=L9,XXe=hCe.parseTag,ZXe=hCe.parseAttr,T5=ote;function wD(t){return t==null}function JXe(t){var e=T5.spaceIndex(t);if(e===-1)return{html:"",closing:t[t.length-2]==="/"};t=T5.trim(t.slice(e+1,-1));var r=t[t.length-1]==="/";return r&&(t=T5.trim(t.slice(0,-1))),{html:t,closing:r}}function QXe(t){var e={};for(var r in t)e[r]=t[r];return e}function KXe(t){var e={};for(var r in t)Array.isArray(t[r])?e[r.toLowerCase()]=t[r].map(function(i){return i.toLowerCase()}):e[r.toLowerCase()]=t[r];return e}function dCe(t){t=QXe(t||{}),t.stripIgnoreTag&&(t.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),t.onIgnoreTag=fp.onIgnoreTagStripAll),t.whiteList||t.allowList?t.whiteList=KXe(t.whiteList||t.allowList):t.whiteList=fp.whiteList,t.onTag=t.onTag||fp.onTag,t.onTagAttr=t.onTagAttr||fp.onTagAttr,t.onIgnoreTag=t.onIgnoreTag||fp.onIgnoreTag,t.onIgnoreTagAttr=t.onIgnoreTagAttr||fp.onIgnoreTagAttr,t.safeAttrValue=t.safeAttrValue||fp.safeAttrValue,t.escapeHtml=t.escapeHtml||fp.escapeHtml,this.options=t,t.css===!1?this.cssFilter=!1:(t.css=t.css||{},this.cssFilter=new YXe(t.css))}dCe.prototype.process=function(t){if(t=t||"",t=t.toString(),!t)return"";var e=this,r=e.options,i=r.whiteList,n=r.onTag,s=r.onIgnoreTag,o=r.onTagAttr,a=r.onIgnoreTagAttr,l=r.safeAttrValue,c=r.escapeHtml,u=e.cssFilter;r.stripBlankChar&&(t=fp.stripBlankChar(t)),r.allowCommentTag||(t=fp.stripCommentTag(t));var h=!1;r.stripIgnoreTagBody&&(h=fp.StripTagBody(r.stripIgnoreTagBody,s),s=h.onIgnoreTag);var p=XXe(t,function(f,g,_,v,b){var w={sourcePosition:f,position:g,isClosing:b,isWhite:Object.prototype.hasOwnProperty.call(i,_)},x=n(_,v,w);if(!wD(x))return x;if(w.isWhite){if(w.isClosing)return"</"+_+">";var S=JXe(v),E=i[_],A=ZXe(S.html,function(O,L){var z=T5.indexOf(E,O)!==-1,k=o(_,O,L,z);return wD(k)?z?(L=l(_,O,L,u),L?O+'="'+L+'"':O):(k=a(_,O,L,z),wD(k)?void 0:k):k});return v="<"+_,A&&(v+=" "+A),S.closing&&(v+=" /"),v+=">",v}else return x=s(_,v,w),wD(x)?c(v):x},c);return h&&(p=h.remove(p)),p};var eZe=dCe;(function(t,e){var r=bs,i=L9,n=eZe;function s(a,l){var c=new n(l);return c.process(a)}e=t.exports=s,e.filterXSS=s,e.FilterXSS=n,function(){for(var a in r)e[a]=r[a];for(var l in i)e[l]=i[l]}();function o(){return typeof self<"u"&&typeof DedicatedWorkerGlobalScope<"u"&&self instanceof DedicatedWorkerGlobalScope}o()&&(self.filterXSS=t.exports)})(Uw,Uw.exports);var tZe=function(){function t(e,r){var i=this;this.arcgisWhiteList={a:["href","style","target"],abbr:["title"],audio:["autoplay","controls","loop","muted","preload"],b:[],br:[],dd:["style"],div:["align","style"],dl:["style"],dt:["style"],em:[],figcaption:["style"],figure:["style"],font:["color","face","size","style"],h1:["style"],h2:["style"],h3:["style"],h4:["style"],h5:["style"],h6:["style"],hr:[],i:[],img:["alt","border","height","src","style","width"],li:[],ol:[],p:["style"],source:["media","src","type"],span:["style"],strong:[],sub:["style"],sup:["style"],table:["border","cellpadding","cellspacing","height","style","width"],tbody:[],tr:["align","height","style","valign"],td:["align","colspan","height","nowrap","rowspan","style","valign","width"],th:["align","colspan","height","nowrap","rowspan","style","valign","width"],u:[],ul:[],video:["autoplay","controls","height","loop","muted","poster","preload","width"]},this.allowedProtocols=["http","https","mailto","iform","tel","flow","lfmobile","arcgis-navigator","arcgis-appstudio-player","arcgis-survey123","arcgis-collector","arcgis-workforce","arcgis-explorer","arcgis-trek2there","arcgis-quickcapture","mspbi","comgooglemaps","pdfefile","pdfehttp","pdfehttps","boxapp","boxemm","awb","awbs","gropen","radarscope"],this.arcgisFilterOptions={allowCommentTag:!0,safeAttrValue:function(s,o,a,l){return s==="a"&&o==="href"||(s==="img"||s==="source")&&o==="src"?i.sanitizeUrl(a):Uw.exports.safeAttrValue(s,o,a,l)}},this._entityMap={"&":"&#x38;","<":"&#x3C;",">":"&#x3E;",'"':"&#x22;","'":"&#x27;","/":"&#x2F;"};var n;e&&!r?n=e:e&&r?(n=Object.create(this.arcgisFilterOptions),Object.keys(e).forEach(function(s){s==="whiteList"?n.whiteList=i._extendObjectOfArrays([i.arcgisWhiteList,e.whiteList||{}]):n[s]=e[s]})):(n=Object.create(this.arcgisFilterOptions),n.whiteList=this.arcgisWhiteList),this.xssFilterOptions=n,this._xssFilter=new Uw.exports.FilterXSS(n)}return t.prototype.sanitize=function(e,r){switch(r===void 0&&(r={}),typeof e){case"number":return isNaN(e)||!isFinite(e)?null:e;case"boolean":return e;case"string":return this._xssFilter.process(e);case"object":return this._iterateOverObject(e,r);default:return r.allowUndefined&&typeof e>"u"?void 0:null}},t.prototype.sanitizeUrl=function(e,r){var i=(r??{}).isProtocolRequired,n=i===void 0?!0:i,s=this._trim(e.substring(0,e.indexOf(":"))),o=e==="/",a=/^#/.test(e),l=s&&this.allowedProtocols.indexOf(s.toLowerCase())>-1;return o||a||l?Uw.exports.escapeAttrValue(e):!s&&!n?Uw.exports.escapeAttrValue("https://".concat(e)):""},t.prototype.sanitizeHTMLAttribute=function(e,r,i,n){return typeof this.xssFilterOptions.safeAttrValue=="function"?this.xssFilterOptions.safeAttrValue(e,r,i,n):Uw.exports.safeAttrValue(e,r,i,n)},t.prototype.validate=function(e,r){r===void 0&&(r={});var i=this.sanitize(e,r);return{isValid:e===i,sanitized:i}},t.prototype.encodeHTML=function(e){var r=this;return String(e).replace(/[&<>"'\/]/g,function(i){return r._entityMap[i]})},t.prototype.encodeAttrValue=function(e){var r=/^[a-zA-Z0-9]$/;return String(e).replace(/[\x00-\xFF]/g,function(i,n){return r.test(i)?i:"&#x".concat(Number(e.charCodeAt(n)).toString(16),";")})},t.prototype._extendObjectOfArrays=function(e){var r={};return e.forEach(function(i){Object.keys(i).forEach(function(n){Array.isArray(i[n])&&Array.isArray(r[n])?r[n]=r[n].concat(i[n]):r[n]=i[n]})}),r},t.prototype._iterateOverObject=function(e,r){var i=this;r===void 0&&(r={});try{var n=!1,s=void 0;if(Array.isArray(e))s=e.reduce(function(a,l){var c=i.validate(l,r);return c.isValid?a.concat([l]):(n=!0,a.concat([c.sanitized]))},[]);else if(uXe(e)){var o=Object.keys(e);s=o.reduce(function(a,l){var c=e[l],u=i.validate(c,r);return u.isValid?a[l]=c:(n=!0,a[l]=u.sanitized),a},{})}else return r.allowUndefined&&typeof e>"u"?void 0:null;return n?s:e}catch{return null}},t.prototype._trim=function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},t}();const D9=new Map;function pCe(){D9.clear()}function rZe(t){return D9.get(t)}function iZe(t,e){D9.set(t,e)}function mV(t){D9.delete(t)}const nZe=()=>re.getLogger("esri.widgets.support.widgetUtils");function sZe(...t){const e=Dc.acquire();for(let i=0;i<t.length;i++){const n=t[i],s=typeof n;if(s==="string")e.push(n);else if(Array.isArray(n))e.push.apply(e,n);else if(s==="object")for(const o in n)n[o]&&e.push(o)}const r=e.join(" ");return Dc.release(e),r}(()=>{const t=new Map,e=new ResizeObserver(i=>{var n;pCe();for(const s of i)(n=t.get(s.target))==null||n(s)}),r=(i,n,s)=>(t.has(i)&&nZe().error("Already observing element",i),t.set(i,n),e.observe(i,s),Zr(()=>{e.unobserve(i),t.delete(i)}));return(i,n,s)=>{let o=null;return Hx([he(()=>typeof i=="function"?i():i,a=>{o==null||o.remove(),a&&(o=r(a,n,s))},Kr),Zr(()=>o==null?void 0:o.remove())])}})();function oZe(t){const e=t==null?void 0:t.closest("[dir]");return e!==null&&e instanceof HTMLElement&&e.dir==="rtl"||document.dir==="rtl"}function Tkt(t){const e="data-node-ref";this[t.getAttribute(e)]=null}function Skt(t){const e="data-node-ref";this[t.getAttribute(e)]=t}const aZe=["dd","dl","dt","h1","h2","h3","h4","h5","h6","sub","sup","animate","animatetransform","circle","clippath","defs","ellipse","g","image","line","lineargradient","marker","mask","path","pattern","polygon","polyline","radialgradient","rect","stop","svg","switch","symbol","text","textpath","tspan","use"],lZe=aZe.reduce((t,e)=>(t[e]=[],t),{}),cZe=["align","alink","alt","bgcolor","border","cellpadding","cellspacing","class","color","cols","colspan","coords","d","dir","face","height","hspace","ismap","lang","marginheight","marginwidth","multiple","nohref","noresize","noshade","nowrap","ref","rel","rev","rows","rowspan","scrolling","shape","span","summary","tabindex","title","usemap","valign","value","vlink","vspace","width"],fCe=new tZe({whiteList:lZe,onTagAttr:(t,e,r)=>{const i=`${e}="${r}"`;if(cZe.includes(e))return i},stripIgnoreTag:!0,stripIgnoreTagBody:["script","style"]},!0);function uZe(t){return t==="Enter"||t===" "}const mCe="http://www.w3.org/",N9=`${mCe}2000/svg`,gCe=`${mCe}1999/xlink`;let Jle=[],ate=(t,e)=>{let r={};return Object.keys(t).forEach(i=>{r[i]=t[i]}),e&&Object.keys(e).forEach(i=>{r[i]=e[i]}),r},lte=(t,e)=>t.vnodeSelector===e.vnodeSelector&&(t.properties&&e.properties?t.properties.key===e.properties.key&&t.properties.bind===e.properties.bind:!t.properties&&!e.properties),yCe=t=>{if(typeof t!="string")throw new Error("Style values must be strings")},hZe=(t,e,r)=>{if(e.vnodeSelector!==""){for(let i=r;i<t.length;i++)if(lte(t[i],e))return i}return-1},gV=(t,e,r,i)=>{let n=t[e];if(n.vnodeSelector==="")return;let s=n.properties;if(!(s&&(s.key===void 0?s.bind:s.key))){for(let o=0;o<t.length;o++)if(o!==e){let a=t[o];if(lte(a,n))throw new Error(`${r.vnodeSelector} had a ${n.vnodeSelector} child ${i==="added"?i:"removed"}, but there is now more than one. You must add unique key properties to make them distinguishable.`)}}},dZe=t=>{if(t.properties){let e=t.properties.enterAnimation;e&&e(t.domNode,t.properties)}},pq=[],fq=!1,_Ce=t=>{(t.children||[]).forEach(_Ce),t.properties&&t.properties.afterRemoved&&t.properties.afterRemoved.apply(t.properties.bind||t.properties,[t.domNode])},Qle=()=>{fq=!1,pq.forEach(_Ce),pq.length=0},Kle=t=>{pq.push(t),fq||(fq=!0,typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(Qle,{timeout:16}):setTimeout(Qle,16))},ece=t=>{let e=t.domNode;if(t.properties){let r=t.properties.exitAnimation;if(r)return e.style.pointerEvents="none",void r(e,()=>{e.parentNode&&(e.parentNode.removeChild(e),Kle(t))},t.properties)}e.parentNode&&(e.parentNode.removeChild(e),Kle(t))},pZe=(t,e,r)=>{if(!e)return;let i=r.eventHandlerInterceptor,n=Object.keys(e),s=n.length;for(let o=0;o<s;o++){let a=n[o],l=e[a];if(a==="className")throw new Error('Property "className" is not supported, use "class".');if(a==="class")gq(t,l,!0);else if(a==="classes"){let c=Object.keys(l),u=c.length;for(let h=0;h<u;h++){let p=c[h];l[p]&&t.classList.add(p)}}else if(a==="styles"){let c=Object.keys(l),u=c.length;for(let h=0;h<u;h++){let p=c[h],f=l[p];f&&(yCe(f),r.styleApplyer(t,p,f))}}else if(a!=="key"&&l!=null){let c=typeof l;c==="function"?(a.lastIndexOf("on",0)===0&&(i&&(l=i(a,l,t,e)),a==="oninput"&&function(){let u=l;l=function(h){u.apply(this,[h]),h.target["oninput-value"]=h.target.value}}()),t[a]=l):r.namespace===N9?a==="href"?t.setAttributeNS(gCe,a,l):t.setAttribute(a,l):c==="string"&&a!=="value"?a==="innerHTML"?t[a]=fCe.sanitize(l):mq(t)&&a in t?t[a]=l:t.setAttribute(a,l):t[a]=l}}};function mq(t){if(!(t instanceof Element&&t.tagName.includes("-")))return!1;const e=window.customElements.get(t.tagName.toLowerCase());return!!e&&t instanceof e}let S6,fZe=(t,e,r)=>{if(e)for(let i of e)sC(i,t,void 0,r)},vCe=(t,e,r)=>{fZe(t,e.children,r),e.text&&(t.textContent=e.text),pZe(t,e.properties,r),e.properties&&e.properties.afterCreate&&e.properties.afterCreate.apply(e.properties.bind||e.properties,[t,r,e.vnodeSelector,e.properties,e.children])},sC=(t,e,r,i)=>{let n,s=0,o=t.vnodeSelector,a=e.ownerDocument;if(o==="")n=t.domNode=a.createTextNode(t.text),r!==void 0?e.insertBefore(n,r):e.appendChild(n);else{for(let l=0;l<=o.length;++l){let c=o.charAt(l);if(l===o.length||c==="."||c==="#"){let u=o.charAt(s-1),h=o.slice(s,l);u==="."?n.classList.add(h):u==="#"?n.id=h:(h==="svg"&&(i=ate(i,{namespace:N9})),i.namespace!==void 0?n=t.domNode=a.createElementNS(i.namespace,h):(n=t.domNode=t.domNode||a.createElement(h),h==="input"&&t.properties&&t.properties.type!==void 0&&n.setAttribute("type",t.properties.type)),r!==void 0?e.insertBefore(n,r):n.parentNode!==e&&e.appendChild(n)),s=l+1}}vCe(n,t,i)}},gq=(t,e,r)=>{e&&e.split(" ").forEach(i=>{i&&t.classList.toggle(i,r)})},mZe=(t,e,r,i)=>{if(!r)return;let n=!1,s=Object.keys(r),o=s.length;for(let a=0;a<o;a++){let l=s[a],c=r[l],u=e[l];if(l==="class")u!==c&&(gq(t,u,!1),gq(t,c,!0));else if(l==="classes"){let h=t.classList,p=Object.keys(c),f=p.length;for(let g=0;g<f;g++){let _=p[g],v=!!c[_];v!==!!u[_]&&(n=!0,v?h.add(_):h.remove(_))}}else if(l==="styles"){let h=Object.keys(c),p=h.length;for(let f=0;f<p;f++){let g=h[f],_=c[g];_!==u[g]&&(n=!0,_?(yCe(_),i.styleApplyer(t,g,_)):i.styleApplyer(t,g,""))}}else if(c||typeof u!="string"||(c=""),l!=="value"||mq(t)){if(c!==u){let h=typeof c;h==="function"&&i.eventHandlerInterceptor||(i.namespace===N9?l==="href"?t.setAttributeNS(gCe,l,c):t.setAttribute(l,c):h==="string"?l==="innerHTML"?t[l]=fCe.sanitize(c):l==="role"&&c===""?t.removeAttribute(l):mq(t)&&l in t?t[l]=c:t.setAttribute(l,c):t[l]!==c&&(t[l]=c),n=!0)}}else{let h=t[l];h!==c&&(t["oninput-value"]?h===t["oninput-value"]:c!==u)&&(t[l]=c,t["oninput-value"]=void 0),c!==u&&(n=!0)}}return n},gZe=(t,e,r,i,n)=>{if(r===i)return!1;i=i||Jle;let s,o=(r=r||Jle).length,a=i.length,l=0,c=0,u=!1;for(;c<a;){let h=l<o?r[l]:void 0,p=i[c];if(h!==void 0&&lte(h,p))u=S6(h,p,n)||u,l++;else{let f=hZe(r,p,l+1);if(f>=0){for(s=l;s<f;s++)ece(r[s]),gV(r,s,t,"removed");u=S6(r[f],p,n)||u,l=f+1}else sC(p,e,l<o?r[l].domNode:void 0,n),dZe(p),gV(i,c,t,"added")}c++}if(o>l)for(s=l;s<o;s++)ece(r[s]),gV(r,s,t,"removed");return u};S6=(t,e,r)=>{let i=t.domNode,n=!1;if(t===e)return!1;let s=!1;if(e.vnodeSelector===""){if(e.text!==t.text){let o=i.ownerDocument.createTextNode(e.text);return i.parentNode.replaceChild(o,i),e.domNode=o,n=!0,n}e.domNode=i}else e.vnodeSelector.lastIndexOf("svg",0)===0&&(r=ate(r,{namespace:N9})),t.text!==e.text&&(s=!0,e.text===void 0?i.removeChild(i.firstChild):i.textContent=e.text),e.domNode=i,s=gZe(e,i,t.children,e.children,r)||s,s=mZe(i,t.properties,e.properties,r)||s,e.properties&&e.properties.afterUpdate&&e.properties.afterUpdate.apply(e.properties.bind||e.properties,[i,r,e.vnodeSelector,e.properties,e.children]);return s&&e.properties&&e.properties.updateAnimation&&e.properties.updateAnimation(i,e.properties,t.properties),n};let OP=(t,e)=>({getLastRender:()=>t,update:r=>{if(t.vnodeSelector!==r.vnodeSelector)throw new Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");let i=t;t=r,S6(i,r,e)},domNode:t.domNode});const yZe={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(t,e,r)=>{e.charAt(0)==="-"?t.style.setProperty(e,r):t.style[e]=r}};let lS=t=>ate(yZe,t),S1={create:(t,e)=>(e=lS(e),sC(t,document.createElement("div"),void 0,e),OP(t,e)),append:(t,e,r)=>(r=lS(r),sC(e,t,void 0,r),OP(e,r)),insertBefore:(t,e,r)=>(r=lS(r),sC(e,t.parentNode,t,r),OP(e,r)),merge:(t,e,r)=>(r=lS(r),e.domNode=t,vCe(t,e,r),OP(e,r)),replace:(t,e,r)=>(r=lS(r),sC(e,t.parentNode,t,r),t.parentNode.removeChild(t),OP(e,r))},bCe,_Ze=(t,e)=>{let r=[];for(;t&&t!==e;)r.push(t),t=t.parentNode;return r};bCe=Array.prototype.find?(t,e)=>t.find(e):(t,e)=>t.filter(e)[0];let vZe=(t,e)=>{let r=t;return e.forEach(i=>{r=r&&r.children?bCe(r.children,n=>n.domNode===i):void 0}),r},bZe=(t,e,r)=>{let i=function(n){r("domEvent",n);let s=e(),o=_Ze(n.currentTarget,s.domNode);o.reverse();let a,l=vZe(s.getLastRender(),o);return t.scheduleRender(),l&&(a=l.properties[`on${n.type}`].apply(l.properties.bind||this,arguments)),r("domEventProcessed",n),a};return(n,s,o,a)=>i},tce=t=>{let e,r,i=lS(t),n=i.performanceLogger,s=!0,o=!1,a=[],l=[],c=(h,p,f)=>{let g,_=()=>g;i.eventHandlerInterceptor=bZe(e,_,n),g=h(p,f(),i),a.push(g),l.push(f)},u=()=>{if(r=void 0,s){s=!1,n("renderStart",void 0);for(let h=0;h<a.length;h++){let p=l[h]();n("rendered",void 0),a[h].update(p),n("patched",void 0)}n("renderDone",void 0),s=!0}};return e={renderNow:u,scheduleRender:()=>{r||o||(r=requestAnimationFrame(u))},stop:()=>{r&&(cancelAnimationFrame(r),r=void 0),o=!0},resume:()=>{o=!1,s=!0,e.scheduleRender()},append:(h,p)=>{c(S1.append,h,p)},insertBefore:(h,p)=>{c(S1.insertBefore,h,p)},merge:(h,p)=>{c(S1.merge,h,p)},replace:(h,p)=>{c(S1.replace,h,p)},detach:h=>{for(let p=0;p<l.length;p++)if(l[p]===h)return l.splice(p,1),a.splice(p,1)[0];throw new Error("renderFunction was not found")}},e},x_=class extends Ae{constructor(){super(...arguments),this.items=new $t,this._watchUpdatingTracking=new Jp,this._callbacks=new Map,this._projector=tce(),this._hiddenProjector=tce()}get needsRender(){return this.items.length>0}get updating(){var e;return((e=this._watchUpdatingTracking)==null?void 0:e.updating)??!1}initialize(){const e=document.createElement("div");e.className="esri-overlay-surface",this._set("surface",e),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),e.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,r=>{for(const i of r.added){const n=()=>i.render();this._callbacks.set(i,n),this._projector.append(this.surface,n)}for(const i of r.removed){const n=this._projector.detach(this._callbacks.get(i));this.surface.removeChild(n.domNode),this._callbacks.delete(i)}})}addItem(e){this.items.add(e)}removeItem(e){this.items.remove(e)}destroy(){this.items.removeAll(),this._callbacks.forEach(e=>this._projector.detach(e)),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(e){const r=this._hiddenSurface,i=this._hiddenProjector;let n;const s=()=>(n=e.render(),n);i.append(r,s),i.renderNow();const o={left:0,top:0,right:0,bottom:0};if(n!=null&&n.domNode){const a=n.domNode.getBoundingClientRect();o.left=a.left,o.top=a.top,o.right=a.right,o.bottom=a.bottom}for(i.detach(s);r.firstChild;)r.removeChild(r.firstChild);return o}overlaps(e,r){const i=this.computeBoundingRect(e),n=this.computeBoundingRect(r);return Math.max(i.left,n.left)<=Math.min(i.right,n.right)&&Math.max(i.top,n.top)<=Math.min(i.bottom,n.bottom)}get hasVisibleItems(){return this.items.some(e=>e.visible)}async prepare(){await document.fonts.load(this._fontString()).catch(()=>{})}renderCanvas(e,r){const i=!!(r!=null&&r.disableDecorations);if(!this.items.some(s=>s.visible&&!(i&&s.isDecoration)))return;const n=e.getContext("2d");n.save(),n.font=this._fontString(),this.items.forEach(s=>{i&&s.isDecoration||(n.save(),s.renderCanvas(n),n.restore())}),n.restore()}_fontString(){return`10px ${getComputedStyle(this.surface).fontFamily}`}};d([m({readOnly:!0})],x_.prototype,"surface",void 0),d([m({readOnly:!0})],x_.prototype,"items",void 0),d([m({readOnly:!0})],x_.prototype,"needsRender",null),d([m({readOnly:!0})],x_.prototype,"_watchUpdatingTracking",void 0),d([m({readOnly:!0})],x_.prototype,"updating",null),x_=d([V("esri.views.overlay.ViewOverlay")],x_);const rce=x_,yV=[0,0];function wZe(t){const e=(t.ownerDocument||window.document).defaultView,r=t.getBoundingClientRect();return yV[0]=r.left+((e==null?void 0:e.pageXOffset)??0),yV[1]=r.top+((e==null?void 0:e.pageYOffset)??0),yV}function ice(t){t&&(T2e(t),t.parentNode&&t.parentNode.removeChild(t))}function xZe(t){const e=document.createElement("div");return t.appendChild(e),e}const RP=16,xD=750,TZe=512,SZe=2,CZe=t=>{let e=class extends t{constructor(...r){super(...r),this._freqInfo={freq:RP,time:xD},this._overlayRenderTaskHandle=null,this.height=0,this.messagesCommon=null,this.overlay=null,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,this.addHandles([he(()=>this.cursor,i=>{const{surface:n}=this;n&&n.setAttribute("data-cursor",i)}),he(()=>this.navigating,i=>{const{surface:n}=this;n&&n.setAttribute("data-navigating",i.toString())})])}initialize(){const r=se("mac"),i=async()=>{r&&(await UE(()=>this.ready),this.messagesCommon=await iee("esri/t9n/common").catch(()=>{}))};i(),this.addHandles([he(()=>this.ui,(n,s)=>this._handleUIChange(n,s),gi),this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused")),KK(i),he(()=>[this.surface,this.messagesCommon],()=>{var n,s,o;r&&((o=this.surface)==null||o.setAttribute("aria-label",((s=(n=this.messagesCommon)==null?void 0:n.ariaLabels)==null?void 0:s.navigationMacVoiceOver)??""))})])}destroy(){this.destroyed||(this.ui=Pe(this.ui),this.container=null)}get container(){return this._get("container")??null}set container(r){const i=this._get("container"),n=d9(r);if(n||typeof r!="string"||re.getLogger(this).error("#container",`element with id '${r}' not found`),i===n)return;if(this._stopMeasuring(),i&&(i.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay&&(this.overlay.destroy(),this._set("overlay",null)),this.root&&(ice(this.root),this._set("root",null)),this.userContent&&(Hae(this.userContent,i),ice(this.userContent),this._set("userContent",null))),!n)return this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),void this._set("container",null);n.classList.add("esri-view");const s=document.createElement("div");s.className="esri-view-user-storage",Hae(n,s),n.appendChild(s),this._set("userContent",s);const o=document.createElement("div");o.className="esri-view-root",n.insertBefore(o,n.firstChild),this._set("root",o);const a=document.createElement("div");a.className="esri-view-surface",a.setAttribute("role","application"),a.tabIndex=0,o.appendChild(a),this._set("surface",a);const l=new rce;o.appendChild(l.surface),this._set("overlay",l),this.addHandles(he(()=>l.needsRender,c=>{c&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=qx({render:()=>{var u;return(u=this.overlay)==null?void 0:u.render()}}):this._overlayRenderTaskHandle=wi(this._overlayRenderTaskHandle)})),this.forceDOMReadyCycle(),this._set("container",n),this._startMeasuring()}get focused(){const r=document.activeElement===this.surface;return document.hasFocus()&&r}get size(){return[this.width,this.height]}blur(){var r;(r=this.surface)==null||r.blur()}focus(){var r;(r=this.surface)==null||r.focus()}pageToContainer(r,i,n){const s=this.position;return r-=s?s[0]:0,i-=s?s[1]:0,n?(n[0]=r,n[1]=i):n=[r,i],n}containerToPage(r,i,n){const s=this.position;return r+=s?s[0]:0,i+=s?s[1]:0,n?(n[0]=r,n[1]=i):n=[r,i],n}_handleUIChange(r,i){this.removeHandles("ui"),i&&i!==r&&i.destroy(),r&&(r.view=this,this.addHandles(he(()=>this.root,n=>{r.container=n?xZe(n):null},gi),"ui")),this._set("ui",r)}_stopMeasuring(){this.removeHandles("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const r=this._freqInfo;r.freq=RP,r.time=xD,this.addHandles([A3(window,"resize",()=>{r.freq=RP,r.time=xD}),qx({prepare:i=>{const n=this._measure(),s=this._freqInfo;if(s.time+=i.deltaTime,n&&(s.freq=RP,this._get("resizing")||this._set("resizing",!0)),s.time<s.freq)return;s.time=0;const o=this._position();s.freq=o||n?RP:Math.min(xD,s.freq*SZe),!n&&s.freq>=TZe&&this._get("resizing")&&this._set("resizing",!1)}})],"measuring"),this._measure(),this._position()}_measure(){const r=this.container,i=r?r.clientWidth:0,n=r?r.clientHeight:0;if(i===0||n===0)return this.suspended||this._set("suspended",!0),!1;const s=this.width,o=this.height;return i===s&&n===o?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",i),this._set("height",n),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:s,oldHeight:o,width:i,height:n}),!0)}_position(){const r=this.container,i=this.position,n=r&&wZe(r);return!!n&&(!i||n[0]!==i[0]||n[1]!==i[1])&&(this._set("position",[n[0],n[1]]),!0)}forceDOMReadyCycle(){}};return d([m()],e.prototype,"container",null),d([m({readOnly:!0})],e.prototype,"focused",null),d([m({readOnly:!0})],e.prototype,"height",void 0),d([m()],e.prototype,"messagesCommon",void 0),d([m({type:rce})],e.prototype,"overlay",void 0),d([m({readOnly:!0})],e.prototype,"position",void 0),d([m({readOnly:!0})],e.prototype,"resizing",void 0),d([m({readOnly:!0})],e.prototype,"root",void 0),d([m({value:null,readOnly:!0})],e.prototype,"size",null),d([m({readOnly:!0})],e.prototype,"surface",void 0),d([m({readOnly:!0})],e.prototype,"suspended",void 0),d([m()],e.prototype,"ui",void 0),d([m({readOnly:!0})],e.prototype,"userContent",void 0),d([m({readOnly:!0})],e.prototype,"width",void 0),d([m()],e.prototype,"widthBreakpoint",void 0),e=d([V("esri.views.DOMContainer")],e),e};function Nv(t,e,r,i){return{x:t,y:e,z:r,hasZ:r!=null,hasM:!1,spatialReference:i,type:"point"}}function ka(t,e,r,i,n){return!(e==null||i==null||t.length<2)&&($P.x=t[0],$P.y=t[1],$P.z=t[2],$P.spatialReference=e,_n($P,r,i,n))}const $P=Nv(0,0,0,lt.WGS84);function ag(t,e,r){return!!ka(t,e,TD,r.spatialReference)&&(r.x=TD[0],r.y=TD[1],r.z=TD[2],!0)}async function wCe(t,e,r,i){return await T9(e,r.spatialReference,null,i),ag(t,e,r)}const TD=C();var De;function nce(t){return t==="global"?De.Global:De.Local}function _V(t){return t===De.Global?"global":"local"}(function(t){t[t.Global=1]="Global",t[t.Local=2]="Local"})(De||(De={}));var Bi,Go;(function(t){t[t.OBJECT=0]="OBJECT",t[t.HUD=1]="HUD",t[t.TERRAIN=2]="TERRAIN",t[t.OVERLAY=3]="OVERLAY",t[t.I3S=4]="I3S",t[t.PCL=5]="PCL",t[t.LOD=6]="LOD",t[t.VOXEL=7]="VOXEL",t[t.TILES3D=8]="TILES3D"})(Bi||(Bi={}));let EZe=class{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.filteredLayerUids=[],this.store=Go.ALL}};(function(t){t[t.MIN=0]="MIN",t[t.MINMAX=1]="MINMAX",t[t.ALL=2]="ALL"})(Go||(Go={}));let PZe=class{constructor(e,r,i){this.object=e,this.geometryId=r,this.triangleNr=i}},AZe=class extends PZe{constructor(e,r,i,n){super(e,r,i),this.center=n!=null?Zi(n):null}},xCe=class{constructor(e){this.layerUid=e}},kI=class extends xCe{constructor(e,r){super(e),this.graphicUid=r}};function xd(t){return(t==null?void 0:t.dist)!=null}function sce(t){return(e,r,i)=>(ni(oce,e,r,i),!ete(t,oce))}function F9(t){return xd(t)&&t.intersector===Bi.OBJECT&&!!t.target}function k9(t){return xd(t)&&t.intersector===Bi.HUD&&!!t.target&&"center"in t.target&&t.target.center!=null}const oce=C();function th(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function MZe(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function cte(t,e,r,i,n,s,o,a,l,c){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t[4]=s,t[5]=o,t[6]=a,t[7]=l,t[8]=c,t}function ute(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function gd(t,e){if(t===e){const r=e[1],i=e[2],n=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=i,t[7]=n}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function L2(t,e){const r=e[0],i=e[1],n=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=u*o-a*c,p=-u*s+a*l,f=c*s-o*l;let g=r*h+i*p+n*f;return g?(g=1/g,t[0]=h*g,t[1]=(-u*i+n*c)*g,t[2]=(a*i-n*o)*g,t[3]=p*g,t[4]=(u*r-n*l)*g,t[5]=(-a*r+n*s)*g,t[6]=f*g,t[7]=(-c*r+i*l)*g,t[8]=(o*r-i*s)*g,t):null}function OZe(t,e){const r=e[0],i=e[1],n=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8];return t[0]=o*u-a*c,t[1]=n*c-i*u,t[2]=i*a-n*o,t[3]=a*l-s*u,t[4]=r*u-n*l,t[5]=n*s-r*a,t[6]=s*c-o*l,t[7]=i*l-r*c,t[8]=r*o-i*s,t}function RZe(t){const e=t[0],r=t[1],i=t[2],n=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8];return e*(c*s-o*l)+r*(-c*n+o*a)+i*(l*n-s*a)}function XE(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],p=r[0],f=r[1],g=r[2],_=r[3],v=r[4],b=r[5],w=r[6],x=r[7],S=r[8];return t[0]=p*i+f*o+g*c,t[1]=p*n+f*a+g*u,t[2]=p*s+f*l+g*h,t[3]=_*i+v*o+b*c,t[4]=_*n+v*a+b*u,t[5]=_*s+v*l+b*h,t[6]=w*i+x*o+S*c,t[7]=w*n+x*a+S*u,t[8]=w*s+x*l+S*h,t}function C6(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],p=r[0],f=r[1];return t[0]=i,t[1]=n,t[2]=s,t[3]=o,t[4]=a,t[5]=l,t[6]=p*i+f*o+c,t[7]=p*n+f*a+u,t[8]=p*s+f*l+h,t}function hte(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],p=Math.sin(r),f=Math.cos(r);return t[0]=f*i+p*o,t[1]=f*n+p*a,t[2]=f*s+p*l,t[3]=f*o-p*i,t[4]=f*a-p*n,t[5]=f*l-p*s,t[6]=c,t[7]=u,t[8]=h,t}function z9(t,e,r){const i=r[0],n=r[1],s=r[2];return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=n*e[3],t[4]=n*e[4],t[5]=n*e[5],t[6]=s*e[6],t[7]=s*e[7],t[8]=s*e[8],t}function $Ze(t,e,r){const i=r[0],n=r[1];return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=n*e[3],t[4]=n*e[4],t[5]=n*e[5],t}function IZe(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function LZe(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=0,t[3]=-r,t[4]=i,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function DZe(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function NZe(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function P$(t,e){const r=e[0],i=e[1],n=e[2],s=e[3],o=r+r,a=i+i,l=n+n,c=r*o,u=i*o,h=i*a,p=n*o,f=n*a,g=n*l,_=s*o,v=s*a,b=s*l;return t[0]=1-h-g,t[3]=u-b,t[6]=p+v,t[1]=u+b,t[4]=1-c-g,t[7]=f-_,t[2]=p-v,t[5]=f+_,t[8]=1-c-h,t}function TCe(t,e){const r=e[0],i=e[1],n=e[2],s=e[4],o=e[5],a=e[6],l=e[8],c=e[9],u=e[10],h=u*o-a*c,p=-u*s+a*l,f=c*s-o*l,g=r*h+i*p+n*f;if(!g)return null;const _=1/g;return t[0]=h*_,t[1]=(-u*i+n*c)*_,t[2]=(a*i-n*o)*_,t[3]=p*_,t[4]=(u*r-n*l)*_,t[5]=(-a*r+n*s)*_,t[6]=f*_,t[7]=(-c*r+i*l)*_,t[8]=(o*r-i*s)*_,t}function iy(t,e){const r=e[0],i=e[1],n=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],p=e[10],f=e[11],g=e[12],_=e[13],v=e[14],b=e[15],w=r*a-i*o,x=r*l-n*o,S=r*c-s*o,E=i*l-n*a,A=i*c-s*a,O=n*c-s*l,L=u*_-h*g,z=u*v-p*g,k=u*b-f*g,q=h*v-p*_,B=h*b-f*_,J=p*b-f*v;let W=w*J-x*B+S*q+E*k-A*z+O*L;return W?(W=1/W,t[0]=(a*J-l*B+c*q)*W,t[1]=(l*k-o*J-c*z)*W,t[2]=(o*B-a*k+c*L)*W,t[3]=(n*B-i*J-s*q)*W,t[4]=(r*J-n*k+s*z)*W,t[5]=(i*k-r*B-s*L)*W,t[6]=(_*O-v*A+b*E)*W,t[7]=(v*S-g*O-b*x)*W,t[8]=(g*A-_*S+b*w)*W,t):null}function FZe(t,e,r){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/r,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function kZe(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function zZe(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+t[6]**2+t[7]**2+t[8]**2)}function UZe(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t}function SCe(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t}function BZe(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t}function VZe(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t[6]=e[6]+r[6]*i,t[7]=e[7]+r[7]*i,t[8]=e[8]+r[8]*i,t}function GZe(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function jZe(t,e){const r=t[0],i=t[1],n=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=e[0],p=e[1],f=e[2],g=e[3],_=e[4],v=e[5],b=e[6],w=e[7],x=e[8],S=Va();return Math.abs(r-h)<=S*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(i-p)<=S*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(n-f)<=S*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(s-g)<=S*Math.max(1,Math.abs(s),Math.abs(g))&&Math.abs(o-_)<=S*Math.max(1,Math.abs(o),Math.abs(_))&&Math.abs(a-v)<=S*Math.max(1,Math.abs(a),Math.abs(v))&&Math.abs(l-b)<=S*Math.max(1,Math.abs(l),Math.abs(b))&&Math.abs(c-w)<=S*Math.max(1,Math.abs(c),Math.abs(w))&&Math.abs(u-x)<=S*Math.max(1,Math.abs(u),Math.abs(x))}function dte(t){const e=Va(),r=t[0],i=t[1],n=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8];return Math.abs(1-(r*r+s*s+l*l))<=e&&Math.abs(1-(i*i+o*o+c*c))<=e&&Math.abs(1-(n*n+a*a+u*u))<=e}const HZe=XE,WZe=SCe;Object.freeze(Object.defineProperty({__proto__:null,add:UZe,adjoint:OZe,copy:MZe,determinant:RZe,equals:jZe,exactEquals:GZe,frob:zZe,fromMat2d:NZe,fromMat4:th,fromQuat:P$,fromRotation:LZe,fromScaling:DZe,fromTranslation:IZe,identity:ute,invert:L2,isOrthoNormal:dte,mul:HZe,multiply:XE,multiplyScalar:BZe,multiplyScalarAndAdd:VZe,normalFromMat4:iy,normalFromMat4Legacy:TCe,projection:FZe,rotate:hte,scale:z9,scaleByVec2:$Ze,set:cte,str:kZe,sub:WZe,subtract:SCe,translate:C6,transpose:gd},Symbol.toStringTag,{value:"Module"}));function qZe(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function ZE(t,e,r){r*=.5;const i=Math.sin(r);return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(r),t}function U9(t,e){const r=2*Math.acos(e[3]),i=Math.sin(r/2);return i>Va()?(t[0]=e[0]/i,t[1]=e[1]/i,t[2]=e[2]/i):(t[0]=1,t[1]=0,t[2]=0),r}function B9(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=r[0],l=r[1],c=r[2],u=r[3];return t[0]=i*u+o*a+n*c-s*l,t[1]=n*u+o*l+s*a-i*c,t[2]=s*u+o*c+i*l-n*a,t[3]=o*u-i*a-n*l-s*c,t}function YZe(t,e,r){r*=.5;const i=e[0],n=e[1],s=e[2],o=e[3],a=Math.sin(r),l=Math.cos(r);return t[0]=i*l+o*a,t[1]=n*l+s*a,t[2]=s*l-n*a,t[3]=o*l-i*a,t}function XZe(t,e,r){r*=.5;const i=e[0],n=e[1],s=e[2],o=e[3],a=Math.sin(r),l=Math.cos(r);return t[0]=i*l-s*a,t[1]=n*l+o*a,t[2]=s*l+i*a,t[3]=o*l-n*a,t}function ZZe(t,e,r){r*=.5;const i=e[0],n=e[1],s=e[2],o=e[3],a=Math.sin(r),l=Math.cos(r);return t[0]=i*l+n*a,t[1]=n*l-i*a,t[2]=s*l+o*a,t[3]=o*l-s*a,t}function JZe(t,e){const r=e[0],i=e[1],n=e[2];return t[0]=r,t[1]=i,t[2]=n,t[3]=Math.sqrt(Math.abs(1-r*r-i*i-n*n)),t}function S5(t,e,r,i){const n=e[0],s=e[1],o=e[2],a=e[3];let l,c,u,h,p,f=r[0],g=r[1],_=r[2],v=r[3];return c=n*f+s*g+o*_+a*v,c<0&&(c=-c,f=-f,g=-g,_=-_,v=-v),1-c>Va()?(l=Math.acos(c),u=Math.sin(l),h=Math.sin((1-i)*l)/u,p=Math.sin(i*l)/u):(h=1-i,p=i),t[0]=h*n+p*f,t[1]=h*s+p*g,t[2]=h*o+p*_,t[3]=h*a+p*v,t}function QZe(t){const e=AI,r=e(),i=e(),n=e(),s=Math.sqrt(1-r),o=Math.sqrt(r);return t[0]=s*Math.sin(2*Math.PI*i),t[1]=s*Math.cos(2*Math.PI*i),t[2]=o*Math.sin(2*Math.PI*n),t[3]=o*Math.cos(2*Math.PI*n),t}function KZe(t,e){const r=e[0],i=e[1],n=e[2],s=e[3],o=r*r+i*i+n*n+s*s,a=o?1/o:0;return t[0]=-r*a,t[1]=-i*a,t[2]=-n*a,t[3]=s*a,t}function G1(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function CCe(t,e){const r=e[0]+e[4]+e[8];let i;if(r>0)i=Math.sqrt(r+1),t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{let n=0;e[4]>e[0]&&(n=1),e[8]>e[3*n+n]&&(n=2);const s=(n+1)%3,o=(n+2)%3;i=Math.sqrt(e[3*n+n]-e[3*s+s]-e[3*o+o]+1),t[n]=.5*i,i=.5/i,t[3]=(e[3*s+o]-e[3*o+s])*i,t[s]=(e[3*s+n]+e[3*n+s])*i,t[o]=(e[3*o+n]+e[3*n+o])*i}return t}function eJe(t,e,r,i){const n=.5*Math.PI/180;e*=n,r*=n,i*=n;const s=Math.sin(e),o=Math.cos(e),a=Math.sin(r),l=Math.cos(r),c=Math.sin(i),u=Math.cos(i);return t[0]=s*l*u-o*a*c,t[1]=o*a*u+s*l*c,t[2]=o*l*c-s*a*u,t[3]=o*l*u+s*a*c,t}function tJe(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}const rJe=Kh,ECe=nn,iJe=Hee,nJe=B9,sJe=s2,oJe=SSe,aJe=Yee,PCe=Wee,lJe=PCe,ACe=qee,cJe=ACe,pte=TSe,uJe=jC,hJe=o2;function dJe(t,e,r){const i=de(e,r);return i<-.999999?(Je(Cf,pJe,e),Pc(Cf)<1e-6&&Je(Cf,fJe,e),pe(Cf,Cf),ZE(t,Cf,Math.PI),t):i>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(Je(Cf,e,r),t[0]=Cf[0],t[1]=Cf[1],t[2]=Cf[2],t[3]=1+i,pte(t,t))}const Cf=C(),pJe=Ce(1,0,0),fJe=Ce(0,1,0);function mJe(t,e,r,i,n,s){return S5(ace,e,n,s),S5(lce,r,i,s),S5(t,ace,lce,2*s*(1-s)),t}const ace=lc(),lce=lc();function gJe(t,e,r,i){const n=yJe;return n[0]=r[0],n[3]=r[1],n[6]=r[2],n[1]=i[0],n[4]=i[1],n[7]=i[2],n[2]=-e[0],n[5]=-e[1],n[8]=-e[2],pte(t,CCe(t,n))}const yJe=li();Object.freeze(Object.defineProperty({__proto__:null,add:iJe,calculateW:JZe,conjugate:G1,copy:rJe,dot:oJe,equals:hJe,exactEquals:uJe,fromEuler:eJe,fromMat3:CCe,getAxisAngle:U9,identity:qZe,invert:KZe,len:lJe,length:PCe,lerp:aJe,mul:nJe,multiply:B9,normalize:pte,random:QZe,rotateX:YZe,rotateY:XZe,rotateZ:ZZe,rotationTo:dJe,scale:sJe,set:ECe,setAxes:gJe,setAxisAngle:ZE,slerp:S5,sqlerp:mJe,sqrLen:cJe,squaredLength:ACe,str:tJe},Symbol.toStringTag,{value:"Module"}));function MCe(t,e,r){const i=Math.sin(t),n=Math.cos(t),s=Math.sin(e),o=Math.cos(e),a=r;return a[0]=-i,a[4]=-s*n,a[8]=o*n,a[12]=0,a[1]=n,a[5]=-s*i,a[9]=o*i,a[13]=0,a[2]=0,a[6]=o,a[10]=s,a[14]=0,a[3]=0,a[7]=0,a[11]=0,a[15]=1,a}function _Je(t,e,r){return MCe(t,e,r),Qc(r,r),r}function La(t,e,r,i){if(t==null||i==null)return!1;const n=S$(t,HTe),s=S$(i,tqe);if(n===s&&!cce(s)&&(n!==Q.UNKNOWN||To(t,i)))return MI(r,e),!0;if(cce(s)){const o=nC[n][Q.LON_LAT],a=nC[Q.LON_LAT][s];return o!=null&&a!=null&&(o(e,0,By,0),a(By,0,Vy,0),MCe(SD*By[0],SD*By[1],r),r[12]=Vy[0],r[13]=Vy[1],r[14]=Vy[2],!0)}if((s===Q.WEB_MERCATOR||s===Q.PLATE_CARREE||s===Q.WGS84)&&(n===Q.WGS84||n===Q.CGCS2000&&s===Q.PLATE_CARREE||n===Q.SPHERICAL_ECEF||n===Q.WEB_MERCATOR)){const o=nC[n][Q.LON_LAT],a=nC[Q.LON_LAT][s];return o!=null&&a!=null&&(o(e,0,By,0),a(By,0,Vy,0),n===Q.SPHERICAL_ECEF?_Je(SD*By[0],SD*By[1],r):pd(r),r[12]=Vy[0],r[13]=Vy[1],r[14]=Vy[2],!0)}return!1}function cce(t){return t===Q.SPHERICAL_ECEF||t===Q.SPHERICAL_MARS_PCPF||t===Q.SPHERICAL_MOON_PCPF}const SD=Nt(1),By=C(),Vy=C();let U3=class{constructor(e,r,i=r){this.data=e,this.size=r,this.stride=i}},Ye=class extends U3{constructor(e,r,i,n=!1,s=i){super(e,i,s),this.indices=r,this.exclusive=n}};const JE=1e-6,IP=C(),CD=C();function vJe(t,e){const{data:r,size:i}=t,n=r.length/i;if(n<=0)return;const s=new MJe(t);_q(IP,s.minProj,s.maxProj),jA(IP,IP,.5),Uh(CD,s.maxProj,s.minProj);const o=yq(CD),a=new OJe;a.quality=o,n<14&&(t=new U3(new Float64Array(s.buffer,112,42),3));const l=C(),c=C(),u=C(),h=C(),p=C(),f=C(),g=C();switch(bJe(s,t,g,l,c,u,h,p,f,a)){case 1:return void pce(IP,CD,e);case 2:return void PJe(t,h,e)}wJe(t,g,l,c,u,h,p,f,a),OCe(t,a.b0,a.b1,a.b2,WC,qC);const _=C();Uh(_,qC,WC),a.quality=yq(_),a.quality<o?RCe(a.b0,a.b1,a.b2,WC,qC,_,e):pce(IP,CD,e)}function bJe(t,e,r,i,n,s,o,a,l,c){return xJe(t,i,n),vq(i,n)<JE?1:(Uh(o,i,n),Ko(o,o),TJe(e,i,o,s)<JE?2:(Uh(a,n,s),Ko(a,a),Uh(l,s,i),Ko(l,l),Bh(r,a,o),Ko(r,r),Wb(e,r,o,a,l,c),0))}const LP=C(),DP=C(),lh=C(),ch=C(),uh=C(),Gy=C(),jy=C(),Hy=C();function wJe(t,e,r,i,n,s,o,a,l){SJe(t,e,r,LP,DP),LP[0]!==void 0&&(Uh(lh,LP,r),Ko(lh,lh),Uh(ch,LP,i),Ko(ch,ch),Uh(uh,LP,n),Ko(uh,uh),Bh(Gy,ch,s),Ko(Gy,Gy),Bh(jy,uh,o),Ko(jy,jy),Bh(Hy,lh,a),Ko(Hy,Hy),Wb(t,Gy,s,ch,lh,l),Wb(t,jy,o,uh,ch,l),Wb(t,Hy,a,lh,uh,l)),DP[0]!==void 0&&(Uh(lh,DP,r),Ko(lh,lh),Uh(ch,DP,i),Ko(ch,ch),Uh(uh,DP,n),Ko(uh,uh),Bh(Gy,ch,s),Ko(Gy,Gy),Bh(jy,uh,o),Ko(jy,jy),Bh(Hy,lh,a),Ko(Hy,Hy),Wb(t,Gy,s,ch,lh,l),Wb(t,jy,o,uh,ch,l),Wb(t,Hy,a,lh,uh,l))}function xJe(t,e,r){let i=vq(t.maxVert[0],t.minVert[0]),n=0;for(let s=1;s<7;++s){const o=vq(t.maxVert[s],t.minVert[s]);o>i&&(i=o,n=s)}Bu(e,t.minVert[n]),Bu(r,t.maxVert[n])}const hh=[0,0,0];function TJe(t,e,r,i){const{data:n,size:s}=t;let o=Number.NEGATIVE_INFINITY,a=0;for(let l=0;l<n.length;l+=s){hh[0]=n[l]-e[0],hh[1]=n[l+1]-e[1],hh[2]=n[l+2]-e[2];const c=r[0]*hh[0]+r[1]*hh[1]+r[2]*hh[2],u=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],h=hh[0]*hh[0]+hh[1]*hh[1]+hh[2]*hh[2]-c*c/u;h>o&&(o=h,a=l)}return Bu(i,n,a),o}const js=He();function SJe(t,e,r,i,n){EJe(t,e,js,n,i);const s=ICe(r,e);js[1]-JE<=s&&(i[0]=void 0),js[0]+JE>=s&&(n[0]=void 0)}const uce=C(),hce=C(),dce=C(),eT=C(),tT=C(),ED=C();function Wb(t,e,r,i,n,s){if($Ce(e)<JE)return;Bh(uce,r,e),Bh(hce,i,e),Bh(dce,n,e),HC(t,e,js),tT[1]=js[0],eT[1]=js[1],ED[1]=eT[1]-tT[1];const o=[r,i,n],a=[uce,hce,dce];for(let l=0;l<3;++l){HC(t,o[l],js),tT[0]=js[0],eT[0]=js[1],HC(t,a[l],js),tT[2]=js[0],eT[2]=js[1],ED[0]=eT[0]-tT[0],ED[2]=eT[2]-tT[2];const c=yq(ED);c<s.quality&&(Bu(s.b0,o[l]),Bu(s.b1,e),Bu(s.b2,a[l]),s.quality=c)}}const CJe=C();function HC(t,e,r){const{data:i,size:n}=t;r[0]=Number.POSITIVE_INFINITY,r[1]=Number.NEGATIVE_INFINITY;for(let s=0;s<i.length;s+=n){const o=i[s]*e[0]+i[s+1]*e[1]+i[s+2]*e[2];r[0]=Math.min(r[0],o),r[1]=Math.max(r[1],o)}}function EJe(t,e,r,i,n){const{data:s,size:o}=t;Bu(i,s),Bu(n,i),r[0]=ICe(CJe,e),r[1]=r[0];for(let a=o;a<s.length;a+=o){const l=s[a]*e[0]+s[a+1]*e[1]+s[a+2]*e[2];l<r[0]&&(r[0]=l,Bu(i,s,a)),l>r[1]&&(r[1]=l,Bu(n,s,a))}}function pce(t,e,r){r.center=t,r.halfSize=ne(e,e,.5),r.quaternion=C9}const Ag=C(),rT=C(),NP=C(),WC=C(),qC=C(),fce=C();function PJe(t,e,r){Bu(Ag,e),Math.abs(e[0])>Math.abs(e[1])&&Math.abs(e[0])>Math.abs(e[2])?Ag[0]=0:Math.abs(e[1])>Math.abs(e[2])?Ag[1]=0:Ag[2]=0,$Ce(Ag)<JE&&(Ag[0]=Ag[1]=Ag[2]=1),Bh(rT,e,Ag),Ko(rT,rT),Bh(NP,e,rT),Ko(NP,NP),OCe(t,e,rT,NP,WC,qC),Uh(fce,qC,WC),RCe(e,rT,NP,WC,qC,fce,r)}function OCe(t,e,r,i,n,s){HC(t,e,js),n[0]=js[0],s[0]=js[1],HC(t,r,js),n[1]=js[0],s[1]=js[1],HC(t,i,js),n[2]=js[0],s[2]=js[1]}const eb=C(),FP=C(),PD=C(),Ef=QO(1,0,0,0,1,0,0,0,1),AJe=lc();function RCe(t,e,r,i,n,s,o){Ef[0]=t[0],Ef[1]=t[1],Ef[2]=t[2],Ef[3]=e[0],Ef[4]=e[1],Ef[5]=e[2],Ef[6]=r[0],Ef[7]=r[1],Ef[8]=r[2],o.quaternion=RJe(AJe,Ef),_q(eb,i,n),jA(eb,eb,.5),jA(FP,t,eb[0]),jA(PD,e,eb[1]),_q(FP,FP,PD),jA(PD,r,eb[2]),o.center=fe(FP,FP,PD),o.halfSize=ne(eb,s,.5)}const au=7;let MJe=class{constructor(e){this.minVert=new Array(au),this.maxVert=new Array(au);const r=64*au;this.buffer=new ArrayBuffer(r);let i=0;this.minProj=new Float64Array(this.buffer,i,au),i+=8*au,this.maxProj=new Float64Array(this.buffer,i,au),i+=8*au;for(let l=0;l<au;++l)this.minVert[l]=new Float64Array(this.buffer,i,3),i+=24;for(let l=0;l<au;++l)this.maxVert[l]=new Float64Array(this.buffer,i,3),i+=24;for(let l=0;l<au;++l)this.minProj[l]=Number.POSITIVE_INFINITY,this.maxProj[l]=Number.NEGATIVE_INFINITY;const n=new Array(au),s=new Array(au),{data:o,size:a}=e;for(let l=0;l<o.length;l+=a){let c=o[l];c<this.minProj[0]&&(this.minProj[0]=c,n[0]=l),c>this.maxProj[0]&&(this.maxProj[0]=c,s[0]=l),c=o[l+1],c<this.minProj[1]&&(this.minProj[1]=c,n[1]=l),c>this.maxProj[1]&&(this.maxProj[1]=c,s[1]=l),c=o[l+2],c<this.minProj[2]&&(this.minProj[2]=c,n[2]=l),c>this.maxProj[2]&&(this.maxProj[2]=c,s[2]=l),c=o[l]+o[l+1]+o[l+2],c<this.minProj[3]&&(this.minProj[3]=c,n[3]=l),c>this.maxProj[3]&&(this.maxProj[3]=c,s[3]=l),c=o[l]+o[l+1]-o[l+2],c<this.minProj[4]&&(this.minProj[4]=c,n[4]=l),c>this.maxProj[4]&&(this.maxProj[4]=c,s[4]=l),c=o[l]-o[l+1]+o[l+2],c<this.minProj[5]&&(this.minProj[5]=c,n[5]=l),c>this.maxProj[5]&&(this.maxProj[5]=c,s[5]=l),c=o[l]-o[l+1]-o[l+2],c<this.minProj[6]&&(this.minProj[6]=c,n[6]=l),c>this.maxProj[6]&&(this.maxProj[6]=c,s[6]=l)}for(let l=0;l<au;++l){let c=n[l];Bu(this.minVert[l],o,c),c=s[l],Bu(this.maxVert[l],o,c)}}},OJe=class{constructor(){this.b0=Ce(1,0,0),this.b1=Ce(0,1,0),this.b2=Ce(0,0,1),this.quality=0}};function yq(t){return t[0]*t[1]+t[0]*t[2]+t[1]*t[2]}function _q(t,e,r){t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2]}function Uh(t,e,r){t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2]}function jA(t,e,r){t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r}function Bu(t,e,r=0){t[0]=e[r],t[1]=e[r+1],t[2]=e[r+2]}function Bh(t,e,r){const i=e[0],n=e[1],s=e[2],o=r[0],a=r[1],l=r[2];t[0]=n*l-s*a,t[1]=s*o-i*l,t[2]=i*a-n*o}function Ko(t,e){const r=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];if(r>0){const i=1/Math.sqrt(r);t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i}}function $Ce(t){return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]}function vq(t,e){const r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2];return r*r+i*i+n*n}function ICe(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function RJe(t,e){const r=e[0]+e[4]+e[8];if(r>0){let i=Math.sqrt(r+1);t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i}else{let i=0;e[4]>e[0]&&(i=1),e[8]>e[3*i+i]&&(i=2);const n=(i+1)%3,s=(i+2)%3;let o=Math.sqrt(e[3*i+i]-e[3*n+n]-e[3*s+s]+1);t[i]=.5*o,o=.5/o,t[3]=(e[3*n+s]-e[3*s+n])*o,t[n]=(e[3*n+i]+e[3*i+n])*o,t[s]=(e[3*s+i]+e[3*i+s])*o}return t}let LCe=class C5{constructor(e=zn,r=BJe,i=C9){this._data=[e[0],e[1],e[2],r[0],r[1],r[2],i[0],i[1],i[2],i[3]]}clone(){const e=new C5;return e._data=this._data.slice(),e}invalidate(){this._data[3]=-1}get isValid(){return this._data[3]>=0}static fromData(e){const r=new C5;return r._data=e.slice(),r}static fromJSON(e){return new C5(e.center,e.halfSize,e.quaternion)}copy(e){this._data=e.data.slice()}get center(){return ie(Be.get(),this._data[0],this._data[1],this._data[2])}get centerX(){return this._data[0]}get centerY(){return this._data[1]}get centerZ(){return this._data[2]}getCenter(e){return e[0]=this._data[0],e[1]=this._data[1],e[2]=this._data[2],e}set center(e){this._data[0]=e[0],this._data[1]=e[1],this._data[2]=e[2]}setCenter(e,r,i){this._data[0]=e,this._data[1]=r,this._data[2]=i}get halfSize(){return ie(Be.get(),this._data[3],this._data[4],this._data[5])}get halfSizeX(){return this._data[3]}get halfSizeY(){return this._data[4]}get halfSizeZ(){return this._data[5]}getHalfSize(e){return e[0]=this._data[3],e[1]=this._data[4],e[2]=this._data[5],e}set halfSize(e){this._data[3]=e[0],this._data[4]=e[1],this._data[5]=e[2]}get quaternion(){return ECe(Aqe.get(),this._data[6],this._data[7],this._data[8],this._data[9])}getQuaternion(e){return e[0]=this._data[6],e[1]=this._data[7],e[2]=this._data[8],e[3]=this._data[9],e}set quaternion(e){this._data[6]=e[0],this._data[7]=e[1],this._data[8]=e[2],this._data[9]=e[3]}get data(){return this._data}getCorners(e){const r=tn,i=this._data;r[0]=i[6],r[1]=i[7],r[2]=i[8],r[3]=i[9];for(let n=0;n<8;++n){const s=e[n];s[0]=(1&n?-1:1)*i[3],s[1]=(2&n?-1:1)*i[4],s[2]=(4&n?-1:1)*i[5],Oc(s,s,r),s[0]+=i[0],s[1]+=i[1],s[2]+=i[2]}}isVisible(e){return this.intersectPlane(e[0])<=0&&this.intersectPlane(e[1])<=0&&this.intersectPlane(e[2])<=0&&this.intersectPlane(e[3])<=0&&this.intersectPlane(e[4])<=0&&this.intersectPlane(e[5])<=0}get radius(){const e=this._data[3],r=this._data[4],i=this._data[5];return Math.sqrt(e*e+r*r+i*i)}intersectSphere(e){ir[0]=this._data[0]-e[0],ir[1]=this._data[1]-e[1],ir[2]=this._data[2]-e[2];const r=this.getQuaternion(T0);return G1(tn,r),Oc(ir,ir,tn),IE(ir,ir),Mg[0]=Math.min(ir[0],this._data[3]),Mg[1]=Math.min(ir[1],this._data[4]),Mg[2]=Math.min(ir[2],this._data[5]),g$(Mg,ir)<e[3]*e[3]}intersectSphereWithMBS(e,r=this.radius){const i=this._data;ir[0]=i[0]-e[0],ir[1]=i[1]-e[1],ir[2]=i[2]-e[2];const n=e[3],s=n+r;return!(i6(ir)>s*s)&&(tn[0]=-i[6],tn[1]=-i[7],tn[2]=-i[8],tn[3]=i[9],Oc(ir,ir,tn),IE(ir,ir),Mg[0]=Math.min(ir[0],i[3]),Mg[1]=Math.min(ir[1],i[4]),Mg[2]=Math.min(ir[2],i[5]),g$(Mg,ir)<n*n)}intersectPlane(e){const r=e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3],i=this.projectedRadius(e);return r>i?1:r<-i?-1:0}intersectRay(e,r,i=0){const n=this._data,s=tn;s[0]=-n[6],s[1]=-n[7],s[2]=-n[8],s[3]=n[9],ir[0]=e[0]-n[0],ir[1]=e[1]-n[1],ir[2]=e[2]-n[2];const o=Oc(ir,ir,tn),a=Oc(Mg,r,tn);let l=-1/0,c=1/0;const u=this.getHalfSize(YC);for(let h=0;h<3;h++){const p=o[h],f=a[h],g=u[h]+i;if(Math.abs(f)>1e-6){const _=(g-p)/f,v=(-g-p)/f;l=Math.max(l,Math.min(_,v)),c=Math.min(c,Math.max(_,v))}else if(p>g||p<-g)return!1}return l<=c}projectedArea(e,r,i,n){const s=this.getQuaternion(T0);G1(tn,s),ir[0]=e[0]-this._data[0],ir[1]=e[1]-this._data[1],ir[2]=e[2]-this._data[2],Oc(ir,ir,tn);const o=this.getHalfSize(YC),a=ir[0]<-o[0]?-1:ir[0]>o[0]?1:0,l=ir[1]<-o[1]?-1:ir[1]>o[1]?1:0,c=ir[2]<-o[2]?-1:ir[2]>o[2]?1:0,u=Math.abs(a)+Math.abs(l)+Math.abs(c);if(u===0)return 1/0;const h=u===1?4:6,p=6*(a+3*l+9*c+13);P$(cS,s),z9(cS,cS,o);const f=this.getCenter(Lp);for(let v=0;v<h;v++){const b=LJe[p+v];ie(ir,((1&b)<<1)-1,(2&b)-1,((4&b)>>1)-1),Zs(ir,ir,cS),fe(tb,f,ir),tb[3]=1,jc(tb,tb,r);const w=1/Math.max(1e-6,tb[3]);Ld[2*v]=tb[0]*w,Ld[2*v+1]=tb[1]*w}const g=2*h-2;let _=Ld[0]*(Ld[3]-Ld[g+1])+Ld[g]*(Ld[1]-Ld[g-1]);for(let v=2;v<g;v+=2)_+=Ld[v]*(Ld[v+3]-Ld[v-1]);return Math.abs(_)*i*n*.125}projectedRadius(e){const r=this.getQuaternion(T0);return G1(tn,r),Oc(ir,e,tn),Math.abs(ir[0]*this._data[3])+Math.abs(ir[1]*this._data[4])+Math.abs(ir[2]*this._data[5])}minimumDistancePlane(e){return e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3]-this.projectedRadius(e)}maximumDistancePlane(e){return e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3]+this.projectedRadius(e)}toAaBoundingBox(e){const r=this.getQuaternion(T0),i=P$(cS,r),n=this._data[3]*Math.abs(i[0])+this._data[4]*Math.abs(i[3])+this._data[5]*Math.abs(i[6]),s=this._data[3]*Math.abs(i[1])+this._data[4]*Math.abs(i[4])+this._data[5]*Math.abs(i[7]),o=this._data[3]*Math.abs(i[2])+this._data[4]*Math.abs(i[5])+this._data[5]*Math.abs(i[8]);e[0]=this._data[0]-n,e[1]=this._data[1]-s,e[2]=this._data[2]-o,e[3]=this._data[0]+n,e[4]=this._data[1]+s,e[5]=this._data[2]+o}transform(e,r,i,n=0,s=nc(i),o=nc(r),a=lv(r,o)){if(i===s)r.isGeographic?kJe(this,e,r,n,o):FJe(this,e,r,n,o,a);else if(r.isWGS84&&(i.isWebMercator||h$(i)))DJe(r,this,i,e,n);else if(r.isWebMercator&&h$(i))NJe(r,this,i,e,n);else{const l=this.getCenter(Lp);l[2]+=n,Ji(l,r,0,l,i,0,1),e.center=l,this!==e&&(e.quaternion=this.getQuaternion(T0),e.halfSize=this.getHalfSize(YC))}}};const tn=lc(),T0=lc(),$Je=lc(),ir=C(),Mg=C(),tb=Zt();function IJe(t,e=new LCe){return vJe(t,e),e}const Ld=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2],LJe=(()=>{const t=new Int8Array(162);let e=0;const r=i=>{for(let n=0;n<i.length;n++)t[e+n]=i[n];e+=6};return r([6,2,3,1,5,4]),r([0,2,3,1,5,4]),r([0,2,3,7,5,4]),r([0,1,3,2,6,4]),r([0,1,3,2,0,0]),r([0,1,5,7,3,2]),r([0,1,3,7,6,4]),r([0,1,3,7,6,2]),r([0,1,5,7,6,2]),r([0,1,5,4,6,2]),r([0,1,5,4,0,0]),r([0,1,3,7,5,4]),r([0,2,6,4,0,0]),r([0,0,0,0,0,0]),r([1,3,7,5,0,0]),r([2,3,7,6,4,0]),r([2,3,7,6,0,0]),r([2,3,1,5,7,6]),r([0,1,5,7,6,2]),r([0,1,5,7,6,4]),r([0,1,3,7,6,4]),r([4,5,7,6,2,0]),r([4,5,7,6,0,0]),r([4,5,1,3,7,6]),r([0,2,3,7,5,4]),r([6,2,3,7,5,4]),r([6,2,3,1,5,4]),t})();function DCe(t,e,r,i,n){const s=t.getQuaternion(T0);n.quaternion=s,G1(tn,s);const o=t.getCenter(Lp),a=t.getHalfSize(YC);if(i===De.Global){Oc(Ii,o,tn),IE(_p,Ii),wxe(cu,_p,a),Yi(cu,_p,cu);const l=Te(cu);fe(cu,_p,a);const c=Te(cu);if(l<r)n.center=o,ie(Ii,r,r,r),n.halfSize=fe(Ii,a,Ii);else{const u=c>0?1+e/c:1,h=l>0?1+r/l:1,p=(h+u)/2,f=(h-u)/2;ne(cu,_p,f),n.halfSize=Xs(cu,cu,a,p),ne(cu,_p,p),Xs(cu,cu,a,f),bxe(Ii,Ii),Jz(Ii,cu,Ii);const g=t.getQuaternion($Je);n.center=Oc(Ii,Ii,g)}}else{n.center=Xs(Ii,o,$E,(r+e)/2);const l=Oc(Ii,$E,tn);IE(l,l),n.halfSize=Xs(_p,a,l,(r-e)/2)}return n}function DJe(t,e,r,i,n){e.getCenter(Lp),Lp[2]+=n;const s=nc(r);Ji(Lp,t,0,Lp,s,0,1),NCe(s,e,Lp,r,i)}function NJe(t,e,r,i,n){e.getCenter(Lp),Lp[2]+=n,NCe(t,e,Lp,r,i)}function NCe(t,e,r,i,n){const s=e.getQuaternion(T0),o=P$(cS,s),a=e.getHalfSize(YC);for(let l=0;l<8;++l){for(let c=0;c<3;++c)Sm[c]=a[c]*(l&1<<c?-1:1);for(let c=0;c<3;++c){let u=r[c];for(let h=0;h<3;++h)u+=Sm[h]*o[3*h+c];E5[3*l+c]=u}}Ji(E5,t,0,E5,i,0,8),IJe(zJe,n)}function FJe(t,e,r,i,n=nc(r),s=lv(r,n)){t.getCorners(mce),t.getCenter(Sm),Sm[2]+=i,La(r,Sm,lu,n),e.setCenter(lu[12],lu[13],lu[14]);const o=2*Math.sqrt(1+lu[0]+lu[5]+lu[10]);tn[0]=(lu[6]-lu[9])/o,tn[1]=(lu[8]-lu[2])/o,tn[2]=(lu[1]-lu[4])/o,tn[3]=.25*o;const a=t.getQuaternion(T0);e.quaternion=B9(tn,tn,a),G1(tn,tn),ie(_p,0,0,0);const l=e.getCenter(UJe);for(const c of mce)c[2]+=i,s(c,0,c,0),Yi(Ii,c,l),Oc(Ii,Ii,tn),IE(Ii,Ii),xxe(_p,_p,Ii);e.halfSize=_p}function kJe(t,e,r,i,n=nc(r)){const s=Br(r),o=1+Math.max(0,i)/(s.radius+t.centerZ);t.getCenter(Sm),Sm[2]+=i,Ji(Sm,r,0,Sm,n,0,1),e.center=Sm;const a=t.getQuaternion(T0);e.quaternion=a,G1(tn,a),ie(Ii,0,0,1),Oc(Ii,Ii,tn);const l=t.getHalfSize(YC);ie(Ii,l[0]*Math.abs(Ii[0]),l[1]*Math.abs(Ii[1]),l[2]*Math.abs(Ii[2])),ne(Ii,Ii,s.inverseFlattening),fe(Ii,l,Ii),e.halfSize=ne(Ii,Ii,o)}const E5=new Array(24),zJe=new U3(E5,3),Sm=C(),Lp=C(),UJe=C(),YC=C(),cS=li(),lu=xe(),mce=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],Ii=C(),_p=C(),cu=C(),BJe=Ce(-1,-1,-1);let VJe=class{constructor(){this._transform=xe(),this._transformInverse=new AD({value:this._transform},os,xe),this._transformInverseTranspose=new AD(this._transformInverse,Qc,xe),this._transformTranspose=new AD({value:this._transform},Qc,xe),this._transformInverseRotation=new AD({value:this._transform},TCe,li)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(e){Zn(this._transform,e)}multiplyTransform(e){Hr(this._transform,this._transform,e)}set(e){Zn(this._transform,e),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(e,r){this.setTransformMatrix(e),this.multiplyTransform(r),this._invalidateLazyTransforms()}},AD=class{constructor(e,r,i){this._original=e,this._update=r,this._dirty=!0,this._transform=i()}invalidate(){this._dirty=!0}get value(){return this._dirty&&(this._update(this._transform,this._original.value),this._dirty=!1),this._transform}},GJe=class{constructor(e=0){this.offset=e,this.tmpVertex=C()}applyToVertex(e,r,i){const n=ie(fte,e,r,i),s=fe(FCe,n,this.localOrigin),o=this.offset/Te(s);return Xs(this.tmpVertex,n,s,o),this.tmpVertex}applyToAabb(e){const r=qJe,i=YJe,n=XJe;for(let l=0;l<3;++l)r[l]=e[0+l]+this.localOrigin[l],i[l]=e[3+l]+this.localOrigin[l],n[l]=r[l];const s=this.applyToVertex(r[0],r[1],r[2]);for(let l=0;l<3;++l)e[l]=s[l],e[l+3]=s[l];const o=l=>{const c=this.applyToVertex(l[0],l[1],l[2]);for(let u=0;u<3;++u)e[u]=Math.min(e[u],c[u]),e[u+3]=Math.max(e[u+3],c[u])};for(let l=1;l<8;++l){for(let c=0;c<3;++c)n[c]=l&1<<c?i[c]:r[c];o(n)}let a=0;for(let l=0;l<3;++l)r[l]*i[l]<0&&(a|=1<<l);if(a!==0&&a!==7){for(let l=0;l<8;++l)if(!(a&l)){for(let c=0;c<3;++c)n[c]=a&1<<c?0:l&1<<c?r[c]:i[c];o(n)}}for(let l=0;l<3;++l)e[l]-=this.localOrigin[l],e[l+3]-=this.localOrigin[l];return e}},jJe=class{constructor(e=0){this.componentLocalOriginLength=0,this._totalOffset=0,this._offset=0,this._tmpVertex=C(),this._tmpMbs=Jn(),this._tmpObb=new LCe,this._resetOffset(e)}_resetOffset(e){this._offset=e,this._totalOffset=e}set offset(e){this._resetOffset(e)}get offset(){return this._offset}set componentOffset(e){this._totalOffset=this._offset+e}set localOrigin(e){this.componentLocalOriginLength=Te(e)}applyToVertex(e,r,i){const n=ie(fte,e,r,i),s=ie(FCe,e,r,i+this.componentLocalOriginLength),o=this._totalOffset/Te(s);return Xs(this._tmpVertex,n,s,o),this._tmpVertex}applyToAabb(e){const r=this.componentLocalOriginLength,i=e[0],n=e[1],s=e[2]+r,o=e[3],a=e[4],l=e[5]+r,c=Math.abs(i),u=Math.abs(n),h=Math.abs(s),p=Math.abs(o),f=Math.abs(a),g=Math.abs(l),_=.5*(1+Math.sign(i*o))*Math.min(c,p),v=.5*(1+Math.sign(n*a))*Math.min(u,f),b=.5*(1+Math.sign(s*l))*Math.min(h,g),w=Math.max(c,p),x=Math.max(u,f),S=Math.max(h,g),E=Math.sqrt(_*_+v*v+b*b),A=Math.sign(c+i),O=Math.sign(u+n),L=Math.sign(h+s),z=Math.sign(p+o),k=Math.sign(f+a),q=Math.sign(g+l),B=this._totalOffset;if(E<B)return e[0]-=(1-A)*B,e[1]-=(1-O)*B,e[2]-=(1-L)*B,e[3]+=z*B,e[4]+=k*B,e[5]+=q*B,e;const J=B/Math.sqrt(w*w+x*x+S*S),W=B/E,Y=W-J,le=-Y;return e[0]+=i*(A*le+W),e[1]+=n*(O*le+W),e[2]+=s*(L*le+W),e[3]+=o*(z*Y+J),e[4]+=a*(k*Y+J),e[5]+=l*(q*Y+J),e}applyToMbs(e){const r=Te(e),i=this._totalOffset/r;return Xs(this._tmpMbs,e,e,i),this._tmpMbs[3]=e[3]+e[3]*this._totalOffset/r,this._tmpMbs}applyToObb(e){return DCe(e,this._totalOffset,this._totalOffset,De.Global,this._tmpObb),this._tmpObb}},HJe=class{constructor(e=0){this.offset=e,this.sphere=Jn(),this.tmpVertex=C()}applyToVertex(e,r,i){const n=this.objectTransform.transform,s=ie(fte,e,r,i),o=Ge(s,s,n),a=this.offset/Te(o);Xs(o,o,o,a);const l=this.objectTransform.inverse;return Ge(this.tmpVertex,o,l),this.tmpVertex}applyToMinMax(e,r){const i=this.offset/Te(e);Xs(e,e,e,i);const n=this.offset/Te(r);Xs(r,r,r,n)}applyToAabb(e){const r=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*r,e[1]+=e[1]*r,e[2]+=e[2]*r;const i=this.offset/Math.sqrt(e[3]*e[3]+e[4]*e[4]+e[5]*e[5]);return e[3]+=e[3]*i,e[4]+=e[4]*i,e[5]+=e[5]*i,e}applyToBoundingSphere(e){const r=Te(e),i=this.offset/r;return Xs(this.sphere,e,e,i),this.sphere[3]=e[3]+e[3]*this.offset/r,this.sphere}};const gce=new HJe;function bq(t){return t!=null?(gce.offset=t,gce):null}const yce=new jJe;function _ce(t){return t!=null?(yce.offset=t,yce):null}const vce=new GJe;function WJe(t){return t!=null?(vce.offset=t,vce):null}const pv="terrain",fte=C(),FCe=C(),qJe=C(),YJe=C(),XJe=C(),QE=1e-5;let ZJe=class{constructor(e){this.options=new EZe,this._results=new JJe,this.transform=new VJe,this.tolerance=QE,this.verticalOffset=null,this._ray=Js(),this._rayEnd=C(),this._rayBeginTransformed=C(),this._rayEndTransformed=C(),this.viewingMode=e??De.Global}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(e,r,i){this.resetWithRay(MSe(e,r,this._ray),i)}resetWithRay(e,r){this.camera=r,e!==this._ray&&b6(e,this._ray),this.options.verticalOffset!==0?this.viewingMode===De.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,fe(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(e=null,r,i,n,s){var a;this.point=r,this.filterPredicate=n,this.tolerance=i??QE;const o=bq(this.verticalOffset);if(e&&e.length>0){const l=s?c=>{s(c)&&this.intersectObject(c)}:c=>{this.intersectObject(c)};for(const c of e){const u=(a=c.getSpatialQueryAccelerator)==null?void 0:a.call(c);u!=null?(o!=null?u.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,l,o):u.forEachAlongRay(this._ray.origin,this._ray.direction,l),this.options.selectionMode&&this.options.hud&&u.forEachDegenerateObject(l)):c.objects.forAll(h=>l(h))}}this.sortResults()}intersectObject(e){const r=e.geometries;if(!r)return;const i=e.effectiveTransformation,n=bq(this.verticalOffset);for(const s of r){if(!s.visible)continue;const{material:o,id:a}=s;this.transform.setAndInvalidateLazyTransforms(i,s.transformation),Ge(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),Ge(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const l=this.transform.transform;n!=null&&(n.objectTransform=this.transform),o.intersect(s,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,(c,u,h,p,f,g)=>{if(c>=0){if(this.filterPredicate!=null&&!this.filterPredicate(this._ray.origin,this._rayEnd,c))return;const _=p?this._results.hud:this._results,v=p?b=>{const w=new AZe(e,a,h,g);b.set(Bi.HUD,w,c,u,sn,f)}:b=>b.set(Bi.OBJECT,{object:e,geometryId:a,triangleNr:h},c,u,l,f);if((_.min.drapedLayerOrder==null||f>=_.min.drapedLayerOrder)&&(_.min.dist==null||c<_.min.dist)&&v(_.min),this.options.store!==Go.MIN&&(_.max.drapedLayerOrder==null||f<_.max.drapedLayerOrder)&&(_.max.dist==null||c>_.max.dist)&&v(_.max),this.options.store===Go.ALL)if(p){const b=new wq(this._ray);v(b),this._results.hud.all.push(b)}else{const b=new XC(this._ray);v(b),this._results.all.push(b)}}})}}sortResults(e=this._results.all){e.sort((r,i)=>r.dist!==i.dist?(r.dist??0)-(i.dist??0):r.drapedLayerOrder!==i.drapedLayerOrder?bce(r.drapedLayerOrder,i.drapedLayerOrder):bce(r.drapedLayerGraphicOrder,i.drapedLayerGraphicOrder))}};function bce(t,e){return(e??-Number.MAX_VALUE)-(t??-Number.MAX_VALUE)}function yd(t){return new ZJe(t)}let JJe=class{constructor(){this.min=new XC(Js()),this.max=new XC(Js()),this.hud={min:new wq(Js()),max:new wq(Js()),all:new Array},this.ground=new XC(Js()),this.all=[]}init(e){this.min.init(e),this.max.init(e),this.ground.init(e),this.all.length=0,this.hud.min.init(e),this.hud.max.init(e),this.hud.all.length=0}},XC=class{get ray(){return this._ray}get distanceInRenderSpace(){return this.dist!=null?(ne(MD,this.ray.direction,this.dist),Te(MD)):null}getIntersectionPoint(e){return!!xd(this)&&(ne(MD,this.ray.direction,this.dist),fe(e,this.ray.origin,MD),!0)}getTransformedNormal(e){return ce(kP,this.normal),kP[3]=0,jc(kP,kP,this.transformation),ce(e,kP),pe(e,e)}constructor(e){this.intersector=Bi.OBJECT,this.normal=C(),this.transformation=xe(),this._ray=Js(),this.init(e)}init(e){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=Bi.OBJECT,b6(e,this._ray)}set(e,r,i,n,s,o,a){this.intersector=e,this.dist=i,ce(this.normal,n??$E),Zn(this.transformation,s??sn),this.target=r,this.drapedLayerOrder=o,this.drapedLayerGraphicOrder=a}copy(e){b6(e.ray,this._ray),this.intersector=e.intersector,this.dist=e.dist,this.target=e.target,this.drapedLayerOrder=e.drapedLayerOrder,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,ce(this.normal,e.normal),Zn(this.transformation,e.transformation)}},wq=class extends XC{constructor(){super(...arguments),this.intersector=Bi.HUD}};function mte(t){return new XC(t)}const MD=C(),kP=Zt();function kCe(t,e,r,i){return t.renderCoordsHelper.fromRenderCoords(e.eye,E6,i)!=null&&i2e(r,E6)}function V9(t,e){return t.elevationProvider?t.elevationProvider.getElevation(e[0],e[1],e[2],t.renderCoordsHelper.spatialReference,"ground")??0:0}function D2(t,e,r,i){const n=t.state.camera.clone();e&&r&&i&&(n.eye=e,n.center=r,n.up=i),QJe(t,n.ray,Wy)||ce(Wy,n.center);const s=t.state.constraints,o=s.minimumPoiDistance;if(Uo(n.eye,Wy)<o){const a=s.collision.enabled;ce(rb,n.viewForward),ne(rb,rb,o),a?n.eye=ye(E6,Wy,rb):fe(Wy,n.eye,rb);const l=t.renderCoordsHelper,c=l.getAltitude(n.eye),u=s.collision.elevationMargin;a&&c<u&&(ye(rb,Wy,n.eye),n.eye=l.setAltitude(E6,u,n.eye),fe(Wy,n.eye,rb))}return n.center=Wy,n}function wce(t,e,r){if(!t.state.isGlobal||!t.stateManager.constraintsManager)return!1;const i=V9(t,e),n=t.stateManager.constraintsManager.nearFarHeuristic,{far:s}=n.compute(e,r,t.renderDataExtent,i,eQe),o=s*s;return Uo(e,r)>o}function QJe(t,e,r){let i=xce[t.viewingMode];i||(i=yd(t.state.viewingMode),i.options.backfacesTerrain=!t.state.isGlobal,i.options.invisibleTerrain=!0,xce[t.viewingMode]=i);const{isGlobal:n}=t.state;return!(!t.sceneIntersectionHelper.intersectRay(e,i,r)||wce(t,e.origin,r))||!(!t.renderCoordsHelper.intersectManifold(e,0,r)||wce(t,e.origin,r))||!!n&&KJe(e,r,Br(t.spatialReference).radius)}function KJe(t,e,r){const i=de(t.origin,t.origin)-r*r,n=i>0?Math.sqrt(i)/3:1;return ne(e,t.direction,n/Te(t.direction)),fe(e,e,t.origin),!0}const xce={},E6=C(),Wy=C(),rb=C(),eQe={near:0,far:0},tQe=C(),OD=C();function gte(){return{direction:C(),up:C()}}function zCe(t,e,r,i,n){let s=pe(tQe,t),o=de(s,i);const a=o>0;o=Math.abs(o),o>.99&&(o=Math.abs(de(e,i)),o<.99?(ce(s,e),a&&ne(s,s,-1)):s=null);let l=0;if(s){ne(OD,i,de(i,s)),ye(s,s,OD);const u=de(s,n)/(Te(s)*Te(n));Je(OD,s,n),l=(de(OD,i)>0?1:-1)*Fa(Ks(u))}const c=Fa(Ks(-de(i,t)/Te(t)));return r?(r.heading=l,r.tilt=c,r):{heading:l,tilt:c}}const UCe=Ce(0,1,0),BCe=Ce(0,0,1),zP=xe(),Og=C(),Rg=C();function VCe(t,e,r,i=gte()){const{direction:n,up:s}=i;return Oxe(zP,-Nt(e)),LE(zP,zP,Nt(r)),Ge(n,BCe,zP),ne(n,n,-1),Ge(s,UCe,zP),i}function rQe(t,e,r,i){return zCe(e,r,i,BCe,UCe)}function iQe(t,e,r,i){const n=VCe(t,r,i),s=C();return ne(s,n.direction,-e),fe(s,s,t),{up:n.up,eye:s,heading:r,tilt:i}}function nQe(t){return Fa(t)}function sQe(t){return Nt(t)}function GCe(t,e,r,i,n){const s=t.renderSpatialReference,o=t.map&&t.spatialReference||e.spatialReference;return _n(e,Og,s),_n(e,Rg,s),Og[0]-=r/2,Rg[0]+=r/2,Og[1]-=i/2,Rg[1]+=i/2,ka(Og,s,Og,o),ka(Rg,s,Rg,o),n?(n.xmin=Og[0],n.ymin=Og[1],n.xmax=Rg[0],n.ymax=Rg[1],n.spatialReference=o):n=new ei(Og[0],Og[1],Rg[0],Rg[1],o),n}const oQe=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:rQe,eyeForCenterWithHeadingTilt:iQe,eyeTiltToLookAtTilt:sQe,headingTiltToDirectionUp:VCe,lookAtTiltToEyeTilt:nQe,toExtent:GCe},Symbol.toStringTag,{value:"Module"}));function Tce(t,e,r){if(e.longitude==null||e.latitude==null||r.longitude==null||r.latitude==null)throw new Error("Invalid points: no lon/lat");return aQe(t,e.longitude,e.latitude,r.longitude,r.latitude)}function aQe(t,e,r,i,n){const s=Nt(r),o=Nt(n),a=s-o,l=Nt(e)-Nt(i),c=Math.sin(a/2),u=Math.sin(l/2),h=2*hd(Math.sqrt(c*c+Math.cos(s)*Math.cos(o)*u*u))*t;return Math.round(1e4*h)/1e4}function lQe(t,e,r){const i=e.spatialReference,n=Br(i),s=new ke(e.x,t.y,i),o=new ke(r.x,t.y,i),a=new ke(t.x,e.y,i),l=new ke(t.x,r.y,i);return{lon:Tce(n.radius,s,o),lat:Tce(n.radius,a,l)}}function cQe(t,e,r){const i=e/r,n=Nt(t),s=Math.sin(i/2),o=Math.cos(n),a=2*hd(Math.sqrt(s*s/(o*o)));return Fa(a)}function uQe(t,e){let r=t/15;return e||(r=Math.round(r)),r}function Sce(t,e){const r=t==null?void 0:t[0];if(r==null)return null;e||(e={hours:0,minutes:0,seconds:0}),e.hours=uQe(r,!0);const i=e.hours%1;e.hours-=i,e.minutes=60*i;const n=e.minutes%1;return e.minutes-=n,e.seconds=Math.round(60*n),e}const jCe=Ce(0,0,1),HCe=pe(C(),Ce(1,1,1)),hQe=new sv(-180,180),UP=xe(),Q_=C(),iT=C();function WCe(t,e,r,i=gte()){Je(Q_,t,jCe),de(Q_,Q_)===0&&Je(Q_,t,HCe),Kc(UP,-Nt(e),t),Gc(UP,UP,-Nt(r),Q_);const{up:n,direction:s}=i;return Je(n,Q_,t),pe(n,n),Ge(n,n,UP),pe(s,t),Bo(s,s),Ge(s,s,UP),i}function dQe(t,e,r,i){const n=Q_,s=iT;return pe(n,t),Je(iT,n,jCe),de(iT,iT)===0&&Je(iT,n,HCe),Je(s,iT,n),zCe(e,r,i,n,s)}function pQe(t,e,r,i){const n={eye:C(),up:null,tilt:i,heading:r},s=Q_;s[0]=t[0],s[1]=t[2],s[2]=-t[1];const o=e,a=Nt(r),l=Nt(i),c=Math.sin(a),u=Math.cos(a),h=Math.sin(l),p=Math.cos(l),f=Te(s);let g;if(Math.abs(l)<1e-8)g=o+f;else{const le=f/h,D=hd(o/le),I=Math.PI-l-D;g=le*Math.sin(I)}const _=p*o,v=o*o*(h*h),b=u*u*v,w=g-_,x=w*w,S=b*(b+x-s[1]*s[1]);if(S<0)return ne(n.eye,s,g/f),n.tilt=0,RD(n,t);const E=Math.sqrt(S),A=s[1]*w,O=b+x;let L;if(L=u>0?-E+A:E+A,Math.abs(O)<1e-8)return f<1e-8?(n.eye[0]=0,n.eye[1]=0,n.eye[2]=o):ne(n.eye,s,g/f),n.tilt=0,vV(n.eye),RD(n,t);n.eye[1]=L/O;const z=c*c*v,k=h*o,q=u*k*n.eye[1],B=n.eye[1]*n.eye[1],J=1-B,W=Math.sqrt(J),Y=b*B+z-2*q*W*w+J*x;return Math.abs(Y)<1e-8?(ne(n.eye,s,g/f),n.tilt=0,vV(n.eye),RD(n,t)):(n.eye[0]=(J*(g*s[0]-_*s[0])-k*W*(s[0]*n.eye[1]*u+s[2]*c))/Y,n.eye[2]=(J*(g*s[2]-_*s[2])-k*W*(s[2]*n.eye[1]*u-s[0]*c))/Y,ne(n.eye,n.eye,g),vV(n.eye),RD(n,t))}function vV(t){const e=t[1];t[1]=-t[2],t[2]=e}function RD(t,e){const r=WCe(e,t.heading,t.tilt);return t.up=r.up,t}function fQe(t,e,r){const i=Te(e),n=Math.sqrt(r*r+i*i-2*r*i*Math.cos(Math.PI-t)),s=hd(r/(n/Math.sin(t)));return Fa(t-s)}function mQe(t,e,r){const i=Nt(t),n=Te(e);return hd(r/(n/Math.sin(i)))+i}function qCe(t,e,r,i,n){let s,o,a,l;const c=e.latitude,u=Br(t.spatialReference).radius,h=e.longitude,p=cQe(c,r,u)/2;s=h-p,o=h+p;const f=Nt(c),g=(1+Math.sin(f))/(1-Math.sin(f)),_=(g+1)*Math.tan(i/u/2),v=_*_;function b(x){const S=Math.PI/2;return(x=KGe.normalize(x,-S))>S&&(x=Math.PI-x),x}if(a=1.5*Math.PI-2*Math.atan(.5*(_+Math.sqrt(4*g+v))),l=a+i/u,a=b(a),l=b(l),l<a){const x=l;l=a,a=x}if(a=Math.max(Fa(a),-90),l=Math.min(Fa(l),90),o=hQe.monotonic(s,o),o-s>180){const x=(o-s-180)/2;s+=x,o-=x}const w=t.spatialReference&&t.spatialReference.isGeographic?t.spatialReference:lt.WGS84;return n?(n.xmin=s,n.ymin=a,n.xmax=o,n.ymax=l,n.spatialReference=w):n=new ei(s,a,o,l,w),t.spatialReference&&t.spatialReference.isWebMercator&&z1(n,!1,n),n}const gQe=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:dQe,eyeForCenterWithHeadingTilt:pQe,eyeTiltToLookAtTilt:mQe,headingTiltToDirectionUp:WCe,lookAtTiltToEyeTilt:fQe,toExtent:qCe},Symbol.toStringTag,{value:"Module"}));function P6(t){return t.type==="point"}let yte=class{constructor(e,r=null,i=0){this.array=e,this.spatialReference=r,this.offset=i}};function YCe(t){return"array"in t}function Lm(t,e,r="ground"){if(P6(e))return t.getElevation(e.x,e.y,e.z||0,e.spatialReference,r);if(YCe(e)){let i=e.offset;return t.getElevation(e.array[i++],e.array[i++],e.array[i]||0,e.spatialReference??t.spatialReference,r)}return t.getElevation(e[0],e[1],e[2]||0,t.spatialReference,r)}function xq(t,e){return t!=null&&(e==null||(e===De.Local?!t.isGeographic||t.isWGS84||t.wkid===Wh.CGCS2000:t.isWebMercator||t.isWGS84||t.wkid===Wh.CGCS2000||t.wkid===Wh.GCSMARS2000||t.wkid===Wh.GCSMARS2000_SPHERE||t.wkid===Wh.GCSMOON2000))}const XCe=()=>re.getLogger("esri.views.3d.support.cameraUtils"),ZCe=39.37,JCe=96,Tq=1,yQe=8,_Qe=5,QCe=1,Cce=C(),vQe={heading:0,tilt:0},eR=C(),bQe=new sv(-20037508342788905e-9,20037508342788905e-9),wQe=new sv(-180,180);var aa;function yy(t){return t.spatialReference??lt.WGS84}function B3(t){return t.viewingMode==="global"?gQe:oQe}function xQe(t,e,r,i,n){return B3(t).headingTiltToDirectionUp(e,r,i,n)}function p0(t,e){if(e==null)return null;const r=t.renderSpatialReference,i=B3(t).headingTiltToDirectionUp,n=C();if(!_n(e.position,n,r))return null;const s=i(n,e.heading,e.tilt);ne(s.direction,s.direction,t.state.camera.distance),fe(s.direction,s.direction,n);const o=D2(t,n,s.direction,s.up);return o.fov=Nt(e.fov),o.row=e.layout.row,o.rows=e.layout.rows,o.column=e.layout.column,o.columns=e.layout.columns,o}(function(t){t[t.LOCKED=0]="LOCKED",t[t.ADJUST=1]="ADJUST"})(aa||(aa={}));const nT=C();function KE(t,e,r){const i=t.renderSpatialReference,n=j9(t,e.eye,e.viewForward,e.up,vQe);let s=yy(t);return ka(e.eye,i,nT,s)||(s=lt.WGS84,ka(e.eye,i,nT,s)),r==null?r=new eu(new ke(nT,s),n.heading,n.tilt,Fa(e.fov)):(r.position.x=nT[0],r.position.y=nT[1],r.position.z=nT[2],r.position.spatialReference=s,r.heading=n.heading,r.tilt=n.tilt,r.fov=Fa(e.fov)),r.layout.row=e.row,r.layout.rows=e.rows,r.layout.column=e.column,r.layout.columns=e.columns,r}function G9(t,e,r){const i=t.state.camera,n=i.width/2/i.pixelRatio;return t.renderCoordsHelper.viewingMode===De.Global&&r!=null&&(e*=Math.cos(Nt(r))),e/=t.renderCoordsHelper.unitInMeters,n/(JCe*ZCe/e)/Math.tan(i.fovX/2)}function l2(t,e,r){const i=t.state.camera,n=e*Math.tan(i.fovX/2),s=i.width/2/i.pixelRatio;let o=JCe*ZCe/(s/n);return t.renderCoordsHelper.viewingMode===De.Global&&r!=null&&(o/=Math.cos(Nt(r))),o*t.renderCoordsHelper.unitInMeters}async function KCe(t,e,r,i,n,s){return eEe(t,e,G9(t,r,e.latitude),i,n,s)}function TQe(t,e,r,i,n,s){return fEe(t,_te(t,i.heading,i.tilt,e,r,n),i.fov,s)}async function eEe(t,e,r,i,n,s){const o=await rEe(t,i.heading,i.tilt,e,r,n,s);return vt(s),mEe(t,o,i.fov,s)}function j9(t,e,r,i,n){return B3(t).directionToHeadingTilt(e,r,i,n)}function tEe(t,e){return!!(t.basemapTerrain&&t.renderCoordsHelper.fromRenderCoords(e,eR,t.spatialReference)&&t.elevationProvider&&(Lm(t.elevationProvider,eR)??0)>eR[2]-QCe)}async function SQe(t,e,r){if(tEe(t,e))return!0;const{elevationProvider:i,spatialReference:n,renderCoordsHelper:s}=t;if(i==null||!s.fromRenderCoords(e,eR,n))return!1;const[o,a,l]=eR,c=await i.queryElevation(o,a,l,n,"ground",r)??0;return vt(r),c>l-QCe}async function CQe(t,e,r){const i=C();if(e==null)return ce(i,t.state.camera.center);if(e instanceof ke){const{renderSpatialReference:n,basemapTerrain:s,elevationProvider:o}=t,a=e.spatialReference;if(await g6(e,i,n,0,{signal:r}),vt(r),e.z==null&&s!=null&&o!=null){const l=await o.queryElevation(e.x,e.y,e.z??0,a,"ground",r);vt(r),l!=null&&t.renderCoordsHelper.setAltitude(i,l)}return i}return ce(i,e)}function EQe(t,e){const r=C();if(e==null)return ce(r,t.state.camera.center);if(e instanceof ke){if(!_n(e,r,t.renderSpatialReference))return null;const{basemapTerrain:i,elevationProvider:n}=t;if(e.z==null&&i!=null&&n!=null){const s=Lm(n,e);s!=null&&t.renderCoordsHelper.setAltitude(r,s)}return r}return ce(r,e)}function _te(t,e,r,i,n,s){return iEe(t,e,r,i instanceof ke?i:null,EQe(t,i),n,s)}async function rEe(t,e,r,i,n,s,o){const a=i instanceof ke?i:null,l=await CQe(t,i,o);return vt(o),nEe(t,e,r,a,l,n,s,o)}function iEe(t,e,r,i,n,s,o){if(n==null||!i&&(i=new ke({spatialReference:yy(t)}),!ag(n,t.renderSpatialReference,i)))return null;const a=sEe(t,e,r,n,s,o);if(oEe(t,r,o)&&tEe(t,a.eye)){const{tilt:l,mode:c}=aEe(t,r,n,s);return iEe(t,e,l,i,n,s,c)}return lEe(a,n)}async function nEe(t,e,r,i,n,s,o,a){i||(i=new ke({spatialReference:yy(t)}),await wCe(n,t.renderSpatialReference,i,{signal:a})||(i=null)),vt(a);const l=sEe(t,e,r,n,s,o);if(oEe(t,r,o)&&await SQe(t,l.eye,a)){vt(a);const{tilt:c,mode:u}=aEe(t,r,n,s);return nEe(t,e,c,i,n,s,u,a)}return lEe(l,n)}function sEe(t,e,r,i,n,s){const o=AQe(t,e,r,i,n=Math.max(n,t.state.constraints.minimumPoiDistance),s);return(0,B3(t).eyeForCenterWithHeadingTilt)(i,n,o.heading,o.tilt)}function oEe(t,e,r){const i=t.map.ground.navigationConstraint;return r===aa.ADJUST&&t.viewingMode==="global"&&e>0&&(i==null||i.type==="stay-above")}function aEe(t,e,r,i){const n=pEe(t,r,i,OQe(t,i,e,r));return{tilt:n,mode:e-n<1?aa.LOCKED:aa.ADJUST}}function lEe(t,e){return{...t,center:Zi(e)}}function cEe(t,e){const{state:r,spatialReference:i}=t,n=e.spatialReference;return r.isGlobal&&xq(n,De.Global)||r.isLocal&&i.equals(n)}function uEe(t,e){let r,i,n;if(t.state.isGlobal){const u=new ke(e.xmin,e.ymin,e.spatialReference),h=new ke(e.xmax,e.ymax,e.spatialReference),p=e.spatialReference.isGeographic?wQe:bQe;r=new ke({x:p.center(u.x,h.x),y:(h.y+u.y)/2,z:e.zmax!=null&&e.zmin!=null?(e.zmax+e.zmin)/2:void 0,spatialReference:e.spatialReference});const f=Br(e.spatialReference),g=lQe(r,u,h);i=g.lon,n=g.lat,p.diff(u.x,h.x)>p.range/2&&(i+=f.halfCircumference),i=Math.min(i,f.halfCircumference),n=Math.min(n,f.halfCircumference)}else{const u=t.renderSpatialReference??e.spatialReference;u.equals(e.spatialReference)||(e=M2(e,u)),i=e.xmax-e.xmin,n=e.ymax-e.ymin;const h=e.zmax!=null&&e.zmin!=null?(e.zmax+e.zmin)/2:void 0;r=new ke({x:e.xmin+.5*i,y:e.ymin+.5*n,z:h,spatialReference:u})}const s=e.zmax!=null&&e.zmin!=null?e.zmax-e.zmin:0,o=t.state.camera,a=1/Math.tan(o.fovX/2),l=1/Math.tan(o.fovY/2),c=1/Math.tan(o.fov/2);return{center:r,distance:Math.max(.5*i*a,.5*n*l,.5*s*c)/Tq}}async function hEe(t,e,r,i,n,s){const o=cEe(t,e)?e:await hv(e,t.spatialReference,{signal:s});vt(s);const{center:a,distance:l}=uEe(t,o),c=await rEe(t,r,i,a,l,n,s);return vt(s),mEe(t,c,t.camera.fov,s)}function P5(t,e,r,i,n,s){let o;try{o=cEe(t,e)?e:M2(e,t.spatialReference)}catch{return null}const{center:a,distance:l}=uEe(t,o),c=_te(t,r,i,a,l,n);return c==null?null:fEe(t,c,t.camera.fov,s)}function dEe(t,e,r){const i=t.renderSpatialReference,n=new ke({spatialReference:yy(t)});if(!ag(r,i,n))return null;const s=Math.tan(e.fovX/2),o=Math.tan(e.fovY/2),a=D0(e.eye,r),l=2*a*s*Tq,c=2*a*o*Tq;return t.viewingMode==="global"?qCe(t,n,l,c):GCe(t,n,l,c)}function PQe(t,e,r){const i=t.pointsOfInterest.centerOnSurfaceFrequent.distance;if(Math.log(r/i)/Math.LN2>yQe)return!0;const n=t.renderSpatialReference,s=yy(t),o=new ke({spatialReference:s});if(!ag(e,n,o))return!1;const a=new ke({spatialReference:s});if(!ag(t.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,n,a))return!1;const l=Math.tan(.5*t.state.camera.fov)*i;return a.distance(o)/l>_Qe}function AQe(t,e,r,i,n,s){let o=0;return s===aa.ADJUST&&PQe(t,i,n)?(e=0,o=MQe(t,n,r,i)):o=vte(t,i,n,r),o=t.state.constraints.clampTilt(n,o),{heading:e,tilt:r=pEe(t,i,n,o)}}const A6=.7;function MQe(t,e,r,i){const n=vte(t,i,e,r);if(!t.state.constraints.tilt)return n;const s=t.state.constraints.tilt(e);s.max=Math.min(s.max,.5*Math.PI);const o=s.min*(1-A6)+s.max*A6;return Math.min(n,o)}function OQe(t,e,r,i){let n=vte(t,i,e,r);if(!t.state.constraints.tilt)return n;const s=t.state.constraints.tilt(e);return n=Math.min(n,.5*Math.PI),s.min*(1-A6)+n*A6}function pEe(t,e,r,i){return B3(t).lookAtTiltToEyeTilt(i,e,r)}function vte(t,e,r,i){return B3(t).eyeTiltToLookAtTilt(i,e,r)}function fEe(t,e,r,i){if(e==null)return null;const n=t.renderSpatialReference,s=new ke({spatialReference:yy(t)});return ag(e.eye,n,s)?(i??(i=new eu),i.position=s,i.heading=e.heading,i.tilt=e.tilt,i.fov=r,i):null}async function mEe(t,e,r,i){const n=t.renderSpatialReference,s=new ke({spatialReference:yy(t)});return await wCe(e.eye,n,s,{signal:i}),vt(i),new eu(s,e.heading,e.tilt,r)}function RQe(t,e){var i;const r=(i=t.basemapTerrain)==null?void 0:i.tilingScheme;if(r)return r.levelAtScale(e);XCe().error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")}function gEe(t,e){var i;const r=(i=t.basemapTerrain)==null?void 0:i.tilingScheme;if(r)return r.scaleAtLevel(e);XCe().error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")}function yEe(t,e){return ka(e.center,t.renderSpatialReference,Cce,lt.WGS84),l2(t,e.distance,Cce[1])}const bte=()=>re.getLogger("esri.layers.support.ElevationSampler");let _Ee=class{queryElevation(e){return vEe(e.clone(),this)}on(){return Zr()}projectIfRequired(e,r){return bEe(e,r)}},$Qe=class extends _Ee{get spatialReference(){return this.extent.spatialReference}constructor(e,r,i){super(),this.tile=e,this.noDataValue=i;const n=e.tile.extent;this.extent=a9(n,r.spatialReference),this.extent.zmin=e.zmin,this.extent.zmax=e.zmax,this._aaExtent=n;const s=Ba(r.spatialReference),o=r.lodAt(e.tile.level).resolution*s;this.demResolution={min:o,max:o}}contains(e){const r=this.projectIfRequired(e,this.spatialReference);return r!=null&&this.containsAt(r.x,r.y)}containsAt(e,r){return l9(this._aaExtent,e,r)}elevationAt(e,r){if(!this.containsAt(e,r)){const i=this.extent,n=`${i.xmin}, ${i.ymin}, ${i.xmax}, ${i.ymax}`;return bte().warn("#elevationAt()",`Point used to sample elevation (${e}, ${r}) is outside of the sampler extent (${n})`),this.noDataValue}return this.tile.sample(e,r)??this.noDataValue}},qkt=class extends _Ee{get spatialReference(){return this.extent.spatialReference}constructor(e,r,i){let n;super(),typeof r=="number"?(this.noDataValue=r,n=null):(n=r,this.noDataValue=i),this.samplers=n?e.map(o=>new $Qe(o,n,this.noDataValue)):e;const s=this.samplers[0];if(s){this.extent=s.extent.clone();const{min:o,max:a}=s.demResolution;this.demResolution={min:o,max:a};for(let l=1;l<this.samplers.length;l++){const c=this.samplers[l];this.extent.union(c.extent),this.demResolution.min=Math.min(this.demResolution.min,c.demResolution.min),this.demResolution.max=Math.max(this.demResolution.max,c.demResolution.max)}}else this.extent=a9(Wt(),n.spatialReference),this.demResolution={min:0,max:0}}elevationAt(e,r){let i,n=!1;for(const s of this.samplers)if(s.containsAt(e,r)&&(n=!0,i=s.elevationAt(e,r),i!==s.noDataValue))return i;return i??(n||bte().warn("#elevationAt()",`Point used to sample elevation (${e}, ${r}) is outside of the sampler`),this.noDataValue)}};function vEe(t,e){const r=bEe(t,e.spatialReference);if(!r)return null;switch(t.type){case"point":IQe(t,r,e);break;case"polyline":LQe(t,r,e);break;case"multipoint":DQe(t,r,e)}return t}function bEe(t,e){if(t==null)return null;const r=t.spatialReference;if(r.equals(e))return t;const i=PI(t,e);return i||bte().error(`Cannot project geometry spatial reference (wkid:${r.wkid}) to elevation sampler spatial reference (wkid:${e.wkid})`),i}function IQe(t,e,r){t.z=r.elevationAt(e.x,e.y)}function LQe(t,e,r){Cm.spatialReference=e.spatialReference;const i=t.hasM&&!t.hasZ;for(let n=0;n<t.paths.length;n++){const s=t.paths[n],o=e.paths[n];for(let a=0;a<s.length;a++){const l=s[a],c=o[a];Cm.x=c[0],Cm.y=c[1],i&&(l[3]=l[2]),l[2]=r.elevationAt(Cm.x,Cm.y)}}t.hasZ=!0}function DQe(t,e,r){Cm.spatialReference=e.spatialReference;const i=t.hasM&&!t.hasZ;for(let n=0;n<t.points.length;n++){const s=t.points[n],o=e.points[n];Cm.x=o[0],Cm.y=o[1],i&&(s[3]=s[2]),s[2]=r.elevationAt(Cm.x,Cm.y)}t.hasZ=!0}const Cm=new ke;var Sq;let Jf=Sq=class extends ze{constructor(t){super(t),this.cols=null,this.level=0,this.levelValue=null,this.origin=null,this.resolution=0,this.rows=null,this.scale=0}clone(){return new Sq({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}};d([m({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],Jf.prototype,"cols",void 0),d([m({type:fn,json:{write:!0}})],Jf.prototype,"level",void 0),d([m({type:String,json:{write:!0}})],Jf.prototype,"levelValue",void 0),d([m({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],Jf.prototype,"origin",void 0),d([m({type:Number,json:{write:!0}})],Jf.prototype,"resolution",void 0),d([m({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],Jf.prototype,"rows",void 0),d([m({type:Number,json:{write:!0}})],Jf.prototype,"scale",void 0),Jf=Sq=d([V("esri.layers.support.LOD")],Jf);const Pp=Jf;let NQe=class{constructor(e,r,i,n,s=void 0){this.id=e,this.level=r,this.row=i,this.col=n,this.extent=s}};var T_;const Ece=new yn({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});let _a=T_=class extends ze{static create(t={}){const{resolutionFactor:e=1,scales:r,size:i=256,spatialReference:n=lt.WebMercator,numLODs:s=24}=t;if(!$m(n)){const h=[];if(r)for(let p=0;p<r.length;p++){const f=r[p];h.push(new Pp({level:p,scale:f,resolution:f}))}else{let p=5e-4;for(let f=s-1;f>=0;f--)h.unshift(new Pp({level:f,scale:p,resolution:p})),p*=2}return new T_({dpi:96,lods:h,origin:new ke(0,0,n),size:[i,i],spatialReference:n})}const o=Xp(n),a=t.origin?new ke({x:t.origin.x,y:t.origin.y,spatialReference:n}):new ke(o?{x:o.origin[0],y:o.origin[1],spatialReference:n}:{x:0,y:0,spatialReference:n}),l=96,c=1/(Ba(n)*39.37*l),u=[];if(r)for(let h=0;h<r.length;h++){const p=r[h],f=p*c;u.push(new Pp({level:h,scale:p,resolution:f}))}else{let h=XK(n)?512/i*5916575275917094e-7:256/i*591657527591555e-6;const p=Math.ceil(s/e);u.push(new Pp({level:0,scale:h,resolution:h*c}));for(let f=1;f<p;f++){const g=h/2**e,_=g*c;u.push(new Pp({level:f,scale:g,resolution:_})),h=g}}return new T_({dpi:l,lods:u,origin:a,size:[i,i],spatialReference:n})}constructor(t){super(t),this.dpi=96,this.format=null,this.origin=null,this.size=null,this.spatialReference=null}get isWrappable(){const{spatialReference:t,origin:e}=this;if(t&&e){const r=Xp(t);return t.isWrappable&&!!r&&Math.abs(r.origin[0]-e.x)<=r.dx}return!1}readOrigin(t,e){return ke.fromJSON({spatialReference:e.spatialReference,...t})}set lods(t){let e=0,r=0;const i=[],n=this._levelToLOD={};t&&(e=-1/0,r=1/0,t.forEach(s=>{i.push(s.scale),e=s.scale>e?s.scale:e,r=s.scale<r?s.scale:r,n[s.level]=s})),this._set("scales",i),this._set("lods",t),this._initializeUpsampleLevels()}readSize(t,e){return[e.cols,e.rows]}writeSize(t,e){e.cols=t[0],e.rows=t[1]}zoomToScale(t){const e=this.scales;if(t<=0)return e[0];if(t>=e.length-1)return e[e.length-1];const r=Math.floor(t),i=r+1;return e[r]/(e[r]/e[i])**(t-r)}scaleToZoom(t){const e=this.scales,r=e.length-1;let i=0;for(;i<r;i++){const n=e[i],s=e[i+1];if(n<=t)return i;if(s===t)return i+1;if(n>t&&s<t)return i+Math.log(n/t)/Math.log(n/s)}return i}snapScale(t,e=.95){const r=this.scaleToZoom(t);return r%Math.floor(r)>=e?this.zoomToScale(Math.ceil(r)):this.zoomToScale(Math.floor(r))}tileAt(t,e,r,i){const n=this.lodAt(t);if(!n)return null;let s,o;if(typeof e=="number")s=e,o=r;else if(To(e.spatialReference,this.spatialReference))s=e.x,o=e.y,i=r;else{const c=PI(e,this.spatialReference);if(c==null)return null;s=c.x,o=c.y,i=r}const a=n.resolution*this.size[0],l=n.resolution*this.size[1];return i||(i=new NQe(null,0,0,0,Wt())),i.level=t,i.row=Math.floor((this.origin.y-o)/l+.001),i.col=Math.floor((s-this.origin.x)/a+.001),this.updateTileInfo(i),i}updateTileInfo(t,e=T_.ExtrapolateOptions.NONE){let r=this.lodAt(t.level);if(!r&&e===T_.ExtrapolateOptions.POWER_OF_TWO){const o=this.lods[this.lods.length-1];o.level<t.level&&(r=o)}if(!r)return;const i=t.level-r.level,n=r.resolution*this.size[0]/2**i,s=r.resolution*this.size[1]/2**i;t.id=`${t.level}/${t.row}/${t.col}`,t.extent||(t.extent=Wt()),t.extent[0]=this.origin.x+t.col*n,t.extent[1]=this.origin.y-(t.row+1)*s,t.extent[2]=t.extent[0]+n,t.extent[3]=t.extent[1]+s}upsampleTile(t){const e=this._upsampleLevels[t.level];return!(!e||e.parentLevel===-1)&&(t.level=e.parentLevel,t.row=Math.floor(t.row/e.factor+.001),t.col=Math.floor(t.col/e.factor+.001),this.updateTileInfo(t),!0)}getTileBounds(t,e){const r=this.lodAt(e.level);if(r==null)return null;const{resolution:i}=r,n=i*this.size[0],s=i*this.size[1];return t[0]=this.origin.x+e.col*n,t[1]=this.origin.y-(e.row+1)*s,t[2]=t[0]+n,t[3]=t[1]+s,t}lodAt(t){var e;return((e=this._levelToLOD)==null?void 0:e[t])??null}clone(){return T_.fromJSON(this.write({}))}getOrCreateCompatible(t,e){if(this.size[0]===256&&this.size[1]===256)return t===256?this:null;const r=[],i=this.lods.length;for(let n=0;n<i;n++){const s=this.lods[n],o=s.resolution*e;r.push(new Pp({level:s.level,scale:s.scale,resolution:o}))}return new T_({size:[t,t],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:r})}_initializeUpsampleLevels(){const t=this.lods;this._upsampleLevels=[];let e=null;for(let r=0;r<t.length;r++){const i=t[r];this._upsampleLevels[i.level]={parentLevel:e?e.level:-1,factor:e?e.resolution/i.resolution:0},e=i}}};d([m({type:Number,json:{write:!0}})],_a.prototype,"compressionQuality",void 0),d([m({type:Number,json:{write:!0}})],_a.prototype,"dpi",void 0),d([m({type:String,json:{read:Ece.read,write:Ece.write,origins:{"web-scene":{read:!1,write:!1}}}})],_a.prototype,"format",void 0),d([m({readOnly:!0})],_a.prototype,"isWrappable",null),d([m({type:ke,json:{write:!0}})],_a.prototype,"origin",void 0),d([Tr("origin")],_a.prototype,"readOrigin",null),d([m({type:[Pp],value:null,json:{write:!0}})],_a.prototype,"lods",null),d([m({readOnly:!0})],_a.prototype,"scales",void 0),d([m({cast:t=>Array.isArray(t)?t:typeof t=="number"?[t,t]:[256,256]})],_a.prototype,"size",void 0),d([Tr("size",["rows","cols"])],_a.prototype,"readSize",null),d([hr("size",{cols:{type:fn},rows:{type:fn}})],_a.prototype,"writeSize",null),d([m({type:lt,json:{write:!0}})],_a.prototype,"spatialReference",void 0),_a=T_=d([V("esri.layers.support.TileInfo")],_a),function(t){var e;(e=t.ExtrapolateOptions||(t.ExtrapolateOptions={}))[e.NONE=0]="NONE",e[e.POWER_OF_TWO=1]="POWER_OF_TWO"}(_a||(_a={}));const A5=_a,FQe=12;let Fc=class Nl{constructor(e){const r=Nl.checkUnsupported(e);if(r!=null)throw r;const i=e;this.spatialReference=i.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isGCS=dv(this.spatialReference)||Iv(this.spatialReference)||Lv(this.spatialReference),this.origin=[i.origin.x,i.origin.y],this.pixelSize=i.size[0],this.dpi=i.dpi;const n=i.lods.reduce((c,u,h)=>(u.level<c.min&&(c.min=u.level,c.minIndex=h),c.max=Math.max(c.max,u.level),c),{min:1/0,minIndex:0,max:-1/0}),s=i.lods[n.minIndex],o=2**s.level;let a=s.resolution*o,l=s.scale*o;this.levels=new Array(n.max+1);for(let c=0;c<this.levels.length;c++)this.levels[c]={resolution:a,scale:l,tileSize:[a*i.size[0],a*i.size[1]]},a/=2,l/=2}clone(){return new Nl(this.toTileInfo())}toTileInfo(){return new A5({dpi:this.dpi,origin:new ke({x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference}),size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((e,r)=>new Pp({level:r,scale:e.scale,resolution:e.resolution}))})}getExtent(e,r,i,n){const s=this.levels[e],o=s.tileSize[0],a=s.tileSize[1];n[0]=this.origin[0]+i*o,n[2]=this.origin[0]+(i+1)*o,n[3]=this.origin[1]-r*a,n[1]=this.origin[1]-(r+1)*a}convertExtentToRadians(e,r){this._isWebMercator?(r[0]=vae(e[0]),r[1]=Qk(e[1]),r[2]=vae(e[2]),r[3]=Qk(e[3])):this._isGCS&&(r[0]=Nt(e[0]),r[1]=Nt(e[1]),r[2]=Nt(e[2]),r[3]=Nt(e[3]))}getExtentGeometry(e,r,i,n=new ei){return this.getExtent(e,r,i,Pf),n.spatialReference=this.spatialReference,n.xmin=Pf[0],n.ymin=Pf[1],n.xmax=Pf[2],n.ymax=Pf[3],n.zmin=void 0,n.zmax=void 0,n}ensureMaxLod(e){if(e==null)return!1;let r=!1;for(;this.levels.length<=e;){const i=this.levels[this.levels.length-1],n=i.resolution/2;this.levels.push({resolution:n,scale:i.scale/2,tileSize:[n*this.pixelSize,n*this.pixelSize]}),r=!0}return r}capMaxLod(e){this.levels.length>e+1&&(this.levels.length=e+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(e){return this.levels[0].scale/2**e}levelAtScale(e){const r=this.levels[0].scale;return e>=r?0:Math.log(r/e)*Math.LOG2E}resolutionAtLevel(e){return this.levels[0].resolution/2**e}compatibleWith(e){if(!(e instanceof Nl)){if(Nl.checkUnsupported(e))return!1;e=new Nl(e)}if(!e.spatialReference.equals(this.spatialReference)||e.pixelSize!==this.pixelSize)return!1;const r=Math.min(this.levels.length,e.levels.length)-1,i=this.levels[r].resolution;let n=.5*i;return!U1(e.origin[0],this.origin[0],n)||!U1(e.origin[1],this.origin[1],n)?!1:(n=.5*i/2**r/this.pixelSize*FQe,U1(i,e.levels[r].resolution,n))}rootTilesInExtent(e,r=null,i=1/0){const n=new Array,s=this.levels[0].tileSize;if(e==null||s[0]===0||s[1]===0)return n;Nl.computeRowColExtent(e,s,this.origin,Pf);let o=Pf[1],a=Pf[3],l=Pf[0],c=Pf[2];const u=c-l,h=a-o;if(u*h>i){const p=Math.floor(Math.sqrt(i));h>p&&(o=o+Math.floor(.5*h)-Math.floor(.5*p),a=o+p),u>p&&(l=l+Math.floor(.5*u)-Math.floor(.5*p),c=l+p)}for(let p=o;p<a;p++)for(let f=l;f<c;f++)n.push([0,p,f]);return r!=null&&(r[0]=this.origin[0]+l*s[0],r[1]=this.origin[1]-a*s[1],r[2]=this.origin[0]+c*s[0],r[3]=this.origin[1]-o*s[1]),n}static computeRowColExtent(e,r,i,n){const s=.001*(e[2]-e[0]+(e[3]-e[1]));n[0]=Math.max(0,Math.floor((e[0]+s-i[0])/r[0])),n[2]=Math.max(0,Math.ceil((e[2]-s-i[0])/r[0])),n[1]=Math.max(0,Math.floor((i[1]-e[3]+s)/r[1])),n[3]=Math.max(0,Math.ceil((i[1]-e[1]-s)/r[1]))}static isPowerOfTwo(e){const r=e.lods,i=r[0].resolution*2**r[0].level;return!r.some(n=>!I7e(n.resolution,i/2**n.level))}static hasGapInLevels(e){const r=e.lods.map(i=>i.level);r.sort((i,n)=>i-n);for(let i=1;i<r.length;i++)if(r[i]!==r[0]+i)return!0;return!1}static tileSizeSupported(e){const r=e.size[1];return r===e.size[0]&&(r&r-1)==0&&r>=128&&r<=512}static hasOriginPerLODs(e){const r=e.origin;return e.lods.some(i=>i.origin!=null&&(i.origin[0]!==r.x||i.origin[1]!==r.y))}static getMissingTileInfoError(){return new K("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(e){return e==null?wte():e.lods.length<1?new K("tilingscheme:generic","Tiling scheme must have at least one level"):Nl.isPowerOfTwo(e)?Nl.hasGapInLevels(e)?new K("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):Nl.tileSizeSupported(e)?Nl.hasOriginPerLODs(e)?new K("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new K("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new K("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(e,r){const i=e[2]-e[0],n=e[3]-e[1],s=Ba(r),o=1.2*Math.max(i,n),a=256,l=96,c=.0254,u=new Nl(new A5({size:[a,a],origin:new ke({x:e[0]-.5*(o-i),y:e[3]+.5*(o-n)}),lods:[new Pp({level:0,resolution:o/a,scale:1/(a/l*c/(o*s))})],spatialReference:r}));return u.ensureMaxLod(20),u}static makeWebMercatorAuxiliarySphere(e){const r=new Nl(Nl.WebMercatorAuxiliarySphereTileInfo);return r.ensureMaxLod(e),r}static makeGCSWithTileSize(e,r=256,i=16){const n=256/r,s=new Nl(new A5({size:[r,r],origin:new ke({x:-180,y:90,spatialReference:e}),spatialReference:e,lods:[new Pp({level:0,resolution:.703125*n,scale:295497598570834e-6*n})]}));return s.ensureMaxLod(i),s}get test(){return{isWebMercator:this._isWebMercator,isGCS:this._isGCS}}};function wte(){return new K("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}Fc.WebMercatorAuxiliarySphereTileInfo=new A5({size:[256,256],origin:new ke({x:-20037508342787e-6,y:20037508342787e-6,spatialReference:lt.WebMercator}),spatialReference:lt.WebMercator,lods:[new Pp({level:0,resolution:156543.03392800014,scale:591657527591555e-6})]}),Fc.WebMercatorAuxiliarySphere=Fc.makeWebMercatorAuxiliarySphere(19);const Pf=Wt(),oC=64,HA=512,kQe=2.5,A$=L7e(IW/10),wEe=2,xEe=Wt();Fc.WebMercatorAuxiliarySphere.getExtent(0,0,0,xEe);const zQe=Wt([-180,-90,180,90]),UQe="Cannot extend surface to encompass all layers because it would result in too many root tiles.",BQe="Surface extent is too large for tile resolution at level 0.",VQe=3;let GQe=VQe;function Cq(t){return t<4?3:GQe}const Ps=4;let S_=class extends Qn.EventedAccessor{constructor(e){super(e),this.demResolution={min:-1,max:-1},this.noDataValue=A$}initialize(){this.view.basemapTerrain.on("elevation-change",()=>this.emit("changed",{}))}get extent(){const e=this.view.basemapTerrain;if((e==null?void 0:e.extent)==null||e.spatialReference==null)return null;const r=a9(e.extent,e.spatialReference);return r.zmin=e.visibleElevationBounds.min,r.zmax=e.visibleElevationBounds.max,r}get spatialReference(){var e;return((e=this.view.basemapTerrain)==null?void 0:e.spatialReference)??lt.WGS84}elevationAt(e,r){var i;if(this.extent==null||!al(this.extent,e,r)){const n=this.extent!=null?`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:null;return re.getLogger(this).warn("#elevationAt()",`Point used to sample elevation (${e}, ${r}) is outside of the sampler extent (${n})`),this.noDataValue}return((i=this.view.elevationProvider)==null?void 0:i.getElevation(e,r,0,this.spatialReference,"ground"))??this.noDataValue}queryElevation(e){return vEe(e.clone(),this)}};d([m({readOnly:!0})],S_.prototype,"demResolution",void 0),d([m({readOnly:!0})],S_.prototype,"extent",null),d([m({readOnly:!0})],S_.prototype,"noDataValue",void 0),d([m()],S_.prototype,"spatialReference",null),d([m({constructOnly:!0})],S_.prototype,"view",void 0),S_=d([V("esri.views.support.GroundViewElevationSampler")],S_);const jQe=S_;let Xg=class extends Ae{constructor(e){super(e),this.view=null,this.layerViews=new $t}initialize(){this.addHandles(fd(()=>{var e,r;return(r=(e=this.view)==null?void 0:e.map)==null?void 0:r.ground},e=>e.load())),this.addHandles(this.layerViews.on("after-changes",()=>this._layerViewsAfterChangesHandler()))}destroy(){this._set("view",null);for(const e of this.layerViews)e.destroy();this.layerViews.length=0}get elevationSampler(){return this.view?this.view.type==="2d"?null:this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new jQe({view:this.view}):null:null}get extent(){const e=this.view;return e&&e.type!=="2d"&&e.ready?dEe(e,e.state.camera,e.pointsOfInterest.centerOnSurfaceFrequent.renderLocation):null}get updating(){return!this.suspended&&this.layerViews.some(e=>e.updating)}get suspended(){return!this.view||this.view.suspended}_layerViewsAfterChangesHandler(){this.removeHandles("updating"),this.addHandles(this.layerViews.map(e=>he(()=>e.updating,()=>this._updateUpdating(),Qr)).toArray(),"updating"),this._updateUpdating()}_updateUpdating(){this.notifyChange("updating")}};d([m({readOnly:!0})],Xg.prototype,"elevationSampler",null),d([m({readOnly:!0})],Xg.prototype,"extent",null),d([m({type:Boolean,readOnly:!0})],Xg.prototype,"updating",null),d([m({constructOnly:!0})],Xg.prototype,"view",void 0),d([m({type:$t,readOnly:!0})],Xg.prototype,"layerViews",void 0),d([m({readOnly:!0})],Xg.prototype,"suspended",null),Xg=d([V("esri.views.GroundView")],Xg);const HQe=Xg;let ny=class{constructor(e,r){this._owner=r,this._properties={},this._afterDispatchHandle=null;for(const i in e){const n=e[i],s=new Lbe(n,void 0,void 0,2,2);this._properties[i]={pool:s,acquired:[]}}this._afterDispatchHandle=qbe(()=>this._release())}destroy(){this._afterDispatchHandle&&(this._afterDispatchHandle.remove(),this._afterDispatchHandle=null);for(const e in this._properties){const r=this._properties[e];for(const i of r.acquired)Qoe(i)||r.pool.release(i);r.pool.destroy(),r.pool=null,r.acquired=null}this._properties=null,this._owner=null}get(e){const r=this._owner._get(e),i=this._properties[e];let n=i.pool.acquire();for(i.acquired.push(n);n===r;)i.acquired.push(n),n=i.pool.acquire();return n}_release(){for(const e in this._properties){const r=this._properties[e];let i=0;for(const n of r.acquired)Qoe(n)?r.acquired[i++]=n:r.pool.release(n);r.acquired.length=i}}};const WQe=se("mac")?"Meta":"Ctrl",qQe=new Set(["Alt","Ctrl","Meta","Shift","Primary"]),YQe=t=>qQe.has(t);let XQe=class{constructor(e,r=[]){this.eventType=e,this.keyModifiers=r}matches(e){if(e.type!==this.eventType)return!1;if(this.keyModifiers.length===0)return!0;const r=e.modifiers;for(const i of this.keyModifiers)if(!r.has(i))return!1;return!0}};const Pce=()=>re.getLogger("esri.views.input.InputHandler");let qo=class{constructor(e){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=e}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const e in this._incoming){const r=this._incoming[e];for(const i of r)this._incomingEventMatches.push(i.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map(e=>e.eventType)),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(e){this._manager?Pce().error("This InputHandler has already been registered with an InputManager"):(e.setEventCallback(r=>this._handleEvent(r)),e.setUninstallCallback(()=>this._onUninstall()),this._manager=e)}onUninstall(){}registerIncoming(e,r,i){let n;typeof r=="function"?(i=r,n=[]):n=r||[];const s=typeof e=="string"?new XQe(e,n):e,o=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},a=u=>{const h=this._incoming[u.match.eventType];if(h){const p=h.indexOf(u);h.splice(p,1),o(),this._manager&&this._manager.updateDependencies()}},l=new ZQe(s,i,{onPause:a,onRemove:a,onResume:u=>{const h=this._incoming[u.match.eventType];h&&!h.includes(u)&&(h.push(u),o(),this._manager&&this._manager.updateDependencies())}});let c=this._incoming[s.eventType];return c||(c=[],this._incoming[s.eventType]=c),c.push(l),o(),this._manager&&this._manager.updateDependencies(),l}registerOutgoing(e){if(this._outgoing[e])throw new Error("There is already a callback registered for this outgoing InputEvent: "+e);const r=new JQe(e,{onEmit:(i,n,s,o)=>{var a;(a=this._manager)==null||a.emit(i.eventType,n,s,o)},onRemove:i=>{var n;delete this._outgoing[i.eventType],(n=this._manager)==null||n.updateDependencies()}});return this._outgoing[e]=r,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),r}startCapturingPointer(e){var r;(r=this._manager)==null||r.setPointerCapture(e,!0)}stopCapturingPointer(e){var r;(r=this._manager)==null||r.setPointerCapture(e,!1)}refreshHasPendingInputs(){var e;(e=this._manager)==null||e.refreshHasPendingInputs()}_onUninstall(){this._manager?(this.onUninstall(),this._manager=null):Pce().error("This InputHandler is not registered with an InputManager")}_handleEvent(e){var i;const r=this._incoming[e.type];if(r){for(const n of r)if(n.match.matches(e)&&((i=n.callback)==null||i.call(n,e),e.shouldStopPropagation()))break}}},ZQe=class{constructor(e,r,i){this.match=e,this._callback=r,this._handler=i}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}},JQe=class{constructor(e,r){this.eventType=e,this._removed=!1,this._handler=r}emit(e,r,i){this._removed||this._handler.onEmit(this,e,r,i)}remove(){this._removed=!0,this._handler.onRemove(this)}},QQe=class extends qo{constructor(e){super(!0),this._onChange=e,this._value="mouse",this._x=null,this._y=null,this.registerIncoming("pointer-move",r=>{this._update(r.data)})}_update(e){const r=e.native.pointerType==="touch"?"touch":"mouse",{x:i,y:n}=e;r===this._value&&this._x===i&&this._y===n||(this._value=r,this._x=i,this._y=n,this._onChange(r,i,n))}},KQe=class{constructor(e,r){this._observable=new EI,this._value=e,this._equalityFunction=r}get value(){return Lt(this._observable),this._value}set value(e){this._equalityFunction(e,this._value)||(this._value=e,this._observable.notify())}mutate(e){e(this._value),this._observable.notify()}};function Wm(t,e=mbe){return new KQe(t,e)}let eKe=class extends qo{get multiTouchActive(){return this._multiTouchActive.value}constructor(){super(!0),this._activeTouchPointerIds=new Set,this._multiTouchActive=Wm(!1),this._onPointerAdd=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.add(e.native.pointerId),this._update())},this._onPointerRemove=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.delete(e.native.pointerId),this._update())},this.registerIncoming("pointer-down",this._onPointerAdd),this.registerIncoming("pointer-up",this._onPointerRemove),this.registerIncoming("pointer-capture-lost",this._onPointerRemove),this.registerIncoming("pointer-cancel",this._onPointerRemove)}_update(){this._multiTouchActive.value=this._activeTouchPointerIds.size>1}},_h=class extends Ae{constructor(e){super(e),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._handlersPriority=[],this._currentPropagation=null,this._updateDependenciesAfterPropagation=!1,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=WQe,this._latestPointerType="mouse",this._propertiesPool=new ny({latestPointerLocation:iKe},this),this.latestPointerLocation=null,this._paused=!1,this.test={timestamp:void 0,hasCurrentPropagation:()=>!!this._currentPropagation}}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const e=Object.keys(this._nameToGroup);for(const r of e)this.uninstallHandlers(r);this.eventSource.destroy(),this._currentPropagation=null,this._propertiesPool.destroy()}get hasPendingInputs(){return this._handlers.some(e=>e.handler.hasPendingInputs)}get latestPointerType(){return this._latestPointerType}get multiTouchActive(){return this._multiTouchHandler.multiTouchActive}get updating(){return this.hasPendingInputs||this._paused}installHandlers(e,r,i=j1.INTERNAL){if(this._nameToGroup[e])return void re.getLogger(this).error("There is already an InputHandler group registered under the name `"+e+"`");if(r.length===0)return void re.getLogger(this).error("Can't register a group of zero handlers");const n={name:e,handlers:r.map(s=>({handler:s,active:!0,removed:!1,priorityIndex:0,groupPriority:i,eventCallback:null,uninstallCallback:null}))};this._nameToGroup[e]=n;for(let s=n.handlers.length-1;s>=0;s--){const o=n.handlers[s];this._handlers.push(o),o.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(a,l,c,u,h)=>{this._emitInputEvent(o.priorityIndex+1,a,l,c,h,u)},setPointerCapture:(a,l)=>{this._setPointerCapture(n,o,a,l)},setEventCallback:a=>{o.eventCallback=a},setUninstallCallback:a=>{o.uninstallCallback=a},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers(e){const r=this._nameToGroup[e];r?(r.handlers.forEach(i=>{var n;i.removed=!0,(n=i.uninstallCallback)==null||n.call(i)}),delete this._nameToGroup[e],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):re.getLogger(this).error("There is no InputHandler group registered under the name `"+e+"`")}hasHandlers(e){return this._nameToGroup[e]!==void 0}isModifierKeyDown(e){return this._activeKeyModifiers&&this._activeKeyModifiers.has(e)}updateDependencies(){if(this._currentPropagation)return void(this._updateDependenciesAfterPropagation=!0);this._updateDependenciesAfterPropagation=!1;const e=new Set,r=new Set;this._handlersPriority=[];for(let i=this._handlers.length-1;i>=0;i--){const n=this._handlers[i];n.priorityIndex=i,this._handlersPriority.push(n)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let i=this._handlersPriority.length-1;i>=0;i--){const n=this._handlersPriority[i];n.priorityIndex=i;let s=n.handler.hasSideEffects;if(!s){for(const o of n.handler.outgoingEventTypes)if(e.has(o)){s=!0;break}}if(s)for(const o of n.handler.incomingEventMatches){e.add(o.eventType);for(const a of o.keyModifiers)YQe(a)||r.add(a)}n.active=s}this._sourceEvents=e,this._keyModifiers=r,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointer(e,r,i){this._latestPointerType=e;const n=this._get("latestPointerLocation");if(n==null||n.x!==r||n.y!==i){const s=this._propertiesPool.get("latestPointerLocation");s.x=r,s.y=i,this._set("latestPointerLocation",s)}}_onEventReceived(e,r){if(e==="pointer-capture-lost"){const s=r;this._pointerCaptures.delete(s.native.pointerId)}this._updateKeyModifiers(e,r);const i=this.test.timestamp!=null?this.test.timestamp:r.native?r.native.timestamp:void 0,n=r.native?r.native.cancelable:void 0;this._emitInputEventFromSource(e,r,i,n)}_updateKeyModifiers(e,r){if(!r)return;let i=!1;const n=()=>{if(!i){const a=new Set;this._activeKeyModifiers.forEach(l=>{a.add(l)}),this._activeKeyModifiers=a,i=!0}},s=(a,l)=>{l&&!this._activeKeyModifiers.has(a)?(n(),this._activeKeyModifiers.add(a)):!l&&this._activeKeyModifiers.has(a)&&(n(),this._activeKeyModifiers.delete(a))};if(e==="key-down"||e==="key-up"){const a=r.key;this._keyModifiers.has(a)&&s(a,e==="key-down")}const o=r.native;s("Alt",!(!o||!o.altKey)),s("Ctrl",!(!o||!o.ctrlKey)),s("Shift",!(!o||!o.shiftKey)),s("Meta",!(!o||!o.metaKey)),s("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerHandler=new QQe((e,r,i)=>this._setLatestPointer(e,r,i)),this._multiTouchHandler=new eKe,this.installHandlers("input-manager-logic",[this._latestPointerHandler,this._multiTouchHandler],j1.ALWAYS),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,j1.INTERNAL)}_setPointerCapture(e,r,i,n){const s=e.name+"-"+r.priorityIndex,o=this._pointerCaptures.get(i.pointerId)||new Set;this._pointerCaptures.set(i.pointerId,o),n?(o.add(s),o.size===1&&this.eventSource&&this.eventSource.setPointerCapture(i,!0)):o.has(s)&&(o.delete(s),o.size===0&&(this._pointerCaptures.delete(i.pointerId),this.eventSource&&this.eventSource.setPointerCapture(i,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter(e=>!e.removed),this.updateDependencies()}_emitInputEventFromSource(e,r,i,n){this._emitInputEvent(0,e,r,i,n)}_emitInputEvent(e,r,i,n,s,o){const a=n!==void 0?n:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),l=s!==void 0&&s,c={event:new tKe(r,i,a,o||this._activeKeyModifiers,l),priorityIndex:e};this._currentPropagation?this._currentPropagation.events.push(c):this._doNewPropagation(c)}_doNewPropagation(e){this._currentPropagation={events:new l6,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:e.event.timestamp},this._currentPropagation.events.push(e),this._continuePropagation()}_continuePropagation(){var r,i,n;this._paused=!1;const e=this._currentPropagation;if(e){for(;e.events.length>0;){const{event:s,priorityIndex:o}=e.events.pop(),a=(r=s.data)==null?void 0:r.eventId;if(!(a!=null&&this._stoppedPropagationEventIds.has(a)))for(e.currentHandler=this._handlersPriority[o];e.currentHandler;){if(e.currentHandler.removed)e.needsHandlerGarbageCollect=!0;else{if(e.currentHandler.active&&!s.shouldStopPropagation()&&((n=(i=e.currentHandler).eventCallback)==null||n.call(i,s)),s.shouldStopPropagation()){a!=null&&this._stoppedPropagationEventIds.add(a);break}if(s.shouldPausePropagation(()=>this._continuePropagation()))return void this._pausePropagation({event:s,priorityIndex:e.currentHandler.priorityIndex+1})}e.currentHandler=this._handlersPriority[e.currentHandler.priorityIndex+1]}}e.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null,this._updateDependenciesAfterPropagation&&this.updateDependencies()}}_pausePropagation(e){const r=new l6;r.push(e);const i=this._currentPropagation;if(i){for(;i.events.length;)r.push(i.events.pop());i.events=r,i.currentHandler=null,this._paused=!0}}_compareHandlerPriority(e,r){if(e.handler.hasSideEffects!==r.handler.hasSideEffects)return e.handler.hasSideEffects?1:-1;if(e.groupPriority!==r.groupPriority)return e.groupPriority>r.groupPriority?-1:1;for(const i of e.handler.incomingEventMatches)for(const n of r.handler.incomingEventMatches){if(i.eventType!==n.eventType)continue;const s=i.keyModifiers.filter(o=>n.keyModifiers.includes(o));if(s.length===i.keyModifiers.length!=(s.length===n.keyModifiers.length))return i.keyModifiers.length>n.keyModifiers.length?-1:1}return e.priorityIndex>r.priorityIndex?-1:1}_sortHandlersPriority(e){const r=[];for(const i of e){let n=0;for(;n<r.length&&this._compareHandlerPriority(i,r[n])>=0;)n++;r.splice(n,0,i)}return r}get debug(){const e=r=>{const i=this._setPointerCapture;this._setPointerCapture=()=>{},r(),this._setPointerCapture=i};return{injectEvent:(r,i)=>{e(()=>{this._onEventReceived(r,i)})},disablePointerCapture:e}}};d([m({readOnly:!0})],_h.prototype,"hasPendingInputs",null),d([m({constructOnly:!0})],_h.prototype,"eventSource",void 0),d([m({constructOnly:!0})],_h.prototype,"recognizers",void 0),d([m()],_h.prototype,"_latestPointerType",void 0),d([m()],_h.prototype,"latestPointerType",null),d([m()],_h.prototype,"multiTouchActive",null),d([m({readOnly:!0})],_h.prototype,"latestPointerLocation",void 0),d([m()],_h.prototype,"_paused",void 0),d([m({readOnly:!0})],_h.prototype,"updating",null),_h=d([V("esri.views.input.InputManager")],_h);let tKe=class{constructor(e,r,i,n,s){this.type=e,this.data=r,this.timestamp=i,this.modifiers=n,this.cancelable=s,this._propagationState=K_.NONE,this._resumeCallback=null}stopPropagation(){this._propagationState|=K_.STOPPED}shouldStopPropagation(){return(this._propagationState&K_.STOPPED)!=0}async(e){this._propagationState|=K_.PAUSED;const r=(i,n)=>{this._propagationState&=~K_.PAUSED;const s=this._resumeCallback;if(this._resumeCallback=null,s&&s(),n)throw i;return i};return(typeof e=="function"?e():e).then(i=>r(i,!1),i=>r(i,!0))}shouldPausePropagation(e){return!!(this._propagationState&K_.PAUSED)&&(this._resumeCallback=e,!0)}preventDefault(){this.data.native.preventDefault()}};var K_;(function(t){t[t.NONE=0]="NONE",t[t.STOPPED=1]="STOPPED",t[t.PAUSED=2]="PAUSED"})(K_||(K_={}));const j1={ALWAYS:1,DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3};let rKe=class{};const iKe=rKe;function Af(t){return t!=null&&"open"in t&&"declaredClass"in t}function Ace(t){return t!=null&&"declaredClass"in t&&"dockOptions"in t}const nKe=t=>{let e=class extends t{constructor(){super(...arguments),this._popupSetupTask=null,this.popup={},this.popupEnabled=!0}initialize(){this.addHandles([he(()=>[this.ui,this.popup],([r,i],n)=>{const s="popup",o="manual";if(n){const[a,l]=n;a&&Af(l)&&(l.view=null,Ace(l)&&a.remove(l,s))}r&&Af(i)&&(i.view=this,Ace(i)&&r.add(i,{key:s,position:o,internal:!0}))},gi),this.on("click",r=>{this.popup&&this.popupEnabled&&(r.pointerType!=="mouse"||r.button===0)&&(!Af(this.popup)&&"autoOpenEnabled"in this.popup&&this.popup.autoOpenEnabled===!1||(Af(this.popup)?this.popup.viewModel.handleViewClick(r):r.async(async()=>{await this.setupPopup(),Af(this.popup)&&!this.destroyed&&this.ready&&this.popupEnabled&&this.popup.viewModel.handleViewClick(r)})))},j1.WIDGET)]),UE(()=>this.ready&&this.popupEnabled&&!this.updating).then(()=>{ge(()=>import("./Popup-pcxysF_X.js"),__vite__mapDeps([85,1,86,87,88,22,89,90,58,40,38,21,91,49,47,48,50,92,93,94,95,3,96,97,98,7,99,100,101,102,103,104,9,105,106,107,108,109,110,111,112,8,113,10,11,114,115,116,117,118,119,120,16,121,122,123]))})}destroy(){this.destroyed||this.closePopup()}async openPopup(r){if(Af(this.popup))return this.popup.open(r);try{if(await this.setupPopup(),!this.popup)return void re.getLogger(this).error(new K("view:null-popup","Popup is null and can't be opened"));this.popup.open(r)}catch{}}closePopup(){var r;(r=this._popupSetupTask)==null||r.abort(),Af(this.popup)&&this.popup.close()}async fetchPopupFeatures(r,i){return await this.when(),this._popupHitsToFeatures(await this._getPopupHits(r,i),i)}async setupPopup(){var r;if((r=this._popupSetupTask)==null||r.abort(),this.popup&&!Af(this.popup))return this._popupSetupTask=dy(async i=>{const{default:n}=await ge(()=>import("./Popup-pcxysF_X.js"),__vite__mapDeps([85,1,86,87,88,22,89,90,58,40,38,21,91,49,47,48,50,92,93,94,95,3,96,97,98,7,99,100,101,102,103,104,9,105,106,107,108,109,110,111,112,8,113,10,11,114,115,116,117,118,119,120,16,121,122,123]));if(vt(i),!this.popup||Af(this.popup))return;const s=this.popup;delete s.open,delete s.close,this.popup=new n(s)}),this._popupSetupTask.promise}async _popupHitsToFeatures({location:r,hits:i},n){const s=[],o=[];let a=!1;const l=a9e(n,se("popup-view-fetch-timeout")??oKe),c=p=>{const f=new sKe(p);return o.push(f),s.push(f.promise),f},u=p=>{const f=o.at(-1);return f&&f.layerView===p&&!a?f:c(p)};for(const p of i)"graphic"in p?(u(p.layerView).graphics.push(p.graphic),a=!1):(s.push(p.layerView.fetchPopupFeaturesAtLocation(p.mapPoint,l)),a=!0);o.map(p=>p.resolve(l));const h=$k(s).then(p=>p.filter(f=>!!f).flat());return{pendingFeatures:s,allGraphicsPromise:h,location:r}}async _getPopupHits(r,i){const{hits:n,location:s}=await this.popupHitTest(r);vt(i);const o=[];for(const a of n)if("graphic"in a){if(this._isValidPopupGraphic(a.graphic,i)){const l=this._isValidPopupGraphicsLayerView(a.layerView)?a.layerView:void 0;o.push({graphic:a.graphic,layerView:l})}}else this._isValidPopupLocationLayerView(a.layerView)&&o.push({mapPoint:a.mapPoint,layerView:a.layerView});return{hits:o,location:s}}_isValidPopupGraphic(r,i){return r&&!!r.getEffectivePopupTemplate(i!=null&&i.defaultPopupTemplateEnabled)}_isValidPopupGraphicsLayerView(r){return!r||(!("layer"in r)||!r.suspended)&&"fetchPopupFeaturesFromGraphics"in r}_isValidPopupLocationLayerView(r){return(!("layer"in r)||!r.suspended)&&"fetchPopupFeaturesAtLocation"in r}};return d([m({cast(r){return!r||Af(r)||typeof r=="object"&&(r.open=i=>(ev(re.getLogger(this),"view.popup is no longer created by default. view.popup.open() will stop working when the popup isn't created",{replacement:"Use view.openPopup() instead.",version:"4.27"}),this.openPopup(i)),r.close=()=>(ev(re.getLogger(this),"view.popup is no longer created by default. view.popup.close() will stop working when the popup isn't created",{replacement:"Use view.closePopup() instead.",version:"4.27"}),this.closePopup())),r}})],e.prototype,"popup",void 0),d([m()],e.prototype,"popupEnabled",void 0),e=d([V("esri.views.PopupView")],e),e};let sKe=class{constructor(e){this.layerView=e,this._resolver=ha(),this.graphics=[]}get promise(){return this._resolver.promise}resolve(e){const{layerView:r,graphics:i,_resolver:n}=this;if(!r)return n.resolve(i),n.promise;let s;return r.fetchPopupFeaturesFromGraphics(i,e).catch(o=>(s=o,null)).then(o=>{o?n.resolve(o):n.reject(s)}),n.promise}};const oKe=5e3,Mce={milliseconds:1,seconds:1e3,minutes:6e4,hours:36e5,days:864e5,weeks:6048e5,months:26784e5,years:31536e6,decades:31536e7,centuries:31536e8};function bV(t,e,r,i=og){const n=new af(Lee(i)),s=er.fromJSDate(t,{zone:n}),o=r==="decades"||r==="centuries"?"year":TEe(r);return r==="decades"&&(e*=10),r==="centuries"&&(e*=100),s.plus({[o]:e}).toJSDate()}function Oce(t,e,r=og){const i=new af(Lee(r)),n=er.fromJSDate(t,{zone:i});if(e==="decades"||e==="centuries"){const o=n.startOf("year"),{year:a}=o,l=a-a%(e==="decades"?10:100);return o.set({year:l}).toJSDate()}const s=TEe(e);return n.startOf(s).toJSDate()}function u6t(t,e,r){return t===0?0:t*Mce[e]/Mce[r]}function h6t(t,e){return t&&e?t.intersection(e):t||e}function TEe(t){switch(t){case"milliseconds":return"millisecond";case"seconds":return"second";case"minutes":return"minute";case"hours":return"hour";case"days":return"day";case"weeks":return"week";case"months":return"month";case"years":return"year"}}var Xd;let Eu=Xd=class extends ze{static get allTime(){return Rce}static get empty(){return aKe}constructor(t){super(t),this.end=null,this.start=null}readEnd(t,e){return e.end!=null?new Date(e.end):null}writeEnd(t,e){e.end=(t==null?void 0:t.getTime())??null}get isAllTime(){return this.equals(Xd.allTime)}get isEmpty(){return this.equals(Xd.empty)}readStart(t,e){return e.start!=null?new Date(e.start):null}writeStart(t,e){e.start=(t==null?void 0:t.getTime())??null}clone(){return new Xd({end:this.end,start:this.start})}equals(t){var s,o,a,l;if(!t)return!1;const e=((s=this.start)==null?void 0:s.getTime())??this.start,r=((o=this.end)==null?void 0:o.getTime())??this.end,i=((a=t.start)==null?void 0:a.getTime())??t.start,n=((l=t.end)==null?void 0:l.getTime())??t.end;return e===i&&r===n}expandTo(t,e=og){if(this.isEmpty||this.isAllTime)return this.clone();let r=this.start;r&&(r=Oce(r,t,e));let i=this.end;if(i){const n=Oce(i,t,e);i=i.getTime()===n.getTime()?n:bV(n,1,t,e)}return new Xd({start:r,end:i})}intersection(t){var a,l,c,u;if(!t)return this.clone();if(this.isEmpty||t.isEmpty)return Xd.empty;if(this.isAllTime)return t.clone();if(t.isAllTime)return this.clone();const e=((a=this.start)==null?void 0:a.getTime())??-1/0,r=((l=this.end)==null?void 0:l.getTime())??1/0,i=((c=t.start)==null?void 0:c.getTime())??-1/0,n=((u=t.end)==null?void 0:u.getTime())??1/0;let s,o;if(i>=e&&i<=r?s=i:e>=i&&e<=n&&(s=e),r>=i&&r<=n?o=r:n>=e&&n<=r&&(o=n),s!=null&&o!=null&&!isNaN(s)&&!isNaN(o)){const h=new Xd;return h.start=s===-1/0?null:new Date(s),h.end=o===1/0?null:new Date(o),h}return Xd.empty}offset(t,e,r=og){if(this.isEmpty||this.isAllTime)return this.clone();const i=new Xd,{start:n,end:s}=this;return n!=null&&(i.start=bV(n,t,e,r)),s!=null&&(i.end=bV(s,t,e,r)),i}union(t){if(!t||t.isEmpty)return this.clone();if(this.isEmpty)return t.clone();if(this.isAllTime||t.isAllTime)return Rce.clone();const e=this.start!=null&&t.start!=null?new Date(Math.min(this.start.getTime(),t.start.getTime())):null,r=this.end!=null&&t.end!=null?new Date(Math.max(this.end.getTime(),t.end.getTime())):null;return new Xd({start:e,end:r})}};d([m({type:Date,json:{write:{allowNull:!0}}})],Eu.prototype,"end",void 0),d([Tr("end")],Eu.prototype,"readEnd",null),d([hr("end")],Eu.prototype,"writeEnd",null),d([m({readOnly:!0,json:{read:!1}})],Eu.prototype,"isAllTime",null),d([m({readOnly:!0,json:{read:!1}})],Eu.prototype,"isEmpty",null),d([m({type:Date,json:{write:{allowNull:!0}}})],Eu.prototype,"start",void 0),d([Tr("start")],Eu.prototype,"readStart",null),d([hr("start")],Eu.prototype,"writeStart",null),Eu=Xd=d([V("esri.TimeExtent")],Eu);const Rce=new Eu,aKe=new Eu({start:void 0,end:void 0}),SEe=Eu;async function CEe(t,e){const{WhereClause:r}=await ge(()=>import("./WhereClause-DN7niXzF.js").then(i=>i.W),__vite__mapDeps([36,37,38]));return r.create(t,e)}function d6t(t,e){return t!=null&&t!==""?e!=null&&e!==""?`(${t}) AND (${e})`:t:e}function p6t(t){return typeof t=="number"}function xte(t){return typeof t=="string"||t instanceof String}const lKe="yyyy-MM-dd",cKe="TT";var tR;(function(t){t.HM="HH:mm",t.HMS="HH:mm:ss",t.HMS_MS="HH:mm:ss.SSS"})(tR||(tR={}));const uKe=[tR.HMS_MS,tR.HMS,tR.HM,cKe];function $ce(t){if(!t||!xte(t))return null;const e=er.fromFormat(t,lKe);return e.isValid?e:null}function Ice(t){return t&&xte(t)?$ze(uKe,e=>{const r=er.fromFormat(t,e);return r.isValid?r:null})??null:null}function Lce(t){if(!t||!xte(t))return null;const e=er.fromISO(t);return e.isValid?e:null}var e3;(function(t){t.VALUE_OUT_OF_RANGE="domain-validation-error::value-out-of-range",t.INVALID_CODED_VALUE="domain-validation-error::invalid-coded-value"})(e3||(e3={}));const hKe=new Set(["integer","small-integer","big-integer","esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeBigInteger"]);function dKe(t){return t!=null&&hKe.has(t.type)}function EEe(t){return t!=null&&(t.type==="date-only"||t.type==="esriFieldTypeDateOnly")}function PEe(t){return t!=null&&(t.type==="timestamp-offset"||t.type==="esriFieldTypeTimestampOffset")}function AEe(t){return t!=null&&(t.type==="time-only"||t.type==="esriFieldTypeTimeOnly")}function pKe(t,e){const r=t==null?void 0:t.domain;if(!r)return null;switch(r.type){case"range":{const{min:i,max:n}=MEe(t);if(i!=null&&+e<i||n!=null&&+e>n)return e3.VALUE_OUT_OF_RANGE;break}case"coded-value":case"codedValue":if(r.codedValues==null||r.codedValues.every(i=>i==null||i.code!==e))return e3.INVALID_CODED_VALUE}return null}function MEe(t,e){const r=e??(t==null?void 0:t.domain);if(!r||r.type!=="range")return;const i="range"in r?r.range[0]:r.minValue,n="range"in r?r.range[1]:r.maxValue,s=dKe(t);return EEe(t)||AEe(t)||PEe(t)?{...fKe(t,n,i),isInteger:s}:{min:i!=null&&typeof i=="number"?i:null,max:n!=null&&typeof n=="number"?n:null,rawMin:i,rawMax:n,isInteger:s}}function fKe(t,e,r){var i,n,s,o,a,l;return EEe(t)?{min:(i=$ce(r))==null?void 0:i.toMillis(),max:(n=$ce(e))==null?void 0:n.toMillis(),rawMin:r,rawMax:e}:AEe(t)?{min:(s=Ice(r))==null?void 0:s.toMillis(),max:(o=Ice(e))==null?void 0:o.toMillis(),rawMin:r,rawMax:e}:PEe(t)?{min:(a=Lce(r))==null?void 0:a.toMillis(),max:(l=Lce(e))==null?void 0:l.toMillis(),rawMin:r,rawMax:e}:{max:null,min:null}}const mKe=()=>re.getLogger("esri.support.arcadeOnDemand");let wV;function Tte(){return wV||(wV=(async()=>{const t=await ge(()=>import("./arcadeUtils-9U9h2sVX.js").then(e=>e.aK),__vite__mapDeps([124,37,38,125,42,40,126]));return{arcade:t.arcade,arcadeUtils:t,Dictionary:t.Dictionary,Feature:t.arcadeFeature}})()),wV}const gKe=(t,e,r)=>Ste.create(t,e,r,null,["$feature","$view"],[]),OEe=(t,e,r)=>Ste.create(t,e,r,null,["$feature","$view"],[]),f6t=(t,e,r,i)=>Ste.create(t,e,r,i,["$feature","$view"],[]);let Ste=class REe{constructor(e,r,i,n,s,o,a){this.services=null,this.script=e,this.evaluate=n;const l=Array.isArray(o)?o:o==null?void 0:o.fields;this.fields=l??[],this._syntaxTree=i,this._arcade=r,this._arcadeFeature=s,this._spatialReference=a,this._referencesGeometry=r.scriptTouchesGeometry(this._syntaxTree),this._referencesScale=this._arcade.referencesMember(this._syntaxTree,"scale")}static async create(e,r,i,n,s,o){const{arcade:a,Feature:l,Dictionary:c}=await Tte(),u=lt.fromJSON(r);let h;try{h=a.parseScript(e,o)}catch(L){return mKe().error(new K("arcade-bad-expression","Failed to parse arcade script",{script:e,error:L})),null}const p=s.reduce((L,z)=>({...L,[z]:null}),{});let f=null;n!=null&&(f=new c(n),f.immutable=!0,p.$config=null);const g=a.scriptUsesGeometryEngine(h),_=g&&a.enableGeometrySupport(),v=a.scriptUsesFeatureSet(h)&&a.enableFeatureSetSupport(),b=a.scriptIsAsync(h),w=b&&a.enableAsyncSupport(),x={vars:p,spatialReference:u,useAsync:!!w};await Promise.all([_,v,w]);const S=new Set;await a.loadDependentModules(S,h,null,b,g);const E=new c;E.immutable=!1,E.setField("scale",0);const A=a.compileScript(h,x),O=(L,z)=>{var q;const k=(q=L.$view)==null?void 0:q.timeZone;return"$view"in L&&L.$view&&(E.setField("scale",typeof L.$view=="object"&&"scale"in L.$view?L.$view.scale:void 0),L.$view=E),f&&(L.$config=f),A({vars:L,spatialReference:u,services:z,timeZone:k})};return new REe(e,a,h,O,new l,i,u)}repurposeFeature(e){return e.geometry&&!e.geometry.spatialReference&&(e.geometry.spatialReference=this._spatialReference),this._arcadeFeature.repurposeFromGraphicLikeObject(e.geometry,e.attributes,{fields:this.fields}),this._arcadeFeature}referencesGeometry(){return this._referencesGeometry}referencesScale(){return this._referencesScale}};const yKe=/^([0-9_])/,_Ke=/[^a-z0-9_\u0080-\uffff]+/gi;function m6t(t){return t==null?null:t.trim().replaceAll(_Ke,"_").replace(yKe,"F$1")||null}const vKe=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],bKe=["field","normalizationField"];function g6t(t,e){if(t!=null&&e!=null){for(const r of Array.isArray(t)?t:[t])if(Dce(vKe,r,e),"visualVariables"in r&&r.visualVariables)for(const i of r.visualVariables)Dce(bKe,i,e)}}function Dce(t,e,r){if(t)for(const i of t){const n=Oz(i,e),s=n&&typeof n!="function"&&r.get(n);s&&E2(i,s.name,e)}}function y6t(t,e){var r;if(t!=null&&((r=e==null?void 0:e.fields)!=null&&r.length))if("startField"in t){const i=e.get(t.startField),n=e.get(t.endField);t.startField=(i==null?void 0:i.name)??null,t.endField=(n==null?void 0:n.name)??null}else{const i=e.get(t.startTimeField),n=e.get(t.endTimeField);t.startTimeField=(i==null?void 0:i.name)??null,t.endTimeField=(n==null?void 0:n.name)??null}}const xV=new Set;function $Ee(t,e){return t&&e?(xV.clear(),M$(xV,t,e),Array.from(xV).sort()):[]}function M$(t,e,r){var i;if(r)if((i=e==null?void 0:e.fields)!=null&&i.length)if(r.includes("*"))for(const{name:n}of e.fields)t.add(n);else for(const n of r)c2(t,e,n);else{if(r.includes("*"))return t.clear(),void t.add("*");for(const n of r)n!=null&&t.add(n)}}function c2(t,e,r){if(typeof r=="string")if(e){const i=e.get(r);i&&t.add(i.name)}else t.add(r)}function _6t(t,e){return e==null||t==null?[]:e.includes("*")?(t.fields??[]).map(r=>r.name):e}async function sy(t,e,r){var s;if(!r)return;const{arcadeUtils:i}=await Tte(),n=i.extractFieldNames(r,(s=e==null?void 0:e.fields)==null?void 0:s.map(o=>o.name));for(const o of n)c2(t,e,o)}async function IEe(t,e,r){if(r&&r!=="1=1"){const i=await CEe(r,e);if(!i.isStandardized)throw new K("fieldUtils:collectFilterFields","Where clause is not standardized",{where:r});M$(t,e,i.fieldNames)}}function v6t({displayField:t,fields:e}){return t||(e!=null&&e.length?TV(e,"name-or-title")||TV(e,"unique-identifier")||TV(e,"type-or-category")||wKe(e):null)}function wKe(t){for(const e of t){if(!(e!=null&&e.name))continue;const r=e.name.toLowerCase();if(r.includes("name")||r.includes("title"))return e.name}return null}function TV(t,e){for(const r of t)if(r!=null&&r.valueType&&r.valueType===e)return r.name;return null}async function b6t(t,e){var i;if(!e)return;const r=(i=e.elevationInfo)==null?void 0:i.featureExpressionInfo;return r?r.collectRequiredFields(t,e.fieldsIndex):void 0}function xKe(t,e,r){r.onStatisticExpression?sy(t,e,r.onStatisticExpression.expression):t.add(r.onStatisticField)}async function w6t(t,e,r){if(!e||!r||!("fields"in r))return;const i=[],n=r.popupTemplate;i.push(TKe(t,e,n)),r.fields&&i.push(...r.fields.map(async s=>xKe(t,e.fieldsIndex,s))),await Promise.all(i)}async function TKe(t,e,r){const i=[];r!=null&&r.expressionInfos&&i.push(...r.expressionInfos.map(s=>sy(t,e.fieldsIndex,s.expression)));const n=r==null?void 0:r.content;if(Array.isArray(n))for(const s of n)s.type==="expression"&&s.expressionInfo&&i.push(sy(t,e.fieldsIndex,s.expressionInfo.expression));await Promise.all(i)}async function x6t(t,e,r){e&&(e.timeInfo&&(r!=null&&r.timeExtent)&&M$(t,e.fieldsIndex,[e.timeInfo.startField,e.timeInfo.endField]),e.floorInfo&&M$(t,e.fieldsIndex,[e.floorInfo.floorField]),(r==null?void 0:r.where)!=null&&await IEe(t,e.fieldsIndex,r.where))}async function T6t(t,e,r){e&&r&&await Promise.all(r.map(i=>SKe(t,e,i)))}async function SKe(t,e,r){e&&r&&(r.valueExpression?await sy(t,e.fieldsIndex,r.valueExpression):r.field&&c2(t,e.fieldsIndex,r.field))}function S6t(t){return t?$Ee(t.fieldsIndex,LEe(t)):[]}function CKe(t){if(!t)return[];const e=t.geometryFieldsInfo;return e?$Ee(t.fieldsIndex,[e.shapeAreaField,e.shapeLengthField]):[]}const EKe=new Set(["oid","global-id","guid"]),PKe=new Set(["oid","global-id"]),AKe=[/^fnode_$/i,/^tnode_$/i,/^lpoly_$/i,/^rpoly_$/i,/^poly_$/i,/^shape$/i,/^shape_$/i,/^subclass$/i,/^subclass_$/i,/^rings_ok$/i,/^rings_nok$/i,/perimeter/i,/objectid/i,/_i$/i];function MKe(t){const e=new Set;DEe(t).forEach(i=>e.add(i)),CKe(t).forEach(i=>e.add(i.toLowerCase()));const r=t&&"infoFor3D"in t?t.infoFor3D:void 0;return r&&(Object.values(r.assetMapFieldRoles).forEach(i=>e.add(i.toLowerCase())),Object.values(r.transformFieldRoles).forEach(i=>e.add(i.toLowerCase()))),Array.from(e)}function LEe(t){if(!t)return[];const e="editFieldsInfo"in t&&t.editFieldsInfo;if(!e)return[];const{creationDateField:r,creatorField:i,editDateField:n,editorField:s}=e;return[r,i,n,s].filter(Boolean)}function DEe(t){return LEe(t).map(e=>e.toLowerCase())}function C6t(t,e){var r;return t.editable&&!EKe.has(t.type)&&!DEe(e).includes(((r=t.name)==null?void 0:r.toLowerCase())??"")}function E6t(t,e){var i;const r=((i=t.name)==null?void 0:i.toLowerCase())??"";return!((e==null?void 0:e.objectIdField)!=null&&r===e.objectIdField.toLowerCase()||(e==null?void 0:e.globalIdField)!=null&&r===e.globalIdField.toLowerCase()||MKe(e).includes(r)||PKe.has(t.type)||AKe.some(n=>n.test(r)))}async function P6t(t,e){const{labelingInfo:r,fieldsIndex:i}=e;r!=null&&r.length&&await Promise.all(r.map(n=>OKe(t,i,n)))}async function OKe(t,e,r){if(!r)return;const i=r.getLabelExpression(),n=r.where;if(i.type==="arcade")await sy(t,e,i.expression);else{const s=i.expression.match(/{[^}]*}/g);s&&s.forEach(o=>{c2(t,e,o.slice(1,-1))})}await IEe(t,e,n)}function A6t(t){const e=t.defaultValue;return e!==void 0&&kEe(t,e)?e:t.nullable?null:void 0}function M6t(t){const e=typeof t=="string"?{type:t}:t;return VKe(e)?255:e.type==="esriFieldTypeDate"||e.type==="date"?8:void 0}function NEe(t){return typeof t=="number"&&!isNaN(t)&&isFinite(t)}function RKe(t){return t===null||NEe(t)}function $Ke(t){return t===null||Number.isInteger(t)}function FEe(t){return t!=null&&typeof t=="string"}function IKe(t){return t===null||FEe(t)}function LKe(){return!0}function kEe(t,e){let r;switch(t.type){case"date":case"integer":case"long":case"small-integer":case"big-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":case"esriFieldTypeBigInteger":r=t.nullable?$Ke:Number.isInteger;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":r=t.nullable?RKe:NEe;break;case"string":case"esriFieldTypeString":r=t.nullable?IKe:FEe;break;default:r=LKe}return arguments.length===1?r:r(e)}const DKe=["integer","small-integer","big-integer"],NKe=["single","double"],FKe=["esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeBigInteger"],kKe=["esriFieldTypeSingle","esriFieldTypeDouble"],zKe=new Set([...DKe,...FKe]),UKe=new Set([...NKe,...kKe]),BKe=Bbe(zKe,UKe);function zEe(t){return t!=null&&BKe.has(t.type)}function VKe(t){return t!=null&&(t.type==="string"||t.type==="esriFieldTypeString")}function GKe(t){return t!=null&&(t.type==="date"||t.type==="esriFieldTypeDate")}function O6t(t){return t!=null&&(t.type==="date-only"||t.type==="esriFieldTypeDateOnly")}function R6t(t){return t!=null&&(t.type==="timestamp-offset"||t.type==="esriFieldTypeTimestampOffset")}function $6t(t){return t!=null&&(t.type==="time-only"||t.type==="esriFieldTypeTimeOnly")}function I6t(t){return t!=null&&(t.type==="oid"||t.type==="esriFieldTypeOID")}function L6t(t){return t!=null&&(t.type==="global-id"||t.type==="esriFieldTypeGlobalID")}function D6t(t,e){return jKe(t,e)===null}var M6,O6;function N6t(t){return t==null||typeof t=="number"&&isNaN(t)?null:t}function jKe(t,e){return t==null||t.nullable&&e===null?null:zEe(t)&&!HKe(t.type,Number(e))?M6.OUT_OF_RANGE:kEe(t,e)?t.domain?pKe(t,e):null:O6.INVALID_TYPE}function HKe(t,e){const r=typeof t=="string"?UEe(t):t;if(!r)return!1;const i=r.min,n=r.max;return r.isInteger?Number.isInteger(e)&&e>=i&&e<=n:e>=i&&e<=n}function UEe(t){switch(t){case"esriFieldTypeSmallInteger":case"small-integer":return WKe;case"esriFieldTypeInteger":case"integer":return qKe;case"esriFieldTypeBigInteger":case"big-integer":return YKe;case"esriFieldTypeSingle":case"single":return XKe;case"esriFieldTypeDouble":case"double":return ZKe}}(function(t){t.OUT_OF_RANGE="numeric-range-validation-error::out-of-range"})(M6||(M6={})),function(t){t.INVALID_TYPE="type-validation-error::invalid-type"}(O6||(O6={}));const WKe={min:-32768,max:32767,isInteger:!0,rawMin:-32768,rawMax:32767},qKe={min:-2147483648,max:2147483647,isInteger:!0,rawMin:-2147483648,rawMax:2147483647},YKe={min:-Number.MAX_SAFE_INTEGER,max:Number.MAX_SAFE_INTEGER,isInteger:!0,rawMin:-Number.MAX_SAFE_INTEGER,rawMax:Number.MAX_SAFE_INTEGER},XKe={min:-34e37,max:12e37,isInteger:!1,rawMin:-34e37,rawMax:12e37},ZKe={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1,rawMin:-Number.MAX_VALUE,rawMax:Number.MAX_VALUE};function F6t(t,e,r){switch(t){case e3.INVALID_CODED_VALUE:return`Value ${r} is not in the coded domain - field: ${e.name}, domain: ${JSON.stringify(e.domain)}`;case e3.VALUE_OUT_OF_RANGE:return`Value ${r} is out of the range of valid values - field: ${e.name}, domain: ${JSON.stringify(e.domain)}`;case O6.INVALID_TYPE:return`Value ${r} is not a valid value for the field type - field: ${e.name}, type: ${e.type}, nullable: ${e.nullable}`;case M6.OUT_OF_RANGE:{const{min:i,max:n}=UEe(e.type);return`Value ${r} is out of range for the number type - field: ${e.name}, type: ${e.type}, value range is ${i} to ${n}`}}}function k6t(t,e){return!JKe(t,e,null)}function JKe(t,e,r){if(!(e!=null&&e.attributes)||!t){if(r!=null)for(const s of t??[])r.add(s);return!0}const i=new Set(Object.keys(e.attributes));let n=!1;for(const s of t)if(!i.has(s)){if(n=!0,r==null)break;r.add(s)}return n}function z6t(t){return!!t&&["raster.itempixelvalue","raster.servicepixelvalue"].some(e=>t.toLowerCase().startsWith(e))}let M5=class extends ze{constructor(e){super(e),this.type=null}};d([m({type:["attachments","custom","fields","media","text","expression","relationship"],readOnly:!0,json:{read:!1,write:!0}})],M5.prototype,"type",void 0),M5=d([V("esri.popup.content.Content")],M5);const Fv=M5;var Eq;let qb=Eq=class extends Fv{constructor(t){super(t),this.description=null,this.displayType="auto",this.title=null,this.type="attachments"}clone(){return new Eq({description:this.description,displayType:this.displayType,title:this.title})}};d([m({type:String,json:{write:!0}})],qb.prototype,"description",void 0),d([m({type:["auto","preview","list"],json:{write:!0}})],qb.prototype,"displayType",void 0),d([m({type:String,json:{write:!0}})],qb.prototype,"title",void 0),d([m({type:["attachments"],readOnly:!0,json:{read:!1,write:!0}})],qb.prototype,"type",void 0),qb=Eq=d([V("esri.popup.content.AttachmentsContent")],qb);const R6=qb;var Pq;let Yb=Pq=class extends Fv{constructor(t){super(t),this.creator=null,this.destroyer=null,this.outFields=null,this.type="custom"}clone(){return new Pq({creator:this.creator,destroyer:this.destroyer,outFields:Array.isArray(this.outFields)?_e(this.outFields):null})}};d([m()],Yb.prototype,"creator",void 0),d([m()],Yb.prototype,"destroyer",void 0),d([m()],Yb.prototype,"outFields",void 0),d([m({type:["custom"],readOnly:!0})],Yb.prototype,"type",void 0),Yb=Pq=d([V("esri.popup.content.CustomContent")],Yb);const QKe=Yb;var Aq;let uS=Aq=class extends ze{constructor(t){super(t),this.title=null,this.expression=null,this.returnType="dictionary"}clone(){return new Aq({title:this.title,expression:this.expression})}};d([m({type:String,json:{write:!0}})],uS.prototype,"title",void 0),d([m({type:String,json:{write:!0}})],uS.prototype,"expression",void 0),d([m({type:["dictionary"],readOnly:!0,json:{read:!1,write:!0}})],uS.prototype,"returnType",void 0),uS=Aq=d([V("esri.popup.ElementExpressionInfo")],uS);const KKe=uS;var Mq;let WA=Mq=class extends Fv{constructor(t){super(t),this.expressionInfo=null,this.type="expression"}clone(){var t;return new Mq({expressionInfo:(t=this.expressionInfo)==null?void 0:t.clone()})}};d([m({type:KKe,json:{write:!0}})],WA.prototype,"expressionInfo",void 0),d([m({type:["expression"],readOnly:!0,json:{read:!1,write:!0}})],WA.prototype,"type",void 0),WA=Mq=d([V("esri.popup.content.ExpressionContent")],WA);const Cte=WA;let hS=class extends nh(ze){constructor(e){super(e),this.dateFormat=null,this.digitSeparator=!1,this.places=null}};d([It(TWe)],hS.prototype,"dateFormat",void 0),d([m({type:Boolean,json:{write:!0}})],hS.prototype,"digitSeparator",void 0),d([m({type:fn,json:{write:!0}})],hS.prototype,"places",void 0),hS=d([V("esri.popup.support.FieldInfoFormat")],hS);const eet=hS;var Oq;let Zd=Oq=class extends ze{constructor(t){super(t),this.fieldName=null,this.format=null,this.isEditable=!0,this.label=null,this.stringFieldOption="text-box",this.statisticType=null,this.tooltip=null,this.visible=!0}clone(){return new Oq({fieldName:this.fieldName,format:this.format?_e(this.format):null,isEditable:this.isEditable,label:this.label,stringFieldOption:this.stringFieldOption,statisticType:this.statisticType,tooltip:this.tooltip,visible:this.visible})}};d([m({type:String,json:{write:!0}})],Zd.prototype,"fieldName",void 0),d([m({type:eet,json:{write:!0}})],Zd.prototype,"format",void 0),d([m({type:Boolean,json:{write:{alwaysWriteDefaults:!0},default:!0}})],Zd.prototype,"isEditable",void 0),d([m({type:String,json:{write:!0}})],Zd.prototype,"label",void 0),d([It(new yn({richtext:"rich-text",textarea:"text-area",textbox:"text-box"}),{default:"text-box"})],Zd.prototype,"stringFieldOption",void 0),d([m({type:["count","sum","min","max","avg","stddev","var"],json:{write:!0}})],Zd.prototype,"statisticType",void 0),d([m({type:String,json:{write:!0}})],Zd.prototype,"tooltip",void 0),d([m({type:Boolean,json:{write:!0}})],Zd.prototype,"visible",void 0),Zd=Oq=d([V("esri.popup.FieldInfo")],Zd);const BEe=Zd;var Rq;let Zg=Rq=class extends Fv{constructor(t){super(t),this.attributes=null,this.description=null,this.fieldInfos=null,this.title=null,this.type="fields"}writeFieldInfos(t,e){e.fieldInfos=t&&t.map(r=>r.toJSON())}clone(){return new Rq(_e({attributes:this.attributes,description:this.description,fieldInfos:this.fieldInfos,title:this.title}))}};d([m({type:Object,json:{write:!0}})],Zg.prototype,"attributes",void 0),d([m({type:String,json:{write:!0}})],Zg.prototype,"description",void 0),d([m({type:[BEe]})],Zg.prototype,"fieldInfos",void 0),d([hr("fieldInfos")],Zg.prototype,"writeFieldInfos",null),d([m({type:String,json:{write:!0}})],Zg.prototype,"title",void 0),d([m({type:["fields"],readOnly:!0,json:{read:!1,write:!0}})],Zg.prototype,"type",void 0),Zg=Rq=d([V("esri.popup.content.FieldsContent")],Zg);const $6=Zg;let Xb=class extends ze{constructor(e){super(e),this.altText=null,this.caption="",this.title="",this.type=null}};d([m({type:String,json:{write:!0}})],Xb.prototype,"altText",void 0),d([m({type:String,json:{write:!0}})],Xb.prototype,"caption",void 0),d([m({type:String,json:{write:!0}})],Xb.prototype,"title",void 0),d([m({type:["image","bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],Xb.prototype,"type",void 0),Xb=d([V("esri.popup.content.mixins.MediaInfo")],Xb);const Ete=Xb;var $q;let Zb=$q=class extends Ae{constructor(t){super(t),this.color=null,this.fieldName=null,this.tooltip=null,this.value=null}clone(){return new $q({fieldName:this.fieldName,tooltip:this.tooltip,value:this.value})}};d([m()],Zb.prototype,"color",void 0),d([m()],Zb.prototype,"fieldName",void 0),d([m()],Zb.prototype,"tooltip",void 0),d([m()],Zb.prototype,"value",void 0),Zb=$q=d([V("esri.popup.content.support.ChartMediaInfoValueSeries")],Zb);const tet=Zb;var Iq;let C_=Iq=class extends ze{constructor(t){super(t),this.colors=null,this.fields=[],this.normalizeField=null,this.series=[],this.tooltipField=null}clone(){return new Iq({colors:_e(this.colors),fields:_e(this.fields),normalizeField:this.normalizeField,tooltipField:this.tooltipField})}};d([m({type:[Xe],json:{type:[[fn]],write:!0}})],C_.prototype,"colors",void 0),d([m({type:[String],json:{write:!0}})],C_.prototype,"fields",void 0),d([m({type:String,json:{write:!0}})],C_.prototype,"normalizeField",void 0),d([m({type:[tet],json:{read:!1}})],C_.prototype,"series",void 0),d([m({type:String,json:{write:!0}})],C_.prototype,"tooltipField",void 0),C_=Iq=d([V("esri.popup.content.support.ChartMediaInfoValue")],C_);const ret=C_;let qA=class extends Ete{constructor(e){super(e),this.type=null,this.value=null}};d([m({type:["bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],qA.prototype,"type",void 0),d([m({type:ret,json:{write:!0}})],qA.prototype,"value",void 0),qA=d([V("esri.popup.content.mixins.ChartMediaInfo")],qA);const H9=qA,W9=ac()({barchart:"bar-chart",columnchart:"column-chart",linechart:"line-chart",piechart:"pie-chart"});var Lq;let O5=Lq=class extends H9{constructor(t){super(t),this.type="bar-chart"}clone(){return new Lq({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};d([m({type:["bar-chart"],readOnly:!0,json:{type:["barchart"],read:!1,write:W9.write}})],O5.prototype,"type",void 0),O5=Lq=d([V("esri.popup.content.BarChartMediaInfo")],O5);const VEe=O5;var Dq;let R5=Dq=class extends H9{constructor(t){super(t),this.type="column-chart"}clone(){return new Dq({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};d([m({type:["column-chart"],readOnly:!0,json:{type:["columnchart"],read:!1,write:W9.write}})],R5.prototype,"type",void 0),R5=Dq=d([V("esri.popup.content.ColumnChartMediaInfo")],R5);const GEe=R5;var Nq;let YA=Nq=class extends ze{constructor(t){super(t),this.linkURL=null,this.sourceURL=null}clone(){return new Nq({linkURL:this.linkURL,sourceURL:this.sourceURL})}};d([m({type:String,json:{write:!0}})],YA.prototype,"linkURL",void 0),d([m({type:String,json:{write:!0}})],YA.prototype,"sourceURL",void 0),YA=Nq=d([V("esri.popup.content.support.ImageMediaInfoValue")],YA);const iet=YA;var Fq;let dS=Fq=class extends Ete{constructor(t){super(t),this.refreshInterval=null,this.type="image",this.value=null}clone(){return new Fq({altText:this.altText,title:this.title,caption:this.caption,refreshInterval:this.refreshInterval,value:this.value?this.value.clone():null})}};d([m({type:Number,json:{write:!0}})],dS.prototype,"refreshInterval",void 0),d([m({type:["image"],readOnly:!0,json:{read:!1,write:!0}})],dS.prototype,"type",void 0),d([m({type:iet,json:{write:!0}})],dS.prototype,"value",void 0),dS=Fq=d([V("esri.popup.content.ImageMediaInfo")],dS);const jEe=dS;var kq;let $5=kq=class extends H9{constructor(t){super(t),this.type="line-chart"}clone(){return new kq({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};d([m({type:["line-chart"],readOnly:!0,json:{type:["linechart"],read:!1,write:W9.write}})],$5.prototype,"type",void 0),$5=kq=d([V("esri.popup.content.LineChartMediaInfo")],$5);const HEe=$5;var zq;let I5=zq=class extends H9{constructor(t){super(t),this.type="pie-chart"}clone(){return new zq({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};d([m({type:["pie-chart"],readOnly:!0,json:{type:["piechart"],read:!1,write:W9.write}})],I5.prototype,"type",void 0),I5=zq=d([V("esri.popup.content.PieChartMediaInfo")],I5);const WEe=I5,qEe={base:Ete,key:"type",defaultKeyValue:"image",typeMap:{"bar-chart":VEe,"column-chart":GEe,"line-chart":HEe,"pie-chart":WEe,image:jEe}};var Uq;let Jd=Uq=class extends Fv{constructor(t){super(t),this.activeMediaInfoIndex=null,this.attributes=null,this.description=null,this.mediaInfos=null,this.title=null,this.type="media"}readMediaInfos(t){return t&&t.map(e=>e.type==="image"?jEe.fromJSON(e):e.type==="barchart"?VEe.fromJSON(e):e.type==="columnchart"?GEe.fromJSON(e):e.type==="linechart"?HEe.fromJSON(e):e.type==="piechart"?WEe.fromJSON(e):void 0).filter(Boolean)}writeMediaInfos(t,e){e.mediaInfos=t&&t.map(r=>r.toJSON())}clone(){return new Uq(_e({activeMediaInfoIndex:this.activeMediaInfoIndex,attributes:this.attributes,description:this.description,mediaInfos:this.mediaInfos,title:this.title}))}};d([m()],Jd.prototype,"activeMediaInfoIndex",void 0),d([m({type:Object,json:{write:!0}})],Jd.prototype,"attributes",void 0),d([m({type:String,json:{write:!0}})],Jd.prototype,"description",void 0),d([m({types:[qEe]})],Jd.prototype,"mediaInfos",void 0),d([Tr("mediaInfos")],Jd.prototype,"readMediaInfos",null),d([hr("mediaInfos")],Jd.prototype,"writeMediaInfos",null),d([m({type:String,json:{write:!0}})],Jd.prototype,"title",void 0),d([m({type:["media"],readOnly:!0,json:{read:!1,write:!0}})],Jd.prototype,"type",void 0),Jd=Uq=d([V("esri.popup.content.MediaContent")],Jd);const I6=Jd;var Bq;let XA=Bq=class extends ze{constructor(t){super(t),this.field=null,this.order=null}clone(){return new Bq({field:this.field,order:this.order})}};d([m({type:String,json:{write:!0}})],XA.prototype,"field",void 0),d([m({type:["asc","desc"],json:{write:!0}})],XA.prototype,"order",void 0),XA=Bq=d([V("esri.popup.support.RelatedRecordsInfoFieldOrder")],XA);const YEe=XA;let Qf=class extends nh(Fv){constructor(e){super(e),this.description=null,this.displayCount=null,this.displayType="list",this.orderByFields=null,this.relationshipId=null,this.title=null,this.type="relationship"}};d([m({type:String,json:{write:!0}})],Qf.prototype,"description",void 0),d([m({type:Number,json:{type:fn,write:!0}})],Qf.prototype,"displayCount",void 0),d([m({type:["list"],json:{write:!0}})],Qf.prototype,"displayType",void 0),d([m({type:[YEe],json:{write:!0}})],Qf.prototype,"orderByFields",void 0),d([m({type:Number,json:{type:fn,write:!0}})],Qf.prototype,"relationshipId",void 0),d([m({type:String,json:{write:!0}})],Qf.prototype,"title",void 0),d([m({type:["relationship"],readOnly:!0,json:{read:!1,write:!0}})],Qf.prototype,"type",void 0),Qf=d([V("esri.popup.content.RelationshipContent")],Qf);const L6=Qf;var Vq;let ZA=Vq=class extends Fv{constructor(t){super(t),this.text=null,this.type="text"}clone(){return new Vq({text:this.text})}};d([m({type:String,json:{write:!0}})],ZA.prototype,"text",void 0),d([m({type:["text"],readOnly:!0,json:{read:!1,write:!0}})],ZA.prototype,"type",void 0),ZA=Vq=d([V("esri.popup.content.TextContent")],ZA);const D6=ZA,net={base:null,key:"type",typeMap:{attachment:R6,media:I6,text:D6,expression:Cte,field:$6,relationship:L6}};var Gq;let Jb=Gq=class extends ze{constructor(t){super(t),this.name=null,this.title=null,this.expression=null,this.returnType=null}clone(){return new Gq({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};d([m({type:String,json:{write:!0}})],Jb.prototype,"name",void 0),d([m({type:String,json:{write:!0}})],Jb.prototype,"title",void 0),d([m({type:String,json:{write:!0}})],Jb.prototype,"expression",void 0),d([m({type:["string","number"],json:{write:!0}})],Jb.prototype,"returnType",void 0),Jb=Gq=d([V("esri.popup.ExpressionInfo")],Jb);const set=Jb;var jq;let JA=jq=class extends ze{constructor(t){super(t),this.returnTopmostRaster=null,this.showNoDataRecords=null}clone(){return new jq({showNoDataRecords:this.showNoDataRecords,returnTopmostRaster:this.returnTopmostRaster})}};d([m({type:Boolean,json:{write:!0}})],JA.prototype,"returnTopmostRaster",void 0),d([m({type:Boolean,json:{write:!0}})],JA.prototype,"showNoDataRecords",void 0),JA=jq=d([V("esri.popup.LayerOptions")],JA);const oet=JA;var Hq;let QA=Hq=class extends ze{constructor(t){super(t),this.showRelatedRecords=null,this.orderByFields=null}clone(){return new Hq({showRelatedRecords:this.showRelatedRecords,orderByFields:this.orderByFields?_e(this.orderByFields):null})}};d([m({type:Boolean,json:{write:!0}})],QA.prototype,"showRelatedRecords",void 0),d([m({type:[YEe],json:{write:!0}})],QA.prototype,"orderByFields",void 0),QA=Hq=d([V("esri.popup.RelatedRecordsInfo")],QA);const aet=QA;var Wq;let vh=Wq=class extends bee(Ae){constructor(t){super(t),this.active=!1,this.className=null,this.disabled=!1,this.icon=null,this.id=null,this.indicator=!1,this.title=null,this.type=null,this.visible=!0}clone(){return new Wq({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible})}};d([m()],vh.prototype,"active",void 0),d([m()],vh.prototype,"className",void 0),d([m()],vh.prototype,"disabled",void 0),d([m()],vh.prototype,"icon",void 0),d([m()],vh.prototype,"id",void 0),d([m()],vh.prototype,"indicator",void 0),d([m()],vh.prototype,"title",void 0),d([m()],vh.prototype,"type",void 0),d([m()],vh.prototype,"visible",void 0),vh=Wq=d([V("esri.support.actions.ActionBase")],vh);const Pte=vh;var qq;let L5=qq=class extends Pte{constructor(t){super(t),this.image=null,this.type="button"}clone(){return new qq({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image})}};d([m()],L5.prototype,"image",void 0),L5=qq=d([V("esri.support.Action.ActionButton")],L5);const cet=L5;var Yq;let KA=Yq=class extends Pte{constructor(t){super(t),this.image=null,this.type="toggle",this.value=!1}clone(){return new Yq({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image,value:this.value})}};d([m()],KA.prototype,"image",void 0),d([m()],KA.prototype,"value",void 0),KA=Yq=d([V("esri.support.Action.ActionToggle")],KA);const uet=KA,BP="relationships/",Nce="expression/",het=$t.ofType({key:"type",defaultKeyValue:"button",base:Pte,typeMap:{button:cet,toggle:uet}}),det={base:Fv,key:"type",typeMap:{media:I6,custom:QKe,text:D6,attachments:R6,fields:$6,expression:Cte,relationship:L6}},pet=new Set(["attachments","fields","media","text","expression","relationship"]);let Oo=class extends nh(ze){constructor(){super(...arguments),this.actions=null,this.content="",this.expressionInfos=null,this.fieldInfos=null,this.layerOptions=null,this.lastEditInfoEnabled=!0,this.outFields=null,this.overwriteActions=!1,this.returnGeometry=!1,this.title=""}castContent(e){return Array.isArray(e)?e.map(r=>ig(det,r)):typeof e=="string"||typeof e=="function"||e instanceof HTMLElement||nu(e)?e:(re.getLogger(this).error("content error","unsupported content value",{value:e}),null)}readContent(e,r){const{popupElements:i}=r;return Array.isArray(i)&&i.length>0?this._readPopupInfoElements(r.description,r.mediaInfos,i):this._readPopupInfo(r)}writeContent(e,r,i,n){typeof e!="string"?Array.isArray(e)&&(r.popupElements=e.filter(s=>pet.has(s.type)).map(s=>s==null?void 0:s.toJSON(n)),r.popupElements.forEach(s=>{s.type==="attachments"?this._writeAttachmentContent(r):s.type==="media"?this._writeMediaContent(s,r):s.type==="text"?this._writeTextContent(s,r):s.type==="relationship"&&this._writeRelationshipContent(s,r)})):r.description=e}writeFieldInfos(e,r,i,n){const{content:s}=this,o=Array.isArray(s)?s:null;if(e){const a=o?o.filter(c=>c.type==="fields"):[],l=a.length&&a.every(c=>{var u;return(u=c.fieldInfos)==null?void 0:u.length});r.fieldInfos=e.filter(Boolean).map(c=>{const u=c.toJSON(n);return l&&(u.visible=!1),u})}if(o)for(const a of o)a.type==="fields"&&this._writeFieldsContent(a,r)}writeLayerOptions(e,r,i,n){r[i]=!e||e.showNoDataRecords===null&&e.returnTopmostRaster===null?null:e.toJSON(n)}writeTitle(e,r){r.title=e||""}async collectRequiredFields(e,r){const i=this.expressionInfos||[];await this._collectExpressionInfoFields(e,r,[...i,...this._getContentExpressionInfos(this.content,i)]),M$(e,r,[...this.outFields||[],...this._getActionsFields(this.actions),...this._getTitleFields(this.title),...this._getContentFields(this.content)])}async getRequiredFields(e){const r=new Set;return await this.collectRequiredFields(r,e),[...r].sort()}_writeFieldsContent(e,r){if(!Array.isArray(e.fieldInfos)||!e.fieldInfos.length)return;const i=_e(e.fieldInfos);Array.isArray(r.fieldInfos)?i.forEach(n=>{const s=r.fieldInfos.find(o=>o.fieldName.toLowerCase()===n.fieldName.toLowerCase());s?s.visible=!0:r.fieldInfos.push(n)}):r.fieldInfos=i}_writeAttachmentContent(e){e.showAttachments||(e.showAttachments=!0)}_writeRelationshipContent(e,r){var s,o;const i=((s=e.orderByFields)==null?void 0:s.map(a=>this._toFieldOrderJSON(a,e.relationshipId)))||[],n=[...((o=r.relatedRecordsInfo)==null?void 0:o.orderByFields)||[],...i];r.relatedRecordsInfo={showRelatedRecords:!0,...(n==null?void 0:n.length)&&{orderByFields:n}}}_writeTextContent(e,r){!r.description&&e.text&&(r.description=e.text)}_writeMediaContent(e,r){if(!Array.isArray(e.mediaInfos)||!e.mediaInfos.length)return;const i=_e(e.mediaInfos);Array.isArray(r.mediaInfos)?r.mediaInfos=[...r.mediaInfos,...i]:r.mediaInfos=i}_readPopupInfoElements(e,r,i){const n={description:!1,mediaInfos:!1};return i.map(s=>s.type==="media"?(s.mediaInfos||!r||n.mediaInfos||(s.mediaInfos=r,n.mediaInfos=!0),I6.fromJSON(s)):s.type==="text"?(s.text||!e||n.description||(s.text=e,n.description=!0),D6.fromJSON(s)):s.type==="attachments"?R6.fromJSON(s):s.type==="fields"?$6.fromJSON(s):s.type==="expression"?Cte.fromJSON(s):s.type==="relationship"?L6.fromJSON(s):void 0).filter(Boolean)}_toRelationshipContent(e){const{field:r,order:i}=e;if(!(r!=null&&r.startsWith(BP)))return null;const n=r.replace(BP,"").split("/");if(n.length!==2)return null;const s=parseInt(n[0],10),o=n[1];return typeof s=="number"&&o?L6.fromJSON({relationshipId:s,orderByFields:[{field:o,order:i}]}):null}_toFieldOrderJSON(e,r){const{order:i,field:n}=e;return{field:`${BP}${r}/${n}`,order:i}}_readPopupInfo({description:e,mediaInfos:r,showAttachments:i,relatedRecordsInfo:n={showRelatedRecords:!1}}){const s=[];e?s.push(new D6({text:e})):s.push(new $6),Array.isArray(r)&&r.length&&s.push(I6.fromJSON({mediaInfos:r})),i&&s.push(R6.fromJSON({displayType:"auto"}));const{showRelatedRecords:o,orderByFields:a}=n;return o&&(a!=null&&a.length)&&a.forEach(l=>{const c=this._toRelationshipContent(l);c&&s.push(c)}),s.length?s:e}_getContentElementFields(e){const r=e==null?void 0:e.type;if(r==="attachments")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description)];if(r==="custom")return e.outFields||[];if(r==="fields")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...this._getFieldInfoFields(e.fieldInfos??this.fieldInfos)];if(r==="media"){const i=e.mediaInfos||[];return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...i.reduce((n,s)=>[...n,...this._getMediaInfoFields(s)],[])]}return r==="text"?this._extractFieldNames(e.text):[]}_getMediaInfoFields(e){const{caption:r,title:i,value:n}=e,s=n||{},{fields:o,normalizeField:a,tooltipField:l,sourceURL:c,linkURL:u}=s,h=[...this._extractFieldNames(i),...this._extractFieldNames(r),...this._extractFieldNames(c),...this._extractFieldNames(u),...o??[]];return a&&h.push(a),l&&h.push(l),h}_getContentExpressionInfos(e,r){return Array.isArray(e)?e.reduce((i,n)=>[...i,...n.type==="expression"&&n.expressionInfo?[n.expressionInfo]:[]],r):[]}_getContentFields(e){return typeof e=="string"?this._extractFieldNames(e):Array.isArray(e)?e.reduce((r,i)=>[...r,...this._getContentElementFields(i)],[]):[]}async _collectExpressionInfoFields(e,r,i){i&&await Promise.all(i.map(n=>sy(e,r,n.expression)))}_getFieldInfoFields(e){return e?e.filter(r=>r.visible===void 0||!!r.visible).map(r=>r.fieldName).filter(r=>!r.startsWith(BP)&&!r.startsWith(Nce)):[]}_getActionsFields(e){return e?e.toArray().reduce((r,i)=>[...r,...this._getActionFields(i)],[]):[]}_getActionFields(e){const{className:r,title:i,type:n}=e,s=n==="button"||n==="toggle"?e.image:"";return[...this._extractFieldNames(i),...this._extractFieldNames(r),...this._extractFieldNames(s)]}_getTitleFields(e){return typeof e=="string"?this._extractFieldNames(e):[]}_extractFieldNames(e){if(!e||typeof e!="string")return[];const r=/{[^}]*}/g,i=e.match(r);if(!i)return[];const n=/\{(\w+):.+\}/,s=i.filter(o=>!(o.indexOf(`{${BP}`)===0||o.indexOf(`{${Nce}`)===0)).map(o=>o.replace(n,"{$1}"));return s?s.map(o=>o.slice(1,-1)):[]}};d([m({type:het})],Oo.prototype,"actions",void 0),d([m()],Oo.prototype,"content",void 0),d([ai("content")],Oo.prototype,"castContent",null),d([Tr("content",["description","fieldInfos","popupElements","mediaInfos","showAttachments","relatedRecordsInfo"])],Oo.prototype,"readContent",null),d([hr("content",{popupElements:{type:$t.ofType(net)},showAttachments:{type:Boolean},mediaInfos:{type:$t.ofType(qEe)},description:{type:String},relatedRecordsInfo:{type:aet}})],Oo.prototype,"writeContent",null),d([m({type:[set],json:{write:!0}})],Oo.prototype,"expressionInfos",void 0),d([m({type:[BEe]})],Oo.prototype,"fieldInfos",void 0),d([hr("fieldInfos")],Oo.prototype,"writeFieldInfos",null),d([m({type:oet})],Oo.prototype,"layerOptions",void 0),d([hr("layerOptions")],Oo.prototype,"writeLayerOptions",null),d([m({type:Boolean,json:{read:{source:"showLastEditInfo"},write:{target:"showLastEditInfo"},default:!0}})],Oo.prototype,"lastEditInfoEnabled",void 0),d([m()],Oo.prototype,"outFields",void 0),d([m()],Oo.prototype,"overwriteActions",void 0),d([m()],Oo.prototype,"returnGeometry",void 0),d([m({json:{type:String}})],Oo.prototype,"title",void 0),d([hr("title")],Oo.prototype,"writeTitle",null),Oo=d([V("esri.PopupTemplate")],Oo);const fet=Oo,Fce=new yn({esriSMS:"simple-marker",esriPMS:"picture-marker",esriSLS:"simple-line",esriSFS:"simple-fill",esriPFS:"picture-fill",esriTS:"text",esriSHD:"shield-label-symbol",PointSymbol3D:"point-3d",LineSymbol3D:"line-3d",PolygonSymbol3D:"polygon-3d",WebStyleSymbol:"web-style",MeshSymbol3D:"mesh-3d",LabelSymbol3D:"label-3d",CIMSymbolReference:"cim"});let met=0,pS=class extends ze{constructor(e){super(e),this.id="sym"+met++,this.type=null,this.color=new Xe([0,0,0,1])}readColor(e){return(e==null?void 0:e[0])!=null?[e[0],e[1],e[2],e[3]/255]:e}async collectRequiredFields(e,r){}hash(){return JSON.stringify(this.toJSON())}clone(){}};d([m({type:Fce.apiValues,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,writer:Fce.write}}})],pS.prototype,"type",void 0),d([m({type:Xe,json:{write:{allowNull:!0}}})],pS.prototype,"color",void 0),d([Tr("color")],pS.prototype,"readColor",null),pS=d([V("esri.symbols.Symbol")],pS);const su=pS;var Xq;let E_=Xq=class extends su{constructor(t){super(t),this.data=null,this.type="cim"}readData(t,e){return e}writeData(t,e){Object.assign(e,t)}async collectRequiredFields(t,e){var r;if(((r=this.data)==null?void 0:r.type)==="CIMSymbolReference"){const i=this.data.primitiveOverrides;if(i){const n=i.map(s=>{const o=s.valueExpressionInfo;return o?sy(t,e,o.expression):null});await Promise.all(n)}}}clone(){return new Xq({data:_e(this.data)})}hash(){return CK(JSON.stringify(this.data)).toString()}};d([m({json:{write:!1}})],E_.prototype,"color",void 0),d([m({json:{write:!0}})],E_.prototype,"data",void 0),d([Tr("data",["symbol"])],E_.prototype,"readData",null),d([hr("data",{})],E_.prototype,"writeData",null),d([It({CIMSymbolReference:"cim"},{readOnly:!0})],E_.prototype,"type",void 0),E_=Xq=d([V("esri.symbols.CIMSymbol")],E_);const q9=E_;let fS=class extends ze{constructor(e){super(e),this.enabled=!0,this.type=null,this.ignoreDrivers=!1}writeEnabled(e,r,i){e||(r[i]=e)}};d([m({type:Boolean,json:{read:{source:"enable"},write:{target:"enable"}}})],fS.prototype,"enabled",void 0),d([hr("enabled")],fS.prototype,"writeEnabled",null),d([m({type:["icon","object","line","path","fill","water","extrude","text"],readOnly:!0})],fS.prototype,"type",void 0),fS=d([V("esri.symbols.Symbol3DLayer")],fS);const yg=fS;function get(t,e){const r=e.transparency!=null?hee(e.transparency):1,i=e.color;return i&&Array.isArray(i)?new Xe([i[0]||0,i[1]||0,i[2]||0,r]):null}function yet(t,e){e.color=t.toJSON().slice(0,3);const r=uee(t.a);r!==0&&(e.transparency=r)}const _y={type:Xe,json:{type:[fn],default:null,read:{source:["color","transparency"],reader:get},write:{target:{color:{type:[fn]},transparency:{type:fn}},writer:yet}}},lg={type:Number,cast:kn,json:{write:!0}};let Qb=class extends ze{constructor(e){super(e),this.color=new Xe([0,0,0,1]),this.extensionLength=0,this.size=xl(1)}clone(){}cloneProperties(){return{color:_e(this.color),size:this.size,extensionLength:this.extensionLength}}};d([m({type:["solid","sketch"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],Qb.prototype,"type",void 0),d([m(_y)],Qb.prototype,"color",void 0),d([m({...lg,json:{write:{overridePolicy:t=>({enabled:!!t})}}})],Qb.prototype,"extensionLength",void 0),d([m(lg)],Qb.prototype,"size",void 0),Qb=d([V("esri.symbols.edges.Edges3D")],Qb);const Ate=Qb;var Zq;let D5=Zq=class extends Ate{constructor(t){super(t),this.type="sketch"}clone(){return new Zq(this.cloneProperties())}};d([It({sketch:"sketch"},{readOnly:!0})],D5.prototype,"type",void 0),D5=Zq=d([V("esri.symbols.edges.SketchEdges3D")],D5);const Mte=D5;var Jq;let N5=Jq=class extends Ate{constructor(t){super(t),this.type="solid"}clone(){return new Jq(this.cloneProperties())}};d([It({solid:"solid"},{readOnly:!0})],N5.prototype,"type",void 0),N5=Jq=d([V("esri.symbols.support.SolidEdges3D")],N5);const XEe=N5,ZEe={types:{key:"type",base:Ate,typeMap:{solid:XEe,sketch:Mte}},json:{write:!0}};var Qq;let Yu=Qq=class extends ze{constructor(t){super(t),this.color=null}clone(){const t={color:this.color!=null?this.color.clone():null};return new Qq(t)}};d([m(_y)],Yu.prototype,"color",void 0),Yu=Qq=d([V("esri.symbols.support.Symbol3DMaterial")],Yu);var Kq;let P_=Kq=class extends yg{constructor(t){super(t),this.type="extrude",this.size=1,this.material=null,this.castShadows=!0,this.edges=null}clone(){return new Kq({edges:this.edges&&this.edges.clone(),enabled:this.enabled,material:this.material!=null?this.material.clone():null,castShadows:this.castShadows,size:this.size})}};d([It({Extrude:"extrude"},{readOnly:!0})],P_.prototype,"type",void 0),d([m({type:Number,json:{write:{enabled:!0,isRequired:!0}},nonNullable:!0})],P_.prototype,"size",void 0),d([m({type:Yu,json:{write:!0}})],P_.prototype,"material",void 0),d([m({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],P_.prototype,"castShadows",void 0),d([m(ZEe)],P_.prototype,"edges",void 0),P_=Kq=d([V("esri.symbols.ExtrudeSymbol3DLayer")],P_);const JEe=P_;let eM=class extends su{constructor(e){super(e),this.type="simple-line",this.width=.75}hash(){return`${this.type}.${this.width}`}};d([It({esriSLS:"simple-line"},{readOnly:!0})],eM.prototype,"type",void 0),d([m({type:Number,cast:kn,json:{write:!0}})],eM.prototype,"width",void 0),eM=d([V("esri.symbols.LineSymbol")],eM);const _et=eM,vet=["begin","end","begin-end"],QEe=["arrow","circle","square","diamond","cross","x"];var eY;let Kf=eY=class extends ze{constructor(t){super(t),this.placement="begin-end",this.type="line-marker",this.style="arrow"}writeStyle(t,e,r,i){e[r]=(i==null?void 0:i.origin)==="web-map"?"arrow":t}set color(t){this._set("color",t)}readColor(t){return(t==null?void 0:t[0])!=null?[t[0],t[1],t[2],t[3]/255]:t}writeColor(t,e,r,i){(i==null?void 0:i.origin)==="web-map"||(e[r]=t)}clone(){return new eY({color:_e(this.color),placement:this.placement,style:this.style})}hash(){var t;return`${this.placement}.${(t=this.color)==null?void 0:t.hash()}.${this.style}`}};d([m({type:["begin","end","begin-end"],json:{write:!0}})],Kf.prototype,"placement",void 0),d([It({"line-marker":"line-marker"},{readOnly:!0}),m({json:{origins:{"web-map":{write:!1}}}})],Kf.prototype,"type",void 0),d([m({type:QEe})],Kf.prototype,"style",void 0),d([hr("style")],Kf.prototype,"writeStyle",null),d([m({type:Xe,value:null,json:{write:{allowNull:!0}}})],Kf.prototype,"color",null),d([Tr("color")],Kf.prototype,"readColor",null),d([hr("color")],Kf.prototype,"writeColor",null),Kf=eY=d([V("esri.symbols.LineSymbolMarker")],Kf);const bet=Kf;var tY;const SV=new yn({esriSLSSolid:"solid",esriSLSDash:"dash",esriSLSDot:"dot",esriSLSDashDot:"dash-dot",esriSLSDashDotDot:"long-dash-dot-dot",esriSLSNull:"none",esriSLSInsideFrame:"inside-frame",esriSLSShortDash:"short-dash",esriSLSShortDot:"short-dot",esriSLSShortDashDot:"short-dash-dot",esriSLSShortDashDotDot:"short-dash-dot-dot",esriSLSLongDash:"long-dash",esriSLSLongDashDot:"long-dash-dot"});let Jg=tY=class extends _et{constructor(...t){super(...t),this.type="simple-line",this.style="solid",this.cap="round",this.join="round",this.marker=null,this.miterLimit=2}normalizeCtorArgs(t,e,r,i,n,s){if(t&&typeof t!="string")return t;const o={};return t!=null&&(o.style=t),e!=null&&(o.color=e),r!=null&&(o.width=kn(r)),i!=null&&(o.cap=i),n!=null&&(o.join=n),s!=null&&(o.miterLimit=kn(s)),o}clone(){var t;return new tY({color:_e(this.color),style:this.style,width:this.width,cap:this.cap,join:this.join,miterLimit:this.miterLimit,marker:(t=this.marker)==null?void 0:t.clone()})}hash(){var t,e;return`${super.hash()}.${(t=this.color)==null?void 0:t.hash()}.${this.style}.${this.cap}.${this.join}.${this.miterLimit}.${(e=this.marker)==null?void 0:e.hash()}`}};d([It({esriSLS:"simple-line"},{readOnly:!0})],Jg.prototype,"type",void 0),d([m({type:SV.apiValues,json:{read:SV.read,write:SV.write}})],Jg.prototype,"style",void 0),d([m({type:["butt","round","square"],json:{write:{overridePolicy:(t,e,r)=>({enabled:t!=="round"&&(r==null?void 0:r.origin)==null})}}})],Jg.prototype,"cap",void 0),d([m({type:["miter","round","bevel"],json:{write:{overridePolicy:(t,e,r)=>({enabled:t!=="round"&&(r==null?void 0:r.origin)==null})}}})],Jg.prototype,"join",void 0),d([m({types:{key:"type",base:null,defaultKeyValue:"line-marker",typeMap:{"line-marker":bet}},json:{write:!0,origins:{"web-scene":{write:!1}}}})],Jg.prototype,"marker",void 0),d([m({type:Number,json:{read:!1,write:!1}})],Jg.prototype,"miterLimit",void 0),Jg=tY=d([V("esri.symbols.SimpleLineSymbol")],Jg);const vy=Jg;let tM=class extends su{constructor(e){super(e),this.outline=null,this.type=null}hash(){return`${this.type}.${this.outline&&this.outline.hash()}`}};d([m({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":vy}},json:{default:null,write:!0}})],tM.prototype,"outline",void 0),d([m({type:["simple-fill","picture-fill"],readOnly:!0})],tM.prototype,"type",void 0),tM=d([V("esri.symbols.FillSymbol")],tM);const KEe=tM;let F5=class extends ze{constructor(e){super(e)}clone(){}};d([m({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],F5.prototype,"type",void 0),F5=d([V("esri.symbols.patterns.LinePattern3D")],F5);const e3e=F5,wet=["dash","dash-dot","dot","long-dash","long-dash-dot","long-dash-dot-dot","none","short-dash","short-dash-dot","short-dash-dot-dot","short-dot","solid"];var rY;const xet=ac()({dash:"dash","dash-dot":"dash-dot","dash-dot-dot":"long-dash-dot-dot",dot:"dot","long-dash":"long-dash","long-dash-dot":"long-dash-dot",null:"none","short-dash":"short-dash","short-dash-dot":"short-dash-dot","short-dash-dot-dot":"short-dash-dot-dot","short-dot":"short-dot",solid:"solid"});let rM=rY=class extends e3e{constructor(t){super(t),this.type="style",this.style="solid"}clone(){const t={style:this.style};return new rY(t)}};d([m({type:["style"]})],rM.prototype,"type",void 0),d([It(xet),m({type:wet})],rM.prototype,"style",void 0),rM=rY=d([V("esri.symbols.patterns.LineStylePattern3D")],rM);const Ote=rM;let k5=class extends ze{constructor(e){super(e)}clone(){}};d([m({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],k5.prototype,"type",void 0),k5=d([V("esri.symbols.patterns.Pattern3D")],k5);const t3e=k5,Tet=["backward-diagonal","cross","diagonal-cross","forward-diagonal","horizontal","none","solid","vertical"];var iY;let iM=iY=class extends t3e{constructor(t){super(t),this.type="style",this.style="solid"}clone(){const t={style:this.style};return new iY(t)}};d([m({type:["style"]})],iM.prototype,"type",void 0),d([m({type:Tet,json:{read:!0,write:!0}})],iM.prototype,"style",void 0),iM=iY=d([V("esri.symbols.patterns.StylePattern3D")],iM);const r3e=iM,Cet={types:{key:"type",base:t3e,typeMap:{style:r3e}},json:{write:!0}},i3e={types:{key:"type",base:e3e,typeMap:{style:Ote}},json:{write:!0}},rR=new Xe("white");new Xe("black");const Eet=new Xe([255,255,255,0]);function Pet(t){return t.r===0&&t.g===0&&t.b===0}var nY;let iR=nY=class extends Yu{constructor(t){super(t),this.colorMixMode=null}clone(){const t={color:this.color!=null?this.color.clone():null,colorMixMode:this.colorMixMode};return new nY(t)}};d([It({multiply:"multiply",replace:"replace",tint:"tint"})],iR.prototype,"colorMixMode",void 0),iR=nY=d([V("esri.symbols.support.Symbol3DFillMaterial")],iR);function vs(t=Lte){return[t[0],t[1],t[2],t[3],t[4],t[5]]}function u2(t,e,r,i,n,s,o=vs()){return o[0]=t,o[1]=e,o[2]=r,o[3]=i,o[4]=n,o[5]=s,o}function K6t(t,e){const r=isFinite(t[2])||isFinite(t[5]);return new ei(r?{xmin:t[0],xmax:t[3],ymin:t[1],ymax:t[4],zmin:t[2],zmax:t[5],spatialReference:e}:{xmin:t[0],xmax:t[3],ymin:t[1],ymax:t[4],spatialReference:e})}function t3(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.min(t[2],e[2]),t[3]=Math.max(t[3],e[3]),t[4]=Math.max(t[4],e[4]),t[5]=Math.max(t[5],e[5])}function Aet(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[3]=Math.max(t[3],e[2]),t[4]=Math.max(t[4],e[3])}function lf(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.min(t[2],e[2]),t[3]=Math.max(t[3],e[0]),t[4]=Math.max(t[4],e[1]),t[5]=Math.max(t[5],e[2])}function Hc(t,e,r=0,i=e.length/3){let n=t[0],s=t[1],o=t[2],a=t[3],l=t[4],c=t[5];for(let u=0;u<i;u++)n=Math.min(n,e[r+3*u]),s=Math.min(s,e[r+3*u+1]),o=Math.min(o,e[r+3*u+2]),a=Math.max(a,e[r+3*u]),l=Math.max(l,e[r+3*u+1]),c=Math.max(c,e[r+3*u+2]);t[0]=n,t[1]=s,t[2]=o,t[3]=a,t[4]=l,t[5]=c}function CV(t,e,r){const i=e.length;let n=t[0],s=t[1],o=t[2],a=t[3],l=t[4],c=t[5];if(r)for(let u=0;u<i;u++){const h=e[u];n=Math.min(n,h[0]),s=Math.min(s,h[1]),o=Math.min(o,h[2]),a=Math.max(a,h[0]),l=Math.max(l,h[1]),c=Math.max(c,h[2])}else for(let u=0;u<i;u++){const h=e[u];n=Math.min(n,h[0]),s=Math.min(s,h[1]),a=Math.max(a,h[0]),l=Math.max(l,h[1])}t[0]=n,t[1]=s,t[2]=o,t[3]=a,t[4]=l,t[5]=c}function Met(t){for(let e=0;e<6;e++)if(!isFinite(t[e]))return!1;return!0}function N2(t){return t[0]>=t[3]?0:t[3]-t[0]}function F2(t){return t[1]>=t[4]?0:t[4]-t[1]}function kv(t){return t[2]>=t[5]?0:t[5]-t[2]}function n3e(t){const e=N2(t),r=kv(t),i=F2(t);return Math.sqrt(e*e+r*r+i*i)}function kp(t,e=[0,0,0]){return e[0]=t[0]+N2(t)/2,e[1]=t[1]+F2(t)/2,e[2]=t[2]+kv(t)/2,e}function $D(t,e=[0,0,0]){return e[0]=N2(t),e[1]=F2(t),e[2]=kv(t),e}function Rte(t,e){return e[0]>=t[0]&&e[1]>=t[1]&&e[2]>=t[2]&&e[0]<=t[3]&&e[1]<=t[4]&&e[2]<=t[5]}function e8t(t,e){return e[0]>=t[0]&&e[1]>=t[1]&&e[2]>=t[2]&&e[3]<=t[3]&&e[4]<=t[4]&&e[5]<=t[5]}function Oet(t,e){return Math.max(e[0],t[0])<=Math.min(e[3],t[3])&&Math.max(e[1],t[1])<=Math.min(e[4],t[4])&&Math.max(e[2],t[2])<=Math.min(e[5],t[5])}function zp(t,e){return e==null||Oet(t,e)}function s3e(t,e,r,i,n=t){return n[0]=t[0]+e,n[1]=t[1]+r,n[2]=t[2]+i,n[3]=t[3]+e,n[4]=t[4]+r,n[5]=t[5]+i,n}function t8t(t,e,r=t){const i=t[0]+N2(t)/2,n=t[1]+F2(t)/2,s=t[2]+kv(t)/2;return r[0]=i+(t[0]-i)*e,r[1]=n+(t[1]-n)*e,r[2]=s+(t[2]-s)*e,r[3]=i+(t[3]-i)*e,r[4]=n+(t[4]-n)*e,r[5]=s+(t[5]-s)*e,r}function o3e(t,e,r=t){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r!==t&&(r[3]=t[3],r[4]=t[4],r[5]=t[5]),r}function a3e(t,e,r=t){return r[3]=e[0],r[4]=e[1],r[5]=e[2],r!==t&&(r[0]=t[0],r[1]=t[1],r[2]=t[2]),t}function Y9(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function Li(t){return t?Y9(t,kce):vs(kce)}function $te(t,e){return e||(e=Wt()),e[0]=t[0],e[1]=t[1],e[2]=t[3],e[3]=t[4],e}function r8t(t,e){return t[0]=e[0],t[1]=e[1],t[2]=Number.NEGATIVE_INFINITY,t[3]=e[2],t[4]=e[3],t[5]=Number.POSITIVE_INFINITY,t}function Ret(t,e,r,i,n){return t[0]=e,t[1]=r,t[2]=Number.NEGATIVE_INFINITY,t[3]=i,t[4]=n,t[5]=Number.POSITIVE_INFINITY,t}function sY(t){return t.length===6}function Ite(t){return N2(t)===0&&F2(t)===0&&kv(t)===0}function i8t(t,e,r){if(t==null||e==null)return t===e;if(!sY(t)||!sY(e))return!1;if(r){for(let i=0;i<t.length;i++)if(!r(t[i],e[i]))return!1}else for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}function $et(t,e,r,i,n,s){return u2(t,e,r,i,n,s,Iet)}const n8t=[-1/0,-1/0,-1/0,1/0,1/0,1/0],kce=[1/0,1/0,1/0,-1/0,-1/0,-1/0],Lte=[0,0,0,0,0,0],Iet=vs();function EV(t,{isPrimitive:e,width:r,depth:i,height:n}){const s=e?10:1;if(r==null&&n==null&&i==null)return[s*t[0],s*t[1],s*t[2]];const o=Ce(r,i,n);let a;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/t[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=t[l]*a);return o}const Let=u2(-.5,-.5,-.5,.5,.5,.5),Det=u2(-.5,-.5,0,.5,.5,1),Net=u2(-.5,-.5,0,.5,.5,.5);function Fet(t){switch(t){case"sphere":case"cube":case"diamond":return Let;case"cylinder":case"cone":case"inverted-cone":return Det;case"tetrahedron":return Net;default:return}}const Dte=["butt","square","round"],ket=[...Dte,"none"],l3e=["miter","bevel","round"];var oY;let Kb=oY=class extends ze{constructor(t){super(t),this.color=new Xe([0,0,0,1]),this.size=xl(1),this.pattern=null,this.patternCap="butt"}clone(){const t={color:this.color!=null?this.color.clone():null,size:this.size,pattern:this.pattern!=null?this.pattern.clone():null,patternCap:this.patternCap};return new oY(t)}};d([m(_y)],Kb.prototype,"color",void 0),d([m(lg)],Kb.prototype,"size",void 0),d([m(i3e)],Kb.prototype,"pattern",void 0),d([m({type:Dte,json:{default:"butt",write:{overridePolicy(){return{enabled:this.pattern!=null}}}}})],Kb.prototype,"patternCap",void 0),Kb=oY=d([V("esri.symbols.support.Symbol3DOutline")],Kb);var z5;let Qg=z5=class extends yg{constructor(t){super(t),this.type="fill",this.material=null,this.pattern=null,this.castShadows=!0,this.outline=null,this.edges=null}clone(){const t={edges:this.edges!=null?this.edges.clone():null,enabled:this.enabled,material:this.material!=null?this.material.clone():null,pattern:this.pattern!=null?this.pattern.clone():null,castShadows:this.castShadows,outline:this.outline!=null?this.outline.clone():null};return new z5(t)}static fromSimpleFillSymbol(t){var i,n,s;const e=t.outline&&t.outline.style&&t.outline.style!=="inside-frame"&&t.outline.style!=="solid"?new Ote({style:t.outline.style}):null,r={size:((i=t.outline)==null?void 0:i.width)??0,color:(((n=t.outline)==null?void 0:n.color)??rR).clone(),pattern:e};return e&&((s=t.outline)!=null&&s.cap)&&(r.patternCap=t.outline.cap),new z5({material:new iR({color:(t.color??Eet).clone()}),pattern:t.style&&t.style!=="solid"?new r3e({style:t.style}):null,outline:r})}};d([It({Fill:"fill"},{readOnly:!0})],Qg.prototype,"type",void 0),d([m({type:iR,json:{write:!0}})],Qg.prototype,"material",void 0),d([m(Cet)],Qg.prototype,"pattern",void 0),d([m({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Qg.prototype,"castShadows",void 0),d([m({type:Kb,json:{write:!0}})],Qg.prototype,"outline",void 0),d([m(ZEe)],Qg.prototype,"edges",void 0),Qg=z5=d([V("esri.symbols.FillSymbol3DLayer")],Qg);const k2=Qg,zet=["none","underline","line-through"],Uet=["normal","italic","oblique"],Bet=["normal","lighter","bold","bolder"],c3e={type:Number,cast:t=>{const e=Ep(t);return e===0?1:we(e,.1,4)},nonNullable:!0},Vet=["left","right","center"],Get=["baseline","top","middle","bottom"],u3e={type:Vet,nonNullable:!0},h3e={type:Get,nonNullable:!0},jet=8;var aY;let Kg=aY=class extends ze{constructor(t){super(t),this.decoration="none",this.family="sans-serif",this.size=9,this.style="normal",this.weight="normal"}castSize(t){return kn(t)}clone(){return new aY({decoration:this.decoration,family:this.family,size:this.size,style:this.style,weight:this.weight})}hash(){return`${this.decoration}.${this.family}.${this.size}.${this.style}.${this.weight}`}};d([m({type:zet,json:{default:"none",write:!0}})],Kg.prototype,"decoration",void 0),d([m({type:String,json:{write:!0}})],Kg.prototype,"family",void 0),d([m({type:Number,json:{write:{overridePolicy:(t,e,r)=>({enabled:!r||!r.textSymbol3D})}}})],Kg.prototype,"size",void 0),d([ai("size")],Kg.prototype,"castSize",null),d([m({type:Uet,json:{default:"normal",write:!0}})],Kg.prototype,"style",void 0),d([m({type:Bet,json:{default:"normal",write:!0}})],Kg.prototype,"weight",void 0),Kg=aY=d([V("esri.symbols.Font")],Kg);const zI=Kg;var lY;const Het=ac()({circle:"circle",square:"square",cross:"cross",x:"x",kite:"kite",triangle:"triangle"});let ew=lY=class extends ze{constructor(t){super(t)}readHref(t,e,r){return t?t2(t,r):e.dataURI}writeHref(t,e,r,i){t&&(mg(t)?e.dataURI=t:(e.href=OE(t,i),ju(e.href)&&(e.href=L0(e.href))))}clone(){return new lY({href:this.href,primitive:this.primitive})}};d([m({type:String,json:{write:!0,read:{source:["href","dataURI"]}}})],ew.prototype,"href",void 0),d([Tr("href")],ew.prototype,"readHref",null),d([hr("href",{href:{type:String},dataURI:{type:String}})],ew.prototype,"writeHref",null),d([It(Het)],ew.prototype,"primitive",void 0),ew=lY=d([V("esri.symbols.support.IconSymbol3DLayerResource")],ew);const Wet="circle";var cY;let dx=cY=class extends Ae{constructor(){super(...arguments),this.x=0,this.y=0}clone(){return new cY({x:this.x,y:this.y})}};d([m({type:Number})],dx.prototype,"x",void 0),d([m({type:Number})],dx.prototype,"y",void 0),dx=cY=d([V("esri.symbols.support.Symbol3DAnchorPosition2D")],dx);var uY;let nM=uY=class extends ze{constructor(t){super(t),this.color=new Xe([0,0,0,1]),this.size=xl(1)}clone(){const t={color:this.color!=null?this.color.clone():null,size:this.size};return new uY(t)}};d([m(_y)],nM.prototype,"color",void 0),d([m(lg)],nM.prototype,"size",void 0),nM=uY=d([V("esri.symbols.support.Symbol3DIconOutline")],nM);var mS;const d3e="esri.symbols.IconSymbol3DLayer";let em=mS=class extends yg{constructor(t){super(t),this.material=null,this.resource=null,this.type="icon",this.size=12,this.anchor="center",this.anchorPosition=null,this.outline=null}clone(){return new mS({anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),enabled:this.enabled,material:this.material!=null?this.material.clone():null,outline:this.outline!=null?this.outline.clone():null,resource:this.resource&&this.resource.clone(),size:this.size})}static fromSimpleMarkerSymbol(t){const e=t.color||rR,r=zce(t),i=t.outline&&t.outline.width>0?{size:t.outline.width,color:(t.outline.color||rR).clone()}:null;return new mS({size:t.size,resource:{primitive:Yet(t.style)},material:{color:e},outline:i,anchor:r?"relative":void 0,anchorPosition:r})}static fromPictureMarkerSymbol(t){const e=!t.color||Pet(t.color)?rR:t.color,r=zce(t);return new mS({size:t.width<=t.height?t.height:t.width,resource:{href:t.url},material:{color:e.clone()},anchor:r?"relative":void 0,anchorPosition:r})}static fromCIMSymbol(t){return new mS({resource:{href:bwe({mediaType:"application/json",data:JSON.stringify(t.data)})}})}};function zce(t){const e="width"in t?t.width:t.size,r="height"in t?t.height:t.size,i=Uce(t.xoffset),n=Uce(t.yoffset);return(i||n)&&e&&r?{x:-i/e,y:n/r}:null}function Uce(t){return isFinite(t)?t:0}d([m({type:Yu,json:{write:!0}})],em.prototype,"material",void 0),d([m({type:ew,json:{write:!0}})],em.prototype,"resource",void 0),d([It({Icon:"icon"},{readOnly:!0})],em.prototype,"type",void 0),d([m(lg)],em.prototype,"size",void 0),d([It({center:"center",left:"left",right:"right",top:"top",bottom:"bottom",topLeft:"top-left",topRight:"top-right",bottomLeft:"bottom-left",bottomRight:"bottom-right",relative:"relative"}),m({json:{default:"center"}})],em.prototype,"anchor",void 0),d([m({type:dx,json:{type:[Number],read:{reader:t=>new dx({x:t[0],y:t[1]})},write:{writer:(t,e)=>{e.anchorPosition=[t.x,t.y]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],em.prototype,"anchorPosition",void 0),d([m({type:nM,json:{write:!0}})],em.prototype,"outline",void 0),em=mS=d([V(d3e)],em);const qet={circle:"circle",cross:"cross",diamond:"kite",square:"square",x:"x",triangle:"triangle",path:null};function Yet(t){return qet[t]||(re.getLogger(d3e).warn(`${t} cannot be mapped to Icon symbol. Fallback to "circle"`),"circle")}const C1=em;let tw=class extends nh(ze){constructor(e){super(e),this.type="style",this.placement="begin-end",this.style="arrow",this.color=null}equals(e){return e!=null&&e.placement===this.placement&&e.style===this.style&&(this.color==null&&e.color==null||this.color!=null&&e.color!=null&&this.color.toJSON()===e.color.toJSON())}};d([m({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],tw.prototype,"type",void 0),d([m({type:vet,json:{default:"begin-end",write:!0}})],tw.prototype,"placement",void 0),d([m({type:QEe,json:{default:"arrow",write:!0}})],tw.prototype,"style",void 0),d([m({type:Xe,json:{type:[fn],default:null,write:!0}})],tw.prototype,"color",void 0),tw=d([V("esri.symbols.LineStyleMarker3D")],tw);const hY=tw;var U5;let tm=U5=class extends yg{constructor(t){super(t),this.material=null,this.type="line",this.join="miter",this.cap="butt",this.size=xl(1),this.pattern=null,this.marker=null}clone(){const t={enabled:this.enabled,material:this.material!=null?this.material.clone():null,size:this.size,join:this.join,cap:this.cap,pattern:this.pattern!=null?this.pattern.clone():null,marker:this.marker!=null?this.marker.clone():null};return new U5(t)}static fromSimpleLineSymbol(t){var r;const e={enabled:!0,size:t.width??xl(1),cap:t.cap||"butt",join:t.join||"miter",pattern:t.style&&t.style!=="inside-frame"?new Ote({style:t.style}):null,material:new Yu({color:(t.color||rR).clone()}),marker:t.marker?new hY({placement:t.marker.placement,style:t.marker.style,color:((r=t.marker.color)==null?void 0:r.clone())??null}):null};return new U5(e)}};d([m({type:Yu,json:{write:!0}})],tm.prototype,"material",void 0),d([It({Line:"line"},{readOnly:!0})],tm.prototype,"type",void 0),d([m({type:l3e,json:{write:!0,default:"miter"}})],tm.prototype,"join",void 0),d([m({type:Dte,json:{write:!0,default:"butt"}})],tm.prototype,"cap",void 0),d([m(lg)],tm.prototype,"size",void 0),d([m(i3e)],tm.prototype,"pattern",void 0),d([m({types:{key:"type",base:hY,typeMap:{style:hY}},json:{write:!0}})],tm.prototype,"marker",void 0),tm=U5=d([V("esri.symbols.LineSymbol3DLayer")],tm);const UI=tm;var dY;const Xet=ac()({sphere:"sphere",cylinder:"cylinder",cube:"cube",cone:"cone",diamond:"diamond",tetrahedron:"tetrahedron",invertedCone:"inverted-cone"});let sM=dY=class extends ze{clone(){return new dY({href:this.href,primitive:this.primitive})}};d([m({type:String,json:{read:tee,write:r2}})],sM.prototype,"href",void 0),d([It(Xet)],sM.prototype,"primitive",void 0),sM=dY=d([V("esri.symbols.support.ObjectSymbol3DLayerResource")],sM);const p3e="sphere";var pY;let Bw=pY=class extends Ae{constructor(){super(...arguments),this.x=0,this.y=0,this.z=0}clone(){return new pY({x:this.x,y:this.y,z:this.z})}};d([m({type:Number})],Bw.prototype,"x",void 0),d([m({type:Number})],Bw.prototype,"y",void 0),d([m({type:Number})],Bw.prototype,"z",void 0),Bw=pY=d([V("esri.symbols.support.Symbol3DAnchorPosition3D")],Bw);var fY;let el=fY=class extends yg{constructor(t){super(t),this.material=null,this.castShadows=!0,this.resource=null,this.type="object",this.width=void 0,this.height=void 0,this.depth=void 0,this.anchor=void 0,this.anchorPosition=void 0,this.heading=void 0,this.tilt=void 0,this.roll=void 0}clone(){var t,e,r;return new fY({heading:this.heading,tilt:this.tilt,roll:this.roll,anchor:this.anchor,anchorPosition:(t=this.anchorPosition)==null?void 0:t.clone(),depth:this.depth,enabled:this.enabled,height:this.height,material:((e=this.material)==null?void 0:e.clone())??null,castShadows:this.castShadows,resource:(r=this.resource)==null?void 0:r.clone(),width:this.width})}get isPrimitive(){return!this.resource||typeof this.resource.href!="string"}};d([m({type:Yu,json:{write:!0}})],el.prototype,"material",void 0),d([m({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],el.prototype,"castShadows",void 0),d([m({type:sM,json:{write:!0}})],el.prototype,"resource",void 0),d([It({Object:"object"},{readOnly:!0})],el.prototype,"type",void 0),d([m({type:Number,json:{write:!0}})],el.prototype,"width",void 0),d([m({type:Number,json:{write:!0}})],el.prototype,"height",void 0),d([m({type:Number,json:{write:!0}})],el.prototype,"depth",void 0),d([It({center:"center",top:"top",bottom:"bottom",origin:"origin",relative:"relative"}),m({json:{default:"origin"}})],el.prototype,"anchor",void 0),d([m({type:Bw,json:{type:[Number],read:{reader:t=>new Bw({x:t[0],y:t[1],z:t[2]})},write:{writer:(t,e)=>{e.anchorPosition=[t.x,t.y,t.z]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],el.prototype,"anchorPosition",void 0),d([m({type:Number,json:{write:!0}})],el.prototype,"heading",void 0),d([m({type:Number,json:{write:!0}})],el.prototype,"tilt",void 0),d([m({type:Number,json:{write:!0}})],el.prototype,"roll",void 0),d([m({readOnly:!0})],el.prototype,"isPrimitive",null),el=fY=d([V("esri.symbols.ObjectSymbol3DLayer")],el);const Nte=el;var mY;let Fl=mY=class extends yg{constructor(t){super(t),this.material=null,this.castShadows=!0,this.type="path",this.profile="circle",this.join="miter",this.cap="butt",this.width=void 0,this.height=void 0,this.anchor="center",this.profileRotation="all"}readWidth(t,e){return t??(e.height==null&&e.size!=null?e.size:void 0)}readHeight(t,e){return t??(e.width==null&&e.size!=null?e.size:void 0)}clone(){return new mY({enabled:this.enabled,material:this.material!=null?this.material.clone():null,castShadows:this.castShadows,profile:this.profile,join:this.join,cap:this.cap,width:this.width,height:this.height,profileRotation:this.profileRotation,anchor:this.anchor})}};d([m({type:Yu,json:{write:!0}})],Fl.prototype,"material",void 0),d([m({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Fl.prototype,"castShadows",void 0),d([It({Path:"path"},{readOnly:!0})],Fl.prototype,"type",void 0),d([m({type:["circle","quad"],json:{write:!0,default:"circle"}})],Fl.prototype,"profile",void 0),d([m({type:l3e,json:{write:!0,default:"miter"}})],Fl.prototype,"join",void 0),d([m({type:ket,json:{write:!0,default:"butt"}})],Fl.prototype,"cap",void 0),d([m({type:Number,json:{write:{enabled:!0,target:{width:{type:Number},size:{type:Number}}}}})],Fl.prototype,"width",void 0),d([Tr("width",["width","size","height"])],Fl.prototype,"readWidth",null),d([m({type:Number,json:{write:!0}})],Fl.prototype,"height",void 0),d([Tr("height",["height","size","width"])],Fl.prototype,"readHeight",null),d([m({type:["center","bottom","top"],json:{write:!0,default:"center"}})],Fl.prototype,"anchor",void 0),d([m({type:["heading","all"],json:{write:!0,default:"all"}})],Fl.prototype,"profileRotation",void 0),Fl=mY=d([V("esri.symbols.PathSymbol3DLayer")],Fl);const Fte=Fl;var gY;let aC=gY=class extends ze{constructor(){super(...arguments),this.color=new Xe([0,0,0,1]),this.size=0}clone(){const t={color:_e(this.color),size:this.size};return new gY(t)}};d([m(_y)],aC.prototype,"color",void 0),d([m(lg)],aC.prototype,"size",void 0),aC=gY=d([V("esri.symbols.support.Symbol3DHalo")],aC);let nR=class extends nh(ze){constructor(e){super(e),this.color=null}};d([m(_y)],nR.prototype,"color",void 0),nR=d([V("esri.symbols.support.Symbol3DTextBackground")],nR);var B5;let vc=B5=class extends yg{constructor(t){super(t),this._userSize=void 0,this.halo=null,this.horizontalAlignment="center",this.lineHeight=1,this.material=null,this.background=null,this.text=null,this.type="text",this.verticalAlignment="baseline"}get font(){return this._get("font")||null}set font(t){t!=null&&this._userSize!=null&&(t.size=this._userSize),this._set("font",t)}writeFont(t,e,r,i){const n={...i,textSymbol3D:!0};e.font=t.write({},n),delete e.font.size}get size(){var t;return this._userSize!=null?this._userSize:((t=this.font)==null?void 0:t.size)!=null?this.font.size:9}set size(t){this._userSize=t,this.font!=null&&(this.font.size=this._userSize),this.notifyChange("size")}clone(){const t=new B5({enabled:this.enabled,font:this.font&&_e(this.font),halo:this.halo&&_e(this.halo),horizontalAlignment:this.horizontalAlignment,lineHeight:this.lineHeight,material:this.material!=null?this.material.clone():null,text:this.text,verticalAlignment:this.verticalAlignment,background:_e(this.background)});return t._userSize=this._userSize,t}static fromTextSymbol(t){return new B5({font:t.font!=null?t.font.clone():new zI,halo:Zet(t.haloColor,t.haloSize),horizontalAlignment:t.horizontalAlignment,lineHeight:t.lineHeight,material:t.color?new Yu({color:t.color.clone()}):null,text:t.text,verticalAlignment:t.verticalAlignment,background:t.backgroundColor?new nR({color:t.backgroundColor.clone()}):null})}};function Zet(t,e){return t&&e!=null&&e>0?new aC({color:_e(t),size:e}):null}d([m({type:zI,json:{write:!0}})],vc.prototype,"font",null),d([hr("font")],vc.prototype,"writeFont",null),d([m({type:aC,json:{write:!0}})],vc.prototype,"halo",void 0),d([m({...u3e,json:{default:"center",write:!0}})],vc.prototype,"horizontalAlignment",void 0),d([m({...c3e,json:{default:1,write:!0}})],vc.prototype,"lineHeight",void 0),d([m({type:Yu,json:{write:!0}})],vc.prototype,"material",void 0),d([m({type:nR,json:{write:!0}})],vc.prototype,"background",void 0),d([m(lg)],vc.prototype,"size",null),d([m({type:String,json:{write:!0}})],vc.prototype,"text",void 0),d([It({Text:"text"},{readOnly:!0})],vc.prototype,"type",void 0),d([m({...h3e,json:{default:"baseline",write:!0}})],vc.prototype,"verticalAlignment",void 0),vc=B5=d([V("esri.symbols.TextSymbol3DLayer")],vc);const z2=vc;var yY;let A_=yY=class extends yg{constructor(t){super(t),this.color=_Y.clone(),this.type="water",this.waterbodySize="medium",this.waveDirection=null,this.waveStrength="moderate"}clone(){return new yY({color:_e(this.color),waterbodySize:this.waterbodySize,waveDirection:this.waveDirection,waveStrength:this.waveStrength})}};d([m({type:Xe,nonNullable:!0,json:{type:[fn],write:(t,e,r)=>e[r]=t.toArray(Xe.AlphaMode.UNLESS_OPAQUE),default:()=>_Y.clone(),defaultEquals:t=>t.toCss(!0)===_Y.toCss(!0)}})],A_.prototype,"color",void 0),d([It({Water:"water"},{readOnly:!0})],A_.prototype,"type",void 0),d([m({type:["small","medium","large"],json:{write:!0,default:"medium"}})],A_.prototype,"waterbodySize",void 0),d([m({type:Number,json:{write:!0,default:null}})],A_.prototype,"waveDirection",void 0),d([m({type:["calm","rippled","slight","moderate"],json:{write:!0,default:"moderate"}})],A_.prototype,"waveStrength",void 0),A_=yY=d([V("esri.symbols.WaterSymbol3DLayer")],A_);const _Y=new Xe([0,119,190]),f3e=A_;var vY;let rw=vY=class extends Ae{constructor(t){super(t),this.name=null,this.styleUrl=null,this.styleName=null,this.portal=null}clone(){return new vY({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}};d([m({type:String})],rw.prototype,"name",void 0),d([m({type:String})],rw.prototype,"styleUrl",void 0),d([m({type:String})],rw.prototype,"styleName",void 0),d([m({type:ud})],rw.prototype,"portal",void 0),rw=vY=d([V("esri.symbols.support.StyleOrigin")],rw);const O$=rw;var bY;let Mx=bY=class extends Ae{constructor(){super(...arguments),this.url=""}clone(){return new bY({url:this.url})}};d([m({type:String})],Mx.prototype,"url",void 0),Mx=bY=d([V("esri.symbols.support.Thumbnail")],Mx);const m3e={icon:C1,object:Nte,line:UI,path:Fte,fill:k2,extrude:JEe,text:z2,water:f3e},Jet=$t.ofType({base:yg,key:"type",typeMap:m3e,errorContext:"symbol-layer"});let rm=class extends su{constructor(e){super(e),this.styleOrigin=null,this.thumbnail=null,this.type=null;const r=this.__accessor__&&this.__accessor__.metadata&&this.__accessor__.metadata.symbolLayers,i=r==null?void 0:r.type,n=i||$t;this._set("symbolLayers",new n)}get color(){return null}set color(e){this.constructed&&re.getLogger(this).error("Symbol3D does not support colors on the symbol level. Colors may be set on individual symbol layer materials instead.")}set symbolLayers(e){Xx(e,this._get("symbolLayers"))}readStyleOrigin(e,r,i){if(e.styleUrl&&e.name){const n=t2(e.styleUrl,i);return new O$({styleUrl:n,name:e.name})}if(e.styleName&&e.name)return new O$({portal:(i==null?void 0:i.portal)||ud.getDefault(),styleName:e.styleName,name:e.name});i!=null&&i.messages&&i.messages.push(new tv("symbol3d:incomplete-style-origin","Style origin requires either a 'styleUrl' or 'styleName' and a 'name' property",{context:i,definition:e}))}writeStyleOrigin(e,r,i,n){if(e.styleUrl&&e.name){let s=OE(e.styleUrl,n);ju(s)&&(s=L0(s)),r.styleOrigin={styleUrl:s,name:e.name}}else e.styleName&&e.name&&(e.portal&&(n!=null&&n.portal)&&!kUe(e.portal.restUrl,n.portal.restUrl)?n!=null&&n.messages&&n.messages.push(new tv("symbol:cross-portal","The symbol style origin cannot be persisted because it refers to an item on a different portal than the one being saved to.",{symbol:this})):r.styleOrigin={styleName:e.styleName,name:e.name})}normalizeCtorArgs(e){return e instanceof yg||e&&m3e[e.type]?{symbolLayers:[e]}:Array.isArray(e)?{symbolLayers:e}:e}};d([m({json:{read:!1,write:!1}})],rm.prototype,"color",null),d([m({type:Jet,nonNullable:!0,json:{write:!0}}),ai(Dwe)],rm.prototype,"symbolLayers",null),d([m({type:O$})],rm.prototype,"styleOrigin",void 0),d([Tr("styleOrigin")],rm.prototype,"readStyleOrigin",null),d([hr("styleOrigin",{"styleOrigin.styleUrl":{type:String},"styleOrigin.styleName":{type:String},"styleOrigin.name":{type:String}})],rm.prototype,"writeStyleOrigin",null),d([m({type:Mx,json:{read:!1}})],rm.prototype,"thumbnail",void 0),d([m({type:["point-3d","line-3d","polygon-3d","mesh-3d","label-3d"],readOnly:!0})],rm.prototype,"type",void 0),rm=d([V("esri.symbols.Symbol3D")],rm);const V3=rm;let oM=class extends ze{constructor(e){super(e),this.visible=!0}clone(){}};d([m({type:["line"],constructOnly:!0,json:{read:!1,write:{ignoreOrigin:!0}}})],oM.prototype,"type",void 0),d([m({readOnly:!0})],oM.prototype,"visible",void 0),oM=d([V("esri.symbols.callouts.Callout3D")],oM);const g3e=oM;var wY;let V5=wY=class extends ze{constructor(t){super(t),this.color=new Xe("white")}clone(){return new wY({color:_e(this.color)})}};d([m(_y)],V5.prototype,"color",void 0),V5=wY=d([V("esri.symbols.callouts.LineCallout3DBorder")],V5);const Qet=V5;var xY;let M_=xY=class extends g3e{constructor(t){super(t),this.type="line",this.color=new Xe([0,0,0,1]),this.size=xl(1),this.border=null}get visible(){return this.size>0&&this.color!=null&&this.color.a>0}clone(){return new xY({color:_e(this.color),size:this.size,border:_e(this.border)})}};d([It({line:"line"})],M_.prototype,"type",void 0),d([m(_y)],M_.prototype,"color",void 0),d([m(lg)],M_.prototype,"size",void 0),d([m({type:Qet,json:{write:!0}})],M_.prototype,"border",void 0),d([m({readOnly:!0})],M_.prototype,"visible",null),M_=xY=d([V("esri.symbols.callouts.LineCallout3D")],M_);const y3e=M_;function kte(t){if(!t)return!1;const e=t.verticalOffset;return!!e&&!(e.screenLength<=0||e.maxWorldLength!=null&&e.maxWorldLength<=0)}function _3e(t){if(!t||!t.supportsCallout||!t.supportsCallout())return!1;const e=t.callout;return!!e&&!!e.visible&&!!kte(t)}function zte(t){return t.type==="point-3d"||t.type==="label-3d"}function v3e(t){return t.horizontalAlignment==="center"}const b3e={types:{key:"type",base:g3e,typeMap:{line:y3e}},json:{write:!0}};var TY;let gS=TY=class extends ze{constructor(t){super(t),this.screenLength=0,this.minWorldLength=0,this.maxWorldLength=null}clone(){return new TY({screenLength:this.screenLength,minWorldLength:this.minWorldLength,maxWorldLength:this.maxWorldLength})}};d([m(lg)],gS.prototype,"screenLength",void 0),d([m({type:Number,nonNullable:!0,json:{write:!0,default:0}})],gS.prototype,"minWorldLength",void 0),d([m({type:Number,json:{write:!0}})],gS.prototype,"maxWorldLength",void 0),gS=TY=d([V("esri.symbols.support.Symbol3DVerticalOffset")],gS);const Ute=gS;var G5;const w3e=$t.ofType({base:null,key:"type",typeMap:{text:z2}});let O_=G5=class extends V3{constructor(t){super(t),this.verticalOffset=null,this.callout=null,this.styleOrigin=null,this.symbolLayers=new w3e,this.type="label-3d"}supportsCallout(){return!0}hasVisibleCallout(){return _3e(this)}hasVisibleVerticalOffset(){return kte(this)}clone(){return new G5({styleOrigin:_e(this.styleOrigin),symbolLayers:_e(this.symbolLayers),thumbnail:_e(this.thumbnail),callout:_e(this.callout),verticalOffset:_e(this.verticalOffset)})}static fromTextSymbol(t){return new G5({symbolLayers:new $t([z2.fromTextSymbol(t)])})}};d([m({type:Ute,json:{write:!0}})],O_.prototype,"verticalOffset",void 0),d([m(b3e)],O_.prototype,"callout",void 0),d([m({json:{read:!1,write:!1}})],O_.prototype,"styleOrigin",void 0),d([m({type:w3e})],O_.prototype,"symbolLayers",void 0),d([It({LabelSymbol3D:"label-3d"},{readOnly:!0})],O_.prototype,"type",void 0),O_=G5=d([V("esri.symbols.LabelSymbol3D")],O_);const X9=O_;var j5;const x3e=$t.ofType({base:null,key:"type",typeMap:{line:UI,path:Fte}}),Ket=$t.ofType({base:null,key:"type",typeMap:{line:UI,path:Fte}});let aM=j5=class extends V3{constructor(t){super(t),this.symbolLayers=new x3e,this.type="line-3d"}clone(){return new j5({styleOrigin:_e(this.styleOrigin),symbolLayers:_e(this.symbolLayers),thumbnail:_e(this.thumbnail)})}static fromSimpleLineSymbol(t){return new j5({symbolLayers:new $t([UI.fromSimpleLineSymbol(t)])})}};d([m({type:x3e,json:{type:Ket}})],aM.prototype,"symbolLayers",void 0),d([It({LineSymbol3D:"line-3d"},{readOnly:!0})],aM.prototype,"type",void 0),aM=j5=d([V("esri.symbols.LineSymbol3D")],aM);const Z9=aM;let R_=class extends su{constructor(e){super(e),this.angle=0,this.type=null,this.xoffset=0,this.yoffset=0,this.size=9}hash(){return`${this.type}.${this.angle}.${this.size}.${this.xoffset}.${this.yoffset}`}};d([m({type:Number,json:{read:t=>t&&-1*t,write:(t,e)=>e.angle=t&&-1*t}})],R_.prototype,"angle",void 0),d([m({type:["simple-marker","picture-marker"],readOnly:!0})],R_.prototype,"type",void 0),d([m({type:Number,cast:kn,json:{write:!0}})],R_.prototype,"xoffset",void 0),d([m({type:Number,cast:kn,json:{write:!0}})],R_.prototype,"yoffset",void 0),d([m({type:Number,cast:t=>t==="auto"?t:kn(t),json:{write:!0}})],R_.prototype,"size",void 0),R_=d([V("esri.symbols.MarkerSymbol")],R_);const T3e=R_;var H5;const S3e=$t.ofType({base:null,key:"type",typeMap:{fill:k2}});let lM=H5=class extends V3{constructor(t){super(t),this.symbolLayers=new S3e,this.type="mesh-3d"}clone(){return new H5({styleOrigin:_e(this.styleOrigin),symbolLayers:_e(this.symbolLayers),thumbnail:_e(this.thumbnail)})}static fromSimpleFillSymbol(t){return new H5({symbolLayers:new $t([k2.fromSimpleFillSymbol(t)])})}};d([m({type:S3e})],lM.prototype,"symbolLayers",void 0),d([It({MeshSymbol3D:"mesh-3d"},{readOnly:!0})],lM.prototype,"type",void 0),lM=H5=d([V("esri.symbols.MeshSymbol3D")],lM);const G3=lM;function ett(t,e,r){return e.imageData?bwe({mediaType:e.contentType||"image/png",isBase64:!0,data:e.imageData}):C3e(e.url,r)}function C3e(t,e){var r;return rtt(e)&&!ju(t)&&((r=e==null?void 0:e.layer)!=null&&r.parsedUrl)?Bz(e.layer.parsedUrl.path,"images",t):t2(t,e)}function ttt(t,e,r,i){if(mg(t)){const n=rv(t);if(!n)return;e.contentType=n.mediaType,e.imageData=n.data,r&&r.imageData===e.imageData&&r.url&&r2(r.url,e,"url",i)}else r2(t,e,"url",i)}const E3e={json:{read:{source:["imageData","url"],reader:ett},write:{writer(t,e,r,i){ttt(t,e,this.source,i)}}}},P3e={readOnly:!0,json:{read:{source:["imageData","url"],reader(t,e,r){const i={};return e.imageData&&(i.imageData=e.imageData),e.contentType&&(i.contentType=e.contentType),e.url&&(i.url=C3e(e.url,r)),i}}}};function rtt(t){var e,r;return!(t==null||t.origin!=="service"&&t.origin!=="portal-item"||((e=t.layer)==null?void 0:e.type)!=="feature"&&((r=t.layer)==null?void 0:r.type)!=="stream")}var SY;let bh=SY=class extends KEe{constructor(...t){super(...t),this.type="picture-fill",this.url=null,this.xscale=1,this.yscale=1,this.width=12,this.height=12,this.xoffset=0,this.yoffset=0,this.source=null}normalizeCtorArgs(t,e,r,i){if(t&&typeof t!="string"&&t.imageData==null)return t;const n={};return t&&(n.url=t),e&&(n.outline=e),r!=null&&(n.width=kn(r)),i!=null&&(n.height=kn(i)),n}clone(){const t=new SY({color:_e(this.color),height:this.height,outline:this.outline&&this.outline.clone(),url:this.url,width:this.width,xoffset:this.xoffset,xscale:this.xscale,yoffset:this.yoffset,yscale:this.yscale});return t._set("source",_e(this.source)),t}hash(){var t;return`${super.hash()}.${(t=this.color)==null?void 0:t.hash()}.${this.height}.${this.url}.${this.width}.${this.xoffset}.${this.xscale}.${this.yoffset}.${this.yscale}`}};d([It({esriPFS:"picture-fill"},{readOnly:!0})],bh.prototype,"type",void 0),d([m(E3e)],bh.prototype,"url",void 0),d([m({type:Number,json:{write:!0}})],bh.prototype,"xscale",void 0),d([m({type:Number,json:{write:!0}})],bh.prototype,"yscale",void 0),d([m({type:Number,cast:kn,json:{write:!0}})],bh.prototype,"width",void 0),d([m({type:Number,cast:kn,json:{write:!0}})],bh.prototype,"height",void 0),d([m({type:Number,cast:kn,json:{write:!0}})],bh.prototype,"xoffset",void 0),d([m({type:Number,cast:kn,json:{write:!0}})],bh.prototype,"yoffset",void 0),d([m(P3e)],bh.prototype,"source",void 0),bh=SY=d([V("esri.symbols.PictureFillSymbol")],bh);const A3e=bh;var CY;let Qd=CY=class extends T3e{constructor(...t){super(...t),this.color=null,this.type="picture-marker",this.url=null,this.source=null,this.height=12,this.width=12,this.size=null}normalizeCtorArgs(t,e,r){if(t&&typeof t!="string"&&t.imageData==null)return t;const i={};return t&&(i.url=t),e!=null&&(i.width=kn(e)),r!=null&&(i.height=kn(r)),i}readHeight(t,e){return e.size||t}readWidth(t,e){return e.size||t}clone(){const t=new CY({angle:this.angle,height:this.height,url:this.url,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset});return t._set("source",_e(this.source)),t}hash(){return`${super.hash()}.${this.height}.${this.url}.${this.width}`}};d([m({json:{write:!1}})],Qd.prototype,"color",void 0),d([It({esriPMS:"picture-marker"},{readOnly:!0})],Qd.prototype,"type",void 0),d([m(E3e)],Qd.prototype,"url",void 0),d([m(P3e)],Qd.prototype,"source",void 0),d([m({type:Number,cast:kn,json:{write:!0}})],Qd.prototype,"height",void 0),d([Tr("height",["height","size"])],Qd.prototype,"readHeight",null),d([m({type:Number,cast:kn,json:{write:!0}})],Qd.prototype,"width",void 0),d([m({json:{write:!1}})],Qd.prototype,"size",void 0),Qd=CY=d([V("esri.symbols.PictureMarkerSymbol")],Qd);const J9=Qd;var iw;const M3e=$t.ofType({base:null,key:"type",typeMap:{icon:C1,object:Nte,text:z2}});let nw=iw=class extends V3{constructor(t){super(t),this.verticalOffset=null,this.callout=null,this.symbolLayers=new M3e,this.type="point-3d"}supportsCallout(){if((this.symbolLayers?this.symbolLayers.length:0)<1)return!1;for(const t of this.symbolLayers.items)switch(t.type){case"icon":case"text":case"object":continue;default:return!1}return!0}hasVisibleCallout(){return _3e(this)}hasVisibleVerticalOffset(){return kte(this)}clone(){return new iw({verticalOffset:_e(this.verticalOffset),callout:_e(this.callout),styleOrigin:_e(this.styleOrigin),symbolLayers:_e(this.symbolLayers),thumbnail:_e(this.thumbnail)})}static fromSimpleMarkerSymbol(t){return new iw({symbolLayers:new $t([C1.fromSimpleMarkerSymbol(t)])})}static fromPictureMarkerSymbol(t){return new iw({symbolLayers:new $t([C1.fromPictureMarkerSymbol(t)])})}static fromCIMSymbol(t){var i,n;if(((n=(i=t.data)==null?void 0:i.symbol)==null?void 0:n.type)!=="CIMPointSymbol")return null;const r=t.data.symbol;return new iw(r!=null&&r.callout?{symbolLayers:new $t([C1.fromCIMSymbol(t)]),callout:new y3e({size:.5,color:new Xe([0,0,0])}),verticalOffset:new Ute({screenLength:40})}:{symbolLayers:new $t([C1.fromCIMSymbol(t)])})}static fromTextSymbol(t){return new iw({symbolLayers:new $t([z2.fromTextSymbol(t)])})}};d([m({type:Ute,json:{write:!0}})],nw.prototype,"verticalOffset",void 0),d([m(b3e)],nw.prototype,"callout",void 0),d([m({type:M3e,json:{origins:{"web-scene":{write:!0}}}})],nw.prototype,"symbolLayers",void 0),d([It({PointSymbol3D:"point-3d"},{readOnly:!0})],nw.prototype,"type",void 0),nw=iw=d([V("esri.symbols.PointSymbol3D")],nw);const E1=nw;var cM;const O3e=$t.ofType({base:null,key:"type",typeMap:{extrude:JEe,fill:k2,icon:C1,line:UI,object:Nte,text:z2,water:f3e}});let uM=cM=class extends V3{constructor(t){super(t),this.symbolLayers=new O3e,this.type="polygon-3d"}initialize(){const t=e=>{e.type==="line"&&ev(re.getLogger(this),"LineSymbol3DLayer can not be used as a SymbolLayer with a PolygonSymbol3D symbol anymore.",{replacement:"Use FillSymbol3DLayer.outline instead.",version:"4.28"}),e.type==="text"&&ev(re.getLogger(this),"TextSymbol3DLayer can not be used as a SymbolLayer with a PolygonSymbol3D symbol anymore.",{replacement:"Use Labels instead.",version:"4.28"})};for(const e of this.symbolLayers)t(e);this.addHandles(Vo(()=>this.symbolLayers,"after-add",({item:e})=>t(e),Qr))}clone(){return new cM({styleOrigin:_e(this.styleOrigin),symbolLayers:_e(this.symbolLayers),thumbnail:_e(this.thumbnail)})}static fromJSON(t){var r;const e=new cM;if(e.read(t),e.symbolLayers.length===2&&e.symbolLayers.at(0).type==="fill"&&e.symbolLayers.at(1).type==="line"){const i=e.symbolLayers.at(0),n=e.symbolLayers.at(1);!n.enabled||(r=t.symbolLayers)!=null&&r[1]&&t.symbolLayers[1].enable===!1||(i.outline={size:n.size,color:n.material!=null?n.material.color:null}),e.symbolLayers.removeAt(1)}return e}static fromSimpleFillSymbol(t){return new cM({symbolLayers:new $t([k2.fromSimpleFillSymbol(t)])})}};d([m({type:O3e,json:{write:!0}})],uM.prototype,"symbolLayers",void 0),d([It({PolygonSymbol3D:"polygon-3d"},{readOnly:!0})],uM.prototype,"type",void 0),uM=cM=d([V("esri.symbols.PolygonSymbol3D")],uM);const BI=uM;var EY;const PV=new yn({esriSFSSolid:"solid",esriSFSNull:"none",esriSFSHorizontal:"horizontal",esriSFSVertical:"vertical",esriSFSForwardDiagonal:"forward-diagonal",esriSFSBackwardDiagonal:"backward-diagonal",esriSFSCross:"cross",esriSFSDiagonalCross:"diagonal-cross"});let sw=EY=class extends KEe{constructor(...t){super(...t),this.color=new Xe([0,0,0,.25]),this.outline=new vy,this.type="simple-fill",this.style="solid"}normalizeCtorArgs(t,e,r){if(t&&typeof t!="string")return t;const i={};return t&&(i.style=t),e&&(i.outline=e),r&&(i.color=r),i}clone(){return new EY({color:_e(this.color),outline:this.outline&&this.outline.clone(),style:this.style})}hash(){return`${super.hash()}${this.style}.${this.color&&this.color.hash()}`}};d([m()],sw.prototype,"color",void 0),d([m()],sw.prototype,"outline",void 0),d([It({esriSFS:"simple-fill"},{readOnly:!0})],sw.prototype,"type",void 0),d([m({type:PV.apiValues,json:{read:PV.read,write:PV.write}})],sw.prototype,"style",void 0),sw=EY=d([V("esri.symbols.SimpleFillSymbol")],sw);const VI=sw;var PY;const AV=new yn({esriSMSCircle:"circle",esriSMSSquare:"square",esriSMSCross:"cross",esriSMSX:"x",esriSMSDiamond:"diamond",esriSMSTriangle:"triangle",esriSMSPath:"path"});let im=PY=class extends T3e{constructor(...t){super(...t),this.color=new Xe([255,255,255,.25]),this.type="simple-marker",this.size=12,this.style="circle",this.outline=new vy}normalizeCtorArgs(t,e,r,i){if(t&&typeof t!="string")return t;const n={};return t&&(n.style=t),e!=null&&(n.size=kn(e)),r&&(n.outline=r),i&&(n.color=i),n}writeColor(t,e){t&&this.style!=="x"&&this.style!=="cross"&&(e.color=t.toJSON()),t===null&&(e.color=null)}set path(t){this.style="path",this._set("path",t)}clone(){return new PY({angle:this.angle,color:_e(this.color),outline:this.outline&&this.outline.clone(),path:this.path,size:this.size,style:this.style,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){var t;return`${super.hash()}.${this.color&&this.color.hash()}.${this.path}.${this.style}.${(t=this.outline)==null?void 0:t.hash()}`}};d([m()],im.prototype,"color",void 0),d([hr("color")],im.prototype,"writeColor",null),d([It({esriSMS:"simple-marker"},{readOnly:!0})],im.prototype,"type",void 0),d([m()],im.prototype,"size",void 0),d([m({type:AV.apiValues,json:{read:AV.read,write:AV.write}})],im.prototype,"style",void 0),d([m({type:String,json:{write:!0}})],im.prototype,"path",null),d([m({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":vy}},json:{default:null,write:!0}})],im.prototype,"outline",void 0),im=PY=d([V("esri.symbols.SimpleMarkerSymbol")],im);const j3=im;var AY;let Vn=AY=class extends su{constructor(...t){super(...t),this.backgroundColor=null,this.borderLineColor=null,this.borderLineSize=null,this.font=new zI,this.horizontalAlignment="center",this.kerning=!0,this.haloColor=null,this.haloSize=null,this.rightToLeft=null,this.rotated=!1,this.text="",this.type="text",this.verticalAlignment="baseline",this.xoffset=0,this.yoffset=0,this.angle=0,this.width=null,this.lineWidth=192,this.lineHeight=1}normalizeCtorArgs(t,e,r){if(t&&typeof t!="string")return t;const i={};return t&&(i.text=t),e&&(i.font=e),r&&(i.color=r),i}writeLineWidth(t,e,r,i){i&&typeof i!="string"?i.origin:e[r]=t}castLineWidth(t){return kn(t)}writeLineHeight(t,e,r,i){i&&typeof i!="string"?i.origin:e[r]=t}clone(){return new AY({angle:this.angle,backgroundColor:_e(this.backgroundColor),borderLineColor:_e(this.borderLineColor),borderLineSize:this.borderLineSize,color:_e(this.color),font:this.font&&this.font.clone(),haloColor:_e(this.haloColor),haloSize:this.haloSize,horizontalAlignment:this.horizontalAlignment,kerning:this.kerning,lineHeight:this.lineHeight,lineWidth:this.lineWidth,rightToLeft:this.rightToLeft,rotated:this.rotated,text:this.text,verticalAlignment:this.verticalAlignment,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){var t,e,r;return`${(t=this.backgroundColor)==null?void 0:t.hash()}.${this.borderLineColor}.${this.borderLineSize}.${(e=this.color)==null?void 0:e.hash()}.${this.font&&this.font.hash()}.${(r=this.haloColor)==null?void 0:r.hash()}.${this.haloSize}.${this.horizontalAlignment}.${this.kerning}.${this.rightToLeft}.${this.rotated}.${this.text}.${this.verticalAlignment}.${this.width}.${this.xoffset}.${this.yoffset}.${this.lineHeight}.${this.lineWidth}.${this.angle}`}};d([m({type:Xe,json:{write:!0}})],Vn.prototype,"backgroundColor",void 0),d([m({type:Xe,json:{write:!0}})],Vn.prototype,"borderLineColor",void 0),d([m({type:Number,json:{write:!0},cast:kn})],Vn.prototype,"borderLineSize",void 0),d([m({type:zI,json:{write:!0}})],Vn.prototype,"font",void 0),d([m({...u3e,json:{write:!0}})],Vn.prototype,"horizontalAlignment",void 0),d([m({type:Boolean,json:{write:!0}})],Vn.prototype,"kerning",void 0),d([m({type:Xe,json:{write:!0}})],Vn.prototype,"haloColor",void 0),d([m({type:Number,cast:kn,json:{write:!0}})],Vn.prototype,"haloSize",void 0),d([m({type:Boolean,json:{write:!0}})],Vn.prototype,"rightToLeft",void 0),d([m({type:Boolean,json:{write:!0}})],Vn.prototype,"rotated",void 0),d([m({type:String,json:{write:!0}})],Vn.prototype,"text",void 0),d([It({esriTS:"text"},{readOnly:!0})],Vn.prototype,"type",void 0),d([m({...h3e,json:{write:!0}})],Vn.prototype,"verticalAlignment",void 0),d([m({type:Number,cast:kn,json:{write:!0}})],Vn.prototype,"xoffset",void 0),d([m({type:Number,cast:kn,json:{write:!0}})],Vn.prototype,"yoffset",void 0),d([m({type:Number,json:{read:t=>t&&-1*t,write:(t,e)=>e.angle=t&&-1*t}})],Vn.prototype,"angle",void 0),d([m({type:Number,json:{write:!0}})],Vn.prototype,"width",void 0),d([m({type:Number})],Vn.prototype,"lineWidth",void 0),d([hr("lineWidth")],Vn.prototype,"writeLineWidth",null),d([ai("lineWidth")],Vn.prototype,"castLineWidth",null),d([m(c3e)],Vn.prototype,"lineHeight",void 0),d([hr("lineHeight")],Vn.prototype,"writeLineHeight",null),Vn=AY=d([V("esri.symbols.TextSymbol")],Vn);const H3=Vn;var MY;let Kd=MY=class extends su{constructor(t){super(t),this.color=null,this.styleName=null,this.portal=null,this.styleUrl=null,this.thumbnail=null,this.name=null,this.type="web-style"}get _fetchCacheKey(){const t=this.portal!=null?this.portal:ud.getDefault(),e=t.user?t.user.username:null;return`${this.styleName}:${this.styleUrl}:${this.name}:${e}:${t.url}`}read(t,e){this.portal=e==null?void 0:e.portal,super.read(t,e)}clone(){return new MY({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}fetchSymbol(t){return this._fetchSymbol("webRef",t)}fetchCIMSymbol(t){return this._fetchSymbol("cimRef",t)}async _fetchSymbol(t,e){const r=e!=null?e.cache:null,i=r?this._fetchCacheKey:null;if(r!=null){const a=i&&r.get(i);if(a)return a.clone()}const{resolveWebStyleSymbol:n}=await ge(()=>Promise.resolve().then(()=>Lwt),void 0);vt(e);const s=n(this,{portal:this.portal},t,e);s.catch(a=>{re.getLogger(this).error("#fetchSymbol()","Failed to create symbol from style",a)});const o=await s;return t==="webRef"&&o.type==="point-3d"||t==="cimRef"&&o.type==="cim"?(r!=null&&r.set(i,o.clone()),o):null}};d([m({json:{write:!1}})],Kd.prototype,"color",void 0),d([m({type:String,json:{write:!0}})],Kd.prototype,"styleName",void 0),d([m({type:ud,json:{write:!1}})],Kd.prototype,"portal",void 0),d([m({type:String,json:{read:tee,write:r2}})],Kd.prototype,"styleUrl",void 0),d([m({type:Mx,json:{read:!1}})],Kd.prototype,"thumbnail",void 0),d([m({type:String,json:{write:!0}})],Kd.prototype,"name",void 0),d([It({styleSymbolReference:"web-style"},{readOnly:!0})],Kd.prototype,"type",void 0),d([m()],Kd.prototype,"_fetchCacheKey",null),Kd=MY=d([V("esri.symbols.WebStyleSymbol")],Kd);const W3=Kd;function Q9(t){if(!t)return!1;switch(t.type){case"picture-fill":case"picture-marker":case"simple-fill":case"simple-line":case"simple-marker":case"text":case"cim":return!0;default:return!1}}function h2(t){if(!t)return!1;switch(t.type){case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":return!0;default:return!1}}const ZC={base:su,key:"type",typeMap:{"simple-fill":VI,"picture-fill":A3e,"picture-marker":J9,"simple-line":vy,"simple-marker":j3,text:H3,"label-3d":X9,"line-3d":Z9,"mesh-3d":G3,"point-3d":E1,"polygon-3d":BI,"web-style":W3,cim:q9},errorContext:"symbol"},u8t={base:su,key:"type",typeMap:{"picture-marker":J9,"simple-marker":j3,text:H3,"web-style":W3,cim:q9},errorContext:"symbol"},itt=kz({types:ZC}),ntt={base:su,key:"type",typeMap:{"simple-fill":VI,"picture-fill":A3e,"picture-marker":J9,"simple-line":vy,"simple-marker":j3,text:H3,"line-3d":Z9,"mesh-3d":G3,"point-3d":E1,"polygon-3d":BI,"web-style":W3,cim:q9},errorContext:"symbol"},h8t={base:su,key:"type",typeMap:{text:H3,"label-3d":X9},errorContext:"symbol"},Bce={base:su,key:"type",typeMap:{"line-3d":Z9,"mesh-3d":G3,"point-3d":E1,"polygon-3d":BI,"web-style":W3,cim:q9},errorContext:"symbol"},d8t={base:su,key:"type",typeMap:{"label-3d":X9},errorContext:"symbol"},p8t=ig(ZC);var OY;function stt(t){if(!t)return null;const e={};for(const r in t){const i=n2(t[r]);i&&(e[r]=i)}return Object.keys(e).length!==0?e:null}function ott(t){if(t==null)return null;const e={};for(const r in t){const i=t[r];i&&(e[r]=i.toJSON())}return Object.keys(e).length!==0?e:null}let kl=OY=class extends nh(ze){constructor(...t){super(...t),this.isAggregate=!1,this.layer=null,this.origin=null,this.popupTemplate=null,this.sourceLayer=null,Object.defineProperty(this,"uid",{value:Gu(),configurable:!0})}normalizeCtorArgs(t,e,r,i){return t&&!t.declaredClass?t:{geometry:t,symbol:e,attributes:r,popupTemplate:i}}set aggregateGeometries(t){const e=this._get("aggregateGeometries");JSON.stringify(e)!==JSON.stringify(t)&&this._set("aggregateGeometries",t)}set attributes(t){const e=this._get("attributes");e!==t&&(this._set("attributes",t),this._notifyLayer("attributes",e,t))}set geometry(t){const e=this._get("geometry");e!==t&&(this._set("geometry",t),this._notifyLayer("geometry",e,t))}set symbol(t){const e=this._get("symbol");e!==t&&(this._set("symbol",t),this._notifyLayer("symbol",e,t))}set visible(t){const e=this._get("visible");e!==t&&(this._set("visible",t),this._notifyLayer("visible",e,t))}cloneShallow(){return new OY({aggregateGeometries:this.aggregateGeometries,attributes:this.attributes,geometry:this.geometry,isAggregate:this.isAggregate,layer:this.layer,popupTemplate:this.popupTemplate,sourceLayer:this.sourceLayer,symbol:this.symbol,visible:this.visible,origin:this.origin})}getEffectivePopupTemplate(t=!1){if(this.popupTemplate)return this.popupTemplate;const e=this.origin&&"layer"in this.origin?this.origin.layer:null;for(const r of[e,this.sourceLayer,this.layer])if(r){if("popupTemplate"in r&&r.popupTemplate)return r.popupTemplate;if(t&&"defaultPopupTemplate"in r&&r.defaultPopupTemplate!=null)return r.defaultPopupTemplate}return null}getAttribute(t){var e;return(e=this.attributes)==null?void 0:e[t]}setAttribute(t,e){if(this.attributes){const r=this.getAttribute(t);this.attributes[t]=e,this._notifyLayer("attributes",r,e,t)}else this.attributes={[t]:e},this._notifyLayer("attributes",void 0,e,t)}getObjectId(){return this.sourceLayer&&"objectIdField"in this.sourceLayer&&this.sourceLayer.objectIdField?this.getAttribute(this.sourceLayer.objectIdField):null}toJSON(){var t;return{aggregateGeometries:ott(this.aggregateGeometries),geometry:this.geometry!=null?this.geometry.toJSON():null,symbol:this.symbol!=null?this.symbol.toJSON():null,attributes:cW(this.attributes)?this.attributes.toJSON():{...this.attributes},popupTemplate:((t=this.popupTemplate)==null?void 0:t.toJSON())??null}}notifyGeometryChanged(){this._notifyLayer("geometry",this.geometry,this.geometry)}notifyMeshTransformChanged(t={}){const{geometry:e}=this;if((e==null?void 0:e.type)==="mesh"){const r={origin:e.origin,transform:e.transform};this._notifyLayer("origin-transform",r,r,t.action)}}_notifyLayer(t,e,r,i){if(!this.layer||!("graphicChanged"in this.layer))return;const n={graphic:this,property:t,oldValue:e,newValue:r};t==="origin-transform"&&(n.action=i),t==="attributes"&&(n.attributeName=i),this.layer.graphicChanged(n)}};d([m({value:null,json:{read:stt}})],kl.prototype,"aggregateGeometries",null),d([m({value:null})],kl.prototype,"attributes",null),d([m({value:null,types:h9,json:{read:n2}})],kl.prototype,"geometry",null),d([m({type:Boolean})],kl.prototype,"isAggregate",void 0),d([m({clonable:"reference"})],kl.prototype,"layer",void 0),d([m({clonable:"reference"})],kl.prototype,"origin",void 0),d([m({type:fet})],kl.prototype,"popupTemplate",void 0),d([m({clonable:"reference"})],kl.prototype,"sourceLayer",void 0),d([m({value:null,types:ZC})],kl.prototype,"symbol",null),d([m({type:Boolean,value:!0})],kl.prototype,"visible",null),kl=OY=d([V("esri.Graphic")],kl),function(t){t.generateUID=Gu}(kl||(kl={}));const fv=kl;let Ox=class extends YO{_own(e){e.layer&&"remove"in e.layer&&e.layer!==this.owner&&e.layer.remove(e),e.layer=this.owner}_release(e){e.layer===this.owner&&(e.layer=null)}};d([Iwe({Type:fv,ensureType:Na(fv)})],Ox.prototype,"itemType",void 0),Ox=d([V("esri.support.GraphicsCollection")],Ox);let $_=class extends Ae{constructor(e){super(e),this.view=null,this.baseLayerViews=new $t,this.referenceLayerViews=new $t,this._loadingHandle=he(()=>{var r,i;return(i=(r=this.view)==null?void 0:r.map)==null?void 0:i.basemap},r=>{r&&r.load().catch(()=>{})},gi)}destroy(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null);for(const e of this.baseLayerViews)e.destroy();this.baseLayerViews.length=0;for(const e of this.referenceLayerViews)e.destroy();this.referenceLayerViews.length=0}get suspended(){return!this.view||this.view.suspended}get updating(){var r,i;if(this.view&&this.view.suspended)return!1;const e=(i=(r=this.view)==null?void 0:r.map)==null?void 0:i.basemap;return!!e&&!!e.loaded&&(this.baseLayerViews.some(n=>n.updating)||this.referenceLayerViews.some(n=>n.updating))}};d([m({constructOnly:!0})],$_.prototype,"view",void 0),d([m({readOnly:!0})],$_.prototype,"baseLayerViews",void 0),d([m({readOnly:!0})],$_.prototype,"referenceLayerViews",void 0),d([m({readOnly:!0})],$_.prototype,"suspended",null),d([m({type:Boolean,readOnly:!0})],$_.prototype,"updating",null),$_=d([V("esri.views.BasemapView")],$_);function att(t){return"tryRecycleWith"in t}let ltt=class{constructor(e,r,i){this.layer=e,this.view=r,this.layerViewImporter=i,this._controller=new AbortController,this._deferred=ha(),this._started=!1,this.done=!1,this.promise=this._deferred.promise,ca(this._controller.signal,()=>{const n=new K("cancelled:layerview-create","layerview creation cancelled",{layer:e});this._deferred.reject(n)})}tryRecycle(e){if(!this.done||!this.layerView||!att(this.layerView))return null;const r=this.layer.type,i=this._controller.signal;for(let n=0;n<e.length;n++){const s=e[n];if(s.type!==r)continue;const o=this.layerView.tryRecycleWith(s,{signal:i});if(o){e.splice(n,1),this.layer=s;const a=this.layerView,l=a.view;return this.promise=Promise.race([o.then(()=>(vt(this._controller.signal),s.emit("layerview-destroy",{view:l,layerView:a}),l.emit("layerview-destroy",{view:l,layerView:a}),s.emit("layerview-create",{view:l,layerView:a}),l.emit("layerview-create",{view:l,layerView:a}),a)),new Promise((c,u)=>ca(this._controller.signal,()=>u(dr())))]),this.promise}}return null}destroy(){this._controller.abort();const{layerView:e}=this;if(e){const{layer:r,view:i}=this;r.emit("layerview-destroy",{view:i,layerView:e}),i.emit("layerview-destroy",{layer:r,layerView:e})}this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null,this._map=null}async start(){var n,s;if(this._started)return;this._started=!0;const{_controller:{signal:e},layer:r,view:i}=this;this._map=i.map;try{let o,a;if(await r.load({signal:e}),r.prefetchResources&&await r.prefetchResources({signal:e}),utt(r))o=await r.createLayerView(i,{signal:e});else{if(!this.layerViewImporter.hasLayerViewModule(r))throw new K("layer:view-not-supported","No layerview implementation was found");const u=await this.layerViewImporter.importLayerView(r);vt(e),o="default"in u?new u.default({layer:r,view:i}):new u({layer:r,view:i})}const l=()=>{a=wi(a),o.destroyed||o.destroy(),o.layer=null,o.parent=null,o.view=null,this.done=!0};a=ca(e,l),vt(e);try{await o.when()}catch(u){throw l(),u}if(!((s=(n=this._map)==null?void 0:n.allLayers)==null?void 0:s.includes(r)))return l(),void this._deferred.reject(new K("view:no-layerview-for-layer","The layer has been removed from the map",{layer:r}));this.layerView=o,r.emit("layerview-create",{view:i,layerView:o}),i.emit("layerview-create",{layer:r,layerView:o}),this.done=!0,this._deferred.resolve(o)}catch(o){r.emit("layerview-create-error",{view:i,error:o}),i.emit("layerview-create-error",{layer:r,error:o}),this.done=!0,this._deferred.reject(new K("layerview:create-error","layerview creation failed",{layer:r,error:o}))}}},wh=class extends Ae{constructor(e){super(e),this._layerLayerViewInfoMap=new Map,this._recyclingInfoMap=new Map,this._watchUpdatingTracking=new Jp,this.supportsGround=!0,this._preloadLayerViewModules=()=>{var i;const r=(i=this.view.map)==null?void 0:i.allLayers;if(r)for(const n of r)this.layerViewImporter.hasLayerViewModule(n)&&this.layerViewImporter.importLayerView(n)},this._reschedule=()=>this.destroyed?Promise.reject():(this._workPromise==null&&(this._workPromise=ha(),this._workPromise.promise.catch(()=>{})),this.removeHandles("reschedule"),this.addHandles(M3(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{var l,c,u;if(this.destroyed)return;const r=this.view.map;if(this._map!==r&&(this.clear(),this._map=r),this._workPromise==null)return void this.notifyChange("updating");this.removeHandles("reschedule"),this.removeHandles("collection-change");const i=new Set,n=[],s=this.view.ready,o=h=>{if(h!=null){for(const p of h)if(p){i.add(p);const f=this._layerLayerViewInfoMap.get(p);f&&s?f.start():f||this._recyclingInfoMap.has(p)||n.push(p),"layers"in p&&p.layers&&o(p.layers)}}};for(const h of this._rootCollectionNames)o(Gm(this,h));for(const[h,p]of this._layerLayerViewInfoMap)if(!i.has(h)){this._layerLayerViewInfoMap.delete(p.layer);const f=p.tryRecycle(n);f?(this.notifyChange("updating"),this._recyclingInfoMap.set(p.layer,p),f.then(()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(p.layer),this._layerLayerViewInfoMap.set(p.layer,p),this._reschedule()}).catch(()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(p.layer),p.destroy(),this._reschedule()})):p.destroy()}for(const[h,p]of this._recyclingInfoMap)i.has(h)||(this.notifyChange("updating"),this._recyclingInfoMap.delete(p.layer),p.destroy());for(const h of n)this._createLayerView(h);this._refreshCollections();const a=[(l=r==null?void 0:r.ground)==null?void 0:l.layers,(c=r==null?void 0:r.basemap)==null?void 0:c.baseLayers,(u=r==null?void 0:r.basemap)==null?void 0:u.referenceLayers,r==null?void 0:r.layers].filter(h=>!!h);i.forEach(h=>"layers"in h&&a.push(h.layers)),this.addHandles(a.map(h=>this._watchUpdatingTracking.addOnCollectionChange(()=>h,this._reschedule)),"collection-change"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.addHandles([Vo(()=>{var e,r;return(r=(e=this.view)==null?void 0:e.map)==null?void 0:r.allLayers},"change",this._preloadLayerViewModules,{onListenerAdd:this._preloadLayerViewModules}),he(()=>{const e=this.view,r=e==null?void 0:e.map;return[r==null?void 0:r.basemap,r==null?void 0:r.ground,r==null?void 0:r.layers,e==null?void 0:e.ready]},()=>this._reschedule(),Kr)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),ZB(this._recyclingInfoMap),ZB(this._layerLayerViewInfoMap),this._watchUpdatingTracking.destroy(),this._map=null,this._workPromise!=null&&(this._workPromise.reject(dr()),this._workPromise=null)}get _layersToLayerViews(){const e=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&e.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(e)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return this._workPromise!=null||this._watchUpdatingTracking.updating||Zh(this._layerLayerViewInfoMap,e=>!e.done)||this._recyclingInfoMap.size>0}get updatingRemaining(){let e=0;for(const r of this._layerLayerViewInfoMap.values())r.done||++e;return e}clear(){this.destroyed||(ZB(this._layerLayerViewInfoMap),this._refreshCollections())}async whenLayerView(e){if(await this._reschedule(),!this._layerLayerViewInfoMap.has(e)){if(this._recyclingInfoMap.has(e))return this._recyclingInfoMap.get(e).promise;throw new K("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:e})}return this._layerLayerViewInfoMap.get(e).promise}_refreshCollections(){for(const[e,r]of this._layersToLayerViews)this._populateLayerViewsOwners(Gm(this,e),Gm(this,r),this.view);this.notifyChange("updating"),this.notifyChange("updatingRemaining")}_populateLayerViewsOwners(e,r,i){if(!e||!r)return void(r&&r.removeAll());let n=0;for(const s of e){const o=this._layerLayerViewInfoMap.get(s);if(!(o!=null&&o.layerView))continue;const a=o.layerView;a.layer=s,a.parent=i,r.at(n)!==a&&r.splice(n,0,a),s.layers&&this._populateLayerViewsOwners(s.layers,a.layerViews,a),n+=1}n<r.length&&r.splice(n,r.length)}_createLayerView(e){e.load().catch(()=>{}),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);const r=new ltt(e,this.view,this.layerViewImporter);r.promise.then(()=>this._refreshCollections(),i=>{i&&(_s(i)||i.name==="cancelled:layerview-create")||re.getLogger(this).error(`Failed to create layerview for layer title:'${e.title??"no title"}', id:'${e.id??"no id"}' of type '${e.type}'.`,{layer:e,error:i}),this._refreshCollections()}),this._layerLayerViewInfoMap.set(e,r),this.view.ready&&r.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}};d([m()],wh.prototype,"_workPromise",void 0),d([m({readOnly:!0})],wh.prototype,"_watchUpdatingTracking",void 0),d([m({readOnly:!0})],wh.prototype,"_layersToLayerViews",null),d([m({readOnly:!0})],wh.prototype,"_rootCollectionNames",null),d([m()],wh.prototype,"layerViewImporter",void 0),d([m()],wh.prototype,"supportsGround",void 0),d([m({readOnly:!0})],wh.prototype,"updating",null),d([m({readOnly:!0})],wh.prototype,"updatingRemaining",null),d([m({constructOnly:!0})],wh.prototype,"view",void 0),wh=d([V("esri.views.LayerViewManager")],wh);const ctt=wh;function utt(t){return"createLayerView"in t&&t.createLayerView!=null}let _u=class extends Ae{constructor(e){super(e),this.factor=1.5,this.offset=dd(0,0),this.position=null,this.size=120,this.maskUrl=null,this.maskEnabled=!0,this.overlayUrl=null,this.overlayEnabled=!0,this.visible=!0}get version(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}};d([m({type:Number})],_u.prototype,"factor",void 0),d([m({nonNullable:!0})],_u.prototype,"offset",void 0),d([m()],_u.prototype,"position",void 0),d([m({type:Number,range:{min:0}})],_u.prototype,"size",void 0),d([m()],_u.prototype,"maskUrl",void 0),d([m()],_u.prototype,"maskEnabled",void 0),d([m()],_u.prototype,"overlayUrl",void 0),d([m()],_u.prototype,"overlayEnabled",void 0),d([m({readOnly:!0})],_u.prototype,"version",null),d([m({type:Boolean})],_u.prototype,"visible",void 0),_u=d([V("esri.views.Magnifier")],_u);const R3e=_u;let W5=class{constructor(e){this._observable=new EI,this._map=new Map(e)}get size(){return Lt(this._observable),this._map.size}clear(){this._map.size>0&&(this._map.clear(),this._observable.notify())}delete(e){const r=this._map.delete(e);return r&&this._observable.notify(),r}entries(){return Lt(this._observable),this._map.entries()}forEach(e,r){Lt(this._observable),this._map.forEach((i,n)=>e.call(r,i,n,this),r)}get(e){return Lt(this._observable),this._map.get(e)}has(e){return Lt(this._observable),this._map.has(e)}keys(){return Lt(this._observable),this._map.keys()}set(e,r){return this._map.set(e,r),this._observable.notify(),this}values(){return Lt(this._observable),this._map.values()}[Symbol.iterator](){return Lt(this._observable),this._map[Symbol.iterator]()}get[Symbol.toStringTag](){return this._map[Symbol.toStringTag]}};var RY;let hM=RY=class extends ze{constructor(t){super(t),this.name=null,this.code=null}clone(){return new RY({name:this.name,code:this.code})}};d([m({type:String,json:{write:!0}})],hM.prototype,"name",void 0),d([m({type:[String,Number],json:{write:!0}})],hM.prototype,"code",void 0),hM=RY=d([V("esri.layers.support.CodedValue")],hM);const htt=new yn({inherited:"inherited",codedValue:"coded-value",range:"range"});let dM=class extends ze{constructor(e){super(e),this.name=null,this.type=null}};d([m({type:String,json:{write:!0}})],dM.prototype,"name",void 0),d([It(htt)],dM.prototype,"type",void 0),dM=d([V("esri.layers.support.Domain")],dM);const K9=dM;var $Y;let pM=$Y=class extends K9{constructor(t){super(t),this.codedValues=null,this.type="coded-value"}getName(t){let e=null;if(this.codedValues){const r=String(t);this.codedValues.some(i=>(String(i.code)===r&&(e=i.name),!!e))}return e}clone(){return new $Y({codedValues:_e(this.codedValues),name:this.name})}};d([m({type:[hM],json:{write:!0}})],pM.prototype,"codedValues",void 0),d([It({codedValue:"coded-value"})],pM.prototype,"type",void 0),pM=$Y=d([V("esri.layers.support.CodedValueDomain")],pM);const $3e=pM;var IY;let q5=IY=class extends K9{constructor(t){super(t),this.type="inherited"}clone(){return new IY}};d([It({inherited:"inherited"})],q5.prototype,"type",void 0),q5=IY=d([V("esri.layers.support.InheritedDomain")],q5);const I3e=q5;var LY;let yS=LY=class extends K9{constructor(t){super(t),this.maxValue=null,this.minValue=null,this.type="range"}clone(){return new LY({maxValue:this.maxValue,minValue:this.minValue,name:this.name})}};d([m({json:{type:[Number],read:{source:"range",reader:(t,e)=>{var r;return(r=e.range)==null?void 0:r[1]}},write:{enabled:!1,overridePolicy(){return{enabled:this.maxValue!=null&&this.minValue==null}},target:"range",writer(t,e,r){e[r]=[this.minValue||0,t]}}}})],yS.prototype,"maxValue",void 0),d([m({json:{type:[Number],read:{source:"range",reader:(t,e)=>{var r;return(r=e.range)==null?void 0:r[0]}},write:{target:"range",writer(t,e,r){e[r]=[t,this.maxValue||0]}}}})],yS.prototype,"minValue",void 0),d([It({range:"range"})],yS.prototype,"type",void 0),yS=LY=d([V("esri.layers.support.RangeDomain")],yS);const L3e=yS,dtt={key:"type",base:K9,typeMap:{range:L3e,"coded-value":$3e,inherited:I3e}};function ptt(t){if(!(t!=null&&t.type))return null;switch(t.type){case"range":return L3e.fromJSON(t);case"codedValue":return $3e.fromJSON(t);case"inherited":return I3e.fromJSON(t)}return null}const ftt=new yn({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml",esriFieldTypeBigInteger:"big-integer",esriFieldTypeDateOnly:"date-only",esriFieldTypeTimeOnly:"time-only",esriFieldTypeTimestampOffset:"timestamp-offset"});var DY;const mtt=new yn({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",dateAndTime:"date-and-time",description:"description",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"});let tl=DY=class extends ze{constructor(t){super(t),this.alias=null,this.defaultValue=void 0,this.description=null,this.domain=null,this.editable=!0,this.length=void 0,this.name=null,this.nullable=!0,this.type=null,this.valueType=null,this.visible=!0}readDescription(t,{description:e}){let r=null;try{r=e?JSON.parse(e):null}catch{}return(r==null?void 0:r.value)??null}readValueType(t,{description:e}){let r=null;try{r=e?JSON.parse(e):null}catch{}return r?mtt.fromJSON(r.fieldValueType):null}clone(){var t;return new DY({alias:this.alias,defaultValue:this.defaultValue,description:this.description,domain:((t=this.domain)==null?void 0:t.clone())??null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType,visible:this.visible})}};d([m({type:String,json:{write:!0}})],tl.prototype,"alias",void 0),d([m({type:[String,Number],json:{write:{allowNull:!0}}})],tl.prototype,"defaultValue",void 0),d([m()],tl.prototype,"description",void 0),d([Tr("description")],tl.prototype,"readDescription",null),d([m({types:dtt,json:{read:{reader:ptt},write:!0}})],tl.prototype,"domain",void 0),d([m({type:Boolean,json:{write:!0}})],tl.prototype,"editable",void 0),d([m({type:fn,json:{write:{overridePolicy:t=>({enabled:Number.isFinite(t)})}}})],tl.prototype,"length",void 0),d([m({type:String,json:{write:!0}})],tl.prototype,"name",void 0),d([m({type:Boolean,json:{write:!0}})],tl.prototype,"nullable",void 0),d([It(ftt)],tl.prototype,"type",void 0),d([m()],tl.prototype,"valueType",void 0),d([Tr("valueType",["description"])],tl.prototype,"readValueType",null),d([m({type:Boolean,json:{read:!1}})],tl.prototype,"visible",void 0),tl=DY=d([V("esri.layers.support.Field")],tl);const D3e=tl;var NY;let _S=NY=class extends ze{constructor(t){super(t),this.type="map-layer"}clone(){const{mapLayerId:t,gdbVersion:e}=this;return new NY({mapLayerId:t,gdbVersion:e})}};d([It({mapLayer:"map-layer"})],_S.prototype,"type",void 0),d([m({type:fn,json:{write:!0}})],_S.prototype,"mapLayerId",void 0),d([m({type:String,json:{write:!0}})],_S.prototype,"gdbVersion",void 0),_S=NY=d([V("esri.layers.support.source.MapLayerSource")],_S);var FY;let e0=FY=class extends ze{constructor(t){super(t),this.type="query-table"}clone(){const{workspaceId:t,query:e,oidFields:r,spatialReference:i,geometryType:n}=this,s={workspaceId:t,query:e,oidFields:r,spatialReference:(i==null?void 0:i.clone())??void 0,geometryType:n};return new FY(s)}};d([It({queryTable:"query-table"})],e0.prototype,"type",void 0),d([m({type:String,json:{write:!0}})],e0.prototype,"workspaceId",void 0),d([m({type:String,json:{write:!0}})],e0.prototype,"query",void 0),d([m({type:String,json:{write:!0}})],e0.prototype,"oidFields",void 0),d([m({type:lt,json:{write:!0}})],e0.prototype,"spatialReference",void 0),d([It(_2e)],e0.prototype,"geometryType",void 0),e0=FY=d([V("esri.layers.support.source.QueryTableDataSource")],e0);var kY;let vS=kY=class extends ze{constructor(t){super(t),this.type="raster"}clone(){const{workspaceId:t,dataSourceName:e}=this;return new kY({workspaceId:t,dataSourceName:e})}};d([It({raster:"raster"})],vS.prototype,"type",void 0),d([m({type:String,json:{write:!0}})],vS.prototype,"dataSourceName",void 0),d([m({type:String,json:{write:!0}})],vS.prototype,"workspaceId",void 0),vS=kY=d([V("esri.layers.support.source.RasterDataSource")],vS);var zY;let ow=zY=class extends ze{constructor(t){super(t),this.type="table"}clone(){const{workspaceId:t,gdbVersion:e,dataSourceName:r}=this;return new zY({workspaceId:t,gdbVersion:e,dataSourceName:r})}};d([It({table:"table"})],ow.prototype,"type",void 0),d([m({type:String,json:{write:!0}})],ow.prototype,"workspaceId",void 0),d([m({type:String,json:{write:!0}})],ow.prototype,"gdbVersion",void 0),d([m({type:String,json:{write:!0}})],ow.prototype,"dataSourceName",void 0),ow=zY=d([V("esri.layers.support.source.TableDataSource")],ow);var UY,BY;const gtt=ac()({esriLeftInnerJoin:"left-inner-join",esriLeftOuterJoin:"left-outer-join"});let vu=UY=class extends ze{constructor(t){super(t),this.type="join-table"}readLeftTableSource(t,e,r){return Vce()(t,e,r)}castLeftTableSource(t){return ig(VY(),t)}readRightTableSource(t,e,r){return Vce()(t,e,r)}castRightTableSource(t){return ig(VY(),t)}clone(){const{leftTableKey:t,rightTableKey:e,leftTableSource:r,rightTableSource:i,joinType:n}=this,s={leftTableKey:t,rightTableKey:e,leftTableSource:(r==null?void 0:r.clone())??void 0,rightTableSource:(i==null?void 0:i.clone())??void 0,joinType:n};return new UY(s)}};d([It({joinTable:"join-table"})],vu.prototype,"type",void 0),d([m({type:String,json:{write:!0}})],vu.prototype,"leftTableKey",void 0),d([m({type:String,json:{write:!0}})],vu.prototype,"rightTableKey",void 0),d([m({json:{write:!0}})],vu.prototype,"leftTableSource",void 0),d([Tr("leftTableSource")],vu.prototype,"readLeftTableSource",null),d([ai("leftTableSource")],vu.prototype,"castLeftTableSource",null),d([m({json:{write:!0}})],vu.prototype,"rightTableSource",void 0),d([Tr("rightTableSource")],vu.prototype,"readRightTableSource",null),d([ai("rightTableSource")],vu.prototype,"castRightTableSource",null),d([It(gtt)],vu.prototype,"joinType",void 0),vu=UY=d([V("esri.layers.support.source.JoinTableDataSource")],vu);let MV=null;function Vce(){return MV||(MV=kz({types:VY()})),MV}let OV=null;function VY(){return OV||(OV={key:"type",base:null,typeMap:{"data-layer":f0,"map-layer":_S}}),OV}const ytt={key:"type",base:null,typeMap:{"join-table":vu,"query-table":e0,raster:vS,table:ow}};let f0=BY=class extends ze{constructor(t){super(t),this.type="data-layer"}clone(){const{fields:t,dataSource:e}=this;return new BY({fields:t,dataSource:e})}};d([It({dataLayer:"data-layer"})],f0.prototype,"type",void 0),d([m({type:[D3e],json:{write:!0}})],f0.prototype,"fields",void 0),d([m({types:ytt,json:{write:!0}})],f0.prototype,"dataSource",void 0),f0=BY=d([V("esri.layers.support.source.DataLayerSource")],f0),f0.from=Na(f0);let aw=class extends nh(ze){constructor(e){super(e),this.onFields=null,this.operator=null,this.searchTerm=null,this.searchType=null}};d([m({type:[String],json:{write:{enabled:!0,overridePolicy(){return{enabled:this.onFields!=null&&this.onFields.length>0}}}}})],aw.prototype,"onFields",void 0),d([m({type:String,json:{write:!0}})],aw.prototype,"operator",void 0),d([m({type:String,json:{write:!0}})],aw.prototype,"searchTerm",void 0),d([m({type:String,json:{write:!0}})],aw.prototype,"searchType",void 0),aw=d([V("esri.rest.support.FullTextSearch")],aw);const _tt=aw;var GY;const Gce=new yn({upperLeft:"upper-left",lowerLeft:"lower-left"});let lw=GY=class extends ze{constructor(t){super(t),this.extent=null,this.mode="view",this.originPosition="upper-left",this.tolerance=1}clone(){return new GY(_e({extent:this.extent,mode:this.mode,originPosition:this.originPosition,tolerance:this.tolerance}))}};d([m({type:ei,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],lw.prototype,"extent",void 0),d([m({type:["view","edit"],json:{write:!0}})],lw.prototype,"mode",void 0),d([m({type:String,json:{read:Gce.read,write:Gce.write}})],lw.prototype,"originPosition",void 0),d([m({type:Number,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],lw.prototype,"tolerance",void 0),lw=GY=d([V("esri.rest.support.QuantizationParameters")],lw);const vtt=lw,btt=new yn({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"});var jY;const jce=new yn({count:"count",sum:"sum",min:"min",max:"max",avg:"avg",stddev:"stddev",var:"var",exceedslimit:"exceedslimit",percentile_cont:"percentile-continuous",percentile_disc:"percentile-discrete",EnvelopeAggregate:"envelope-aggregate",CentroidAggregate:"centroid-aggregate",ConvexHullAggregate:"convex-hull-aggregate"});let ep=jY=class extends ze{constructor(t){super(t),this.maxPointCount=void 0,this.maxRecordCount=void 0,this.maxVertexCount=void 0,this.onStatisticField=null,this.outStatisticFieldName=null,this.statisticType=null,this.statisticParameters=null}writeStatisticParameters(t,e){this.statisticType!=="percentile-continuous"&&this.statisticType!=="percentile-discrete"||(e.statisticParameters=_e(t))}clone(){return new jY({maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,statisticType:this.statisticType,statisticParameters:_e(this.statisticParameters)})}};d([m({type:Number,json:{write:!0}})],ep.prototype,"maxPointCount",void 0),d([m({type:Number,json:{write:!0}})],ep.prototype,"maxRecordCount",void 0),d([m({type:Number,json:{write:!0}})],ep.prototype,"maxVertexCount",void 0),d([m({type:String,json:{write:!0}})],ep.prototype,"onStatisticField",void 0),d([m({type:String,json:{write:!0}})],ep.prototype,"outStatisticFieldName",void 0),d([m({type:String,json:{read:{source:"statisticType",reader:jce.read},write:{target:"statisticType",writer:jce.write}}})],ep.prototype,"statisticType",void 0),d([m({type:Object})],ep.prototype,"statisticParameters",void 0),d([hr("statisticParameters")],ep.prototype,"writeStatisticParameters",null),ep=jY=d([V("esri.rest.support.StatisticDefinition")],ep);const wtt=ep;var Y5;const xtt=new yn({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let Dt=Y5=class extends ze{static from(t){return Yx(Y5,t)}constructor(t){super(t),this.aggregateIds=null,this.cacheHint=void 0,this.compactGeometryEnabled=!1,this.datumTransformation=null,this.defaultSpatialReferenceEnabled=!1,this.distance=void 0,this.dynamicDataSource=void 0,this.formatOf3DObjects=null,this.fullText=null,this.gdbVersion=null,this.geometry=null,this.geometryPrecision=void 0,this.groupByFieldsForStatistics=null,this.having=null,this.historicMoment=null,this.maxAllowableOffset=void 0,this.maxRecordCountFactor=1,this.multipatchOption=null,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.outStatistics=null,this.parameterValues=null,this.pixelSize=null,this.quantizationParameters=null,this.rangeValues=null,this.relationParameter=null,this.resultType=null,this.returnCentroid=!1,this.returnDistinctValues=!1,this.returnExceededLimitFeatures=!0,this.returnGeometry=!1,this.returnQueryGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.sourceSpatialReference=null,this.spatialRelationship="intersects",this.start=void 0,this.sqlFormat=null,this.text=null,this.timeExtent=null,this.timeReferenceUnknownClient=!1,this.units=null,this.where=null}castDatumTransformation(t){return typeof t=="number"||typeof t=="object"?t:null}writeHistoricMoment(t,e){e.historicMoment=t&&t.getTime()}writeParameterValues(t,e){if(t){const r={};for(const i in t){const n=t[i];Array.isArray(n)?r[i]=n.map(s=>s instanceof Date?s.getTime():s):n instanceof Date?r[i]=n.getTime():r[i]=n}e.parameterValues=r}}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10,e.where="1=1"}writeWhere(t,e){e.where=t||"1=1"}clone(){return new Y5(_e({aggregateIds:this.aggregateIds,cacheHint:this.cacheHint,compactGeometryEnabled:this.compactGeometryEnabled,datumTransformation:this.datumTransformation,defaultSpatialReferenceEnabled:this.defaultSpatialReferenceEnabled,distance:this.distance,fullText:this.fullText,formatOf3DObjects:this.formatOf3DObjects,gdbVersion:this.gdbVersion,geometry:this.geometry,geometryPrecision:this.geometryPrecision,groupByFieldsForStatistics:this.groupByFieldsForStatistics,having:this.having,historicMoment:this.historicMoment!=null?new Date(this.historicMoment.getTime()):null,maxAllowableOffset:this.maxAllowableOffset,maxRecordCountFactor:this.maxRecordCountFactor,multipatchOption:this.multipatchOption,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,outStatistics:this.outStatistics,parameterValues:this.parameterValues,pixelSize:this.pixelSize,quantizationParameters:this.quantizationParameters,rangeValues:this.rangeValues,relationParameter:this.relationParameter,resultType:this.resultType,returnDistinctValues:this.returnDistinctValues,returnGeometry:this.returnGeometry,returnCentroid:this.returnCentroid,returnExceededLimitFeatures:this.returnExceededLimitFeatures,returnQueryGeometry:this.returnQueryGeometry,returnM:this.returnM,returnZ:this.returnZ,dynamicDataSource:this.dynamicDataSource,sourceSpatialReference:this.sourceSpatialReference,spatialRelationship:this.spatialRelationship,start:this.start,sqlFormat:this.sqlFormat,text:this.text,timeExtent:this.timeExtent,timeReferenceUnknownClient:this.timeReferenceUnknownClient,units:this.units,where:this.where}))}};Dt.MAX_MAX_RECORD_COUNT_FACTOR=5,d([m({json:{write:!0}})],Dt.prototype,"aggregateIds",void 0),d([m({type:Boolean,json:{write:!0}})],Dt.prototype,"cacheHint",void 0),d([m({type:Boolean,json:{default:!1,write:!0}})],Dt.prototype,"compactGeometryEnabled",void 0),d([m({json:{write:!0}})],Dt.prototype,"datumTransformation",void 0),d([ai("datumTransformation")],Dt.prototype,"castDatumTransformation",null),d([m({type:Boolean,json:{default:!1,write:!0}})],Dt.prototype,"defaultSpatialReferenceEnabled",void 0),d([m({type:Number,json:{write:{overridePolicy:t=>({enabled:t>0})}}})],Dt.prototype,"distance",void 0),d([m({type:f0,json:{write:!0}})],Dt.prototype,"dynamicDataSource",void 0),d([m({type:String,json:{write:!0}})],Dt.prototype,"formatOf3DObjects",void 0),d([m({type:[_tt],json:{write:{enabled:!0,overridePolicy(){return{enabled:this.fullText!=null&&this.fullText.length>0}}}}})],Dt.prototype,"fullText",void 0),d([m({type:String,json:{write:!0}})],Dt.prototype,"gdbVersion",void 0),d([m({types:h9,json:{read:n2,write:!0}})],Dt.prototype,"geometry",void 0),d([m({type:Number,json:{write:!0}})],Dt.prototype,"geometryPrecision",void 0),d([m({type:[String],json:{write:!0}})],Dt.prototype,"groupByFieldsForStatistics",void 0),d([m({type:String,json:{write:!0}})],Dt.prototype,"having",void 0),d([m({type:Date})],Dt.prototype,"historicMoment",void 0),d([hr("historicMoment")],Dt.prototype,"writeHistoricMoment",null),d([m({type:Number,json:{write:!0}})],Dt.prototype,"maxAllowableOffset",void 0),d([m({type:Number,cast:t=>t<1?1:t>Dt.MAX_MAX_RECORD_COUNT_FACTOR?Dt.MAX_MAX_RECORD_COUNT_FACTOR:t,json:{write:{overridePolicy:t=>({enabled:t>1})}}})],Dt.prototype,"maxRecordCountFactor",void 0),d([m({type:["xyFootprint"],json:{write:!0}})],Dt.prototype,"multipatchOption",void 0),d([m({type:Number,json:{read:{source:"resultRecordCount"}}})],Dt.prototype,"num",void 0),d([m({json:{write:!0}})],Dt.prototype,"objectIds",void 0),d([m({type:[String],json:{write:!0}})],Dt.prototype,"orderByFields",void 0),d([m({type:[String],json:{write:!0}})],Dt.prototype,"outFields",void 0),d([m({type:lt,json:{name:"outSR",write:!0}})],Dt.prototype,"outSpatialReference",void 0),d([m({type:[wtt],json:{write:{enabled:!0,overridePolicy(){return{enabled:this.outStatistics!=null&&this.outStatistics.length>0}}}}})],Dt.prototype,"outStatistics",void 0),d([m({json:{write:!0}})],Dt.prototype,"parameterValues",void 0),d([hr("parameterValues")],Dt.prototype,"writeParameterValues",null),d([m({type:ke,json:{write:!0}})],Dt.prototype,"pixelSize",void 0),d([m({type:vtt,json:{write:!0}})],Dt.prototype,"quantizationParameters",void 0),d([m({type:[Object],json:{write:!0}})],Dt.prototype,"rangeValues",void 0),d([m({type:String,json:{read:{source:"relationParam"},write:{target:"relationParam",overridePolicy(){return{enabled:this.spatialRelationship==="relation"}}}}})],Dt.prototype,"relationParameter",void 0),d([m({type:String,json:{write:!0}})],Dt.prototype,"resultType",void 0),d([m({type:Boolean,json:{default:!1,write:!0}})],Dt.prototype,"returnCentroid",void 0),d([m({type:Boolean,json:{default:!1,write:!0}})],Dt.prototype,"returnDistinctValues",void 0),d([m({type:Boolean,json:{default:!0,write:!0}})],Dt.prototype,"returnExceededLimitFeatures",void 0),d([m({type:Boolean,json:{write:!0}})],Dt.prototype,"returnGeometry",void 0),d([m({type:Boolean,json:{default:!1,write:!0}})],Dt.prototype,"returnQueryGeometry",void 0),d([m({type:Boolean,json:{default:!1,write:!0}})],Dt.prototype,"returnM",void 0),d([m({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Dt.prototype,"returnZ",void 0),d([m({type:lt,json:{write:!0}})],Dt.prototype,"sourceSpatialReference",void 0),d([It(btt,{ignoreUnknown:!1,name:"spatialRel"})],Dt.prototype,"spatialRelationship",void 0),d([m({type:Number,json:{read:{source:"resultOffset"}}})],Dt.prototype,"start",void 0),d([hr("start"),hr("num")],Dt.prototype,"writeStart",null),d([m({type:String,json:{write:!0}})],Dt.prototype,"sqlFormat",void 0),d([m({type:String,json:{write:!0}})],Dt.prototype,"text",void 0),d([m({type:SEe,json:{write:!0}})],Dt.prototype,"timeExtent",void 0),d([m({type:Boolean,json:{default:!1,write:!0}})],Dt.prototype,"timeReferenceUnknownClient",void 0),d([It(xtt,{ignoreUnknown:!1}),m({json:{write:{overridePolicy(t){return{enabled:!!t&&this.distance!=null&&this.distance>0}}}}})],Dt.prototype,"units",void 0),d([m({type:String,json:{write:{overridePolicy(t){return{enabled:t!=null||this.start!=null&&this.start>0}}}}})],Dt.prototype,"where",void 0),d([hr("where")],Dt.prototype,"writeWhere",null),Dt=Y5=d([V("esri.rest.support.Query")],Dt);const Hce=Dt;let t0=class extends Qn.EventedAccessor{constructor(e){super(e),this._selectionMap=new W5,this._trashCan=[],this._layerEditHandles=new $t,this._vizTaskId=0,this.showHighlight=!0}initialize(){this.addHandles([he(()=>[this.view,this.showHighlight],()=>this._refreshVisualization()),Vo(()=>this.sources,"change",r=>{const i=this._selectionMap;for(const n of r.removed)i.delete(n);this._refreshListeners(),this._refreshVisualization()},{onListenerAdd:()=>this._refreshListeners()})]);const e=new $t;this.view.when().then(()=>{this.view.map.allLayers.flatten(r=>"sublayers"in r&&r.sublayers?r.sublayers:null).forEach(r=>{(ID(r)&&!qVe(r)||Y2(r))&&e.add(r)}),this._set("sources",e)})}destroy(){this._layerEditHandles.drain(wi)}get selections(){return Array.from(this._selectionMap.entries()).map(e=>{const[r,i]=e;return{layer:r,selection:[...i.selection]}})}get count(){let e=0;for(const r of this._selectionMap.values())e+=r.selection.length;return e}get hasSelection(){return this.count>0}get sources(){return this._get("sources")}set sources(e){this._set("sources",e)}async getSelectedFeatures(e,r={},i="layerView"){const{view:n,selections:s}=this,o=(e!==void 0?s.filter(a=>e.includes(a.layer)):s).filter(a=>a.selection.length>0).map(async a=>{const{layer:l,selection:c}=a,u=Y2(l)?l.parent:l;if(u==null||!Wce(u))return null;if(i==="layer")return qce(u,c,r);const h=await n.whenLayerView(u);return qce(h,c,r)});return(await Promise.all(o)).filter(a=>a!==null)}updateSelection(e){const r=new Map;for(const[s,o]of this._selectionMap)r.set(s,[...o.selection]);let i=!1;const n=e.current.concat(e.added);for(const s of n){const o=s.sourceLayer,a=s.getObjectId();if(this.sources.includes(o)&&(ID(o)||Y2(o))&&a!==null){const l=$K(r,o,()=>[]);l.includes(a)||(l.push(a),i=!0)}}for(const s of e.removed){const o=s.sourceLayer,a=s.getObjectId();if(this.sources.includes(o)&&(ID(o)||Y2(o))&&a!==null){const l=r.get(o),c=l==null?void 0:l.indexOf(a);c!==void 0&&c>=0&&(l==null||l.splice(c,1),i=!0)}}if(i){const{_selectionMap:s,_trashCan:o}=this,a=[];for(const[l,c]of r){const u=s.get(l);u!==void 0&&o.push(u),s.set(l,{selection:c}),a.push({layer:l,selection:c,...BH(u!==void 0?u.selection:[],c)})}this._onSelectionChange(a)}}setSelection(e,r){this._setSelection(e,r)}getSelection(e){const r=this._selectionMap.get(e);return r==null?void 0:r.selection}appendToSelection(e,r){const i=this._selectionMap.get(e),n=i!==void 0?[...i.selection]:[];for(const s of r)n.includes(s)||n.push(s);this._setSelection(e,n)}removeFromSelection(e,r){const i=this._selectionMap.get(e);if(!i)return;const n=[];for(const s of i.selection)r.includes(s)||n.push(s);this._setSelection(e,n)}toggleInSelection(e,r){const i=this._selectionMap.get(e);if(!i||i.selection.length===0)return void this._setSelection(e,r);const n=new Set(i.selection),s=new Set(r),o=v9e(n,s);this._setSelection(e,Array.from(o))}clear(){const e=this._selectionMap.values();this._trashCan.push(...e);const r=[];for(const[i,n]of this._selectionMap.entries())r.push({layer:i,added:[],removed:[...n.selection],selection:[]});this._selectionMap.clear(),this._onSelectionChange(r)}_onSelectionChange(e){this._refreshVisualization(),this.emit("selection-change",{view:this.view,changes:e})}_refreshVisualization(){var o;if(this.view==null||this.sources==null)return;for(this._vizTaskId++;this._trashCan.length>0;){const a=this._trashCan.pop();(o=a==null?void 0:a.highlightHandle)==null||o.remove()}const{sources:e,view:r,_selectionMap:i,showHighlight:n}=this,s=this._vizTaskId;for(const a of e){const l=i.get(a),c=Y2(a)?a.parent:a;c!=null&&Wce(c)&&r.whenLayerView(c).then(u=>{var h;(h=l==null?void 0:l.highlightHandle)==null||h.remove(),l!==void 0&&n&&s===this._vizTaskId&&"highlight"in u&&typeof u.highlight=="function"&&l.selection.length>0&&(l.highlightHandle=u.highlight(l.selection,"selection"))})}}_refreshListeners(){this._layerEditHandles.drain(wi);for(const e of this.sources){const r=Y2(e)?e.parent:e;if(r!=null&&ID(r)){const i=r.on("edits",n=>{this._handleEditChanges(n,e)});this._layerEditHandles.push(i)}}}_handleEditChanges(e,r){if(e.deletedFeatures!==void 0&&e.deletedFeatures.length>0&&this._selectionMap.has(r)){const i=e.deletedFeatures.filter(n=>n.error==null).map(n=>n.objectId).filter(P3);this.removeFromSelection(r,i)}}_setSelection(e,r){if(!this.sources.includes(e))throw new Error(`Cannot set selection on layer ${e.title} because it is not in 'sources'`);const i=this._selectionMap.get(e);if(i===void 0||!Stt(i,{selection:r})){i!==void 0&&this._trashCan.push(i),this._selectionMap.set(e,{selection:[...r]});const n={layer:e,selection:[...r],...BH(i!==void 0?i.selection:[],r)};this._onSelectionChange([n])}}};d([m({readOnly:!0,nonNullable:!0})],t0.prototype,"selections",null),d([m({readOnly:!0,nonNullable:!0})],t0.prototype,"count",null),d([m({constructOnly:!0,nonNullable:!0})],t0.prototype,"view",void 0),d([m({readOnly:!0,nonNullable:!0})],t0.prototype,"hasSelection",null),d([m()],t0.prototype,"showHighlight",void 0),d([m()],t0.prototype,"sources",null),t0=d([V("esri.views.SelectionManager")],t0);const ID=t=>t.createQuery!==void 0&&t.on!==void 0,Ttt=t=>t.layer!==void 0,Wce=t=>(t==null?void 0:t.when)!==void 0,Stt=(t,e)=>{if(t==null&&e==null)return!0;if(t!=null&&e==null||t==null&&e!=null)return!1;if(t!=null&&e!=null&&t.selection!=null&&e.selection!=null){const r=[...t.selection],i=[...e.selection];if(r.length!==i.length)return!1;r.sort(),i.sort();for(let n=0;n<r.length;n++)if(r[n]!==i[n])return!1}return!0},qce=async(t,e,r={})=>{let i;if(Ttt(t)){const n=t;i=n===void 0?null:await n.queryFeatures(new Hce({...r,objectIds:e})).then(s=>({data:s,layer:t.layer}))}else{const n=t;i=n===void 0?null:await n.queryFeatures(new Hce({...r,objectIds:e})).then(s=>({data:s,layer:n}))}return i},Ctt=t0;let fM=class extends nh(Ae){constructor(e){super(e),this.accentColor=new Xe([255,127,0]),this.textColor=new Xe([255,255,255])}};d([m({type:Xe,nonNullable:!0})],fM.prototype,"accentColor",void 0),d([m({type:Xe,nonNullable:!0})],fM.prototype,"textColor",void 0),fM=d([V("esri.views.Theme")],fM);const HY=fM;var Yce;(function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right"})(Yce||(Yce={}));const N3e=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],F3e={};function k3e(t){return!!F3e[t]}function Ett(t){for(const e of t)if(!k3e(e))return!1;return!0}N3e.forEach(t=>{F3e[t]=!0});let Ptt=class{constructor(e){this._handlers=new Map,this._counter=0,this._handlerCounts=new Map,this.view=e,this.inputManager=null}connect(e){e&&this.disconnect(),this.inputManager=e,this._handlers.forEach(({handler:r,priority:i},n)=>{var s;return(s=this.inputManager)==null?void 0:s.installHandlers(n,[r],i)})}disconnect(){this.inputManager&&this._handlers.forEach((e,r)=>{var i;return(i=this.inputManager)==null?void 0:i.uninstallHandlers(r)}),this.inputManager=null}destroy(){this.disconnect(),this._handlers.clear(),this.view=null}on(e,r,i,n){const s=Array.isArray(e)?e:e.split(",");if(!Ett(s))return s.some(k3e)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let o,a;Array.isArray(r)?a=r:(o=r,a=[]),typeof i=="function"?o=i:n=i,n=n??j1.DEFAULT;const l=this._createUniqueGroupName(),c=new Att(this.view,s,a,o);this._handlers.set(l,{handler:c,priority:n});for(const u of s){const h=this._handlerCounts.get(u)||0;this._handlerCounts.set(u,h+1)}return this.inputManager&&this.inputManager.installHandlers(l,[c],n),Zr(()=>this._removeHandler(l,s))}hasHandler(e){return!!this._handlerCounts.get(e)}_removeHandler(e,r){if(this._handlers.has(e)){this._handlers.delete(e);for(const i of r){const n=this._handlerCounts.get(i);n===void 0?console.error("Trying to remove handler for event that has no handlers registered: ",i):n===1?this._handlerCounts.delete(i):this._handlerCounts.set(i,n-1)}}this.inputManager&&this.inputManager.uninstallHandlers(e)}_createUniqueGroupName(){return this._counter+=1,`viewEvents_${this._counter}`}},Att=class extends qo{constructor(e,r,i,n){super(!0),this._latestDragStart=void 0,this.view=e;for(const s of r)switch(s){case"click":this.registerIncoming("click",i,o=>n(this._wrapClick(o)));break;case"double-click":this.registerIncoming("double-click",i,o=>n(this._wrapDoubleClick(o)));break;case"immediate-click":this.registerIncoming("immediate-click",i,o=>n(this._wrapImmediateClick(o)));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",i,o=>n(this._wrapImmediateDoubleClick(o)));break;case"hold":this.registerIncoming("hold",i,o=>n(this._wrapHold(o)));break;case"drag":this.registerIncoming("drag",i,o=>{const a=this._wrapDrag(o);a&&n(a)});break;case"key-down":this.registerIncoming("key-down",i,o=>n(this._wrapKeyDown(o)));break;case"key-up":this.registerIncoming("key-up",i,o=>n(this._wrapKeyUp(o)));break;case"pointer-down":this.registerIncoming("pointer-down",i,o=>n(this._wrapPointer(o,"pointer-down")));break;case"pointer-move":this.registerIncoming("pointer-move",i,o=>n(this._wrapPointer(o,"pointer-move")));break;case"pointer-up":this.registerIncoming("pointer-up",i,o=>n(this._wrapPointer(o,"pointer-up")));break;case"pointer-drag":this.registerIncoming("pointer-drag",i,o=>n(this._wrapPointerDrag(o)));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",i,o=>n(this._wrapMouseWheel(o)));break;case"pointer-enter":this.registerIncoming("pointer-enter",i,o=>n(this._wrapPointer(o,"pointer-enter")));break;case"pointer-leave":this.registerIncoming("pointer-leave",i,o=>n(this._wrapPointer(o,"pointer-leave")));break;case"gamepad":this.registerIncoming("gamepad",i,o=>{n(this._wrapGamepad(o))});break;case"focus":this.registerIncoming("focus",i,o=>{n(this._wrapFocus(o))});break;case"blur":this.registerIncoming("blur",i,o=>{n(this._wrapBlur(o))})}}_wrapFocus(e){return{type:"focus",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:r=>e.async(r),preventDefault:()=>e.preventDefault()}}_wrapBlur(e){return{type:"blur",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:r=>e.async(r),preventDefault:()=>e.preventDefault()}}_wrapClick(e){const{pointerType:r,button:i,buttons:n,x:s,y:o,native:a,eventId:l}=e.data,{cancelable:c,timestamp:u}=e;return{type:"click",pointerType:r,button:i,buttons:n,x:s,y:o,native:a,timestamp:u,screenPoint:dd(s,o),mapPoint:this._getMapPoint(s,o),eventId:l,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:h=>e.async(h),preventDefault:()=>e.preventDefault()}}_wrapDoubleClick(e){const{pointerType:r,button:i,buttons:n,x:s,y:o,native:a,eventId:l}=e.data,{cancelable:c,timestamp:u}=e;return{type:"double-click",pointerType:r,button:i,buttons:n,x:s,y:o,native:a,timestamp:u,mapPoint:this._getMapPoint(s,o),eventId:l,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:h=>e.async(h),preventDefault:()=>e.preventDefault()}}_wrapImmediateClick(e){const{pointerType:r,button:i,buttons:n,x:s,y:o,native:a,eventId:l}=e.data,c=a.pointerId,{cancelable:u,timestamp:h}=e;return{type:"immediate-click",pointerId:c,pointerType:r,button:i,buttons:n,x:s,y:o,native:a,timestamp:h,mapPoint:this._getMapPoint(s,o),eventId:l,cancelable:u,stopPropagation:()=>e.stopPropagation(),async:p=>e.async(p),preventDefault:()=>e.preventDefault()}}_wrapImmediateDoubleClick(e){const{pointerType:r,button:i,buttons:n,x:s,y:o,native:a,eventId:l}=e.data,c=a.pointerId,{cancelable:u,timestamp:h}=e;return{type:"immediate-double-click",pointerId:c,pointerType:r,button:i,buttons:n,x:s,y:o,native:a,timestamp:h,mapPoint:this._getMapPoint(s,o),eventId:l,cancelable:u,stopPropagation:()=>e.stopPropagation(),async:p=>e.async(p),preventDefault:()=>e.preventDefault()}}_wrapHold(e){const{pointerType:r,button:i,buttons:n,x:s,y:o,native:a}=e.data,{cancelable:l,timestamp:c}=e;return{type:"hold",pointerType:r,button:i,buttons:n,x:s,y:o,native:a,timestamp:c,mapPoint:this._getMapPoint(s,o),cancelable:l,stopPropagation:()=>e.stopPropagation(),async:u=>e.async(u),preventDefault:()=>e.preventDefault()}}_getMapPoint(e,r){return this.view.toMap(dd(e,r),{exclude:[]})}_wrapDrag(e){const r=e.data,{x:i,y:n}=r.center,{action:s,pointerType:o,button:a}=r;if(s==="start"&&(this._latestDragStart=r),!this._latestDragStart)return;const l=r.pointer.native,c=r.buttons,{cancelable:u,timestamp:h}=e,p={x:this._latestDragStart.center.x,y:this._latestDragStart.center.y};return s==="end"&&(this._latestDragStart=void 0),{type:"drag",action:s,x:i,y:n,origin:p,pointerType:o,button:a,buttons:c,radius:r.radius,angle:Fa(r.angle),native:l,timestamp:h,cancelable:u,stopPropagation:()=>e.stopPropagation(),async:f=>e.async(f),preventDefault:()=>e.preventDefault()}}_wrapKeyDown(e){const{key:r,repeat:i,native:n}=e.data,{cancelable:s,timestamp:o}=e;return{type:"key-down",key:r,repeat:i,native:n,timestamp:o,cancelable:s,stopPropagation:()=>e.stopPropagation(),async:a=>e.async(a),preventDefault:()=>e.preventDefault()}}_wrapKeyUp(e){const{key:r,native:i}=e.data,{cancelable:n,timestamp:s}=e;return{type:"key-up",key:r,native:i,timestamp:s,cancelable:n,stopPropagation:()=>e.stopPropagation(),async:o=>e.async(o),preventDefault:()=>e.preventDefault()}}_wrapPointer(e,r){const{x:i,y:n,button:s,buttons:o,native:a,eventId:l}=e.data,c=a.pointerId,u=a.pointerType,{cancelable:h,timestamp:p}=e;return{type:r,x:i,y:n,pointerId:c,pointerType:u,button:s,buttons:o,native:a,timestamp:p,eventId:l,cancelable:h,stopPropagation:()=>e.stopPropagation(),async:f=>e.async(f),preventDefault:()=>e.preventDefault()}}_wrapPointerDrag(e){const{x:r,y:i,buttons:n,native:s,eventId:o}=e.data.currentEvent,{button:a}=e.data.startEvent,l=e.data.startEvent.native.pointerId,c=e.data.startEvent.native.pointerType,u=e.data.action,h={x:e.data.startEvent.x,y:e.data.startEvent.y},{cancelable:p,timestamp:f}=e;return{type:"pointer-drag",x:r,y:i,pointerId:l,pointerType:c,button:a,buttons:n,action:u,origin:h,native:s,timestamp:f,eventId:o,cancelable:p,stopPropagation:()=>e.stopPropagation(),async:g=>e.async(g),preventDefault:()=>e.preventDefault()}}_wrapMouseWheel(e){const{cancelable:r,data:i,timestamp:n}=e,{x:s,y:o,deltaY:a,native:l}=i;return{type:"mouse-wheel",x:s,y:o,deltaY:a,native:l,timestamp:n,cancelable:r,stopPropagation:()=>e.stopPropagation(),async:c=>e.async(c),preventDefault:()=>e.preventDefault()}}_wrapGamepad(e){const{action:r,state:i,device:n}=e.data,{cancelable:s,timestamp:o}=e,{buttons:a,axes:l}=i;return{type:"gamepad",device:n,timestamp:o,action:r,buttons:a,axes:l,cancelable:s,stopPropagation:()=>e.stopPropagation(),async:c=>e.async(c),preventDefault:()=>e.preventDefault()}}};var R$,Xce,Zce;(function(t){t[t.USER=0]="USER",t[t.MANAGER=1]="MANAGER"})(R$||(R$={})),function(t){t[t.None=0]="None",t[t.Unfocused=1]="Unfocused",t[t.Focused=2]="Focused",t[t.Unselected=4]="Unselected",t[t.Selected=8]="Selected",t[t.All=15]="All"}(Xce||(Xce={})),function(t){t[t.None=0]="None",t[t.Custom1=16]="Custom1",t[t.Custom2=32]="Custom2",t[t.Custom3=64]="Custom3",t[t.Custom4=128]="Custom4",t[t.Custom5=256]="Custom5",t[t.Custom6=512]="Custom6",t[t.Custom7=1024]="Custom7",t[t.Custom8=2048]="Custom8",t[t.Custom9=4096]="Custom9",t[t.Custom10=8192]="Custom10",t[t.Custom11=16384]="Custom11",t[t.Custom12=32768]="Custom12",t[t.All=65520]="All"}(Zce||(Zce={}));function Mtt(t){return[t.on("before-add",e=>{const r=e.item;if(r==null||t.includes(r))return re.getLogger("esri.views.interactive.interactiveToolUtils").warn("Tool is either already in the list of tools or tool is `null`. Not adding tool."),void e.preventDefault();r.onAdd()}),t.on("after-remove",e=>{const r=e.item;r.active&&(r.view.activeTool=null),r.destroy()})]}function WY(t){return t.visible&&t.getEditableFlag!=null&&t.getEditableFlag(R$.USER)&&t.getEditableFlag(R$.MANAGER)}function nm(t){return dd(t.x,t.y)}function E8t(t){return pn(t.x,t.y)}function z3e(t,e){var i;const r=(i=t instanceof HTMLElement?t:t.surface)==null?void 0:i.getBoundingClientRect();return r?dd(e.clientX-r.left,e.clientY-r.top):dd(0,0)}function Jce(t,e){return e instanceof Event?z3e(t,e):nm(e)}function Qce(t){if(t instanceof Event)return!0;if(typeof t=="object"&&"type"in t)switch(t.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;default:return!1}return!1}let Ott=class{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._revertToNullActiveTool=!1,this._cursor=null}get cursor(){return this._cursor}hasFocusedManipulators(){return this._grabbedManipulators.size>0||this._draggedManipulators.size>0}handleInputEvent(e,r){const i=()=>e.stopPropagation();switch(e.type){case"pointer-move":Kce(e.pointerType)&&this._pointerLocations.set(e.pointerId,{x:e.x,y:e.y,pointerType:e.pointerType});break;case"drag":this._grabbedManipulators.size>0&&(this._stopDrag=!0),this._stopDrag&&(i(),e.action==="end"&&(this._stopDrag=!1));break;case"pointer-down":{if(!eue(e))break;const n=nm(e),s=this._intersect(n,e.pointerType,r.forEachTool);if(s==null)break;const o=s.manipulator,a=s.tool;o==null||a==null||!o.interactive||o.grabbable&&o.grabbableForEvent(e)||!o.grabbing||o.dragging||this._releaseManipulatorBeforeDragging(o,e,r),o!=null&&a!=null&&o.interactive&&o.grabbable&&o.grabbableForEvent(e)&&!o.grabbing&&(this._grabbedManipulators.set(e.pointerId,{manipulator:o,tool:a,start:n,pointerType:e.pointerType}),this._grabbedManipulators.size===1&&r.activeTool==null&&(this._revertToNullActiveTool=!0,r.setActiveTool(s.tool)),o.grabbing=!0,o.events.emit("grab-changed",{action:"start",pointerType:e.pointerType,screenPoint:n}),i());break}case"pointer-up":this._draggedManipulators.has(e.pointerId)||this._handlePointerEnd(e,r);break;case"pointer-drag":{if(!eue(e))break;const n=this._grabbedManipulators.get(e.pointerId),s=n==null?void 0:n.manipulator,o=n==null?void 0:n.tool;if(s==null||o==null)break;const a=nm(e);a.x=we(a.x,0,r.view.width),a.y=we(a.y,0,r.view.height);const l=n.start,c=this._draggedManipulators.get(e.pointerId);switch(e.action){case"start":case"update":e.action!=="update"&&this._grabbedManipulators.size!==1||(s.dragging=!0,c?s.events.emit("drag",{action:"update",start:l,screenPoint:a}):s.events.emit("drag",{action:"start",start:l,screenPoint:a,pointerType:e.pointerType}),this._draggedManipulators.set(e.pointerId,{tool:o,manipulator:s,start:l}));break;case"end":s.dragging=!1,c&&s.events.emit("drag",{action:"end",start:l,screenPoint:a}),this._draggedManipulators.delete(e.pointerId),this._handlePointerEnd(e,r)}i();break}case"immediate-click":{const n=nm(e),s=this._intersect(n,e.pointerType,r.forEachTool);if(Rtt(e)||r.forEachTool(c=>{if((s==null||s.tool!==c||c.automaticManipulatorSelection)&&c.manipulators){let u=!1;c.manipulators.forEach(({manipulator:h})=>{h.selected&&(h.selected=!1,u=!0)}),u&&c.onManipulatorSelectionChanged&&c.onManipulatorSelectionChanged()}}),s==null)break;const{manipulator:o,tool:a}=s;if(!o.interactive)break;o.selectable&&a.automaticManipulatorSelection&&(o.selected=!o.selected,a.onManipulatorSelectionChanged&&a.onManipulatorSelectionChanged());const l=e.native.shiftKey;o.events.emit("immediate-click",{screenPoint:n,button:e.button,pointerType:e.pointerType,shiftKey:l,stopPropagation:i}),RV(o,i);break}case"click":{const n=nm(e),s=this._intersect(n,e.pointerType,r.forEachTool),o=s==null?void 0:s.manipulator;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit(e.type,{screenPoint:n,button:e.button,pointerType:e.pointerType,shiftKey:a}),i();break}case"double-click":{const n=nm(e),s=this._intersect(n,e.pointerType,r.forEachTool),o=s!=null?s.manipulator:null;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit("double-click",{screenPoint:n,button:e.button,pointerType:e.pointerType,shiftKey:a,stopPropagation:i}),RV(o,i);break}case"immediate-double-click":{const n=nm(e),s=this._intersect(n,e.pointerType,r.forEachTool),o=s!=null?s.manipulator:null;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit("immediate-double-click",{screenPoint:n,button:e.button,pointerType:e.pointerType,shiftKey:a,stopPropagation:i}),RV(o,i);break}}this._onFocusChange(r.forEachTool)}_releaseManipulatorBeforeDragging(e,r,i){e.grabbing=!1,e.events.emit("grab-changed",{action:"end",pointerType:r.pointerType,screenPoint:nm(r)}),this._grabbedManipulators.forEach(({manipulator:n},s)=>{n===e&&this._grabbedManipulators.delete(s)}),this._afterManipulatorRelease(i.setActiveTool)}_handlePointerEnd(e,r){var n;const i=(n=this._grabbedManipulators.get(e.pointerId))==null?void 0:n.manipulator;i!=null&&i.grabbing&&(i.grabbing=!1,i.events.emit("grab-changed",{action:"end",pointerType:e.pointerType,screenPoint:nm(e)}),this._grabbedManipulators.delete(e.pointerId),this._afterManipulatorRelease(r.setActiveTool))}_cursorFromMap(e){let r=null;return Zh(e,({manipulator:i})=>!(i==null||!i.interactive)&&(i.grabbing&&i.grabCursor?(r=i.grabCursor,!0):!!i.cursor&&(r=i.cursor,!0))),r}_onFocusChange(e){this._updateCursor(),this._updateFocusedManipulatorTools(e)}_updateCursor(){this._grabbedManipulators.size>0?this._cursor=this._cursorFromMap(this._grabbedManipulators)||"grabbing":this._hoveredManipulators.size>0?this._cursor=this._cursorFromMap(this._hoveredManipulators)||"pointer":this._cursor=null}_updateFocusedManipulatorTools(e){const r=new Set,i=new Set;this._grabbedManipulators.forEach(({tool:n})=>{r.add(n)}),this._hoveredManipulators.forEach(({tool:n})=>{i.add(n)}),e(n=>{n.hasGrabbedManipulators=r.has(n),n.hasHoveredManipulators=i.has(n);const s=this._grabbedManipulators.values(),o=Oze(s,({tool:a})=>a===n);n.firstGrabbedManipulator=o!=null?o.manipulator:null})}clearPointers(e,{forEachTool:r,setActiveTool:i},n=!0,s){const o=(a,l)=>a===e&&(s==null||s===l);this._grabbedManipulators.forEach(({tool:a,manipulator:l,pointerType:c},u)=>{o(a,l)&&(this._grabbedManipulators.delete(u),l.grabbing=!1,l.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:c}))}),this._draggedManipulators.forEach(({tool:a,manipulator:l},c)=>{o(a,l)&&(this._draggedManipulators.delete(c),l.dragging=!1,l.events.emit("drag",{action:"cancel"}))}),n&&this._hoveredManipulators.forEach(({tool:a,manipulator:l},c)=>{o(a,l)&&(this._hoveredManipulators.delete(c),l.hovering=!1)}),this._afterManipulatorRelease(i),this._onFocusChange(r)}_intersect(e,r,i){let n=null;return i(s=>{if(s.manipulators==null||!WY(s))return!1;const o=s.manipulators.intersect(e,r);return o!=null&&(n={tool:s,manipulator:o},!0)}),n}updateHoveredStateFromKnownPointers(e){this._pointerLocations.forEach((r,i)=>{this._updateHoveredStateForPointerAtScreenPosition(dd(r.x,r.y),i,r.pointerType,e)})}handleHoverEvent(e,r){e.type!=="pointer-up"&&e.type!=="immediate-click"&&e.type!=="pointer-move"||!Kce(e.pointerType)||this._updateHoveredStateForPointerAtScreenPosition(nm(e),e.pointerId,e.pointerType,r)}_updateHoveredStateForPointerAtScreenPosition(e,r,i,n){var a;let s=this._intersect(e,i,n);const o=(a=this._hoveredManipulators.get(r))==null?void 0:a.manipulator;s==null||s.manipulator.interactive||(s=null),s!=null&&o===s.manipulator||(o!=null&&(o.hovering=!1),s!=null?(s.manipulator.hovering=!0,this._hoveredManipulators.set(r,s)):this._hoveredManipulators.delete(r),this._onFocusChange(n))}_afterManipulatorRelease(e){this._grabbedManipulators.size===0&&this._revertToNullActiveTool&&(e(null),this._revertToNullActiveTool=!1)}};function Kce(t){return t==="mouse"}function eue(t){return t.pointerType!=="mouse"||t.button===0}function Rtt(t){return!!t.native.shiftKey}function RV(t,e){t!=null&&t.consumesClicks&&e()}const tue="attached",$V="tools",rue=1e3;let sm=class extends Ae{constructor(e){super(e),this._updatingHandles=new Jp,this._clock=SI,this._manipulatorState=new Ott,this.tools=new $t,this.cursor=null,this._interacting=!1,this._interactingTimeout=rue,this._interactingTimeoutHandle=null,this._forEachTool=r=>{for(const i of this.tools.items)if(r(i))return}}initialize(){this.addHandles([this.view.on(N3e,e=>{this._handleInputEvent(e)},j1.TOOL),...Mtt(this.tools),this.tools.on("before-add",({item:e})=>{this._updateToolEditableFlag(e)}),this.tools.on("before-remove",({item:e})=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()}),this.tools.on("change",()=>{this._refreshToolWatchers()})])}destroy(){this.activeTool=null,this.tools.drain(e=>e.destroy()),this._clearInteractingTimeout(),this._interacting=!1,this._updatingHandles.destroy()}get _manipulatorStateEventArgs(){return{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:e=>{this.activeTool=e},view:this.view}}set activeTool(e){if(e!=null&&!this.view.ready)return void re.getLogger(this).error("Cannot set active tool while view is not ready.");if(e===this.activeTool)return;const r=this.activeTool;this._set("activeTool",e),r!=null&&r.deactivate(),e!=null&&e.activate(),this._removeIncompleteTools(e);for(const i of this.tools){this._updateToolEditableFlag(i);const n=WY(i);this.activeTool!=null&&n||this._manipulatorState.clearPointers(i,this._manipulatorStateEventArgs,!n)}this._updateCursor()}get updating(){return this._updatingHandles.updating||this.tools.some(e=>e.updating)}get interacting(){return this._interacting}_clearInteractingTimeout(){this._interactingTimeoutHandle=wi(this._interactingTimeoutHandle)}_startInteractingTimeout(){this._clearInteractingTimeout(),this._interactingTimeoutHandle=this._clock.setTimeout(()=>this._interacting=!1,this._interactingTimeout)}attach(){var e;this.view.type==="3d"?this.addHandles([he(()=>{const{state:r}=this.view;return"camera"in r&&r.camera},()=>this._forEachManipulator(r=>r.onViewChange())),(e=this.view.elevationProvider)==null?void 0:e.on("elevation-change",r=>this._forEachManipulator(i=>i.onElevationChange(r)))],tue):this.addHandles(he(()=>this.view.extent,()=>this._forEachManipulator(r=>r.onViewChange())))}detach(){this.activeTool=null,this.tools.removeAll(),this.removeHandles(tue),this._clearInteractingTimeout(),this._interacting=!1}_forEachManipulator(e){this._forEachTool(r=>{r.manipulators&&r.manipulators.forEach(({manipulator:i})=>e(i,r))})}_handleInputEvent(e){let r=!1;const i={...e,stopPropagation:()=>{r=!0,e.stopPropagation()}};this.activeTool!=null?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(i):this._forEachTool(n=>{!r&&n.visible&&n.handleInputEvent(i)}),!r&&e.type==="key-down"&&e.key==="Escape"&&this.activeTool&&(e.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(i,this._manipulatorStateEventArgs),r||this.activeTool==null||this.activeTool.handleInputEventAfter(i),this._manipulatorState.handleHoverEvent(i,this._forEachTool),this._updateCursor(),e.type==="pointer-move"&&(this._manipulatorState.hasFocusedManipulators()||this.activeTool)&&(this._interacting=!0,this._startInteractingTimeout())}_refreshToolWatchers(){this.removeHandles($V),this._forEachTool(e=>{if(e instanceof Ae){const r=he(()=>[e.cursor,e.visible,e.editable],()=>{WY(e)||this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()});this.addHandles(r,$V)}e.manipulators&&this.addHandles([e.manipulators.on("after-remove",r=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs,!0,r.item.manipulator)}),e.manipulators.on("change",()=>{this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()})],$V)}),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateToolEditableFlag(e){var r;(r=e.setEditableFlag)==null||r.call(e,R$.MANAGER,this.activeTool==null||e===this.activeTool)}_updateCursor(){let e=this._manipulatorState.cursor;e==null&&this._forEachTool(r=>!(r.cursor==null||!r.visible)&&(e=r.cursor,!0)),this._get("cursor")!==e&&this._set("cursor",e)}_removeIncompleteTools(e){this.tools.filter(r=>(e==null||r!==e)&&!r.created&&r.removeIncompleteOnCancel).forEach(r=>{this.tools.remove(r)})}get test(){const e=this;return{setClock:r=>this._clock=r,set interactingTimeoutEnabled(r){e._interactingTimeout=r?rue:0},get interactingTimeoutEnabled(){return e._interactingTimeout!==0}}}};d([m({constructOnly:!0,nonNullable:!0})],sm.prototype,"view",void 0),d([m({value:null})],sm.prototype,"activeTool",null),d([m({readOnly:!0,type:$t})],sm.prototype,"tools",void 0),d([m({readOnly:!0})],sm.prototype,"cursor",void 0),d([m({readOnly:!0})],sm.prototype,"updating",null),d([m()],sm.prototype,"_interacting",void 0),d([m({readOnly:!0})],sm.prototype,"interacting",null),sm=d([V("esri.views.ToolViewManager")],sm);let bS=class extends Ae{constructor(e){super(),this.nativeIndex=null,this._detectedDeviceType="unknown",e.mapping==="standard"?this._detectedDeviceType="standard":$tt.test(e.id)?this._detectedDeviceType="spacemouse":this._detectedDeviceType="unknown",this.nativeIndex=e.index}get native(){const e=navigator.getGamepads?navigator.getGamepads():[];return this.nativeIndex!=null&&this.nativeIndex<e.length?e[this.nativeIndex]:null}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return Itt[this.deviceType]}};d([m({nonNullable:!0,readOnly:!0})],bS.prototype,"nativeIndex",void 0),d([m({type:String,readOnly:!0})],bS.prototype,"deviceType",null),d([m({type:Number,readOnly:!0})],bS.prototype,"axisThreshold",null),bS=d([V("esri.views.input.gamepad.GamepadInputDevice")],bS);const $tt=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),Itt={standard:.15,spacemouse:.025,unknown:0},Bte=bS;let mM=class extends Ae{constructor(...e){super(...e),this.devices=new $t,this.enabledFocusMode="document"}};d([m({type:$t.ofType(Bte),readOnly:!0})],mM.prototype,"devices",void 0),d([m({type:["document","view","none"]})],mM.prototype,"enabledFocusMode",void 0),mM=d([V("esri.views.input.gamepad.GamepadSettings")],mM);const Ltt=mM;let X5=class extends Ae{constructor(){super(...arguments),this.gamepad=new Ltt}};d([m({readOnly:!0})],X5.prototype,"gamepad",void 0),X5=d([V("esri.views.input.Input")],X5);const Dtt=X5;let I_=class extends Ae{constructor(e){super(e),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};d([m({type:Boolean,nonNullable:!0})],I_.prototype,"enabled",void 0),d([m({type:Bte})],I_.prototype,"device",void 0),d([m({type:["pan","zoom"],nonNullable:!0})],I_.prototype,"mode",void 0),d([m({type:["forward-down","forward-up"],nonNullable:!0})],I_.prototype,"tiltDirection",void 0),d([m({type:Number,nonNullable:!0})],I_.prototype,"velocityFactor",void 0),I_=d([V("esri.views.navigation.gamepad.GamepadSettings")],I_);const U3e=I_;let cw=class extends Ae{constructor(e){super(e),this.browserTouchPanEnabled=!0,this.gamepad=new U3e,this.momentumEnabled=!0,this.mouseWheelZoomEnabled=!0}};d([m({type:Boolean})],cw.prototype,"browserTouchPanEnabled",void 0),d([m({type:U3e,nonNullable:!0})],cw.prototype,"gamepad",void 0),d([m({type:Boolean})],cw.prototype,"momentumEnabled",void 0),d([m({type:Boolean})],cw.prototype,"mouseWheelZoomEnabled",void 0),cw=d([V("esri.views.navigation.Navigation")],cw);const B3e=cw,V3e={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer","3dtilesserver":"3DTilesServer"},G3e=Object.values(V3e),j3e=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${G3e.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),Ntt=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^\\/\\n]+)\\/(${G3e.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),Ftt=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function L8t(t){return!!j3e.test(t)}function Vte(t){if(t==null)return null;const e=da(t),r=(e==null?void 0:e.path.match(j3e))||(e==null?void 0:e.path.match(Ntt));if(!r)return null;const[,i,n,s,o]=r,a=n.indexOf("/");return{title:H3e(a!==-1?n.slice(a+1):n),serverType:V3e[s.toLowerCase()],sublayer:o!=null&&o!==""?parseInt(o,10):null,url:{path:i}}}function ktt(t){const e=da(t).path.match(Ftt);return e?{serviceUrl:e[1],sublayerId:Number(e[2])}:null}function H3e(t){return(t=t.replaceAll(/\s*[/_]+\s*/g," "))[0].toUpperCase()+t.slice(1)}function D8t(t,e){const r=[];if(t){const i=Vte(t);i!=null&&i.title&&r.push(i.title)}if(e){const i=H3e(e);r.push(i)}if(r.length===2){if(r[0].toLowerCase().includes(r[1].toLowerCase()))return r[0];if(r[1].toLowerCase().includes(r[0].toLowerCase()))return r[1]}return r.join(" - ")}function N8t(t){if(!t)return!1;const e=".arcgis.com/",r="//services",i="//tiles",n="//features",s=(t=t.toLowerCase()).includes(e),o=t.includes(r)||t.includes(i)||t.includes(n);return s&&o}function F8t(t,e){return t&&wwe(Twe(t,e))}function k8t(t){let{url:e}=t;if(!e)return{url:e};e=Twe(e,t.logger);const r=da(e),i=Vte(r.path);let n;if(i!=null)i.sublayer!=null&&t.layer.layerId==null&&(n=i.sublayer),e=i.url.path;else if(t.nonStandardUrlAllowed){const s=ktt(r.path);s!=null&&(e=s.serviceUrl,n=s.sublayerId)}return{url:wwe(e),layerId:n}}function z8t(t,e,r,i,n){r2(e,i,"url",n),i.url&&t.layerId!=null&&(i.url=Bz(i.url,r,t.layerId.toString()))}function U8t(t){if(!t)return!1;const e=t.toLowerCase(),r=e.includes("/services/"),i=e.includes("/mapserver/wmsserver"),n=e.includes("/imageserver/wmsserver"),s=e.includes("/wmsserver");return r&&(i||n||s)}function B8t(t,e,r){const i=W3e(t),n=e,s=ztt(i,n,r);if(i){const o=DI.deriveUnitFromSR(i,t.spatialReference).heightUnit;if(!r&&o!==i.heightUnit){const a=new K("layerview:unmatched-height-unit",`The vertical units of the layer must match the horizontal units (${o})`,{horizontalUnit:o});return new K("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:i,error:a})}}if(!Utt(t)||s===Ac.Unsupported)return new K("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:i});switch(s){case Ac.Units:{const o=(i==null?void 0:i.heightUnit)||"unknown",a=(n==null?void 0:n.heightUnit)||"unknown",l=new K("layerview:incompatible-height-unit",`The vertical units of the layer (${o}) must match the vertical units of the scene (${a})`,{layerUnit:o,sceneUnit:a});return new K("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:i,sceneHeightModelInfo:n,error:l})}case Ac.HeightModel:{const o=(i==null?void 0:i.heightModel)||"unknown",a=(n==null?void 0:n.heightModel)||"unknown",l=new K("layerview:incompatible-height-model",`The height model of the layer (${o}) must match the height model of the scene (${a})`,{layerHeightModel:o,sceneHeightModel:a});return new K("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:i,sceneHeightModelInfo:n,error:l})}case Ac.CRS:{const o=(i==null?void 0:i.vertCRS)||"unknown",a=(n==null?void 0:n.vertCRS)||"unknown",l=new K("layerview:incompatible-vertical-datum",`The vertical datum of the layer (${o}) must match the vertical datum of the scene (${a})`,{layerDatum:o,sceneDatum:a});return new K("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:i,sceneHeightModelInfo:n,error:l})}}return null}function ztt(t,e,r){if(!iue(t)||!iue(e))return Ac.Unsupported;if(t==null||e==null)return Ac.Ok;if(!r&&t.heightUnit!==e.heightUnit)return Ac.Units;if(t.heightModel!==e.heightModel)return Ac.HeightModel;switch(t.heightModel){case"gravity-related-height":return Ac.Ok;case"ellipsoidal":return t.vertCRS===e.vertCRS?Ac.Ok:Ac.CRS;default:return Ac.Unsupported}}var Ac;function iue(t){return t==null||t.heightModel!=null&&t.heightUnit!=null}function Utt(t){return"heightModelInfo"in t&&t.heightModelInfo!=null||t.spatialReference!=null||!X3e(t)}function W3e(t){var i;if(t.type==="integrated-mesh-3dtiles")return null;const e=t.url?Vte(t.url):void 0;return!(((i=t.spatialReference)==null?void 0:i.vcsWkid)==null&&e!=null&&e.serverType==="ImageServer")&&q3e(t)&&t.heightModelInfo?t.heightModelInfo:X3e(t)?DI.deriveUnitFromSR(Vtt,t.spatialReference):null}function q3e(t){return"heightModelInfo"in t}function Y3e(t){if(t.type==="unknown"||!("capabilities"in t))return!1;switch(t.type){case"catalog":case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"oriented-imagery":case"wfs":case"knowledge-graph-sublayer":return!0;default:return!1}}function X3e(t){return Y3e(t)?!!(t.capabilities&&t.capabilities.data&&t.capabilities.data.supportsZ):Z3e(t)}function Btt(t){return t.layers!=null||Z3e(t)||Y3e(t)||q3e(t)}function Z3e(t){switch(t.type){case"building-scene":case"elevation":case"integrated-mesh":case"integrated-mesh-3dtiles":case"point-cloud":case"scene":case"voxel":return!0;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"catalog":case"catalog-footprint":case"catalog-dynamic-group":case"csv":case"dimension":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"knowledge-graph":case"link-chart":case"knowledge-graph-sublayer":case"line-of-sight":case"map-image":case"map-notes":case"media":case"ogc-feature":case"open-street-map":case"oriented-imagery":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"video":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}(function(t){t[t.Ok=0]="Ok",t[t.Units=1]="Units",t[t.HeightModel=2]="HeightModel",t[t.CRS=3]="CRS",t[t.Unsupported=4]="Unsupported"})(Ac||(Ac={}));const Vtt=new DI({heightModel:"gravity-related-height"});let qY,IV=null;async function Gtt(t){IV||(IV=ge(()=>Promise.resolve().then(()=>DSt),void 0).then(e=>qY=e)),await IV,vt(t)}async function J3e(t,e,r,i){if(!t)return null;const n=t.spatialReference;return F3()||md(n,e)?M2(t,e):qY?qY.projectGeometry(t,e,r,i):(await Promise.race([Gtt(i),HE(i)]),J3e(t,e,r,i))}let Ki=class extends Ae{constructor(e){super(e),this.required={tileInfo:!1,heightModelInfo:!1,extent:!1},this.defaultSpatialReference=null,this.userSpatialReference=null,this.sourcePreloadCount=10,this.priorityCollection=null,this.requiresExtentInSpatialReference=!0,this.suspended=!1,this._projectExtentTask={task:null,input:null,output:null,spatialReference:null}}destroy(){this._projectExtentTask.task&&(this._projectExtentTask.task=wl(this._projectExtentTask.task)),this._set("map",null)}get ready(){return!this._spatialReferenceTask.updating&&!this._tileInfoTask.updating&&!this._extentTask.updating}get heightModelInfoReady(){return!this._heightModelInfoTask.updating}get spatialReference(){return this.userSpatialReference!=null?this.userSpatialReference:this._spatialReferenceTask.spatialReference}get extent(){return this._extentTask.extent}get heightModelInfo(){return this._heightModelInfoTask.heightModelInfo}get vcsWkid(){return this._heightModelInfoTask.vcsWkid}get latestVcsWkid(){return this._heightModelInfoTask.latestVcsWkid}get viewingMode(){return this.userSpatialReference==null||this.userSpatialReference.equals(this._spatialReferenceTask.spatialReference)?this._spatialReferenceTask.viewingMode:null}get tileInfo(){return this._tileInfoTask.tileInfo}get mapCollections(){var i,n,s,o;const e=(i=this.map)==null?void 0:i.call(this),r=[];return this.priorityCollection!=null&&r.push(this.priorityCollection),r.push({parent:e==null?void 0:e.basemap,layers:(n=e==null?void 0:e.basemap)==null?void 0:n.baseLayers},{layers:e==null?void 0:e.layers},{parent:e==null?void 0:e.ground,layers:(s=e==null?void 0:e.ground)==null?void 0:s.layers},{parent:e==null?void 0:e.basemap,layers:(o=e==null?void 0:e.basemap)==null?void 0:o.referenceLayers}),r}get _allLayers(){return this._collectLayers(this.mapCollections)}get _spatialReferenceTask(){if(this.suspended)return this._get("_spatialReferenceTask")??{updating:!1};const{layers:e,updating:r}=this._allLayers;let i=null;for(const s of e){const o=this._getSupportedSpatialReferences(s);if(o.length>0){const a=this._narrowDownSpatialReferenceCandidates(i,o);a!=null&&(i=a)}if(i!=null&&i.length===1)break}if(r&&(i==null||i.length!==1))return{updating:!0};const n=this._pickSpatialReferenceCandidate(i);return{spatialReference:n!=null?n.spatialReference:null,viewingMode:n!=null?n.viewingMode:null,updating:!1}}get _tileInfoTask(){var i,n,s,o,a,l,c;if(!this.required.tileInfo)return this._get("_tileInfoTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const{layers:e,updating:r}=this._collectLayers([{parent:(n=(i=this.map)==null?void 0:i.call(this))==null?void 0:n.basemap,layers:(a=(o=(s=this.map)==null?void 0:s.call(this))==null?void 0:o.basemap)==null?void 0:a.baseLayers},{layers:(c=(l=this.map)==null?void 0:l.call(this))==null?void 0:c.layers}]);if(e&&e.length>0&&"tileInfo"in e[0]){const u=e[0].tileInfo;return{tileInfo:u&&u.spatialReference.equals(this.spatialReference)?u:null,updating:!1}}return{updating:r}}get _heightModelInfoTask(){var i,n,s;if(!this.required.heightModelInfo||this.suspended&&((i=this._get("_heightModelInfoTask"))!=null&&i.heightModelInfo))return this._get("_heightModelInfoTask")??{updating:!1};const{layers:e,updating:r}=this._allLayers;for(const o of e)if(Btt(o)){const a=W3e(o);if(a)return{heightModelInfo:a,vcsWkid:(n=o.spatialReference)==null?void 0:n.vcsWkid,latestVcsWkid:(s=o.spatialReference)==null?void 0:s.latestVcsWkid,updating:!1}}return{updating:r}}get _extentCandidatesTask(){if(this.suspended||!this.required.extent)return this._get("_extentCandidatesTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const e=this._allLayers,r=e.updating,i=[];for(const n of e.layers){const s="fullExtents"in n&&n.fullExtents||(n.fullExtent!=null?[n.fullExtent]:[]),o=this.requiresExtentInSpatialReference?null:s[0],a=s.find(l=>l.spatialReference.equals(this.spatialReference))??o;if(a)return{candidates:[{extent:a,layer:n}],updating:!1};if(this._getSupportedSpatialReferences(n).length>0)for(const l of s)i.push({extent:l,layer:n})}return{candidates:i,updating:r}}get _extentTask(){const{candidates:e,updating:r}=this._extentCandidatesTask;if(r)return{updating:r};if(e==null||e.length===0)return{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const i=this._pickExtentCandidate(e),n=this.spatialReference;return i.extent.equals(this._projectExtentTask.input)&&n.equals(this._projectExtentTask.spatialReference)?{extent:this._projectExtentTask.output,updating:this._projectExtentTask.task!=null&&!this._projectExtentTask.task.finished}:(this._projectExtentTask.task!=null&&(this._projectExtentTask.task=wl(this._projectExtentTask.task)),this._projectExtentTask={input:i.extent.clone(),output:null,spatialReference:n.clone(),task:dy(async s=>{try{const o=await J3e(i.extent,n,"portalItem"in i.layer?i.layer.portalItem:void 0,s);this._projectExtentTask={...this._projectExtentTask,task:null,output:o}}catch{if(Ls(s))return;this._projectExtentTask={...this._projectExtentTask,task:null}}})},{updating:!0})}_narrowDownSpatialReferenceCandidates(e,r){if(e==null)return r;const i=[],n=(s,o)=>s!=null?o!=null?s===o&&s:s:o;for(const s of e)for(const o of r){if(!s.spatialReference.equals(o.spatialReference))continue;const a=n(s.viewingMode,o.viewingMode);if(a!==!1){i.push({spatialReference:s.spatialReference,viewingMode:a});break}}return i.length>0?i:null}_pickSpatialReferenceCandidate(e){const r=this.defaultSpatialReference;return e==null||e.length<1?r!=null?{spatialReference:r,viewingMode:null}:null:(r!=null&&e.length>1&&e.some(({spatialReference:i})=>i.equals(r))&&(e=e.filter(({spatialReference:i})=>i.equals(r))),e.length>1&&e.some(({viewingMode:i})=>i!==De.Local)&&(e=e.filter(({viewingMode:i})=>i!==De.Local)),e[0])}_getSupportedSpatialReferences(e){const r="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(r.length===0)return[];const i=[];for(const n of r){const s=this.getSpatialReferenceSupport({spatialReference:n,layer:e});if(s!=null){const o=s.constraints!=null?s.constraints:[{spatialReference:n,viewingMode:null}];for(const{spatialReference:a,viewingMode:l}of o)this.requiresExtentInSpatialReference&&this.userSpatialReference!=null&&!a.equals(this.userSpatialReference)||i.push({spatialReference:a,viewingMode:l})}}return i}_pickExtentCandidate(e){const r=this.spatialReference;return e.find(({extent:i})=>r.equals(i.spatialReference))||e[0]}_collectLayers(e){var i;if(this._loadMaybe((i=this.map)==null?void 0:i.call(this))!=="loaded")return{layers:[],updating:!0};const r=new jtt;for(const n of e)if(this._collectCollection(n,r),r.preloading===this.sourcePreloadCount)break;return{layers:r.layers,updating:r.updating}}_collectCollection(e,r){if(e.layers){switch(this._loadMaybe(e.parent)){case"loading":return r.updating=!0,void++r.preloading;case"failed":return}for(const i of e.layers){switch(this._loadMaybe(i)){case"failed":continue;case"loading":r.updating=!0,++r.preloading;break;case"loaded":r.updating||r.layers.push(i),"layers"in i&&this._collectCollection({layers:i.layers},r)}if(r.preloading===this.sourcePreloadCount)break}}}_loadMaybe(e){return e&&"loadStatus"in e&&e.loadStatus!=null?e.loadStatus==="not-loaded"?(e.load().catch(r=>{_s(r)||console.log(r)}),"loading"):e.loadStatus:"loaded"}};d([m()],Ki.prototype,"required",void 0),d([m({constructOnly:!0})],Ki.prototype,"map",void 0),d([m({constructOnly:!0})],Ki.prototype,"getSpatialReferenceSupport",void 0),d([m()],Ki.prototype,"defaultSpatialReference",void 0),d([m()],Ki.prototype,"userSpatialReference",void 0),d([m()],Ki.prototype,"sourcePreloadCount",void 0),d([m()],Ki.prototype,"priorityCollection",void 0),d([m()],Ki.prototype,"requiresExtentInSpatialReference",void 0),d([m()],Ki.prototype,"suspended",void 0),d([m({readOnly:!0})],Ki.prototype,"ready",null),d([m({readOnly:!0})],Ki.prototype,"heightModelInfoReady",null),d([m({readOnly:!0})],Ki.prototype,"spatialReference",null),d([m({readOnly:!0})],Ki.prototype,"extent",null),d([m({readOnly:!0})],Ki.prototype,"heightModelInfo",null),d([m({readOnly:!0})],Ki.prototype,"vcsWkid",null),d([m({readOnly:!0})],Ki.prototype,"latestVcsWkid",null),d([m({readOnly:!0})],Ki.prototype,"viewingMode",null),d([m({readOnly:!0})],Ki.prototype,"tileInfo",null),d([m({readOnly:!0})],Ki.prototype,"mapCollections",null),d([m({readOnly:!0})],Ki.prototype,"_allLayers",null),d([m({readOnly:!0})],Ki.prototype,"_spatialReferenceTask",null),d([m({readOnly:!0})],Ki.prototype,"_tileInfoTask",null),d([m({readOnly:!0})],Ki.prototype,"_heightModelInfoTask",null),d([m({readOnly:!0})],Ki.prototype,"_extentCandidatesTask",null),d([m()],Ki.prototype,"_extentTask",null),d([m()],Ki.prototype,"_projectExtentTask",void 0),Ki=d([V("esri.views.support.DefaultsFromMap")],Ki);let jtt=class{constructor(){this.layers=new Array,this.preloading=-1,this.updating=!1}};var gM;let Pt=gM=class extends Qn.EventedMixin(Gz(Ae)){constructor(t){super(t),this._userSpatialReference=null,this._cursor=null,this.handles=new $v,this.updatingHandles=new Jp,this.allLayerViews=new v$({getCollections:()=>{var e,r,i;return[(e=this.basemapView)==null?void 0:e.baseLayerViews,(r=this.groundView)==null?void 0:r.layerViews,this.layerViews,(i=this.basemapView)==null?void 0:i.referenceLayerViews]},getChildrenFunction:Wtt}),this.groundView=null,this.basemapView=null,this.fatalError=null,this.graphics=new Ox,this.analyses=new YE,this.typeSpecificPreconditionsReady=!0,this.layerViews=new $t,this.magnifier=new R3e,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this.spatialReferenceWarningDelay=1e3,this.supportsGround=!0,this.timeExtent=null,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.input=new Dtt,this.navigation=new B3e,this.layerViewManager=null,this.analysisViewManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new Ptt(this),this.persistableViewModels=new $t,this._isValid=!1,this._readyCycleForced=!1,this._lockedSpatialReference=null,this._userTimeZone=null,this._lockedTimeZone=null,this.theme=null,this.handles.add(he(()=>this.preconditionsReady,e=>{var i,n;const r=this.ready;if(e?(this._lockedSpatialReference=this.spatialReference,this._lockedTimeZone=this.timeZone,gM.views.add(this)):(this._lockedSpatialReference=null,gM.views.remove(this)),this.notifyChange("spatialReference"),!e&&r)(i=this.toolViewManager)==null||i.detach(),this.analysisViewManager!=null&&this.analysisViewManager.detach(),(n=this.layerViewManager)==null||n.clear(),this._teardown();else if(e&&!r){try{this._startup()}catch(s){return void queueMicrotask(()=>{console.error("View._startup failed",s),this.fatalError=new K("startup-error",null,s)})}this.analysisViewManager!=null&&this.analysisViewManager.attach(),this.toolViewManager.attach()}},Qr))}initialize(){this.addResolvingPromise(Promise.all([this.loadAsyncDependencies(),this.validate()]).then(()=>(this._isValid=!0,UE(()=>this.ready)))),this.basemapView=new $_({view:this}),this.layerViewManager=new ctt({view:this,layerViewImporter:{importLayerView:t=>this.importLayerView(t),hasLayerViewModule:t=>this.hasLayerViewModule(t)},supportsGround:this.supportsGround}),this.toolViewManager=new sm({view:this}),this._setupSpatialReferenceLogger(),this.selectionManager=new Ctt({view:this}),this.addHandles([he(()=>this.initialExtentRequired,t=>this.defaultsFromMap.required={...this.defaultsFromMap.required,extent:t},Kr),he(()=>this.ready,t=>{this.defaultsFromMap&&(this.defaultsFromMap.suspended=t,this.defaultsFromMap.userSpatialReference=t?this.spatialReference:this._userSpatialReference)},Qr),he(()=>this._userSpatialReference,t=>{this.defaultsFromMap&&(this.defaultsFromMap.userSpatialReference=t)},Kr)])}_setupSpatialReferenceLogger(){let t=null;this.addHandles([he(()=>{var e;return(e=this.defaultsFromMap)==null?void 0:e.ready},e=>{var i;const r=((i=this.map)==null?void 0:i.allLayers.length)>0;if(e&&!this.spatialReference&&r){if(t!=null)return;const n=Zr(()=>t=wl(t));t=dy(async s=>{try{await i$(this.spatialReferenceWarningDelay,null,s)}catch{return}finally{t=null}re.getLogger(this).warn("#spatialReference","no spatial reference could be derived from the currently added map layers")}),this.addHandles(n,"spatial-reference-logger-task")}else this.removeHandles("spatial-reference-logger-task")},{sync:!0})])}destroy(){var t,e;this.destroyed||(gM.views.remove(this),this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics=Pe(this.graphics),this.analyses=Pe(this.analyses),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),Pe(this.analysisViewManager),this.toolViewManager=Pe(this.toolViewManager),this.layerViewManager=Pe(this.layerViewManager),this.selectionManager=Pe(this.selectionManager),this.basemapView=Pe(this.basemapView),(t=this.groundView)==null||t.destroy(),(e=this.layerViews)==null||e.forEach(r=>r.destroy()),this.layerViews.length=0,this.invalidate(),this._emitter.clear(),this.handles.destroy(),this.map=Pe(this.map),this.updatingHandles.destroy())}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return re.getLogger(this).error("#toMap()","Not implemented on this instance of View"),null}get activeTool(){var t;return(t=this.toolViewManager)==null?void 0:t.activeTool}set activeTool(t){this.toolViewManager&&(this.toolViewManager.activeTool=t)}get animation(){return this._get("animation")}set animation(t){this._set("animation",t)}get center(){return null}get _defaultsFromMapSettings(){return{}}get defaultsFromMap(){return new Ki({required:{tileInfo:!1,heightModelInfo:!1,extent:!1},map:()=>this.map,getSpatialReferenceSupport:t=>this.getSpatialReferenceSupport(t),...this._defaultsFromMapSettings})}get extent(){return this._get("extent")}set extent(t){this._set("extent",t)}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get interacting(){return this.navigating}get navigating(){return!1}get preconditionsReady(){var t;return!(this.fatalError||!this._isValid||this._readyCycleForced||!this.map||Q0.isLoadable(this.map)&&!this.map.loaded||this.width===0||this.height===0||!this.spatialReference||!this._validateSpatialReference(this.spatialReference)||!this._lockedSpatialReference&&!((t=this.defaultsFromMap)!=null&&t.ready)||!this.typeSpecificPreconditionsReady)}get resolution(){return 0}set map(t){t!==this._get("map")&&(t!=null&&t.destroyed&&(re.getLogger(this).warn("#map","The provided map is already destroyed",{map:t}),t=null),Q0.isLoadable(t)&&t.load().catch(()=>{}),this.constructed&&!this.destroyed&&(this.forceReadyCycle(),this._lockedSpatialReference=null),this._set("map",t))}get spatialReference(){var e,r;const t=this._userSpatialReference||this._lockedSpatialReference||this.getDefaultSpatialReference()||null;if(t&&((r=(e=this.defaultsFromMap)==null?void 0:e.required)!=null&&r.heightModelInfo)){const i=t.clone();return i.vcsWkid=this.defaultsFromMap.vcsWkid,i.latestVcsWkid=this.defaultsFromMap.latestVcsWkid,i}return t}set spatialReference(t){const e=!To(t,this._get("spatialReference"));this._set("_userSpatialReference",t),e&&(this._set("spatialReference",t),this._spatialReferenceChanged(t))}_spatialReferenceChanged(t){}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get timeZone(){return this._userTimeZone??this._lockedTimeZone??this.getDefaultTimeZone()??og}set timeZone(t){const e=new Set(["etc/utc","etc/gmt","gmt"]),r=new Set(Intl.supportedValuesOf("timeZone").map(i=>i.toLowerCase()));this._userTimeZone=t,t===og||t===Iee||e.has(t.toLowerCase())||r.has(t.toLowerCase())||re.getLogger(this).warn("#timeZone",`the parsed value '${t}' may not be a valid IANA time zone`)}get tools(){var t;return(t=this.toolViewManager)==null?void 0:t.tools}get initialExtent(){var t;return(t=this.defaultsFromMap)==null?void 0:t.extent}get cursor(){var t;return((t=this.toolViewManager)==null?void 0:t.cursor)??this._cursor??"default"}set cursor(t){this._cursor=t,this.notifyChange("cursor")}get size(){return[this.width,this.height]}get effectiveTheme(){return this.theme??new HY}whenLayerView(t){var e;return((e=this.layerViewManager)==null?void 0:e.whenLayerView(t))??Promise.reject()}getDefaultSpatialReference(){var t;return(t=this.defaultsFromMap)==null?void 0:t.spatialReference}getDefaultHeightModelInfo(){var t;return(this.map&&"heightModelInfo"in this.map?this.map.heightModelInfo:void 0)??((t=this.defaultsFromMap)==null?void 0:t.heightModelInfo)??null}getDefaultTimeZone(){return null}importLayerView(t){throw new K("importLayerView() not implemented")}hasLayerViewModule(t){return!1}async validate(){}async loadAsyncDependencies(){}invalidate(){this._isValid=!1}getSpatialReferenceSupport(){return{constraints:null}}_validateSpatialReference(t){return this.getSpatialReferenceSupport({spatialReference:t})!=null}when(t,e){return this.isResolved()&&!this.ready&&re.getLogger(this).warn("#when()","Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use reactiveUtils.whenOnce(() => view.ready).then(...) instead."),super.when(t,e)}forceReadyCycle(){this.ready&&(fd(()=>this.destroyed||this.preconditionsReady===!1,()=>this._readyCycleForced=!1,{once:!0}),this._readyCycleForced=!0)}addAndActivateTool(t){this.toolViewManager.tools.add(t),this.activeTool=t}tryFatalErrorRecovery(){this.fatalError=null}};Pt.views=new $t,d([m()],Pt.prototype,"_userSpatialReference",void 0),d([m()],Pt.prototype,"activeTool",null),d([m({readOnly:!0})],Pt.prototype,"allLayerViews",void 0),d([m()],Pt.prototype,"groundView",void 0),d([m()],Pt.prototype,"animation",null),d([m()],Pt.prototype,"basemapView",void 0),d([m()],Pt.prototype,"center",null),d([m({readOnly:!0})],Pt.prototype,"_defaultsFromMapSettings",null),d([m()],Pt.prototype,"defaultsFromMap",null),d([m()],Pt.prototype,"fatalError",void 0),d([m({type:ei})],Pt.prototype,"extent",null),d([m(p6(Ox,"graphics"))],Pt.prototype,"graphics",void 0),d([m(p6(YE,"analyses"))],Pt.prototype,"analyses",void 0),d([m({readOnly:!0,type:DI})],Pt.prototype,"heightModelInfo",null),d([m({readOnly:!0})],Pt.prototype,"interacting",null),d([m({readOnly:!0})],Pt.prototype,"navigating",null),d([m({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_lockedSpatialReference","defaultsFromMap.ready","typeSpecificPreconditionsReady"]})],Pt.prototype,"preconditionsReady",null),d([m({readOnly:!0})],Pt.prototype,"typeSpecificPreconditionsReady",void 0),d([m({type:$t,readOnly:!0})],Pt.prototype,"layerViews",void 0),d([m()],Pt.prototype,"resolution",null),d([m({type:R3e})],Pt.prototype,"magnifier",void 0),d([m({value:null,type:w2e})],Pt.prototype,"map",null),d([m()],Pt.prototype,"padding",void 0),d([m({readOnly:!0})],Pt.prototype,"ready",void 0),d([m({type:lt})],Pt.prototype,"spatialReference",null),d([m()],Pt.prototype,"spatialReferenceWarningDelay",void 0),d([m()],Pt.prototype,"stationary",null),d([m({readOnly:!0})],Pt.prototype,"supportsGround",void 0),d([m({type:SEe})],Pt.prototype,"timeExtent",void 0),d([m({type:String,nonNullable:!0})],Pt.prototype,"timeZone",null),d([m()],Pt.prototype,"tools",null),d([m()],Pt.prototype,"toolViewManager",void 0),d([m({readOnly:!0})],Pt.prototype,"type",void 0),d([m({type:Number})],Pt.prototype,"scale",void 0),d([m({readOnly:!0})],Pt.prototype,"updating",void 0),d([m({readOnly:!0})],Pt.prototype,"initialExtentRequired",void 0),d([m({readOnly:!0})],Pt.prototype,"initialExtent",null),d([m()],Pt.prototype,"cursor",null),d([m({readOnly:!0})],Pt.prototype,"input",void 0),d([m({type:B3e,nonNullable:!0})],Pt.prototype,"navigation",void 0),d([m()],Pt.prototype,"layerViewManager",void 0),d([m()],Pt.prototype,"analysisViewManager",void 0),d([m()],Pt.prototype,"selectionManager",void 0),d([m()],Pt.prototype,"width",void 0),d([m()],Pt.prototype,"height",void 0),d([m({readOnly:!0})],Pt.prototype,"resizing",void 0),d([m({value:null,readOnly:!0})],Pt.prototype,"size",null),d([m({readOnly:!0})],Pt.prototype,"suspended",void 0),d([m({readOnly:!0})],Pt.prototype,"viewEvents",void 0),d([m({readOnly:!0})],Pt.prototype,"persistableViewModels",void 0),d([m()],Pt.prototype,"_isValid",void 0),d([m()],Pt.prototype,"_readyCycleForced",void 0),d([m()],Pt.prototype,"_lockedSpatialReference",void 0),d([m()],Pt.prototype,"_userTimeZone",void 0),d([m()],Pt.prototype,"_lockedTimeZone",void 0),d([m({type:HY})],Pt.prototype,"theme",void 0),d([m({readOnly:!0,type:HY})],Pt.prototype,"effectiveTheme",null),Pt=gM=d([V("esri.views.View")],Pt);const Htt=Pt;function Wtt(t){return t.layerViews}let L_=class extends Hk{constructor(e){super(e),this.state="running",this.target=null,this._resolver=null}initialize(){this._resolver=ha(),this.addResolvingPromise(this._resolver.promise)}get done(){return this.state==="finished"||this.state==="stopped"}stop(){var e;this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","stopped"),(e=this._resolver)==null||e.reject(new K("ViewAnimation stopped")))}finish(){var e;this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","finished"),(e=this._resolver)==null||e.resolve())}update(e,r){r||(r=nu(e)?"waiting-for-target":"running"),this._set("target",e),this._set("state",r)}};d([m({readOnly:!0})],L_.prototype,"done",null),d([m({readOnly:!0,type:String})],L_.prototype,"state",void 0),d([m()],L_.prototype,"target",void 0),L_=d([V("esri.views.ViewAnimation")],L_),function(t){t.State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"}}(L_||(L_={}));const r3=L_,VP=()=>ge(()=>import("./TileLayerView3D-TxxDwqh-.js"),__vite__mapDeps([127,128,129,130,131,132,133,134,135,136])),nue=()=>ge(()=>import("./ElevationLayerView3D-Cc9AmKc2.js"),__vite__mapDeps([137,128,129,130])),sue={"base-dynamic":()=>ge(()=>import("./BaseDynamicLayerView3D-B8u8C6tl.js"),__vite__mapDeps([138,139,128,140,141,130,131])),"base-elevation":nue,"base-tile":VP,"bing-maps":VP,"building-scene":()=>ge(()=>import("./BuildingSceneLayerView3D-BQoOiU4W.js"),__vite__mapDeps([142,143,144,90,58,89,40,38,21,95,3,96,97,50,92,98,7,99,100,101,102,103,104,9,105,106,88,93,107,108,109,110,111,112,8,113,10,11,114,115,116,117,118,119,120,16,94,121,122,145,146,147,76,69,135,36,37,148,149,150,151,75,123,152,153,154,155,156,157,126,158,41,33,34,133,35,28,39,20,22,23,24,31,32,140,128,49,47,48,159,130,131,160,161,162,163,74,164,165])),csv:()=>ge(()=>import("./CSVLayerView3D-DahsZgDd.js"),__vite__mapDeps([166,154,155,156,157,126,58,158,90,89,40,38,21,41,33,34,135,103,133,35,36,37,28,39,20,22,23,24,92,31,32,140,128,49,47,48,50,159,9,102,130,131])),dimension:()=>ge(()=>import("./DimensionLayerView3D-DodwrSdt.js"),__vite__mapDeps([167,128,130])),elevation:nue,feature:()=>ge(()=>import("./FeatureLayerView3D-DcDFWJ4a.js"),__vite__mapDeps([153,154,155,156,157,126,58,158,90,89,40,38,21,41,33,34,135,103,133,35,36,37,28,39,20,22,23,24,92,31,32,140,128,49,47,48,50,159,9,102,130,131])),geojson:()=>ge(()=>import("./GeoJSONLayerView3D-DURE-ePf.js"),__vite__mapDeps([168,154,155,156,157,126,58,158,90,89,40,38,21,41,33,34,135,103,133,35,36,37,28,39,20,22,23,24,92,31,32,140,128,49,47,48,50,159,9,102,130,131])),graphics:()=>ge(()=>import("./GraphicsLayerView3D-CpDe5lBY.js"),__vite__mapDeps([169,128,157,170,58,158,90,89,40,38,21,41,33,34,135,140,130])),group:()=>ge(()=>import("./GroupLayerView-39Rky0QM.js"),__vite__mapDeps([171,130])),imagery:()=>ge(()=>import("./ImageryLayerView3D-wuBpkCZC.js"),__vite__mapDeps([172,139,128,140,141,130,131,9,135])),"integrated-mesh":()=>ge(()=>import("./IntegratedMeshLayerView3D-B6SKy_xl.js"),__vite__mapDeps([173,148,149,150,151,75,76,69,123,106,152,92,153,154,155,156,157,126,58,158,90,89,40,38,21,41,33,34,135,103,133,35,36,37,28,39,20,22,23,24,31,32,140,128,49,47,48,50,159,9,102,130,131,160,161,112,162,163,74])),"integrated-mesh-3dtiles":()=>ge(()=>import("./IntegratedMesh3DTilesLayerView3D-DJZGNcXH.js"),__vite__mapDeps([174,149,150,83,128,130])),"line-of-sight":()=>ge(()=>import("./LineOfSightLayerView3D-AzTNXhI9.js"),__vite__mapDeps([175,128,130])),"map-image":()=>ge(()=>import("./MapImageLayerView3D-2yfCqGlp.js"),__vite__mapDeps([176,139,128,140,141,130,131,9,177,133,134,132,135,136])),media:()=>ge(()=>import("./MediaLayerView3D-DgGJ75Fk.js"),__vite__mapDeps([178,179,180,128,141,130])),"ogc-feature":()=>ge(()=>import("./OGCFeatureLayerView3D-0zVBZjz9.js"),__vite__mapDeps([181,154,155,156,157,126,58,158,90,89,40,38,21,41,33,34,135,103,133,35,36,37,28,39,20,22,23,24,92,31,32,140,128,49,47,48,50,159,9,102,130,131])),"open-street-map":VP,"oriented-imagery":()=>ge(()=>import("./FeatureLayerView3D-DcDFWJ4a.js"),__vite__mapDeps([153,154,155,156,157,126,58,158,90,89,40,38,21,41,33,34,135,103,133,35,36,37,28,39,20,22,23,24,92,31,32,140,128,49,47,48,50,159,9,102,130,131])),"point-cloud":()=>ge(()=>import("./PointCloudLayerView3D-C4u6SxmH.js"),__vite__mapDeps([182,128,76,69,67,68,183,135,130])),voxel:()=>ge(()=>import("./VoxelLayerView3D-V179zpnr.js"),__vite__mapDeps([184,128,183,135,130])),route:()=>ge(()=>import("./RouteLayerView3D-qfQsaKel.js"),__vite__mapDeps([185,186,128,170,58,158,90,89,40,38,21,41,33,34,135,140,159,130])),scene:t=>t.profile==null||t.profile==="mesh-pyramids"?ge(()=>import("./SceneLayerView3D-yAh8KGjD.js"),__vite__mapDeps([187,123,36,37,38,103,133,148,149,150,151,75,76,69,106,152,92,153,154,155,156,157,126,58,158,90,89,40,21,41,33,34,135,35,28,39,20,22,23,24,31,32,140,128,49,47,48,50,159,9,102,130,131,160,161,112,162,163,74,188,165,164,183])):ge(()=>import("./SceneLayerGraphicsView3D-54gP3uC2.js"),__vite__mapDeps([189,151,150,75,76,69,123,106,152,92,153,154,155,156,157,126,58,158,90,89,40,38,21,41,33,34,135,103,133,35,36,37,28,39,20,22,23,24,31,32,140,128,49,47,48,50,159,9,102,130,131,188,165,183])),stream:()=>ge(()=>import("./StreamLayerView3D-Dn1vr92q.js"),__vite__mapDeps([190,64,65,49,47,48,50,159,155,156,157,126,58,158,90,89,40,38,21,41,33,34,135,103,133,35,36,37,28,39,20,22,23,24,92,31,32,140,128,130])),tile:VP,"imagery-tile":()=>ge(()=>import("./ImageryTileLayerView3D-DYej-teh.js"),__vite__mapDeps([191,73,128,129,9,135,130,131,136])),"vector-tile":()=>ge(()=>import("./VectorTileLayerView3D-Cl3IYcKz.js"),__vite__mapDeps([192,61,48,60,193,81,128,129,130])),wcs:()=>ge(()=>import("./ImageryTileLayerView3D-DYej-teh.js"),__vite__mapDeps([191,73,128,129,9,135,130,131,136])),"web-tile":VP,wfs:()=>ge(()=>import("./WFSLayerView3D-BukLiMOV.js"),__vite__mapDeps([194,154,155,156,157,126,58,158,90,89,40,38,21,41,33,34,135,103,133,35,36,37,28,39,20,22,23,24,92,31,32,140,128,49,47,48,50,159,9,102,130,131])),wms:()=>ge(()=>import("./WMSLayerView3D-2N9k8cP-.js"),__vite__mapDeps([195,139,128,140,141,130,131,9,196])),wmts:()=>ge(()=>import("./WMTSLayerView3D-CYEDd0c7.js"),__vite__mapDeps([197,128,129,130,131])),catalog:null,"catalog-dynamic-group":null,"catalog-footprint":null,"geo-rss":null,kml:null,"knowledge-graph":null,"link-chart":null,"knowledge-graph-sublayer":null,"map-notes":null,"subtype-group":null,unknown:null,unsupported:null,video:null};function qtt(t){const e=t.declaredClass?t.declaredClass.slice(t.declaredClass.lastIndexOf(".")+1):"Unknown",r=e.replaceAll(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new K(`${r}:view-not-supported`,`${e} is not supported in 3D`)}const oue={hasLayerViewModule:t=>sue[t.type]!=null,importLayerView:t=>{const e=sue[t.type];if(e==null)throw qtt(t);return e(t)}},aue="analyses-owner-handles";var lC,Vw;(function(t){t[t.PENDING=0]="PENDING",t[t.CREATED=1]="CREATED"})(lC||(lC={})),function(t){t[t.ADDED=0]="ADDED",t[t.REMOVED=1]="REMOVED"}(Vw||(Vw={}));let uw=class extends Ae{constructor(e){super(e),this._allAnalysisViews=new $t,this._creatingViewCount=0,this._items=new Map,this._scheduledUpdateHandle=null,this._attachedToViewResolver=lue(),this._analysisModules={"area-measurement":{module:null},dimension:{module:null},"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null}}}destroy(){this._disconnectOwners(),this._attachedToViewResolver.reject(dr("AnalysisViewManager was destroyed"))}attach(){this._connectOwners(),this._attachedToViewResolver.resolve()}detach(){this._disconnectOwners(),this._attachedToViewResolver.reject(dr()),this._attachedToViewResolver=lue()}get updating(){return!this.view.ready||this._creatingViewCount!==0||this._allAnalysisViews.some(e=>e.updating)}get testInfo(){return{allAnalysisViews:this._allAnalysisViews}}async whenAnalysisView(e){await this._attachedToViewResolver.promise;const r=this._items.get(e);if(r==null||r.state.list===Vw.REMOVED)throw new K("AnalysisViewManager:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});return r.createAnalysisViewTask.promise}_connectOwners(){this.addHandles(this._connectAnalysesCollection(this.view.analyses),aue)}_disconnectOwners(){this.removeHandles(aue),this._update(),this._creatingViewCount=0}_connectAnalysesCollection(e){for(const n of e)this._addAnalysis(n);const r=e.on("after-add",n=>this._addAnalysis(n.item)),i=e.on("after-remove",n=>this._removeAnalysis(n.item));return Zr(()=>{r.remove(),i.remove();for(const n of e)this._removeAnalysis(n)})}_addAnalysis(e){const r=this._items.get(e);if(r==null){const i={state:{view:lC.PENDING,list:Vw.ADDED},analysis:e,view:null,createAnalysisViewTask:null};this._items.set(e,i),i.createAnalysisViewTask=dy(n=>this._createAnalysisViewPromise(i,n))}else r.state.list=Vw.ADDED}_removeAnalysis(e){const r=this._items.get(e);r!=null?(r.state.list=Vw.REMOVED,this._scheduleUpdate()):re.getLogger(this).error("Trying to remove analysis which was not added")}_scheduleUpdate(){this._scheduledUpdateHandle==null&&(this._scheduledUpdateHandle=M3(()=>this._update()))}_update(){this._scheduledUpdateHandle=wi(this._scheduledUpdateHandle),this._items.forEach(e=>{if(e.state.list===Vw.REMOVED)switch(this._items.delete(e.analysis),e.state.view){case lC.PENDING:e.createAnalysisViewTask=wl(e.createAnalysisViewTask);break;case lC.CREATED:e.view!=null&&(this._allAnalysisViews.remove(e.view),e.view=Pe(e.view),e.createAnalysisViewTask=null)}})}async _createAnalysisViewPromise(e,r){const i=e.analysis,n=i.type,s=this._analysisModules[n];if(this._creatingViewCount+=1,s.module==null)try{s.module=await this._loadAnalysisModule(n)}catch(a){throw this._creatingViewCount-=1,a}if(Ls(r))throw this._creatingViewCount-=1,dr("AnalysisView creation aborted");const o=new s.module.default({analysis:i,view:this.view});try{await o.when()}catch(a){throw this._creatingViewCount-=1,a}if(Ls(r))throw this._creatingViewCount-=1,o.destroy(),dr("AnalysisView creation aborted");return e.view=o,e.state.view=lC.CREATED,this._allAnalysisViews.add(o),this._creatingViewCount-=1,o}_loadAnalysisModule(e){switch(e){case"area-measurement":return ge(()=>import("./AreaMeasurementAnalysisView3D-D02-cmVo.js"),__vite__mapDeps([198,199,200,86,201,202,27,203,204]));case"dimension":return ge(()=>import("./DimensionAnalysisView3D-D2aIUzKu.js").then(r=>r.D),__vite__mapDeps([205,201,206,200,86,202,27,203,207,208,209,141,193,210,204,103,133,156]));case"direct-line-measurement":return ge(()=>import("./DirectLineMeasurementAnalysisView3D-CtZnRphp.js"),__vite__mapDeps([211,199,200,86,201,202,27,203,207]));case"line-of-sight":return ge(()=>import("./LineOfSightAnalysisView3D-C9N84sgw.js"),__vite__mapDeps([212,201,213,161,112,162,163,208,210]));case"slice":return ge(()=>import("./SliceAnalysisView3D-BztPzci8.js"),__vite__mapDeps([214,201,161,112,162,163,144,90,58,89,40,38,21,95,3,96,97,50,92,98,7,99,100,101,102,103,104,9,105,106,88,93,107,108,109,110,111,8,113,10,11,114,115,116,117,118,119,120,16,94,121,122,145,146,147,76,69,135,208,209,141]))}}};function lue(){const t=ha();return t.promise.catch(()=>{}),t}d([m()],uw.prototype,"updating",null),d([m({constructOnly:!0})],uw.prototype,"view",void 0),d([m()],uw.prototype,"_allAnalysisViews",void 0),d([m()],uw.prototype,"_creatingViewCount",void 0),uw=d([V("esri.views.3d.analysis.AnalysisViewManager3D")],uw);const Ytt=uw;let r0=class extends Ae{constructor(e){super(e),this.collision=new yM,this.distance=1/0,this.minimumPoiDistance=4,this.tilt=null}get altitude(){return this.mode===De.Local?null:this._get("altitude")||null}set altitude(e){this.mode!==De.Local?this._set("altitude",e):re.getLogger(this).warn("Altitude constraint is ignored in local scenes")}clampAltitude(e){return this.altitude?we(e,this.altitude.min,this.altitude.max):e}clampTilt(e,r){if(!this.tilt)return r;const i=this.tilt(e);return we(r,i.min,i.max)}clampDistance(e){return Math.min(e,this.distance)}createDefaultTilt(){return this.mode===De.Local?this._createDefaultTiltLocal():this._createDefaultTiltGlobal()}createConstantMaxTilt(e){return(r,i=LV)=>(i.min=ea.min,i.max=e,i)}_createDefaultTiltLocal(){const e=this.collision.enabled?w5([[4e3,ea.max],[1e4,Nt(88)],[6e6,Nt(88)]]):()=>ea.max;return(r,i=LV)=>(i.min=ea.min,i.max=e(r),i)}_createDefaultTiltGlobal(){const e=this.collision.enabled?w5([[4e3,ea.max],[5e4,Nt(88)],[6e6,Nt(88)],[2e7,ea.min]]):w5([[3e5,ea.max],[3e6,Nt(88)],[6e6,Nt(88)],[2e7,ea.min]]);return(r,i=LV)=>(i.min=ea.min,i.max=e(r),i)}};function Xtt(t){return{min:-2e5,max:4*t.radius}}d([m()],r0.prototype,"altitude",null),d([m({readOnly:!0})],r0.prototype,"collision",void 0),d([m()],r0.prototype,"distance",void 0),d([m({readOnly:!0})],r0.prototype,"minimumPoiDistance",void 0),d([m()],r0.prototype,"tilt",void 0),d([m({constructOnly:!0})],r0.prototype,"mode",void 0),r0=d([V("esri.views.3d.state.Constraints")],r0);const cue=Xtt(Yr),ea={min:Nt(.5),max:Nt(179.5)},LV={min:0,max:0};let yM=class extends Ae{constructor(){super(...arguments),this.enabled=!0,this.elevationMargin=5}};d([m({type:Boolean})],yM.prototype,"enabled",void 0),d([m({type:Number})],yM.prototype,"elevationMargin",void 0),yM=d([V("esri.views.3d.state.Constraints.CollisionConstraint")],yM);let cC=class extends nv{constructor(){super(...arguments),this.min=cue.min,this.max=cue.max}};d([m({type:Number})],cC.prototype,"min",void 0),d([m({type:Number})],cC.prototype,"max",void 0),cC=d([V("esri.views.3d.constraints.AltitudeConstraint")],cC);let m0=class extends nv{constructor(){super(...arguments),this.mode="auto"}get near(){return this._get("near")}set near(e){this._set("near",e),e>=this._get("far")&&(this.far=e+1e-9),this.mode="manual"}castNear(e){return Math.max(1e-8,e)}get far(){return this._get("far")}set far(e){this._set("far",e),e<=this._get("near")&&(this.near=e-1e-9),this.mode="manual"}castFar(e){return Math.max(1e-8,e)}autoUpdate(e,r){this.mode==="auto"&&(this._get("near")!==e&&this._set("near",e),this._get("far")!==r&&this._set("far",r))}};d([m({type:Number,value:1e-8})],m0.prototype,"near",null),d([ai("near")],m0.prototype,"castNear",null),d([m({type:Number,value:1e-8})],m0.prototype,"far",null),d([ai("far")],m0.prototype,"castFar",null),d([m({type:["auto","manual"]})],m0.prototype,"mode",void 0),m0=d([V("esri.views.3d.constraints.ClipDistanceConstraint")],m0);const YY={min:Fa(ea.min),max:Fa(ea.max)};let Gw=class extends nv{constructor(e){super(e),this.mode="auto"}get max(){return this._get("max")}set max(e){this._set("max",e),this.mode="manual"}castMax(e){return we(e,YY.min,YY.max)}autoUpdate(e){this.mode==="auto"&&this._get("max")!==e&&this._set("max",e)}};d([m({type:["auto","manual"]})],Gw.prototype,"mode",void 0),d([m({type:Number,value:YY.max})],Gw.prototype,"max",null),d([ai("max")],Gw.prototype,"castMax",null),Gw=d([V("esri.views.3d.constraints.TiltConstraint")],Gw);let jw=class extends nv{constructor(){super(...arguments),this.tilt=new Gw,this.altitude=new cC,this.clipDistance=new m0}};d([m({type:Gw})],jw.prototype,"tilt",void 0),d([m({type:cC})],jw.prototype,"altitude",void 0),d([m({type:m0})],jw.prototype,"clipDistance",void 0),jw=d([V("esri.views.3d.constraints.Constraints")],jw);var XY;let xh=XY=class extends ze{constructor(t){super(t),this.type="sun",this.date=null,this.directShadowsEnabled=!1,this.displayUTCOffset=null}readDate(t,e){return e.datetime!=null&&new Date(e.datetime)||null}writeDate(t,e,r){e[r]=t.getTime()}readDirectShadowsEnabled(t,e){return!!e.directShadows}writedirectShadowsEnabled(t,e,r){t&&(e[r]=t)}writeDisplayUTCOffset(t,e){t!=null&&(e.displayUTCOffset=t)}clone(){return new XY(this.cloneConstructProperties())}cloneConstructProperties(){const t={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:this.displayUTCOffset!=null?this.displayUTCOffset:null};return this.date!=null&&(t.date=new Date(this.date.getTime())),t}};d([m({readOnly:!0,type:["sun"],json:{write:!0}})],xh.prototype,"type",void 0),d([m({type:Date,json:{type:Number,write:{target:"datetime"}}})],xh.prototype,"date",void 0),d([Tr("date",["datetime"])],xh.prototype,"readDate",null),d([hr("date")],xh.prototype,"writeDate",null),d([m({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],xh.prototype,"directShadowsEnabled",void 0),d([Tr("directShadowsEnabled",["directShadows"])],xh.prototype,"readDirectShadowsEnabled",null),d([hr("directShadowsEnabled")],xh.prototype,"writedirectShadowsEnabled",null),d([m({type:Number,json:{write:!0}})],xh.prototype,"displayUTCOffset",void 0),d([hr("displayUTCOffset")],xh.prototype,"writeDisplayUTCOffset",null),xh=XY=d([V("esri.webscene.SunLighting")],xh);const $$=xh;var wS;let om=wS=class extends Qn.EventedMixin($$){constructor(t){super(t),this.cameraTrackingEnabled=!0,this.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};const e=new Date().getFullYear(),r=new Date("March 15, "+e+" 12:00:00 UTC");this._set("defaultDate",r),this._set("date",r)}get ambientOcclusionEnabled(){return y1(re.getLogger(this),"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._get("ambientOcclusionEnabled")??!1}set ambientOcclusionEnabled(t){y1(re.getLogger(this),"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._set("ambientOcclusionEnabled",t)}get waterReflectionEnabled(){return y1(re.getLogger(this),"waterReflectionEnabled",{replacement:"reflections are automatically shown and this property has no effect",version:"4.27"}),this._get("waterReflectionEnabled")??!1}set waterReflectionEnabled(t){y1(re.getLogger(this),"waterReflectionEnabled",{replacement:"reflections are automatically shown and this property has no effect",version:"4.27"}),this._set("waterReflectionEnabled",t)}get defaultDate(){return new Date(this._get("defaultDate").getTime())}static fromWebsceneLighting(t){return new wS(t.cloneConstructProperties())}set defaultDate(t){const e=this._get("date")===this._get("defaultDate");t=new Date(t.getTime()),this._set("defaultDate",t),e&&this._set("date",t)}set date(t){t!=null&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(t.getTime())))}autoUpdate(t,e){const r=wS.calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=e.hours,this.positionTimezoneInfo.minutes=e.minutes,this.positionTimezoneInfo.seconds=e.seconds;let i=null;t!=null&&(this.positionTimezoneInfo.autoUpdated=!0,isNaN(t.getTime())?(i=this.defaultDate.getTime(),this._set("date",this.defaultDate)):(i=this.date&&this.date.getTime(),this._set("date",new Date(t.getTime()))));const n=wS.calculateTimezoneOffset(this.positionTimezoneInfo);if(r!==n&&(LD.target=this,LD.timezoneOffset=n,this.emit("timezone-will-change",LD),LD.target=null),t!=null)return isNaN(t.getTime())||i!==t.getTime()}clone(){const t=this._get("date")===this._get("defaultDate"),e=new wS({...this.cloneConstructProperties(),defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled});return t&&e._set("date",e._get("defaultDate")),e.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated,e.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours,e.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes,e.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds,e}cloneWithWebsceneLighting(t){const e=this.clone();return t.date!=null&&(e.date=t.date),e.directShadowsEnabled=t.directShadowsEnabled,e.displayUTCOffset=t.displayUTCOffset,e}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};d([m({type:Boolean})],om.prototype,"cameraTrackingEnabled",void 0),d([m({type:Boolean})],om.prototype,"ambientOcclusionEnabled",null),d([m({type:Boolean})],om.prototype,"waterReflectionEnabled",null),d([m({type:Date})],om.prototype,"defaultDate",null),d([m({type:Date})],om.prototype,"date",null),om=wS=d([V("esri.views.3d.environment.SunLighting")],om),function(t){function e({hours:r,minutes:i,seconds:n}){return Math.round(r+i/60+n/3600)}t.calculateTimezoneOffset=e}(om||(om={}));const LD={target:null,timezoneOffset:0},hw=om;var ZY;let _M=ZY=class extends ze{constructor(t){super(t),this.type="virtual",this.directShadowsEnabled=!1}clone(){return new ZY(this.cloneConstructProperties())}cloneConstructProperties(){return{directShadowsEnabled:this.directShadowsEnabled}}};d([m({readOnly:!0,type:["virtual"],json:{write:!0}})],_M.prototype,"type",void 0),d([m({type:Boolean,json:{default:!1,name:"directShadows",write:!0}})],_M.prototype,"directShadowsEnabled",void 0),_M=ZY=d([V("esri.webscene.VirtualLighting")],_M);const eU=_M;var Z5;let xS=Z5=class extends Qn.EventedMixin(eU){constructor(t){super(t),this.cameraTrackingEnabled=!0}get ambientOcclusionEnabled(){return y1(re.getLogger(this),"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._get("ambientOcclusionEnabled")??!1}set ambientOcclusionEnabled(t){y1(re.getLogger(this),"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._set("ambientOcclusionEnabled",t)}get waterReflectionEnabled(){return y1(re.getLogger(this),"waterReflectionEnabled",{replacement:"water reflections are automatically shown and this property has no effect",version:"4.27"}),this._get("waterReflectionEnabled")??!1}set waterReflectionEnabled(t){y1(re.getLogger(this),"waterReflectionEnabled",{replacement:"water reflections are automatically shown and this property has no effect",version:"4.27"}),this._set("waterReflectionEnabled",t)}clone(){return new Z5({...this.cloneConstructProperties(),cameraTrackingEnabled:this.cameraTrackingEnabled})}static fromWebsceneLighting(t){return new Z5(t.cloneConstructProperties())}cloneWithWebsceneLighting(t){const e=this.clone();return e.directShadowsEnabled=t.directShadowsEnabled,e}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};d([m({type:Boolean})],xS.prototype,"ambientOcclusionEnabled",null),d([m({type:Boolean})],xS.prototype,"waterReflectionEnabled",null),d([m({type:Boolean})],xS.prototype,"cameraTrackingEnabled",void 0),xS=Z5=d([V("esri.views.3d.environment.VirtualLighting")],xS);const vM=xS,Ztt={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:hw,virtual:vM}};var JY;let sR=JY=class extends Ae{set quality(t){["low","high"].includes(t)&&this._set("quality",t)}clone(){return new JY({quality:this.quality})}};d([m({type:["low","high"],value:"low"})],sR.prototype,"quality",null),sR=JY=d([V("esri.views.3d.environment.SceneViewAtmosphere")],sR);var QY;let bM=QY=class extends ze{constructor(t){super(t),this.type="sunny",this.cloudCover=.5}clone(){return new QY({cloudCover:this.cloudCover})}};d([It({sunny:"sunny"})],bM.prototype,"type",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],bM.prototype,"cloudCover",void 0),bM=QY=d([V("esri.views.3d.environment.SunnyWeather")],bM);const N6=bM;var KY;let wM=KY=class extends ze{constructor(t){super(t),this.type="cloudy",this.cloudCover=.5}clone(){return new KY({cloudCover:this.cloudCover})}};d([It({cloudy:"cloudy"})],wM.prototype,"type",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],wM.prototype,"cloudCover",void 0),wM=KY=d([V("esri.views.3d.environment.CloudyWeather")],wM);const Q3e=wM;var eX;let xM=eX=class extends ze{constructor(t){super(t),this.type="foggy",this.fogStrength=.5}clone(){return new eX({fogStrength:this.fogStrength})}};d([It({foggy:"foggy"})],xM.prototype,"type",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],xM.prototype,"fogStrength",void 0),xM=eX=d([V("esri.views.3d.environment.FoggyWeather")],xM);const K3e=xM;var tX;let TS=tX=class extends ze{constructor(t){super(t),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new tX({cloudCover:this.cloudCover,precipitation:this.precipitation})}};d([It({rainy:"rainy"})],TS.prototype,"type",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],TS.prototype,"cloudCover",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],TS.prototype,"precipitation",void 0),TS=tX=d([V("esri.views.3d.environment.RainyWeather")],TS);const ePe=TS;var rX;let dw=rX=class extends ze{constructor(t){super(t),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new rX({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};d([It({snowy:"snowy"})],dw.prototype,"type",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],dw.prototype,"cloudCover",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],dw.prototype,"precipitation",void 0),d([m({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],dw.prototype,"snowCover",void 0),dw=rX=d([V("esri.views.3d.environment.SnowyWeather")],dw);const tPe=dw,rPe={key:"type",base:N6,typeMap:{sunny:N6,cloudy:Q3e,rainy:ePe,snowy:tPe,foggy:K3e}},Jtt=Object.keys(rPe.typeMap);function Qtt(t,e){return!!Jtt.includes(t)||(e.error(`"${t}" is not a valid weather type`),!1)}const b0=1e4,Ktt=1e5,ert={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:$$,virtual:eU}};let J5=class extends ze{constructor(e){super(e)}clone(){}};d([m({readOnly:!0,json:{read:!1}})],J5.prototype,"type",void 0),J5=d([V("esri.webscene.background.Background")],J5);const iPe=J5;var iX;const trt={..._y,nonNullable:!0};let TM=iX=class extends iPe{constructor(t){super(t),this.type="color",this.color=new Xe([0,0,0,1])}clone(){return new iX(this.cloneProperties())}cloneProperties(){return{color:this.color.clone()}}};d([It({color:"color"},{readOnly:!0})],TM.prototype,"type",void 0),d([m(trt)],TM.prototype,"color",void 0),TM=iX=d([V("esri.webscene.background.ColorBackground")],TM);const nPe=TM,uue={base:iPe,key:"type",typeMap:{color:nPe}};function rrt(t){return(e,r,i)=>{if(!e)return e;for(const n in t.typeMap)if(e.type===n){const s=new t.typeMap[n];return s.read(e,i),s}}}const irt={types:uue,json:{read:rrt(uue),write:{overridePolicy:(t,e,r)=>({enabled:!r||!r.isPresentation})}}};var nX;const hue=(t,e,r)=>({enabled:!r||!r.isPresentation});let D_=nX=class extends ze{constructor(t){super(t),this.lighting=new $$,this.background=null,this.atmosphereEnabled=!0,this.starsEnabled=!0}set weather(t){Qtt(t==null?void 0:t.type,re.getLogger(this))&&this._set("weather",t)}clone(){return new nX(this.cloneConstructProperties())}cloneConstructProperties(){return{lighting:this.lighting&&this.lighting.type==="virtual"?eU.prototype.clone.call(this.lighting):$$.prototype.clone.call(this.lighting),background:_e(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,weather:this.weather.clone()}}};d([m({types:ert,nonNullable:!0,json:{write:!0}})],D_.prototype,"lighting",void 0),d([m(irt)],D_.prototype,"background",void 0),d([m({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:hue}}})],D_.prototype,"atmosphereEnabled",void 0),d([m({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:hue}}})],D_.prototype,"starsEnabled",void 0),d([m({types:rPe,nonNullable:!0,json:{write:!0},value:new N6})],D_.prototype,"weather",null),D_=nX=d([V("esri.webscene.Environment")],D_);const sPe=D_;var SM;let SS=SM=class extends sPe{constructor(t){super(t),this.atmosphere=new sR,this.lighting=this.castLighting(),this.cachedCameraTrackingEnabled=null}destroy(){this.atmosphere.destroy()}static fromWebsceneEnvironment(t){const e=t.cloneConstructProperties();return new SM({...e,lighting:e.lighting?e.lighting.type==="virtual"?vM.fromWebsceneLighting(e.lighting):hw.fromWebsceneLighting(e.lighting):void 0})}castLighting(t){return this._convertLightingWithDestroy(t)}applyLighting(t){this.lighting=this._convertLightingWithDestroy(t)}_convertLightingWithDestroy(t){const e=this._convertLighting(t);return e!==t&&this.addHandles(xbe(e)),e}_convertLighting(t){var e,r;return t?t instanceof hw||t instanceof vM?t:t instanceof $$?this.lighting&&this.lighting.type!=="virtual"?this.lighting.cloneWithWebsceneLighting(t):new hw({...t.cloneConstructProperties(),...(e=this.lighting)==null?void 0:e.cloneNonPersistentConstructProperties()}):t instanceof eU?this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(t):new vM({...t.cloneConstructProperties(),...(r=this.lighting)==null?void 0:r.cloneNonPersistentConstructProperties()}):ig(Ztt,t):new hw}clone(){return new SM({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:_e(this.background)})}cloneWithWebsceneEnvironment(t){return new SM({atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:_e(this.background),...t.cloneConstructProperties(),lighting:this._getLighting(t)})}_getLighting(t){switch(t.lighting.type){case"sun":return this.lighting&&this.lighting.type==="sun"?this.lighting.cloneWithWebsceneLighting(t.lighting):hw.fromWebsceneLighting(t.lighting);case"virtual":return this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(t.lighting):vM.fromWebsceneLighting(t.lighting);default:return t.lighting,hw.fromWebsceneLighting(t.lighting)}}};d([m({type:sR,json:{read:!1},nonNullable:!0})],SS.prototype,"atmosphere",void 0),d([m({nonNullable:!0})],SS.prototype,"lighting",void 0),d([ai("lighting")],SS.prototype,"castLighting",null),SS=SM=d([V("esri.views.3d.environment.SceneViewEnvironment")],SS);const CS=SS;function nrt(t,e,r){if(e==null)return!1;const i=FTe(e);return i!=null&&(i(t,0,GP,0),r!==GP&&(r[0]=GP[0],r[1]=GP[1],r.length>2&&(r[2]=GP[2])),!0)}const GP=C();function srt(t,e){DD[0]=t.x,DD[1]=t.y;const r=t.z;return DD[2]=r!==void 0?r:0,nrt(DD,t.spatialReference,e)}const DD=C();var wa;(function(t){t[t.Realistic=0]="Realistic",t[t.Local=1]="Local",t[t.Mars=2]="Mars",t[t.None=3]="None"})(wa||(wa={}));function oPe(t){return"r"in t&&"g"in t&&"b"in t}function aPe(t){return"h"in t&&"s"in t&&"v"in t}function lPe(t){return"l"in t&&"a"in t&&"b"in t}function cPe(t){return"l"in t&&"c"in t&&"h"in t}function ort(t){return"x"in t&&"y"in t&&"z"in t}const art=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],lrt=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function uPe(t,e){const r=[];let i,n;if(t[0].length!==e.length)throw new Error("dimensions do not match");const s=t.length,o=t[0].length;let a=0;for(i=0;i<s;i++){for(a=0,n=0;n<o;n++)a+=t[i][n]*e[n];r.push(a)}return r}function hPe(t){const e=[t.r/255,t.g/255,t.b/255].map(i=>i<=.04045?i/12.92:((i+.055)/1.055)**2.4),r=uPe(art,e);return{x:100*r[0],y:100*r[1],z:100*r[2]}}function Gte(t){const e=uPe(lrt,[t.x/100,t.y/100,t.z/100]).map(r=>{const i=r<=.0031308?12.92*r:1.055*r**.4166666666666667-.055;return Math.min(1,Math.max(i,0))});return{r:Math.round(255*e[0]),g:Math.round(255*e[1]),b:Math.round(255*e[2])}}function dPe(t){const e=[t.x/95.047,t.y/100,t.z/108.883].map(r=>r>.008856451679035631?r**.3333333333333333:7.787037037037035*r+.13793103448275862);return{l:116*e[1]-16,a:500*(e[0]-e[1]),b:200*(e[1]-e[2])}}function pPe(t){const e=t.l,r=[(e+16)/116+t.a/500,(e+16)/116,(e+16)/116-t.b/200].map(i=>i>6/29?i**3:3*(6/29)**2*(i-4/29));return{x:95.047*r[0],y:100*r[1],z:108.883*r[2]}}function crt(t){const e=t.l,r=t.a,i=t.b,n=Math.sqrt(r*r+i*i);let s=Math.atan2(i,r);return s=s>0?s:s+2*Math.PI,{l:e,c:n,h:s}}function urt(t){const e=t.l,r=t.c,i=t.h;return{l:e,a:r*Math.cos(i),b:r*Math.sin(i)}}function hrt(t){return dPe(hPe(t))}function drt(t){return Gte(pPe(t))}function prt(t){return crt(dPe(hPe(t)))}function frt(t){return Gte(pPe(urt(t)))}function mrt(t){const e=t.r,r=t.g,i=t.b,n=Math.max(e,r,i),s=n-Math.min(e,r,i);let o=n,a=s===0?0:n===e?(r-i)/s%6:n===r?(i-e)/s+2:(e-r)/s+4,l=s===0?0:s/o;return a<0&&(a+=6),a*=60,l*=100,o*=100/255,{h:a,s:l,v:o}}function grt(t){const e=(t.h+360)%360/60,r=t.s/100,i=t.v/100*255,n=i*r,s=n*(1-Math.abs(e%2-1));let o;switch(Math.floor(e)){case 0:o={r:n,g:s,b:0};break;case 1:o={r:s,g:n,b:0};break;case 2:o={r:0,g:n,b:s};break;case 3:o={r:0,g:s,b:n};break;case 4:o={r:s,g:0,b:n};break;case 5:case 6:o={r:n,g:0,b:s};break;default:o={r:0,g:0,b:0}}return o.r=Math.round(o.r+i-n),o.g=Math.round(o.g+i-n),o.b=Math.round(o.b+i-n),o}function jte(t){return oPe(t)?t:cPe(t)?frt(t):lPe(t)?drt(t):ort(t)?Gte(t):aPe(t)?grt(t):t}function K8t(t){return aPe(t)?t:mrt(jte(t))}function ezt(t){return lPe(t)?t:hrt(jte(t))}function tzt(t){return cPe(t)?t:prt(jte(t))}function yrt(t){let{r:e,g:r,b:i,a:n}=t;return n<1&&(e=Math.round(n*e+255*(1-n)),r=Math.round(n*r+255*(1-n)),i=Math.round(n*i+255*(1-n))),new Xe({r:e,g:r,b:i})}function _rt(t,e){const{r,g:i,b:n}=e!=null&&e.ignoreAlpha?t:yrt(t);return .2126*r+.7152*i+.0722*n}var sX;function rzt(t,e=sX.High){return _rt(t,{ignoreAlpha:!0})>e?new Xe([0,0,0,t.a]):new Xe([255,255,255,t.a])}function izt(t,e){const r=t.clone();return r.a*=e,r}function I$(t){return Xe.toUnitRGBA(t)}function nzt(t,e){return t===e||t!=null&&e!=null&&o2(t,e)}function szt(t){return Bt(t[0],t[1],t[2],t.length>3?t[3]:1)}function ozt(t,e){const r=Xe.toUnitRGBA(t);return r[3]*=e,r}(function(t){t[t.Low=160]="Low",t[t.High=225]="High"})(sX||(sX={}));function eo(t,e){return t[0]=e[0],t[1]=e[1],t}function cr(t,e,r){return t[0]=e,t[1]=r,t}function vp(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function Em(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function fPe(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t}function mPe(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t}function vrt(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function brt(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function wrt(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t}function xrt(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t}function Trt(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}function Uc(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t}function Srt(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t}function mv(t,e){const r=e[0]-t[0],i=e[1]-t[1];return Math.sqrt(r*r+i*i)}function F6(t,e){const r=e[0]-t[0],i=e[1]-t[1];return r*r+i*i}function Hte(t){const e=t[0],r=t[1];return Math.sqrt(e*e+r*r)}function gPe(t){const e=t[0],r=t[1];return e*e+r*r}function Wte(t,e){return t[0]=-e[0],t[1]=-e[1],t}function Crt(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function L$(t,e){const r=e[0],i=e[1];let n=r*r+i*i;return n>0&&(n=1/Math.sqrt(n),t[0]=e[0]*n,t[1]=e[1]*n),t}function As(t,e){return t[0]*e[0]+t[1]*e[1]}function Ert(t,e,r){const i=e[0]*r[1]-e[1]*r[0];return t[0]=t[1]=0,t[2]=i,t}function Vh(t,e,r,i){const n=e[0],s=e[1];return t[0]=n+i*(r[0]-n),t[1]=s+i*(r[1]-s),t}function Prt(t,e){e=e||1;const r=2*AI()*Math.PI;return t[0]=Math.cos(r)*e,t[1]=Math.sin(r)*e,t}function yPe(t,e,r){const i=e[0],n=e[1];return t[0]=r[0]*i+r[2]*n,t[1]=r[1]*i+r[3]*n,t}function N_(t,e,r){const i=e[0],n=e[1];return t[0]=r[0]*i+r[2]*n+r[4],t[1]=r[1]*i+r[3]*n+r[5],t}function Art(t,e,r){const i=e[0],n=e[1];return t[0]=r[0]*i+r[3]*n+r[6],t[1]=r[1]*i+r[4]*n+r[7],t}function Mrt(t,e,r){const i=e[0],n=e[1];return t[0]=r[0]*i+r[4]*n+r[12],t[1]=r[1]*i+r[5]*n+r[13],t}function Ort(t,e,r,i){const n=e[0]-r[0],s=e[1]-r[1],o=Math.sin(i),a=Math.cos(i);return t[0]=n*a-s*o+r[0],t[1]=n*o+s*a+r[1],t}function Rrt(t,e){const r=t[0],i=t[1],n=e[0],s=e[1];let o=r*r+i*i;o>0&&(o=1/Math.sqrt(o));let a=n*n+s*s;a>0&&(a=1/Math.sqrt(a));const l=(r*n+i*s)*o*a;return l>1?0:l<-1?Math.PI:Math.acos(l)}function $rt(t){return"vec2("+t[0]+", "+t[1]+")"}function _Pe(t,e){return t[0]===e[0]&&t[1]===e[1]}function vPe(t,e){const r=t[0],i=t[1],n=e[0],s=e[1],o=Va();return Math.abs(r-n)<=o*Math.max(1,Math.abs(r),Math.abs(n))&&Math.abs(i-s)<=o*Math.max(1,Math.abs(i),Math.abs(s))}function Irt(t,e,r,i,n){let s=e[0]-r[0],o=e[1]-r[1];const a=(i[0]*s+i[1]*o)*(n-1);return s=i[0]*a,o=i[1]*a,t[0]=e[0]+s,t[1]=e[1]+o,t}const Lrt=Hte,Drt=Em,Nrt=fPe,Frt=mPe,bPe=mv,krt=F6,zrt=gPe;Object.freeze(Object.defineProperty({__proto__:null,add:vp,angle:Rrt,ceil:vrt,copy:eo,cross:Ert,dist:bPe,distance:mv,div:Frt,divide:mPe,dot:As,equals:vPe,exactEquals:_Pe,floor:brt,inverse:Crt,len:Lrt,length:Hte,lerp:Vh,max:xrt,min:wrt,mul:Nrt,multiply:fPe,negate:Wte,normalize:L$,projectAndScale:Irt,random:Prt,rotate:Ort,round:Trt,scale:Uc,scaleAndAdd:Srt,set:cr,sqrDist:krt,sqrLen:zrt,squaredDistance:F6,squaredLength:gPe,str:$rt,sub:Drt,subtract:Em,transformMat2:yPe,transformMat2d:N_,transformMat3:Art,transformMat4:Mrt},Symbol.toStringTag,{value:"Module"}));function qte(t){return we((t-1e5)/9e5,0,1)}const oX=1e4,Urt=.085,e1=1e5;let Brt=class{};const Ai=Brt;function T(t,...e){let r="";for(let i=0;i<e.length;i++)r+=t[i]+e[i];return r+=t[t.length-1],r}(function(t){function e(i){return Math.round(i).toString()}function r(i){return i.toPrecision(8)}t.int=e,t.float=r})(T||(T={}));var R;function Vrt(t){return t===R.POSITION}(function(t){t.POSITION="position",t.NORMAL="normal",t.NORMALCOMPRESSED="normalCompressed",t.UV0="uv0",t.COLOR="color",t.SYMBOLCOLOR="symbolColor",t.SIZE="size",t.TANGENT="tangent",t.OFFSET="offset",t.PERSPECTIVEDIVIDE="perspectiveDivide",t.CENTEROFFSETANDDISTANCE="centerOffsetAndDistance",t.LENGTH="length",t.PREVPOSITION="prevPosition",t.NEXTPOSITION="nextPosition",t.SUBDIVISIONFACTOR="subdivisionFactor",t.COLORFEATUREATTRIBUTE="colorFeatureAttribute",t.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute",t.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute",t.DISTANCETOSTART="distanceToStart",t.UVMAPSPACE="uvMapSpace",t.BOUNDINGRECT="boundingRect",t.UVREGION="uvRegion",t.PROFILERIGHT="profileRight",t.PROFILEUP="profileUp",t.PROFILEVERTEXANDNORMAL="profileVertexAndNormal",t.FEATUREVALUE="featureValue",t.INSTANCEMODELORIGINHI="instanceModelOriginHi",t.INSTANCEMODELORIGINLO="instanceModelOriginLo",t.INSTANCEMODEL="instanceModel",t.INSTANCEMODELNORMAL="instanceModelNormal",t.INSTANCECOLOR="instanceColor",t.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute",t.LOCALTRANSFORM="localTransform",t.GLOBALTRANSFORM="globalTransform",t.BOUNDINGSPHERE="boundingSphere",t.MODELORIGIN="modelOrigin",t.MODELSCALEFACTORS="modelScaleFactors",t.FEATUREATTRIBUTE="featureAttribute",t.STATE="state",t.LODLEVEL="lodLevel",t.POSITION0="position0",t.POSITION1="position1",t.NORMAL2COMPRESSED="normal2Compressed",t.COMPONENTINDEX="componentIndex",t.VARIANTOFFSET="variantOffset",t.VARIANTSTROKE="variantStroke",t.VARIANTEXTENSION="variantExtension",t.SIDENESS="sideness",t.START="start",t.END="end",t.UP="up",t.EXTRUDE="extrude",t.OBJECTANDLAYERIDCOLOR="objectAndLayerIdColor",t.INSTANCEOBJECTANDLAYERIDCOLOR="instanceObjectAndLayerIdColor"})(R||(R={}));var on;function qm(t,e){switch(e.textureCoordinateType){case on.Default:return t.attributes.add(R.UV0,"vec2"),t.varyings.add("vuv0","vec2"),void t.vertex.code.add(T`void forwardTextureCoordinates() {
vuv0 = uv0;
}`);case on.Compressed:return t.attributes.add(R.UV0,"vec2"),t.varyings.add("vuv0","vec2"),void t.vertex.code.add(T`vec2 getUV0() {
return uv0 / 16384.0;
}
void forwardTextureCoordinates() {
vuv0 = getUV0();
}`);case on.Atlas:return t.attributes.add(R.UV0,"vec2"),t.varyings.add("vuv0","vec2"),t.attributes.add(R.UVREGION,"vec4"),t.varyings.add("vuvRegion","vec4"),void t.vertex.code.add(T`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);default:e.textureCoordinateType;case on.None:return void t.vertex.code.add(T`void forwardTextureCoordinates() {}`);case on.COUNT:return}}(function(t){t[t.None=0]="None",t[t.Default=1]="Default",t[t.Atlas=2]="Atlas",t[t.Compressed=3]="Compressed",t[t.COUNT=4]="COUNT"})(on||(on={}));function Td(t){t.code.add(T`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)}function cg(t){t.include(Td),t.code.add(T`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromRGBA(vec4 depth, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(depth), nearFar);
}
float linearDepthFromTexture(sampler2D depthTexture, vec2 uv, vec2 nearFar) {
ivec2 iuv = ivec2(uv * vec2(textureSize(depthTexture, 0)));
return linearDepthFromRGBA(texelFetch(depthTexture, iuv, 0), nearFar);
}`)}function wPe(t){t.code.add(T`float linearizeDepth(float depth, vec2 nearFar) {
float depthNdc = depth * 2.0 - 1.0;
return (2.0 * nearFar[0] * nearFar[1]) / (depthNdc * (nearFar[1] - nearFar[0]) - (nearFar[1] + nearFar[0]));
}
float linearDepthFromTexture(sampler2D depthTexture, vec2 uv, vec2 nearFar) {
ivec2 iuv = ivec2(uv * vec2(textureSize(depthTexture, 0)));
float depth = texelFetch(depthTexture, iuv, 0).r;
return linearizeDepth(depth, nearFar);
}`)}function tU(t){t.fragment.code.add(T`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)}var Rr;(function(t){t[t.Pass=0]="Pass",t[t.Draw=1]="Draw"})(Rr||(Rr={}));let vn=class{constructor(e,r,i,n,s=null){if(this.name=e,this.type=r,this.arraySize=s,this.bind={[Rr.Pass]:null,[Rr.Draw]:null},n)switch(i){case Rr.Pass:this.bind[Rr.Pass]=n;break;case Rr.Draw:this.bind[Rr.Draw]=n}}equals(e){return this.type===e.type&&this.name===e.name&&this.arraySize===e.arraySize}},Ft=class extends vn{constructor(e,r){super(e,"vec3",Rr.Pass,(i,n,s)=>i.setUniform3fv(e,r(n,s)))}};function by(t){t.uniforms.add(new Ft("mainLightDirection",(e,r)=>r.lighting.mainLight.direction))}function _g(t){t.uniforms.add(new Ft("mainLightIntensity",(e,r)=>r.lighting.mainLight.intensity))}function k6(t){by(t.fragment),_g(t.fragment),t.fragment.code.add(T`vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {
float dotVal = clamp(dot(normal_global, mainLightDirection), 0.0, 1.0);
return mainLightIntensity * ((1.0 - shadowing) * dotVal);
}`)}let ti=class extends vn{constructor(e,r){super(e,"vec2",Rr.Pass,(i,n,s)=>i.setUniform2fv(e,r(n,s)))}},xr=class extends vn{constructor(e,r){super(e,"vec4",Rr.Pass,(i,n,s)=>i.setUniform4fv(e,r(n,s)))}},$e=class extends vn{constructor(e,r){super(e,"float",Rr.Pass,(i,n,s)=>i.setUniform1f(e,r(n,s)))}},ln=class extends vn{constructor(e,r){super(e,"mat4",Rr.Pass,(i,n,s)=>i.setUniformMatrix4fv(e,r(n,s)))}};const Za=Zt();let Grt=class{constructor(e){this.message=e}toString(){return`AssertException: ${this.message}`}};function pt(t,e){if(!t){e=e||"Assertion";const r=new Error(e).stack;throw new Grt(`${e} at ${r}`)}}function sT(t,e){t||(e=e||"",console.warn("Verify failed: "+e+`
`+new Error("verify").stack))}function due(t,e,r,i){let n,s=(r[0]-t[0])/e[0],o=(i[0]-t[0])/e[0];s>o&&(n=s,s=o,o=n);let a=(r[1]-t[1])/e[1],l=(i[1]-t[1])/e[1];if(a>l&&(n=a,a=l,l=n),s>l||a>o)return!1;a>s&&(s=a),l<o&&(o=l);let c=(r[2]-t[2])/e[2],u=(i[2]-t[2])/e[2];return c>u&&(n=c,c=u,u=n),!(s>u||c>o)&&(u<o&&(o=u),!(o<0))}function ND(t,e,r,i,n,s=He()){const o=(i[n]-r[n])*(e[0]-t[0])-(i[0]-r[0])*(e[n]-t[n]),a=(i[0]-r[0])*(t[n]-r[n])-(i[n]-r[n])*(t[0]-r[0]);if(o===0)return!1;const l=a/o;return s[0]=t[0]+l*(e[0]-t[0]),s[1]=t[n]+l*(e[n]-t[n]),!0}function pue(t,e,r,i,n){Za[0]=t[0],Za[1]=t[1],Za[2]=t[2],Za[3]=1,jc(Za,Za,e),n.length>2&&(n[2]=-Za[2]),jc(Za,Za,r),pt(Za[3]!==0),n[0]=Za[0]/Za[3],n[1]=Za[1]/Za[3],n[2]=Za[2]/Za[3],n[0]=(.5*n[0]+.5)*i[2]+i[0],n[1]=(.5*n[1]+.5)*i[3]+i[1]}function jrt(t,e){return Math.log(t)/Math.log(e)}function Hrt(t,e,r,i){t[12]=e,t[13]=r,t[14]=i}function xPe(t){return t[0]===1&&t[1]===0&&t[2]===0&&t[3]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[7]===0&&t[8]===0&&t[9]===0&&t[10]===1&&t[11]===0&&t[15]===1}const TPe=()=>re.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");let SPe=class{constructor(){this._includedModules=new Map}include(e,r){if(this._includedModules.has(e)){const i=this._includedModules.get(e);if(i!==r){TPe().error("Shader module included multiple times with different configuration.");const n=new Set;for(const s of Object.keys(i))i[s]!==e[s]&&n.add(s);for(const s of Object.keys(e))i[s]!==e[s]&&n.add(s);n.forEach(s=>console.error(`  ${s}: current ${i[s]} new ${e[s]}`))}}else this._includedModules.set(e,r),e(this.builder,r)}},Or=class extends SPe{constructor(){super(...arguments),this.vertex=new fue,this.fragment=new fue,this.attributes=new Yrt,this.varyings=new Xrt,this.extensions=new aX,this.constants=new CPe,this.outputs=new cX}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(e){const r=this.extensions.generateSource(e),i=this.attributes.generateSource(e),n=this.varyings.generateSource(e),s=e==="vertex"?this.vertex:this.fragment,o=s.uniforms.generateSource(),a=s.code.generateSource(),l=e==="vertex"?Jrt:Zrt,c=this.constants.generateSource().concat(s.constants.generateSource()),u=this.outputs.generateSource(e);return`#version 300 es
${r.join(`
`)}

${l}

${c.join(`
`)}

${o.join(`
`)}

${i.join(`
`)}

${n.join(`
`)}

${u.join(`
`)}

${a.join(`
`)}`}generateBindPass(e){const r=new Map;this.vertex.uniforms.entries.forEach(s=>{const o=s.bind[Rr.Pass];o&&r.set(s.name,o)}),this.fragment.uniforms.entries.forEach(s=>{const o=s.bind[Rr.Pass];o&&r.set(s.name,o)});const i=Array.from(r.values()),n=i.length;return(s,o)=>{for(let a=0;a<n;++a)i[a](e,s,o)}}generateBindDraw(e){const r=new Map;this.vertex.uniforms.entries.forEach(s=>{const o=s.bind[Rr.Draw];o&&r.set(s.name,o)}),this.fragment.uniforms.entries.forEach(s=>{const o=s.bind[Rr.Draw];o&&r.set(s.name,o)});const i=Array.from(r.values()),n=i.length;return(s,o,a)=>{for(let l=0;l<n;++l)i[l](e,s,o,a)}}},Wrt=class{constructor(){this._entries=new Map}add(...e){for(const r of e)this._add(r)}get(e){return this._entries.get(e)}_add(e){if(e!=null){if(this._entries.has(e.name)&&!this._entries.get(e.name).equals(e))throw new K(`Duplicate uniform name ${e.name} for different uniform type`);this._entries.set(e.name,e)}else TPe().error(`Trying to add null Uniform from ${new Error().stack}.`)}generateSource(){return Array.from(this._entries.values()).map(e=>e.arraySize!=null?`uniform ${e.type} ${e.name}[${e.arraySize}];`:`uniform ${e.type} ${e.name};`)}get entries(){return Array.from(this._entries.values())}},qrt=class{constructor(){this._entries=new Array}add(e){this._entries.push(e)}generateSource(){return this._entries}},fue=class extends SPe{constructor(){super(...arguments),this.uniforms=new Wrt,this.code=new qrt,this.constants=new CPe}get builder(){return this}},Yrt=class{constructor(){this._entries=new Array}add(e,r){this._entries.push([e,r])}generateSource(e){return e==="fragment"?[]:this._entries.map(r=>`in ${r[1]} ${r[0]};`)}},Xrt=class{constructor(){this._entries=new Map}add(e,r){this._entries.has(e)&&pt(this._entries.get(e)===r),this._entries.set(e,r)}generateSource(e){const r=new Array;return this._entries.forEach((i,n)=>r.push(e==="vertex"?`out ${i} ${n};`:`in ${i} ${n};`)),r}},aX=class lX{constructor(){this._entries=new Set}add(e){this._entries.add(e)}generateSource(e){const r=e==="vertex"?lX.ALLOWLIST_VERTEX:lX.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(i=>r.includes(i)).map(i=>`#extension ${i} : enable`)}};aX.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],aX.ALLOWLIST_VERTEX=[];let cX=class uX{constructor(){this._entries=new Map}add(e,r,i=0){const n=this._entries.get(i);n?pt(n.name===e&&n.type===r,`Fragment shader output location ${i} occupied`):this._entries.set(i,{name:e,type:r})}generateSource(e){if(e==="vertex")return[];this._entries.size===0&&this._entries.set(0,{name:uX.DEFAULT_NAME,type:uX.DEFAULT_TYPE});const r=new Array;return this._entries.forEach((i,n)=>r.push(`layout(location = ${n}) out ${i.type} ${i.name};`)),r}};cX.DEFAULT_TYPE="vec4",cX.DEFAULT_NAME="fragColor";let CPe=class xs{constructor(){this._entries=new Set}add(e,r,i){let n="ERROR_CONSTRUCTOR_STRING";switch(r){case"float":n=xs._numberToFloatStr(i);break;case"int":n=xs._numberToIntStr(i);break;case"bool":n=i.toString();break;case"vec2":n=`vec2(${xs._numberToFloatStr(i[0])},                            ${xs._numberToFloatStr(i[1])})`;break;case"vec3":n=`vec3(${xs._numberToFloatStr(i[0])},                            ${xs._numberToFloatStr(i[1])},                            ${xs._numberToFloatStr(i[2])})`;break;case"vec4":n=`vec4(${xs._numberToFloatStr(i[0])},                            ${xs._numberToFloatStr(i[1])},                            ${xs._numberToFloatStr(i[2])},                            ${xs._numberToFloatStr(i[3])})`;break;case"ivec2":n=`ivec2(${xs._numberToIntStr(i[0])},                             ${xs._numberToIntStr(i[1])})`;break;case"ivec3":n=`ivec3(${xs._numberToIntStr(i[0])},                             ${xs._numberToIntStr(i[1])},                             ${xs._numberToIntStr(i[2])})`;break;case"ivec4":n=`ivec4(${xs._numberToIntStr(i[0])},                             ${xs._numberToIntStr(i[1])},                             ${xs._numberToIntStr(i[2])},                             ${xs._numberToIntStr(i[3])})`;break;case"mat2":case"mat3":case"mat4":n=`${r}(${Array.prototype.map.call(i,s=>xs._numberToFloatStr(s)).join(", ")})`}return this._entries.add(`const ${r} ${e} = ${n};`),this}static _numberToIntStr(e){return e.toFixed(0)}static _numberToFloatStr(e){return Number.isInteger(e)?e.toFixed(1):e.toString()}generateSource(){return Array.from(this._entries)}};const Zrt=`#ifdef GL_FRAGMENT_PRECISION_HIGH
  precision highp float;
  precision highp sampler2D;
#else
  precision mediump float;
  precision mediump sampler2D;
#endif`,Jrt=`precision highp float;
precision highp sampler2D;`;let ct=class extends vn{constructor(e,r){super(e,"sampler2D",Rr.Pass,(i,n,s)=>i.bindTexture(e,r(n,s)))}};const JC=Ce(parseFloat(5802e-9.toFixed(6)),parseFloat(13558e-9.toFixed(6)),parseFloat(331e-7.toFixed(6))),DV=3,NV=Ce(DV*parseFloat(65e-8.toFixed(6)),DV*parseFloat(1881e-9.toFixed(6)),DV*parseFloat(85e-9.toFixed(6))),Qrt=3996e-9,Krt=Ce(parseFloat(Number(JC[0]+NV[0]).toFixed(6)),parseFloat(Number(JC[1]+NV[1]).toFixed(6)),parseFloat(Number(JC[2]+NV[2]).toFixed(6)));function EPe(t){const e=new Or;e.attributes.add(R.POSITION,"vec2"),e.include(qm,{textureCoordinateType:on.Default}),e.varyings.add("worldRay","vec3"),e.varyings.add("eyeDir","vec3");const{vertex:r,fragment:i}=e;return r.uniforms.add(new ln("inverseProjectionMatrix",(n,s)=>s.camera.inverseProjectionMatrix),new ln("inverseViewMatrix",(n,s)=>R3(eit,s.camera.viewMatrix))),r.code.add(T`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),i.uniforms.add(new Ft("backgroundColor",n=>n.backgroundColor),new ti("radii",n=>n.radii),new Ft("cameraPosition",(n,s)=>s.camera.eye),new xr("heightParameters",n=>n.heightParameters),new $e("innerFadeDistance",n=>n.innerFadeDistance),new $e("altitudeFade",n=>n.altitudeFade),new ct("depthTexture",n=>n.depthTexture),new $e("hazeStrength",n=>n.hazeStrength)),i.constants.add("betaRayleigh","vec3",JC),i.constants.add("betaCombined","vec3",Krt),i.constants.add("betaMie","float",Qrt),i.constants.add("scaleHeight","float",Urt*e1),by(i),e.include(tU),t.haze&&(i.include(cg),i.uniforms.add(new ti("nearFar",(n,s)=>s.camera.nearFar))),i.code.add(T`vec2 sphereIntersect(vec3 start, vec3 dir, float radius, bool planet) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = planet ? heightParameters[1] - radius * radius : heightParameters[2];
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),i.code.add(T`float chapmanApproximation(float X, float h, float cosZenith) {
float c = sqrt(X + h);
float cExpH = c * exp(-h);
if (cosZenith >= 0.0) {
return cExpH / (c * cosZenith + 1.0);
} else {
float x0 = sqrt(1.0 - cosZenith * cosZenith) * (X + h);
float c0 = sqrt(x0);
return 2.0 * c0 * exp(X - x0) - cExpH / (1.0 - c * cosZenith);
}
}`),i.code.add(T`float getOpticalDepth(vec3 position, vec3 dir, float h) {
return scaleHeight * chapmanApproximation(radii[0] / scaleHeight, h, dot(normalize(position), dir));
}`),i.code.add(T`
    const int STEPS = 6;

    vec3 getAtmosphereColour(vec3 cameraPos, vec3 rayDir, vec3 lightDir, float terrainDepth) {
      float reducedPlanetRadius = radii[0] - 20000.0;
      vec2 rayPlanetIntersect = sphereIntersect(cameraPos, rayDir, reducedPlanetRadius, true);
      vec2 rayAtmosphereIntersect = sphereIntersect(cameraPos, rayDir, radii[1], false);
      bool hitsAtmosphere = (rayAtmosphereIntersect.x <= rayAtmosphereIntersect.y) && rayAtmosphereIntersect.x > 0.0;
      bool insideAtmosphere = heightParameters[0] < radii[1];

      if (!(hitsAtmosphere || insideAtmosphere)) {
        return vec3(0);
      }

      bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;

      float start = insideAtmosphere ? 0.0 : rayAtmosphereIntersect.x;

      if (heightParameters[0] < reducedPlanetRadius) {
        // Long light rays from the night side of the planet lead to numerical instability
        // Do not render the atmosphere in such cases
        if (dot(rayDir, normalize(cameraPos)) < -0.025) {
          return vec3(0);
        }
        start = rayPlanetIntersect.y;
      }

      float end = hitsPlanet ? rayPlanetIntersect.x : rayAtmosphereIntersect.y;
      float maxEnd = end;

      ${t.haze?T`if (terrainDepth != -1.0) { end = terrainDepth; }`:""}

      vec3 samplePoint = cameraPos + rayDir * end;
      float multiplier = hitsPlanet ? -1.0 : 1.0;

      vec3 scattering = vec3(0);
      float scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
      float lastOpticalDepth = getOpticalDepth(samplePoint, rayDir, scaleFract);
      float stepSize = (end - start) / float(STEPS);
      for (int i = 0; i < STEPS; i++) {
        samplePoint -= stepSize * rayDir;
        scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
        float opticalDepth = multiplier * getOpticalDepth(samplePoint, rayDir * multiplier, scaleFract);

        if (i > 0) {
          scattering *= ${t.haze?"":T`mix(2.5, 1.0, clamp((length(cameraPos) - radii[0]) / 50e3, 0.0, 1.0)) * `} exp(-(mix(betaCombined, betaRayleigh, 0.5) + betaMie) * max(0.0, (opticalDepth - lastOpticalDepth)));
        }

        if (dot(normalize(samplePoint), lightDir) > -0.3) {

          float scale = exp(-scaleFract);
          float lightDepth = getOpticalDepth(samplePoint, lightDir, scaleFract);

          scattering += scale * exp(-(betaCombined + betaMie) * lightDepth);
          ${t.haze?"":T`scattering += scale * exp(-(0.25 * betaCombined ) * lightDepth);`}
        }

        lastOpticalDepth = opticalDepth;

      }

      float mu = dot(rayDir, lightDir);
      float mumu = 1.0 + mu * mu;

      float phaseRayleigh = 0.0596831 * mumu;

      ${t.haze?T`return 3.0 * scattering * stepSize * phaseRayleigh * betaRayleigh;`:T`
            const float g = 0.8;
            const float gg = g * g;
            float phaseMie = end == maxEnd ? 0.1193662 * ((1.0 - gg) * mumu) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg)) : 0.0;
            phaseMie = clamp(phaseMie, 0.0, 128.0);
            return 3.0 * scattering * stepSize * (phaseRayleigh * betaRayleigh + 0.025 * phaseMie * betaMie);`}
    }

    ${t.haze?"":T`
            vec4 applyUndergroundAtmosphere(vec3 rayDir, vec3 lightDirection, vec4 fragColor) {
              vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, rayDir, radii[0], true);
              if (!((rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.y > 0.0)) {
                return fragColor;
              }

              float lightAngle = dot(lightDirection, normalize(cameraPosition + rayDir * max(0.0, rayPlanetIntersect.x)));
              vec4 surfaceColor = vec4(vec3(max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)))), 1.0 - altitudeFade);
              float relDist = (rayPlanetIntersect.y - max(0.0, rayPlanetIntersect.x)) / innerFadeDistance;
              if (relDist > 1.0) {
                return surfaceColor;
              }

              return mix(fragColor, surfaceColor, smoothstep(0.0, 1.0, relDist * relDist));
            }

            float getGlow(float dist, float radius, float intensity) {
              return pow(radius / max(dist, 1e-6), intensity);
            }

            vec3 getSun(vec3 cameraPos, vec3 rayDir, vec3 lightDir){

              // Get the amount of atmosphere between camera and the Sun along the view ray
              float scaleFract = (length(cameraPos) - radii[0]) / scaleHeight;
              float sunOpticalDepth = getOpticalDepth(cameraPos, rayDir, max(scaleFract, 0.0));

              // Find the amount of light that remains after travelling through the atmosphere from the Sun along the view ray
              // This will make the colour of the Sun reddish on the horizon and white from space
              vec3 sunTransmittance = exp(-(mix(betaCombined, betaRayleigh, 0.5)) * max(0.0, sunOpticalDepth));

              // Alignment of light direction and view ray
              float mu = clamp(dot(rayDir, lightDir), 0.0, 1.0);
              // Draw the Sun as a bright disc
              float sunDisc = 256.0 * smoothstep(0.0, 128.0, clamp(getGlow(1.0 - mu, 3e-5, 3.0), 0.0, 128.0));

              return normalize(sunTransmittance) * sunDisc;
            }`}

    ${t.haze&&t.reduced?T`
        float getDepth(vec2 uv){
          return linearDepthFromTexture(depthTexture, uv, nearFar);
        }

        float textureBilinear(vec2 uv) {
          // Information about the high-resolution depth texture
          vec2 depthTextureSize = vec2(textureSize(depthTexture, 0));
          vec2 texelSize = 1.0 / depthTextureSize;

          // The uv inside the upper right pixel - of the tile of 4 pixels -
          // that the atmosphere uv maps to in the depth texture
          vec2 depthUV = (uv * depthTextureSize) - vec2(0.5);

          // Relative distance of the uv coordinates inside the depth texture pixel
          vec2 f = fract(depthUV);

          // Snap to the centre of the depth texture pixel
          vec2 snapUV = (floor(depthUV) + vec2(0.5)) / depthTextureSize;

          // Read the depth texture pixel and its three neighbours
          float d0 = getDepth(snapUV);
          float d1 = getDepth(snapUV + vec2(texelSize.x, 0.0));
          float d2 = getDepth(snapUV + vec2(0.0, texelSize.y));
          float d3 = getDepth(snapUV + texelSize);

          // Return the bilinearly interpolated value of the neighbouring pixels based
          // on the sample position in the depth texture pixel
          return mix(mix(d0, d1, f.x), mix(d2, d3, f.x), f.y);
        }
        `:""}

    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;
      ${t.haze?T`
          vec4 depthSample = texture(depthTexture, vuv0).rgba;
          if (depthSample != vec4(0)) {
            vec3 cameraSpaceRay = normalize(eyeDir);
            cameraSpaceRay /= cameraSpaceRay.z;

              ${t.reduced?T`cameraSpaceRay *= -textureBilinear(vuv0);`:T`cameraSpaceRay *= -linearDepthFromTexture(depthTexture, vuv0, nearFar);`}

            terrainDepth = max(0.0, length(cameraSpaceRay));
          }else{
            discard;
          }
          `:T`${t.reduced?"":T`
                float depthSample = texture(depthTexture, vuv0).r;
                if (depthSample != 1.0) {
                  fragColor = vec4(0);
                  return;
                }`}`}

      ${t.haze?T`
            vec3 col = vec3(0);
            float fadeOut = smoothstep(-10000.0, -15000.0, heightParameters[0] - radii[0]);
            if(depthSample != vec4(0)){
              col = (1.0 - fadeOut) * hazeStrength * getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            }
            // Alpha is ignored for haze blending
            float alpha = 1.0;
            `:T`
            vec3 col = linearizeGamma(backgroundColor);
            col += getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            col += getSun(cameraPosition, rayDir, mainLightDirection);
            float alpha = smoothstep(0.0, mix(0.15, 0.01, heightParameters[3]), length(col));`}

      col = tonemapACES(col);
      fragColor = delinearizeGamma(vec4(col, alpha));
      ${t.haze?"":T`fragColor = applyUndergroundAtmosphere(rayDir, mainLightDirection, fragColor);`}
    }
  `),e}const eit=xe(),tit=Object.freeze(Object.defineProperty({__proto__:null,betaRayleigh:JC,build:EPe},Symbol.toStringTag,{value:"Module"}));let Ir=class{constructor(e,r){this._module=e,this._loadModule=r}get(){return this._module}async reload(){return this._module=await this._loadModule(),this._module}};var Ci,sr,Se,ug,_t,Up,i3,qe,Xr,cn,Ht,Jt,Sn,Tt,tt,ks,ia,Ar,Lu,Sa;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT"})(Ci||(Ci={})),function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(sr||(sr={})),function(t){t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"}(Se||(Se={})),function(t){t[t.ADD=32774]="ADD",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX",t[t.SUBTRACT=32778]="SUBTRACT",t[t.REVERSE_SUBTRACT=32779]="REVERSE_SUBTRACT"}(ug||(ug={})),function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",t[t.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER"}(_t||(_t={})),function(t){t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK"}(Up||(Up={})),function(t){t[t.CW=2304]="CW",t[t.CCW=2305]="CCW"}(i3||(i3={})),function(t){t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT"}(qe||(qe={})),function(t){t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS"}(Xr||(Xr={})),function(t){t[t.ZERO=0]="ZERO",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP"}(cn||(cn={})),function(t){t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(Ht||(Ht={})),function(t){t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(Jt||(Jt={})),function(t){t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"}(Sn||(Sn={})),function(t){t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.RED=6403]="RED",t[t.RG=33319]="RG",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER"}(Tt||(Tt={})),function(t){t[t.RGBA4=32854]="RGBA4",t[t.R16F=33325]="R16F",t[t.RG16F=33327]="RG16F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.R32F=33326]="R32F",t[t.RG32F=33328]="RG32F",t[t.RGBA32F=34836]="RGBA32F",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB5_A1=32855]="RGB5_A1",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.RGB16F=34843]="RGB16F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.RGB565=36194]="RGB565",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2=32857]="RGB10_A2",t[t.RGB10_A2UI=36975]="RGB10_A2UI"}(tt||(tt={})),function(t){t[t.FLOAT=5126]="FLOAT",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.INT=5124]="INT",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV"}(ks||(ks={})),function(t){t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8"}(ia||(ia={})),function(t){t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.STATIC_READ=35045]="STATIC_READ",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.STREAM_COPY=35042]="STREAM_COPY"}(Ar||(Ar={})),function(t){t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER"}(Lu||(Lu={})),function(t){t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER"}(Sa||(Sa={}));const FV=33984;var Wn,cl,hX;(function(t){t[t.Texture=0]="Texture",t[t.BufferObject=1]="BufferObject",t[t.VertexArrayObject=2]="VertexArrayObject",t[t.Shader=3]="Shader",t[t.Program=4]="Program",t[t.FramebufferObject=5]="FramebufferObject",t[t.Renderbuffer=6]="Renderbuffer",t[t.TransformFeedback=7]="TransformFeedback",t[t.Sync=8]="Sync",t[t.UNCOUNTED=9]="UNCOUNTED",t[t.LinesOfCode=9]="LinesOfCode",t[t.Uniform=10]="Uniform",t[t.COUNT=11]="COUNT"})(Wn||(Wn={})),function(t){t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15"}(cl||(cl={})),function(t){t[t.NONE=0]="NONE",t[t.BACK=1029]="BACK"}(hX||(hX={}));const n3=33306;var $n,mue,gue,yue,z6,dX,_ue;(function(t){t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"})($n||($n={})),function(t){t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT=5124]="INT",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY"}(mue||(mue={})),function(t){t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS"}(gue||(gue={})),function(t){t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED"}(yue||(yue={})),function(t){t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED"}(z6||(z6={})),function(t){t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE"}(dX||(dX={})),function(t){t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT"}(_ue||(_ue={}));let Vr=class{constructor(e,r,i){this.release=i,this.initializeConfiguration(e,r),this._configuration=r.snapshot(),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e)}destroy(){this._program=gt(this._program),this._pipeline=this._configuration=null}reload(e){gt(this._program),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e)}get program(){return this._program}get compiled(){return this.program.compiled}get key(){return this._configuration.key}get configuration(){return this._configuration}ensureAttributeLocations(e){this.program.assertCompatibleVertexAttributeLocations(e)}get primitiveType(){return sr.TRIANGLES}getPipeline(e,r,i){return this._pipeline}initializeConfiguration(e,r){}};const Mr=new Map([[R.POSITION,0],[R.NORMAL,1],[R.NORMALCOMPRESSED,1],[R.UV0,2],[R.COLOR,3],[R.COLORFEATUREATTRIBUTE,3],[R.SIZE,4],[R.TANGENT,4],[R.CENTEROFFSETANDDISTANCE,5],[R.SYMBOLCOLOR,5],[R.FEATUREATTRIBUTE,6],[R.INSTANCEFEATUREATTRIBUTE,6],[R.INSTANCECOLOR,7],[R.OBJECTANDLAYERIDCOLOR,7],[R.INSTANCEOBJECTANDLAYERIDCOLOR,7],[R.INSTANCEMODEL,8],[R.INSTANCEMODELNORMAL,12],[R.INSTANCEMODELORIGINHI,11],[R.INSTANCEMODELORIGINLO,15]]),rit=()=>re.getLogger("esri.views.webgl.checkWebGLError");function iit(t,e){switch(e){case t.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case t.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case t.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case t.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case t.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case t.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}const U6=!!se("enable-feature:webgl-debug");function bp(){return U6}function pX(){return U6}function Pm(t){if(bp()){const e=t.getError();if(e){const r=iit(t,e),i=new Error().stack;rit().error(new K("webgl-error","WebGL error occurred",{message:r,stack:i}))}}}let Lr=class{constructor(e,r,i){this._context=e,this._locations=i,this._textures=new Map,this._freeTextureUnits=new Vt({deallocator:null}),this._glProgram=e.programCache.acquire(r.generate("vertex"),r.generate("fragment"),i),this._glProgram.stop=()=>{throw new Error("Wrapped _glProgram used directly")},this.bindPass=r.generateBindPass(this),this.bindDraw=r.generateBindDraw(this),this._fragmentUniforms=bp()?r.fragmentUniforms:null}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get hasTransformFeedbackVaryings(){return this._glProgram.hasTransformFeedbackVaryings}get compiled(){return this._glProgram.compiled}setUniform1b(e,r){this._glProgram.setUniform1i(e,r?1:0)}setUniform1i(e,r){this._glProgram.setUniform1i(e,r)}setUniform1f(e,r){this._glProgram.setUniform1f(e,r)}setUniform2fv(e,r){this._glProgram.setUniform2fv(e,r)}setUniform3fv(e,r){this._glProgram.setUniform3fv(e,r)}setUniform4fv(e,r){this._glProgram.setUniform4fv(e,r)}setUniformMatrix3fv(e,r){this._glProgram.setUniformMatrix3fv(e,r)}setUniformMatrix4fv(e,r){this._glProgram.setUniformMatrix4fv(e,r)}setUniform1fv(e,r){this._glProgram.setUniform1fv(e,r)}setUniform1iv(e,r){this._glProgram.setUniform1iv(e,r)}setUniform2iv(e,r){this._glProgram.setUniform3iv(e,r)}setUniform3iv(e,r){this._glProgram.setUniform3iv(e,r)}setUniform4iv(e,r){this._glProgram.setUniform4iv(e,r)}assertCompatibleVertexAttributeLocations(e){e.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}stop(){this._textures.clear(),this._freeTextureUnits.clear()}bindTexture(e,r){if((r==null?void 0:r.glName)==null){const n=this._textures.get(e);return n&&(this._context.bindTexture(null,n.unit),this._freeTextureUnit(n),this._textures.delete(e)),null}let i=this._textures.get(e);return i==null?(i=this._allocTextureUnit(r),this._textures.set(e,i)):i.texture=r,this._context.useProgram(this),this.setUniform1i(e,i.unit),this._context.bindTexture(r,i.unit),i.unit}rebindTextures(){var e;this._context.useProgram(this),this._textures.forEach((r,i)=>{this._context.bindTexture(r.texture,r.unit),this.setUniform1i(i,r.unit)}),(e=this._fragmentUniforms)==null||e.forEach(r=>{r.type!=="sampler2D"&&r.type!=="samplerCube"||this._textures.has(r.name)||console.error(`Texture sampler ${r.name} has no bound texture`)})}_allocTextureUnit(e){return{texture:e,unit:this._freeTextureUnits.length===0?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(e){this._freeTextureUnits.push(e.unit)}};var Pi,d2,Dn,gv,tc,oy,fi,Xl,F0;(function(t){t[t.None=0]="None",t[t.Front=1]="Front",t[t.Back=2]="Back",t[t.COUNT=3]="COUNT"})(Pi||(Pi={})),function(t){t[t.Less=0]="Less",t[t.Lequal=1]="Lequal",t[t.COUNT=2]="COUNT"}(d2||(d2={})),function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.UPDATE=1]="UPDATE"}(Dn||(Dn={})),function(t){t[t.NOT_LOADED=0]="NOT_LOADED",t[t.LOADING=1]="LOADING",t[t.LOADED=2]="LOADED"}(gv||(gv={})),function(t){t[t.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",t[t.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(tc||(tc={})),function(t){t[t.Highlight=0]="Highlight",t[t.MaskOccludee=1]="MaskOccludee",t[t.COUNT=2]="COUNT"}(oy||(oy={})),function(t){t[t.Blend=0]="Blend",t[t.Opaque=1]="Opaque",t[t.Mask=2]="Mask",t[t.MaskBlend=3]="MaskBlend",t[t.COUNT=4]="COUNT"}(fi||(fi={})),function(t){t[t.OFF=0]="OFF",t[t.ON=1]="ON"}(Xl||(Xl={})),function(t){t.DDS_ENCODING="image/vnd-ms.dds",t.KTX2_ENCODING="image/ktx2",t.BASIS_ENCODING="image/x.basis"}(F0||(F0={}));function tu(t,e,r=ug.ADD,i=[0,0,0,0]){return{srcRgb:t,srcAlpha:t,dstRgb:e,dstAlpha:e,opRgb:r,opAlpha:r,color:{r:i[0],g:i[1],b:i[2],a:i[3]}}}function Wo(t,e,r,i,n=ug.ADD,s=ug.ADD,o=[0,0,0,0]){return{srcRgb:t,srcAlpha:e,dstRgb:r,dstAlpha:i,opRgb:n,opAlpha:s,color:{r:o[0],g:o[1],b:o[2],a:o[3]}}}const Yte={face:Up.BACK,mode:i3.CCW},PPe={face:Up.FRONT,mode:i3.CCW},rU=t=>t===Pi.Back?Yte:t===Pi.Front?PPe:null,ru={zNear:0,zFar:1},Yt={r:!0,g:!0,b:!0,a:!0};function nit(t){return pit.intern(t)}function sit(t){return fit.intern(t)}function oit(t){return mit.intern(t)}function ait(t){return git.intern(t)}function lit(t){return yit.intern(t)}function cit(t){return _it.intern(t)}function uit(t){return vit.intern(t)}function hit(t){return bit.intern(t)}function dit(t){return wit.intern(t)}function kt(t){return xit.intern(t)}let vg=class{constructor(e,r){this._makeKey=e,this._makeRef=r,this._interns=new Map}intern(e){if(!e)return null;const r=this._makeKey(e),i=this._interns;return i.has(r)||i.set(r,this._makeRef(e)),i.get(r)??null}};function bg(t){return"["+t.join(",")+"]"}const pit=new vg(APe,t=>({__tag:"Blending",...t}));function APe(t){return t?bg([t.srcRgb,t.srcAlpha,t.dstRgb,t.dstAlpha,t.opRgb,t.opAlpha,t.color.r,t.color.g,t.color.b,t.color.a]):null}const fit=new vg(MPe,t=>({__tag:"Culling",...t}));function MPe(t){return t?bg([t.face,t.mode]):null}const mit=new vg(OPe,t=>({__tag:"PolygonOffset",...t}));function OPe(t){return t?bg([t.factor,t.units]):null}const git=new vg(RPe,t=>({__tag:"DepthTest",...t}));function RPe(t){return t?bg([t.func]):null}const yit=new vg($Pe,t=>({__tag:"StencilTest",...t}));function $Pe(t){return t?bg([t.function.func,t.function.ref,t.function.mask,t.operation.fail,t.operation.zFail,t.operation.zPass]):null}const _it=new vg(IPe,t=>({__tag:"DepthWrite",...t}));function IPe(t){return t?bg([t.zNear,t.zFar]):null}const vit=new vg(LPe,t=>({__tag:"ColorWrite",...t}));function LPe(t){return t?bg([t.r,t.g,t.b,t.a]):null}const bit=new vg(DPe,t=>({__tag:"StencilWrite",...t}));function DPe(t){return t?bg([t.mask]):null}const wit=new vg(NPe,t=>({__tag:"DrawBuffers",...t}));function NPe(t){return t?bg(t.buffers):null}const xit=new vg(Tit,t=>({blending:nit(t.blending),culling:sit(t.culling),polygonOffset:oit(t.polygonOffset),depthTest:ait(t.depthTest),stencilTest:lit(t.stencilTest),depthWrite:cit(t.depthWrite),colorWrite:uit(t.colorWrite),stencilWrite:hit(t.stencilWrite),drawBuffers:dit(t.drawBuffers)}));function Tit(t){return t?bg([APe(t.blending),MPe(t.culling),OPe(t.polygonOffset),RPe(t.depthTest),$Pe(t.stencilTest),IPe(t.depthWrite),LPe(t.colorWrite),DPe(t.stencilWrite),NPe(t.drawBuffers)]):null}let Sit=class{constructor(e){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._drawBuffersInvalid=!0,this._stateSetters=e}setPipeline(e){(this._pipelineInvalid||e!==this._pipeline)&&(this._setBlending(e.blending),this._setCulling(e.culling),this._setPolygonOffset(e.polygonOffset),this._setDepthTest(e.depthTest),this._setStencilTest(e.stencilTest),this._setDepthWrite(e.depthWrite),this._setColorWrite(e.colorWrite),this._setStencilWrite(e.stencilWrite),this._setDrawBuffers(e.drawBuffers),this._pipeline=e),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDrawBuffers(){this._drawBuffersInvalid=!0,this._pipelineInvalid=!0}_setBlending(e){this._blending=this._setSubState(e,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(e){this._culling=this._setSubState(e,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(e){this._polygonOffset=this._setSubState(e,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(e){this._depthTest=this._setSubState(e,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(e){this._stencilTest=this._setSubState(e,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(e){this._depthWrite=this._setSubState(e,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(e){this._colorWrite=this._setSubState(e,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(e){this._stencilWrite=this._setSubState(e,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setDrawBuffers(e){this._drawBuffers=this._setSubState(e,this._drawBuffers,this._drawBuffersInvalid,this._stateSetters.setDrawBuffers),this._drawBuffersInvalid=!1}_setSubState(e,r,i,n){return(i||e!==r)&&(n(e),this._pipelineInvalid=!0),e}},Cit=class extends Ai{constructor(){super(...arguments),this.heightParameters=Zt(),this.radii=He(),this.innerFadeDistance=0,this.altitudeFade=0,this.hazeStrength=1,this.renderScale=He(),this.backgroundColor=C()}},CM=class FPe extends Vr{initializeProgram(e){return new Lr(e.rctx,FPe.shader.get().build(this.configuration),Mr)}initializePipeline(){return this.configuration.reduced?kt({blending:tu(Se.ONE,Se.ZERO),depthTest:{func:Xr.ALWAYS},colorWrite:Yt}):this.configuration.haze?kt({blending:Wo(Se.ONE,Se.ZERO,Se.ONE_MINUS_SRC_COLOR,Se.ONE),colorWrite:Yt}):kt({blending:tu(Se.SRC_ALPHA,Se.ONE_MINUS_SRC_ALPHA),depthTest:{func:Xr.LEQUAL},colorWrite:Yt})}};CM.shader=new Ir(tit,()=>ge(()=>Promise.resolve().then(()=>INt),void 0));let cc=class extends Ai{constructor(){super(),this._key="",this._keyDirty=!1,this._parameterBits=this._parameterBits?this._parameterBits.map(()=>0):[],this._parameterNames||(this._parameterNames=[])}get key(){return this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits)),this._key}snapshot(){const e=this._parameterNames,r={key:this.key};for(const i of e)r[i]=this[i];return r}};function j(t={}){return(e,r)=>{if(e._parameterNames=e._parameterNames??[],e._parameterNames.push(r),t.constValue!=null)Object.defineProperty(e,r,{get:()=>t.constValue});else{const i=e._parameterNames.length-1,n=t.count||2,s=Math.ceil(Math.log2(n)),o=e._parameterBits??[0];let a=0;for(;o[a]+s>16;)a++,a>=o.length&&o.push(0);e._parameterBits=o;const l=o[a],c=(1<<s)-1<<l;o[a]+=s,Object.defineProperty(e,r,{get(){return this[i]},set(u){if(this[i]!==u&&(this[i]=u,this._keyDirty=!0,this._parameterBits[a]=this._parameterBits[a]&~c|+u<<l&c,typeof u!="number"&&typeof u!="boolean"))throw new Error("Configuration value for "+r+" must be boolean or number, got "+typeof u)}})}}}let B6=class extends cc{constructor(){super(...arguments),this.haze=!1,this.reduced=!1}};d([j()],B6.prototype,"haze",void 0),d([j()],B6.prototype,"reduced",void 0);var qi,ra;(function(t){t[t.RED=0]="RED",t[t.RG=1]="RG",t[t.RGBA4=2]="RGBA4",t[t.RGBA=3]="RGBA",t[t.RGBA_MIPMAP=4]="RGBA_MIPMAP",t[t.R16F=5]="R16F",t[t.RGBA16F=6]="RGBA16F"})(qi||(qi={})),function(t){t[t.DEPTH_STENCIL_TEXTURE=0]="DEPTH_STENCIL_TEXTURE",t[t.DEPTH16_BUFFER=1]="DEPTH16_BUFFER"}(ra||(ra={}));let jo=class{constructor(e,r,i,n,s,o=!1,a=0){this.name=e,this.count=r,this.type=i,this.offset=n,this.stride=s,this.normalized=o,this.divisor=a}};new jo(R.POSITION,3,qe.FLOAT,0,12);new jo(R.POSITION,3,qe.FLOAT,0,20),new jo(R.UV0,2,qe.FLOAT,12,20);new jo(R.POSITION,3,qe.FLOAT,0,32),new jo(R.NORMAL,3,qe.FLOAT,12,32),new jo(R.UV0,2,qe.FLOAT,24,32);new jo(R.POSITION,3,qe.FLOAT,0,16),new jo(R.COLOR,4,qe.UNSIGNED_BYTE,12,16);const Xte=[new jo(R.POSITION,2,qe.FLOAT,0,8)],GI=[new jo(R.POSITION,2,qe.FLOAT,0,16),new jo(R.UV0,2,qe.FLOAT,8,16)];function Eit(t){switch(t){case qe.BYTE:case qe.UNSIGNED_BYTE:return 1;case qe.SHORT:case qe.UNSIGNED_SHORT:return 2;case qe.FLOAT:case qe.INT:case qe.UNSIGNED_INT:return 4}}function kPe(t){const e=t.gl;switch(e.getError()){case e.NO_ERROR:return null;case e.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";case e.INVALID_VALUE:return"An unacceptable value has been specified for an argument";case e.INVALID_OPERATION:return"The specified command is not allowed for the current state";case e.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case e.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case e.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"}function k0(t,e){return t.vertexBuffers[e].usedMemory/Pit(t.layout[e])}function Pit(t){return t[0].stride}function Zte(t,e,r,i,n=0){var o;const s=t.gl;t.bindBuffer(r);for(const a of i){const l=e.get(a.name);if(l===void 0){console.warn(`There is no location for vertex attribute '${a.name}' defined.`);continue}const c=n*a.stride;if(a.count<=4)s.vertexAttribPointer(l,a.count,a.type,a.normalized,a.stride,a.offset+c),s.enableVertexAttribArray(l),a.divisor>0&&t.gl.vertexAttribDivisor(l,a.divisor);else if(a.count===9)for(let u=0;u<3;u++)s.vertexAttribPointer(l+u,3,a.type,a.normalized,a.stride,a.offset+12*u+c),s.enableVertexAttribArray(l+u),a.divisor>0&&t.gl.vertexAttribDivisor(l+u,a.divisor);else if(a.count===16)for(let u=0;u<4;u++)s.vertexAttribPointer(l+u,4,a.type,a.normalized,a.stride,a.offset+16*u+c),s.enableVertexAttribArray(l+u),a.divisor>0&&((o=t.gl)==null||o.vertexAttribDivisor(l+u,a.divisor));else console.error("Unsupported vertex attribute element count: "+a.count);if(bp()){const u=kPe(t),h=Eit(a.type),p=a.offset,f=Math.round(h/p)!==h/p?`. Offset not a multiple of stride. DataType requires ${h} bytes, but descriptor has an offset of ${p}`:"";u&&console.error(`Unable to bind vertex attribute "${a.name}" with baseInstanceOffset ${c}${f}:`,u,a)}}}function zPe(t,e,r,i){var s,o,a;const n=t.gl;t.bindBuffer(r);for(const l of i){const c=e.get(l.name);if(l.count<=4)n.disableVertexAttribArray(c),l.divisor&&l.divisor>0&&((s=t.gl)==null||s.vertexAttribDivisor(c,0));else if(l.count===9)for(let u=0;u<3;u++)n.disableVertexAttribArray(c+u),l.divisor&&l.divisor>0&&((o=t.gl)==null||o.vertexAttribDivisor(c+u,0));else if(l.count===16)for(let u=0;u<4;u++)n.disableVertexAttribArray(c+u),l.divisor&&l.divisor>0&&((a=t.gl)==null||a.vertexAttribDivisor(c+u,0));else console.error("Unsupported vertex attribute element count: "+l.count)}t.unbindBuffer(_t.ARRAY_BUFFER)}function Jte(t){switch(t){case Tt.ALPHA:case Tt.LUMINANCE:case Tt.RED:case Tt.RED_INTEGER:case tt.R8:case tt.R8I:case tt.R8UI:case tt.R8_SNORM:case ia.STENCIL_INDEX8:return 1;case Tt.LUMINANCE_ALPHA:case Tt.RG:case Tt.RG_INTEGER:case tt.RGBA4:case tt.R16F:case tt.R16I:case tt.R16UI:case tt.RG8:case tt.RG8I:case tt.RG8UI:case tt.RG8_SNORM:case tt.RGB565:case tt.RGB5_A1:case ia.DEPTH_COMPONENT16:return 2;case Tt.DEPTH_COMPONENT:case Tt.RGB:case Tt.RGB_INTEGER:case tt.RGB8:case tt.RGB8I:case tt.RGB8UI:case tt.RGB8_SNORM:case tt.SRGB8:case ia.DEPTH_COMPONENT24:return 3;case Tt.DEPTH_STENCIL:case Tt.DEPTH24_STENCIL8:case Tt.RGBA:case Tt.RGBA_INTEGER:case tt.RGBA8:case tt.R32F:case tt.R11F_G11F_B10F:case tt.RG16F:case tt.R32I:case tt.R32UI:case tt.RG16I:case tt.RG16UI:case tt.RGBA8I:case tt.RGBA8UI:case tt.RGBA8_SNORM:case tt.SRGB8_ALPHA8:case tt.RGB9_E5:case tt.RGB10_A2UI:case tt.RGB10_A2:case ia.DEPTH_STENCIL:case ia.DEPTH_COMPONENT32F:case ia.DEPTH24_STENCIL8:return 4;case ia.DEPTH32F_STENCIL8:return 5;case tt.RGB16F:case tt.RGB16I:case tt.RGB16UI:return 6;case tt.RG32F:case tt.RG32I:case tt.RG32UI:case tt.RGBA16F:case tt.RGBA16I:case tt.RGBA16UI:return 8;case tt.RGB32F:case tt.RGB32I:case tt.RGB32UI:return 12;case tt.RGBA32F:case tt.RGBA32I:case tt.RGBA32UI:return 16;case $n.COMPRESSED_RGB_S3TC_DXT1_EXT:case $n.COMPRESSED_RGBA_S3TC_DXT1_EXT:return .5;case $n.COMPRESSED_RGBA_S3TC_DXT3_EXT:case $n.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case $n.COMPRESSED_R11_EAC:case $n.COMPRESSED_SIGNED_R11_EAC:case $n.COMPRESSED_RGB8_ETC2:case $n.COMPRESSED_SRGB8_ETC2:case $n.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case $n.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return .5;case $n.COMPRESSED_RG11_EAC:case $n.COMPRESSED_SIGNED_RG11_EAC:case $n.COMPRESSED_RGBA8_ETC2_EAC:case $n.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0}const FD=()=>re.getLogger("esri.views.webgl.VertexArrayObject");let _d=class{constructor(e,r,i,n,s=null){this._context=e,this._locations=r,this._layout=i,this._buffers=n,this._indexBuffer=s,this._glName=null,this._initialized=!1}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get byteSize(){return Object.keys(this._buffers).reduce((e,r)=>e+this._buffers[r].usedMemory,this._indexBuffer!=null?this._indexBuffer.usedMemory:0)}get layout(){return this._layout}get locations(){return this._locations}get usedMemory(){return this.byteSize+(Object.keys(this._buffers).length+(this._indexBuffer?1:0))*ube}dispose(){var e;if(this._context){this._context.getBoundVAO()===this&&this._context.bindVAO(null);for(const r in this._buffers)(e=this._buffers[r])==null||e.dispose(),delete this._buffers[r];this._indexBuffer=gt(this._indexBuffer),this.disposeVAOOnly()}else(this._glName||Object.getOwnPropertyNames(this._buffers).length>0)&&FD().warn("Leaked WebGL VAO")}disposeVAOOnly(){this._glName&&(this._context.gl.deleteVertexArray(this._glName),this._glName=null,this._context.instanceCounter.decrement(Wn.VertexArrayObject,this)),this._context=null}initialize(){if(this._initialized)return;const{gl:e}=this._context,r=e.createVertexArray();e.bindVertexArray(r),this._bindLayout(),e.bindVertexArray(null),this._glName=r,this._context.instanceCounter.increment(Wn.VertexArrayObject,this),this._initialized=!0}bind(){this.initialize(),this._context.gl.bindVertexArray(this.glName)}_bindLayout(){const{_buffers:e,_layout:r,_indexBuffer:i}=this;e||FD().error("Vertex buffer dictionary is empty!");const n=this._context.gl;for(const s in e){const o=e[s];o||FD().error("Vertex buffer is uninitialized!");const a=r[s];a||FD().error("Vertex element descriptor is empty!"),Zte(this._context,this._locations,o,a)}i!=null&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,i.glName)}unbind(){this.initialize(),this._context.gl.bindVertexArray(null)}},_f=class extends _d{};const qy=()=>re.getLogger("esri.views.webgl.BufferObject");let Wr=class pw{static createIndex(e,r,i){return new pw(e,_t.ELEMENT_ARRAY_BUFFER,r,i)}static createVertex(e,r,i){return new pw(e,_t.ARRAY_BUFFER,r,i)}static createUniform(e,r,i){return new pw(e,_t.UNIFORM_BUFFER,r,i)}static createPixelPack(e,r=Ar.STREAM_READ,i){const n=new pw(e,_t.PIXEL_PACK_BUFFER,r);return i&&n.setSize(i),n}static createPixelUnpack(e,r=Ar.STREAM_DRAW,i){return new pw(e,_t.PIXEL_UNPACK_BUFFER,r,i)}static createTransformFeedback(e,r=Ar.STATIC_DRAW,i){const n=new pw(e,_t.TRANSFORM_FEEDBACK_BUFFER,r);return n.setSize(i),n}constructor(e,r,i,n){this._context=e,this.bufferType=r,this.usage=i,this._glName=null,this._size=-1,this._indexType=void 0,e.instanceCounter.increment(Wn.BufferObject,this),this._glName=this._context.gl.createBuffer(),Pm(this._context.gl),n&&this.setData(n)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get usedMemory(){return this.bufferType===_t.ELEMENT_ARRAY_BUFFER?this._indexType===qe.UNSIGNED_INT?4*this._size:2*this._size:this._size}get _isVAOAware(){return this.bufferType===_t.ELEMENT_ARRAY_BUFFER||this.bufferType===_t.ARRAY_BUFFER}dispose(){var e;(e=this._context)!=null&&e.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(Wn.BufferObject,this),this._context=null):this._glName&&qy().warn("Leaked WebGL buffer object")}setSize(e,r=null){if(e<=0&&qy().error("Buffer size needs to be positive!"),this.bufferType===_t.ELEMENT_ARRAY_BUFFER&&r!=null)switch(this._indexType=r,r){case qe.UNSIGNED_SHORT:e*=2;break;case qe.UNSIGNED_INT:e*=4}this._setBufferData(e)}setData(e){if(!e)return;let r=e.byteLength;this.bufferType===_t.ELEMENT_ARRAY_BUFFER&&(Az(e)&&(r/=2,this._indexType=qe.UNSIGNED_SHORT),Mz(e)&&(r/=4,this._indexType=qe.UNSIGNED_INT)),this._setBufferData(r,e)}_setBufferData(e,r=null){this._size=e;const i=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const n=this._context.gl;r!=null?n.bufferData(this.bufferType,r,this.usage):n.bufferData(this.bufferType,e,this.usage),Pm(n),this._isVAOAware&&this._context.bindVAO(i)}setSubData(e,r,i,n){if(!e)return;(r<0||r*e.BYTES_PER_ELEMENT>=this.usedMemory)&&qy().error("offset is out of range!"),i>=n&&qy().error("end must be bigger than start!"),(r+(n-i))*e.BYTES_PER_ELEMENT>this.usedMemory&&qy().error("An attempt to write beyond the end of the buffer!");const s=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const{gl:o}=this._context;o.bufferSubData(this.bufferType,r*e.BYTES_PER_ELEMENT,e,i,n-i),Pm(o),this._isVAOAware&&this._context.bindVAO(s)}getSubData(e,r=0,i,n){if(i<0||n<0)return void qy().error("Problem getting subdata: offset and length were less than zero!");const s=Ait(e)?e.BYTES_PER_ELEMENT:1;if(s*((i??0)+(n??0))>e.byteLength)return void qy().error("Problem getting subdata: offset and length exceeded destination size!");r+s*(n??0)>this.usedMemory&&qy().warn("Potential problem getting subdata: requested data exceeds buffer size!");const o=this._context.gl;this.bufferType===_t.TRANSFORM_FEEDBACK_BUFFER?(this._context.bindBuffer(this,_t.TRANSFORM_FEEDBACK_BUFFER),o.getBufferSubData(_t.TRANSFORM_FEEDBACK_BUFFER,r,e,i,n),this._context.unbindBuffer(_t.TRANSFORM_FEEDBACK_BUFFER)):(this._context.bindBuffer(this,_t.COPY_READ_BUFFER),o.getBufferSubData(_t.COPY_READ_BUFFER,r,e,i,n),this._context.unbindBuffer(_t.COPY_READ_BUFFER))}async getSubDataAsync(e,r=0,i,n){await this._context.clientWaitAsync(),this.getSubData(e,r,i,n)}};function Ait(t){return hze(t)}var yv;(function(t){t[t.Texture=0]="Texture",t[t.RenderBuffer=1]="RenderBuffer"})(yv||(yv={}));let ri=class{constructor(e=0,r=e){this.width=e,this.height=r,this.target=Sn.TEXTURE_2D,this.pixelFormat=Tt.RGBA,this.dataType=ks.UNSIGNED_BYTE,this.samplingMode=Ht.LINEAR,this.wrapMode=Jt.REPEAT,this.maxAnisotropy=1,this.flipped=!1,this.hasMipmap=!1,this.isOpaque=!1,this.unpackAlignment=4,this.preMultiplyAlpha=!1,this.depth=1,this.isImmutable=!1}};function Mit(t){return t.width<=0||t.height<=0?0:Math.round(t.width*t.height*(t.hasMipmap?4/3:1)*(t.internalFormat==null?4:Jte(t.internalFormat)))}let Oit=class UPe extends ri{constructor(e,r){switch(super(),this.context=e,Object.assign(this,r),this.internalFormat){case tt.R16F:case tt.R16I:case tt.R16UI:case tt.R32F:case tt.R32I:case tt.R32UI:case tt.R8_SNORM:case tt.R8:case tt.R8I:case tt.R8UI:this.pixelFormat=Tt.RED}}static validate(e,r){return new UPe(e,r)}};const vue=4;let Sr=class Th{constructor(e,r=null,i=null){if(this.type=yv.Texture,this._glName=null,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._wasImmutablyAllocated=!1,"context"in e)this._descriptor=e,i=r;else{const n=Oit.validate(e,r);if(!n)throw new K("Texture descriptor invalid");this._descriptor=n}this._descriptor.target===Sn.TEXTURE_CUBE_MAP?this._setDataCubeMap(i):this.setData(i)}get glName(){return this._glName}get descriptor(){return this._descriptor}get usedMemory(){return Mit(this._descriptor)}get isDirty(){return this._samplingModeDirty||this._wrapModeDirty}dispose(){this._glName&&this._descriptor.context.instanceCounter.decrement(Wn.Texture,this),this._descriptor.context.gl&&this._glName&&(this._descriptor.context.unbindTexture(this),this._descriptor.context.gl.deleteTexture(this._glName),this._glName=null)}release(){this.dispose()}resize(e,r){const i=this._descriptor;if(i.width!==e||i.height!==r){if(this._wasImmutablyAllocated)throw new K("Immutable textures can't be resized!");i.width=e,i.height=r,this._descriptor.target===Sn.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}}_setDataCubeMap(e=null){for(let r=Sn.TEXTURE_CUBE_MAP_POSITIVE_X;r<=Sn.TEXTURE_CUBE_MAP_NEGATIVE_Z;r++)this._setData(e,r)}setData(e){this._setData(e)}_setData(e,r){var c;if(!((c=this._descriptor.context)!=null&&c.gl))return;const i=this._descriptor.context.gl;Pm(i),this._glName||(this._glName=i.createTexture(),this._glName&&this._descriptor.context.instanceCounter.increment(Wn.Texture,this)),e===void 0&&(e=null);const n=this._descriptor,s=r??n.target,o=jP(s);e===null&&(n.width=n.width||vue,n.height=n.height||vue,o&&(n.depth=n.depth??1));const a=this._descriptor.context.bindTexture(this,Th.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(Th.TEXTURE_UNIT_FOR_UPDATES),kV(n),this._configurePixelStorage(),Pm(i);const l=this._deriveInternalFormat();if(xue(e)){let u="width"in e?e.width:e.codedWidth,h="height"in e?e.height:e.codedHeight;const p=1;e instanceof HTMLVideoElement&&(u=e.videoWidth,h=e.videoHeight),n.width&&n.height,o&&n.depth,n.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(s,l,n.hasMipmap,u,h,p),this._texImage(s,0,l,u,h,p,e),Pm(i),n.hasMipmap&&this.generateMipmap(),n.width||(n.width=u),n.height||(n.height=h),o&&!n.depth&&(n.depth=p)}else{const{width:u,height:h,depth:p}=n;if(u==null||h==null)throw new K("Width and height must be specified!");if(o&&p==null)throw new K("Depth must be specified!");if(n.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(s,l,n.hasMipmap,u,h,p),Q5(e)){const f=e.levels,g=Tue(s,u,h,p),_=Math.min(g-1,f.length-1);i.texParameteri(n.target,this._descriptor.context.gl.TEXTURE_MAX_LEVEL,_);const v=l;if(!Iit(v))throw new K("Attempting to use compressed data with an uncompressed format!");this._forEachMipmapLevel((b,w,x,S)=>{const E=f[Math.min(b,f.length-1)];this._compressedTexImage(s,b,v,w,x,S,E)},_)}else this._texImage(s,0,l,u,h,p,e),Pm(i),n.hasMipmap&&this.generateMipmap()}bue(i,this._descriptor),wue(i,this._descriptor),Rit(this._descriptor.context,this._descriptor),Pm(i),this._descriptor.context.bindTexture(a,Th.TEXTURE_UNIT_FOR_UPDATES)}updateData(e,r,i,n,s,o,a=0){o||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const l=this._descriptor,c=this._deriveInternalFormat(),{context:u,pixelFormat:h,dataType:p,target:f,isImmutable:g}=l;if(g&&!this._wasImmutablyAllocated)throw new K("Cannot update immutable texture before allocation!");const _=u.bindTexture(this,Th.TEXTURE_UNIT_FOR_UPDATES,!0);(r<0||i<0||n>l.width||s>l.height||r+n>l.width||i+s>l.height)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage();const{gl:v}=u;a&&v.pixelStorei(v.UNPACK_SKIP_ROWS,a),xue(o)?v.texSubImage2D(f,e,r,i,n,s,h,p,o):Q5(o)?v.compressedTexSubImage2D(f,e,r,i,n,s,c,o.levels[e]):v.texSubImage2D(f,e,r,i,n,s,h,p,o),a&&v.pixelStorei(v.UNPACK_SKIP_ROWS,0),u.bindTexture(_,Th.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(e,r,i,n,s,o,a,l){l||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const c=this._descriptor,u=this._deriveInternalFormat(),{context:h,pixelFormat:p,dataType:f,isImmutable:g,target:_}=c;if(g&&!this._wasImmutablyAllocated)throw new K("Cannot update immutable texture before allocation!");jP(_)||console.warn("Attempting to set 3D texture data on a non-3D texture");const v=h.bindTexture(this,Th.TEXTURE_UNIT_FOR_UPDATES);h.setActiveTexture(Th.TEXTURE_UNIT_FOR_UPDATES),(r<0||i<0||n<0||s>c.width||o>c.height||a>c.depth||r+s>c.width||i+o>c.height||n+a>c.depth)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage();const{gl:b}=h;if(Q5(l))l=l.levels[e],b.compressedTexSubImage3D(_,e,r,i,n,s,o,a,u,l);else{const w=l;b.texSubImage3D(_,e,r,i,n,s,o,a,p,f,w)}h.bindTexture(v,Th.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const e=this._descriptor;if(!e.hasMipmap){if(this._wasImmutablyAllocated)throw new K("Cannot add mipmaps to immutable texture after allocation");e.hasMipmap=!0,this._samplingModeDirty=!0,kV(e)}e.samplingMode===Ht.LINEAR?(this._samplingModeDirty=!0,e.samplingMode=Ht.LINEAR_MIPMAP_NEAREST):e.samplingMode===Ht.NEAREST&&(this._samplingModeDirty=!0,e.samplingMode=Ht.NEAREST_MIPMAP_NEAREST);const r=this._descriptor.context.bindTexture(this,Th.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(Th.TEXTURE_UNIT_FOR_UPDATES),this._descriptor.context.gl.generateMipmap(e.target),this._descriptor.context.bindTexture(r,Th.TEXTURE_UNIT_FOR_UPDATES)}setSamplingMode(e){e!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=e,this._samplingModeDirty=!0)}setWrapMode(e){e!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=e,kV(this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const e=this._descriptor,r=e.context.gl;this._samplingModeDirty&&(bue(r,e),this._samplingModeDirty=!1),this._wrapModeDirty&&(wue(r,e),this._wrapModeDirty=!1)}_deriveInternalFormat(){if(this._descriptor.internalFormat!=null)return this._descriptor.internalFormat===Tt.DEPTH_STENCIL&&(this._descriptor.internalFormat=Tt.DEPTH24_STENCIL8),this._descriptor.internalFormat;switch(this._descriptor.dataType){case ks.FLOAT:switch(this._descriptor.pixelFormat){case Tt.RGBA:return this._descriptor.internalFormat=tt.RGBA32F;case Tt.RGB:return this._descriptor.internalFormat=tt.RGB32F;default:throw new K("Unable to derive format")}case ks.UNSIGNED_BYTE:switch(this._descriptor.pixelFormat){case Tt.RGBA:return this._descriptor.internalFormat=tt.RGBA8;case Tt.RGB:return this._descriptor.internalFormat=tt.RGB8}}return this._descriptor.internalFormat=this._descriptor.pixelFormat===Tt.DEPTH_STENCIL?Tt.DEPTH24_STENCIL8:this._descriptor.pixelFormat}_configurePixelStorage(){const e=this._descriptor.context.gl,{unpackAlignment:r,flipped:i,preMultiplyAlpha:n}=this._descriptor;e.pixelStorei(e.UNPACK_ALIGNMENT,r),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,i?1:0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n?1:0)}_texStorage(e,r,i,n,s,o){const{gl:a}=this._descriptor.context;if(!$it(r))throw new K("Immutable textures must have a sized internal format");if(!this._descriptor.isImmutable)return;const l=i?Tue(e,n,s,o):1;if(jP(e)){if(o==null)throw new K("Missing depth dimension for 3D texture upload");a.texStorage3D(e,l,r,n,s,o)}else a.texStorage2D(e,l,r,n,s);this._wasImmutablyAllocated=!0}_texImage(e,r,i,n,s,o,a){const l=this._descriptor.context.gl,c=jP(e),{isImmutable:u,pixelFormat:h,dataType:p}=this._descriptor;if(u){if(a!=null){const f=a;if(c){if(o==null)throw new K("Missing depth dimension for 3D texture upload");l.texSubImage3D(e,r,0,0,0,n,s,o,h,p,f)}else l.texSubImage2D(e,r,0,0,n,s,h,p,f)}}else{const f=a;if(c){if(o==null)throw new K("Missing depth dimension for 3D texture upload");l.texImage3D(e,r,i,n,s,o,0,h,p,f)}else l.texImage2D(e,r,i,n,s,0,h,p,f)}}_compressedTexImage(e,r,i,n,s,o,a){const l=this._descriptor.context.gl,c=jP(e);if(this._descriptor.isImmutable){if(a!=null)if(c){if(o==null)throw new K("Missing depth dimension for 3D texture upload");l.compressedTexSubImage3D(e,r,0,0,0,n,s,o,i,a)}else l.compressedTexSubImage2D(e,r,0,0,n,s,i,a)}else if(c){if(o==null)throw new K("Missing depth dimension for 3D texture upload");l.compressedTexImage3D(e,r,i,n,s,o,0,a)}else l.compressedTexImage2D(e,r,i,n,s,0,a)}_forEachMipmapLevel(e,r=1/0){let{width:i,height:n,depth:s,hasMipmap:o,target:a}=this._descriptor;const l=a===Sn.TEXTURE_3D;if(i==null||n==null||l&&s==null)throw new K("Missing texture dimensions for mipmap calculation");for(let c=0;e(c,i,n,s),o&&(i!==1||n!==1||l&&s!==1)&&!(c>=r);++c)i=Math.max(1,i>>1),n=Math.max(1,n>>1),l&&(s=Math.max(1,s>>1))}};function kV(t){(t.width!=null&&t.width<0||t.height!=null&&t.height<0||t.depth!=null&&t.depth<0)&&console.error("Negative dimension parameters are not allowed!")}function bue(t,e){let r=e.samplingMode,i=e.samplingMode;r===Ht.LINEAR_MIPMAP_NEAREST||r===Ht.LINEAR_MIPMAP_LINEAR?(r=Ht.LINEAR,e.hasMipmap||(i=Ht.LINEAR)):r!==Ht.NEAREST_MIPMAP_NEAREST&&r!==Ht.NEAREST_MIPMAP_LINEAR||(r=Ht.NEAREST,e.hasMipmap||(i=Ht.NEAREST)),t.texParameteri(e.target,t.TEXTURE_MAG_FILTER,r),t.texParameteri(e.target,t.TEXTURE_MIN_FILTER,i)}function wue(t,e){typeof e.wrapMode=="number"?(t.texParameteri(e.target,t.TEXTURE_WRAP_S,e.wrapMode),t.texParameteri(e.target,t.TEXTURE_WRAP_T,e.wrapMode)):(t.texParameteri(e.target,t.TEXTURE_WRAP_S,e.wrapMode.s),t.texParameteri(e.target,t.TEXTURE_WRAP_T,e.wrapMode.t))}function Rit(t,e){const r=t.capabilities.textureFilterAnisotropic;r&&t.gl.texParameterf(e.target,r.TEXTURE_MAX_ANISOTROPY,e.maxAnisotropy??1)}function $it(t){return t in tt}function Iit(t){return t in $n}function Q5(t){return t!=null&&"type"in t&&t.type==="compressed"}function Lit(t){return t!=null&&"byteLength"in t}function xue(t){return t!=null&&!Q5(t)&&!Lit(t)}function jP(t){return t===Sn.TEXTURE_3D||t===Sn.TEXTURE_2D_ARRAY}function Tue(t,e,r,i=1){let n=Math.max(e,r);return t===Sn.TEXTURE_3D&&(n=Math.max(n,i)),Math.round(Math.log(n)/Math.LN2)+1}Sr.TEXTURE_UNIT_FOR_UPDATES=0;function wg(t,e=Xte,r=Mr,i=-1,n=1){let s=null;return e===GI?s=new Float32Array([i,i,0,0,n,i,1,0,i,n,0,1,n,n,1,1]):s=new Float32Array([i,i,n,i,i,n,n,n]),new _f(t,r,{geometry:e},{geometry:Wr.createVertex(t,Ar.STATIC_DRAW,s)})}const Dit=4;function BPe(t){const e=new ri(Dit);return e.samplingMode=Ht.NEAREST,new Sr(t,e)}const V6=16;function Rx(t){return Math.ceil(t/V6)*V6}function Nit(t){return Math.floor(t/V6)*V6}function Fit(t,e){let s=t.width*t.height;if(s<4096)return t instanceof ImageData?VPe(t):t;let o=t.width,a=t.height;do o=Math.ceil(o/2),a=Math.ceil(a/2),s=o*a;while(s>1048576||e!=null&&(o>e||a>e));return Qte(t,o,a)}function kit(t,e){const r=Math.max(t.width,t.height);if(r<=e)return t;const i=e/r;return Qte(t,Math.round(t.width*i),Math.round(t.height*i))}function Qte(t,e,r){if(t instanceof ImageData)return Qte(VPe(t),e,r);const i=document.createElement("canvas");return i.width=e,i.height=r,i.getContext("2d").drawImage(t,0,0,i.width,i.height),i}function VPe(t){const e=document.createElement("canvas");e.width=t.width,e.height=t.height;const r=e.getContext("2d");if(r==null)throw new K("Failed to create 2d context from HTMLCanvasElement");return r.putImageData(t,0,0),e}function Ga(t,e=!0){t.attributes.add(R.POSITION,"vec2"),e&&t.varyings.add("uv","vec2"),t.vertex.code.add(T`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      ${e?T`uv = position * 0.5 + vec2(0.5);`:""}
    }
  `)}let Kte=class extends Ai{};function GPe(t){const e=new Or;e.include(Ga),e.fragment.uniforms.add(new ct("colorTexture",i=>i.color),new ct("depthTexture",i=>i.depth));const r=t.haze;return e.fragment.code.add(T`
    void main() {
      ${r?T`vec4`:T`float`} depthSample = texture(depthTexture, uv) ${r?"":T`.r`};
      if (depthSample ${r?T`== vec4(0)`:T`!= 1.0`} ) {
          fragColor = vec4(0);
          return;
      }
      fragColor = texture(colorTexture, uv);
    }
    `),e}const zit=Object.freeze(Object.defineProperty({__proto__:null,AtmosphereCompositingPassParameters:Kte,build:GPe},Symbol.toStringTag,{value:"Module"}));let jPe=class HPe extends Vr{initializeProgram(e){return new Lr(e.rctx,HPe.shader.get().build(this.configuration),Mr)}initializePipeline(){return this.configuration.haze?kt({blending:Wo(Se.ONE,Se.ZERO,Se.ONE_MINUS_SRC_COLOR,Se.ONE),depthTest:{func:Xr.ALWAYS},colorWrite:Yt}):kt({blending:tu(Se.SRC_ALPHA,Se.ONE_MINUS_SRC_ALPHA),depthTest:{func:Xr.ALWAYS},colorWrite:Yt})}};jPe.shader=new Ir(zit,()=>ge(()=>Promise.resolve().then(()=>LNt),void 0));let Sue=class{constructor(e,r){this._view=e,this._context=r,this.type=wa.Realistic,this._handles=new $v,this._compositingPassParameters=new Kte,this._atmosphereConfiguration=new B6,this._passParameters=new Cit,this._rootTileElevationMin=NaN,this._lowerBoundEarthRadius=Yr.radius,this._fadeHaze=0,this._updateRadius(Yr.radius);const i=this._context.renderContext.rctx;this._updateRootTileElevationBounds(),this._handles.add([he(()=>{var s,o;return(o=(s=this._view)==null?void 0:s.basemapTerrain)==null?void 0:o.rootTileElevationBounds},()=>{var s;return(s=this._view)!=null&&s.basemapTerrain?this._updateRootTileElevationBounds():null}),he(()=>{var s,o;return(o=(s=this._view)==null?void 0:s.basemapTerrain)==null?void 0:o.visibleElevationBounds},()=>{var s;return(s=this._view)!=null&&s.basemapTerrain?this._updateVisibleElevationBounds():null}),he(()=>{var s;return(s=this._view)==null?void 0:s.environment.background},s=>{const o=s instanceof nPe?I$(s.color):qu;ie(this._passParameters.backgroundColor,o[0]*o[3],o[1]*o[3],o[2]*o[3])},Kr)]);const n=new B6;n.haze=!1,this._atmosphereTechnique=this._context.techniqueRepository.acquire(CM,n),n.haze=!0,this._atmosphereHazeTechnique=this._context.techniqueRepository.acquire(CM,n),n.reduced=!0,n.haze=!1,this._atmosphereReducedTechnique=this._context.techniqueRepository.acquire(CM,n),n.haze=!0,this._atmosphereHazeReducedTechnique=this._context.techniqueRepository.acquire(CM,n),this._vao=wg(i,GI)}destroy(){this._handles.destroy(),this._atmosphereTechnique.release(),this._atmosphereHazeTechnique.release(),this._atmosphereReducedTechnique.release(),this._atmosphereHazeReducedTechnique.release(),this._vao.dispose()}render(e,r){this._render(e,r?this._atmosphereTechnique:this._atmosphereReducedTechnique,e.offscreenRenderingHelper.depthTexture,r,!1)}renderHaze(e,r,i){var n;this._fadeHaze=r,this._render(e,i?this._atmosphereHazeTechnique:this._atmosphereHazeReducedTechnique,(n=e.bindParameters.linearDepth)==null?void 0:n.getTexture(),i,!0)}_render(e,r,i,n,s){if(i==null)return;const o=e.offscreenRenderingHelper;this._update(e.bindParameters.camera),this._passParameters.depthTexture=i;const a=e.rctx.bindTechnique(r,e.bindParameters,this._passParameters);if(n)o.renderDepthDetached(()=>this._renderCommon(a,e));else{const l=e.rctx.getViewport(),c=Te(e.bindParameters.camera.eye)-Yr.radius;let u;if(c<e1){const _=Math.min(1,Math.max(0,c/e1));u=s?Rt(.4,.5,_):Rt(.2,.3,_)}else{const _=Math.min(1,Math.max(0,(c-e1)/(15*e1)));u=s?Rt(.5,1,_):Rt(.3,.6,_)}const h=Rx(Math.round(u*e.bindParameters.camera.fullViewport[2])),p=Rx(Math.round(u*e.bindParameters.camera.fullViewport[3]));e.rctx.setViewport(0,0,h,p);const f=o.renderToCachedFBO(null,"chapman",()=>this._renderCommon(a,e),[0,0,0,1],qi.RGBA,null,h,p);e.rctx.setViewport(l.x,l.y,l.width,l.height),this._compositingPassParameters.color=f.getTexture(),this._compositingPassParameters.depth=i,this._atmosphereConfiguration.haze=s;const g=this._context.techniqueRepository.acquire(jPe,this._atmosphereConfiguration);e.rctx.bindTechnique(g,e.bindParameters,this._compositingPassParameters),o.renderDepthDetached(()=>e.rctx.screen.draw()),g.release(),f.release()}}_renderCommon(e,r){this._vao!=null&&(r.rctx.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),r.rctx.drawArrays(sr.TRIANGLE_STRIP,0,4))}_adjustRadiusForTesselation(e){return e*Math.cos(Math.PI/16/16)}_updateRootTileElevationBounds(){const e=this._view.basemapTerrain.rootTileElevationBounds.min;e!==this._rootTileElevationMin&&(this._rootTileElevationMin=e,this._lowerBoundEarthRadius=Yr.radius,this._updateVisibleElevationBounds())}_updateVisibleElevationBounds(){const e=this._adjustRadiusForTesselation(Yr.radius+this._view.basemapTerrain.visibleElevationBounds.min);e<this._lowerBoundEarthRadius&&this._updateRadius(e)}_updateRadius(e){this._lowerBoundEarthRadius=e,cr(this._passParameters.radii,e,e+e1),this._passParameters.innerFadeDistance=2*Math.sqrt((2*e-oX)*oX)}_update(e){if(!e)return;const r=Ra(e.eye),i=Math.sqrt(r),n=r-this._passParameters.radii[1]*this._passParameters.radii[1],s=we((i-this._passParameters.radii[0])/e1,0,1);nn(this._passParameters.heightParameters,i,r,n,s),this._passParameters.altitudeFade=qte(i-this._lowerBoundEarthRadius),this._passParameters.hazeStrength=Rt(Rt(.6,1,_$(9500,10500,i-Yr.radius)),1,this._fadeHaze)}static isSupported(e){return e.renderContext.rctx.capabilities.depthTexture}};function WPe(t){t.fragment.code.add(T`vec4 textureAtlasLookup(sampler2D tex, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
return textureGrad(tex, uvAtlas, dUVdx, dUVdy);
}`)}function ere(t,e){switch(t.include(qm,e),e.textureCoordinateType){case on.Default:case on.Compressed:return void t.fragment.code.add(T`vec4 textureLookup(sampler2D tex, vec2 uv) {
return texture(tex, uv);
}`);case on.Atlas:return t.include(WPe),void t.fragment.code.add(T`vec4 textureLookup(sampler2D tex, vec2 uv) {
return textureAtlasLookup(tex, uv, vuvRegion);
}`);default:e.textureCoordinateType;case on.None:case on.COUNT:return}}let Xu=class extends vn{constructor(e,r){super(e,"vec3",Rr.Draw,(i,n,s,o)=>i.setUniform3fv(e,r(n,s,o)))}},id=class extends vn{constructor(e,r){super(e,"sampler2D",Rr.Draw,(i,n,s)=>i.bindTexture(e,r(n,s)))}},zv=class{constructor(e){this._material=e.material,this._techniqueRepository=e.techniqueRep,this._output=e.output}dispose(){this._techniqueRepository.release(this._technique)}get technique(){return this._technique}get _stippleTextureRepository(){return this._techniqueRepository.constructionContext.stippleTextureRepository}get _markerTextureRepository(){return this._techniqueRepository.constructionContext.markerTextureRepository}ensureTechnique(e,r){return this._technique=this._techniqueRepository.releaseAndAcquire(e,this._material.getConfiguration(this._output,r),this._technique),this._technique}ensureResources(e){return gv.LOADED}},tre=class extends zv{constructor(e){super(e),this._numLoading=0,this._disposed=!1,this._textureRepository=e.textureRepository,this._textureId=e.textureId,this._acquire(e.textureId,r=>this._texture=r),this._acquire(e.normalTextureId,r=>this._textureNormal=r),this._acquire(e.emissiveTextureId,r=>this._textureEmissive=r),this._acquire(e.occlusionTextureId,r=>this._textureOcclusion=r),this._acquire(e.metallicRoughnessTextureId,r=>this._textureMetallicRoughness=r)}dispose(){this._texture=tr(this._texture),this._textureNormal=tr(this._textureNormal),this._textureEmissive=tr(this._textureEmissive),this._textureOcclusion=tr(this._textureOcclusion),this._textureMetallicRoughness=tr(this._textureMetallicRoughness),this._disposed=!0}ensureResources(e){return this._numLoading===0?gv.LOADED:gv.LOADING}get textureBindParameters(){return new qPe(this._texture!=null?this._texture.glTexture:null,this._textureNormal!=null?this._textureNormal.glTexture:null,this._textureEmissive!=null?this._textureEmissive.glTexture:null,this._textureOcclusion!=null?this._textureOcclusion.glTexture:null,this._textureMetallicRoughness!=null?this._textureMetallicRoughness.glTexture:null)}updateTexture(e){this._texture!=null&&e===this._texture.id||(this._texture=tr(this._texture),this._textureId=e,this._acquire(this._textureId,r=>this._texture=r))}_acquire(e,r){if(e==null)return void r(null);const i=this._textureRepository.acquire(e);if(nu(i))return++this._numLoading,void i.then(n=>{if(this._disposed)return tr(n),void r(null);r(n)}).finally(()=>--this._numLoading);r(i)}},qPe=class extends Ai{constructor(e=null,r=null,i=null,n=null,s=null,o,a){super(),this.texture=e,this.textureNormal=r,this.textureEmissive=i,this.textureOcclusion=n,this.textureMetallicRoughness=s,this.scale=o,this.normalTextureTransformMatrix=a}};var ot;(function(t){t[t.Disabled=0]="Disabled",t[t.Normal=1]="Normal",t[t.Schematic=2]="Schematic",t[t.Water=3]="Water",t[t.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh",t[t.Simplified=5]="Simplified",t[t.TerrainWithWater=6]="TerrainWithWater",t[t.COUNT=7]="COUNT"})(ot||(ot={}));function rre(t,e){const r=t.fragment,i=e.hasMetallicRoughnessTexture||e.hasEmissionTexture||e.hasOcclusionTexture;if(e.pbrMode===ot.Normal&&i&&t.include(ere,e),e.pbrMode!==ot.Schematic)if(e.pbrMode!==ot.Disabled){if(e.pbrMode===ot.Normal){r.code.add(T`vec3 mrr;
vec3 emission;
float occlusion;`);const n=e.pbrTextureBindType;e.hasMetallicRoughnessTexture&&(r.uniforms.add(n===Rr.Pass?new ct("texMetallicRoughness",s=>s.textureMetallicRoughness):new id("texMetallicRoughness",s=>s.textureMetallicRoughness)),r.code.add(T`void applyMetallnessAndRoughness(vec2 uv) {
vec3 metallicRoughness = textureLookup(texMetallicRoughness, uv).rgb;
mrr[0] *= metallicRoughness.b;
mrr[1] *= metallicRoughness.g;
}`)),e.hasEmissionTexture&&(r.uniforms.add(n===Rr.Pass?new ct("texEmission",s=>s.textureEmissive):new id("texEmission",s=>s.textureEmissive)),r.code.add(T`void applyEmission(vec2 uv) {
emission *= textureLookup(texEmission, uv).rgb;
}`)),e.hasOcclusionTexture?(r.uniforms.add(n===Rr.Pass?new ct("texOcclusion",s=>s.textureOcclusion):new id("texOcclusion",s=>s.textureOcclusion)),r.code.add(T`void applyOcclusion(vec2 uv) {
occlusion *= textureLookup(texOcclusion, uv).r;
}
float getBakedOcclusion() {
return occlusion;
}`)):r.code.add(T`float getBakedOcclusion() { return 1.0; }`),n===Rr.Pass?r.uniforms.add(new Ft("emissionFactor",s=>s.emissiveFactor),new Ft("mrrFactors",s=>s.mrrFactors)):r.uniforms.add(new Xu("emissionFactor",s=>s.emissiveFactor),new Xu("mrrFactors",s=>s.mrrFactors)),r.code.add(T`
    void applyPBRFactors() {
      mrr = mrrFactors;
      emission = emissionFactor;
      occlusion = 1.0;

      ${e.hasMetallicRoughnessTexture?T`applyMetallnessAndRoughness(${e.hasMetallicRoughnessTextureTransform?T`metallicRoughnessUV`:"vuv0"});`:""}

      ${e.hasEmissionTexture?T`applyEmission(${e.hasEmissiveTextureTransform?T`emissiveUV`:"vuv0"});`:""}

      ${e.hasOcclusionTexture?T`applyOcclusion(${e.hasOcclusionTextureTransform?T`occlusionUV`:"vuv0"});`:""}
    }
  `)}}else r.code.add(T`float getBakedOcclusion() { return 1.0; }`);else r.code.add(T`vec3 mrr = vec3(0.0, 0.6, 0.2);
vec3 emission = vec3(0.0);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`)}function ire(t,e){const r=t.fragment,i=e.lightingSphericalHarmonicsOrder!==void 0?e.lightingSphericalHarmonicsOrder:2;i===0?(r.uniforms.add(new Ft("lightingAmbientSH0",(n,s)=>ie(Cue,s.lighting.sh.r[0],s.lighting.sh.g[0],s.lighting.sh.b[0]))),r.code.add(T`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):i===1?(r.uniforms.add(new xr("lightingAmbientSH_R",(n,s)=>nn($g,s.lighting.sh.r[0],s.lighting.sh.r[1],s.lighting.sh.r[2],s.lighting.sh.r[3])),new xr("lightingAmbientSH_G",(n,s)=>nn($g,s.lighting.sh.g[0],s.lighting.sh.g[1],s.lighting.sh.g[2],s.lighting.sh.g[3])),new xr("lightingAmbientSH_B",(n,s)=>nn($g,s.lighting.sh.b[0],s.lighting.sh.b[1],s.lighting.sh.b[2],s.lighting.sh.b[3]))),r.code.add(T`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):i===2&&(r.uniforms.add(new Ft("lightingAmbientSH0",(n,s)=>ie(Cue,s.lighting.sh.r[0],s.lighting.sh.g[0],s.lighting.sh.b[0])),new xr("lightingAmbientSH_R1",(n,s)=>nn($g,s.lighting.sh.r[1],s.lighting.sh.r[2],s.lighting.sh.r[3],s.lighting.sh.r[4])),new xr("lightingAmbientSH_G1",(n,s)=>nn($g,s.lighting.sh.g[1],s.lighting.sh.g[2],s.lighting.sh.g[3],s.lighting.sh.g[4])),new xr("lightingAmbientSH_B1",(n,s)=>nn($g,s.lighting.sh.b[1],s.lighting.sh.b[2],s.lighting.sh.b[3],s.lighting.sh.b[4])),new xr("lightingAmbientSH_R2",(n,s)=>nn($g,s.lighting.sh.r[5],s.lighting.sh.r[6],s.lighting.sh.r[7],s.lighting.sh.r[8])),new xr("lightingAmbientSH_G2",(n,s)=>nn($g,s.lighting.sh.g[5],s.lighting.sh.g[6],s.lighting.sh.g[7],s.lighting.sh.g[8])),new xr("lightingAmbientSH_B2",(n,s)=>nn($g,s.lighting.sh.b[5],s.lighting.sh.b[6],s.lighting.sh.b[7],s.lighting.sh.b[8]))),r.code.add(T`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),e.pbrMode!==ot.Normal&&e.pbrMode!==ot.Schematic||r.code.add(T`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))}const Cue=C(),$g=Zt();function jI(t){t.vertex.code.add(T`const float PI = 3.141592653589793;`),t.fragment.code.add(T`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)}var Dm,p2;function Uit(t){return(t==null?void 0:t.cubeMap)!=null}function Bit(t){return t!=null&&!t.running}(function(t){t[t.RENDERING=0]="RENDERING",t[t.FADING=1]="FADING",t[t.FINISHED=2]="FINISHED"})(Dm||(Dm={})),function(t){t[t.RG=0]="RG",t[t.BA=1]="BA"}(p2||(p2={}));function vf(t=ZPe){return[t[0],t[1],t[2],t[3]]}function K5(t,e,r=vf()){return ce(r,t),r[3]=e,r}function Eue(t,e,r=Zt()){return Je(r,t,e),pe(r,r),r[3]=-Txe(t,e),r}function YPe(t,e=vf()){const r=$xe(EM,t);return XPe(e,Fa(U9(e,r))),e}function Pue(t,e,r=vf()){return ZE(EM,t,D$(t)),ZE(Aue,e,D$(e)),B9(EM,Aue,EM),XPe(r,Fa(U9(r,EM)))}function Vit(t,e,r,i=vf()){return K5(oee,t,kD),K5(aee,e,Mue),K5($E,r,Oue),Pue(kD,Mue,kD),Pue(kD,Oue,i),i}function Git(t){return t[3]}function D$(t){return Nt(t[3])}function XPe(t,e){return t[3]=e,t}const ZPe=[0,0,1,0],EM=lc(),Aue=lc();vf();const kD=vf(),Mue=vf(),Oue=vf();var Ur;(function(t){t[t.ANIMATING=0]="ANIMATING",t[t.INTERACTING=1]="INTERACTING",t[t.IDLE=2]="IDLE"})(Ur||(Ur={}));let jit=class{constructor(){this.readChannels=p2.RG,this.renderingStage=Dm.FINISHED,this.startTime=0,this.startTimeHeightFade=0,this.cameraPositionLastFrame=C(),this.parallax=new Rue,this.parallaxNew=new Rue,this.pointOnGround=C(),this.fadeMode=$i.HIDE,this.fadeFactor=0,this.opacity=0}updateParallax(e){const r=this.parallax,i=Te(e.eye);if(r.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(i*i-Yr.radius*Yr.radius,0))/i,Eue($ue,r.anchorPointClouds,oT),Gc(r.transform,sn,oT[3],oT),this.fadeMode===$i.CROSS_FADE){const n=this.parallaxNew;Eue($ue,n.anchorPointClouds,oT),Gc(n.transform,sn,oT[3],oT)}}updateFading(e,r,i,n){this.isFading&&this._advanceFading(i,n),this._evaluateFading(e,r,i)}_evaluateFading(e,r,i){const n=e.relativeElevation,s=this._calculateDistanceToAnchorPoint(e);if((n>1.7*b0||n<-b0||s>Xit)&&this.opacity>0)this._setFade($i.HIDE,i);else if(!this.isFading){if((n>b0||n<-.35*b0||s>Yit)&&this.opacity>0)this._setFade($i.FADE_OUT,i);else if(n<=b0&&n>=-.35*b0&&r===Ur.IDLE&&Bit(this.data)){if(this.opacity===0)return void this._setFade($i.FADE_IN,i);(s>qit||this.renderingStage===Dm.FADING)&&this._setFade($i.CROSS_FADE,i)}}}_advanceFading(e,r){this._switchReadChannels(),this._updateAnchorPoint(),this._advanceFadingFactorAndOpacity(e,r)}_advanceFadingFactorAndOpacity(e,r){if(this.fadeFactor<1)return this.fadeFactor=r?we((e-this.startTime)/(Wit*r),0,1):1,this.fadeMode===$i.FADE_OUT&&(this.opacity=1-this.fadeFactor),this.fadeMode===$i.FADE_IN&&(this.opacity=this.fadeFactor),void(this.fadeMode===$i.CROSS_FADE&&(this.opacity=1));this.fadeFactor=0,this.fadeMode===$i.FADE_OUT&&(this.opacity=0),this.fadeMode===$i.FADE_IN&&(this.opacity=1),this.fadeMode===$i.CROSS_FADE&&(this.opacity=1),this.fadeMode=$i.NONE}_switchReadChannels(){const e=this.fadeMode===$i.CROSS_FADE&&this.fadeFactor===1,r=this.fadeMode===$i.FADE_IN&&this.fadeFactor===0;this.renderingStage===Dm.FADING&&(e||r)&&(this.readChannels=1-this.readChannels,this.renderingStage=Dm.FINISHED)}_calculateDistanceToAnchorPoint(e){return pe(this.pointOnGround,e.eye),ne(this.pointOnGround,this.pointOnGround,Yr.radius),Te(ye(Hit,this.parallax.anchorPointClouds,this.pointOnGround))}_updateAnchorPoint(){this.fadeMode===$i.CROSS_FADE&&(this.fadeFactor===0&&ce(this.parallaxNew.anchorPointClouds,this.pointOnGround),this.fadeFactor===1&&ce(this.parallax.anchorPointClouds,this.parallaxNew.anchorPointClouds)),this.fadeMode===$i.FADE_IN&&this.fadeFactor===0&&ce(this.parallax.anchorPointClouds,this.pointOnGround)}_setFade(e,r){switch(e){case $i.HIDE:this.opacity=0;break;case $i.FADE_OUT:this.opacity=1;break;case $i.FADE_IN:this.opacity=0;break;case $i.CROSS_FADE:this.opacity=1}this.fadeMode=e,this.fadeFactor=0,this.startTime=r}get isFading(){return this.fadeMode===$i.FADE_OUT||this.fadeMode===$i.FADE_IN||this.fadeMode===$i.CROSS_FADE}};var $i;(function(t){t[t.NONE=0]="NONE",t[t.HIDE=1]="HIDE",t[t.FADE_OUT=2]="FADE_OUT",t[t.FADE_IN=3]="FADE_IN",t[t.CROSS_FADE=4]="CROSS_FADE"})($i||($i={}));let Rue=class{constructor(){this.anchorPointClouds=C(),this.radiusCurvatureCorrectionFactor=0,this.transform=xe()}};const $ue=Ce(0,0,1),oT=vf(),Hit=C(),Wit=1.25,qit=34e3,Yit=64e3,Xit=2e5;let Ym=class extends vn{constructor(e,r){super(e,"bool",Rr.Pass,(i,n,s)=>i.setUniform1b(e,r(n,s)))}},Zit=class extends vn{constructor(e,r){super(e,"samplerCube",Rr.Pass,(i,n,s)=>i.bindTexture(e,r(n,s)))}};function JPe(t){const e=t.fragment;e.uniforms.add(new ln("rotationMatrixClouds",(r,i)=>i.cloudsFade.parallax.transform),new ln("rotationMatrixCloudsCrossFade",(r,i)=>i.cloudsFade.parallaxNew.transform),new Ft("anchorPosition",(r,i)=>i.cloudsFade.parallax.anchorPointClouds),new Ft("anchorPositionCrossFade",(r,i)=>i.cloudsFade.parallaxNew.anchorPointClouds),new $e("cloudsHeight",()=>Ktt),new $e("radiusCurvatureCorrectionFactor",(r,i)=>i.cloudsFade.parallax.radiusCurvatureCorrectionFactor),new $e("totalFadeInOut",(r,i)=>1-i.cloudsFade.opacity),new $e("crossFadeAnchorFactor",(r,i)=>we(i.cloudsFade.fadeFactor,0,1)),new Zit("cubeMap",(r,i)=>{var n,s;return((s=(n=i.cloudsFade.data)==null?void 0:n.cubeMap)==null?void 0:s.colorTexture)??null}),new Ym("crossFade",(r,i)=>i.cloudsFade.fadeMode===$i.CROSS_FADE),new Ym("readChannelsRG",(r,i)=>i.cloudsFade.readChannels===p2.RG),new Ym("fadeTextureChannels",(r,i)=>i.cloudsFade.renderingStage===Dm.FADING)),e.constants.add("planetRadius","float",Yr.radius),e.code.add(T`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos)
{
float radiusClouds = planetRadius + cloudsHeight;
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusClouds * radiusClouds;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
vec3 intersectionPont = cameraPosition + dir * pointIntDist;
intersectionPont =  intersectionPont - spherePos;
return intersectionPont;
}`),e.code.add(T`vec3 correctForPlanetCurvature(vec3 dir)
{
dir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;
return dir;
}`),e.code.add(T`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)
{
return (rotMat * vec4(inVec, 0.0)).xyz;
}`),by(e),_g(e),e.code.add(T`const float SUNSET_TRANSITION_FACTOR = 0.3;
const vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);
const float RIM_SCATTERING_FACTOR = 140.0;
const float BACKLIGHT_FACTOR = 0.2;
const float BACKLIGHT_SCATTERING_FACTOR = 10.0;
const float BACKLIGHT_TRANSITION_FACTOR = 0.3;
vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds)
{
float upDotLight = dot(normalize(cameraPosition), normalize(mainLightDirection));
float dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(mainLightDirection)), 0.0);
float sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);
vec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);
vec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);
vec3 combinedLight = clamp((mainLightIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));
float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
float rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);
vec3 directSunScattering = RIM_COLOR * rimLightIntensity * (pow(dirDotLight, RIM_SCATTERING_FACTOR)) * scatteringMod;
float additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;
return vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);
}`),e.code.add(T`vec4 getCloudData(vec3 rayDir, bool readOtherChannel)
{
vec4 cloudData = texture(cubeMap, rayDir);
float mu = dot(rayDir, vec3(0, 0, 1));
bool readChannels = readChannelsRG ^^ readOtherChannel;
if (readChannels) {
cloudData = vec4(vec3(cloudData.r), cloudData.g);
} else {
cloudData = vec4(vec3(cloudData.b), cloudData.a);
}
if (length(cloudData) == 0.0) {
return vec4(cloudData.rgb, 1.0);
}
return cloudData;
}`),e.code.add(T`vec4 renderCloudsNoFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
float totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudData.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), totalTransmittance);
}`),e.code.add(T`vec4 renderCloudsCrossFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
vec4 cloudColor = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade);
worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = getCloudData(worldRayRotatedCorrected, fadeTextureChannels);
vec4 cloudColorCrossFade = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);
float totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudColor.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(cloudColor.rgb, totalTransmittance);
}`),e.code.add(T`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition)
{
return crossFade ? renderCloudsCrossFade(worldRay, cameraPosition) : renderCloudsNoFade(worldRay, cameraPosition);
}`)}function xg(t){t.code.add(T`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)}function QPe(){const t=new Or,{attributes:e,varyings:r,vertex:i,fragment:n}=t;return e.add(R.POSITION,"vec2"),r.add("worldRay","vec3"),i.uniforms.add(new ln("inverseProjectionMatrix",(s,o)=>o.camera.inverseProjectionMatrix),new ln("inverseViewMatrix",(s,o)=>R3(Jit,o.camera.viewMatrix))),i.code.add(T`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0.0)).xyz;
gl_Position = vec4(position, 1.0, 1.0);
}`),n.include(xg),n.include(Td),t.include(ire,{pbrMode:ot.Disabled,lightingSphericalHarmonicsOrder:2}),t.include(jI),t.include(tU),t.include(k6),t.include(JPe),n.uniforms.add(new Ft("cameraPosition",(s,o)=>o.camera.eye)),n.code.add(T`void main() {
vec4 cloudsColor = renderClouds(normalize(worldRay), cameraPosition);
fragColor = vec4((1.0 - totalFadeInOut) * cloudsColor.rgb, cloudsColor.a);
}`),t}const Jit=xe(),Qit=Object.freeze(Object.defineProperty({__proto__:null,build:QPe},Symbol.toStringTag,{value:"Module"}));let KPe=class eAe extends Vr{constructor(e){super(e,new cc,()=>this.destroy())}initializeProgram(e){return new Lr(e.rctx,eAe.shader.get().build(),Mr)}initializePipeline(){return kt({blending:Wo(Se.ONE,Se.ZERO,Se.SRC_ALPHA,Se.ONE),depthTest:{func:Xr.LEQUAL},colorWrite:Yt})}};KPe.shader=new Ir(Qit,()=>ge(()=>Promise.resolve().then(()=>DNt),void 0));let fw=class extends Ae{constructor(e){super(e),this._technique=new KPe(e),this._vao=wg(e.rctx)}destroy(){this._technique=tr(this._technique),this._vao=gt(this._vao)}render(e){if(!this._technique.compiled)return void this.requestRender();const r=e.bindParameters.cloudsFade;if(this._vao==null||r.data==null)return;const i=e.rctx.bindTechnique(this._technique,e.bindParameters,Kit);e.rctx.bindVAO(this._vao),i.assertCompatibleVertexAttributeLocations(this._vao),e.rctx.drawArrays(sr.TRIANGLE_STRIP,0,4)}};d([m({constructOnly:!0})],fw.prototype,"rctx",void 0),d([m({constructOnly:!0})],fw.prototype,"viewingMode",void 0),d([m({constructOnly:!0})],fw.prototype,"planetRadius",void 0),d([m({constructOnly:!0})],fw.prototype,"requestRender",void 0),fw=d([V("esri.views.3d.environment.CloudsComposition")],fw);const Kit=new Ai;function kc(){return new Float32Array(3)}function fX(t){const e=new Float32Array(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function pi(t,e,r){const i=new Float32Array(3);return i[0]=t,i[1]=e,i[2]=r,i}function ent(t,e){return new Float32Array(t,e,3)}function nre(){return kc()}function tAe(){return pi(1,1,1)}function rAe(){return pi(1,0,0)}function iAe(){return pi(0,1,0)}function nAe(){return pi(0,0,1)}const tnt=nre(),rnt=tAe(),int=rAe(),nnt=iAe(),snt=nAe();Object.freeze(Object.defineProperty({__proto__:null,ONES:rnt,UNIT_X:int,UNIT_Y:nnt,UNIT_Z:snt,ZEROS:tnt,clone:fX,create:kc,createView:ent,fromValues:pi,ones:tAe,unitX:rAe,unitY:iAe,unitZ:nAe,zeros:nre},Symbol.toStringTag,{value:"Module"}));var Ql;(function(t){t[t.SIXTEEN=0]="SIXTEEN",t[t.HUNDRED=1]="HUNDRED",t[t.TWOHUNDRED=2]="TWOHUNDRED",t[t.COUNT=3]="COUNT"})(Ql||(Ql={}));let eF=class extends cc{constructor(){super(...arguments),this.steps=Ql.SIXTEEN,this.writeTextureChannels=p2.RG}};d([j({count:Ql.COUNT})],eF.prototype,"steps",void 0),d([j({constValue:se("esri-mobile")?1024:2048})],eF.prototype,"cubeMapSize",void 0),d([j()],eF.prototype,"writeTextureChannels",void 0);let PM=class{constructor(e,r,i,n,s,o,a,l,c=.5){this.coverage=e,this.density=r,this.absorption=i,this.cloudSize=n,this.detailSize=s,this.smoothness=o,this.cloudHeight=a,this.raymarchingSteps=l,this.median=c}};const Iue=new PM([0,.6],[.03,.03],[0,0],[.9,.9],[.8,.8],[.7,.7],[.05,.05],Ql.SIXTEEN),va={sunny:Iue,cloudy:new PM([.3,.65],[.2,.4],[0,0],[.85,.85],[.75,.75],[.3,.4],[1,1],Ql.TWOHUNDRED,.6),rainy:new PM([.6,.8],[.5,.8],[.1,.5],[.9,.9],[.75,.75],[.5,.5],[1,1],Ql.TWOHUNDRED,.4),snowy:new PM([.25,.75],[.3,.3],[0,0],[.95,.95],[.7,.7],[.69,.75],[.3,1],Ql.HUNDRED,.65),foggy:new PM([.8,.8],[.5,.5],[0,0],[.95,.95],[.9,.9],[.55,.55],[.3,.3],Ql.SIXTEEN),default:Iue},Nh=se("esri-mobile")?64:128,ont=Nh/128,hp=Math.ceil(Math.sqrt(Nh)),H1=(Nh+2)*hp,ant=1e5,zV=128,lnt=H1/1560;let sh=class extends vn{constructor(e,r){super(e,"mat3",Rr.Pass,(i,n,s)=>i.setUniformMatrix3fv(e,r(n,s)))}},sre=class extends Ai{constructor(){super(...arguments),this.cloudRadius=0,this.cloudSize=0,this.detailSize=0,this.absorption=0,this.density=0,this.smoothness=0,this.cloudHeight=0,this.coverage=0,this.raymarchingSteps=va.default.raymarchingSteps,this.weatherTile=He(),this.viewMatrix=li()}};function sAe(t){const e=new Or;e.include(Ga,!1);const r=e.fragment;return r.uniforms.add(new $e("cloudRadius",i=>i.cloudRadius),new $e("power",i=>Rt(35,120,i.absorption)),new $e("sigmaE",i=>1+i.absorption),new $e("density",i=>Rt(0,.3,i.density)),new $e("cloudSize",i=>Rt(0,.02,Math.max(.01,1-i.cloudSize))),new $e("detailSize",i=>Rt(0,.2,Math.max(.01,1-i.detailSize))),new $e("smoothness",i=>Rt(0,.5,1-i.smoothness)),new $e("cloudHeight",i=>Rt(0,1500,i.cloudHeight)),new $e("coverage",i=>i.coverage),new sh("view",i=>i.viewMatrix),new ct("cloudShapeTexture",i=>i.noiseTexture!=null?i.noiseTexture.textureAtlas:null),new ti("cloudVariables",i=>cr(cnt,i.coverage,i.absorption))),r.constants.add("halfCubeMapSize","float",.5*t.cubeMapSize),r.code.add(T`
    const int STEPS = ${t.steps===Ql.SIXTEEN?T`16`:t.steps===Ql.HUNDRED?T`100`:T`200`};
    const int STEPS_LIGHT = 6;
    const float stepL = 300.0 / float(STEPS_LIGHT);
    const float cloudStart = 1500.0;

    vec3 rayDirection(vec2 fragCoord) {
      vec2 xy = fragCoord - halfCubeMapSize;
      return normalize(vec3(-xy, -halfCubeMapSize));
    }

    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }`),r.code.add(T`
    float getCloudShape(vec3 pos, float pOffset) {
      const float textureWidth = ${T.float(H1)};
      const float dataWidth = ${T.float(H1)};
      const float tileRows = ${T.float(hp)};
      const vec3 atlasDimensions = vec3(${T.float(Nh)}, ${T.float(Nh)}, tileRows * tileRows);

      //Change from Y being height to Z being height
      vec3 p = float(${T.float(ont)}) * pos.xzy;

      //Pixel coordinates of point in the 3D data
      vec3 coord = vec3(mod(p - pOffset * atlasDimensions, atlasDimensions));
      float f = fract(coord.z);
      float level = floor(coord.z);
      float tileY = floor(level / tileRows);
      float tileX = level - tileY * tileRows;

      //The data coordinates are offset by the x and y tile, the two boundary cells between each tile pair and the initial boundary cell on the first row/column
      vec2 offset = atlasDimensions.x * vec2(tileX, tileY) + 2.0 * vec2(tileX, tileY) + 1.0;
      vec2 pixel = coord.xy + offset;
      vec2 data = texture(cloudShapeTexture, mod(pixel, dataWidth) / textureWidth).xy;

      return 1.0 - mix(data.x, data.y, f);
    }

    float getCloudMap(vec2 p){
      // Shift the texture center to origin to avoid seam artifacts
      vec2 uv = (${T.float(lnt)} * p) / ${T.float(H1)} + 0.5;

      return texture(cloudShapeTexture, uv).a;
    }
    `),r.code.add(T`float clouds(vec3 p) {
float cloud = saturate(0.5 * mix(0.0, 1.0, min(2.0 * coverage, 1.0)));
if (cloud <= 0.0) {
return 0.0;
}
float cloudMap = getCloudMap(cloudSize * p.xy);
cloud = mix(cloud, min(2.0 * (coverage), 1.0) * cloudMap, min(2.0 * (1.0 - coverage), 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float shape = getCloudShape(8.0 * cloudSize * p, 0.0);
cloud = saturate(remap(cloud, smoothness * shape, 1.0, 0.0, 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float heightFraction = saturate((length(p) - cloudRadius - cloudStart) / cloudHeight);
cloud *= saturate(remap(heightFraction, 0.0, 0.25, 0.0, 1.0)) * smoothstep(1.0, 0.25, heightFraction);
if (cloud <= 0.0) {
return 0.0;
}
return density * saturate(remap(cloud, 0.35 * smoothness * getCloudShape(detailSize * p, 0.0), 1.0, 0.0, 1.0));
}`),r.code.add(T`vec2 sphereIntersections(vec3 start, vec3 dir, float radius) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = dot(start, start) - (radius * radius);
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}
float HenyeyGreenstein(float g, float costh) {
return (1.0 / (4.0 * 3.1415))  * ((1.0 - g * g) / pow(1.0 + g * g - 2.0 * g * costh, 1.5));
}`),r.code.add(`
    float multipleOctaves(float extinction, float mu, float stepL) {
      float attenuation = 1.0;
      float contribution = 1.0;
      float phaseAttenuation = 1.0;
      float luminance = 0.0;

      for (int i = 0; i < 4; i++) {
        float phase = mix(HenyeyGreenstein(0.0, mu), HenyeyGreenstein(0.3 * phaseAttenuation, mu), 0.7);
        luminance += contribution * phase * exp(-stepL * extinction * sigmaE * attenuation);
        attenuation *= 0.2;
        contribution *= 0.6;
        phaseAttenuation *= 0.5;
      }

      return luminance;
    }`),r.code.add(T`float lightRay(vec3 org, vec3 p, float phaseFunction, float mu, vec3 sunDirection) {
float lightRayDensity = clouds(p);
lightRayDensity += clouds(p + sunDirection * 1.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 2.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 3.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 4.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 5.0 * stepL);
float beersLaw = multipleOctaves(lightRayDensity, mu, stepL);
return mix(beersLaw * 2.0 * (1.0 - (exp(-stepL * lightRayDensity * 2.0 * sigmaE ))), beersLaw, 0.5 + 0.5 * mu);
}`),r.code.add(T`float mainRay(vec3 org, vec3 dir, vec3 sunDirection, float distToStart, float totalDistance, out float totalTransmittance) {
if (dir.z < 0.0) {
return 0.0;
}
totalTransmittance = 1.0;
float stepS = totalDistance / float(STEPS);
float cameraHeight = length(org);
float mu = 0.5 + 0.5 * dot(sunDirection, dir);
float phaseFunction = mix(HenyeyGreenstein(-0.3, mu), HenyeyGreenstein(0.3, mu), 0.7);
vec3 p = org + distToStart  * dir;
float dist = distToStart;
float shading = 0.0;
for (int i = 0; i < STEPS; i++) {
float sampleDensity = clouds(p);
float sampleSigmaE = sampleDensity * sigmaE;
if (sampleDensity > 0.0 ) {
float ambient = mix((1.2), (1.6), saturate((length(p) - cloudRadius - cloudStart) / cloudHeight));
float luminance = sampleDensity * (ambient + power * phaseFunction * lightRay(org, p, phaseFunction, mu, sunDirection));
float transmittance = exp(-sampleSigmaE * stepS);
shading += totalTransmittance * (luminance - luminance * transmittance) / sampleSigmaE;
totalTransmittance *= transmittance;
if (totalTransmittance <= 0.001) {
totalTransmittance = 0.0;
break;
}
}
dist += stepS;
p = org + dir * dist;
}
return shading;
}`),r.code.add(T`void main() {
if (coverage ==  0.0) {
fragColor = vec4(0.0, 1.0, 0.0, 1.0);
return;
}
vec3 rayDir = rayDirection(gl_FragCoord.xy);
rayDir = normalize(view * rayDir);
vec3 viewPos = vec3(0, 0, cloudRadius + 1.0);
bool hitsPlanet = rayDir.z < 0.0;
float hazeFactor = smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(dot(rayDir, vec3(0, 0, 1))));
float totalTransmittance = 1.0;
float shading = 0.0;
if (hitsPlanet) {
shading = clamp(1.0 - cloudVariables.y, 0.6, 1.0) * (1.0 - hazeFactor);
totalTransmittance = hazeFactor;
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
return;
}
vec2 rayStartIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart);
vec2 rayEndIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart + cloudHeight);
float distToStart = rayStartIntersect.y;
float totalDistance = rayEndIntersect.y - distToStart;
vec3 sunDirection = normalize(vec3(0, 0, 1));
shading = 0.5 * mainRay(viewPos, rayDir, sunDirection, distToStart, totalDistance, totalTransmittance);
shading = mix(clamp(1.0 - cloudVariables.y, 0.6, 1.0), shading, hazeFactor);
totalTransmittance = mix(0.0, totalTransmittance, hazeFactor);
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
}`),e}const cnt=He(),unt=Object.freeze(Object.defineProperty({__proto__:null,CloudsPassParameters:sre,build:sAe},Symbol.toStringTag,{value:"Module"}));let oAe=class aAe extends Vr{constructor(e,r){super(e,r,()=>this.destroy())}initializeProgram(e){return new Lr(e.rctx,aAe.shader.get().build(this.configuration),Mr)}initializePipeline(){return kt({blending:tu(Se.CONSTANT_COLOR,Se.ONE_MINUS_CONSTANT_COLOR,ug.ADD,this.configuration.writeTextureChannels===p2.RG?[1,1,0,0]:[0,0,1,1]),depthTest:{func:Xr.LEQUAL},colorWrite:Yt})}};oAe.shader=new Ir(unt,()=>ge(()=>Promise.resolve().then(()=>NNt),void 0));var Nu;(function(t){t[t.Full=0]="Full",t[t.WeatherMap=1]="WeatherMap",t[t.COUNT=2]="COUNT"})(Nu||(Nu={}));let mX=class extends cc{constructor(){super(...arguments),this.mode=Nu.Full}};d([j({count:Nu.COUNT})],mX.prototype,"mode",void 0);let ore=class extends Ai{constructor(){super(...arguments),this.weatherTile=lr(0,0)}};function lAe(t){const e=new Or;return e.include(Ga,!1),e.fragment.code.add(T`float remap(float x, float low1, float high1, float low2, float high2) {
return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
}`),t.mode===Nu.Full&&e.fragment.code.add(T`
    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }

    // Safer modulo for positive and negative values
    vec3 modulo(vec3 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec3 hash(vec3 p3, float frequency){
      p3 = modulo(p3, frequency);
      p3 = fract(p3 * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yxz + 33.33);
      return -1.0 + 2.0 * fract((p3.xxy + p3.yxx) * p3.zyx);
    }

    // 5th order polynomial interpolation
    vec3 fade(vec3 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec3 p, float frequency){
      // Cell point is in
      vec3 i = floor(p);

      // Position in the cell in [0, 1]
      vec3 f = fract(p);

      // Interpolation value for gradient mixing
      vec3 u = fade(f);

      // Trilinear interpolation of gradients at cube vertices around point
      return mix( mix( mix( dot( hash( i + vec3(0.0,0.0,0.0), frequency), f - vec3(0.0,0.0,0.0) ),
                            dot( hash( i + vec3(1.0,0.0,0.0), frequency), f - vec3(1.0,0.0,0.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,0.0), frequency), f - vec3(0.0,1.0,0.0) ),
                            dot( hash( i + vec3(1.0,1.0,0.0), frequency), f - vec3(1.0,1.0,0.0) ), u.x), u.y),
                  mix( mix( dot( hash( i + vec3(0.0,0.0,1.0), frequency), f - vec3(0.0,0.0,1.0) ),
                            dot( hash( i + vec3(1.0,0.0,1.0), frequency), f - vec3(1.0,0.0,1.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,1.0), frequency), f - vec3(0.0,1.0,1.0) ),
                            dot( hash( i + vec3(1.0,1.0,1.0), frequency), f - vec3(1.0,1.0,1.0) ), u.x), u.y), u.z );
    }

    float getPerlinNoise(vec3 pos, float frequency) {
      float octaveFrequencyFactor = 2.0;
      float sum = 0.0;
      float weightSum = 0.0;
      float weight = 1.0;

      for (int oct = 0; oct < 3; oct++) {
        vec3 p = pos * frequency;
        float val = 0.5 + 0.5 * gradientNoise(p, frequency);
        sum += val * weight;
        weightSum += weight;
        weight *= 0.5;
        frequency *= octaveFrequencyFactor;
      }

      float noise = (sum / weightSum);
      noise = saturate(noise);
      return noise;
    }

    float worley(vec3 pos, float numCells) {
      vec3 p = pos * numCells;
      float d = 1.0e10;

      for (int x = -1; x <= 1; x++) {
        for (int y = -1; y <= 1; y++) {
          for (int z = -1; z <= 1; z++) {
            vec3 tp = floor(p) + vec3(x, y, z);
            tp = p - tp - (hash(tp, numCells) * 0.5 + 0.5);
            d = min(d, dot(tp, tp));
          }
        }
      }

      return 1.0 - clamp(d, 0.0, 1.0);
    }

    vec3 get3Dfrom2D(vec2 uv) {
      vec2 tile = floor(uv);
      float z = floor(${T.float(hp)} * tile.y + tile.x);
      return vec3(fract(uv), z);
    }

    float getTextureForPointPerlinWorley(vec3 p) {
      float perlinNoise = getPerlinNoise(p, ${T.float(8)});

      float worley0 = worley(p, ${T.float(2)} * 2.0);
      float worley1 = worley(p, ${T.float(2)} * 8.0);
      float worley2 = worley(p, ${T.float(2)} * 14.0);

      float worleyFBM = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      return remap(perlinNoise, 0.0, 1.0, worleyFBM, 1.0);
    }

    float getTextureForPointWorley(vec3 p) {
      float worley0 = worley(p, ${T.float(2)});
      float worley1 = worley(p, ${T.float(2)} * 2.0);
      float worley2 = worley(p, ${T.float(2)} * 4.0);
      float worley3 = worley(p, ${T.float(2)} * 8.0);

      float FBM0 = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      float FBM1 = worley1 * 0.625 + worley2 * 0.25 + worley3 * 0.125;
      float FBM2 = worley2 * 0.75 + worley3 * 0.25;

      return FBM0 * 0.625 + FBM1 * 0.25 + FBM2 * 0.125;
    }
  `),e.fragment.uniforms.add(new ti("weatherTile",r=>r.weatherTile)),e.fragment.code.add(T`
    vec2 modulo(vec2 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec2 hash(vec2 p){
      // Get position of p in weather tile
      p = modulo(p, ${T.float(zV)});

      // Get global coordinates of p
      p += weatherTile * ${T.float(zV)};

      // Limit position to avoid numerical instability
      p = modulo(p, ${T.float(ant)});

      vec3 p3 = fract(vec3(p.xyx) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return 2.0 * fract((p3.xx + p3.yz) * p3.zy) - 1.0;
    }

    vec2 fade(vec2 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec2 p){
      vec2 i = floor( p );
      vec2 f = fract( p );

      vec2 u = fade(f);

      // Bilinear interpolation of gradients at cell vertices around point
      return  mix(
                mix(dot( hash( i + vec2(0.0,0.0) ), f - vec2(0.0,0.0) ),
                    dot( hash( i + vec2(1.0,0.0) ), f - vec2(1.0,0.0) ), u.x),
                mix(dot( hash( i + vec2(0.0,1.0) ), f - vec2(0.0,1.0) ),
                    dot( hash( i + vec2(1.0,1.0) ), f - vec2(1.0,1.0) ), u.x),
                u.y);
    }

    float worley(vec2 p){
      float d = 1.0e10;
      for (int x = -1; x <= 1; x++){
        for (int y = -1; y <= 1; y++){
                vec2 tp = floor(p) + vec2(x, y);
                tp = p - tp - (0.5 + 0.5 * hash(tp));
                d = min(d, dot(tp, tp));
            }
        }
      return 1.0 - clamp(d, 0.0, 1.0);
    }
  `),e.fragment.code.add(T`void main() {`),t.mode===Nu.Full&&e.fragment.code.add(T`
        float padWidth = 1.0;
        float paddedSize = ${T.float(Nh)} + 2.0 * padWidth;
        float tileCount = ${T.float(hp)} * ${T.float(hp)};
        vec2 tile = floor((gl_FragCoord.xy - 0.5) / paddedSize);

        bool padCell = false;
        if (mod(gl_FragCoord.x, paddedSize) == 0.5 || mod(gl_FragCoord.x, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        if (mod(gl_FragCoord.y, paddedSize) == 0.5 || mod(gl_FragCoord.y, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        bool startPadX = false;
        bool startPadY = false;
        bool endPadX = false;
        bool endPadY = false;

        if (gl_FragCoord.x == tile.x * paddedSize + 0.5) {
          startPadX = true;
        }

        if (gl_FragCoord.y == tile.y * paddedSize + 0.5) {
          startPadY = true;
        }

        if (gl_FragCoord.x == (tile.x + 1.0) * paddedSize - 0.5) {
          endPadX = true;
        }

        if (gl_FragCoord.y == (tile.y + 1.0) * paddedSize - 0.5) {
          endPadY = true;
        }

        vec2 padding = vec2(2.0 * padWidth) * tile;
        vec2 uv;

        if (padCell) {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;

          if (startPadX) {
            pixel.x += ${T.float(Nh)};
          }

          if (startPadY) {
            pixel.y += ${T.float(Nh)};
          }

          if (endPadX) {
            pixel.x -= ${T.float(Nh)};
          }

          if (endPadY) {
            pixel.y -= ${T.float(Nh)};
          }

          uv = vec2(pixel.xy / ${T.float(Nh)});
        } else {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;
          uv = vec2(pixel.xy / ${T.float(Nh)});
        }

        vec3 p_ = get3Dfrom2D(uv);
        vec3 p = p_;
        p.z /= (${T.float(hp)} * ${T.float(hp)});

        float worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        float worleyNoise = getTextureForPointWorley(p);

        fragColor.r = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

        p_ = mod(p_ + 1.0, ${T.float(hp)} * ${T.float(hp)});
        p = p_;
        p.z /= (${T.float(hp)} * ${T.float(hp)});

        worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        worleyNoise = getTextureForPointWorley(p);

        fragColor.g = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));
      `),e.fragment.code.add(T`
      vec2 mapUV = ${T.float(zV)} * (gl_FragCoord.xy / ${T.float(H1)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);

      ${t.mode===Nu.Full?T`fragColor.ba = vec2(0.0, map);`:T`fragColor = vec4(map);`};
    }
  `),e}const hnt=Object.freeze(Object.defineProperty({__proto__:null,NoiseTextureAtlasPassParameters:ore,build:lAe},Symbol.toStringTag,{value:"Module"}));let gX=class cAe extends Vr{initializeProgram(e){return new Lr(e.rctx,cAe.shader.get().build(this.configuration),Mr)}initializePipeline(){return kt({blending:this.configuration.mode===Nu.Full?tu(Se.ONE,Se.ZERO):Wo(Se.ZERO,Se.ONE,Se.ONE,Se.ZERO),depthTest:{func:Xr.ALWAYS},colorWrite:Yt})}};gX.shader=new Ir(hnt,()=>ge(()=>Promise.resolve().then(()=>FNt),void 0));let uAe=class{constructor(e,r,i=r){this.internalFormat=e,this.width=r,this.height=i,this.multisampled=!1,this.samples=1}};function dnt(t){return t.width<=0||t.height<=0||t.internalFormat==null?0:t.width*t.height*Jte(t.internalFormat)}let hAe=class{constructor(e,r){this._context=e,this._descriptor=r,this.type=yv.RenderBuffer,this._context.instanceCounter.increment(Wn.Renderbuffer,this);const i=this._context.gl;this.glName=i.createRenderbuffer(),this._context.bindRenderbuffer(this);const{width:n,height:s,internalFormat:o,multisampled:a}=r;a?i.renderbufferStorageMultisample(i.RENDERBUFFER,this.samples,o,n,s):i.renderbufferStorage(i.RENDERBUFFER,o,n,s)}get descriptor(){return this._descriptor}get samples(){const e=this._descriptor.samples,r=this._context.parameters.maxSamples;return e?Math.min(e,r):r}get usedMemory(){return dnt(this._descriptor)}resize(e,r){const i=this._descriptor;if(i.width===e&&i.height===r)return;i.width=e,i.height=r;const n=this._context.gl;this._context.bindRenderbuffer(this),i.multisampled?n.renderbufferStorageMultisample(n.RENDERBUFFER,this.samples,i.internalFormat,i.width,i.height):n.renderbufferStorage(n.RENDERBUFFER,i.internalFormat,i.width,i.height)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(Wn.Renderbuffer,this),this._context=null)}};const pnt=()=>re.getLogger("esri.views.webgl.FramebufferObject");let bf=class AM{constructor(e,r,i=null){this._context=e,this._glName=null,this._colorAttachments=new Map,this._depthStencilBuffer=null,this._depthStencilTexture=null,this._initialized=!1,e.instanceCounter.increment(Wn.FramebufferObject,this);const n=tF(r)?r:new Sr(this._context,r);if(this._colorAttachments.set(cl.COLOR_ATTACHMENT0,n),this._validateTextureDescriptor(n.descriptor),this._validateColorAttachmentPoint(cl.COLOR_ATTACHMENT0),i!=null)if(mnt(i))this._context.capabilities.depthTexture||console.error("Setting the depth/stencil texture as an attachment requires WEBGL_depth_texture or WebGL2"),this._depthStencilTexture=tF(i)?i:new Sr(this._context,i),this._validateTextureDescriptor(this._depthStencilTexture.descriptor);else{const s=fnt(i)?i:new hAe(this._context,i);this._depthStencilBuffer=s,this._validateRenderBufferDescriptor(s.descriptor)}}dispose(){var r,i;if(this._colorAttachments.size===0&&!this._glName)return;const e=this._context.getBoundFramebufferObject();this._colorAttachments.forEach((n,s)=>{var o;return(o=this.detachColorTexture(s))==null?void 0:o.dispose()}),(r=this.detachDepthStencilBuffer())==null||r.dispose(),(i=this.detachDepthStencilTexture())==null||i.dispose(),this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),this._context.bindFramebuffer(e),this._context.instanceCounter.decrement(Wn.FramebufferObject,this)}get glName(){return this._glName}get colorTexture(){return this._colorAttachments.get(cl.COLOR_ATTACHMENT0)}get depthStencil(){return this._depthStencilTexture||this._depthStencilBuffer}get depthStencilTexture(){return this._depthStencilTexture}get width(){var r;const e=this._colorAttachments.get(cl.COLOR_ATTACHMENT0);return((r=e==null?void 0:e.descriptor)==null?void 0:r.width)??0}get height(){var r;const e=this._colorAttachments.get(cl.COLOR_ATTACHMENT0);return((r=e==null?void 0:e.descriptor)==null?void 0:r.height)??0}get usedMemory(){var e;return[...this._colorAttachments].reduce((r,[i,n])=>r+n.usedMemory,((e=this.depthStencil)==null?void 0:e.usedMemory)??0)}getColorTexture(e){const r=this._colorAttachments.get(e);return r&&tF(r)?r:null}get colorAttachments(){return[...this._colorAttachments.keys()]}attachColorTexture(e,r=cl.COLOR_ATTACHMENT0){var n;if(!e)return;this._validateColorAttachmentPoint(r);const i=e.descriptor;this._validateTextureDescriptor(i),(n=this.detachColorTexture(r))==null||n.dispose(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,r)),this._colorAttachments.set(r,e)}detachColorTexture(e=cl.COLOR_ATTACHMENT0){const r=this._colorAttachments.get(e);if(r){if(this._initialized){const i=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e),this._context.bindFramebuffer(i)}return this._colorAttachments.delete(e),r}}setColorTextureTarget(e,r=cl.COLOR_ATTACHMENT0){const i=this._colorAttachments.get(r);i&&this._framebufferTexture2D(i.glName,r,e)}attachDepthStencil(e){if(e)switch(e.type){case yv.Texture:return this._attachDepthStencilTexture(e);case yv.RenderBuffer:return this._attachDepthStencilBuffer(e)}}_attachDepthStencilTexture(e){var i;if(e==null)return;const r=e.descriptor;r.pixelFormat!==Tt.DEPTH_STENCIL&&r.pixelFormat!==Tt.DEPTH24_STENCIL8&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!"),r.dataType!==ks.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!"),this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!"),this._validateTextureDescriptor(r),this._disposeDepthStencilAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,n3)),(i=this._depthStencilTexture)==null||i.dispose(),this._depthStencilTexture=e}detachDepthStencilTexture(){const e=this._depthStencilTexture;return e&&this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,n3)),this._depthStencilTexture=null,e}_attachDepthStencilBuffer(e){if(e==null)return;const r=e.descriptor;if(this._validateRenderBufferDescriptor(r),this._disposeDepthStencilAttachments(),this._initialized){this._context.bindFramebuffer(this);const i=this._context.gl,n=this._getGLAttachmentPoint(r);i.framebufferRenderbuffer(Sa.FRAMEBUFFER,n,i.RENDERBUFFER,e.glName)}this._depthStencilBuffer=e}detachDepthStencilBuffer(){const e=this._depthStencilBuffer;if(e&&this._initialized){this._context.bindFramebuffer(this);const r=this._context.gl,i=this._getGLAttachmentPoint(e.descriptor);r.framebufferRenderbuffer(Sa.FRAMEBUFFER,i,r.RENDERBUFFER,null)}return this._depthStencilBuffer=null,e}copyToTexture(e,r,i,n,s,o,a){(e<0||r<0||s<0||o<0)&&console.error("Offsets cannot be negative!"),(i<=0||n<=0)&&console.error("Copy width and height must be greater than zero!");const l=a.descriptor;a.descriptor.target!==Sn.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!"),((l==null?void 0:l.width)==null||(l==null?void 0:l.height)==null||e+i>this.width||r+n>this.height||s+i>l.width||o+n>l.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");const c=this._context,u=c.bindTexture(a,Sr.TEXTURE_UNIT_FOR_UPDATES);c.setActiveTexture(Sr.TEXTURE_UNIT_FOR_UPDATES),c.bindFramebuffer(this),c.gl.copyTexSubImage2D(Sn.TEXTURE_2D,0,s,o,e,r,i,n),c.bindTexture(u,Sr.TEXTURE_UNIT_FOR_UPDATES)}readPixels(e,r,i,n,s,o,a){(i<=0||n<=0)&&console.error("Copy width and height must be greater than zero!"),a||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(e,r,i,n,s,o,a)}async readPixelsAsync(e,r,i,n,s,o,a){const{gl:l}=this._context,c=Wr.createPixelPack(this._context,Ar.STREAM_READ,a.byteLength);this._context.bindBuffer(c),this._context.bindFramebuffer(this),l.readPixels(e,r,i,n,s,o,0),this._context.unbindBuffer(_t.PIXEL_PACK_BUFFER),await c.getSubDataAsync(a),c.dispose()}resize(e,r){var n,s;if(this.width===e&&this.height===r)return;const i={width:e,height:r};px(i,this._context.parameters.maxTextureSize),this._colorAttachments.forEach(o=>o.resize(i.width,i.height)),(n=this._depthStencilTexture)==null||n.resize(i.width,i.height),this._initialized&&(px(i,this._context.parameters.maxRenderbufferSize),(s=this._depthStencilBuffer)==null||s.resize(i.width,i.height),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1)}initializeAndBind(e=Sa.FRAMEBUFFER){const r=this._context.gl;if(this._initialized)return void r.bindFramebuffer(e,this.glName);this._glName&&r.deleteFramebuffer(this._glName);const i=r.createFramebuffer();if(r.bindFramebuffer(e,i),this._colorAttachments.forEach((n,s)=>this._framebufferTexture2D(n.glName,s,Lue(n),e)),this._depthStencilBuffer){const n=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);r.framebufferRenderbuffer(e,n,r.RENDERBUFFER,this._depthStencilBuffer.glName)}else this._depthStencilTexture&&this._framebufferTexture2D(this._depthStencilTexture.glName,r.DEPTH_STENCIL_ATTACHMENT,Lue(this._depthStencilTexture),e);bp()&&r.checkFramebufferStatus(e)!==r.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=i,this._initialized=!0}_framebufferTexture2D(e,r=cl.COLOR_ATTACHMENT0,i=Sn.TEXTURE_2D,n=Sa.FRAMEBUFFER,s=0){this._context.gl.framebufferTexture2D(n,r,i,e,s)}_disposeDepthStencilAttachments(){const e=this._context.gl;if(this._depthStencilBuffer){if(this._initialized){this._context.bindFramebuffer(this);const r=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);e.framebufferRenderbuffer(Sa.FRAMEBUFFER,r,e.RENDERBUFFER,null)}this._depthStencilBuffer=gt(this._depthStencilBuffer)}this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture=gt(this._depthStencilTexture))}_validateTextureDescriptor(e){e.target!==Sn.TEXTURE_2D&&e.target!==Sn.TEXTURE_CUBE_MAP&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!"),px(e,this._context.parameters.maxTextureSize),this._validateBufferDimensions(e)}_validateRenderBufferDescriptor(e){px(e,this._context.parameters.maxRenderbufferSize),this._validateBufferDimensions(e)}_validateBufferDimensions(e){e.width<=0&&(e.width=this.width),e.height<=0&&(e.height=this.height),this.width>0&&this.height>0&&(this.width===e.width&&this.height===e.height||console.error("Attachment size must match framebuffer size!"))}_getGLAttachmentPoint(e){switch(e.internalFormat){case ia.DEPTH_COMPONENT16:case ia.DEPTH_COMPONENT24:case ia.DEPTH_COMPONENT32F:return this._context.gl.DEPTH_ATTACHMENT;case ia.DEPTH24_STENCIL8:case ia.DEPTH32F_STENCIL8:case ia.DEPTH_STENCIL:return this._context.gl.DEPTH_STENCIL_ATTACHMENT;case ia.STENCIL_INDEX8:return this._context.gl.STENCIL_ATTACHMENT}}_validateColorAttachmentPoint(e){if(AM._MAX_COLOR_ATTACHMENTS===-1){const{gl:i}=this._context;AM._MAX_COLOR_ATTACHMENTS=i.getParameter(i.MAX_COLOR_ATTACHMENTS)}const r=e-cl.COLOR_ATTACHMENT0;r+1>AM._MAX_COLOR_ATTACHMENTS&&re.getLogger("esri.views.webgl.FrameBufferObject").error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${r+1}. Implementation supports up to ${AM._MAX_COLOR_ATTACHMENTS} color attachments`)}};function tF(t){return t!=null&&"type"in t&&t.type===yv.Texture}function fnt(t){return t!=null&&"type"in t&&t.type===yv.RenderBuffer}function mnt(t){return tF(t)||t!=null&&"pixelFormat"in t}function px(t,e){const r=Math.max(t.width,t.height);if(r>e){pnt().warn(`Resizing FBO attachment size ${t.width}x${t.height} to device limit ${e}`);const i=e/r;return t.width=Math.round(t.width*i),t.height=Math.round(t.height*i),!1}return!0}function Lue(t){return t.descriptor.target===Sn.TEXTURE_CUBE_MAP?Sn.TEXTURE_CUBE_MAP_POSITIVE_X:Sn.TEXTURE_2D}bf._MAX_COLOR_ATTACHMENTS=-1;let MM=class extends Ae{constructor(e){super(e),this._needsRender=!0,this._passParameters=new ore,this._fbo=new bf(e.context.renderContext.rctx,new ri(H1)),this._vao=wg(e.context.renderContext.rctx)}get _techniqueRepository(){return this.context.techniqueRepository}get textureAtlas(){return this._texture!=null?this._weatherMapTechnique!=null&&this._weatherMapTechnique.compiled&&this._needsRender&&(this._texture=this._render(Nu.WeatherMap)):this._fullTechnique!=null&&this._fullTechnique.compiled&&(this._texture=this._render(Nu.Full)),this._texture}_setDirty(){this._needsRender=!0}updateWeatherMap(e){this._passParameters.weatherTile[0]===e[0]&&this._passParameters.weatherTile[1]===e[1]||(eo(this._passParameters.weatherTile,e),this._setDirty())}destroy(){this._fullTechniqueCached=tr(this._fullTechniqueCached),this._weatherMapTechniqueCached=tr(this._weatherMapTechniqueCached),this._fbo=gt(this._fbo),this._vao=gt(this._vao)}get _fullTechnique(){if(this._fullTechniqueCached==null){const e=new mX;e.mode=Nu.Full,this._fullTechniqueCached=this._techniqueRepository.acquire(gX,e)}return this._fullTechniqueCached}get _weatherMapTechnique(){if(this._weatherMapTechniqueCached==null){const e=new mX;e.mode=Nu.WeatherMap,this._weatherMapTechniqueCached=this._techniqueRepository.acquire(gX,e)}return this._weatherMapTechniqueCached}_render(e){if(this._vao==null||this._fbo==null)return null;const r=e===Nu.Full?this._fullTechnique:this._weatherMapTechnique,i=this.context.renderContext.rctx,n=i.getViewport();i.setViewport(0,0,H1,H1),i.bindFramebuffer(this._fbo);const s=i.bindTechnique(r,null,this._passParameters);return i.bindVAO(this._vao),s.assertCompatibleVertexAttributeLocations(this._vao),i.gl.drawArrays(i.gl.TRIANGLE_STRIP,0,4),i.setViewport(n.x,n.y,n.width,n.height),this._needsRender=!1,this._fbo.colorTexture}};d([m({constructOnly:!0})],MM.prototype,"context",void 0),d([m({readOnly:!0})],MM.prototype,"_techniqueRepository",null),MM=d([V("esri.views.3d.environment.NoiseTextureAtlas")],MM);var Ec;(function(t){t[t.Occluded=0]="Occluded",t[t.NotOccluded=1]="NotOccluded",t[t.Both=2]="Both",t[t.COUNT=3]="COUNT"})(Ec||(Ec={}));function dAe(t){t.include(cg),t.uniforms.add(new ct("geometryDepthTexture",(e,r)=>{var i;return(i=r.multipassGeometry.linearDepth)==null?void 0:i.getTexture()}),new ti("nearFar",(e,r)=>r.camera.nearFar)),t.code.add(T`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, nearFar);
return (elementDepth < (geometryDepth - 1.0));
}`)}let gnt=class{};function iu(t,e){if(!e.multipassEnabled)return;t.fragment.include(cg),t.fragment.uniforms.add(new ct("terrainDepthTexture",(i,n)=>{var s;return(s=n.multipassTerrain.linearDepth)==null?void 0:s.getTexture()}),new ti("nearFar",(i,n)=>n.camera.nearFar));const r=e.occlusionPass;t.fragment.code.add(T`
   ${r?"bool":"void"} terrainDepthTest(float fragmentDepth) {
      vec4 data = texelFetch(terrainDepthTexture, ivec2(gl_FragCoord.xy), 0);
      float linearDepth = linearDepthFromRGBA(data, nearFar);
      ${r?T`return fragmentDepth < linearDepth && data != vec4(0.0, 0.0, 0.0, 1.0);`:T`
          if(fragmentDepth ${e.cullAboveGround?">":"<="} linearDepth){
            discard;
          }`}
    }`)}let ynt=class{constructor(){this.cullAboveGround=!1}};function iU(t){return t?{ray:Js(t.ray),c0:t.c0,c1:t.c1}:{ray:Js(),c0:0,c1:Number.MAX_VALUE}}function _nt(t,e=iU()){return b6(t,e.ray),e.c0=0,e.c1=Number.MAX_VALUE,e}function vnt(t,e,r=iU()){const i=Te(t.vector);return OSe(t.origin,e,r.ray),r.c0=0,r.c1=i,r}function n9t(t,e){return pAe(t,t.c0,e)}function s9t(t,e){return pAe(t,t.c1,e)}function pAe(t,e,r){return fe(r,t.ray.origin,ne(r,t.ray.direction,e))}new my(()=>iU());function N$(t){return t?[zr(t[0]),zr(t[1]),zr(t[2]),zr(t[3]),zr(t[4]),zr(t[5])]:[zr(),zr(),zr(),zr(),zr(),zr()]}function fAe(){return[C(),C(),C(),C(),C(),C(),C(),C()]}function G6(t,e){for(let r=0;r<q3;r++)A9(t[r],e[r]);return t}function mAe(t,e,r,i=Cnt){const n=Hr(Gee.get(),e,t);os(n,n);for(let s=0;s<Tnt;++s){const o=jc(Vee.get(),Snt[s],n);ie(i[s],o[0]/o[3],o[1]/o[3],o[2]/o[3])}gAe(r,i)}function gAe(t,e){Ma(e[st.FAR_BOTTOM_LEFT],e[st.NEAR_BOTTOM_LEFT],e[st.NEAR_TOP_LEFT],t[si.LEFT]),Ma(e[st.NEAR_BOTTOM_RIGHT],e[st.FAR_BOTTOM_RIGHT],e[st.FAR_TOP_RIGHT],t[si.RIGHT]),Ma(e[st.FAR_BOTTOM_LEFT],e[st.FAR_BOTTOM_RIGHT],e[st.NEAR_BOTTOM_RIGHT],t[si.BOTTOM]),Ma(e[st.NEAR_TOP_LEFT],e[st.NEAR_TOP_RIGHT],e[st.FAR_TOP_RIGHT],t[si.TOP]),Ma(e[st.NEAR_BOTTOM_LEFT],e[st.NEAR_BOTTOM_RIGHT],e[st.NEAR_TOP_RIGHT],t[si.NEAR]),Ma(e[st.FAR_BOTTOM_RIGHT],e[st.FAR_BOTTOM_LEFT],e[st.FAR_TOP_LEFT],t[si.FAR])}function P1(t,e){for(let r=0;r<q3;r++){const i=t[r];if(i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]>=e[3])return!1}return!0}function bnt(t,e){return _Ae(t,_nt(e,vAe.get()))}function o9t(t,e){for(let r=0;r<q3;r++){const i=t[r];if(!oYe(i,e))return!1}return!0}function wnt(t,e,r){return _Ae(t,vnt(e,r,vAe.get()))}function yAe(t,e){for(let r=0;r<q3;r++)if(bi(t[r],e)>0)return!1;return!0}function _Ae(t,e){for(let r=0;r<q3;r++)if(!sYe(t[r],e))return!1;return!0}var si,st;(function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.TOP=3]="TOP",t[t.NEAR=4]="NEAR",t[t.FAR=5]="FAR"})(si||(si={})),function(t){t[t.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT",t[t.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT",t[t.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT",t[t.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT",t[t.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT",t[t.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT",t[t.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT",t[t.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"}(st||(st={}));const xnt={bottom:[st.FAR_BOTTOM_RIGHT,st.NEAR_BOTTOM_RIGHT,st.NEAR_BOTTOM_LEFT,st.FAR_BOTTOM_LEFT],near:[st.NEAR_BOTTOM_LEFT,st.NEAR_BOTTOM_RIGHT,st.NEAR_TOP_RIGHT,st.NEAR_TOP_LEFT],far:[st.FAR_BOTTOM_RIGHT,st.FAR_BOTTOM_LEFT,st.FAR_TOP_LEFT,st.FAR_TOP_RIGHT],right:[st.NEAR_BOTTOM_RIGHT,st.FAR_BOTTOM_RIGHT,st.FAR_TOP_RIGHT,st.NEAR_TOP_RIGHT],left:[st.FAR_BOTTOM_LEFT,st.NEAR_BOTTOM_LEFT,st.NEAR_TOP_LEFT,st.FAR_TOP_LEFT],top:[st.FAR_TOP_LEFT,st.NEAR_TOP_LEFT,st.NEAR_TOP_RIGHT,st.FAR_TOP_RIGHT]},q3=6,Tnt=8,Snt=[Bt(-1,-1,-1,1),Bt(1,-1,-1,1),Bt(1,1,-1,1),Bt(-1,1,-1,1),Bt(-1,-1,1,1),Bt(1,-1,1,1),Bt(1,1,1,1),Bt(-1,1,1,1)],vAe=new my(iU),Cnt=fAe();function Ent(t,e,r){return 2*Math.atan(Math.sqrt(e*e+r*r)*Math.tan(.5*t)/e)}function Pnt(t,e,r){return 2*Math.atan(Math.sqrt(e*e+r*r)*Math.tan(.5*t)/r)}function Ant(t,e,r){return 2*Math.atan(e*Math.tan(.5*t)/Math.sqrt(e*e+r*r))}function Mnt(t,e,r){return 2*Math.atan(r*Math.tan(.5*t)/Math.sqrt(e*e+r*r))}var yX;let Qe=yX=class extends Ae{constructor(t){super(t),this._ray=Js(),this._viewport=Bt(0,0,1,1),this._padding=Bt(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=lr(1,1e3),this._viewDirty=!0,this._viewMatrix=xe(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=xe(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=xe(),this._frustumDirty=!0,this._frustum=N$(),this._fullViewport=Zt(),this._pixelRatio=1,this.row=0,this.column=0,this._rows=1,this._columns=1,this._center=C(),this._up=C(),this.relativeElevation=0}get pixelRatio(){return this._pixelRatio}set pixelRatio(t){this._pixelRatio=t>0?t:1}get rows(){return this._rows}set rows(t){this._rows=Math.max(1,t)}get columns(){return this._columns}set columns(t){this._columns=Math.max(1,t)}get eye(){return this._ray.origin}set eye(t){this._compareAndSetView(t,this._ray.origin)}get center(){return this._center}set center(t){this._compareAndSetView(t,this._center,"_center")}get ray(){return ye(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(t){this._compareAndSetView(t,this._up,"_up")}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(t){Zn(this._viewMatrix,t),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),ie(C(),-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10])}get viewUp(){return this._ensureViewClean(),ie(C(),this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9])}get viewRight(){return this._ensureViewClean(),ie(C(),this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8])}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(t){this._nearFar[0]!==t&&(this._nearFar[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get far(){return this._nearFar[1]}set far(t){this._nearFar[1]!==t&&(this._nearFar[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get viewport(){return this._viewport}set viewport(t){this.x=t[0],this.y=t[1],this.width=t[2],this.height=t[3]}get screenViewport(){if(this.pixelRatio===1)return this._viewport;const t=s2(Zt(),this._viewport,1/this.pixelRatio),e=this._get("screenViewport");return e&&o2(t,e)?e:t}get screenPadding(){if(this.pixelRatio===1)return this._padding;const t=s2(Zt(),this._padding,1/this.pixelRatio),e=this._get("screenPadding");return e&&o2(t,e)?e:t}get x(){return this._viewport[0]}set x(t){t+=this._padding[Kt.LEFT],this._viewport[0]!==t&&(this._viewport[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get y(){return this._viewport[1]}set y(t){t+=this._padding[Kt.BOTTOM],this._viewport[1]!==t&&(this._viewport[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get width(){return this._viewport[2]}set width(t){this._viewport[2]!==t&&(this._viewport[2]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get height(){return this._viewport[3]}set height(t){this._viewport[3]!==t&&(this._viewport[3]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get fullWidth(){return this._viewport[2]+this._padding[Kt.RIGHT]+this._padding[Kt.LEFT]}set fullWidth(t){this.width=t-(this._padding[Kt.RIGHT]+this._padding[Kt.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[Kt.TOP]+this._padding[Kt.BOTTOM]}set fullHeight(t){this.height=t-(this._padding[Kt.TOP]+this._padding[Kt.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[Kt.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[Kt.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get _aspect(){return this.width/this.height}get padding(){return this._padding}set padding(t){jC(this._padding,t)||(this._viewport[0]+=t[Kt.LEFT]-this._padding[Kt.LEFT],this._viewport[1]+=t[Kt.BOTTOM]-this._padding[Kt.BOTTOM],this._viewport[2]-=t[Kt.RIGHT]+t[Kt.LEFT]-(this._padding[Kt.RIGHT]+this._padding[Kt.LEFT]),this._viewport[3]-=t[Kt.TOP]+t[Kt.BOTTOM]-(this._padding[Kt.TOP]+this._padding[Kt.BOTTOM]),Kh(this._padding,t),this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_padding"),this.notifyChange("_viewport"))}get viewProjectionMatrix(){return this._viewProjectionDirty&&(Hr(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){const t=this.width,e=this.height,r=this.near*Math.tan(this.fovY/2)*2,i=r*this._aspect,n=r/this.rows,s=i/this.columns,o=-i/2+this.column*s,a=o+s,l=-r/2+this.row*n,c=l+n,u=Lxe(xe(),o*(1+2*this._padding[Kt.LEFT]/t),a*(1+2*this._padding[Kt.RIGHT]/t),l*(1+2*this._padding[Kt.BOTTOM]/e),c*(1+2*this._padding[Kt.TOP]/e),this.near,this.far),h=this._get("projectionMatrix");return h&&r9(h,u)?h:u}get inverseProjectionMatrix(){return os(xe(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||xe()}get fov(){return this._fov}set fov(t){this._fov=t,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return Ant(this._fov,this.width,this.height)}set fovX(t){this._fov=Ent(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return Mnt(this._fov,this.width,this.height)}set fovY(t){this._fov=Pnt(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return Di(this.center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(os(this._viewInverseTransposeMatrix,this.viewMatrix),Qc(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(t){const e=2*t-1;return 2*this.near*this.far/(this.far+this.near-e*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return this.relativeElevation!=null&&this.relativeElevation>=0}copyFrom(t){ce(this._ray.origin,t.eye),this.center=t.center,this.up=t.up,Kh(this._viewport,t.viewport),this.notifyChange("_viewport"),Kh(this._padding,t.padding),this.notifyChange("_padding"),eo(this._nearFar,t.nearFar),this.notifyChange("_nearFar"),this._fov=t.fov,this.row=t.row,this.column=t.column,this.rows=t.rows,this.columns=t.columns,this.relativeElevation=t.relativeElevation;const e=t;return this._viewDirty=e._viewDirty,this._viewDirty||(Zn(this._viewMatrix,t.viewMatrix),this.notifyChange("_viewMatrix")),this._viewProjectionDirty=!0,this._frustumDirty=e._frustumDirty,this._frustumDirty||(G6(this._frustum,t.frustum),this._frustumDirty=!1),e._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(Zn(this._viewInverseTransposeMatrix,t.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),Kh(this._fullViewport,t.fullViewport),this.pixelRatio=t.pixelRatio,this}copyViewFrom(t){this.eye=t.eye,this.center=t.center,this.up=t.up}clone(){return new yX().copyFrom(this)}equals(t){return zo(this.eye,t.eye)&&zo(this.center,t.center)&&zo(this.up,t.up)&&jC(this._viewport,t.viewport)&&jC(this._padding,t.padding)&&_Pe(this.nearFar,t.nearFar)&&this._fov===t.fov&&this.pixelRatio===t.pixelRatio&&this.relativeElevation===t.relativeElevation&&this.row===t.row&&this.column===t.column&&this.rows===t.rows&&this.columns===t.columns}almostEquals(t){const e=Math.max(1,1/this.pixelRatio,1/t.pixelRatio);if(Math.abs(t.fov-this._fov)>=.001||_6(t.screenPadding,this.screenPadding)>=e||_6(this.screenViewport,t.screenViewport)>=e||this.row!==t.row||this.column!==t.column||this.rows!==t.rows||this.columns!==t.columns)return!1;Yi(fa,t.eye,t.center),Yi(UV,this.eye,this.center);const r=de(fa,UV),i=i6(fa),n=i6(UV),s=5e-4;return r*r>=(1-1e-10)*i*n&&g$(t.eye,this.eye)<Math.max(i,n)*s*s}computeRenderPixelSizeAt(t){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(t))}computeRenderPixelSizeAtDist(t){return t*this.perRenderPixelRatio}computeScreenPixelSizeAt(t){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(t))}_viewDirectionDistance(t){return Math.abs(KO(this.viewForward,ye(fa,t,this.eye)))}computeScreenPixelSizeAtDist(t){return t*this.perScreenPixelRatio}computeDistanceFromRadius(t,e){return t/Math.tan(Math.min(this.fovX,this.fovY)/(2*(e||1)))}getScreenCenter(t=pn()){return t[0]=(this.padding[Kt.LEFT]+this.width/2)/this.pixelRatio,t[1]=(this.padding[Kt.TOP]+this.height/2)/this.pixelRatio,t}getRenderCenter(t,e=.5,r=.5){return t[0]=this.padding[Kt.LEFT]+this.width*e,t[1]=this.padding[Kt.BOTTOM]+this.height*r,t[2]=.5,t}setGLViewport(t){const e=this.viewport,r=this.padding;t.setViewport(e[0]-r[3],e[1]-r[2],e[2]+r[1]+r[3],e[3]+r[0]+r[2])}applyProjection(t,e){t!==Er&&ce(Er,t),Er[3]=1,jc(Er,Er,this.projectionMatrix);const r=Math.abs(Er[3]);ne(Er,Er,1/r);const i=this.fullViewport;e[0]=Rt(0,i[0]+i[2],.5+.5*Er[0]),e[1]=Rt(0,i[1]+i[3],.5+.5*Er[1]),e[2]=.5*(Er[2]+1),e[3]=r}unapplyProjection(t,e){const r=this.fullViewport;Er[0]=(t[0]/(r[0]+r[2])*2-1)*t[3],Er[1]=(t[1]/(r[1]+r[3])*2-1)*t[3],Er[2]=(2*t[2]-1)*t[3],Er[3]=t[3],this.inverseProjectionMatrix!=null&&(jc(Er,Er,this.inverseProjectionMatrix),e[0]=Er[0],e[1]=Er[1],e[2]=Er[2])}projectToScreen(t,e){return this.projectToRenderScreen(t,BV),this.renderToScreen(BV,e),e}projectToRenderScreen(t,e){if(Er[0]=t[0],Er[1]=t[1],Er[2]=t[2],Er[3]=1,jc(Er,Er,this.viewProjectionMatrix),Er[3]===0)return null;const r=Er;ne(r,r,1/Math.abs(Er[3]));const i=this.fullViewport,n=Rt(0,i[0]+i[2],.5+.5*r[0]),s=Rt(0,i[1]+i[3],.5+.5*r[1]);return"x"in e?(e.x=n,e.y=s):(e[0]=n,e[1]=s,e.length>2&&(e[2]=.5*(r[2]+1))),e}unprojectFromScreen(t,e){return this.unprojectFromRenderScreen(this.screenToRender(t,BV),e)}unprojectFromRenderScreen(t,e){if(Hr(zD,this.projectionMatrix,this.viewMatrix),!os(zD,zD))return null;const r=this.fullViewport;return Er[0]=2*(t[0]-r[0])/r[2]-1,Er[1]=2*(t[1]-r[1])/r[3]-1,Er[2]=2*t[2]-1,Er[3]=1,jc(Er,Er,zD),Er[3]===0?null:(e[0]=Er[0]/Er[3],e[1]=Er[1]/Er[3],e[2]=Er[2]/Er[3],e)}constrainWindowSize(t,e,r,i){const n=t*this.pixelRatio,s=e*this.pixelRatio,o=Math.max(n-r/2,0),a=Math.max(this.fullHeight-s-i/2,0),l=-Math.min(n-r/2,0),c=-Math.min(this.fullHeight-s-i/2,0),u=r-l- -Math.min(this.fullWidth-n-r/2,0),h=i-c- -Math.min(s-i/2,0);return[Math.round(o),Math.round(a),Math.round(u),Math.round(h)]}computeUp(t){t===De.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(t,e){const r=t[0]*this.pixelRatio,i=this.fullHeight-t[1]*this.pixelRatio;return e[0]=r,e[1]=i,e}renderToScreen(t,e){const r=t[0]/this.pixelRatio,i=(this.fullHeight-t[1])/this.pixelRatio;e[0]=r,e[1]=i}_computeUpGlobal(){ye(fa,this.center,this.eye);const t=Te(this.center);t<1?(ie(this._up,0,0,1),this._markViewDirty(),this.notifyChange("_up")):Math.abs(de(fa,this.center))>.9999*Te(fa)*t||(Je(this._up,fa,this.center),Je(this._up,this._up,fa),pe(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_computeUpLocal(){fy(fa,this.eye,this.center),Math.abs(fa[2])<=.9999&&(ne(fa,fa,fa[2]),ie(this._up,-fa[0],-fa[1],1-fa[2]),pe(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_compareAndSetView(t,e,r=""){typeof t[0]=="number"&&isFinite(t[0])&&typeof t[1]=="number"&&isFinite(t[1])&&typeof t[2]=="number"&&isFinite(t[2])?zo(t,e)||(ce(e,t),this._markViewDirty(),r.length&&this.notifyChange(r)):re.getLogger("esri.views.3d.webgl-engine.lib.Camera").warn("Camera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&(mAe(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&(t9(this._viewMatrix,this.eye,this.center,this.up),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}};d([m()],Qe.prototype,"_viewport",void 0),d([m()],Qe.prototype,"_padding",void 0),d([m()],Qe.prototype,"_fov",void 0),d([m()],Qe.prototype,"_nearFar",void 0),d([m()],Qe.prototype,"_viewDirty",void 0),d([m()],Qe.prototype,"_viewMatrix",void 0),d([m()],Qe.prototype,"_pixelRatio",void 0),d([m()],Qe.prototype,"pixelRatio",null),d([m()],Qe.prototype,"row",void 0),d([m()],Qe.prototype,"column",void 0),d([m()],Qe.prototype,"_rows",void 0),d([m()],Qe.prototype,"rows",null),d([m()],Qe.prototype,"_columns",void 0),d([m()],Qe.prototype,"columns",null),d([m()],Qe.prototype,"eye",null),d([m()],Qe.prototype,"center",null),d([m()],Qe.prototype,"_center",void 0),d([m()],Qe.prototype,"up",null),d([m()],Qe.prototype,"_up",void 0),d([m({readOnly:!0})],Qe.prototype,"viewForward",null),d([m({readOnly:!0})],Qe.prototype,"viewUp",null),d([m({readOnly:!0})],Qe.prototype,"viewRight",null),d([m({readOnly:!0})],Qe.prototype,"nearFar",null),d([m()],Qe.prototype,"near",null),d([m()],Qe.prototype,"far",null),d([m()],Qe.prototype,"viewport",null),d([m({readOnly:!0})],Qe.prototype,"screenViewport",null),d([m({readOnly:!0})],Qe.prototype,"screenPadding",null),d([m()],Qe.prototype,"x",null),d([m()],Qe.prototype,"y",null),d([m()],Qe.prototype,"width",null),d([m()],Qe.prototype,"height",null),d([m()],Qe.prototype,"fullWidth",null),d([m()],Qe.prototype,"fullHeight",null),d([m({readOnly:!0})],Qe.prototype,"_aspect",null),d([m()],Qe.prototype,"padding",null),d([m({readOnly:!0})],Qe.prototype,"projectionMatrix",null),d([m({readOnly:!0})],Qe.prototype,"inverseProjectionMatrix",null),d([m()],Qe.prototype,"fov",null),d([m()],Qe.prototype,"fovX",null),d([m()],Qe.prototype,"fovY",null),Qe=yX=d([V("esri.views.3d.webgl-engine.lib.Camera")],Qe);const Er=Zt(),zD=xe(),fa=C(),UV=C(),BV=oa();var Kt;(function(t){t[t.TOP=0]="TOP",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.LEFT=3]="LEFT"})(Kt||(Kt={}));var ue;(function(t){t[t.INTEGRATED_MESH=0]="INTEGRATED_MESH",t[t.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN",t[t.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL",t[t.OPAQUE_NO_SSAO_DEPTH=3]="OPAQUE_NO_SSAO_DEPTH",t[t.TRANSPARENT_MATERIAL=4]="TRANSPARENT_MATERIAL",t[t.TRANSPARENT_NO_SSAO_DEPTH=5]="TRANSPARENT_NO_SSAO_DEPTH",t[t.TRANSPARENT_TERRAIN=6]="TRANSPARENT_TERRAIN",t[t.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL=7]="TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL",t[t.OCCLUDED_TERRAIN=8]="OCCLUDED_TERRAIN",t[t.OCCLUDER_MATERIAL=9]="OCCLUDER_MATERIAL",t[t.TRANSPARENT_OCCLUDER_MATERIAL=10]="TRANSPARENT_OCCLUDER_MATERIAL",t[t.OCCLUSION_PIXELS=11]="OCCLUSION_PIXELS",t[t.ANTIALIASING=12]="ANTIALIASING",t[t.COMPOSITE=13]="COMPOSITE",t[t.BLIT=14]="BLIT",t[t.SSAO=15]="SSAO",t[t.HIGHLIGHT=16]="HIGHLIGHT",t[t.SHADOW_HIGHLIGHT=17]="SHADOW_HIGHLIGHT",t[t.ENVIRONMENT_OPAQUE=18]="ENVIRONMENT_OPAQUE",t[t.ENVIRONMENT_TRANSPARENT=19]="ENVIRONMENT_TRANSPARENT",t[t.LASERLINES=20]="LASERLINES",t[t.LASERLINES_CONTRAST_CONTROL=21]="LASERLINES_CONTRAST_CONTROL",t[t.HUD_MATERIAL=22]="HUD_MATERIAL",t[t.LABEL_MATERIAL=23]="LABEL_MATERIAL",t[t.LINE_CALLOUTS=24]="LINE_CALLOUTS",t[t.LINE_CALLOUTS_HUD_DEPTH=25]="LINE_CALLOUTS_HUD_DEPTH",t[t.DRAPED_MATERIAL=26]="DRAPED_MATERIAL",t[t.DRAPED_WATER=27]="DRAPED_WATER",t[t.VOXEL=28]="VOXEL",t[t.MAX_SLOTS=29]="MAX_SLOTS"})(ue||(ue={}));var ft;(function(t){t[t.Color=0]="Color",t[t.Alpha=1]="Alpha",t[t.FrontFace=2]="FrontFace",t[t.NONE=3]="NONE",t[t.COUNT=4]="COUNT"})(ft||(ft={}));let are=class{constructor(e=C()){this.intensity=e}},bAe=class{constructor(e=C(),r=Ce(.57735,.57735,.57735)){this.intensity=e,this.direction=r}},j6=class{constructor(e=C(),r=Ce(.57735,.57735,.57735),i=!0,n=1,s=1){this.intensity=e,this.direction=r,this.castShadows=i,this.specularStrength=n,this.environmentStrength=s}},wAe=class{constructor(){this.r=[0],this.g=[0],this.b=[0]}};function Ont(t,e,r){(r=r||t).length=t.length;for(let i=0;i<t.length;i++)r[i]=t[i]*e[i];return r}function VV(t,e,r){(r=r||t).length=t.length;for(let i=0;i<t.length;i++)r[i]=t[i]*e;return r}function QC(t,e,r){(r=r||t).length=t.length;for(let i=0;i<t.length;i++)r[i]=t[i]+e[i];return r}function xAe(t){return(t+1)*(t+1)}function Rnt(t){return we(Math.floor(Math.sqrt(t)-1),0,2)}function TAe(t,e,r){const i=t[0],n=t[1],s=t[2],o=r||[];return o.length=xAe(e),e>=0&&(o[0]=.28209479177),e>=1&&(o[1]=.4886025119*i,o[2]=.4886025119*s,o[3]=.4886025119*n),e>=2&&(o[4]=1.09254843059*i*n,o[5]=1.09254843059*n*s,o[6]=.31539156525*(3*s*s-1),o[7]=1.09254843059*i*s,o[8]=.54627421529*(i*i-n*n)),o}function $nt(t,e){const r=xAe(t),i=e||{r:[],g:[],b:[]};i.r.length=i.g.length=i.b.length=r;for(let n=0;n<r;n++)i.r[n]=i.g[n]=i.b[n]=0;return i}function Int(t,e){const r=Rnt(e.r.length);for(const i of t)Bo(_X,i.direction),TAe(_X,r,S0),Ont(S0,rF),VV(S0,i.intensity[0],aT),QC(e.r,aT),VV(S0,i.intensity[1],aT),QC(e.g,aT),VV(S0,i.intensity[2],aT),QC(e.b,aT);return e}function Lnt(t,e){TAe(_X,0,S0);for(const r of t)e.r[0]+=S0[0]*rF[0]*r.intensity[0]*4*Math.PI,e.g[0]+=S0[0]*rF[0]*r.intensity[1]*4*Math.PI,e.b[0]+=S0[0]*rF[0]*r.intensity[2]*4*Math.PI;return e}function Dnt(t,e,r,i){$nt(e,i),ie(r.intensity,0,0,0);let n=!1;const s=Nnt,o=Fnt,a=knt;s.length=0,o.length=0,a.length=0;for(const l of t)l instanceof j6&&!n?(ce(r.direction,l.direction),ce(r.intensity,l.intensity),r.specularStrength=l.specularStrength,r.environmentStrength=l.environmentStrength,r.castShadows=l.castShadows,n=!0):l instanceof j6||l instanceof bAe?s.push(l):l instanceof are?o.push(l):l instanceof wAe&&a.push(l);Int(s,i),Lnt(o,i);for(const l of a)QC(i.r,l.r),QC(i.g,l.g),QC(i.b,l.b)}const Nnt=[],Fnt=[],knt=[],S0=[0],aT=[0],_X=C(),rF=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];let Due=class{constructor(){this.color=C(),this.intensity=1}},znt=class{constructor(){this.direction=C(),this.ambient=new Due,this.diffuse=new Due}};const SAe=.4;let GV=class{constructor(){this._shOrder=2,this._legacy=new znt,this.globalFactor=.5,this.noonFactor=.5,this._sphericalHarmonics=new wAe,this._mainLight=new j6(C(),Ce(1,0,0),!1)}get legacy(){return this._legacy}get sh(){return this._sphericalHarmonics}get mainLight(){return this._mainLight}set(e){Dnt(e,this._shOrder,this._mainLight,this._sphericalHarmonics),ce(this._legacy.direction,this._mainLight.direction);const r=1/Math.PI;this._legacy.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*r,this._legacy.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*r,this._legacy.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*r,ne(this._legacy.diffuse.color,this._mainLight.intensity,r),ce(UD,this._legacy.diffuse.color),ne(UD,UD,SAe*this.globalFactor),fe(this._legacy.ambient.color,this._legacy.ambient.color,UD)}copyFrom(e){this._sphericalHarmonics.r=Array.from(e.sh.r),this._sphericalHarmonics.g=Array.from(e.sh.g),this._sphericalHarmonics.b=Array.from(e.sh.b),ce(this._mainLight.direction,e.mainLight.direction),ce(this._mainLight.intensity,e.mainLight.intensity),this._mainLight.castShadows=e.mainLight.castShadows,this._mainLight.specularStrength=e.mainLight.specularStrength,this._mainLight.environmentStrength=e.mainLight.environmentStrength,this.globalFactor=e.globalFactor,this.noonFactor=e.noonFactor}lerpLighting(e,r,i){if(ni(this._mainLight.intensity,e.mainLight.intensity,r.mainLight.intensity,i),this._mainLight.environmentStrength=Rt(e.mainLight.environmentStrength,r.mainLight.environmentStrength,i),this._mainLight.specularStrength=Rt(e.mainLight.specularStrength,r.mainLight.specularStrength,i),ce(this._mainLight.direction,r.mainLight.direction),this._mainLight.castShadows=r.mainLight.castShadows,this.globalFactor=Rt(e.globalFactor,r.globalFactor,i),this.noonFactor=Rt(e.noonFactor,r.noonFactor,i),e.sh.r.length===r.sh.r.length)for(let n=0;n<r.sh.r.length;n++)this._sphericalHarmonics.r[n]=Rt(e.sh.r[n],r.sh.r[n],i),this._sphericalHarmonics.g[n]=Rt(e.sh.g[n],r.sh.g[n],i),this._sphericalHarmonics.b[n]=Rt(e.sh.b[n],r.sh.b[n],i);else for(let n=0;n<r.sh.r.length;n++)this._sphericalHarmonics.r[n]=r.sh.r[n],this._sphericalHarmonics.g[n]=r.sh.g[n],this._sphericalHarmonics.b[n]=r.sh.b[n]}};const UD=C();let nU=class{constructor(e,r){this.shadowMap=e,this.slicePlane=r,this.slot=ue.OPAQUE_MATERIAL,this.hasOccludees=!1,this.enableFillLights=!0,this.transparencyPassType=ft.NONE,this.alignPixelEnabled=!1,this.decorations=Xl.ON,this.overlayStretch=1,this._camera=new Qe,this._inverseViewport=He(),this.oldLighting=new GV,this.newLighting=new GV,this._fadedLighting=new GV,this._lighting=this.newLighting,this.ssr=new Unt,this.multipassEnabled=!1,this.multipassTerrain=new ynt,this.multipassGeometry=new gnt,this.hudRenderStyle=Ec.Occluded,this.cloudsFade=new jit}get camera(){return this._camera}set camera(e){this._camera=e,this._inverseViewport[0]=1/e.fullViewport[2],this._inverseViewport[1]=1/e.fullViewport[3]}get inverseViewport(){return this._inverseViewport}get lighting(){return this._lighting}get weatherFading(){return this._lighting===this._fadedLighting}fadeLighting(e){const{oldLighting:r,newLighting:i}=this;e>=1?this._lighting=i:(this._fadedLighting.lerpLighting(r,i,e),this._lighting=this._fadedLighting)}},Unt=class{constructor(){this.fadeFactor=1,this.reprojectionMatrix=xe()}};const Ho=Symbol("Yield");let Bnt=class{constructor(){this._tasks=new Array,this._runningTasks=Wm(0)}get length(){return this._tasks.length}get running(){return this._runningTasks.value>0}destroy(){this.cancelAll()}runTask(e){if(this.length===0)return Ho;for(;!e.done&&this._process(e);)e.madeProgress()}push(e,r,i){return++this._runningTasks.value,new Promise((n,s)=>this._tasks.push(new Nue(n,s,e,r,i))).finally(()=>--this._runningTasks.value)}unshift(e,r,i){return++this._runningTasks.value,new Promise((n,s)=>this._tasks.unshift(new Nue(n,s,e,r,i))).finally(()=>--this._runningTasks.value)}_process(e){var i;if(this._tasks.length===0)return!1;const r=this._tasks.shift();try{const n=Ls(r.signal);if(n&&!r.abortCallback)r.reject(dr());else{const s=n?(i=r.abortCallback)==null?void 0:i.call(r,dr()):r.callback(e);nu(s)?s.then(r.resolve,r.reject):r.resolve(s)}}catch(n){r.reject(n)}return!0}cancelAll(){const e=dr();for(const r of this._tasks)if(r.abortCallback){const i=r.abortCallback(e);r.resolve(i)}else r.reject(e);this._tasks.length=0}},Nue=class{constructor(e,r,i,n=void 0,s=void 0){this.resolve=e,this.reject=r,this.callback=i,this.signal=n,this.abortCallback=s}},OM=class extends Ae{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};d([m()],OM.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),d([m()],OM.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),OM=d([V("esri.views.support.DebugFlags")],OM);const Vnt=new OM;function Gnt(){return new H6.Scheduler}var bt;(function(t){t.RESOURCE_CONTROLLER_IMMEDIATE="immediate",t.RESOURCE_CONTROLLER="schedule",t.SLIDE="slide",t.STREAM_DATA_LOADER="stream loader",t.ELEVATION_QUERY="elevation query",t.TERRAIN_SURFACE="terrain",t.SURFACE_GEOMETRY_UPDATES="surface geometry updates",t.LOD_RENDERER="LoD renderer",t.GRAPHICS_CORE="Graphics3D",t.I3S_CONTROLLER="I3S",t.POINT_CLOUD_LAYER="point cloud",t.FEATURE_TILE_FETCHER="feature fetcher",t.OVERLAY="overlay",t.STAGE="stage",t.GRAPHICS_DECONFLICTOR="graphics deconflictor",t.FILTER_VISIBILITY="Graphics3D filter visibility",t.SCALE_VISIBILITY="Graphics3D scale visibility",t.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",t.POINT_OF_INTEREST_FREQUENT="POI frequent",t.POINT_OF_INTEREST_INFREQUENT="POI infrequent",t.LABELER="labeler",t.FEATURE_QUERY_ENGINE="feature query",t.FEATURE_TILE_TREE="feature tile tree",t.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",t.ELEVATION_ALIGNMENT="elevation alignment",t.ELEVATION_ALIGNMENT_SCENE="elevation alignment scene",t.TEXT_TEXTURE_ATLAS="text texture atlas",t.TEXTURE_UNLOAD="texture unload",t.LINE_OF_SIGHT_TOOL="line of sight tool",t.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",t.ELEVATION_PROFILE="elevation profile",t.SNAPPING="snapping",t.SHADOW_ACCUMULATOR="shadow accumulator",t.CLOUDS_GENERATOR="clouds generator",t[t.NONE=0]="NONE",t[t.TEST_PRIO=1]="TEST_PRIO"})(bt||(bt={}));const bm=0,Fue=new Map([[bt.RESOURCE_CONTROLLER_IMMEDIATE,bm],[bt.RESOURCE_CONTROLLER,4],[bt.SLIDE,bm],[bt.STREAM_DATA_LOADER,bm],[bt.ELEVATION_QUERY,bm],[bt.TERRAIN_SURFACE,1],[bt.SURFACE_GEOMETRY_UPDATES,1],[bt.LOD_RENDERER,2],[bt.GRAPHICS_CORE,2],[bt.I3S_CONTROLLER,2],[bt.POINT_CLOUD_LAYER,2],[bt.FEATURE_TILE_FETCHER,2],[bt.OVERLAY,4],[bt.STAGE,4],[bt.GRAPHICS_DECONFLICTOR,4],[bt.FILTER_VISIBILITY,4],[bt.SCALE_VISIBILITY,4],[bt.FRUSTUM_VISIBILITY,4],[bt.CLOUDS_GENERATOR,4],[bt.POINT_OF_INTEREST_FREQUENT,6],[bt.POINT_OF_INTEREST_INFREQUENT,30],[bt.LABELER,8],[bt.FEATURE_QUERY_ENGINE,8],[bt.FEATURE_TILE_TREE,16],[bt.FEATURE_TILE_TREE_ACTIVE,bm],[bt.ELEVATION_ALIGNMENT,12],[bt.ELEVATION_ALIGNMENT_SCENE,14],[bt.TEXT_TEXTURE_ATLAS,12],[bt.TEXTURE_UNLOAD,12],[bt.LINE_OF_SIGHT_TOOL,16],[bt.LINE_OF_SIGHT_TOOL_INTERACTIVE,bm],[bt.SNAPPING,bm],[bt.SHADOW_ACCUMULATOR,30]]);function kue(t){return Fue.has(t)?Fue.get(t):typeof t=="number"?t:1}const zue=6.5,Uue=1,jnt=30,Bue=1e3/30,Vue=100,Gue=.9;var H6,ib;(function(t){class e{get updating(){return this._updating.value}_updatingChanged(){this._updating.value=this._tasks.some(s=>s.needsUpdate)}constructor(){this._updating=Wm(!0),this._microTaskQueued=!1,this._frameNumber=0,this.performanceInfo={total:new A0("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new i,this._state=Ur.INTERACTING,this._tasks=new Vt,this._runQueue=new Vt,this._load=0,this._idleStateCallbacks=new Vt,this._idleUpdatesStartFired=!1,this._forceTask=!1,this._debug=!1,this._debugHandle=he(()=>Vnt.SCHEDULER_LOG_SLOW_TASKS,o=>this._debug=o,gi);for(const o of Object.keys(bt))this.performanceInfo.tasks.set(bt[o],new A0(bt[o]));const s=this;this._test={FRAME_SAFETY_BUDGET:zue,INTERACTING_BUDGET:Bue,IDLE_BUDGET:Vue,get availableBudget(){return s._budget.budget},usedBudget:0,getBudget:()=>s._budget,setBudget:o=>s._budget=o,updateTask:o=>this._updateTask(o),getState:o=>this._getState(o),getRuntime:o=>this._getRuntime(o),frameTaskTimes:this._frameTaskTimes,resetRuntimes:()=>this._resetRuntimes(),getRunning:()=>this._getRunning()}}destroy(){this._tasks.toArray().forEach(s=>s.remove()),this._tasks.clear(),wi(this._debugHandle),this._microTaskQueued=!1,this._updatingChanged()}taskRunningChanged(s){this._updatingChanged(),s&&this._budget.remaining>0&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask(()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.remaining>0&&this._schedule()&&this.frame())}))}registerTask(s,o){const a=new r(this,s,o);return this._tasks.push(a),this._updatingChanged(),this.performanceInfo.tasks.has(s)||this.performanceInfo.tasks.set(s,new A0(s)),a}registerIdleStateCallbacks(s,o){const a={idleBegin:s,idleEnd:o};this._idleStateCallbacks.push(a),this.state===Ur.IDLE&&this._idleUpdatesStartFired&&a.idleBegin();const l=this;return{remove:()=>this._removeIdleStateCallbacks(a),set idleBegin(c){l._idleUpdatesStartFired&&(a.idleEnd(),l._state===Ur.IDLE&&c()),a.idleBegin=c},set idleEnd(c){a.idleEnd=c}}}get load(){return this._load}set state(s){this._state!==s&&(this._state=s,this.state!==Ur.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll(o=>o.idleEnd())))}get state(){return this._state}updateBudget(s){this._test.usedBudget=0,++this._frameNumber;let o=zue,a=s.frameDuration,l=Uue;switch(this.state){case Ur.IDLE:o=0,a=Math.max(Vue,s.frameDuration),l=jnt;break;case Ur.INTERACTING:a=Math.max(Bue,s.frameDuration);case Ur.ANIMATING:}return a=a-s.elapsedFrameTime-o,this.state!==Ur.IDLE&&a<Uue&&!this._forceTask?(this._forceTask=!0,!1):(a=Math.max(a,l),this._budget.reset(a,this.state),this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case Ur.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll(s=>s.idleBegin())),this._runIdle();break;case Ur.INTERACTING:this._runInteracting();break;default:this._runAnimating()}this._test.usedBudget=this._budget.elapsed}stopFrame(){this._budget.reset(0,this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(s){this._idleUpdatesStartFired&&s.idleEnd(),this._idleStateCallbacks.removeUnordered(s)}removeTask(s){this._tasks.removeUnordered(s),this._runQueue.removeUnordered(s),this._updatingChanged()}_updateTask(s){this._tasks.forAll(o=>{o.name===s&&o.setPriority(s)})}_getState(s){if(this._runQueue.some(a=>a.name===s))return ib.SCHEDULED;let o=ib.IDLE;return this._tasks.forAll(a=>{a.name===s&&a.needsUpdate&&(a.schedulePriority<=1?o=ib.READY:o!==ib.READY&&(o=ib.WAITING))}),o}_getRuntime(s){let o=0;return this._tasks.forAll(a=>{a.name===s&&(o+=a.runtime)}),o}_resetRuntimes(){this._tasks.forAll(s=>s.runtime=0)}_getRunning(){const s=new Map;if(this._tasks.forAll(a=>{a.needsUpdate&&s.set(a.name,(s.get(a.name)||0)+1)}),s.size===0)return null;let o="";return s.forEach((a,l)=>{o+=a>1?` ${a}x ${l}`:` ${l}`}),o}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const s=this._tasks.reduce((o,a)=>a.needsUpdate?++o:o,0);this._load=this._load*Gue+s*(1-Gue)}_schedule(){for(this._runQueue.filterInPlace(s=>!!s.needsUpdate||(s.schedulePriority=s.basePriority,!1)),this._tasks.forAll(s=>{s.basePriority===bm&&s.needsUpdate&&!this._runQueue.includes(s)&&s.blockFrame!==this._frameNumber&&this._runQueue.unshift(s)});this._runQueue.length===0;){let s=!1,o=0;if(this._tasks.forAll(a=>{a.needsUpdate&&a.schedulePriority!==0&&a.basePriority!==bm&&a.blockFrame!==this._frameNumber&&(s=!0,o=Math.max(o,a.basePriority),a.schedulePriority===1?(a.schedulePriority=0,this._runQueue.push(a)):--a.schedulePriority)}),!s)return this._updatingChanged(),!1}return this._updatingChanged(),!0}_run(){const s=this._budget.now();this._startFrameTaskTimes();do for(;this._runQueue.length>0;){const o=this._budget.now(),a=this._runQueue.pop();this._budget.resetProgress();try{a.task.runTask(this._budget)===Ho&&(a.blockFrame=this._frameNumber)}catch(c){re.getLogger("esri.views.support.Scheduler").error(`Exception in task "${a.name}"`,c),a.blockFrame=this._frameNumber}!this._budget.hasProgressed&&a.blockFrame!==this._frameNumber&&a.needsUpdate&&(a.name,bt.I3S_CONTROLLER,a.blockFrame=this._frameNumber),a.schedulePriority=a.basePriority;const l=this._budget.now()-o;if(a.runtime+=l,this._frameTaskTimes.set(a.priority,this._frameTaskTimes.get(a.priority)+l),this._debug&&l>2*this._budget.budget&&console.log("Task",a.name,"used",l,"of max",this._budget.budget,"ms"),this._budget.remaining<=0)return this._updatingChanged(),void this._recordFrameTaskTimes(this._budget.now()-s)}while(this._schedule());this._updatingChanged(),this._recordFrameTaskTimes(this._budget.now()-s)}_startFrameTaskTimes(){for(const s of Object.keys(bt))this._frameTaskTimes.set(bt[s],0)}_recordFrameTaskTimes(s){this._frameTaskTimes.forEach((o,a)=>this.performanceInfo.tasks.get(a).record(o)),this.performanceInfo.total.record(s)}get test(){return this._test}}t.Scheduler=e;class r{get task(){return this._task.value}get updating(){return this._queue.running}constructor(s,o,a){this._scheduler=s,this.name=o,this.blockFrame=0,this.runtime=0,this._queue=new Bnt,this._handles=new $v,this._basePriority=kue(o),this.schedulePriority=this._basePriority,this._task=Wm(a??this._queue),this._handles.add(fd(()=>this.task.running,l=>s.taskRunningChanged(l)))}remove(){this.processQueue(yl),this._scheduler.removeTask(this),this.schedule=s3.schedule,this.reschedule=s3.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(s){if(this.name===s)return;this.name=s;const o=kue(s);this._basePriority!==bm&&this.schedulePriority===0||(this.schedulePriority=o),this._basePriority=o}get priority(){return this.name}set priority(s){this.setPriority(s)}get needsUpdate(){return this.updating||this.task.running}schedule(s,o,a){return this._queue.push(s,o,a)}reschedule(s,o,a){return this._queue.unshift(s,o,a)}processQueue(s){return this._queue.runTask(s)}}class i{constructor(){this._begin=typeof performance<"u"?performance.now():0,this._budget=0,this._state=Ur.IDLE,this._done=!1,this._progressed=!1,this._enabled=!0}run(s){return!this.done&&(s()===!0&&this.madeProgress(),!0)}get done(){return this._done}get budget(){return this._budget}madeProgress(){return this._progressed=!0,this._done=this.elapsed>=this._budget&&this._enabled,this._done}get state(){return this._state}get enabled(){return this._enabled}set enabled(s){this._enabled=s}reset(s,o){this._begin=this.now(),this._budget=s,this._state=o,this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return performance.now()-this._begin}resetProgress(){this._progressed=!1,this._done=!1}get hasProgressed(){return this._progressed}}t.Budget=i})(H6||(H6={})),function(t){t.SCHEDULED="s",t.READY="r",t.WAITING="w",t.IDLE="i"}(ib||(ib={}));const yl=(()=>{const t=new H6.Budget;return t.enabled=!1,t})();let Hnt=class{remove(){}processQueue(){}schedule(e,r,i){try{if(Ls(r)){const n=dr();return i?Promise.resolve(i(n)):Promise.reject(n)}return XH(e(yl))}catch(n){return Promise.reject(n)}}reschedule(e,r,i){return this.schedule(e,r,i)}};const s3=new Hnt;let zl=class extends Ae{constructor(e){super(e),this._techniques=new Array,this._techniqueConfiguration=new eF,this._bindParameters=new nU(null,null),this._passParameters=new sre,this._weatherTile=He(),this._weatherTileCount=128,this._faceIndex=0,this._tileIndex=0,this.coverage=Rt(va.default.coverage[0],va.default.coverage[1],.5),this.density=Rt(va.default.density[0],va.default.density[1],.5),this.absorption=Rt(va.default.absorption[0],va.default.absorption[1],.5),this.cloudSize=Rt(va.default.cloudSize[0],va.default.cloudSize[1],.5),this.detailSize=Rt(va.default.detailSize[0],va.default.detailSize[1],.5),this.smoothness=Rt(va.default.smoothness[0],va.default.smoothness[1],.5),this.cloudHeight=Rt(va.default.cloudHeight[0],va.default.cloudHeight[1],.5),this.raymarchingSteps=va.default.raymarchingSteps,this._viewMatrix=xe(),this._dirty=!1,this.running=!1,this._vao=wg(e.context.renderContext.rctx)}_getTechnique(e){const r=1-this.context.renderContext.bindParameters.cloudsFade.readChannels,i=r===p2.RG?2*e:2*e+1;return this._techniques[i]||(this._techniqueConfiguration.writeTextureChannels=r,this._techniqueConfiguration.steps=e,this._techniques[i]=new oAe({rctx:this.context.renderContext.rctx,viewingMode:this.view.state.viewingMode},this._techniqueConfiguration),this._techniques[i])}updateWeatherTile(){const e=this.view.camera.position.latitude,r=this.view.camera.position.longitude;if(e==null||r==null)return;cr(this._weatherTile,(e+90)/180,(r+180)/360);const i=Math.floor(this._weatherTileCount*Math.abs(2*this._weatherTile[0]-1));this._weatherTile[0]=Math.floor(2*this._weatherTileCount*this._weatherTile[0]),this._weatherTile[1]=Math.floor(4*(this._weatherTileCount-i)*this._weatherTile[1]);let n=0,s=0;if(this.view.environment!=null&&this.view.environment.lighting.type!=="virtual"&&this.view.environment.lighting.date!=null){const o=new Date(this.view.environment.lighting.date);o.setUTCHours(this.view.environment.lighting.date.getUTCHours()+(this.view.environment.lighting.displayUTCOffset??0)),n=31*o.getUTCMonth()+o.getUTCDate(),s=o.getUTCFullYear()}this._weatherTile[0]=(this._weatherTile[0]+n)%(2*this._weatherTileCount),this._weatherTile[1]=(this._weatherTile[1]+s%100)%(4*this._weatherTileCount),vPe(this._passParameters.weatherTile,this._weatherTile)||this.setDirty()}initialize(){const e=Br(this.view.spatialReference);this._passParameters.cloudRadius=.5*e.radius,this.setDirty(),this.updateWeatherTile(),this.addHandles([this.view.resourceController.scheduler.registerTask(bt.CLOUDS_GENERATOR,this),he(()=>[this.coverage,this.density,this.absorption,this.cloudSize,this.detailSize,this.smoothness,this.cloudHeight,this.raymarchingSteps],()=>this.setDirty(),gi)])}destroy(){this._techniques.forEach(e=>tr(e)),this._frameBufferCube=gt(this._frameBufferCube),this._techniques.length=0,this._vao.dispose(),this._passParameters.noiseTexture=Pe(this._passParameters.noiseTexture)}get _tilesPerFace(){switch(this._techniqueConfiguration.steps){case Ql.SIXTEEN:return 1;case Ql.HUNDRED:return 4;case Ql.COUNT:case Ql.TWOHUNDRED:return 8}}get usedMemory(){var e,r,i;return(((e=this._frameBufferCube)==null?void 0:e.usedMemory)??0)+(((i=(r=this._passParameters.noiseTexture)==null?void 0:r.textureAtlas)==null?void 0:i.usedMemory)??0)}_ensureNoiseTexture(){if(this._passParameters.noiseTexture!=null)this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile);else{const e=this.context;this._passParameters.noiseTexture=new MM({context:e}),this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile)}return this._passParameters.noiseTexture.textureAtlas!=null}_ensureFrameBufferCube(e){if(this._frameBufferCube==null){const r=new ri(e);r.target=Sn.TEXTURE_CUBE_MAP,r.wrapMode=Jt.CLAMP_TO_EDGE,this._frameBufferCube=new bf(this.context.renderContext.rctx,r)}return this._frameBufferCube}get cubeMap(){return this._frameBufferCube}destroyFrameBufferCube(){this._frameBufferCube=gt(this._frameBufferCube)}applyPreset(e,r){const i=e.median,n=s=>{const o=Rt(s[0],s[1],i);return r<.5?Rt(s[0],o,2*r):Rt(o,s[1],2*(r-.5))};this.coverage=n(e.coverage),this.density=n(e.density),this.absorption=n(e.absorption),this.cloudSize=n(e.cloudSize),this.detailSize=n(e.detailSize),this.smoothness=n(e.smoothness),this.cloudHeight=n(e.cloudHeight),this.raymarchingSteps=e.raymarchingSteps}setDirty(){this._dirty=this.running=!0}runTask(e){this._faceIndex===0&&this._tileIndex===0&&(this._passParameters.raymarchingSteps=this.raymarchingSteps,this.updateWeatherTile(),eo(this._passParameters.weatherTile,this._weatherTile));const r=this._getTechnique(this._passParameters.raymarchingSteps);if(!r.compiled||this.context.renderContext.bindParameters.cloudsFade.fadeMode===$i.CROSS_FADE||!this._ensureNoiseTexture())return Ho;this._faceIndex===0&&this._tileIndex===0&&(this.context.renderContext.bindParameters.cloudsFade.renderingStage=Dm.RENDERING,this._passParameters.absorption=this.absorption,this._passParameters.density=this.density,this._passParameters.cloudSize=this.cloudSize,this._passParameters.detailSize=this.detailSize,this._passParameters.smoothness=this.smoothness,this._passParameters.cloudHeight=this.cloudHeight,this._passParameters.coverage=this.coverage,this._dirty=!1);const i=Wnt[this._faceIndex],n=qnt[this._faceIndex];Nxe(this._viewMatrix,Ynt,i,n),th(this._passParameters.viewMatrix,this._viewMatrix);const s=this.context.renderContext.rctx,o=s.bindTechnique(r,this._bindParameters,this._passParameters);s.bindVAO(this._vao),o.assertCompatibleVertexAttributeLocations(this._vao);const a=s.getViewport(),l=r.configuration.cubeMapSize,c=l/this._tilesPerFace,u=this._tileIndex*c;s.setViewport(0,u,l,c);const h=this._ensureFrameBufferCube(l);s.bindFramebuffer(h);const p=Sn.TEXTURE_CUBE_MAP_POSITIVE_X+this._faceIndex;return h.setColorTextureTarget(p),s.gl.drawArrays(s.gl.TRIANGLE_STRIP,0,4),s.gl.flush(),s.setViewport(a.x,a.y,a.width,a.height),this.requestRender(),++this._tileIndex,this._faceIndex===4&&this._tileIndex===this._tilesPerFace?(this.running=this._dirty,this._faceIndex=0,this._tileIndex=0,this.running||(this.context.renderContext.bindParameters.cloudsFade.renderingStage=Dm.FADING)):this._tileIndex===this._tilesPerFace&&(++this._faceIndex,this._tileIndex=0),e.madeProgress(),Ho}};d([m({constructOnly:!0})],zl.prototype,"context",void 0),d([m({constructOnly:!0})],zl.prototype,"view",void 0),d([m({constructOnly:!0})],zl.prototype,"requestRender",void 0),d([m()],zl.prototype,"coverage",void 0),d([m()],zl.prototype,"density",void 0),d([m()],zl.prototype,"absorption",void 0),d([m()],zl.prototype,"cloudSize",void 0),d([m()],zl.prototype,"detailSize",void 0),d([m()],zl.prototype,"smoothness",void 0),d([m()],zl.prototype,"cloudHeight",void 0),d([m()],zl.prototype,"raymarchingSteps",void 0),d([m()],zl.prototype,"running",void 0),zl=d([V("esri.views.3d.environment.CloudsGenerator")],zl);const Wnt=[pi(1,0,0),pi(-1,0,0),pi(0,1,0),pi(0,-1,0),pi(0,0,1)],qnt=[pi(0,1,0),pi(0,1,0),pi(0,0,-1),pi(0,0,1),pi(0,1,0)],Ynt=nre();let lre=class extends Ai{constructor(){super(...arguments),this.fogColor=C(),this.fogStrength=4e-6,this.atmosphereC=1,this.fogAmount=0}};function CAe(){const t=new Or;t.attributes.add(R.POSITION,"vec2"),t.include(qm,{textureCoordinateType:on.Default}),t.varyings.add("worldRay","vec3"),t.varyings.add("eyeDir","vec3");const{vertex:e,fragment:r}=t;return e.uniforms.add(new ln("inverseProjectionMatrix",(i,n)=>n.camera.inverseProjectionMatrix),new ln("inverseViewMatrix",(i,n)=>R3(Xnt,n.camera.viewMatrix))),e.code.add(T`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),r.uniforms.add(new $e("atmosphereC",i=>i.atmosphereC),new Ft("cameraPosition",(i,n)=>n.camera.eye),new ti("nearFar",(i,n)=>n.camera.nearFar),new ct("depthTexture",i=>i.depthTexture),new $e("fogStrength",i=>i.fogStrength),new $e("fogAmount",i=>i.fogAmount),new Ft("fogColor",i=>i.fogColor)),t.include(tU),r.include(cg),r.code.add(T`vec2 sphereIntersect(vec3 start, vec3 dir) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float d = (b * b) - 4.0 * a * atmosphereC;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),r.code.add(T`vec4 applyFog(float dist, vec3 rayDir){
if(dist == -1.0){
vec2 rayAtmosphereIntersect = sphereIntersect(cameraPosition, rayDir);
dist = 0.055 * rayAtmosphereIntersect.y;
}
float fogAmount = fogAmount * (1.0 - exp(-dist * fogStrength));
return vec4(fogAmount * fogColor, fogAmount);
}`),r.code.add(T`vec3 tonemapACES(vec3 x) {
return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
}
void main() {
vec3 rayDir = normalize(worldRay);
float terrainDepth = -1.0;
float depthSample = texture(depthTexture, vuv0).r;
float zNorm = 2.0 * depthSample - 1.0;
float linDepth = 2.0 * nearFar[0] * nearFar[1] / (nearFar[1] + nearFar[0] - zNorm * (nearFar[1] - nearFar[0]));
if(depthSample < 1.0 && depthSample > 0.0){
vec3 cameraSpaceRay = normalize(eyeDir);
cameraSpaceRay /= cameraSpaceRay.z;
cameraSpaceRay *= linDepth;
terrainDepth = max(0.0, length(cameraSpaceRay));
}
vec4 fog = applyFog(terrainDepth, rayDir);
fragColor = delinearizeGamma(vec4(tonemapACES(fog.rgb), fog.a));
}`),t}const Xnt=xe(),Znt=Object.freeze(Object.defineProperty({__proto__:null,FogPassParameters:lre,build:CAe},Symbol.toStringTag,{value:"Module"}));let EAe=class PAe extends Vr{constructor(e){super(e,new cc,()=>this.destroy())}initializeProgram(e){return new Lr(e.rctx,PAe.shader.get().build(),Mr)}initializePipeline(){return kt({blending:Wo(Se.SRC_ALPHA,Se.ZERO,Se.ONE_MINUS_SRC_ALPHA,Se.ONE),colorWrite:Yt})}};EAe.shader=new Ir(Znt,()=>ge(()=>Promise.resolve().then(()=>kNt),void 0));const Jnt=.95,Qnt=1;let mw=class extends Ae{constructor(e){super(e),this._passParameters=new lre;const r=e.context.renderContext.rctx;this._vao=wg(r,GI),this._technique=new EAe(e);const i=Br(e.view.spatialReference);this._planetRadius=i.radius,this._atmosphereRadius=i.radius+e1}destroy(){this._technique.release(),this._vao.dispose()}set strength(e){this._passParameters.fogStrength=e}get strength(){return this._passParameters.fogStrength}render(e,r){if(this._update(e,r),this._passParameters.fogAmount<=0)return;const i=this._technique;if(!i.compiled)return void this.context.requestRender();const n=e.offscreenRenderingHelper;n.renderDepthDetached(()=>{this._passParameters.depthTexture=n.depthTexture;const s=e.rctx.bindTechnique(i,e.bindParameters,this._passParameters);this._renderFog(s,e)})}_renderFog(e,r){const i=r.rctx;i.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),i.drawArrays(sr.TRIANGLE_STRIP,0,4)}_update(e,r){const i=e.bindParameters.camera;pe(jue,i.eye);const n=Math.max(0,de(jue,e.bindParameters.lighting.mainLight.direction)),s=r.color;ne(Hue,s,.1),ni(this._passParameters.fogColor,Hue,s,n);const o=Te(i.eye),a=o*o;this._passParameters.atmosphereC=a-this._atmosphereRadius*this._atmosphereRadius,this._passParameters.fogAmount=(1-_$(Jnt*b0,Qnt*b0,Math.abs(o-this._planetRadius)))*r.amount,this._passParameters.fogStrength=r.strength}static isSupported(e){return e.capabilities.depthTexture}};d([m({constructOnly:!0})],mw.prototype,"context",void 0),d([m({constructOnly:!0})],mw.prototype,"view",void 0),d([m({constructOnly:!0})],mw.prototype,"rctx",void 0),d([m({constructOnly:!0})],mw.prototype,"viewingMode",void 0),mw=d([V("esri.views.3d.environment.Fog")],mw);let Knt=class{constructor(){this.color=C(),this.strength=0,this.amount=0}};const jue=C(),Hue=C();var U;function est(t){return KC(t)||t===U.Depth||t===U.LinearDepth||t===U.Normal||t===U.ObjectAndLayerIdColor}function KC(t){return t===U.Shadow||t===U.ShadowHighlight||t===U.ShadowExcludeHighlight}function oR(t){return vX(t)||t===U.Normal}function $x(t){return t===U.Highlight||t===U.ObjectAndLayerIdColor}function AAe(t){return t===U.Color||$x(t)}function z0(t){return t===U.Color||t===U.Alpha}function jV(t){return z0(t)||t===U.ObjectAndLayerIdColor}function tst(t){return z0(t)||t===U.Highlight}function Wue(t){return tst(t)||t===U.LinearDepth}function iF(t){return z0(t)||$x(t)}function vX(t){return iF(t)||t===U.LinearDepth}(function(t){t[t.Color=0]="Color",t[t.LinearDepth=1]="LinearDepth",t[t.Depth=2]="Depth",t[t.Normal=3]="Normal",t[t.Shadow=4]="Shadow",t[t.ShadowHighlight=5]="ShadowHighlight",t[t.ShadowExcludeHighlight=6]="ShadowExcludeHighlight",t[t.Highlight=7]="Highlight",t[t.Alpha=8]="Alpha",t[t.ObjectAndLayerIdColor=9]="ObjectAndLayerIdColor",t[t.CompositeColor=10]="CompositeColor",t[t.COUNT=11]="COUNT"})(U||(U={}));function cre({code:t},e){e.doublePrecisionRequiresObfuscation?t.add(T`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):t.add(T`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)}let MAe=class extends vn{constructor(e,r){super(e,"mat4",Rr.Draw,(i,n,s)=>i.setUniformMatrix4fv(e,r(n,s)))}};function cf(t,e){e.instancedDoublePrecision?t.constants.add("cameraPosition","vec3",zn):t.uniforms.add(new Xu("cameraPosition",(r,i)=>ie(OAe,i.camera.viewInverseTransposeMatrix[3]-r.origin[0],i.camera.viewInverseTransposeMatrix[7]-r.origin[1],i.camera.viewInverseTransposeMatrix[11]-r.origin[2])))}function Zc(t,e){if(!e.instancedDoublePrecision)return void t.uniforms.add(new ln("proj",(i,n)=>n.camera.projectionMatrix),new MAe("view",(i,n)=>ic(que,n.camera.viewMatrix,i.origin)),new Xu("localOrigin",i=>i.origin));const r=i=>ie(OAe,i.camera.viewInverseTransposeMatrix[3],i.camera.viewInverseTransposeMatrix[7],i.camera.viewInverseTransposeMatrix[11]);t.uniforms.add(new ln("proj",(i,n)=>n.camera.projectionMatrix),new ln("view",(i,n)=>ic(que,n.camera.viewMatrix,r(n))),new Ft("localOrigin",(i,n)=>r(n)))}const que=xe(),OAe=C();function o3(t){t.uniforms.add(new ln("viewNormal",(e,r)=>r.camera.viewInverseTransposeMatrix))}function Y3(t){t.uniforms.add(new $e("pixelRatio",(e,r)=>r.camera.pixelRatio/r.overlayStretch))}function bX(t,e,r){for(let i=0;i<r;++i)e[2*i]=t[i],e[2*i+1]=t[i]-e[2*i]}function rst(t,e){const r=t.length;for(let i=0;i<r;++i)uC[0]=t[i],e[i]=uC[0];return e}function ist(t,e){const r=t.length;for(let i=0;i<r;++i)uC[0]=t[i],uC[1]=t[i]-uC[0],e[i]=uC[1];return e}const uC=new Float32Array(2);let wX=class extends cc{constructor(){super(...arguments),this.instancedDoublePrecision=!1,this.hasModelTransformation=!1}};d([j()],wX.prototype,"instancedDoublePrecision",void 0),d([j()],wX.prototype,"hasModelTransformation",void 0);const Yue=li();function RAe(t,e){const r=e.hasModelTransformation,i=e.instancedDoublePrecision;r&&(t.vertex.uniforms.add(new ln("model",s=>s.modelTransformation??sn)),t.vertex.uniforms.add(new sh("normalLocalOriginFromModel",s=>(iy(Yue,s.modelTransformation??sn),Yue)))),e.instanced&&i&&(t.attributes.add(R.INSTANCEMODELORIGINHI,"vec3"),t.attributes.add(R.INSTANCEMODELORIGINLO,"vec3"),t.attributes.add(R.INSTANCEMODEL,"mat3"),t.attributes.add(R.INSTANCEMODELNORMAL,"mat3"));const n=t.vertex;i&&(n.include(cre,e),n.uniforms.add(new Xu("viewOriginHi",(s,o)=>rst(ie(BD,o.camera.viewInverseTransposeMatrix[3],o.camera.viewInverseTransposeMatrix[7],o.camera.viewInverseTransposeMatrix[11]),BD)),new Xu("viewOriginLo",(s,o)=>ist(ie(BD,o.camera.viewInverseTransposeMatrix[3],o.camera.viewInverseTransposeMatrix[7],o.camera.viewInverseTransposeMatrix[11]),BD)))),n.code.add(T`
    vec3 getVertexInLocalOriginSpace() {
      return ${r?i?"(model * vec4(instanceModel * localPosition().xyz, 1.0)).xyz":"(model * localPosition()).xyz":i?"instanceModel * localPosition().xyz":"localPosition().xyz"};
    }

    vec3 subtractOrigin(vec3 _pos) {
      ${i?T`
          // Negated inputs are intentionally the first two arguments. The other way around the obfuscation in dpAdd() stopped
          // working for macOS 14+ and iOS 17+.
          // Issue: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/56280
          vec3 originDelta = dpAdd(-instanceModelOriginHi, -instanceModelOriginLo, viewOriginHi, viewOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `),n.code.add(T`
    vec3 dpNormal(vec4 _normal) {
      return normalize(${r?i?"normalLocalOriginFromModel * (instanceModelNormal * _normal.xyz)":"normalLocalOriginFromModel * _normal.xyz":i?"instanceModelNormal * _normal.xyz":"_normal.xyz"});
    }
    `),e.output===U.Normal&&(o3(n),n.code.add(T`
    vec3 dpNormalView(vec4 _normal) {
      return normalize((viewNormal * ${r?i?"vec4(normalLocalOriginFromModel * (instanceModelNormal * _normal.xyz), 1.0)":"vec4(normalLocalOriginFromModel * _normal.xyz, 1.0)":i?"vec4(instanceModelNormal * _normal.xyz, 1.0)":"_normal"}).xyz);
    }
    `)),e.hasVertexTangents&&n.code.add(T`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${r?i?"return vec4(normalLocalOriginFromModel * (instanceModelNormal * _tangent.xyz), _tangent.w);":"return vec4(normalLocalOriginFromModel * _tangent.xyz, _tangent.w);":i?"return vec4(instanceModelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}
    }`)}const BD=C();let vl=class extends wX{};d([j({constValue:!0})],vl.prototype,"hasSliceHighlight",void 0),d([j({constValue:!1})],vl.prototype,"hasSliceInVertexProgram",void 0),d([j({constValue:Rr.Pass})],vl.prototype,"pbrTextureBindType",void 0);var hg;(function(t){t[t.Cone=0]="Cone",t[t.Cylinder=1]="Cylinder",t[t.Underground=2]="Underground",t[t.COUNT=3]="COUNT"})(hg||(hg={}));let ure=class extends vl{constructor(){super(...arguments),this.geometry=hg.Cone}};d([j({count:hg.COUNT})],ure.prototype,"geometry",void 0);function HI(t){t.attributes.add(R.POSITION,"vec3"),t.vertex.code.add(T`vec3 positionModel() { return position; }`)}let W6=class extends vn{constructor(e,r){super(e,"mat3",Rr.Draw,(i,n,s)=>i.setUniformMatrix3fv(e,r(n,s)))}};function eE(t,e){t.include(HI);const r=t.vertex;r.include(cre,e),t.varyings.add("vPositionWorldCameraRelative","vec3"),t.varyings.add("vPosition_view","vec3"),r.uniforms.add(new Ft("transformWorldFromViewTH",i=>i.transformWorldFromViewTH),new Ft("transformWorldFromViewTL",i=>i.transformWorldFromViewTL),new sh("transformViewFromCameraRelativeRS",i=>i.transformViewFromCameraRelativeRS),new ln("transformProjFromView",i=>i.transformProjFromView),new W6("transformWorldFromModelRS",i=>i.transformWorldFromModelRS),new Xu("transformWorldFromModelTH",i=>i.transformWorldFromModelTH),new Xu("transformWorldFromModelTL",i=>i.transformWorldFromModelTL)),r.code.add(T`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`),r.code.add(T`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${e.spherical?T`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:T`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `),t.fragment.uniforms.add(new Ft("transformWorldFromViewTL",i=>i.transformWorldFromViewTL)),r.code.add(T`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`),t.fragment.code.add(T`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)}let $Ae=class extends Ai{constructor(){super(...arguments),this.transformWorldFromViewTH=C(),this.transformWorldFromViewTL=C(),this.transformViewFromCameraRelativeRS=li(),this.transformProjFromView=xe()}},IAe=class extends Ai{constructor(){super(...arguments),this.transformWorldFromModelRS=li(),this.transformWorldFromModelTH=C(),this.transformWorldFromModelTL=C()}};function _v(t){t.varyings.add("linearDepth","float")}function f2(t){t.vertex.uniforms.add(new ti("nearFar",(e,r)=>r.camera.nearFar))}function sU(t){t.vertex.code.add(T`float calculateLinearDepth(vec2 nearFar,float z) {
return (-z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)}function X3(t,e){const{vertex:r}=t;switch(e.output){case U.Color:if(e.receiveShadows)return _v(t),void r.code.add(T`void forwardLinearDepth() { linearDepth = gl_Position.w; }`);break;case U.LinearDepth:case U.Shadow:case U.ShadowHighlight:case U.ShadowExcludeHighlight:return t.include(eE,e),_v(t),f2(t),sU(t),void r.code.add(T`void forwardLinearDepth() {
linearDepth = calculateLinearDepth(nearFar, vPosition_view.z);
}`)}r.code.add(T`void forwardLinearDepth() {}`)}function Kl(t){sU(t),t.vertex.code.add(T`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = calculateLinearDepth(nearFar,eye.z);
return proj * eye;
}`),t.vertex.code.add(T`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)}let oU=class extends Ai{constructor(){super(...arguments),this.texV=He(),this.altitudeFade=0,this.innerScale=0,this.undergroundFadeAlpha=0,this.silhouette=new hre}},hre=class{constructor(){this.center=C(),this.v1=C(),this.v2=C()}};function LAe(t){const e=new Or,{vertex:r,fragment:i}=e;if(by(r),t.geometry===hg.Underground)e.attributes.add(R.POSITION,"vec2"),e.varyings.add("color","vec4"),r.uniforms.add(new Ft("cameraPosition",(n,s)=>s.camera.eye),new $e("undergroundFadeAlpha",n=>n.undergroundFadeAlpha)),r.code.add(T`void main(void) {
float ndotl = dot(normalize(cameraPosition), mainLightDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);
}`),i.code.add(T`void main() {
fragColor = color;
}`);else{e.include(Kl,t),e.attributes.add(R.POSITION,"vec3"),e.varyings.add("vtc","vec2"),e.varyings.add("falloff","float");const n=t.geometry===hg.Cylinder;r.uniforms.add(new ln("proj",(a,l)=>l.camera.projectionMatrix),new ln("view",(a,l)=>l.camera.viewMatrix)),n||(e.varyings.add("innerFactor","float"),r.uniforms.add(new Ft("silCircleCenter",a=>a.silhouette.center)),r.uniforms.add(new Ft("silCircleV1",a=>a.silhouette.v1)),r.uniforms.add(new Ft("silCircleV2",a=>a.silhouette.v2)),r.uniforms.add(new ti("texV",a=>a.texV)),r.uniforms.add(new $e("innerScale",a=>a.innerScale)));const s=6.2831853,o=1/128;r.code.add(T`
		void main(void) {
      ${n?T`
      vec3 pos = position;
      float ndotl = mainLightDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:T`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${T.float(s*o)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), mainLightDirection);
      vtc.x = position.x  * ${T.float(o)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
    }
	  `),i.uniforms.add(new ct("tex",a=>a.texture)),n||i.uniforms.add(new $e("altitudeFade",a=>a.altitudeFade)),i.code.add(T`
		void main() {
			vec4 atmosphereColor = texture(tex, vtc) * falloff;
      ${n?T`fragColor = atmosphereColor;`:T`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			fragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));
      `}
    }`)}return e}const nst=Object.freeze(Object.defineProperty({__proto__:null,SilhouetteCircle:hre,SimpleAtmospherePassParameters:oU,build:LAe},Symbol.toStringTag,{value:"Module"}));let q6=class DAe extends Vr{initializeProgram(e){return new Lr(e.rctx,DAe.shader.get().build(this.configuration),Mr)}initializePipeline(){return this.configuration.geometry===hg.Cylinder?kt({blending:Wo(Se.SRC_ALPHA,Se.ONE,Se.ONE_MINUS_SRC_ALPHA,Se.ONE_MINUS_SRC_ALPHA),culling:Yte,depthTest:{func:Xr.LEQUAL},colorWrite:Yt}):kt({blending:Wo(Se.SRC_ALPHA,Se.ONE,Se.ONE_MINUS_SRC_ALPHA,Se.ONE_MINUS_SRC_ALPHA),depthTest:{func:Xr.LEQUAL},colorWrite:Yt})}};q6.shader=new Ir(nst,()=>ge(()=>Promise.resolve().then(()=>zNt),void 0));const sst=new Uint8ClampedArray([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,16,0,0,16,16,0,0,16,16,0,0,16,16,0,0,16,15,0,0,17,15,0,0,17,15,0,0,17,15,0,0,17,14,0,0,18,14,0,0,18,14,0,0,18,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,20,13,0,0,20,13,0,0,20,13,0,0,20,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,22,12,0,0,22,12,0,0,22,12,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,27,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,29,18,0,0,29,18,0,0,29,17,0,0,30,17,0,0,30,17,0,0,30,17,0,0,30,16,0,0,31,16,0,0,31,16,0,0,31,16,0,0,32,16,0,0,32,16,0,0,32,15,0,0,33,15,0,0,33,15,0,0,33,15,0,0,34,15,8,0,34,15,8,0,34,15,8,0,34,15,7,0,35,15,7,0,35,15,7,0,35,21,7,0,36,21,7,0,36,21,7,0,36,21,7,0,37,21,7,0,37,21,7,0,37,20,7,0,38,20,7,0,38,20,7,0,38,20,7,0,39,20,7,0,39,20,7,0,39,20,7,0,39,19,6,0,40,19,6,0,40,19,6,0,40,19,6,0,41,19,6,0,41,19,6,0,41,18,6,0,42,18,6,0,42,18,6,0,42,24,6,0,43,24,6,0,43,24,6,0,43,23,6,0,44,23,6,0,44,23,6,0,44,23,6,0,45,23,6,0,45,23,6,0,45,22,6,0,46,22,6,0,46,22,6,0,46,22,5,0,47,22,5,0,47,22,5,0,47,21,5,0,48,21,5,0,48,21,5,0,48,21,5,0,49,21,5,0,49,26,5,0,49,25,5,0,50,25,5,0,50,25,5,0,50,25,5,0,51,25,5,0,51,25,5,0,51,25,5,0,52,25,5,0,52,25,5,0,52,24,5,0,53,24,5,0,53,24,5,0,53,24,9,0,54,28,9,0,54,28,9,0,54,28,9,0,55,28,9,0,55,27,9,0,56,27,9,0,56,27,9,0,56,27,9,4,57,27,9,4,57,27,9,4,57,26,9,4,58,26,9,4,58,26,9,4,58,26,9,4,59,26,9,4,59,26,9,4,59,26,8,4,60,30,8,4,60,30,8,4,60,29,8,4,61,29,8,4,61,29,8,4,62,29,8,4,62,29,8,4,62,28,8,4,63,28,8,4,63,28,8,4,63,28,12,4,64,28,12,4,64,28,12,4,64,27,12,4,65,27,12,8,65,27,12,8,65,31,12,8,66,31,12,8,66,30,11,8,67,30,11,8,67,30,11,8,67,30,11,8,68,30,11,8,68,30,11,8,68,30,15,7,69,30,15,7,69,30,15,7,69,33,15,11,70,33,15,11,70,32,14,11,71,32,14,11,71,32,14,11,71,32,18,14,72,32,18,14,72,32,18,14,72,31,17,14,73,35,17,14,73,34,17,17,74,34,21,17,74,34,21,17,74,34,20,17,75,34,20,20,75,34,20,20,75,34,23,20,76,34,23,20,76,36,23,23,77,36,23,23,77,36,23,23,77,36,23,23,78,36,26,26,78,36,26,26,78,36,26,26,79,36,26,29,79,38,26,29,80,38,29,29,80,38,29,29,80,38,28,31,81,38,28,31,81,38,31,31,81,37,31,34,82,37,31,34,82,37,31,37,83,40,34,37,83,40,34,37,83,39,33,39,84,39,33,39,84,39,36,42,84,39,36,42,85,39,36,42,85,39,36,42,85,39,39,44,86,39,39,44,86,41,38,47,87,41,41,47,87,41,41,50,87,41,41,49,88,41,41,52,88,40,43,52,89,43,43,52,89,43,43,54,89,42,45,54,90,42,45,57,90,42,45,57,90,42,45,59,91,42,48,59,91,44,47,61,92,44,47,61,92,44,50,61,92,44,49,63,93,44,49,63,93,44,52,66,93,43,52,65,94,46,54,68,94,46,54,70,95,46,54,70,95,46,54,70,95,45,56,72,96,45,56,72,96,45,58,74,97,47,58,76,97,47,58,76,97,47,60,78,98,47,60,78,98,47,60,81,98,49,62,80,99,49,62,82,99,48,61,84,100,48,64,84,100,48,64,84,100,50,63,86,101,50,66,86,101,50,66,88,101,50,65,90,102,52,67,89,103,51,69,91,104,51,68,92,105,52,69,93,107,52,71,94,108,54,70,96,109,53,71,96,111,52,73,98,112,54,72,98,114,53,73,100,115,54,72,100,117,54,73,102,118,55,74,104,120,55,76,105,121,56,77,106,123,56,76,107,124,57,79,107,126,58,78,110,128,57,79,111,129,56,80,113,131,58,79,112,132,57,82,114,134,58,81,116,136,60,82,117,137,59,83,117,139,60,83,119,141,59,84,120,142,60,85,122,144,59,86,122,146,60,86,126,148,62,87,127,149,61,88,127,151,62,88,128,153,63,89,130,155,62,90,131,156,63,90,132,158,64,91,134,160,65,91,135,162,64,92,136,163,63,93,138,165,66,95,139,167,65,95,140,169,66,95,142,171,67,96,142,172,66,97,144,174,67,99,145,176,67,97,148,178,67,99,147,180,68,100,149,181,68,100,150,183,69,101,152,185,70,102,153,187,71,103,155,188,70,103,156,190,70,104,157,192,71,105,158,194,71,106,160,195,72,106,161,197,72,108,161,199,73,108,163,200,73,109,164,202,74,109,165,204,74,110,167,206,75,111,168,207,74,112,170,209,75,112,170,210,76,113,171,212,76,114,173,214,77,115,174,215,78,115,175,217,78,116,175,218,78,117,177,220,78,118,178,221,79,118,180,223,80,120,180,224,81,120,181,226,81,120,182,227,82,121,184,229,82,122,185,230,84,123,186,232,83,123,187,233,84,124,189,234,84,125,188,235,85,126,189,237,86,126,190,238,86,127,191,239,87,127,192,240,87,129,193,242,88,129,194,243,89,130,195,244,90,131,196,245,90,132,197,246,91,132,197,247,92,133,198,248,92,134,199,249,93,135,200,250,94,136,201,251,95,137,202,252,96,138,203,253,97,140,204,254,98,141,205,254,99,142,206,255,101,143,207,255,102,144,208,255,103,146,209,255,104,147,209,255,106,148,210,255,107,149,211,255,108,151,212,255,110,152,213,255,111,153,213,255,112,154,214,255,114,156,215,255,115,157,215,255,117,158,216,255,118,160,217,255,120,161,217,255,121,162,218,255,123,164,218,255,124,165,219,255,125,166,219,255,127,167,220,255,129,169,220,255,130,170,221,255,132,171,221,255,133,173,222,255,134,174,222,255,136,175,223,255,139,178,224,255,142,180,224,255,144,182,225,255,147,185,226,255,150,187,226,255,153,189,227,255,155,191,228,255,158,194,228,255,160,196,229,255,163,198,229,255,165,200,230,255,168,202,231,255,170,203,231,255,172,205,232,255,174,207,232,255,176,209,233,255,178,210,234,255,180,212,234,255,182,214,235,255,184,215,236,255,186,217,237,255,188,219,238,255,190,220,238,255,192,221,239,255,193,222,240,255,194,224,240,255,196,225,241,255,197,226,241,255,198,226,242,255,199,227,242,255,200,228,242,255,201,228,243,255,202,229,243,255,203,230,243,255,204,230,244,255,205,231,244,255,207,232,244,255,208,233,245,255,209,233,245,255,211,234,246,255,213,235,246,255,217,238,247,255,222,240,248,255,226,242,249,255,231,245,250,255,236,247,251,255,241,249,252,255,245,251,253,255,249,252,254,255,255,255,255,255]);function ou(t,e=0){const r=t.stride;return Array.from(t.fields.keys()).map(i=>{const n=t.fields.get(i),s=n.constructor.ElementCount,o=ost(n.constructor.ElementType),a=n.offset,l=!(!n.optional||!n.optional.glNormalized);return new jo(i,s,o,a,r,l,e)})}function ost(t){const e=ast[t];if(e)return e;throw new Error("BufferType not supported in WebGL")}const ast={u8:qe.UNSIGNED_BYTE,u16:qe.UNSIGNED_SHORT,u32:qe.UNSIGNED_INT,i8:qe.BYTE,i16:qe.SHORT,i32:qe.INT,f32:qe.FLOAT};let dre=class{constructor(e,r,i=0,n,s){this.TypedArrayConstructor=e,this.elementCount=9;const o=this.TypedArrayConstructor;n===void 0&&(n=9*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=s==null?new o(r,a):new o(r,a,(s-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const n=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,n,this.stride,n+i*this.stride)}getMat(e,r){let i=e*this.typedBufferStride;for(let n=0;n<9;n++)r[n]=this.typedBuffer[i++];return r}setMat(e,r){let i=e*this.typedBufferStride;for(let n=0;n<9;n++)this.typedBuffer[i++]=r[n]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}copyFrom(e,r,i){const n=this.typedBuffer,s=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;for(let l=0;l<9;++l)n[o++]=s[a++]}get buffer(){return this.typedBuffer.buffer}};dre.ElementCount=9;let pre=class{constructor(e,r,i=0,n,s){this.TypedArrayConstructor=e,this.elementCount=16;const o=this.TypedArrayConstructor;n===void 0&&(n=16*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=s==null?new o(r,a):new o(r,a,(s-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const n=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,n,this.stride,n+i*this.stride)}getMat(e,r){let i=e*this.typedBufferStride;for(let n=0;n<16;n++)r[n]=this.typedBuffer[i++];return r}setMat(e,r){let i=e*this.typedBufferStride;for(let n=0;n<16;n++)this.typedBuffer[i++]=r[n]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}copyFrom(e,r,i){const n=this.typedBuffer,s=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;for(let l=0;l<16;++l)n[o++]=s[a++]}get buffer(){return this.typedBuffer.buffer}};pre.ElementCount=16;let wy=class{constructor(e,r,i=0,n,s){this.TypedArrayConstructor=e,this.elementCount=1;const o=this.TypedArrayConstructor;n===void 0&&(n=o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=s==null?new o(r,a):new o(r,a,(s-i)/o.BYTES_PER_ELEMENT),this.stride=n,this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride)}sliceBuffer(e,r,i=this.count-r){const n=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,n,this.stride,n+i*this.stride)}get(e){return this.typedBuffer[e*this.typedBufferStride]}set(e,r){this.typedBuffer[e*this.typedBufferStride]=r}get buffer(){return this.typedBuffer.buffer}};wy.ElementCount=1;let xy=class{constructor(e,r,i=0,n,s){this.TypedArrayConstructor=e,this.elementCount=2;const o=this.TypedArrayConstructor;n===void 0&&(n=2*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=s==null?new o(r,a):new o(r,a,(s-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const n=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,n,this.stride,n+i*this.stride)}getVec(e,r){return e*=this.typedBufferStride,cr(r,this.typedBuffer[e],this.typedBuffer[e+1])}setVec(e,r){e*=this.typedBufferStride,this.typedBuffer[e++]=r[0],this.typedBuffer[e]=r[1]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}setValues(e,r,i){e*=this.typedBufferStride,this.typedBuffer[e++]=r,this.typedBuffer[e]=i}copyFrom(e,r,i){const n=this.typedBuffer,s=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;n[o++]=s[a++],n[o]=s[a]}get buffer(){return this.typedBuffer.buffer}};xy.ElementCount=2;let Ty=class{constructor(e,r,i=0,n,s){this.TypedArrayConstructor=e,this.elementCount=3;const o=this.TypedArrayConstructor;n===void 0&&(n=3*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=s==null?new o(r,a):new o(r,a,(s-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const n=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,n,this.stride,n+i*this.stride)}getVec(e,r){return e*=this.typedBufferStride,ie(r,this.typedBuffer[e],this.typedBuffer[e+1],this.typedBuffer[e+2])}setVec(e,r){e*=this.typedBufferStride,this.typedBuffer[e++]=r[0],this.typedBuffer[e++]=r[1],this.typedBuffer[e]=r[2]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}setValues(e,r,i,n){e*=this.typedBufferStride,this.typedBuffer[e++]=r,this.typedBuffer[e++]=i,this.typedBuffer[e]=n}copyFrom(e,r,i){const n=this.typedBuffer,s=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;n[o++]=s[a++],n[o++]=s[a++],n[o]=s[a]}get buffer(){return this.typedBuffer.buffer}};Ty.ElementCount=3;let Sy=class{constructor(e,r,i=0,n,s){this.TypedArrayConstructor=e,this.start=i,this.elementCount=4;const o=this.TypedArrayConstructor;n===void 0&&(n=4*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=s==null?new o(r,a):new o(r,a,(s-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const n=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,n,this.stride,n+i*this.stride)}getVec(e,r){return e*=this.typedBufferStride,nn(r,this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e])}setVec(e,r){e*=this.typedBufferStride,this.typedBuffer[e++]=r[0],this.typedBuffer[e++]=r[1],this.typedBuffer[e++]=r[2],this.typedBuffer[e]=r[3]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}setValues(e,r,i,n,s){e*=this.typedBufferStride,this.typedBuffer[e++]=r,this.typedBuffer[e++]=i,this.typedBuffer[e++]=n,this.typedBuffer[e]=s}copyFrom(e,r,i){const n=this.typedBuffer,s=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;n[o++]=s[a++],n[o++]=s[a++],n[o++]=s[a++],n[o]=s[a]}get buffer(){return this.typedBuffer.buffer}};Sy.ElementCount=4;let aU=class NAe extends wy{constructor(e,r=0,i,n){super(Float32Array,e,r,i,n),this.elementType="f32"}static fromTypedArray(e,r){return new NAe(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};aU.ElementType="f32";let U2=class xX extends xy{constructor(e,r=0,i,n){super(Float32Array,e,r,i,n),this.elementType="f32"}slice(e,r){return this.sliceBuffer(xX,e,r)}static fromTypedArray(e,r){return new xX(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};U2.ElementType="f32";let Qs=class TX extends Ty{constructor(e,r=0,i,n){super(Float32Array,e,r,i,n),this.elementType="f32"}slice(e,r){return this.sliceBuffer(TX,e,r)}static fromTypedArray(e,r){return new TX(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Qs.ElementType="f32";let uf=class SX extends Sy{constructor(e,r=0,i,n){super(Float32Array,e,r,i,n),this.elementType="f32"}slice(e,r){return this.sliceBuffer(SX,e,r)}static fromTypedArray(e,r){return new SX(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};uf.ElementType="f32";let vv=class CX extends dre{constructor(e,r=0,i,n){super(Float32Array,e,r,i,n),this.elementType="f32"}slice(e,r){return this.sliceBuffer(CX,e,r)}static fromTypedArray(e,r){return new CX(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};vv.ElementType="f32";let fre=class EX extends dre{constructor(e,r=0,i,n){super(Float64Array,e,r,i,n),this.elementType="f64"}slice(e,r){return this.sliceBuffer(EX,e,r)}static fromTypedArray(e,r){return new EX(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};fre.ElementType="f64";let mre=class PX extends pre{constructor(e,r=0,i,n){super(Float32Array,e,r,i,n),this.elementType="f32"}slice(e,r){return this.sliceBuffer(PX,e,r)}static fromTypedArray(e,r){return new PX(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};mre.ElementType="f32";let F$=class AX extends pre{constructor(e,r=0,i,n){super(Float64Array,e,r,i,n),this.elementType="f64"}slice(e,r){return this.sliceBuffer(AX,e,r)}static fromTypedArray(e,r){return new AX(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};F$.ElementType="f64";let gre=class MX extends wy{constructor(e,r=0,i,n){super(Float64Array,e,r,i,n),this.elementType="f64"}slice(e,r){return this.sliceBuffer(MX,e,r)}static fromTypedArray(e,r){return new MX(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};gre.ElementType="f64";let yre=class OX extends xy{constructor(e,r=0,i,n){super(Float64Array,e,r,i,n),this.elementType="f64"}slice(e,r){return this.sliceBuffer(OX,e,r)}static fromTypedArray(e,r){return new OX(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};yre.ElementType="f64";let vd=class RX extends Ty{constructor(e,r=0,i,n){super(Float64Array,e,r,i,n),this.elementType="f64"}slice(e,r){return this.sliceBuffer(RX,e,r)}static fromTypedArray(e,r){return new RX(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};vd.ElementType="f64";let lU=class $X extends Sy{constructor(e,r=0,i,n){super(Float64Array,e,r,i,n),this.elementType="f64"}slice(e,r){return this.sliceBuffer($X,e,r)}static fromTypedArray(e,r){return new $X(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};lU.ElementType="f64";let a3=class IX extends wy{constructor(e,r=0,i,n){super(Uint8Array,e,r,i,n),this.elementType="u8"}slice(e,r){return this.sliceBuffer(IX,e,r)}static fromTypedArray(e,r){return new IX(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};a3.ElementType="u8";let cU=class LX extends xy{constructor(e,r=0,i,n){super(Uint8Array,e,r,i,n),this.elementType="u8"}slice(e,r){return this.sliceBuffer(LX,e,r)}static fromTypedArray(e,r){return new LX(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};cU.ElementType="u8";let uU=class DX extends Ty{constructor(e,r=0,i,n){super(Uint8Array,e,r,i,n),this.elementType="u8"}slice(e,r){return this.sliceBuffer(DX,e,r)}static fromTypedArray(e,r){return new DX(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};uU.ElementType="u8";let za=class NX extends Sy{constructor(e,r=0,i,n){super(Uint8Array,e,r,i,n),this.elementType="u8"}slice(e,r){return this.sliceBuffer(NX,e,r)}static fromTypedArray(e,r){return new NX(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};za.ElementType="u8";let hU=class FX extends wy{constructor(e,r=0,i,n){super(Uint16Array,e,r,i,n),this.elementType="u16"}slice(e,r){return this.sliceBuffer(FX,e,r)}static fromTypedArray(e,r){return new FX(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};hU.ElementType="u16";let _re=class kX extends xy{constructor(e,r=0,i,n){super(Uint16Array,e,r,i,n),this.elementType="u16"}slice(e,r){return this.sliceBuffer(kX,e,r)}static fromTypedArray(e,r){return new kX(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};_re.ElementType="u16";let dU=class zX extends Ty{constructor(e,r=0,i,n){super(Uint16Array,e,r,i,n),this.elementType="u16"}slice(e,r){return this.sliceBuffer(zX,e,r)}static fromTypedArray(e,r){return new zX(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};dU.ElementType="u16";let WI=class UX extends Sy{constructor(e,r=0,i,n){super(Uint16Array,e,r,i,n),this.elementType="u16"}slice(e,r){return this.sliceBuffer(UX,e,r)}static fromTypedArray(e,r){return new UX(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};WI.ElementType="u16";let pU=class BX extends wy{constructor(e,r=0,i,n){super(Uint32Array,e,r,i,n),this.elementType="u32"}slice(e,r){return this.sliceBuffer(BX,e,r)}static fromTypedArray(e,r){return new BX(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};pU.ElementType="u32";let vre=class VX extends xy{constructor(e,r=0,i,n){super(Uint32Array,e,r,i,n),this.elementType="u32"}slice(e,r){return this.sliceBuffer(VX,e,r)}static fromTypedArray(e,r){return new VX(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};vre.ElementType="u32";let FAe=class GX extends Ty{constructor(e,r=0,i,n){super(Uint32Array,e,r,i,n),this.elementType="u32"}slice(e,r){return this.sliceBuffer(GX,e,r)}static fromTypedArray(e,r){return new GX(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};FAe.ElementType="u32";let kAe=class jX extends Sy{constructor(e,r=0,i,n){super(Uint32Array,e,r,i,n),this.elementType="u32"}slice(e,r){return this.sliceBuffer(jX,e,r)}static fromTypedArray(e,r){return new jX(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};kAe.ElementType="u32";let bre=class HX extends wy{constructor(e,r=0,i,n){super(Int8Array,e,r,i,n),this.elementType="i8"}slice(e,r){return this.sliceBuffer(HX,e,r)}static fromTypedArray(e,r){return new HX(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};bre.ElementType="i8";let fU=class WX extends xy{constructor(e,r=0,i,n){super(Int8Array,e,r,i,n),this.elementType="i8"}slice(e,r){return this.sliceBuffer(WX,e,r)}static fromTypedArray(e,r){return new WX(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};fU.ElementType="i8";let zAe=class qX extends Ty{constructor(e,r=0,i,n){super(Int8Array,e,r,i,n),this.elementType="i8"}slice(e,r){return this.sliceBuffer(qX,e,r)}static fromTypedArray(e,r){return new qX(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};zAe.ElementType="i8";let UAe=class YX extends Sy{constructor(e,r=0,i,n){super(Int8Array,e,r,i,n),this.elementType="i8"}slice(e,r){return this.sliceBuffer(YX,e,r)}static fromTypedArray(e,r){return new YX(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};UAe.ElementType="i8";let BAe=class XX extends wy{constructor(e,r=0,i,n){super(Int16Array,e,r,i,n),this.elementType="i16"}slice(e,r){return this.sliceBuffer(XX,e,r)}static fromTypedArray(e,r){return new XX(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};BAe.ElementType="i16";let qI=class ZX extends xy{constructor(e,r=0,i,n){super(Int16Array,e,r,i,n),this.elementType="i16"}slice(e,r){return this.sliceBuffer(ZX,e,r)}static fromTypedArray(e,r){return new ZX(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};qI.ElementType="i16";let VAe=class JX extends Ty{constructor(e,r=0,i,n){super(Int16Array,e,r,i,n),this.elementType="i16"}slice(e,r){return this.sliceBuffer(JX,e,r)}static fromTypedArray(e,r){return new JX(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};VAe.ElementType="i16";let GAe=class QX extends Sy{constructor(e,r=0,i,n){super(Int16Array,e,r,i,n),this.elementType="i16"}slice(e,r){return this.sliceBuffer(QX,e,r)}static fromTypedArray(e,r){return new QX(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};GAe.ElementType="i16";let jAe=class KX extends wy{constructor(e,r=0,i,n){super(Int32Array,e,r,i,n),this.elementType="i32"}slice(e,r){return this.sliceBuffer(KX,e,r)}static fromTypedArray(e,r){return new KX(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};jAe.ElementType="i32";let HAe=class eZ extends xy{constructor(e,r=0,i,n){super(Int32Array,e,r,i,n),this.elementType="i32"}slice(e,r){return this.sliceBuffer(eZ,e,r)}static fromTypedArray(e,r){return new eZ(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};HAe.ElementType="i32";let WAe=class tZ extends Ty{constructor(e,r=0,i,n){super(Int32Array,e,r,i,n),this.elementType="i32"}slice(e,r){return this.sliceBuffer(tZ,e,r)}static fromTypedArray(e,r){return new tZ(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};WAe.ElementType="i32";let qAe=class rZ extends Sy{constructor(e,r=0,i,n){super(Int32Array,e,r,i,n),this.elementType="i32"}slice(e,r){return this.sliceBuffer(rZ,e,r)}static fromTypedArray(e,r){return new rZ(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};qAe.ElementType="i32";function Xue(t){switch(t){case"u8":case"i8":return 1;case"u16":case"i16":return 2;case"u32":case"i32":case"f32":return 4;case"f64":return 8}}let Zue=class YAe{constructor(e,r){this.layout=e,this.buffer=typeof r=="number"?new ArrayBuffer(r*e.stride):r;for(const i of e.fields.keys()){const n=e.fields.get(i);this[i]=new n.constructor(this.buffer,n.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(e,r){const i=this[e];return i&&i.elementCount===r.ElementCount&&i.elementType===r.ElementType?i:null}slice(e,r){return new YAe(this.layout,this.buffer.slice(e*this.stride,r*this.stride))}copyFrom(e,r=0,i=0,n=e.count){const s=this.stride;if(s%4==0){const o=new Uint32Array(e.buffer,r*s,n*s/4);new Uint32Array(this.buffer,i*s,n*s/4).set(o)}else{const o=new Uint8Array(e.buffer,r*s,n*s);new Uint8Array(this.buffer,i*s,n*s).set(o)}return this}get usedMemory(){return this.byteLength}dispose(){}},XAe=class ZAe{constructor(e=null){this._stride=0,this._lastAligned=0,this._fields=new Map,e&&(this._stride=e.stride,e.fields.forEach(r=>this._fields.set(r[0],{...r[1],constructor:ust(r[1].constructor)})))}vec2f(e,r){return this._appendField(e,U2,r),this}vec2f64(e,r){return this._appendField(e,yre,r),this}vec3f(e,r){return this._appendField(e,Qs,r),this}vec3f64(e,r){return this._appendField(e,vd,r),this}vec4f(e,r){return this._appendField(e,uf,r),this}vec4f64(e,r){return this._appendField(e,lU,r),this}mat3f(e,r){return this._appendField(e,vv,r),this}mat3f64(e,r){return this._appendField(e,fre,r),this}mat4f(e,r){return this._appendField(e,mre,r),this}mat4f64(e,r){return this._appendField(e,F$,r),this}vec4u8(e,r){return this._appendField(e,za,r),this}f32(e,r){return this._appendField(e,aU,r),this}f64(e,r){return this._appendField(e,gre,r),this}u8(e,r){return this._appendField(e,a3,r),this}u16(e,r){return this._appendField(e,hU,r),this}i8(e,r){return this._appendField(e,bre,r),this}vec2i8(e,r){return this._appendField(e,fU,r),this}vec2i16(e,r){return this._appendField(e,qI,r),this}vec2u8(e,r){return this._appendField(e,cU,r),this}vec4u16(e,r){return this._appendField(e,WI,r),this}u32(e,r){return this._appendField(e,pU,r),this}_appendField(e,r,i){if(this._fields.has(e))return void pt(!1,`${e} already added to vertex buffer layout`);const n=r.ElementCount*Xue(r.ElementType),s=this._stride;this._stride+=n,this._fields.set(e,{size:n,constructor:r,offset:s,optional:i})}createBuffer(e){return new Zue(this,e)}createView(e){return new Zue(this,e)}clone(){const e=new ZAe;return e._stride=this._stride,e._fields=new Map,this._fields.forEach((r,i)=>e._fields.set(i,r)),e.BufferType=this.BufferType,e}get stride(){if(this._lastAligned!==this._fields.size){let e=1;this._fields.forEach(r=>e=Math.max(e,Xue(r.constructor.ElementType))),this._stride=Math.floor((this._stride+e-1)/e)*e,this._lastAligned=this._fields.size}return this._stride}get fields(){return this._fields}};function Qi(){return new XAe}let lst=class{constructor(e){this.fields=new Array,e.fields.forEach((r,i)=>{const n={...r,constructor:JAe(r.constructor)};this.fields.push([i,n])}),this.stride=e.stride}};const cst=[aU,U2,Qs,uf,vv,mre,gre,yre,vd,lU,fre,F$,a3,cU,uU,za,hU,_re,dU,WI,pU,vre,FAe,kAe,bre,fU,zAe,UAe,BAe,qI,VAe,GAe,jAe,HAe,WAe,qAe];function JAe(t){return`${t.ElementType}_${t.ElementCount}`}function ust(t){return QAe.get(t)}const QAe=new Map;cst.forEach(t=>QAe.set(JAe(t),t));function xo(t,e=!1){return t<=Qu?e?new Array(t).fill(0):new Array(t):new Float64Array(t)}function KAe(t){return(cd(t)?t.length:t.byteLength/8)<=Qu?Array.from(t):new Float64Array(t)}function nd(t,e,r){return Array.isArray(t)?t.slice(e,e+r):t.subarray(e,e+r)}function hst(t,e){for(let r=0;r<e.length;++r)t[r]=e[r];return t}function U9t(t){return Array.isArray(t)?new Float64Array(t):t}function mn(t,e=!1){return t<=Qu?e?new Array(t).fill(0):new Array(t):new Float32Array(t)}function B9t(t){return cd(t)?t.length<Qu?t:new Float32Array(t):t.length<Qu?Array.from(t):t}function Jue(t){return(cd(t)?t.length:t.byteLength/8)<=Qu?Array.from(t):new Float32Array(t)}function Y6(t,e,r){return Array.isArray(t)?t.slice(e,e+r):t.subarray(e,e+r)}function Xm(t){if(cd(t)){if(t.length<Qu)return t}else if(t.length<Qu)return Array.from(t);let e=!0,r=!0;return t.some((i,n)=>(e=e&&i===0,r=r&&i===n,!e&&!r)),e?Uv(t.length):r?B2(t.length):cd(t)||t.BYTES_PER_ELEMENT!==Uint16Array.BYTES_PER_ELEMENT?dst(t):t}function dst(t){let e=!0;for(const r of t){if(r>=65536)return cd(t)?new Uint32Array(t):t;r>=256&&(e=!1)}return e?new Uint8Array(t):new Uint16Array(t)}function X6(t){return t<=Qu?new Array(t):t<=65536?new Uint16Array(t):new Uint32Array(t)}function pst(t){return t<=Qu?new Array(t):new Uint32Array(t)}let lT=(()=>{const t=new Uint32Array(131072);for(let e=0;e<t.length;++e)t[e]=e;return t})();const eMe=[0],HV=(()=>{const t=new Uint16Array(65536);for(let e=0;e<t.length;++e)t[e]=e;return t})();function B2(t){if(t===1)return eMe;if(t<Qu)return Array.from(new Uint16Array(HV.buffer,0,t));if(t<HV.length)return new Uint16Array(HV.buffer,0,t);if(t>lT.length){const e=Math.max(2*lT.length,t);lT=new Uint32Array(e);for(let r=0;r<lT.length;r++)lT[r]=r}return new Uint32Array(lT.buffer,0,t)}let VD=new Uint8Array(65536);function Uv(t){if(t===1)return eMe;if(t<Qu)return new Array(t).fill(0);if(t>VD.length){const e=Math.max(2*VD.length,t);VD=new Uint8Array(e)}return new Uint8Array(VD.buffer,0,t)}var iZ;(function(t){function e(o,a){const l=o[a],c=o[a+1],u=o[a+2];return Math.sqrt(l*l+c*c+u*u)}function r(o,a){const l=o[a],c=o[a+1],u=o[a+2],h=1/Math.sqrt(l*l+c*c+u*u);o[a]*=h,o[a+1]*=h,o[a+2]*=h}function i(o,a,l){o[a]*=l,o[a+1]*=l,o[a+2]*=l}function n(o,a,l,c,u,h=a){(u=u||o)[h]=o[a]+l[c],u[h+1]=o[a+1]+l[c+1],u[h+2]=o[a+2]+l[c+2]}function s(o,a,l,c,u,h=a){(u=u||o)[h]=o[a]-l[c],u[h+1]=o[a+1]-l[c+1],u[h+2]=o[a+2]-l[c+2]}t.length=e,t.normalize=r,t.scale=i,t.add=n,t.subtract=s})(iZ||(iZ={}));var Cn;(function(t){t[t.Layer=0]="Layer",t[t.Object=1]="Object",t[t.Mesh=2]="Mesh",t[t.Line=3]="Line",t[t.Point=4]="Point",t[t.Material=5]="Material",t[t.Texture=6]="Texture",t[t.COUNT=7]="COUNT"})(Cn||(Cn={}));function fst(t){if(t.length<Qu)return Array.from(t);if(cd(t))return Float64Array.from(t);if(!("BYTES_PER_ELEMENT"in t))return Array.from(t);switch(t.BYTES_PER_ELEMENT){case 1:return Uint8Array.from(t);case 2:return Az(t)?Uint16Array.from(t):Int16Array.from(t);case 4:return Float32Array.from(t);default:return Float64Array.from(t)}}let tMe=class rMe{constructor(e,r,i){this.primitiveIndices=e,this._numIndexPerPrimitive=r,this.position=i,this._children=void 0,pt(e.length>=1),pt(i.size===3||i.size===4);const{data:n,size:s,indices:o}=i;pt(o.length%this._numIndexPerPrimitive==0),pt(o.length>=e.length*this._numIndexPerPrimitive);const a=e.length;let l=s*o[this._numIndexPerPrimitive*e[0]];nb.clear(),nb.push(l);const c=Ce(n[l],n[l+1],n[l+2]),u=Zi(c);for(let f=0;f<a;++f){const g=this._numIndexPerPrimitive*e[f];for(let _=0;_<this._numIndexPerPrimitive;++_){l=s*o[g+_],nb.push(l);let v=n[l];c[0]=Math.min(v,c[0]),u[0]=Math.max(v,u[0]),v=n[l+1],c[1]=Math.min(v,c[1]),u[1]=Math.max(v,u[1]),v=n[l+2],c[2]=Math.min(v,c[2]),u[2]=Math.max(v,u[2])}}this.bbMin=c,this.bbMax=u;const h=ni(C(),this.bbMin,this.bbMax,.5);this.radius=.5*Math.max(Math.max(u[0]-c[0],u[1]-c[1]),u[2]-c[2]);let p=this.radius*this.radius;for(let f=0;f<nb.length;++f){l=nb.at(f);const g=n[l]-h[0],_=n[l+1]-h[1],v=n[l+2]-h[2],b=g*g+_*_+v*v;if(b<=p)continue;const w=Math.sqrt(b),x=.5*(w-this.radius);this.radius=this.radius+x,p=this.radius*this.radius;const S=x/w;h[0]+=g*S,h[1]+=_*S,h[2]+=v*S}this.center=h,nb.clear()}getChildren(){if(this._children||Uo(this.bbMin,this.bbMax)<=1)return this._children;const e=ni(C(),this.bbMin,this.bbMax,.5),r=this.primitiveIndices.length,i=new Uint8Array(r),n=new Array(8);for(let u=0;u<8;++u)n[u]=0;const{data:s,size:o,indices:a}=this.position;for(let u=0;u<r;++u){let h=0;const p=this._numIndexPerPrimitive*this.primitiveIndices[u];let f=o*a[p],g=s[f],_=s[f+1],v=s[f+2];for(let b=1;b<this._numIndexPerPrimitive;++b){f=o*a[p+b];const w=s[f],x=s[f+1],S=s[f+2];w<g&&(g=w),x<_&&(_=x),S<v&&(v=S)}g<e[0]&&(h|=1),_<e[1]&&(h|=2),v<e[2]&&(h|=4),i[u]=h,++n[h]}let l=0;for(let u=0;u<8;++u)n[u]>0&&++l;if(l<2)return;const c=new Array(8);for(let u=0;u<8;++u)c[u]=n[u]>0?new Uint32Array(n[u]):void 0;for(let u=0;u<8;++u)n[u]=0;for(let u=0;u<r;++u){const h=i[u];c[h][n[h]++]=this.primitiveIndices[u]}this._children=new Array;for(let u=0;u<8;++u)c[u]!==void 0&&this._children.push(new rMe(c[u],this._numIndexPerPrimitive,this.position));return this._children}static prune(){nb.prune()}};const nb=new Vt({deallocator:null});let YI=class{constructor(){this.id=Gu()}};function mst(t){return t?{p0:Zi(t.p0),p1:Zi(t.p1),p2:Zi(t.p2)}:{p0:C(),p1:C(),p2:C()}}function gst(t,e,r){const i=e[0]-t[0],n=e[1]-t[1],s=r[0]-t[0],o=r[1]-t[1];return .5*Math.abs(i*o-n*s)}function yst(t,e,r){return ye(WV,e,t),ye(Que,r,t),.5*Te(Je(WV,WV,Que))}new my(yf);new my(()=>mst());const WV=C(),Que=C();function _st(t,e){if(!t)return!1;const{size:r,data:i,indices:n}=t;ie(e,0,0,0),ie(Ih,0,0,0);let s=0,o=0;for(let a=0;a<n.length-2;a+=3){const l=n[a]*r,c=n[a+1]*r,u=n[a+2]*r;ie(go,i[l],i[l+1],i[l+2]),ie(C0,i[c],i[c+1],i[c+2]),ie(GD,i[u],i[u+1],i[u+2]);const h=yst(go,C0,GD);h?(fe(go,go,C0),fe(go,go,GD),ne(go,go,1/3*h),fe(e,e,go),s+=h):(fe(Ih,Ih,go),fe(Ih,Ih,C0),fe(Ih,Ih,GD),o+=3)}return(o!==0||s!==0)&&(s!==0?(ne(e,e,1/s),!0):o!==0&&(ne(e,Ih,1/o),!0))}function vst(t,e){if(!t)return!1;const{size:r,data:i,indices:n}=t;ie(e,0,0,0);let s=-1,o=0;for(let a=0;a<n.length;a++){const l=n[a]*r;s!==l&&(e[0]+=i[l],e[1]+=i[l+1],e[2]+=i[l+2],o++),s=l}return o>1&&ne(e,e,1/o),o>0}function bst(t,e,r){if(!t)return!1;ie(r,0,0,0),ie(Ih,0,0,0);let i=0,n=0;const{size:s,data:o,indices:a}=t,l=a.length-1,c=l+(e?2:0);for(let u=0;u<c;u+=2){const h=u<l?u+1:0,p=a[u<l?u:l]*s,f=a[h]*s;go[0]=o[p],go[1]=o[p+1],go[2]=o[p+2],C0[0]=o[f],C0[1]=o[f+1],C0[2]=o[f+2],ne(go,fe(go,go,C0),.5);const g=D0(go,C0);g>0?(fe(r,r,ne(go,go,g)),i+=g):i===0&&(fe(Ih,Ih,go),n++)}return i!==0?(ne(r,r,1/i),!0):n!==0&&(ne(r,Ih,1/n),!0)}const go=C(),C0=C(),GD=C(),Ih=C();let Z6=class{constructor(e){this.channel=e,this.id=Gu()}};function nZ(t,e){return t==null&&(t=[]),t.push(e),t}function sZ(t,e){if(t==null)return null;const r=t.filter(i=>i!==e);return r.length===0?null:r}function wst(t,e,r,i,n){jD[0]=t.get(e,0),jD[1]=t.get(e,1),jD[2]=t.get(e,2),bX(jD,sb,3),r.set(n,0,sb[0]),i.set(n,0,sb[1]),r.set(n,1,sb[2]),i.set(n,1,sb[3]),r.set(n,2,sb[4]),i.set(n,2,sb[5])}const jD=C(),sb=new Float32Array(6);let gs=class iMe extends YI{constructor(e,r,i=null,n=Cn.Mesh,s=null,o=-1){super(),this.material=e,this.mapPositions=i,this.type=n,this.objectAndLayerIdColor=s,this.edgeIndicesLength=o,this.visible=!0,this._attributes=new Map,this._boundingInfo=null;for(const[a,l]of r)this._attributes.set(a,{...l,indices:Xm(l.indices)}),a===R.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._attributes.get(a).indices.length:this.edgeIndicesLength)}instantiate(e={}){const r=new iMe(e.material||this.material,[],this.mapPositions,this.type,this.objectAndLayerIdColor,this.edgeIndicesLength);return this._attributes.forEach((i,n)=>{i.exclusive=!1,r._attributes.set(n,i)}),r._boundingInfo=this._boundingInfo,r.transformation=e.transformation||this.transformation,r}get attributes(){return this._attributes}getMutableAttribute(e){let r=this._attributes.get(e);return r&&!r.exclusive&&(r={...r,exclusive:!0,data:fst(r.data)},this._attributes.set(e,r)),r}setAttributeData(e,r){const i=this._attributes.get(e);i&&this._attributes.set(e,{...i,exclusive:!0,data:r})}get indexCount(){const e=this._attributes.values().next().value.indices;return(e==null?void 0:e.length)??0}get faceCount(){return this.indexCount/3}get boundingInfo(){return this._boundingInfo==null&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(e){return!!(this.type===Cn.Mesh?this._computeAttachmentOriginTriangles(e):this.type===Cn.Line?this._computeAttachmentOriginLines(e):this._computeAttachmentOriginPoints(e))&&(this._transformation!=null&&Ge(e,e,this._transformation),!0)}_computeAttachmentOriginTriangles(e){const r=this.attributes.get(R.POSITION);return _st(r,e)}_computeAttachmentOriginLines(e){const r=this.attributes.get(R.POSITION);return bst(r,xst(this.material.parameters,r),e)}_computeAttachmentOriginPoints(e){const r=this.attributes.get(R.POSITION);return vst(r,e)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const e=this.attributes.get(R.POSITION);if(!e||e.indices.length===0)return null;const r=this.type===Cn.Mesh?3:1;pt(e.indices.length%r==0,"Indexing error: "+e.indices.length+" not divisible by "+r);const i=B2(e.indices.length/r);return new tMe(i,r,e)}get transformation(){return this._transformation??sn}set transformation(e){this._transformation=e&&e!==sn?WE(e):null}addHighlight(){const e=new Z6(oy.Highlight);return this.highlights=nZ(this.highlights,e),e}removeHighlight(e){this.highlights=sZ(this.highlights,e)}};function xst(t,e){return!(!("isClosed"in t)||!t.isClosed)&&e.indices.length>2}const cT=iZ,qV=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],Tst=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],Sst=[0,0,1,0,1,1,0,1],Cst=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],nMe=new Array(36);for(let t=0;t<6;t++)for(let e=0;e<6;e++)nMe[6*t+e]=t;const gw=new Array(36);for(let t=0;t<6;t++)gw[6*t]=0,gw[6*t+1]=1,gw[6*t+2]=2,gw[6*t+3]=2,gw[6*t+4]=3,gw[6*t+5]=0;function Est(t,e){Array.isArray(e)||(e=[e,e,e]);const r=new Array(24);for(let i=0;i<8;i++)r[3*i]=qV[i][0]*e[0],r[3*i+1]=qV[i][1]*e[1],r[3*i+2]=qV[i][2]*e[2];return new gs(t,[[R.POSITION,new Ye(r,Cst,3,!0)],[R.NORMAL,new Ye(Tst,nMe,3)],[R.UV0,new Ye(Sst,gw,2)]])}const YV=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],Pst=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],Ast=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],Mst=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];function Ost(t,e){Array.isArray(e)||(e=[e,e,e]);const r=new Array(18);for(let i=0;i<6;i++)r[3*i]=YV[i][0]*e[0],r[3*i+1]=YV[i][1]*e[1],r[3*i+2]=YV[i][2]*e[2];return new gs(t,[[R.POSITION,new Ye(r,Ast,3,!0)],[R.NORMAL,new Ye(Pst,Mst,3)]])}const nF=pi(-.5,0,-.5),sF=pi(.5,0,-.5),oF=pi(0,0,.5),aF=pi(0,.5,0),uT=kc(),hT=kc(),tE=kc(),rE=kc(),iE=kc();ye(uT,nF,aF),ye(hT,nF,sF),Je(tE,uT,hT),pe(tE,tE),ye(uT,sF,aF),ye(hT,sF,oF),Je(rE,uT,hT),pe(rE,rE),ye(uT,oF,aF),ye(hT,oF,nF),Je(iE,uT,hT),pe(iE,iE);const XV=[nF,sF,oF,aF],Rst=[0,-1,0,tE[0],tE[1],tE[2],rE[0],rE[1],rE[2],iE[0],iE[1],iE[2]],$st=[0,1,2,3,1,0,3,2,1,3,0,2],Ist=[0,0,0,1,1,1,2,2,2,3,3,3];function Lst(t,e){Array.isArray(e)||(e=[e,e,e]);const r=new Array(12);for(let i=0;i<4;i++)r[3*i]=XV[i][0]*e[0],r[3*i+1]=XV[i][1]*e[1],r[3*i+2]=XV[i][2]*e[2];return new gs(t,[[R.POSITION,new Ye(r,$st,3,!0)],[R.NORMAL,new Ye(Rst,Ist,3)]])}function j9t(t,e,r,i,n={uv:!0}){const s=-Math.PI,o=2*Math.PI,a=-Math.PI/2,l=Math.PI,c=Math.max(3,Math.floor(r)),u=Math.max(2,Math.floor(i)),h=(c+1)*(u+1),p=mn(3*h),f=mn(3*h),g=mn(2*h),_=[];let v=0;for(let x=0;x<=u;x++){const S=[],E=x/u,A=a+E*l,O=Math.cos(A);for(let L=0;L<=c;L++){const z=L/c,k=s+z*o,q=Math.cos(k)*O,B=Math.sin(A),J=-Math.sin(k)*O;p[3*v]=q*e,p[3*v+1]=B*e,p[3*v+2]=J*e,f[3*v]=q,f[3*v+1]=B,f[3*v+2]=J,g[2*v]=z,g[2*v+1]=E,S.push(v),++v}_.push(S)}const b=new Array;for(let x=0;x<u;x++)for(let S=0;S<c;S++){const E=_[x][S],A=_[x][S+1],O=_[x+1][S+1],L=_[x+1][S];x===0?(b.push(E),b.push(O),b.push(L)):x===u-1?(b.push(E),b.push(A),b.push(O)):(b.push(E),b.push(A),b.push(O),b.push(O),b.push(L),b.push(E))}const w=[[R.POSITION,new Ye(p,b,3,!0)],[R.NORMAL,new Ye(f,b,3,!0)]];return n.uv&&w.push([R.UV0,new Ye(g,b,2,!0)]),n.offset&&(w[0][0]=R.OFFSET,w.push([R.POSITION,new Ye(Float64Array.from(n.offset),Uv(b.length),3,!0)])),new gs(t,w)}function Dst(t,e,r,i){const n=sMe(e,r,i);return new gs(t,n)}function sMe(t,e,r){const i=t;let n,s;if(r)n=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],s=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1];else{const c=i*(1+Math.sqrt(5))/2;n=[-i,c,0,i,c,0,-i,-c,0,i,-c,0,0,-i,c,0,i,c,0,-i,-c,0,i,-c,c,0,-i,c,0,i,-c,0,-i,-c,0,i],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]}for(let c=0;c<n.length;c+=3)cT.scale(n,c,t/cT.length(n,c));let o={};function a(c,u){c>u&&([c,u]=[u,c]);const h=c.toString()+"."+u.toString();if(o[h])return o[h];let p=n.length;return n.length+=3,cT.add(n,3*c,n,3*u,n,p),cT.scale(n,p,t/cT.length(n,p)),p/=3,o[h]=p,p}for(let c=0;c<e;c++){const u=s.length,h=new Array(4*u);for(let p=0;p<u;p+=3){const f=s[p],g=s[p+1],_=s[p+2],v=a(f,g),b=a(g,_),w=a(_,f),x=4*p;h[x]=f,h[x+1]=v,h[x+2]=w,h[x+3]=g,h[x+4]=b,h[x+5]=v,h[x+6]=_,h[x+7]=w,h[x+8]=b,h[x+9]=v,h[x+10]=b,h[x+11]=w}s=h,o={}}const l=Jue(n);for(let c=0;c<l.length;c+=3)cT.normalize(l,c);return[[R.POSITION,new Ye(Jue(n),s,3,!0)],[R.NORMAL,new Ye(l,s,3,!0)]]}function oZ(t,e,r,i,n,s,o,a,l=null){const c=r?Zi(r):C(),u=e?Zi(e):Ce(0,0,1);o??(o=He());const h=i?[255*i[0],255*i[1],255*i[2],i.length>3?255*i[3]:255]:[255,255,255,255],p=n!=null&&n.length===2?n:[1,1],f=Uv(1),g=[[R.POSITION,new Ye(c,f,3,!0)],[R.NORMAL,new Ye(u,f,3,!0)],[R.UV0,new Ye(o,f,o.length)],[R.COLOR,new Ye(h,f,4,!0)],[R.SIZE,new Ye(p,f,2)]];if(s!=null&&(s=[s[0],s[1],s[2],s[3]],g.push([R.CENTEROFFSETANDDISTANCE,new Ye(s,f,4)])),a){const _=[a[0],a[1],a[2],a[3]];g.push([R.FEATUREATTRIBUTE,new Ye(_,f,4)])}return new gs(t,g,null,Cn.Point,l)}const Nst=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function H9t(t,e=Nst){const r=new Array(12);for(let c=0;c<4;c++)for(let u=0;u<3;u++)r[3*c+u]=e[c][u];const i=[0,1,2,2,3,0],n=[0,0,1],s=[0,0,0,0,0,0],o=[0,0,1,0,1,1,0,1],a=[255,255,255,255],l=[[R.POSITION,new Ye(r,i,3,!0)],[R.NORMAL,new Ye(n,s,3,!0)],[R.UV0,new Ye(o,i,2,!0)],[R.COLOR,new Ye(a,s,4,!0)]];return new gs(t,l)}function Kue(t,e,r,i,n,s=!0,o=!0){let a=0;const l=r,c=e;let u=pi(0,a,0),h=pi(0,a+c,0),p=pi(0,-1,0),f=pi(0,1,0);n&&(a=c,h=pi(0,0,0),u=pi(0,a,0),p=pi(0,1,0),f=pi(0,-1,0));const g=[h,u],_=[p,f],v=i+2,b=Math.sqrt(c*c+l*l);if(n)for(let O=i-1;O>=0;O--){const L=O*(2*Math.PI/i),z=pi(Math.cos(L)*l,a,Math.sin(L)*l);g.push(z);const k=pi(c*Math.cos(L)/b,-l/b,c*Math.sin(L)/b);_.push(k)}else for(let O=0;O<i;O++){const L=O*(2*Math.PI/i),z=pi(Math.cos(L)*l,a,Math.sin(L)*l);g.push(z);const k=pi(c*Math.cos(L)/b,l/b,c*Math.sin(L)/b);_.push(k)}const w=new Array,x=new Array;if(s){for(let O=3;O<g.length;O++)w.push(1),w.push(O-1),w.push(O),x.push(0),x.push(0),x.push(0);w.push(g.length-1),w.push(2),w.push(1),x.push(0),x.push(0),x.push(0)}if(o){for(let O=3;O<g.length;O++)w.push(O),w.push(O-1),w.push(0),x.push(O),x.push(O-1),x.push(1);w.push(0),w.push(2),w.push(g.length-1),x.push(1),x.push(2),x.push(_.length-1)}const S=mn(3*v);for(let O=0;O<v;O++)S[3*O]=g[O][0],S[3*O+1]=g[O][1],S[3*O+2]=g[O][2];const E=mn(3*v);for(let O=0;O<v;O++)E[3*O]=_[O][0],E[3*O+1]=_[O][1],E[3*O+2]=_[O][2];const A=[[R.POSITION,new Ye(S,w,3,!0)],[R.NORMAL,new Ye(E,x,3,!0)]];return new gs(t,A)}function Fst(t,e,r,i,n,s,o){const a=n?fX(n):pi(1,0,0),l=s?fX(s):pi(0,0,0);o??(o=!0);const c=kc();pe(c,a);const u=kc();ne(u,c,Math.abs(e));const h=kc();ne(h,u,-.5),fe(h,h,l);const p=pi(0,1,0);Math.abs(1-de(c,p))<.2&&ie(p,0,0,1);const f=kc();Je(f,c,p),pe(f,f),Je(p,f,c);const g=2*i+(o?2:0),_=i+(o?2:0),v=mn(3*g),b=mn(3*_),w=mn(2*g),x=new Array(3*i*(o?4:2)),S=new Array(3*i*(o?4:2));o&&(v[3*(g-2)]=h[0],v[3*(g-2)+1]=h[1],v[3*(g-2)+2]=h[2],w[2*(g-2)]=0,w[2*(g-2)+1]=0,v[3*(g-1)]=v[3*(g-2)]+u[0],v[3*(g-1)+1]=v[3*(g-2)+1]+u[1],v[3*(g-1)+2]=v[3*(g-2)+2]+u[2],w[2*(g-1)]=1,w[2*(g-1)+1]=1,b[3*(_-2)]=-c[0],b[3*(_-2)+1]=-c[1],b[3*(_-2)+2]=-c[2],b[3*(_-1)]=c[0],b[3*(_-1)+1]=c[1],b[3*(_-1)+2]=c[2]);const E=(k,q,B)=>{x[k]=q,S[k]=B};let A=0;const O=kc(),L=kc();for(let k=0;k<i;k++){const q=k*(2*Math.PI/i);ne(O,p,Math.sin(q)),ne(L,f,Math.cos(q)),fe(O,O,L),b[3*k]=O[0],b[3*k+1]=O[1],b[3*k+2]=O[2],ne(O,O,r),fe(O,O,h),v[3*k]=O[0],v[3*k+1]=O[1],v[3*k+2]=O[2],w[2*k]=k/i,w[2*k+1]=0,v[3*(k+i)]=v[3*k]+u[0],v[3*(k+i)+1]=v[3*k+1]+u[1],v[3*(k+i)+2]=v[3*k+2]+u[2],w[2*(k+i)]=k/i,w[2*k+1]=1;const B=(k+1)%i;E(A++,k,k),E(A++,k+i,k),E(A++,B,B),E(A++,B,B),E(A++,k+i,k),E(A++,B+i,B)}if(o){for(let k=0;k<i;k++){const q=(k+1)%i;E(A++,g-2,_-2),E(A++,k,_-2),E(A++,q,_-2)}for(let k=0;k<i;k++){const q=(k+1)%i;E(A++,k+i,_-1),E(A++,g-1,_-1),E(A++,q+i,_-1)}}const z=[[R.POSITION,new Ye(v,x,3,!0)],[R.NORMAL,new Ye(b,S,3,!0)],[R.UV0,new Ye(w,x,2,!0)]];return new gs(t,z)}function W9t(t,e,r,i,n,s,o=pi(0,0,0)){const a=e.length,l=mn(r.length*a*3+(6*i.length||0)),c=mn(r.length*a*3+(i?6:0)),u=new Array,h=new Array;let p=0,f=0;const g=C(),_=C(),v=C(),b=C(),w=C(),x=C(),S=C(),E=C(),A=C(),O=C(),L=C(),z=C(),k=C(),q=zr();ie(A,0,1,0),ye(_,r[1],r[0]),pe(_,_),s?(fe(E,r[0],o),pe(v,E)):ie(v,0,0,1),J6(_,v,A,A,w,v,ehe),ce(b,v),ce(z,w);for(let I=0;I<i.length;I++)ne(x,w,i[I][0]),ne(E,v,i[I][2]),fe(x,x,E),fe(x,x,r[0]),l[p++]=x[0],l[p++]=x[1],l[p++]=x[2];c[f++]=-_[0],c[f++]=-_[1],c[f++]=-_[2];for(let I=0;I<n.length;I++)u.push(n[I][0]>0?n[I][0]:-n[I][0]-1+i.length),u.push(n[I][1]>0?n[I][1]:-n[I][1]-1+i.length),u.push(n[I][2]>0?n[I][2]:-n[I][2]-1+i.length),h.push(0),h.push(0),h.push(0);let B=i.length;const J=i.length-1;for(let I=0;I<r.length;I++){let F=!1;I>0&&(ce(g,_),I<r.length-1?(ye(_,r[I+1],r[I]),pe(_,_)):F=!0,fe(O,g,_),pe(O,O),fe(L,r[I-1],b),FI(r[I],O,q),R2(q,eh(L,g),E)?(ye(E,E,r[I]),pe(v,E),Je(w,O,v),pe(w,w)):J6(O,b,z,A,w,v,ehe),ce(b,v),ce(z,w)),s&&(fe(E,r[I],o),pe(k,E));for(let G=0;G<a;G++)if(ne(x,w,e[G][0]),ne(E,v,e[G][1]),fe(x,x,E),pe(S,x),c[f++]=S[0],c[f++]=S[1],c[f++]=S[2],fe(x,x,r[I]),l[p++]=x[0],l[p++]=x[1],l[p++]=x[2],!F){const H=(G+1)%a;u.push(B+G),u.push(B+a+G),u.push(B+H),u.push(B+H),u.push(B+a+G),u.push(B+a+H);for(let Z=0;Z<6;Z++){const te=u.length-6;h.push(u[te+Z]-J)}}B+=a}const W=r[r.length-1];for(let I=0;I<i.length;I++)ne(x,w,i[I][0]),ne(E,v,i[I][1]),fe(x,x,E),fe(x,x,W),l[p++]=x[0],l[p++]=x[1],l[p++]=x[2];const Y=f/3;c[f++]=_[0],c[f++]=_[1],c[f++]=_[2];const le=B-a;for(let I=0;I<n.length;I++)u.push(n[I][0]>=0?B+n[I][0]:-n[I][0]-1+le),u.push(n[I][2]>=0?B+n[I][2]:-n[I][2]-1+le),u.push(n[I][1]>=0?B+n[I][1]:-n[I][1]-1+le),h.push(Y),h.push(Y),h.push(Y);const D=[[R.POSITION,new Ye(l,u,3,!0)],[R.NORMAL,new Ye(c,h,3,!0)]];return new gs(t,D)}function q9t(t,e,r,i){pt(e.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),pt(e[0].length===3,"createPolylineGeometry(): malformed vertex"),pt(r==null||r.length===e.length,"createPolylineGeometry: need same number of points and normals"),pt(r==null||r[0].length===3,"createPolylineGeometry(): malformed normal");const n=xo(3*e.length),s=new Array(2*(e.length-1));let o=0,a=0;for(let c=0;c<e.length;c++){for(let u=0;u<3;u++)n[o++]=e[c][u];c>0&&(s[a++]=c-1,s[a++]=c)}const l=[[R.POSITION,new Ye(n,s,3,!0)]];if(r){const c=mn(3*r.length);let u=0;for(let h=0;h<e.length;h++)for(let p=0;p<3;p++)c[u++]=r[h][p];l.push([R.NORMAL,new Ye(c,s,3,!0)])}return i&&l.push([R.COLOR,new Ye(i,B2(i.length/4),4)]),new gs(t,l,null,Cn.Line)}function kst(t,e=t){const r=t.attributes,i=r.get(R.POSITION).data,n=r.get(R.NORMAL).data;if(n){const s=e.getMutableAttribute(R.NORMAL).data;for(let o=0;o<n.length;o+=3){const a=n[o+1];s[o+1]=-n[o+2],s[o+2]=a}}if(i){const s=e.getMutableAttribute(R.POSITION).data;for(let o=0;o<i.length;o+=3){const a=i[o+1];s[o+1]=-i[o+2],s[o+2]=a}}}function ZV(t,e,r,i,n){return!(Math.abs(de(e,t))>n)&&(Je(r,t,e),pe(r,r),Je(i,r,t),pe(i,i),!0)}function J6(t,e,r,i,n,s,o){return ZV(t,e,n,s,o)||ZV(t,r,n,s,o)||ZV(t,i,n,s,o)}const ehe=.99619469809;let zst=class{constructor(e,r){this.type=wa.Local,this._configuration=new ure,this._passParameters=new oU,this._configuration.geometry=hg.Cylinder,this._technique=r.techniqueRepository.acquire(q6,this._configuration);const i=r.renderContext.rctx;this._vao=this._createVertexArrayObject(i),this._vaoCount=k0(this._vao,"geometry");const n=new ri;n.wrapMode=Jt.CLAMP_TO_EDGE,n.flipped=!0,n.width=1,n.height=512,this._passParameters.texture=new Sr(i,n,sst)}destroy(){this._passParameters.texture=gt(this._passParameters.texture),this._vao.dispose(),this._technique.release()}render(e){const r=e.rctx,i=r.bindTechnique(this._technique,e.bindParameters,this._passParameters);Ust(the,e.bindParameters.camera.viewMatrix),i.setUniformMatrix4fv("view",the),r.bindVAO(this._vao),i.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(sr.TRIANGLES,0,this._vaoCount)}renderHaze(){return!1}_createVertexArrayObject(e){const r=sMe(1,2,!1),{data:i,indices:n}=r[0][1],s=rhe.createBuffer(n.length),o=s.position;for(let a=0;a<n.length;++a){const l=3*n[a%3==0?a+2:a%3==2?a-2:a];o.set(a,0,i[l]),o.set(a,1,i[l+1]),o.set(a,2,i[l+2])}return new _f(e,Mr,{geometry:ou(rhe)},{geometry:Wr.createVertex(e,Ar.STATIC_DRAW,s.buffer)})}};function Ust(t,e){Zn(t,e),t[12]=0,t[13]=0,t[14]=0,t[15]=1}const the=xe(),rhe=Qi().vec3f(R.POSITION),Bst=new Uint8ClampedArray([0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,16,0,0,0,16,0,0,0,16,0,0,0,17,0,0,0,17,0,0,0,18,0,0,0,18,0,0,0,19,0,0,0,19,0,0,0,19,0,0,0,20,0,0,0,20,0,0,0,21,0,0,0,21,0,0,0,22,0,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,28,9,0,0,28,9,0,0,29,9,0,0,29,8,0,0,30,8,0,0,30,8,0,0,31,8,0,0,31,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,33,8,0,0,33,8,0,0,34,7,0,0,35,7,0,0,35,7,0,0,36,7,0,0,36,7,7,0,37,7,7,0,37,7,7,0,38,7,7,0,38,13,7,0,39,13,7,0,39,13,6,0,40,13,6,0,40,12,6,0,41,12,6,0,41,12,6,0,41,12,6,0,42,12,6,0,42,12,6,0,43,12,6,0,43,12,6,0,44,12,6,0,44,11,6,0,45,11,6,6,45,11,6,6,46,11,5,5,47,11,5,5,47,11,5,5,48,11,5,5,48,10,5,5,49,10,5,5,49,10,5,5,50,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,52,15,5,5,52,14,5,5,53,14,5,5,54,14,5,5,54,14,5,5,55,14,5,5,55,14,5,5,56,13,4,4,57,13,4,4,57,13,4,4,58,13,4,4,58,13,4,4,59,13,4,4,59,17,4,4,60,17,4,4,60,17,4,4,60,17,4,4,61,17,4,4,61,16,4,4,62,16,4,4,63,16,4,4,63,16,8,4,64,16,8,4,64,16,8,4,65,15,8,4,66,15,8,4,66,15,8,4,67,19,8,4,68,19,8,4,68,18,7,4,69,18,7,4,69,18,7,4,69,18,7,4,70,18,7,4,70,18,7,4,71,18,7,4,71,18,7,4,72,17,7,3,73,17,7,3,73,21,7,3,74,21,7,3,74,20,7,3,75,20,7,3,76,20,7,3,76,20,7,3,77,20,7,3,77,20,7,3,78,20,7,3,78,20,7,7,78,19,6,6,79,19,10,6,80,19,10,6,80,22,9,6,81,22,9,6,81,22,9,6,82,22,9,6,83,22,9,6,83,21,9,6,84,21,9,6,84,21,9,6,85,21,9,6,86,21,9,6,86,23,9,6,87,23,9,6,87,23,9,6,87,23,9,6,88,23,9,6,88,23,9,6,89,23,8,6,90,23,8,6,90,22,8,6,91,22,8,6,91,25,8,6,92,25,8,5,93,25,8,5,93,24,8,5,94,24,8,5,94,24,11,5,95,24,11,5,96,24,11,5,96,26,11,5,97,26,11,5,97,26,11,5,97,26,10,5,98,26,10,5,98,26,10,5,99,25,10,5,100,25,10,5,100,25,10,5,101,25,10,5,101,25,10,5,102,27,10,5,103,27,10,5,103,27,10,5,104,27,10,5,104,27,12,5,105,26,12,5,106,26,12,5,106,29,12,5,106,29,12,5,106,29,12,7,107,28,12,7,108,28,12,7,108,28,12,7,109,28,12,7,109,30,12,7,110,30,11,7,111,30,11,7,111,30,11,7,112,30,11,7,112,29,11,7,113,29,11,7,114,29,11,7,114,31,11,7,115,31,11,7,115,31,11,7,115,31,11,7,116,31,11,7,116,33,13,7,117,33,13,9,117,32,13,9,118,32,13,9,118,32,13,9,119,34,15,8,120,34,15,8,120,34,15,8,121,36,15,8,121,36,15,8,122,36,15,8,122,35,15,8,123,37,14,8,124,37,14,8,124,37,14,8,124,37,14,8,124,39,14,8,125,39,16,8,125,38,16,8,126,38,16,8,127,38,16,8,127,40,16,10,128,40,16,10,128,40,16,10,129,42,18,10,129,41,18,10,130,41,18,10,130,43,18,10,131,43,18,10,131,42,17,10,132,42,17,12,132,42,17,12,133,44,17,12,133,44,17,12,133,46,17,11,134,46,17,11,134,45,19,11,135,45,19,11,135,47,19,11,136,47,19,11,136,47,19,11,137,47,19,11,137,48,20,11,138,48,20,11,138,50,20,13,139,50,20,13,139,49,20,13,140,49,22,13,140,51,22,13,141,51,22,13,141,50,22,13,142,52,22,13,142,52,21,12,143,53,21,12,143,53,21,12,143,53,21,12,143,53,21,14,144,53,23,14,144,55,23,14,145,55,23,14,145,56,23,14,146,56,23,14,146,57,24,14,147,57,24,14,147,59,24,16,148,59,24,16,148,58,24,15,149,58,26,15,149,58,26,15,149,60,26,15,150,60,26,15,150,61,25,15,151,61,25,15,151,62,25,17,152,62,25,17,152,64,25,17,152,64,27,17,152,63,27,17,153,63,27,17,153,65,27,17,153,66,28,17,154,66,28,17,154,67,28,16,155,67,28,16,155,67,30,16,155,69,29,18,156,69,29,18,156,68,29,18,157,70,29,18,157,70,29,18,157,71,31,18,158,71,31,18,158,72,30,19,159,72,30,19,159,74,30,19,159,73,30,19,160,73,32,19,160,74,32,19,161,74,32,21,161,76,32,21,161,78,33,21,161,78,33,21,161,79,35,20,162,78,34,20,163,79,34,22,164,81,36,22,164,82,36,22,165,81,35,22,166,82,37,21,167,84,37,21,167,85,36,21,168,86,38,23,169,88,38,23,169,88,38,23,170,88,39,23,170,89,39,24,171,91,40,24,171,92,40,24,172,93,40,24,173,94,41,25,173,95,41,25,174,96,42,25,175,98,42,25,175,99,43,26,176,99,43,26,177,101,45,26,177,102,44,26,178,103,46,27,179,104,46,27,179,105,46,27,179,106,45,28,180,108,47,28,180,108,46,28,181,109,48,28,182,111,48,29,182,111,49,29,183,114,49,29,184,114,50,30,184,114,50,30,185,116,51,30,185,117,51,30,186,119,52,31,187,119,53,31,187,121,53,31,188,122,54,33,188,123,54,32,189,124,55,32,189,125,55,32,189,126,56,34,190,128,56,34,190,128,57,33,191,130,57,33,191,131,58,35,192,131,58,35,192,133,59,34,193,134,60,35,194,135,60,35,194,136,61,37,195,139,61,37,195,139,62,36,196,141,62,36,196,141,63,38,197,142,63,38,197,143,64,39,198,144,64,39,198,146,66,39,198,146,67,39,198,147,67,38,199,147,68,40,199,149,68,40,200,150,69,40,200,152,70,41,201,154,71,41,201,154,71,42,202,155,72,42,202,156,73,41,203,157,73,43,203,158,74,42,204,160,75,44,204,161,76,44,204,162,77,44,205,164,77,45,205,165,78,45,206,166,79,45,206,168,80,46,207,169,81,46,207,170,83,47,207,171,83,47,207,172,83,47,207,174,85,48,208,175,85,48,208,177,85,48,209,178,87,49,209,180,87,49,210,181,87,49,210,182,89,50,210,182,89,50,211,185,91,50,211,186,91,51,212,186,93,51,212,189,94,52,212,190,95,51,213,192,96,51,213,193,96,53,213,194,97,52,214,195,98,54,214,197,98,55,215,198,100,55,215,199,101,55,215,200,102,55,216,202,103,55,216,203,104,55,216,204,105,57,216,205,106,57,216,207,107,58,216,208,108,58,217,209,109,59,217,210,110,60,217,211,111,60,218,212,112,61,218,213,113,61,218,214,114,62,219,217,115,63,219,217,116,64,219,218,118,64,220,219,119,65,220,220,121,66,220,222,121,67,221,222,122,67,221,222,123,68,221,223,124,69,222,224,125,70,222,225,127,71,222,226,128,72,223,228,129,73,223,228,130,74,223,229,132,75,223,230,135,79,224,231,138,81,224,233,141,84,224,233,144,87,225,235,147,91,225,236,150,94,225,237,154,97,225,238,158,102,225,239,161,107,225,239,165,110,225,240,168,114,226,241,172,118,226,241,176,122,226,241,181,126,226,242,183,130,227,243,186,135,227,243,190,139,227,244,194,143,227,244,197,147,228,244,200,150,228,245,204,154,228,245,207,157,228,245,210,161,229,246,212,164,229,246,215,167,229,246,217,169,229,246,220,172,230,247,221,174,230]),HD=128,ihe=-oX,nhe=0,JV=50,Vst=()=>1-511/512,Gst=w5([[50,.1015625],[500,.21875],[5e3,1-250/512],[5e4,.4140625]]);let jst=class{constructor(e,r){this.view=e,this.type=wa.Mars,this._passParameters=new oU,this._vaoCount=0,this._texV1=1;const i=Br(e.spatialReference);this._planetRadius=i.radius,this._outerRimWidth=i.outerAtmosphereRimWidth,this._innerRimFactor=(this._planetRadius+ihe)/this._planetRadius,this._middleRimFactor=(this._planetRadius+nhe)/this._planetRadius,this._outerRimFactor=(this._planetRadius+this._outerRimWidth)/this._planetRadius,this._texV0=nhe/this._outerRimWidth,this._texVScale=this._texV1-this._texV0,this._techniqueRepository=r.techniqueRepository;const n=r.renderContext.rctx;this._cameraChangeHandle=he(()=>{var a;return(a=this.view.state)==null?void 0:a.camera},()=>r.requestRender(),Kr),this._vao=this._createRibbon(n),this._vaoCount=k0(this._vao,"geometry"),this._fadeVao=wg(n),this._fadeVaoCount=k0(this._fadeVao,"geometry");const s=new ri;s.wrapMode=Jt.CLAMP_TO_EDGE,s.flipped=!0,s.width=1,s.height=512,this._passParameters.texture=new Sr(n,s,Bst);const o=new ure;o.geometry=hg.Cone,this._coneTechnique=this._techniqueRepository.acquire(q6,o),o.geometry=hg.Underground,this._undergroundTechnique=this._techniqueRepository.acquire(q6,o)}destroy(){this._coneTechnique.release(),this._undergroundTechnique.release(),this._cameraChangeHandle.remove(),this._passParameters.texture=gt(this._passParameters.texture),this._fadeVao.dispose(),this._vao.dispose()}render(e){const r=e.bindParameters.camera;this._update(r);const i=e.rctx;this._passParameters.undergroundFadeAlpha<1&&(i.bindTechnique(this._coneTechnique,e.bindParameters,this._passParameters),i.bindVAO(this._vao),i.drawArrays(sr.TRIANGLES,0,this._vaoCount)),this._passParameters.undergroundFadeAlpha>0&&(i.bindTechnique(this._undergroundTechnique,e.bindParameters,this._passParameters),i.bindVAO(this._fadeVao),i.drawArrays(sr.TRIANGLE_STRIP,0,this._fadeVaoCount))}renderHaze(){}_update(e){const r=C(),i=this._planetRadius,n=Te(e.eye),s=n-i;if(s<0){const f=Math.min(-s/5e3,1);this._passParameters.undergroundFadeAlpha=f}else this._passParameters.undergroundFadeAlpha=0;const o=Math.max(JV,s),a=i+ihe;this._passParameters.innerScale=Hst(i+o,i,a)-1,this._passParameters.altitudeFade=qte(s),ne(r,e.eye,(i+JV)/n),she(r,e.center,e.up,i,this._passParameters.silhouette);const l=this._computeScreenRimWidth(e,r,e.up,this._passParameters.silhouette),c=Vst(),u=Gst(s);let h=this._texV0+c*this._texVScale,p=this._texV0+l*u*this._texVScale;if(s>JV){she(e.eye,e.center,e.up,i,this._passParameters.silhouette);const f=this._computeScreenRimWidth(e,e.eye,e.up,this._passParameters.silhouette),g=we((f-1.5)/(l-1.5),0,1);h=this._texV0+g*c*this._texVScale,p=this._texV0+Rt(this._texV1,l*u,g)*this._texVScale}cr(this._passParameters.texV,h,p)}_createRibbon(e){const r=mn(3+3*HD*3),i=new Uint32Array(3*HD*5);r[0]=0,r[1]=0,r[2]=-1;for(let o=0;o<HD;o++){const a=9*o+3;r[a]=o,r[a+1]=this._innerRimFactor,r[a+2]=-1,r[a+3]=o,r[a+4]=this._middleRimFactor,r[a+5]=0,r[a+6]=o,r[a+7]=this._outerRimFactor,r[a+8]=1;const l=3*o+1,c=o===HD-1?1:l+3,u=15*o;i[u]=l,i[u+1]=l+1,i[u+2]=c+1,i[u+3]=c+1,i[u+4]=c,i[u+5]=l,i[u+6]=l+1,i[u+7]=l+2,i[u+8]=c+2,i[u+9]=c+2,i[u+10]=c+1,i[u+11]=l+1,i[u+12]=l,i[u+13]=c,i[u+14]=0}const n=ohe.createBuffer(i.length),s=n.position;for(let o=0;o<i.length;++o){const a=3*i[o];s.set(o,0,r[a]),s.set(o,1,r[a+1]),s.set(o,2,r[a+2])}return new _f(e,Mr,{geometry:ou(ohe)},{geometry:Wr.createVertex(e,Ar.STATIC_DRAW,n.buffer)})}_computeScreenRimWidth(e,r,i,n){return fe(dT,n.center,n.v2),ne(WD,dT,this._outerRimFactor),t9(QV,r,dT,i),pue(dT,QV,e.projectionMatrix,e.viewport,dT),pue(WD,QV,e.projectionMatrix,e.viewport,WD),Di(dT,WD)/e.height}};function she(t,e,r,i,n){const s=Te(t),o=i*Math.sqrt(s*s-i*i)/s,a=Math.sqrt(i*i-o*o),l=n.v1,c=n.v2;return ne(n.center,t,a/s),Je(l,t,e),Ra(l)<1&&Je(l,t,r),ne(l,l,o/Te(l)),Je(c,l,t),ne(c,c,o/Te(c)),o}const QV=xe(),dT=C(),WD=C();function Hst(t,e,r){return t*t/(Math.sqrt(t*t-e*e)*Math.sqrt(t*t-r*r)+e*r)}const ohe=Qi().vec3f(R.POSITION);var ay;(function(t){t[t.Rain=0]="Rain",t[t.Snow=1]="Snow",t[t.COUNT=2]="COUNT"})(ay||(ay={}));let aZ=class extends cc{constructor(){super(...arguments),this.type=ay.Rain}};d([j({count:ay.COUNT})],aZ.prototype,"type",void 0);function oMe(t){const e=new Or;return e.attributes.add(R.POSITION,"vec3"),e.attributes.add(R.INSTANCEFEATUREATTRIBUTE,"float"),e.vertex.uniforms.add(new Ft("cameraPosition",(r,i)=>i.camera.eye)),e.vertex.uniforms.add(new Ft("offset",(r,i)=>Wst(r,i))),e.vertex.uniforms.add(new $e("width",r=>r.width)),e.vertex.uniforms.add(new ln("proj",(r,i)=>i.camera.projectionMatrix)),e.vertex.uniforms.add(new ln("view",(r,i)=>i.camera.viewMatrix)),e.vertex.uniforms.add(new $e("time",r=>r.time)),e.varyings.add("vUv","vec2"),e.vertex.code.add(T`
    vec3 hash31(float p){
      vec3 p3 = fract(vec3(p) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return fract((p3.xxy + p3.yzz) * p3.zyx);
    }

    float hash11(float p){
      p = fract(p * 0.1031);
      p *= p + 33.33;
      p *= p + p;
      return fract(p);
    }

    //https://www.geeks3d.com/20141201/how-to-rotate-a-vertex-by-a-quaternion-in-glsl/
    vec3 rotateVectorByQuaternion(vec3 v, vec4 q){
      return 2.0 * cross(q.xyz, v * q.w + cross(q.xyz, v)) + v;
    }

    void main(void) {

      vUv = position.xz;

      vec3 rand = hash31(instanceFeatureAttribute);

      // Set random position for all particles
      // The hash function space is not high resolution so offset particles by an additional random value
      // This creates grids of 1000 particles which are shifted by random hundreths of the tile width
      // overlaying multiple identical but offset grids
      vec3 randomPosition = 2.0 * (rand + (0.01 + 0.01 * rand) * floor(0.001 * instanceFeatureAttribute)) - 1.0;

      // Random orientation of rain drops
      float angle = 3.1415 * hash11(instanceFeatureAttribute);

      vec3 up = vec3(0, 0, 1);

      // Gravity and wind direction
      vec3 direction = normalize(cameraPosition);

      vec3 tangent = normalize(cross(direction, up));

      // Gravity
      vec3 animatedPos = randomPosition + direction * -time;

      // Rain particles fall straight down and are randomly oriented
      // Snow particles have random sinusoid trajectories and are rotated to face the camera
      ${t.type===ay.Rain?T`
            // Random rotation for particle
            vec3 rotationAxis = up;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));
            vec3 transformedPos = rotateVectorByQuaternion(vec3(0.2, 0.2, 4.0) * (position - vec3(0.5, 0.0, 0.5)), quat);

            // Rotate particle to planetary position
            rotationAxis = tangent;
            angle = 0.5 * -acos(dot(direction, up));
            quat = vec4(rotationAxis * sin(angle), cos(angle));
            transformedPos = rotateVectorByQuaternion(transformedPos, quat);

            vec4 pos = mat4(mat3(view)) * vec4(transformedPos + (mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * pos;
      `:T`
            vec3 rotationAxis = direction;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));

            tangent = rotateVectorByQuaternion(tangent, quat);
            // Random sinusoid from friction
            animatedPos += tangent * 0.25 * sin(dot(animatedPos, direction));
            vec4 pos = mat4(mat3(view)) * vec4((mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * (0.5 * vec4(position.xzy, 0.0) + pos);
      `}
    }
  `),e.fragment.uniforms.add(new $e("opacity",r=>r.opacity),new Ft("particleColor",(r,i)=>qst(i,t))),e.fragment.code.add(T`
    void main() {

      // Cut off corners of the triangle
      if(vUv.x < 0.0 || vUv.y < 0.0){
        discard;
      }

      float d = length(vUv - vec2(0.5));

      ${t.type===ay.Rain?T`d = 0.35 * smoothstep(0.5, 0.0, d);`:T`d = smoothstep(0.5, 0.1, d);`}
      fragColor = opacity * vec4(particleColor * d, d);
    }
  `),e}function Wst(t,e){const r=e.camera.eye,i=.5*t.width,n=1/t.width,s=vxe(lZ,ie(lZ,(r[0]+i)*n,(r[1]+i)*n,(r[2]+i)*n));return Yi(s,r,ne(s,s,t.width))}function qst(t,e){const r=e.type===ay.Rain?Xst:Yst,i=ne(lZ,r,Zst),n=t.camera.eye;pe(ahe,n);const s=Math.max(0,de(ahe,t.lighting.mainLight.direction));return ni(i,i,r,s)}const lZ=C(),ahe=C(),Yst=Ce(1,1,1),Xst=Ce(.85,.85,.85),Zst=.7,Jst=Object.freeze(Object.defineProperty({__proto__:null,build:oMe},Symbol.toStringTag,{value:"Module"}));let Qst=class extends Ai{constructor(){super(...arguments),this.time=0,this.radius=1,this.width=500,this.opacity=1}},cZ=class aMe extends Vr{initializeProgram(e){return new Lr(e.rctx,aMe.shader.get().build(this.configuration),lF)}initializePipeline(){return kt({blending:Wo(Se.ONE,Se.ONE,Se.ONE_MINUS_SRC_ALPHA,Se.ONE_MINUS_SRC_ALPHA),depthTest:{func:Xr.LEQUAL},colorWrite:Yt})}};cZ.shader=new Ir(Jst,()=>ge(()=>Promise.resolve().then(()=>UNt),void 0));const lF=new Map([[R.POSITION,0],[R.INSTANCEFEATUREATTRIBUTE,1]]);let lMe=class{constructor(){this.enabled=!0,this._time=0}get time(){return this._time}advance({deltaTime:e,fixedTime:r}){return r!=null?this._time!==r&&(this._time=r,!0):(this._time=this._time+e,e!==0)}},Kst=class{constructor(e,r){this.deltaTime=e,this.fixedTime=r}},yw=class extends Ae{constructor(e){super(e),this._numParticles=25e4,this._rainSpeed=.1,this._snowSpeed=.01,this._passParameters=new Qst,this._animation=new lMe,this._updatingTracking=new Jp,this._passParameters.time=0,this._passParameters.radius=Br(e.view.spatialReference).radius,this._techniqueRepository=e.context.techniqueRepository}destroy(){this._updatingTracking.destroy(),this._numParticles=0,this._snowTechniqueCached=tr(this._snowTechniqueCached),this._rainTechniqueCached=tr(this._rainTechniqueCached),this._vao=gt(this._vao),this._instanceIdBuffer=gt(this._instanceIdBuffer)}get updating(){return this._updatingTracking.updating}get _rainTechnique(){if(this._rainTechniqueCached==null){const e=new aZ;e.type=ay.Rain,this._rainTechniqueCached=this._techniqueRepository.acquire(cZ,e)}return this._rainTechniqueCached}get _snowTechnique(){if(this._snowTechniqueCached==null){const e=new aZ;e.type=ay.Snow,this._snowTechniqueCached=this._techniqueRepository.acquire(cZ,e)}return this._snowTechniqueCached}update(e){return this._animation.advance(e)}render(e,r,i){const n=i==="rainy"?this._rainTechnique:this._snowTechnique;if(!n.compiled)return void this.context.requestRender();const s=e.rctx;if(this._ensureResources(s),n==null||this._vao==null||this._instanceIdBuffer==null||(e.bindParameters.cloudsFade.data!=null&&(this._passParameters.opacity=e.bindParameters.cloudsFade.opacity),this._passParameters.opacity<=0))return;const o=.35;r=r<.5?Rt(0,o,2*r):Rt(o,1,2*(r-.5)),this._passParameters.time=(i==="rainy"?this._rainSpeed:this._snowSpeed)*OK(this._animation.time)%1e5;const a=s.bindTechnique(n,e.bindParameters,this._passParameters);s.bindVAO(this._vao),a.assertCompatibleVertexAttributeLocations(this._vao),Zte(s,lF,this._instanceIdBuffer,lhe,0),s.drawArraysInstanced(sr.TRIANGLES,0,3,this._numParticles*r),zPe(s,lF,this._instanceIdBuffer,lhe)}_ensureResources(e){this._vao==null&&(this._vao=this._createVertexArrayObject(e)),this._instanceIdBuffer==null&&(this._instanceIdBuffer=this._createInstanceIndices(e))}_createInstanceIndices(e){const r=[];for(let i=0;i<this._numParticles;i++)r.push(i);return Wr.createVertex(e,Ar.STATIC_DRAW,new Float32Array(r))}_createVertexArrayObject(e){const r=new Float32Array([-1,0,1,1,0,-1,1,0,1]);return new _f(e,lF,{geometry:ou(eot)},{geometry:Wr.createVertex(e,Ar.STATIC_DRAW,r)})}};d([m({constructOnly:!0})],yw.prototype,"context",void 0),d([m({constructOnly:!0})],yw.prototype,"view",void 0),d([m({readOnly:!0})],yw.prototype,"updating",null),d([m()],yw.prototype,"_updatingTracking",void 0),yw=d([V("esri.views.3d.environment.Precipitation")],yw);const eot=Qi().vec3f(R.POSITION),lhe=ou(Qi().f32(R.INSTANCEFEATUREATTRIBUTE),1);function cMe(){const t=new Or;return t.attributes.add(R.POSITION,"vec3"),t.attributes.add(R.COLOR,"vec4"),t.attributes.add(R.SIZE,"float"),t.varyings.add("vcolor","vec4"),t.varyings.add("vsize","float"),t.vertex.uniforms.add(new ln("transform",(e,r)=>tot(e,r)),new xr("viewport",(e,r)=>r.camera.fullViewport),new $e("pixelRatio",(e,r)=>r.camera.pixelRatio)),t.vertex.code.add(T`void main(void) {
gl_Position = transform * vec4(position, 0);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;
}`),t.fragment.code.add(T`void main() {
float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
fragColor = vec4(vcolor.xyz, intensity);
}`),t}function tot(t,e){return Zn(Yy,e.camera.projectionMatrix),Yy[10]=24e-8-1,Yy[11]=-1,Yy[14]=(24e-8-2)*e.camera.near,Hr(Yy,Yy,e.camera.viewMatrix),Hr(Yy,Yy,t.modelMatrix)}const Yy=xe(),rot=Object.freeze(Object.defineProperty({__proto__:null,build:cMe},Symbol.toStringTag,{value:"Module"}));let iot=class extends Ai{constructor(){super(...arguments),this.modelMatrix=xe()}},uMe=class hMe extends Vr{constructor(e){super(e,new cc,()=>this.destroy())}initializeProgram(e){return new Lr(e.rctx,hMe.shader.get().build(),Mr)}initializePipeline(){return kt({blending:Wo(Se.SRC_ALPHA,Se.ONE,Se.ONE_MINUS_SRC_ALPHA,Se.ONE_MINUS_SRC_ALPHA),depthTest:{func:Xr.LEQUAL},colorWrite:Yt})}};uMe.shader=new Ir(rot,()=>ge(()=>Promise.resolve().then(()=>BNt),void 0));let F_=class extends Ae{get updating(){return this._updatingTracking.updating||this.loading}get loading(){return this._loadDataTask!=null&&!this._loadDataTask.finished}constructor(e){super(e),this._loadDataTask=null,this._numPoints=0,this._passParameters=new iot,this._updatingTracking=new Jp}initialize(){this._loadDataTask=this._createLoadDataTask()}destroy(){this._loadDataTask=wl(this._loadDataTask),this._updatingTracking.destroy(),this._numPoints=0,this._technique=tr(this._technique),this._vao=gt(this._vao),ob=null}render(e){const{rctx:r}=e;if(this._ensureResources(r),this._technique==null||this._vao==null)return;if(!this._technique.compiled)return void this.requestRender();const i=r.bindTechnique(this._technique,e.bindParameters,this._passParameters);r.bindVAO(this._vao),i.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(sr.POINTS,0,this._numPoints)}_ensureResources(e){if(this._technique!=null||ob==null)return;this._technique=new uMe({rctx:e,viewingMode:this.view.state.viewingMode}),this._numPoints=ob.byteLength/che;const r=new Float32Array(ob,0,2*this._numPoints),i=new Uint8Array(ob,2*this._numPoints*4,this._numPoints);this._vao=this._createVertexArrayObject(e,r,i,this._numPoints),this._updatingTracking.add(()=>this.view.environment.lighting.type!=="virtual"?this.view.environment.lighting.date:null,n=>this._update(n),gi)}_computeDayDuration(e){const r=e,i=new Date(e.getFullYear(),0,1,11,58,56);return(+r-+i)/(+new Date(e.getFullYear()+1,0,1,11,58,55)-+i)}_update(e){if(!e)return;const r=(e.getHours()/12+e.getMinutes()/60*(2/24)+e.getSeconds()/60*(2/1440)-.9972222)%2,i=2*this._computeDayDuration(e),n=Zn(this._passParameters.modelMatrix,oot);DE(n,n,-i*Math.PI),Hr(n,sot,n),DE(n,n,-r*Math.PI),this.requestRender()}_hexToRGB(e){return[parseInt(e.substring(0,2),16),parseInt(e.substring(2,4),16),parseInt(e.substring(4,6),16)]}_unpackUint8Attributes(e){return e>=192?[2.9,e-192]:e>=160?[2.5,e-160]:e>=128?[2,e-128]:e>=96?[1.5,e-96]:e>=64?[1,e-64]:e>=32?[.7,e-32]:[.4,e]}_createVertexArrayObject(e,r,i,n){const s=uhe.createBuffer(n),o=s.position,a=s.color,l=s.size;for(let c=0;c<n;c++){const u=r[2*c],h=r[2*c+1];o.set(c,0,-Math.cos(u)*Math.sin(h)),o.set(c,1,-Math.sin(u)*Math.sin(h)),o.set(c,2,-Math.cos(h));const p=this._unpackUint8Attributes(i[c]),f=this._hexToRGB(not[p[1]]);a.set(c,0,255*f[0]),a.set(c,1,255*f[1]),a.set(c,2,255*f[2]),a.set(c,3,255),l.set(c,p[0])}return new _f(e,Mr,{geometry:ou(uhe)},{geometry:Wr.createVertex(e,Ar.STATIC_DRAW,s.buffer)})}_createLoadDataTask(){if(ob!=null)return null;const e=dy(async r=>{const{data:i}=await OBe("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:r});this._verifyStarData(i),ob=i});return e.promise.catch(r=>{_s(r)||re.getLogger(this).error(r)}).then(()=>{this.destroyed||(this.requestRender(),this.notifyChange("updating"))}),e}_verifyStarData(e){if(!e)throw new K("stars:no-data-received","Failed to create stars because star catalogue is missing");const r=e.byteLength/che;if(r%1!=0||r>5e4||r<5e3)throw new K("stars:invalid-data","Failed to create stars because star catalogue data is invalid")}};d([m({constructOnly:!0})],F_.prototype,"view",void 0),d([m({constructOnly:!0})],F_.prototype,"requestRender",void 0),d([m({readOnly:!0})],F_.prototype,"updating",null),d([m()],F_.prototype,"_loadDataTask",void 0),d([m()],F_.prototype,"_updatingTracking",void 0),F_=d([V("esri.views.3d.environment.Stars")],F_);const not=["9bb2ff","9eb5ff","aabfff","bbccff","ccd8ff ","dae2ff","e4e9ff","eeefff","f8f6ff","fff9fb","fff5ef","fff1e5","ffeddb","ffe9d2","ffe6ca","ffe3c3","ffe0bb","ffddb4","ffdaad","ffd6a5","ffd29c","ffcc8f","ffc178","ffa94b","ff7b00"],sot=Uee(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),oot=Uee(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),che=9,uhe=Qi().vec3f(R.POSITION).vec4u8(R.COLOR).f32(R.SIZE);let ob=null;const mU={required:[]},dMe={required:[U.LinearDepth]},pMe={required:[U.CompositeColor]},fMe={required:[U.Highlight]},aot={required:[U.Depth,U.Normal]};let gU=class extends Ae{consumes(){return mU}get usedMemory(){return 0}get isDecoration(){return!1}get running(){return!1}get materialReference(){return null}modify(e){}get numGeometries(){return 0}get hasOccludees(){return!1}queryRenderOccludedState(e){return!1}},V2=class extends gU{},mMe=class extends gU{constructor(){super(...arguments),this.drapedPriority=0}},lot=class extends gU{},cot=class extends gU{};function uZ(t){return"prepareTechnique"in t}function hhe(t){return"prepareTechniques"in t}var nE;(function(t){t[t.Immediate=0]="Immediate",t[t.Faded=1]="Faded"})(nE||(nE={}));var RM;let Zo=RM=class extends V2{constructor(t){super(t),this.produces=new Map([[ue.ENVIRONMENT_OPAQUE,()=>!(this._atmosphere===null&&this._stars===null)],[ue.ENVIRONMENT_TRANSPARENT,()=>this._atmosphere!==null]]),this._context=null,this._atmosphere=null,this._oldWeatherParameters=new KV,this._newWeatherParameters=new KV,this._fadedWeatherParameters=new KV,this._weatherParameters=this._newWeatherParameters}initialize(){this.view._stage.addRenderPlugin(this)}destroy(){var t;this.removeHandles(),this.uninitializeRenderContext(),((t=this.view)==null?void 0:t._stage)!=null&&this.view._stage.removeRenderPlugin(this),this._set("view",null)}get atmosphere(){return this._atmosphere}get _atmosphereType(){return this.atmosphere!=null?this.atmosphere.type:wa.None}consumes(){return this._atmosphereType===wa.Realistic?dMe:mU}updateAnimation(t){return this._precipitation!=null&&this._precipitation.update(t)}get updating(){return this._stars!=null&&this._stars.updating||this._clouds!=null&&this._clouds.running}get weatherVisible(){return Te(this.view.state.camera.eye)-Br(this.view.spatialReference).radius<=b0}get usedMemory(){var t;return((t=this._clouds)==null?void 0:t.usedMemory)??0}get _stars(){var i;const t=this.view,e=((i=t.environment)==null?void 0:i.starsEnabled)??!1,r=this._get("_stars");return e&&this._context!=null?r??new F_({view:t,requestRender:()=>this._setNeedsRender()}):(Pe(r),null)}get _precipitation(){const t=this._get("_precipitation");if(!this._precipitationEnabled||this._context==null)return Pe(t),null;const e=this.view,r=this._context;return t!=null&&t.context===r?t:(Pe(t),new yw({context:r,view:e}))}get _clouds(){const t=this._get("_clouds");if(!this.weatherEnabled||this._context==null)return Pe(t),null;if(t!=null)return t;const e=this.view,r=this._context;return Pe(t),new zl({context:r,view:e,requestRender:()=>this._setNeedsRender()})}get _cloudsComposition(){const t=this._get("_cloudsComposition");if(!this.weatherEnabled||this._context==null)return Pe(t),null;const e=this.view.state.viewingMode,r=this._context.renderContext.rctx,i=Br(this.view.spatialReference).radius;return t!=null&&t.viewingMode===e&&t.planetRadius===i?t:(Pe(t),new fw({rctx:r,viewingMode:e,planetRadius:i,requestRender:()=>this._setNeedsRender()}))}get _fog(){const t=this._get("_fog");if(!this.weatherEnabled||this._context==null)return Pe(t),null;if(t!=null)return t;const e=this.view,r=this._context,i=this._context.renderContext.rctx,n=this.view.state.viewingMode;return new mw({context:r,view:e,rctx:i,viewingMode:n})}get weatherEnabled(){var t,e;return!!((e=(t=this.view)==null?void 0:t.environmentManager)!=null&&e.weatherEnabled)}get _precipitationEnabled(){return this.weatherEnabled&&(this.view.environment.weather.type==="rainy"||this.view.environment.weather.type==="snowy")}initializeRenderContext(t=null){this._context=t;const e=()=>this._setNeedsRender();this.addHandles([he(()=>({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled}),r=>this._updateAtmosphere(r),Kr),he(()=>this._stars,e),he(()=>this._precipitation,e),he(()=>this._clouds,()=>this._updateWeather(),gi),he(()=>this._fog,()=>this._updateFogHaze(),gi),he(()=>this.view.state.mode,()=>{this._setNeedsRender()},Qr),he(()=>this._weatherUpdateParameters,()=>{this._updateWeather(),this._updateFogHaze()},Kr)])}uninitializeRenderContext(){this._context=null,this._atmosphere=Pe(this._atmosphere),this._set("_stars",Pe(this._stars)),this._set("_precipitation",Pe(this._precipitation)),this._set("_clouds",Pe(this._clouds)),this._set("_cloudsComposition",Pe(this._cloudsComposition)),this._set("_fog",Pe(this._fog))}prepareRender(t){var e;t.bindParameters.cloudsFade.data=Uit(this._clouds)?this._clouds:null,this.view.viewingMode!=="local"&&((e=t.bindParameters.cloudsFade.data)==null?void 0:e.cubeMap)!=null&&(this._updateWeatherFading(t.bindParameters,t.time),t.bindParameters.cloudsFade.renderingStage===Dm.FINISHED&&this._clouds!=null&&this._clouds.coverage===0&&this._clouds.running===!1&&(this._clouds.destroyFrameBufferCube(),t.bindParameters.cloudsFade.data=null))}renderNode(t){var e,r,i,n,s,o,a;switch(t.bindParameters.slot){case ue.ENVIRONMENT_OPAQUE:this._stars!=null&&this._stars.render(t),this.atmosphere!=null&&(this.atmosphere.render(t,(i=(r=(e=this.view)==null?void 0:e._stage)==null?void 0:r.renderer)==null?void 0:i.fullResolutionAtmosphere),this._cloudsComposition!=null&&t.bindParameters.cloudsFade.data!=null&&(this.weatherVisible&&this._clouds!=null&&this._clouds.updateWeatherTile(),this._cloudsComposition.render(t)),t.bindParameters.cloudsFade.isFading&&this._context!=null&&((n=t.bindParameters.cloudsFade.data)==null?void 0:n.cubeMap)!=null&&this._context.requestRender());break;case ue.ENVIRONMENT_TRANSPARENT:if(this.atmosphere!=null&&(this.atmosphere.renderHaze(t,this._weatherParameters.hazeAmount,(a=(o=(s=this.view)==null?void 0:s._stage)==null?void 0:o.renderer)==null?void 0:a.fullResolutionAtmosphere),this._weatherParameters.fog.amount>0&&this._fog!=null&&this._fog.render(t,this._weatherParameters.fog),this._precipitation)){const l=this.view.environment.weather;l.type!=="rainy"&&l.type!=="snowy"||this._precipitation.render(t,l.precipitation,l.type)}}}updateLightSources(t,e,r,i){if(this._context!=null){const n=this._context.renderContext;n.bindParameters.oldLighting.copyFrom(n.bindParameters.lighting),n.bindParameters.newLighting.noonFactor=e,n.bindParameters.newLighting.globalFactor=r,n.bindParameters.newLighting.set(t),i===nE.Faded||n.bindParameters.weatherFading?n.bindParameters.fadeLighting(0):n.bindParameters.fadeLighting(1),this._context.requestRender()}}get _weatherUpdateParameters(){const t=this.weatherEnabled?this.view.environment.weather:null;return t==null?null:t.type==="rainy"||t.type==="snowy"?{type:t.type,weatherAdjustment:t.cloudCover,effect:t.precipitation}:{type:t.type,weatherAdjustment:t.type==="foggy"?t.fogStrength:t.cloudCover}}_updateWeatherFading(t,e){t.cloudsFade.updateFading(t.camera,this.view.state.mode,e,this.view.qualitySettings.fadeDuration),t.cloudsFade.updateParallax(t.camera),t.weatherFading&&(this._updateLighting(t),this._updateFogAtmoshpere(t))}_updateLighting(t){t.cloudsFade.fadeMode!==$i.CROSS_FADE&&t.cloudsFade.fadeMode!==$i.FADE_IN?t.fadeLighting(0):t.fadeLighting(t.cloudsFade.fadeFactor)}_updateFogAtmoshpere(t){t.cloudsFade.fadeMode!==$i.CROSS_FADE&&t.cloudsFade.fadeMode!==$i.FADE_IN?this._fadeWeather(0):this._fadeWeather(t.cloudsFade.fadeFactor)}_fadeWeather(t){const{_newWeatherParameters:e,_oldWeatherParameters:r}=this;t>=1?this._weatherParameters=e:(this._fadedWeatherParameters.lerp(r,e,t),this._weatherParameters=this._fadedWeatherParameters)}_updateWeather(){const t=this._weatherUpdateParameters;t!=null&&this._clouds!=null&&(this._clouds.applyPreset(va[t.type],t.weatherAdjustment),this._setNeedsRender())}_setNeedsRender(){this._context!=null&&this._context.requestRender()}_updateFogHaze(){const t=this._weatherUpdateParameters;if(this._fog==null||t==null||this._context==null)return;const e=this._context.renderContext.bindParameters;switch(this._oldWeatherParameters.copyFrom(this._weatherParameters),t.type){case"foggy":this._newWeatherParameters.fog.strength=Rt(3e-5,.005,t.weatherAdjustment**3),ce(this._newWeatherParameters.fog.color,dhe),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender();break;case"rainy":this._newWeatherParameters.fog.strength=Rt(4e-6,2e-4,(t.effect??0)**3),ce(this._newWeatherParameters.fog.color,uot),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=0,this._setNeedsRender();break;case"snowy":this._newWeatherParameters.fog.strength=Rt(4e-6,2e-4,(t.effect??0)**3),ce(this._newWeatherParameters.fog.color,dhe),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender();break;default:this._newWeatherParameters.fog.strength=0,this._newWeatherParameters.fog.amount=0,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender()}e.weatherFading?this._fadeWeather(0):this._fadeWeather(1)}_updateAtmosphere(t){const e=this._selectAtmosphereType(t);if(e!==wa.None&&this._context){if(!this._atmosphere||this._atmosphere.type!==e){this._atmosphere=Pe(this._atmosphere);const r=this._getAtmosphereClass(e);r&&(this._atmosphere=new r(this.view,this._context))}}else this._atmosphere=Pe(this._atmosphere);this._setNeedsRender()}_getAtmosphereClass(t){switch(t){case wa.Realistic:return Sue;case wa.Local:return zst;case wa.Mars:return jst;default:case wa.None:return null}}_selectAtmosphereType(t){const{enabled:e,viewingMode:r}=t;return!e||Lv(this.view.spatialReference)?wa.None:r===De.Local?wa.Local:this._context!=null&&Sue.isSupported(this._context)&&c$(this.view.spatialReference)?wa.Realistic:Iv(this.view.spatialReference)?wa.Mars:wa.None}get test(){return{atmosphere:this._atmosphere,clouds:this._clouds,selectAtmosphereType:()=>this._selectAtmosphereType({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled}),stubGetAtmosphereClass:t=>{phe=RM.prototype._getAtmosphereClass,RM.prototype._getAtmosphereClass=t},restoreGetAtmosphereClass:()=>{RM.prototype._getAtmosphereClass=phe}}}};d([m({constructOnly:!0})],Zo.prototype,"view",void 0),d([m({readOnly:!0})],Zo.prototype,"atmosphere",null),d([m({readOnly:!0})],Zo.prototype,"_atmosphereType",null),d([m({type:Boolean,readOnly:!0})],Zo.prototype,"updating",null),d([m({readOnly:!0})],Zo.prototype,"weatherVisible",null),d([m()],Zo.prototype,"_context",void 0),d([m()],Zo.prototype,"_atmosphere",void 0),d([m({readOnly:!0})],Zo.prototype,"_stars",null),d([m({readOnly:!0})],Zo.prototype,"_precipitation",null),d([m({readOnly:!0})],Zo.prototype,"_clouds",null),d([m({readOnly:!0})],Zo.prototype,"_cloudsComposition",null),d([m({readOnly:!0})],Zo.prototype,"_fog",null),d([m({readOnly:!0})],Zo.prototype,"weatherEnabled",null),d([m({readOnly:!0})],Zo.prototype,"_precipitationEnabled",null),d([m({readOnly:!0})],Zo.prototype,"_weatherUpdateParameters",null),Zo=RM=d([V("esri.views.3d.environment.EnvironmentRenderer")],Zo);let KV=class{constructor(){this.fog=new Knt,this.hazeAmount=1}copyFrom(e){this.fog.amount=e.fog.amount,this.hazeAmount=e.hazeAmount,this.fog.strength=e.fog.strength,ce(this.fog.color,e.fog.color)}lerp(e,r,i){this.fog.amount=Rt(e.fog.amount,r.fog.amount,i),this.hazeAmount=Rt(e.hazeAmount,r.hazeAmount,i),this.fog.strength=Rt(e.fog.strength,r.fog.strength,i),ni(this.fog.color,e.fog.color,r.fog.color,i)}};const uot=Ce(.5,.5,.5),dhe=Ce(1.5,1.5,1.5);let phe;var cUt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function XI(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var fhe,mhe,ghe,gMe={exports:{}};fhe=gMe,mhe=function(){var t=Math.PI,e=Math.sin,r=Math.cos,i=Math.tan,n=Math.asin,s=Math.atan2,o=Math.acos,a=t/180,l=864e5,c=2440588,u=2451545,h={dec:0,ra:0};function p(D){return D.valueOf()/l-.5+c}function f(D){return new Date((D+.5-c)*l)}function g(D){return p(D)-u}var _=23.4397*a;function v(D,I){return s(e(D)*r(_)-i(I)*e(_),r(D))}function b(D,I){return n(e(I)*r(_)+r(I)*e(_)*e(D))}function w(D,I,F){return s(e(D),r(D)*e(I)-i(F)*r(I))}function x(D,I,F){return n(e(I)*e(F)+r(I)*r(F)*r(D))}function S(D,I){return a*(280.16+360.9856235*D)-I}function E(D){return a*(357.5291+.98560028*D)}function A(D){return a*(1.9148*e(D)+.02*e(2*D)+3e-4*e(3*D))}function O(D,I){return D+I+102.9372*a+t}function L(D,I){var F=E(D),G=O(F,A(F));return I||(I={dec:0,ra:0}),I.dec=b(G,0),I.ra=v(G,0),I}var z={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(D,I,F,G){var H=a*-F,Z=a*I,te=g(D),me=L(te,h),Me=S(te,H)-me.ra;return G||(G={azimuth:0,altitude:0}),G.azimuth=w(Me,Z,me.dec),G.altitude=x(Me,Z,me.dec),G}},k=[[-.83,"sunrise","sunset"]];z.addTime=function(D,I,F){k.push([D,I,F])};var q=9e-4;function B(D,I){return Math.round(D-q-I/(2*t))}function J(D,I,F){return q+(D+I)/(2*t)+F}function W(D,I,F){return u+D+.0053*e(I)-.0069*e(2*F)}function Y(D,I,F){return o((e(D)-e(I)*e(F))/(r(I)*r(F)))}function le(D){var I=a*(134.963+13.064993*D),F=a*(93.272+13.22935*D),G=a*(218.316+13.176396*D)+6.289*a*e(I),H=5.128*a*e(F),Z=385001-20905*r(I);return{ra:v(G,H),dec:b(G,H),dist:Z}}return z.getTimes=function(D,I,F){var G=a*-F,H=a*I,Z=B(g(D),G),te=J(0,G,Z),me=E(te),Me=A(me),it=O(me,Me),Et=b(it,0),St=W(te,me,it);function ht(Oe){return W(J(Y(Oe,H,Et),G,Z),me,it)}function Ke(Oe){var Ve=(e(Oe)-e(H)*e(Et))/(r(H)*r(Et));return Ve<-1?z.PolarException.MIDNIGHT_SUN:Ve>1?z.PolarException.POLAR_NIGHT:z.PolarException.NORMAL}var je,_r,Cr,Ni,Ue,pr={solarNoon:f(St),nadir:f(St-.5),polarException:z.PolarException.NORMAL};for(je=0,_r=k.length;je<_r;je+=1)Ue=St-((Ni=ht((Cr=k[je])[0]*a))-St),pr[Cr[1]]=f(Ue),pr[Cr[2]]=f(Ni);return pr.polarException=Ke(k[0][0]*a),pr},z.getMoonPosition=function(D,I,F){var G=a*-F,H=a*I,Z=g(D),te=le(Z),me=S(Z,G)-te.ra,Me=x(me,H,te.dec);return Me+=.017*a/i(Me+10.26*a/(Me+5.1*a)),{azimuth:w(me,H,te.dec),altitude:Me,distance:te.dist}},z.getMoonFraction=function(D){var I=g(D),F=L(I),G=le(I),H=149598e3,Z=o(e(F.dec)*e(G.dec)+r(F.dec)*r(G.dec)*r(F.ra-G.ra)),te=s(H*e(Z),G.dist-H*r(Z));return(1+r(te))/2},z},(ghe=mhe())!==void 0&&(fhe.exports=ghe);const m2=XI(gMe.exports),dl={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8e5,ambient:.015,direct:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};let qD=class{constructor(e,r){this.direct=e,this.ambient=r}};function hot(t,e,r,i,n,s){ie(s.ambient.color,1,1,1),s.ambient.intensity=dl.global.ambient,ie(s.direct.color,1,1,1),s.direct.intensity=dl.global.direct;const o=e[2],a=we((Math.abs(o)-dl.local.altitude)/(dl.global.altitude-dl.local.altitude),0,1);let l;if(s.globalFactor=a,t!=null&&(l=m2.getTimes(t,e[1],e[0])),a<1){let c;if(t!=null)c=_ot(t,l,i);else{const u=vMe(i);c={direct:{intensity:dl.local.directAtNoon*u.direct,color:Ce(1,1,1)},ambient:{intensity:dl.local.ambientAtNoon*u.ambient,color:Ce(1,1,1)},timeOfDay:"early afternoon"}}ni(s.ambient.color,c.ambient.color,s.ambient.color,a),s.ambient.intensity=Rt(c.ambient.intensity,s.ambient.intensity,a),ni(s.direct.color,c.direct.color,s.direct.color,a),s.direct.intensity=Rt(c.direct.intensity,s.direct.intensity,a),s.specularStrength=i==="rainy"||i==="snowy"||i==="foggy"?0:1,s.environmentStrength=i==="rainy"?.7:i==="snowy"||i==="foggy"?.75:1}s.noonFactor=t!=null?yot(t,l):1,t!=null?dot(t,e,r,s.direct.directionToLightSource):yMe(n,r,s.direct.directionToLightSource)}function yMe(t,e,r){e===De.Global?pe(i7,t.eye):ie(i7,0,0,1),ne(n7,t.viewForward,-1);const i=v6(n7,i7),n=Math.max(i-2*s7,0),s=.85*n/(n+1),o=Math.max(s7,i-s7-s);Kc(Phe,-o,t.viewRight),Ge(r,n7,Phe),fe(r,r,ne(vot,t.viewRight,bot)),pe(r,r)}function dot(t,e,r,i){const n=got,s=pd(mot);if(r===De.Global)m2.getPosition(t,0,0,n),ie(i,0,0,-1),LE(s,s,-n.azimuth),Kz(s,s,-n.altitude),Ge(i,i,s);else{const o=dl.planarDirection,a=o.globalAngles,l=e[2];let c=(Math.abs(l)-o.localAltitude)/(o.globalAltitude-o.localAltitude);c=we(c,0,1),c<1?(m2.getPosition(t,e[1],e[0],n),n.azimuth=(1-c)*n.azimuth+c*a.azimuth,n.altitude=(1-c)*n.altitude+c*a.altitude):(n.azimuth=a.azimuth,n.altitude=a.altitude),ie(i,0,-1,0),DE(s,s,-n.azimuth),LE(s,s,-n.altitude),Ge(i,i,s)}}function pot(t,e){if(e===De.Global)return!0;const r=dl.planarDirection;return Math.abs(t)<r.localAltitude}const fot=Ce(.5773502691896258,-.5773502691896258,.5773502691896258);let _Me=class{constructor(){this.ambient={color:Ce(1,1,1),intensity:.55},this.direct={color:Ce(1,1,1),intensity:.55,directionToLightSource:Zi(fot)},this.noonFactor=.5,this.globalFactor=0,this.specularStrength=1,this.environmentStrength=1}};const mot=xe(),got={azimuth:0,altitude:0};function yot(t,e){const r=t.valueOf();let i,n;e.polarException===m2.PolarException.MIDNIGHT_SUN?(i=r-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,n=i+432e6):e.polarException===m2.PolarException.POLAR_NIGHT?(i=r-2,n=r-1):(i=e.sunrise.valueOf(),n=e.sunset.valueOf());const s=i+(n-i)/2;return 1-we(Math.abs(r-s)/432e5,0,1)}function vMe(t){switch(t){case"disabled":case"sunny":case"cloudy":return new qD(1,1);case"rainy":return new qD(.4,1.2);case"snowy":return new qD(.5,1.3);case"foggy":return new qD(.2,1.6)}}function yhe(t,e){const r=(t[0]+t[1]+t[2])/3;t[0]+=(r-t[0])*e,t[1]+=(r-t[1])*e,t[2]+=(r-t[2])*e}const e7=Ce(.01,.01,.01),hZ=Ce(1,.6,.5),dZ=Ce(1,.98,.98),_he=Ce(1,1,1),t7=Ce(.8,.8,1),pZ=Ce(.8,.8,1),fZ=Ce(.98,.98,1),vhe=Ce(1,1,1),r7=lr(.01,dl.local.ambientAtNight),mZ=lr(dl.local.directAtTwilight,dl.local.ambientAtTwilight),gZ=lr(.9*dl.local.directAtNoon,dl.local.ambientAtNoon),bhe=lr(dl.local.directAtNoon,dl.local.ambientAtNoon),whe=gZ,xhe=dZ,The=fZ,She=mZ,Che=hZ,Ehe=pZ;function _ot(t,e,r){const i=t.valueOf();let n,s;e.polarException===m2.PolarException.MIDNIGHT_SUN?(n=i-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,s=n+432e6):e.polarException===m2.PolarException.POLAR_NIGHT?(n=i-2,s=i-1):(n=e.sunrise.valueOf(),s=e.sunset.valueOf());const o=s-n,a=n+o/2,l=o/4,c=a-l,u=a+l,h=.06*o,p=n-h/2,f=n+h/2,g=s-h/2,_=s+h/2,v=He(),b=C(),w=C();let x="";if(i<p||i>_)eo(v,r7),ce(b,e7),ce(w,t7),x="night";else if(i<f){const A=(i-p)/(f-p);Vh(v,r7,mZ,A),ni(b,e7,hZ,A),ni(w,t7,pZ,A),x="sun rising"}else if(i<c){const A=(i-f)/(c-f);Vh(v,mZ,gZ,A),ni(b,hZ,dZ,A),ni(w,pZ,fZ,A),x="early morning"}else if(i<a){const A=(i-c)/(a-c);Vh(v,gZ,bhe,A),ni(b,dZ,_he,A),ni(w,fZ,vhe,A),x="late morning"}else if(i<u){const A=(i-a)/(u-a);Vh(v,bhe,whe,A),ni(b,_he,xhe,A),ni(w,vhe,The,A),x="early afternoon"}else if(i<g){const A=(i-u)/(g-u);Vh(v,whe,She,A),ni(b,xhe,Che,A),ni(w,The,Ehe,A),x="late afternoon"}else if(i<_){const A=(i-g)/(_-g);Vh(v,She,r7,A),ni(b,Che,e7,A),ni(w,Ehe,t7,A),x="sun setting"}let S=0;switch(r){case"rainy":case"foggy":S=.8;break;case"snowy":S=.5}S>0&&(yhe(b,S),yhe(w,S));const E=vMe(r);return{direct:{intensity:v[0]*E.direct,color:b},ambient:{intensity:v[1]*E.ambient,color:w},timeOfDay:x}}const Phe=xe(),i7=C(),n7=C(),vot=C(),s7=.25,bot=.2;let tp=class extends Qn.EventedAccessor{constructor(){super(),this._referencePointUpdateDelay=200,this._referencePointUpdateInterval=3e3,this._referencePointUpdateDistThreshold=1e6,this._referencePosUpdateQuery=null,this._referencePosMapCoordsRequested=null,this._viewHandlesKey="viewHandles",this._preserveAbsoluteDateTime=!1,this._trackingEnabled=!1,this._referencePosResetPreserveAbsoluteTime=!1,this._referencePosUpdateTimer=null,this._referencePosMapCoords=null,this._mainLight=new j6,this._ambientLight=new are,this._moonLight=new bAe,this.disableQueries=!1,this._disableWeather=!1,this._renderer=null,this._referencePosWGS84Comparable=null,this._resetReferencePosition()}destroy(){this.disconnectView()}get _view(){var e;return(e=this._renderer)==null?void 0:e.view}get updating(){var e;return!((this.disableQueries||!this._referencePosUpdateQuery&&!this._referencePosMapCoordsRequested)&&!((e=this._renderer)!=null&&e.updating))}get weatherEnabled(){var e,r,i;return((e=this._view)==null?void 0:e.environment.atmosphereEnabled)&&!this._disableWeather&&((i=(r=this._view)==null?void 0:r.state)==null?void 0:i.viewingMode)===De.Global&&c$(this._view.spatialReference)}get weatherVisible(){var e;return this.weatherEnabled&&((e=this._renderer)==null?void 0:e.weatherVisible)}get referencePositionWGS84Comparable(){return this._referencePosWGS84Comparable}connectView(e){if(this._renderer)return;this._renderer=new Zo({view:e});const r=()=>this._updateRenderParameters(),i=()=>this._cameraHandler();this.addHandles([he(()=>e.environment.lighting,n=>this._updateLightingHandler(n),Qr),he(()=>e.environment.lighting.type!=="virtual"?e.environment.lighting.date:null,n=>this._lightingDateHandler(n),Qr),he(()=>e.stationary,()=>this._interactingStationaryHandler()),he(()=>e.environment.lighting.directShadowsEnabled,r,Qr),he(()=>e.qualitySettings.ambientOcclusion,r,Qr),he(()=>e.qualitySettings.reflections,r,Qr),he(()=>e.spatialReference,()=>this._resetReferencePosition(!0),Qr),he(()=>e.environment.weather.type,()=>this._updateLighting(null,nE.Faded),Qr),he(()=>this.weatherEnabled,()=>this._updateLighting(null,nE.Faded),Qr),he(()=>e.viewingMode,()=>this._resetReferencePosition(!0),Kr),he(()=>e.environment.lighting.type!=="virtual"&&e.environment.lighting.cameraTrackingEnabled,n=>this._updateCameraTracking(n),Kr),he(()=>e.state.camera,i,Kr),he(()=>this.disableQueries,i)],this._viewHandlesKey),this._updateRenderParameters(),this._updateLighting(),this._cameraHandler(),this.notifyChange("updating")}disconnectView(){this.removeHandles(this._viewHandlesKey),this._resetReferencePosition(),this._renderer=Pe(this._renderer)}_updateLightingHandler(e){this._updateCameraTracking(e.type!=="virtual"&&e.cameraTrackingEnabled),this._lightingDateHandler(e.type!=="virtual"?e.date:null),this._updateRenderParameters()}_updateCameraTracking(e){if(this._trackingEnabled=e,e)this._cameraHandler();else{const r=this._view.environment.lighting;(r==null?void 0:r.type)!=="virtual"&&(r.positionTimezoneInfo.autoUpdated=!1)}}_lightingDateHandler(e){const r=this._view.environment.lighting;if((r==null?void 0:r.type)!=="virtual"){if(e){if(!r.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;const i=this._view.spatialReference;if(!dv(i)){const n=this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(n))return void this._requestReferencePositionUpdate(n)}if(this._preupdateTracking(e),this._referencePosWGS84Comparable!=null){const n=Sce(this._referencePosWGS84Comparable,Ahe);n!=null&&(r.autoUpdate(null,n),this._trackingEnabled&&(r.positionTimezoneInfo.autoUpdated=!0))}}this._updateLighting(e)}}else this._updateLighting()}_preupdateTracking(e){!this._trackingEnabled&&this._view.environment.lighting.type!=="virtual"&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(e)}_cameraHandler(e=null){const r=this._view;if(!r.ready)return;const i=r.stateManager.camera;i&&(this._cameraHandlerClientSide(i,e)||this._cameraHandlerServerSide(i))}_cameraHandlerClientSide(e,r){const i=c$(this._view.spatialReference);if(i&&!dv(this._view.spatialReference))return this._view.environment.lighting.type==="virtual"&&this._updateLighting(),!1;const n=e.position;return this._referencePosWGS84Comparable==null&&(this._referencePosWGS84Comparable=C()),i?srt(n,this._referencePosWGS84Comparable):ie(this._referencePosWGS84Comparable,n.longitude??0,n.latitude??0,n.z??0),this.notifyChange("referencePositionWGS84Comparable"),this._autoUpdateTimezone(this._referencePosWGS84Comparable,r)||this._updateLighting(r),!0}_cameraHandlerServerSide(e){const r=e.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(r))&&this._requestReferencePositionUpdate(r,!0),this._view.mapCoordsHelper&&this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable[2]=(r.z??0)*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged())}_interactingStationaryHandler(){this._view.stationary&&this._executePendingReferencePositionUpdate()}_updateLighting(e,r=nE.Immediate){const i=this._view;e=e||(i.environment.lighting.type==="virtual"?null:i.environment.lighting.date);const n=this._referencePosWGS84Comparable,s=n?wot:xot,o=this.weatherVisible?i.environment.weather.type:"disabled";n!=null?hot(e,n,i.state.viewingMode,o,i.state.camera,s):i.environment.lighting.type==="virtual"&&yMe(i.state.camera,i.state.viewingMode,s.direct.directionToLightSource);const a=this._mainLight,l=s.direct;ne(a.intensity,l.color,l.intensity*Math.PI),ce(a.direction,l.directionToLightSource),a.specularStrength=s.specularStrength,a.environmentStrength=s.environmentStrength;const c=this._ambientLight;ne(c.intensity,s.ambient.color,s.ambient.intensity);const u=this._moonLight;ni(u.intensity,Sot,Cot,s.globalFactor);const h=(1-.5*s.globalFactor)*(1-.4*s.noonFactor*(1-s.globalFactor));ne(u.intensity,u.intensity,h),ce(u.direction,l.directionToLightSource),this._renderer.updateLightSources([a,c,u],s.noonFactor,s.globalFactor,r),this._updateRenderParameters()}_autoUpdateTimezone(e,r=null){if(this._view.environment.lighting.type==="virtual"||!this._view.environment.lighting.cameraTrackingEnabled||e==null)return!1;const i=Tot;i.setTime((r||this._view.environment.lighting.date).getTime());const n=Sce(e,Ahe);if(n==null)return!1;let s=this._view.environment.lighting.positionTimezoneInfo;if(s.autoUpdated){if(s.hours===n.hours&&s.minutes===n.minutes&&s.seconds===n.seconds)return!1}else s=n;const o=i.getUTCHours()-(n.hours-s.hours),a=i.getUTCMinutes()-(n.minutes-s.minutes),l=i.getUTCSeconds()-(n.seconds-s.seconds);return i.setUTCHours(o),i.setUTCMinutes(a),i.setUTCSeconds(l),!r&&this._view.environment.lighting.autoUpdate(i,n)}_updateRenderParameters(){const e=this._view._stage;if(!e)return;const r=this._referencePosWGS84Comparable==null||pot(this._referencePosWGS84Comparable[2],this._view.state.viewingMode);e.renderer.setParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&r,environment:this._view.environment,weatherVisible:this._view.environmentManager.weatherVisible,qualitySettings:this._view.qualitySettings})}_resetReferencePosition(e=!1){this._cancelReferencePosUpdates(),this._referencePosMapCoords=null,this._referencePosMapCoordsRequested=null,this._referencePosResetPreserveAbsoluteTime=null,this._referencePosWGS84Comparable=null,this.notifyChange("updating"),e&&this._cameraHandler()}_requestReferencePositionUpdate(e,r=!1){if(!this.disableQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(e):this._referencePosMapCoordsRequested=e.clone(),this._referencePosResetPreserveAbsoluteTime=!!r,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&this._view.stationary)){const i=this._referencePosUpdateQuery=i$(this._referencePointUpdateDelay).then(()=>{if(this._referencePosUpdateQuery===i){const s=()=>this._referencePosUpdateQuery!==i;return this._doReferencePositionUpdateQuery(s)}}).catch(s=>{s.name==="mapcoordshelper:missing-geometry-service"&&(this.disableQueries=!0)}).then(()=>{this._referencePosUpdateQuery===i&&(this._referencePosUpdateQuery=null,this._referencePosUpdateTimer||this._executePendingReferencePositionUpdate(),this.notifyChange("updating"))}),n=this._referencePosUpdateTimer=i$(this._referencePointUpdateInterval).then(()=>{this._referencePosUpdateTimer===n&&(this._referencePosUpdateTimer=null,this._referencePosUpdateQuery||this._executePendingReferencePositionUpdate())});this.notifyChange("updating")}}async _doReferencePositionUpdateQuery(e){this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1),this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone(),this._referencePosResetPreserveAbsoluteTime=null,this._referencePosMapCoordsRequested=null;const r=await this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords);if(!e()&&!isNaN(r[0])&&!isNaN(r[1])){const i=(this._referencePosMapCoords.z??0)*this._view.mapCoordsHelper.unitInMeters;this._referencePosWGS84Comparable?(this._referencePosWGS84Comparable[0]=r[0],this._referencePosWGS84Comparable[1]=r[1],this._referencePosWGS84Comparable[2]=i):this._referencePosWGS84Comparable=[r[0],r[1],i],this._referencePosChanged()}}_executePendingReferencePositionUpdate(){const e=this._referencePosMapCoordsRequested;e&&this._requestReferencePositionUpdate(e,this._referencePosResetPreserveAbsoluteTime)}_referencePosChanged(){this._preserveAbsoluteDateTime?this._updateLighting():this._autoUpdateTimezone(this._referencePosWGS84Comparable)||this._updateLighting(),this.notifyChange("referencePositionWGS84Comparable")}_exceedsReferencePosDistThreshold(e){if(this._referencePosMapCoords){let r=this._referencePosMapCoords.distance(e);return this._view.mapCoordsHelper&&(r*=this._view.mapCoordsHelper.unitInMeters),r>this._referencePointUpdateDistThreshold}return!0}_cancelReferencePosUpdates(){const e=!!this._referencePosUpdateQuery;return this._referencePosUpdateQuery=null,this._referencePosUpdateTimer=null,e}get test(){const e=this;return{get renderer(){return e._renderer},set referencePointUpdateInterval(r){e._referencePointUpdateInterval=r},set referencePointUpdateDistThreshold(r){e._referencePointUpdateDistThreshold=r},set referencePosUpdateTimer(r){e._referencePosUpdateTimer=r},set referencePointUpdateDelay(r){e._referencePointUpdateDelay=r},set disableWeather(r){e._disableWeather=r}}}};d([m({type:Boolean,readOnly:!0})],tp.prototype,"updating",null),d([m()],tp.prototype,"disableQueries",void 0),d([m()],tp.prototype,"_disableWeather",void 0),d([m()],tp.prototype,"weatherEnabled",null),d([m()],tp.prototype,"weatherVisible",null),d([m()],tp.prototype,"referencePositionWGS84Comparable",null),d([m()],tp.prototype,"_renderer",void 0),d([m()],tp.prototype,"_referencePosWGS84Comparable",void 0),tp=d([V("esri.views.3d.environment.SceneViewEnvironmentManager")],tp);const wot=new _Me,xot=new _Me,Tot=new Date,Ahe={hours:0,minutes:0,seconds:0},Sot=Ce(.22,.22,.33),Cot=Ce(.22,.22,.22);var Vi;(function(t){t[t.NONE=0]="NONE",t[t.TILT=1]="TILT",t[t.ALTITUDE=2]="ALTITUDE",t[t.DISTANCE=4]="DISTANCE",t[t.COLLISION=8]="COLLISION",t[t.ALL=15]="ALL",t[t.ALL_EXCEPT_COLLISION=7]="ALL_EXCEPT_COLLISION"})(Vi||(Vi={}));var rr;(function(t){t[t.NONE=0]="NONE",t[t.ZOOM=1]="ZOOM",t[t.TUMBLE=2]="TUMBLE",t[t.LOOK_AROUND=3]="LOOK_AROUND",t[t.PAN=4]="PAN",t[t.ASCEND=5]="ASCEND"})(rr||(rr={}));var dg;(function(t){t[t.TUMBLE=0]="TUMBLE",t[t.LOOK_AROUND=1]="LOOK_AROUND"})(dg||(dg={}));let Sd=class{constructor(e=Vi.ALL,r=rr.NONE,i=0,n=null,s=null,o=dg.TUMBLE){this.selection=e,this.interactionType=r,this.interactionFactor=i,this.interactionStartCamera=n,this.interactionDirection=s,this.tiltMode=o}};function k$(t,e){return(t&e)!=0}function Q6(t,e,r,i,n,s){t!==0&&(r?(s.min=Math.min(s.min,e),s.max=Math.max(s.max,e)):i!=null?(s.min-=Math.max(0,(e-s.min)*(1-i)),s.max+=Math.max(0,(e-s.max)*(1-i))):n&&(s.min-=Math.max(0,e-s.min-n),s.max+=Math.max(0,e-s.max-n)))}const G2=new Sd(Vi.NONE);function bMe(t,e,r,i){return e=e||t.viewForward,ce(i,e),ne(i,i,Math.sign(de(e,r))),i}function Eot(t,e,r,i){return Rot(t,e,r,Mot(i,e,r,!0))}function Pot(t,e,r,i){const n=de(r,ye(t,i,e));return fe(t,e,ne(t,r,n))}const Aot={dir:C(),len:0,clip:He()};function Mot(t,e,r,i){const n=Aot;return t?(r&&i&&(n.len=Di(e,r)),ce(n.dir,t)):i?(n.len=Di(e,r),ye(n.dir,r,e),ne(n.dir,n.dir,1/n.len)):(ye(n.dir,r,e),pe(n.dir,n.dir)),n}function Oot(t,e,r){const i=de(t,r.dir),n=-bi(t,e);if(n<0&&i>=0)return!1;if(i>-1e-6&&i<1e-6)return n>0;if((n<0||i<0)&&!(n<0&&i<0))return!0;const s=n/i;return i>0?s<r.clip[1]&&(r.clip[1]=s):s>r.clip[0]&&(r.clip[0]=s),r.clip[0]<=r.clip[1]}function Rot(t,e,r,i){i.clip[0]=0,i.clip[1]=r?i.len:Number.MAX_VALUE;for(let n=0;n<t.length;n++)if(!Oot(t[n],e,i))return!1;return!0}function $ot(t,e,r=G2){const i=wre(t,e,r);if(i===0)return!1;const n=t.renderCoordsHelper,s=n.getAltitude(e.eye)+i,o=bMe(e,r.interactionDirection,Dot(t,e,Math.sign(i),zot),kot),a=ce(Uot,e.viewForward),l=n.intersectInfiniteManifold(eh(e.eye,o),s,o7);return e.eye=l??n.setAltitude(o7,s,e.eye),e.center=Pot(o7,e.eye,a,e.center),!0}function wre(t,e,r=G2){if(!Iot(t,r)||!t.state.constraints.altitude)return 0;const i=Not(t.state.constraints.altitude,Fot);Lot(t,r,i);const n=t.renderCoordsHelper.getAltitude(e.eye),s=we(n,i.min,i.max)-n;return Math.abs(s)<=1e-6?0:s}function Iot(t,e){const r=t.state.constraints.altitude;return!(!t.state.isGlobal||!r)&&(e.interactionType!==rr.TUMBLE||!k$(e.selection,Vi.TILT))}function Lot(t,e,r){const i=e.interactionType;if(i===rr.NONE)return;const{min:n,max:s}=r,{interactionStartCamera:o,interactionFactor:a}=e;if(!o)return;const l=i===rr.TUMBLE||i===rr.ZOOM,c=wre(t,o),u=c===0?0:t.renderCoordsHelper.getAltitude(o.eye);r.min=n,r.max=s,Q6(c,u,l,a,.05*u,r)}function Dot(t,e,r,i){return t.renderCoordsHelper.worldUpAtPosition(e.eye,i),ne(i,i,r),i}function Not(t,e){return e.min=t.min,e.max=t.max,e}const Fot={min:0,max:0},kot=C(),zot=C(),Uot=C(),o7=C();function xre(t,e,r=G2){if(!t.state.isLocal)return 0;const i=t.state.constraints.distance;if(!t.pointsOfInterest.surfaceOrigin.renderLocation||i===1/0)return 0;YD.min=0,YD.max=i,Vot(t,r,YD);const n=Tre(t,e),s=YD.max-n;return s>=-1e-6?0:s}function Bot(t,e,r=G2){const i=xre(t,e,r);if(i===0)return!1;const n=t.pointsOfInterest.surfaceOrigin;if(!n.renderLocation)return!1;const s=Tre(t,e)+i,o=ce(jot,e.eye),a=bMe(e,r.interactionDirection,Got(e,n.renderLocation,qot),Wot);if(!Dv(jSe(n.renderLocation,s),eh(e.eye,a),XD))return!1;e.eye=XD;const l=ye(Hot,e.eye,o);e.center=fe(XD,e.center,l);const c=t.renderCoordsHelper.getAltitude(e.center),u=t.renderCoordsHelper.intersectInfiniteManifold(e.ray,c,XD);return u!=null&&(e.center=u),!0}function Vot(t,e,r){const i=e.interactionType;if(i===rr.NONE)return;const{min:n,max:s}=r,{interactionStartCamera:o,interactionFactor:a}=e;if(!o)return;const l=i===rr.ZOOM||i===rr.PAN,c=xre(t,o),u=c===0?0:Tre(t,o);r.min=n,r.max=s,Q6(c,u,l,a,.05*u,r)}function Tre(t,e){const r=t.pointsOfInterest.surfaceOrigin;return r.renderLocation?Di(e.eye,r.renderLocation):0}function Got(t,e,r){return fy(r,t.eye,e)}const YD={min:0,max:0},jot=C(),Hot=C(),Wot=C(),qot=C(),XD=C();function Z3(t,e,r=ed.EYE){const i=t.state.constraints;if(!i.collision.enabled)return!1;const n=V9(t,e.eye),s=t.renderCoordsHelper.getAltitude(e.eye),o=n+i.collision.elevationMargin;if(s>=o)return!1;const a=Te(e.eye);if(ye(ZD,e.center,e.eye),e.eye=t.renderCoordsHelper.setAltitude(Yot,o,e.eye),r===ed.EYE_AND_CENTER)e.center=fe(ZD,e.eye,ZD);else if(r===ed.EYE_AND_CENTER_SCALE){const l=(a-s+o)/a;e.center=ne(ZD,e.center,l)}return!0}var ed;(function(t){t[t.EYE=0]="EYE",t[t.EYE_AND_CENTER=1]="EYE_AND_CENTER",t[t.EYE_AND_CENTER_SCALE=2]="EYE_AND_CENTER_SCALE"})(ed||(ed={}));const ZD=C(),Yot=C();function bv(t,e,r){t.worldUpAtPosition(e,Mhe),ye(a7,r,e);const i=Te(a7);return i===0?0:Ks(de(a7,Mhe)/i)}const Mhe=C(),a7=C();function wMe(t,e,r,i=!0){HP.eyeCenterDistance=0,HP.requiresTwoSteps=!1;const n=Sre(t,e,r,G2,HP);if(n===0)return!1;switch(Kc(JD,-n,e.viewRight),r.tiltMode){case dg.LOOK_AROUND:Ge(Xy,e.viewForward,JD),ne(Xy,Xy,HP.eyeCenterDistance),e.center=fe(c1,e.eye,Xy);break;case dg.TUMBLE:ye(Xy,e.center,e.eye),Ge(Xy,Xy,JD),e.eye=ye(c1,e.center,Xy);break;default:r.tiltMode}return e.up=Ge(c1,e.up,JD),!HP.requiresTwoSteps||!i||wMe(t,e,r,!1)}function Sre(t,e,r,i=G2,n){if(!t.state.constraints.tilt)return 0;const s=e.distance,o=t.state.constraints.tilt(s,nat);return iat(t,r,o),i.interactionType===rr.TUMBLE&&k$(i.selection,Vi.ALTITUDE)&&xMe(t,i.interactionStartCamera,o),r.tiltMode===dg.LOOK_AROUND||i.tiltMode===dg.LOOK_AROUND?Zot(t,e,o,n):Xot(t,e,o)}function Xot(t,e,r){const i=bv(t.renderCoordsHelper,e.center,e.eye),n=i-we(i,r.min,r.max);return z$(n)?n:0}function Zot(t,e,r,i){switch(i&&(i.requiresTwoSteps=!1),t.viewingMode){case"global":return Qot(t,e,r,i);case"local":return Jot(t,e,r,i)}}function Jot(t,e,r,i){const n=bv(t.renderCoordsHelper,e.center,e.eye),s=we(n,r.min,r.max),o=n-s;if(!z$(o))return 0;if(i){const a=t.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,l=t.renderCoordsHelper.getAltitude(e.eye)-a,c=Math.cos(s);Math.abs(c)>1e-4?i.eyeCenterDistance=l/c:i.eyeCenterDistance=e.distance}return o}function Qot(t,e,r,i){const n=Kot(t,e,sat),s=we(n.tiltAtCenter,r.min,r.max);if(!z$(n.tiltAtCenter-s))return 0;let o,a;return n.centerIsOnSurface?(o=eat(n),a=tat(n,o)):(o=n.constraints.clampTilt(n.eyeCenterDistance,n.tiltAtCenter),i&&o<Math.PI/2&&(i.requiresTwoSteps=!0,o=Math.PI/2-1e-5),a=rat(n,o)),i&&(i.eyeCenterDistance=yZ(n,o)),a}function Kot(t,e,r){const i=t.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,n=i+Br(t.spatialReference).radius,s=t.renderCoordsHelper.intersectManifold(e.ray,i,c1);return r.eyeCenterDistance=e.distance,r.centerIsOnSurface=!1,s!=null?(r.eyeCenterDistance=Di(e.eye,s),r.tiltAtCenter=bv(t.renderCoordsHelper,s,e.eye),r.centerIsOnSurface=!0):t.state.isLocal?r.tiltAtCenter=bv(t.renderCoordsHelper,e.center,e.eye):(z3($9(I9,n),e.ray,c1),r.eyeCenterDistance=Di(e.eye,c1),r.tiltAtCenter=Ks(-de(e.viewForward,pe(c1,c1)))),r.radius=n,r.eyeRadius=Te(e.eye),r.constraints=t.state.constraints,r}function z$(t){return Math.abs(t)>1e-9}function eat(t){const{constraints:e,eyeCenterDistance:r,tiltAtCenter:i}=t;let n=i,s=e.clampTilt(r,i);const o=yZ(t,s);if(e.clampTilt(o,i)===s)return s;let a=0;for(;a<10&&z$(s-n);){const l=(n+s)/2,c=yZ(t,l);z$(e.clampTilt(c,l)-l)?n=l:s=l,a++}return s}function yZ(t,e){if(!t.centerIsOnSurface)return t.eyeCenterDistance;const r=Math.PI-we(e,0,Math.PI),i=hd(t.radius/t.eyeRadius*Math.sin(r)),n=Math.PI-r-i,s=Math.sin(n)/Math.sin(r);if(t.eyeRadius<t.radius&&s>1){const o=Math.PI-i,a=Math.PI-r-o;return Math.sin(a)/Math.sin(r)*t.eyeRadius}return s*t.eyeRadius}function tat(t,e){const r=hd(t.radius/t.eyeRadius*Math.sin(t.tiltAtCenter)),i=hd(t.radius/t.eyeRadius*Math.sin(e));return t.eyeRadius>t.radius?r-i:i-r}function rat(t,e){return t.tiltAtCenter-Math.PI/2-(e-Math.PI/2)}function iat(t,e,r){if(e.interactionType===rr.NONE)return;const{interactionStartCamera:i,interactionFactor:n}=e;if(!i)return;const{min:s,max:o}=r,a=Sre(t,i,G2,e),l=a===0?0:bv(t.renderCoordsHelper,i.center,i.eye);r.min=s,r.max=o,e.interactionType===rr.TUMBLE?(k$(e.selection,Vi.ALTITUDE)&&xMe(t,i,r),Q6(a,l,!0,n,Ohe,r)):Q6(a,l,!1,n,Ohe,r)}function xMe(t,e,r){const i=t.state.constraints;if(t.state.isLocal||!i.altitude||!e)return;const n=Ra(e.center),s=Math.sqrt(n),o=e.distance,a=Br(t.spatialReference).radius,l=i.altitude.min+a,c=i.altitude.max+a,u=(l*l-o*o-n)/(-2*s*o),h=(c*c-o*o-n)/(-2*s*o);r.min=Math.max(r.min,Math.min(Math.PI-Ks(h),r.max)),r.max=Math.min(r.max,Math.PI-Ks(u))}const Xy=C(),JD=xe(),c1=C(),Ohe=Nt(5),nat={min:0,max:0},sat={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},HP={eyeCenterDistance:0,requiresTwoSteps:!1},oat=t=>t,yU=t=>t*t,Cre=t=>1-yU(1-t),aat=t=>t<.5?yU(2*t)/2:(Cre(2*(t-.5))+1)/2,Ere=t=>t*t*t,TMe=t=>1-Ere(1-t),SMe=t=>t<.5?Ere(2*t)/2:(TMe(2*(t-.5))+1)/2,Pre=t=>t*t*t*t,CMe=t=>1-Pre(1-t),lat=t=>t<.5?Pre(2*t)/2:(CMe(2*(t-.5))+1)/2,Are=t=>t*t*t*t*t,EMe=t=>1-Are(1-t),cat=t=>t<.5?Are(2*t)/2:(EMe(2*(t-.5))+1)/2,Mre=t=>1-Math.cos(t*Math.PI/2),PMe=t=>1-Mre(1-t),uat=t=>t<.5?Mre(2*t)/2:(PMe(2*(t-.5))+1)/2,Ore=t=>2**(10*(t-1)),ZI=t=>1-Ore(1-t),hat=t=>t<.5?Ore(2*t)/2:(ZI(2*(t-.5))+1)/2,Rre=t=>-(Math.sqrt(1-t*t)-1),AMe=t=>1-Rre(1-t),dat=t=>t<.5?Rre(2*t)/2:(AMe(2*(t-.5))+1)/2;function Cd(t){const e=2*(t-Math.sqrt((t-1)*t)),r=e/2/t;return i=>i<r?t*i*i:e*i-e+1}function Ed(t,e){return(r,i)=>r<e?e*t(r/e,i):1-t((1-r)/(1-e),i)*(1-e)}const pat=Ed(Cd(1),1),fat=Ed(Cd(1),0),MMe=Ed(Cd(1),.5),mat=Ed(Cd(2),1),gat=Ed(Cd(2),0),yat=Ed(Cd(2),.5),_at=Ed(Cd(3),1),vat=Ed(Cd(3),0),bat=Ed(Cd(3),.5),wat=Ed(Cd(4),1),xat=Ed(Cd(4),0),Tat=Ed(Cd(4),.5),Sat={linear:oat,"in-quad":yU,"out-quad":Cre,"in-out-quad":aat,"in-coast-quad":pat,"out-coast-quad":fat,"in-out-coast-quad":MMe,"in-cubic":Ere,"out-cubic":TMe,"in-out-cubic":SMe,"in-coast-cubic":mat,"out-coast-cubic":gat,"in-out-coast-cubic":yat,"in-quart":Pre,"out-quart":CMe,"in-out-quart":lat,"in-coast-quart":_at,"out-coast-quart":vat,"in-out-coast-quart":bat,"in-quint":Are,"out-quint":EMe,"in-out-quint":cat,"in-coast-quint":wat,"out-coast-quint":xat,"in-out-coast-quint":Tat,"in-sine":Mre,"out-sine":PMe,"in-out-sine":uat,"in-expo":Ore,"out-expo":ZI,"in-out-expo":hat,"in-circ":Rre,"out-circ":AMe,"in-out-circ":dat};function qn(t,e,r=Aat,i=e){i!==e&&i.copyFrom(e),i.computeUp(t.state.viewingMode);let n=!1;for(let a=0;a<Mat;a++){let l=0;for(const c of Pat)if(k$(r.selection,c.type)){const u=Math.abs(c.error(t,i,r));c.apply(t,i,r)&&(n=!0,l+=u)}if(l===0)break}const s=k$(r.selection,Vi.COLLISION),o=Cat(r.interactionType,t);return s&&Z3(t,i,o)&&(n=!0),n&&i.computeUp(t.state.viewingMode),n}function Cat(t,e){switch(t){case rr.PAN:return ed.EYE_AND_CENTER;case rr.ASCEND:return e.state.isGlobal?ed.EYE_AND_CENTER_SCALE:ed.EYE_AND_CENTER;default:return ed.EYE}}function Ap(t){const e=Math.min(1,t/150);return SMe(e)}function Eat(t,e,r){return Sre(t,e,r)*e.distance}const Pat=[{type:Vi.TILT,error:Eat,apply:wMe},{type:Vi.ALTITUDE,error:wre,apply:$ot},{type:Vi.DISTANCE,error:xre,apply:Bot}],Aat=new Sd,Mat=5;let Rhe=class{constructor(e){this.viewingMode=e,this.center=C(),this.pitch=0,this.yaw=0,this.distance=0,this.direction=Zi($he),this.fov=55,this.size=1}pixelsPerPanAtZoom(e){return this.size/2/(this._zoomToPanScale*e)}zoomAtPixelsPerPan(e){return this.size/2/(this._zoomToPanScale*e)}pixelsPerRotateAtZoom(){const e=Math.max(Math.cos(Math.abs(this.pitch)),.5);return this.size/2/e}compareTo(e,r){if(r||(r={pan:0,rotate:0,sourceZoom:0,targetZoom:0}),this.viewingMode===De.Global){const s=(Te(this.center)+Te(e.center))/2;r.pan=v6(this.center,e.center)*s}else r.pan=Di(this.center,e.center);let i=Math.abs(e.yaw-this.yaw);i>=Math.PI&&(i=2*Math.PI-i);const n=Math.abs(e.pitch-this.pitch);return r.rotate=Math.max(i,n),r.sourceZoom=this.distance,r.targetZoom=e.distance,r}interpolate(e,r,i){this.viewingMode===De.Global?Qqe(e.center,r.center,i.pan,this.center):ni(this.center,e.center,r.center,i.pan),this.distance=isFinite(r.distance)?Rt(e.distance,r.distance,i.zoom):e.distance,this.pitch=Rt(e.pitch,r.pitch,i.rotate);let n=e.yaw;const s=r.yaw;Math.abs(s-n)>=Math.PI&&(n+=2*(n<s?1:-1)*Math.PI),this.yaw=Rt(n,s,i.rotate)}copyFrom(e){ce(this.center,e.center),this.pitch=e.pitch,this.yaw=e.yaw,this.distance=e.distance,ce(this.direction,e.direction),this.size=e.size,this.copyFromCommon(e),this.viewingMode=e.viewingMode}copyFromRenderCamera(e){const r=this._lookAtOrientation(e.center,Ihe);ce(this.center,e.center),ye(Xo,e.center,e.eye),Zs(Xo,Xo,r),Zs(Jy,e.up,r),this.distance=Te(Xo),this.distance!==0&&(Xo[0]/=this.distance,Xo[1]/=this.distance,Xo[2]/=this.distance),this.pitch=this._eyeUpToPitch(Xo),this.yaw=Oat(Xo,Jy),this.size=Math.sqrt(e.width*e.width+e.height*e.height),this.copyFromCommon(e)}copyFromCommon(e){this.fov=e.fov,this._zoomToPanScale=Math.atan(.5*this.fov)}copyToRenderCamera(e){const r=this._lookAtOrientation(this.center,Ihe);gd(r,r),this._axisAngleVec3(cF,this.pitch-Math.PI/2,$he,Xo),this._axisAngleVec3(Hw,this.yaw,Xo,Xo),this._axisAngleVec3(cF,this.pitch-Math.PI/2,Hw,Jy),this._axisAngleVec3(Hw,this.yaw,Jy,Jy),ne(Xo,Xo,this.distance),Zs(Xo,Xo,r),Zs(Jy,Jy,r),e.center=this.center,e.eye=ye(Xo,this.center,Xo),e.up=Jy}_axisAngleVec3(e,r,i,n){const s=Math.cos(r),o=Math.sin(r);return ne(uu,i,s),Je(Cc,e,i),ne(Cc,Cc,o),ne(Zy,e,(1-s)*de(e,i)),fe(n,fe(n,uu,Cc),Zy)}_lookAtOrientation(e,r=li()){return this._upAtLookAt(e,Zy),Je(uu,this.direction,Zy),pe(uu,uu),uu[0]===0&&uu[1]===0&&uu[2]===0&&ce(uu,cF),Je(Cc,Zy,uu),pe(Cc,Cc),r[0]=uu[0],r[1]=Cc[0],r[2]=Zy[0],r[3]=uu[1],r[4]=Cc[1],r[5]=Zy[1],r[6]=uu[2],r[7]=Cc[2],r[8]=Zy[2],r}_upAtLookAt(e,r){return this.viewingMode===De.Local?ce(r,Hw):pe(r,e)}_eyeUpToPitch(e){return Math.PI-v6(Hw,e)}};function Oat(t,e){const r=Rat;return Math.abs(e[2])<.5?(ce(r,e),t[2]>0&&ne(r,r,-1)):ce(r,t),Je(Cc,r,Hw),pe(Cc,Cc),v6(cF,Cc,Hw)}const uu=C(),Cc=C(),Zy=C(),Xo=C(),Jy=C(),Rat=C(),Hw=$E,$he=aee,cF=oee,Ihe=li(),K6={desiredScreenFlow:2,minDuration:500,maxDuration:8e3};let $at=class OMe{constructor(e){this._createCamera=e,this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0},this.settings={desiredScreenFlow:K6.desiredScreenFlow},this.source=e(),this.target=e()}clone(){const e=new OMe(this._createCamera);return e.copyFrom(this),e}copyFrom(e){this.update(e.source,e.target,e.settings)}update(e,r,i){this.source!==e&&this.source.copyFrom(e),this.target!==r&&this.target.copyFrom(r),this.compared=this.source.compareTo(this.target,this.compared),this.settings.desiredScreenFlow=i.desiredScreenFlow!=null?i.desiredScreenFlow:K6.desiredScreenFlow,this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size,this.halfWindowSize=this.target.size/2}halfWindowPanAtZoom(e){const r=this.target.pixelsPerPanAtZoom(e);return this.halfWindowSize/r}get hasZoom(){return Math.abs(this.compared.sourceZoom-this.compared.targetZoom)>1e-5}get hasPan(){return this.compared.pan>1e-9}get hasRotate(){return this.compared.rotate>1e-9}},Iat=class{constructor(){this.segments=[]}get time(){return this.segments.reduce((e,r)=>e+r.time,0)}interpolateComponentsAt(e,r){e=Math.min(Math.max(e,0),1),e*=this.time;let i=0,n=0;const s=this.definition;for(let o=0;o<this.segments.length;o++){const a=this.segments[o],l=a.definition;if(e<=a.time||o===this.segments.length-1){if(r=this.segmentInterpolateComponentsAt(a,a.time===0?0:e/a.time,r),s.hasPan&&!isNaN(r.pan)&&isFinite(s.compared.pan)?r.pan=(i+l.compared.pan*r.pan)/s.compared.pan:r.pan=1,s.hasRotate&&!isNaN(r.rotate)&&isFinite(s.compared.rotate)?r.rotate=(n+l.compared.rotate*r.rotate)/s.compared.rotate:r.rotate=1,s.hasZoom&&!isNaN(r.zoom)&&isFinite(l.compared.targetZoom)){const c=r.zoom*(l.compared.targetZoom-l.compared.sourceZoom)+l.compared.sourceZoom,u=this.segments[0].definition.compared.sourceZoom,h=this.segments[this.segments.length-1].definition.compared.targetZoom;r.zoom=(c-u)/(h-u)}else r.zoom=1;return r}e-=a.time,i+=l.compared.pan,n+=l.compared.rotate}}segmentInterpolateComponentsAt(e,r,i){return e.interpolateComponentsAt(r,i)}},l7=class{get time(){return this._time}constructor(e){e&&this.update(e)}update(e){e&&(this.definition?this.definition.copyFrom(e):this.definition=e.clone()),this._updatePrecomputedVariables(),this._updatePixelFlow()}_updatePrecomputedVariables(){const e=this.definition,r=e.compared,i=r.sourceZoom,n=r.targetZoom;this._zoomSign=i>n?1:-1,this._panPixelsAtSource=r.pan*e.source.pixelsPerPanAtZoom(i);const s=(e.source.pixelsPerRotateAtZoom(i)+e.target.pixelsPerRotateAtZoom(n))/2;this._rotatePixels=r.rotate*s}_updatePixelFlow(){const e=this.definition.compared.sourceZoom,r=this.definition.compared.targetZoom,{hasZoom:i,hasPan:n,hasRotate:s}=this.definition;let o=0,a=0;i&&(n&&(o=(r/e-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),s&&(a=this._zoomSign*(Math.log(e/r)/Math.LN2)*this.definition.halfWindowSize/this._rotatePixels)),this._zoomPixelFlow=0,this._panPixelFlow=0,this._rotatePixelFlow=0;const l=this.definition.desiredPixelFlow;if(i&&n&&s){const c=o+a+o*a;this._zoomPixelFlow=o*a/c*l,this._panPixelFlow=a/c*l,this._rotatePixelFlow=o/c*l}else if(i&&n){const c=1+o;this._zoomPixelFlow=o/c*l,this._panPixelFlow=1/c*l}else if(i&&s){const c=1+a;this._zoomPixelFlow=a/c*l,this._rotatePixelFlow=1/c*l}else if(n&&s){const c=this._panPixelsAtSource/this._rotatePixels,u=1+c;this._panPixelFlow=c/u*l,this._rotatePixelFlow=1/u*l}else n?this._panPixelFlow=l:i?this._zoomPixelFlow=l:s&&(this._rotatePixelFlow=l);this._time=s?this.rotateTime:i?this.zoomTime:n?this.panTime:0}get rotateTime(){return this.definition.hasRotate?this._rotatePixels/this._rotatePixelFlow:0}get zoomTime(){return this.definition.hasZoom?this._zoomSign*(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2)*this.definition.halfWindowSize/this._zoomPixelFlow:0}get panTime(){if(this.definition.hasPan){if(this.definition.hasZoom){const e=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2,r=e*this._panPixelsAtSource;return Math.log(r*(this._zoomPixelFlow/this._panPixelFlow)+1)/(e*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}return 0}_interpolateComponentsZoom(e){if(e===0||e===1)return e;if(this.definition.hasZoom){const r=this.definition.compared.sourceZoom,i=this.definition.compared.targetZoom;return(r*(r/i)**-e-r)/(i-r)}return e}_interpolateComponentsPan(e){if(e===0||e===1)return e;if(this.definition.hasPan&&this.definition.hasZoom){const r=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*(this._panPixelFlow*(2**(r*e*this._time)-1))/(r*Math.LN2)}return e}_interpolateComponentsRotate(e){return e}interpolateComponentsAt(e,r){e=Math.min(Math.max(e,0),1);const i=this._interpolateComponentsZoom(e),n=this._interpolateComponentsPan(e),s=this._interpolateComponentsRotate(e);return r?(r.zoom=i,r.pan=n,r.rotate=s):r={zoom:i,pan:n,rotate:s},r}};function Lat(t,e,r){const i=e-t.compared.sourceZoom,n=t.halfWindowPanAtZoom(i);return-t.halfWindowSize*(r.ascensionFactor*Math.LN2*t.compared.pan+n)*Math.log(t.compared.sourceZoom/e)/(t.desiredPixelFlow*Math.LN2*n)}function Dat(t,e,r){const i=1/e,n=Math.log(t.compared.sourceZoom*i),s=1/t.desiredPixelFlow,o=1/Math.LN2,a=e-t.compared.sourceZoom,l=1/a,c=(r.ascensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(a))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*i*s*o*l*c-t.halfWindowSize*n*s*o*l+t.halfWindowSize*n*s*o*c/(a*a)}function Nat(t,e,r){const i=e-t.compared.sourceZoom,n=1/i,s=1/e,o=Math.log(t.compared.sourceZoom*s),a=(r.ascensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(i))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*n*(-2*n*s*a+2*n*o+2*s-2*o*a/(i*i)-a/(e*e))/(t.desiredPixelFlow*Math.LN2)}function Fat(t,e){return-t.halfWindowSize*Math.log(t.compared.sourceZoom/e)/(t.desiredPixelFlow*Math.LN2)}function kat(t,e){return t.halfWindowSize/(e*t.desiredPixelFlow*Math.LN2)}function zat(t,e){return-t.halfWindowSize/(e*e*t.desiredPixelFlow*Math.LN2)}function Uat(t,e,r){return-t.compared.pan*t.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e))}function Bat(t,e,r){return t.compared.pan*t.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e*e))}function Vat(t,e,r){return-2*t.compared.pan*t.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e*e*e))}function Gat(t,e,r){return t.halfWindowSize*(-t.halfWindowPanAtZoom(e)-r.descensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(t.compared.targetZoom))*Math.log(e/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2*t.halfWindowPanAtZoom(-e+t.compared.targetZoom))}function jat(t,e,r){const i=Math.log(e/t.compared.targetZoom),n=1/t.desiredPixelFlow,s=1/Math.LN2,o=-e+t.compared.targetZoom,a=1/o,l=(-t.halfWindowPanAtZoom(e)-r.descensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(t.compared.targetZoom))/t.halfWindowPanAtZoom(1);return-t.halfWindowSize*i*n*s*a+t.halfWindowSize*i*n*s*l/(o*o)+t.halfWindowSize*n*s*a*l/e}function Hat(t,e,r){const i=e-t.compared.targetZoom,n=1/i,s=1/e,o=Math.log(e/t.compared.targetZoom),a=(t.halfWindowPanAtZoom(e)+r.descensionFactor*Math.LN2*t.compared.pan-t.halfWindowPanAtZoom(t.compared.targetZoom))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*n*(-2*n*s*a-2*n*o+2*s+2*o*a/(i*i)-a/(e*e))/(t.desiredPixelFlow*Math.LN2)}function Wat(t,e){return t.halfWindowSize*Math.log(e/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2)}function qat(t,e){return t.halfWindowSize/(e*t.desiredPixelFlow*Math.LN2)}function Yat(t,e){return-t.halfWindowSize/(e*e*t.desiredPixelFlow*Math.LN2)}function Xat(t){const e=Math.LN2*t.compared.pan,r=t.compared.sourceZoom-t.compared.targetZoom,i=t.halfWindowPanAtZoom(r),n=t.halfWindowSize*Math.log(t.compared.sourceZoom/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2*i);return t.compared.sourceZoom<=t.compared.targetZoom?n*(e-i):n*(e+i)}function Zat(t,e){let r=Jat(t,e);const i={ascensionFactor:e.ascensionFactor!=null?e.ascensionFactor:.5,descensionFactor:e.descensionFactor!=null?e.descensionFactor:.5},n=i.ascensionFactor===0,s=i.descensionFactor===0,o=n?Fat:Lat,a=n?kat:Dat,l=n?zat:Nat,c=s?Wat:Gat,u=s?qat:jat,h=s?Yat:Hat,p=S=>o(t,S,i)+Uat(t,S,i)+c(t,S,i),f=S=>a(t,S,i)+Bat(t,S,i)+u(t,S,i),g=S=>l(t,S,i)+Vat(t,S,i)+h(t,S,i);let _=p(r);const v=Xat(t);let b;const w=e.maximumIterations||20,x=e.maximumDistance!=null?e.maximumDistance:1/0;for(b=0;b<w;b++){const E=(f(r)+1e-6)/g(r);if(isNaN(E)||r>=x&&E<0){if(!isFinite(x))return null;r=x,_=p(r);break}if(r-=E,r<t.compared.sourceZoom||r<t.compared.targetZoom)return null;const A=p(r);if(Math.abs(A-_)/_<=.005)break;_=A}return _>v*(1-.3)||r<t.compared.sourceZoom||r<t.compared.targetZoom?null:r}function Jat(t,e){const r=Math.max(t.compared.sourceZoom,t.compared.targetZoom),i=t.source.zoomAtPixelsPerPan(t.desiredPixelFlow/t.compared.pan)/2;return i<r?e.maximumDistance!=null?r+(e.maximumDistance-r)/2:1.5*r:e.maximumDistance?Math.min(e.maximumDistance,i):i}let Qat=class extends Iat{constructor(e,r){super(),this._preallocSegments=[new l7,new l7,new l7],this._ascensionSegment=null,this._descensionSegment=null,this.update(e,r)}update(e,r){if(!e)return;this.definition?this.definition.copyFrom(e):this.definition=e.clone();let i=null;r!=null&&r.apex&&(i=Zat(e,r.apex)),this.segments.length=0,this._ascensionSegment=null,this._descensionSegment=null,i==null?this._updateWithoutApex():this._updateWithApex(i,r==null?void 0:r.apex)}segmentInterpolateComponentsAt(e,r,i){return i=e.interpolateComponentsAt(r,i),e===this._ascensionSegment?i.zoom=Cre(i.zoom):e===this._descensionSegment&&(i.zoom=yU(i.zoom)),i}_updateWithApex(e,r){const[i,n,s]=this._preallocSegments,o=(r==null?void 0:r.ascensionFactor)??.5,a=Math.min(1-o,(r==null?void 0:r.ascensionFactor)!=null&&r.descensionFactor!=null?r.descensionFactor:.5),l=1-o-a;i.definition?i.definition.copyFrom(this.definition):i.definition=this.definition.clone(),i.definition.compared.targetZoom=e,i.definition.compared.pan=this.definition.compared.pan*o,i.definition.compared.rotate=this.definition.compared.rotate*o,i.update(),this._ascensionSegment=i,this.segments.push(i),l>0&&(n.definition?n.definition.copyFrom(this.definition):n.definition=this.definition.clone(),n.definition.copyFrom(this.definition),n.definition.compared.sourceZoom=e,n.definition.compared.targetZoom=e,n.definition.compared.pan=this.definition.compared.pan*l,n.definition.compared.rotate=this.definition.compared.rotate*l,n.update(),this.segments.push(n)),s.definition?s.definition.copyFrom(this.definition):s.definition=this.definition.clone(),s.definition.compared.sourceZoom=e,s.definition.compared.pan=this.definition.compared.pan*a,s.definition.compared.rotate=this.definition.compared.rotate*a,s.update(),this._descensionSegment=s,this.segments.push(s)}_updateWithoutApex(){const[e]=this._preallocSegments;e.update(this.definition),this.segments.push(e)}};const Kat={zoom:0,pan:0,rotate:0};let elt=class{get time(){return this._time}constructor(e){this._createCamera=e,this._time=0,this.definition=new $at(e),this.path=new Qat}update(e,r,i){this.definition.update(e,r,i),this.path.update(this.definition,i),this._time=this._applyTimeSettings(kbe(isFinite(this.path.time)?this.path.time:0),i),this._easing=i.easing??(this._time>=1e3?MMe:ZI)}cameraAt(e,r){r=r||this._createCamera(),e=Math.min(Math.max(0,e),1),e=this._normalizedEasing(e);const i=this.path.interpolateComponentsAt(e,Kat);return r.interpolate(this.definition.source,this.definition.target,i),r}_normalizedEasing(e){const r=this._easing(0,this._time),i=this._easing(1,this._time);return(this._easing(e,this._time)-r)/(i-r)}_applyTimeSettings(e,r){const i=r.speedFactor!=null?r.speedFactor:1;r.duration!=null?e=r.duration:r.speedFactor!=null&&(e=e/i);const n=r.minDuration!=null?r.minDuration:K6.minDuration/i,s=r.maxDuration!=null?r.maxDuration:K6.maxDuration/i;return Math.min(Math.max(n,e),s)}},tlt=class{get finished(){return this.currentTime>=this._animation.time}get time(){return this._animation.time}constructor(e){this.currentTime=0,this._animation=new elt(()=>new Rhe(e)),this._current=new Rhe(e)}update(e,r,i){const{source:n,target:s}=this._animation.definition,o=ye(rlt,r.center,e.center),a=Te(o);a>=1e-5?(o[0]/=a,o[1]/=a,o[2]/=a):(o[0]=0,o[1]=1,o[0]=0),ce(n.direction,o),ce(s.direction,o),n.copyFromRenderCamera(e),s.copyFromRenderCamera(r),this._current.copyFrom(n),this._animation.update(n,s,i),this.currentTime=0,e.almostEquals(r)&&(this.currentTime=this._animation.time)}cameraAt(e,r){return this._animation.cameraAt(e,this._current),r=r||new Qe,this._current.copyToRenderCamera(r),r}step(e,r){return this.finished||(this.currentTime=this.currentTime+kbe(e),this.currentTime>=this.time&&(this.currentTime=this.time)),this.cameraAt(this.currentTime/this.time,r)}};const rlt=C();var rn;(function(t){t[t.Ready=0]="Ready",t[t.Rejected=1]="Rejected",t[t.Running=2]="Running",t[t.Stopped=3]="Stopped",t[t.Finished=4]="Finished"})(rn||(rn={}));let w0=class extends Ae{constructor(e){super(e),this.state=rn.Ready}get active(){return this.state===rn.Running}get isInteractive(){return!1}get canStop(){return!1}stopController(){return!!this.canStop&&(this.state=rn.Stopped,!0)}finishController(){this.state=rn.Finished}get steppingFinished(){return!1}};d([m({constructOnly:!0})],w0.prototype,"view",void 0),d([m({readOnly:!0})],w0.prototype,"active",null),d([m()],w0.prototype,"state",void 0),d([m({readOnly:!0})],w0.prototype,"isInteractive",null),w0=d([V("esri.views.3d.state.controllers.CameraController")],w0);let U$=class extends w0{constructor(){super(...arguments),this._asyncResult=null}get canStop(){return!0}set asyncResult(e){this._asyncResult&&(this._asyncResult.reject(dr()),this._asyncResult=null),this.state===rn.Finished||this.state===rn.Stopped?(Rz(e),this.state===rn.Finished?e.resolve():e.reject(dr())):this._asyncResult=e}get asyncResult(){return this._asyncResult}onControllerStart(){this.state=rn.Running,this.viewAnimation!=null&&this.viewAnimation.when(()=>this.updateStateFromViewAnimation(),()=>this.updateStateFromViewAnimation())}updateStateFromViewAnimation(){this.viewAnimation==null||this.state!==rn.Ready&&this.state!==rn.Running||(this.viewAnimation.state===r3.State.FINISHED?this.finish():this.viewAnimation.state===r3.State.STOPPED&&(this.state=rn.Stopped))}onControllerEnd(){this.viewAnimation==null||this.viewAnimation.done||(this.state===rn.Finished?this.viewAnimation.finish():this.state===rn.Stopped&&this.viewAnimation.stop()),this._asyncResult&&(this.state===rn.Finished?this._asyncResult.resolve():this._asyncResult.reject(dr()))}finish(){this.finishController()}};U$=d([V("esri.views.3d.state.controllers.AnimationController")],U$);let M0=class extends U${get intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.mode="interaction",this._hasTarget=!1}initialize(){this.animation=new tlt(this.view.state.viewingMode),this.viewAnimation=this.mode==="interaction"?null:new r3}get isInteractive(){return this.mode==="interaction"}begin(e,r){this._hasTarget=!0;const i=this.animationSettings(r);QD.copyFrom(this.view.state.camera);const n=yd(this.view.state.viewingMode);this.intersectionHelper.intersectRay(QD.ray,n,Lhe)&&(QD.center=Lhe),this.animation.update(QD,e,i),this.animation.finished&&this.finish()}finish(){this.animation.currentTime=this.animation.time,super.finish()}get steppingFinished(){return this._hasTarget&&this.animation.finished}stepController(e,r){this._hasTarget&&this.animation.step(e,r)}onControllerEnd(e){this._hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,e),this.animation.currentTime=this.animation.time),super.onControllerEnd(e)}animationSettings(e={}){return{apex:{maximumDistance:this.view.state.constraints.clampAltitude(1/0)/6,ascensionFactor:void 0,descensionFactor:void 0},...e,easing:typeof e.easing=="string"?Sat[e.easing]:e.easing}}};d([m({constructOnly:!0})],M0.prototype,"mode",void 0),d([m({readOnly:!0})],M0.prototype,"isInteractive",null),M0=d([V("esri.views.3d.state.controllers.PointToPointAnimationController")],M0);const QD=new Qe,Lhe=C();function _U(t=nlt){return[t[0],t[1],t[2],t[3]]}function B$(t,e){return ilt(t[0],t[1],t[2],e,Vee.get())}function ilt(t,e,r,i,n=_U()){return n[0]=t,n[1]=e,n[2]=r,n[3]=i,n}function $re(t,e,r){return Je(r,t,e),pe(r,r),r[3]=P9(t,e),r}const nlt=[0,0,1,0];function TUt(t,e,r=Js()){return Ire(t,Rp(e),r),pe(r.direction,r.direction),r}function Ire(t,e,r){return slt(t,t.screenToRender(e,Be.get()),r)}function slt(t,e,r){const i=eo(Be.get(),e);if(i[2]=0,!t.unprojectFromRenderScreen(i,r.origin))return null;const n=eo(Be.get(),e);n[2]=1;const s=t.unprojectFromRenderScreen(n,Be.get());return s==null?null:(ye(r.direction,s,r.origin),r)}function J3(t,e,r){return Lre(t,t.screenToRender(e,Be.get()),r)}function Lre(t,e,r){ce(r.origin,t.eye);const i=ie(Be.get(),e[0],e[1],1),n=t.unprojectFromRenderScreen(i,Be.get());return n==null?null:(ye(r.direction,n,r.origin),r)}function Dre(t,e,r,i){const n=J3(e,r,olt);return Dv(t,n,i)}const olt=Js();var l3;(function(t){t[t.Ellipsoid=0]="Ellipsoid",t[t.Silhouette=1]="Silhouette"})(l3||(l3={}));const RMe=30,e8=[1,3e8],vU=80,$Me=8,IMe=200,LMe=1508e5,DMe=5,NMe=50,alt=5,llt=10,c7=90,j2={exclude:new Set([pv])};function Ix(t,e,r){return r[0]=e[0]/(t.fullWidth/t.pixelRatio),r[1]=e[1]/(t.fullHeight/t.pixelRatio),r}function _Z(t){for(;t>Math.PI;)t-=2*Math.PI;for(;t<-Math.PI;)t+=2*Math.PI;return t}function wv(t,e,r){const i=Kc(Gee.get(),r[3],r);i==null||pee(i,sn)||(ye(di,t.eye,e),Ge(di,di,i),t.eye=fe(di,di,e),ye(di,t.center,e),Ge(di,di,i),t.center=fe(di,di,e),t.up=Ge(di,t.up,i))}function clt(t,e,r,i){return R2(t,Ire(e,r,kre),i)}function vZ(t,e,r,i){return R2(t,J3(e,r,kre),i)}function Nre(t,e,r,i){const n=Be.get();let s=1-r;ye(n,e,t.eye);const o=Te(n);let a=o*(1-s);s>=0&&a<i&&(a=i,s=-(a-o)/o),Math.abs(o-a)<1e-6||(ne(n,n,s),t.eye=fe(di,t.eye,n),t.center=ni(di,t.center,e,s))}function FMe(t,e,r){e.getScreenCenter(Dhe),Dre(t,e,Dhe,di)&&(e.center=di);const i=e.distance,n=i*r;if(Math.abs(i-n)<1e-6)return;const s=ne(Be.get(),e.viewForward,n);e.eye=ye(di,e.center,s)}const Dhe=pn();function u7(t,e){ie(e,0,0,0);for(const r of t)fe(e,e,r);ne(e,e,1/t.length)}function uF(t,e,r,i){return Math.sin(t/Te(e))*(r+i.radius)}function Nhe(t,e,r,i){return uF(Math.PI/2,e,r,i)+(t-Math.PI/2)}var wo;(function(t){t[t.Vertical=0]="Vertical",t[t.Horizontal=1]="Horizontal"})(wo||(wo={}));const Fhe={Elevation:3e4,Angle:Nt(16)},KD={Pole:.95,Angle:Nt(18),Tilt:45},kMe=Nt(80);function zMe(t,e,r,i,n,s){const o=C(),a=Jn();let l=!0,c=!0;return t.intersectScreen(r,o,s)?a[3]=Te(o):(c=!1,e.aboveGround&&n!==l3.Ellipsoid?a[3]=Math.max(Te(e.center),.9*i.radius):a[3]=Te(e.eye)-e.relativeElevation,n===l3.Silhouette?V$(a,e,r,o):l=Dre(a,e,r,o)),{sphere:a,scenePickPoint:l?o:null,hasGeometryIntersection:c}}function bU(t,e,r){return Te(t.eye)-r.radius>Fhe.Elevation?wo.Horizontal:(J3(t,e,Hhe),-Math.sign(t.relativeElevation)*(.5*Math.PI+P9(t.eye,Hhe.direction))<Fhe.Angle?wo.Vertical:wo.Horizontal)}function UMe(t,e,r){ye(h7,r,e),t.eye=ye(di,t.eye,h7),t.center=ye(di,t.center,h7)}const h7=C();function V$(t,e,r,i){const n=J3(e,r,kre);return n!=null&&(z3(t,n,eN),Dv(t,n,i)?!(Uo(eN,n.origin)<Uo(i,n.origin))||(ce(i,eN),!1):(ye(pT,e.eye,e.center),pe(pT,pT),PSe(pT,-de(pe(pT,pT),eN),khe),R2(khe,n,i),!1))}const eN=C(),pT=C(),khe=zr();function BMe(t,e,r,i,n,s){let o=0;if(Je(i8,t,e),ye(nN,t,e),Te(t)<=n||!i.aboveGround){Je(r,nN,i.eye);const a=de(t,e)/(Te(t)*Te(e));if(a<.9999)o=Ks(a);else{const c=Te(Je(C(),t,e))/(Te(t)*Te(e));o=hd(c)}const l=Math.cos(we(ov.normalize(Nt(s)),0,kMe));o=-o-Math.max(0,Te(e)-n)/(l*n)}else ye(zhe,i.eye,i.center),Je(r,nN,zhe),o=-Te(nN)/n;return pe(r,r),ne(r,r,Te(i8)),o}const zhe=C();function Uhe(t,e,r,i){let n,s;const o=Math.cos(we(ov.normalize(Nt(i)),0,kMe));return n=e>r?-(e-r)/(o*r):e<-r?Math.PI-(e+r)/(o*r):Ks(e/r),s=t>r?-(t-r)/(o*r):t<-r?Math.PI-(t+r)/(o*r):Ks(t/r),(s-n)*r}function ult(t,e,r,i,n,s,o,a,l,c){const u=Uhe(t[2],e[2],s[3],a),h=l?Uhe(t[0],e[0],s[3],180):e[0]-t[0],p=Math.sin(o)*h-Math.cos(o)*u,f=Math.cos(o)*h+Math.sin(o)*u;pe(di,n);const g=l?p/Math.sqrt(Math.abs(s[3]**2-de(r,di)**2)):p/s[3],_=f/Math.sqrt(Math.abs(s[3]**2-de(r,i)**2));cr(c,g,_)}function VMe(t,e,r,i,n,s,o,a,l,c){Je(i8,t,e),dq(s.up,s.eye,tN,rN,iN),dq([0,0,1],s.eye,U0,W1,WMe),ce(r,W1),ce(i,U0),pe(r,r),ne(r,r,Te(i8)),Wle(t,pe(rN,rN),pe(iN,iN),pe(tN,tN),Bhe),Wle(e,rN,iN,tN,Vhe),ult(Bhe,Vhe,t,U0,W1,o,a,l,c,n)}function hlt(t,e,r,i,n,s,o){Kc(t8,n,i),Kc(r8,o,s),Hr(hC,t8,r8),ye(e,t,r),Ge(e,e,hC),fe(e,e,r)}function GMe(t,e,r,i,n,s){Kc(t8,i,r),Kc(r8,s,n),Hr(hC,t8,r8),ye(di,t.eye,e),Ge(di,di,hC),t.eye=fe(di,di,e),ye(di,t.center,e),Ge(di,di,hC),t.center=fe(di,di,e),ye(di,t.up,e),Ge(di,di,hC),t.up=fe(di,di,e)}function Fre(t,e,r,i,n,s){return(Math.abs(i)>Math.PI-KD.Angle||Math.abs(i)<KD.Angle)&&(Math.abs(t[2])<r*KD.Pole||Math.abs(e)>r)&&s.aboveGround&&n<KD.Tilt}function jMe(t,e,r,i,n,s){if(s)$re(r,i,Ghe),wv(e,t,Ghe);else{const o=BMe(r,i,jhe,e,t[3],n);wv(e,t,B$(jhe,o))}}function HMe(t,e,r,i,n,s,o){const a=o?20:1,l=1e-12;let c,u;ce(ab,i),sN.copyFrom(e);for(let h=0;h<a&&Uo(r,ab)>l&&(c=Uo(r,ab),VMe(r,ab,W1,U0,WP,sN,t,n,s,o),GMe(sN,t,U0,WP[1],W1,WP[0]),hlt(ab,ab,t,U0,WP[1],W1,WP[0]),u=Uo(r,ab),u<c||h===0);h++)e.copyFrom(sN)}function dlt(t,e,r,i,n,s,o){Fre(r,de(e.up,r),t[3],-ov.normalize(Nt(n)),s,e)?HMe(t,e,r,i,-ov.normalize(Nt(n)),s,o):jMe(t,e,r,i,s,o)}function plt(t,e,r,i,n,s){const{eye:o}=t;dq([0,0,1],o,U0,W1,WMe);const a=e.translation[0]*r.pan,l=n.mode==="zoom"?0:e.translation[1]*r.pan,c=Math.max(Math.sqrt(Math.abs(1-de(t.center,U0)**2/Te(t.center)**2)),.5),u=(Math.sin(s)*l+Math.cos(s)*a)/c,h=-Math.cos(s)*l+Math.sin(s)*a;switch(Gc(i.pan.matrix,i.pan.matrix,u,U0),i.pan.enabled=!0,n.mode){case"pan":Gc(i.pan.matrix,i.pan.matrix,h,W1),i.pan.enabled=!0;break;case"zoom":i.zoom=-e.translation[1]*r.zoom}}function flt(t,e,r,i,n){const{eye:s,viewRight:o}=t,a=Je(Be.get(),o,s),l=e.translation[0]*r.pan;switch(l!==0&&(Gc(i.pan.matrix,i.pan.matrix,-l,a),i.pan.enabled=!0),n.mode){case"pan":{const c=e.translation[1]*r.pan;c!==0&&(Gc(i.pan.matrix,i.pan.matrix,c,o),i.pan.enabled=!0);break}case"zoom":i.zoom=-e.translation[1]*r.zoom}}function mlt(t,e,r,i,n,s,o,a,l){Fre(t.center,de(t.up,t.center),Te(t.center),-ov.normalize(Nt(s)),o,e)?plt(e,r,i,a,l,-ov.normalize(Nt(n))):flt(e,r,i,a,l)}const U0=C(),W1=C(),WMe=C(),tN=C(),rN=C(),iN=C(),Bhe=C(),Vhe=C(),WP=He(),Ghe=_U(),t8=xe(),r8=xe(),hC=xe(),ab=C(),di=C(),nN=C(),sN=new Qe,i8=C(),jhe=C(),kre={origin:C(),direction:C()},Hhe={origin:C(),direction:C()},Whe=.6,d7=4,glt=60;let n8=class extends M0{constructor(){super(...arguments),this._zoomLocation=C(),this._tmpCamera=new Qe,this._tmpViewDir=C(),this._tmpRayDir={origin:C(),direction:C()},this._targetOnSphere=C(),this._tmpCenter=C(),this._beginCamera=new Qe,this._constraintOptions=new Sd(Vi.ALL_EXCEPT_COLLISION,rr.ZOOM,null,this._beginCamera),this._sphere=Jn()}initialize(){this._intersector=yd(this.view.state.viewingMode)}zoomStep(e,r){if(!this.active)return;const i=this.view.state;this.animation.finished?this._beginCamera.copyFrom(i.camera):this.animation.cameraAt(1,this._beginCamera);let n=!1,s=!1;this.intersectionHelper.intersectScreen(r,this._zoomLocation,this.view.map.ground.opacity===0?j2:{})&&(n=e>0,s=!0),this._tmpCamera.copyFrom(i.camera),n?this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter):this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:ce(this._zoomLocation,this._tmpCamera.center),this._updateCamera(this._tmpCamera,e,this._zoomLocation,r,s),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:ZI}}_updateCamera(e,r,i,n,s){const o=Br(this.view.spatialReference),a=bU(e,n,o),l=Math.abs(this.view.camera.position.z);pe(aN,e.eye),ne(aN,aN,-1),J3(e,n,this._tmpRayDir),pe(this._tmpRayDir.direction,this._tmpRayDir.direction);const c=we(Math.min($Me,1/Math.abs(de(aN,this._tmpRayDir.direction)))*l,IMe,LMe);if(a===wo.Horizontal){let u=Whe**r;this._sphere[3]=Te(i),ye(this._tmpViewDir,e.center,e.eye);const h=Math.min(Te(this._tmpViewDir),c);let p=h*u;if(u<=1&&p<d7&&(p=d7,u=p/h),Math.abs(h-p)<1e-6)return;const f=Te(e.center);if(this._sphere[3]!==f){const g=this._sphere[3]+u*(f-this._sphere[3]);e.center=ne(oN,e.center,g/f)}ne(this._tmpViewDir,this._tmpViewDir,-u),e.eye=fe(oN,e.center,this._tmpViewDir),qn(this.view,e,this._constraintOptions),Uo(i,e.center)>1e-12&&Dre(this._sphere,e,n,this._targetOnSphere)&&dlt(this._sphere,e,i,this._targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{let u=Whe**Math.abs(r);const h=r>0?1:-1;ye(this._tmpViewDir,i,e.eye);const p=Te(this._tmpViewDir),f=this.view._stage.renderView.getMinimalDepthForArea(null,n[0],n[1],this.view.state.camera,glt);let g=f??c;g=s&&r>0?Math.min(g,p):g,ne(this._tmpRayDir.direction,this._tmpRayDir.direction,g),fe(i,this._tmpRayDir.origin,this._tmpRayDir.direction);let _=g*u;const v=Math.max(d7,1.01*e.nearFar[0]);if(r>0&&_<v&&(_=v,u=_/g),Math.abs(g-_)<1e-6)return;ne(this._tmpRayDir.direction,this._tmpRayDir.direction,h*(1-u)),e.eye=fe(oN,e.eye,this._tmpRayDir.direction),e.center=fe(oN,e.center,this._tmpRayDir.direction)}Z3(this.view,e)}};n8=d([V("esri.views.3d.state.controllers.global.ZoomStepController")],n8);const oN=C(),aN=C();let hF,dF=null;const sE=new Map;async function CUt(t){dF==null&&(hF==null&&(hF=ge(()=>import("./VoxelWasmPerSceneView-B5Rz73qQ.js"),__vite__mapDeps([]))),dF=await hF);const e=t.view;let r=sE.get(e);return r||(r=new dF.default({view:e}),sE.set(e,r)),r.addVoxelLayer(t)}function G$(t){return sE.get(t)}function EUt(t){const e=t.view,r=sE.get(e);r&&r.removeVoxelLayer(t)<1&&(sE.delete(e),sE.size===0&&(hF=null,dF=null))}const ylt=.6,_lt=4,vlt=60;let s8=class extends M0{constructor(){super(...arguments),this._zoomLocation=C(),this._tmpCamera=new Qe,this._tmpRayDir=C(),this._tmpCenter=C(),this._beginCamera=new Qe,this._constraintOptions=new Sd(Vi.ALL,rr.ZOOM,null,this._beginCamera)}zoomStep(e,r){if(!this.active)return;const i=this.view.state;this.animation.finished?this._beginCamera.copyFrom(i.camera):this.animation.cameraAt(1,this._beginCamera),this._tmpCamera.copyFrom(i.camera);const n=yd(this.view.state.viewingMode);let s=!1;e>0?(s=this.intersectionHelper.intersectScreenFreePointFallback(r,this._zoomLocation,this.view.map.ground.opacity===0?j2:{}),this.intersectionHelper.intersectRay(this._tmpCamera.ray,n,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter)):this.intersectionHelper.intersectRay(this._tmpCamera.ray,n,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:ce(this._zoomLocation,this._tmpCamera.center);const o=ylt**e;let a=this.view._stage.renderView.getMinimalDepthForArea(G$(this.view),r[0],r[1],this.view.state.camera,vlt);ye(lN,this._tmpCamera.eye,this._zoomLocation),pe(lN,lN);const l=we(Math.min($Me,1/Math.abs(de(blt,lN)))*Math.abs(this.view.camera.position.z),IMe,LMe);if(a=a??l,a){const c=C();ye(c,this._zoomLocation,this._tmpCamera.eye),(a<Te(c)||!s)&&(pe(c,c),fe(this._zoomLocation,this._tmpCamera.eye,ne(c,c,a)))}this._updateCamera(this._tmpCamera,o,this._zoomLocation),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:ZI}}_updateCamera(e,r,i){ye(this._tmpRayDir,i,e.eye);const n=Te(this._tmpRayDir);let s=n*r;const o=r<=1,a=Math.max(_lt,1.01*e.nearFar[0]);s!==0&&(o&&s<a&&(s=a,r=s/n),Math.abs(n-s)<1e-6||(ne(this._tmpRayDir,this._tmpRayDir,r),e.eye=ye(qhe,i,this._tmpRayDir),e.center=ni(qhe,e.center,i,1-r),qn(this.view,e,this._constraintOptions)))}};s8=d([V("esri.views.3d.state.controllers.local.ZoomStepController")],s8);const qhe=C(),blt=Ce(0,0,1),lN=C();function wlt(t,e){switch(e){case"primary":return t.pointerType==="touch"||t.button===0;case"secondary":return t.pointerType!=="touch"&&t.button===2;case"tertiary":return t.pointerType!=="touch"&&t.button===1}}function zre(t,e){if(t.pointerType==="touch")return!1;switch(e){case"primary":return t.button===0;case"secondary":return t.button===2;case"tertiary":return t.button===1}}let xlt=class extends qo{constructor(e,r){super(!0),this._view=e,this.registerIncoming("double-click",r,i=>this._handleDoubleClick(i))}_handleDoubleClick(e){const r=e.data;if(wlt(r,"primary")){const i=this._view.state.isGlobal?new n8({view:this._view,mode:"animation"}):new s8({view:this._view,mode:"animation"});this._view.state.switchCameraController(i),i.zoomStep(Math.log(.5)/Math.log(.6),pn(r.x,r.y)),e.stopPropagation()}}};function Tlt(t,e,r){return t===De.Global?new Clt(r):new Slt(e,r)}let Slt=class{constructor(e,r){this._elevationProvider=e,this._referenceEllipsoid=Br(r),this._unitInMeters=Ba(r,this._referenceEllipsoid.metersPerDegree)}compute(e,r,i,n,s){var x;s||(s={near:0,far:0});let o=e[2]*this._unitInMeters;const a=o,l=o-n,c=(x=this._elevationProvider)==null?void 0:x.visibleElevationBounds;c&&(o=l>=0?a-this._unitInMeters*c.min:this._unitInMeters*c.max-a);const u={x:(i=i??new ei({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0})).xmax-i.xmin,y:i.ymax-i.ymin,z:4*Math.max(i.xmax-i.xmin,i.ymax-i.ymin)},h=Math.max(u.x,u.y,u.z);ye(lb,r,e),fT[0]=lb[0]>0?i.xmax:i.xmin,fT[1]=lb[1]>0?i.ymax:i.ymin,fT[2]=lb[2]>0?h/2:-h/2,ye(fT,fT,e),pe(lb,lb);const p=1.1*de(fT,lb)*this._unitInMeters,f=Math.sqrt(o*(o+2*this._referenceEllipsoid.radius)),g=Math.max(i.xmax-i.xmin,i.ymax-i.ymin),_=g*Alt*this._unitInMeters,v=g*Mlt*this._unitInMeters,b=we((o-v)/(_-v),0,1)**3,w=Math.min(Rt(f,p,b),f)*Math.max(Math.log(Math.abs(l)),1);return qMe(Math.min(w,Math.max(34064e4,h))/this._unitInMeters,Elt,this._unitInMeters,s)}},Clt=class{constructor(e){this._referenceEllipsoid=Br(e)}compute(e,r,i,n,s){s||(s={near:0,far:0});const o=Te(e),a=o-this._referenceEllipsoid.radius,l=this._referenceEllipsoid.radius+Math.min(0,n),c=Math.abs(a-n),u=Math.max(c,Math.abs(a)),h=Math.sqrt(u*(u+2*l)),p=o+this._referenceEllipsoid.radius;return qMe(1.2*Rt(h,p,qte(u)),we(2e4-(Math.log(u)-7.983)/9.011*19e3,1e3,2e4),1,s)}};function qMe(t,e,r,i){const n=Plt/r;return t/e>n?(i.far=t,i.near=i.far/e):(i.near=n,i.far=i.near*e),i}const Elt=2e4,Plt=2,Alt=.001,Mlt=1e-4,fT=C(),lb=C();let pF=class extends Ae{constructor(e){super(e)}initialize(){this.addHandles(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e)))}_handleElevationChangeEvent(e){if(this.view.state.cameraController)return;const r=this.view.state.camera;e.spatialReference!=null&&kCe(this.view,r,e.extent,e.spatialReference)&&this._applyToCurrentCamera()}_applyToCurrentCamera(){this.view.state.updateCamera(e=>Z3(this.view,e,ed.EYE_AND_CENTER))}};d([m({constructOnly:!0})],pF.prototype,"view",void 0),pF=d([V("esri.views.3d.state.ElevationCollisionConstraint")],pF);let $M=class extends Ae{constructor(e){super(e),this.nearFarHeuristic=Tlt(e.view.state.viewingMode,e.view.basemapTerrain,e.view.renderCoordsHelper.spatialReference)}initialize(){this.addHandles([he(()=>{var e,r,i,n;return[(r=(e=this.view.constraints)==null?void 0:e.clipDistance)==null?void 0:r.near,(n=(i=this.view.constraints)==null?void 0:i.clipDistance)==null?void 0:n.far]},()=>this._clipDistanceNearFarChanged()),he(()=>{var e,r;return(r=(e=this.view.constraints)==null?void 0:e.clipDistance)==null?void 0:r.mode},()=>this._updateNearFar()),this.view.state.events.on("before-camera-change",e=>this._updateCameraNearFar(e)),he(()=>this.view.renderDataExtent,()=>this._updateNearFar(),Qr),he(()=>{var e,r,i,n;return[(r=(e=this.view.constraints)==null?void 0:e.altitude)==null?void 0:r.min,(n=(i=this.view.constraints)==null?void 0:i.altitude)==null?void 0:n.max]},()=>this._updateAltitude(),Qr),he(()=>{var e,r;return(r=(e=this.view.constraints)==null?void 0:e.tilt)==null?void 0:r.max},()=>this._updateTiltMax(),Qr),he(()=>{var e,r;return(r=(e=this.view.constraints)==null?void 0:e.tilt)==null?void 0:r.mode},()=>this._updateTilt(),Qr),he(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},()=>this._updateTiltAutoMax(),Qr),he(()=>{var e,r,i,n,s,o;return[(i=(r=(e=this.view.map)==null?void 0:e.ground)==null?void 0:r.navigationConstraint)==null?void 0:i.type,(o=(s=(n=this.view.state)==null?void 0:n.constraints)==null?void 0:s.collision)==null?void 0:o.enabled]},()=>this._updateCollision(),Qr)]),this.view.state.isLocal&&this.addHandles(he(()=>this.view.renderDataExtent,e=>this._updateLocalSurfaceDistance(e),gi)),this._updateNearFar(),this.view.state.viewingMode!==De.Local&&this._updateAltitude(),this._updateTilt(),this._updateCollision(),this._set("surfaceCollisionConstraint",new pF({view:this.view}))}destroy(){this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))}_clipDistanceNearFarChanged(){var r;const e=(r=this.view.constraints)==null?void 0:r.clipDistance;e&&e.mode!=="auto"&&this.view.state.updateCamera(i=>this._updateCameraNearFarManual(i,e))}_updateNearFar(){this.view.state.updateCamera(e=>this._updateCameraNearFar(e))}_updateCameraNearFar(e){const r=this.view.constraints&&this.view.constraints.clipDistance;(r?r.mode:"auto")==="manual"?this._updateCameraNearFarManual(e,r):this._updateCameraNearFarAuto(e,r)}_updateCameraNearFarAuto(e,r){this.nearFarHeuristic.compute(e.eye,e.center,this.view.renderDataExtent,V9(this.view,e.eye),e),r&&r.autoUpdate(e.near,e.far)}_updateCameraNearFarManual(e,r){r&&(e.near=r.near,e.far=r.far)}_updateCollision(){var n,s,o;const e=(o=(s=(n=this.view.map)==null?void 0:n.ground)==null?void 0:s.navigationConstraint)==null?void 0:o.type,r=!e||e==="stay-above",i=this.view.state.constraints.collision;if(r!==i.enabled){i.enabled=r,r&&this._reapplyConstraints(Vi.COLLISION);const a=this.view.constraints&&this.view.constraints.tilt;a&&a.mode!=="auto"||this._updateTiltAuto()}}_updateAltitude(){const e=this.view.constraints&&this.view.constraints.altitude;e&&this.view.state.viewingMode!==De.Local?this.view.state.constraints.altitude={min:e.min,max:e.max}:this.view.state.constraints.altitude=null,this._reapplyConstraints()}_updateTiltMax(){const e=this.view.constraints&&this.view.constraints.tilt;e&&e.mode!=="auto"&&(this._updateTiltManual(e),this._reapplyConstraints())}_updateTilt(){const e=this.view.constraints&&this.view.constraints.tilt;(e?e.mode:"auto")==="manual"?this._updateTiltManual(e):this._updateTiltAuto(),this._reapplyConstraints()}_updateTiltManual(e){const r=this.view.state.constraints;r.tilt=r.createConstantMaxTilt(Nt(e.max))}_updateTiltAuto(){const e=this.view.state.constraints;e.tilt=e.createDefaultTilt(),this._updateTiltAutoMax()}_updateTiltAutoMax(){const e=this.view.constraints&&this.view.constraints.tilt;if(!e||e.mode!=="auto")return;const r=this.view.state.constraints;if(r.tilt){const i=r.tilt(this.view.state.camera.distance).max;e.autoUpdate(Fa(i))}}_updateLocalSurfaceDistance(e){if(e==null)return;let r=Math.max(e.width,e.height);if(r<=0)return;e.zmax!=null&&e.zmin!=null&&(r=Math.max(r,e.zmax-e.zmin));const i=this.view.state,n=3*r/Math.atan(i.camera.fov/2);n!==i.constraints.distance&&(i.constraints.distance=n)}_reapplyConstraints(e=Vi.ALL){this.view.state.updateCamera(r=>qn(this.view,r,new Sd(e,rr.NONE,null)))}};d([m({constructOnly:!0})],$M.prototype,"view",void 0),d([m({readOnly:!0})],$M.prototype,"surfaceCollisionConstraint",void 0),$M=d([V("esri.views.3d.state.ConstraintsManager")],$M);let u1=class{get planes(){return this.frustum}get points(){return this._points}get mutablePoints(){return this._points}get direction(){return this._direction}get origin(){return this._origin}constructor(e){this.renderCoordsHelper=e,this.frustum=N$(),this._points=fAe(),this.lines=new Array(12),this._origin=C(),this._direction=C(),this._altitude=null;for(let r=0;r<12;r++)this.lines[r]={origin:null,direction:C(),endpoint:null}}update(e){mAe(e.viewMatrix,e.projectionMatrix,this.frustum,this._points),ce(this._origin,e.eye),ce(this._direction,e.viewForward),this._altitude=this.renderCoordsHelper.getAltitude(this._origin),this._updateLines()}updatePoints(e){for(let r=0;r<this._points.length;r++)ce(this._points[r],e[r]);gAe(this.frustum,this._points),this._updateLines()}get altitude(){return this._altitude}intersectsSphere(e){return P1(this.frustum,e)}intersectsRay(e){return bnt(this.frustum,e)}intersectsLineSegment(e,r){return wnt(this.frustum,e,r)}intersectsPoint(e){return yAe(this.frustum,e)}_updateLines(){const e=this._points;for(let r=0;r<4;r++){const i=r+4;p7(this.lines[r],e[r],e[i]),p7(this.lines[r+4],e[r],r===3?e[0]:e[r+1]),p7(this.lines[r+8],e[i],r===3?e[4]:e[i+1])}}};function p7(t,e,r){t.origin=e,t.endpoint=r,fy(t.direction,e,r)}u1.planePointIndices=xnt,u1.nearFarLineIndices=[[st.NEAR_BOTTOM_LEFT,st.FAR_BOTTOM_LEFT],[st.NEAR_BOTTOM_RIGHT,st.FAR_BOTTOM_RIGHT],[st.NEAR_TOP_RIGHT,st.FAR_TOP_RIGHT],[st.NEAR_TOP_LEFT,st.FAR_TOP_LEFT]];let aR=class extends w0{set desiredCamera(e){this._set("desiredCamera",e.clone())}constructor(e){super(e)}get canStop(){return!0}get constraintEnabled(){return this.view.state.constraints.collision.enabled}onControllerStart(){this.state=rn.Running,this.addHandles(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e))),this._applyCorrection()}onControllerEnd(){this.removeAllHandles()}stepController(){}_handleElevationChangeEvent(e){(e.spatialReference==null||kCe(this.view,this.desiredCamera,e.extent,e.spatialReference))&&this._applyCorrection()}_applyCorrection(){this.view.state.updateCamera(e=>{e.copyViewFrom(this.desiredCamera),Z3(this.view,e,ed.EYE_AND_CENTER)||this.constraintEnabled||(this.state=rn.Stopped)})}};d([m({constructOnly:!0})],aR.prototype,"desiredCamera",null),aR=d([V("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],aR);const Olt=.66;function YMe(t){return 360-xee.normalize(t)}function wU(t){return xee.normalize(360-t)}function Rlt(t,e,r){const i=e.camera;if(i!=null)return Ilt(i,yy(t));const{targetGeometry:n}=e;if(n==null)return null;const{camera:s,mode:o}=XMe(t,e.rotation,r);if(n.type==="point")return Dlt(t,e,n,s,o);const a=n.extent;return a==null?null:P5(t,a,s.heading,s.tilt,o)}async function $lt(t,e,r,i){const n=e.camera;if(n!=null)return Llt(n,yy(t),i);const{targetGeometry:s}=e;if(s==null)throw new Error("Viewpoint has no targetGeometry!");const{camera:o,mode:a}=XMe(t,e.rotation,r);if(s.type==="point")return Nlt(t,e,s,o,a,i);const l=s.extent;if(l==null)throw new Error("Target geometry has no extent!");return hEe(t,l,o.heading,o.tilt,a,i)}function Ilt(t,e){const r=t.position;let i;try{i=uv(r,e)}catch{return null}if(!i)return null;const n=t.clone();return n.position=i.clone(),n}async function Llt(t,e,r){const i=t.position,n=await hv(i,e,{signal:r});vt(r);const s=t.clone();return s.position=n.clone(),s}function XMe(t,e,r){const i=KE(t,t.state.camera);let n=aa.ADJUST;return e!=null&&(i.heading=YMe(e),n=aa.LOCKED),r!=null&&(i.tilt=r),{camera:i,mode:n}}function Dlt(t,e,r,i,n){const s=t.spatialReference;let o;try{o=uv(r.clone(),s)}catch{return null}if(!o)return null;const a=e.scale!=null?G9(t,e.scale,o.latitude):t.state.camera.distance;return TQe(t,o,a,i,n)}async function Nlt(t,e,r,i,n,s){const o=t.spatialReference,a=await hv(r.clone(),o,{signal:s});vt(s);const l=e.scale!=null?G9(t,e.scale,a.latitude):t.state.camera.distance;return eEe(t,a,l,i,n,s)}function Flt(t,e,r=null){return r==null&&(r=new sf),Vre(t,null,e.clone(),r)}async function klt(t,e,r){const i=Ylt(t,e);if(!i)throw new K("viewpointutils-create:no-target","Missing target for creating viewpoint");const n=new eu({fov:t.camera.fov}),s=new sf({camera:n});if(i.target instanceof sf)return cb(await Blt(t,i.target,i,r,s));if(i.target instanceof eu)return cb(await JMe(t,i.target,r,s));const o=i.scale!=null||i.zoom!=null;if(i.target instanceof ei){const c=i.target.xmin===i.target.xmax||i.target.ymin===i.target.ymax;return cb(o||c?await a8(t,i,i.target.center,n,r,s):await Hlt(t,i,i.target,n,r,s))}const a={boundingBox:Li(),hasZ:!1,screenSpaceObjects:[]},l=o?zlt(t,i):void 0;if(await ZMe(t,i.target,l,a,r),isFinite(a.boundingBox[0])){let c;if(kp(a.boundingBox,Ln),Au.x=Ln[0],Au.y=Ln[1],Au.z=Ln[2],Au.spatialReference=t.spatialReference,isFinite(Au.z)&&a.hasZ?c=Ite(a.boundingBox):(Au.z=void 0,c=NGe($te(a.boundingBox,Zlt))),o||c)return cb(await a8(t,i,Au,n,r,s));const u=Xlt(t,a.screenSpaceObjects);return cb(await qlt(t,i,Au,a.boundingBox,u,n,r,s))}return i.position?cb(await Glt(t,i,n,s,r)):cb(await jlt(t,i,n,r,s))}function Ure(t,e){return e.scale==null&&e.zoom!=null?gEe(t,e.zoom):e.scale}function zlt(t,e){const r=Ure(t,e);return r?sXe(r):void 0}function Bre(t,e){let r=!1;return e.heading!=null?(t.heading=e.heading,r=!0):e.rotation!=null&&(t.heading=YMe(e.rotation),r=!0),e.tilt!=null&&(t.tilt=e.tilt,r=!0),e.fov!=null&&(t.fov=e.fov),r}function Vre(t,e,r,i){const n=t.spatialReference||lt.WGS84;if((e=e??p0(t,r))==null)return i;const s=new ke({spatialReference:n});return ag(e.center,t.renderSpatialReference,s)&&(i.targetGeometry=s,i.scale=yEe(t,e),i.rotation=wU(r.heading),i.camera=r),i}async function o8(t,e,r,i){var h;const n=()=>new K("viewpointutils:invalid-geometry","The target is missing a valid geometry");if(!e)throw n();e.type==="mesh"&&(e=e.extent);const s=e.spatialReference,o=t.spatialReference,a=t.basemapTerrain.spatialReference;if(!e.hasZ&&t.basemapTerrain){let p;switch(e.type){case"point":p=e;break;case"multipoint":case"polyline":p=(h=e.extent)==null?void 0:h.center;break;case"extent":p=e.center;break;case"polygon":p=e.centroid}p!=null&&a!=null&&t.elevationProvider!=null?(p=await hv(p,a,{signal:i}),Ln[2]=Lm(t.elevationProvider,p)??0):Ln[2]=0}const l=Jlt[e.type],c=new Array;if(l(e,e.hasZ?p=>{c.push([p[0],p[1],p[2]])}:p=>{c.push([p[0],p[1]])},Ln),c.length===0)throw n();const u=await hv(new $3({spatialReference:s,hasZ:e.hasZ,hasM:!1,points:c}),o,{signal:i});if(e.hasZ&&(r.hasZ=!0),e.hasZ)for(const[p,f,g]of u.points)Ln[0]=p,Ln[1]=f,Ln[2]=g,lf(r.boundingBox,Ln);else for(const[p,f]of u.points)Ln[0]=p,Ln[1]=f,lf(r.boundingBox,Ln)}async function Ult(t,e,r,i,n){const s=await sg(t.whenViewForGraphic(e));if(s.ok===!1||s.value==null||!("whenGraphicBounds"in s.value))return void await o8(t,e.geometry,i,n);const o=s.value,a=await sg(o.whenGraphicBounds(e,{minDemResolution:r}));if(a.ok===!1||!a.value)return void await o8(t,e.geometry,i,n);const{screenSpaceObjects:l,boundingBox:c}=a.value;t3(i.boundingBox,c),l&&l.forEach(u=>{i.screenSpaceObjects.push(u)}),isFinite(c[2])&&(i.hasZ=!0)}async function ZMe(t,e,r,i,n){var s;if(Array.isArray(e)&&e.length===2){const o=e[0],a=e[1];if(typeof o=="number"&&typeof a=="number")return Au.x=o,Au.y=a,Au.z=void 0,Au.spatialReference=(s=t.spatialReference)!=null&&s.isGeographic?t.spatialReference:lt.WGS84,void await o8(t,Au,i,n)}e&&"map"in e&&typeof e.map=="function"?await Promise.allSettled(e.map(o=>ZMe(t,o,r,i,n))):e instanceof py?await o8(t,e,i,n):e instanceof fv&&await Ult(t,e,r,i,n)}async function Blt(t,e,r,i,n){if(e.camera!=null)return JMe(t,e.camera,i,n);n.scale=e.scale,n.rotation=e.rotation,n.targetGeometry=e.targetGeometry!=null?e.targetGeometry.clone():null,n.camera=null,r.heading!=null?n.rotation=wU(r.heading):r.rotation!=null&&(n.rotation=r.rotation);const s=Ure(t,r);return s!=null&&(n.scale=s),n.camera=await $lt(t,n,r.tilt,i),n}async function JMe(t,e,r,i){const n=t.spatialReference,s=await hv(e.position,n,{signal:r});return(e=e.clone()).fov=t.camera.fov,e.position=s,Vre(t,null,e,i)}async function Vlt(t,e,r,i,n,s,o){const a=t.renderSpatialReference;return await g6(e,f7,a,0,{signal:o}),await g6(r,uN,a,0,{signal:o}),s.targetGeometry=new ke(e),n.position=new ke(r),ye(l8,f7,uN),j9(t,uN,l8,i.up,n),s.scale=l2(t,Di(uN,f7),s.targetGeometry.latitude),s.rotation=wU(n.heading),s.camera=n,s}async function a8(t,e,r,i,n,s){if(r==null)throw new K("createfromcenter","invalid point");s.targetGeometry=r.clone();const o=D2(t);if(e.position)return Vlt(t,s.targetGeometry,e.position,o,i,s,n);if(e.zoomFactor){const l=o.distance/e.zoomFactor,c=ne(Ln,o.viewForward,-l);o.eye=fe(Ln,o.center,c),s.scale=l2(t,l,r.latitude)}KE(t,o,i);const a=Bre(i,e)?aa.LOCKED:aa.ADJUST;if(!e.zoomFactor){const l=Ure(t,e);if(l==null){const{renderSpatialReference:c}=t;await g6(r,Ln,c,0,{signal:n}),yAe(o.frustum,Ln)?s.scale=l2(t,Di(o.eye,Ln),r.latitude):s.scale=yEe(t,o)}else s.scale=l;s.camera=await KCe(t,s.targetGeometry,s.scale,i,a,n)}return s}async function Glt(t,e,r,i,n){const s=D2(t);ce(l8,s.viewForward),j9(t,s.eye,l8,s.up,m7);const o=t.spatialReference,{position:a}=e;if(a){const l=await hv(a,o,{signal:n});r.position=l}else r.position=new ke;return r.heading=e.heading!=null?e.heading:m7.heading,r.tilt=e.tilt!=null?e.tilt:m7.tilt,Vre(t,null,r,i)}async function jlt(t,e,r,i,n){const s=D2(t),{spatialReference:o,renderSpatialReference:a}=t,l=new ke({spatialReference:o});return ag(s.center,a,l)?a8(t,e,l,r,i,n):a8(t,e,null,r,i,n)}async function Hlt(t,e,r,i,n,s){s.targetGeometry=r.clone();const o=D2(t);KE(t,o,i);const a=Bre(i,e)?aa.LOCKED:aa.ADJUST;return s.camera=await hEe(t,r,i.heading,i.tilt,a,n),s}function Wlt(t,e,r,i,n){let s=0;r.z!=null?s=r.z:t.basemapTerrain&&t.elevationProvider&&(s=Lm(t.elevationProvider,r)),ie(Ln,r.x,r.y,s),La(t.spatialReference,Ln,Yhe,t.renderSpatialReference),th(cN,Yhe),gd(cN,cN),Li(qP);const o=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(let g=0;g<o.length;g++){const _=o[g];let v=i[_[2]];isFinite(v)||(v=s),ie(Ln,i[_[0]],i[_[1]],v),ka(Ln,t.spatialReference,Ln,t.renderSpatialReference),lf(qP,Zs(Ln,Ln,cN))}const a=N2(qP),l=kv(qP),c=F2(qP),u=1/Math.tan(e.fovX/2),h=1/Math.tan(e.fovY/2),p=.5*Math.sqrt(a*a+c*c)*Math.max(h,u)+.5*l,f=.5*l*h+.5*Math.max(a,c);return Math.max(p,f)/n}async function qlt(t,e,r,i,n,s,o,a){a.targetGeometry=r.clone();const l=D2(t),c=Wlt(t,l,r,i,n);KE(t,l,s);const u=Bre(s,e)?aa.LOCKED:aa.ADJUST;return a.scale=l2(t,c,a.targetGeometry.latitude),a.camera=await KCe(t,a.targetGeometry,a.scale,s,u,o),a}function Ylt(t,e){if(!e||!t.spatialReference)return null;const r={target:void 0};return"declaredClass"in e||Array.isArray(e)?r.target=e:(Object.assign(r,e),e.center&&!r.target&&(r.target=e.center)),r}function cb(t){return(t==null?void 0:t.camera)!=null&&(t.rotation=wU(t.camera.heading)),t}function Xlt(t,e){const r=Olt;if(!e.length)return r;let i=Number.NEGATIVE_INFINITY;for(let n=0;n<e.length;n++){const s=e[n].screenSpaceBoundingRect;i=Math.max(i,Math.abs(s[0]),Math.abs(s[1]),Math.abs(s[2]),Math.abs(s[3]))}return r-i/Math.min(t.width,t.height)*2}const Ln=C(),Yhe=xe(),cN=li(),qP=vs(),Zlt=Wt(),l8=C(),uN=C(),f7=C(),m7={heading:0,tilt:0},Au=new ke,Jlt={point(t,e,r){r[0]=t.x,r[1]=t.y,t.z!=null&&(r[2]=t.z),e(r)},polygon(t,e,r){const i=t.hasZ;for(let n=0;n<t.rings.length;n++){const s=t.rings[n];for(let o=0;o<s.length;o++)r[0]=s[o][0],r[1]=s[o][1],i&&(r[2]=s[o][2]),e(r)}},polyline(t,e,r){const i=t.hasZ;for(let n=0;n<t.paths.length;n++){const s=t.paths[n];for(let o=0;o<s.length;o++)r[0]=s[o][0],r[1]=s[o][1],i&&(r[2]=s[o][2]),e(r)}},multipoint(t,e,r){const i=t.points,n=t.hasZ;for(let s=0;s<i.length;s++)r[0]=i[s][0],r[1]=i[s][1],n&&(r[2]=i[s][2]),e(r)},extent(t,e,r){t.zmin!=null&&t.zmax!=null?(e(ie(r,t.xmin,t.ymin,t.zmin)),e(ie(r,t.xmax,t.ymin,t.zmin)),e(ie(r,t.xmin,t.ymax,t.zmin)),e(ie(r,t.xmax,t.ymax,t.zmin)),e(ie(r,t.xmin,t.ymin,t.zmax)),e(ie(r,t.xmax,t.ymin,t.zmax)),e(ie(r,t.xmin,t.ymax,t.zmax)),e(ie(r,t.xmax,t.ymax,t.zmax))):(e(ie(r,t.xmin,t.ymin,r[2])),e(ie(r,t.xmax,t.ymin,r[2])),e(ie(r,t.xmin,t.ymax,r[2])),e(ie(r,t.xmax,t.ymax,r[2])))}};let Qlt=class{constructor(e,r,i){this.target=e,this.options=r,this.view=i,this.state="pending",this._animationController=null,this.promise=new Promise((n,s)=>{this._resolveCallback=n,this._rejectCallback=s;const o=new AbortController;this.options.signal!=null&&ca(this.options.signal,()=>{this.abort()}),this._abortController=o,this.waitForReady()})}resolve(e){if(this.state!=="finished")return this.state="finished",this._resolveCallback(e)}reject(e){if(this.state!=="finished")return this.state="finished",this._rejectCallback(e)}abort(e=!1){this._abortController.abort(),this.state==="wait-for-animation-finish"&&!e&&this._animationController!=null&&this.view.state.cameraController===this._animationController&&this._animationController.active&&this._animationController.stopController(),this.reject(dr())}async waitForReady(){if(this.state="wait-for-ready",!this.view.ready)try{await UE(()=>this.view.ready,this._abortController.signal)}catch(e){return this.reject(e)}this.createViewPoint()}async createViewPoint(){if(this.state!=="finished"){this.state="wait-for-viewpoint",this._animationController=this.options.animate?this._getAnimationController():null;try{const e=await klt(this.view,this.target,this._abortController.signal);if(this.state==="finished")return;const r=e?this._getCameraFromViewpoint(e):null;if(r==null)return;if(this.options.animate){if(this._animationController==null)return;this.startAnimation(r,this._animationController)}else this.view.stateManager.setStateCamera(r.camera,{applyConstraints:!r.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),this.resolve()}catch(e){this.reject(e)}}}_getCameraFromViewpoint(e){var s;const r=!!(this.target instanceof sf&&this.target.camera||this.target instanceof eu),i=e.camera;if(i==null)return null;if(!this.view.stateManager.isCompatible(i)){const o=i.position,a=o&&o.spatialReference,l=a?a.wkid:"none",c=(s=this.view.spatialReference)==null?void 0:s.wkid;return this.reject(new K("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${l}, view: ${c})`,{camera:i})),null}const n=p0(this.view,i);return n==null?(this.reject(new K("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:e,camera:n,isFullySpecified:r}}startAnimation(e,r){this.state="wait-for-animation-finish";const i=r.viewAnimation;if(i==null)return void this.reject(new K("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));if(i.update(e.viewpoint,"running"),!r.active||r.viewAnimation==null||r.viewAnimation.target!==e.viewpoint||this.view.state.cameraController!==r)return this.abort();let n;e.isFullySpecified?(n=new aR({view:this.view,desiredCamera:e.camera}),Z3(this.view,e.camera,ed.EYE_AND_CENTER)):qn(this.view,e.camera),r.begin(e.camera,this.options);const s=()=>{const a=this.view.state.cameraController;n&&(a&&a.active?a instanceof M0&&a.viewAnimation!=null&&a.viewAnimation.target===e.viewpoint&&(this.view.state.cameraController=n):r.viewAnimation!=null&&r.viewAnimation.target===e.viewpoint&&r.state===rn.Finished&&(this.view.state.cameraController=n))},o=a=>{if(this.view.state!=null)switch(r.state){case rn.Finished:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.resolve()}break;case rn.Ready:case rn.Rejected:case rn.Running:case rn.Stopped:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.reject(a)}}};i.when(s,a=>o(a)),r.asyncResult={resolve:()=>o(),reject:a=>o(a)}}_getAnimationController(){let e=null,r=null;const i=this.view.state.cameraController;return i instanceof M0&&(i.updateStateFromViewAnimation(),i.active&&(e=i,r=e.viewAnimation)),e!=null||(e=new M0({view:this.view,mode:"animation"}),r=e.viewAnimation,this.view.state.switchCameraController(e))?e:(r!=null&&r.stop(),this.reject(new K("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null)}},xv=class{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return this._outer.size===0}get(e,r){var i;return(i=this._outer.get(e))==null?void 0:i.get(r)}set(e,r,i){const n=this._outer.get(e);n?n.set(r,i):this._outer.set(e,new Map([[r,i]]))}delete(e,r){const i=this._outer.get(e);i&&(i.delete(r),i.size===0&&this._outer.delete(e))}forEach(e){this._outer.forEach((r,i)=>e(r,i))}};var Rs;function g7(t=!se("disable-feature:high-quality-idle"),e=null){const r=new xv;return t?(r.set(Ur.IDLE,Rs.Antialiasing,e!=="low"),r.set(Ur.IDLE,Rs.HighResolutionAtmosphere,e!=="low"),r.set(Ur.IDLE,Rs.HighQualityTransparency,!0),r.set(Ur.IDLE,Rs.SSAO,!0),r.set(Ur.IDLE,Rs.WaterReflection,!0),r.set(Ur.IDLE,Rs.PhysicalPixelRendering,!0)):(r.set(Ur.ANIMATING,Rs.HighResolutionShadows,!0),r.set(Ur.INTERACTING,Rs.HighResolutionShadows,!0)),r.set(Ur.IDLE,Rs.HighResolutionShadows,!0),r.set(Ur.IDLE,Rs.HighResolutionVoxel,!0),r}(function(t){t[t.Antialiasing=0]="Antialiasing",t[t.HighQualityTransparency=1]="HighQualityTransparency",t[t.HighResolutionVoxel=2]="HighResolutionVoxel",t[t.HighResolutionAtmosphere=3]="HighResolutionAtmosphere",t[t.SSAO=4]="SSAO",t[t.WaterReflection=5]="WaterReflection",t[t.HighResolutionShadows=6]="HighResolutionShadows",t[t.PhysicalPixelRendering=7]="PhysicalPixelRendering"})(Rs||(Rs={}));let es=class extends Ae{constructor(e){super(e),this.ready=!1,this._windowDevicePixelRatio=1,this._devicePixelRatioOverride=null,this._idleTimeout=Xhe,this.test={viewStateManager:this,contentCameraResetState:new Map,setDevicePixelRatio:r=>this._devicePixelRatioOverride=r,renderState:null,get maximumPixelRatio(){return this.viewStateManager.view.qualitySettings.maximumPixelRatio},get updatingIgnoreRenderState(){return this.renderState!=null},get idleTimeoutEnabled(){return this.viewStateManager._idleTimeout>0},set idleTimeoutEnabled(r){this.viewStateManager._idleTimeout=r?Xhe:0}},this._propertiesPool=new ny({frustum:u1},this),this._cameraSetByUser=!1,this._gotoOperation=null,this._cameraChangeTime=0,this._tmpCanvasSize=new Klt}initialize(){this._cameraChangeTime=performance.now(),this.addHandles([Vo(()=>this.view.state.events,"before-camera-change",e=>e&&this._updateElevation(e)),he(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},(e,r)=>this._cameraChangedHandler(e,r),Qr)]),fd(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},e=>this._updateElevation(e),{once:!0,sync:!0}),this.addHandles([qx({prepare:()=>this._prepareFrame()}),he(()=>this.view.state.cameraController,()=>{this._cameraSetByUser=!0,this.removeHandles(dN)}),Vo(()=>this.view.state.events,"camera-projection-changed",()=>this.notifyChange("scale"))])}destroy(){this.exit(),this._propertiesPool=Pe(this._propertiesPool)}get camera(){const e=this._get("camera");if(!this.ready)return e;const r=KE(this.view,this.view.state.camera,y7);return r&&e&&r.equals(e)?e:r.clone()}set camera(e){var r,i;this._updatePropertyBeforeReady("camera",e)||((r=this.view.elevationProvider)==null||r.enableCache(!0),this.setStateCamera(p0(this.view,e),{applyConstraints:!1})||re.getLogger(this).error("#camera=","Invalid camera",e),(i=this.view.elevationProvider)==null||i.enableCache(!1))}get contentCamera(){const e=this._get("contentCamera");if(!this.ready)return e;const r=KE(this.view,this.view.state.contentCamera,y7);return r&&e&&r.equals(e)?e:r.clone()}set contentCamera(e){if(this._updatePropertyBeforeReady("contentCamera",e))return;const r=p0(this.view,e);r!=null?(this._updateElevation(r),this.view.state.contentCamera=r):this.view.state.contentCamera=null}installContentCameraReset(e){if(this.removeHandles(_7),this.test.contentCameraResetState.clear(),!this.view.state.fixedContentCamera)return!1;const r=this.zoom,i=this.view.state.camera.distance**2,n=Ea(this.view.state.camera.center),s=e.sticky?this.contentCamera.clone():null;return this.addHandles([he(()=>this.contentCamera,()=>{e.sticky||(this.removeHandles(_7),this.test.contentCameraResetState.clear())}),he(()=>this.zoom,o=>{o!==void 0&&r!==void 0&&(this.test.contentCameraResetState.set("view.zoom",Math.abs(o-r)/2),Math.abs(o-r)>2?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=s))}),he(()=>this.view.state.camera,o=>{const a=Uo(n,o.center);this.test.contentCameraResetState.set("camera.center",a/i),a>i?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=s)})],_7),!0}get center(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")}set center(e){var r;this._updatePropertyBeforeReady("center",e)||(e?this.isCompatible(e)?this.setStateCamera(this._centerToCamera(e),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():re.getLogger(this).error("#center=","Invalid center",e):re.getLogger(this).error("#center=","Center has an incompatible spatial reference (center: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+((r=this.view.spatialReference)==null?void 0:r.wkid)+")",e):re.getLogger(this).error("#center=","Center may not be null or undefined"))}get extent(){if(!this.ready)return this._get("extent");const e=this.view,r=dEe(e,e.state.camera,e.pointsOfInterest.centerOnContent.renderLocation);return r??this._get("extent")}set extent(e){var r;this._updatePropertyBeforeReady("extent",e)||(e?this.isCompatible(e)?this.setStateCamera(this._extentToCamera(e),{applyConstraints:!0})||re.getLogger(this).error("#extent=","Invalid extent",e):re.getLogger(this).error("#extent=","Extent has an incompatible spatial reference (extent: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+((r=this.view.spatialReference)==null?void 0:r.wkid)+")",e):re.getLogger(this).error("#extent=","Extent may not be null or undefined"))}get frustum(){const e=this._propertiesPool.get("frustum");return e.renderCoordsHelper=this.view.renderCoordsHelper,e.update(this.view.state.camera),e}get constraintsManager(){return this._constraintsManager}get _initialViewpoint(){var r;const e=this.view.map;return e&&"initialViewProperties"in e?(r=e.initialViewProperties)==null?void 0:r.viewpoint:void 0}get hasInitialView(){return!!this._initialViewpoint}get scale(){if(this.ready){const e=this.view.pointsOfInterest.centerOnContent;return l2(this.view,e.distance,e.location.latitude)}return this._get("scale")}set scale(e){this._updatePropertyBeforeReady("scale",e)||this.setStateCamera(this._scaleToCamera(e),{applyConstraints:!0})||re.getLogger(this).error("#scale=","Invalid scale",e)}get padding(){if(!this.ready)return this._get("padding");const e=this.view.state.camera,r=e.padding,i=e.pixelRatio,n=this._get("padding"),s=Math.round(r[Kt.TOP]/i),o=Math.round(r[Kt.RIGHT]/i),a=Math.round(r[Kt.BOTTOM]/i),l=Math.round(r[Kt.LEFT]/i);return n!=null&&n.top===s&&n.right===o&&n.bottom===a&&n.left===l?n:{top:s,right:o,bottom:a,left:l}}set padding(e){this._updatePropertyBeforeReady("padding",e)||(this._paddingToArray(e,this.view.state.camera.pixelRatio,hN),this.view.state.updateCamera(r=>r.padding=hN))}_paddingToArray(e,r,i){e?nn(i,e.top||0,e.right||0,e.bottom||0,e.left||0):nn(i,0,0,0,0);for(let n=0;n<4;n++)i[n]=Math.round(i[n]*r)}get screenCenter(){const e=this.padding;return dd((this.view.width-(e.left+e.right))/2+e.left,(this.view.height-(e.top+e.bottom))/2+e.top)}get viewpoint(){return this.ready?Flt(this.view,this.camera):this._get("viewpoint")}set viewpoint(e){var r;if(!this._updatePropertyBeforeReady("viewpoint",e))if(e)if(this.isCompatible(e))this.setStateCamera(this._viewpointToCamera(e),{applyConstraints:!e.camera})||re.getLogger(this).error("#viewpoint=","Invalid viewpoint",e);else{const i=e.camera!=null?e.camera.position:e.targetGeometry,n=i!=null&&i.spatialReference;re.getLogger(this).error("#viewpoint=","Viewpoint has an incompatible spatial reference (viewpoint: "+(n?n.wkid:"none")+", view: "+((r=this.view.spatialReference)==null?void 0:r.wkid)+")",e)}else re.getLogger(this).error("#viewpoint=","Viewpoint may not be null or undefined")}get zoom(){return this.ready?RQe(this.view,this.scale):this._get("zoom")}set zoom(e){this._updatePropertyBeforeReady("zoom",e)||e===void 0||this.setStateCamera(this._zoomToCamera(e),{applyConstraints:!0})||re.getLogger(this).error("#zoom=","Invalid zoom",e)}_computeCanvasSize(){var n;if(this._devicePixelRatioOverride)return this.view.state.contentPixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*this._devicePixelRatioOverride),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*this._devicePixelRatioOverride),this._tmpCanvasSize.pixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize;const e=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio),r=(this._usePhysicalPixelRendering?this._windowDevicePixelRatio:e)*this.view.resolutionScale;this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*r),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*r);const i=(n=this.view._stage.renderView.renderingContext)==null?void 0:n.parameters.maxTextureSize;return i&&px(this._tmpCanvasSize,i),this._tmpCanvasSize.pixelRatio=this._tmpCanvasSize.width>0?this._tmpCanvasSize.width/this.view.surface.clientWidth*.5+this._tmpCanvasSize.height/this.view.surface.clientHeight*.5:r,this.view.state&&(this.view.state.contentPixelRatio=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)),this._tmpCanvasSize}get _rasterPixelRatio(){return this._devicePixelRatioOverride!=null?this._devicePixelRatioOverride:this._usePhysicalPixelRenderingAny?this._windowDevicePixelRatio:Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)}get _usePhysicalPixelRendering(){var e,r;return((r=(e=this.view)==null?void 0:e._stage)==null?void 0:r.renderer.isFeatureEnabled(Rs.PhysicalPixelRendering))??!1}get _usePhysicalPixelRenderingAny(){var r,i;const e=(i=(r=this.view)==null?void 0:r._stage)==null?void 0:i.renderer;return e&&(e.isFeatureEnabled(Rs.PhysicalPixelRendering,Ur.IDLE)||e.isFeatureEnabled(Rs.PhysicalPixelRendering,Ur.INTERACTING)||e.isFeatureEnabled(Rs.PhysicalPixelRendering,Ur.ANIMATING))}preinit(e){var r,i,n;return!(this._isOverridden("center")&&!aS(this.center.spatialReference,e))&&!(this._isOverridden("camera")&&!aS(this.camera.position.spatialReference,e))&&!(this._isOverridden("extent")&&!aS(this.extent.spatialReference,e))&&!!(!this._isOverridden("viewpoint")||aS((r=this.viewpoint.targetGeometry)==null?void 0:r.spatialReference,e)&&aS((n=(i=this.viewpoint.camera)==null?void 0:i.position)==null?void 0:n.spatialReference,e))}init(){this._constraintsManager=new $M({view:this.view}),this._prepareFrame();const e=this._getInitialProperties();this._cameraSetByUser=!1,this._set("ready",!0);for(const r of e)this.set(r.name,r.value);if(!this._cameraSetByUser){const r=this._initialViewpoint||this.view.initialExtent;r&&this.isCompatible(r)?this._setInitialView(r):this.view.state.viewingMode===De.Local&&this.addHandles(fd(()=>this.view.basemapTerrain.ready,()=>{this.removeHandles(dN),this._setInitialView(this.view.dataExtent)},{once:!0,initial:!0}),dN)}}exit(){this._cancelGoToOperation(),this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this._cameraSetByUser=!1,this.removeHandles(dN),this._constraintsManager=Pe(this._constraintsManager))}async goTo(e,r){const i={animate:!0,...r};return this._gotoOperation!=null&&this._gotoOperation.abort(i.animate),this._gotoOperation=new Qlt(e,i,this.view),this.view.resourceController.scheduler.stopFrame(),this._gotoOperation.promise}debugSetCameraOnContent(){this.setStateCamera(D2(this.view),{applyConstraints:!1})}step(e){const r=this.view.state,i=r==null?void 0:r.cameraController;i&&(r.updateCamera(n=>i.stepController(e,n)),i.steppingFinished&&i.finishController())}_cancelGoToOperation(){this._gotoOperation!=null&&(this._gotoOperation.abort(),this._gotoOperation=null)}_getInitialProperties(){const e=new Set,r=[];for(const{propertyName:i,overrides:n}of tct){const s=e.has(i),o=this._isOverridden(i);!s&&o&&r.push({name:i,value:this._get(i)}),this._clearOverride(i),(s||o)&&n.forEach(a=>e.add(a))}return r}_setInitialView(e){if(e==null||this._cameraSetByUser)return;if(e instanceof eu)return void this.setStateCamera(p0(this.view,e),{applyConstraints:!1});if(e instanceof sf){if(e.targetGeometry instanceof ei){const s=P5(this.view,e.targetGeometry,0,.5,aa.LOCKED);return void(s!=null&&this.setStateCamera(p0(this.view,s),{applyConstraints:!0}))}const i={applyConstraints:!e.camera},n=this._viewpointToCamera(e);return void this.setStateCamera(n,i)}const r=P5(this.view,e,0,.5,aa.LOCKED);r!=null&&this.setStateCamera(p0(this.view,r),{applyConstraints:!0})}_updatePropertyBeforeReady(e,r){return!this.ready&&(this._override(e,r),r&&ect.has(e)&&this._override("hasInitialView",!0),!0)}isCompatible(e){return e!=null&&(e instanceof sf?e.camera?this.isCompatible(e.camera):this.isCompatible(e.targetGeometry):e instanceof eu?this.isCompatible(e.position):e.spatialReference&&!YTe(e.spatialReference,this.view.spatialReference))}_getPreservingHeadingTilt(e=rct){return this._cameraSetByUser?(e.heading=this.camera.heading,e.tilt=this.camera.tilt):(e.heading=0,e.tilt=.5),e}_centerPointAtDistanceToCamera(e,r,i=Qy){const{heading:n,tilt:s}=this._getPreservingHeadingTilt(),o=_te(this.view,n,s,e,r,aa.ADJUST);return o==null?null:(i.copyFrom(this.view.state.camera),i.eye=o.eye,i.center=o.center,i.up=o.up,i)}_centerToCamera(e){const r=this.view.pointsOfInterest.centerOnContent;r.runTask();const i=r.distance;return this._centerPointAtDistanceToCamera(e,i)}_extentToCamera(e){const{heading:r,tilt:i}=this._getPreservingHeadingTilt(),n=P5(this.view,e,r,i,aa.ADJUST,y7);return n?p0(this.view,n):null}_scaleToCamera(e){if(e==null)return null;const r=this.view.pointsOfInterest.centerOnContent;r.runTask();const i=r.renderLocation,n=r.location.latitude,s=G9(this.view,e,n);return this._centerPointAtDistanceToCamera(i,s)}_zoomToCamera(e){return this._scaleToCamera(gEe(this.view,e))}_viewpointToCamera(e){return p0(this.view,Rlt(this.view,e))}setStateCamera(e,r){return!(e==null||!this.view.state.stopActiveCameraController())&&(this._cameraSetByUser=!0,r.doNotCancelGoToOperation||this._cancelGoToOperation(),this.view.state.updateCamera(i=>{r.positionAndOrientationOnly?(i.eye=e.eye,i.center=e.center,i.up=e.up):i.copyFrom(e),r.applyConstraints&&qn(this.view,i)}),r.applyConstraints||(this.view.state.cameraController=new aR({view:this.view,desiredCamera:e})),!0)}_prepareFrame(){const{surface:e,canvas:r}=this.view;if(!e||!r)return;this._windowDevicePixelRatio=window.devicePixelRatio;const i=this._computeCanvasSize();if(i.width!==0&&i.height!==0&&(r.width===i.width&&r.height===i.height||(r.width=i.width,r.height=i.height),this.view.state)){const n=this.view.state.camera;n.fullWidth===i.width&&n.fullHeight===i.height&&n.pixelRatio===i.pixelRatio||(Qy.copyFrom(n),Qy.pixelRatio!==i.pixelRatio&&(this._paddingToArray(this.padding,i.pixelRatio,hN),Qy.padding=hN),Qy.fullWidth=i.width,Qy.fullHeight=i.height,Qy.pixelRatio=i.pixelRatio,this.view.state.camera=Qy),this._updateViewState()}}_updateElevation(e){var s,o;const r=(s=this.view.basemapTerrain)==null?void 0:s.spatialReference,i=((o=this.view.renderCoordsHelper)==null?void 0:o.getAltitude(e.eye))??0,n=r?V9(this.view,e.eye):0;e.relativeElevation=i-n}_updateViewState(){this.test.renderState!=null?this.view.state.mode=this.test.renderState:this.view.animation?this.view.state.mode=Ur.ANIMATING:this.view.interacting?this.view.state.mode=Ur.INTERACTING:(this.view.state.mode===Ur.ANIMATING&&(this._cameraChangeTime=0),performance.now()-this._cameraChangeTime<this._idleTimeout?this.view.state.mode=Ur.INTERACTING:this.view.state.mode=Ur.IDLE),this.view.state.rasterPixelRatio=this._rasterPixelRatio}_cameraChangedHandler(e,r){e&&r&&e.almostEquals(r)||(this._cameraChangeTime=performance.now(),this._updateViewState())}};d([m({type:eu,dependsOn:["view.state.camera","ready"]})],es.prototype,"camera",null),d([m({type:eu,dependsOn:["view.state.contentCamera","ready"]})],es.prototype,"contentCamera",null),d([m({type:ke})],es.prototype,"center",null),d([m({type:ei})],es.prototype,"extent",null),d([m({readOnly:!0})],es.prototype,"frustum",null),d([m()],es.prototype,"_constraintsManager",void 0),d([m({readOnly:!0})],es.prototype,"constraintsManager",null),d([m()],es.prototype,"_initialViewpoint",null),d([m({readOnly:!0})],es.prototype,"hasInitialView",null),d([m({readOnly:!0,type:Boolean})],es.prototype,"ready",void 0),d([m({type:Number})],es.prototype,"scale",null),d([m()],es.prototype,"padding",null),d([m({readOnly:!0})],es.prototype,"screenCenter",null),d([m({constructOnly:!0})],es.prototype,"view",void 0),d([m({type:sf})],es.prototype,"viewpoint",null),d([m({type:Number})],es.prototype,"zoom",null),d([m({readOnly:!0})],es.prototype,"_rasterPixelRatio",null),d([m({readOnly:!0})],es.prototype,"_usePhysicalPixelRendering",null),d([m({readOnly:!0})],es.prototype,"_usePhysicalPixelRenderingAny",null),d([m()],es.prototype,"_windowDevicePixelRatio",void 0),d([m()],es.prototype,"_devicePixelRatioOverride",void 0),es=d([V("esri.views.3d.state.ViewStateManager")],es);let Klt=class{constructor(){this.width=0,this.height=0,this.pixelRatio=1}};const ect=new Set(["camera","viewpoint","extent","scale","center","zoom"]),tct=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],rct={heading:0,tilt:0},y7=new eu,Qy=new Qe,hN=Zt(),dN="pending-initial-view",_7="content-camera-reset",Xhe=300,Zhe=100;let Nm=class extends w0{constructor(){super(...arguments),this.startCamera=new Qe,this.currentCamera=new Qe,this._lastInteraction=0}get isInteractive(){return performance.now()-this._lastInteraction<Zhe}stepController(e,r){r.copyViewFrom(this.currentCamera),this.currentCamera.copyFrom(r)}onControllerStart(e){this.state=rn.Running,this.startCamera.copyFrom(e),this.currentCamera.copyFrom(e)}onControllerEnd(e){e.copyViewFrom(this.currentCamera)}commitCamera(){this._lastInteraction=performance.now(),setTimeout(()=>this.notifyChange("isInteractive"),Zhe),this.view.state.updateCamera(e=>this.stepController(0,e)),this.steppingFinished&&this.finishController()}};d([m({readOnly:!0})],Nm.prototype,"isInteractive",null),d([m()],Nm.prototype,"_lastInteraction",void 0),Nm=d([V("esri.views.3d.state.controllers.InteractiveController")],Nm);var Mc;(function(t){t[t.CENTER=0]="CENTER",t[t.EYE=1]="EYE"})(Mc||(Mc={}));let lR=class extends Nm{get _intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.pivot=Mc.CENTER,this._rotScale=0,this._lastPoint=He(),this._tmpWorldUp=C(),this._tmpViewDir=C(),this._tmpRotCurPoint=He(),this._tmpTransf=xe(),this._tmpAxis=C(),this._tmpPivotPoint=C(),this._pivotPos=C(),this._constraintOptions=new Sd(Vi.ALL,rr.TUMBLE,0,this.startCamera)}initialize(){this._rotScale=this.pivot===Mc.CENTER?3:1.5}begin(e){if(this.active){switch(this.pivot){case Mc.EYE:ce(this._pivotPos,this.startCamera.eye),this._constraintOptions.interactionType=rr.LOOK_AROUND,this._constraintOptions.tiltMode=dg.LOOK_AROUND,this._constraintOptions.selection=Vi.NONE;break;case Mc.CENTER:{const r=this._intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this._pivotPos,this.view.map.ground.opacity===0?j2:{});r||ce(this._pivotPos,this.startCamera.center),this._constrainPivotPoint(e,r),this.startCamera.center=this._pivotPos,this._constraintOptions.interactionType=rr.TUMBLE,this._constraintOptions.tiltMode=dg.TUMBLE,this._constraintOptions.selection=Vi.ALL&~Vi.DISTANCE;break}}Ix(this.startCamera,e,this._lastPoint)}}_constrainPivotPoint(e,r){const i=this.startCamera,n=C();ye(n,this._pivotPos,i.eye);const s=Te(n),o=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(i.eye,Jhe);let a=Math.max(Math.min(alt,1/Math.abs(de(Jhe,i.viewForward)))*o,llt);r&&(a=Math.min(s,a));const l=Br(this.view.spatialReference),c=pn(i.width/i.pixelRatio*.5,i.height/i.pixelRatio*.5),u=bU(this.startCamera,c,l);let h=this.view._stage.renderView.getMinimalDepthForArea(G$(this.view),i.fullWidth/i.pixelRatio*.5,i.fullHeight/i.pixelRatio*.5,i,2.5*c7,c7),p=this.view._stage.renderView.getMinimalDepthForArea(G$(this.view),e[0],e[1],i,c7);h==null&&p==null||(h=h??p??0,p=p==null||u===wo.Horizontal?h:p,a=h>p?p:h,a=r?Math.min(a,s):a),pe(n,n),ce(this._pivotPos,fe(this._tmpPivotPoint,i.eye,ne(this._tmpPivotPoint,n,a)))}update(e){if(this.active){switch(this.pivot){case Mc.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,e,this.currentCamera.center,this._pivotPos);break;case Mc.CENTER:this.currentCamera.center=this._pivotPos,this.currentCamera.eye=this._applyRotation(this.currentCamera,e,this.currentCamera.eye,this._pivotPos)}qn(this.view,this.currentCamera,this._constraintOptions),this.commitCamera()}}end(){this.active&&this.finishController()}_applyRotation(e,r,i,n){this.view.renderCoordsHelper.worldUpAtPosition(n,this._tmpWorldUp),Ix(e,r,this._tmpRotCurPoint);let s=(this._lastPoint[1]-this._tmpRotCurPoint[1])*this._rotScale,o=(this._tmpRotCurPoint[0]-this._lastPoint[0])*this._rotScale;ye(this._tmpViewDir,i,n);const a=Te(this._tmpViewDir),l=Ks(de(this._tmpViewDir,this._tmpWorldUp)/a);if(this.pivot===Mc.EYE){s*=-.5;const c=.5*Math.PI-l,u=.5*Math.PI*.99;s=c-Math.max(-u,Math.min(u,c+s))}return s=we(s+l,ea.min,ea.max)-l,Je(this._tmpAxis,e.up,this._tmpViewDir),this.pivot===Mc.CENTER&&(o=-o),Kc(this._tmpTransf,o,this._tmpWorldUp),Gc(this._tmpTransf,this._tmpTransf,s,this._tmpAxis),Ge(this._tmpViewDir,this._tmpViewDir,this._tmpTransf),e.up=Ge(v7,e.up,this._tmpTransf),fe(v7,n,this._tmpViewDir),eo(this._lastPoint,this._tmpRotCurPoint),v7}};d([m()],lR.prototype,"pivot",void 0),lR=d([V("esri.views.3d.state.controllers.RotateController")],lR);const v7=C(),Jhe=C();let b7=class extends qo{constructor(e,r,i,n){super(!0),this._view=e,this.pointerAction=r,this._pivot=i,this.registerIncoming("drag",n,s=>this._handleDrag(s))}_handleDrag(e){const r=e.data;if(r.pointers.size>1||!zre(e.data,this.pointerAction))return;const i=pn(r.center.x,r.center.y);switch(r.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._cameraController=new lR({view:this._view,pivot:this._pivot}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(i);break;case"update":this._cameraController&&this._cameraController.update(i);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}e.stopPropagation()}},bZ=class extends Nm{constructor(){super(...arguments),this._pickPoint=C(),this._tmpP0=He(),this._panAxisAngle=_U(),this._tmpRayDir=C(),this._tmpRayDirPick=C(),this._targetOnSphere=C(),this._navMode=wo.Horizontal,this._tmpRay={origin:C(),direction:C()},this.dragBeginPoint=pn(),this._normalizedAnchorPoint=He(),this._constraintOptions=new Sd(Vi.ALL_EXCEPT_COLLISION,rr.ZOOM,0,this.startCamera),this._sphere=Jn(),this._hasPickPoint=!1}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;eo(this.dragBeginPoint,e),Ix(this.startCamera,e,this._normalizedAnchorPoint);const r=Br(this.view.spatialReference),i=zMe(this._intersectionHelper,this.startCamera,e,r,l3.Ellipsoid,this.view.map.ground.opacity===0?j2:{});if(this._navMode=bU(this.startCamera,e,r),this._navMode===wo.Horizontal)this._hasPickPoint=!!i.scenePickPoint,this._pickPoint=i.scenePickPoint??this._pickPoint,this._sphere=i.sphere;else{let n;J3(this.startCamera,e,this._tmpRay),pe(this._tmpRay.direction,this._tmpRay.direction),i.scenePickPoint!=null&&(ye(this._tmpRayDirPick,this.startCamera.eye,i.scenePickPoint),n=Te(this._tmpRayDirPick));const s=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(this.startCamera.eye,Qhe);let o=we(Math.min(RMe,1/Math.abs(de(Qhe,this._tmpRay.direction)))*s,e8[0],e8[1]);const a=this.view._stage.renderView.getMinimalDepthForArea(null,e[0],e[1],this.view.state.camera,vU);o=a??o,o=n!=null?Math.min(o,n):o,this._hasPickPoint=!0,ne(this._tmpRay.direction,this._tmpRay.direction,o),fe(this._pickPoint,this._tmpRay.origin,this._tmpRay.direction)}}update(e){if(this.active){if(this.currentCamera.eye=this.startCamera.eye,this.currentCamera.center=this.startCamera.center,this.currentCamera.up=this.startCamera.up,this._navMode===wo.Horizontal){ye(this._tmpRayDir,this.currentCamera.center,this.currentCamera.eye);const r=Te(this._tmpRayDir);Ix(this.currentCamera,e,this._tmpP0);const i=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let n=r*2**i;const s=this.view.state.constraints.minimumPoiDistance;if(i<0&&n<s&&(n=s),Math.abs(r-n)<1e-6)return;if(this._hasPickPoint&&n<r){const o=1-(1-n/r)*(1-this._sphere[3]/Te(this.currentCamera.center));this.currentCamera.center=ne(pN,this.currentCamera.center,o)}ne(this._tmpRayDir,this._tmpRayDir,-n/r),this.currentCamera.eye=fe(pN,this.currentCamera.center,this._tmpRayDir),this._constraintOptions.interactionFactor=Ap(mv(this.dragBeginPoint,e)),qn(this.view,this.currentCamera,this._constraintOptions),this._hasPickPoint&&(V$(this._sphere,this.currentCamera,this.dragBeginPoint,this._targetOnSphere),$re(this._pickPoint,this._targetOnSphere,this._panAxisAngle),wv(this.currentCamera,this._sphere,this._panAxisAngle))}else{const r=Te(this._tmpRay.direction);Ix(this.currentCamera,e,this._tmpP0);const i=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let n=r*2**i;const s=this.view.state.constraints.minimumPoiDistance;if(i<0&&n<s&&(n=s),Math.abs(r-n)<1e-6)return;ne(this._tmpRayDir,this._tmpRay.direction,1-n/r),this.currentCamera.eye=fe(pN,this.currentCamera.eye,this._tmpRayDir),this.currentCamera.center=fe(pN,this.currentCamera.center,this._tmpRayDir)}Z3(this.view,this.currentCamera),this.commitCamera()}}end(){this.active&&this.finishController()}};bZ=d([V("esri.views.3d.state.controllers.global.ZoomController")],bZ);const pN=C(),Qhe=C();let wZ=class extends Nm{constructor(){super(...arguments),this._tmpP=C(),this._tmpDir=C(),this._tmpN=C(),this._tmpP0=He(),this._tmpPoi=C(),this._tmpRayDir=C(),this.dragBeginPoint=pn(),this._normalizedAnchorPoint=He(),this._constraintOptions=new Sd(Vi.ALL,rr.ZOOM,0,this.startCamera,C()),this._plane=zr()}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;eo(this.dragBeginPoint,e),Ix(this.startCamera,e,this._normalizedAnchorPoint);const r=this._intersectionHelper.intersectScreenFreePointFallback(e,this._tmpP,this.view.map.ground.opacity===0?j2:{});ye(this._tmpDir,this._tmpP,this.startCamera.eye);const i=Te(this._tmpDir);pe(this._tmpDir,this._tmpDir);const n=Math.abs(this.view.camera.position.z);let s=we(Math.min(RMe,1/Math.abs(de(ict,this._tmpDir)))*n,e8[0],e8[1]);const o=this.view._stage.renderView.getMinimalDepthForArea(G$(this.view),e[0],e[1],this.view.state.camera,vU);s=o??s,s=r?Math.min(s,i):s,ne(this._tmpDir,this._tmpDir,s),fe(this._tmpP,this.startCamera.eye,this._tmpDir),ye(this._tmpN,this.startCamera.eye,this.startCamera.center),pe(this._tmpN,this._tmpN),this._tmpN[1]<0&&Bo(this._tmpN,this._tmpN),FI(this._tmpP,this._tmpN,this._plane)}update(e){if(!this.active)return;clt(this._plane,this.currentCamera,this.dragBeginPoint,this._tmpPoi)||ce(this._tmpPoi,this.currentCamera.center),Ix(this.currentCamera,e,this._tmpP0);let r=4*(this._tmpP0[1]-this._normalizedAnchorPoint[1]);eo(this._normalizedAnchorPoint,this._tmpP0),ye(this._tmpRayDir,this._tmpPoi,this.currentCamera.eye);const i=Te(this._tmpRayDir);let n=i*(1-r);this._constraintOptions.interactionDirection&&(ce(this._constraintOptions.interactionDirection,this._tmpRayDir),ne(this._constraintOptions.interactionDirection,this._constraintOptions.interactionDirection,Math.sign(r)/i));const s=this.view.state.constraints.minimumPoiDistance;r>=0&&n<s&&(n=s,r=-(n-i)/i),Math.abs(i-n)<1e-6||(ne(this._tmpRayDir,this._tmpRayDir,r),this.currentCamera.eye=fe(ub,this.currentCamera.eye,this._tmpRayDir),ni(ub,this.currentCamera.center,this._tmpPoi,r),this._tmpPoi[2]>this.startCamera.center[2]?ub[2]=Math.max(this.startCamera.center[2],ub[2]):ub[2]=Math.min(this.startCamera.center[2],ub[2]),this.currentCamera.center=ub,this._constraintOptions.interactionFactor=Ap(mv(this.dragBeginPoint,e)),qn(this.view,this.currentCamera,this._constraintOptions),this.commitCamera())}end(){this.active&&this.finishController()}};wZ=d([V("esri.views.3d.state.controllers.local.ZoomController")],wZ);const ub=C(),ict=Ce(0,0,1);let nct=class extends qo{constructor(e,r,i){super(!0),this._view=e,this.pointerAction=r,this.registerIncoming("drag",i,n=>this._handleDrag(n))}_handleDrag(e){const r=e.data;if(r.pointers.size>1||!zre(e.data,this.pointerAction))return;const i=pn(r.center.x,r.center.y);switch(r.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._view.state.isGlobal?this._cameraController=new bZ({view:this._view}):this._cameraController=new wZ({view:this._view}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(i);break;case"update":this._cameraController&&this._cameraController.update(i);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}e.stopPropagation()}};function Dd(t){let e=t*t;return t<0&&(e*=-1),e}function Khe(t,e,r){const i=r,n=t.state,s=t.device,o=e.tiltDirection==="forward-down"?1:-1,a=1;return s.deviceType==="standard"?(i.translation[0]=Dd(n.axes[0]),i.translation[1]=Dd(n.axes[1]),i.translation[2]=Dd(n.buttons[7])-Dd(n.buttons[6]),i.heading=Dd(n.axes[2]),i.tilt=Dd(n.axes[3])):s.deviceType==="spacemouse"&&(i.translation[0]=1.2*Dd(n.axes[0]),i.translation[1]=1.2*Dd(n.axes[1]),i.translation[2]=2*-Dd(n.axes[2]),i.heading=1.2*Dd(n.axes[5]),i.tilt=1.2*Dd(n.axes[3])),i.tilt*=o,ne(i.translation,i.translation,a),i}function ede(t,e){const r=e;return r.translation[0]=t[1]-t[0],r.translation[1]=t[3]-t[2],r.translation[2]=t[4]-t[5],r.heading=t[7]-t[6],r.tilt=t[8]-t[9],r.zoom=t[10]-t[11],r}function w7(t){return t.translation[0]===0&&t.translation[1]===0&&t.translation[2]===0&&t.heading===0&&t.tilt===0&&t.zoom===0}let fx=class extends Nm{constructor(e){super(e),this._filteredSurfaceElevation=0,this._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this._keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0],this._tmpCamera=new Qe,this._headingStart=0,this._constraintOptions=new Sd(Vi.ALL,rr.NONE,0,new Qe,null,dg.LOOK_AROUND)}handleEventGamepad(e){const r=Khe(e,this.view.navigation.gamepad,this._transformation);(e.action==="end"||w7(r))&&this.finishController()}activateDirection(e){this._keysButtonState[e]=1,ede(this._keysButtonState,this._transformation)}deactivateDirection(e){this._keysButtonState[e]=0;const r=ede(this._keysButtonState,this._transformation);w7(r)&&this.finishController()}onControllerStart(e){this._filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z,this._headingStart=this.view.camera.heading,super.onControllerStart(e)}_updateFilteredSurfaceElevation(e){const r=this.view.pointsOfInterest.cameraOnSurface.location.z,i=1;this._filteredSurfaceElevation+=i*(r-this._filteredSurfaceElevation)*e}stepController(e,r){var i;this._updateStartHeading(),this._updateFilteredSurfaceElevation(e),this.currentCamera.copyViewFrom(r),this._updateCameraCenter(),(i=this._constraintOptions.interactionStartCamera)==null||i.copyFrom(this.currentCamera),this._calculateControlTransformation(e,this.currentCamera,hb),this._applyDisabledMovementTypes(hb),this._applyPan(hb.pan),this._applyRotate(hb.rotate),this._applyZoom(hb.zoom),this._applyAscend(hb.ascend),this._constraintOptions.interactionType=rr.NONE,this._constraintOptions.selection=Vi.COLLISION,qn(this.view,this.currentCamera,this._constraintOptions),super.stepController(e,r)}_updateStartHeading(){this._transformation.heading!==0&&(this._headingStart=this.view.camera.heading)}_applyRotate(e){if(!e.enabled)return;const r=this.currentCamera;ye(Cl,r.center,r.eye),Ge(Cl,Cl,e.matrix),r.center=fe(Cl,Cl,r.eye),r.up=Ge(Cl,r.up,e.matrix),this._constraintOptions.interactionType=rr.LOOK_AROUND,this._constraintOptions.selection=Vi.ALL_EXCEPT_COLLISION,qn(this.view,r,this._constraintOptions)}_applyPan(e,r=this.currentCamera){e.enabled&&(r.eye=Ge(Cl,r.eye,e.matrix),r.center=Ge(Cl,r.center,e.matrix),this.view.state.isGlobal&&(r.up=Ge(Cl,r.up,e.matrix)),this._constraintOptions.interactionType=rr.PAN,this._constraintOptions.selection=Vi.ALL,qn(this.view,r,this._constraintOptions))}_applyZoom(e){if(!e)return;const r=this.currentCamera.viewForward;this.currentCamera.eye=fe(Cl,this.currentCamera.eye,ne(Be.get(),r,e)),ce(YP,r),Bo(YP,YP),this._constraintOptions.interactionDirection=YP,this._constraintOptions.interactionType=rr.ZOOM,this._constraintOptions.selection=Vi.ALL_EXCEPT_COLLISION,qn(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_applyAscend(e){if(!e)return;const r=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,Be.get());if(this._constraintOptions.interactionDirection=ce(YP,r),this.view.state.isGlobal){const i=Te(this.currentCamera.eye),n=(i+e)/i;this.currentCamera.eye=ne(Cl,this.currentCamera.eye,n),this.currentCamera.center=ne(Cl,this.currentCamera.center,n)}else{const i=ne(Be.get(),r,e);this.currentCamera.eye=fe(Cl,this.currentCamera.eye,i),this.currentCamera.center=fe(Cl,this.currentCamera.center,i)}this._updateCameraCenter(),this._constraintOptions.interactionType=rr.ASCEND,this._constraintOptions.selection=Vi.COLLISION,qn(this.view,this.currentCamera,this._constraintOptions)&&this._updateCameraCenter(),this._constraintOptions.selection=Vi.ALL_EXCEPT_COLLISION,qn(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_calculateControlTransformation(e,r,i){hct(i);const n=this._computeVelocities(e);this.view.state.isLocal?this._calculateControlTransformationLocal(n,r,i):this._calculateControlTransformationGlobal(n,r,i)}_updateCameraCenter(){const e=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,r=this.view.renderCoordsHelper,i=this.currentCamera.ray;this.currentCamera.center=r.intersectManifoldClosestSilhouette(i,e,Cl)}_calculateControlTransformationLocal(e,r,i){const{viewRight:n,viewForward:s}=r,o=this._transformation,a=this.view.navigation.gamepad,l=ie(Be.get(),s[0],s[1],0);pe(l,l);const c=o.translation[0]*e.pan;if(c!==0){const _=ne(Be.get(),n,c);ic(i.pan.matrix,i.pan.matrix,_),i.pan.enabled=!0}switch(a.mode){case"pan":{const _=-o.translation[1]*e.pan;if(_!==0){const v=ne(Be.get(),l,_);ic(i.pan.matrix,i.pan.matrix,v),i.pan.enabled=!0}i.zoom=o.zoom*e.zoom;break}case"zoom":i.zoom=(-o.translation[1]+o.zoom)*e.zoom;break;default:a.mode}const u=o.translation[2]*e.ascend;i.ascend=u;const h=-o.heading*e.rotate;h!==0&&(Gc(i.rotate.matrix,i.rotate.matrix,h,this.view.renderCoordsHelper.worldUpAtPosition(r.eye,Be.get())),i.rotate.enabled=!0);const p=o.tilt*e.rotate,f=bv(this.view.renderCoordsHelper,r.center,r.eye),g=we(f+p,ea.min,ea.max)-f;g&&(Gc(i.rotate.matrix,i.rotate.matrix,g,n),i.rotate.enabled=!0)}_calculateControlTransformationGlobal(e,r,i){const{eye:n,viewRight:s}=r,o=this._transformation,a=this.view.navigation.gamepad,l=Je(Be.get(),s,n);pe(l,l),Bo(l,l),mlt(this.startCamera,r,o,e,this.view.camera.heading,this._headingStart,this.view.camera.tilt,i,a),this._tmpCamera.copyFrom(this.currentCamera),this._applyPan(hb.pan,this._tmpCamera);const c=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,u=o.translation[2]*e.ascend;i.ascend=u;const h=-o.heading*e.rotate;h!==0&&(Gc(i.rotate.matrix,i.rotate.matrix,h,this._tmpCamera.eye),i.rotate.enabled=!0);const p=o.tilt*e.rotate,f=this._clampTiltDeltaGlobalToValidRange(p,r.ray,c);f!==0&&(Gc(i.rotate.matrix,i.rotate.matrix,f,this._tmpCamera.viewRight),i.rotate.enabled=!0),i.zoom+=o.zoom*e.zoom}_clampTiltDeltaGlobalToValidRange(e,r,i){const n=Br(this.view.spatialReference),s=uF(ea.min,r.origin,i,n);let o=0,a=0;const l=Be.get();if(this.view.renderCoordsHelper.intersectManifold(r,i,l)){const c=bv(this.view.renderCoordsHelper,l,r.origin);o=uF(c,r.origin,i,n),a=uF(ea.max,r.origin,i,n)}else{z3($9(I9,i+n.radius),r,l);const c=Math.PI+P9(r.direction,l);o=Nhe(c,r.origin,i,n),a=Nhe(ea.max,r.origin,i,n)}return we(o+e,s,a)-o}_getPointAbsoluteSurfaceElevation(e,r,i){const{renderCoordsHelper:n}=this.view,s=n.getAltitude(e),o=r+Math.abs(s-r);return n.setAltitude(i,o,e),o}_clampedDistanceToSurface(e,r){const{renderCoordsHelper:i}=this.view,{camera:n}=this.view.state,{direction:s}=xQe(this.view,r,0,QMe,uct),o=i.intersectManifoldClosestSilhouette(eh(r,s),e,Be.get()),a=Di(r,o),l=i.intersectManifoldClosestSilhouette(eh(r,fy(Be.get(),r,n.center)),e,Be.get()),c=Di(r,l);return Math.min(a,c)}_computeHeadingRotateRadius(e){const{renderCoordsHelper:r,state:i}=this.view,{camera:n,isGlobal:s}=i,o=r.intersectManifoldClosestSilhouette(n.ray,this._filteredSurfaceElevation,Be.get());if(s){const a=ye(Be.get(),e,o),l=Te(a);ne(a,a,1/l);const c=pe(Be.get(),e),u=Ks(de(c,a));return l*Math.sin(Math.min(oct,u))}{const a=ce(Be.get(),e);return r.setAltitude(a,this._filteredSurfaceElevation),Di(o,a)}}_minimumAscendVelocity(){return this.view.state.constraints.collision.enabled?0:act}_computeVelocities(e){const r=this._filteredSurfaceElevation,i=r+Br(this.view.spatialReference).radius,{camera:n,isGlobal:s}=this.view.state,o=Be.get(),a=this._getPointAbsoluteSurfaceElevation(n.eye,r,o),l=this._clampedDistanceToSurface(r,o),c=n.width/2,u=tde*n.width,h=tde*n.width,p=l*Math.tan(.5*n.fovX)/c,f=p/i,g=p/this._computeHeadingRotateRadius(o),_=a-r;return{pan:(s?f:p)*u*e,ascend:Math.max(this._minimumAscendVelocity()*e,2**(u*e/c)*_-_),zoom:2**(u*e/c)*l-l,rotate:we(g*h,lct,cct)*e}}_applyDisabledMovementTypes(e){this.disableMovements==null||this.disableMovements.mode!==void 0&&this.view.state.viewingMode!==this.disableMovements.mode||(e.zoom=this.disableMovements.zoom?0:e.zoom,e.ascend=this.disableMovements.ascend?0:e.ascend,e.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&pd(e.pan.matrix),e.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&pd(e.rotate.matrix))}static activatesFor(e,r){const i=Khe(r,e.navigation.gamepad,sct);return!(r.action==="end"||w7(i))}};d([m({constructOnly:!0})],fx.prototype,"gamepadDevice",void 0),d([m({constructOnly:!0})],fx.prototype,"disableMovements",void 0),fx=d([V("esri.views.3d.state.controllers.GamepadKeyboardController")],fx);const sct={translation:[0,0,0],heading:0,tilt:0,zoom:0},QMe=80,oct=Nt(QMe),tde=.75,act=5,lct=Nt(30),cct=Nt(80),hb={zoom:0,ascend:0,pan:{enabled:!1,matrix:xe()},rotate:{enabled:!1,matrix:xe()}},Cl=C(),YP=C(),uct=gte();function hct(t){t.zoom=0,t.ascend=0,t.pan.enabled=!1,pd(t.pan.matrix),t.rotate.enabled=!1,pd(t.rotate.matrix)}let dct=class extends qo{constructor(e){super(!0),this._view=e,this._watchHandles=new $v,this._handle=this.registerIncoming("gamepad",r=>this._handleEventGamepad(r)),this._handle.pause()}onInstall(e){super.onInstall(e),this._watchHandles.add([he(()=>this._view.navigation.gamepad.enabled,r=>{r?this._handle.resume():(this._handle.pause(),this._cameraControllerGamepad&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null))},gi),he(()=>this._view.navigation.gamepad.device,r=>{this._cameraControllerGamepad&&r&&this._cameraControllerGamepad.gamepadDevice!==r&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null)})])}onUninstall(){this._watchHandles.removeAll(),super.onUninstall()}_handleEventGamepad(e){const r=this._view.navigation.gamepad.device;if(r&&e.data.device!==r)return;const i=this._cameraControllerGamepad&&this._cameraControllerGamepad.active;if(i||fx.activatesFor(this._view,e.data)){if(!i){const n=new fx({view:this._view,gamepadDevice:e.data.device});this._view.state.switchCameraController(n)&&(this._cameraControllerGamepad=n)}this._cameraControllerGamepad&&this._cameraControllerGamepad.active&&this._cameraControllerGamepad.gamepadDevice===e.data.device&&this._cameraControllerGamepad.handleEventGamepad(e.data)}}};function pct(t){const e=()=>t(document.visibilityState==="visible");return document.addEventListener("visibilitychange",e),{remove:()=>document.addEventListener("visibilitychange",e)}}var wc;(function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.FORWARD=2]="FORWARD",t[t.BACKWARD=3]="BACKWARD",t[t.UP=4]="UP",t[t.DOWN=5]="DOWN",t[t.HEADINGLEFT=6]="HEADINGLEFT",t[t.HEADINGRIGHT=7]="HEADINGRIGHT",t[t.TILTUP=8]="TILTUP",t[t.TILTDOWN=9]="TILTDOWN",t[t.ZOOMIN=10]="ZOOMIN",t[t.ZOOMOUT=11]="ZOOMOUT"})(wc||(wc={}));let fct=class extends qo{constructor(e,r){super(!0),this._view=e,this._disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:De.Local},this._keyToNumber={[r.left]:wc.LEFT,[r.right]:wc.RIGHT,[r.forward]:wc.FORWARD,[r.backward]:wc.BACKWARD,[r.up]:wc.UP,[r.down]:wc.DOWN,[r.headingLeft]:wc.HEADINGLEFT,[r.headingRight]:wc.HEADINGRIGHT,[r.tiltUp]:wc.TILTUP,[r.tiltDown]:wc.TILTDOWN,[r.zoomIn]:wc.ZOOMIN,[r.zoomOut]:wc.ZOOMOUT},this.registerIncoming("key-down",null,i=>this._handleKeyDown(i)),this.registerIncoming("key-up",null,i=>this._handleKeyUp(i)),this.registerIncoming("blur",null,()=>this._handleStop()),this._visibilityHandle=pct(i=>i?null:this._handleStop())}onUninstall(){var e;(e=this._visibilityHandle)==null||e.remove(),this._handleStop()}_handleKeyDown(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const r=this._keyToNumber[e.data.key];r!=null&&(this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active||(this._cameraControllerKeyboard=new fx({view:this._view,disableMovements:this._disableMovements}),this._view.state.switchCameraController(this._cameraControllerKeyboard)),this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.activateDirection(r),e.stopPropagation()))}_handleStop(){var e;(e=this._cameraControllerKeyboard)!=null&&e.active&&(this._cameraControllerKeyboard.finishController(),this._cameraControllerKeyboard=null)}_handleKeyUp(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const r=this._keyToNumber[e.data.key];r!=null&&this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.deactivateDirection(r),e.stopPropagation())}},mct=class extends qo{constructor(e,r){super(!0),this._view=e,this.registerIncoming("mouse-wheel",r,i=>this._handleMouseWheel(i))}_handleMouseWheel(e){if(!this._view.navigation.mouseWheelZoomEnabled)return;const r=e.data;this._cameraController&&this._cameraController.active||(this._cameraController=this._view.state.isGlobal?new n8({view:this._view,mode:"interaction"}):new s8({view:this._view,mode:"interaction"}),this._view.state.switchCameraController(this._cameraController)),this._cameraController.zoomStep(-1/60*r.deltaY,pn(r.x,r.y)),e.preventDefault(),e.stopPropagation()}},c8=class{constructor(e){this._gain=e}reset(e){this._value=e}set gain(e){this._gain=e}get value(){return this._value===void 0?0:this._value}update(e){this._value===void 0?this._value=e:this._value=this._gain*e+(1-this._gain)*this._value}},g2=class extends U${constructor(){super(...arguments),this._beginCamera=new Qe,this._elapsedTimeSec=0,this.constraintOptions=new Sd(Vi.ALL,rr.PAN,0,this._beginCamera)}initialize(){this.constraintOptions.interactionType=this.interactionType,this.viewAnimation=new r3}get steppingFinished(){return this.momentum.isFinished(this._elapsedTimeSec)}onControllerStart(e){this._beginCamera.copyFrom(e),super.onControllerStart(e)}stepController(e,r){r.copyViewFrom(this._beginCamera),this._elapsedTimeSec+=e,this.momentumStep(this._elapsedTimeSec,r),qn(this.view,r,this.constraintOptions)}};g2=d([V("esri.views.3d.state.controllers.momentum.MomentumController")],g2);let cR=class extends g2{constructor(e){super(e),this.interactionType=rr.PAN,this._tmpPan=C()}momentumStep(e,r){const i=this.momentum.value(e);ne(this._tmpPan,this.momentum.direction,i),r.eye=ye(rde,r.eye,this._tmpPan),r.center=ye(rde,r.center,this._tmpPan),this.constraintOptions.interactionDirection=this._tmpPan}};d([m({constructOnly:!0})],cR.prototype,"momentum",void 0),cR=d([V("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],cR);const rde=C(),gct=C(),fN=C();let fF=class extends g2{constructor(e){super(e),this.interactionType=rr.PAN}momentumStep(e,r){const i=this.momentum.value1(e),n=this.momentum.value2(e);ce(fN,r.eye),pe(fN,fN),Je(this.momentum.axis2,fN,this.momentum.axis1),GMe(r,gct,this.momentum.axis1,i,this.momentum.axis2,n)}};d([m({constructOnly:!0})],fF.prototype,"momentum",void 0),fF=d([V("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],fF);let Ww=class extends g2{set center(e){this._set("center",Zi(e))}set axis(e){this._set("axis",Zi(e))}constructor(e){super(e),this.interactionType=rr.TUMBLE}momentumStep(e,r){const i=this.momentum.value(e);wv(r,this.center,B$(this.axis,i))}};d([m({constructOnly:!0})],Ww.prototype,"momentum",void 0),d([m({constructOnly:!0})],Ww.prototype,"center",null),d([m({constructOnly:!0})],Ww.prototype,"axis",null),Ww=d([V("esri.views.3d.state.controllers.momentum.MomentumController")],Ww);let dC=class extends g2{set zoomCenter(e){this._set("zoomCenter",Zi(e))}constructor(e){super(e),this.interactionType=rr.ZOOM,this.constraintOptions.interactionDirection=C()}momentumStep(e,r){const{interactionDirection:i}=this.constraintOptions;if(!i)return;ce(i,r.eye);const n=this.momentum.valueDelta(0,e);Nre(r,this.zoomCenter,n,this.view.state.constraints.minimumPoiDistance),fy(i,r.eye,i)}};d([m({constructOnly:!0})],dC.prototype,"momentum",void 0),d([m({constructOnly:!0})],dC.prototype,"zoomCenter",null),dC=d([V("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],dC);let _w=class extends g2{set screenCenter(e){this._set("screenCenter",pn(e[0],e[1]))}set sceneCenter(e){this._set("sceneCenter",Zi(e))}constructor(e){super(e),this.interactionType=rr.ZOOM,this.radius=0,this._tmpSceneCenter=C(),this._tmpZoomAxisAngle=_U(),this._sphere=Jn()}initialize(){this._sphere[3]=this.radius}momentumStep(e,r){const i=this.momentum.valueDelta(0,e);FMe(this._sphere,r,i),this.constraintOptions.interactionType=rr.ZOOM,qn(this.view,r,this.constraintOptions),V$(this._sphere,r,this.screenCenter,this._tmpSceneCenter),$re(this.sceneCenter,this._tmpSceneCenter,this._tmpZoomAxisAngle),wv(r,this._sphere,this._tmpZoomAxisAngle),this.constraintOptions.interactionType=rr.PAN}};d([m({constructOnly:!0})],_w.prototype,"momentum",void 0),d([m({constructOnly:!0})],_w.prototype,"screenCenter",null),d([m({constructOnly:!0})],_w.prototype,"sceneCenter",null),d([m({constructOnly:!0})],_w.prototype,"radius",void 0),_w=d([V("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],_w);let Mp=class{constructor(e){this._gain=e,this.lastValue=void 0,this.filteredDelta=void 0}update(e){if(this.hasLastValue()){const r=this.computeDelta(e);this._updateDelta(r)}this.lastValue=e}reset(){this.lastValue=void 0,this.filteredDelta=void 0}hasLastValue(){return this.lastValue!==void 0}hasFilteredDelta(){return this.filteredDelta!==void 0}computeDelta(e){return this.lastValue===void 0?NaN:e-this.lastValue}_updateDelta(e){this.filteredDelta!==void 0?this.filteredDelta=(1-this._gain)*this.filteredDelta+this._gain*e:this.filteredDelta=e}},xU=class{constructor(e,r,i){this._initialVelocity=e,this._stopVelocity=r,this._friction=i,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(e){return e>this.duration}get friction(){return this._friction}value(e){return this.valueFromInitialVelocity(this._initialVelocity,e)}valueDelta(e,r){const i=this.value(e);return this.value(e+r)-i}valueFromInitialVelocity(e,r){r=Math.min(r,this.duration);const i=1-this.friction;return e*(i**r-1)/Math.log(i)}},yct=class extends xU{constructor(e,r,i,n,s){super(e,r,i),this._sceneVelocity=n,this.direction=s}value(e){return super.valueFromInitialVelocity(this._sceneVelocity,e)}},KMe=class{constructor(e=300,r=12,i=.84){this._minimumInitialVelocity=e,this._stopVelocity=r,this._friction=i,this.enabled=!0,this._time=new Mp(.6),this._screen=[new Mp(.4),new Mp(.4)],this._scene=[new Mp(.6),new Mp(.6),new Mp(.6)],this._tmpDirection=C()}add(e,r,i){if(this.enabled){if(this._time.hasLastValue()&&this._time.computeDelta(i)<.015)return;this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._scene[0].update(r[0]),this._scene[1].update(r[1]),this._scene[2].update(r[2]),this._time.update(i)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._scene[0].reset(),this._scene[1].reset(),this._scene[2].reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta()||!this._time.hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,r=this._screen[1].filteredDelta,i=e==null||r==null?0:Math.sqrt(e*e+r*r),n=this._time.filteredDelta,s=n==null||i==null?0:i/n;return Math.abs(s)<this._minimumInitialVelocity?null:this.createMomentum(s,this._stopVelocity,this._friction)}createMomentum(e,r,i){ie(this._tmpDirection,this._scene[0].filteredDelta??0,this._scene[1].filteredDelta??0,this._scene[2].filteredDelta??0);const n=Te(this._tmpDirection);n>0&&ne(this._tmpDirection,this._tmpDirection,1/n);const s=this._time.filteredDelta;return new yct(e,r,i,s==null?0:n/s,this._tmpDirection)}},ide=class{constructor(e){this._gain=e}update(e){this.filteredValue!==void 0?this.filteredValue=(1-this._gain)*this.filteredValue+this._gain*e:this.filteredValue=e}reset(){this.filteredValue=void 0}get hasFilteredValue(){return this.filteredValue!==void 0}};const nde=1e-5;let _ct=class extends xU{constructor(e,r,i,n,s,o=0,a){super(e,r,i),this._angularVelocity1=n,this.axis1=s,this.angularVelocity2=o,this.axis2=a}value1(e){return super.valueFromInitialVelocity(this._angularVelocity1,e)}value2(e){return super.valueFromInitialVelocity(this.angularVelocity2,e)}},vct=class{constructor(e=300,r=12,i=.84){this._minimumInitialVelocity=e,this._stopVelocity=r,this._friction=i,this.enabled=!0,this._tmpAxis1=C(),this._tmpAxis2=C(),this._tmpAngles=He(),this._time=new Mp(.3),this._screen=[new Mp(.4),new Mp(.4)],this._angle1=new ide(.6),this._angle2=new ide(.6),this._axis1=C(),this._axis2=C(),this._lastScene=C()}addMomentumDirectRotation(e,r,i,n,s,o){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(i)<.01)return;let a=BMe(this._lastScene,r,this._tmpAxis2,n,s,o);this._angle2.update(0),Ra(this._tmpAxis2)<nde?a=0:pe(this._axis1,this._tmpAxis2),this._angle1.update(a),ce(this._lastScene,r)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(i)}}addMomentumPreserveHeading(e,r,i,n,s,o,a){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(i)<.01)return;VMe(this._lastScene,r,this._tmpAxis2,this._tmpAxis1,this._tmpAngles,n,s,o,a,!1),Ra(this._tmpAxis2)<nde?(this._angle1.update(0),this._angle2.update(0)):(this._angle1.update(this._tmpAngles[1]),this._angle2.update(this._tmpAngles[0]),pe(this._axis1,this._tmpAxis1),pe(this._axis2,this._tmpAxis2)),ce(this._lastScene,r)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(i)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._angle1.reset(),this._angle2.reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,r=this._screen[1].filteredDelta,i=e==null||r==null?null:Math.sqrt(e*e+r*r),n=this._time.filteredDelta,s=i==null||n==null?0:i/n;return Math.abs(s)<this._minimumInitialVelocity?null:this.createMomentum(s,this._stopVelocity,this._friction)}createMomentum(e,r,i){const n=this._time.filteredDelta,s=this._angle1.filteredValue,o=this._angle2.filteredValue,a=n==null||o==null?0:o/n;return new _ct(e,r,i,n==null||s==null?0:s/n,this._axis1,a,this._axis2)}},eOe=class{constructor(e=2.5,r=.01,i=.95,n=12){this._minimumInitialVelocity=e,this._stopVelocity=r,this._friction=i,this._maxVelocity=n,this.enabled=!0,this.value=new Mp(.8),this.time=new Mp(.3)}add(e,r){if(this.enabled&&r!=null){if(this.time.hasLastValue()){if(this.time.computeDelta(r)<.01)return;if(this.value.hasFilteredDelta()){const i=this.value.computeDelta(e);this.value.filteredDelta*i<0&&this.value.reset()}}this.time.update(r),this.value.update(e)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta()||!this.time.hasFilteredDelta())return null;let e=this.value.filteredDelta/this.time.filteredDelta;return e=we(e,-this._maxVelocity,this._maxVelocity),Math.abs(e)<this._minimumInitialVelocity?null:this.createMomentum(e,this._stopVelocity,this._friction)}createMomentum(e,r,i){return new xU(e,r,i)}},tOe=class extends eOe{constructor(e=3,r=.01,i=.95,n=12){super(e,r,i,n)}add(e,r){const i=this.value.lastValue;if(i!=null){let n=e-i;for(;n>Math.PI;)n-=2*Math.PI;for(;n<-Math.PI;)n+=2*Math.PI;e=i+n}super.add(e,r)}},bct=class extends xU{constructor(e,r,i){super(e,r,i)}value(e){const r=super.value(e);return Math.exp(r)}valueDelta(e,r){const i=super.value(e),n=super.value(e+r)-i;return Math.exp(n)}},rOe=class extends eOe{constructor(e=2.5,r=.01,i=.95,n=12){super(e,r,i,n)}add(e,r){super.add(Math.log(e),r)}createMomentum(e,r,i){return new bct(e,r,i)}},xZ=class extends Nm{constructor(){super(...arguments),this._smoothRotation=new c8(.05),this._rotationAxis=C(),this._beginAngle=0,this._beginHeading=0,this._panningPlane=zr(),this._beginRadius=0,this._smoothScaling=new c8(.05),this._zoomCenterScreen=pn(),this._zoomMomentumEstimator=new rOe,this._rotationMomentumEstimator=new tOe,this._panSphericalMomentumEstimator=new vct,this._panPlanarMomentumEstimator=new KMe,this._adjustedSphere=Jn(),this._tmp3d=C(),this._tmpScreenPointArray=pn(),this._beginScreenPoint=pn(),this._beginScenePoint=C(),this._screenPickPoint=pn(),this._scenePickPoint=C(),this._mode=wo.Horizontal,this._sphere=Jn(),this._pointerCount=0,this._tmpInteractionDirection=C(),this._beginCamera=new Qe,this._constraintOptions=new Sd(Vi.ALL,rr.NONE,0,this._beginCamera)}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;this._zoomMomentumEstimator.enabled=this._rotationMomentumEstimator.enabled=this._panPlanarMomentumEstimator.enabled=this._panSphericalMomentumEstimator.enabled=this.view.navigation.momentumEnabled,this._beginHeading=-ov.normalize(Nt(this.view.camera.heading)),this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._smoothRotation.reset(),Rp(e.center,this._screenPickPoint),eo(this._beginScreenPoint,this._screenPickPoint);const r=Br(this.view.spatialReference),i=zMe(this._intersectionHelper,this.startCamera,this._screenPickPoint,r,l3.Silhouette,this.view.map.ground.opacity===0?j2:{});i.scenePickPoint!=null&&(this._scenePickPoint=i.scenePickPoint,this._sphere=i.sphere,ce(this._beginScenePoint,this._scenePickPoint),this._mode=bU(this.startCamera,this._screenPickPoint,r),this._mode===wo.Vertical&&this._preparePlanarPanMode(e,i.hasGeometryIntersection),this._beginCamera.copyFrom(this.startCamera))}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const r=e.pointers.size>1;this._mode===wo.Horizontal?(r&&this._zoomSpherical(e),this._panningSpherical(e),r&&this._rotateSpherical(e)):(r&&this._zoomPlanar(e),this._panningPlanar(e),r&&this._rotatePlanar(e)),this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const r=this._zoomMomentumEstimator.evaluateMomentum();if(r)return this._mode===wo.Horizontal?new _w({view:this.view,momentum:r,screenCenter:this._zoomCenterScreen,sceneCenter:this._beginScenePoint,radius:this._sphere[3]}):new dC({view:this.view,momentum:r,zoomCenter:this._beginScenePoint});const i=this._rotationMomentumEstimator.evaluateMomentum();if(i)return new Ww({view:this.view,momentum:i,center:this._sphere,axis:this._rotationAxis});if(this._mode===wo.Horizontal){const n=this._panSphericalMomentumEstimator.evaluateMomentum();if(n)return new fF({view:this.view,momentum:n})}else{const n=this._panPlanarMomentumEstimator.evaluateMomentum();if(n)return new cR({view:this.view,momentum:n})}return null}_preparePlanarPanMode(e,r){const i=Bo(this._tmp3d,this.startCamera.viewForward);FI(this._scenePickPoint,i,this._panningPlane);const n=pn(this._screenPickPoint[0],0),s=C(),o=Te(this.startCamera.eye);this._adjustedSphere[3]=o<this._sphere[3]?o-100:this._sphere[3],V$(this._adjustedSphere,this.startCamera,n,s);const a=oa();this.startCamera.projectToRenderScreen(s,a);const l=C(),c=C(),u=C();ye(l,this._scenePickPoint,this.currentCamera.eye);const h=Te(l);pe(l,l);const p=DMe*Math.max(Math.abs(this.view.camera.position.z),NMe),f=this.view._stage.renderView.getMinimalDepthForArea(null,this._screenPickPoint[0],this._screenPickPoint[1],this.view.state.camera,vU);let g=f??p;g=r?Math.min(g,h):g,ce(u,fe(c,this.currentCamera.eye,ne(c,l,g))),this._panningPlane[3]=-de(this._panningPlane,u),this.startCamera.center=fe(c,this.startCamera.eye,ne(c,this.startCamera.viewForward,g));const _=Rp(e.center,this._tmpScreenPointArray);vZ(this._panningPlane,this.startCamera,_,this._beginScenePoint)}_zoomSpherical(e){const r=this._beginRadius/e.radius,i=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=i,this._smoothScaling.update(r),FMe(this._sphere,this.currentCamera,this._smoothScaling.value),Rp(e.center,this._zoomCenterScreen),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),this._constraintOptions.interactionType=rr.ZOOM,this._constraintOptions.interactionFactor=Ap(e.radius-this._beginRadius),qn(this.view,this.currentCamera,this._constraintOptions)}_panningSpherical(e){const r=Rp(e.center,this._tmpScreenPointArray);V$(this._sphere,this.currentCamera,r,this._tmp3d),Fre(this._beginScenePoint,de(this.currentCamera.up,this._beginScenePoint),this._sphere[3],this._beginHeading,this.view.camera.tilt,this.startCamera)?(HMe(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this._beginHeading,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumPreserveHeading(r,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere,this._beginHeading,this.view.camera.tilt)):(jMe(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumDirectRotation(r,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere[3],this.view.camera.tilt)),this._constraintOptions.interactionType=rr.PAN,this._constraintOptions.interactionFactor=Ap(mv(this._screenPickPoint,r)),qn(this.view,this.currentCamera,this._constraintOptions)}_rotateSpherical(e){pe(this._rotationAxis,this._scenePickPoint),this.currentCamera.aboveGround||Bo(this._rotationAxis,this._rotationAxis);const r=this._smoothRotation.value,i=r+_Z(e.angle-r),n=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=n,this._smoothRotation.update(i);const s=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(s,.001*e.timestamp),wv(this.currentCamera,this._sphere,B$(this._rotationAxis,s)),this._constraintOptions.interactionType=rr.TUMBLE,this._constraintOptions.interactionFactor=Ap(e.radius*i),qn(this.view,this.currentCamera,this._constraintOptions)}_panningPlanar(e){const r=Rp(e.center,this._tmpScreenPointArray);vZ(this._panningPlane,this.currentCamera,r,this._tmp3d)&&(UMe(this.currentCamera,this._beginScenePoint,this._tmp3d),this._panPlanarMomentumEstimator.add(r,this._tmp3d,.001*e.timestamp),this._constraintOptions.interactionType=rr.PAN,this._constraintOptions.interactionFactor=Ap(mv(this._beginScreenPoint,r)),this._constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this._tmpInteractionDirection),qn(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null)}_zoomPlanar(e){const r=this._beginRadius/e.radius,i=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=i,this._smoothScaling.update(r),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),Nre(this.currentCamera,this._beginScenePoint,this._smoothScaling.value,this.view.state.constraints.minimumPoiDistance),this._constraintOptions.interactionType=rr.ZOOM,this._constraintOptions.interactionFactor=Ap(e.radius-this._beginRadius),qn(this.view,this.currentCamera,this._constraintOptions)}_rotatePlanar(e){ce(this._rotationAxis,this._beginScenePoint),this.currentCamera.aboveGround||Bo(this._rotationAxis,this._rotationAxis);const r=this._smoothRotation.value;let i=e.angle-r;i=_Z(i);const n=r+i,s=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=s,this._smoothRotation.update(n);const o=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(o,.001*e.timestamp),wv(this.currentCamera,this._sphere,B$(this._rotationAxis,o)),this._constraintOptions.interactionType=rr.TUMBLE,this._constraintOptions.interactionFactor=Ap(e.radius*o),qn(this.view,this.currentCamera,this._constraintOptions)}};xZ=d([V("esri.views.3d.state.controllers.global.PinchAndPanController")],xZ);const sde=Ce(0,0,1),wct={ELEVATION_THRESHOLD:3e4,ANGLE_THRESHOLD:16/180*Math.PI};let TZ=class extends Nm{constructor(){super(...arguments),this._rotationValueSmooth=new c8(.05),this._scalingValueSmooth=new c8(.05),this._planeHorizontal=zr(),this._planeVertical=zr(),this._rotationMomentumEstimator=new tOe,this._panMomentumEstimator=new KMe(300,12,.9),this._zoomMomentumEstimator=new rOe,this._beginRadius=0,this._beginCenter=C(),this._beginAngle=0,this._tmpPoints=[],this._panMode=wo.Horizontal,this._beginCenterScreen=pn(),this._tmpCentroid3d=C(),this._tmpCentroid2d=pn(),this._tmp2d=pn(),this._pointerCount=0,this._beginCamera=new Qe,this._constraintOptions=new Sd(Vi.ALL,rr.NONE,0,this._beginCamera)}begin(e){if(!this.active)return;const r=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=r,this._rotationMomentumEstimator.enabled=r,this._panMomentumEstimator.enabled=r,this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._rotationValueSmooth.reset(),this._scalingValueSmooth.reset(),Rp(e.center,this._beginCenterScreen),PSe(sde,0,this._planeHorizontal);const i=C(),n=this._intersectionHelper.intersectScreenFreePointFallback(this._beginCenterScreen,i,this.view.map.ground.opacity===0?j2:{}),s=C();Bo(s,this.startCamera.viewForward);const o=C();ce(o,sde);const a=de(s,o),l=hd(a<0?-a:a);this._panMode=l>=wct.ANGLE_THRESHOLD?wo.Horizontal:wo.Vertical;const c=Math.min(DMe,1/Math.abs(de(o,this.startCamera.viewForward)))*Math.max(Math.abs(this.view.camera.position.z),NMe);aq(this._planeHorizontal,this._planeHorizontal,i),this.startCamera.aboveGround||lq(this._planeHorizontal,this._planeHorizontal);const u=C(),h=C(),p=C();ye(u,i,this.currentCamera.eye);const f=Te(u);if(pe(u,u),this._panMode===wo.Vertical){ne(o,o,a),ye(this._planeVertical,s,o),pe(this._planeVertical,this._planeVertical),aq(this._planeVertical,this._planeVertical,i);const g=this.view._stage.renderView.getMinimalDepthForArea(G$(this.view),this._beginCenterScreen[0],this._beginCenterScreen[1],this.view.state.camera,vU);let _=g??c;_=n?Math.min(_,f):_,ce(p,fe(h,this.currentCamera.eye,ne(h,u,_))),this._planeVertical[3]=-de(this._planeVertical,p),this._computePlanePoints(e.pointers,this._planeVertical,this.startCamera,this._tmpPoints),u7(this._tmpPoints,this._beginCenter)}else{const g=n?f:c;ce(p,fe(h,this.currentCamera.eye,ne(h,u,g))),this._planeHorizontal[3]=-de(this._planeHorizontal,p),this._computePlanePoints(e.pointers,this._planeHorizontal,this.startCamera,this._tmpPoints),u7(this._tmpPoints,this._beginCenter)}this._beginCamera.copyFrom(this.startCamera)}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const r=e.pointers.size>1,i=this._panMode===wo.Horizontal?this._planeHorizontal:this._planeVertical,n=this._beginCenter;if(r){const s=this._beginRadius/e.radius,o=.001875*Math.min(Math.max(e.radius,40),120);this._scalingValueSmooth.gain=o,this._scalingValueSmooth.update(s),Nre(this.currentCamera,n,this._scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance),this._zoomMomentumEstimator.add(this._scalingValueSmooth.value,.001*e.timestamp),this._constraintOptions.interactionType=rr.ZOOM,this._constraintOptions.interactionFactor=Ap(Math.abs(e.radius-this._beginRadius)),qn(this.view,this.currentCamera,this._constraintOptions)}if(this._computePlanePoints(e.pointers,i,this.currentCamera,this._tmpPoints),u7(this._tmpPoints,this._tmpCentroid3d),Rp(e.center,this._tmpCentroid2d),UMe(this.currentCamera,n,this._tmpCentroid3d),this._panMomentumEstimator.add(this._tmpCentroid2d,this._tmpCentroid3d,.001*e.timestamp),this._constraintOptions.interactionType=rr.PAN,this._constraintOptions.interactionFactor=Ap(mv(this._beginCenterScreen,this._tmpCentroid2d)),qn(this.view,this.currentCamera,this._constraintOptions),r){const s=n,o=this._rotationValueSmooth.value,a=o+_Z(e.angle-o),l=.00125*Math.min(Math.max(e.radius,40),120);this._rotationValueSmooth.gain=l,this._rotationValueSmooth.update(a);const c=this._rotationValueSmooth.value-this._beginAngle;this._rotationMomentumEstimator.add(c,.001*e.timestamp);const u=this._planeHorizontal;wv(this.currentCamera,s,B$(u,c)),this._constraintOptions.interactionType=rr.TUMBLE,this._constraintOptions.interactionFactor=Ap(Math.abs(e.radius*c)),qn(this.view,this.currentCamera,this._constraintOptions)}this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const r=this._zoomMomentumEstimator.evaluateMomentum();if(r)return new dC({view:this.view,momentum:r,zoomCenter:this._beginCenter});const i=this._rotationMomentumEstimator.evaluateMomentum();if(i)return new Ww({view:this.view,momentum:i,center:this._beginCenter,axis:this._planeHorizontal});const n=this._panMomentumEstimator.evaluateMomentum();return n?new cR({view:this.view,momentum:n}):null}_computePlanePoints(e,r,i,n){n.length=e.size;const s=this._tmp2d;let o=0;return e.forEach(a=>{s[0]=a.x,s[1]=a.y,n[o]===void 0&&(n[o]=C()),vZ(r,i,s,n[o]),o+=1}),n}get _intersectionHelper(){return this.view.sceneIntersectionHelper}};TZ=d([V("esri.views.3d.state.controllers.local.PinchAndPanController")],TZ);let ode=class extends qo{constructor(e,r,i){super(!0),this._view=e,this.pointerAction=r,this._lastEndTimestamp=0,this._lastTimestamp=0,this.registerIncoming("drag",i,n=>this._handleDrag(n))}_handleDrag(e){if(e.data.pointerType==="mouse"&&!zre(e.data,this.pointerAction))return;const r=e.timestamp-this._lastEndTimestamp,i=40,n=this._momentum&&this._momentum.active&&r<i;switch(e.data.action){case"start":case"update":if(n)break;this._controller&&this._controller.active?e.data.timestamp-this._lastTimestamp>2&&(this._controller.update(e.data),this._lastTimestamp=e.timestamp):this._startController(e);break;case"end":case"removed":this._endController(e,!0);break;case"added":this._endController(e,!1),this._startController(e)}e.stopPropagation()}_endController(e,r){if(this._controller&&this._controller.active){this._lastEndTimestamp=e.timestamp;const i=this._controller.end(e.data);r&&i&&(this._momentum=i,this._view.state.switchCameraController(this._momentum))}this._controller=null}_startController(e){this._controller=this._createController(),this._view.state.switchCameraController(this._controller),this._controller.begin(e.data),this._lastTimestamp=e.timestamp}_createController(){return this._view.state.isGlobal?new xZ({view:this._view}):new TZ({view:this._view})}},xct=class extends qo{constructor(e,r){super(!0),this.view=e,this.registerIncoming("pointer-down",r,()=>this.view.state.stopActiveCameraController())}},iOe=class extends qo{constructor(e,r){super(!0),this.key=e,this.registerIncoming("key-down",r,i=>this._handleKeyDown(i))}_handleKeyDown(e){e.data.key===this.key&&(this.activate(),e.stopPropagation())}},Tct=class extends iOe{constructor(e,r,i){super(r,i),this.view=e}activate(){this.view.goTo({heading:0}).catch(()=>{})}},Sct=class extends iOe{constructor(e,r,i){super(r,i),this.view=e}activate(){this.view.goTo({tilt:0}).catch(()=>{})}},Cct=class extends qo{constructor(e,r=!1){super(!0),this._view=e,this._invert=r,this.registerIncoming("vertical-two-finger-drag",i=>this._handleTwoFinger(i))}_handleTwoFinger(e){var n,s,o;const r=this._invert?-1:1,i=pn(0,e.data.delta*r);switch(e.data.action){case"begin":(n=this._cameraController)==null||n.end(),this._cameraController=new lR({view:this._view,pivot:Mc.CENTER}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(i);break;case"update":(s=this._cameraController)==null||s.update(i);break;case"end":(o=this._cameraController)==null||o.end(),this._cameraController=null}}};function ade(t){const e=t.native;return e?{buttons:e.buttons.map(r=>r.pressed?r.value||1:0),axes:e.axes.map(r=>Act(r,t.axisThreshold))}:{buttons:[],axes:[]}}function Ect(t,e){if(t.axes.length!==e.axes.length||t.buttons.length!==e.buttons.length)return!1;for(let r=0;r<t.axes.length;r++)if(t.axes[r]!==e.axes[r])return!1;for(let r=0;r<t.buttons.length;r++)if(t.buttons[r]!==e.buttons[r])return!1;return!0}function Pct(t){for(let e=0;e<t.axes.length;e++)if(t.axes[e]!==0)return!1;for(let e=0;e<t.buttons.length;e++)if(t.buttons[e]!==0)return!1;return!0}function Act(t,e){const r=Math.abs(t);return r<e?0:Math.sign(t)*(r-e)/(1-e)}let Mct=class{constructor(e,r){this._element=e,this._input=r,this._hasEventListeners=!1,this._onConnectGamepad=s=>{this._connectGamepad(s.gamepad)},this._onDisconnectGamepad=s=>{const o=s.gamepad,a=o.index,l=this._inputDevices[a];l&&(this._emitGamepadEvent(o,ade(l),!1),this._inputDevices.splice(a,1),this._latestUpdate.splice(a,1),this._input.gamepad.devices.remove(l),this.ensurePollingState())},this._frameTask=null,this._latestUpdate=new Array,this._inputDevices=new Array,this._callback=null;const i="getGamepads"in window.navigator,n=window.isSecureContext;this.supported=i&&n,this.supported&&(this._forEachGamepad(s=>this._connectGamepad(s)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}set hasEventListeners(e){this._hasEventListeners!==e&&(this._hasEventListeners=e,this.ensurePollingState())}get _eventsEnabled(){return this.supported&&this._inputDevices.length>0&&this._hasEventListeners}set onEvent(e){this._callback=e}_connectGamepad(e){const r=new Bte(e);r.deviceType!=="unknown"&&(this._inputDevices[e.index]=r,this._input.gamepad.devices.add(r)),this.ensurePollingState()}ensurePollingState(){this._eventsEnabled?this._startPolling():this._stopPolling()}_startPolling(){this._frameTask==null&&(this._frameTask=qx({update:()=>this._readGamepadState()}))}_stopPolling(){this._frameTask!=null&&(this._frameTask.remove(),this._frameTask=null,this._latestUpdate=new Array)}_readGamepadState(){const e=document.hasFocus(),r=this._element.contains(document.activeElement),i=this._input.gamepad.enabledFocusMode==="document"&&!e||this._input.gamepad.enabledFocusMode==="view"&&!r;this._forEachGamepad(n=>{const s=this._inputDevices[n.index];if(!s)return;const o=this._latestUpdate[n.index],a=ade(s),l=i||Pct(a);o&&(o.timestamp===n.timestamp||!o.active&&l||Ect(o.state,a))||this._emitGamepadEvent(n,a,!l)})}_forEachGamepad(e){const r=window.navigator.getGamepads();for(let i=0;i<r.length;i++){const n=r[i];this._validate(n)&&e(n)}}_emitGamepadEvent(e,r,i){const n=this._latestUpdate[e.index],s=n&&n.active;if(!s&&!i)return;const o=!s&&i?"start":s&&i?"update":"end";this._latestUpdate[e.index]={timestamp:e.timestamp,state:r,active:i},this._callback&&this._callback({device:this._inputDevices[e.index],state:r,action:o})}_validate(e){if(!e||!e.connected)return!1;for(let r=0;r<e.axes.length;r++)if(isNaN(e.axes[r]))return!1;return!0}};const lde=se("edge"),Oct=se("chrome"),Rct=se("ff"),$ct=se("safari"),cde="esri-view-surface",mT={touchNone:`${cde}--touch-none`,touchPan:`${cde}--touch-pan`};let nOe=class sOe{constructor(e,r){this._input=r,this._active={},this._callback=()=>{},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=e,e.getAttribute("tabindex")||e.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new Mct(e,this._input),this._gamepadSource.onEvent=i=>this._callback("gamepad",i)}destroy(){this._callback=()=>{},this.activeEvents=null,this._activePointerCaptures.forEach(e=>{this._releasePointerCaptureSafe(e)}),this._gamepadSource=Pe(this._gamepadSource),this._activePointerCaptures=null,this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(e){this._browserTouchPanningEnabled=e,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(e){this._callback=e}set activeEvents(e){for(const r in this._active)if(!e||!e.has(r)){const i=this._active[r];this._element.removeEventListener(x7[r],i),delete this._active[r]}e&&e.forEach(r=>{if(!this._active[r]&&x7[r]){const i=(this._eventHandlers[r]||this._handleDefault).bind(this,r);this._element.addEventListener(x7[r],i),this._active[r]=i}}),this._gamepadSource.hasEventListeners=(e==null?void 0:e.has("gamepad"))??!1}setPointerCapture(e,r){r?this._setPointerCatpureSafe(e.pointerId):(this._releasePointerCaptureSafe(e.pointerId),this._activePointerCaptures.delete(e.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?mT.touchNone:mT.touchPan),this._element.classList.add(this._browserTouchPanningEnabled?mT.touchPan:mT.touchNone)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove(mT.touchNone),this._element.classList.remove(mT.touchPan),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_setPointerCatpureSafe(e){try{this._element.setPointerCapture(e),this._activePointerCaptures.add(e)}catch{}}_releasePointerCaptureSafe(e){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(e))return;this._element.releasePointerCapture(e)}catch{}}_updateNormalizedPointerLikeEvent(e,r){const i=z3e(this._element,e);return sOe.test.disableSubpixelCoordinates&&(i.x=Math.round(i.x),i.y=Math.round(i.y)),r.x=i.x,r.y=i.y,r}_handleKey(e,r){const{key:i}=r;i&&e==="key-up"&&this._keyDownState.delete(i);const n={native:r,key:i,repeat:!!i&&this._keyDownState.has(i)};i&&e==="key-down"&&this._keyDownState.add(n.key),this._callback(e,n)}_handlePointer(e,r){const i=this._updateNormalizedPointerLikeEvent(r,{native:r,x:0,y:0,pointerType:r.pointerType,button:r.button,buttons:r.buttons,eventId:this._eventId++});this._callback(e,i)}_handlePointerPreventDefault(e,r){const i=this._updateNormalizedPointerLikeEvent(r,{native:r,x:0,y:0,pointerType:r.pointerType,button:r.button,buttons:r.buttons,eventId:this._eventId++});r.preventDefault(),this._callback(e,i)}_handleMouseWheel(e,r){let i=r.deltaY;switch(r.deltaMode){case 0:lde&&(i=i/document.documentElement.clientHeight*600);break;case 1:i*=30;break;case 2:i*=900}lde?i*=.7:Oct||$ct?i*=.6:Rct&&(i*=1.375);const n=100,s=Math.abs(i);s>n&&(i=i/s*200/(1+Math.exp(-.02*(s-n))));const o=this._updateNormalizedPointerLikeEvent(r,{native:r,x:0,y:0,deltaY:i});this._callback(e,o)}_handlePointerCaptureLost(e,r){this._activePointerCaptures.delete(r.pointerId),this._handleDefault(e,r)}_handleDefault(e,r){const i={native:r};r.preventDefault(),this._callback(e,i)}_preventAltKeyDefault(e){e.key==="Alt"&&e.preventDefault()}_preventMultiTouchPanning(e){e.touches.length>1&&e.preventDefault()}};nOe.test={disableSubpixelCoordinates:!1};const x7={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};let Ict=class extends qo{constructor(){super(!0),this.registerIncoming("context-menu",e=>{e.data.native.preventDefault()})}};const Fu={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500,maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};function SZ(t,e){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)}function Lct(t,e){const r=e.x-t.x,i=e.y-t.y;return Math.sqrt(r*r+i*i)}function Dct(t,e){if(e?(e.radius=0,e.center.x=0,e.center.y=0):e={radius:0,center:dd()},t.length===0)return e;if(t.length===1)return e.center.x=t[0].x,e.center.y=t[0].y,e;if(t.length===2){const[x,S]=t,[E,A]=[S.x-x.x,S.y-x.y];return e.radius=Math.sqrt(E*E+A*A)/2,e.center.x=(x.x+S.x)/2,e.center.y=(x.y+S.y)/2,e}let r=0,i=0;for(let x=0;x<t.length;x++)r+=t[x].x,i+=t[x].y;r/=t.length,i/=t.length;const n=t.map(x=>x.x-r),s=t.map(x=>x.y-i);let o=0,a=0,l=0,c=0,u=0,h=0,p=0;for(let x=0;x<n.length;x++){const S=n[x],E=s[x],A=S*S,O=E*E;o+=A,a+=O,l+=S*E,c+=A*S,u+=O*E,h+=S*O,p+=E*A}const f=.5*(c+h),g=.5*(u+p),_=o*a-l*l,v=(f*a-g*l)/_,b=(o*g-l*f)/_,w=dd(v+r,b+i);return{radius:Math.sqrt(v*v+b*b+(o+a)/t.length),center:w}}function uR(t){const{native:e}=t,{pointerId:r,button:i,pointerType:n}=e;return n==="mouse"?`${r}:${i}`:`${n}`}let Nct=class extends qo{constructor(e){super(!1),this._navigationTouch=e,this._startStateModifiers=new Set,this._activePointerMap=new Map,this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._drag=this.registerOutgoing("drag"),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-capture-lost",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-cancel",this._handlePointerUpAndPointerLost.bind(this))}_createPayload(e,r,i,n){return{action:e,pointerType:this._pointerType,button:this._mouseButton,buttons:r.buttons,timestamp:n,pointers:Fct(this._activePointerMap),pointer:r,angle:i.angle,radius:i.radius,center:i.center}}_addPointer(e){const r=e.native.pointerId,i=mN(this._activePointerMap).angle,n={event:e,initialAngle:0,lastAngle:0};this._activePointerMap.set(r,n);const s=mF(n,oOe(this._activePointerMap));n.initialAngle=s,n.lastAngle=s,this._updatePointerAngles(i)}_updatePointer(e){if(e&&e.x==null&&e.y==null)return;const r=e.native.pointerId,i=this._activePointerMap.get(r);i?i.event=e:this._addPointer(e)}_removePointer(e){const r=mN(this._activePointerMap).angle;this._activePointerMap.delete(e),this._updatePointerAngles(r)}_updatePointerAngles(e){const r=mN(this._activePointerMap);this._activePointerMap.forEach(i=>{i.initialAngle=mF(i,r)-e,i.lastAngle=mF(i,r)-e})}_emitEvent(e,r,i){const n=mN(this._activePointerMap);this._drag.emit(this._createPayload(e,r,n,i),void 0,this._startStateModifiers)}_handlePointerUpAndPointerLost(e){const r=e.data.native.pointerId,i=e.timestamp;this._activePointerMap.get(r)&&(this._activePointerMap.size===1?(this._updatePointer(e.data),!this._isCurrentDragSuppressed&&this._emitEvent("end",e.data,i),this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._removePointer(r)):(this._removePointer(r),this._emitEvent("removed",e.data,e.timestamp)))}_handlePointerDrag(e){const r=e.data,i=r.currentEvent,n=e.timestamp;switch(r.action){case"start":case"update":this._isDragging?this._activePointerMap.has(i.native.pointerId)?(this._updatePointer(i),!this._isCurrentDragSuppressed&&this._emitEvent("update",i,n)):(this._addPointer(i),this._emitEvent("added",i,n),this._isCurrentDragSuppressed=this._isSuppressed):(this._updatePointer(i),this._pointerType=e.data.startEvent.pointerType,this._mouseButton=e.data.startEvent.button,this._startStateModifiers=e.modifiers,this._isDragging=!0,this._isCurrentDragSuppressed=this._isSuppressed,!this._isCurrentDragSuppressed&&this._emitEvent("start",i,n))}}get _isSuppressed(){return!!this._navigationTouch&&!this._navigationTouch.browserTouchPanEnabled&&this._pointerType==="touch"&&this._activePointerMap.size===1}};function oOe(t){const e=[];return t.forEach(r=>{e.push(dd(r.event.x,r.event.y))}),Dct(e)}function mN(t){const e=oOe(t);let r=0;return t.forEach(i=>{let n=mF(i,e),s=n-i.lastAngle;for(;s>Math.PI;)s-=2*Math.PI;for(;s<-Math.PI;)s+=2*Math.PI;n=i.lastAngle+s,i.lastAngle=n;const o=n-i.initialAngle;r+=o}),r/=t.size||1,{angle:r,radius:e.radius,center:e.center}}function Fct(t){const e=new Map;return t.forEach((r,i)=>e.set(i,r.event)),e}function mF(t,e){const r=t.event,i=r.x-e.center.x,n=r.y-e.center.y;return Math.atan2(n,i)}var ude;(function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right",t[t.Back=3]="Back",t[t.Forward=4]="Forward",t[t.Undefined=-1]="Undefined"})(ude||(ude={}));let kct=class extends qo{constructor(e=Fu.maximumDoubleClickDelay,r=Fu.maximumDoubleClickDistance,i=Fu.maximumDoubleTouchDelay,n=Fu.maximumDoubleTouchDistance,s=SI){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=r,this._maximumDoubleTouchDelay=i,this._maximumDoubleTouchDistance=n,this._clock=s,this._pointerState=new Map,this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUp.bind(this))}onUninstall(){this._pointerState.forEach(e=>{e.immediateDoubleClick&&e.immediateDoubleClick.timeoutHandle.remove()}),super.onUninstall()}_handlePointerDown(e){const r=e.data,i=uR(r);if(!this._pointerState.has(i)){const n={downButton:r.native.button,x:r.x,y:r.y,immediateDoubleClick:null};this._pointerState.set(i,n),this.startCapturingPointer(r.native)}}_handlePointerUp(e){const r=e.data,i=uR(r),n=this._pointerState.get(i);if(n&&n.downButton===r.native.button){const s=n.immediateDoubleClick,o=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;s?(s.timeoutHandle.remove(),SZ(s,e.data)>o?this._startImmediateDoubleClick(e,n):(this._immediateDoubleClick.emit(e.data,void 0,s.modifiers),this._removeState(r))):SZ(n,e.data)>o?this._removeState(r):this._startImmediateDoubleClick(e,n)}}_startImmediateDoubleClick(e,r){const i=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay;r.immediateDoubleClick={x:e.data.x,y:e.data.y,modifiers:e.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(e.data),i)}}_removeState(e){const r=uR(e);this._pointerState.delete(r),this.stopCapturingPointer(e.native),this.refreshHasPendingInputs()}},zct=class extends qo{constructor(e=Fu.maximumClickDelay,r=Fu.movementUntilMouseDrag,i=Fu.movementUntilPenDrag,n=Fu.movementUntilTouchDrag,s=Fu.holdDelay,o=SI){super(!1),this._maximumClickDelay=e,this._movementUntilMouseDrag=r,this._movementUntilPenDrag=i,this._movementUntilTouchDrag=n,this._holdDelay=s,this._clock=o,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",a=>{this._handlePointerLoss(a,"pointer-up")}),this.registerIncoming("pointer-capture-lost",a=>{this._handlePointerLoss(a,"pointer-capture-lost")}),this.registerIncoming("pointer-cancel",a=>{this._handlePointerLoss(a,"pointer-cancel")}),this._moveHandle=this.registerIncoming("pointer-move",this._handlePointerMove.bind(this)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach(e=>{e.holdTimeout=wi(e.holdTimeout)}),super.onUninstall()}_handlePointerDown(e){const r=e.data,i=r.native.pointerId;let n=null;this._pointerState.size===0&&(n=this._clock.setTimeout(()=>{const o=this._pointerState.get(i);if(o){if(!o.isDragging){const a=o.previousEvent;this._pointerHold.emit(a,void 0,e.modifiers),o.holdEmitted=!0}o.holdTimeout=null}},this._holdDelay));const s={startEvent:r,previousEvent:r,startTimestamp:e.timestamp,isDragging:!1,downButton:r.native.button,holdTimeout:n,modifiers:new Set};this._pointerState.set(i,s),this.startCapturingPointer(r.native),this._moveHandle.resume(),this._pointerState.size>1&&this._startDragging(e)}_createPointerDragData(e,r,i){return{action:e,startEvent:r.startEvent,previousEvent:r.previousEvent,currentEvent:i}}_handlePointerMove(e){const r=e.data,i=r.native.pointerId,n=this._pointerState.get(i);n&&(n.isDragging?this._pointerDrag.emit(this._createPointerDragData("update",n,r),void 0,n.modifiers):Lct(r,n.startEvent)>this._getDragThreshold(r.native.pointerType)&&this._startDragging(e),n.previousEvent=r)}_getDragThreshold(e){switch(e){case"touch":return this._movementUntilTouchDrag;case"pen":return this._movementUntilPenDrag;default:return this._movementUntilMouseDrag}}_startDragging(e){const r=e.data,i=r.native.pointerId;this._pointerState.forEach(n=>{n.holdTimeout!=null&&(n.holdTimeout.remove(),n.holdTimeout=null),n.isDragging||(n.modifiers=e.modifiers,n.isDragging=!0,i===n.startEvent.native.pointerId?this._pointerDrag.emit(this._createPointerDragData("start",n,r)):this._pointerDrag.emit(this._createPointerDragData("start",n,n.previousEvent),e.timestamp))})}_handlePointerLoss(e,r){const i=e.data,n=i.native.pointerId,s=this._pointerState.get(n);s&&(s.holdTimeout!=null&&(s.holdTimeout.remove(),s.holdTimeout=null),s.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",s,r==="pointer-up"?i:s.previousEvent),void 0,s.modifiers):r==="pointer-up"&&s.downButton===i.native.button&&e.timestamp-s.startTimestamp<=this._maximumClickDelay&&!s.holdEmitted&&this._immediateClick.emit(i),this._pointerState.delete(n),this.stopCapturingPointer(i.native),this._pointerState.size===0&&this._moveHandle.pause())}},Uct=class extends qo{constructor(e=Fu.maximumDoubleClickDelay,r=Fu.maximumDoubleClickDistance,i=Fu.maximumDoubleTouchDelay,n=Fu.maximumDoubleTouchDistance,s=SI){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=r,this._maximumDoubleTouchDelay=i,this._maximumDoubleTouchDistance=n,this._clock=s,this._pointerState=new Map,this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",this._handleImmediateClick.bind(this)),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this))}onUninstall(){this._pointerState.forEach(e=>e.doubleClickTimer=wi(e.doubleClickTimer))}get hasPendingInputs(){return Zh(this._pointerState,e=>e.doubleClickTimer!=null)}_clearDoubleClickTimer(e,r){const i=this._pointerState.get(e);i&&(i.doubleClickTimer=wi(i.doubleClickTimer),r&&this._click.emit(i.event.data,void 0,i.event.modifiers),this._pointerState.delete(e),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(e){const r=this._pointerState.get(e);r.pointerDownCount===1&&this._click.emit(r.event.data,void 0,r.event.modifiers),r.doubleClickTimer=null,this._pointerState.delete(e),this.refreshHasPendingInputs()}_getPointerId(e){const{pointerId:r,pointerType:i,button:n}=e.native;return i==="mouse"?`${r}:${n}`:`${i}`}_handleImmediateClick(e){const r=e.data,{pointerType:i}=r.native,n=this._getPointerId(r);if(!this._pointerState.has(n))return void this._startClick(e);const s=this._pointerState.get(n),{data:o,modifiers:a}=s.event,l=i==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;SZ(o,r)>l?(this._clearDoubleClickTimer(n,!0),this._startClick(e)):(this._clearDoubleClickTimer(n,!1),s.pointerDownCount===2&&this._doubleClick.emit(o,void 0,a))}_handlePointerDown(e){const r=uR(e.data),i=this._pointerState.get(r);i&&(i.pointerDownCount+=1)}_startClick(e){const{data:r}=e,{native:{pointerType:i}}=r,n=uR(r),s=i==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay,o=this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(n),s);this._pointerState.set(n,{event:e,doubleClickTimer:o,pointerDownCount:1}),this.refreshHasPendingInputs()}},Bct=class{constructor(e){this._callbacks=e,this._currentCount=0,this._callbacks.condition||(this._callbacks.condition=()=>!0)}handle(e){const r=e.data,i=r.pointers.size;switch(r.action){case"start":this._currentCount=i,this._emitStart(e);break;case"added":this._emitEnd(this._previousEvent),this._currentCount=i,this._emitStart(e);break;case"update":this._emitUpdate(e);break;case"removed":this._startEvent&&this._emitEnd(this._previousEvent),this._currentCount=i,this._emitStart(e);break;case"end":this._emitEnd(e),this._currentCount=0}this._previousEvent=e}_emitStart(e){var r,i;this._startEvent=e,(i=(r=this._callbacks).condition)!=null&&i.call(r,this._currentCount,e)&&this._callbacks.start(this._currentCount,e,this._startEvent)}_emitUpdate(e){var r,i;(i=(r=this._callbacks).condition)!=null&&i.call(r,this._currentCount,e)&&this._callbacks.update(this._currentCount,e,this._startEvent)}_emitEnd(e){var r,i;(i=(r=this._callbacks).condition)!=null&&i.call(r,this._currentCount,e)&&this._callbacks.end(this._currentCount,e,this._startEvent),this._startEvent=null}},Vct=class extends qo{constructor(e=20,r=40){super(!1),this._threshold=e,this._maxDelta=r,this._state="ready",this._emittedArtificalEnd2=!1,this._vertical=this.registerOutgoing("vertical-two-finger-drag"),this._artificalDrag=this.registerOutgoing("drag"),this._dragEventSeparator=new Bct({start:(i,n)=>this._observeStart(i,n),update:(i,n,s)=>this._observeUpdate(i,n,s),end:(i,n)=>this._observeEnd(n)}),this.registerIncoming("drag",i=>this._dragEventSeparator.handle(i))}get failed(){return this._state==="failed"}_observeStart(e,r){e===1&&this._emittedArtificalEnd2&&(this._emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:r.data.button,buttons:r.data.buttons,pointerType:r.data.pointerType,timestamp:r.data.timestamp,pointers:r.data.pointers,pointer:r.data.pointer,angle:r.data.angle,radius:r.data.radius,center:r.data.center}),r.stopPropagation()),this._state=e===2?"ready":"failed"}_observeUpdate(e,r,i){if(this._state!=="failed"&&e===2)return this._state==="active"?(this._vertical.emit({delta:r.data.center.y-this._thresholdReachedCenter.y,action:"update"}),void r.stopPropagation()):void(this._checkMovementWithinLimits(r.data,i.data)?this._checkVerticalThresholdReached(r.data,i.data)&&(this._state="active",this._emittedArtificalEnd2=!0,this._thresholdReachedCenter=r.data.center,this._artificalDrag.emit({action:"end",button:r.data.button,buttons:r.data.buttons,pointerType:r.data.pointerType,timestamp:r.data.timestamp,pointers:r.data.pointers,pointer:r.data.pointer,angle:r.data.angle,radius:r.data.radius,center:r.data.center}),this._vertical.emit({delta:r.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),r.stopPropagation()):this._state="failed")}_observeEnd(e){this._state==="active"&&(this._vertical.emit({delta:e.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this._state="ready",e.stopPropagation())}_checkMovementWithinLimits(e,r){let i=-1/0,n=1/0,s=-1/0,o=1/0;for(const{x:_,y:v}of r.pointers.values())i=Math.max(i,_),n=Math.min(n,_),s=Math.max(s,v),o=Math.min(o,v);let a=-1/0,l=1/0,c=-1/0,u=1/0;for(const{x:_,y:v}of e.pointers.values())a=Math.max(a,_),l=Math.min(l,_),c=Math.max(c,v),u=Math.min(u,v);const h=i-n,p=s-o,f=a-l,g=c-u;return Math.abs(e.center.x-r.center.x)<this._threshold&&Math.abs(f-h)<=this._maxDelta&&Math.abs(g-p)<=this._maxDelta}_checkVerticalThresholdReached(e,r){let i=Math.abs(e.center.y-r.center.y);return e.pointers.forEach((n,s)=>{const o=r.pointers.get(s);i=Math.min(i,Math.abs(n.y-o.y))}),i>=this._threshold}},rp=class extends Ae{destroy(){this.disconnect()}get primaryDragAction(){return this._get("primaryDragAction")}set primaryDragAction(e){e!=="pan"&&e!=="rotate"||e===this._get("primaryDragAction")||(this._set("primaryDragAction",e),this._updateMode())}get mode(){return this._get("mode")}set mode(e){e!=="default"&&e!=="pro"||e===this._get("mode")||(this._set("mode",e),this._updateMode())}get updating(){var e;return!!((e=this._inputManager)!=null&&e.updating)}get latestPointerType(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerType}get latestPointerLocation(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerLocation}get multiTouchActive(){var e;return((e=this._inputManager)==null?void 0:e.multiTouchActive)??!1}disconnect(){this.view.viewEvents.disconnect(),this._inputManager=Pe(this._inputManager)}connect(){const e=this.view;this._source=new nOe(this.view.surface,e.input);const r=[new kct,new zct,new Uct,new Nct(this.view.navigation),new Vct],i=new _h({eventSource:this._source,recognizers:r});this._inputManager=i,i.installHandlers("prevent-context-menu",[new Ict],j1.INTERNAL),this._modeDragPan=new ode(e,"primary"),this._modeDragRotate=new b7(e,"secondary",Mc.CENTER),this._modeDragZoom=new nct(e,"tertiary");const n={lookAround:"b",pan:{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"},resetHeading:"n",resetTilt:"p"};i.installHandlers("navigation",[new xct(e),new xlt(e),new dct(e),new fct(e,n.pan),new mct(e),new Sct(e,n.resetTilt),new Tct(e,n.resetHeading),new b7(e,"primary",Mc.EYE,[n.lookAround]),new b7(e,"secondary",Mc.CENTER,[n.lookAround]),new ode(e,"tertiary",[n.lookAround]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new Cct(e)],j1.INTERNAL),this.view.viewEvents.connect(i),this._updateMode(),this.addHandles(he(()=>{var s;return(s=this.view.navigation)==null?void 0:s.browserTouchPanEnabled},s=>{this._source.browserTouchPanningEnabled=!s},gi))}isModifierKeyDown(e){var r;return((r=this._inputManager)==null?void 0:r.isModifierKeyDown(e))??!1}_updateMode(){var n;const e=this.mode,r=this.primaryDragAction,i=(n=CZ.get(e))==null?void 0:n.get(r);i&&(this._modeDragPan&&(this._modeDragPan.pointerAction=i.pan),this._modeDragRotate&&(this._modeDragRotate.pointerAction=i.rotate),this._modeDragZoom&&(this._modeDragZoom.pointerAction=i.zoom))}get test(){return{inputManager:this._inputManager,modeDragPan:this._modeDragPan,modeDragRotate:this._modeDragRotate,modeDragZoom:this._modeDragZoom}}};d([m()],rp.prototype,"view",void 0),d([m({value:"pan"})],rp.prototype,"primaryDragAction",null),d([m({value:"default"})],rp.prototype,"mode",null),d([m({readOnly:!0})],rp.prototype,"updating",null),d([m()],rp.prototype,"latestPointerType",null),d([m()],rp.prototype,"latestPointerLocation",null),d([m()],rp.prototype,"multiTouchActive",null),d([m()],rp.prototype,"_inputManager",void 0),rp=d([V("esri.views.3d.input.SceneInputManager")],rp);const CZ=new Map,T7=new Map,S7=new Map;T7.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"}),T7.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"}),S7.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"}),S7.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"}),CZ.set("default",T7),CZ.set("pro",S7);const Gct=rp;let Gn=class extends Ae{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1}};d([m()],Gn.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),d([m()],Gn.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),d([m()],Gn.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),d([m()],Gn.prototype,"DECONFLICTOR_SHOW_GRID",void 0),d([m()],Gn.prototype,"LABELS_SHOW_BORDER",void 0),d([m()],Gn.prototype,"TEXT_SHOW_BASELINE",void 0),d([m()],Gn.prototype,"TEXT_SHOW_BORDER",void 0),d([m()],Gn.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),d([m()],Gn.prototype,"OVERLAY_SHOW_CENTER",void 0),d([m()],Gn.prototype,"SHOW_POI",void 0),d([m()],Gn.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),d([m()],Gn.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),d([m()],Gn.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),d([m()],Gn.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),d([m()],Gn.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),d([m()],Gn.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),d([m()],Gn.prototype,"I3S_TREE_SHOW_TILES",void 0),d([m()],Gn.prototype,"I3S_SHOW_MODIFICATIONS",void 0),d([m()],Gn.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),d([m()],Gn.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),d([m()],Gn.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),d([m()],Gn.prototype,"LINE_WIREFRAMES",void 0),Gn=d([V("esri.views.3d.support.DebugFlags")],Gn);const yi=new Gn;let Mu,oE,EZ=!1,PZ=!1,AZ=!1,MZ=!1,hR=null;function jct(t,e){if(!PZ||!oE)return;aOe();const r=oE;let i=0;for(let n=0;n<t.accBinsNumX;n++)for(let s=0;s<t.accBinsNumY;s++){const o=t.accBins[n][t.accBinsNumY-1-s];i+=o.length;const a=n*t.accBinsSizeX,l=(n+1)*t.accBinsSizeX,c=s*t.accBinsSizeY,u=(s+1)*t.accBinsSizeY;r.fillText(o.length.toFixed(),a+5,c+15),lOe(a,l,c,u,"blue")}r.fillText("total totalShownLabels: "+i,70,40),r.fillText("total visible labels: "+e.size,70,50),r.fillText("total numTests: "+t.accNumTests,70,30)}function Hct(t){AZ=yi.DECONFLICTOR_SHOW_VISIBLE,MZ=yi.DECONFLICTOR_SHOW_INVISIBLE,EZ=AZ||MZ,PZ=yi.DECONFLICTOR_SHOW_GRID,hR=null,EZ||PZ?hR=()=>Wct(t):Mu&&(Mu.parentElement.removeChild(Mu),Mu=null)}function aOe(){hR&&(hR(),hR=null)}function Wct(t){Mu==null&&(Mu=document.createElement("canvas"),Mu.setAttribute("id","debugCanvas2d"),t.surface.parentElement.style.position="relative",t.surface.parentElement.appendChild(Mu));const{state:e}=t,{camera:r,pixelRatio:i}=e,{width:n,height:s}=r,o=n*i,a=s*i;Mu.setAttribute("width",`${o}px`),Mu.setAttribute("height",`${a}px`),Mu.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${n}px;height:${s}px`),oE=Mu.getContext("2d"),oE.clearRect(0,0,n,s),oE.font="12px Arial"}function lOe(t,e,r,i,n){aOe();const s=Mu.height,o=oE;o.beginPath(),o.lineWidth=1,o.strokeStyle=n,o.moveTo(t,s-r),o.lineTo(e,s-r),o.stroke(),o.lineTo(e,s-i),o.stroke(),o.lineTo(e,s-r),o.stroke(),o.lineTo(t,s-r),o.stroke(),o.lineTo(t,s-r),o.stroke(),o.closePath()}function qct(t,e){EZ&&(e&&AZ||!e&&MZ)&&lOe(t.aabr[0],t.aabr[2],t.aabr[1],t.aabr[3],e?"green":"red")}var sa,vo;(function(t){t[t.USER=1]="USER",t[t.SCALE_RANGE=2]="SCALE_RANGE",t[t.FILTER=4]="FILTER",t[t.DECONFLICTION=8]="DECONFLICTION",t[t.ALL_GRAPHIC=15]="ALL_GRAPHIC",t[t.ALL_LABEL=255]="ALL_LABEL"})(sa||(sa={})),function(t){t[t.GRAPHIC=1]="GRAPHIC",t[t.LABEL=16]="LABEL"}(vo||(vo={}));function cOe(t,e){return new dOe(t,fOe,e)}function Yct(t,e){const{curvatureDependent:r,scaleStart:i,scaleFallOffRange:n}=fOe;return new dOe(t,{curvatureDependent:{min:{curvature:r.min.curvature,tiltAngle:r.min.tiltAngle,scaleFallOffFactor:C7.curvatureDependent.min.scaleFallOffFactor},max:{curvature:r.max.curvature,tiltAngle:r.max.tiltAngle,scaleFallOffFactor:C7.curvatureDependent.max.scaleFallOffFactor}},scaleStart:i,scaleFallOffRange:n,minPixelSize:C7.minPixelSize},e)}function Xct(t){return Math.abs(t*t*t)}function uOe(t,e,r){const i=r.parameters;return E7.scale=Math.min(i.divisor/(e-i.offset),1),E7.factor=Xct(t),E7}function Gre(t,e){return Rt(t*Math.max(e.scale,e.minScaleFactor),t,e.factor)}function Zct(t,e,r){const i=uOe(t,e,r);return i.minScaleFactor=0,Gre(1,i)}function hde(t,e,r,i){i.scale=Zct(t,e,r),i.factor=0,i.minScaleFactor=r.minScaleFactor}function hOe(t,e,r=[0,0]){const i=Math.min(Math.max(e.scale,e.minScaleFactor),1);return r[0]=t[0]*i,r[1]=t[1]*i,r}function Jct(t,e,r,i){return Gre(t,uOe(e,r,i))}let dOe=class pOe{get minScaleFactor(){return this._fontHeight!=null?Math.min(this._description.minPixelSize/this._fontHeight,1):0}constructor(e,r,i,n=Qct(),s){this._viewingMode=e,this._description=r,this._ellipsoidRadius=i,this.parameters=n,this._fontHeight=s,this._viewingMode===De.Local?(this._coverageCompensation=this._surfaceCoverageCompensationLocal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersLocal):(this._coverageCompensation=this._surfaceCoverageCompensationGlobal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersGlobal)}update(e){return(!this.parameters||this.parameters.camera.fovY!==e.fovY||this.parameters.camera.distance!==e.distance)&&(this._calculateParameters(e,this._ellipsoidRadius,this.parameters),!0)}overrideFontHeight(e){return e!==this._fontHeight?new pOe(this._viewingMode,this._description,this._ellipsoidRadius,this.parameters,e):this}_calculateParameters(e,r,i){const{scaleStart:n,scaleFallOffRange:s}=this._description,{fovY:o,distance:a}=e,l=this._calculateCurvatureDependentParameters(e,r),c=this._coverageCompensation(e,r,l),{tiltAngle:u,scaleFallOffFactor:h}=l,p=Math.sin(u)*a,f=.5*Math.PI-u-o*(.5-n*c),g=p/Math.cos(f),_=f+o*s*c,v=(g-h*(p/Math.cos(_)))/(1-h);return i.camera.fovY=e.fovY,i.camera.distance=e.distance,i.offset=v,i.divisor=g-v,i}_calculateCurvatureDependentParametersLocal(e,r,i=dde){return i.tiltAngle=this._description.curvatureDependent.min.tiltAngle,i.scaleFallOffFactor=this._description.curvatureDependent.min.scaleFallOffFactor,i}_calculateCurvatureDependentParametersGlobal(e,r,i=dde){const n=this._description.curvatureDependent,s=1+e.distance/r,o=Math.sqrt(s*s-1),[a,l]=[n.min.curvature,n.max.curvature],c=we((o-a)/(l-a),0,1),[u,h]=[n.min,n.max];return i.tiltAngle=Rt(u.tiltAngle,h.tiltAngle,c),i.scaleFallOffFactor=Rt(u.scaleFallOffFactor,h.scaleFallOffFactor,c),i}_surfaceCoverageCompensationLocal(e,r,i){return(e.fovY-i.tiltAngle)/e.fovY}_surfaceCoverageCompensationGlobal(e,r,i){const n=r*r,s=i.tiltAngle+.5*Math.PI,{fovY:o,distance:a}=e,l=a*a+n-2*Math.cos(s)*a*r,c=Math.sqrt(l),u=Math.sqrt(l-n);return(Math.acos(u/c)-Math.asin(r/(c/Math.sin(s)))+.5*o)/o}};const fOe={curvatureDependent:{min:{curvature:Nt(10),tiltAngle:Nt(12),scaleFallOffFactor:.5},max:{curvature:Nt(70),tiltAngle:Nt(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},C7={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14};function Qct(){return{camera:{distance:0,fovY:0},divisor:0,offset:0}}const E7={scale:0,factor:0,minScaleFactor:0},dde={tiltAngle:0,scaleFallOffFactor:0};function Kct(t){return t instanceof Float32Array&&t.length>=16}function eut(t){return Array.isArray(t)&&t.length>=16}function tut(t){return Kct(t)||eut(t)}const c3={unknown:1,inches:mo(1,"meters","inches"),feet:mo(1,"meters","feet"),"us-feet":mo(1,"meters","us-feet"),yards:mo(1,"meters","yards"),miles:mo(1,"meters","miles"),"nautical-miles":mo(1,"meters","nautical-miles"),millimeters:mo(1,"meters","millimeters"),centimeters:mo(1,"meters","centimeters"),decimeters:mo(1,"meters","decimeters"),meters:mo(1,"meters","meters"),kilometers:mo(1,"meters","kilometers"),"decimal-degrees":1/XBe(1,"meters",Yr.radius)};var Oa,pde;(function(t){t[t.Undefined=0]="Undefined",t[t.DefinedSize=1]="DefinedSize",t[t.DefinedScale=2]="DefinedScale"})(Oa||(Oa={})),function(t){t[t.Undefined=0]="Undefined",t[t.DefinedAngle=1]="DefinedAngle"}(pde||(pde={}));let jre=class{constructor(e){this.field=e}},rut=class extends jre{constructor(e){super(e),this.minSize=[0,0,0],this.maxSize=[0,0,0],this.offset=[0,0,0],this.factor=[0,0,0],this.type=[Oa.Undefined,Oa.Undefined,Oa.Undefined]}},iut=class extends jre{constructor(e){super(e),this.colors=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.values=[0,0,0,0,0,0,0,0]}},nut=class extends jre{constructor(e){super(e),this.values=[0,0,0,0,0,0,0,0],this.opacityValues=[0,0,0,0,0,0,0,0]}},sut=class{};function XP(t){return t!=null}function gT(t){return typeof t=="number"}function TU(t){return typeof t=="string"}function out(t){return t==null||TU(t)}function Ds(t,e){t&&t.push(e)}function aut(t,e,r,i=xe()){const n=t||0,s=e||0,o=r||0;return n!==0&&DE(i,i,-n/180*Math.PI),s!==0&&LE(i,i,s/180*Math.PI),o!==0&&Kz(i,i,o/180*Math.PI),i}function Ky(t,e,r,i,n){var a;const s=t.minSize,o=t.maxSize;if(t.expression)return Ds(n,"Could not convert size info: expression not supported"),!1;if(t.useSymbolValue){const l=i.symbolSize[r];return e.minSize[r]=l,e.maxSize[r]=l,e.offset[r]=e.minSize[r],e.factor[r]=0,e.type[r]=Oa.DefinedSize,!0}if(XP(t.field))return XP(t.stops)?t.stops.length===2&&gT(t.stops[0].size)&&gT(t.stops[1].size)?(fde(t.stops[0].size,t.stops[1].size,t.stops[0].value,t.stops[1].value,e,r),e.type[r]=Oa.DefinedSize,!0):(Ds(n,"Could not convert size info: stops only supported with 2 elements"),!1):gT(s)&&gT(o)&&XP(t.minDataValue)&&XP(t.maxDataValue)?(fde(s,o,t.minDataValue,t.maxDataValue,e,r),e.type[r]=Oa.DefinedSize,!0):t.valueUnit==="unknown"?(Ds(n,"Could not convert size info: proportional size not supported"),!1):c3[t.valueUnit]!=null?(e.minSize[r]=-1/0,e.maxSize[r]=1/0,e.offset[r]=0,e.factor[r]=1/c3[t.valueUnit],e.type[r]=Oa.DefinedSize,!0):(Ds(n,"Could not convert size info: scale-dependent size not supported"),!1);if(!XP(t.field)){if((a=t.stops)!=null&&a[0]&&gT(t.stops[0].size))return e.minSize[r]=t.stops[0].size,e.maxSize[r]=t.stops[0].size,e.offset[r]=e.minSize[r],e.factor[r]=0,e.type[r]=Oa.DefinedSize,!0;if(gT(s))return e.minSize[r]=s,e.maxSize[r]=s,e.offset[r]=s,e.factor[r]=0,e.type[r]=Oa.DefinedSize,!0}return Ds(n,"Could not convert size info: unsupported variant of sizeInfo"),!1}function fde(t,e,r,i,n,s){const o=Math.abs(i-r)>0?(e-t)/(i-r):0;n.minSize[s]=o>0?t:e,n.maxSize[s]=o>0?e:t,n.offset[s]=t-r*o,n.factor[s]=o}function lut(t,e,r,i){if(t.normalizationField||t.valueRepresentation)return Ds(i,"Could not convert size info: unsupported property"),null;if(!out(t.field))return Ds(i,"Could not convert size info: field is not a string"),null;if(e.size){if(t.field)if(e.size.field){if(t.field!==e.size.field)return Ds(i,"Could not convert size info: multiple fields in use"),null}else e.size.field=t.field}else e.size=new rut(t.field);let n;switch(t.axis){case"width":return n=Ky(t,e.size,0,r,i),n?e:null;case"height":return n=Ky(t,e.size,2,r,i),n?e:null;case"depth":return n=Ky(t,e.size,1,r,i),n?e:null;case"width-and-depth":return n=Ky(t,e.size,0,r,i),n&&Ky(t,e.size,1,r,i),n?e:null;case null:case void 0:case"all":return n=Ky(t,e.size,0,r,i),n=n&&Ky(t,e.size,1,r,i),n=n&&Ky(t,e.size,2,r,i),n?e:null;default:return Ds(i,`Could not convert size info: unknown axis "${t.axis}""`),null}}function cut(t,e,r){for(let n=0;n<3;++n){let s=e.unitInMeters;t.type[n]===Oa.DefinedSize&&(s*=e.modelSize[n],t.type[n]=Oa.DefinedScale),t.minSize[n]=t.minSize[n]/s,t.maxSize[n]=t.maxSize[n]/s,t.offset[n]=t.offset[n]/s,t.factor[n]=t.factor[n]/s}let i;if(t.type[0]!==Oa.Undefined)i=0;else if(t.type[1]!==Oa.Undefined)i=1;else{if(t.type[2]===Oa.Undefined)return Ds(r,"No size axis contains a valid size or scale"),!1;i=2}for(let n=0;n<3;++n)t.type[n]===Oa.Undefined&&(t.minSize[n]=t.minSize[i],t.maxSize[n]=t.maxSize[i],t.offset[n]=t.offset[i],t.factor[n]=t.factor[i],t.type[n]=t.type[i]);return!0}function mde(t,e,r){t[4*e]=r.r/255,t[4*e+1]=r.g/255,t[4*e+2]=r.b/255,t[4*e+3]=r.a}function uut(t,e,r){if(t.normalizationField)return Ds(r,"Could not convert color info: unsupported property"),null;if(TU(t.field)){if(!t.stops)return Ds(r,"Could not convert color info: missing stops or colors"),null;{if(t.stops.length>8)return Ds(r,"Could not convert color info: too many color stops"),null;e.color=new iut(t.field);const i=t.stops;for(let n=0;n<8;++n){const s=i[Math.min(n,i.length-1)];e.color.values[n]=s.value,mde(e.color.colors,n,s.color)}}}else{if(!(t.stops&&t.stops.length>=0))return Ds(r,"Could not convert color info: no field and no colors/stops"),null;{const i=t.stops&&t.stops.length>=0&&t.stops[0].color;e.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(let n=0;n<8;n++)e.color.values[n]=1/0,mde(e.color.colors,n,i)}}return e}function hut(t,e,r){if(t.normalizationField)return Ds(r,"Could not convert opacity info: unsupported property"),null;if(TU(t.field)){if(!t.stops)return Ds(r,"Could not convert opacity info: missing stops or opacities"),null;{if(t.stops.length>8)return Ds(r,"Could not convert opacity info: too many opacity stops"),null;e.opacity=new nut(t.field);const i=t.stops;for(let n=0;n<8;++n){const s=i[Math.min(n,i.length-1)];e.opacity.values[n]=s.value,e.opacity.opacityValues[n]=s.opacity}}}else{if(!(t.stops&&t.stops.length>=0))return Ds(r,"Could not convert opacity info: no field and no opacities/stops"),null;{const i=t.stops&&t.stops.length>=0?t.stops[0].opacity:0;e.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(let n=0;n<8;n++)e.opacity.values[n]=1/0,e.opacity.opacityValues[n]=i}}return e}function P7(t,e,r){const i=r===2&&t.rotationType==="arithmetic";e.offset[r]=i?90:0,e.factor[r]=i?-1:1,e.type[r]=1}function dut(t,e,r){if(!TU(t.field))return Ds(r,"Could not convert rotation info: field is not a string"),null;if(e.rotation){if(t.field)if(e.rotation.field){if(t.field!==e.rotation.field)return Ds(r,"Could not convert rotation info: multiple fields in use"),null}else e.rotation.field=t.field}else e.rotation={field:t.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(t.axis){case"tilt":return P7(t,e.rotation,0),e;case"roll":return P7(t,e.rotation,1),e;case null:case void 0:case"heading":return P7(t,e.rotation,2),e;default:return Ds(r,`Could not convert rotation info: unknown axis "${t.axis}""`),null}}let JI=class{constructor(e,r=[1,1,1],i=[1,1,1],n=1,s=[0,0,0],o=[1,1,1],a=[0,0,0]){this.supports=e,this.modelSize=r,this.symbolSize=i,this.unitInMeters=n,this.anchor=s,this.scale=o,this.rotation=a}};function mOe(t,e,r){if(!t)return null;const i=t.reduce((n,s)=>{if(!n)return n;if(s.valueExpression)return Ds(r,"Could not convert visual variables: arcade expressions not supported"),null;switch(s.type){case"size":return e.supports.size?lut(s,n,e,r):n;case"color":return e.supports.color?uut(s,n,r):n;case"opacity":return e.supports.opacity?hut(s,n,r):null;case"rotation":return e.supports.rotation?dut(s,n,r):n;default:return null}},new sut);return!(t.length>0&&i)||i.size||i.color||i.opacity||i.rotation?i!=null&&i.size&&!cut(i.size,e,r)?null:i:null}let put=class{constructor(e,r,i){this.visualVariables=e,this.materialParameters=r,this.requiresShaderTransformation=i}};function u3(t,e){if(!t||yi.TESTS_DISABLE_FAST_UPDATES)return null;const r=mOe(t.visualVariables,e);return r?new put(r,yOe(r,e),!!r.size):null}function h3(t,e,r){if(!e||!t)return!1;const i=t.visualVariables,n=mOe(e.visualVariables,r);return!!n&&!!(gN(i.size,n.size,"size")&&gN(i.color,n.color,"color")&&gN(i.rotation,n.rotation,"rotation")&&gN(i.opacity,n.opacity,"opacity"))&&(t.visualVariables=n,t.materialParameters=yOe(n,r),t.requiresShaderTransformation=!!n.size,!0)}function gN(t,e,r){if(!!t!=!!e||t&&t.field!==(e==null?void 0:e.field))return!1;if(t&&r==="rotation"){const i=t,n=e;for(let s=0;s<3;s++)if(i.type[s]!==n.type[s]||i.offset[s]!==n.offset[s]||i.factor[s]!==n.factor[s])return!1}return!0}let gOe=class extends Ai{constructor(e){super(),this.vvSize=(e==null?void 0:e.size)??null,this.vvColor=(e==null?void 0:e.color)??null,this.vvOpacity=(e==null?void 0:e.opacity)??null}};function yOe(t,e){const r=new gOe(t);return r.vvSize&&(r.vvSymbolAnchor=e.anchor,pd(dR),aut(e.rotation[2],e.rotation[0],e.rotation[1],dR),r.vvSymbolRotationMatrix=r.vvSymbolRotationMatrix||li(),th(r.vvSymbolRotationMatrix,dR)),r}function fut(t,e,r){if(!t.vvSize)return r;Zn(e_,r);const i=t.vvSymbolRotationMatrix;gg(dR,i[0],i[1],i[2],0,i[3],i[4],i[5],0,i[6],i[7],i[8],0,0,0,0,1),Hr(e_,e_,dR);for(let n=0;n<3;++n){const s=t.vvSize.offset[n]+e[0]*t.vvSize.factor[n];gde[n]=we(s,t.vvSize.minSize[n],t.vvSize.maxSize[n])}return P2(e_,e_,gde),ic(e_,e_,t.vvSymbolAnchor),e_}function Hre(t,e,r){if(!e.vvSize)return ie(t,1,1,1),t;for(let i=0;i<3;++i){const n=e.vvSize.offset[i]+r[0]*e.vvSize.factor[i];t[i]=we(n,e.vvSize.minSize[i],e.vvSize.maxSize[i])}return t}function Qp(t,e){const r=t==null?0:e.attributes[t];return typeof r=="number"&&isFinite(r)?r:0}const e_=xe(),gde=C(),dR=xe();function Wre(t){t.vertex.code.add(T`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),t.vertex.code.add(T`vec3 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec3 params) {
return vec3(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z
);
}`),t.vertex.code.add(T`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec3 factor) {
return mix(size * clamp(factor.x, factor.z, 1.0), size, factor.y);
}`),t.vertex.code.add(T`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),t.vertex.code.add(T`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec3 factor) {
return mix(size * clamp(factor.x, factor.z, 1.0), size, factor.y);
}`),t.vertex.code.add(T`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function mut(t){t.uniforms.add(new Ft("screenSizePerspective",e=>_Oe(e.screenSizePerspective)))}function SU(t){t.uniforms.add(new Ft("screenSizePerspectiveAlignment",e=>_Oe(e.screenSizePerspectiveAlignment||e.screenSizePerspective)))}function _Oe(t){return ie(gut,t.parameters.divisor,t.parameters.offset,t.minScaleFactor)}const gut=C();function vOe(t,e){const r=t.vertex;e.hasVerticalOffset?(bOe(r),e.hasScreenSizePerspective&&(t.include(Wre),SU(r),cf(t.vertex,e)),r.code.add(T`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${e.spherical?T`vec3 worldNormal = normalize(worldPos + localOrigin);`:T`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${e.hasScreenSizePerspective?T`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:T`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):r.code.add(T`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}const yut=Zt();function bOe(t){t.uniforms.add(new xr("verticalOffset",(e,r)=>{const{minWorldLength:i,maxWorldLength:n,screenLength:s}=e.verticalOffset,o=Math.tan(.5*r.camera.fovY)/(.5*r.camera.fullViewport[3]),a=r.camera.pixelRatio||1;return nn(yut,s*a,o,i,n)}))}const wOe=.5;function xOe(t,e){t.include(Wre),t.attributes.add(R.POSITION,"vec3"),t.attributes.add(R.NORMAL,"vec3"),t.attributes.add(R.CENTEROFFSETANDDISTANCE,"vec4");const r=t.vertex;Zc(r,e),cf(r,e),r.uniforms.add(new xr("viewport",(i,n)=>n.camera.fullViewport),new $e("polygonOffset",i=>i.shaderPolygonOffset),new $e("cameraGroundRelative",(i,n)=>n.camera.aboveGround?1:-1)),e.hasVerticalOffset&&bOe(r),r.constants.add("smallOffsetAngle","float",.984807753012208),r.code.add(T`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),r.code.add(T`
    float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
      float pointGroundSign = ${e.multipassEnabled?T.float(0):T`sign(pointGroundDistance)`};
      if (pointGroundSign == 0.0) {
        pointGroundSign = cameraGroundRelative;
      }

      // cameraGroundRelative is -1 if camera is below ground, 1 if above ground
      // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise
      float groundRelative = cameraGroundRelative * pointGroundSign;

      // view angle dependent part of polygon offset emulation: we take the absolute value because the sign that is
      // dropped is instead introduced using the ground-relative position of the symbol and the camera
      if (polygonOffset > .0) {
        float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
        float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
        float factor = (1.0 - tanAlpha / viewport[2]);

        // same side of the terrain
        if (groundRelative > 0.0) {
          posView *= factor;
        }
        // opposite sides of the terrain
        else {
          posView /= factor;
        }
      }

      return groundRelative;
    }
  `),e.draped&&!e.hasVerticalOffset||o3(r),e.draped||(r.uniforms.add(new $e("perDistancePixelRatio",(i,n)=>Math.tan(n.camera.fovY/2)/(n.camera.fullViewport[2]/2))),r.code.add(T`
    void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
      float distanceToCamera = length(posView);

      // Compute offset in world units for a half pixel shift
      float pixelOffset = distanceToCamera * perDistancePixelRatio * ${T.float(wOe)};

      // Apply offset along normal in the direction away from the ground surface
      vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;

      // Apply the same offset also on the view space position
      vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;

      posModel += modelOffset;
      posView += viewOffset;
    }
  `)),e.screenCenterOffsetUnitsEnabled&&Y3(r),e.hasScreenSizePerspective&&SU(r),r.code.add(T`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      vec3 centerOffset = centerOffsetAndDistance.xyz;
      float pointGroundDistance = centerOffsetAndDistance.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${e.draped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${e.hasScreenSizePerspective&&(e.hasVerticalOffset||e.screenCenterOffsetUnitsEnabled)?"vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${e.hasVerticalOffset?e.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${e.hasVerticalOffset?T`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${e.screenCenterOffsetUnitsEnabled?"":T`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${e.screenCenterOffsetUnitsEnabled?e.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${e.screenCenterOffsetUnitsEnabled?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `)}const yN=vs();function TOe(t,e,r,i,n,s){if(t.visible)if(t.boundingInfo){pt(t.type===Cn.Mesh);const o=e.tolerance;SOe(t.boundingInfo,r,i,o,n,s)}else{const o=t.attributes.get(R.POSITION),a=o.indices;QI(r,i,0,a.length/3,a,o,void 0,n,s)}}const _ut=C();function SOe(t,e,r,i,n,s){if(t==null)return;const o=EOe(e,r,_ut);if(o3e(yN,t.bbMin),a3e(yN,t.bbMax),n!=null&&n.applyToAabb(yN),Yre(yN,e,o,i)){const{primitiveIndices:a,position:l}=t,c=a?a.length:l.indices.length/3;if(c>xut){const u=t.getChildren();if(u!==void 0){for(const h of u)SOe(h,e,r,i,n,s);return}}QI(e,r,0,c,l.indices,l,a,n,s)}}const COe=C();function QI(t,e,r,i,n,s,o,a,l){if(o)return vut(t,e,r,i,n,s,o,a,l);const{data:c,stride:u}=s,h=t[0],p=t[1],f=t[2],g=e[0]-h,_=e[1]-p,v=e[2]-f;for(let b=r,w=3*r;b<i;++b){let x=u*n[w++],S=c[x++],E=c[x++],A=c[x];x=u*n[w++];let O=c[x++],L=c[x++],z=c[x];x=u*n[w++];let k=c[x++],q=c[x++],B=c[x];a!=null&&([S,E,A]=a.applyToVertex(S,E,A,b),[O,L,z]=a.applyToVertex(O,L,z,b),[k,q,B]=a.applyToVertex(k,q,B,b));const J=O-S,W=L-E,Y=z-A,le=k-S,D=q-E,I=B-A,F=_*I-D*v,G=v*le-I*g,H=g*D-le*_,Z=J*F+W*G+Y*H;if(Math.abs(Z)<=Number.EPSILON)continue;const te=h-S,me=p-E,Me=f-A,it=te*F+me*G+Me*H;if(Z>0){if(it<0||it>Z)continue}else if(it>0||it<Z)continue;const Et=me*Y-W*Me,St=Me*J-Y*te,ht=te*W-J*me,Ke=g*Et+_*St+v*ht;if(Z>0){if(Ke<0||it+Ke>Z)continue}else if(Ke>0||it+Ke<Z)continue;const je=(le*Et+D*St+I*ht)/Z;je>=0&&l(je,qre(J,W,Y,le,D,I,COe),b,!1)}}function vut(t,e,r,i,n,s,o,a,l){const{data:c,stride:u}=s,h=t[0],p=t[1],f=t[2],g=e[0]-h,_=e[1]-p,v=e[2]-f;for(let b=r;b<i;++b){const w=o[b];let x=3*w,S=u*n[x++],E=c[S++],A=c[S++],O=c[S];S=u*n[x++];let L=c[S++],z=c[S++],k=c[S];S=u*n[x];let q=c[S++],B=c[S++],J=c[S];a!=null&&([E,A,O]=a.applyToVertex(E,A,O,b),[L,z,k]=a.applyToVertex(L,z,k,b),[q,B,J]=a.applyToVertex(q,B,J,b));const W=L-E,Y=z-A,le=k-O,D=q-E,I=B-A,F=J-O,G=_*F-I*v,H=v*D-F*g,Z=g*I-D*_,te=W*G+Y*H+le*Z;if(Math.abs(te)<=Number.EPSILON)continue;const me=h-E,Me=p-A,it=f-O,Et=me*G+Me*H+it*Z;if(te>0){if(Et<0||Et>te)continue}else if(Et>0||Et<te)continue;const St=Me*le-Y*it,ht=it*W-le*me,Ke=me*Y-W*Me,je=g*St+_*ht+v*Ke;if(te>0){if(je<0||Et+je>te)continue}else if(je>0||Et+je<te)continue;const _r=(D*St+I*ht+F*Ke)/te;_r>=0&&l(_r,qre(W,Y,le,D,I,F,COe),w,!1)}}const yde=C(),_de=C();function qre(t,e,r,i,n,s,o){return ie(yde,t,e,r),ie(_de,i,n,s),Je(o,yde,_de),pe(o,o),o}function EOe(t,e,r){return ie(r,1/(e[0]-t[0]),1/(e[1]-t[1]),1/(e[2]-t[2]))}function Yre(t,e,r,i){return Xre(t,e,r,i,1/0)}function Xre(t,e,r,i,n){const s=(t[0]-i-e[0])*r[0],o=(t[3]+i-e[0])*r[0];let a=Math.min(s,o),l=Math.max(s,o);const c=(t[1]-i-e[1])*r[1],u=(t[4]+i-e[1])*r[1];if(l=Math.min(l,Math.max(c,u)),l<0||(a=Math.max(a,Math.min(c,u)),a>l))return!1;const h=(t[2]-i-e[2])*r[2],p=(t[5]+i-e[2])*r[2];return l=Math.min(l,Math.max(h,p)),!(l<0)&&(a=Math.max(a,Math.min(h,p)),!(a>l)&&a<n)}function POe(t,e,r,i,n){let s=(r.screenLength||0)*t.pixelRatio;n!=null&&(s=Jct(s,i,e,n));const o=s*Math.tan(.5*t.fovY)/(.5*t.fullHeight);return we(o*e,r.minWorldLength||0,r.maxWorldLength!=null?r.maxWorldLength:1/0)}function AOe(t,e){const r=e?AOe(e):{};for(const i in t){let n=t[i];n!=null&&n.forEach&&(n=wut(n)),n==null&&i in r||(r[i]=n)}return r}function but(t,e){let r=!1;for(const i in e){const n=e[i];n!==void 0&&(Array.isArray(n)?t[i]===null?(t[i]=n.slice(),r=!0):ebe(t[i],n)&&(r=!0):t[i]!==n&&(r=!0,t[i]=n))}return r}function wut(t){const e=[];return t.forEach(r=>e.push(r)),e}const MOe={multiply:1,ignore:2,replace:3,tint:4},xut=1e3;let Bv=class extends YI{constructor(e,r){super(),this.type=Cn.Material,this.supportsEdges=!1,this._visible=!0,this._renderPriority=0,this._vertexAttributeLocations=Mr,this._pp0=Ce(0,0,1),this._pp1=Ce(0,0,0),this._parameters=AOe(e,r),this.validateParameters(this._parameters)}get parameters(){return this._parameters}update(e){return!1}setParameters(e,r=!0){but(this._parameters,e)&&(this.validateParameters(this._parameters),r&&this.parametersChanged())}validateParameters(e){}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.parametersChanged())}shouldRender(e){return this.isVisible()&&this.isVisibleForOutput(e.output)&&(!this.parameters.isDecoration||e.bindParameters.decorations===Xl.ON)&&(this.parameters.renderOccluded&e.renderOccludedMask)!=0}isVisibleForOutput(e){return!0}get renderPriority(){return this._renderPriority}set renderPriority(e){e!==this._renderPriority&&(this._renderPriority=e,this.parametersChanged())}get vertexAttributeLocations(){return this._vertexAttributeLocations}isVisible(){return this._visible}parametersChanged(){var e;(e=this.repository)==null||e.materialChanged(this)}queryRenderOccludedState(e){return this.isVisible()&&this.parameters.renderOccluded===e}intersectDraped(e,r,i,n,s,o){return this._pp0[0]=this._pp1[0]=n[0],this._pp0[1]=this._pp1[1]=n[1],this.intersect(e,r,i,this._pp0,this._pp1,s)}},OOe=class extends Kst{constructor(e,r,i){super(r,i),this.camera=e}};var kr;(function(t){t[t.None=0]="None",t[t.Occlude=1]="Occlude",t[t.Transparent=2]="Transparent",t[t.OccludeAndTransparent=4]="OccludeAndTransparent",t[t.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil",t[t.Opaque=16]="Opaque"})(kr||(kr={}));let Zre=class extends Ai{constructor(){super(...arguments),this.renderOccluded=kr.Occlude,this.isDecoration=!1}},ROe=class{constructor(){this.factor=new vde,this.factorAlignment=new vde}},vde=class{constructor(){this.scale=0,this.factor=0,this.minScaleFactor=0}};function jBt(t,e,r,i=1){const{data:n,indices:s}=t,o=e.typedBuffer,a=e.typedBufferStride,l=s.length;if(r*=a,i===1)for(let c=0;c<l;++c)o[r]=n[s[c]],r+=a;else for(let c=0;c<l;++c){const u=n[s[c]];for(let h=0;h<i;h++)o[r]=u,r+=a}}function bde(t,e,r){const{data:i,indices:n}=t,s=e.typedBuffer,o=e.typedBufferStride,a=n.length;r*=o;for(let l=0;l<a;++l){const c=2*n[l];s[r]=i[c],s[r+1]=i[c+1],r+=o}}function $Oe(t,e,r,i){const{data:n,indices:s}=t,o=e.typedBuffer,a=e.typedBufferStride,l=s.length;if(r*=a,i==null||i===1)for(let c=0;c<l;++c){const u=3*s[c];o[r]=n[u],o[r+1]=n[u+1],o[r+2]=n[u+2],r+=a}else for(let c=0;c<l;++c){const u=3*s[c];for(let h=0;h<i;++h)o[r]=n[u],o[r+1]=n[u+1],o[r+2]=n[u+2],r+=a}}function d3(t,e,r,i=1){const{data:n,indices:s}=t,o=e.typedBuffer,a=e.typedBufferStride,l=s.length;if(r*=a,i===1)for(let c=0;c<l;++c){const u=4*s[c];o[r]=n[u],o[r+1]=n[u+1],o[r+2]=n[u+2],o[r+3]=n[u+3],r+=a}else for(let c=0;c<l;++c){const u=4*s[c];for(let h=0;h<i;++h)o[r]=n[u],o[r+1]=n[u+1],o[r+2]=n[u+2],o[r+3]=n[u+3],r+=a}}function wde(t,e,r){const i=t.typedBuffer,n=t.typedBufferStride;e*=n;for(let s=0;s<r;++s)i[e]=0,i[e+1]=0,i[e+2]=0,i[e+3]=0,e+=n}function Jre(t,e,r,i,n=1){if(!e)return void $Oe(t,r,i,n);const{data:s,indices:o}=t,a=r.typedBuffer,l=r.typedBufferStride,c=o.length,u=e[0],h=e[1],p=e[2],f=e[4],g=e[5],_=e[6],v=e[8],b=e[9],w=e[10],x=e[12],S=e[13],E=e[14];i*=l;let A=0,O=0,L=0;const z=i9(e)?k=>{A=s[k]+x,O=s[k+1]+S,L=s[k+2]+E}:k=>{const q=s[k],B=s[k+1],J=s[k+2];A=u*q+f*B+v*J+x,O=h*q+g*B+b*J+S,L=p*q+_*B+w*J+E};if(n===1)for(let k=0;k<c;++k)z(3*o[k]),a[i]=A,a[i+1]=O,a[i+2]=L,i+=l;else for(let k=0;k<c;++k){z(3*o[k]);for(let q=0;q<n;++q)a[i]=A,a[i+1]=O,a[i+2]=L,i+=l}}function Qre(t,e,r,i,n=1){if(!e)return void $Oe(t,r,i,n);const{data:s,indices:o}=t,a=e,l=r.typedBuffer,c=r.typedBufferStride,u=o.length,h=a[0],p=a[1],f=a[2],g=a[4],_=a[5],v=a[6],b=a[8],w=a[9],x=a[10],S=!fee(a),E=1e-6,A=1-E;i*=c;let O=0,L=0,z=0;const k=i9(a)?q=>{O=s[q],L=s[q+1],z=s[q+2]}:q=>{const B=s[q],J=s[q+1],W=s[q+2];O=h*B+g*J+b*W,L=p*B+_*J+w*W,z=f*B+v*J+x*W};if(n===1)if(S)for(let q=0;q<u;++q){k(3*o[q]);const B=O*O+L*L+z*z;if(B<A&&B>E){const J=1/Math.sqrt(B);l[i]=O*J,l[i+1]=L*J,l[i+2]=z*J}else l[i]=O,l[i+1]=L,l[i+2]=z;i+=c}else for(let q=0;q<u;++q)k(3*o[q]),l[i]=O,l[i+1]=L,l[i+2]=z,i+=c;else for(let q=0;q<u;++q){if(k(3*o[q]),S){const B=O*O+L*L+z*z;if(B<A&&B>E){const J=1/Math.sqrt(B);O*=J,L*=J,z*=J}}for(let B=0;B<n;++B)l[i]=O,l[i+1]=L,l[i+2]=z,i+=c}}function Tut(t,e,r,i,n=1){if(!e)return void d3(t,r,i,n);const{data:s,indices:o}=t,a=e,l=r.typedBuffer,c=r.typedBufferStride,u=o.length,h=a[0],p=a[1],f=a[2],g=a[4],_=a[5],v=a[6],b=a[8],w=a[9],x=a[10],S=!fee(a),E=1e-6,A=1-E;if(i*=c,n===1)for(let O=0;O<u;++O){const L=4*o[O],z=s[L],k=s[L+1],q=s[L+2],B=s[L+3];let J=h*z+g*k+b*q,W=p*z+_*k+w*q,Y=f*z+v*k+x*q;if(S){const le=J*J+W*W+Y*Y;if(le<A&&le>E){const D=1/Math.sqrt(le);J*=D,W*=D,Y*=D}}l[i]=J,l[i+1]=W,l[i+2]=Y,l[i+3]=B,i+=c}else for(let O=0;O<u;++O){const L=4*o[O],z=s[L],k=s[L+1],q=s[L+2],B=s[L+3];let J=h*z+g*k+b*q,W=p*z+_*k+w*q,Y=f*z+v*k+x*q;if(S){const le=J*J+W*W+Y*Y;if(le<A&&le>E){const D=1/Math.sqrt(le);J*=D,W*=D,Y*=D}}for(let le=0;le<n;++le)l[i]=J,l[i+1]=W,l[i+2]=Y,l[i+3]=B,i+=c}}function IOe(t,e,r,i,n=1){const{data:s,indices:o}=t,a=r.typedBuffer,l=r.typedBufferStride,c=o.length;if(i*=l,e!==s.length||e!==4)if(n!==1)if(e!==4)for(let u=0;u<c;++u){const h=3*o[u];for(let p=0;p<n;++p)a[i]=s[h],a[i+1]=s[h+1],a[i+2]=s[h+2],a[i+3]=255,i+=l}else for(let u=0;u<c;++u){const h=4*o[u];for(let p=0;p<n;++p)a[i]=s[h],a[i+1]=s[h+1],a[i+2]=s[h+2],a[i+3]=s[h+3],i+=l}else{if(e===4){for(let u=0;u<c;++u){const h=4*o[u];a[i]=s[h],a[i+1]=s[h+1],a[i+2]=s[h+2],a[i+3]=s[h+3],i+=l}return}for(let u=0;u<c;++u){const h=3*o[u];a[i]=s[h],a[i+1]=s[h+1],a[i+2]=s[h+2],a[i+3]=255,i+=l}}else{a[i]=s[0],a[i+1]=s[1],a[i+2]=s[2],a[i+3]=s[3];const u=new Uint32Array(r.typedBuffer.buffer,r.start),h=l/4,p=u[i/=4];i+=h;const f=c*n;for(let g=1;g<f;++g)u[i]=p,i+=h}}function Sut(t,e,r){const{data:i,indices:n}=t,s=e.typedBuffer,o=e.typedBufferStride,a=n.length,l=i[0];r*=o;for(let c=0;c<a;++c)s[r]=l,r+=o}function LOe(t,e,r,i,n=1){const s=e.typedBuffer,o=e.typedBufferStride;if(i*=o,n===1)for(let a=0;a<r;++a)s[i]=t[0],s[i+1]=t[1],s[i+2]=t[2],s[i+3]=t[3],i+=o;else for(let a=0;a<r;++a)for(let l=0;l<n;++l)s[i]=t[0],s[i+1]=t[1],s[i+2]=t[2],s[i+3]=t[3],i+=o}function DOe(t,e,r,i,n,s){var o;for(const a of e.fields.keys()){const l=t.attributes.get(a),c=l==null?void 0:l.indices;if(l&&c)Cut(a,l,r,i,n,s);else if(a===R.OBJECTANDLAYERIDCOLOR&&t.objectAndLayerIdColor!=null){const u=(o=t.attributes.get(R.POSITION))==null?void 0:o.indices;if(u){const h=u.length,p=n.getField(a,za);LOe(t.objectAndLayerIdColor,p,h,s)}}}}function Cut(t,e,r,i,n,s){switch(t){case R.POSITION:{pt(e.size===3);const o=n.getField(t,Qs);pt(!!o,`No buffer view for ${t}`),o&&Jre(e,r,o,s);break}case R.NORMAL:{pt(e.size===3);const o=n.getField(t,Qs);pt(!!o,`No buffer view for ${t}`),o&&Qre(e,i,o,s);break}case R.NORMALCOMPRESSED:{pt(e.size===2);const o=n.getField(t,qI);pt(!!o,`No buffer view for ${t}`),o&&bde(e,o,s);break}case R.UV0:{pt(e.size===2);const o=n.getField(t,U2);pt(!!o,`No buffer view for ${t}`),o&&bde(e,o,s);break}case R.COLOR:case R.SYMBOLCOLOR:{const o=n.getField(t,za);pt(!!o,`No buffer view for ${t}`),pt(e.size===3||e.size===4),!o||e.size!==3&&e.size!==4||IOe(e,e.size,o,s);break}case R.COLORFEATUREATTRIBUTE:{const o=n.getField(t,aU);pt(!!o,`No buffer view for ${t}`),pt(e.size===1),o&&e.size===1&&Sut(e,o,s);break}case R.TANGENT:{pt(e.size===4);const o=n.getField(t,uf);pt(!!o,`No buffer view for ${t}`),o&&Tut(e,i,o,s);break}case R.PROFILERIGHT:case R.PROFILEUP:case R.PROFILEVERTEXANDNORMAL:case R.FEATUREVALUE:{pt(e.size===4);const o=n.getField(t,uf);pt(!!o,`No buffer view for ${t}`),o&&d3(e,o,s)}}}let HBt=class extends Ai{constructor(e){super(),this.slicePlaneLocalOrigin=e}};function Eut(t,e){NOe(t,e,new Ft("slicePlaneOrigin",(r,i)=>UOe(e,r,i)),new Ft("slicePlaneBasis1",(r,i)=>{var n;return u8(e,r,i,(n=i.slicePlane)==null?void 0:n.basis1)}),new Ft("slicePlaneBasis2",(r,i)=>{var n;return u8(e,r,i,(n=i.slicePlane)==null?void 0:n.basis2)}))}function Fn(t,e){NOe(t,e,new Xu("slicePlaneOrigin",(r,i)=>UOe(e,r,i)),new Xu("slicePlaneBasis1",(r,i)=>{var n;return u8(e,r,i,(n=i.slicePlane)==null?void 0:n.basis1)}),new Xu("slicePlaneBasis2",(r,i)=>{var n;return u8(e,r,i,(n=i.slicePlane)==null?void 0:n.basis2)}))}function NOe(t,e,...r){if(!e.hasSlicePlane){const o=T`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`;return e.hasSliceInVertexProgram&&t.vertex.code.add(o),void t.fragment.code.add(o)}e.hasSliceInVertexProgram&&t.vertex.uniforms.add(...r),t.fragment.uniforms.add(...r);const i=T`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`,n=T`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
if (sliceByFactors(factors)) {
return color;
}
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`,s=e.hasSliceHighlight?T`
        ${n}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `:T`#define highlightSlice(_color_, _pos_) (_color_)`;e.hasSliceInVertexProgram&&t.vertex.code.add(i),t.fragment.code.add(i),t.fragment.code.add(s)}function FOe(t,e,r){return t.instancedDoublePrecision?ie(Put,r.camera.viewInverseTransposeMatrix[3],r.camera.viewInverseTransposeMatrix[7],r.camera.viewInverseTransposeMatrix[11]):e.slicePlaneLocalOrigin}function kOe(t,e){return t!=null?ye(h8,e.origin,t):e.origin}function zOe(t,e,r){return t.hasSliceTranslatedView?e!=null?ic(Aut,r.camera.viewMatrix,e):r.camera.viewMatrix:null}function UOe(t,e,r){if(r.slicePlane==null)return zn;const i=FOe(t,e,r),n=kOe(i,r.slicePlane),s=zOe(t,i,r);return s!=null?Ge(h8,n,s):n}function u8(t,e,r,i){if(i==null||r.slicePlane==null)return zn;const n=FOe(t,e,r),s=kOe(n,r.slicePlane),o=zOe(t,n,r);return o!=null?(fe(ZP,i,s),Ge(h8,s,o),Ge(ZP,ZP,o),ye(ZP,ZP,h8)):i}const Put=C(),h8=C(),ZP=C(),Aut=xe();function Q3(t,e){const r=e.output===U.ObjectAndLayerIdColor,i=e.objectAndLayerIdColorInstanced;r&&(t.varyings.add("objectAndLayerIdColorVarying","vec4"),i?t.attributes.add(R.INSTANCEOBJECTANDLAYERIDCOLOR,"vec4"):t.attributes.add(R.OBJECTANDLAYERIDCOLOR,"vec4")),t.vertex.code.add(T`
     void forwardObjectAndLayerIdColor() {
      ${r?i?T`objectAndLayerIdColorVarying = instanceObjectAndLayerIdColor * 0.003921568627451;`:T`objectAndLayerIdColorVarying = objectAndLayerIdColor * 0.003921568627451;`:T``} }`),t.fragment.code.add(T`
      void outputObjectAndLayerIdColor() {
        ${r?T`fragColor = objectAndLayerIdColorVarying;`:T``} }`)}function CU(t){t.uniforms.add(new Ym("alignPixelEnabled",(e,r)=>r.alignPixelEnabled)),t.code.add(T`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`),t.code.add(T`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`)}function Mut(t,e){const{vertex:r,fragment:i}=t;r.include(CU),e.multipassEnabled&&(r.include(dAe),t.varyings.add("depth","float")),r.code.add(T`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${e.multipassEnabled?T`
        // Don't draw vertices behind geometry
        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){
          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
        }`:""}

      ${e.multipassEnabled?"depth = projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `),t.include(iu,e),i.code.add(T`
  void main() {
    fragColor = vec4(1);
    ${e.multipassEnabled?T`
        if(terrainDepthTest(depth)) {
          fragColor.g = 0.5;
        }`:""}
  }
  `)}function BOe(t){t.vertex.uniforms.add(new $e("renderTransparentlyOccludedHUD",(e,r)=>r.hudRenderStyle===Ec.Occluded?1:r.hudRenderStyle===Ec.NotOccluded?0:.75),new xr("viewport",(e,r)=>r.camera.fullViewport),new ct("hudVisibilityTexture",(e,r)=>{var i;return(i=r.hudVisibility)==null?void 0:i.getTexture()})),t.vertex.include(CU),t.vertex.code.add(T`bool testHUDVisibility(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}const VOe=Bt(1,1,0,1),Kre=Bt(1,0,1,1);function Vv(t){t.fragment.uniforms.add(new ct("depthTexture",(e,r)=>r.mainDepth)),t.fragment.constants.add("occludedHighlightFlag","vec4",VOe).add("unoccludedHighlightFlag","vec4",Kre),t.fragment.code.add(T`void outputHighlight() {
float sceneDepth = float(texelFetch(depthTexture, ivec2(gl_FragCoord.xy), 0).x);
if (gl_FragCoord.z > sceneDepth + 5e-7) {
fragColor = occludedHighlightFlag;
} else {
fragColor = unoccludedHighlightFlag;
}
}`)}let GOe=class extends vn{constructor(e,r,i){super(e,"vec4",Rr.Pass,(n,s,o)=>n.setUniform4fv(e,r(s,o)),i)}},Zl=class extends vn{constructor(e,r,i){super(e,"float",Rr.Pass,(n,s,o)=>n.setUniform1fv(e,r(s,o)),i)}},KI=class extends gOe{constructor(){super(...arguments),this.renderOccluded=kr.Occlude,this.isDecoration=!1}};const aE=8;function B0(t,e){const{vertex:r,attributes:i}=t;e.hasVvInstancing&&(e.vvSize||e.vvColor)&&i.add(R.INSTANCEFEATUREATTRIBUTE,"vec4"),e.vvSize?(r.uniforms.add(new Ft("vvSizeMinSize",n=>n.vvSize.minSize)),r.uniforms.add(new Ft("vvSizeMaxSize",n=>n.vvSize.maxSize)),r.uniforms.add(new Ft("vvSizeOffset",n=>n.vvSize.offset)),r.uniforms.add(new Ft("vvSizeFactor",n=>n.vvSize.factor)),r.uniforms.add(new sh("vvSymbolRotationMatrix",n=>n.vvSymbolRotationMatrix)),r.uniforms.add(new Ft("vvSymbolAnchor",n=>n.vvSymbolAnchor)),r.code.add(T`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),r.code.add(T`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${e.hasVvInstancing?T`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):r.code.add(T`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),e.vvColor?(r.constants.add("vvColorNumber","int",aE),r.uniforms.add(new Zl("vvColorValues",n=>n.vvColor.values,aE),new GOe("vvColorColors",n=>n.vvColor.colors,aE)),r.code.add(T`
      vec4 interpolateVVColor(float value) {
        if (value <= vvColorValues[0]) {
          return vvColorColors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (vvColorValues[i] >= value) {
            float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
            return mix(vvColorColors[i-1], vvColorColors[i], f);
          }
        }
        return vvColorColors[vvColorNumber - 1];
      }

      vec4 vvGetColor(vec4 featureAttribute) {
        return interpolateVVColor(featureAttribute.y);
      }

      ${e.hasVvInstancing?T`
            vec4 vvColor() {
              return vvGetColor(instanceFeatureAttribute);
            }`:"vec4 vvColor() { return vec4(1.0); }"}
    `)):r.code.add(T`vec4 vvColor() { return vec4(1.0); }`)}const d8=.1,Fo=.001;function jOe(t){const e=new Or,r=t.signedDistanceFieldEnabled;if(e.include(xOe,t),e.include(Fn,t),t.occlusionPass)return e.include(Mut,t),e;const{vertex:i,fragment:n}=e;e.include(Wre),n.include(Td),n.include(xg),e.include(B0,t),e.include(Q3,t),e.include(BOe),e.varyings.add("vcolor","vec4"),e.varyings.add("vtc","vec2"),e.varyings.add("vsize","vec2"),e.varyings.add("voccluded","float"),i.uniforms.add(new xr("viewport",(c,u)=>u.camera.fullViewport),new ti("screenOffset",(c,u)=>cr(HOe,2*c.screenOffset[0]*u.camera.pixelRatio,2*c.screenOffset[1]*u.camera.pixelRatio)),new ti("anchorPosition",c=>j$(c)),new xr("materialColor",c=>c.color)),Y3(i),r&&(i.uniforms.add(new xr("outlineColor",c=>c.outlineColor)),n.uniforms.add(new xr("outlineColor",c=>xde(c)?c.outlineColor:qu),new $e("outlineSize",c=>xde(c)?c.outlineSize:0))),t.pixelSnappingEnabled&&i.include(CU),t.hasScreenSizePerspective&&(mut(i),SU(i)),t.debugDrawLabelBorder&&e.varyings.add("debugBorderCoords","vec4"),e.attributes.add(R.UV0,"vec2"),e.attributes.add(R.COLOR,"vec4"),e.attributes.add(R.SIZE,"vec2"),e.attributes.add(R.FEATUREATTRIBUTE,"vec4"),i.code.add(T`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      forwardObjectAndLayerIdColor();

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${t.hasScreenSizePerspective?T`
            inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
            vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:T`
            inputSize = size;
            vec2 screenOffsetScaled = screenOffset;`}

      ${t.vvSize?"inputSize *= vvScale(featureAttribute).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);
      bool visible = testHUDVisibility(posProj);
      voccluded = visible ? 0.0 : 1.0;
    `);const s=T`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPosition) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`,o=t.pixelSnappingEnabled?r?T`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:T`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:T`posProj += quadOffset;`;i.code.add(T`
    ${t.occlusionTestEnabled?"if (visible) {":""}
    ${s}
    ${t.vvColor?"vcolor = interpolateVVColor(featureAttribute.y) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

    ${t.output===U.ObjectAndLayerIdColor?T`vcolor.a = 1.0;`:""}

    bool alphaDiscard = vcolor.a < ${T.float(Fo)};
    ${r?`alphaDiscard = alphaDiscard && outlineColor.a < ${T.float(Fo)};`:""}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${o}
      gl_Position = posProj;
    }

    vtc = uv;

    ${t.debugDrawLabelBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":""}
    vsize = inputSize;
    ${t.occlusionTestEnabled?T`} else { vtc = vec2(0.0);
      ${t.debugDrawLabelBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
  }
  `),n.uniforms.add(new ct("tex",c=>c.texture));const a=t.debugDrawLabelBorder?T`(isBorder > 0.0 ? 0.0 : ${T.float(d8)})`:T.float(d8),l=T`
    ${t.debugDrawLabelBorder?T`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${t.sampleSignedDistanceFieldTexelCenter?T`
      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      float txSize = float(textureSize(tex, 0).x);
      float texelSize = 1.0 / txSize;

      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;
      `:T`
      vec2 samplePos = vtc;
      `}

    ${r?T`
      vec4 fillPixelColor = vcolor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${a} ||
          fillPixelColor.a + outlinePixelColor.a < ${T.float(Fo)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        fragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${a}) {
          discard;
        }

        fragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // fragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:T`
          vec4 texColor = texture(tex, vtc, -0.5);
          if (texColor.a < ${a}) {
            discard;
          }
          fragColor = texColor * premultiplyAlpha(vcolor);
          `}

    // Draw debug border with transparency, so that original texels along border are still partially visible
    ${t.debugDrawLabelBorder?T`fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`:""}
  `;switch(t.output){case U.Color:n.code.add(T`
        void main() {
          ${l}
          ${t.transparencyPassType===ft.FrontFace?"fragColor.rgb /= fragColor.a;":""}
        }`);break;case U.Alpha:n.code.add(T`
        void main() {
          ${l}
          fragColor = vec4(fragColor.a);
        }`);break;case U.ObjectAndLayerIdColor:n.code.add(T`
        void main() {
          ${l}
          outputObjectAndLayerIdColor();
        }`);break;case U.Highlight:n.constants.add("occludedHighlightFlag","vec4",VOe),n.constants.add("unoccludedHighlightFlag","vec4",Kre),n.code.add(T`
        void main() {
          ${l}
          if (voccluded == 1.0) {
            fragColor = occludedHighlightFlag;
          } else {
            fragColor = unoccludedHighlightFlag;
          }
        }`)}return e}function xde(t){return t.outlineColor[3]>0&&t.outlineSize>0}function j$(t,e=HOe){return t.textureIsSignedDistanceField?Out(t.anchorPosition,t.distanceFieldBoundingBox,e):eo(e,t.anchorPosition),e}function Out(t,e,r){e!=null?cr(r,t[0]*(e[2]-e[0])+e[0],t[1]*(e[3]-e[1])+e[1]):cr(r,0,0)}const HOe=He(),Rut=Object.freeze(Object.defineProperty({__proto__:null,build:jOe,calculateAnchorPosForRendering:j$},Symbol.toStringTag,{value:"Module"})),Zu=Wo(Se.SRC_ALPHA,Se.ONE,Se.ONE_MINUS_SRC_ALPHA,Se.ONE_MINUS_SRC_ALPHA),$ut=tu(Se.ONE,Se.ONE),WOe=tu(Se.ZERO,Se.ONE_MINUS_SRC_ALPHA);function Cy(t){return t===ft.FrontFace?null:t===ft.Alpha?WOe:$ut}function EU(t){return t===ft.FrontFace?ru:null}const PU=5e5,AU={factor:-1,units:-2};function MU(t){return t?AU:null}function Gv(t,e=Xr.LESS){return t===ft.NONE||t===ft.FrontFace?e:Xr.LEQUAL}let qOe=class YOe extends Vr{initializeConfiguration(e,r){r.spherical=e.viewingMode===De.Global}initializeProgram(e){return new Lr(e.rctx,YOe.shader.get().build(this.configuration),Mr)}initializePipeline(){const e=this.configuration.transparencyPassType,r=this.configuration,i=e===ft.NONE,n=e===ft.FrontFace,s=this.configuration.hasPolygonOffset?Iut:null,o=r.draped?null:(i||n)&&r.output!==U.Highlight&&(r.depthEnabled||r.occlusionPass)?ru:null;return kt({blending:r.output===U.Color||r.output===U.Alpha||r.output===U.Highlight?i?Lut:Cy(e):null,depthTest:r.draped?null:{func:Xr.LEQUAL},depthWrite:o,colorWrite:Yt,polygonOffset:s})}get primitiveType(){return this.configuration.occlusionPass?sr.POINTS:sr.TRIANGLES}};qOe.shader=new Ir(Rut,()=>ge(()=>Promise.resolve().then(()=>VNt),void 0));const Iut={factor:0,units:-4},Lut=tu(Se.ONE,Se.ONE_MINUS_SRC_ALPHA);let ts=class extends vl{constructor(){super(...arguments),this.output=U.Color,this.transparencyPassType=ft.NONE,this.screenCenterOffsetUnitsEnabled=!1,this.spherical=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.debugDrawLabelBorder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.depthEnabled=!0,this.pixelSnappingEnabled=!0,this.draped=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.occlusionPass=!1,this.objectAndLayerIdColorInstanced=!1}};d([j({count:U.COUNT})],ts.prototype,"output",void 0),d([j({count:ft.COUNT})],ts.prototype,"transparencyPassType",void 0),d([j()],ts.prototype,"screenCenterOffsetUnitsEnabled",void 0),d([j()],ts.prototype,"spherical",void 0),d([j()],ts.prototype,"occlusionTestEnabled",void 0),d([j()],ts.prototype,"signedDistanceFieldEnabled",void 0),d([j()],ts.prototype,"sampleSignedDistanceFieldTexelCenter",void 0),d([j()],ts.prototype,"vvSize",void 0),d([j()],ts.prototype,"vvColor",void 0),d([j()],ts.prototype,"hasVerticalOffset",void 0),d([j()],ts.prototype,"hasScreenSizePerspective",void 0),d([j()],ts.prototype,"debugDrawLabelBorder",void 0),d([j()],ts.prototype,"hasSlicePlane",void 0),d([j()],ts.prototype,"hasPolygonOffset",void 0),d([j()],ts.prototype,"depthEnabled",void 0),d([j()],ts.prototype,"pixelSnappingEnabled",void 0),d([j()],ts.prototype,"draped",void 0),d([j()],ts.prototype,"multipassEnabled",void 0),d([j()],ts.prototype,"cullAboveGround",void 0),d([j()],ts.prototype,"occlusionPass",void 0),d([j()],ts.prototype,"objectAndLayerIdColorInstanced",void 0),d([j({constValue:!0})],ts.prototype,"hasSliceInVertexProgram",void 0),d([j({constValue:!1})],ts.prototype,"hasVvInstancing",void 0);let p3=class extends Bv{constructor(e){super(e,new Hut),this._configuration=new ts,this.produces=new Map([[ue.HUD_MATERIAL,r=>iF(r)&&!this.parameters.drawInSecondSlot],[ue.LABEL_MATERIAL,r=>iF(r)&&this.parameters.drawInSecondSlot],[ue.OCCLUSION_PIXELS,()=>this.parameters.occlusionTest],[ue.DRAPED_MATERIAL,r=>iF(r)]])}getConfiguration(e,r){return this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen",this._configuration.hasPolygonOffset=this.parameters.polygonOffset,this._configuration.draped=this.parameters.draped,this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this._configuration.sampleSignedDistanceFieldTexelCenter=this.parameters.sampleSignedDistanceFieldTexelCenter,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.occlusionPass=r.slot===ue.OCCLUSION_PIXELS&&this.parameters.occlusionTest,e===U.Color&&(this._configuration.debugDrawLabelBorder=!!yi.LABELS_SHOW_BORDER),this._configuration.depthEnabled=this.parameters.depthEnabled,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.multipassEnabled=r.multipassEnabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}intersect(e,r,i,n,s,o){if(!(i.options.selectionMode&&i.options.hud&&e.visible&&i.point))return;const a=this.parameters,l=i.point,c=i.camera;let{scaleX:u,scaleY:h}=this._getScreenScale(e);u*=c.pixelRatio,h*=c.pixelRatio,th(M7,r),e.attributes.has(R.FEATUREATTRIBUTE)&&Fut(M7);const p=e.attributes.get(R.POSITION),f=e.attributes.get(R.SIZE),g=e.attributes.get(R.NORMAL),_=e.attributes.get(R.CENTEROFFSETANDDISTANCE);pt(p.size>=3);const v=j$(a),b=this.parameters.centerOffsetUnits==="screen";for(let w=0;w<p.data.length/p.size;w++){const x=w*p.size;ie(ma,p.data[x],p.data[x+1],p.data[x+2]),Ge(ma,ma,r);const S=w*f.size;t_[0]=f.data[S]*u,t_[1]=f.data[S+1]*h,Ge(ma,ma,c.viewMatrix);const E=w*_.size;if(ie(hu,_.data[E],_.data[E+1],_.data[E+2]),!b&&(ma[0]+=hu[0],ma[1]+=hu[1],hu[2]!==0)){const O=hu[2];pe(hu,ma),ye(ma,ma,ne(hu,hu,O))}const A=w*g.size;if(ie(JP,g.data[A],g.data[A+1],g.data[A+2]),this._normalAndViewAngle(JP,M7,c,O7),this._applyVerticalOffsetTransformationView(ma,O7,c,A7),c.applyProjection(ma,Ja),Ja[0]>-1){b&&(hu[0]||hu[1])&&(Ja[0]+=hu[0]*c.pixelRatio,hu[1]!==0&&(Ja[1]+=Gre(hu[1],A7.factorAlignment)*c.pixelRatio),c.unapplyProjection(Ja,ma)),Ja[0]+=this.parameters.screenOffset[0]*c.pixelRatio,Ja[1]+=this.parameters.screenOffset[1]*c.pixelRatio,Ja[0]=Math.floor(Ja[0]),Ja[1]=Math.floor(Ja[1]),hOe(t_,A7.factor,t_);const O=Vut*c.pixelRatio;let L=0;if(a.textureIsSignedDistanceField&&(L=a.outlineSize*c.pixelRatio/2),Tde(l,Ja[0],Ja[1],t_,O,L,a,v)){const z=i.ray;if(Ge(Sde,ma,os(zut,c.viewMatrix)),Ja[0]=l[0],Ja[1]=l[1],c.unprojectFromRenderScreen(Ja,ma)){const k=C();ce(k,z.direction);const q=1/Te(k);ne(k,k,q),o(Di(z.origin,ma)*q,k,-1,!0,1,Sde)}}}}}intersectDraped(e,r,i,n,s,o){const a=e.attributes.get(R.POSITION),l=e.attributes.get(R.SIZE),c=this.parameters,u=j$(c);let{scaleX:h,scaleY:p}=this._getScreenScale(e);h*=e.screenToWorldRatio,p*=e.screenToWorldRatio;const f=Gut*e.screenToWorldRatio;for(let g=0;g<a.data.length/a.size;g++){const _=g*a.size,v=a.data[_],b=a.data[_+1],w=g*l.size;t_[0]=l.data[w]*h,t_[1]=l.data[w+1]*p;let x=0;c.textureIsSignedDistanceField&&(x=c.outlineSize*e.screenToWorldRatio/2),Tde(n,v,b,t_,f,x,c,u)&&s(o.dist,o.normal,-1,!1)}}createBufferWriter(){return new qut(this)}_normalAndViewAngle(e,r,i,n){return tut(r)&&(r=th(kut,r)),Zs(n.normal,e,r),Ge(n.normal,n.normal,i.viewInverseTransposeMatrix),n.cosAngle=de(XOe,jut),n}_updateScaleInfo(e,r,i){const n=this.parameters;n.screenSizePerspective!=null?hde(i,r,n.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minScaleFactor=0),n.screenSizePerspectiveAlignment!=null?hde(i,r,n.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minScaleFactor=e.factor.minScaleFactor)}applyShaderOffsetsView(e,r,i,n,s,o,a){const l=this._normalAndViewAngle(r,i,s,O7);return this._applyVerticalGroundOffsetView(e,l,s,a),this._applyVerticalOffsetTransformationView(a,l,s,o),this._applyPolygonOffsetView(a,l,n[3],s,a),this._applyCenterOffsetView(a,n,a),a}applyShaderOffsetsNDC(e,r,i,n,s){return this._applyCenterOffsetNDC(e,r,i,n),s!=null&&ce(s,n),this._applyPolygonOffsetNDC(n,r,i,n),n}_applyPolygonOffsetView(e,r,i,n,s){const o=n.aboveGround?1:-1;let a=Math.sign(i);a===0&&(a=o);const l=o*a;if(this.parameters.shaderPolygonOffset<=0)return ce(s,e);const c=we(Math.abs(r.cosAngle),.01,1),u=1-Math.sqrt(1-c*c)/c/n.viewport[2];return ne(s,e,l>0?u:1/u),s}_applyVerticalGroundOffsetView(e,r,i,n){const s=Te(e),o=i.aboveGround?1:-1,a=i.computeRenderPixelSizeAtDist(s)*wOe,l=ne(ma,r.normal,o*a);return fe(n,e,l),n}_applyVerticalOffsetTransformationView(e,r,i,n){var c;const s=this.parameters;if(!((c=s.verticalOffset)!=null&&c.screenLength)){if(s.screenSizePerspective||s.screenSizePerspectiveAlignment){const u=Te(e);this._updateScaleInfo(n,u,r.cosAngle)}else n.factor.scale=1,n.factorAlignment.scale=1;return e}const o=Te(e),a=s.screenSizePerspectiveAlignment??s.screenSizePerspective,l=POe(i,o,s.verticalOffset,r.cosAngle,a);return this._updateScaleInfo(n,o,r.cosAngle),ne(r.normal,r.normal,l),fe(e,e,r.normal)}_applyCenterOffsetView(e,r,i){const n=this.parameters.centerOffsetUnits!=="screen";return i!==e&&ce(i,e),n&&(i[0]+=r[0],i[1]+=r[1],r[2]&&(pe(JP,i),fe(i,i,ne(JP,JP,r[2])))),i}_applyCenterOffsetNDC(e,r,i,n){const s=this.parameters.centerOffsetUnits!=="screen";return n!==e&&ce(n,e),s||(n[0]+=r[0]/i.fullWidth*2,n[1]+=r[1]/i.fullHeight*2),n}_applyPolygonOffsetNDC(e,r,i,n){const s=this.parameters.shaderPolygonOffset;if(e!==n&&ce(n,e),s){const o=i.aboveGround?1:-1,a=o*Math.sign(r[3]);n[2]-=(a||o)*s}return n}createGLMaterial(e){return new Dut(e)}calculateRelativeScreenBounds(e,r,i=Wt()){return Nut(this.parameters,e,r,i),i[2]=i[0]+e[0],i[3]=i[1]+e[1],i}_getScreenScale(e){const r=e.attributes.get(R.FEATUREATTRIBUTE);if(r==null)return{scaleX:1,scaleY:1};const i=Bee(r.data,But),[n,s]=Hre(Uut,this.parameters,i);return{scaleX:n,scaleY:s}}},Dut=class extends tre{constructor(e){super({...e,...e.material.parameters})}selectProgram(e){return this.ensureTechnique(qOe,e)}beginSlot(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.selectProgram(e)}};function Nut(t,e,r,i){i[0]=t.anchorPosition[0]*-e[0]+t.screenOffset[0]*r,i[1]=t.anchorPosition[1]*-e[1]+t.screenOffset[1]*r}function Fut(t){const e=t[0],r=t[1],i=t[2],n=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=1/Math.sqrt(e*e+r*r+i*i),h=1/Math.sqrt(n*n+s*s+o*o),p=1/Math.sqrt(a*a+l*l+c*c);return t[0]=e*u,t[1]=r*u,t[2]=i*u,t[3]=n*h,t[4]=s*h,t[5]=o*h,t[6]=a*p,t[7]=l*p,t[8]=c*p,t}function Tde(t,e,r,i,n,s,o,a){let l=e-n-(a[0]>0?i[0]*a[0]:0),c=l+i[0]+2*n,u=r-n-(a[1]>0?i[1]*a[1]:0),h=u+i[1]+2*n;const p=o.distanceFieldBoundingBox;return o.textureIsSignedDistanceField&&p!=null&&(l+=i[0]*p[0],u+=i[1]*p[1],c-=i[0]*(1-p[2]),h-=i[1]*(1-p[3]),l-=s,c+=s,u-=s,h+=s),t[0]>l&&t[0]<c&&t[1]>u&&t[1]<h}const A7=new ROe,ma=C(),JP=C(),Ja=Zt(),XOe=C(),Sde=C(),M7=li(),kut=li(),zut=xe(),hu=C(),Uut=C(),But=Zt(),O7={normal:XOe,cosAngle:0},Vut=1,Gut=2,t_=[0,0],jut=Ce(0,0,1);let Hut=class extends qPe{constructor(){super(...arguments),this.renderOccluded=kr.Occlude,this.isDecoration=!1,this.color=Bt(1,1,1,1),this.texCoordScale=[1,1],this.polygonOffset=!1,this.anchorPosition=lr(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.outlineColor=Bt(1,1,1,1),this.outlineSize=0,this.vvSizeEnabled=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.centerOffsetUnits="world",this.drawInSecondSlot=!1,this.depthEnabled=!0,this.draped=!1}};const ZOe=Qi().vec3f(R.POSITION).vec3f(R.NORMAL).vec2f(R.UV0).vec4u8(R.COLOR).vec2f(R.SIZE).vec4f(R.CENTEROFFSETANDDISTANCE).vec4f(R.FEATUREATTRIBUTE),Wut=ZOe.clone().vec4u8(R.OBJECTANDLAYERIDCOLOR);let qut=class{constructor(e){this._material=e,this.vertexBufferLayout=se("enable-feature:objectAndLayerId-rendering")?Wut:ZOe}elementCount(e){return 6*e.attributes.get(R.POSITION).indices.length}write(e,r,i,n,s){var b;Jre(i.attributes.get(R.POSITION),e,n.position,s,6),Qre(i.attributes.get(R.NORMAL),r,n.normal,s,6);const o=i.attributes.get(R.UV0).data;let a,l,c,u;if(o==null||o.length<4){const w=this._material.parameters;a=0,l=0,c=w.texCoordScale[0],u=w.texCoordScale[1]}else a=o[0],l=o[1],c=o[2],u=o[3];c=Math.min(1.99999,c+1),u=Math.min(1.99999,u+1);let h=i.attributes.get(R.POSITION).indices.length,p=s;const f=n.uv0;for(let w=0;w<h;++w)f.set(p,0,a),f.set(p,1,l),p++,f.set(p,0,c),f.set(p,1,l),p++,f.set(p,0,c),f.set(p,1,u),p++,f.set(p,0,c),f.set(p,1,u),p++,f.set(p,0,a),f.set(p,1,u),p++,f.set(p,0,a),f.set(p,1,l),p++;IOe(i.attributes.get(R.COLOR),4,n.color,s,6);const{data:g,indices:_}=i.attributes.get(R.SIZE);h=_.length;const v=n.size;p=s;for(let w=0;w<h;++w){const x=g[2*_[w]],S=g[2*_[w]+1];for(let E=0;E<6;++E)v.set(p,0,x),v.set(p,1,S),p++}if(i.attributes.get(R.CENTEROFFSETANDDISTANCE)?d3(i.attributes.get(R.CENTEROFFSETANDDISTANCE),n.centerOffsetAndDistance,s,6):wde(n.centerOffsetAndDistance,s,6*h),i.attributes.get(R.FEATUREATTRIBUTE)?d3(i.attributes.get(R.FEATUREATTRIBUTE),n.featureAttribute,s,6):wde(n.featureAttribute,s,6*h),i.objectAndLayerIdColor!=null){const w=(b=i.attributes.get(R.POSITION))==null?void 0:b.indices;if(w){const x=w.length,S=n.getField(R.OBJECTANDLAYERIDCOLOR,za);LOe(i.objectAndLayerIdColor,S,x,s,6)}}}};const Mf=C(),yT=Zt(),QP=Zt(),R7=C(),Yut=xe(),Xut=Jn(),$7=Js(),Zut=C(),Jut=Wt();class Qut{constructor(){this.aabr=Wt(),this.distance=0,this.culled=!1,this.visible=!1}}class Kut{constructor(e,r){this.graphics3DGraphic=e,this.slicePlaneEnabled=r,this.info={}}}var Sc;(function(t){t[t.Idle=0]="Idle",t[t.Process=1]="Process",t[t.Sort=2]="Sort",t[t.Deconflict=3]="Deconflict",t[t.NumStates=4]="NumStates"})(Sc||(Sc={}));class eht{constructor(){this.camera=new Qe,this.slicePlane=gy(),this.slicePlaneEnabled=!1}copyFrom(e){this.camera.copyFrom(e.camera),$2(e.slicePlane,this.slicePlane),this.slicePlaneEnabled=e.slicePlaneEnabled}}let pC=class extends Ae{get dirty(){return this._dirty}get state(){return this._state}constructor(t){super(t),this._dirty=!1,this._viewState=new eht,this._state=Sc.Idle,this._active=new Map,this._visible=new Map,this._iterators=new nht,this._accBinsNumX=15,this._accBinsNumY=20,this._accBinsSizeX=0,this._accBinsSizeY=0,this._accBins=null,this.accNumTests=0}destroy(){this._active.clear(),this._visible.clear(),this._iterators=null}setDirty(){!this._dirty&&this._active.size>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._state!==Sc.Idle||this._dirty}get updatingProgress(){if(!this.updating)return 1;const t=this._state/Sc.NumStates;return this._dirty?.5*t:t}get running(){return this.view.ready&&this.view.state!=null&&this.updating}runTask(t){switch(this._state){case Sc.Idle:this._startUpdate(),t.madeProgress();case Sc.Process:if(this._state=Sc.Process,!this._processActiveGraphics(t))return;case Sc.Sort:if(this._state=Sc.Sort,!this._sortVisibleGraphics(t))return;case Sc.Deconflict:if(this._state=Sc.Deconflict,!this._deconflictVisibleGraphics(t))return;default:jct(this,this._visible),this._state=Sc.Idle,this.notifyChange("updating")}}modifyGraphics(t,e){e?t.forEach(r=>this.addToActiveGraphics(r)):t.forEach(r=>this.removeFromActiveGraphics(r)),this.setDirty()}layerSupportsDeconfliction(t){if(t==null||t.type!=="object3d")return!1;const e=t.stageObject;if(((e==null?void 0:e.geometries.length)??0)!==1)return!1;const r=e==null?void 0:e.geometries[0];return(r==null?void 0:r.material)instanceof p3}_startUpdate(){Hct(this.view),this._dirty=!1,this._viewState.copyFrom(this.viewState);const{fullWidth:t,fullHeight:e}=this._viewState.camera;this._initBins(t,e),this._resetIterators()}addToActiveGraphics(t){t.info[this.visibilityGroup]=new Qut,this._active.set(t.graphics3DGraphic.graphic.uid,t),this.setDirty()}removeFromActiveGraphics(t){this._visible.delete(t.graphics3DGraphic.graphic.uid),tht(t,this.visibilityGroup),delete t.info[this.visibilityGroup],this._active.delete(t.graphics3DGraphic.graphic.uid),this.setDirty()}_processActiveGraphics(t){const e=this._ensureActiveGraphicsIterator(),r=R3(Yut,this._viewState.camera.projectionMatrix),i=this.view.viewingMode==="global"&&this.view.map.ground.opacity===1&&this._viewState.camera.relativeElevation>0?Xut:null;let n=0;for(i!=null&&(Ge(i,zn,this._viewState.camera.viewMatrix),i[3]=Br(this.view.spatialReference).radius,n=qSe(i,zn));!t.done;){t.madeProgress();const s=e.next();if(s.done===!0)return this._resetActiveGraphicsIterator(),!0;const o=s.value,a=o==null?void 0:o.info[this.visibilityGroup];a&&(this._collectGraphics3DGraphics(o,r,i,n),a.culled?this._visible.delete(o.graphics3DGraphic.graphic.uid):this._visible.set(o.graphics3DGraphic.graphic.uid,o))}return!1}_sortVisibleGraphics(t){const e=this._ensureSortGraphicsIterator();for(;!t.done;){const r=e.next();if(t.madeProgress(),r.done===!0)return this._resetSortGraphicsIterator(),!0}return!1}_deconflictVisibleGraphics(t){const e=this._ensureVisibleGraphicsIterator(),r=this.visibilityGroup===vo.LABEL;for(;!t.done;){t.madeProgress();const i=e.next();if(i.done===!0)return this._resetVisibleGraphicsIterator(),!0;const n=i.value,s=n.info[this.visibilityGroup];if(!s||s.culled){this._setGraphicVisibility(n,!1);continue}const o=n.graphics3DGraphic,a=!r||o.isVisible();s.visible=a&&!this._isConflicted(n),s.visible&&this._addToBins(n),this._setGraphicVisibility(n,s.visible),qct(s,s.visible)}return!1}_resetIterators(){this._iterators.active=null,this._iterators.visible=null,this._iterators.sort=null}_ensureActiveGraphicsIterator(){return this._iterators.active||(this._iterators.active=Cde(this._active)),this._iterators.active}_resetActiveGraphicsIterator(){this._iterators.active=null}_ensureVisibleGraphicsIterator(){return this._iterators.visible||(this._iterators.visible=Cde(this._visible)),this._iterators.visible}_resetVisibleGraphicsIterator(){this._iterators.visible=null}_ensureSortGraphicsIterator(){return this._iterators.sort||(this._iterators.sort=rht(this._visible,this._iterators.sortArray,this.visibilityGroup)),this._iterators.sort}_resetSortGraphicsIterator(){this._iterators.sort=null}_collectGraphics3DGraphics(t,e,r,i){const n=t.graphics3DGraphic;if(n.destroyed)return;const s=t.info[this.visibilityGroup];if(!n.isVisible(vo.GRAPHIC,sa.DECONFLICTION))return void(s.culled=!0);const o=this.getGraphicsLayers(n);Ku(s.aabr);let a=null;for(const l of o){if(!this.layerSupportsDeconfliction(l))continue;const c=l.stageObject.geometries[0].material;if(a==null&&(a=aht,this._getProjectionInfo(l,e,a),a.isOutsideScreen||this._isCulledBySlice(t,Mf)||r!=null&&this._isCulledByHorizon(a,r,i)))return void(s.culled=!0);this._expandBoundingRect(s,l,c,a)}a==null?s.culled=!0:(s.distance=a.distance,s.culled=!1)}_getProjectionInfo(t,e,r){const i=this._viewState.camera,n=t.stageObject,s=n.geometries[0],o=s.material,a=n.boundingVolumeWorldSpace.bounds;Ge(Mf,a,i.viewMatrix);const l=s.attributes,c=l.get(R.NORMAL).data,u=l.get(R.CENTEROFFSETANDDISTANCE).data;o.applyShaderOffsetsView(Mf,c,n.transformation,u,i,r.scaleInfo,Mf),nn(yT,Mf[0],Mf[1],Mf[2],1),jc(QP,yT,i.projectionMatrix),ne(r.positionNDC,QP,1/QP[3]),o.applyShaderOffsetsNDC(r.positionNDC,u,i,r.positionNDC,R7),r.distanceWithoutPolygonOffset=i.depthNDCToWorld(R7[2]),r.distance=R7[2]===r.positionNDC[2]?r.distanceWithoutPolygonOffset:i.depthNDCToWorld(r.positionNDC[2]),nn(QP,r.positionNDC[0],r.positionNDC[1],r.positionNDC[2],1),jc(yT,QP,e),s2(yT,yT,1/yT[3]),ie(r.positionView,Mf[0],Mf[1],Mf[2])}_isCulledByHorizon(t,e,r){return ce($7.direction,t.positionView),ie($7.origin,0,0,0),!!Dv(e,$7,Zut)&&t.distanceWithoutPolygonOffset>r}_isCulledBySlice(t,e){return t.slicePlaneEnabled&&this._viewState.slicePlaneEnabled&&ete(this._viewState.slicePlane,e)}_expandBoundingRect(t,e,r,{positionNDC:i,scaleInfo:n}){const s=this._viewState.camera,o=e.getScreenSize(sht);hOe(o,n.factor,o),o[0]*=s.pixelRatio,o[1]*=s.pixelRatio;const a=a6(r.calculateRelativeScreenBounds(o,n.factorAlignment.scale,Jut),Rt(0,s.fullWidth,.5+.5*i[0]),Rt(0,s.fullHeight,.5+.5*i[1])),l=this.marginFactor;if(l!==0){const c=l*Math.min($a(a),Jl(a));a[0]-=c,a[1]-=c,a[2]+=c,a[3]+=c}V1(t.aabr,a,t.aabr)}_isConflicted(t){const e=t.graphics3DGraphic.graphic.uid,r=t.info[this.visibilityGroup];let i=!0;for(let n=Math.floor(r.aabr[0]/this._accBinsSizeX);n<=Math.floor(r.aabr[2]/this._accBinsSizeX);n++)if(!(n<0||n>=this._accBinsNumX))for(let s=Math.floor(r.aabr[1]/this._accBinsSizeY);s<=Math.floor(r.aabr[3]/this._accBinsSizeY);s++){if(s<0||s>=this._accBinsNumY)continue;i=!1;const o=this._accBins[n][s];for(let a=0;a<o.length;a++){const l=o.data[a],c=l.info[this.visibilityGroup];if(c&&c.visible&&l.graphics3DGraphic.graphic.uid!==e&&(this.accNumTests++,c9(c.aabr,r.aabr)))return!0}}return i}_initBins(t,e){if(this._accBins==null){this._accBins=[];for(let r=0;r<this._accBinsNumX;r++){this._accBins.push([]);const i=this._accBins[this._accBins.length-1];for(let n=0;n<this._accBinsNumY;n++)i.push(new Vt)}}else for(let r=0;r<this._accBinsNumX;r++)for(let i=0;i<this._accBinsNumY;i++)this._accBins[r][i].clear();this._accBinsSizeX=t/this._accBinsNumX,this._accBinsSizeY=e/this._accBinsNumY,this.accNumTests=0}_addToBins(t){const e=t.info[this.visibilityGroup],r=Math.floor(e.aabr[0]/this._accBinsSizeX),i=Math.floor(e.aabr[2]/this._accBinsSizeX),n=Math.floor(e.aabr[1]/this._accBinsSizeY),s=Math.floor(e.aabr[3]/this._accBinsSizeY);for(let o=r;o<=i;o++)if(!(o<0||o>=this._accBinsNumX))for(let a=n;a<=s;a++)a<0||a>=this._accBinsNumY||this._accBins[o][a].push(t)}_setGraphicVisibility(t,e){const r=t.graphics3DGraphic;r.destroyed||(r.setVisibilityFlag(this.visibilityGroup,sa.DECONFLICTION,e),this.visibilityGroup===vo.LABEL&&this.view.labeler.setLabelGraphicVisibility(r,e))}};function tht(t,e){const r=t.graphics3DGraphic;r.destroyed||r.setVisibilityFlag(e,sa.DECONFLICTION,!0)}function*Cde(t){if(Map.prototype.entries){const e=t.entries();for(let r=e.next();!r.done;r=e.next())yield r.value[1]}else yield*t.values()}function*rht(t,e,r){e.clear(),t.forEach((n,s)=>{var l;const o=e.pushNew();o.id=s,o.visible=n.graphics3DGraphic.getVisibilityFlag(r,sa.DECONFLICTION);const a=(l=n.info)==null?void 0:l[r];o.prio=n.graphics3DGraphic.deconflictionPriority,o.distance=a?a.distance:Number.MAX_VALUE}),yield;const i=e.iterableSort((n,s)=>n.prio!==s.prio?s.prio-n.prio:n.distance!==s.distance?n.distance-s.distance:n.visible!==s.visible?n.visible?-1:1:n.id-s.id);for(let n=i.next();!n.done;n=i.next())yield;e.forAll(n=>{const s=t.get(n.id);s&&(t.delete(n.id),t.set(n.id,s))}),e.clear()}d([m({constructOnly:!0})],pC.prototype,"view",void 0),d([m({type:Boolean,readOnly:!0})],pC.prototype,"updating",null),pC=d([V("esri.views.3d.layers.graphics.Deconflictor")],pC);class iht{constructor(){this.id=0,this.visible=!1,this.prio=0,this.distance=0}}class nht{constructor(e=null,r=null,i=null){this.active=e,this.visible=r,this.sort=i,this.sortArray=new Vt({allocator:n=>n||new iht})}}const sht=He();class oht{constructor(){this.positionView=C(),this.positionNDC=C(),this.distance=0,this.distanceWithoutPolygonOffset=0,this.scaleInfo=new ROe}get isOutsideScreen(){const e=this.positionNDC;return e[0]<-1||e[1]<-1||e[2]<-1||e[0]>=1||e[1]>=1}}const aht=new oht,lht=2e3;let gF=class extends pC{constructor(e){super(e),this.visibilityGroup=vo.LABEL,this.marginFactor=.05,this._lastDeconfliction=0}get viewState(){return this.parent.viewState}runTask(e){if(this.parent.running)return Ho;const r=performance.now();if(e.state!==Ur.IDLE&&r-this._lastDeconfliction<lht)return Ho;super.runTask(e),this.state===Sc.Idle&&(this._lastDeconfliction=r)}enabledChanged(e,r){this.modifyGraphics(r,e.labelsEnabled)}getGraphicsLayers(e){return e.labelLayers}};d([m({constructOnly:!0})],gF.prototype,"parent",void 0),gF=d([V("esri.views.3d.layers.graphics.LabelDeconflictor")],gF);let OZ=class extends pC{constructor(){super(...arguments),this._contexts=new Map,this.visibilityGroup=vo.GRAPHIC,this._marginFactor=-.1}get labels(){return this._labels}get viewState(){return this._viewState}initialize(){this.addHandles([he(()=>{var e,r;return(r=(e=this.view)==null?void 0:e.state)==null?void 0:r.camera},()=>{this._updateViewState(),this.setDirty()}),he(()=>{var e,r,i;return(i=(r=(e=this.view)==null?void 0:e.map)==null?void 0:r.ground)==null?void 0:i.opacity},(e,r)=>{e!==1&&r!==1||this.setDirty()}),he(()=>{var e;return(e=this.view)==null?void 0:e.slicePlane},()=>{this._updateSlicePlane(),this._slicePlaneChanged()},gi)]),this._frameTask=this.view.resourceController.scheduler.registerTask(bt.GRAPHICS_DECONFLICTOR,this),this._labels=new gF({view:this.view,parent:this})}destroy(){this._labels=Pe(this._labels),this._frameTask=wi(this._frameTask)}get marginFactor(){return this._marginFactor}set marginFactor(e){this._marginFactor=e,this.setDirty()}setDirty(){this._contexts.size>0&&(super.setDirty(),this._labels.setDirty())}runTask(e){super.runTask(e),this.running||this._labels.setDirty()}setInitialIconVisibilityFlag(e,r){const i=!(this._graphicSupportsDeconfliction(r)&&I7(e));r.setVisibilityFlag(vo.GRAPHIC,sa.DECONFLICTION,i)}_updateViewState(){var e;(e=this.view)!=null&&e.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this._updateSlicePlane())}_updateSlicePlane(){const e=this.view?this.view.slicePlane:null;e!=null&&zSe(e,this._viewState.camera.viewMatrix,this._viewState.slicePlane),this._viewState.slicePlaneEnabled=e!=null}_slicePlaneChanged(){Zh(this._contexts,(e,r)=>r.symbolCreationContext.slicePlaneEnabled)&&this.setDirty()}addGraphicsOwner(e){const r=this._getGraphicsContext(e);return{addGraphic:i=>this._addGraphic(e,r,i),removeGraphic:i=>this._removeGraphic(r,i),labelingInfoChange:()=>this._labels.enabledChanged(e,r),featureReductionChange:()=>this.enabledChanged(e,r),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(e,r),clear:()=>r.forEach(i=>this._removeGraphic(r,i.graphics3DGraphic))}}removeGraphicsOwner(e){const r=this._contexts.get(e);r&&(r.forEach(i=>this._removeGraphic(r,i.graphics3DGraphic)),this._contexts.delete(e),this.setDirty())}_addGraphic(e,r,i){const n=i.graphic.uid,s=new Kut(i,e.symbolCreationContext.slicePlaneEnabled);r.set(n,s),I7(e)&&this.addToActiveGraphics(s),e.labelsEnabled&&this._labels.addToActiveGraphics(s)}_removeGraphic(e,r){const i=r.graphic.uid,n=e.get(i);n&&(this.removeFromActiveGraphics(n),this._labels.removeFromActiveGraphics(n),e.delete(i),this.setDirty())}enabledChanged(e,r){const i=I7(e);i||cht(e),this.modifyGraphics(r,i)}_slicePlaneEnabledChanged(e,r){const i=e.symbolCreationContext.slicePlaneEnabled;r.forEach(n=>n.slicePlaneEnabled=i),this.setDirty()}getGraphicsLayers(e){return e.layers}_graphicSupportsDeconfliction(e){if(e.isDraped)return!1;const r=e.layers;if(!(r!=null&&r.length))return!1;for(const i of r)if(this.layerSupportsDeconfliction(i))return!0;return!1}_getGraphicsContext(e){const r=this._contexts.get(e);if(r)return r;const i=new Map;return this._contexts.set(e,i),this.setDirty(),i}};function I7(t){const e=t.layer;return!(!(e!=null&&e.featureReduction)||e.featureReduction.type!=="selection")}function cht(t){const e=t.graphics3DGraphics;e&&e.forEach(r=>r.setVisibilityFlag(vo.GRAPHIC,sa.DECONFLICTION,!0))}OZ=d([V("esri.views.3d.layers.graphics.GraphicsDeconflictor")],OZ);function JOe(t){return"declaredClass"in t}function Ede(t){return"declaredClass"in t}function uht(t){return"declaredClass"in t}function hht(t,e){return t?uht(t)?t:new fv({layer:e,sourceLayer:e,visible:t.visible,symbol:_e(t.symbol),attributes:_e(t.attributes),geometry:QOe(t.geometry)}):null}function QOe(t){return t==null?null:JOe(t)?t:n2(dht(t))}function dht(t){const{wkid:e,wkt:r,wkt2:i,latestWkid:n}=t.spatialReference,s={wkid:e,wkt:r,wkt2:i,latestWkid:n};switch(t.type){case"point":{const{x:o,y:a,z:l,m:c}=t;return{x:o,y:a,z:l,m:c,spatialReference:s}}case"polygon":{const{rings:o,hasZ:a,hasM:l}=t;return{rings:Pde(o),hasZ:a,hasM:l,spatialReference:s}}case"polyline":{const{paths:o,hasZ:a,hasM:l}=t;return{paths:Pde(o),hasZ:a,hasM:l,spatialReference:s}}case"extent":{const{xmin:o,xmax:a,ymin:l,ymax:c,zmin:u,zmax:h,mmin:p,mmax:f,hasZ:g,hasM:_}=t;return{xmin:o,xmax:a,ymin:l,ymax:c,zmin:u,zmax:h,mmin:p,mmax:f,hasZ:g,hasM:_,spatialReference:s}}case"multipoint":{const{points:o,hasZ:a,hasM:l}=t;return{points:eRe(o)?KOe(o):o,hasZ:a,hasM:l,spatialReference:s}}default:return}}function Pde(t){return pht(t)?t.map(e=>KOe(e)):t}function KOe(t){return t.map(e=>Array.from(e))}function pht(t){for(const e of t)if(e.length!==0)return eRe(e);return!1}function eRe(t){return t.length>0&&(bI(t[0])||wI(t[0]))}function fht(t,e){if(!t)return null;let r;if(Ede(t)){if(e==null)return t.clone();if(Ede(e))return e.copy(t)}return e!=null?(r=e,r.x=t.x,r.y=t.y,r.spatialReference=t.spatialReference,t.hasZ?(r.z=t.z,r.hasZ=t.hasZ):(r.z=void 0,r.hasZ=!1),t.hasM?(r.m=t.m,r.hasM=!0):(r.m=void 0,r.hasM=!1)):(r=Nv(t.x,t.y,t.z,t.spatialReference),t.hasM&&(r.m=t.m,r.hasM=!0)),r}function iVt(t){const{wkid:e,wkt:r,wkt2:i,latestWkid:n}=t,s={wkid:e,wkt:r,wkt2:i,latestWkid:n};return lt.fromJSON(s)}const eie="__begin__",tie="__end__",mht=new RegExp(eie,"ig"),ght=new RegExp(tie,"ig"),Ade=new RegExp("^"+eie,"i"),Mde=new RegExp(tie+"$","i"),p8='"',yht=p8+" + ",_ht=" + "+p8;function vht(t){return t.replaceAll(new RegExp("\\[","g"),"{").replaceAll(new RegExp("\\]","g"),"}")}function nVt(t){return t.replaceAll(new RegExp("\\{","g"),"[").replaceAll(new RegExp("\\}","g"),"]")}function rie(t){const e={expression:"",type:"none"};return t.labelExpressionInfo?t.labelExpressionInfo.value?(e.expression=t.labelExpressionInfo.value,e.type="conventional"):t.labelExpressionInfo.expression&&(e.expression=t.labelExpressionInfo.expression,e.type="arcade"):t.labelExpression!=null&&(e.expression=vht(t.labelExpression),e.type="conventional"),e}function sVt(t){const e=rie(t);if(!e)return null;switch(e.type){case"conventional":return bht(e.expression);case"arcade":return e.expression}return null}function oVt(t){const e=rie(t);if(!e)return null;switch(e.type){case"conventional":return xht(e.expression);case"arcade":return tRe(e.expression)}return null}function bht(t){let e;return t?(e=SK(t,r=>eie+'$feature["'+r+'"]'+tie),e=Ade.test(e)?e.replace(Ade,""):p8+e,e=Mde.test(e)?e.replace(Mde,""):e+p8,e=e.replaceAll(mht,yht).replaceAll(ght,_ht)):e='""',e}const wht=/^\s*\{([^}]+)\}\s*$/i;function xht(t){const e=t==null?void 0:t.match(wht);return(e==null?void 0:e[1].trim())||null}const Tht=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*$/i,Sht=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,Cht=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])([\w\s]+)(\1)\s*\));?\s*$/i;function tRe(t){if(!t)return null;let e=Tht.exec(t)||Sht.exec(t);return e?e[1]||e[3]:(e=Cht.exec(t),e?e[2]:null)}const L7=()=>re.getLogger("esri.layers.support.labelFormatUtils"),D7={type:"simple",evaluate:()=>null},Eht={getAttribute:(t,e)=>t.field(e)};async function Pht(t,e,r){if(!t||!t.symbol||!e)return D7;const i=t.where,n=rie(t);let s;if(n.type==="arcade"){const o=await gKe(n.expression,r,e);if(o==null)return D7;s={type:"arcade",evaluate(a,l){try{const c="attributes"in a?o.repurposeFeature(a):a;c.contextTimeZone=l??null;const u=o.evaluate({$view:{timeZone:l},$feature:c},o.services);if(u!=null)return u.toString()}catch(c){L7().error(new K("arcade-expression-error","Encountered an error when evaluating label expression for feature",{error:c,feature:a,expression:n}))}return null},needsHydrationToEvaluate:()=>tRe(n.expression)==null}}else s={type:"simple",evaluate:o=>n.expression.replaceAll(/{[^}]*}/g,a=>{const l=a.slice(1,-1),c=e.get(l);if(!c)return a;let u=null;return"attributes"in o?o&&o.attributes&&(u=o.attributes[c.name]):u=o.field(c.name),u==null?"":Aht(u,c)})};if(i){let o;try{o=await CEe(i,e)}catch(l){return L7().error(new K("bad-where-clause","Encountered an error when evaluating where clause, ignoring",{where:i,error:l})),D7}const a=s.evaluate;s.evaluate=(l,c)=>{const u="attributes"in l?void 0:Eht;try{if(o.testFeature(l,u))return a(l,c)}catch(h){L7().error(new K("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:i,feature:l,error:h}))}return null}}return s}function Aht(t,e){if(t==null)return"";const r=e.domain;if(r){if(r.type==="codedValue"||r.type==="coded-value"){const n=t;for(const s of r.codedValues)if(s.code===n)return s.name}else if(r.type==="range"){const{max:n,min:s}=MEe(e),o=+t;if(s!=null&&n!=null&&s<=o&&o<=n)return r.name}}let i=t;return GKe(e)?i=v9(i,CWe("short-date")):zEe(e)&&(i=AWe(+i)),i||""}function rRe(t,e,r,i,n,s,o,a,l,c,u){const h=Nht[u.mode];let p,f,g=0;if(Ji(t,e,r,i,l.spatialReference,n,a))return h.requiresAlignment(u)?(g=h.applyElevationAlignmentBuffer(i,n,s,o,a,l,c,u),p=s,f=o):(p=i,f=n),Ji(p,l.spatialReference,f,s,c.spatialReference,o,a)?g:void 0}function Tv(t,e,r,i,n){const s=(P6(t)?t.z:YCe(t)?t.array[t.offset+2]:t[2])||0;switch(r.mode){case"on-the-ground":{const o=Lm(e,t,"ground")??0;return n.verticalDistanceToGround=0,n.sampledElevation=o,void(n.z=o)}case"relative-to-ground":{const o=Lm(e,t,"ground")??0,a=r.geometryZWithOffset(s,i);return n.verticalDistanceToGround=a,n.sampledElevation=o,void(n.z=a+o)}case"relative-to-scene":{const o=Lm(e,t,"scene")??0,a=r.geometryZWithOffset(s,i);return n.verticalDistanceToGround=a,n.sampledElevation=o,void(n.z=a+o)}case"absolute-height":{const o=r.geometryZWithOffset(s,i),a=Lm(e,t,"ground")??0;return n.verticalDistanceToGround=o-a,n.sampledElevation=a,void(n.z=o)}default:return void(n.z=0)}}function Mht(t,e,r,i){return Tv(t,e,r,i,fC),fC.z}function eL(t,e,r){return e==null||r==null?t.definedChanged:e==="on-the-ground"&&r==="on-the-ground"?t.staysOnTheGround:e===r||e!=="on-the-ground"&&r!=="on-the-ground"?En.UPDATE:t.onTheGroundChanged}function bd(t){return t==="relative-to-ground"||t==="relative-to-scene"}function Sv(t){return t!=="absolute-height"}function Oht(t,e,r,i,n){Tv(e,r,n,i,fC),iRe(t,fC.verticalDistanceToGround);const s=fC.sampledElevation,o=Zn(Fht,t.transformation);return _N[0]=e.x,_N[1]=e.y,_N[2]=fC.z,La(e.spatialReference,_N,o,i.spatialReference)?t.transformation=o:console.warn("Could not locate symbol object properly, it might be misplaced"),s}function iRe(t,e){for(let r=0;r<t.geometries.length;++r){const i=t.geometries[r].getMutableAttribute(R.CENTEROFFSETANDDISTANCE);i&&i.data[3]!==e&&(i.data[3]=e,t.geometryVertexAttributeUpdated(t.geometries[r],R.CENTEROFFSETANDDISTANCE))}}function Rht(t,e,r,i,n,s){let o=0;const a=s.spatialReference;e*=3,i*=3;for(let l=0;l<n;++l){const c=t[e],u=t[e+1],h=t[e+2],p=s.getElevation(c,u,h,a,"ground")??0;o+=p,r[i]=c,r[i+1]=u,r[i+2]=p,e+=3,i+=3}return o/n}function $ht(t,e,r,i,n,s,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),u=a.featureExpressionInfoContext,h=s.spatialReference;e*=3,i*=3;for(let p=0;p<n;++p){const f=t[e],g=t[e+1],_=t[e+2],v=s.getElevation(f,g,_,h,"ground")??0;l+=v,r[i]=f,r[i+1]=g,r[i+2]=u==null?_+v+c:v+c,e+=3,i+=3}return l/n}function Iht(t,e,r,i,n,s,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),u=a.featureExpressionInfoContext,h=s.spatialReference;e*=3,i*=3;for(let p=0;p<n;++p){const f=t[e],g=t[e+1],_=t[e+2],v=s.getElevation(f,g,_,h,"scene")??0;l+=v,r[i]=f,r[i+1]=g,r[i+2]=u==null?_+v+c:v+c,e+=3,i+=3}return l/n}function Lht(t){const e=t.meterUnitOffset,r=t.featureExpressionInfoContext;return e!==0||r!=null}function Dht(t,e,r,i,n,s,o,a){const l=a.calculateOffsetRenderUnits(o),c=a.featureExpressionInfoContext;e*=3,i*=3;for(let u=0;u<n;++u){const h=t[e],p=t[e+1],f=t[e+2];r[i]=h,r[i+1]=p,r[i+2]=c==null?f+l:l,e+=3,i+=3}return 0}let tL=class{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}};var En;(function(t){t[t.NONE=0]="NONE",t[t.UPDATE=1]="UPDATE",t[t.RECREATE=2]="RECREATE"})(En||(En={}));const Nht={"absolute-height":{applyElevationAlignmentBuffer:Dht,requiresAlignment:Lht},"on-the-ground":{applyElevationAlignmentBuffer:Rht,requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:$ht,requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:Iht,requiresAlignment:()=>!0}},Fht=xe(),fC=new tL,_N=C();function iie(t){return t.mapPositions!=null}function nRe(t,e,r,i,n){const s=t.stageObject,o=s.geometries;let a=0;for(const l of o){if(!iie(l))continue;const{update:c,averageGeometrySampledElevation:u}=oRe(l,e,r,i,n);a+=u,c&&s.geometryVertexAttributeUpdated(l,R.POSITION)}return a/o.length}function Lx(t,e,r,i,n,s){const o=t.stageObject,a=e.centerPointInElevationSR;let l=0;o.usesVerticalDistanceToGround?(i(a,Yl),iRe(o,Yl.verticalDistanceToGround),l=Yl.sampledElevation):(i(a,Yl),e.mode!=="absolute-height"&&(l=Yl.sampledElevation));const c=Zn(kht,s??o.transformation),u=ie(sRe,c[12],c[13],c[14]);yi.TESTS_DISABLE_OPTIMIZATIONS?(ql[0]=a.x,ql[1]=a.y,ql[2]=Yl.z,La(a.spatialReference,ql,c,n.spatialReference)&&(s?Zn(s,c):o.transformation=c)):n.setAltitudeOfTransformation(Yl.z,c);const h=nie/n.unitInMeters;return(Math.abs(c[12]-u[0])>=h||Math.abs(c[13]-u[1])>=h||Math.abs(c[14]-u[2])>=h)&&(s?Zn(s,c):o.transformation=c),l}const kht=xe();function zht(t,e,r,i,n){const s=t.graphics3DSymbolLayer.lodRenderer;if(s==null)return 0;const o=e.centerPointInElevationSR;i(o,Yl);const a=e.mode!=="absolute-height"?Yl.sampledElevation:0,l=s.instanceData,c=t.instanceIndex,u=Bht;l.getGlobalTransform(c,u);const h=ie(sRe,u[12],u[13],u[14]);yi.TESTS_DISABLE_OPTIMIZATIONS?(ql[0]=o.x,ql[1]=o.y,ql[2]=Yl.z,La(o.spatialReference,ql,u,n.spatialReference)&&l.setGlobalTransform(c,u)):n.setAltitudeOfTransformation(Yl.z,u);const p=nie/n.unitInMeters;return(yi.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(u[12]-h[0])>=p||Math.abs(u[13]-h[1])>=p||Math.abs(u[14]-h[2])>=p)&&l.setGlobalTransform(c,u),a}function Uht(t,e,r,i,n){const s=t.stageObject,o=s.geometries;if(o.length===0)return 0;let a=0,l=null,c=0,u=!1;for(const h of o){if(!iie(h))continue;const p=h.attributes.get(R.POSITION);if(p!==l){const{update:f,averageGeometrySampledElevation:g}=oRe(h,e,r,i,n);c=g,l=p,u=f}u&&s.geometryVertexAttributeUpdated(h,R.POSITION),a+=c}return a/o.length}const nie=.01,ql=C(),dh=C(),_T=C(),Bht=xe(),sRe=C(),Yl=new tL;function oRe(t,e,r,i,n){let s=!1;const o=t.transformation,a=e.requiresSampledElevationInfo;dh[0]=o[12],dh[1]=o[13],dh[2]=o[14],t.invalidateBoundingInfo();const l=t.getMutableAttribute(R.POSITION),c=l.data,u=l.size,h=c.length/u,p=new yte(t.mapPositions,r);let f=0,g=0;for(let _=0;_<h;_++){if(_T[0]=c[f],_T[1]=c[f+1],_T[2]=c[f+2],i(p,Yl),a&&(g+=Yl.sampledElevation),yi.TESTS_DISABLE_OPTIMIZATIONS)c[f]=p.array[p.offset],c[f+1]=p.array[p.offset+1],c[f+2]=Yl.z,Ji(c,r,f,c,n.spatialReference,f,1),c[f]-=dh[0],c[f+1]-=dh[1],c[f+2]-=dh[2],s=!0;else{ql[0]=c[f]+dh[0],ql[1]=c[f+1]+dh[1],ql[2]=c[f+2]+dh[2],n.setAltitude(ql,Yl.z),c[f]=ql[0]-dh[0],c[f+1]=ql[1]-dh[1],c[f+2]=ql[2]-dh[2];const v=nie/n.unitInMeters;(Math.abs(_T[0]-c[f])>=v||Math.abs(_T[1]-c[f+1])>=v||Math.abs(_T[2]-c[f+2])>=v)&&(s=!0)}f+=u,p.offset+=3}return g/=h,{update:s,averageGeometrySampledElevation:g}}function Vht(t){return!!t&&c3[t]!=null}function aRe(t){return 1/(c3[t]||1)}function Ght(){const t=Object.keys(c3);return t.sort(),t}const jht=Ght(),Hht=()=>re.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function Wht(t){return{cachedResult:t.cachedResult,arcade:t.arcade?{func:t.arcade.func,context:t.arcade.modules.arcadeUtils.createExecContext(null,{sr:t.arcade.context.spatialReference}),modules:t.arcade.modules}:null}}function lVt(t){const e=t==null?void 0:t.expression;if(typeof e=="string"){const r=uRe(e);if(r!=null)return{cachedResult:r}}return null}async function cVt(t,e,r,i){const n=t==null?void 0:t.expression;if(typeof n!="string")return null;const s=uRe(n);if(s!=null)return{cachedResult:s};const o=await Tte();vt(r);const a=o.arcadeUtils,l=a.createSyntaxTree(n);return a.dependsOnView(l)?(i!=null&&i.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:a.createFunction(l),context:a.createExecContext(null,{sr:e}),modules:o}}}function lRe(t,e,r){return t.arcadeUtils.createFeature(e.attributes,e.geometry,r)}function OU(t,e){if(t!=null&&!cRe(t)){if(!e||!t.arcade)return void Hht().errorOncePerTick("Arcade support required but not provided");const r=e;r._geometry&&(r._geometry=QOe(r._geometry)),t.arcade.modules.arcadeUtils.updateExecContext(t.arcade.context,e)}}function qht(t){if(t!=null){if(cRe(t))return t.cachedResult;const e=t.arcade;let r=e==null?void 0:e.modules.arcadeUtils.executeFunction(e.func,e.context);return typeof r!="number"&&(t.cachedResult=0,r=0),r}return 0}function uVt(t,e=!1){let r=t==null?void 0:t.featureExpressionInfo;const i=r==null?void 0:r.expression;return e||i==="0"||(r=null),r??null}const Yht={cachedResult:0};function cRe(t){return t.cachedResult!=null}function uRe(t){return t==="0"?0:null}let f8=class hRe{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(e){this._unit=e,this._metersPerElevationInfoUnit=aRe(e)}get requiresSampledElevationInfo(){return this.mode!=="absolute-height"}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(e){this._meterUnitOffset=e,this._renderUnitOffset=0}set offsetElevationInfoUnits(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(e){this._renderUnitOffset+=e}geometryZWithOffset(e,r){const i=this.calculateOffsetRenderUnits(r);return this.featureExpressionInfoContext!=null?i:e+i}calculateOffsetRenderUnits(e){let r=this._meterUnitOffset;const i=this.featureExpressionInfoContext;return i!=null&&(r+=qht(i)*this._metersPerElevationInfoUnit),r/e.unitInMeters+this._renderUnitOffset}setFromElevationInfo(e){this.mode=e.mode,this.unit=Vht(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=e.offset??0}updateFeatureExpressionInfoContext(e,r,i){if(e==null)return void(this._featureExpressionInfoContext=null);const n=e==null?void 0:e.arcade;n&&r!=null&&i!=null?(this._featureExpressionInfoContext=Wht(e),OU(this._featureExpressionInfoContext,lRe(n.modules,r,i))):this._featureExpressionInfoContext=e}static fromElevationInfo(e){const r=new hRe;return e!=null&&r.setFromElevationInfo(e),r}},Xht=class{constructor(e,r,i){this.graphic=e,this.renderingInfo=r,this.layer=i}};function sie(t,e){if(t.type==="point")return r_(t,e,!1);if(JOe(t))switch(t.type){case"extent":return r_(t.center,e,!1);case"polygon":return r_(t.centroid,e,!1);case"polyline":return r_(Ode(t),e,!0);case"mesh":return r_(t.origin,e,!1)}else switch(t.type){case"extent":return r_(Zht(t),e,!0);case"polygon":return r_(Jht(t),e,!0);case"polyline":return r_(Ode(t),e,!0)}}function Ode(t){const e=t.paths[0];if(!e||e.length===0)return null;const r=Qxe(e,Jxe(e)/2);return Nv(r[0],r[1],r[2],t.spatialReference)}function Zht(t){return Nv(.5*(t.xmax+t.xmin),.5*(t.ymax+t.ymin),t.zmin!=null&&t.zmax!=null&&isFinite(t.zmin)&&isFinite(t.zmax)?.5*(t.zmax+t.zmin):void 0,t.spatialReference)}function Jht(t){const e=t.rings[0];if(!e||e.length===0)return null;const r=e2e(t.rings,!!t.hasZ);return Nv(r[0],r[1],r[2],t.spatialReference)}function r_(t,e,r){const i=r?t:fht(t);return e&&t?JTe(t,i,e)?i:null:i}function dVt(t,e,r,i=0){if(t){e||(e=Wt());const n=t;let s=.5*n.width*(r-1),o=.5*n.height*(r-1);return n.width<1e-7*n.height?s+=o/20:n.height<1e-7*n.width&&(o+=s/20),nn(e,n.xmin-s-i,n.ymin-o-i,n.xmax+s+i,n.ymax+o+i),e}return null}function pR(t,e,r=null){const i=NI(qh);return t!=null&&(i[0]=t[0],i[1]=t[1],i[2]=t[2]),e!=null?i[3]=e:t!=null&&t.length>3&&(i[3]=t[3]),r&&(i[0]*=r,i[1]*=r,i[2]*=r,i[3]*=r),i}function pVt(t,e,r,i,n,s=[0,0,0,0]){for(let o=0;o<3;++o)s[o]=(t==null?void 0:t[o])!=null?t[o]:(r==null?void 0:r[o])!=null?r[o]:n[o];return s[3]=e??i??n[3],s}function Rde(t=Im,e,r,i=1){const n=new Array(3);if(e==null||r==null)n[0]=1,n[1]=1,n[2]=1;else{let s,o=0;for(let a=2;a>=0;a--){const l=t[a];let c;const u=l!=null,h=a===0&&!s&&!u,p=r[a];l==="symbol-value"||h?c=p!==0?e[a]/p:1:u&&l!=="proportional"&&isFinite(l)&&(c=p!==0?l/p:1),c!=null&&(n[a]=c,s=c,o=Math.max(o,Math.abs(c)))}for(let a=2;a>=0;a--)n[a]==null?n[a]=s:n[a]===0&&(n[a]=.001*o)}for(let s=2;s>=0;s--)n[s]/=i;return Ea(n)}function Qht(t){return t.isPrimitive!=null}function RU(t){return RZ(Qht(t)?[t.width,t.depth,t.height]:t)?null:"Symbol sizes may not be negative values"}function RZ(t){const e=r=>r==null||r>=0;return Array.isArray(t)?t.every(e):e(t)}function Kht(t,e,r,i=xe()){return t&&DE(i,i,-t/180*Math.PI),e&&LE(i,i,e/180*Math.PI),r&&Kz(i,i,r/180*Math.PI),i}function oie(t,e,r){if(r.minDemResolution!=null)return r.minDemResolution;const i=Ba(e),n=N2(t)*i,s=F2(t)*i,o=kv(t)*(e.isGeographic?1:i);return n===0&&s===0&&o===0?r.minDemResolutionForPoints:.01*Math.max(n,s,o)}var Xt;(function(t){t[t.INVISIBLE=0]="INVISIBLE",t[t.TRANSPARENT=1]="TRANSPARENT",t[t.OPAQUE=2]="OPAQUE"})(Xt||(Xt={}));let edt=class{constructor(e,r,i){this.baseMaterial=e,this.edgeMaterials=r,this.properties=i}},Tg=class{get isElevationSource(){return!!this.stageObject.lastValidElevationBB}constructor(e,r,i,n,s,o,a,l=null){this.graphics3DSymbolLayer=e,this.stageObject=r,this._uniqueGeometries=i,this._uniqueMaterials=n,this._sharedResource=s,this.elevationAligner=o,this.elevationContext=a,this._edgeState=l,this.type="object3d",this._stageLayer=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1}initialize(e){this._stageLayer=e;const r=e.stage;r.addMany(this._uniqueMaterials),r.addMany(this._uniqueGeometries),r.add(this.stageObject)}destroy(){var r,i;if(!this._stageLayer)return;const e=this._stageLayer.stage;e.removeMany(this._uniqueMaterials),e.removeMany(this._uniqueGeometries),e.remove(this.stageObject),this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1),(r=e.renderer.edgeView)==null||r.removeObject(this.stageObject),this.stageObject.dispose(),(i=this._sharedResource)==null||i.release(),this._visible=!1,this._stageLayer=null}layerOpacityChanged(e,r){if(this._edgeState==null)return;const i=$de(this._edgeState.baseMaterial);let n=!1;for(const s of this._edgeState.edgeMaterials)s.objectTransparency!==i&&(s.objectTransparency=i,n=!0);n&&this.resetEdgeObject(r),this._stageLayer.stage.renderer.ensureEdgeView().updateAllComponentOpacities(this.stageObject,[e])}slicePlaneEnabledChanged(e,r){this._edgeState!=null&&(this._stageLayer.stage.renderer.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{hasSlicePlane:e},!r),this._edgeState.properties.hasSlicePlane=e)}setVisibility(e){if(this._stageLayer!=null&&this._visible!==e&&(this._visible=e,this.stageObject.visible=e,this._visible&&!this._addedToStage&&(this._stageLayer.add(this.stageObject),this._addedToStage=!0),this._edgeState)){const r=this._stageLayer.stage.renderer.ensureEdgeView();r.hasObject(this.stageObject)?r.updateObjectVisibility(this.stageObject,e):e&&this._addOrUpdateEdgeObject(r,!1)}}get visible(){return this._visible}alignWithElevation(e,r,i,n){if(this.elevationAligner==null)return;i!=null&&OU(this.elevationContext.featureExpressionInfoContext,i);const s=(o,a)=>Tv(o,e,this.elevationContext,r,a);this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,e.spatialReference,s,r),this.resetEdgeObject(n)}alignWithAbsoluteElevation(e,r,i){const n=(s,o)=>{o.sampledElevation=e,o.verticalDistanceToGround=0,o.z=e};this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,null,n,r),this.resetEdgeObject(i)}getCenterObjectSpace(e=C()){return ce(e,this.stageObject.boundingVolumeObjectSpace.bounds)}getBoundingBoxObjectSpace(e=vs()){const r=this.stageObject.boundingVolumeObjectSpace;return o3e(e,r.min),a3e(e,r.max),e}computeAttachmentOrigin(e){const r=this.stageObject.effectiveTransformation;if(this.useObjectOriginAsAttachmentOrigin)e.render.origin[0]+=r[12],e.render.origin[1]+=r[13],e.render.origin[2]+=r[14],e.render.num++;else for(const i of this.stageObject.geometries)i.computeAttachmentOrigin(Ig)&&(Ge(Ig,Ig,r),fe(e.render.origin,e.render.origin,Ig),e.render.num++)}async getProjectedBoundingBox(e,r,i,n,s){const o=this.getBoundingBoxObjectSpace(s),a=tdt,l=Ite(o)?1:a.length;for(let u=0;u<l;u++){const h=a[u];i_[0]=o[h[0]],i_[1]=o[h[1]],i_[2]=o[h[2]],Ge(i_,i_,this.stageObject.transformation),db[3*u]=i_[0],db[3*u+1]=i_[1],db[3*u+2]=i_[2]}if(!e(db,0,l))return null;Li(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let u=0;u<3*l;u+=3){for(let h=0;h<3;h++)o[h]=Math.min(o[h],db[u+h]),o[h+3]=Math.max(o[h+3],db[u+h]);c&&i.push({location:db.slice(u,u+3),screenSpaceBoundingRect:c})}if(r!=null&&r.service&&this.elevationContext.mode!=="absolute-height"){kp(o,Ig);const u=this.elevationContext.mode==="relative-to-scene"?"scene":"ground";let h=0;if(r.useViewElevation)h=r.service.getElevation(Ig[0],Ig[1],u)??0;else try{const p=oie(o,r.service.spatialReference,r);h=await r.service.queryElevation(Ig[0],Ig[1],n,p,u)??0}catch{}s3e(o,0,0,-this.alignedSampledElevation+h)}return o}addObjectState(e,r){e===oy.Highlight&&r.addObject(this.stageObject,this.stageObject.highlight()),e===oy.MaskOccludee&&r.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(e){e.removeObject(this.stageObject)}resetEdgeObject(e){if(this._edgeState==null)return;const r=this._stageLayer.stage.renderer.ensureEdgeView();this._visible?this._addOrUpdateEdgeObject(r,e):r.removeObject(this.stageObject)}_addOrUpdateEdgeObject(e,r){const i=this._edgeState;if(i==null)return;const n=$de(i.baseMaterial);for(const s of i.edgeMaterials)s.objectTransparency=n;e.addOrUpdateObject3D(this.stageObject,i.edgeMaterials,i.properties,!r).then(()=>{var s;return(s=this._stageLayer)==null?void 0:s.sync()})}};function $de(t){return t.isVisible()?t.parameters.transparent?Xt.TRANSPARENT:Xt.OPAQUE:Xt.INVISIBLE}const db=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],i_=C(),Ig=C(),tdt=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];let dRe=class{constructor(e,r=null){this.labelText=r,this.elevationOffset=e??0}};const pRe=3,$Z=3,fRe=10;let mRe=class{constructor(e,r=null){this.geometry=e,this.textures=r}},gRe=class{constructor(e,r,i){this.components=e,this.minScreenSpaceRadius=r,this.pivotOffset=i;const n=this.geometries;this.numVertices=n.reduce((s,o)=>s+o.attributes.get(R.POSITION).indices.length,0)}get geometries(){return Pz(this.components.map(e=>e.geometry))}},yRe=class{constructor(e){this.levels=e,this.levels.sort((r,i)=>r.minScreenSpaceRadius===i.minScreenSpaceRadius?r.numVertices-i.numVertices:r.minScreenSpaceRadius-i.minScreenSpaceRadius)}};function vN(t){const e=[];return t.levels.forEach(r=>r.components.forEach(i=>e.push(i.geometry.material))),Pz(e)}function Ide(t){const e=new Array;return t.levels.forEach(r=>r.components.forEach(i=>{i.textures!=null&&e.push(...i.textures)})),Pz(e)}function Lde(t){const e=new Array;return t.levels.forEach(r=>r.components.forEach(i=>e.push(i.geometry))),Pz(e)}function rdt(t){switch(t){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}function _Re(t,e){const r=(i,n,s=!1)=>new yRe(i.map(o=>{const a=n(o.tesselation);return s&&kst(a),new gRe([new mRe(a)],o.minScreenSpaceRadius)}));switch(t){case"sphere":return r([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],i=>Dst(e,.5,i,!0));case"cube":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>Est(e,1));case"cone":return r(N7,i=>Kue(e,1,.5,i,!1),!0);case"inverted-cone":return r(N7,i=>Kue(e,1,.5,i,!0),!0);case"cylinder":return r(N7,i=>Fst(e,1,.5,i,[0,0,1],[0,0,.5]));case"tetrahedron":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>Lst(e,1),!0);case"diamond":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>Ost(e,1),!0);default:return}}const N7=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];let Fh=class{constructor(e){this.estimated=!1,this.verticesPerFeature=e.verticesPerFeature??0,this.verticesPerCoordinate=e.verticesPerCoordinate??0,this.drawCallsPerFeature=e.drawCallsPerFeature??0,this.memory=e.memory??new vRe}},aie=class extends Fh{constructor(e){super(e),this.estimated=!0}},idt=class extends Fh{constructor(e,r){super(r),this.numComplexities=e}},ndt=class extends aie{constructor(e,r){super(r),this.numComplexities=e}},vRe=class{constructor(){this.bytesPerFeature=0,this.bytesPerFeatureLabel=0,this.resourceBytes=0,this.draped={bytesPerFeature:0,bytesPerFeatureLabel:0}}};function sdt(t){return t.type==="fill"}function odt(t){return t.type==="extrude"}function adt(t){return t&&t.enabled&&(odt(t)||sdt(t))&&t.edges!=null}function ldt(t){return t&&t.enabled&&t.edges||null}function bRe(t,e){return cdt(ldt(t),e)}function cdt(t,e){if(t==null)return null;const r=t.color!=null?Bee(Xe.toUnitRGBA(t.color)):Bt(0,0,0,0),i=fs(t.size),n=fs(t.extensionLength);switch(t.type){case"solid":return udt({color:r,size:i,extensionLength:n,...e});case"sketch":return hdt({color:r,size:i,extensionLength:n,...e});default:return}}function udt(t){return{...ddt,...t,type:"solid"}}function hdt(t){return{...pdt,...t,type:"sketch"}}const ddt={color:Bt(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:Xt.OPAQUE,hasSlicePlane:!1},pdt={color:Bt(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:Xt.OPAQUE,hasSlicePlane:!1};function K3(t,e){switch(e.normalType){case $r.Compressed:t.attributes.add(R.NORMALCOMPRESSED,"vec2"),t.vertex.code.add(T`vec3 decompressNormal(vec2 normal) {
float z = 1.0 - abs(normal.x) - abs(normal.y);
return vec3(normal + sign(normal) * min(z, 0.0), z);
}
vec3 normalModel() {
return decompressNormal(normalCompressed);
}`);break;case $r.Attribute:t.attributes.add(R.NORMAL,"vec3"),t.vertex.code.add(T`vec3 normalModel() {
return normal;
}`);break;case $r.ScreenDerivative:t.fragment.code.add(T`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`);break;default:e.normalType;case $r.COUNT:case $r.Ground:}}var $r;(function(t){t[t.Attribute=0]="Attribute",t[t.Compressed=1]="Compressed",t[t.Ground=2]="Ground",t[t.ScreenDerivative=3]="ScreenDerivative",t[t.COUNT=4]="COUNT"})($r||($r={}));function wRe(t,e){const r=t.fragment;switch(r.code.add(T`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`),e.doubleSidedMode){case gn.None:r.code.add(T`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`);break;case gn.View:r.code.add(T`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`);break;case gn.WindingOrder:r.code.add(T`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`);break;default:e.doubleSidedMode;case gn.COUNT:}}var gn;(function(t){t[t.None=0]="None",t[t.View=1]="View",t[t.WindingOrder=2]="WindingOrder",t[t.COUNT=3]="COUNT"})(gn||(gn={}));let eP=class{constructor(e){this.vertexBufferLayout=e}elementCount(e){return e.attributes.get(R.POSITION).indices.length}write(e,r,i,n,s){DOe(i,this.vertexBufferLayout,e,r,n,s)}};function $U(t,e){switch(e.normalType){case $r.Attribute:case $r.Compressed:t.include(K3,e),t.varyings.add("vNormalWorld","vec3"),t.varyings.add("vNormalView","vec3"),t.vertex.uniforms.add(new W6("transformNormalGlobalFromModel",r=>r.transformNormalGlobalFromModel),new sh("transformNormalViewFromGlobal",r=>r.transformNormalViewFromGlobal)),t.vertex.code.add(T`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`);break;case $r.Ground:t.include(eE,e),t.varyings.add("vNormalWorld","vec3"),t.vertex.code.add(T`
        void forwardNormal() {
          vNormalWorld = ${e.spherical?T`normalize(vPositionWorldCameraRelative);`:T`vec3(0.0, 0.0, 1.0);`}
        }
        `);break;case $r.ScreenDerivative:t.vertex.code.add(T`void forwardNormal() {}`);break;default:e.normalType;case $r.COUNT:}}let xRe=class extends $Ae{constructor(){super(...arguments),this.transformNormalViewFromGlobal=li()}},TRe=class extends IAe{constructor(){super(...arguments),this.transformNormalGlobalFromModel=li(),this.toMapSpace=Zt()}};const lie={func:Xr.LESS},m8={func:Xr.ALWAYS},pg={mask:255},SRe={mask:0},fdt=t=>({function:{func:Xr.NOTEQUAL,ref:t,mask:t},operation:{fail:cn.KEEP,zFail:cn.KEEP,zPass:cn.KEEP}}),mdt=t=>({function:{func:Xr.ALWAYS,ref:t,mask:t},operation:{fail:cn.KEEP,zFail:cn.KEEP,zPass:cn.REPLACE}}),jv={function:{func:Xr.ALWAYS,ref:tc.OutlineVisualElementMask,mask:tc.OutlineVisualElementMask},operation:{fail:cn.KEEP,zFail:cn.KEEP,zPass:cn.ZERO}},Cv={function:{func:Xr.ALWAYS,ref:tc.OutlineVisualElementMask,mask:tc.OutlineVisualElementMask},operation:{fail:cn.KEEP,zFail:cn.KEEP,zPass:cn.REPLACE}},CRe={function:{func:Xr.EQUAL,ref:tc.OutlineVisualElementMask,mask:tc.OutlineVisualElementMask},operation:{fail:cn.KEEP,zFail:cn.KEEP,zPass:cn.KEEP}},ERe={function:{func:Xr.NOTEQUAL,ref:tc.OutlineVisualElementMask,mask:tc.OutlineVisualElementMask},operation:{fail:cn.KEEP,zFail:cn.KEEP,zPass:cn.KEEP}};function PRe({normalTexture:t,metallicRoughnessTexture:e,metallicFactor:r,roughnessFactor:i,emissiveTexture:n,emissiveFactor:s,occlusionTexture:o}){return t==null&&e==null&&n==null&&(s==null||zo(s,zn))&&o==null&&(i==null||i===1)&&(r==null||r===1)}function AVt({normalTexture:t,metallicRoughnessTexture:e,metallicFactor:r,roughnessFactor:i,emissiveTexture:n,emissiveFactor:s,occlusionTexture:o}){return t==null&&e==null&&n==null&&(s==null||zo(s,zn))&&o==null&&(i==null||i===1)&&(r==null||r===1||r===0)}const IU=[1,1,.5],cie=[0,.6,.2],gdt=[0,1,.2];function ARe(t){t.vertex.code.add(T`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)}var Ns;function ydt(t){switch(t){case"multiply":default:return Ns.Multiply;case"ignore":return Ns.Ignore;case"replace":return Ns.Replace;case"tint":return Ns.Tint}}function MRe(t,e,r){if(t==null||e===Ns.Ignore)return r[0]=255,r[1]=255,r[2]=255,void(r[3]=255);const i=we(Math.round(t[3]*g8),0,g8),n=i===0||e===Ns.Tint?0:e===Ns.Replace?_dt:vdt;r[0]=we(Math.round(t[0]*vT),0,vT),r[1]=we(Math.round(t[1]*vT),0,vT),r[2]=we(Math.round(t[2]*vT),0,vT),r[3]=i+n}(function(t){t[t.Multiply=1]="Multiply",t[t.Ignore=2]="Ignore",t[t.Replace=3]="Replace",t[t.Tint=4]="Tint"})(Ns||(Ns={}));const vT=255,g8=85,_dt=g8,vdt=2*g8;function ORe(t){t.vertex.code.add(T`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${T.int(Ns.Multiply)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${T.int(Ns.Replace)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${T.int(Ns.Tint)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${T.int(Ns.Multiply)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)}let rL=class extends vn{constructor(e,r){super(e,"int",Rr.Pass,(i,n,s)=>i.setUniform1i(e,r(n,s)))}};function RRe(t,e){e.hasSymbolColors?(t.include(ORe),t.attributes.add(R.SYMBOLCOLOR,"vec4"),t.varyings.add("colorMixMode","mediump float"),t.vertex.code.add(T`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`)):(t.fragment.uniforms.add(new rL("colorMixMode",r=>MOe[r.colorMixMode])),t.vertex.code.add(T`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`))}function H2(t,e){e.hasVertexColors?(t.attributes.add(R.COLOR,"vec4"),t.varyings.add("vColor","vec4"),t.vertex.code.add(T`void forwardVertexColor() { vColor = color; }`),t.vertex.code.add(T`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):t.vertex.code.add(T`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}function $Re(t){t.code.add(T`const float MAX_RGBA4_FLOAT =
15.0 / 16.0 +
15.0 / 16.0 / 16.0 +
15.0 / 16.0 / 16.0 / 16.0 +
15.0 / 16.0 / 16.0 / 16.0 / 16.0;
const vec4 FIXED_POINT_FACTORS_RGBA4 = vec4(1.0, 16.0, 16.0 * 16.0, 16.0 * 16.0 * 16.0);
vec4 floatToRgba4(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA4_FLOAT);
vec4 fixedPointU4 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS_RGBA4) * 16.0);
const float toU4AsFloat = 1.0 / 15.0;
return fixedPointU4 * toU4AsFloat;
}
const vec4 RGBA4_2_FLOAT_FACTORS = vec4(
15.0 / (16.0),
15.0 / (16.0 * 16.0),
15.0 / (16.0 * 16.0 * 16.0),
15.0 / (16.0 * 16.0 * 16.0 * 16.0)
);
float rgba4ToFloat(vec4 rgba) {
return dot(rgba, RGBA4_2_FLOAT_FACTORS);
}`)}function ly(t,e){switch(e.output){case U.Shadow:case U.ShadowHighlight:case U.ShadowExcludeHighlight:t.fragment.include($Re),t.fragment.code.add(T`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 20.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
return depth + SLOPE_SCALE * m + BIAS;
}
void outputDepth(float _linearDepth) {
fragColor = floatToRgba4(_calculateFragDepth(_linearDepth));
}`);break;case U.LinearDepth:t.fragment.include(Td),t.fragment.code.add(T`void outputDepth(float _linearDepth) {
fragColor = float2rgba(_linearDepth);
}`)}}function bdt(t){t.fragment.code.add(T`
    #define discardOrAdjustAlpha(color) { if (color.a < ${T.float(Fo)}) { discard; } }
  `)}let Dx=class extends vn{constructor(e,r){super(e,"float",Rr.Draw,(i,n,s)=>i.setUniform1f(e,r(n,s)))}};function Nx(t,e){IRe(t,e,new $e("textureAlphaCutoff",r=>r.textureAlphaCutoff))}function wdt(t,e){IRe(t,e,new Dx("textureAlphaCutoff",r=>r.textureAlphaCutoff))}function IRe(t,e,r){const i=t.fragment;switch(e.alphaDiscardMode!==fi.Mask&&e.alphaDiscardMode!==fi.MaskBlend||i.uniforms.add(r),e.alphaDiscardMode){case fi.Blend:return t.include(bdt);case fi.Opaque:i.code.add(T`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case fi.Mask:i.code.add(T`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case fi.MaskBlend:t.fragment.code.add(T`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}}function LRe(t,e){const{vertex:r,fragment:i}=t,n=e.hasColorTexture&&e.alphaDiscardMode!==fi.Opaque;switch(e.output){case U.LinearDepth:case U.Shadow:case U.ShadowHighlight:case U.ShadowExcludeHighlight:case U.ObjectAndLayerIdColor:Zc(r,e),t.include(Kl,e),t.include(qm,e),t.include(B0,e),t.include(ly,e),t.include(Fn,e),t.include(Q3,e),f2(t),t.varyings.add("depth","float"),n&&i.uniforms.add(new ct("tex",s=>s.texture)),r.code.add(T`void main(void) {
vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
forwardTextureCoordinates();
forwardObjectAndLayerIdColor();
}`),t.include(Nx,e),i.code.add(T`
          void main(void) {
            discardBySlice(vpos);
            ${n?T`
                    vec4 texColor = texture(tex, ${e.hasColorTextureTransform?T`colorUV`:T`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            ${e.output===U.ObjectAndLayerIdColor?T`outputObjectAndLayerIdColor();`:T`outputDepth(depth);`}
          }
        `);break;case U.Normal:{Zc(r,e),t.include(Kl,e),t.include(K3,e),t.include($U,e),t.include(qm,e),t.include(B0,e),n&&i.uniforms.add(new ct("tex",o=>o.texture)),e.normalType===$r.ScreenDerivative&&t.varyings.add("vPositionView","vec3");const s=e.normalType===$r.Attribute||e.normalType===$r.Compressed;r.code.add(T`
          void main(void) {
            vpos = getVertexInLocalOriginSpace();

            ${s?T`vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));`:T`
                  // Get vertex position in camera space for screen-space derivative normals
                  vPositionView = (view * vec4(vpos, 1.0)).xyz;
                `}
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            forwardTextureCoordinates();
          }
        `),t.include(Fn,e),t.include(Nx,e),i.code.add(T`
          void main() {
            discardBySlice(vpos);
            ${n?T`
                    vec4 texColor = texture(tex, ${e.hasColorTextureTransform?T`colorUV`:T`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}

            ${e.normalType===$r.ScreenDerivative?T`vec3 normal = screenDerivativeNormal(vPositionView);`:T`
                  vec3 normal = normalize(vNormalWorld);
                  if (gl_FrontFacing == false){
                    normal = -normal;
                  }`}
            fragColor = vec4(0.5 + 0.5 * normal, 1.0);
          }
        `);break}case U.Highlight:Zc(r,e),t.include(Kl,e),t.include(qm,e),t.include(B0,e),n&&i.uniforms.add(new ct("tex",s=>s.texture)),r.code.add(T`void main(void) {
vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPosition(proj, view, vpos);
forwardTextureCoordinates();
}`),t.include(Fn,e),t.include(Nx,e),t.include(Vv,e),i.code.add(T`
          void main() {
            discardBySlice(vpos);
            ${n?T`
                    vec4 texColor = texture(tex, ${e.hasColorTextureTransform?T`colorUV`:T`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            outputHighlight();
          }
        `)}}function DRe(t,e){const r=t.fragment;e.hasVertexTangents?(t.attributes.add(R.TANGENT,"vec4"),t.varyings.add("vTangent","vec4"),e.doubleSidedMode===gn.WindingOrder?r.code.add(T`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):r.code.add(T`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):r.code.add(T`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`),e.textureCoordinateType!==on.None&&(t.include(ere,e),r.uniforms.add(e.pbrTextureBindType===Rr.Pass?new ct("normalTexture",i=>i.textureNormal):new id("normalTexture",i=>i.textureNormal)),e.hasNormalTextureTransform&&(r.uniforms.add(new ti("scale",i=>i.scale??E9)),r.uniforms.add(new sh("normalTextureTransformMatrix",i=>i.normalTextureTransformMatrix??O2))),r.code.add(T`vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
vec3 rawNormal = textureLookup(normalTexture, uv).rgb * 2.0 - 1.0;`),e.hasNormalTextureTransform&&r.code.add(T`mat3 normalTextureRotation = mat3(normalTextureTransformMatrix[0][0]/scale[0], normalTextureTransformMatrix[0][1]/scale[1], 0.0,
normalTextureTransformMatrix[1][0]/scale[0], normalTextureTransformMatrix[1][1]/scale[1], 0.0,
0.0, 0.0, 0.0 );
rawNormal.xy = (normalTextureRotation * vec3(rawNormal.x, rawNormal.y, 1.0)).xy;`),r.code.add(T`return tangentSpace * rawNormal;
}`))}const NRe=3e5,yF=5e5;let FRe=class extends vn{constructor(e,r){super(e,"vec2",Rr.Draw,(i,n,s,o)=>i.setUniform2fv(e,r(n,s,o)))}};const F7=4;function kRe(){const t=new Or,e=t.fragment;t.include(Ga);const r=(F7+1)/2,i=1/(2*r*r);return e.include(wPe),e.uniforms.add(new ct("depthMap",n=>n.depthTexture),new id("tex",n=>n.colorTexture),new FRe("blurSize",n=>n.blurSize),new $e("projScale",(n,s)=>{const o=Di(s.camera.eye,s.camera.center);return o>5e4?Math.max(0,n.projScale-(o-5e4)):n.projScale}),new ti("nearFar",(n,s)=>s.camera.nearFar)),e.code.add(T`
    void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
      float c = texture(tex, uv).r;
      float d = linearDepthFromTexture(depthMap, uv, nearFar);

      float ddiff = d - center_d;

      float w = exp(-r * r * ${T.float(i)} - ddiff * ddiff * sharpness);
      wTotal += w;
      bTotal += w * c;
    }
  `),t.outputs.add("fragBlur","float"),e.code.add(T`
    void main(void) {
      float b = 0.0;
      float w_total = 0.0;

      float center_d = linearDepthFromTexture(depthMap, uv, nearFar);

      float sharpness = -0.05 * projScale / center_d;
      for (int r = -${T.int(F7)}; r <= ${T.int(F7)}; ++r) {
        float rf = float(r);
        vec2 uvOffset = uv + rf * blurSize;
        blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
      }

      fragBlur = b / w_total;
    }
  `),t}const xdt=Object.freeze(Object.defineProperty({__proto__:null,build:kRe},Symbol.toStringTag,{value:"Module"}));let zRe=class URe extends Vr{initializeProgram(e){return new Lr(e.rctx,URe.shader.get().build(),Mr)}initializePipeline(){return kt({colorWrite:Yt})}};zRe.shader=new Ir(xdt,()=>ge(()=>Promise.resolve().then(()=>GNt),void 0));const Tdt="eXKEvZaUc66cjIKElE1jlJ6MjJ6Ufkl+jn2fcXp5jBx7c6KEflSGiXuXeW6OWs+tfqZ2Yot2Y7Zzfo2BhniEj3xoiXuXj4eGZpqEaHKDWjSMe7palFlzc3BziYOGlFVzg6Zzg7CUY5JrjFF7eYJ4jIKEcyyEonSXe7qUfqZ7j3xofqZ2c4R5lFZ5Y0WUbppoe1l2cIh2ezyUho+BcHN2cG6DbpqJhqp2e1GcezhrdldzjFGUcyxjc3aRjDyEc1h7Sl17c6aMjH92pb6Mjpd4dnqBjMOEhqZleIOBYzB7gYx+fnqGjJuEkWlwnCx7fGl+c4hjfGyRe5qMlNOMfnqGhIWHc6OMi4GDc6aMfqZuc6aMzqJzlKZ+lJ6Me3qRfoFue0WUhoR5UraEa6qMkXiPjMOMlJOGe7JrUqKMjK6MeYRzdod+Sl17boiPc6qEeYBlcIh2c1WEe7GDiWCDa0WMjEmMdod+Y0WcdntzhmN8WjyMjKJjiXtzgYxYaGd+a89zlEV7e2GJfnd+lF1rcK5zc4p5cHuBhL6EcXp5eYB7fnh8iX6HjIKEeaxuiYOGc66RfG2Ja5hzjlGMjEmMe9OEgXuPfHyGhPeEdl6JY02McGuMfnqGhFiMa3WJfnx2l4hwcG1uhmN8c0WMc39og1GBbrCEjE2EZY+JcIh2cIuGhIWHe0mEhIVrc09+gY5+eYBlnCyMhGCDl3drfmmMgX15aGd+gYx+fnuRfnhzY1SMsluJfnd+hm98WtNrcIuGh4SEj0qPdkqOjFF7jNNjdnqBgaqUjMt7boeBhnZ4jDR7c5pze4GGjEFrhLqMjHyMc0mUhKZze4WEa117kWlwbpqJjHZ2eX2Bc09zeId+e0V7WlF7jHJ2l72BfId8l3eBgXyBe897jGl7c66cgW+Xc76EjKNbgaSEjGx4fId8jFFjgZB8cG6DhlFziZhrcIh2fH6HgUqBgXiPY8dahGFzjEmMhEFre2dxhoBzc5SGfleGe6alc7aUeYBlhKqUdlp+cH5za4OEczxza0Gcc4J2jHZ5iXuXjH2Jh5yRjH2JcFx+hImBjH+MpddCl3dreZeJjIt8ZW18bm1zjoSEeIOBlF9oh3N7hlqBY4+UeYFwhLJjeYFwaGd+gUqBYxiEYot2fqZ2ondzhL6EYyiEY02Ea0VjgZB8doaGjHxoc66cjEGEiXuXiXWMiZhreHx8frGMe75rY02Ec5pzfnhzlEp4a3VzjM+EhFFza3mUY7Zza1V5e2iMfGyRcziEhDyEkXZ2Y4OBnCx7g5t2eyBjgV6EhEFrcIh2dod+c4Z+nJ5zjm15jEmUeYxijJp7nL6clIpjhoR5WrZraGd+fnuRa6pzlIiMg6ZzfHx5foh+eX1ufnB5eX1ufnB5aJt7UqKMjIh+e3aBfm5lbYSBhGFze6J4c39oc0mUc4Z+e0V7fKFVe0WEdoaGY02Ec4Z+Y02EZYWBfH6HgU1+gY5+hIWUgW+XjJ57ebWRhFVScHuBfJ6PhBx7WqJzlM+Ujpd4gHZziX6HjHmEgZN+lJt5boiPe2GJgX+GjIGJgHZzeaxufnB5hF2JtdN7jJ57hp57hK6ElFVzg6ZzbmiEbndzhIWHe3uJfoFue3qRhJd2j3xoc65zlE1jc3p8lE1jhniEgXJ7e657vZaUc3qBh52BhIF4aHKDa9drgY5+c52GWqZzbpqJe8tjnM+UhIeMfo2BfGl+hG1zSmmMjKJjZVaGgX15c1lze0mEp4OHa3mUhIWHhDyclJ6MeYOJkXiPc0VzhFiMlKaEboSJa5Jze41re3qRhn+HZYWBe0mEc4p5fnORbox5lEp4hGFjhGGEjJuEc1WEhLZjeHeGa7KlfHx2hLaMeX1ugY5+hIWHhKGPjMN7c1WEho1zhoBzZYx7fnhzlJt5exyUhFFziXtzfmmMa6qMYyiEiXxweV12kZSMeWqXSl17fnhzxmmMrVGEe1mcc4p5eHeGjK6MgY5+doaGa6pzlGV7g1qBh4KHkXiPeW6OaKqafqZ2eXZ5e1V7jGd7boSJc3BzhJd2e0mcYot2h1RoY8dahK6EQmWEWjx7e1l2lL6UgXyBdnR4eU9zc0VreX1umqaBhld7fo2Bc6KEc5Z+hDyEcIeBWtNrfHyGe5qMhMuMe5qMhEGEbVVupcNzg3aHhIF4boeBe0mEdlptc39ofFl5Y8uUlJOGiYt2UmGEcyxjjGx4jFF7a657ZYWBnElzhp57iXtrgZN+tfOEhIOBjE2HgU1+e8tjjKNbiWCDhE15gUqBgYN7fnqGc66ce9d7iYSBj0qPcG6DnGGcT3eGa6qMZY+JlIiMl4hwc3aRdnqBlGV7eHJ2hLZjfnuRhDyEeX6MSk17g6Z+c6aUjHmEhIF4gXyBc76EZW18fGl+fkl+jCxrhoVwhDyUhIqGlL2DlI6EhJd2tdN7eYORhEGMa2Faa6pzc3Bzc4R5lIRznM+UY9eMhDycc5Z+c4p5c4iGY117pb6MgXuPrbJafnx2eYOJeXZ5e657hDyEcziElKZjfoB5eHeGj4WRhGGEe6KGeX1utTStc76EhFGJnCyMa5hzfH6HnNeceYB7hmN8gYuMhIVrczSMgYF8h3N7c5pza5hzjJqEYIRdgYuMlL2DeYRzhGGEeX1uhLaEc4iGeZ1zdl6JhrVteX6Me2iMfm5lWqJzSpqEa6pzdnmchHx2c6OMhNdrhoR5g3aHczxzeW52gV6Ejm15frGMc0Vzc4Z+l3drfniJe+9rWq5rlF1rhGGEhoVwe9OEfoh+e7pac09+c3qBY0lrhDycdnp2lJ6MiYOGhGCDc3aRlL2DlJt5doaGdnp2gYF8gWeOjF2Uc4R5c5Z+jEmMe7KEc4mEeYJ4dmyBe0mcgXiPbqJ7eYB7fmGGiYSJjICGlF1reZ2PnElzbpqJfH6Hc39oe4WEc5eJhK6EhqyJc3qBgZB8c09+hEmEaHKDhFGJc5SGiXWMUpaEa89zc6OMnCyMiXtrho+Be5qMc7KEjJ57dmN+hKGPjICGbmiEe7prdod+hGCDdnmchBx7eX6MkXZ2hGGEa657hm98jFFjY5JreYOJgY2EjHZ2a295Y3FajJ6Mc1J+YzB7e4WBjF2Uc4R5eV12gYxzg1qBeId+c9OUc5pzjFFjgY5+hFiMlIaPhoR5lIpjjIKBlNdSe7KEeX2BfrGMhIqGc65zjE2UhK6EklZ+QmWEeziMWqZza3VzdnR4foh+gYF8n3iJiZhrnKp7gYF8eId+lJ6Me1lrcIuGjKJjhmN8c66MjFF7a6prjJ6UnJ5zezyUfruRWlF7nI5zfHyGe657h4SEe8tjhBx7jFFjc09+c39ojICMeZeJeXt+YzRzjHZ2c0WEcIeBeXZ5onSXkVR+gYJ+eYFwdldzgYF7eX2BjJ6UiXuXlE1jh4SEe1mchLJjc4Z+hqZ7eXZ5bm1zlL6Ue5p7iWeGhKqUY5pzjKJjcIeBe8t7gXyBYIRdlEp4a3mGnK6EfmmMZpqEfFl5gYxzjKZuhGFjhoKGhHx2fnx2eXuMe3aBiWeGvbKMe6KGa5hzYzB7gZOBlGV7hmN8hqZlYot2Y117a6pzc6KEfId8foB5rctrfneJfJ6PcHN2hFiMc5pzjH92c0VzgY2EcElzdmCBlFVzg1GBc65zY4OBboeBcHiBeYJ4ewxzfHx5lIRzlEmEnLKEbk1zfJ6PhmN8eYBljBiEnMOEiXxwezyUcIeBe76EdsKEeX2BdnR4jGWUrXWMjGd7fkl+j4WRlEGMa5Jzho+BhDyEfnqMeXt+g3aHlE1jczClhNN7ZW18eHx8hGFjZW18iXWMjKJjhH57gYuMcIuGWjyMe4ZtjJuExmmMj4WRdntzi4GDhFFzYIRdnGGcjJp7Y0F7e4WEkbCGiX57fnSHa657a6prhBCMe3Z+SmmMjH92eHJ2hK6EY1FzexhrvbKMnI5za4OEfnd+eXuMhImBe897hLaMjN+EfG+BeIOBhF1+eZeJi4GDkXZ2eXKEgZ6Ejpd4c2GHa1V5e5KUfqZuhCx7jKp7lLZrg11+hHx2hFWUoot2nI5zgbh5mo9zvZaUe3qRbqKMfqZ2kbCGhFiM";let Sdt=class extends Ai{constructor(){super(...arguments),this.projScale=1}},Cdt=class extends Sdt{constructor(){super(...arguments),this.intensity=1}},Edt=class extends Ai{},Pdt=class extends Edt{constructor(){super(...arguments),this.blurSize=He()}};function LU(t){t.fragment.uniforms.add(new xr("projInfo",(e,r)=>Adt(r.camera))),t.fragment.uniforms.add(new ti("zScale",(e,r)=>Mdt(r.camera))),t.fragment.code.add(T`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}function Adt(t){const e=t.projectionMatrix;return e[11]===0?nn(Dde,2/(t.fullWidth*e[0]),2/(t.fullHeight*e[5]),(1+e[12])/e[0],(1+e[13])/e[5]):nn(Dde,-2/(t.fullWidth*e[0]),-2/(t.fullHeight*e[5]),(1-e[8])/e[0],(1-e[9])/e[5])}const Dde=Zt();function Mdt(t){return t.projectionMatrix[11]===0?cr(Nde,0,1):cr(Nde,1,0)}const Nde=He(),Fde=16;function BRe(){const t=new Or,e=t.fragment;return t.include(Ga),t.include(LU),e.include(wPe),e.uniforms.add(new $e("radius",(r,i)=>DU(i.camera))),e.code.add(T`vec3 sphere[16] = vec3[16](
vec3(0.186937, 0.0, 0.0),
vec3(0.700542, 0.0, 0.0),
vec3(-0.864858, -0.481795, -0.111713),
vec3(-0.624773, 0.102853, -0.730153),
vec3(-0.387172, 0.260319, 0.007229),
vec3(-0.222367, -0.642631, -0.707697),
vec3(-0.01336, -0.014956, 0.169662),
vec3(0.122575, 0.1544, -0.456944),
vec3(-0.177141, 0.85997, -0.42346),
vec3(-0.131631, 0.814545, 0.524355),
vec3(-0.779469, 0.007991, 0.624833),
vec3(0.308092, 0.209288,0.35969),
vec3(0.359331, -0.184533, -0.377458),
vec3(0.192633, -0.482999, -0.065284),
vec3(0.233538, 0.293706, -0.055139),
vec3(0.417709, -0.386701, 0.442449)
);
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn - bias, 0.0);
}`),e.code.add(T`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`),e.uniforms.add(new ti("nearFar",(r,i)=>i.camera.nearFar),new ct("normalMap",r=>r.normalTexture),new ct("depthMap",r=>r.depthTexture),new $e("projScale",r=>r.projScale),new ct("rnm",r=>r.noiseTexture),new ti("rnmScale",(r,i)=>cr(kde,i.camera.fullWidth/r.noiseTexture.descriptor.width,i.camera.fullHeight/r.noiseTexture.descriptor.height)),new $e("intensity",r=>r.intensity),new ti("screenSize",(r,i)=>cr(kde,i.camera.fullWidth,i.camera.fullHeight))),t.outputs.add("fragOcclusion","float"),e.code.add(T`
    void main(void) {
      float currentPixelDepth = linearDepthFromTexture(depthMap, uv, nearFar);

      if (-currentPixelDepth > nearFar.y || -currentPixelDepth < nearFar.x) {
        fragOcclusion = 1.0;
        return;
      }

      // get the normal of current fragment
      vec4 norm4 = texture(normalMap, uv);
      if(norm4.a != 1.0) {
        fragOcclusion = 1.0;
        return;
      }
      vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;

      vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy, currentPixelDepth);

      float sum = 0.0;
      vec3 tapPixelPos;

      vec3 fres = normalize(2.0 * texture(rnm, uv * rnmScale).xyz - 1.0);

      // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
      // bug or deviation from CE somewhere else?
      float ps = projScale / (2.0 * currentPixelPos.z * zScale.x + zScale.y);

      for(int i = 0; i < ${T.int(Fde)}; ++i) {
        vec2 unitOffset = reflect(sphere[i], fres).xy;
        vec2 offset = vec2(-unitOffset * radius * ps);

        // don't use current or very nearby samples
        if( abs(offset.x) < 2.0 || abs(offset.y) < 2.0){
          continue;
        }

        vec2 tc = vec2(gl_FragCoord.xy + offset);
        if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenSize.x || tc.y > screenSize.y) continue;
        vec2 tcTap = tc / screenSize;
        float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap, nearFar);

        tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

        sum += aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
      }

      // output the result
      float A = max(1.0 - sum * intensity / float(${T.int(Fde)}), 0.0);

      // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4) / 2.2
      A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;

      fragOcclusion = A;
    }
  `),t}function DU(t){return Math.max(10,20*t.computeScreenPixelSizeAtDist(Math.abs(4*t.relativeElevation)))}const kde=He(),Odt=Object.freeze(Object.defineProperty({__proto__:null,build:BRe,getRadius:DU},Symbol.toStringTag,{value:"Module"}));let VRe=class GRe extends Vr{initializeProgram(e){return new Lr(e.rctx,GRe.shader.get().build(),Mr)}initializePipeline(){return kt({colorWrite:Yt})}};VRe.shader=new Ir(Odt,()=>ge(()=>Promise.resolve().then(()=>jNt),void 0));const IM=2;let LM=class extends V2{constructor(e){super(e),this._context=null,this._passParameters=new Cdt,this._drawParameters=new Pdt,this.produces=new Map([[ue.SSAO,()=>this._produces()]])}_getCameraElevation(){var e;return((e=this._context)==null?void 0:e.renderContext.bindParameters.camera.relativeElevation)??1/0}_produces(){return this._enableTime!=null&&this._context!=null&&this._getCameraElevation()<yF}consumes(){return this._produces()?aot:mU}initializeRenderContext(e){this._context=e,this.addHandles([he(()=>{var r;return this.view.qualitySettings.ambientOcclusion||((r=this._context)==null?void 0:r.isFeatureEnabled(Rs.SSAO))},r=>r?this._enable():this._disable(),Kr)])}uninitializeRenderContext(){this._disable(),this._context=null}_disable(){this._passParameters.noiseTexture=gt(this._passParameters.noiseTexture),this._enableTime=null}destroy(){this._disable()}_enable(){var i;if(this._enableTime!=null||!this._context)return;const e=Uint8Array.from(atob(Tdt),n=>n.charCodeAt(0)),r=new ri;r.wrapMode=Jt.CLAMP_TO_EDGE,r.pixelFormat=Tt.RGB,r.wrapMode=Jt.REPEAT,r.hasMipmap=!0,r.width=32,r.height=32,this._passParameters.noiseTexture=new Sr(this._context.renderContext.rctx,r,e),this._ssaoTechnique==null&&(this._ssaoTechnique=this._context.techniqueRepository.acquire(VRe)),this._blurTechnique==null&&(this._blurTechnique=this._context.techniqueRepository.acquire(zRe)),this._enableTime=0,(i=this._context)==null||i.requestRender()}renderNode(e,r,i){const n=e.bindParameters,s=i==null?void 0:i.get("normals"),o=s==null?void 0:s.getTexture(),a=s==null?void 0:s.getTexture(n3);if(this._enableTime==null||this._context==null||!o||!a)return;if(!this._ssaoTechnique.compiled||!this._blurTechnique.compiled)return this._enableTime=e.time,void this._context.requestRender();this._enableTime===0&&(this._enableTime=e.time);const l=e.rctx,c=n.camera,u=this.view.qualitySettings.fadeDuration,h=c.relativeElevation,p=we((yF-h)/(yF-NRe),0,1),f=u>0?Math.min(u,e.time-this._enableTime)/u:1,g=f*p;this._passParameters.normalTexture=o,this._passParameters.depthTexture=a,this._passParameters.projScale=1/c.computeScreenPixelSizeAtDist(1),this._passParameters.intensity=4*Rdt/DU(c)**6*g;const _=c.fullViewport[2],v=c.fullViewport[3],b=Math.round(_/IM),w=Math.round(v/IM),x=this._context.fbos,S=x.acquire(_,v,"ssao input",qi.RG);l.unbindTexture(S.fbo.colorTexture),l.bindFramebuffer(S.fbo),l.setViewport(0,0,_,v),l.bindTechnique(this._ssaoTechnique,n,this._passParameters,this._drawParameters),l.screen.draw();const E=x.acquire(b,w,"ssao blur",qi.RED);l.unbindTexture(E.fbo.colorTexture),l.bindFramebuffer(E.fbo),this._drawParameters.colorTexture=S.getTexture(),cr(this._drawParameters.blurSize,0,IM/v),l.bindTechnique(this._blurTechnique,n,this._passParameters,this._drawParameters),l.setViewport(0,0,b,w),l.screen.draw(),S.release();const A=x.acquire(b,w,"ssao",qi.RED);return l.unbindTexture(A.fbo.colorTexture),l.bindFramebuffer(A.fbo),l.setViewport(0,0,_,v),l.setClearColor(1,1,1,0),l.clear(Ci.COLOR_BUFFER_BIT),this._drawParameters.colorTexture=E.getTexture(),cr(this._drawParameters.blurSize,IM/_,0),l.bindTechnique(this._blurTechnique,n,this._passParameters,this._drawParameters),l.setViewport(0,0,b,w),l.screen.draw(),l.setViewport4fv(c.fullViewport),E.release(),f<1&&this._context.requestRender(),A}};d([m({constructOnly:!0})],LM.prototype,"view",void 0),d([m()],LM.prototype,"_context",void 0),LM=d([V("esri.views.3d.webgl-engine.effects.ssao.SSAO")],LM);const Rdt=.5;function iL(t,e){const r=t.fragment;e.receiveAmbientOcclusion?(r.uniforms.add(new ct("ssaoTex",(i,n)=>{var s;return(s=n.ssao)==null?void 0:s.getTexture()})),r.constants.add("blurSizePixelsInverse","float",1/IM),r.code.add(T`float evaluateAmbientOcclusionInverse() {
vec2 ssaoTextureSizeInverse = 1.0 / vec2(textureSize(ssaoTex, 0));
return texture(ssaoTex, gl_FragCoord.xy * blurSizePixelsInverse * ssaoTextureSizeInverse).r;
}
float evaluateAmbientOcclusion() {
return 1.0 - evaluateAmbientOcclusionInverse();
}`)):r.code.add(T`float evaluateAmbientOcclusionInverse() { return 1.0; }
float evaluateAmbientOcclusion() { return 0.0; }`)}function $dt(t){const e=t.fragment.code;e.add(T`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`),e.add(T`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`),e.add(T`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)}function uie(t,e){const r=t.fragment.code;t.include(jI),e.pbrMode!==ot.Normal&&e.pbrMode!==ot.Schematic&&e.pbrMode!==ot.Simplified&&e.pbrMode!==ot.TerrainWithWater||(r.add(T`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),r.add(T`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`)),e.pbrMode!==ot.Normal&&e.pbrMode!==ot.Schematic||(t.include($dt),r.add(T`struct PBRShadingInfo
{
float NdotL;
float NdotV;
float NdotH;
float VdotH;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),r.add(T`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),r.add(T`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),r.add(T`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`))}function Idt(t,e){const r=t.fragment.code;t.include(jI),r.add(T`
  struct PBRShadingWater
  {
      float NdotL;   // cos angle between normal and light direction
      float NdotV;   // cos angle between normal and view direction
      float NdotH;   // cos angle between normal and half vector
      float VdotH;   // cos angle between view direction and half vector
      float LdotH;   // cos angle between light direction and half vector
      float VdotN;   // cos angle between view direction and normal vector
  };

  float dtrExponent = ${e.useCustomDTRExponentForWater?"2.2":"2.0"};
  `),r.add(T`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),r.add(T`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),r.add(T`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`),r.add(T`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}
vec3 tonemapACES(const vec3 x) {
return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
}`)}function nL(t){t.constants.add("ambientBoostFactor","float",SAe)}function tP(t){t.uniforms.add(new $e("lightingGlobalFactor",(e,r)=>r.lighting.globalFactor))}function y2(t,e){const r=t.fragment;switch(t.include(iL,e),e.pbrMode!==ot.Disabled&&t.include(uie,e),t.include(ire,e),t.include(jI),r.code.add(T`
    const float GAMMA_SRGB = 2.1;
    const float INV_GAMMA_SRGB = 0.4761904;
    ${e.pbrMode===ot.Disabled?"":"const vec3 GROUND_REFLECTANCE = vec3(0.2);"}
  `),nL(r),tP(r),by(r),r.code.add(T`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${e.spherical?T`normalize(vPosWorld)`:T`vec3(0.0, 0.0, 1.0)`}, mainLightDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `),_g(r),r.code.add(T`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * mainLightIntensity;
}`),e.pbrMode){case ot.Disabled:case ot.WaterOnIntegratedMesh:case ot.Water:t.include(k6),r.code.add(T`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)
{
vec3 mainLighting = evaluateMainLighting(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`);break;case ot.Normal:case ot.Schematic:r.code.add(T`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);
inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`),r.code.add(T`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`),e.useFillLights?r.uniforms.add(new Ym("hasFillLights",(i,n)=>n.enableFillLights)):r.constants.add("hasFillLights","bool",!1),r.code.add(T`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0) ? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;
vec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * mainLightIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * mainLightIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`),r.uniforms.add(new $e("lightingSpecularStrength",(i,n)=>n.lighting.mainLight.specularStrength),new $e("lightingEnvironmentStrength",(i,n)=>n.lighting.mainLight.environmentStrength)),r.code.add(T`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
vec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(inputs.NdotH, inputs.roughness) * mainLightIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * mainLightIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;
float normalDirectionModifier = mix(1., min(mix(0.1, 2.0, (inputs.NdotNG + 1.) * 0.5), 1.0), clamp(inputs.roughness * 5.0, 0.0 , 1.0));
inputs.skyRadianceToSurface = (ambientLightRadianceComponent + horizonLightRadianceComponent) * normalDirectionModifier + mainLightRadianceComponent;
inputs.groundRadianceToSurface = 0.5 * GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) * normalDirectionModifier + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`),r.code.add(T`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = _emission == vec3(0.0) ? _emission : pow(_emission, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${e.pbrMode!==ot.Schematic||e.hasColorTexture?T`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`:T`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `);break;case ot.Simplified:case ot.TerrainWithWater:t.include(k6),r.code.add(T`const float roughnessTerrain = 0.5;
const float specularityTerrain = 0.5;
const vec3 fresnelReflectionTerrain = vec3(0.04);
vec3 evaluatePBRSimplifiedLighting(vec3 n, vec3 c, float shadow, float ssao, vec3 al, vec3 vd, vec3 nup) {
vec3 viewDirection = -vd;
vec3 h = normalize(viewDirection + mainLightDirection);
float NdotL = clamp(dot(n, mainLightDirection), 0.001, 1.0);
float NdotV = clamp(abs(dot(n, viewDirection)), 0.001, 1.0);
float NdotH = clamp(dot(n, h), 0.0, 1.0);
float NdotNG = clamp(dot(n, nup), -1.0, 1.0);
vec3 albedoLinear = pow(c, vec3(GAMMA_SRGB));
float lightness = 0.3 * albedoLinear[0] + 0.5 * albedoLinear[1] + 0.2 * albedoLinear[2];
vec3 f0 = (0.85 * lightness + 0.15) * fresnelReflectionTerrain;
vec3 f90 =  vec3(clamp(dot(f0, vec3(50.0 * 0.33)), 0.0, 1.0));
vec3 mainLightIrradianceComponent = (1. - shadow) * NdotL * mainLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(n, ssao) + al;
vec3 ambientSky = ambientLightIrradianceComponent + mainLightIrradianceComponent;
vec3 indirectDiffuse = ((1.0 - NdotNG) * mainLightIrradianceComponent + (1.0 + NdotNG ) * ambientSky) * 0.5;
vec3 outDiffColor = albedoLinear * (1.0 - f0) * indirectDiffuse / PI;
vec3 mainLightRadianceComponent = normalDistribution(NdotH, roughnessTerrain) * mainLightIntensity;
vec2 dfg = prefilteredDFGAnalytical(roughnessTerrain, NdotV);
vec3 specularColor = f0 * dfg.x + f90 * dfg.y;
vec3 specularComponent = specularityTerrain * specularColor * mainLightRadianceComponent;
vec3 outColorLinear = outDiffColor + specularComponent;
vec3 outColor = pow(outColorLinear, vec3(INV_GAMMA_SRGB));
return outColor;
}`);break;default:e.pbrMode;case ot.COUNT:}}let Ldt=class extends vn{constructor(e,r,i){super(e,"mat4",Rr.Draw,(n,s,o,a)=>n.setUniformMatrix4fv(e,r(s,o,a)),i)}},Ddt=class extends vn{constructor(e,r,i){super(e,"mat4",Rr.Pass,(n,s,o)=>n.setUniformMatrix4fv(e,r(s,o)),i)}},Ndt=class extends Ai{constructor(){super(...arguments),this.modelTransformation=sn}},hie=class extends Ndt{constructor(){super(...arguments),this.origin=C()}};function sL(t,e){e.receiveShadows&&(t.fragment.uniforms.add(new Ddt("shadowMapMatrix",(r,i)=>i.shadowMap.getShadowMapMatrices(r.origin),4)),jRe(t))}function f3(t,e){e.receiveShadows&&(t.fragment.uniforms.add(new Ldt("shadowMapMatrix",(r,i)=>i.shadowMap.getShadowMapMatrices(r.origin),4)),jRe(t))}function jRe(t){const e=t.fragment;e.include($Re),e.uniforms.add(new ct("shadowMap",(r,i)=>i.shadowMap.depthTexture),new rL("numCascades",(r,i)=>i.shadowMap.numCascades),new xr("cascadeDistances",(r,i)=>i.shadowMap.cascadeDistances)),e.code.add(T`int chooseCascade(float depth, out mat4 mat) {
vec4 distance = cascadeDistances;
int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;
mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];
return i;
}
vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
vec4 lv = mat * vec4(_vpos, 1.0);
lv.xy /= lv.w;
return 0.5 * lv.xyz + vec3(0.5);
}
vec2 cascadeCoordinates(int i, ivec2 textureSize, vec3 lvpos) {
float xScale = float(textureSize.y) / float(textureSize.x);
return vec2((float(i) + lvpos.x) * xScale, lvpos.y);
}
float readShadowMapDepth(ivec2 uv, sampler2D _depthTex) {
return rgba4ToFloat(texelFetch(_depthTex, uv, 0));
}
float posIsInShadow(ivec2 uv, vec3 lvpos, sampler2D _depthTex) {
return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
}
float filterShadow(vec2 uv, vec3 lvpos, ivec2 texSize, sampler2D _depthTex) {
vec2 st = fract(uv * vec2(texSize) + vec2(0.5));
ivec2 base = ivec2(uv * vec2(texSize) - vec2(0.5));
float s00 = posIsInShadow(ivec2(base.x, base.y), lvpos, _depthTex);
float s10 = posIsInShadow(ivec2(base.x + 1, base.y), lvpos, _depthTex);
float s11 = posIsInShadow(ivec2(base.x + 1, base.y + 1), lvpos, _depthTex);
float s01 = posIsInShadow(ivec2(base.x, base.y + 1), lvpos, _depthTex);
return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
}
float readShadowMap(const in vec3 _vpos, float _linearDepth) {
mat4 mat;
int i = chooseCascade(_linearDepth, mat);
if (i >= numCascades) { return 0.0; }
vec3 lvpos = lightSpacePosition(_vpos, mat);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }
ivec2 size = textureSize(shadowMap, 0);
vec2 uv = cascadeCoordinates(i, size, lvpos);
return filterShadow(uv, lvpos, size, shadowMap);
}`)}function Fdt(t,e){e.hasColorTextureTransform?(t.vertex.uniforms.add(new sh("colorTextureTransformMatrix",r=>r.colorTextureTransformMatrix??O2)),t.varyings.add("colorUV","vec2"),t.vertex.code.add(T`void forwardColorUV(){
colorUV = (colorTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):t.vertex.code.add(T`void forwardColorUV(){}`)}function kdt(t,e){e.hasNormalTextureTransform&&e.textureCoordinateType!==on.None?(t.vertex.uniforms.add(new sh("normalTextureTransformMatrix",r=>r.normalTextureTransformMatrix??O2)),t.varyings.add("normalUV","vec2"),t.vertex.code.add(T`void forwardNormalUV(){
normalUV = (normalTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):t.vertex.code.add(T`void forwardNormalUV(){}`)}function zdt(t,e){e.hasEmissionTextureTransform&&e.textureCoordinateType!==on.None?(t.vertex.uniforms.add(new sh("emissiveTextureTransformMatrix",r=>r.emissiveTextureTransformMatrix??O2)),t.varyings.add("emissiveUV","vec2"),t.vertex.code.add(T`void forwardEmissiveUV(){
emissiveUV = (emissiveTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):t.vertex.code.add(T`void forwardEmissiveUV(){}`)}function Udt(t,e){e.hasOcclusionTextureTransform&&e.textureCoordinateType!==on.None?(t.vertex.uniforms.add(new sh("occlusionTextureTransformMatrix",r=>r.occlusionTextureTransformMatrix??O2)),t.varyings.add("occlusionUV","vec2"),t.vertex.code.add(T`void forwardOcclusionUV(){
occlusionUV = (occlusionTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):t.vertex.code.add(T`void forwardOcclusionUV(){}`)}function Bdt(t,e){e.hasMetallicRoughnessTextureTransform&&e.textureCoordinateType!==on.None?(t.vertex.uniforms.add(new sh("metallicRoughnessTextureTransformMatrix",r=>r.metallicRoughnessTextureTransformMatrix??O2)),t.varyings.add("metallicRoughnessUV","vec2"),t.vertex.code.add(T`void forwardMetallicRoughnessUV(){
metallicRoughnessUV = (metallicRoughnessTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):t.vertex.code.add(T`void forwardMetallicRoughnessUV(){}`)}function H$(t){t.include(xg),t.code.add(T`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${T.int(Ns.Multiply)}) {
        return allMixed;
      }
      if (mode == ${T.int(Ns.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${T.int(Ns.Replace)}) {
        return externalColor;
      }

      // tint (or something invalid)
      float vIn = rgb2v(internalMixed);
      vec3 hsvTint = rgb2hsv(externalColor);
      vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
      return hsv2rgb(hsvOut);
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${T.int(Ns.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${T.int(Ns.Replace)}) {
        return externalOpacity;
      }

      // multiply or tint (or something invalid)
      return allMixed;
    }
  `)}function HRe(t){const e=new Or,{vertex:r,fragment:i,varyings:n}=e;if(Zc(r,t),e.include(HI),n.add("vpos","vec3"),e.include(B0,t),e.include(RAe,t),e.include(vOe,t),e.include(Fdt,t),t.output===U.Color||t.output===U.Alpha){e.include(kdt,t),e.include(zdt,t),e.include(Udt,t),e.include(Bdt,t),cf(r,t),e.include(K3,t),e.include(Kl,t);const s=t.normalType===$r.Attribute||t.normalType===$r.Compressed;s&&t.offsetBackfaces&&e.include(ARe),e.include(DRe,t),e.include($U,t),t.instancedColor&&e.attributes.add(R.INSTANCECOLOR,"vec4"),n.add("vPositionLocal","vec3"),e.include(qm,t),e.include(X3,t),e.include(RRe,t),e.include(H2,t),r.uniforms.add(new xr("externalColor",o=>o.externalColor)),n.add("vcolorExt","vec4"),t.multipassEnabled&&n.add("depth","float"),r.code.add(T`
      void main(void) {
        forwardNormalizedVertexColor();
        vcolorExt = externalColor;
        ${t.instancedColor?"vcolorExt *= instanceColor * 0.003921568627451;":""}
        vcolorExt *= vvColor();
        vcolorExt *= getSymbolColor();
        forwardColorMixMode();

        if (vcolorExt.a < ${T.float(Fo)}) {
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        } else {
          vpos = getVertexInLocalOriginSpace();
          vPositionLocal = vpos - view[3].xyz;
          vpos = subtractOrigin(vpos);
          ${s?T`vNormalWorld = dpNormal(vvLocalNormal(normalModel()));`:""}
          vpos = addVerticalOffset(vpos, localOrigin);
          ${t.hasVertexTangents?"vTangent = dpTransformVertexTangent(tangent);":""}
          gl_Position = transformPosition(proj, view, vpos);
          ${s&&t.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
        }

        ${t.multipassEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}
        forwardLinearDepth();
        forwardTextureCoordinates();
        forwardColorUV();
        forwardNormalUV();
        forwardEmissiveUV();
        forwardOcclusionUV();
        forwardMetallicRoughnessUV();
      }
    `)}switch(t.output){case U.Alpha:e.include(Fn,t),e.include(Nx,t),e.include(iu,t),i.uniforms.add(new $e("opacity",s=>s.opacity),new $e("layerOpacity",s=>s.layerOpacity)),t.hasColorTexture&&i.uniforms.add(new ct("tex",s=>s.texture)),i.include(H$),i.code.add(T`
      void main() {
        discardBySlice(vpos);
        ${t.multipassEnabled?"terrainDepthTest(depth);":""}
        ${t.hasColorTexture?T`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?T`colorUV`:T`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:T`vec4 texColor = vec4(1.0);`}
        ${t.hasVertexColors?T`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:T`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        fragColor = vec4(opacity_);
      }
    `);break;case U.Color:e.include(Fn,t),e.include(y2,t),e.include(iL,t),e.include(Nx,t),e.include(t.instancedDoublePrecision?sL:f3,t),e.include(iu,t),cf(i,t),i.uniforms.add(r.uniforms.get("localOrigin"),new Ft("ambient",s=>s.ambient),new Ft("diffuse",s=>s.diffuse),new $e("opacity",s=>s.opacity),new $e("layerOpacity",s=>s.layerOpacity)),t.hasColorTexture&&i.uniforms.add(new ct("tex",s=>s.texture)),e.include(rre,t),e.include(uie,t),i.include(H$),e.include(wRe,t),nL(i),tP(i),_g(i),i.code.add(T`
      void main() {
        discardBySlice(vpos);
        ${t.multipassEnabled?"terrainDepthTest(depth);":""}
        ${t.hasColorTexture?T`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?T`colorUV`:T`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:T`vec4 texColor = vec4(1.0);`}
        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        ${t.normalType===$r.ScreenDerivative?T`
                vec3 normal = screenDerivativeNormal(vPositionLocal);`:T`
                shadingParams.normalView = vNormalWorld;
                vec3 normal = shadingNormal(shadingParams);`}
        ${t.pbrMode===ot.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse() * getBakedOcclusion();

        vec3 posWorld = vpos + localOrigin;

        float additionalAmbientScale = additionalDirectedAmbientLight(posWorld);
        float shadow = ${t.receiveShadows?"readShadowMap(vpos, linearDepth)":t.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

        vec3 matColor = max(ambient, diffuse);
        ${t.hasVertexColors?T`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:T`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${t.hasNormalTexture?T`
                mat3 tangentSpace = ${t.hasVertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"}
                vec3 shadingNormal = computeTextureNormal(tangentSpace, ${t.hasNormalTextureTransform?T`normalUV`:"vuv0"});`:T`vec3 shadingNormal = normal;`}
        vec3 normalGround = ${t.spherical?T`normalize(posWorld);`:T`vec3(0.0, 0.0, 1.0);`}

        ${t.snowCover?T`
                float snow = smoothstep(0.5, 0.55, dot(normal, normalGround));
                albedo = mix(albedo, vec3(1), snow);
                shadingNormal = mix(shadingNormal, normal, snow);
                ssao = mix(ssao, 1.0, snow);`:""}

        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

        ${t.pbrMode===ot.Normal||t.pbrMode===ot.Schematic?T`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${t.snowCover?T`
                        mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                        emission = mix(emission, vec3(0.0), snow);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:T`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        fragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${t.transparencyPassType===ft.Color?T`fragColor = premultiplyAlpha(fragColor);`:""}
      }
    `)}return e.include(LRe,t),e}const Vdt=Object.freeze(Object.defineProperty({__proto__:null,build:HRe},Symbol.toStringTag,{value:"Module"}));let Gdt=class extends xRe{constructor(){super(...arguments),this.isSchematic=!1,this.usePBR=!1,this.mrrFactors=Ea(IU),this.hasVertexColors=!1,this.hasSymbolColors=!1,this.doubleSided=!1,this.doubleSidedType="normal",this.cullFace=Pi.Back,this.isInstanced=!1,this.hasInstancedColor=!1,this.emissiveFactor=Ce(0,0,0),this.instancedDoublePrecision=!1,this.normalType=$r.Attribute,this.receiveShadows=!0,this.receiveAmbientOcclusion=!0,this.castShadows=!0,this.shadowMappingEnabled=!1,this.ambient=Ce(.2,.2,.2),this.diffuse=Ce(.8,.8,.8),this.externalColor=Bt(1,1,1,1),this.colorMixMode="multiply",this.opacity=1,this.layerOpacity=1,this.origin=C(),this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.offsetTransparentBackfaces=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.modelTransformation=null,this.transparent=!1,this.writeDepth=!0,this.customDepthTest=d2.Less,this.textureAlphaMode=fi.Blend,this.textureAlphaCutoff=d8,this.textureAlphaPremultiplied=!1,this.hasOccludees=!1,this.renderOccluded=kr.Occlude,this.isDecoration=!1}},jdt=class extends TRe{constructor(){super(...arguments),this.origin=C(),this.slicePlaneLocalOrigin=this.origin}},die=class WRe extends Vr{initializeConfiguration(e,r){r.spherical=e.viewingMode===De.Global,r.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result,r.textureCoordinateType=r.hasColorTexture||r.hasMetallicRoughnessTexture||r.hasEmissionTexture||r.hasOcclusionTexture||r.hasNormalTexture?on.Default:on.None,r.objectAndLayerIdColorInstanced=r.instanced}initializeProgram(e){return this._initializeProgram(e,WRe.shader)}_initializeProgram(e,r){return new Lr(e.rctx,r.get().build(this.configuration),Mr)}_convertDepthTestFunction(e){return e===d2.Lequal?Xr.LEQUAL:Xr.LESS}_makePipeline(e,r){const i=this.configuration,n=e===ft.NONE,s=e===ft.FrontFace;return kt({blending:i.output!==U.Color&&i.output!==U.Alpha||!i.transparent?null:n?Zu:Cy(e),culling:Hdt(i)?rU(i.cullFace):null,depthTest:{func:Gv(e,this._convertDepthTestFunction(i.customDepthTest))},depthWrite:(n||s)&&i.writeDepth?ru:null,colorWrite:Yt,stencilWrite:i.hasOccludees?pg:null,stencilTest:i.hasOccludees?r?Cv:jv:null,polygonOffset:n||s?null:MU(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._makePipeline(this.configuration.transparencyPassType,!0),this._makePipeline(this.configuration.transparencyPassType,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}};function Hdt(t){return t.cullFace!==Pi.None||!t.hasSlicePlane&&!t.transparent&&!t.doubleSidedMode}die.shader=new Ir(Vdt,()=>ge(()=>Promise.resolve().then(()=>HNt),void 0));let jt=class extends vl{constructor(){super(...arguments),this.output=U.Color,this.alphaDiscardMode=fi.Opaque,this.doubleSidedMode=gn.None,this.pbrMode=ot.Disabled,this.cullFace=Pi.None,this.transparencyPassType=ft.NONE,this.normalType=$r.Attribute,this.textureCoordinateType=on.None,this.customDepthTest=d2.Less,this.spherical=!1,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.hasVerticalOffset=!1,this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.hasColorTexture=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasScreenSizePerspective=!1,this.hasVertexTangents=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.hasModelTransformation=!1,this.offsetBackfaces=!1,this.vvSize=!1,this.vvColor=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.textureAlphaPremultiplied=!1,this.instanced=!1,this.instancedColor=!1,this.objectAndLayerIdColorInstanced=!1,this.instancedDoublePrecision=!1,this.doublePrecisionRequiresObfuscation=!1,this.writeDepth=!0,this.transparent=!1,this.enableOffset=!0,this.cullAboveGround=!1,this.snowCover=!1,this.hasColorTextureTransform=!1,this.hasEmissionTextureTransform=!1,this.hasNormalTextureTransform=!1,this.hasOcclusionTextureTransform=!1,this.hasMetallicRoughnessTextureTransform=!1}};d([j({count:U.COUNT})],jt.prototype,"output",void 0),d([j({count:fi.COUNT})],jt.prototype,"alphaDiscardMode",void 0),d([j({count:gn.COUNT})],jt.prototype,"doubleSidedMode",void 0),d([j({count:ot.COUNT})],jt.prototype,"pbrMode",void 0),d([j({count:Pi.COUNT})],jt.prototype,"cullFace",void 0),d([j({count:ft.COUNT})],jt.prototype,"transparencyPassType",void 0),d([j({count:$r.COUNT})],jt.prototype,"normalType",void 0),d([j({count:on.COUNT})],jt.prototype,"textureCoordinateType",void 0),d([j({count:d2.COUNT})],jt.prototype,"customDepthTest",void 0),d([j()],jt.prototype,"spherical",void 0),d([j()],jt.prototype,"hasVertexColors",void 0),d([j()],jt.prototype,"hasSymbolColors",void 0),d([j()],jt.prototype,"hasVerticalOffset",void 0),d([j()],jt.prototype,"hasSlicePlane",void 0),d([j()],jt.prototype,"hasSliceHighlight",void 0),d([j()],jt.prototype,"hasColorTexture",void 0),d([j()],jt.prototype,"hasMetallicRoughnessTexture",void 0),d([j()],jt.prototype,"hasEmissionTexture",void 0),d([j()],jt.prototype,"hasOcclusionTexture",void 0),d([j()],jt.prototype,"hasNormalTexture",void 0),d([j()],jt.prototype,"hasScreenSizePerspective",void 0),d([j()],jt.prototype,"hasVertexTangents",void 0),d([j()],jt.prototype,"hasOccludees",void 0),d([j()],jt.prototype,"multipassEnabled",void 0),d([j()],jt.prototype,"hasModelTransformation",void 0),d([j()],jt.prototype,"offsetBackfaces",void 0),d([j()],jt.prototype,"vvSize",void 0),d([j()],jt.prototype,"vvColor",void 0),d([j()],jt.prototype,"receiveShadows",void 0),d([j()],jt.prototype,"receiveAmbientOcclusion",void 0),d([j()],jt.prototype,"textureAlphaPremultiplied",void 0),d([j()],jt.prototype,"instanced",void 0),d([j()],jt.prototype,"instancedColor",void 0),d([j()],jt.prototype,"objectAndLayerIdColorInstanced",void 0),d([j()],jt.prototype,"instancedDoublePrecision",void 0),d([j()],jt.prototype,"doublePrecisionRequiresObfuscation",void 0),d([j()],jt.prototype,"writeDepth",void 0),d([j()],jt.prototype,"transparent",void 0),d([j()],jt.prototype,"enableOffset",void 0),d([j()],jt.prototype,"cullAboveGround",void 0),d([j()],jt.prototype,"snowCover",void 0),d([j()],jt.prototype,"hasColorTextureTransform",void 0),d([j()],jt.prototype,"hasEmissionTextureTransform",void 0),d([j()],jt.prototype,"hasNormalTextureTransform",void 0),d([j()],jt.prototype,"hasOcclusionTextureTransform",void 0),d([j()],jt.prototype,"hasMetallicRoughnessTextureTransform",void 0),d([j({constValue:!1})],jt.prototype,"occlusionPass",void 0),d([j({constValue:!0})],jt.prototype,"hasVvInstancing",void 0),d([j({constValue:!1})],jt.prototype,"useCustomDTRExponentForWater",void 0),d([j({constValue:!1})],jt.prototype,"supportsTextureAtlas",void 0),d([j({constValue:!0})],jt.prototype,"useFillLights",void 0);function qRe(t){const e=new Or,{vertex:r,fragment:i,varyings:n}=e;return Zc(r,t),e.include(HI),n.add("vpos","vec3"),e.include(B0,t),e.include(RAe,t),e.include(vOe,t),t.output!==U.Color&&t.output!==U.Alpha||(cf(e.vertex,t),e.include(K3,t),e.include(Kl,t),t.offsetBackfaces&&e.include(ARe),t.instancedColor&&e.attributes.add(R.INSTANCECOLOR,"vec4"),n.add("vNormalWorld","vec3"),n.add("localvpos","vec3"),t.multipassEnabled&&n.add("depth","float"),e.include(qm,t),e.include(X3,t),e.include(RRe,t),e.include(H2,t),r.uniforms.add(new xr("externalColor",s=>s.externalColor)),n.add("vcolorExt","vec4"),r.code.add(T`
        void main(void) {
          forwardNormalizedVertexColor();
          vcolorExt = externalColor;
          ${t.instancedColor?"vcolorExt *= instanceColor * 0.003921568627451;":""}
          vcolorExt *= vvColor();
          vcolorExt *= getSymbolColor();
          forwardColorMixMode();

          if (vcolorExt.a < ${T.float(Fo)}) {
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          } else {
            vpos = getVertexInLocalOriginSpace();
            localvpos = vpos - view[3].xyz;
            vpos = subtractOrigin(vpos);
            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            ${t.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
          }
          ${t.multipassEnabled?T`depth = (view * vec4(vpos, 1.0)).z;`:""}
          forwardLinearDepth();
          forwardTextureCoordinates();
        }
      `)),t.output===U.Alpha&&(e.include(Fn,t),e.include(Nx,t),e.include(iu,t),i.uniforms.add(new $e("opacity",s=>s.opacity),new $e("layerOpacity",s=>s.layerOpacity)),t.hasColorTexture&&i.uniforms.add(new ct("tex",s=>s.texture)),i.include(H$),i.code.add(T`
      void main() {
        discardBySlice(vpos);
        ${t.multipassEnabled?T`terrainDepthTest(depth);`:""}
        ${t.hasColorTexture?T`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?T`colorUV`:T`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:T`vec4 texColor = vec4(1.0);`}
        ${t.hasVertexColors?T`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:T`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}

        fragColor = vec4(opacity_);
      }
    `)),t.output===U.Color&&(e.include(Fn,t),e.include(y2,t),e.include(iL,t),e.include(Nx,t),e.include(t.instancedDoublePrecision?sL:f3,t),e.include(iu,t),cf(e.fragment,t),by(i),nL(i),tP(i),i.uniforms.add(r.uniforms.get("localOrigin"),r.uniforms.get("view"),new Ft("ambient",s=>s.ambient),new Ft("diffuse",s=>s.diffuse),new $e("opacity",s=>s.opacity),new $e("layerOpacity",s=>s.layerOpacity)),t.hasColorTexture&&i.uniforms.add(new ct("tex",s=>s.texture)),e.include(rre,t),e.include(uie,t),i.include(H$),_g(i),i.code.add(T`
      void main() {
        discardBySlice(vpos);
        ${t.multipassEnabled?T`terrainDepthTest(depth);`:""}
        ${t.hasColorTexture?T`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?T`colorUV`:T`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:T`vec4 texColor = vec4(1.0);`}
        vec3 viewDirection = normalize(vpos - cameraPosition);
        ${t.pbrMode===ot.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${t.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":t.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${t.hasVertexColors?T`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:T`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${t.snowCover?T`albedo = mix(albedo, vec3(1), 0.9);`:T``}
        ${T`
            vec3 shadingNormal = normalize(vNormalWorld);
            albedo *= 1.2;
            vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
            float alignmentLightView = clamp(dot(viewForward, -mainLightDirection), 0.0, 1.0);
            float transmittance = 1.0 - clamp(dot(viewForward, shadingNormal), 0.0, 1.0);
            float treeRadialFalloff = vColor.r;
            float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
            additionalLight += backLightFactor * mainLightIntensity;`}
        ${t.pbrMode===ot.Normal||t.pbrMode===ot.Schematic?t.spherical?T`vec3 normalGround = normalize(vpos + localOrigin);`:T`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:T``}
        ${t.pbrMode===ot.Normal||t.pbrMode===ot.Schematic?T`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${t.snowCover?T`
                        mrr = vec3(0.0, 1.0, 0.04);
                        emission = vec3(0.0);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:T`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        fragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${t.transparencyPassType===ft.Color?T`fragColor = premultiplyAlpha(fragColor);`:T``}
      }
    `)),e.include(LRe,t),e}const Wdt=Object.freeze(Object.defineProperty({__proto__:null,build:qRe},Symbol.toStringTag,{value:"Module"}));let YRe=class XRe extends die{initializeConfiguration(e,r){super.initializeConfiguration(e,r),r.hasMetallicRoughnessTexture=!1,r.hasEmissionTexture=!1,r.hasOcclusionTexture=!1,r.hasNormalTexture=!1,r.hasModelTransformation=!1,r.normalType=$r.Attribute,r.doubleSidedMode=gn.WindingOrder,r.hasVertexTangents=!1}initializeProgram(e){return this._initializeProgram(e,XRe.shader)}};YRe.shader=new Ir(Wdt,()=>ge(()=>Promise.resolve().then(()=>WNt),void 0));let hf=class extends Bv{constructor(e){super(e,Xdt),this.supportsEdges=!0,this.produces=new Map([[ue.OPAQUE_MATERIAL,r=>(oR(r)||KC(r))&&!this.parameters.transparent],[ue.TRANSPARENT_MATERIAL,r=>(oR(r)||KC(r))&&this.parameters.transparent&&this.parameters.writeDepth],[ue.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,r=>(oR(r)||KC(r))&&this.parameters.transparent&&!this.parameters.writeDepth]]),this._configuration=new jt,this._vertexBufferLayout=Zdt(this.parameters)}isVisibleForOutput(e){return e!==U.Shadow&&e!==U.ShadowExcludeHighlight&&e!==U.ShadowHighlight||this.parameters.castShadows}isVisible(){const e=this.parameters;if(!super.isVisible()||e.layerOpacity===0)return!1;const{hasInstancedColor:r,hasVertexColors:i,hasSymbolColors:n,vvColor:s}=e,o=e.colorMixMode==="replace",a=e.opacity>0,l=e.externalColor&&e.externalColor[3]>0,c=r||s||n;return i&&c?o||a:i?o?l:a:c?o||a:o?l:a}getConfiguration(e,r){return this._configuration.output=e,this._configuration.hasNormalTexture=!!this.parameters.normalTextureId,this._configuration.hasColorTexture=!!this.parameters.textureId,this._configuration.hasVertexTangents=this.parameters.hasVertexTangents,this._configuration.instanced=this.parameters.isInstanced,this._configuration.instancedDoublePrecision=this.parameters.instancedDoublePrecision,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.hasVerticalOffset=this.parameters.verticalOffset!=null,this._configuration.hasScreenSizePerspective=this.parameters.screenSizePerspective!=null,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasSliceHighlight=this.parameters.hasSliceHighlight,this._configuration.alphaDiscardMode=this.parameters.textureAlphaMode,this._configuration.normalType=this.parameters.normalType,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,this.parameters.customDepthTest!=null&&(this._configuration.customDepthTest=this.parameters.customDepthTest),this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.cullFace=this.parameters.hasSlicePlane?Pi.None:this.parameters.cullFace,this._configuration.multipassEnabled=r.multipassEnabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration.hasModelTransformation=this.parameters.modelTransformation!=null,e!==U.Color&&e!==U.Alpha||(this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSymbolColors=this.parameters.hasSymbolColors,this.parameters.treeRendering?this._configuration.doubleSidedMode=gn.WindingOrder:this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?gn.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?gn.WindingOrder:gn.None,this._configuration.instancedColor=this.parameters.hasInstancedColor,this._configuration.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,this._configuration.receiveAmbientOcclusion=this.parameters.receiveAmbientOcclusion&&r.ssao!=null,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this._configuration.pbrMode=this.parameters.usePBR?this.parameters.isSchematic?ot.Schematic:ot.Normal:ot.Disabled,this._configuration.hasMetallicRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this._configuration.hasEmissionTexture=!!this.parameters.emissiveTextureId,this._configuration.hasOcclusionTexture=!!this.parameters.occlusionTextureId,this._configuration.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<PU,this._configuration.snowCover=this.hasSnowCover(r),this._configuration.hasColorTextureTransform=!!this.parameters.colorTextureTransformMatrix,this._configuration.hasNormalTextureTransform=!!this.parameters.normalTextureTransformMatrix,this._configuration.hasEmissionTextureTransform=!!this.parameters.emissiveTextureTransformMatrix,this._configuration.hasOcclusionTextureTransform=!!this.parameters.occlusionTextureTransformMatrix,this._configuration.hasMetallicRoughnessTextureTransform=!!this.parameters.metallicRoughnessTextureTransformMatrix),this._configuration}hasSnowCover(e){return e.weather!=null&&e.weatherVisible&&e.weather.type==="snowy"&&e.weather.snowCover==="enabled"}intersect(e,r,i,n,s,o){if(this.parameters.verticalOffset!=null){const a=i.camera;ie(z7,r[12],r[13],r[14]);let l=null;switch(i.viewingMode){case De.Global:l=pe(zde,z7);break;case De.Local:l=ce(zde,Kdt)}let c=0;const u=ye(ept,z7,a.eye),h=Te(u),p=ne(u,u,1/h);let f=null;this.parameters.screenSizePerspective&&(f=de(l,p)),c+=POe(a,h,this.parameters.verticalOffset,f??0,this.parameters.screenSizePerspective),ne(l,l,c),Zs(k7,l,i.transform.inverseRotation),n=ye(Jdt,n,k7),s=ye(Qdt,s,k7)}TOe(e,i,n,s,bq(i.verticalOffset),o)}createGLMaterial(e){return new qdt(e)}createBufferWriter(){return new eP(this._vertexBufferLayout)}},qdt=class extends tre{constructor(e){super({...e,...e.material.parameters})}_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:e.shadowMap.enabled})}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output!==U.Color&&this._output!==U.Alpha||(this._updateShadowState(e),this._updateOccludeeState(e));const r=this._material.parameters;this.updateTexture(r.textureId);const i=e.camera.viewInverseTransposeMatrix;return ie(r.origin,i[3],i[7],i[11]),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(r.treeRendering?YRe:die,e)}},Ydt=class extends Gdt{constructor(){super(...arguments),this.initTextureTransparent=!1,this.treeRendering=!1,this.hasVertexTangents=!1}};const Xdt=new Ydt;function Zdt(t){const e=Qi().vec3f(R.POSITION);return t.normalType===$r.Compressed?e.vec2i16(R.NORMALCOMPRESSED,{glNormalized:!0}):e.vec3f(R.NORMAL),t.hasVertexTangents&&e.vec4f(R.TANGENT),(t.textureId||t.normalTextureId||t.metallicRoughnessTextureId||t.emissiveTextureId||t.occlusionTextureId)&&e.vec2f(R.UV0),t.hasVertexColors&&e.vec4u8(R.COLOR),t.hasSymbolColors&&e.vec4u8(R.SYMBOLCOLOR),se("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(R.OBJECTANDLAYERIDCOLOR),e}const Jdt=C(),Qdt=C(),Kdt=Ce(0,0,1),zde=C(),k7=C(),z7=C(),ept=C(),ZRe=new aie({});function qVt(t){return t.type==="web-style"?ZRe:pie(t.symbolLayers.toArray().map(e=>JRe(t,e)))}function pie(t){let e=0,r=0,i=0,n=!1,s=0;const o=new vRe;for(const a of t)a!=null&&(e+=a.verticesPerFeature,r+=a.verticesPerCoordinate,i+=a.drawCallsPerFeature,o.bytesPerFeature+=a.memory.bytesPerFeature,o.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.resourceBytes+=a.memory.resourceBytes,o.draped.bytesPerFeature+=a.memory.bytesPerFeature,o.draped.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,n=n||a.estimated,++s);return n?new ndt(s,{verticesPerFeature:e,verticesPerCoordinate:r,drawCallsPerFeature:i,memory:o}):new idt(s,{verticesPerFeature:e,verticesPerCoordinate:r,drawCallsPerFeature:i,memory:o})}function YVt(t){const e=pie(t);return e.numComplexities>0&&(e.verticesPerFeature/=e.numComplexities,e.verticesPerCoordinate/=e.numComplexities,e.drawCallsPerFeature/=e.numComplexities,e.memory.bytesPerFeature/=e.numComplexities,e.memory.bytesPerFeatureLabel/=e.numComplexities,e.memory.resourceBytes/=e.numComplexities,e.memory.draped.bytesPerFeature/=e.numComplexities,e.memory.draped.bytesPerFeatureLabel/=e.numComplexities),e}const U7={};function JRe(t,e){var n,s;const r=QRe(t,e),i=adt(e)?2:0;switch(e.type){case"extrude":return new Fh({verticesPerFeature:-12,verticesPerCoordinate:12,drawCallsPerFeature:i,memory:r});case"fill":if(t.type==="mesh-3d")return new Fh({drawCallsPerFeature:i,memory:r});if(e.outline!=null&&e.outline.size>0)return new Fh({verticesPerFeature:-12,verticesPerCoordinate:9,memory:r});case"water":return new Fh({verticesPerFeature:-6,verticesPerCoordinate:3,memory:r});case"line":return new Fh({verticesPerFeature:-6,verticesPerCoordinate:6,memory:r});case"object":return(n=e.resource)!=null&&n.href?new aie({verticesPerFeature:100,memory:r}):{...tpt(((s=e.resource)==null?void 0:s.primitive)??p3e),memory:r};case"path":{let o=0,a=0;switch(e.profile){case"circle":o=fRe;break;case"quad":o=4;break;default:return void(e.profile,void 0)}switch(e.join??"simple"){case"round":a=pRe;break;case"miter":case"bevel":a=1;break;default:return}const l=2*o,c=o*a*2,u=c+l;let h=-2*c-l;switch(e.cap){case"none":break;case"butt":case"square":h+=2*(o-1);break;case"round":h+=2*(o*($Z-1)*2+o);break;default:return}return new Fh({verticesPerFeature:h,verticesPerCoordinate:u,memory:r})}case"text":case"icon":return new Fh({verticesPerFeature:6,memory:r});default:return}}function QRe(t,e){const r=t.type==="point-3d";switch(e.type){case"extrude":return e.edges&&e.edges.size>0?El.EXTRUDE_EDGES:El.EXTRUDE;case"fill":return e.outline!=null&&e.outline.size>0?El.FILL_OUTLINE:El.FILL;case"water":return El.FILL;case"line":return e.join==="round"?El.LINE_ROUND:El.LINE_MITER;case"path":switch(e.join){case"round":switch(e.profile){case"circle":return El.PATH_ROUND_CIRCLE;case"quad":return El.PATH_ROUND_QUAD;default:return void(e.profile,void 0)}case"miter":case"bevel":switch(e.profile){case"circle":return El.PATH_MITER_CIRCLE;case"quad":return El.PATH_MITER_QUAD;default:return void(e.profile,void 0)}default:return}case"object":return r?El.OBJECT_POINT:El.OBJECT_POLYGON;case"icon":case"text":return r?El.ICON_POINT:El.ICON_POLYGON;default:return}}function tpt(t){const e=U7[t];if(e)return e;const r=KRe(_Re(t,new hf({})).levels);return U7[t]=new Fh({verticesPerFeature:r}),U7[t]}function KRe(t){return t.reduce((e,r,i)=>e+r.numVertices*(1/10**i),0)/t.reduce((e,r,i)=>e+1/10**i,0)}const El={ICON_POINT:{bytesPerFeature:2379.8272296852992,bytesPerFeatureLabel:852.246235,resourceBytes:0,draped:{bytesPerFeature:1868.2382921559424,bytesPerFeatureLabel:839.205415}},ICON_POLYGON:{bytesPerFeature:2957.8429876524656,bytesPerFeatureLabel:862.5307816666666,resourceBytes:0,draped:{bytesPerFeature:2579.7767085451133,bytesPerFeatureLabel:856.9298550000001}},OBJECT_POINT:{bytesPerFeature:603.543820573039,bytesPerFeatureLabel:717.4551849999999,resourceBytes:0,draped:{bytesPerFeature:603.543820573039,bytesPerFeatureLabel:717.4551849999999}},OBJECT_POLYGON:{bytesPerFeature:1111.1693389308373,bytesPerFeatureLabel:707.4535949999998,resourceBytes:0,draped:{bytesPerFeature:1111.1693389308373,bytesPerFeatureLabel:707.4535949999998}},LINE_MITER:{bytesPerFeature:3081.208408220661,bytesPerFeatureLabel:858.6749016666668,resourceBytes:0,draped:{bytesPerFeature:2682.57863388475,bytesPerFeatureLabel:844.6118016666666}},LINE_ROUND:{bytesPerFeature:3209.3236242927915,bytesPerFeatureLabel:858.1810416666667,resourceBytes:0,draped:{bytesPerFeature:2687.6256038096126,bytesPerFeatureLabel:849.578535}},PATH_MITER_CIRCLE:{bytesPerFeature:38708.74276663992,bytesPerFeatureLabel:858.70415,resourceBytes:0,draped:{bytesPerFeature:38708.74276663992,bytesPerFeatureLabel:858.70415}},PATH_ROUND_CIRCLE:{bytesPerFeature:42098.00590216518,bytesPerFeatureLabel:868.3632500000001,resourceBytes:0,draped:{bytesPerFeature:42098.00590216518,bytesPerFeatureLabel:868.3632500000001}},PATH_MITER_QUAD:{bytesPerFeature:25037.823002405767,bytesPerFeatureLabel:835.93355,resourceBytes:0,draped:{bytesPerFeature:25037.823002405767,bytesPerFeatureLabel:835.93355}},PATH_ROUND_QUAD:{bytesPerFeature:40320.254760224525,bytesPerFeatureLabel:851.66955,resourceBytes:0,draped:{bytesPerFeature:40320.254760224525,bytesPerFeatureLabel:851.66955}},FILL:{bytesPerFeature:3147.43349219103,bytesPerFeatureLabel:850.7598550000001,resourceBytes:0,draped:{bytesPerFeature:2673.7898488975106,bytesPerFeatureLabel:846.6459950000002}},FILL_OUTLINE:{bytesPerFeature:4565.099993465867,bytesPerFeatureLabel:855.334515,resourceBytes:0,draped:{bytesPerFeature:3904.46969705314,bytesPerFeatureLabel:844.7081016666667}},EXTRUDE:{bytesPerFeature:7551.2282834569505,bytesPerFeatureLabel:849.5513283333333,resourceBytes:0,draped:{bytesPerFeature:7551.2282834569505,bytesPerFeatureLabel:849.5513283333333}},EXTRUDE_EDGES:{bytesPerFeature:2959.8379634500698,bytesPerFeatureLabel:602.0969283333335,resourceBytes:0,draped:{bytesPerFeature:2959.8379634500698,bytesPerFeatureLabel:602.0969283333335}}};var Xn;(function(t){t[t.RecreateSymbol=0]="RecreateSymbol",t[t.RecreateGraphics=1]="RecreateGraphics",t[t.FastUpdate=2]="FastUpdate"})(Xn||(Xn={}));let fie=class{constructor(e){this.schedule=e,this._abortController=null,this._loadStatus=Iu.LOADING,this._loadError=null,this._loader=null,this.logger=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(e,r){return this._loadStatus===Iu.LOADED?(e&&e(),this._loader??Promise.resolve()):this._loadStatus===Iu.FAILED?(r&&r(this._loadError),this._loader??Promise.resolve()):(this._loader==null&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null,this._loadStatus=Iu.LOADED},i=>{throw this._loadError=i,this._abortController=null,this._loadStatus=Iu.FAILED,!_s(i)&&this.logger&&i.message&&this.logger.warn(i.message),i})),this._loader.then(e,r).catch(()=>{}),this._loader)}abortLoad(){this._abortController!=null?this._abortController=wl(this._abortController):this._loadStatus===Iu.LOADING&&(this._loadStatus=Iu.FAILED),this._loader=null}};var Iu;(function(t){t[t.LOADING=0]="LOADING",t[t.LOADED=1]="LOADED",t[t.FAILED=2]="FAILED"})(Iu||(Iu={}));const bT=()=>re.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");let Sg=class extends fie{constructor(e,r,i,n){super(i.schedule),this.symbol=e,this.symbolLayer=r,this._context=i,this.ignoreDrivers=!1,this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1},this._materials=[],this.usedMemory=0,this.logger=bT(),this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},this.skipHighSymbolLodsChanged=!0,this._renderPriority=n.renderPriority,this._renderPriorityStep=n.renderPriorityStep,this._elevationContext=new f8,this.complexity=this.computeComplexity(),this.ignoreDrivers=n.ignoreDrivers,this.ignoreDrivers||(this._drivenProperties=Ude(this._context.renderer)),this._updateElevationContext()}getCachedSize(){return null}get extentPadding(){return 0}get materials(){return this._materials}_drivenPropertiesChanged(e){if(this.ignoreDrivers)return!1;const r=this._drivenProperties,i=Ude(e);return i.color!==r.color||i.opacity!==r.opacity||i.opacityAlwaysOpaque!==r.opacityAlwaysOpaque||i.size!==r.size}get needsDrivenTransparentPass(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}_logGeometryCreationWarnings(e,r,i,n){const s=e.projectionSuccess,o="polygons"in e?e.polygons:null,a=`${n} geometry failed to be created`;let l=null;s?!this._logGeometryValidationWarnings(r,i,n)&&o&&o.length===0&&i==="rings"&&r.length>0&&r[0].length>2&&(l=`${a} (filled rings should use clockwise winding - try reversing the order of vertices)`):l=`${a} (failed to project geometry to view spatial reference)`,l&&bT().warnOncePerTick(l)}_logGeometryValidationWarnings(e,r,i){const n=`${i} geometry failed to be created`;return!e.length||e.length===1&&!e[0].length?(bT().warnOncePerTick(`${n} (no ${r} were defined)`),!0):(!Array.isArray(e)||!Array.isArray(e[0]))&&(bT().warnOncePerTick(`${n} (${r} should be defined as a 2D array)`),!0)}_validateGeometry(e,r=null,i=null){if(r!=null&&!r.includes(e.type))return this.logger.warn("unsupported geometry type for "+i+` symbol: ${e.type}`),!1;if(e.type==="point"){const n=e;if(!isFinite(n.x)||!isFinite(n.y))return bT().warn("point coordinate is not a valid number, graphic skipped"),!1}return!0}_defaultElevationInfoNoZ(){return rpt}_defaultElevationInfoZ(){return ipt}_updateElevationContext(){this._elevationInfoOverride!=null?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}getDefaultElevationInfo(e){return e.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(e,r=this.getDefaultElevationInfo(e)){return this._elevationContext.mode||r.mode}setElevationInfoOverride(e){this._elevationInfoOverride=e,this._updateElevationContext()}setGraphicElevationContext(e,r=new f8){const i=e.geometry,n=this.getDefaultElevationInfo(i);r.unit=this._elevationContext.unit!=null?this._elevationContext.unit:n.unit,r.mode=this.getGeometryElevationMode(i,n),r.offsetMeters=this._elevationContext.meterUnitOffset??n.offset??0;const s=!this._elevationOptions.supportsOnTheGround&&r.mode==="on-the-ground";s&&(r.mode="relative-to-ground",r.offsetMeters=0);const o=s?Yht:this._elevationContext.featureExpressionInfoContext;return r.updateFeatureExpressionInfoContext(o,e,this._context.layer),r}prepareSymbolLayerPatch(e){}updateGeometry(e,r){return!1}updateTransform(e,r,i,n){return!1}onRemoveGraphic(e){}_getLayerOpacity(){return this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner?this._context.graphicsCoreOwner.fullOpacity??0:this._context.layer.opacity??1}_getCombinedOpacity(e,r=Bde){let i=1;return this.draped||(i*=this._getLayerOpacity()),this._drivenProperties.opacity||(e!=null?i*=e.a:r.hasIntrinsicColor||(i=0)),i}_getCombinedOpacityAndColor(e,r=Bde){const i=this._getCombinedOpacity(e,r);if(this._drivenProperties.color)return pR(null,i);const n=e!=null?Xe.toUnitRGB(e):Im;return pR(n,i)}_getVertexOpacityAndColor(e,r=null){const i=this._drivenProperties.color?e.color:null,n=this._drivenProperties.opacity?e.opacity:null,s=pR(i,n);return r&&(s[0]*=r,s[1]*=r,s[2]*=r,s[3]*=r),s}isFastUpdatesEnabled(){return this._fastUpdates!=null}computeComplexity(){return JRe(this.symbol,this.symbolLayer)}globalPropertyChanged(e,r,i){switch(e){case"opacity":return this.layerOpacityChanged(r,i),!0;case"elevationInfo":{const n=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(r,i,n)!==En.RECREATE}case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(r,i);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged;case"skipHighSymbolLods":return this.skipHighSymbolLodsChanged;default:return!1}}get pixelRatioChanged(){return!0}updateGraphics3DGraphicElevationInfo(e,r,i){let n=En.UPDATE;return e.forEach(s=>{const o=r(s);if(o!=null){const a=s.graphic;this.setGraphicElevationContext(a,o.elevationContext),o.needsElevationUpdates=i(o.elevationContext.mode)}else n=En.RECREATE}),n}applyRendererDiff(e,r){return Xn.RecreateSymbol}getFastUpdateAttrValues(e){if(!this._fastUpdates)return null;const r=this._fastUpdates.visualVariables,i=r.size?Qp(r.size.field,e):0,n=r.color?Qp(r.color.field,e):0,s=r.opacity?Qp(r.opacity.field,e):0;return Bt(i,n,s,0)}get draped(){return this._draped}ensureDrapedStatus(e){return this._draped==null?(this._draped=e,!0):(e!==this.draped&&bT().warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)}test(){const e=()=>{var r,i,n,s,o,a,l,c;return{size:((i=(r=this._fastUpdates)==null?void 0:r.visualVariables.size)==null?void 0:i.field)??null,color:((s=(n=this._fastUpdates)==null?void 0:n.visualVariables.color)==null?void 0:s.field)??null,opacity:((a=(o=this._fastUpdates)==null?void 0:o.visualVariables.opacity)==null?void 0:a.field)??null,rotation:((c=(l=this._fastUpdates)==null?void 0:l.visualVariables.rotation)==null?void 0:c.field)??null}};return{drivenProperties:this._drivenProperties,getVisVarFields:e}}};function Ude(t){const e={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};return t&&"visualVariables"in t&&t.visualVariables&&t.visualVariables.forEach(r=>{switch(r.type){case"color":if(e.color=!0,r.stops)for(let i=0;i<r.stops.length;i++){const n=r.stops[i].color;n&&(e.opacity=!0,n.a<1&&(e.opacityAlwaysOpaque=!1))}break;case"opacity":e.opacity=!0,e.opacityAlwaysOpaque=!1;break;case"size":e.size=!0}}),e}const rpt={mode:"on-the-ground",offset:0,unit:"meters"},ipt={mode:"absolute-height",offset:0,unit:"meters"},Bde={hasIntrinsicColor:!1};let Ey=class extends YI{get geometries(){return this._geometries}get transformation(){return this._transformation??sn}set transformation(e){this._transformation=Zn(this._transformation??xe(),e),this._invalidateBoundingVolume(),this._emit("transformationChanged",this)}get shaderTransformation(){return this._shaderTransformation}set shaderTransformation(e){this._shaderTransformation=e?Zn(this._shaderTransformation??xe(),e):null,this._invalidateBoundingVolume(),this._emit("shaderTransformationChanged",this)}get effectiveTransformation(){return this.shaderTransformation??this.transformation}constructor(e={}){super(),this.type=Cn.Object,this._shaderTransformation=null,this._parentLayer=null,this._visible=!0,this.castShadow=e.castShadow??!0,this.usesVerticalDistanceToGround=e.usesVerticalDistanceToGround??!1,this.graphicUid=e.graphicUid,this.layerUid=e.layerUid,e.isElevationSource&&(this.lastValidElevationBB=new e$e),this._geometries=e.geometries?Array.from(e.geometries):new Array}dispose(){this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(e){pt(this._parentLayer==null||e==null,"Object3D can only be added to a single Layer"),this._parentLayer=e}addGeometry(e){e.visible=this._visible,this._geometries.push(e),this._emit("geometryAdded",{object:this,geometry:e}),this._invalidateBoundingVolume()}removeGeometry(e){const r=this._geometries.splice(e,1)[0];r&&(this._emit("geometryRemoved",{object:this,geometry:r}),this._invalidateBoundingVolume())}removeAllGeometries(){for(;this._geometries.length>0;)this.removeGeometry(0)}geometryVertexAttributeUpdated(e,r,i=!1){this._emit("attributesChanged",{object:this,geometry:e,attribute:r,sync:i}),Vrt(r)&&this._invalidateBoundingVolume()}get visible(){return this._visible}set visible(e){if(this._visible!==e){this._visible=e;for(const r of this._geometries)r.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const e=new Z6(oy.MaskOccludee);for(const r of this._geometries)r.occludees=nZ(r.occludees,e);return this._emit("occlusionChanged",this),e}removeOcclude(e){for(const r of this._geometries)r.occludees=sZ(r.occludees,e);this._emit("occlusionChanged",this)}highlight(){const e=new Z6(oy.Highlight);for(const r of this._geometries)r.highlights=nZ(r.highlights,e);return this._emit("highlightChanged",this),e}removeHighlight(e){for(const r of this._geometries)r.highlights=sZ(r.highlights,e);this._emit("highlightChanged",this)}getCombinedStaticTransformation(e,r){return Hr(r,this.transformation,e.transformation)}getCombinedShaderTransformation(e,r=xe()){return Hr(r,this.effectiveTransformation,e.transformation)}get boundingVolumeWorldSpace(){return this._bvWorldSpace||(this._bvWorldSpace=this._bvWorldSpace||new Vde,this._validateBoundingVolume(this._bvWorldSpace,fR.WorldSpace)),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._bvObjectSpace||(this._bvObjectSpace=this._bvObjectSpace||new Vde,this._validateBoundingVolume(this._bvObjectSpace,fR.ObjectSpace)),this._bvObjectSpace}_validateBoundingVolume(e,r){const i=r===fR.ObjectSpace;for(const n of this._geometries){const s=n.boundingInfo;s&&npt(s,e,i?n.transformation:this.getCombinedShaderTransformation(n))}ni(e.bounds,e.min,e.max,.5);for(const n of this._geometries){const s=n.boundingInfo;if(s==null)continue;const o=i?n.transformation:this.getCombinedShaderTransformation(n),a=qE(o);Ge(Gde,s.center,o);const l=Di(Gde,e.bounds),c=s.radius*a;e.bounds[3]=Math.max(e.bounds[3],l+c)}}_invalidateBoundingVolume(){var r;const e=(r=this._bvWorldSpace)==null?void 0:r.bounds;this._bvObjectSpace=this._bvWorldSpace=void 0,this._parentLayer&&e&&this._parentLayer.notifyObjectBBChanged(this,e)}_emit(e,r){this._parentLayer&&this._parentLayer.events.emit(e,r)}get test(){const e=this;return{hasGeometry:r=>e._geometries.includes(r),getGeometryIndex:r=>e._geometries.indexOf(r)}}},e$e=class{constructor(){this.min=Ce(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=Ce(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}},Vde=class extends e$e{constructor(){super(...arguments),this.bounds=Jn()}};function npt(t,e,r){const i=t.bbMin,n=t.bbMax;if(i9(r)){const s=ie(spt,r[12],r[13],r[14]);fe(du,i,s),fe(Nd,n,s);for(let o=0;o<3;++o)e.min[o]=Math.min(e.min[o],du[o]),e.max[o]=Math.max(e.max[o],Nd[o])}else if(Ge(du,i,r),zo(i,n))for(let s=0;s<3;++s)e.min[s]=Math.min(e.min[s],du[s]),e.max[s]=Math.max(e.max[s],du[s]);else{Ge(Nd,n,r);for(let s=0;s<3;++s)e.min[s]=Math.min(e.min[s],du[s],Nd[s]),e.max[s]=Math.max(e.max[s],du[s],Nd[s]);for(let s=0;s<3;++s){ce(du,i),ce(Nd,n),du[s]=n[s],Nd[s]=i[s],Ge(du,du,r),Ge(Nd,Nd,r);for(let o=0;o<3;++o)e.min[o]=Math.min(e.min[o],du[o],Nd[o]),e.max[o]=Math.max(e.max[o],du[o],Nd[o])}}}const spt=C(),du=C(),Nd=C(),Gde=C();var fR;(function(t){t[t.WorldSpace=0]="WorldSpace",t[t.ObjectSpace=1]="ObjectSpace"})(fR||(fR={}));function mie(t,e,r,i,n){const s=t.clippingExtent;if(_n(e,A1,t.elevationProvider.spatialReference),s!=null&&!Rte(s,A1))return null;_n(e,A1,t.renderCoordsHelper.spatialReference),r.localOrigin=t.localOriginFactory.getOrigin(A1);const o=new Ey({geometries:[r],castShadow:!1,layerUid:t.layer.uid,graphicUid:n,usesVerticalDistanceToGround:!0});return{object:o,sampledElevation:Oht(o,e,t.elevationProvider,t.renderCoordsHelper,i)}}function W$(t,e,r){const i=t.elevationContext,n=r.spatialReference;_n(e,A1,n),i.centerPointInElevationSR=Nv(A1[0],A1[1],e.hasZ?A1[2]:0,n??null)}function q$(t){switch(t.type){case"point":return t;case"polygon":case"extent":return sie(t);case"polyline":{const e=t.paths[0];if(!e||e.length===0)return null;const r=Qxe(e,Jxe(e)/2);return Nv(r[0],r[1],r[2],t.spatialReference)}case"mesh":return t.origin}return null}const A1=C();function t$e(){return new Float32Array(2)}function opt(t){const e=new Float32Array(2);return e[0]=t[0],e[1]=t[1],e}function Gh(t,e){const r=new Float32Array(2);return r[0]=t,r[1]=e,r}function apt(t,e){return new Float32Array(t,e,2)}function r$e(){return t$e()}function i$e(){return Gh(1,1)}function n$e(){return Gh(1,0)}function s$e(){return Gh(0,1)}const o$e=r$e(),a$e=i$e(),lpt=n$e(),cpt=s$e();Object.freeze(Object.defineProperty({__proto__:null,ONES:a$e,UNIT_X:lpt,UNIT_Y:cpt,ZEROS:o$e,clone:opt,create:t$e,createView:apt,fromValues:Gh,ones:i$e,unitX:n$e,unitY:s$e,zeros:r$e},Symbol.toStringTag,{value:"Module"}));function l$e(t){const e=new Or,{vertex:r,fragment:i}=e;return r.include(CU),e.include(xOe,t),e.include(Fn,t),e.attributes.add(R.UV0,"vec2"),r.uniforms.add(new xr("viewport",(n,s)=>s.camera.fullViewport),new $e("lineSize",(n,s)=>n.size>0?Math.max(1,n.size)*s.camera.pixelRatio:0),new ti("pixelToNDC",(n,s)=>cr(Hde,2/s.camera.fullViewport[2],2/s.camera.fullViewport[3])),new $e("borderSize",(n,s)=>n.borderColor!=null?s.camera.pixelRatio:0),new ti("screenOffset",(n,s)=>cr(Hde,n.horizontalScreenOffset*s.camera.pixelRatio,0))),e.varyings.add("coverageSampling","vec4"),e.varyings.add("lineSizes","vec2"),t.multipassEnabled&&e.varyings.add("depth","float"),t.occlusionTestEnabled&&e.include(BOe),t.hasScreenSizePerspective&&SU(r),r.code.add(T`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 endPoint = projectPositionHUD(projectAux);

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
    ${t.occlusionTestEnabled?T`
      if (!testHUDVisibility(endPoint)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }`:""}

    ${t.hasScreenSizePerspective?T`
      vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);
        `:T`vec2 screenOffsetScaled = screenOffset;`}
      // Add view dependent polygon offset to get exact same original starting point. This is mostly used to get the
      // correct depth value
      vec3 posView = (view * vec4(position, 1.0)).xyz;
      ${t.multipassEnabled?"depth = posView.z;":""}

      applyHUDViewDependentPolygonOffset(centerOffsetAndDistance.w, projectAux.absCosAngle, posView);
      vec4 startPoint = proj * vec4(posView, 1.0);
      // Apply screen offset to both start and end point
      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
      startPoint.xy += screenOffsetNorm * startPoint.w;
      endPoint.xy += screenOffsetNorm * endPoint.w;
      // Align start and end to pixel origin
      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${t.depthHudEnabled?t.depthHudAlignStartEnabled?T`endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);`:T`startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);`:""}
      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);
      // The direction of the line in screen space
      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${t.hasScreenSizePerspective?T`
      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);
        `:T`
      float lineSizeScaled = lineSize;
      float borderSizeScaled = borderSize;
        `}
      float halfPixelSize = lineSizeScaled * 0.5;

      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
      float padding = 1.0 + borderSizeScaled;
      vec2 ndcOffset = (-halfPixelSize - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

      // Offset x/y from the center of the line in screen space
      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

      // Compute a coverage varying which we can use in the fragment shader to determine
      // how much a pixel is actually covered by the line (i.e. to anti alias the line).
      // This works by computing two coordinates that can be linearly interpolated and then
      // subtracted to find out how far away from the line edge we are.
      float edgeDirection = (uv0.x * 2.0 - 1.0);

      float halfBorderSize = 0.5 * borderSizeScaled;
      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

      coverageSampling = vec4(
        // Edge coordinate
        outerEdgeCoverageSampler,

        // Border edge coordinate
        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

        // Line offset
        halfPixelSize - 0.5,

        // Border offset
        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
      );

      lineSizes = vec2(lineSizeScaled, borderSizeScaled);

      gl_Position = projectedPosition;
    }
  `),i.uniforms.add(new xr("uColor",n=>jde(n.color)),new xr("borderColor",n=>jde(n.borderColor))),t.multipassEnabled&&(i.include(dAe,t),i.uniforms.add(new ti("inverseViewport",(n,s)=>s.inverseViewport))),i.code.add(T`
    void main() {
      ${t.multipassEnabled?"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }":""}

      // Mix between line and border coverage offsets depending on whether we need
      // a border (based on the sidedness).
      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

      // Mix between border and line color based on the line coverage (conceptually the line blends on top of the
      // border background).
      //
      // Anti-alias by blending final result using the full (including optional border) coverage and the color alpha
      float borderAlpha = uColor.a * borderColor.a * coverage.y;
      float colorAlpha = uColor.a * coverage.x;

      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);

    ${t.depthHudEnabled?T`
      if (finalAlpha < 0.01) {
        discard;
      }
      `:T`
      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
      fragColor = vec4(finalRgb, finalAlpha);
      `}
  }
  `),e}function jde(t){return t??qu}const Hde=He(),upt=Object.freeze(Object.defineProperty({__proto__:null,build:l$e},Symbol.toStringTag,{value:"Module"}));let c$e=class u$e extends Vr{initializeConfiguration(e,r){r.spherical=e.viewingMode===De.Global}initializeProgram(e){return new Lr(e.rctx,u$e.shader.get().build(this.configuration),Mr)}setPipelineState(e){const r=e?Xr.ALWAYS:Xr.LESS;return this.configuration.depthHudEnabled?kt({depthTest:{func:r},depthWrite:ru}):kt({blending:Wo(Se.ONE,Se.SRC_ALPHA,Se.ONE_MINUS_SRC_ALPHA,Se.ONE_MINUS_SRC_ALPHA),depthTest:{func:r},colorWrite:Yt})}initializePipeline(){return this.setPipelineState(this.configuration.multipassEnabled)}};c$e.shader=new Ir(upt,()=>ge(()=>Promise.resolve().then(()=>qNt),void 0));let Sh=class extends vl{constructor(){super(...arguments),this.screenCenterOffsetUnitsEnabled=!1,this.spherical=!1,this.occlusionTestEnabled=!0,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.depthHudEnabled=!1,this.depthHudAlignStartEnabled=!1,this.hasSlicePlane=!1,this.multipassEnabled=!1}};d([j()],Sh.prototype,"screenCenterOffsetUnitsEnabled",void 0),d([j()],Sh.prototype,"spherical",void 0),d([j()],Sh.prototype,"occlusionTestEnabled",void 0),d([j()],Sh.prototype,"hasVerticalOffset",void 0),d([j()],Sh.prototype,"hasScreenSizePerspective",void 0),d([j()],Sh.prototype,"depthHudEnabled",void 0),d([j()],Sh.prototype,"depthHudAlignStartEnabled",void 0),d([j()],Sh.prototype,"hasSlicePlane",void 0),d([j()],Sh.prototype,"multipassEnabled",void 0),d([j({constValue:!0})],Sh.prototype,"hasSliceInVertexProgram",void 0),d([j({constValue:!1})],Sh.prototype,"draped",void 0);let bN=class IZ extends Bv{get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}constructor(e){super(e,new h$e),this.produces=new Map([[ue.LINE_CALLOUTS,r=>r===U.Color],[ue.LINE_CALLOUTS_HUD_DEPTH,r=>r===U.Color]]),this._configuration=new Sh,this._uniqueMaterialIdentifier=IZ.uniqueMaterialIdentifier(this.parameters)}passParameters(){return this.parameters}getConfiguration(e,r){const i=(r==null?void 0:r.slot)!==ue.LINE_CALLOUTS;return this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.hasVerticalOffset=this.parameters.verticalOffset!=null,this._configuration.hasScreenSizePerspective=this.parameters.screenSizePerspective!=null,this._configuration.depthHudEnabled=i,this._configuration.depthHudAlignStartEnabled=!!this.parameters.depthHUDAlignStart,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen",this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.multipassEnabled=r.multipassEnabled,this._configuration}intersect(){}createGLMaterial(e){return new hpt(e)}createBufferWriter(){return new ppt}validateParameters(e){const r=IZ.uniqueMaterialIdentifier(e);r!==this._uniqueMaterialIdentifier&&(this._uniqueMaterialIdentifier=r)}static uniqueMaterialIdentifier(e){return JSON.stringify({horizontalScreenOffset:e.horizontalScreenOffset??0,centerOffsetUnits:e.centerOffsetUnits||"world"})}},hpt=class extends zv{beginSlot(e){return this.ensureTechnique(c$e,e)}},h$e=class extends Zre{constructor(){super(...arguments),this.horizontalScreenOffset=0,this.color=[0,0,0,1],this.size=1,this.occlusionTest=!1,this.shaderPolygonOffset=1e-5,this.depthHUDAlignStart=!1,this.centerOffsetUnits="world",this.hasSlicePlane=!1}};const dpt=Qi().vec3f(R.POSITION).vec3f(R.NORMAL).vec2f(R.UV0).vec4f(R.CENTEROFFSETANDDISTANCE),Wde=[Gh(0,0),Gh(1,0),Gh(0,1),Gh(1,0),Gh(1,1),Gh(0,1)];let ppt=class{constructor(){this.vertexBufferLayout=dpt}elementCount(e){return 6*e.attributes.get(R.POSITION).indices.length}write(e,r,i,n,s){Jre(i.attributes.get(R.POSITION),e,n.position,s,6),Qre(i.attributes.get(R.NORMAL),r,n.normal,s,6),d3(i.attributes.get(R.CENTEROFFSETANDDISTANCE),n.centerOffsetAndDistance,s,6);for(let o=0;o<Wde.length;++o)n.uv0.setVec(s+o,Wde[o])}},d$e=class p$e extends Sg{constructor(e,r){super(e,null,r,mpt),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){this._materials[0]=new bN(this._materialParameters),this._context.stage.add(this._materials[0])}destroy(){super.destroy(),this._context.stage.remove(this._materials[0]),this._materials.length=0}_perInstanceMaterialParameters(e){const r=this._materialParameters;return r.horizontalScreenOffset=e.horizontalScreenOffset??0,r.centerOffsetUnits=e.centerOffsetUnits||"world",r}get _materialParameters(){var o;const e=new h$e,r=this.symbol,i=r.callout;if(e.color=i.color!=null?Xe.toUnitRGBA(i.color):[0,0,0,0],e.color[3]*=this._getLayerOpacity(),e.size=fs(i.size||0),r.verticalOffset){const{screenLength:a,minWorldLength:l,maxWorldLength:c}=r.verticalOffset;e.verticalOffset={screenLength:fs(a),minWorldLength:l||0,maxWorldLength:c??1/0}}e.borderColor=((o=i.border)==null?void 0:o.color)!=null?Xe.toUnitRGBA(i.border.color):null;const n=r.symbolLayers.at(0).type==="object",s=r.type==="label-3d";return e.occlusionTest=!n,e.shaderPolygonOffset=n?0:void 0,e.depthHUDAlignStart=s,e.hasSlicePlane=this._context.slicePlaneEnabled,e.screenSizePerspective=this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,e}_defaultElevationInfoNoZ(){return fpt}createGraphics3DGraphic(e){const r=e.renderingInfo,i=e.graphic,n=this.setGraphicElevationContext(i,new f8,r.elevationOffset||0),s=r.symbol,o=this._elevationContext.mode==="on-the-ground"&&(s.type==="cim"||!s.symbolLayers.some(l=>l.type==="object"||l.type==="text"));if(s.type!=="label-3d"&&o||s.type==="point-3d"&&s.symbolLayers.every(l=>l.type==="text"&&!v3e(l)))return null;const a=sie(i.geometry);return a==null?null:this._createAs3DShape(a,n,r,i.uid)}layerOpacityChanged(){var e;(e=this._materials[0])==null||e.setParameters(this._materialParameters)}layerElevationInfoChanged(e,r,i){const n=this._elevationContext.mode,s=eL(p$e.elevationModeChangeTypes,i,n);return s!==En.UPDATE||e.forEach(o=>{const a=r(o);a!=null&&this.updateGraphicElevationContext(o.graphic,a)}),s}slicePlaneEnabledChanged(){var e;return(e=this._materials[0])==null||e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}setGraphicElevationContext(e,r,i=0){return super.setGraphicElevationContext(e,r),r.addOffsetRenderUnits(i),r}updateGraphicElevationContext(e,r){this.setGraphicElevationContext(e,r.elevationContext,r.metadata!=null?r.metadata.elevationOffset:0),r.needsElevationUpdates=bd(r.elevationContext.mode)}computeComplexity(){return new Fh({verticesPerFeature:6})}_createVertexData(e){const{translation:r,centerOffset:i}=e,n=new Ye(r?[r[0],r[1],r[2]]:[0,0,0],B7,3,!0),s=new Ye(i?[i[0],i[1],i[2],i[3]]:[0,0,0,1],B7,4,!0);return[[R.POSITION,n],[R.NORMAL,new Ye([0,0,1],B7,3,!0)],[R.CENTEROFFSETANDDISTANCE,s]]}_getOrCreateMaterial(e){var n;const r=this._perInstanceMaterialParameters(e),i=bN.uniqueMaterialIdentifier(r);if(i===((n=this._materials[0])==null?void 0:n.uniqueMaterialIdentifier))return{material:this._materials[0],isUnique:!1};if(e.materialCollection!=null){let s=e.materialCollection.get(i);return s==null&&(s=new bN(r),e.materialCollection.add(i,s)),{material:s,isUnique:!1}}return{material:new bN(r),isUnique:!0}}_createAs3DShape(e,r,i,n){const s=this._context.layer.uid,o=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:n,layerUid:s}),a=this._getOrCreateMaterial(i),l=new gs(a.material,this._createVertexData(i),null,Cn.Point,o),c=mie(this._context,e,l,r,n);if(c==null)return null;const u=new Tg(this,c.object,[l],a.isUnique?[a.material]:null,null,Lx,r);return u.metadata=new dRe(i.elevationOffset),u.alignedSampledElevation=c.sampledElevation,u.needsElevationUpdates=bd(r.mode),W$(u,e,this._context.elevationProvider),u}};d$e.elevationModeChangeTypes={definedChanged:En.UPDATE,staysOnTheGround:En.UPDATE,onTheGroundChanged:En.RECREATE};const B7=[0],fpt={mode:"relative-to-ground",offset:0},mpt={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};let gpt=class{constructor(e,r,i=C(),n=Zt(),s=0,o="world",a=0,l=null){this.renderer=e,this.symbol=r,this.translation=i,this.centerOffset=n,this.horizontalScreenOffset=s,this.centerOffsetUnits=o,this.elevationOffset=a,this.materialCollection=l}},ypt=class extends Xht{};const qde=()=>re.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");function _pt(t,e){if(!zte(t))return qde().error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${t.type}' does not support callouts`),null;if(!t.callout)return null;const r=vpt[t.callout.type];return r?new r(t,e):(qde().error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${t.callout.type}`),null)}const vpt={line:d$e},gie=(t,e,r)=>[e,r],m3=(t,e,r)=>[e,r,t[2]],yie=(t,e,r)=>[e,r,t[2],t[3]];function o7t(t){return t?{originPosition:t.originPosition==="upper-left"?"upperLeft":t.originPosition==="lower-left"?"lowerLeft":t.originPosition,scale:t.tolerance?[t.tolerance,t.tolerance]:[1,1],translate:t.extent!=null?[t.extent.xmin,t.extent.ymax]:[0,0]}:null}function bpt({scale:t,translate:e},r){return Math.round((r-e[0])/t[0])}function wpt({scale:t,translate:e},r){return Math.round((e[1]-r)/t[1])}function f$e({scale:t,translate:e},r){return r*t[0]+e[0]}function m$e({scale:t,translate:e},r){return e[1]-r*t[1]}function g$e(t,e,r){const i=new Array(r.length);if(!r.length)return i;const[n,s]=t.scale;let o=f$e(t,r[0][0]),a=m$e(t,r[0][1]);i[0]=e(r[0],o,a);for(let l=1;l<r.length;l++){const c=r[l];o+=c[0]*n,a-=c[1]*s,i[l]=e(c,o,a)}return i}function y$e(t,e,r){const i=new Array(r.length);for(let n=0;n<r.length;n++)i[n]=g$e(t,e,r[n]);return i}function xpt(t,e,r,i){return g$e(t,r?i?yie:m3:i?m3:gie,e)}function Tpt(t,e,r,i){return y$e(t,r?i?yie:m3:i?m3:gie,e)}function Spt(t,e,r,i){return y$e(t,r?i?yie:m3:i?m3:gie,e)}function a7t(t,e,r,i,n){return e.x=bpt(t,r.x),e.y=wpt(t,r.y),e!==r&&(i&&(e.z=r.z),n&&(e.m=r.m)),e}function _$e(t,e,r,i,n){return r!=null&&(e.points=xpt(t,r.points,i,n)),e}function v$e(t,e,r,i,n){return r==null||(e.x=f$e(t,r.x),e.y=m$e(t,r.y),e!==r&&(i&&(e.z=r.z),n&&(e.m=r.m))),e}function b$e(t,e,r,i,n){return r!=null&&(e.rings=Spt(t,r.rings,i,n)),e}function w$e(t,e,r,i,n){return r!=null&&(e.paths=Tpt(t,r.paths,i,n)),e}let l7t=class{constructor(e,r,i){this.uid=e,this.geometry=r,this.attributes=i,this.visible=!0,this.objectId=null,this.centroid=null}};function u7t(t){return t.geometry!=null}let h7t=class{constructor(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}};function p7t(t,e){var u;const r=_2e.fromJSON(t.geometryType),i=lt.fromJSON(t.spatialReference),n=t.transform,s=t.objectIdFieldName,o=e==null?void 0:e.maxStringAttributeLength,a=e==null?void 0:e.maxStringAttributeFields;let l;const c=t.features.map(h=>{const p=Cpt(h,r,i,t.objectIdFieldName),f=p.geometry;if(Opt(p.attributes,a,o,g=>{l??(l=[]);const _=Mpt(p,s);_!=null&&l.push({objectId:_,attribute:g})}),f!=null&&n)switch(f.type){case"point":p.geometry=v$e(n,f,f,f.hasZ,f.hasM);break;case"multipoint":p.geometry=_$e(n,f,f,!!f.hasZ,!!f.hasM);break;case"polygon":p.geometry=b$e(n,f,f,!!f.hasZ,!!f.hasM);break;case"polyline":p.geometry=w$e(n,f,f,!!f.hasZ,!!f.hasM);break;case"extent":case"mesh":p.geometry=f}return p});return{geometryType:r,features:c,spatialReference:i,fields:((u=t.fields)==null?void 0:u.map(h=>D3e.fromJSON(h)))??[],objectIdFieldName:t.objectIdFieldName,globalIdFieldName:t.globalIdFieldName,geohashFieldName:t.geohashFieldName,geometryProperties:t.geometryProperties,hasZ:t.hasZ,hasM:t.hasM,exceededTransferLimit:t.exceededTransferLimit,transform:null,missingAttributes:l}}function Cpt(t,e,r,i){return{uid:Gu(),objectId:i&&t.attributes?t.attributes[i]:null,attributes:t.attributes,geometry:Ept(t.geometry,e,r),visible:!0}}function Ept(t,e,r){if(t==null)return null;switch(e){case"point":{const i=t;return{x:i.x,y:i.y,z:i.z,m:i.m,hasZ:i.z!=null,hasM:i.m!=null,type:"point",spatialReference:r}}case"polyline":{const i=t;return{paths:i.paths,hasZ:!!i.hasZ,hasM:!!i.hasM,type:"polyline",spatialReference:r}}case"polygon":{const i=t;return{rings:i.rings,hasZ:!!i.hasZ,hasM:!!i.hasM,type:"polygon",spatialReference:r}}case"multipoint":{const i=t;return{points:i.points,hasZ:!!i.hasZ,hasM:!!i.hasM,type:"multipoint",spatialReference:r}}}}function Ppt(t){if(t==null)return 0;let e=32;switch(t.type){case"point":e+=42;break;case"polyline":case"polygon":{let r=0;const i=2+(t.hasZ?1:0)+(t.hasM?1:0),n=t.type==="polyline"?t.paths:t.rings;for(const s of n)r+=s.length;e+=8*r*i+64,e+=128*r,e+=34,e+=32*(n.length+1);break}case"multipoint":{const r=2+(t.hasZ?1:0)+(t.hasM?1:0),i=t.points.length;e+=8*i*r+64,e+=128*i,e+=34,e+=32;break}case"extent":e+=98,t.hasM&&(e+=32),t.hasZ&&(e+=32);break;case"mesh":e+=K1(t.vertexAttributes.position,t.vertexAttributes.normal,t.vertexAttributes.uv,t.vertexAttributes.tangent)}return e}function f7t(t){let e=32;return e+=nbe(t.attributes),e+=3,e+=8+Ppt(t.geometry),e}function m7t(t){if(t==null)return 0;switch(t.type){case"point":return 1;case"polyline":{let e=0;for(const r of t.paths)e+=r.length;return e}case"polygon":{let e=0;for(const r of t.rings)e+=r.length;return e}case"multipoint":return t.points.length;case"extent":return 2;case"mesh":{const e=t.vertexAttributes&&t.vertexAttributes.position;return e?e.length/3:0}default:return}}function g7t(t){if(t==null)return!1;switch(t.type){case"extent":case"point":return!0;case"polyline":for(const e of t.paths)if(e.length>0)return!0;return!1;case"polygon":for(const e of t.rings)if(e.length>0)return!0;return!1;case"multipoint":return t.points.length>0;case"mesh":return!t.loaded||t.vertexAttributes.position.length>0}}function y7t(t,e){switch(Li(e),t.type==="mesh"&&(t=t.extent),t.type){case"point":e[0]=e[3]=t.x,e[1]=e[4]=t.y,t.hasZ&&(e[2]=e[5]=t.z);break;case"polyline":for(let r=0;r<t.paths.length;r++)CV(e,t.paths[r],!!t.hasZ);break;case"polygon":for(let r=0;r<t.rings.length;r++)CV(e,t.rings[r],!!t.hasZ);break;case"multipoint":CV(e,t.points,!!t.hasZ);break;case"extent":e[0]=t.xmin,e[1]=t.ymin,e[3]=t.xmax,e[4]=t.ymax,t.zmin!=null&&(e[2]=t.zmin),t.zmax!=null&&(e[5]=t.zmax)}}function Apt(t,e){switch(Ku(e),t.type==="mesh"&&(t=t.extent),t.type){case"point":e[0]=e[2]=t.x,e[1]=e[3]=t.y;break;case"polyline":for(let r=0;r<t.paths.length;r++)JB(e,t.paths[r]);break;case"polygon":for(let r=0;r<t.rings.length;r++)JB(e,t.rings[r]);break;case"multipoint":JB(e,t.points);break;case"extent":e[0]=t.xmin,e[1]=t.ymin,e[2]=t.xmax,e[3]=t.ymax}}function Mpt(t,e){return t.objectId!=null?t.objectId:t.attributes&&e?t.attributes[e]:null}function Opt(t,e,r,i){if(e!=null&&e.size&&r!=null&&t)for(const n in t){if(!e.has(n))continue;const s=t[n];typeof s=="string"&&s.length>r&&(i(n),t[n]="")}}let g3=class LZ{constructor(e=null,r={},i,n){this.geometry=e,this.attributes=r,this.centroid=i,this.objectId=n,this.displayId=0,this.geohashX=0,this.geohashY=0}weakClone(){const e=new LZ(this.geometry,this.attributes,this.centroid,this.objectId);return e.displayId=this.displayId,e.geohashX=this.geohashX,e.geohashY=this.geohashY,e}clone(){var i,n;const e=(i=this.geometry)==null?void 0:i.clone(),r=new LZ(e,{...this.attributes},(n=this.centroid)==null?void 0:n.clone(),this.objectId);return r.displayId=this.displayId,r.geohashX=this.geohashX,r.geohashY=this.geohashY,r}};function _7t(t){var e,r;return!!((r=(e=t.geometry)==null?void 0:e.coords)!=null&&r.length)}let Rpt=class x$e{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const e=new x$e;return e.objectIdFieldName=this.objectIdFieldName,e.globalIdFieldName=this.globalIdFieldName,e.geohashFieldName=this.geohashFieldName,e.geometryProperties=this.geometryProperties,e.geometryType=this.geometryType,e.spatialReference=this.spatialReference,e.hasZ=this.hasZ,e.hasM=this.hasM,e.features=this.features,e.fields=this.fields,e.transform=this.transform,e.exceededTransferLimit=this.exceededTransferLimit,e.uniqueIdField=this.uniqueIdField,e.queryGeometry=this.queryGeometry,e.queryGeometryType=this.queryGeometryType,e}};const V7=2;let wd=class DM{constructor(e=[],r=[],i=!1){this.lengths=e??[],this.coords=r??[],this.hasIndeterminateRingOrder=i}static fromRect(e){const[r,i,n,s]=e,o=n-r,a=s-i;return new DM([5],[r,i,o,0,0,a,-o,0,0,-a])}get isPoint(){return this.lengths.length===0}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce((e,r)=>e+r)}forEachVertex(e){let r=0;this.lengths.length||e(this.coords[0],this.coords[1]);for(let i=0;i<this.lengths.length;i++){const n=this.lengths[i];for(let s=0;s<n;s++)e(this.coords[V7*(s+r)],this.coords[V7*(s+r)+1]);r+=n}}deltaDecode(){const e=this.clone(),{coords:r,lengths:i}=e;let n=0;for(const s of i){for(let o=1;o<s;o++)r[2*(n+o)]+=r[2*(n+o)-2],r[2*(n+o)+1]+=r[2*(n+o)-1];n+=s}return e}clone(e){if(this.lengths.length===0)return new DM([],[this.coords[0],this.coords[1]]);const r=(this.lengths.length===0?1:this.lengths.reduce((n,s)=>n+s))*V7,i=this.coords.slice(0,r);return e?(e.set(i),new DM(this.lengths,e,this.hasIndeterminateRingOrder)):new DM(Array.from(this.lengths),Array.from(i),this.hasIndeterminateRingOrder)}};function Ua(t,e){return t?e?4:3:e?3:2}const oL=()=>re.getLogger("esri.layers.graphics.featureConversionUtils"),T$e={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0,esriGeometryEnvelope:0},$pt=(t,e,r,i,n,s)=>{t[r]=n,t[r+1]=s},Yde=(t,e,r,i,n,s)=>{t[r]=n,t[r+1]=s,t[r+2]=e[i+2]},Ipt=(t,e,r,i,n,s)=>{t[r]=n,t[r+1]=s,t[r+2]=e[i+3]},Lpt=(t,e,r,i,n,s)=>{t[r]=n,t[r+1]=s,t[r+2]=e[i+2],t[r+3]=e[i+3]};function _ie(t,e,r,i){if(t){if(r)return e&&i?Lpt:Yde;if(e&&i)return Ipt}else if(e&&i)return Yde;return $pt}function G7({scale:t,translate:e},r){return Math.round((r-e[0])/t[0])}function j7({scale:t,translate:e},r){return Math.round((e[1]-r)/t[1])}function H7({scale:t,translate:e},r,i){return r*t[i]+e[i]}function v7t(t,e,r){return t?e?r?wie(t):vie(t):r?bie(t):NU(t):null}function NU(t){const e=t.coords;return{x:e[0],y:e[1]}}function S$e(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t}function vie(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2]}}function Dpt(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t}function bie(t){const e=t.coords;return{x:e[0],y:e[1],m:e[2]}}function Npt(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.m,t}function wie(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2],m:e[3]}}function Fpt(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t.coords[3]=e.m,t}function kpt(t,e,r,i){let n=NU;r&&i?n=wie:r?n=vie:i&&(n=bie);for(const s of e){const{geometry:o,attributes:a}=s,l=o!=null?n(o):null;t.push({attributes:a,geometry:l})}return t}function xie(t,e){return t&&e?Fpt:t?Dpt:e?Npt:S$e}function zpt(t,e,r,i,n){const s=xie(r,i);for(const{geometry:o,attributes:a}of e){const l=o!=null?s(new wd,o):null;t.push(new g3(l,a,null,n?a[n]:void 0))}return t}function Upt(t,e,r=xie(e.z!=null,e.m!=null)){return r(t,e)}function Bpt(t,e,r,i){for(const{geometry:n,attributes:s}of e)t.push({attributes:s,geometry:n!=null?C$e(n,r,i):null});return t}function C$e(t,e,r){if(t==null)return null;const i=Ua(e,r),n=[];for(let s=0;s<t.coords.length;s+=i){const o=[];for(let a=0;a<i;a++)o.push(t.coords[s+a]);n.push(o)}return e?r?{points:n,hasZ:e,hasM:r}:{points:n,hasZ:e}:r?{points:n,hasM:r}:{points:n}}function Vpt(t,e,r,i,n){const s=Ua(r,i);for(const{geometry:o,attributes:a}of e){const l=o!=null?E$e(new wd,o,s):null;t.push(new g3(l,a,null,n?a[n]:void 0))}return t}function E$e(t,e,r=Ua(e.hasZ,e.hasM)){t.lengths[0]=e.points.length;const i=t.coords;let n=0;for(const s of e.points)for(let o=0;o<r;o++)i[n++]=s[o];return t}function Gpt(t,e,r,i){for(const{geometry:n,attributes:s}of e)t.push({attributes:s,geometry:n!=null?P$e(n,r,i):null});return t}function P$e(t,e,r){if(!t)return null;const i=Ua(e,r),{coords:n,lengths:s}=t,o=[];let a=0;for(const l of s){const c=[];for(let u=0;u<l;u++){const h=[];for(let p=0;p<i;p++)h.push(n[a++]);c.push(h)}o.push(c)}return e?r?{paths:o,hasZ:e,hasM:r}:{paths:o,hasZ:e}:r?{paths:o,hasM:r}:{paths:o}}function jpt(t,e,r,i,n){const s=Ua(r,i);for(const{geometry:o,attributes:a,centroid:l}of e){const c=o!=null?A$e(new wd,o,s):null,u=l!=null?Upt(new wd,l):null;t.push(new g3(c,a,u,n?a[n]:void 0))}return t}function A$e(t,e,r=Ua(e.hasZ,e.hasM)){const{lengths:i,coords:n}=t;let s=0;for(const o of e.paths){for(const a of o)for(let l=0;l<r;l++)n[s++]=a[l];i.push(o.length)}return t}function Hpt(t,e,r,i){for(const{geometry:n,attributes:s,centroid:o}of e){const a=n!=null?M$e(n,r,i):null;if(o!=null){const l=NU(o);t.push({attributes:s,centroid:l,geometry:a})}else t.push({attributes:s,geometry:a})}return t}function M$e(t,e,r){if(!t)return null;const i=Ua(e,r),{coords:n,lengths:s}=t,o=[];let a=0;for(const l of s){const c=[];for(let u=0;u<l;u++){const h=[];for(let p=0;p<i;p++)h.push(n[a++]);c.push(h)}o.push(c)}return e?r?{rings:o,hasZ:e,hasM:r}:{rings:o,hasZ:e}:r?{rings:o,hasM:r}:{rings:o}}function Wpt(t,e,r,i,n){for(const{geometry:s,centroid:o,attributes:a}of e){const l=s!=null?O$e(new wd,s,r,i):null,c=n?a[n]:void 0;o!=null?t.push(new g3(l,a,S$e(new wd,o),c)):t.push(new g3(l,a,null,c))}return t}function O$e(t,e,r=e.hasZ,i=e.hasM){return qpt(t,e.rings,r,i)}function qpt(t,e,r,i){const n=Ua(r,i),{lengths:s,coords:o}=t;let a=0;V0(t);for(const l of e){for(const c of l)for(let u=0;u<n;u++)o[a++]=c[u];s.push(l.length)}return t}const lE=[],mR=[];function b7t(t,e,r,i,n){lE[0]=t;const[s]=R$e(mR,lE,e,r,i,n);return df(lE),df(mR),s}function R$e(t,e,r,i,n,s){if(df(t),!r){for(const o of e){const a=s?o.attributes[s]:void 0;t.push(new g3(null,o.attributes,null,a))}return t}switch(r){case"esriGeometryPoint":return zpt(t,e,i,n,s);case"esriGeometryMultipoint":return Vpt(t,e,i,n,s);case"esriGeometryPolyline":return jpt(t,e,i,n,s);case"esriGeometryPolygon":return Wpt(t,e,i,n,s);default:oL().error("convertToFeatureSet:unknown-geometry",new K(`Unable to parse unknown geometry type '${r}'`)),df(t)}return t}function w7t(t,e,r,i){mR[0]=t,$$e(lE,mR,e,r,i);const n=lE[0];return df(lE),df(mR),n}function Ypt(t,e,r){if(t==null)return null;const i=new wd;return"hasZ"in t&&e==null&&(e=t.hasZ),"hasM"in t&&r==null&&(r=t.hasM),zE(t)?xie(e??t.z!=null,r??t.m!=null)(i,t):zc(t)?O$e(i,t,e,r):Ip(t)?A$e(i,t,Ua(e,r)):Cx(t)?E$e(i,t,Ua(e,r)):void oL().error("convertFromGeometry:unknown-geometry",new K(`Unable to parse unknown geometry type '${t}'`))}function Xpt(t,e,r,i){const n=t&&("coords"in t?t:t.geometry);if(n==null)return null;switch(e){case"esriGeometryPoint":{let s=NU;return r&&i?s=wie:r?s=vie:i&&(s=bie),s(n)}case"esriGeometryMultipoint":return C$e(n,r,i);case"esriGeometryPolyline":return P$e(n,r,i);case"esriGeometryPolygon":return M$e(n,r,i);default:return oL().error("convertToGeometry:unknown-geometry",new K(`Unable to parse unknown geometry type '${e}'`)),null}}function Zpt(t,e){for(const r of e)t.push({attributes:r.attributes});return t}function $$e(t,e,r,i,n){if(df(t),r==null)return Zpt(t,e);switch(r){case"esriGeometryPoint":return kpt(t,e,i,n);case"esriGeometryMultipoint":return Bpt(t,e,i,n);case"esriGeometryPolyline":return Gpt(t,e,i,n);case"esriGeometryPolygon":return Hpt(t,e,i,n);default:oL().error("convertToFeatureSet:unknown-geometry",new K(`Unable to parse unknown geometry type '${r}'`))}return t}function x7t(t){const{objectIdFieldName:e,spatialReference:r,transform:i,fields:n,hasM:s,hasZ:o,features:a,geometryType:l,exceededTransferLimit:c,uniqueIdField:u,queryGeometry:h,queryGeometryType:p}=t,f={features:$$e([],a,l,o,s),fields:n,geometryType:l,objectIdFieldName:e,spatialReference:r,uniqueIdField:u,queryGeometry:Xpt(h,p,!1,!1)};return i&&(f.transform=i),c&&(f.exceededTransferLimit=c),s&&(f.hasM=s),o&&(f.hasZ=o),f}function T7t(t,e){const r=new Rpt,{hasM:i,hasZ:n,features:s,objectIdFieldName:o,spatialReference:a,geometryType:l,exceededTransferLimit:c,transform:u,fields:h}=t;return h&&(r.fields=h),r.geometryType=l??null,r.objectIdFieldName=o??e??null,r.spatialReference=a??null,r.objectIdFieldName?(s&&R$e(r.features,s,l,n,i,r.objectIdFieldName),c&&(r.exceededTransferLimit=c),i&&(r.hasM=i),n&&(r.hasZ=n),u&&(r.transform=u),r):(oL().error(new K("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),r)}function S7t(t){const{transform:e,features:r,hasM:i,hasZ:n}=t;if(!e)return t;for(const s of r)s.geometry!=null&&Zde(s.geometry,s.geometry,i,n,e),s.centroid!=null&&Zde(s.centroid,s.centroid,i,n,e);return t.transform=null,t}function C7t(t,e){const{geometryType:r,features:i,hasM:n,hasZ:s}=e;if(!t)return e;for(let o=0;o<i.length;o++){const a=i[o],l=a.weakClone();l.geometry=new wd,Xde(l.geometry,a.geometry,n,s,r,t),a.centroid&&(l.centroid=new wd,Xde(l.centroid,a.centroid,n,s,"esriGeometryPoint",t)),i[o]=l}return e.transform=t,e}function Xde(t,e,r,i,n,s,o=r,a=i){if(V0(t),!(e!=null&&e.coords.length))return null;const l=T$e[n],{coords:c,lengths:u}=e,h=Ua(r,i),p=Ua(r&&o,i&&a),f=_ie(r,i,o,a);if(!u.length)return f(t.coords,c,0,0,G7(s,c[0]),j7(s,c[1])),V0(t,h,0),t;let g,_,v,b,w=0,x=0,S=x;for(const E of u){if(E<l)continue;let A=0;x=S,v=g=G7(s,c[w]),b=_=j7(s,c[w+1]),f(t.coords,c,x,w,v,b),A++,w+=h,x+=p;for(let O=1;O<E;O++,w+=h)v=G7(s,c[w]),b=j7(s,c[w+1]),v===g&&b===_||(f(t.coords,c,x,w,v-g,b-_),x+=p,A++,g=v,_=b);A>=l&&(t.lengths.push(A),S=x)}return df(t.coords,S),t.coords.length?t:null}function E7t(t,e,r,i,n,s,o=r,a=i){if(V0(t),!(e!=null&&e.coords.length))return null;const l=T$e[n],{coords:c,lengths:u}=e,h=Ua(r,i),p=Ua(r&&o,i&&a),f=_ie(r,i,o,a);if(!u.length)return f(t.coords,c,0,0,c[0],c[1]),V0(t,h,0),t;let g=0;const _=s*s;for(const v of u){if(v<l){g+=v*h;continue}const b=t.coords.length/p,w=g,x=g+(v-1)*h;f(t.coords,c,t.coords.length,w,c[w],c[w+1]),DZ(t.coords,c,h,_,f,w,x),f(t.coords,c,t.coords.length,x,c[x],c[x+1]);const S=t.coords.length/p-b;S>=l?t.lengths.push(S):df(t.coords,b*p),g+=v*h}return t.coords.length?t:null}function Jpt(t,e,r,i){const n=t[e],s=t[e+1],o=t[r],a=t[r+1],l=t[i],c=t[i+1];let u=o,h=a,p=l-u,f=c-h;if(p!==0||f!==0){const g=((n-u)*p+(s-h)*f)/(p*p+f*f);g>1?(u=l,h=c):g>0&&(u+=p*g,h+=f*g)}return p=n-u,f=s-h,p*p+f*f}function DZ(t,e,r,i,n,s,o){let a,l=i,c=0;for(let u=s+r;u<o;u+=r)a=Jpt(e,u,s,o),a>l&&(c=u,l=a);l>i&&(c-s>r&&DZ(t,e,r,i,n,s,c),n(t,e,t.length,c,e[c],e[c+1]),o-c>r&&DZ(t,e,r,i,n,c,o))}function P7t(t,e,r,i){var c;if(!((c=e==null?void 0:e.coords)!=null&&c.length))return null;const n=Ua(r,i);let s=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY;if(e&&e.coords){const u=e.coords;for(let h=0;h<u.length;h+=n){const p=u[h],f=u[h+1];s=Math.min(s,p),a=Math.max(a,p),o=Math.min(o,f),l=Math.max(l,f)}}return sY(t)?Ret(t,s,o,a,l):o9(s,o,a,l,t),t}function Zde(t,e,r,i,n){const{coords:s,lengths:o}=e,a=Ua(r,i);if(!s.length)return t!==e&&V0(t),t;Rz(n);const{originPosition:l,scale:c,translate:u}=n,h=Kpt;h.originPosition=l;const p=h.scale;p[0]=c[0]??1,p[1]=-(c[1]??1),p[2]=c[2]??1,p[3]=c[3]??1;const f=h.translate;if(f[0]=u[0]??0,f[1]=u[1]??0,f[2]=u[2]??0,f[3]=u[3]??0,!o.length){for(let _=0;_<a;++_)t.coords[_]=H7(h,s[_],_);return t!==e&&V0(t,a,0),t}let g=0;for(let _=0;_<o.length;_++){const v=o[_];t.lengths[_]=v;for(let x=0;x<a;++x)t.coords[g+x]=H7(h,s[g+x],x);let b=t.coords[g],w=t.coords[g+1];g+=a;for(let x=1;x<v;x++,g+=a){b+=s[g]*p[0],w+=s[g+1]*p[1],t.coords[g]=b,t.coords[g+1]=w;for(let S=2;S<a;++S)t.coords[g+S]=H7(h,s[g+S],S)}}return t!==e&&V0(t,s.length,o.length),t}function A7t(t,e,r,i,n,s){if(V0(t),t.lengths.push(...e.lengths),r===n&&i===s)for(let o=0;o<e.coords.length;o++)t.coords.push(e.coords[o]);else{const o=Ua(r,i),a=_ie(r,i,n,s),l=e.coords;for(let c=0;c<l.length;c+=o)a(t.coords,l,t.coords.length,c,l[c],l[c+1])}return t}function Qpt(t,e,r,i){let n=0,s=t[i*e],o=t[i*(e+1)];for(let a=1;a<r;a++){const l=s+t[i*(e+a)],c=o+t[i*(e+a)+1],u=(l-s)*(c+o);s=l,o=c,n+=u}return .5*n}function M7t(t,e){const{coords:r,lengths:i}=t;let n=0,s=0;for(let o=0;o<i.length;o++){const a=i[o];s+=Qpt(r,n,a,e),n+=a}return Math.abs(s)}function V0(t,e=0,r=0){df(t.lengths,r),df(t.coords,e)}function df(t,e=0){t.length!==e&&(t.length=e)}const Kpt={originPosition:"lowerLeft",scale:[1,1,1,1],translate:[0,0,0,0]},Jde=new ua(Array,t=>Y9(t,Lte),null,10,5),eft=Wt();let tft=class{get labelLayers(){return this._labelLayers||_ze}get extent(){return this._extent}get isElevationSource(){return this.layers.some(e=>e==null?void 0:e.isElevationSource)}constructor(e,r,i,n,s){this.graphic=e,this.graphics3DSymbol=r,this.layers=i,this._visibleFlags=sa.ALL_LABEL,this.deconflictionPriority=0,++r.referenced,this._featureExpressionFeature=s?lRe(s,e,n):null}initialize(e){this._layer=e,this._forEachSymbolLayerGraphic(r=>{r.initialize(e),r.setVisibility(this.isVisible())})}destroy(){this._forEachSymbolLayerGraphic(e=>e.destroy()),this._calloutLayer=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}get destroyed(){return this.layers==null}clearLabelGraphics(){this._forEachLabelGraphic(e=>e.destroy()),this._labelLayers=null}addLabelGraphic(e,r){this._labelLayers||(this._labelLayers=new Array),this._labelLayers.push(e),e.initialize(r),e.setVisibility(this.isVisible(vo.LABEL))}setCalloutGraphic(e){this._calloutLayer=e,this._layer&&(e.initialize(this._layer),e.setVisibility(this.isVisible()))}get calloutLayer(){return this._calloutLayer}get isDraped(){let e=!1;return this._forEachSymbolLayerGraphic(r=>{r.type==="draped"&&(e=!0)}),e}isVisible(e=vo.GRAPHIC,r){const i=r?this._visibleFlags|r|vo.LABEL*r:this._visibleFlags;return e===vo.GRAPHIC?(i&sa.ALL_GRAPHIC)===sa.ALL_GRAPHIC:(i&sa.ALL_LABEL)===sa.ALL_LABEL}setVisibilityFlag(e,r,i){const n=this.isVisible(e);i?this._visibleFlags|=e*r:this._visibleFlags&=~(e*r);const s=this.isVisible(e);if(n===s)return!1;if(e===vo.LABEL)this._forEachLabelGraphic(o=>o.setVisibility(s));else{this._forEachSymbolLayerGraphic(a=>a.setVisibility(s));const o=this.isVisible(vo.LABEL);this._forEachLabelGraphic(a=>a.setVisibility(o))}return!0}getVisibilityFlag(e,r){return(this._visibleFlags&e*r)!=0}computeExtent(e){if(!this._extent){const r=this.graphic.geometry;if(r==null)return!1;this._extent=Wt(),Apt(r,this._extent);const i=r.spatialReference;if(!To(i,e)&&!S9(this._extent,i,this._extent,e))return this._extent=null,!1}return!0}getAsOptimizedGeometry(e,r){return this._optimizedGeometry||(this._optimizedGeometry=this._convertGraphicToOptimizedGeometry(this.graphic,e,r)),this._optimizedGeometry}_convertGraphicToOptimizedGeometry(e,r,i){let n=e.geometry;return n.type!=="mesh"&&n.type!=="extent"||(n=nf.fromExtent(n.type==="mesh"?n.extent:n)),Ypt(n,r,i)}get usedMemory(){let e=nbe(this.graphic.attributes);return this._forEachSymbolLayerGraphic(r=>e+=r.graphics3DSymbolLayer.usedMemory),e}computeAttachmentOrigin(){const e={render:{origin:C(),num:0},draped:{origin:He(),num:0}};for(const r of this.layers)r!=null&&r.computeAttachmentOrigin(e);return e.render.num>1&&ne(e.render.origin,e.render.origin,1/e.render.num),e.draped.num>1&&Uc(e.draped.origin,e.draped.origin,1/e.draped.num),e}async getProjectedBoundingBox(e,r,i,n,s){return s||(s={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),s.boundingBox?Li(s.boundingBox):s.boundingBox=Li(),s.requiresDrapedElevation=!1,await jz(this.layers,async o=>{if(o==null)return;const a=o.type==="draped"?r:e,l=Jde.acquire(),c=await o.getProjectedBoundingBox(a,i,s.screenSpaceObjects,n,l);isFinite(c[2])&&isFinite(c[5])||(s.requiresDrapedElevation=!0),c&&t3(s.boundingBox,l),Jde.release(l)}),Met(s.boundingBox)||kW($te(s.boundingBox,eft))?s:null}needsElevationUpdates(){var e;for(const r of this.layers)if(r!=null&&(r.type==="object3d"||r.type==="lod-instance")&&r.needsElevationUpdates)return!0;return((e=this._labelLayers)==null?void 0:e.some(r=>(r==null?void 0:r.needsElevationUpdates)??!1))??!1}alignWithElevation(e,r,i){this._forEachRenderedGraphic(n=>{n.type!=="object3d"&&n.type!=="lod-instance"||n.alignWithElevation(e,r,this._featureExpressionFeature,i)})}alignWithAbsoluteElevation(e,r,i){this._forEachRenderedGraphic(n=>{n.type==="object3d"&&n.alignWithAbsoluteElevation(e,r,i)})}addObjectStateSet(e,r){this._forEachSymbolLayerGraphic(i=>i.addObjectState(e,r))}removeObjectState(e){this._forEachSymbolLayerGraphic(r=>r.removeObjectState(e))}_forEachGraphicList(e,r){e==null||e.forEach(i=>i&&r(i))}_forEachSymbolLayerGraphic(e){this._forEachGraphicList(this.layers,e),this._calloutLayer&&e(this._calloutLayer)}_forEachLabelGraphic(e){this._forEachGraphicList(this._labelLayers,e)}_forEachRenderedGraphic(e){this._forEachSymbolLayerGraphic(e),this._forEachLabelGraphic(e)}get test(){const e=this;return{addLabelLayer:r=>{e._labelLayers||(e._labelLayers=new Array),e._labelLayers.push(r)}}}},R7t=class{constructor(e,r){this.scheduler=e,this.schedule=r,this.sharedResources=null,this.streamDataRequester=null,this.elevationProvider=null,this.renderer=null,this.stage=null,this.clippingExtent=null,this.renderCoordsHelper=null,this.overlaySR=null,this.layer=null,this.drapeSourceRenderer=null,this.graphicsCoreOwner=null,this.localOriginFactory=null,this.featureExpressionInfoContext=null,this.screenSizePerspectiveEnabled=!0,this.slicePlaneEnabled=!1,this.physicalBasedRenderingEnabled=!1,this.skipHighSymbolLods=!1,this.isAsync=!1}},rft=class{constructor(){this.renderPriority=0,this.renderPriorityStep=1,this.ignoreDrivers=!1}};var Qde,Kde,epe,I$e={exports:{}};Qde=I$e,Kde=function(){function t(D,I,F){F=F||2;var G,H,Z,te,me,Me,it,Et=I&&I.length,St=Et?I[0]*F:D.length,ht=e(D,0,St,F,!0),Ke=[];if(!ht||ht.next===ht.prev)return Ke;if(Et&&(ht=l(D,I,ht,F)),D.length>80*F){G=Z=D[0],H=te=D[1];for(var je=F;je<St;je+=F)(me=D[je])<G&&(G=me),(Me=D[je+1])<H&&(H=Me),me>Z&&(Z=me),Me>te&&(te=Me);it=(it=Math.max(Z-G,te-H))!==0?1/it:0}return i(ht,Ke,F,G,H,it),Ke}function e(D,I,F,G,H){var Z,te;if(H===le(D,I,F,G)>0)for(Z=I;Z<F;Z+=G)te=J(Z,D[Z],D[Z+1],te);else for(Z=F-G;Z>=I;Z-=G)te=J(Z,D[Z],D[Z+1],te);if(te&&E(te,te.next)){var me=te.next;W(te),te=me}return te}function r(D,I){if(!D)return D;I||(I=D);var F,G=D;do if(F=!1,G.steiner||!E(G,G.next)&&S(G.prev,G,G.next)!==0)G=G.next;else{var H=G.prev;if(W(G),(G=I=H)===G.next)break;F=!0}while(F||G!==I);return I}function i(D,I,F,G,H,Z,te){if(D){!te&&Z&&g(D,G,H,Z);for(var me,Me,it=D;D.prev!==D.next;)if(me=D.prev,Me=D.next,Z?s(D,G,H,Z):n(D))I.push(me.i/F),I.push(D.i/F),I.push(Me.i/F),W(D),D=Me.next,it=Me.next;else if((D=Me)===it){te?te===1?i(D=o(r(D),I,F),I,F,G,H,Z,2):te===2&&a(D,I,F,G,H,Z):i(r(D),I,F,G,H,Z,1);break}}}function n(D){var I=D.prev,F=D,G=D.next;if(S(I,F,G)>=0)return!1;for(var H=D.next.next;H!==D.prev;){if(w(I.x,I.y,F.x,F.y,G.x,G.y,H.x,H.y)&&S(H.prev,H,H.next)>=0)return!1;H=H.next}return!0}function s(D,I,F,G){var H=D.prev,Z=D,te=D.next;if(S(H,Z,te)>=0)return!1;for(var me=H.x<Z.x?H.x<te.x?H.x:te.x:Z.x<te.x?Z.x:te.x,Me=H.y<Z.y?H.y<te.y?H.y:te.y:Z.y<te.y?Z.y:te.y,it=H.x>Z.x?H.x>te.x?H.x:te.x:Z.x>te.x?Z.x:te.x,Et=H.y>Z.y?H.y>te.y?H.y:te.y:Z.y>te.y?Z.y:te.y,St=v(me,Me,I,F,G),ht=v(it,Et,I,F,G),Ke=D.prevZ,je=D.nextZ;Ke&&Ke.z>=St&&je&&je.z<=ht;){if(Ke!==D.prev&&Ke!==D.next&&w(H.x,H.y,Z.x,Z.y,te.x,te.y,Ke.x,Ke.y)&&S(Ke.prev,Ke,Ke.next)>=0||(Ke=Ke.prevZ,je!==D.prev&&je!==D.next&&w(H.x,H.y,Z.x,Z.y,te.x,te.y,je.x,je.y)&&S(je.prev,je,je.next)>=0))return!1;je=je.nextZ}for(;Ke&&Ke.z>=St;){if(Ke!==D.prev&&Ke!==D.next&&w(H.x,H.y,Z.x,Z.y,te.x,te.y,Ke.x,Ke.y)&&S(Ke.prev,Ke,Ke.next)>=0)return!1;Ke=Ke.prevZ}for(;je&&je.z<=ht;){if(je!==D.prev&&je!==D.next&&w(H.x,H.y,Z.x,Z.y,te.x,te.y,je.x,je.y)&&S(je.prev,je,je.next)>=0)return!1;je=je.nextZ}return!0}function o(D,I,F){var G=D;do{var H=G.prev,Z=G.next.next;!E(H,Z)&&A(H,G,G.next,Z)&&k(H,Z)&&k(Z,H)&&(I.push(H.i/F),I.push(G.i/F),I.push(Z.i/F),W(G),W(G.next),G=D=Z),G=G.next}while(G!==D);return r(G)}function a(D,I,F,G,H,Z){var te=D;do{for(var me=te.next.next;me!==te.prev;){if(te.i!==me.i&&x(te,me)){var Me=B(te,me);return te=r(te,te.next),Me=r(Me,Me.next),i(te,I,F,G,H,Z),void i(Me,I,F,G,H,Z)}me=me.next}te=te.next}while(te!==D)}function l(D,I,F,G){var H,Z,te,me=[];for(H=0,Z=I.length;H<Z;H++)(te=e(D,I[H]*G,H<Z-1?I[H+1]*G:D.length,G,!1))===te.next&&(te.steiner=!0),me.push(b(te));for(me.sort(c),H=0;H<me.length;H++)F=r(F=h(me[H],F),F.next);return F}function c(D,I){return D.x-I.x}function u(D){if(D.next.prev===D)return D;let I=D;for(;;){const F=I.next;if(F.prev===I||F===I||F===D)break;I=F}return I}function h(D,I){var F=p(D,I);if(!F)return I;var G=B(F,D),H=r(F,F.next);let Z=u(G);return r(Z,Z.next),H=u(H),u(I===F?H:I)}function p(D,I){var F,G=I,H=D.x,Z=D.y,te=-1/0;do{if(Z<=G.y&&Z>=G.next.y&&G.next.y!==G.y){var me=G.x+(Z-G.y)*(G.next.x-G.x)/(G.next.y-G.y);if(me<=H&&me>te){if(te=me,me===H){if(Z===G.y)return G;if(Z===G.next.y)return G.next}F=G.x<G.next.x?G:G.next}}G=G.next}while(G!==I);if(!F)return null;if(H===te)return F;var Me,it=F,Et=F.x,St=F.y,ht=1/0;G=F;do H>=G.x&&G.x>=Et&&H!==G.x&&w(Z<St?H:te,Z,Et,St,Z<St?te:H,Z,G.x,G.y)&&(Me=Math.abs(Z-G.y)/(H-G.x),k(G,D)&&(Me<ht||Me===ht&&(G.x>F.x||G.x===F.x&&f(F,G)))&&(F=G,ht=Me)),G=G.next;while(G!==it);return F}function f(D,I){return S(D.prev,D,I.prev)<0&&S(I.next,D,D.next)<0}function g(D,I,F,G){var H=D;do H.z===null&&(H.z=v(H.x,H.y,I,F,G)),H.prevZ=H.prev,H.nextZ=H.next,H=H.next;while(H!==D);H.prevZ.nextZ=null,H.prevZ=null,_(H)}function _(D){var I,F,G,H,Z,te,me,Me,it=1;do{for(F=D,D=null,Z=null,te=0;F;){for(te++,G=F,me=0,I=0;I<it&&(me++,G=G.nextZ);I++);for(Me=it;me>0||Me>0&&G;)me!==0&&(Me===0||!G||F.z<=G.z)?(H=F,F=F.nextZ,me--):(H=G,G=G.nextZ,Me--),Z?Z.nextZ=H:D=H,H.prevZ=Z,Z=H;F=G}Z.nextZ=null,it*=2}while(te>1);return D}function v(D,I,F,G,H){return(D=1431655765&((D=858993459&((D=252645135&((D=16711935&((D=32767*(D-F)*H)|D<<8))|D<<4))|D<<2))|D<<1))|(I=1431655765&((I=858993459&((I=252645135&((I=16711935&((I=32767*(I-G)*H)|I<<8))|I<<4))|I<<2))|I<<1))<<1}function b(D){var I=D,F=D;do(I.x<F.x||I.x===F.x&&I.y<F.y)&&(F=I),I=I.next;while(I!==D);return F}function w(D,I,F,G,H,Z,te,me){return(H-te)*(I-me)-(D-te)*(Z-me)>=0&&(D-te)*(G-me)-(F-te)*(I-me)>=0&&(F-te)*(Z-me)-(H-te)*(G-me)>=0}function x(D,I){return D.next.i!==I.i&&D.prev.i!==I.i&&!z(D,I)&&(k(D,I)&&k(I,D)&&q(D,I)&&(S(D.prev,D,I.prev)||S(D,I.prev,I))||E(D,I)&&S(D.prev,D,D.next)>0&&S(I.prev,I,I.next)>0)}function S(D,I,F){return(I.y-D.y)*(F.x-I.x)-(I.x-D.x)*(F.y-I.y)}function E(D,I){return D.x===I.x&&D.y===I.y}function A(D,I,F,G){var H=L(S(D,I,F)),Z=L(S(D,I,G)),te=L(S(F,G,D)),me=L(S(F,G,I));return H!==Z&&te!==me||!(H!==0||!O(D,F,I))||!(Z!==0||!O(D,G,I))||!(te!==0||!O(F,D,G))||!(me!==0||!O(F,I,G))}function O(D,I,F){return I.x<=Math.max(D.x,F.x)&&I.x>=Math.min(D.x,F.x)&&I.y<=Math.max(D.y,F.y)&&I.y>=Math.min(D.y,F.y)}function L(D){return D>0?1:D<0?-1:0}function z(D,I){var F=D;do{if(F.i!==D.i&&F.next.i!==D.i&&F.i!==I.i&&F.next.i!==I.i&&A(F,F.next,D,I))return!0;F=F.next}while(F!==D);return!1}function k(D,I){return S(D.prev,D,D.next)<0?S(D,I,D.next)>=0&&S(D,D.prev,I)>=0:S(D,I,D.prev)<0||S(D,D.next,I)<0}function q(D,I){var F=D,G=!1,H=(D.x+I.x)/2,Z=(D.y+I.y)/2;do F.y>Z!=F.next.y>Z&&F.next.y!==F.y&&H<(F.next.x-F.x)*(Z-F.y)/(F.next.y-F.y)+F.x&&(G=!G),F=F.next;while(F!==D);return G}function B(D,I){var F=new Y(D.i,D.x,D.y),G=new Y(I.i,I.x,I.y),H=D.next,Z=I.prev;return D.next=I,I.prev=D,F.next=H,H.prev=F,G.next=F,F.prev=G,Z.next=G,G.prev=Z,G}function J(D,I,F,G){var H=new Y(D,I,F);return G?(H.next=G.next,H.prev=G,G.next.prev=H,G.next=H):(H.prev=H,H.next=H),H}function W(D){D.next.prev=D.prev,D.prev.next=D.next,D.prevZ&&(D.prevZ.nextZ=D.nextZ),D.nextZ&&(D.nextZ.prevZ=D.prevZ)}function Y(D,I,F){this.i=D,this.x=I,this.y=F,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function le(D,I,F,G){for(var H=0,Z=I,te=F-G;Z<F;Z+=G)H+=(D[te]-D[Z])*(D[Z+1]+D[te+1]),te=Z;return H}return t.deviation=function(D,I,F,G){var H=I&&I.length,Z=H?I[0]*F:D.length,te=Math.abs(le(D,0,Z,F));if(H)for(var me=0,Me=I.length;me<Me;me++){var it=I[me]*F,Et=me<Me-1?I[me+1]*F:D.length;te-=Math.abs(le(D,it,Et,F))}var St=0;for(me=0;me<G.length;me+=3){var ht=G[me]*F,Ke=G[me+1]*F,je=G[me+2]*F;St+=Math.abs((D[ht]-D[je])*(D[Ke+1]-D[ht+1])-(D[ht]-D[Ke])*(D[je+1]-D[ht+1]))}return te===0&&St===0?0:Math.abs((St-te)/te)},t.flatten=function(D){for(var I=D[0][0].length,F={vertices:[],holes:[],dimensions:I},G=0,H=0;H<D.length;H++){for(var Z=0;Z<D[H].length;Z++)for(var te=0;te<I;te++)F.vertices.push(D[H][Z][te]);H>0&&(G+=D[H-1].length,F.holes.push(G))}return F},t},(epe=Kde())!==void 0&&(Qde.exports=epe);const y3=XI(I$e.exports),Tie=()=>re.getLogger("esri.views.3d.support.buffer.math");function ift(t,e,r){pf(t.typedBuffer,e.typedBuffer,r,t.typedBufferStride,e.typedBufferStride)}function pf(t,e,r,i=3,n=i){if(t.length/i!==Math.ceil(e.length/n))return t;const s=t.length/i,o=r[0],a=r[1],l=r[2],c=r[4],u=r[5],h=r[6],p=r[8],f=r[9],g=r[10],_=r[12],v=r[13],b=r[14];let w=0,x=0;for(let S=0;S<s;S++){const E=e[w],A=e[w+1],O=e[w+2];t[x]=o*E+c*A+p*O+_,t[x+1]=a*E+u*A+f*O+v,t[x+2]=l*E+h*A+g*O+b,w+=n,x+=i}return t}function L$e(t,e,r){ff(t.typedBuffer,e.typedBuffer,r,t.typedBufferStride,e.typedBufferStride)}function ff(t,e,r,i=3,n=i){if(t.length/i!==Math.ceil(e.length/n))return void Tie().error("source and destination buffers need to have the same number of elements");const s=t.length/i,o=r[0],a=r[1],l=r[2],c=r[3],u=r[4],h=r[5],p=r[6],f=r[7],g=r[8];let _=0,v=0;for(let b=0;b<s;b++){const w=e[_],x=e[_+1],S=e[_+2];t[v]=o*w+c*x+p*S,t[v+1]=a*w+u*x+f*S,t[v+2]=l*w+h*x+g*S,_+=n,v+=i}}function nft(t,e,r){y8(t.typedBuffer,e,r,t.typedBufferStride)}function y8(t,e,r,i=3){const n=Math.min(t.length/i,e.count),s=e.typedBuffer,o=e.typedBufferStride;let a=0,l=0;for(let c=0;c<n;c++)t[l]=r*s[a],t[l+1]=r*s[a+1],t[l+2]=r*s[a+2],a+=o,l+=i}function Sie(t,e,r,i=3,n=i){const s=t.length/i;if(s!==Math.ceil(e.length/n))return t;let o=0,a=0;for(let l=0;l<s;l++)t[a]=e[o]+r[0],t[a+1]=e[o+1]+r[1],t[a+2]=e[o+2]+r[2],o+=n,a+=i;return t}function sft(t,e){FU(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function FU(t,e,r=3,i=r){const n=Math.min(t.length/r,e.length/i);let s=0,o=0;for(let a=0;a<n;a++){const l=e[s],c=e[s+1],u=e[s+2],h=l*l+c*c+u*u;if(h>0){const p=1/Math.sqrt(h);t[o]=p*l,t[o+1]=p*c,t[o+2]=p*u}s+=i,o+=r}}function oft(t,e,r){const i=Math.min(t.count,e.count),n=t.typedBuffer,s=t.typedBufferStride,o=e.typedBuffer,a=e.typedBufferStride;let l=0,c=0;for(let u=0;u<i;u++)n[c]=o[l]>>r,n[c+1]=o[l+1]>>r,n[c+2]=o[l+2]>>r,l+=a,c+=s}Object.freeze(Object.defineProperty({__proto__:null,normalize:FU,normalizeView:sft,scale:y8,scaleView:nft,shiftRight:oft,transformMat3:ff,transformMat3View:L$e,transformMat4:pf,transformMat4View:ift,translate:Sie},Symbol.toStringTag,{value:"Module"}));function aft(t,e,r){return{objectId:t,target:e,distance:r,type:"vertex"}}function tpe(t,e,r,i,n,s=!1){return{objectId:t,target:e,distance:r,type:"edge",start:i,end:n,draped:s}}var G0,Do;function mC(t){return t&&t.declaredClass==="esri.renderers.visualVariables.SizeVariable"}function Y$(t){return t!=null&&!isNaN(t)&&isFinite(t)}function D$e(t){return t.valueExpression?G0.Expression:t.field&&typeof t.field=="string"?G0.Field:G0.Unknown}function lft(t,e){const r=e||D$e(t),i=t.valueUnit||"unknown";return r===G0.Unknown?Do.Constant:t.stops?Do.Stops:t.minSize!=null&&t.maxSize!=null&&t.minDataValue!=null&&t.maxDataValue!=null?Do.ClampedLinear:i==="unknown"?t.minSize!=null&&t.minDataValue!=null?t.minSize&&t.minDataValue?Do.Proportional:Do.Additive:Do.Identity:Do.RealWorldSize}(function(t){t.Unknown="unknown",t.Expression="expression",t.Field="field"})(G0||(G0={})),function(t){t.Unknown="unknown",t.Stops="stops",t.ClampedLinear="clamped-linear",t.Proportional="proportional",t.Additive="additive",t.Constant="constant",t.Identity="identity",t.RealWorldSize="real-world-size"}(Do||(Do={}));const Ev=()=>re.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),rpe=new fv,_F=Math.PI,N$e=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function F$e(t,e,r){const i="visualVariables"in t&&t.visualVariables?t.visualVariables.find(g=>g.type==="color"):t;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.ColorVariable")return void Ev().warn("The visualVariable should be an instance of esri.renderers.visualVariables.ColorVariable");const n=typeof e=="number",s=n?null:e,o=s==null?void 0:s.attributes;let a=n?e:null;const l=i.field,{ipData:c,hasExpression:u}=i.cache;let h=i.cache.compiledFunc;if(!l&&!u){const g=i.stops;return g&&g[0]&&g[0].color}if(typeof a!="number")if(u){if((r==null?void 0:r.arcade)==null)return void Ev().error("Use of arcade expressions requires an arcade context");const g={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},_=r.arcade.arcadeUtils,v=_.getViewInfo(g),b=_.createExecContext(s,v,r.timeZone);if(!h){const w=_.createSyntaxTree(i.valueExpression);h=_.createFunction(w),i.cache.compiledFunc=h}a=_.executeFunction(h,b)}else o&&(a=o[l]);const p=i.normalizationField,f=o!=null&&p!=null?parseFloat(o[p]):void 0;if(a!=null&&(!p||n||!isNaN(f)&&f!==0)){isNaN(f)||n||(a/=f);const g=Eie(a,c);if(g){const _=g[0],v=g[1],b=_===v?i.stops[_].color:Xe.blendColors(i.stops[_].color,i.stops[v].color,g[2],r!=null?r.color:void 0);return new Xe(b)}}}function k$e(t,e,r){const i="visualVariables"in t&&t.visualVariables?t.visualVariables.find(g=>g.type==="opacity"):t;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.OpacityVariable")return void Ev().warn("The visualVariable should be an instance of esri.renderers.visualVariables.OpacityVariable");const n=typeof e=="number",s=n?null:e,o=s==null?void 0:s.attributes;let a=n?e:null;const l=i.field,{ipData:c,hasExpression:u}=i.cache;let h=i.cache.compiledFunc;if(!l&&!u){const g=i.stops;return g&&g[0]&&g[0].opacity}if(typeof a!="number")if(u){if((r==null?void 0:r.arcade)==null)return void Ev().error("Use of arcade expressions requires an arcade context");const g={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},_=r.arcade.arcadeUtils,v=_.getViewInfo(g),b=_.createExecContext(s,v,r.timeZone);if(!h){const w=_.createSyntaxTree(i.valueExpression);h=_.createFunction(w),i.cache.compiledFunc=h}a=_.executeFunction(h,b)}else o&&(a=o[l]);const p=i.normalizationField,f=o!=null&&p!=null?parseFloat(o[p]):void 0;if(a!=null&&(!p||n||!isNaN(f)&&f!==0)){isNaN(f)||n||(a/=f);const g=Eie(a,c);if(g){const _=g[0],v=g[1];if(_===v)return i.stops[_].opacity;{const b=i.stops[_].opacity;return b+(i.stops[v].opacity-b)*g[2]}}}}function z$e(t,e,r){const i="visualVariables"in t&&t.visualVariables?t.visualVariables.find(f=>f.type==="rotation"):t;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.RotationVariable")return void Ev().warn("The visualVariable should be an instance of esri.renderers.visualVariables.RotationVariable");const n=i.axis||"heading",s=n==="heading"&&i.rotationType==="arithmetic"?90:0,o=n==="heading"&&i.rotationType==="arithmetic"?-1:1,a=typeof e=="number"?null:e,l=a==null?void 0:a.attributes,c=i.field,{hasExpression:u}=i.cache;let h=i.cache.compiledFunc,p=0;if(!c&&!u)return p;if(u){if((r==null?void 0:r.arcade)==null)return void Ev().error("Use of arcade expressions requires an arcade context");const f={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},g=r.arcade.arcadeUtils,_=g.getViewInfo(f),v=g.createExecContext(a,_,r.timeZone);if(!h){const b=g.createSyntaxTree(i.valueExpression);h=g.createFunction(b),i.cache.compiledFunc=h}p=g.executeFunction(h,v)}else l&&(p=l[c]||0);return p=typeof p!="number"||isNaN(p)?null:s+o*p,p}function cft(t,e,r){const i=typeof e=="number",n=i?null:e,s=n==null?void 0:n.attributes;let o=i?e:null;const{isScaleDriven:a}=t.cache;let l=t.cache.compiledFunc;if(a){const u=r!=null?r.scale:void 0,h=r!=null?r.view:void 0;o=u==null||h==="3d"?uft(t):u}else if(!i)switch(t.inputValueType){case G0.Expression:{if((r==null?void 0:r.arcade)==null)return void Ev().error("Use of arcade expressions requires an arcade context");const u={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},h=r.arcade.arcadeUtils,p=h.getViewInfo(u),f=h.createExecContext(n,p,r.timeZone);if(!l){const g=h.createSyntaxTree(t.valueExpression);l=h.createFunction(g),t.cache.compiledFunc=l}o=h.executeFunction(l,f);break}case G0.Field:s&&(o=s[t.field]);break;case G0.Unknown:o=null}if(!Y$(o))return null;if(i||!t.normalizationField)return o;const c=s?parseFloat(s[t.normalizationField]):null;return Y$(c)&&c!==0?o/c:null}function uft(t){let e=null,r=null;const i=t.stops;return i?(e=i[0].value,r=i[i.length-1].value):(e=t.minDataValue||0,r=t.maxDataValue||0),(e+r)/2}function kU(t,e,r){const i="visualVariables"in t&&t.visualVariables?t.visualVariables.find(s=>s.type==="size"):t;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.SizeVariable")return void Ev().warn("The visualVariable should be an instance of esri.renderers.visualVariables.SizeVariable");const n=B$e(cft(i,e,r),i,e,r,i.cache.ipData);return n==null||isNaN(n)?0:n}function Jc(t,e,r){return t==null?null:mC(t)?kU(t,e,r):Y$(t)?t:null}function U$e(t,e,r){return Y$(r)&&t>r?r:Y$(e)&&t<e?e:t}function hft(t,e,r,i){return t+((Jc(e.minSize,r,i)||e.minDataValue)??0)}function dft(t,e,r){const i=t.stops;let n=(i==null?void 0:i.length)&&i[0].size;return n==null&&(n=t.minSize),Jc(n,e,r)}function pft(t,e,r,i){const n=(t-e.minDataValue)/(e.maxDataValue-e.minDataValue),s=Jc(e.minSize,r,i),o=Jc(e.maxSize,r,i),a=i!=null?i.shape:void 0;if(t<=e.minDataValue)return s;if(t>=e.maxDataValue)return o;if(s==null||o==null)return null;if(e.scaleBy==="area"&&a){const l=a==="circle",c=l?_F*(s/2)**2:s*s,u=c+n*((l?_F*(o/2)**2:o*o)-c);return l?2*Math.sqrt(u/_F):Math.sqrt(u)}return s+n*(o-s)}function fft(t,e,r,i){const n=i!=null?i.shape:void 0,s=t/e.minDataValue,o=Jc(e.minSize,r,i),a=Jc(e.maxSize,r,i);let l=null;return l=n==="circle"?2*Math.sqrt(s*(o/2)**2):n==="square"||n==="diamond"||n==="image"?Math.sqrt(s*o**2):s*o,U$e(l,o,a)}function mft(t,e,r,i,n){var l,c,u;const[s,o,a]=Eie(t,n);if(s===o)return Jc((l=e.stops)==null?void 0:l[s].size,r,i);{const h=Jc((c=e.stops)==null?void 0:c[s].size,r,i);return h+(Jc((u=e.stops)==null?void 0:u[o].size,r,i)-h)*a}}function gft(t,e,r,i){const n=((i==null?void 0:i.resolution)??1)*c3[e.valueUnit],s=Jc(e.minSize,r,i),o=Jc(e.maxSize,r,i),{valueRepresentation:a}=e;let l=null;return l=a==="area"?2*Math.sqrt(t/_F)/n:a==="radius"||a==="distance"?2*t/n:t/n,U$e(l,s,o)}function B$e(t,e,r,i,n){switch(e.transformationType){case Do.Additive:return hft(t,e,r,i);case Do.Constant:return dft(e,r,i);case Do.ClampedLinear:return pft(t,e,r,i);case Do.Proportional:return fft(t,e,r,i);case Do.Stops:return mft(t,e,r,i,n);case Do.RealWorldSize:return gft(t,e,r,i);case Do.Identity:return t;case Do.Unknown:return null}}function yft(t,e,r){const{isScaleDriven:i}=t.cache;if(!(i&&r==="3d"||e))return null;const n={scale:e,view:r};let s=Jc(t.minSize,rpe,n),o=Jc(t.maxSize,rpe,n);if(s!=null||o!=null){if(s>o){const a=o;o=s,s=a}return{minSize:s,maxSize:o}}}function Cie(t,e,r){if(!t.visualVariables)return;const i=[],n=[],s=[],o=[],a=[];for(const l of t.visualVariables)switch(l.type){case"color":n.push(l);break;case"opacity":s.push(l);break;case"rotation":a.push(l);break;case"size":o.push(l)}return n.forEach(l=>{const c=F$e(l,e,r);i.push({variable:l,value:c})}),s.forEach(l=>{const c=k$e(l,e,r);i.push({variable:l,value:c})}),a.forEach(l=>{const c=z$e(l,e,r);i.push({variable:l,value:c})}),o.forEach(l=>{const c=kU(l,e,r);i.push({variable:l,value:c})}),i.filter(l=>l.value!=null)}function Eie(t,e){if(!e)return;let r=0,i=e.length-1;return e.some((n,s)=>t<n?(i=s,!0):(r=s,!1)),[r,i,(t-e[r])/(e[i]-e[r])]}function _ft(t,e,r){const i=["proportional","proportional","proportional"];for(const n of t){const s=n.useSymbolValue?"symbol-value":kU(n,e,r);switch(n.axis){case"width":i[0]=s;break;case"depth":i[1]=s;break;case"height":i[2]=s;break;case"width-and-depth":i[0]=s,i[1]=s;break;case"all":case void 0:case null:i[0]=s,i[1]=s,i[2]=s;break;default:n.axis}}return i}const L7t=Object.freeze(Object.defineProperty({__proto__:null,getAllSizes:_ft,getColor:F$e,getOpacity:k$e,getRotationAngle:z$e,getSize:kU,getSizeForValue:B$e,getSizeFromNumberOrVariable:Jc,getSizeRangeAtScale:yft,getVisualVariableValues:Cie,viewScaleRE:N$e},Symbol.toStringTag,{value:"Module"}));function zU(t,e){if(!t||t.symbol)return null;const r=e==null?void 0:e.renderer;return t&&r!=null&&r.getObservationRenderer?r.getObservationRenderer(t):r}function vft(t,e){if(t.symbol!=null)return t.symbol;const r=zU(t,e);return r!=null&&r.type!=="dot-density"?r.getSymbol(t,e):null}function D7t(t,e){const r=zU(t,e),i=vft(t,e);if(i==null)return null;const n={renderer:r,symbol:i};if(r==null||!("visualVariables"in r)||!r.visualVariables)return n;const s=Cie(r,t,e)??[],o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of s)switch(a.type){case"color":n.color=l.toRgba();break;case"size":if(a.target==="outline")n.outlineSize=l;else{const c=a.axis,u=a.useSymbolValue?"symbol-value":l;switch(c){case"width":o[0]=u;break;case"depth":o[1]=u;break;case"height":o[2]=u;break;case"width-and-depth":o[0]=o[1]=u;break;default:o[0]=o[1]=o[2]=u}}break;case"opacity":n.opacity=l;break;case"rotation":switch(a.axis){case"tilt":n.tilt=l;break;case"roll":n.roll=l;break;default:n.heading=l}}return o[0]==="proportional"&&o[1]==="proportional"&&o[2]==="proportional"||(n.size=o),n}async function bft(t,e){if(t.symbol!=null)return t.symbol;const r=zU(t,e);return r!=null?r.getSymbolAsync(t,e):null}async function N7t(t,e){const r=zU(t,e),i=await bft(t,e);if(!i)return null;const n={renderer:r,symbol:i};if(!r||!("visualVariables"in r)||!r.visualVariables)return n;const s=Cie(r,t,e)??[],o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of s)if(a.type==="color")n.color=Xe.toUnitRGBA(l);else if(a.type==="size")if(a.target==="outline")n.outlineSize=l;else{const c=a.axis,u=a.useSymbolValue?"symbol-value":l;c==="width"?o[0]=u:c==="depth"?o[1]=u:c==="height"?o[2]=u:o[0]=o[1]=c==="width-and-depth"?u:o[2]=u}else a.type==="opacity"?n.opacity=l:a.type==="rotation"&&a.axis==="tilt"?n.tilt=l:a.type==="rotation"&&a.axis==="roll"?n.roll=l:a.type==="rotation"&&(n.heading=l);return(isFinite(o[0])||isFinite(o[1])||isFinite(o[2]))&&(n.size=o),n}function wft(t,e=0){const r=t[e];return typeof r=="number"&&isFinite(r)?r:null}function xft(t){for(let e=0;e<3;e++){const r=t[e];if(typeof r=="number")return isFinite(r)?r:0}return 0}function Tft(t,e,r,i){const n=(o=>!Array.isArray(o[0]))(e)?(o,a)=>e[3*o+a]:(o,a)=>e[o][a],s=i?Ba(i)/p$(i):1;return Zee(t,(o,a)=>ie(o,n(a,0)*s,n(a,1)*s,n(a,2)),r)}function V$e(t,e,r){const i=Tft(ipe,t,e,r)?ipe:[0,0,1];return Math.abs(i[2])>Math.cos(Nt(80))?hn.Z:Math.abs(i[1])>Math.abs(i[0])?hn.Y:hn.X}const ipe=zr();function Sft(t,e,r){const i=V$e(t,(e.length>0?e[0]:t.length/3)-1,r);if(i!==hn.Z){t=t.slice();for(let n=0;n<t.length;n+=3)t[n+i]=t[n+2]}return y3(t,e,3)}function npe(t){const e=[[R.POSITION,new Ye(t.attributeData.position,t.indices,3,!0)]],r=Uv(t.indices.length);return t.attributeData.colorFeature!=null?e.push([R.COLORFEATUREATTRIBUTE,new Ye([t.attributeData.colorFeature],r,1,!0)]):t.attributeData.color&&e.push([R.COLOR,new Ye(t.attributeData.color,r,4,!0)]),t.attributeData.uvMapSpace&&e.push([R.UVMAPSPACE,new Ye(t.attributeData.uvMapSpace,t.indices,4,!0)]),t.attributeData.boundingRect&&e.push([R.BOUNDINGRECT,new Ye(t.attributeData.boundingRect,t.indices,9,!0)]),new gs(t.material,e,t.mapPositions,Cn.Mesh,t.attributeData.objectAndLayerIdColor)}function spe(t,e=null){const r=[[R.POSITION,new Ye(t.attributeData.position,t.indices,3,!0)],[R.UV0,new Ye(t.attributeData.uv0,t.indices,2,!0)]];return new gs(t.material,r,t.mapPositions,Cn.Mesh,e)}function X$(t){switch(t.type){case"extent":if(t instanceof ei)return nf.fromExtent(t);break;case"polygon":return t}return null}let UU=class{constructor(e,r,i){this.renderData=e,this.layerUid=r,this.graphicUid=i,this.outGeometries=new Array}};function NZ(t,e,r){const i=Array.isArray(t),n=i?t.length/e:t.byteLength/(4*e),s=i?t:new Uint32Array(t,0,n*e),o=(r==null?void 0:r.minReduction)??0,a=(r==null?void 0:r.originalIndices)||null,l=a?a.length:0,c=(r==null?void 0:r.componentOffsets)||null;let u=0;if(c)for(let A=0;A<c.length-1;A++){const O=c[A+1]-c[A];O>u&&(u=O)}else u=n;const h=Math.floor(1.1*u)+1;(Of==null||Of.length<2*h)&&(Of=new Uint32Array(Sxe(2*h)));for(let A=0;A<2*h;A++)Of[A]=0;let p=0;const f=!!c&&!!a,g=f?l:n;let _=X6(n);const v=new Uint32Array(l),b=1.96;let w=o!==0?Math.ceil(4*b*b/(o*o)*o*(1-o)):g,x=1,S=c?c[1]:g;for(let A=0;A<g;A++){if(A===w){const B=1-p/A;if(B+b*Math.sqrt(B*(1-B)/A)<o)return null;w*=2}if(A===S){for(let B=0;B<2*h;B++)Of[B]=0;if(a)for(let B=c[x-1];B<c[x];B++)v[B]=_[a[B]];S=c[++x]}const O=f?a[A]:A,L=O*e,z=Pft(s,L,e);let k=z%h,q=p;for(;Of[2*k+1]!==0;){if(Of[2*k]===z){const B=Of[2*k+1]-1;if(Cft(s,L,B*e,e)){q=_[B];break}}k++,k>=h&&(k-=h)}q===p&&(Of[2*k]=z,Of[2*k+1]=O+1,p++),_[O]=q}if(o!==0&&1-p/n<o)return null;if(f){for(let A=c[x-1];A<v.length;A++)v[A]=_[a[A]];_=Xm(v)}const E=i?new Array(p):new Uint32Array(p*e);p=0;for(let A=0;A<g;A++)_[A]===p&&(Eft(s,(f?a[A]:A)*e,E,p*e,e),p++);if(a&&!f){const A=new Uint32Array(l);for(let O=0;O<A.length;O++)A[O]=_[a[O]];_=Xm(A)}return{buffer:Array.isArray(E)?E:E.buffer,indices:_,uniqueCount:p}}function Cft(t,e,r,i){for(let n=0;n<i;n++)if(t[e+n]!==t[r+n])return!1;return!0}function Eft(t,e,r,i,n){for(let s=0;s<n;s++)r[i+s]=t[e+s]}function Pft(t,e,r){let i=0;for(let n=0;n<r;n++)i=t[e+n]+i|0,i=i+(i<<11)+(i>>>2)|0;return i>>>0}let Of=null;function Aft(t){const e=aL(t.rings,t.hasZ,fg.CCW_IS_HOLE,t.spatialReference),r=new Array;let i=0,n=0;for(const a of e.polygons){const l=a.count,c=a.index,u=nd(e.position,3*c,3*l),h=a.holeIndices.map(f=>f-c),p=Xm(y3(u,h,3));r.push({position:u,faces:p}),i+=u.length,n+=p.length}const s=Mft(r,i,n),o=Array.isArray(s.position)?NZ(s.position,3,{originalIndices:s.faces}):NZ(s.position.buffer,6,{originalIndices:s.faces});return s.position=KAe(new Float64Array(o.buffer)),s.faces=o.indices,s}function Mft(t,e,r){if(t.length===1)return t[0];const i=xo(e),n=new Array(r);let s=0,o=0,a=0;for(const l of t){for(let c=0;c<l.position.length;c++)i[s++]=l.position[c];for(const c of l.faces)n[o++]=c+a;a=s/3}return{position:i,faces:Xm(n)}}function aL(t,e,r,i){const n=t.length,s=new Array(n),o=new Array(n),a=new Array(n);let l=0,c=0,u=0,h=0;for(let g=0;g<n;++g)h+=t[g].length;const p=xo(3*h);let f=0;for(let g=n-1;g>=0;g--){const _=t[g],v=r===fg.CCW_IS_HOLE&&Oft(_,e,i);if(v&&n!==1)s[l++]=_;else{let b=_.length;for(let x=0;x<l;++x)b+=s[x].length;const w={index:f,pathLengths:new Array(l+1),count:b,holeIndices:new Array(l)};w.pathLengths[0]=_.length,_.length>0&&(a[u++]={index:f,count:_.length}),f=v?wN(_,_.length-1,-1,p,f,_.length,e):wN(_,0,1,p,f,_.length,e);for(let x=0;x<l;++x){const S=s[x];w.holeIndices[x]=f,w.pathLengths[x+1]=S.length,S.length>0&&(a[u++]={index:f,count:S.length}),f=wN(S,0,1,p,f,S.length,e)}l=0,w.count>0&&(o[c++]=w)}}for(let g=0;g<l;++g){const _=s[g];_.length>0&&(a[u++]={index:f,count:_.length}),f=wN(_,0,1,p,f,_.length,e)}return o.length=c,a.length=u,{position:p,polygons:o,outlines:a}}function wN(t,e,r,i,n,s,o){n*=3;for(let a=0;a<s;++a){const l=t[e];i[n++]=l[0],i[n++]=l[1],i[n++]=o?l[2]:0,e+=r}return n/3}function Oft(t,e,r){if(e){const i=t.length-1,n=V$e(t,i,r);if(n===hn.X)return!p5(t,hn.Y,hn.Z);if(n===hn.Y)return!p5(t,hn.X,hn.Z)}return!p5(t,hn.X,hn.Y)}var fg;(function(t){t[t.NONE=0]="NONE",t[t.CCW_IS_HOLE=1]="CCW_IS_HOLE"})(fg||(fg={}));var gR,_8,FZ;(function(t){t[t.RasterImage=0]="RasterImage",t[t.Features=1]="Features"})(gR||(gR={})),function(t){t[t.MapLayer=0]="MapLayer",t[t.ViewLayer=1]="ViewLayer",t[t.Outline=2]="Outline",t[t.SnappingHint=3]="SnappingHint"}(_8||(_8={})),function(t){t[t.WithRasterImage=0]="WithRasterImage",t[t.WithoutRasterImage=1]="WithoutRasterImage"}(FZ||(FZ={}));var us,jh,yR,ps;(function(t){t[t.INNER=0]="INNER",t[t.OUTER=1]="OUTER"})(us||(us={})),function(t){t[t.REGULAR=0]="REGULAR",t[t.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",t[t.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",t[t.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(jh||(jh={})),function(t){t[t.OFF=0]="OFF",t[t.ON=1]="ON"}(yR||(yR={})),function(t){t[t.FADING=0]="FADING",t[t.IMMEDIATE=1]="IMMEDIATE",t[t.UNFADED=2]="UNFADED"}(ps||(ps={}));let Rft=class{constructor(e,r){this.vec3=e,this.id=r}};function v8(t,e,r,i){return new Rft(Ce(t,e,r),i)}let ope=class{constructor(){this._extent=Wt(),this.resolution=0,this.renderLocalOrigin=v8(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new $ft}get extent(){return this._extent}setupGeometryViewsCyclical(e){this.setupGeometryViewsDirect();const r=.001*e.range;if(this._extent[0]-r<=e.min){const i=this.canvasGeometries.extents[this.canvasGeometries.numViews++];a6(this._extent,e.range,0,i)}if(this._extent[2]+r>=e.max){const i=this.canvasGeometries.extents[this.canvasGeometries.numViews++];a6(this._extent,-e.range,0,i)}}setupGeometryViewsDirect(){this.canvasGeometries.numViews=1,ey(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let e=0;e<this.canvasGeometries.numViews;e++){const r=this.canvasGeometries.extents[e];if(r[0]!==r[2]&&r[1]!==r[3])return!0}return!1}},$ft=class{constructor(){this.extents=[Wt(),Wt(),Wt()],this.numViews=0}};var Ui;(function(t){t[t.Color=0]="Color",t[t.ColorNoRasterImage=1]="ColorNoRasterImage",t[t.Highlight=2]="Highlight",t[t.WaterNormal=3]="WaterNormal",t[t.Occluded=4]="Occluded",t[t.ObjectAndLayerIdColor=5]="ObjectAndLayerIdColor"})(Ui||(Ui={}));let Ift=class{constructor(e,r,i){this._fbos=e,this._format=r,this._name=i}get valid(){var e;return((e=this._handle)==null?void 0:e.getTexture())!=null}dispose(){this._handle=tr(this._handle)}get texture(){var e;return(e=this._handle)==null?void 0:e.getTexture()}bind(e,r,i){var n,s,o;this._handle&&this._handle.fbo.width===r&&this._handle.fbo.height===i||((n=this._handle)==null||n.release(),this._handle=this._fbos.acquire(r,i,this._name,this._format)),e.unbindTexture((s=this._handle)==null?void 0:s.fbo.colorTexture),e.bindFramebuffer((o=this._handle)==null?void 0:o.fbo)}generateMipMap(){var e,r,i,n,s;(i=(r=(e=this._handle)==null?void 0:e.getTexture())==null?void 0:r.descriptor)!=null&&i.hasMipmap&&((s=(n=this._handle)==null?void 0:n.getTexture())==null||s.generateMipmap())}},wT=class{constructor(e,r,i,n,s=qi.RGBA_MIPMAP){this.output=i,this.content=n,this.fbo=new Ift(e,s,r)}get valid(){return this.fbo.valid}},Lft=class{constructor(e){this.targets=[new wT(e,"overlay color",U.Color,Ui.Color),new wT(e,"overlay IM color",U.Color,Ui.ColorNoRasterImage),new wT(e,"overlay highlight",U.Highlight,Ui.Highlight,qi.RGBA4),new wT(e,"overlay water",U.Normal,Ui.WaterNormal),new wT(e,"overlay occluded",U.Color,Ui.Occluded)],se("enable-feature:objectAndLayerId-rendering")&&this.targets.push(new wT(e,"overlay oid",U.ObjectAndLayerIdColor,Ui.ObjectAndLayerIdColor))}getTexture(e){var r;return(r=this.targets[e])==null?void 0:r.fbo.texture}dispose(){for(const e of this.targets)e.fbo.dispose()}computeValidity(){return this.targets.reduce((e,r,i)=>r.valid?e|=1<<i:e,0)}},Pie=class extends xRe{constructor(){super(...arguments),this.slicePlaneLocalOrigin=C(),this.origin=this.slicePlaneLocalOrigin,this.modelTransformation=null}};var Bc;(function(t){t[t.Material=0]="Material",t[t.ShadowMap=1]="ShadowMap",t[t.Highlight=2]="Highlight"})(Bc||(Bc={}));let Dft=class extends Pie{constructor(){super(...arguments),this.identifier=Bc.Material,this.output=U.Color,this.transparent=!1}},Nft=class extends Pie{constructor(){super(...arguments),this.identifier=Bc.ShadowMap}},Fft=class extends Pie{constructor(){super(...arguments),this.identifier=Bc.Highlight}};function kft(t){t.fragment.code.add(T`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)}function zft(t){t.fragment.code.add(T`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)}function Uft(t,e){const r=t.fragment;r.include(cg),r.uniforms.add(new ti("nearFar",(i,n)=>n.camera.nearFar)),r.uniforms.add(new ct("depthMap",(i,n)=>{var s;return(s=n.linearDepth)==null?void 0:s.getTexture()})),r.uniforms.add(new ln("proj",(i,n)=>n.camera.projectionMatrix)),r.uniforms.add(new $e("invResolutionHeight",(i,n)=>1/n.camera.height)),r.uniforms.add(new ln("reprojectionMatrix",(i,n)=>n.ssr.reprojectionMatrix)),r.code.add(T`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${e.highStepCount?"150":"75"};

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P, nearFar); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        return vec3(P, depth);
      }

      // continue with ray marching
      P = clamp(P + dP, vec2(0.0), vec2(0.999));
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)}function G$e(t,e){t.include(Idt,e),t.include(tU),t.include(zft),e.hasCloudsReflections&&t.include(JPe,e),e.hasScreenSpaceReflections&&t.include(Uft,e);const r=t.fragment;r.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",NRe).add("ssrHeightFadeEnd","float",yF).add("waterDiffusion","float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]),r.code.add(T`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`),r.uniforms.add(new $e("lightingSpecularStrength",(i,n)=>n.lighting.mainLight.specularStrength),new $e("lightingEnvironmentStrength",(i,n)=>n.lighting.mainLight.environmentStrength)),r.code.add(T`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`),e.hasCloudsReflections&&r.code.add(T`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y * cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * clamp((1.0 - totalFadeInOut), 0.0, 1.0);`),e.hasScreenSpaceReflections?(r.uniforms.add(new ln("view",(i,n)=>n.camera.viewMatrix),new ct("lastFrameColorTexture",(i,n)=>{var s;return(s=n.ssr.lastFrameColor)==null?void 0:s.getTexture()}),new $e("fadeFactorSSR",(i,n)=>n.ssr.fadeFactor)),r.code.add(T`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view * vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3 * dCoords.y), 0.0, 1.0) * heightMod * fadeFactorSSR;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture(lastFrameColorTexture, reprojectedCoordinate).xyz) *
reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod * 0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor +
reflSea * seaColorMod + specular + foam);`)):r.code.add(T`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`),e.hasCloudsReflections?e.hasScreenSpaceReflections?r.code.add(T`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):r.code.add(T`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):r.code.add(T`return waterRenderedColor;
}`)}let b8=class extends vn{constructor(e,r){super(e,"vec4",Rr.Draw,(i,n,s)=>i.setUniform4fv(e,r(n,s)))}};var Fm;function Bft(t,e){const{vertex:r,fragment:i}=t;r.uniforms.add(new b8("overlayTexOffset",(n,s)=>Vft(n,s)),new b8("overlayTexScale",(n,s)=>Gft(n,s))),i.constants.add("overlayOpacity","float",1),i.uniforms.add(new ct("ovColorTex",(n,s)=>kZ(n,s))),j$e(t,e)}function KP(t,e){const{vertex:r,fragment:i}=t;r.uniforms.add(new ape("overlayTexOffset"),new ape("overlayTexScale")),i.uniforms.add(new $e("overlayOpacity",n=>n.overlayOpacity),new ct("ovColorTex",(n,s)=>{var o;return(o=s.overlay)==null?void 0:o.getTexture(n.overlayContent)})),j$e(t,e)}(function(t){t[t.Disabled=0]="Disabled",t[t.Enabled=1]="Enabled",t[t.EnabledWithWater=2]="EnabledWithWater",t[t.COUNT=3]="COUNT"})(Fm||(Fm={}));let ape=class extends vn{constructor(e){super(e,"vec4")}};function j$e(t,e){e.pbrMode!==ot.Water&&e.pbrMode!==ot.WaterOnIntegratedMesh&&e.pbrMode!==ot.TerrainWithWater||t.include(G$e,e);const{vertex:r,fragment:i}=t;t.varyings.add("vtcOverlay","vec4"),r.code.add(T`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`),i.code.add(T`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),i.code.add(T`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`),i.code.add(T`vec4 getOverlayColorTexel(vec4 texCoords) {
vec2 texDim =  vec2(textureSize(ovColorTex, 0));
vec4 color0 = texelFetch(ovColorTex, ivec2(vec2(texCoords.x * 0.5, texCoords.y) * texDim), 0);
vec4 color1 = texelFetch(ovColorTex, ivec2(vec2(texCoords.z * 0.5 + 0.5, texCoords.w) * texDim), 0);
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),e.pbrMode!==ot.Water&&e.pbrMode!==ot.WaterOnIntegratedMesh&&e.pbrMode!==ot.TerrainWithWater||(by(i),_g(i),i.code.add(T`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, mainLightDirection, colorInput.rgb, mainLightIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);
return vec4(final, colorInput.w);
}`))}function kZ(t,e){var r,i,n;return t.identifier===Bc.Material&&t.output===U.Color?(r=e.overlay)==null?void 0:r.getTexture(Ui.ColorNoRasterImage):t.identifier===Bc.Material&&t.output===U.ObjectAndLayerIdColor?(i=e.overlay)==null?void 0:i.getTexture(Ui.ObjectAndLayerIdColor):t.identifier===Bc.Highlight?(n=e.overlay)==null?void 0:n.getTexture(Ui.Highlight):null}function Vft(t,e){var n,s,o,a;const r=(s=(n=e.overlay)==null?void 0:n.overlays[us.INNER])==null?void 0:s.extent;o6(r)&&(Am[0]=t.toMapSpace[0]/$a(r)-r[0]/$a(r),Am[1]=t.toMapSpace[1]/Jl(r)-r[1]/Jl(r));const i=(a=(o=e.overlay)==null?void 0:o.overlays[us.OUTER])==null?void 0:a.extent;return o6(i)&&(Am[2]=t.toMapSpace[0]/$a(i)-i[0]/$a(i),Am[3]=t.toMapSpace[1]/Jl(i)-i[1]/Jl(i)),Am}function Gft(t,e){var n,s,o,a;const r=(s=(n=e.overlay)==null?void 0:n.overlays[us.INNER])==null?void 0:s.extent;o6(r)&&(Am[0]=t.toMapSpace[2]/$a(r),Am[1]=t.toMapSpace[3]/Jl(r));const i=(a=(o=e.overlay)==null?void 0:o.overlays[us.OUTER])==null?void 0:a.extent;return o6(i)&&(Am[2]=t.toMapSpace[2]/$a(i),Am[3]=t.toMapSpace[3]/Jl(i)),Am}const Am=Zt();let Aie=class extends Ai{constructor(){super(...arguments),this.color=Ce(1,1,1)}};function H$e(){const t=new Or;return t.include(Ga),t.fragment.uniforms.add(new ct("tex",e=>e.texture),new Ft("uColor",e=>e.color)),t.fragment.code.add(T`void main() {
vec4 texColor = texture(tex, uv);
fragColor = texColor * vec4(uColor, 1.0);
}`),t}const jft=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:Aie,build:H$e},Symbol.toStringTag,{value:"Module"}));let W$e=class{constructor(e){this._context=e,this._perConstructorInstances=new xv,this._frameCounter=0,this._keepAliveFrameCount=lpe}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}destroy(){this._perConstructorInstances.forEach(e=>e.forEach(r=>r.technique.destroy())),this._perConstructorInstances.clear()}acquire(e,r=Wft){const i=r.key;let n=this._perConstructorInstances.get(e,i);if(n==null){const s=new e(this._context,r,()=>this.release(s));n=new Hft(s),this._perConstructorInstances.set(e,i,n)}return++n.refCount,n.technique}releaseAndAcquire(e,r,i){if(i!=null){if(r.key===i.key)return i;this.release(i)}return this.acquire(e,r)}release(e){if(e==null||this._perConstructorInstances.empty)return;const r=this._perConstructorInstances.get(e.constructor,e.key);r!=null&&(--r.refCount,r.refCount===0&&(r.refZeroFrame=this._frameCounter))}frameUpdate(){this._frameCounter++,this._keepAliveFrameCount!==lpe&&this._perConstructorInstances.forEach((e,r)=>{e.forEach((i,n)=>{i.refCount===0&&i.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(i.technique.destroy(),this._perConstructorInstances.delete(r,n))})})}async reloadAll(){const e=new Array;this._perConstructorInstances.forEach((r,i)=>{const n=async(s,o)=>{const a=o.shader;a&&(await a.reload(),s.forEach(l=>l.technique.reload(this._context)))};e.push(n(r,i))}),await Promise.all(e)}},Hft=class{constructor(e){this.technique=e,this.refCount=0,this.refZeroFrame=0}};const lpe=-1,Wft=new cc;let q$e=class{constructor(e,r,i,n){this._textureRepository=e,this._techniqueRepository=r,this.materialChanged=i,this.requestRender=n,this._id2glMaterialRef=new xv}dispose(){this._textureRepository.destroy()}acquire(e,r,i){this._ownMaterial(e);const n=e.produces.get(r);if(!n||!n(i))return null;let s=this._id2glMaterialRef.get(i,e.id);if(s==null){const o=e.createGLMaterial({material:e,techniqueRep:this._techniqueRepository,textureRepository:this._textureRepository,output:i});s=new qft(o),this._id2glMaterialRef.set(i,e.id,s)}return s.ref(),s.glMaterial}release(e,r){const i=this._id2glMaterialRef.get(r,e.id);i!=null&&(i.unref(),i.referenced||(gt(i.glMaterial),this._id2glMaterialRef.delete(r,e.id)))}_ownMaterial(e){e.repository&&e.repository!==this&&re.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository"),e.repository=this}},qft=class{constructor(e){this.glMaterial=e,this._refCnt=0}ref(){++this._refCnt}unref(){--this._refCnt,pt(this._refCnt>=0)}get referenced(){return this._refCnt>0}};const Yft=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","transformationChanged","shaderTransformationChanged","visibilityChanged","occlusionChanged","highlightChanged","geometryAdded","geometryRemoved","attributesChanged"];let zZ=class vF{get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}constructor(e,r){this.objectToBoundingSphere=e,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new po,this._objectCount=0,r&&(r.maximumObjectsPerNode!==void 0&&(this._maximumObjectsPerNode=r.maximumObjectsPerNode),r.maximumDepth!==void 0&&(this._maximumDepth=r.maximumDepth))}destroy(){this._degenerateObjects.clear(),po.clearPool(),UZ[0]=null,pb.prune(),vw.prune()}add(e,r=e.length){this._objectCount+=r,this._grow(e,r);const i=po.acquire();for(let n=0;n<r;n++){const s=e[n];this._isDegenerate(s)?this._degenerateObjects.add(s):(i.init(this._root),this._add(s,i))}po.release(i)}remove(e,r=null){this._objectCount-=e.length;const i=po.acquire();for(const n of e){const s=r??a2(this.objectToBoundingSphere(n),Kft);NM(s[3])?(i.init(this._root),this._remove(n,s,i)):this._degenerateObjects.delete(n)}po.release(i),this._shrink()}update(e,r){if(!NM(r[3])&&this._isDegenerate(e))return;const i=Qft(e);this.remove(i,r),this.add(i)}forEachAlongRay(e,r,i){const n=eh(e,r);this._forEachNode(this._root,s=>{if(!this._intersectsNode(n,s))return!1;const o=s.node;return o.terminals.forAll(a=>{this._intersectsObject(n,a)&&i(a)}),o.residents!==null&&o.residents.forAll(a=>{this._intersectsObject(n,a)&&i(a)}),!0})}forEachAlongRayWithVerticalOffset(e,r,i,n){const s=eh(e,r);this._forEachNode(this._root,o=>{if(!this._intersectsNodeWithOffset(s,o,n))return!1;const a=o.node;return a.terminals.forAll(l=>{this._intersectsObjectWithOffset(s,l,n)&&i(l)}),a.residents!==null&&a.residents.forAll(l=>{this._intersectsObjectWithOffset(s,l,n)&&i(l)}),!0})}forEach(e){this._forEachNode(this._root,r=>{const i=r.node;return i.terminals.forAll(e),i.residents!==null&&i.residents.forAll(e),!0}),this._degenerateObjects.forEach(e)}forEachDegenerateObject(e){this._degenerateObjects.forEach(e)}findClosest(e,r,i,n=()=>!0,s=1/0){let o=1/0,a=1/0,l=null;const c=W7(e,r),u=h=>{if(--s,!n(h))return;const p=this.objectToBoundingSphere(h);if(!P1(i,p))return;const f=t1(e,r,p),g=f-p[3],_=f+p[3];g<o&&(o=g,a=_,l=h)};return this._forEachNodeDepthOrdered(this._root,h=>{if(s<=0||!P1(i,h.bounds)||(ne(ph,c,h.halfSize),fe(ph,ph,h.bounds),t1(e,r,ph)>a))return!1;const p=h.node;return p.terminals.forAll(f=>u(f)),p.residents!==null&&p.residents.forAll(f=>u(f)),!0},e,r),l}forEachInDepthRange(e,r,i,n,s,o,a){let l=-1/0,c=1/0;const u={setRange:_=>{i===vF.DepthOrder.FRONT_TO_BACK?(l=Math.max(l,_.near),c=Math.min(c,_.far)):(l=Math.max(l,-_.far),c=Math.min(c,-_.near))}};u.setRange(n);const h=t1(r,i,e),p=W7(r,i),f=W7(r,-i),g=_=>{if(!a(_))return;const v=this.objectToBoundingSphere(_),b=v,w=t1(r,i,b)-h,x=w-v[3],S=w+v[3];x>c||S<l||!P1(o,v)||s(_,u)};this._forEachNodeDepthOrdered(this._root,_=>{if(!P1(o,_.bounds)||(ne(ph,p,_.halfSize),fe(ph,ph,_.bounds),t1(r,i,ph)-h>c)||(ne(ph,f,_.halfSize),fe(ph,ph,_.bounds),t1(r,i,ph)-h<l))return!1;const v=_.node;return v.terminals.forAll(b=>g(b)),v.residents!==null&&v.residents.forAll(b=>g(b)),!0},r,i)}forEachNode(e){this._forEachNode(this._root,r=>e(r.node,r.bounds,r.halfSize,r.depth))}forEachNeighbor(e,r){const i=N0(r),n=r,s=l=>{const c=this.objectToBoundingSphere(l),u=N0(c),h=i+u;return!(Uo(c,n)-h*h<=0)||e(l)};let o=!0;const a=l=>{o&&(o=s(l))};this._forEachNode(this._root,l=>{const c=N0(l.bounds),u=i+c;if(Uo(l.bounds,n)-u*u>0)return!1;const h=l.node;return h.terminals.forAll(a),o&&h.residents!==null&&h.residents.forAll(a),o}),o&&this.forEachDegenerateObject(a)}_intersectsNode(e,r){return xN(r.bounds,2*-r.halfSize,Ou),xN(r.bounds,2*r.halfSize,Ru),due(e.origin,e.direction,Ou,Ru)}_intersectsNodeWithOffset(e,r,i){return xN(r.bounds,2*-r.halfSize,Ou),xN(r.bounds,2*r.halfSize,Ru),i.applyToMinMax(Ou,Ru),due(e.origin,e.direction,Ou,Ru)}_intersectsObject(e,r){const i=this.objectToBoundingSphere(r);return!(i[3]>0)||uq(i,e)}_intersectsObjectWithOffset(e,r,i){const n=this.objectToBoundingSphere(r);return!(n[3]>0)||uq(i.applyToBoundingSphere(n),e)}_forEachNode(e,r){let i=po.acquire().init(e);const n=[i];for(;n.length!==0;){if(i=n.pop(),r(i)&&!i.isLeaf())for(let s=0;s<i.node.children.length;s++)i.node.children[s]&&n.push(po.acquire().init(i).advance(s));po.release(i)}}_forEachNodeDepthOrdered(e,r,i,n=vF.DepthOrder.FRONT_TO_BACK){let s=po.acquire().init(e);const o=[s];for(Jft(i,n,hpe);o.length!==0;){if(s=o.pop(),r(s)&&!s.isLeaf())for(let a=7;a>=0;--a){const l=hpe[a];s.node.children[l]&&o.push(po.acquire().init(s).advance(l))}po.release(s)}}_remove(e,r,i){pb.clear();const n=i.advanceTo(r,(s,o)=>{pb.push(s.node),pb.push(o)})?i.node.terminals:i.node.residents;if(n.removeUnordered(e),n.length===0)for(let s=pb.length-2;s>=0;s-=2){const o=pb.data[s],a=pb.data[s+1];if(!this._purge(o,a))break}}_nodeIsEmpty(e){if(e.terminals.length!==0)return!1;if(e.residents!==null)return e.residents.length===0;for(let r=0;r<e.children.length;r++)if(e.children[r])return!1;return!0}_purge(e,r){return r>=0&&(e.children[r]=null),!!this._nodeIsEmpty(e)&&(e.residents===null&&(e.residents=new Vt({shrink:!0})),!0)}_add(e,r){r.advanceTo(this.objectToBoundingSphere(e))?r.node.terminals.push(e):(r.node.residents.push(e),r.node.residents.length>this._maximumObjectsPerNode&&r.depth<this._maximumDepth&&this._split(r))}_split(e){const r=e.node.residents;e.node.residents=null;for(let i=0;i<r.length;i++){const n=po.acquire().init(e);this._add(r.at(i),n),po.release(n)}}_grow(e,r){if(r!==0&&(cpe(e,r,i=>this.objectToBoundingSphere(i),Lg),NM(Lg[3])&&!this._fitsInsideTree(Lg)))if(this._nodeIsEmpty(this._root.node))a2(Lg,this._root.bounds),this._root.halfSize=1.25*this._root.bounds[3],this._root.updateBoundsRadiusFromHalfSize();else{const i=this._rootBoundsForRootAsSubNode(Lg);this._placingRootViolatesMaxDepth(i)?this._rebuildTree(Lg,i):this._growRootAsSubNode(i),po.release(i)}}_rebuildTree(e,r){ce(Y7,r.bounds),Y7[3]=r.halfSize,cpe([e,Y7],2,n=>n,X7);const i=po.acquire().init(this._root);this._root.initFrom(null,X7,X7[3]),this._root.increaseHalfSize(1.25),this._forEachNode(i,n=>(this.add(n.node.terminals.data,n.node.terminals.length),n.node.residents!==null&&this.add(n.node.residents.data,n.node.residents.length),!0)),po.release(i)}_placingRootViolatesMaxDepth(e){const r=Math.log(e.halfSize/this._root.halfSize)*Math.LOG2E;let i=0;return this._forEachNode(this._root,n=>(i=Math.max(i,n.depth),i+r<=this._maximumDepth)),i+r>this._maximumDepth}_rootBoundsForRootAsSubNode(e){const r=e[3],i=e;let n=-1/0;const s=this._root.bounds,o=this._root.halfSize;for(let l=0;l<3;l++){const c=s[l]-o-(i[l]-r),u=i[l]+r-(s[l]+o),h=Math.max(0,Math.ceil(c/(2*o))),p=Math.max(0,Math.ceil(u/(2*o)))+1,f=2**Math.ceil(Math.log(h+p)*Math.LOG2E);n=Math.max(n,f),TN[l].min=h,TN[l].max=p}for(let l=0;l<3;l++){let c=TN[l].min,u=TN[l].max;const h=(n-(c+u))/2;c+=Math.ceil(h),u+=Math.floor(h);const p=s[l]-o-c*o*2;q7[l]=p+(u+c)*o}const a=n*o;return q7[3]=a*X$e,po.acquire().initFrom(null,q7,a,0)}_growRootAsSubNode(e){const r=this._root.node;ce(Lg,this._root.bounds),Lg[3]=this._root.halfSize,this._root.init(e),e.advanceTo(Lg,null,!0),e.node.children=r.children,e.node.residents=r.residents,e.node.terminals=r.terminals}_shrink(){for(;;){const e=this._findShrinkIndex();if(e===-1)break;this._root.advance(e),this._root.depth=0}}_findShrinkIndex(){if(this._root.node.terminals.length!==0||this._root.isLeaf())return-1;let e=null;const r=this._root.node.children;let i=0,n=0;for(;n<r.length&&e==null;)i=n++,e=r[i];for(;n<r.length;)if(r[n++])return-1;return i}_isDegenerate(e){return!NM(this.objectToBoundingSphere(e)[3])}_fitsInsideTree(e){const r=this._root.bounds,i=this._root.halfSize;return e[3]<=i&&e[0]>=r[0]-i&&e[0]<=r[0]+i&&e[1]>=r[1]-i&&e[1]<=r[1]+i&&e[2]>=r[2]-i&&e[2]<=r[2]+i}toJSON(){const{maximumDepth:e,maximumObjectsPerNode:r,_objectCount:i}=this,n=this._nodeToJSON(this._root.node);return{maximumDepth:e,maximumObjectsPerNode:r,objectCount:i,root:{bounds:this._root.bounds,halfSize:this._root.halfSize,depth:this._root.depth,node:n}}}_nodeToJSON(e){var s,o;const r=e.children.map(a=>a?this._nodeToJSON(a):null),i=(s=e.residents)==null?void 0:s.map(a=>this.objectToBoundingSphere(a)),n=(o=e.terminals)==null?void 0:o.map(a=>this.objectToBoundingSphere(a));return{children:r,residents:i,terminals:n}}static fromJSON(e){const r=new vF(i=>i,{maximumDepth:e.maximumDepth,maximumObjectsPerNode:e.maximumObjectsPerNode});return r._objectCount=e.objectCount,r._root.initFrom(e.root.node,e.root.bounds,e.root.halfSize,e.root.depth),r}},po=class ES{constructor(){this.bounds=Jn(),this.halfSize=0,this.initFrom(null,null,0,0)}init(e){return this.initFrom(e.node,e.bounds,e.halfSize,e.depth)}initFrom(e,r,i,n=this.depth){return this.node=e??ES.createEmptyNode(),r&&a2(r,this.bounds),this.halfSize=i,this.depth=n,this}increaseHalfSize(e){this.halfSize*=e,this.updateBoundsRadiusFromHalfSize()}updateBoundsRadiusFromHalfSize(){this.bounds[3]=this.halfSize*X$e}advance(e){let r=this.node.children[e];r||(r=ES.createEmptyNode(),this.node.children[e]=r),this.node=r,this.halfSize/=2,this.depth++;const i=Y$e[e];return this.bounds[0]+=i[0]*this.halfSize,this.bounds[1]+=i[1]*this.halfSize,this.bounds[2]+=i[2]*this.halfSize,this.updateBoundsRadiusFromHalfSize(),this}advanceTo(e,r,i=!1){for(;;){if(this.isTerminalFor(e))return r&&r(this,-1),!0;if(this.isLeaf()){if(!i)return r&&r(this,-1),!1;this.node.residents=null}const n=this._childIndex(e);r&&r(this,n),this.advance(n)}}isLeaf(){return this.node.residents!=null}isTerminalFor(e){return e[3]>this.halfSize/2}_childIndex(e){const r=this.bounds;return(r[0]<e[0]?1:0)+(r[1]<e[1]?2:0)+(r[2]<e[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new Vt({shrink:!0}),residents:new Vt({shrink:!0})}}static acquire(){return ES._pool.acquire()}static release(e){ES._pool.release(e)}static clearPool(){ES._pool.prune()}};function Xft(t,e){t[0]=Math.min(t[0],e[0]-e[3]),t[1]=Math.min(t[1],e[1]-e[3]),t[2]=Math.min(t[2],e[2]-e[3])}function Zft(t,e){t[0]=Math.max(t[0],e[0]+e[3]),t[1]=Math.max(t[1],e[1]+e[3]),t[2]=Math.max(t[2],e[2]+e[3])}function xN(t,e,r){r[0]=t[0]+e,r[1]=t[1]+e,r[2]=t[2]+e}function cpe(t,e,r,i){if(e===1){const n=r(t[0]);a2(n,i)}else{Ou[0]=1/0,Ou[1]=1/0,Ou[2]=1/0,Ru[0]=-1/0,Ru[1]=-1/0,Ru[2]=-1/0;for(let n=0;n<e;n++){const s=r(t[n]);NM(s[3])&&(Xft(Ou,s),Zft(Ru,s))}ni(i,Ou,Ru,.5),i[3]=Math.max(Ru[0]-Ou[0],Ru[1]-Ou[1],Ru[2]-Ou[2])/2}}function Jft(t,e,r){if(!vw.length)for(let i=0;i<8;++i)vw.push({index:0,distance:0});for(let i=0;i<8;++i){const n=Y$e[i];vw.data[i].index=i,vw.data[i].distance=t1(t,e,n)}vw.sort((i,n)=>i.distance-n.distance);for(let i=0;i<8;++i)r[i]=vw.data[i].index}function W7(t,e){let r,i=1/0;for(let n=0;n<8;++n){const s=t1(t,e,upe[n]);s<i&&(i=s,r=upe[n])}return r}function t1(t,e,r){return e*(t[0]*r[0]+t[1]*r[1]+t[2]*r[2])}function NM(t){return!isNaN(t)&&t!==-1/0&&t!==1/0&&t>0}po._pool=new ua(po),function(t){var e;(e=t.DepthOrder||(t.DepthOrder={}))[e.FRONT_TO_BACK=1]="FRONT_TO_BACK",e[e.BACK_TO_FRONT=-1]="BACK_TO_FRONT"}(zZ||(zZ={}));const Y$e=[Ce(-1,-1,-1),Ce(1,-1,-1),Ce(-1,1,-1),Ce(1,1,-1),Ce(-1,-1,1),Ce(1,-1,1),Ce(-1,1,1),Ce(1,1,1)],upe=[Ce(-1,-1,-1),Ce(-1,-1,1),Ce(-1,1,-1),Ce(-1,1,1),Ce(1,-1,-1),Ce(1,-1,1),Ce(1,1,-1),Ce(1,1,1)],X$e=Math.sqrt(3),UZ=[null];function Qft(t){return UZ[0]=t,UZ}const q7=Jn(),ph=C(),Ou=C(),Ru=C(),pb=new Vt,Kft=Jn(),Lg=Jn(),Y7=Jn(),X7=Jn(),TN=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],vw=new Vt,hpe=[0,0,0,0,0,0,0,0],Bp=zZ;var q1;(function(t){t[t.ASYNC=0]="ASYNC",t[t.SYNC=1]="SYNC"})(q1||(q1={}));let Z$e=class extends YI{get objects(){return this._objects}constructor(e,r,i=""){super(),this.stage=e,this.apiLayerUid=i,this.type=Cn.Layer,this.events=new Qn,this.visible=!0,this.pickable=!0,this.sliceable=!1,this._objects=new Vt,this._objectsAdded=new Vt,this._handles=new $v,this.apiLayerUid=i,this.visible=(r==null?void 0:r.visible)??!0,this.pickable=(r==null?void 0:r.pickable)??!0,this.updatePolicy=(r==null?void 0:r.updatePolicy)??q1.ASYNC,this._disableOctree=(r==null?void 0:r.disableOctree)??!1,e.add(this);for(const n of Yft)this._handles.add(this.events.on(n,s=>e.handleEvent(n,s)))}destroy(){this._handles.size&&(this._handles.destroy(),this.stage.remove(this),this.invalidateSpatialQueryAccelerator())}add(e){this._objects.push(e),e.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:e}),this._octree!=null&&this._objectsAdded.push(e)}remove(e){this._objects.removeUnordered(e)&&(e.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:e}),this._octree!=null&&(this._objectsAdded.removeUnordered(e)||this._octree.remove([e])))}addMany(e){this._objects.pushArray(e);for(const r of e)r.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:e}),this._octree!=null&&this._objectsAdded.pushArray(e)}removeMany(e){const r=new Array;if(this._objects.removeUnorderedMany(e,e.length,r),r.length!==0){for(const i of r)i.parentLayer=null;if(this.events.emit("layerObjectsRemoved",{layer:this,objects:r}),this._octree!=null){for(let i=0;i<r.length;)this._objectsAdded.removeUnordered(r[i])?(r[i]=r[r.length-1],r.length-=1):++i;this._octree.remove(r)}}}sync(){this.updatePolicy!==q1.SYNC&&this.stage.syncLayer(this.id)}notifyObjectBBChanged(e,r){this._octree==null||this._objectsAdded.includes(e)||this._octree.update(e,r)}getSpatialQueryAccelerator(){return this._octree==null&&this._objects.length>50&&!this._disableOctree?(this._octree=new Bp(e=>e.boundingVolumeWorldSpace.bounds),this._octree.add(this._objects.data,this._objects.length)):this._octree!=null&&this._objectsAdded.length>0&&(this._octree.add(this._objectsAdded.data,this._objectsAdded.length),this._objectsAdded.clear()),this._octree}invalidateSpatialQueryAccelerator(){this._octree=Pe(this._octree),this._objectsAdded.clear()}};function w8(t){return t!=null&&t.type===Cn.Layer}var rc,_2;(function(t){t[t.Draped=0]="Draped",t[t.Screen=1]="Screen",t[t.World=2]="World",t[t.COUNT=3]="COUNT"})(rc||(rc={})),function(t){t[t.Center=0]="Center",t[t.Tip=1]="Tip",t[t.COUNT=2]="COUNT"}(_2||(_2={}));let lo=class extends vl{constructor(){super(...arguments),this.output=U.Color,this.transparencyPassType=ft.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.writeDepth=!1,this.space=rc.Screen,this.hideOnShortSegments=!1,this.hasCap=!1,this.anchor=_2.Center,this.hasTip=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1}get draped(){return this.space===rc.Draped}};d([j({count:U.COUNT})],lo.prototype,"output",void 0),d([j({count:ft.COUNT})],lo.prototype,"transparencyPassType",void 0),d([j()],lo.prototype,"occluder",void 0),d([j()],lo.prototype,"hasSlicePlane",void 0),d([j()],lo.prototype,"writeDepth",void 0),d([j({count:rc.COUNT})],lo.prototype,"space",void 0),d([j()],lo.prototype,"hideOnShortSegments",void 0),d([j()],lo.prototype,"hasCap",void 0),d([j({count:_2.COUNT})],lo.prototype,"anchor",void 0),d([j()],lo.prototype,"hasTip",void 0),d([j()],lo.prototype,"vvSize",void 0),d([j()],lo.prototype,"vvColor",void 0),d([j()],lo.prototype,"vvOpacity",void 0),d([j()],lo.prototype,"hasOccludees",void 0),d([j()],lo.prototype,"multipassEnabled",void 0),d([j()],lo.prototype,"cullAboveGround",void 0),d([j({constValue:!1})],lo.prototype,"occlusionPass",void 0),d([j({constValue:!0})],lo.prototype,"hasVvInstancing",void 0),d([j({constValue:!0})],lo.prototype,"hasSliceTranslatedView",void 0);const dpe=8;function J$e(t,e){const r=t.vertex;r.uniforms.add(new $e("intrinsicWidth",i=>i.width)),e.vvSize?(t.attributes.add(R.SIZEFEATUREATTRIBUTE,"float"),r.uniforms.add(new Ft("vvSizeMinSize",i=>i.vvSize.minSize),new Ft("vvSizeMaxSize",i=>i.vvSize.maxSize),new Ft("vvSizeOffset",i=>i.vvSize.offset),new Ft("vvSizeFactor",i=>i.vvSize.factor)),r.code.add(T`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(t.attributes.add(R.SIZE,"float"),r.code.add(T`float getSize(){
return intrinsicWidth * size;
}`)),e.vvOpacity?(t.attributes.add(R.OPACITYFEATUREATTRIBUTE,"float"),r.constants.add("vvOpacityNumber","int",8),r.uniforms.add(new Zl("vvOpacityValues",i=>i.vvOpacity.values,dpe),new Zl("vvOpacityOpacities",i=>i.vvOpacity.opacityValues,dpe)),r.code.add(T`float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):r.code.add(T`vec4 applyOpacity( vec4 color ){
return color;
}`),e.vvColor?(t.include(B0,e),t.attributes.add(R.COLORFEATUREATTRIBUTE,"float"),r.code.add(T`vec4 getColor(){
return applyOpacity(interpolateVVColor(colorFeatureAttribute));
}`)):(t.attributes.add(R.COLOR,"vec4"),r.code.add(T`vec4 getColor(){
return applyOpacity(color);
}`))}function Z$(t,e,r=0){const i=we(t,0,rmt);for(let n=0;n<4;n++)e[r+n]=Math.floor(256*imt(i*emt[n]))}function Mie(t,e=0){let r=0;for(let i=0;i<4;i++)r+=t[e+i]*tmt[i];return r}const emt=[1,256,65536,16777216],tmt=[1/256,1/65536,1/16777216,1/4294967296],rmt=Mie(new Uint8ClampedArray([255,255,255,255]));function imt(t){return t-Math.floor(t)}let Q$e=class{constructor(e,r,i){this._createTexture=e,this._parametersKey=r,this._repository=new Map,this._orphanCache=i.newCache(`procedural-texture-repository:${Gu()}`,n=>n.dispose())}destroy(){for(const[e,{texture:r}]of this._repository)r.dispose();this._repository.clear(),this._orphanCache.destroy()}swap(e,r=null){const i=this._acquire(e);return this.release(r),i}release(e){if(e==null)return;const r=this._parametersKey(e),i=this._repository.get(r);if(i&&(i.refCount--,i.refCount===0)){this._repository.delete(r);const{texture:n}=i,s=n.usedMemory;this._orphanCache.put(r,n,s)}}_acquire(e){if(e==null)return null;const r=this._parametersKey(e),i=this._repository.get(r);if(i)return i.refCount++,i.texture;const n=this._orphanCache.pop(r)??this._createTexture(e),s=new nmt(n);return this._repository.set(r,s),n}},nmt=class{constructor(e){this.texture=e,this.refCount=1}};function smt(t,e){return new Q$e(r=>{const{encodedData:i,textureSize:n}=omt(r),s=new ri;return s.internalFormat=Tt.RGBA,s.width=n,s.height=1,s.wrapMode=Jt.REPEAT,new Sr(t,s,i)},r=>`${r.pattern.join(",")}-r${r.pixelRatio}`,e)}function omt(t){const e=Oie(t),r=1/t.pixelRatio,i=K$e(t),n=eIe(t),s=(Math.floor(.5*(n-1))+.5)*r,o=[];let a=1;for(const p of e){for(let f=0;f<p;f++){const g=a*(Math.min(f,p-1-f)+.5)*r/s*.5+.5;o.push(g)}a=-a}const l=Math.round(e[0]/2),c=[...o.slice(l),...o.slice(0,l)],u=new Uint8Array(4*i);let h=0;for(const p of c)Z$(p,u,h),h+=4;return{encodedData:u,textureSize:i}}function Oie(t){return t.pattern.map(e=>Math.round(e*t.pixelRatio))}function K$e(t){if(t==null)return 1;const e=Oie(t);return Math.floor(e.reduce((r,i)=>r+i))}function eIe(t){return Oie(t).reduce((e,r)=>Math.max(e,r))}function amt(t){return t==null?qu:t.length===4?t:nn(lmt,t[0],t[1],t[2],1)}const lmt=Zt();function cmt(t,e){t.constants.add("stippleAlphaColorDiscard","float",.001),t.constants.add("stippleAlphaHighlightDiscard","float",.5),e.stippleEnabled?umt(t,e):hmt(t)}function umt(t,e){const r=!(e.draped&&e.stipplePreferContinuous),{vertex:i,fragment:n}=t;n.include(Td),e.draped||(cf(i,e),i.uniforms.add(new $e("worldToScreenPerDistanceRatio",(s,o)=>1/o.camera.perScreenPixelRatio)),i.code.add(T`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`)),t.varyings.add("vStippleDistance","float"),t.varyings.add("vStippleDistanceLimits","vec2"),t.varyings.add("vStipplePatternStretch","float"),i.code.add(T`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${pmt};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `),i.code.add(T`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`),i.code.add(T`
    if (segmentLengthPseudoScreen >= ${r?"patternLength":"1e4"}) {
  `),Y3(i),i.code.add(T`float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
float segmentLengthScreenRounded = flooredRepetitions * patternLength;
float stretch = repetitions / flooredRepetitions;
vStipplePatternStretch = max(0.75, stretch);
return vec2(0.0, segmentLengthScreenRounded);
}
return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
}`),n.uniforms.add(new ct("stipplePatternTexture",s=>s.stippleTexture),new $e("stipplePatternSDFNormalizer",s=>dmt(s.stipplePattern)),new $e("stipplePatternPixelSizeInv",s=>1/tIe(s))),n.code.add(T`float getStippleSDF(out bool isClamped) {
float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;
float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv * vLineSizeInv;
u = fract(u);
float encodedSDF = rgba2float(texture(stipplePatternTexture, vec2(u, 0.5)));
float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;
return (sdf - 0.5) * vStipplePatternStretch + 0.5;
}
float getStippleSDF() {
bool ignored;
return getStippleSDF(ignored);
}
float getStippleAlpha() {
bool isClamped;
float stippleSDF = getStippleSDF(isClamped);
float antiAliasedResult = clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);
return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
}`),e.stippleOffColorEnabled?(n.uniforms.add(new xr("stippleOffColor",s=>amt(s.stippleOffColor))),n.code.add(T`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`)):n.code.add(T`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}function hmt(t){t.fragment.code.add(T`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)}function dmt(t){return t?(Math.floor(.5*(eIe(t)-1))+.5)/t.pixelRatio:1}function tIe(t){const e=t.stipplePattern;return e?K$e(t.stipplePattern)/e.pixelRatio:1}const pmt=T.float(.4);async function cy(t,e){const{data:r}=await Xi(t,{responseType:"image",...e});return r}function fmt(){if(Z7==null){const t=e=>ii(`esri/libs/basisu/${e}`);Z7=ge(()=>import("./basis_transcoder-CdW5vypY.js"),__vite__mapDeps([])).then(e=>e.b).then(({default:e})=>e({locateFile:t}).then(r=>(r.initializeBasis(),delete r.then,r)))}return Z7}let Z7;var qw;(function(t){t[t.ETC1_RGB=0]="ETC1_RGB",t[t.ETC2_RGBA=1]="ETC2_RGBA",t[t.BC1_RGB=2]="BC1_RGB",t[t.BC3_RGBA=3]="BC3_RGBA",t[t.BC4_R=4]="BC4_R",t[t.BC5_RG=5]="BC5_RG",t[t.BC7_M6_RGB=6]="BC7_M6_RGB",t[t.BC7_M5_RGBA=7]="BC7_M5_RGBA",t[t.PVRTC1_4_RGB=8]="PVRTC1_4_RGB",t[t.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA",t[t.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA",t[t.ATC_RGB=11]="ATC_RGB",t[t.ATC_RGBA=12]="ATC_RGBA",t[t.FXT1_RGB=17]="FXT1_RGB",t[t.PVRTC2_4_RGB=18]="PVRTC2_4_RGB",t[t.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA",t[t.ETC2_EAC_R11=20]="ETC2_EAC_R11",t[t.ETC2_EAC_RG11=21]="ETC2_EAC_RG11",t[t.RGBA32=13]="RGBA32",t[t.RGB565=14]="RGB565",t[t.BGR565=15]="BGR565",t[t.RGBA4444=16]="RGBA4444"})(qw||(qw={}));let Kp=null,SN=null;async function rIe(){return SN==null&&(SN=fmt(),Kp=await SN),SN}function mmt(t,e){if(Kp==null)return t.byteLength;const r=new Kp.BasisFile(new Uint8Array(t)),i=nIe(r)?iIe(r.getNumLevels(0),r.getHasAlpha(),r.getImageWidth(0,0),r.getImageHeight(0,0),e):0;return r.close(),r.delete(),i}function gmt(t,e){if(Kp==null)return t.byteLength;const r=new Kp.KTX2File(new Uint8Array(t)),i=sIe(r)?iIe(r.getLevels(),r.getHasAlpha(),r.getWidth(),r.getHeight(),e):0;return r.close(),r.delete(),i}function iIe(t,e,r,i,n){const s=Jte(e?$n.COMPRESSED_RGBA8_ETC2_EAC:$n.COMPRESSED_RGB8_ETC2),o=n&&t>1?(4**t-1)/(3*4**(t-1)):1;return Math.ceil(r*i*s*o)}function nIe(t){return t.getNumImages()>=1&&!t.isUASTC()}function sIe(t){return t.getFaces()>=1&&t.isETC1S()}async function ymt(t,e,r){Kp==null&&(Kp=await rIe());const i=new Kp.BasisFile(new Uint8Array(r));if(!nIe(i))return null;i.startTranscoding();const n=oIe(t,e,i.getNumLevels(0),i.getHasAlpha(),i.getImageWidth(0,0),i.getImageHeight(0,0),(s,o)=>i.getImageTranscodedSizeInBytes(0,s,o),(s,o,a)=>i.transcodeImage(a,0,s,o,0,0));return i.close(),i.delete(),n}async function _mt(t,e,r){Kp==null&&(Kp=await rIe());const i=new Kp.KTX2File(new Uint8Array(r));if(!sIe(i))return null;i.startTranscoding();const n=oIe(t,e,i.getLevels(),i.getHasAlpha(),i.getWidth(),i.getHeight(),(s,o)=>i.getImageTranscodedSizeInBytes(s,0,0,o),(s,o,a)=>i.transcodeImage(a,s,0,0,o,0,-1,-1));return i.close(),i.delete(),n}function oIe(t,e,r,i,n,s,o,a){const{compressedTextureETC:l,compressedTextureS3TC:c}=t.capabilities,[u,h]=l?i?[qw.ETC2_RGBA,$n.COMPRESSED_RGBA8_ETC2_EAC]:[qw.ETC1_RGB,$n.COMPRESSED_RGB8_ETC2]:c?i?[qw.BC3_RGBA,$n.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[qw.BC1_RGB,$n.COMPRESSED_RGB_S3TC_DXT1_EXT]:[qw.RGBA32,Tt.RGBA],p=e.hasMipmap?r:Math.min(1,r),f=[];for(let g=0;g<p;g++)f.push(new Uint8Array(o(g,u))),a(g,u,f[g]);return e.internalFormat=h,e.hasMipmap=f.length>1,e.samplingMode=e.hasMipmap?Ht.LINEAR_MIPMAP_LINEAR:Ht.LINEAR,e.width=n,e.height=s,new Sr(t,e,{type:"compressed",levels:f})}const CN=()=>re.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),vmt=542327876,bmt=131072,wmt=4;function Rie(t){return t.charCodeAt(0)+(t.charCodeAt(1)<<8)+(t.charCodeAt(2)<<16)+(t.charCodeAt(3)<<24)}function xmt(t){return String.fromCharCode(255&t,t>>8&255,t>>16&255,t>>24&255)}const Tmt=Rie("DXT1"),Smt=Rie("DXT3"),Cmt=Rie("DXT5"),Emt=31,Pmt=0,Amt=1,Mmt=2,Omt=3,Rmt=4,$mt=7,Imt=20,Lmt=21;function Dmt(t,e,r){const i=Nmt(r,e.hasMipmap??!1);if(i==null)throw new Error("DDS texture data is null");const{textureData:n,internalFormat:s,width:o,height:a}=i;return e.samplingMode=n.levels.length>1?Ht.LINEAR_MIPMAP_LINEAR:Ht.LINEAR,e.hasMipmap=n.levels.length>1,e.internalFormat=s,e.width=o,e.height=a,new Sr(t,e,n)}function Nmt(t,e){const r=new Int32Array(t,0,Emt);if(r[Pmt]!==vmt)return CN().error("Invalid magic number in DDS header"),null;if(!(r[Imt]&wmt))return CN().error("Unsupported format, must contain a FourCC code"),null;const i=r[Lmt];let n,s;switch(i){case Tmt:n=8,s=$n.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case Smt:n=16,s=$n.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case Cmt:n=16,s=$n.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return CN().error("Unsupported FourCC code:",xmt(i)),null}let o=1,a=r[Rmt],l=r[Omt];!(3&a)&&!(3&l)||(CN().warn("Rounding up compressed texture size to nearest multiple of 4."),a=a+3&-4,l=l+3&-4);const c=a,u=l;let h,p;r[Mmt]&bmt&&e!==!1&&(o=Math.max(1,r[$mt]));let f=r[Amt]+4;const g=[];for(let _=0;_<o;++_)p=(a+3>>2)*(l+3>>2)*n,h=new Uint8Array(t,f,p),g.push(h),f+=p,a=Math.max(1,a>>1),l=Math.max(1,l>>1);return{textureData:{type:"compressed",levels:g},internalFormat:s,width:c,height:u}}let Pv=class extends YI{get parameters(){return this._parameters}constructor(e,r){super(),this._data=e,this.type=Cn.Texture,this._glTexture=null,this._loadingPromise=null,this._loadingController=null,this.events=new Qn,this._parameters={...kmt,...r},this._startPreload(e)}dispose(){this.unload(),this._data=this.frameUpdate=void 0}_startPreload(e){e!=null&&(e instanceof HTMLVideoElement?(this.frameUpdate=r=>this._frameUpdate(e,r),this._startPreloadVideoElement(e)):e instanceof HTMLImageElement&&this._startPreloadImageElement(e))}_startPreloadVideoElement(e){if(!(l$(e.src)||e.preload==="auto"&&e.crossOrigin)){e.preload="auto",e.crossOrigin="anonymous";const r=!e.paused;if(e.src=e.src,r&&e.autoplay){const i=()=>{e.removeEventListener("canplay",i),e.play()};e.addEventListener("canplay",i)}}}_startPreloadImageElement(e){mg(e.src)||l$(e.src)||e.crossOrigin||(e.crossOrigin="anonymous",e.src=e.src)}_createDescriptor(e){const r=new ri;return r.wrapMode=this._parameters.wrap??Jt.REPEAT,r.flipped=!this._parameters.noUnpackFlip,r.samplingMode=this._parameters.mipmap?Ht.LINEAR_MIPMAP_LINEAR:Ht.LINEAR,r.hasMipmap=!!this._parameters.mipmap,r.preMultiplyAlpha=!!this._parameters.preMultiplyAlpha,r.maxAnisotropy=this._parameters.maxAnisotropy??(this._parameters.mipmap?e.parameters.maxMaxAnisotropy:1),r}get glTexture(){return this._glTexture}get memoryEstimate(){var e;return((e=this._glTexture)==null?void 0:e.usedMemory)||Fmt(this._data,this._parameters)}load(e){if(this._glTexture)return this._glTexture;if(this._loadingPromise)return this._loadingPromise;const r=this._data;return r==null?(this._glTexture=new Sr(e,this._createDescriptor(e),null),this._glTexture):(this._parameters.reloadable||(this._data=void 0),typeof r=="string"?this._loadFromURL(e,r):r instanceof Image?this._loadFromImageElement(e,r):r instanceof HTMLVideoElement?this._loadFromVideoElement(e,r):r instanceof ImageData||r instanceof HTMLCanvasElement?this._loadFromImage(e,r):(OA(r)||g1(r))&&this._parameters.encoding===F0.DDS_ENCODING?this._loadFromDDSData(e,r):(OA(r)||g1(r))&&this._parameters.encoding===F0.KTX2_ENCODING?this._loadFromKTX2(e,r):(OA(r)||g1(r))&&this._parameters.encoding===F0.BASIS_ENCODING?this._loadFromBasis(e,r):g1(r)?this._loadFromPixelData(e,r):OA(r)?this._loadFromPixelData(e,new Uint8Array(r)):null)}_frameUpdate(e,r){return this._glTexture==null||e.readyState<_R.HAVE_CURRENT_DATA||r===e.currentTime?r:(this._glTexture.setData(e),this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this._parameters.updateCallback&&this._parameters.updateCallback(),e.currentTime)}_loadFromDDSData(e,r){return this._glTexture=Dmt(e,this._createDescriptor(e),r),this._glTexture}_loadFromKTX2(e,r){return this._loadAsync(()=>_mt(e,this._createDescriptor(e),r).then(i=>(this._glTexture=i,i)))}_loadFromBasis(e,r){return this._loadAsync(()=>ymt(e,this._createDescriptor(e),r).then(i=>(this._glTexture=i,i)))}_loadFromPixelData(e,r){pt(this._parameters.width>0&&this._parameters.height>0);const i=this._createDescriptor(e);return i.pixelFormat=this._parameters.components===1?Tt.LUMINANCE:this._parameters.components===3?Tt.RGB:Tt.RGBA,i.width=this._parameters.width??0,i.height=this._parameters.height??0,this._glTexture=new Sr(e,i,r),this._glTexture}_loadFromURL(e,r){return this._loadAsync(async i=>{const n=await cy(r,{signal:i});return vt(i),this._loadFromImage(e,n)})}_loadFromImageElement(e,r){return r.complete?this._loadFromImage(e,r):this._loadAsync(async i=>{const n=await Awe(r,r.src,!1,i);return vt(i),this._loadFromImage(e,n)})}_loadFromVideoElement(e,r){return r.readyState>=_R.HAVE_CURRENT_DATA?this._loadFromImage(e,r):this._loadFromVideoElementAsync(e,r)}_loadFromVideoElementAsync(e,r){return this._loadAsync(i=>new Promise((n,s)=>{const o=()=>{r.removeEventListener("loadeddata",a),r.removeEventListener("error",l),wi(c)},a=()=>{r.readyState>=_R.HAVE_CURRENT_DATA&&(o(),n(this._loadFromImage(e,r)))},l=u=>{o(),s(u||new K("Failed to load video"))};r.addEventListener("loadeddata",a),r.addEventListener("error",l);const c=ca(i,()=>l(dr()))}))}_loadFromImage(e,r){let i=r;if(!(i instanceof HTMLVideoElement)){const{maxTextureSize:o}=e.parameters;i=this._parameters.downsampleUncompressed?Fit(i,o):kit(i,o)}const n=aIe(i);this._parameters.width=n.width,this._parameters.height=n.height;const s=this._createDescriptor(e);return s.pixelFormat=this._parameters.components===3?Tt.RGB:Tt.RGBA,s.width=n.width,s.height=n.height,this._glTexture=new Sr(e,s,i),this._glTexture}_loadAsync(e){const r=new AbortController;this._loadingController=r;const i=e(r.signal);this._loadingPromise=i;const n=()=>{this._loadingController===r&&(this._loadingController=null),this._loadingPromise===i&&(this._loadingPromise=null)};return i.then(n,n),i}unload(){if(this._glTexture=gt(this._glTexture),this._loadingController!=null){const e=this._loadingController;this._loadingController=null,this._loadingPromise=null,e.abort()}this.events.emit("unloaded")}};function Fmt(t,e){if(t==null)return 0;if(OA(t)||g1(t))return e.encoding===F0.KTX2_ENCODING?gmt(t,!!e.mipmap):e.encoding===F0.BASIS_ENCODING?mmt(t,!!e.mipmap):t.byteLength;const{width:r,height:i}=t instanceof Image||t instanceof ImageData||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement?aIe(t):e;return(e.mipmap?4/3:1)*r*i*(e.components||4)||0}function aIe(t){return t instanceof HTMLVideoElement?{width:t.videoWidth,height:t.videoHeight}:t}var _R;(function(t){t[t.HAVE_NOTHING=0]="HAVE_NOTHING",t[t.HAVE_METADATA=1]="HAVE_METADATA",t[t.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",t[t.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",t[t.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"})(_R||(_R={}));const kmt={wrap:{s:Jt.REPEAT,t:Jt.REPEAT},mipmap:!0,noUnpackFlip:!1,preMultiplyAlpha:!1,downsampleUncompressed:!1},x8=128,$ie=.5;function zmt(t){return t==="cross"||t==="x"}function Umt(t,e=x8,r=e*$ie,i=0){const n=lIe(t,e,r,i);return new Pv(n,{mipmap:!1,wrap:{s:Jt.CLAMP_TO_EDGE,t:Jt.CLAMP_TO_EDGE},width:e,height:e,components:4,noUnpackFlip:!0,reloadable:!0})}function lIe(t,e=x8,r=e*$ie,i=0){switch(t){case"circle":default:return Bmt(e,r);case"square":return Vmt(e,r);case"cross":return jmt(e,r,i);case"x":return Hmt(e,r,i);case"kite":return Gmt(e,r);case"triangle":return Wmt(e,r);case"arrow":return qmt(e,r)}}function Bmt(t,e){const r=t/2-.5;return lL(t,hIe(r,r,e/2))}function Vmt(t,e){return cIe(t,e,!1)}function Gmt(t,e){return cIe(t,e,!0)}function jmt(t,e,r=0){return uIe(t,e,!1,r)}function Hmt(t,e,r=0){return uIe(t,e,!0,r)}function Wmt(t,e){return lL(t,dIe(t/2,e,e/2))}function qmt(t,e){const r=e,i=e/2,n=t/2,s=.8*r,o=hIe(n,(t-e)/2-s,Math.sqrt(s*s+i*i)),a=dIe(n,r,i);return lL(t,(l,c)=>Math.max(a(l,c),-o(l,c)))}function cIe(t,e,r){return r&&(e/=Math.SQRT2),lL(t,(i,n)=>{let s=i-.5*t+.25,o=.5*t-n-.75;if(r){const a=(s+o)/Math.SQRT2;o=(o-s)/Math.SQRT2,s=a}return Math.max(Math.abs(s),Math.abs(o))-.5*e})}function uIe(t,e,r,i=0){e-=i,r&&(e*=Math.SQRT2);const n=.5*e;return lL(t,(s,o)=>{let a,l=s-.5*t,c=.5*t-o-1;if(r){const u=(l+c)/Math.SQRT2;c=(c-l)/Math.SQRT2,l=u}return l=Math.abs(l),c=Math.abs(c),a=l>c?l>n?Math.sqrt((l-n)*(l-n)+c*c):c:c>n?Math.sqrt(l*l+(c-n)*(c-n)):l,a-=i/2,a})}function hIe(t,e,r){return(i,n)=>{const s=i-t,o=n-e;return Math.sqrt(s*s+o*o)-r}}function dIe(t,e,r){const i=Math.sqrt(e*e+r*r);return(n,s)=>{const o=Math.abs(n-t)-r,a=s-t+e/2+.75,l=(e*o+r*a)/i,c=-a;return Math.max(l,c)}}function lL(t,e){const r=new Uint8Array(4*t*t);for(let i=0;i<t;i++)for(let n=0;n<t;n++){const s=n+t*i;let o=e(n,i);o=o/t+.5,Z$(o,r,4*s)}return r}const Fx=64,Iie=Fx/2,pIe=Iie/5,Ymt=Fx/pIe,Xmt=.25;function Zmt(t,e){const r=lIe(t,Fx,Iie,pIe),i=new ri;return i.internalFormat=Tt.RGBA,i.width=Fx,i.height=Fx,i.wrapMode=Jt.CLAMP_TO_EDGE,new Sr(e,i,r)}function fIe(t,e){const{vertex:r,constants:i}=t;i.add("markerSizePerLineWidth","float",Ymt),Y3(r),r.uniforms.get("markerScale")==null&&r.constants.add("markerScale","float",1),r.code.add(T`float getLineWidth() {
return max(getSize(), 1.0) * pixelRatio;
}
float getScreenMarkerSize() {
return markerSizePerLineWidth * markerScale * getLineWidth();
}`),e.space===rc.World&&(r.constants.add("maxSegmentLengthFraction","float",.45),r.uniforms.add(new $e("perRenderPixelRatio",(n,s)=>s.camera.perRenderPixelRatio)),r.code.add(T`bool areWorldMarkersHidden(vec4 pos, vec4 other) {
vec3 midPoint = mix(pos.xyz, other.xyz, 0.5);
float distanceToCamera = length(midPoint);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
float worldMarkerSize = getScreenMarkerSize() * screenToWorldRatio;
float segmentLen = length(pos.xyz - other.xyz);
return worldMarkerSize > maxSegmentLengthFraction * segmentLen;
}
float getWorldMarkerSize(vec4 pos) {
float distanceToCamera = length(pos.xyz);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
return getScreenMarkerSize() * screenToWorldRatio;
}`))}var sd;(function(t){t[t.BUTT=0]="BUTT",t[t.SQUARE=1]="SQUARE",t[t.ROUND=2]="ROUND",t[t.COUNT=3]="COUNT"})(sd||(sd={}));let wn=class extends vl{constructor(){super(...arguments),this.output=U.Color,this.capType=sd.BUTT,this.transparencyPassType=ft.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.writeDepth=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stipplePreferContinuous=!0,this.roundJoins=!1,this.applyMarkerOffset=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.wireframe=!1,this.objectAndLayerIdColorInstanced=!1}};d([j({count:U.COUNT})],wn.prototype,"output",void 0),d([j({count:sd.COUNT})],wn.prototype,"capType",void 0),d([j({count:ft.COUNT})],wn.prototype,"transparencyPassType",void 0),d([j()],wn.prototype,"occluder",void 0),d([j()],wn.prototype,"hasSlicePlane",void 0),d([j()],wn.prototype,"hasPolygonOffset",void 0),d([j()],wn.prototype,"writeDepth",void 0),d([j()],wn.prototype,"draped",void 0),d([j()],wn.prototype,"stippleEnabled",void 0),d([j()],wn.prototype,"stippleOffColorEnabled",void 0),d([j()],wn.prototype,"stipplePreferContinuous",void 0),d([j()],wn.prototype,"roundJoins",void 0),d([j()],wn.prototype,"applyMarkerOffset",void 0),d([j()],wn.prototype,"vvSize",void 0),d([j()],wn.prototype,"vvColor",void 0),d([j()],wn.prototype,"vvOpacity",void 0),d([j()],wn.prototype,"falloffEnabled",void 0),d([j()],wn.prototype,"innerColorEnabled",void 0),d([j()],wn.prototype,"hasOccludees",void 0),d([j()],wn.prototype,"multipassEnabled",void 0),d([j()],wn.prototype,"cullAboveGround",void 0),d([j()],wn.prototype,"wireframe",void 0),d([j()],wn.prototype,"objectAndLayerIdColorInstanced",void 0),d([j({constValue:!1})],wn.prototype,"occlusionPass",void 0),d([j({constValue:!0})],wn.prototype,"hasVvInstancing",void 0),d([j({constValue:!0})],wn.prototype,"hasSliceTranslatedView",void 0);const J$=1;function mIe(t){const e=new Or,{attributes:r,varyings:i,constants:n,vertex:s,fragment:o}=e;e.include(jI),e.include(J$e,t),e.include(cmt,t);const a=t.applyMarkerOffset&&!t.draped;a&&(s.uniforms.add(new $e("markerScale",g=>g.markerScale)),e.include(fIe,{space:rc.World,draped:!1})),t.output===U.LinearDepth&&e.include(ly,t),e.include(Q3,t),Zc(s,t),s.uniforms.add(new ln("inverseProjectionMatrix",(g,_)=>_.camera.inverseProjectionMatrix),new ti("nearFar",(g,_)=>_.camera.nearFar),new $e("miterLimit",g=>g.join!=="miter"?0:g.miterLimit),new xr("viewport",(g,_)=>_.camera.fullViewport)),s.constants.add("LARGE_HALF_FLOAT","float",65500),r.add(R.POSITION,"vec3"),r.add(R.PREVPOSITION,"vec3"),r.add(R.NEXTPOSITION,"vec3"),r.add(R.SUBDIVISIONFACTOR,"float"),r.add(R.UV0,"vec2"),i.add("vColor","vec4"),i.add("vpos","vec3"),i.add("vLineDistance","float"),i.add("vLineWidth","float"),_v(e);const l=t.multipassEnabled&&(t.output===U.Color||t.output===U.Alpha);l&&i.add("depth","float");const c=t.stippleEnabled;c&&i.add("vLineSizeInv","float"),n.add("aaWidth","float",t.stippleEnabled?0:1);const u=t.capType===sd.ROUND,h=t.stippleEnabled&&u,p=t.falloffEnabled||h;p&&i.add("vLineDistanceNorm","float"),u&&(i.add("vSegmentSDF","float"),i.add("vReverseSegmentSDF","float")),s.code.add(T`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`),s.code.add(T`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),sU(e),s.code.add(T`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = nearFar[0] * 0.99;

      if(pos.z > -nearFar[0]) {
        //current pos behind ncp --> we need to clip
        if (!isStartVertex) {
          if(prev.z < -nearFar[0]) {
            //previous in front of ncp
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        } else {
          if(next.z < -nearFar[0]) {
            //next in front of ncp
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        if (prev.z > -nearFar[0]) {
          //previous behind ncp
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        if (next.z > -nearFar[0]) {
          //next behind ncp
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${l?"depth = pos.z;":""}
      linearDepth = calculateLinearDepth(nearFar,pos.z);

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
  `),Y3(s),s.code.add(T`
  void main(void) {
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;
      float lineSize = getSize();

      if (lineSize < 1.0) {
        coverage = lineSize; // convert sub-pixel coverage to alpha
        lineSize = 1.0;
      }
      lineSize += aaWidth;

      float lineWidth = lineSize * pixelRatio;
      vLineWidth = lineWidth;
      ${c?T`vLineSizeInv = 1.0 / lineSize;`:""}

      vec4 pos  = view * vec4(position, 1.0);
      vec4 prev = view * vec4(prevPosition, 1.0);
      vec4 next = view * vec4(nextPosition, 1.0);
  `),a&&s.code.add(T`vec4 other = isStartVertex ? next : prev;
bool markersHidden = areWorldMarkersHidden(pos, other);
if(!isJoin && !markersHidden) {
pos.xyz += normalize(other.xyz - pos.xyz) * getWorldMarkerSize(pos) * 0.5;
}`),s.code.add(T`clipAndTransform(pos, prev, next, isStartVertex);
vec2 left = (pos.xy - prev.xy);
vec2 right = (next.xy - pos.xy);
float leftLen = length(left);
float rightLen = length(right);`),(t.stippleEnabled||u)&&s.code.add(T`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${u?T`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `),s.code.add(T`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`),t.roundJoins?s.code.add(T`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = PERPENDICULAR(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = PERPENDICULAR(endDir);

        float factor = ${t.stippleEnabled?T`min(1.0, subdivisionFactor * ${T.float((J$+2)/(J$+1))})`:T`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):s.code.add(T`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`);const f=t.capType!==sd.BUTT;return s.code.add(T`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      ${f?T`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `),s.code.add(T`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;
    float lineDistNorm = sign(uv0.y) * pos.w;

    vLineDistance =  lineWidth * lineDistNorm;
    ${p?T`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `),u&&s.code.add(T`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`),t.stippleEnabled&&(t.draped?s.uniforms.add(new $e("worldToScreenRatio",(g,_)=>1/_.screenToPCSRatio)):s.code.add(T`vec3 segmentCenter = mix((nextPosition + position) * 0.5, (position + prevPosition) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),s.code.add(T`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(nextPosition - position, position - prevPosition, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),t.draped?s.code.add(T`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):s.code.add(T`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),s.uniforms.add(new $e("stipplePatternPixelSize",g=>tIe(g))),s.code.add(T`float patternLength = lineSize * stipplePatternPixelSize;
vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);
vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);
if (segmentLengthScreenDouble >= 0.001) {
vec2 stippleDisplacement = pos.xy - segmentOrigin;
float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);
vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
}
vStippleDistanceLimits *= pos.w;
vStippleDistance *= pos.w;
vStippleDistanceLimits = isJoin ?
vStippleDistanceLimits :
isStartVertex ?
vec2(-1e34, vStippleDistanceLimits.y) :
vec2(vStippleDistanceLimits.x, 1e34);`)),s.code.add(T`
      // Convert back into NDC
      pos.xy = (pos.xy / viewport.zw) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${t.wireframe&&!t.draped?"pos.z -= 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
      forwardObjectAndLayerIdColor();
    }
  }
  `),l&&e.include(iu,t),e.include(Fn,t),o.include(xg),o.code.add(T`
  void main() {
    discardBySlice(vpos);
    ${l?"terrainDepthTest(depth);":""}
  `),t.wireframe?o.code.add(T`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(u&&o.code.add(T`
        float sdf = min(vSegmentSDF, vReverseSegmentSDF);
        vec2 fragmentPosition = vec2(
          min(sdf, 0.0),
          vLineDistance
        ) * gl_FragCoord.w;

        float fragmentRadius = length(fragmentPosition);
        float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
        float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

        if (capCoverage < ${T.float(Fo)}) {
          discard;
        }
      `),h?o.code.add(T`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${T.float(Fo)}, stippleCoverage);
      `):o.code.add(T`float stippleAlpha = getStippleAlpha();`),t.output!==U.ObjectAndLayerIdColor&&o.code.add(T`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);`),o.uniforms.add(new xr("intrinsicColor",g=>g.color)),o.code.add(T`vec4 color = intrinsicColor * vColor;`),t.innerColorEnabled&&(o.uniforms.add(new xr("innerColor",g=>g.innerColor??g.color),new $e("innerWidth",(g,_)=>g.innerWidth*_.camera.pixelRatio)),o.code.add(T`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),o.code.add(T`vec4 finalColor = blendStipple(color, stippleAlpha);`),t.falloffEnabled&&(o.uniforms.add(new $e("falloff",g=>g.falloff)),o.code.add(T`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`)),t.stippleEnabled||o.code.add(T`float featherStartDistance = max(vLineWidth - 2.0, 0.0);
float value = abs(vLineDistance) * gl_FragCoord.w;
float feather = (value - featherStartDistance) / (vLineWidth - featherStartDistance);
finalColor.a *= 1.0 - clamp(feather, 0.0, 1.0);`)),o.code.add(T`
    ${t.output===U.ObjectAndLayerIdColor?T`finalColor.a = 1.0;`:""}

    if (finalColor.a < ${T.float(Fo)}) {
      discard;
    }

    ${t.output===U.Alpha?T`fragColor = vec4(finalColor.a);`:""}
    ${t.output===U.Color?T`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===U.Color&&t.transparencyPassType===ft.Color?"fragColor = premultiplyAlpha(fragColor);":""}
    ${t.output===U.Highlight?T`fragColor = vec4(1.0);`:""}
    ${t.output===U.LinearDepth?T`outputDepth(linearDepth);`:""}
    ${t.output===U.ObjectAndLayerIdColor?T`outputObjectAndLayerIdColor();`:""}
  }
  `),e}const Jmt=Object.freeze(Object.defineProperty({__proto__:null,build:mIe,ribbonlineNumRoundJoinSubdivisions:J$},Symbol.toStringTag,{value:"Module"})),gIe=new Map([[R.POSITION,0],[R.PREVPOSITION,1],[R.NEXTPOSITION,2],[R.SUBDIVISIONFACTOR,3],[R.UV0,4],[R.COLOR,5],[R.COLORFEATUREATTRIBUTE,5],[R.SIZE,6],[R.SIZEFEATUREATTRIBUTE,6],[R.OPACITYFEATUREATTRIBUTE,7],[R.OBJECTANDLAYERIDCOLOR,8]]);let yIe=class _Ie extends Vr{initializeProgram(e){return new Lr(e.rctx,_Ie.shader.get().build(this.configuration),gIe)}_makePipelineState(e,r){const i=this.configuration,n=e===ft.NONE,s=e===ft.FrontFace,o=est(i.output);return kt({blending:i.output===U.Color||i.output===U.Alpha?n?Zu:Cy(e):null,depthTest:{func:Gv(e)},depthWrite:n?i.writeDepth||o?ru:null:EU(e),colorWrite:Yt,stencilWrite:i.hasOccludees?pg:null,stencilTest:i.hasOccludees?r?Cv:jv:null,polygonOffset:n||s?i.hasPolygonOffset?ppe:null:AU})}initializePipeline(){const e=this.configuration;if(e.occluder){const r=e.hasPolygonOffset?ppe:null;this._occluderPipelineTransparent=kt({blending:Zu,polygonOffset:r,depthTest:m8,depthWrite:null,colorWrite:Yt,stencilWrite:null,stencilTest:ERe}),this._occluderPipelineOpaque=kt({blending:Zu,polygonOffset:r,depthTest:m8,depthWrite:null,colorWrite:Yt,stencilWrite:SRe,stencilTest:CRe}),this._occluderPipelineMaskWrite=kt({blending:null,polygonOffset:r,depthTest:lie,depthWrite:null,colorWrite:null,stencilWrite:pg,stencilTest:Cv})}return this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return this.configuration.wireframe?sr.LINES:sr.TRIANGLE_STRIP}getPipeline(e,r,i){return e?this._occludeePipelineState:this.configuration.occluder?i?this._occluderPipelineTransparent:r?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipeline()}};yIe.shader=new Ir(Jmt,()=>ge(()=>Promise.resolve().then(()=>YNt),void 0));const ppe={factor:0,units:-4};var xc;(function(t){t[t.LEFT_JOIN_START=-2]="LEFT_JOIN_START",t[t.LEFT_JOIN_END=-1]="LEFT_JOIN_END",t[t.LEFT_CAP_START=-4]="LEFT_CAP_START",t[t.LEFT_CAP_END=-5]="LEFT_CAP_END",t[t.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",t[t.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",t[t.RIGHT_CAP_START=4]="RIGHT_CAP_START",t[t.RIGHT_CAP_END=5]="RIGHT_CAP_END"})(xc||(xc={}));let gC=class extends Bv{constructor(e){super(e,new Kmt),this._configuration=new wn,this.produces=new Map([[ue.OPAQUE_MATERIAL,r=>r===U.Highlight||r===U.ObjectAndLayerIdColor||(r===U.Color||r===U.Alpha)&&this.parameters.renderOccluded===kr.OccludeAndTransparentStencil],[ue.OPAQUE_NO_SSAO_DEPTH,r=>r===U.LinearDepth],[ue.OCCLUDER_MATERIAL,r=>vX(r)&&this.parameters.renderOccluded===kr.OccludeAndTransparentStencil],[ue.TRANSPARENT_OCCLUDER_MATERIAL,r=>vX(r)&&this.parameters.renderOccluded===kr.OccludeAndTransparentStencil],[ue.TRANSPARENT_MATERIAL,r=>(r===U.Color||r===U.Alpha)&&this.parameters.writeDepth&&this.parameters.renderOccluded!==kr.OccludeAndTransparentStencil],[ue.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,r=>(r===U.Color||r===U.Alpha)&&!this.parameters.writeDepth&&this.parameters.renderOccluded!==kr.OccludeAndTransparentStencil],[ue.DRAPED_MATERIAL,r=>AAe(r)]]),this._vertexAttributeLocations=gIe}getConfiguration(e,r){this._configuration.output=e,this._configuration.draped=r.slot===ue.DRAPED_MATERIAL;const i=this.parameters.stipplePattern!=null&&e!==U.Highlight;return this._configuration.stippleEnabled=i,this._configuration.stippleOffColorEnabled=i&&this.parameters.stippleOffColor!=null,this._configuration.stipplePreferContinuous=i&&this.parameters.stipplePreferContinuous,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.roundJoins=this.parameters.join==="round",this._configuration.capType=this.parameters.cap,this._configuration.applyMarkerOffset=this.parameters.markerParameters!=null&&tgt(this.parameters.markerParameters),this._configuration.hasPolygonOffset=this.parameters.hasPolygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.innerColorEnabled=this.parameters.innerWidth>0&&this.parameters.innerColor!=null,this._configuration.falloffEnabled=this.parameters.falloff>0,this._configuration.occluder=this.parameters.renderOccluded===kr.OccludeAndTransparentStencil,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.multipassEnabled=r.multipassEnabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration.wireframe=this.parameters.wireframe,this._configuration}intersectDraped(e,r,i,n,s,o){if(!i.options.selectionMode)return;const a=e.attributes.get(R.POSITION).data,l=e.attributes.get(R.SIZE);let c=this.parameters.width;if(this.parameters.vvSize){const _=e.attributes.get(R.SIZEFEATUREATTRIBUTE).data[0];c*=we(this.parameters.vvSize.offset[0]+_*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else l&&(c*=l.data[0]);const u=n[0],h=n[1],p=(c/2+4)*e.screenToWorldRatio;let f=Number.MAX_VALUE,g=0;for(let _=0;_<a.length-5;_+=3){const v=a[_],b=a[_+1],w=u-v,x=h-b,S=a[_+3]-v,E=a[_+4]-b,A=we((S*w+E*x)/(S*S+E*E),0,1),O=S*A-w,L=E*A-x,z=O*O+L*L;z<f&&(f=z,g=_/3)}f<p*p&&s(o.dist,o.normal,g,!1)}intersect(e,r,i,n,s,o){if(!i.options.selectionMode||!e.visible)return;if(!xPe(r))return void re.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial").error("intersection assumes a translation-only matrix");const a=e.attributes,l=a.get(R.POSITION).data;let c=this.parameters.width;if(this.parameters.vvSize){const w=a.get(R.SIZEFEATUREATTRIBUTE).data[0];c*=we(this.parameters.vvSize.offset[0]+w*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else a.has(R.SIZE)&&(c*=a.get(R.SIZE).data[0]);const u=i.camera,h=rgt;eo(h,i.point);const p=c*u.pixelRatio/2+4*u.pixelRatio;ie(eA[0],h[0]-p,h[1]+p,0),ie(eA[1],h[0]+p,h[1]+p,0),ie(eA[2],h[0]+p,h[1]-p,0),ie(eA[3],h[0]-p,h[1]-p,0);for(let w=0;w<4;w++)if(!u.unprojectFromRenderScreen(eA[w],Dg[w]))return;Ma(u.eye,Dg[0],Dg[1],Q7),Ma(u.eye,Dg[1],Dg[2],K7),Ma(u.eye,Dg[2],Dg[3],eG),Ma(u.eye,Dg[3],Dg[0],tG);let f=Number.MAX_VALUE,g=0;const _=vIe(this.parameters,a)?l.length-2:l.length-5;for(let w=0;w<_;w+=3){Pl[0]=l[w]+r[12],Pl[1]=l[w+1]+r[13],Pl[2]=l[w+2]+r[14];const x=(w+3)%l.length;if(Al[0]=l[x]+r[12],Al[1]=l[x+1]+r[13],Al[2]=l[x+2]+r[14],bi(Q7,Pl)<0&&bi(Q7,Al)<0||bi(K7,Pl)<0&&bi(K7,Al)<0||bi(eG,Pl)<0&&bi(eG,Al)<0||bi(tG,Pl)<0&&bi(tG,Al)<0)continue;if(u.projectToRenderScreen(Pl,mb),u.projectToRenderScreen(Al,gb),mb[2]<0&&gb[2]>0){ye(Rf,Pl,Al);const E=u.frustum,A=-bi(E[si.NEAR],Pl)/de(Rf,E[si.NEAR]);ne(Rf,Rf,A),fe(Pl,Pl,Rf),u.projectToRenderScreen(Pl,mb)}else if(mb[2]>0&&gb[2]<0){ye(Rf,Al,Pl);const E=u.frustum,A=-bi(E[si.NEAR],Al)/de(Rf,E[si.NEAR]);ne(Rf,Rf,A),fe(Al,Al,Rf),u.projectToRenderScreen(Al,gb)}else if(mb[2]<0&&gb[2]<0)continue;mb[2]=0,gb[2]=0;const S=jee(Ax(mb,gb,gpe),h);S<f&&(f=S,ce(fpe,Pl),ce(mpe,Al),g=w/3)}const v=i.rayBegin,b=i.rayEnd;if(f<p*p){let w=Number.MAX_VALUE;if(ySe(Ax(fpe,mpe,gpe),Ax(v,b,igt),fb)){ye(fb,fb,v);const x=Te(fb);ne(fb,fb,1/x),w=x/Di(v,b)}o(w,fb,g,!1)}}get _layout(){const e=Qi().vec3f(R.POSITION).vec3f(R.PREVPOSITION).vec3f(R.NEXTPOSITION).f32(R.SUBDIVISIONFACTOR).vec2f(R.UV0);return this.parameters.vvSize?e.f32(R.SIZEFEATUREATTRIBUTE):e.f32(R.SIZE),this.parameters.vvColor?e.f32(R.COLORFEATUREATTRIBUTE):e.vec4f(R.COLOR),this.parameters.vvOpacity&&e.f32(R.OPACITYFEATUREATTRIBUTE),se("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(R.OBJECTANDLAYERIDCOLOR),e}createBufferWriter(){return new egt(this._layout,this.parameters)}createGLMaterial(e){return new Qmt(e)}validateParameters(e){e.join!=="miter"&&(e.miterLimit=0),e.markerParameters!=null&&(e.markerScale=e.markerParameters.width/e.width)}},Qmt=class extends zv{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextureRepository.release(this._stipplePattern),this._stipplePattern=null}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output!==U.Color&&this._output!==U.Alpha||this._updateOccludeeState(e);const r=this._material.parameters.stipplePattern;return this._stipplePattern!==r&&(this._material.setParameters({stippleTexture:this._stippleTextureRepository.swap(r,this._stipplePattern)}),this._stipplePattern=r),this.ensureTechnique(yIe,e)}},Kmt=class extends KI{constructor(){super(...arguments),this.width=0,this.color=qh,this.join="miter",this.cap=sd.BUTT,this.miterLimit=5,this.writeDepth=!0,this.hasPolygonOffset=!1,this.stippleTexture=null,this.stipplePreferContinuous=!0,this.markerParameters=null,this.markerScale=1,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.isClosed=!1,this.falloff=0,this.innerWidth=0,this.hasOccludees=!1,this.wireframe=!1}},egt=class{constructor(e,r){this.vertexBufferLayout=e,this._parameters=r,this.numJoinSubdivisions=0;const i=r.stipplePattern?1:0;switch(this._parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=i;break;case"round":this.numJoinSubdivisions=J$+i}}_isClosed(e){return vIe(this._parameters,e.attributes)}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){const i=e.attributes.get(R.POSITION).indices.length/2+1,n=this._isClosed(e);let s=n?2:2*2;return s+=((n?i:i-1)-(n?0:1))*(2*this.numJoinSubdivisions+4),s+=2,this._parameters.wireframe&&(s=2+4*(s-2)),s}write(e,r,i,n,s){var le,D,I;const o=ngt,a=sgt,l=ogt,c=i.attributes.get(R.POSITION),u=c.indices,h=c.data.length/3,p=(le=i.attributes.get(R.DISTANCETOSTART))==null?void 0:le.data;u&&u.length!==2*(h-1)&&console.warn("RibbonLineMaterial does not support indices");const f=((D=i.attributes.get(R.SIZEFEATUREATTRIBUTE))==null?void 0:D.data[0])??((I=i.attributes.get(R.SIZE))==null?void 0:I.data[0])??1;let g=[1,1,1,1],_=0;const v=this.vertexBufferLayout.fields.has(R.COLORFEATUREATTRIBUTE);v?_=i.attributes.get(R.COLORFEATUREATTRIBUTE).data[0]:i.attributes.has(R.COLOR)&&(g=i.attributes.get(R.COLOR).data);const b=se("enable-feature:objectAndLayerId-rendering")?i.objectAndLayerIdColor:null,w=this.vertexBufferLayout.fields.has(R.OPACITYFEATUREATTRIBUTE),x=w?i.attributes.get(R.OPACITYFEATUREATTRIBUTE).data[0]:0,S=new Float32Array(n.buffer),E=se("enable-feature:objectAndLayerId-rendering")?new Uint8Array(n.buffer):null,A=this.vertexBufferLayout.stride/4;let O=s*A;const L=O;let z=0;const k=p?(F,G,H)=>z=p[H]:(F,G,H)=>z+=Di(F,G),q=se("enable-feature:objectAndLayerId-rendering"),B=(F,G,H,Z,te,me,Me)=>{if(S[O++]=G[0],S[O++]=G[1],S[O++]=G[2],S[O++]=F[0],S[O++]=F[1],S[O++]=F[2],S[O++]=H[0],S[O++]=H[1],S[O++]=H[2],S[O++]=Z,S[O++]=Me,S[O++]=te,S[O++]=f,v)S[O++]=_;else{const it=Math.min(4*me,g.length-4);S[O++]=g[it],S[O++]=g[it+1],S[O++]=g[it+2],S[O++]=g[it+3]}w&&(S[O++]=x),q&&(b!=null&&(E[4*O]=b[0],E[4*O+1]=b[1],E[4*O+2]=b[2],E[4*O+3]=b[3]),O++)};O+=A,ie(a,c.data[0],c.data[1],c.data[2]),e&&Ge(a,a,e);const J=this._isClosed(i);if(J){const F=c.data.length-3;ie(o,c.data[F],c.data[F+1],c.data[F+2]),e&&Ge(o,o,e)}else ie(l,c.data[3],c.data[4],c.data[5]),e&&Ge(l,l,e),B(a,a,l,1,xc.LEFT_CAP_START,0,0),B(a,a,l,1,xc.RIGHT_CAP_START,0,0),ce(o,a),ce(a,l);const W=J?0:1,Y=J?h:h-1;for(let F=W;F<Y;F++){const G=(F+1)%h*3;ie(l,c.data[G],c.data[G+1],c.data[G+2]),e&&Ge(l,l,e),k(o,a,F),B(o,a,l,0,xc.LEFT_JOIN_END,F,z),B(o,a,l,0,xc.RIGHT_JOIN_END,F,z);const H=this.numJoinSubdivisions;for(let Z=0;Z<H;++Z){const te=(Z+1)/(H+1);B(o,a,l,te,xc.LEFT_JOIN_END,F,z),B(o,a,l,te,xc.RIGHT_JOIN_END,F,z)}B(o,a,l,1,xc.LEFT_JOIN_START,F,z),B(o,a,l,1,xc.RIGHT_JOIN_START,F,z),ce(o,a),ce(a,l)}J?(ie(l,c.data[3],c.data[4],c.data[5]),e&&Ge(l,l,e),z=k(o,a,Y),B(o,a,l,0,xc.LEFT_JOIN_END,W,z),B(o,a,l,0,xc.RIGHT_JOIN_END,W,z)):(z=k(o,a,Y),B(o,a,a,0,xc.LEFT_CAP_END,Y,z),B(o,a,a,0,xc.RIGHT_CAP_END,Y,z)),J7(S,L+A,S,L,A),O=J7(S,O-A,S,O,A),this._parameters.wireframe&&this._addWireframeVertices(n,L,O,A)}_addWireframeVertices(e,r,i,n){const s=new Float32Array(e.buffer,i*Float32Array.BYTES_PER_ELEMENT),o=new Float32Array(e.buffer,r*Float32Array.BYTES_PER_ELEMENT,i-r);let a=0;const l=c=>a=J7(o,c,s,a,n);for(let c=0;c<o.length-1;c+=2*n)l(c),l(c+2*n),l(c+1*n),l(c+2*n),l(c+1*n),l(c+3*n)}};function J7(t,e,r,i,n){for(let s=0;s<n;s++)r[i++]=t[e++];return i}function vIe(t,e){return t.isClosed?e.get(R.POSITION).indices.length>2:!1}function tgt(t){return t.anchor===_2.Tip&&t.hideOnShortSegments&&t.placement==="begin-end"&&t.worldSpace}const Pl=C(),Al=C(),Rf=C(),fb=C(),rgt=C(),mb=oa(),gb=oa(),fpe=C(),mpe=C(),gpe=yf(),igt=yf(),ngt=C(),sgt=C(),ogt=C(),eA=[oa(),oa(),oa(),oa()],Dg=[C(),C(),C(),C()],Q7=zr(),K7=zr(),eG=zr(),tG=zr();let Lie=class{constructor(e){this._originSR=e,this._rootOriginId="root/"+Gu(),this._origins=new Map,this._objects=new Map,this._gridSize=5e5}getOrigin(e){const r=this._origins.get(this._rootOriginId);if(r==null){const u=v8(e[0]+Math.random()-.5,e[1]+Math.random()-.5,e[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,u),u}const i=this._gridSize,n=Math.round(e[0]/i),s=Math.round(e[1]/i),o=Math.round(e[2]/i),a=`${n}/${s}/${o}`;let l=this._origins.get(a);const c=.5*i;if(ye(Eo,e,r.vec3),Eo[0]=Math.abs(Eo[0]),Eo[1]=Math.abs(Eo[1]),Eo[2]=Math.abs(Eo[2]),Eo[0]<c&&Eo[1]<c&&Eo[2]<c){if(l){const u=Math.max(...Eo);if(ye(Eo,e,l.vec3),Eo[0]=Math.abs(Eo[0]),Eo[1]=Math.abs(Eo[1]),Eo[2]=Math.abs(Eo[2]),Math.max(...Eo)<u)return l}return r}return l||(l=v8(n*i,s*i,o*i,a),this._origins.set(a,l)),l}_drawOriginBox(e,r=Bt(1,1,0,1)){const i=window.view,n=i._stage,s=r.toString();if(!this._objects.has(s)){this._material=new gC({width:2,color:r}),n.add(this._material);const f=new Z$e(n,{pickable:!1}),g=new Ey({castShadow:!1});n.add(g),f.add(g),this._objects.set(s,g)}const o=this._objects.get(s),a=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],l=a.length,c=new Array(3*l),u=new Array,h=.5*this._gridSize;for(let f=0;f<l;f++)c[3*f]=e[0]+(1&a[f]?h:-h),c[3*f+1]=e[1]+(2&a[f]?h:-h),c[3*f+2]=e[2]+(4&a[f]?h:-h),f>0&&u.push(f-1,f);Ji(c,this._originSR,0,c,i.renderSpatialReference,0,l);const p=new gs(this._material,[[R.POSITION,new Ye(c,u,3,!0)]],null,Cn.Line);n.add(p),o.addGeometry(p)}get test(){const e=this;return{set gridSize(r){e._gridSize=r}}}};const Eo=C();let bIe=class{constructor(e,r,i=null){this.rctx=e,this.sliceHelper=i,this.lastFrameCamera=new Qe,this.output=U.Color,this.renderOccludedMask=T8,this.bindParameters=new nU(r,i!=null?i.plane:null),this.bindParameters.alignPixelEnabled=!0}},agt=class extends bIe{constructor(e,r,i,n){super(e,i,n),this.offscreenRenderingHelper=r,this.sliceHelper=n,this.time=0}};const T8=kr.Occlude|kr.OccludeAndTransparent|kr.OccludeAndTransparentStencil;let FM=class extends Qe{constructor(){super(...arguments),this._projectionMatrix=xe()}get projectionMatrix(){return this._projectionMatrix}};d([m()],FM.prototype,"_projectionMatrix",void 0),d([m({readOnly:!0})],FM.prototype,"projectionMatrix",null),FM=d([V("esri.views.3d.webgl-engine.lib.CascadeCamera")],FM);var v2;(function(t){t[t.Highlight=0]="Highlight",t[t.ExcludeHighlight=1]="ExcludeHighlight"})(v2||(v2={}));let EN=class{constructor(){this.camera=new FM,this.lightMat=xe()}},lgt=class{constructor(){this.maxNumCascadesHighQuality=4,this.maxNumCascadesLowQuality=4,this.textureSizeModHighQuality=1.3,this.textureSizeModLowQuality=.9,this.splitSchemeLambda=0}},Die=class{constructor(e,r){this._fbos=e,this._viewingMode=r,this._enabled=!1,this._snapshots=new Array,this._textureHeight=0,this._numCascades=1,this.settings=new lgt,this._projectionView=xe(),this._projectionViewInverse=xe(),this._modelViewLight=xe(),this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=Zt(),this._cascades=[new EN,new EN,new EN,new EN],this._lastOrigin=null,this._maxTextureWidth=Math.min(se("esri-mobile")?4096:16384,e.rctx.parameters.maxTextureSize)}dispose(){this.enabled=!1,this.disposeOffscreenBuffers()}get depthTexture(){var e;return(e=this._handle)==null?void 0:e.getTexture()}get _textureWidth(){return this._textureHeight*this._numCascades}get numCascades(){return this._numCascades}get cascadeDistances(){return nn(this._usedCascadeDistances,this._cascadeDistances[0],this._numCascades>1?this._cascadeDistances[1]:1/0,this._numCascades>2?this._cascadeDistances[2]:1/0,this._numCascades>3?this._cascadeDistances[3]:1/0)}disposeOffscreenBuffers(){this._handle=tr(this._handle),this._discardSnapshots()}set maxCascades(e){this.settings.maxNumCascadesHighQuality=we(Math.floor(e),1,4)}get maxCascades(){return this.settings.maxNumCascadesHighQuality}set enabled(e){this._enabled=e,e||this.disposeOffscreenBuffers()}get enabled(){return this._enabled}get ready(){return this._enabled&&this.depthTexture!=null}get cascades(){for(let e=0;e<this._numCascades;++e)iG[e]=this._cascades[e];return iG.length=this._numCascades,iG}start(e,r,i,n,s){pt(this.enabled);const{near:o,far:a}=this._clampNearFar(i);this._computeCascadeDistances(o,a,n),this._textureHeight=this._computeTextureHeight(e,s,n),this._setupMatrices(e,r);const{viewMatrix:l,projectionMatrix:c}=e;for(let u=0;u<this._numCascades;++u)this._constructCascade(u,c,l,r);this._lastOrigin=null,this.clear()}finish(){var e;pt(this.enabled),(e=this._handle)==null||e.detachDepth()}getShadowMapMatrices(e){if(!this._lastOrigin||!zo(e,this._lastOrigin)){this._lastOrigin=this._lastOrigin||C(),ce(this._lastOrigin,e);for(let r=0;r<this._numCascades;++r){ic(xpe,this._cascades[r].lightMat,e);for(let i=0;i<16;++i)Tpe[16*r+i]=xpe[i]}}return Tpe}moveSnapshot(e){var r,i;pt(this.enabled),(r=this._handle)==null||r.detachDepth(),(i=this._snapshots[e])==null||i.release(),this._snapshots[e]=this._handle,this._handle=null,this.clear()}copySnapshot(e){var l,c,u,h;const r=(c=(l=this._handle)==null?void 0:l.getTexture())==null?void 0:c.descriptor;if(!this.enabled||!r)return;(u=this._snapshots[e])==null||u.release();const{width:i,height:n}=r,s=e===v2.Highlight?"shadow highlight snapshot":"shadow no highlight snapshot";this._snapshots[e]=this._fbos.acquire(i,n,s,qi.RGBA4);const o=this._fbos.rctx;this._bindFbo();const a=o.bindTexture((h=this._snapshots[e])==null?void 0:h.getTexture(),Sr.TEXTURE_UNIT_FOR_UPDATES);o.gl.copyTexSubImage2D(Sn.TEXTURE_2D,0,0,0,0,0,i,n),o.bindTexture(a,Sr.TEXTURE_UNIT_FOR_UPDATES)}getSnapshot(e){var r;return this.enabled?(r=this._snapshots[e])==null?void 0:r.getTexture():null}clear(){const e=this._fbos.rctx;this._ensureFbo(),this._bindFbo(),e.setClearColor(1,1,1,1),e.clearSafe(Ci.COLOR_BUFFER_BIT|Ci.DEPTH_BUFFER_BIT)}_computeTextureHeight(e,r,i){const n=Math.min(window.devicePixelRatio,r)/e.pixelRatio,s=i?this.settings.textureSizeModHighQuality:this.settings.textureSizeModLowQuality,o=Rx(Math.floor(Math.max(e.fullWidth,e.fullHeight)*n*s)),a=Math.min(this._maxTextureWidth,this._numCascades*o);return Nit(a/this._numCascades)}_ensureFbo(){var e,r,i,n;((e=this._handle)==null?void 0:e.fbo.width)===this._textureWidth&&((r=this._handle)==null?void 0:r.fbo.height)===this._textureHeight||((i=this._handle)==null||i.release(),this._handle=this._fbos.acquire(this._textureWidth,this._textureHeight,"shadow map",qi.RGBA4)),(n=this._handle)==null||n.acquireDepth(ra.DEPTH16_BUFFER)}_discardSnapshot(e){this._snapshots[e]=tr(this._snapshots[e])}_discardSnapshots(){for(let e=0;e<this._snapshots.length;++e)this._discardSnapshot(e);this._snapshots.length=0}_bindFbo(){var r;const e=this._fbos.rctx;e.unbindTexture(this.depthTexture),e.bindFramebuffer((r=this._handle)==null?void 0:r.fbo)}_constructCascade(e,r,i,n){const s=this._cascades[e],o=-this._cascadeDistances[e],a=-this._cascadeDistances[e+1],l=(r[10]*o+r[14])/Math.abs(r[11]*o+r[15]),c=(r[10]*a+r[14])/Math.abs(r[11]*a+r[15]);pt(l<c);for(let f=0;f<8;++f){nn(ype,f%4==0||f%4==3?-1:1,f%4==0||f%4==1?-1:1,f<4?l:c,1);const g=Lh[f];jc(g,ype,this._projectionViewInverse),g[0]/=g[3],g[1]/=g[3],g[2]/=g[3]}Bo(rG,Lh[0]),s.camera.viewMatrix=ic(cgt,this._modelViewLight,rG);for(let f=0;f<8;++f)Ge(Lh[f],Lh[f],s.camera.viewMatrix);let u=Lh[0][2],h=Lh[0][2];for(let f=1;f<8;++f)u=Math.min(u,Lh[f][2]),h=Math.max(h,Lh[f][2]);u-=200,h+=200,s.camera.near=-h,s.camera.far=-u,pgt(i,n,u,h,s.camera),Hr(s.lightMat,s.camera.projectionMatrix,s.camera.viewMatrix);const p=this._textureHeight;s.camera.viewport=[e*p,0,p,p]}_setupMatrices(e,r){Hr(this._projectionView,e.projectionMatrix,e.viewMatrix),os(this._projectionViewInverse,this._projectionView);const i=this._viewingMode===De.Global?e.eye:ie(rG,0,0,1);t9(this._modelViewLight,[0,0,0],[-r[0],-r[1],-r[2]],i)}_clampNearFar(e){let{near:r,far:i}=e;return r<2&&(r=2),i<2&&(i=2),r>=i&&(r=2,i=4),{near:r,far:i}}_computeCascadeDistances(e,r,i){const n=i?this.settings.maxNumCascadesHighQuality:this.settings.maxNumCascadesLowQuality;this._numCascades=Math.min(1+Math.floor(jrt(r/e,4)),n);const s=(r-e)/this._numCascades,o=(r/e)**(1/this._numCascades);let a=e,l=e;for(let c=0;c<this._numCascades+1;++c)this._cascadeDistances[c]=Rt(a,l,this.settings.splitSchemeLambda),a*=o,l+=s}get test(){return{cascades:this._cascades,textureHeight:this._textureHeight}}};const cgt=xe(),ype=Zt(),Lh=[];for(let t=0;t<8;++t)Lh.push(Zt());const _pe=He(),vpe=He(),ugt=He(),bpe=He(),wpe=He(),rG=C(),iG=[],xpe=xe(),Tpe=sn.concat(sn,sn,sn,sn),pu=He(),xT=He(),yb=[He(),He(),He(),He()],Us=He(),nG=He(),n_=He(),tA=He(),TT=He(),ST=He(),PN=He();function hgt(t,e,r,i,n,s,o,a){cr(pu,0,0);for(let E=0;E<4;++E)vp(pu,pu,t[E]);Uc(pu,pu,.25),cr(xT,0,0);for(let E=4;E<8;++E)vp(xT,xT,t[E]);Uc(xT,xT,.25),Vh(yb[0],t[4],t[5],.5),Vh(yb[1],t[5],t[6],.5),Vh(yb[2],t[6],t[7],.5),Vh(yb[3],t[7],t[4],.5);let l=0,c=F6(yb[0],pu);for(let E=1;E<4;++E){const A=F6(yb[E],pu);A<c&&(c=A,l=E)}Em(Us,yb[l],t[l+4]);const u=Us[0];let h,p;Us[0]=-Us[1],Us[1]=u,Em(nG,xT,pu),As(nG,Us)<0&&Wte(Us,Us),Vh(Us,Us,nG,r),L$(Us,Us),h=p=As(Em(n_,t[0],pu),Us);for(let E=1;E<8;++E){const A=As(Em(n_,t[E],pu),Us);A<h?h=A:A>p&&(p=A)}eo(i,pu),Uc(n_,Us,h-e),vp(i,i,n_);let f=-1,g=1,_=0,v=0;for(let E=0;E<8;++E){Em(tA,t[E],i),L$(tA,tA);const A=Us[0]*tA[1]-Us[1]*tA[0];A>0?A>f&&(f=A,_=E):A<g&&(g=A,v=E)}sT(f>0,"leftArea"),sT(g<0,"rightArea"),Uc(TT,Us,h),vp(TT,TT,pu),Uc(ST,Us,p),vp(ST,ST,pu),PN[0]=-Us[1],PN[1]=Us[0];const b=ND(i,t[v],ST,vp(n_,ST,PN),1,n),w=ND(i,t[_],ST,n_,1,s),x=ND(i,t[_],TT,vp(n_,TT,PN),1,o),S=ND(i,t[v],TT,n_,1,a);sT(b,"rayRay"),sT(w,"rayRay"),sT(x,"rayRay"),sT(S,"rayRay")}function Pr(t,e){return 3*e+t}const Spe=He();function pc(t,e){return cr(Spe,t[e],t[e+3]),Spe}const Ml=He(),nt=li();function dgt(t,e,r,i,n){Em(Ml,r,i),Uc(Ml,Ml,.5),nt[0]=Ml[0],nt[1]=Ml[1],nt[2]=0,nt[3]=Ml[1],nt[4]=-Ml[0],nt[5]=0,nt[6]=Ml[0]*Ml[0]+Ml[1]*Ml[1],nt[7]=Ml[0]*Ml[1]-Ml[1]*Ml[0],nt[8]=1,nt[Pr(0,2)]=-As(pc(nt,0),t),nt[Pr(1,2)]=-As(pc(nt,1),t);let s=As(pc(nt,0),r)+nt[Pr(0,2)],o=As(pc(nt,1),r)+nt[Pr(1,2)],a=As(pc(nt,0),i)+nt[Pr(0,2)],l=As(pc(nt,1),i)+nt[Pr(1,2)];s=-(s+a)/(o+l),nt[Pr(0,0)]+=nt[Pr(1,0)]*s,nt[Pr(0,1)]+=nt[Pr(1,1)]*s,nt[Pr(0,2)]+=nt[Pr(1,2)]*s,s=1/(As(pc(nt,0),r)+nt[Pr(0,2)]),o=1/(As(pc(nt,1),r)+nt[Pr(1,2)]),nt[Pr(0,0)]*=s,nt[Pr(0,1)]*=s,nt[Pr(0,2)]*=s,nt[Pr(1,0)]*=o,nt[Pr(1,1)]*=o,nt[Pr(1,2)]*=o,nt[Pr(2,0)]=nt[Pr(1,0)],nt[Pr(2,1)]=nt[Pr(1,1)],nt[Pr(2,2)]=nt[Pr(1,2)],nt[Pr(1,2)]+=1,s=As(pc(nt,1),e)+nt[Pr(1,2)],o=As(pc(nt,2),e)+nt[Pr(2,2)],a=As(pc(nt,1),r)+nt[Pr(1,2)],l=As(pc(nt,2),r)+nt[Pr(2,2)],s=-.5*(s/o+a/l),nt[Pr(1,0)]+=nt[Pr(2,0)]*s,nt[Pr(1,1)]+=nt[Pr(2,1)]*s,nt[Pr(1,2)]+=nt[Pr(2,2)]*s,s=As(pc(nt,1),e)+nt[Pr(1,2)],o=As(pc(nt,2),e)+nt[Pr(2,2)],a=-o/s,nt[Pr(1,0)]*=a,nt[Pr(1,1)]*=a,nt[Pr(1,2)]*=a,n[0]=nt[0],n[1]=nt[1],n[2]=0,n[3]=nt[2],n[4]=nt[3],n[5]=nt[4],n[6]=0,n[7]=nt[5],n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=nt[6],n[13]=nt[7],n[14]=0,n[15]=nt[8]}function pgt(t,e,r,i,n){const s=1/Lh[0][3],o=1/Lh[4][3];pt(s<o);let a=s+Math.sqrt(s*o);const l=Math.sin(Ks(t[2]*e[0]+t[6]*e[1]+t[10]*e[2]));a/=l,hgt(Lh,a,l,_pe,vpe,ugt,bpe,wpe),dgt(_pe,vpe,bpe,wpe,n.projectionMatrix),n.projectionMatrix[10]=2/(r-i),n.projectionMatrix[14]=-(r+i)/(r-i)}function fgt(t){return xd(t)&&t.intersector===Bi.TERRAIN&&!!t.target}let mgt=class extends kI{constructor(e,r,i){super(e,r),this.triangleNr=i}};function wIe(t){return xd(t)&&t.intersector===Bi.OVERLAY&&!!t.target}let BZ=class{constructor(){this.adds=new Vt,this.removes=new Vt,this.updates=new Vt({allocator:e=>e||new ggt,deallocator:e=>(e.renderGeometry=null,e)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}get empty(){return this.adds.length===0&&this.removes.length===0&&this.updates.length===0}},ggt=class{},ygt=class{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}};var en,Is;(function(t){t[t.ADD=0]="ADD",t[t.UPDATE=1]="UPDATE",t[t.REMOVE=2]="REMOVE"})(en||(en={})),function(t){t[t.NONE=0]="NONE",t[t.VISIBILITY=1]="VISIBILITY",t[t.GEOMETRY=2]="GEOMETRY",t[t.TRANSFORMATION=4]="TRANSFORMATION",t[t.HIGHLIGHT=8]="HIGHLIGHT",t[t.OCCLUDEE=16]="OCCLUDEE"}(Is||(Is={}));var Op;function xIe(t){const e=new Map,r=i=>{let n=e.get(i);return n||(n=new ygt,e.set(i,n)),n};return t.removes.forAll(i=>{sG(i)&&r(i.material).removes.push(i)}),t.adds.forAll(i=>{sG(i)&&r(i.material).adds.push(i)}),t.updates.forAll(i=>{sG(i.renderGeometry)&&r(i.renderGeometry.material).updates.push(i)}),e}function sG(t){return t.geometry.indexCount>=1}(function(t){t[t.Default=0]="Default",t[t.Screenshot=1]="Screenshot",t[t.ObjectAndLayerID=2]="ObjectAndLayerID"})(Op||(Op={}));let TIe=class{constructor(e,r){this._material=e,this._repository=r,this._map=new Map}dispose(){this._map.forEach((e,r)=>{e!=null&&this._repository.release(this._material,r)})}load(e,r,i){const n=this._material.produces.get(r);if(!n||!n(i))return null;this._map.has(i)||this._map.set(i,this._repository.acquire(this._material,r,i));const s=this._map.get(i);if(s!=null){if(s.ensureResources(e)===gv.LOADED)return s;this._repository.requestRender()}return null}},VZ=class extends TRe{constructor(e=C()){super(),this.origin=e,this.slicePlaneLocalOrigin=this.origin}},Nie=class{constructor(e=0,r=0){this.from=e,this.to=r}get numElements(){return this.to-this.from}};function Cpe(t){const e=new Map;t.forAll(i=>e.set(i.from,i));let r=!0;for(;r;){r=!1;for(let i=0;i<t.length;++i){const n=t.data[i],s=e.get(n.to);if(!s)return;n.to=s.to,e.delete(s.from),t.removeUnordered(s),r=!0}}}let Epe=class extends Nie{constructor(e,r,i){super(r,i),this.geometry=e}get isVisible(){return this.geometry.visible}get hasHighlights(){return this.geometry.highlights!=null&&this.isVisible}get hasOccludees(){return this.geometry.occludees!=null}},_gt=class{constructor(){this.first=0,this.count=0}},vgt=class{constructor(){this._numElements=0,this._instances=new Map,this.holes=new Vt({allocator:e=>e||new Nie,deallocator:null}),this.hasHiddenInstances=!1,this.hasHighlights=!1,this.hasOccludees=!1,this.drawCommandsDirty=!0,this.drawCommandsDefault=AN(),this.drawCommandsHighlight=AN(),this.drawCommandsOccludees=AN(),this.drawCommandsShadowHighlightRest=AN()}get numElements(){return this._numElements}get instances(){return this._instances}addInstance(e,r){this.deleteInstance(e),this._instances.set(e,r),this._numElements+=r.numElements}deleteInstance(e){const r=this._instances.get(e);r&&(this._numElements-=r.numElements,this._instances.delete(e))}updateInstance(e,r,i){const n=this._instances.get(e);n&&(this._numElements-=n.numElements,n.from=r,n.to=i,this._numElements+=n.numElements)}updateDrawState(e){e.isVisible?(e.hasHighlights&&(this.hasHighlights=!0),e.hasOccludees&&(this.hasOccludees=!0)):this.hasHiddenInstances=!0}updateDrawCommands(e){if(this.drawCommandsDefault.clear(),this.drawCommandsHighlight.clear(),this.drawCommandsOccludees.clear(),this.drawCommandsShadowHighlightRest.clear(),this.drawCommandsDirty=!1,this._instances.size===0)return;if(!this.needsMultipleCommands()){const i=this.drawCommandsDefault.pushNew(),n=this.holes.front();return this.vao!=null&&this.holes.length===1&&n.to===Math.floor(this.vao.byteSize/e)?(i.first=0,void(i.count=n.from)):(i.first=1/0,i.count=0,this._instances.forEach(s=>{i.first=Math.min(i.first,s.from),i.count=Math.max(i.count,s.to)}),void(i.count-=i.first))}const r=Array.from(this._instances.values()).sort((i,n)=>i.from===n.from?i.to-n.to:i.from-n.from);for(const i of r)i.isVisible&&(Ppe(i.hasOccludees?this.drawCommandsOccludees:this.drawCommandsDefault,i),Ppe(i.hasHighlights?this.drawCommandsHighlight:this.drawCommandsShadowHighlightRest,i))}needsMultipleCommands(){return this.hasOccludees||this.hasHighlights||this.hasHiddenInstances}};function bgt(t){return t.vao!=null}function AN(){return new Vt({allocator:t=>t||new _gt,deallocator:t=>t})}function Ppe(t,e){const r=t.back();if(r==null){const i=t.pushNew();return i.first=e.from,void(i.count=e.numElements)}if(wgt(r,e)){const i=e.from-r.first+e.numElements;r.count=i}else{const i=t.pushNew();i.first=e.from,i.count=e.numElements}}function wgt(t,e){return t.first+t.count>=e.from}let xgt=class{constructor(e){this.origin=e,this.buffers=new Array}dispose(){this.buffers.forEach(e=>e.vao.dispose()),this.buffers.length=0}findBuffer(e){return this.buffers.find(r=>r.instances.has(e))}};const GZ=-3,SIe=GZ-1;var wp;(function(t){t[t.ALL=0]="ALL",t[t.SOME=1]="SOME"})(wp||(wp={}));let Tgt=class{constructor(e,r,i){this.name=e,this._storage=r,this.id=Sgt+++":",this.size=0,this.maxSize=-1,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),i&&(this._storage.registerRemoveFunc(this.id,i),this._removeFunc=!0)}destroy(){this._storage.clear(this),this._removeFunc&&this._storage.deregisterRemoveFunc(this.id),this._storage.deregister(this),this._storage=null}get hitRate(){return this._hit/(this._hit+this._miss)}get storageSize(){return this._storage.size}getSize(e){return this._storage.getSize(this,e)}resetHitRate(){this._hit=this._miss=0}put(e,r,i,n=0){this._storage.put(this,e,r,i,n)}pop(e){const r=this._storage.pop(this,e);return r===void 0?++this._miss:++this._hit,r}get(e){const r=this._storage.get(this,e);return r===void 0?++this._miss:++this._hit,r}peek(e){return this._storage.peek(this,e)}updateSize(e,r,i){this._storage.updateSize(this,e,r,i)}clear(){this._storage.clear(this)}clearAll(){this._storage.clearAll()}get performanceInfo(){return this._storage.performanceInfo}resetStats(){this._storage.resetStats()}},CIe=class{get size(){return this._size}constructor(e=10485760){this._maxSize=e,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new Vt,this._users=new Vt}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(e){this._users.push(e)}deregister(e){this._users.removeUnordered(e)}registerRemoveFunc(e,r){this._removeFuncs.push([e,r])}deregisterRemoveFunc(e){this._removeFuncs.filterInPlace(r=>r[0]!==e)}get maxSize(){return this._maxSize}set maxSize(e){this._maxSize=Math.max(e,-1),this._checkSize()}getSize(e,r){const i=this._db.get(e.id+r);return(i==null?void 0:i.size)??0}put(e,r,i,n,s){r=e.id+r;const o=this._db.get(r);if(o&&(this._size-=o.size,e.size-=o.size,this._db.delete(r),o.entry!==i&&this._notifyRemove(r,o.entry,o.size,wp.ALL)),n>this._maxSize)return void this._notifyRemove(r,i,n,wp.ALL);if(i===void 0)return void console.warn("Refusing to cache undefined entry ");if(!n||n<0)return console.warn(`Refusing to cache entry with size ${n} for key ${r}`),void this._notifyRemove(r,i,0,wp.ALL);const a=1+Math.max(s,SIe)-GZ;this._db.set(r,new Cgt(i,n,a)),this._size+=n,e.size+=n,this._checkSize()}updateSize(e,r,i,n){r=e.id+r;const s=this._db.get(r);if(s&&s.entry===i){for(this._size-=s.size,e.size-=s.size;n>this._maxSize;){const o=this._notifyRemove(r,i,n,wp.SOME);if(!(o!=null&&o>0))return void this._db.delete(r);n=o}s.size=n,this._size+=n,e.size+=n,this._checkSize()}}pop(e,r){r=e.id+r;const i=this._db.get(r);if(i)return this._size-=i.size,e.size-=i.size,this._db.delete(r),++this._hit,i.entry;++this._miss}get(e,r){r=e.id+r;const i=this._db.get(r);if(i!==void 0)return this._db.delete(r),i.lives=i.lifetime,this._db.set(r,i),++this._hit,i.entry;++this._miss}peek(e,r){const i=this._db.get(e.id+r);return i?++this._hit:++this._miss,i==null?void 0:i.entry}get performanceInfo(){const e={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},r={},i=new Array;this._db.forEach((o,a)=>{const l=o.lifetime;i[l]=(i[l]||0)+o.size,this._users.forAll(c=>{const{id:u,name:h}=c;if(a.startsWith(u)){const p=r[h]||0;r[h]=p+o.size}})});const n={};this._users.forAll(o=>{const a=o.name;if("hitRate"in o&&typeof o.hitRate=="number"&&!isNaN(o.hitRate)&&o.hitRate>0){const l=r[a]||0;r[a]=l,n[a]=Math.round(100*o.hitRate)+"%"}else n[a]="0%"});const s=Object.keys(r);s.sort((o,a)=>r[a]-r[o]),s.forEach(o=>e[o]=Math.round(r[o]/2**20)+"MB / "+n[o]);for(let o=i.length-1;o>=0;--o){const a=i[o];a&&(e["Priority "+(o+GZ-1)]=Math.round(a/this._size*100)+"%")}return e}resetStats(){this._hit=this._miss=0,this._users.forAll(e=>e.resetHitRate())}clear(e){const r=e.id;this._db.forEach((i,n)=>{n.startsWith(r)&&(this._size-=i.size,this._db.delete(n),this._notifyRemove(n,i.entry,i.size,wp.ALL))}),e.size=0}clearAll(){this._db.forEach((e,r)=>this._notifyRemove(r,e.entry,e.size,wp.ALL)),this._users.forAll(e=>e.size=0),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(e,r,i,n){let s;return this._removeFuncs.some(o=>{if(e.startsWith(o[0])){const a=o[1](r,n,i);return typeof a=="number"&&(s=a),!0}return!1}),s}_checkSize(){this._users.forAll(e=>this._checkSizeLimits(e)),this._checkSizeLimits()}_checkSizeLimits(e){const r=e??this;if(r.maxSize<0||r.size<=r.maxSize)return;const i=e==null?void 0:e.id;let n=!0;for(;n;){n=!1;for(const[s,o]of this._db)if(o.lifetime===0&&(!i||s.startsWith(i))){if(this._purgeItem(s,o,e),r.size<=.9*r.maxSize)return;n||(n=this._db.has(s))}}for(const[s,o]of this._db)if((!i||s.startsWith(i))&&(this._purgeItem(s,o,e),r.size<=.9*r.maxSize))return}_purgeItem(e,r,i=this._users.find(n=>e.startsWith(n.id))){if(this._db.delete(e),r.lives<=1){this._size-=r.size,i&&(i.size-=r.size);const n=this._notifyRemove(e,r.entry,r.size,wp.SOME);n!=null&&n>0&&(this._size+=n,i&&(i.size+=n),r.lives=r.lifetime,r.size=n,this._db.set(e,r))}else--r.lives,this._db.set(e,r)}},Sgt=0,Cgt=class{constructor(e,r,i){this.entry=e,this.size=r,this.lifetime=i,this.lives=i}},cL=class{constructor(e,r){this._cache=e(r,(i,n,s)=>this._remove(i,n,s))}hitrate(){return this._cache.hitRate}destroy(){this._cache.destroy()}clear(){this._cache.clear()}getSize(e){return this._cache.getSize(e)}pop(e){const r=this._cache.peek(e);if(!r)return;const i=r.pop();if(r.length>0){if(i){const n=this._cache.getSize(e)-Math.round(i.usedMemory);this._cache.updateSize(e,r,n)}}else this._cache.pop(e);return i}put(e,r,i=SIe){const n=this._cache.peek(e);if(!n)return void this._cache.put(e,[r],r.usedMemory,i);n.push(r);const s=this._cache.getSize(e)+Math.round(r.usedMemory);this._cache.updateSize(e,n,s)}_remove(e,r,i){switch(r){case wp.ALL:return e.forEach(n=>n.dispose()),0;case wp.SOME:{const n=e.shift();return n&&(i-=Math.round(n.usedMemory),n.dispose()),i}}}},Egt=class{constructor(e,r,i){this._rctx=e,this._locations=r,this._layout=i,this._cache=new cL(e.newCache,"VAOCache")}dispose(){this._cache.destroy()}newVao(e){const r=e.toString();let i=this._cache.pop(r);return i||(i=new _f(this._rctx,this._locations,{geometry:this._layout},{geometry:Wr.createVertex(this._rctx,Ar.STATIC_DRAW)}),i.vertexBuffers.geometry.setSize(e),i)}deleteVao(e){if(e==null)return;const r=e.byteSize.toString();this._cache.put(r,e)}},vR=class extends mMe{constructor(e){super(e),this._vaoCache=null,this._glMaterials=null,this._bufferWriter=null,this._dataByOrigin=new Map,this._hasHighlights=!1,this._hasOccludees=!1,this._produces=new Map,this.drapedPriority=0}destroy(){this._glMaterials=gt(this._glMaterials),this._dataByOrigin.forEach(e=>e.dispose()),this._dataByOrigin.clear(),this._vaoCache=gt(this._vaoCache)}initialize(){this.material.produces.forEach((e,r)=>{this._produces.set(r,i=>!(this._dataByOrigin.size===0||!(i!==U.Highlight&&i!==U.ShadowHighlight||this._hasHighlights))&&e(i))})}get produces(){return this._produces}initializeRenderContext(e,r){const{rctx:i}=e.renderContext;this._glMaterials=new TIe(this.material,r??e.materialRepository),this._bufferWriter=this.material.createBufferWriter(),this._vaoCache=new Egt(i,this.material.vertexAttributeLocations,ou(this._bufferWriter.vertexBufferLayout))}uninitializeRenderContext(){}get hasOccludees(){return this._hasOccludees}get isDecoration(){return this.material.parameters.isDecoration}queryRenderOccludedState(e){return this.material.queryRenderOccludedState(e)}get materialReference(){return this.material}get numGeometries(){let e=0;return this._dataByOrigin.forEach(r=>e+=r.buffers.reduce((i,n)=>i+n.instances.size,0)),e}get usedMemory(){let e=0;return this._dataByOrigin.forEach(r=>e+=r.buffers.reduce((i,n)=>i+n.vao.usedMemory,0)),e}forEachGeometry(e){this._dataByOrigin.forEach(r=>r.buffers.forEach(i=>i.instances.forEach(n=>e(n.geometry))))}modify(e){this._updateGeometries(e.updates),this._addAndRemoveGeometries(e.adds,e.removes),this._updateDrawCommands()}_updateGeometries(e){const r=this._bufferWriter;if(r===null)return;const i=r.vertexBufferLayout.stride/4;for(const n of e){const s=n.renderGeometry,o=this._dataByOrigin.get(s.localOrigin.id),a=o==null?void 0:o.findBuffer(s.id);if(a==null)return;const l=a.instances.get(s.id);if(n.updateType&(Is.GEOMETRY|Is.TRANSFORMATION)){const c=RN(r.elementCount(l.geometry.geometry)*i),u=r.vertexBufferLayout.createView(c.buffer);this._writeGeometry(s,u,0),a.vao.vertexBuffers.geometry.setSubData(c,l.from*i,0,l.numElements*i)}n.updateType&(Is.HIGHLIGHT|Is.OCCLUDEE|Is.VISIBILITY)&&(a.drawCommandsDirty=!0)}}_computeDeltas(e,r){const i=new xv;for(const n of e){const s=n.localOrigin;if(s==null)continue;let o=i.get(s.id,null);o==null&&(o=new Ape(s.vec3),i.set(s.id,null,o)),o.changes.push(n)}for(const n of r){const s=n.localOrigin;if(s==null)continue;const o=this._dataByOrigin.get(s.id),a=o==null?void 0:o.findBuffer(n.id);if(a==null)continue;let l=i.get(s.id,a);l==null&&(l=new Ape(s.vec3),i.set(s.id,a,l)),l.changes.push(n)}return i}_addAndRemoveGeometries(e,r){if(this._bufferWriter===null||this._vaoCache===null)return;const{_bufferWriter:i,_dataByOrigin:n}=this,s=i.vertexBufferLayout.stride/4,o=this._computeDeltas(e,r);o.forEach((a,l)=>{const c=a.get(null),u=c!=null?c.changes:[];o.delete(l,null);let h=n.get(l);if(a.forEach((p,f)=>{if(o.delete(l,f),f==null)return void pt(!1,"No VAO for removed geometries");if(f.instances.size===p.changes.length)return this._vaoCache.deleteVao(f.vao),t$(h.buffers,f),void(h.buffers.length===0&&u.length===0&&n.delete(l));const g=f.numElements,_=f.vao.byteSize/4,v=u.reduce((S,E)=>S+i.elementCount(E.geometry),0),b=p.changes.reduce((S,E)=>S+i.elementCount(E.geometry),0),w=Math.min((g+v-b)*s,ON),x=w>_;w>S8&&w<_/2?(p.changes.forEach(({id:S})=>f.deleteInstance(S)),f.instances.forEach(({geometry:S})=>u.push(S)),this._vaoCache.deleteVao(f.vao),t$(h.buffers,f)):x?this._applyAndRebuild(f,u,p):this._applyRemoves(f,p)}),u.length>0)for(h==null&&(h=new xgt(c.origin),n.set(l,h)),h.buffers.forEach(p=>this._applyAdds(p,u));u.length>0;)h.buffers.push(this._applyAndRebuild(new vgt,u,null))})}_updateDrawCommands(){this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach(e=>{e.buffers.forEach(r=>{r.drawCommandsDirty&&(r.hasHiddenInstances=!1,r.hasHighlights=!1,r.hasOccludees=!1,Zh(r.instances,i=>(r.updateDrawState(i),r.hasHiddenInstances&&r.hasHighlights&&r.hasOccludees)),r.updateDrawCommands(this._bufferWriter.vertexBufferLayout.stride)),this._hasHighlights=this._hasHighlights||r.hasHighlights,this._hasOccludees=this._hasOccludees||r.hasOccludees})})}_applyAndRebuild(e,r,i){if(i!=null)for(const g of i.changes)e.deleteInstance(g.id);const n=this._bufferWriter,s=n.vertexBufferLayout.stride,o=s/4,a=Math.floor(ON/o);let l=e.numElements;for(;r.length>0;){const g=r.pop(),_=n.elementCount(g.geometry);if(l+_>a&&l>0){r.push(g);break}l+=_;const v=new Epe(g,0,0);pt(e.instances.get(g.id)==null),e.addInstance(g.id,v)}const c=l*o,u=RN(c),h=n.vertexBufferLayout.createView(u.buffer);let p=0;e.hasHiddenInstances=!1,e.hasHighlights=!1,e.hasOccludees=!1,e.instances.forEach((g,_)=>{this._writeGeometry(g.geometry,h,p);const v=p;p+=n.elementCount(g.geometry.geometry),e.updateInstance(_,v,p),e.updateDrawState(g)}),this._vaoCache.deleteVao(e.vao),e.vao=this._vaoCache.newVao(Rpe(c)),e.vao.vertexBuffers.geometry.setSubData(u,0,0,p*o),e.holes.clear();const f=e.holes.pushNew();return f.from=p,f.to=Math.floor(e.vao.byteSize/s),e.updateDrawCommands(s),e}_applyRemoves(e,r){if(r.changes.length===0||this._bufferWriter===null)return;for(const a of r.changes){const l=a.id,c=e.instances.get(l);if(!c)continue;e.deleteInstance(l);const u=$f.back();if(u){if(u.to===c.from){u.to=c.to;continue}if(u.from===c.to){u.from=c.from;continue}}const h=$f.pushNew();h.from=c.from,h.to=c.to}Cpe($f);const i=this._bufferWriter.vertexBufferLayout.stride/4,n=$f.reduce((a,l)=>Math.max(a,l.numElements),0)*i,s=RN(n);s.fill(0,0,n);const o=e.vao.vertexBuffers.geometry;$f.forAll(a=>o.setSubData(s,a.from*i,0,a.numElements*i)),e.holes.pushArray($f.data,$f.length),$f.forAll((a,l)=>$f.data[l]=null),$f.clear(),e.drawCommandsDirty=!0}_applyAdds(e,r){if(r.length===0||this._bufferWriter===null)return;if(!bgt(e))return void this._applyAndRebuild(e,r,null);const i=this._bufferWriter,n=i.vertexBufferLayout.stride/4,s=e.numElements,o=r.reduce((b,w)=>b+i.elementCount(w.geometry),0),a=Math.min((s+o)*n,ON),l=4*a;if(e.vao.byteSize<Rpe(ON-S8)&&l>e.vao.byteSize)return void this._applyAndRebuild(e,r,null);Cpe(e.holes);const c=new Array;for(const b of r){const w=i.elementCount(b.geometry),x=Pgt(e.holes,w);c.push(x)}const u=e.vao.vertexBuffers.geometry;let h=0,p=0,f=0;const g=RN(a),_=i.vertexBufferLayout.createView(g.buffer);r.forEach((b,w)=>{const x=c[w];if(x==null)return;if(f!==x){const A=f-p;A>0&&u.setSubData(g,p*n,0,A*n),p=x,h=0}const S=i.elementCount(b.geometry);this._writeGeometry(b,_,h),h+=S,f=x+S;const E=new Epe(b,x,x+S);pt(e.instances.get(b.id)==null),e.addInstance(b.id,E),e.drawCommandsDirty=!0});const v=f-p;v>0&&u.setSubData(g,p*n,0,v*n),gze(r,(b,w)=>c[w]==null)}_writeGeometry(e,r,i){if(this._bufferWriter===null)return;const n=e.localOrigin.vec3;Hrt(Mpe,-n[0],-n[1],-n[2]);const s=Hr(Agt,Mpe,e.transformation);os(MN,s),Qc(MN,MN),this._bufferWriter.write(s,MN,e.geometry,r,i)}updateAnimation(e){return this.material.update(e)}prepareTechnique(e){if(!this.material.shouldRender(e))return null;const{output:r,bindParameters:i}=e,n=this.material.produces.get(i.slot);if(!n||!n(r))return null;const s=r===U.Highlight||r===U.ShadowHighlight;if(s&&!this._hasHighlights)return null;const o=r===U.ShadowExcludeHighlight,a=!(s||o);for(const l of this._dataByOrigin.values())for(const c of l.buffers){if(s&&!c.hasHighlights)continue;const u=(s?c.drawCommandsHighlight:o&&c.needsMultipleCommands()?c.drawCommandsShadowHighlightRest:c.drawCommandsDefault)||null,h=a&&c.drawCommandsOccludees||null;if(u!=null&&u.length||h!=null&&h.length){const p=this._glMaterials.load(e.rctx,i.slot,r),f=p!=null?p.beginSlot(i):null;if(f!=null)return f}}return null}renderNode(e,r){const{output:i,bindParameters:n}=e,s=i===U.Highlight||i===U.ShadowHighlight,o=i===U.ShadowExcludeHighlight,a=!(s||o),l=e.rctx,c=e.bindParameters.slot===ue.OCCLUDER_MATERIAL,u=e.bindParameters.slot===ue.TRANSPARENT_OCCLUDER_MATERIAL;l.runAppleAmdDriverHelper(),l.bindTechnique(r,n,this.material.parameters);for(const h of this._dataByOrigin.values())for(const p of h.buffers){if(s&&!p.hasHighlights)continue;const f=(s?p.drawCommandsHighlight:o&&p.needsMultipleCommands()?p.drawCommandsShadowHighlightRest:p.drawCommandsDefault)||null,g=a&&p.drawCommandsOccludees||null;(f!=null&&f.length||g!=null&&g.length)&&(r.program.bindDraw(new VZ(h.origin),n,this.material.parameters),r.ensureAttributeLocations(p.vao),l.bindVAO(p.vao),f!=null&&f.length&&(l.setPipelineState(r.getPipeline(!1,c,u)),f.forAll(_=>l.drawArrays(r.primitiveType,_.first,_.count))),g!=null&&g.length&&(l.setPipelineState(r.getPipeline(!0,c,u)),g.forAll(_=>l.drawArrays(r.primitiveType,_.first,_.count))))}}get test(){return{material:this.material,glMaterials:this._glMaterials,dataByOrigin:this._dataByOrigin}}};d([m({constructOnly:!0})],vR.prototype,"material",void 0),vR=d([V("esri.views.3d.webgl-engine.materials.renderers.MergedRenderer")],vR);let Ape=class{constructor(e){this.origin=e,this.changes=new Array}};function Pgt(t,e){let r;if(!t.some(n=>!(n.numElements<e)&&(r=n,!0)))return null;const i=r.from;return r.from+=e,r.from>=r.to&&t.removeUnordered(r),i}const Mpe=xe(),Agt=xe(),MN=xe(),$f=new Vt({allocator:t=>t||new Nie,deallocator:null}),S8=65536,oG=4*S8,Ope=1024,EIe=16777216,ON=EIe/4;let aG=new Float32Array(S8);function RN(t){return aG.length<t&&(aG=new Float32Array(t)),aG}function Rpe(t){const e=4*t;return e<=Ope?Ope:e<oG?Sxe(e):Math.max(Math.min(Math.ceil(1.5*e/oG)*oG,EIe),e)}let Tu=class extends Ae{constructor(e){super(e),this._pending=new Mgt,this._changes=new BZ,this._materialRenderers=new Vt,this._sortedMaterialRenderers=new Vt,this._geometries=new Map,this._hasHighlights=!1,this._hasWater=!1}destroy(){this._changes.prune(),this._materialRenderers.forAll(e=>e.destroy()),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear(),this._geometries.clear(),this._pending.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get rctx(){return this.rendererContext.rctx}get _materialRepository(){return this.rendererContext.materialRepository}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccludedDraped(){return this._materialRenderers.some(e=>e.numGeometries!==0&&!e.queryRenderOccludedState(kr.Occlude))}get isEmpty(){return!this.updating&&this._materialRenderers.length===0&&this._geometries.size===0}getMemoryForMaterial(e){if(e==null)return 0;const r=this._materialRenderers.find(i=>i.materialReference===e);return(r==null?void 0:r.usedMemory)??0}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();const e=xIe(this._changes);let r=!1;return e.forEach((i,n)=>{let s=this._materialRenderers.find(o=>o.materialReference===n);if(!s&&i.adds.length>0){const o=new vR({material:n});o.initializeRenderContext(this.rendererContext.pluginContext,this._materialRepository),s=o,this._materialRenderers.push(s),r=!0}s&&(s.modify(i),s.numGeometries===0&&(this._materialRenderers.removeUnordered(s),s.destroy(),r=!0))}),this._changes.clear(),r&&this._updateSortedMaterialRenderers(),this._hasHighlights=this._materialRenderers.some(i=>{const n=i.produces.get(ue.DRAPED_MATERIAL);return!!n&&n(U.Highlight)}),this._hasWater=this._materialRenderers.some(i=>{const n=i.produces.get(ue.DRAPED_WATER);return!!n&&n(U.Normal)}),this.notifyChange("updating"),!0}addGeometries(e,r){if(e.length===0)return;const i=this._validateRenderGeometries(e);for(const s of i)this._geometries.set(s.id,s);const n=this._pending.empty;for(const s of i)this._pending.adds.add(s);n&&this.notifyChange("updating"),r===en.UPDATE&&this._notifyGraphicGeometryChanged(e)}removeGeometries(e,r){const i=this._pending.empty,n=this._pending.adds;for(const s of e)n.has(s)?(this._pending.removed.add(s),n.delete(s)):this._pending.removed.has(s)||this._pending.removes.add(s),this._geometries.delete(s.id);i&&!this._pending.empty&&this.notifyChange("updating"),r===en.UPDATE&&this._notifyGraphicGeometryChanged(e)}modifyGeometries(e,r){const i=this._changes.updates.length===0;for(const n of e){const s=this._changes.updates.pushNew();s.renderGeometry=this._validateRenderGeometry(n),s.updateType=r}switch(i&&this._changes.updates.length>0&&this.notifyChange("updating"),r){case Is.TRANSFORMATION:case Is.GEOMETRY:return this._notifyGraphicGeometryChanged(e);case Is.VISIBILITY:return this._notifyGraphicVisibilityChanged(e)}}updateAnimation(e){let r=!1;return this._sortedMaterialRenderers.forAll(i=>r=!!i.updateAnimation&&i.updateAnimation(e)||r),r}shouldRender(e){return this._sortedMaterialRenderers.some(r=>r.prepareTechnique(e))}render(e){this._sortedMaterialRenderers.forAll(r=>{const i=r.prepareTechnique(e);i!=null&&r.renderNode(e,i)})}intersect(e,r,i,n,s){return this._geometries.forEach(o=>{if(n&&!n(o))return;this._intersectRenderGeometry(o,i,r,0,e,s);const a=this.rendererContext.longitudeCyclical;a&&(o.boundingSphere[0]-o.boundingSphere[3]<a.min&&this._intersectRenderGeometry(o,i,r,a.range,e,s),o.boundingSphere[0]+o.boundingSphere[3]>a.max&&this._intersectRenderGeometry(o,i,r,-a.range,e,s)),s++}),s}_updateSortedMaterialRenderers(){this._sortedMaterialRenderers.clear(),this._materialRenderers.forAll((e,r)=>{e.drapedPriority=r,this._sortedMaterialRenderers.push(e)}),this._sortedMaterialRenderers.sort((e,r)=>{var i,n,s,o;return((i=r.materialReference)==null?void 0:i.renderPriority)===((n=e.materialReference)==null?void 0:n.renderPriority)?e.drapedPriority-r.drapedPriority:(((s=r.materialReference)==null?void 0:s.renderPriority)||0)-(((o=e.materialReference)==null?void 0:o.renderPriority)||0)})}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(let e=0;e<this._changes.updates.length;){const r=this._changes.updates.data[e];this._pending.has(r.renderGeometry)?this._changes.updates.removeUnorderedIndex(e):e++}this._pending.clear()}_intersectRenderGeometry(e,r,i,n,s,o){if(!e.visible)return;let a=0;n+=e.transformation[12],a=e.transformation[13],lG[0]=i[0]-n,lG[1]=i[1]-a,e.screenToWorldRatio=this.rendererContext.screenToWorldRatio,e.material.intersectDraped(e,null,s,lG,(l,c,u)=>{Ogt(r,u,o,e.material.renderPriority,s,e.layerUid,e.graphicUid)},r)}_notifyGraphicGeometryChanged(e){if(this.drapeSource.notifyGraphicGeometryChanged==null)return;let r;for(const i of e){const n=i.graphicUid;n!=null&&n!==r&&(this.drapeSource.notifyGraphicGeometryChanged(n),r=n)}}_notifyGraphicVisibilityChanged(e){if(this.drapeSource.notifyGraphicVisibilityChanged==null)return;let r;for(const i of e){const n=i.graphicUid;n!=null&&n!==r&&(this.drapeSource.notifyGraphicVisibilityChanged(n),r=n)}}_validateRenderGeometries(e){for(const r of e)this._validateRenderGeometry(r);return e}_validateRenderGeometry(e){return e.localOrigin==null&&(e.localOrigin=this._localOriginFactory.getOrigin(e.boundingSphere)),e}get test(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}};d([m()],Tu.prototype,"drapeSource",void 0),d([m()],Tu.prototype,"updating",null),d([m()],Tu.prototype,"rctx",null),d([m({constructOnly:!0})],Tu.prototype,"rendererContext",void 0),d([m()],Tu.prototype,"_materialRepository",null),d([m()],Tu.prototype,"_localOriginFactory",null),d([m({readOnly:!0})],Tu.prototype,"isEmpty",null),d([m()],Tu.prototype,"_materialRenderers",void 0),d([m()],Tu.prototype,"_geometries",void 0),Tu=d([V("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],Tu);let Mgt=class{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return this.adds.size===0&&this.removes.size===0&&this.removed.size===0}has(e){return this.adds.has(e)||this.removes.has(e)||this.removed.has(e)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}};function Ogt(t,e,r,i,n,s,o){const a=new mgt(s,o,e),l=c=>{c.set(Bi.OVERLAY,a,t.dist,t.normal,t.transformation,r,i)};if((n.results.min.drapedLayerOrder==null||r>=n.results.min.drapedLayerOrder)&&(n.results.min.dist==null||n.results.ground.dist<=n.results.min.dist)&&l(n.results.min),n.options.store!==Go.MIN&&(n.results.max.drapedLayerOrder==null||r<n.results.max.drapedLayerOrder)&&(n.results.max.dist==null||n.results.ground.dist>n.results.max.dist)&&l(n.results.max),n.options.store===Go.ALL){const c=mte(n.ray);l(c),n.results.all.push(c)}}const lG=He();let Fie=class PIe extends Vr{initializeProgram(e){return new Lr(e.rctx,PIe.shader.get().build(),Mr)}initializePipeline(){return this.configuration.hasAlpha?kt({blending:Wo(Se.SRC_ALPHA,Se.ONE,Se.ONE_MINUS_SRC_ALPHA,Se.ONE_MINUS_SRC_ALPHA),colorWrite:Yt}):kt({colorWrite:Yt})}};Fie.shader=new Ir(jft,()=>ge(()=>Promise.resolve().then(()=>XNt),void 0));let kie=class extends cc{constructor(){super(...arguments),this.hasAlpha=!1}};d([j()],kie.prototype,"hasAlpha",void 0);let zie=class extends Ai{constructor(){super(...arguments),this.overlayIndex=us.INNER,this.opacity=1}};function AIe(){const t=new Or;return t.include(Ga),t.fragment.uniforms.add(new ct("tex",e=>e.texture)),t.fragment.uniforms.add(new rL("overlayIdx",e=>e.overlayIndex)),t.fragment.uniforms.add(new $e("opacity",e=>e.opacity)),t.fragment.code.add(T`void main() {
vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
fragColor = texture(tex, overlayUV) * opacity;
}`),t}const Rgt=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:zie,build:AIe},Symbol.toStringTag,{value:"Module"}));let MIe=class OIe extends Vr{initializeProgram(e){return new Lr(e.rctx,OIe.shader.get().build(),Mr)}initializePipeline(){return kt({blending:tu(Se.ONE,Se.ONE_MINUS_SRC_ALPHA),colorWrite:Yt})}};MIe.shader=new Ir(Rgt,()=>ge(()=>Promise.resolve().then(()=>ZNt),void 0));let Ch=class extends V2{constructor(e){super(e),this._overlays=null,this._renderTargets=null,this._overlayParameters=new zie,this.hasHighlights=!1,this._hasWater=!1,this._renderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedRenderers=new Vt,this._passParameters=new Aie,this._materialRepository=null,this._screenToWorldRatio=1,this._localOriginFactory=null,this.unloadedMemory=0,this.ignoresMemoryFactor=!1,this._camera=new Qe,this.worldToPCSRatio=1,this.events=new Qn,this.longitudeCyclical=null,this.produces=new Map([[ue.DRAPED_MATERIAL,r=>r!==U.Highlight||this.hasHighlights],[ue.DRAPED_WATER,()=>this._hasWater]]),this._hasTargetWithoutRasterImage=!1,this._hasDrapedFeatureSource=!1,this._hasDrapedRasterSource=!1}initialize(){const e=this.view._stage.renderer.fboCache,r=this.view._stage.renderView,{waterTextures:i,stippleTextures:n,markerTextures:s}=r;this._shaderTechniques=new W$e({rctx:this._rctx,viewingMode:De.Local,stippleTextureRepository:n,markerTextureRepository:s,waterTextureRepository:i}),this._renderContext=new bIe(this._rctx,new Die(e,this.view.state.viewingMode),null),this.addHandles([he(()=>i.updating,()=>this.events.emit("content-changed"),Kr),he(()=>this.spatialReference,o=>this._localOriginFactory=new Lie(o),Kr),Vo(()=>this.view.allLayerViews,"after-changes",()=>this._sortedDrapeSourceRenderersDirty=!0)]),this._materialRepository=new q$e(r.textureRepository,this._shaderTechniques,()=>{this.notifyChange("rendersOccludedDraped"),this.events.emit("content-changed"),this.notifyChange("updating"),this.notifyChange("isEmpty")},()=>this.events.emit("content-changed")),this._bindParameters.slot=ue.DRAPED_MATERIAL,this._bindParameters.mainDepth=null,this._camera.near=1,this._camera.far=1e4,this._camera.relativeElevation=null,this._bindParameters.camera=this._camera,this._bindParameters.transparencyPassType=ft.NONE,this._bindParameters.newLighting.noonFactor=0,this._bindParameters.newLighting.globalFactor=0,this._bindParameters.newLighting.set([new are(Ce(1,1,1))]),this.addHandles(this.view.resourceController.scheduler.registerTask(bt.STAGE,this))}destroy(){this._renderers.forEach(e=>e.destroy()),this._renderers.clear(),this._debugTextureTechnique=tr(this._debugTextureTechnique),this._passParameters.texture=gt(this._passParameters.texture),this._shaderTechniques=Pe(this._shaderTechniques),this.disposeOverlays()}get _bindParameters(){return this._renderContext.bindParameters}get _rctx(){return this.view._stage.renderView.renderingContext}get rctx(){return this._rctx}get materialRepository(){return this._materialRepository}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}initializeRenderContext(e){this.pluginContext=e}uninitializeRenderContext(){}renderNode(){}get updating(){return this._sortedDrapeSourceRenderersDirty||Zh(this._renderers,e=>e.updating)}get hasOverlays(){return this._overlays!=null&&this._renderTargets!=null}getMemoryForMaterial(e){return Array.from(this._renderers.values()).reduce((r,i)=>r+i.getMemoryForMaterial(e),0)}get layers(){return this._sortedDrapeSourceRenderersDirty&&this._updateSortedDrapeSourceRenderers(),this._sortedRenderers.map(e=>e.drapeSource.layer).filter(e=>!!e)}createGeometryDrapeSourceRenderer(e){return this.createDrapeSourceRenderer(e,Tu)}createDrapeSourceRenderer(e,r,i){const n=this._renderers.get(e);n!=null&&n.destroy();const s=new r({...i,rendererContext:this,drapeSource:e});return this._renderers.set(e,s),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this.addHandles(he(()=>e.fullOpacity,()=>this.events.emit("content-changed")),e),s}removeDrapeSourceRenderer(e){if(e==null)return;const r=this._renderers.get(e);r!=null&&(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(e),this.removeHandles(e),r.destroy())}computeValidity(){var e;return((e=this._renderTargets)==null?void 0:e.computeValidity())??0}releaseRenderTargets(){var e;(e=this._renderTargets)==null||e.dispose()}get overlays(){return this._overlays??[]}ensureDrapeTargets(e){this._hasTargetWithoutRasterImage=!!this._overlays&&n5(e,r=>r.drapeTargetType===FZ.WithoutRasterImage)}ensureDrapeSources(e){this._overlays?(this._hasDrapedFeatureSource=n5(e,r=>r.drapeSourceType===gR.Features),this._hasDrapedRasterSource=n5(e,r=>r.drapeSourceType===gR.RasterImage)):this._hasDrapedFeatureSource=this._hasDrapedRasterSource=!1}get _needsColorWithoutRasterImage(){return this._hasDrapedRasterSource&&this._hasDrapedFeatureSource&&this._hasTargetWithoutRasterImage}ensureOverlays(e,r,i=this._bindParameters.overlayStretch){this._overlays==null&&(this._renderTargets=new Lft(this.view._stage.renderer.fboCache),this._overlays=[new ope,new ope]),this.ensureDrapeTargets(e),this.ensureDrapeSources(r),this._bindParameters.overlayStretch=i}disposeOverlays(){this._overlays=null,this._renderTargets=gt(this._renderTargets),this.events.emit("textures-disposed")}getTexture(e){var r,i;if(e!=null)return e===Ui.ColorNoRasterImage&&!this._needsColorWithoutRasterImage&&this._hasDrapedFeatureSource?(r=this._renderTargets)==null?void 0:r.getTexture(Ui.Color):(i=this._renderTargets)==null?void 0:i.getTexture(e)}get running(){return this.updating}runTask(e){this._processDrapeSources(e,()=>!0)}_processDrapeSources(e,r){let i=!1;for(const[n,s]of this._renderers){if(e.done)break;(n.destroyed||r(n))&&s.commitChanges()&&(i=!0,e.madeProgress())}this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,i=!0,this._updateSortedDrapeSourceRenderers()),i&&(this._overlays!=null&&this._renderers.size===0&&this.disposeOverlays(),this.notifyChange("updating"),this.notifyChange("isEmpty"),this.events.emit("content-changed"),this.hasHighlights=Zh(this._renderers,n=>n.hasHighlights),this.notifyChange("rendersOccludedDraped"),this._updateHasWater())}processSyncDrapeSources(){this._processDrapeSources(yl,e=>e.updatePolicy===q1.SYNC)}get isEmpty(){return!yi.OVERLAY_DRAW_DEBUG_TEXTURE&&!Zh(this._renderers,e=>!e.isEmpty)}get hasWater(){return this._hasWater}get rendersOccludedDraped(){const e=this._renderContext.renderOccludedMask;this._renderContext.renderOccludedMask=C8;const r=this._sortedRenderers.some(({renderer:i})=>i.shouldRender(this._renderContext));return this._renderContext.renderOccludedMask=e,r}renders(e){return yi.OVERLAY_DRAW_DEBUG_TEXTURE&&e!==Ui.Occluded||this._sortedRenderers.some(({renderer:r})=>r.shouldRender(this._renderContext))}get mode(){var e,r;return this.isEmpty?Fm.Disabled:(e=this._renderTargets)!=null&&e.getTexture(Ui.WaterNormal)?Fm.EnabledWithWater:(r=this._renderTargets)!=null&&r.getTexture(Ui.Color)?Fm.Enabled:Fm.Disabled}updateAnimation(e){let r=!1;return this._renderers.forEach(i=>r=i.updateAnimation(e)||r),r}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}drawOverlays(e){if(this._overlays&&this._renderTargets){for(const r of this._overlays)this.longitudeCyclical?r.setupGeometryViewsCyclical(this.longitudeCyclical):r.setupGeometryViewsDirect();for(const r of this._renderTargets.targets){if(r.content===Ui.ColorNoRasterImage&&!this._needsColorWithoutRasterImage)continue;const i=this._drawTarget(us.INNER,r,e),n=this._drawTarget(us.OUTER,r,e);(i||n)&&r.fbo.generateMipMap()}}}_drawTarget(e,r,i){const n=this._overlays[e],s=n.canvasGeometries;if(s.numViews===0)return!1;const{alignPixelEnabled:o,contentPixelRatio:a}=i;this._screenToWorldRatio=a*n.mapUnitsPerPixel/this._bindParameters.overlayStretch;const l=r.output;if(this.isEmpty||l===U.Highlight&&!this.hasHighlights||l===U.Normal&&!this.hasWater||!n.hasSomeSizedView())return!1;const c=this._rctx;if(this._camera.pixelRatio=n.pixelRatio*a,this._renderContext.output=l,this._bindParameters.alignPixelEnabled=o,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=l===U.Normal?ue.DRAPED_WATER:ue.DRAPED_MATERIAL,r.content===Ui.Occluded&&(this._renderContext.renderOccludedMask=C8),!this.renders(r.content))return this._renderContext.renderOccludedMask=T8,!1;const u=n.resolution;this._rctx.setViewport(e===us.INNER?0:u,0,u,u);const h=2*n.resolution,p=n.resolution,f=r.fbo;if(f.bind(c,h,p),e===us.INNER&&(c.setClearColor(0,0,0,0),c.clearSafe(Ci.COLOR_BUFFER_BIT)),yi.OVERLAY_DRAW_DEBUG_TEXTURE&&r.content!==Ui.Occluded)for(let g=0;g<s.numViews;g++)this._setViewParameters(s.extents[g],n),this._ensureDebugPatternResources(n.resolution,Igt[e]),this._rctx.bindTechnique(this._debugTextureTechnique,this._renderContext.bindParameters,this._passParameters),this._rctx.screen.draw();return this._sortedRenderers.forAll(({drapeSource:g,renderer:_})=>{if(r.content===Ui.ColorNoRasterImage&&g.drapeSourceType===gR.RasterImage)return;const{fullOpacity:v}=g,b=v!=null&&v<1&&l===U.Color?this.bindTemporaryFramebuffer(h,p):null;for(let w=0;w<s.numViews;w++)this._setViewParameters(s.extents[w],n),_.render(this._renderContext);if(b){f.bind(c,h,p),this._overlayParameters.texture=b.getTexture(),this._overlayParameters.opacity=v,this._overlayParameters.overlayIndex=e;const w=this.pluginContext.techniqueRepository.acquire(MIe);this._rctx.bindTechnique(w,this._renderContext.bindParameters,this._overlayParameters),this._rctx.screen.draw(),w.release(),b.release()}}),c.bindFramebuffer(null),this._renderContext.renderOccludedMask=T8,!0}bindTemporaryFramebuffer(e,r){const i=this.view._stage.renderer.fboCache,n=i.acquire(e,r,"overlay tmp");return i.rctx.unbindTexture(n.fbo.colorTexture),i.rctx.bindFramebuffer(n.fbo),i.rctx.clearSafe(Ci.COLOR_BUFFER_BIT),n}async reloadShaders(){await this._shaderTechniques.reloadAll()}notifyContentChanged(){this.events.emit("content-changed")}intersect(e,r,i,n){var o;this._sortedDrapeSourceRenderersDirty&&this._updateSortedDrapeSourceRenderers();let s=0;for(const{renderer:a}of this._sortedRenderers)s=((o=a.intersect)==null?void 0:o.call(a,e,r,i,n,s))??s}_updateSortedDrapeSourceRenderers(){if(this._sortedRenderers.clear(),this._renderers.size===0)return;const e=this.view.map.allLayers,r=e.length;this._renderers.forEach((i,n)=>{const s=e.indexOf(n.layer),o=s>=0,a=n.renderGroup??(o?_8.MapLayer:_8.ViewLayer),l=r*a+(o?s:0);this._sortedRenderers.push(new $gt(n,i,l))}),this._sortedRenderers.sort((i,n)=>i.index-n.index)}_setViewParameters(e,r){const i=this._camera;i.viewport=[0,0,r.resolution,r.resolution],Dxe(i.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],i.near,i.far),MI(i.viewMatrix,[-e[0],-e[1],0])}_updateHasWater(){const e=Zh(this._renderers,r=>r.hasWater);e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water",e))}_ensureDebugPatternResources(e,r){if(ie(this._passParameters.color,r[0],r[1],r[2]),this._passParameters.texture)return;const i=new Uint8Array(e*e*4);let n=0;for(let a=0;a<e;a++)for(let l=0;l<e;l++){const c=Math.floor(l/10),u=Math.floor(a/10);c<2||u<2||10*c>e-20||10*u>e-20?(i[n++]=255,i[n++]=255,i[n++]=255,i[n++]=255):(i[n++]=255,i[n++]=255,i[n++]=255,i[n++]=1&c&&1&u?1&l^1&a?0:255:1&c^1&u?0:128)}const s=new ri(e);s.samplingMode=Ht.NEAREST,this._passParameters.texture=new Sr(this._rctx,s,i);const o=new kie;o.hasAlpha=!0,this._debugTextureTechnique=this._shaderTechniques.acquire(Fie,o)}get test(){return{drapedRenderers:Array.from(this._renderers.values()),sortedDrapeSources:Array.from(this._sortedRenderers).map(({drapeSource:e})=>e),getDrapeSourceRenderer:e=>this._renderers.get(e)}}};d([m()],Ch.prototype,"hasHighlights",void 0),d([m()],Ch.prototype,"_sortedDrapeSourceRenderersDirty",void 0),d([m()],Ch.prototype,"_shaderTechniques",void 0),d([m({constructOnly:!0})],Ch.prototype,"view",void 0),d([m()],Ch.prototype,"worldToPCSRatio",void 0),d([m()],Ch.prototype,"spatialReference",void 0),d([m({type:Boolean,readOnly:!0})],Ch.prototype,"updating",null),d([m()],Ch.prototype,"isEmpty",null),d([m({readOnly:!0})],Ch.prototype,"rendersOccludedDraped",null),Ch=d([V("esri.views.3d.terrain.OverlayRenderer")],Ch);let $gt=class{constructor(e,r,i){this.drapeSource=e,this.renderer=r,this.index=i}};const Igt=[[1,.5,.5],[.5,.5,1]],Uie=-2,C8=kr.OccludeAndTransparent;function Bie(t,e,r,i){const n=aL(t.rings,!!t.hasZ&&i.mode!=="on-the-ground",fg.CCW_IS_HOLE,t.spatialReference),s=xo(n.position.length),o=rRe(n.position,t.spatialReference,0,s,0,n.position,0,n.position.length/3,e,r,i),a=o!=null;return new Ngt(n.position,s,IIe(n.polygons,n.position,s),$Ie(n.outlines,n.position,s),a,o)}function RIe(t,e){const r=aL(t.rings,!1,fg.CCW_IS_HOLE),i=Ji(r.position,t.spatialReference,0,r.position,e,0,r.position.length/3);for(let n=2;n<r.position.length;n+=3)r.position[n]=Uie;return{position:r.position,polygons:IIe(r.polygons,r.position),outlines:$Ie(r.outlines,r.position),projectionSuccess:i}}function $Ie(t,e,r=null){return t.filter(({count:i})=>i>1).map(({index:i,count:n})=>{const s=3*i,o=3*n;return r!=null?new LIe(i,n,nd(e,s,o),nd(r,s,o)):new Vie(i,n,nd(e,s,o))})}function IIe(t,e,r=null){const i=new Array;for(const{index:n,count:s,holeIndices:o,pathLengths:a}of t){if(s<=1)continue;const l=3*n,c=3*s,u=o.map(p=>p-n),h=r!=null?new Lgt(n,s,nd(e,3*n,3*s),nd(r,l,c),u,a):new Dgt(n,s,nd(e,3*n,3*s),u,a);i.push(h)}return i}let Vie=class{constructor(e,r,i){this.index=e,this.count=r,this.position=i}},LIe=class extends Vie{constructor(e,r,i,n){super(e,r,i),this.mapPositions=n}},Lgt=class extends LIe{constructor(e,r,i,n,s,o){super(e,r,i,n),this.holeIndices=s,this.pathLengths=o}},Dgt=class extends Vie{constructor(e,r,i,n,s){super(e,r,i),this.holeIndices=n,this.pathLengths=s}},Ngt=class{constructor(e,r,i,n,s,o){this.position=e,this.mapPositions=r,this.polygons=i,this.outlines=n,this.projectionSuccess=s,this.sampledElevation=o}};function mf(t,e,r,i,n,s=2){const o=1/(Math.abs(r)+Math.abs(i)+Math.abs(n)),a=r*o,l=i*o,c=n<=0?(a>=0?1:-1)*(1-Math.abs(l)):a,u=n<=0?(l>=0?1:-1)*(1-Math.abs(a)):l,h=e*s;t[h]=$pe(c),t[h+1]=$pe(u)}function Fgt(t){const e=t.length/3,r=new Int16Array(2*e);let i=0;for(let n=0;n<e;++n)mf(r,n,t[i++],t[i++],t[i++]);return r}function qGt(t,e){const r=t.length/3,i=new Int16Array(2*r);let n=0;const s=C();for(let o=0;o<r;++o)s[0]=t[n++],s[1]=t[n++],s[2]=t[n++],Zs(s,s,e),mf(i,o,s[0],s[1],s[2]);return i}function kgt(t,e,r,i=2){const n=r*i,s=Ipe(e[n]),o=Ipe(e[n+1]),a=1-Math.abs(s)-Math.abs(o);t[2]=a,a<0?(t[0]=(s>=0?1:-1)*(1-Math.abs(o)),t[1]=(o>=0?1:-1)*(1-Math.abs(s))):(t[0]=s,t[1]=o),pe(t,t)}function $pe(t){return we(Math.round(32767*t),-32767,32767)}function Ipe(t){return we(t/32767,-1,1)}const zgt=["polygon","extent"];let Ugt=class extends Sg{constructor(e,r,i,n){super(e,r,i,n),this.ensureDrapedStatus(!1)}async doLoad(){var a,l;if(!this._drivenProperties.size){const c=RU(this._getSymbolSize());if(c)throw new K("graphics3dextrudesymbollayer:invalid-size",c)}const e=(l=(a=this.symbolLayer)==null?void 0:a.material)==null?void 0:l.color,r=this._getCombinedOpacityAndColor(e),i=Ea(r),n=r[3],s=n<1||this.needsDrivenTransparentPass,o={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:i,ambient:i,opacity:n,transparent:s,cullFace:s?Pi.None:Pi.Back,hasVertexColors:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0,normalType:$r.Compressed};this._materials[Su.Main]=new hf(o),this._materials[Su.Bottom]=new hf({...o,cullFace:Pi.Back}),this._context.stage.addMany(this._materials)}destroy(){super.destroy(),this._context.stage.removeMany(this._materials),this._materials.length=0}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,zgt,this.symbolLayer.type))return null;const i=this._getVertexOpacityAndColor(e.renderingInfo,255),n=this.setGraphicElevationContext(r);return this._createAs3DShape(r,e.renderingInfo,i,n,r.uid)}layerOpacityChanged(e,r){var a,l,c,u;const i=(l=(a=this.symbolLayer)==null?void 0:a.material)==null?void 0:l.color,n=this._getCombinedOpacity(i),s=n<1||this.needsDrivenTransparentPass;(c=this._materials[Su.Main])==null||c.setParameters({opacity:n,transparent:s}),(u=this._materials[Su.Bottom])==null||u.setParameters({opacity:n,transparent:s});const o=this._getLayerOpacity();e.forEach(h=>{const p=r(h);p!=null&&p.layerOpacityChanged(o,this._context.isAsync)})}layerElevationInfoChanged(e,r){return this.updateGraphics3DGraphicElevationInfo(e,r,Sv)}slicePlaneEnabledChanged(e,r){var i,n;return(i=this._materials[Su.Main])==null||i.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),(n=this._materials[Su.Bottom])==null||n.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),e.forEach(s=>{const o=r(s);o!=null&&o.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){var r,i;const e={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0};return(r=this._materials[Su.Main])==null||r.setParameters(e),(i=this._materials[Su.Bottom])==null||i.setParameters(e),!0}_getExtrusionSize(e){let r;return r=e.size&&this._drivenProperties.size?wft(e.size,2)??0:this._getSymbolSize(),r/=this._context.renderCoordsHelper.unitInMeters,r}applyRendererDiff(e,r){return this._drivenPropertiesChanged(r)?Xn.RecreateSymbol:Xn.RecreateGraphics}async queryForSnapping(e,r,i,n){const s=this._getExtrusionSize(i)*this._context.renderCoordsHelper.unitInMeters/p$(r),{objectId:o,target:a}=e,l=_e(a);switch(l.z=(l.z??0)+s,e.type){case"edge":{const{start:c,end:u}=e,h=_e(c),p=_e(u);return h.z=(h.z??0)+s,p.z=(p.z??0)+s,[tpe(o,l,1/0,h,p)]}case"vertex":return[aft(o,l,1/0),tpe(o,a,1/0,a,l)];default:return[]}}_getSymbolSize(){return this.symbolLayer.size??1}_createAs3DShape(e,r,i,n,s){const o=X$(e.geometry);if(o==null)return null;if(o.rings.length===0||!o.rings.some(L=>L.length>0))return this._logGeometryValidationWarnings(o.rings,"rings","ExtrudeSymbol3DLayer"),null;const a=Bie(o,this._context.elevationProvider,this._context.renderCoordsHelper,n);this._logGeometryCreationWarnings(a,o.rings,"rings","ExtrudeSymbol3DLayer");const l=sie(o);if(l==null)return null;const c=new Array,u=new Array,h=vs(),p=xe(),f=C(),g=this._context.renderCoordsHelper.viewingMode===De.Global;g||this._context.renderCoordsHelper.worldUpAtPosition(null,f),La(o.spatialReference,[l.x,l.y,0],p,this._context.renderCoordsHelper.spatialReference);const _=xe();os(_,p);const v=li();iy(v,_);const{polygons:b,mapPositions:w,position:x}=a;for(const L of b){const z=L.count;if(this._context.clippingExtent&&(Li(h),Hc(h,L.mapPositions),!zp(h,this._context.clippingExtent)))continue;const k=y3(L.mapPositions,L.holeIndices,3);if(k.length===0)continue;const q=k.length,B=6*z,J=X6(B+q),W=X6(q),Y=xo(3*B),le=xo(3*B),D=xo(3*B),I=xo(B);Bgt(x,w,k,L,Y,D,le,I,J,W,this._getExtrusionSize(r),f,g),pf(Y,Y,_);const F=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:s,layerUid:this._context.layer.uid}),G=new Wgt(Y,D,Fgt(le),I);c.push(Lpe(this._materials[Su.Main],J,J.length-W.length,G,i,F),Lpe(this._materials[Su.Bottom],W,0,G,i,F)),u.push(G.heights)}if(c.length===0)return null;const S=new Ey({geometries:c,layerUid:this._context.layer.uid,graphicUid:s,isElevationSource:!0});S.transformation=p;const E=bRe(this.symbolLayer,{opacity:this._getLayerOpacity()}),A=E!=null?{baseMaterial:this._materials[Su.Main],edgeMaterials:[E],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null,O=new Tg(this,S,c,null,null,(L,z,k,q,B)=>jgt(L,z,k,q,B,u),n,A);return O.alignedSampledElevation=a.sampledElevation,O.needsElevationUpdates=Sv(n.mode),O}};function Lpe(t,e,r,i,n,s){const o=Uv(e.length),a=[[R.POSITION,new Ye(i.positions,e,3,!0)],[R.NORMALCOMPRESSED,new Ye(i.normals,e,2,!0)],[R.COLOR,new Ye(n,o,4,!0)]];return new gs(t,a,i.elevation,Cn.Mesh,s,r)}function Bgt(t,e,r,i,n,s,o,a,l,c,u,h,p){const f=r.length/3;let g=0,_=2*i.count;Vgt(t,e,i.index,i.count,r,0,f,n,s,o,a,l,c,_,u,h,p);let v=2*i.count;_=0,Dpe(n,s,a,o,g,i.pathLengths[0],i.count,v,l,_,u),v+=4*i.pathLengths[0],_+=2*i.pathLengths[0],g+=i.pathLengths[0];for(let b=1;b<i.pathLengths.length;++b)Dpe(n,s,a,o,g,i.pathLengths[b],i.count,v,l,_,u),v+=4*i.pathLengths[b],_+=2*i.pathLengths[b],g+=i.pathLengths[b]}function Vgt(t,e,r,i,n,s,o,a,l,c,u,h,p,f,g,_,v){ce(Ol,_);const b=g>0?1:-1;let w=3*r,x=0,S=3*x,E=i,A=3*E;for(let z=0;z<i;++z)v&&(Ol[0]=t[w],Ol[1]=t[w+1],Ol[2]=t[w+2],pe(Ol,Ol)),a[S]=t[w],a[S+1]=t[w+1],a[S+2]=t[w+2],l[S]=e[w],l[S+1]=e[w+1],l[S+2]=e[w+2],c[S]=-b*Ol[0],c[S+1]=-b*Ol[1],c[S+2]=-b*Ol[2],u[x]=0,a[A]=t[w]+g*Ol[0],a[A+1]=t[w+1]+g*Ol[1],a[A+2]=t[w+2]+g*Ol[2],l[A]=e[w],l[A+1]=e[w+1],l[A+2]=e[w+2],c[A]=b*Ol[0],c[A+1]=b*Ol[1],c[A+2]=b*Ol[2],u[E]=g,S+=3,A+=3,w+=3,x+=1,E+=1;w=3*s,S=0,A=3*f;const O=g<0?Bpe:Upe,L=g<0?Upe:Bpe;for(let z=0;z<o;++z)p[S]=n[w+O[0]],p[S+1]=n[w+O[1]],p[S+2]=n[w+O[2]],h[A]=n[w+L[0]]+i,h[A+1]=n[w+L[1]]+i,h[A+2]=n[w+L[2]]+i,S+=3,A+=3,w+=3}function $N(t,e,r,i,n,s,o){i[s]=i[o],o*=3,t[s*=3]=t[o],t[s+1]=t[o+1],t[s+2]=t[o+2],e[s]=e[o],e[s+1]=e[o+1],e[s+2]=e[o+2],r[s]=n[0],r[s+1]=n[1],r[s+2]=n[2]}const rA=C();function Dpe(t,e,r,i,n,s,o,a,l,c,u){let h=n,p=n+1,f=n+o,g=n+o+1,_=a,v=a+1,b=a+2*s,w=a+2*s+1;u<0&&(h=n+o+1,g=n),c*=3;for(let x=0;x<s;++x)x===s-1&&(u>0?(p=n,g=n+o):(p=n,h=n+o)),Ggt(t,h,p,f,rA),$N(t,e,i,r,rA,_,h),$N(t,e,i,r,rA,v,p),$N(t,e,i,r,rA,b,f),$N(t,e,i,r,rA,w,g),l[c++]=_,l[c++]=b,l[c++]=w,l[c++]=_,l[c++]=w,l[c++]=v,h++,p++,f++,g++,_+=2,v+=2,b+=2,w+=2}const cG=C(),Npe=C(),Fpe=C(),kpe=C(),zpe=C();function Ggt(t,e,r,i,n){e*=3,r*=3,i*=3,ie(cG,t[e++],t[e++],t[e++]),ie(Npe,t[r++],t[r++],t[r++]),ie(Fpe,t[i++],t[i++],t[i++]),ye(kpe,Npe,cG),ye(zpe,Fpe,cG),Je(n,zpe,kpe),pe(n,n)}const CT=C();function jgt(t,e,r,i,n,s){const o=t.stageObject,a=o.geometries,l=a.length,c=e.mode!=="absolute-height";let u=0;const h=o.transformation,p=R3(xe(),h);for(let f=0;f<l;f+=2){const g=a[f];if(!iie(g))continue;const _=g.getMutableAttribute(R.POSITION).data,v=s[f/2],b=new yte(g.mapPositions),w=_.length/3;let x=0,S=!1,E=0;for(let A=0;A<w;A++){CT[0]=_[x],CT[1]=_[x+1],CT[2]=_[x+2],i(b,IN),c&&(E+=IN.sampledElevation),yi.TESTS_DISABLE_OPTIMIZATIONS?(ie(fc,b.array[b.offset],b.array[b.offset+1],IN.z+v[x/3]),r!=null&&n.toRenderCoords(fc,r,fc),Ge(fc,fc,p)):(ie(fc,_[x],_[x+1],_[x+2]),Ge(fc,fc,h),n.setAltitude(fc,IN.z+v[x/3]),Ge(fc,fc,p)),_[x]=fc[0],_[x+1]=fc[1],_[x+2]=fc[2];const O=Hgt/n.unitInMeters;(Math.abs(CT[0]-_[x])>=O||Math.abs(CT[1]-_[x+1])>=O||Math.abs(CT[2]-_[x+2])>=O)&&(S=!0),b.offset+=3,x+=3}S&&(g.invalidateBoundingInfo(),o.geometryVertexAttributeUpdated(a[f],R.POSITION),a[f+1].invalidateBoundingInfo(),o.geometryVertexAttributeUpdated(a[f+1],R.POSITION)),u+=E/w}return u/l}const fc=C(),Ol=C(),IN=new tL,Upe=[0,2,1],Bpe=[0,1,2],Hgt=.01;var Su;(function(t){t[t.Main=0]="Main",t[t.Bottom=1]="Bottom"})(Su||(Su={}));let Wgt=class{constructor(e,r,i,n){this.positions=e,this.elevation=r,this.normals=i,this.heights=n}};const LN=[["(",")"],[")","("],["<",">"],[">","<"],["[","]"],["]","["],["{","}"],["}","{"],["«","»"],["»","«"],["‹","›"],["›","‹"],["⁽","⁾"],["⁾","⁽"],["₍","₎"],["₎","₍"],["≤","≥"],["≥","≤"],["〈","〉"],["〉","〈"],["﹙","﹚"],["﹚","﹙"],["﹛","﹜"],["﹜","﹛"],["﹝","﹞"],["﹞","﹝"],["﹤","﹥"],["﹥","﹤"]],_3=["آ","أ","إ","ا"],qgt=["ﻵ","ﻷ","ﻹ","ﻻ"],Ygt=["ﻶ","ﻸ","ﻺ","ﻼ"],E8=["ا","ب","ت","ث","ج","ح","خ","د","ذ","ر","ز","س","ش","ص","ض","ط","ظ","ع","غ","ف","ق","ك","ل","م","ن","ه","و","ي","إ","أ","آ","ة","ى","ل","م","ن","ه","و","ي","إ","أ","آ","ة","ى","ی","ئ","ؤ"],Xgt=["ﺍ","ﺏ","ﺕ","ﺙ","ﺝ","ﺡ","ﺥ","ﺩ","ﺫ","ﺭ","ﺯ","ﺱ","ﺵ","ﺹ","ﺽ","ﻁ","ﻅ","ﻉ","ﻍ","ﻑ","ﻕ","ﻙ","ﻝ","ﻡ","ﻥ","ﻩ","ﻭ","ﻱ","ﺇ","ﺃ","ﺁ","ﺓ","ﻯ","ﯼ","ﺉ","ﺅ","ﹰ","ﹲ","ﹴ","ﹶ","ﹸ","ﹺ","ﹼ","ﹾ","ﺀ","ﺉ","ﺅ"],Zgt=["ﺎ","ﺐ","ﺖ","ﺚ","ﺞ","ﺢ","ﺦ","ﺪ","ﺬ","ﺮ","ﺰ","ﺲ","ﺶ","ﺺ","ﺾ","ﻂ","ﻆ","ﻊ","ﻎ","ﻒ","ﻖ","ﻚ","ﻞ","ﻢ","ﻦ","ﻪ","ﻮ","ﻲ","ﺈ","ﺄ","ﺂ","ﺔ","ﻰ","ﯽ","ﺊ","ﺆ","ﹰ","ﹲ","ﹴ","ﹶ","ﹸ","ﹺ","ﹼ","ﹾ","ﺀ","ﺊ","ﺆ"],Jgt=["ﺎ","ﺒ","ﺘ","ﺜ","ﺠ","ﺤ","ﺨ","ﺪ","ﺬ","ﺮ","ﺰ","ﺴ","ﺸ","ﺼ","ﻀ","ﻄ","ﻈ","ﻌ","ﻐ","ﻔ","ﻘ","ﻜ","ﻠ","ﻤ","ﻨ","ﻬ","ﻮ","ﻴ","ﺈ","ﺄ","ﺂ","ﺔ","ﻰ","ﯿ","ﺌ","ﺆ","ﹱ","ﹲ","ﹴ","ﹷ","ﹹ","ﹻ","ﹽ","ﹿ","ﺀ","ﺌ","ﺆ"],Qgt=["ﺍ","ﺑ","ﺗ","ﺛ","ﺟ","ﺣ","ﺧ","ﺩ","ﺫ","ﺭ","ﺯ","ﺳ","ﺷ","ﺻ","ﺿ","ﻃ","ﻇ","ﻋ","ﻏ","ﻓ","ﻗ","ﻛ","ﻟ","ﻣ","ﻧ","ﻫ","ﻭ","ﻳ","ﺇ","ﺃ","ﺁ","ﺓ","ﻯ","ﯾ","ﺋ","ﺅ","ﹰ","ﹲ","ﹴ","ﹶ","ﹸ","ﹺ","ﹼ","ﹾ","ﺀ","ﺋ","ﺅ"],Vpe=["ء","آ","أ","ؤ","إ","ا","ة","د","ذ","ر","ز","و","ى"],Kgt=["ً","ً","ٌ","؟","ٍ","؟","َ","َ","ُ","ُ","ِ","ِ","ّ","ّ","ْ","ْ","ء","آ","آ","أ","أ","ؤ","ؤ","إ","إ","ئ","ئ","ئ","ئ","ا","ا","ب","ب","ب","ب","ة","ة","ت","ت","ت","ت","ث","ث","ث","ث","ج","ج","ج","ج","ح","ح","ح","ح","خ","خ","خ","خ","د","د","ذ","ذ","ر","ر","ز","ز","س","س","س","س","ش","ش","ش","ش","ص","ص","ص","ص","ض","ض","ض","ض","ط","ط","ط","ط","ظ","ظ","ظ","ظ","ع","ع","ع","ع","غ","غ","غ","غ","ف","ف","ف","ف","ق","ق","ق","ق","ك","ك","ك","ك","ل","ل","ل","ل","م","م","م","م","ن","ن","ن","ن","ه","ه","ه","ه","و","و","ى","ى","ي","ي","ي","ي","ﻵ","ﻶ","ﻷ","ﻸ","ﻹ","ﻺ","ﻻ","ﻼ","؟","؟","؟"],Gpe=["ء","ف"],e0t=["غ","ي"],t0t=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],r0t=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],$=0,be=1,Ot=2,Es=3,P=4,wm=5,bF=6,M=7,rl=8,Rl=9,Fd=10,Ut=11,ee=12,i0t=13,n0t=14,s0t=15,o0t=16,a0t=17,dt=18,l0t=["UBAT_L","UBAT_R","UBAT_EN","UBAT_AN","UBAT_ON","UBAT_B","UBAT_S","UBAT_AL","UBAT_WS","UBAT_CS","UBAT_ES","UBAT_ET","UBAT_NSM","UBAT_LRE","UBAT_RLE","UBAT_PDF","UBAT_LRO","UBAT_RLO","UBAT_BN"],_m=100,c0t=[_m+0,$,$,$,$,_m+1,_m+2,_m+3,be,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,_m+4,P,P,P,$,P,$,P,$,P,P,P,$,$,P,P,$,$,$,$,$,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,$,$,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,$,$,$,$,$,$,$,$,$,$,$,$,$,$,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,$,$,P,P,$,$,P,P,$,$,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,$,$,$,_m+5,M,M,_m+6,_m+7],u0t=[[dt,dt,dt,dt,dt,dt,dt,dt,dt,bF,wm,bF,rl,wm,dt,dt,dt,dt,dt,dt,dt,dt,dt,dt,dt,dt,dt,dt,wm,wm,wm,bF,rl,P,P,Ut,Ut,Ut,P,P,P,P,P,Fd,Rl,Fd,Rl,Rl,Ot,Ot,Ot,Ot,Ot,Ot,Ot,Ot,Ot,Ot,Rl,P,P,P,P,P,P,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,P,P,P,P,P,P,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,P,P,P,P,dt,dt,dt,dt,dt,dt,wm,dt,dt,dt,dt,dt,dt,dt,dt,dt,dt,dt,dt,dt,dt,dt,dt,dt,dt,dt,dt,dt,dt,dt,dt,dt,dt,Rl,P,Ut,Ut,Ut,Ut,P,P,P,P,$,P,P,dt,P,P,Ut,Ut,Ot,Ot,P,$,P,P,P,Ot,$,P,P,P,P,P,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,P,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,P,$,$,$,$,$,$,$,$],[$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,P,P,P,P,P,P,P,P,P,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,P,P,$,$,$,$,$,$,$,P,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,P,$,P,P,P,P,P,P,P,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,be,ee,be,ee,ee,be,ee,ee,be,ee,P,P,P,P,P,P,P,P,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,P,P,P,P,P,be,be,be,be,be,P,P,P,P,P,P,P,P,P,P,P],[Es,Es,Es,Es,P,P,P,P,M,Ut,Ut,M,Rl,M,P,P,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,M,P,P,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,Es,Es,Es,Es,Es,Es,Es,Es,Es,Es,Ut,Es,Es,M,M,M,ee,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,ee,ee,ee,ee,ee,ee,ee,Es,P,ee,ee,ee,ee,ee,ee,M,M,ee,ee,P,ee,ee,ee,ee,M,M,Ot,Ot,Ot,Ot,Ot,Ot,Ot,Ot,Ot,Ot,M,M,M,M,M,M],[M,M,M,M,M,M,M,M,M,M,M,M,M,M,P,M,M,ee,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,P,P,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,M,P,P,P,P,P,P,P,P,P,P,P,P,P,P,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,ee,ee,ee,ee,ee,ee,ee,ee,ee,be,be,P,P,P,P,be,P,P,P,P,P],[rl,rl,rl,rl,rl,rl,rl,rl,rl,rl,rl,dt,dt,dt,$,be,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,rl,wm,i0t,n0t,s0t,o0t,a0t,Rl,Ut,Ut,Ut,Ut,Ut,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,Rl,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,rl,dt,dt,dt,dt,dt,P,P,P,P,P,dt,dt,dt,dt,dt,dt,Ot,$,P,P,Ot,Ot,Ot,Ot,Ot,Ot,Fd,Fd,P,P,P,$,Ot,Ot,Ot,Ot,Ot,Ot,Ot,Ot,Ot,Ot,Fd,Fd,P,P,P,P,$,$,$,$,$,$,$,$,$,$,$,$,$,P,P,P,Ut,Ut,Ut,Ut,Ut,Ut,Ut,Ut,Ut,Ut,Ut,Ut,Ut,Ut,Ut,Ut,Ut,Ut,Ut,Ut,Ut,Ut,Ut,Ut,Ut,Ut,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P],[$,$,$,$,$,$,$,P,P,P,P,P,P,P,P,P,P,P,P,$,$,$,$,$,P,P,P,P,P,be,ee,be,be,be,be,be,be,be,be,be,be,Fd,be,be,be,be,be,be,be,be,be,be,be,be,be,P,be,be,be,be,be,P,be,P,be,be,P,be,be,P,be,be,be,be,be,be,be,be,be,be,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M],[ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,ee,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,ee,ee,ee,ee,ee,ee,ee,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,Rl,P,Rl,P,P,Rl,P,P,P,P,P,P,P,P,P,Ut,P,P,Fd,Fd,P,P,P,P,P,Ut,Ut,P,P,P,P,P,M,M,M,M,M,P,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,M,P,P,dt],[P,P,P,Ut,Ut,Ut,P,P,P,P,P,Fd,Rl,Fd,Rl,Rl,Ot,Ot,Ot,Ot,Ot,Ot,Ot,Ot,Ot,Ot,Rl,P,P,P,P,P,P,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,P,P,P,P,P,P,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,P,P,P,P,P,P,P,P,P,P,P,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,$,P,P,P,$,$,$,$,$,$,P,P,$,$,$,$,$,$,P,P,$,$,$,$,$,$,P,P,$,$,$,P,P,P,Ut,Ut,P,P,P,Ut,Ut,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P,P]];let h0t=class{constructor(){this.inputFormat="ILYNN",this.outputFormat="VLNNN",this.sourceToTarget=[],this.targetToSource=[],this.levels=[]}bidiTransform(e,r,i){if(this.sourceToTarget=[],this.targetToSource=[],!e)return"";if(A0t(this.sourceToTarget,this.targetToSource,e.length),!this.checkParameters(r,i))return e;r=this.inputFormat,i=this.outputFormat;let n=e;const s=O0t,o=Wpe(r.charAt(1)),a=Wpe(i.charAt(1)),l=(r.charAt(0)==="I"?"L":r.charAt(0))+o,c=(i.charAt(0)==="I"?"L":i.charAt(0))+a,u=r.charAt(2)+i.charAt(2);s.defInFormat=l,s.defOutFormat=c,s.defSwap=u;const h=kM(e,l,c,u,s);let p=!1;return i.charAt(1)==="R"?p=!0:i.charAt(1)!=="C"&&i.charAt(1)!=="D"||(p=this.checkContextual(h)==="rtl"),this.sourceToTarget=ku,this.targetToSource=M0t(this.sourceToTarget),A8=this.targetToSource,n=r.charAt(3)===i.charAt(3)?h:i.charAt(3)==="S"?p0t(p,h,!0):g0t(h,p,!0),this.sourceToTarget=ku,this.targetToSource=A8,this.levels=BU,n}_inputFormatSetter(e){if(!qpe.test(e))throw new Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.inputFormat=e}_outputFormatSetter(e){if(!qpe.test(e))throw new Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.outputFormat=e}checkParameters(e,r){return e?this._inputFormatSetter(e):e=this.inputFormat,r?this._outputFormatSetter(r):r=this.outputFormat,e!==r}checkContextual(e){let r=P8(e);if(r!=="ltr"&&r!=="rtl"){try{r=document.dir.toLowerCase()}catch{}r!=="ltr"&&r!=="rtl"&&(r="ltr")}return r}hasBidiChar(e){return I0t.test(e)}};function kM(t,e,r,i,n){const s=d0t(t,{inFormat:e,outFormat:r,swap:i},n);if(s.inFormat===s.outFormat)return t;e=s.inFormat,r=s.outFormat,i=s.swap;const o=e.substring(0,1),a=e.substring(1,4),l=r.substring(0,1),c=r.substring(1,4);if(n.inFormat=e,n.outFormat=r,n.swap=i,o==="L"&&r==="VLTR"){if(a==="LTR")return n.dir=ET,s_(t,n);if(a==="RTL")return n.dir=zM,s_(t,n)}if(o==="V"&&l==="V")return n.dir=a==="RTL"?zM:ET,uG(t,n);if(o==="L"&&r==="VRTL")return a==="LTR"?(n.dir=ET,t=s_(t,n)):(n.dir=zM,t=s_(t,n)),uG(t);if(e==="VLTR"&&r==="LLTR")return n.dir=ET,s_(t,n);if(o==="V"&&l==="L"&&a!==c)return t=uG(t),a==="RTL"?kM(t,"LLTR","VLTR",i,n):kM(t,"LRTL","VRTL",i,n);if(e==="VRTL"&&r==="LRTL")return kM(t,"LRTL","VRTL",i,n);if(o==="L"&&l==="L"){const u=n.swap;return n.swap=u.substr(0,1)+"N",a==="RTL"?(n.dir=zM,t=s_(t,n),n.swap="N"+u.substr(1,2),n.dir=ET,t=s_(t,n)):(n.dir=ET,t=s_(t,n),n.swap="N"+u.substr(1,2),t=kM(t,"VLTR","LRTL",n.swap,n)),t}return t}function d0t(t,e,r){if(e.inFormat===void 0&&(e.inFormat=r.defInFormat),e.outFormat===void 0&&(e.outFormat=r.defOutFormat),e.swap===void 0&&(e.swap=r.defSwap),e.inFormat===e.outFormat)return e;const i=e.inFormat.substring(0,1),n=e.outFormat.substring(0,1);let s,o=e.inFormat.substring(1,4),a=e.outFormat.substring(1,4);return o.charAt(0)==="C"&&(s=P8(t),o=s==="ltr"||s==="rtl"?s.toUpperCase():e.inFormat.charAt(2)==="L"?"LTR":"RTL",e.inFormat=i+o),a.charAt(0)==="C"&&(s=P8(t),s==="rtl"?a="RTL":s==="ltr"?(s=m0t(t),a=s.toUpperCase()):a=e.outFormat.charAt(2)==="L"?"LTR":"RTL",e.outFormat=n+a),e}function p0t(t,e,r){if(e.length===0)return"";t===void 0&&(t=!0),r===void 0&&(r=!0);const i=(e=String(e)).split("");let n=0,s=1,o=i.length;t||(n=i.length-1,s=-1,o=1);const a=f0t(i,n,s,o,r);let l="";for(let c=0;c<i.length;c++)r&&b0t(a,a.length,c)>-1?(FIe(A8,c,!t,-1),ku.splice(c,1)):l+=i[c];return l}function f0t(t,e,r,i,n){let s=0;const o=[];let a=0;for(let l=e;l*r<i;l+=r)if(NIe(t[l])||Q$(t[l])){if(t[l]==="ل"&&w0t(t,l+r,r,i)){t[l]=P0t(t[l+r],s===0?qgt:Ygt),l+=r,E0t(t,l,r,i),n&&(o[a]=l,a++),s=0;continue}const c=t[l];s===1?t[l]=jpe(t,l+r,r,i)?C0t(t[l]):hG(t[l],Zgt):jpe(t,l+r,r,i)===!0?t[l]=hG(t[l],Qgt):t[l]=hG(t[l],Xgt),Q$(c)||(s=1),S0t(c)===!0&&(s=0)}else s=0;return o}function P8(t){const e=/[A-Za-z\u05d0-\u065f\u066a-\u06ef\u06fa-\u07ff\ufb1d-\ufdff\ufe70-\ufefc]/.exec(t);return e?e[0]<="z"?"ltr":"rtl":""}function m0t(t){const e=t.split("");return e.reverse(),P8(e.join(""))}function g0t(t,e,r){if(t.length===0)return"";r===void 0&&(r=!0),e===void 0&&(e=!0);let i="";const n=(t=String(t)).split("");for(let s=0;s<t.length;s++){let o=!1;if(n[s]>="ﹰ"&&n[s]<"\uFEFF"){const a=t.charCodeAt(s);n[s]>="ﻵ"&&n[s]<="ﻼ"?(e?(s>0&&r&&n[s-1]===" "?i=i.substring(0,i.length-1)+"ل":(i+="ل",o=!0),i+=_3[(a-65269)/2]):(i+=_3[(a-65269)/2],i+="ل",s+1<t.length&&r&&n[s+1]===" "?s++:o=!0),o&&(FIe(A8,s,!0,1),ku.splice(s,0,ku[s]))):i+=Kgt[a-65136]}else i+=n[s]}return i}function s_(t,e){const r=t.split(""),i=[];return DIe(r,i,e),_0t(r,i,e),Hpe(2,r,i,e),Hpe(1,r,i,e),BU=i,r.join("")}function DIe(t,e,r){const i=t.length,n=r.dir?r0t:t0t;let s=0,o=-1;const a=[],l=[];r.hiLevel=r.dir,r.lastArabic=!1,r.hasUbatAl=!1,r.hasUbatB=!1,r.hasUbatS=!1;for(let c=0;c<i;c++)a[c]=v0t(t[c]);for(let c=0;c<i;c++){const u=s,h=x0t(t,a,l,c,r);l[c]=h,s=n[u][h];const p=240&s;s&=15;const f=n[s][R0t];if(e[c]=f,p>0)if(p===16){for(let g=o;g<c;g++)e[g]=1;o=-1}else o=-1;if(n[s][$0t])o===-1&&(o=c);else if(o>-1){for(let g=o;g<c;g++)e[g]=f;o=-1}a[c]===wm&&(e[c]=0),r.hiLevel|=f}r.hasUbatS&&y0t(a,e,i,r)}function y0t(t,e,r,i){for(let n=0;n<r;n++)if(t[n]===bF){e[n]=i.dir;for(let s=n-1;s>=0&&t[s]===rl;s--)e[s]=i.dir}}function _0t(t,e,r){if(r.hiLevel!==0&&r.swap.substr(0,1)!==r.swap.substr(1,2))for(let i=0;i<t.length;i++)e[i]===1&&(t[i]=T0t(t[i]))}function v0t(t){const e=t.charCodeAt(0),r=c0t[e>>8];return r<_m?r:u0t[r-_m][255&e]}function uG(t,e){const r=t.split("");if(e){const i=[];DIe(r,i,e),BU=i}return r.reverse(),ku.reverse(),r.join("")}function b0t(t,e,r){for(let i=0;i<e;i++)if(t[i]===r)return i;return-1}function NIe(t){for(let e=0;e<Gpe.length;e++)if(t>=Gpe[e]&&t<=e0t[e])return!0;return!1}function jpe(t,e,r,i){for(;e*r<i&&Q$(t[e]);)e+=r;return!!(e*r<i&&NIe(t[e]))}function w0t(t,e,r,i){for(;e*r<i&&Q$(t[e]);)e+=r;let n=" ";if(!(e*r<i))return!1;n=t[e];for(let s=0;s<_3.length;s++)if(_3[s]===n)return!0;return!1}function Hpe(t,e,r,i){if(i.hiLevel<t)return;if(t===1&&i.dir===zM&&!i.hasUbatB)return e.reverse(),void ku.reverse();const n=e.length;let s,o,a,l,c,u=0;for(;u<n;){if(r[u]>=t){for(s=u+1;s<n&&r[s]>=t;)s++;for(o=u,a=s-1;o<a;o++,a--)l=e[o],e[o]=e[a],e[a]=l,c=ku[o],ku[o]=ku[a],ku[a]=c;u=s}u++}}function x0t(t,e,r,i,n){const s=e[i];return{UBAT_L:()=>(n.lastArabic=!1,$),UBAT_R:()=>(n.lastArabic=!1,be),UBAT_ON:()=>P,UBAT_AN:()=>Es,UBAT_EN:()=>n.lastArabic?Es:Ot,UBAT_AL:()=>(n.lastArabic=!0,n.hasUbatAl=!0,be),UBAT_WS:()=>P,UBAT_CS:()=>{let o,a;return i<1||i+1>=e.length||(o=r[i-1])!==Ot&&o!==Es||(a=e[i+1])!==Ot&&a!==Es?P:(n.lastArabic&&(a=Es),a===o?a:P)},UBAT_ES:()=>(i>0?r[i-1]:wm)===Ot&&i+1<e.length&&e[i+1]===Ot?Ot:P,UBAT_ET:()=>{if(i>0&&r[i-1]===Ot)return Ot;if(n.lastArabic)return P;let o=i+1;const a=e.length;for(;o<a&&e[o]===Ut;)o++;return o<a&&e[o]===Ot?Ot:P},UBAT_NSM:()=>{if(n.inFormat==="VLTR"){const o=e.length;let a=i+1;for(;a<o&&e[a]===ee;)a++;if(a<o){const l=t[i].charCodeAt(0),c=l>=1425&&l<=2303||l===64286,u=e[a];if(c&&(u===be||u===M))return be}}return i<1||e[i-1]===wm?P:r[i-1]},UBAT_B:()=>(n.lastArabic=!0,n.hasUbatB=!0,n.dir),UBAT_S:()=>(n.hasUbatS=!0,P),UBAT_LRE:()=>(n.lastArabic=!1,P),UBAT_RLE:()=>(n.lastArabic=!1,P),UBAT_LRO:()=>(n.lastArabic=!1,P),UBAT_RLO:()=>(n.lastArabic=!1,P),UBAT_PDF:()=>(n.lastArabic=!1,P),UBAT_BN:()=>P}[l0t[s]]()}function T0t(t){let e,r=0,i=LN.length-1;for(;r<=i;)if(e=Math.floor((r+i)/2),t<LN[e][0])i=e-1;else{if(!(t>LN[e][0]))return LN[e][1];r=e+1}return t}function S0t(t){for(let e=0;e<Vpe.length;e++)if(Vpe[e]===t)return!0;return!1}function C0t(t){for(let e=0;e<E8.length;e++)if(t===E8[e])return Jgt[e];return t}function hG(t,e){for(let r=0;r<E8.length;r++)if(t===E8[r])return e[r];return t}function Q$(t){return t>="ً"&&t<="ٕ"}function Wpe(t){return t==="L"?"LTR":t==="R"?"RTL":t==="C"?"CLR":t==="D"?"CRL":""}function E0t(t,e,r,i){for(;e*r<i&&Q$(t[e]);)e+=r;return e*r<i&&(t[e]=" ",!0)}function P0t(t,e){for(let r=0;r<_3.length;r++)if(t===_3[r])return e[r];return t}function A0t(t,e,r){ku=[],BU=[];for(let i=0;i<r;i++)t[i]=i,e[i]=i,ku[i]=i}function M0t(t){const e=new Array(t.length);for(let r=0;r<t.length;r++)e[t[r]]=r;return e}function FIe(t,e,r,i){for(let n=0;n<t.length;n++)(t[n]>e||!r&&t[n]===e)&&(t[n]+=i)}let ku=[],A8=[],BU=[];const O0t={dir:0,defInFormat:"LLTR",defoutFormat:"VLTR",defSwap:"YN",inFormat:"LLTR",outFormat:"VLTR",swap:"YN",hiLevel:0,lastArabic:!1,hasUbatAl:!1,hasBlockSep:!1,hasSegSep:!1,defOutFormat:""},R0t=5,$0t=6,ET=0,zM=1,qpe=/^[(I|V)][(L|R|C|D)][(Y|N)][(S|N)][N]$/,I0t=/[\u0591-\u06ff\ufb1d-\ufefc]/,dG=new h0t;function L0t(t){if(t==null)return["",!1];if(!dG.hasBidiChar(t))return[t,!1];let e;return e=dG.checkContextual(t)==="rtl"?"IDNNN":"ICNNN",[dG.bidiTransform(t,e,"VLYSN"),!0]}let rP=class{constructor(){this.setIdentity()}getAngle(){return(this.rz==null||this.rz===0&&this.rzCos!==1&&this.rzSin!==0)&&(this.rz=Math.atan2(this.rzSin,this.rzCos)),this.rz}setIdentity(){this.tx=0,this.ty=0,this.tz=0,this.s=1,this.rx=0,this.ry=0,this.rz=0,this.rzCos=1,this.rzSin=0}setTranslate(e,r){this.tx=e,this.ty=r}setTranslateZ(e){this.tz=e}setRotateCS(e,r){this.rz=void 0,this.rzCos=e,this.rzSin=r}setRotate(e){this.rz=e,this.rzCos=void 0,this.rzSin=void 0}setRotateY(e){this.ry=e}setScale(e){this.s=e}setMeasure(e){this.m=e}};const kIe="arial-unicode-ms",Ype="woff2",Xpe=new Map,zIe=new Set;let D0t=class{constructor(e,r){this.fontFace=e,this.promise=r}};async function N0t(t){const e=z0t(t),r=Xpe.get(e);if(r)return r.promise;const i=new FontFace(t.family,`url('${mi.fontsUrl}/woff2/${e}.${Ype}') format('${Ype}')`,{style:t.style,weight:t.weight}),n=document.fonts;if(n.has(i)&&i.status==="loading")return i.loaded;const s=i.load().then(()=>(n.add(i),i));return Xpe.set(e,new D0t(i,s)),zIe.add(i),s}function F0t(t){return zIe.has(t)}function k0t(t){if(!t)return kIe;const e=t.toLowerCase().split(" ").join("-");switch(e){case"serif":return"noto-serif";case"sans-serif":return"arial-unicode-ms";case"monospace":return"ubuntu-mono";case"fantasy":return"cabin-sketch";case"cursive":return"redressed";default:return e}}function z0t(t){const e=U0t(t)+B0t(t);return k0t(t.family)+(e.length>0?e:"-regular")}function U0t(t){if(!t.weight)return"";switch(t.weight.toLowerCase()){case"bold":case"bolder":return"-bold"}return""}function B0t(t){if(!t.style)return"";switch(t.style.toLowerCase()){case"italic":case"oblique":return"-italic"}return""}let zs=class{static fromOptimized(e,r,i=!1,n=!1,s=1){return new jZ().initialize(e,r,i,n,s)}static fromJSON(e,r=!1,i=!1){const[n,s]=Zpe(e);return new HZ().initialize(n,s,r,i,1)}static fromOptimizedCIM(e,r,i=!1,n=!1,s=1){return new Jpe().initialize(e,r,i,n,s)}static fromJSONCIM(e,r=!1,i=!1,n=1){const[s,o]=Zpe(e);return new Qpe().initialize(s,o,r,i,n)}static fromFeatureSetReader(e){const r=e.readGeometryForDisplay(),i=e.geometryType;return r&&i?this.fromOptimized(r,i):null}static fromFeatureSetReaderCIM(e){const r=e.readGeometryForDisplay(),i=e.geometryType;return r&&i?this.fromOptimizedCIM(r,i):null}static createEmptyOptimized(e,r=!1,i=!1,n=1){return new jZ().initialize(new wd,e,r,i,n)}static createEmptyJSON(e,r=!1,i=!1){return new HZ().initialize([],e,r,i,1)}static createEmptyOptimizedCIM(e,r=!1,i=!1,n=1){return new Jpe().initialize(new wd,e,r,i,n)}static createEmptyJSONCIM(e,r=!1,i=!1,n=1){return new Qpe().initialize([],e,r,i,n)}asJSON(){const e=n9(this);return this.geometryType==="esriGeometryEnvelope"?{xmin:e[0][0][0],ymin:e[0][0][1],xmax:e[0][2][0],ymax:e[0][2][1]}:this.geometryType==="esriGeometryMultipoint"?{points:e.flat()}:this.geometryType==="esriGeometryPoint"?{x:e[0][0][0],y:e[0][0][1]}:this.geometryType==="esriGeometryPolygon"?{rings:e}:{paths:e}}getCurrentRingArea(){if(this.pathSize<3)return 0;let e,r,i=0;if(this.seekPathStart(),!this.nextPoint())return 0;e=this.x,r=this.y;const n=e,s=r;for(;this.nextPoint();)i+=(e-this.x)*(r+this.y),e=this.x,r=this.y;return i+=(e-n)*(r+s),-.5*i}invertY(){this.yFactor*=-1}},jZ=class UIe extends zs{constructor(){super(...arguments),this._end=-1}initialize(e,r,i,n,s){return this.hasZ=i,this.hasM=n,this.geometryType=r,this._stride=2+Number(i)+Number(n),this._geometry=e,this._pathIndex=-1,this._pathOffset=0,this._pointOffset=-this._stride,this._end=-1,this.yFactor=s,this}reset(){this.initialize(this._geometry,this.geometryType,this.hasZ,this.hasM,this.yFactor)}seekPath(e){if(e>=0&&e<this.totalSize){if(this._pathIndex<e)for(;this._pathIndex<e&&this.nextPath(););else if(this._pathIndex>e)for(;this._pathIndex>e&&this.prevPath(););return!0}return!1}seekPathStart(){this._pointOffset=this._pathOffset-this._stride}seekPathEnd(){this._pointOffset=this._end}seekInPath(e){const r=this._pathOffset+e*this._stride;return r>=0&&r<this._end&&(this._pointOffset=r,!0)}nextPoint(){return(this._pointOffset+=this._stride)<this._end}prevPoint(){return(this._pointOffset-=this._stride)>=this._pathOffset}nextPath(){return!(this.pathIndex>=this.totalSize-1)&&(this._pathIndex>=0&&(this._pathOffset+=this._stride*this.pathSize),this._pathIndex++,this._pointOffset=this._pathOffset-this._stride,this._end=this._pointOffset+this._stride+this._stride*this.pathSize,!0)}prevPath(){return!(this.pathIndex<=0)&&(this._pathIndex--,this._end=this._pathOffset,this._pathOffset-=this._stride*this.pathSize,this._pointOffset=this._pathOffset-this._stride,!0)}pathLength(){const e=this._end,r=this._stride,i=this._geometry.coords;let n=0;for(let s=this._pathOffset+r;s<e;s+=r){const o=i[s-r],a=i[s-r+1],l=i[s]-o,c=i[s+1]-a;n+=Math.sqrt(l*l+c*c)}return n}startPath(){this._geometry.lengths.push(0)}pushPath(e){this.startPath(),this.pushPoints(e)}pushPoint(e){for(let r=0;r<this._stride;++r)this._geometry.coords.push(e[r]);this._geometry.lengths[this.totalSize-1]++}pushXY(e,r){this._geometry.coords.push(e,r),this._geometry.lengths[this.totalSize-1]++}pushPoints(e){for(const r of e)for(let i=0;i<this._stride;++i)this._geometry.coords.push(r[i]);this._geometry.lengths[this.totalSize-1]+=e.length}pushCursor(e){const r=e.asOptimized();this._geometry.coords.push(...r.coords),this._geometry.lengths.push(...r.lengths)}asOptimized(){const e=this._geometry.clone();if(this.yFactor!==1)for(let r=1;r<e.coords.length;r+=this._stride)e.coords[r]*=this.yFactor;return this.geometryType==="esriGeometryPoint"&&(e.lengths.length=0),e}isClosed(){const e=this._geometry.coords,r=this._pathOffset,i=this._end-this._stride;for(let n=0;n<this._stride;n++)if(e[r+n]!==e[i+n])return!1;return!0}clone(){return new UIe().initialize(this._geometry.clone(),this.geometryType,this.hasZ,this.hasM,this.yFactor)}get totalPoints(){return this._geometry.isPoint?1:this._geometry.lengths.reduce((e,r)=>e+r)}get pathSize(){const{lengths:e}=this._geometry;return this._pathIndex<0||this._pathIndex>e.length-1?0:this._geometry.isPoint?1:e[this._pathIndex]}get totalSize(){return this._geometry.lengths.length}get x(){return this._geometry.coords[this._pointOffset]}set x(e){this._geometry.coords[this._pointOffset]=e}get y(){return this.yFactor*this._geometry.coords[this._pointOffset+1]}set y(e){this._geometry.coords[this._pointOffset+1]=this.yFactor*e}get z(){return this._geometry.coords[this._pointOffset+2]}set z(e){this._geometry.coords[this._pointOffset+2]=e}get m(){const e=this.hasZ?3:2;return this._geometry.coords[this._pointOffset+e]}set m(e){this._geometry.coords[this._pointOffset+3]=e}get pathIndex(){return this._pathIndex}get _coordIndex(){return this._pointOffset/this._stride}};function V0t(t){const e=[t.x,t.y];return t.z&&e.push(t.z),t.m&&e.push(t.m),e}function Zpe(t){return zc(t)?[t.rings,"esriGeometryPolygon"]:Ip(t)?[t.paths,"esriGeometryPolyline"]:Cx(t)?[[t.points],"esriGeometryMultipoint"]:$p(t)?[[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]],"esriGeometryEnvelope"]:zE(t)?[[[V0t(t)]],"esriGeometryPoint"]:[[],"esriGeometryPolyline"]}let HZ=class BIe extends zs{initialize(e,r,i,n,s){return this._paths=e,this.geometryType=r,this.hasZ=i,this.hasM=n,this._pathIndex=this._pointIndex=-1,this.yFactor=s,this._mIndex=this.hasZ?3:2,this}reset(){this._pathIndex=this._pointIndex=-1}seekPath(e){return this._pathIndex=e,this._pointIndex=-1,e>=0&&e<this.totalSize&&(this._currentPath=this._paths[e],!0)}seekPathStart(){this._pointIndex=-1}seekPathEnd(){this._pointIndex=this._currentPath.length}seekInPath(e){return e>=0&&e<this._currentPath.length&&(this._pointIndex=e,this._currentPoint=this._currentPath[this._pointIndex],!0)}nextPoint(){return this._currentPoint=this._currentPath[++this._pointIndex],this._pointIndex<this._currentPath.length}prevPoint(){return this._currentPoint=this._currentPath[--this._pointIndex],this._pointIndex>=0}nextPath(){return this._pointIndex=-1,this._currentPath=this._paths[++this._pathIndex],this._pathIndex<this.totalSize}prevPath(){return this.pathIndex>0&&(this._pointIndex=-1,this._pathIndex--,this._currentPath=this._paths[this._pathIndex],!0)}pathLength(){const e=this._currentPath.length,r=this._currentPath;let i=0;for(let n=1;n<e;n++){const s=r[n-1],o=r[n],a=s[0],l=s[1],c=o[0]-a,u=o[1]-l;i+=Math.sqrt(c*c+u*u)}return i}startPath(){this._paths.push([])}pushPath(e){this._paths.push(e)}pushPoint(e){this._paths[this.totalSize-1].push(e)}pushXY(e,r){this._paths[this.totalSize-1].push([e,r])}pushPoints(e){this._paths[this.totalSize-1].push(...e)}pushCursor(e){const r=n9(e);for(const i of r)this.pushPath(i)}asOptimized(){const e=new wd;if(this.geometryType==="esriGeometryPoint")e.coords.push(...this._paths[0][0]),e.lengths.length=0;else for(const r of this._paths){for(const i of r)e.coords.push(i[0]),e.coords.push(i[1]*this.yFactor),this.hasZ&&e.coords.push(i[2]),this.hasM&&e.coords.push(i[this._mIndex]);e.lengths.push(r.length)}return e}isClosed(){const e=this._currentPath[0],r=this._currentPath[this._currentPath.length-1];for(let i=0;i<e.length;i++)if(e[i]!==r[i])return!1;return!0}clone(){return new BIe().initialize(_e(this._paths),this.geometryType,this.hasZ,this.hasM,this.yFactor)}get totalPoints(){return this._paths.map(e=>e.length).reduce((e,r)=>e+r)}get pathSize(){return this._pathIndex<0||this._pathIndex>this.totalSize-1?-1:this._paths[this._pathIndex].length}get totalSize(){return this._paths.length}get x(){return this._currentPoint[0]}set x(e){this._currentPoint[0]=e}get y(){return this.yFactor*this._currentPoint[1]}set y(e){this._currentPoint[1]=this.yFactor*e}get z(){return this._currentPoint[2]}set z(e){this._currentPoint[2]=e}get m(){return this._currentPoint[this._mIndex]}set m(e){this._currentPoint[this._mIndex]=e}get pathIndex(){return this._pathIndex}};const DN=4,NN=1;let Jpe=class VIe extends jZ{initialize(e,r,i,n,s){return super.initialize(e,r,i,n,s),this._controlPoints||(this._controlPoints=this._controlPoints=new Array(this.totalSize).fill(void 0).map(o=>new Set)),this}startPath(){super.startPath(),this._controlPoints.push(new Set)}clone(){const e=new VIe().initialize(this._geometry.clone(),this.geometryType,this.hasZ,this.hasM,this.yFactor);return e._controlPoints=this._controlPoints,e}setControlPoint(){this._controlPoints[this.pathIndex].add(this._coordIndex)}getControlPoint(){return this._controlPoints[this.pathIndex].has(this._coordIndex)}setControlPointAt(e){this._controlPoints[this.pathIndex].add(e)}getControlPointAt(e){return this._controlPoints[this.pathIndex].has(e)}},Qpe=class GIe extends HZ{initialize(e,r,i,n,s){return super.initialize(e,r,i,n,s)}clone(){return new GIe().initialize(_e(this._paths),this.geometryType,this.hasZ,this.hasM,this.yFactor)}setControlPoint(){this._paths[this.pathIndex][this._pointIndex][DN]=NN}getControlPoint(){return this._paths[this.pathIndex][this._pointIndex][DN]===NN}setControlPointAt(e){this._paths[this.pathIndex][e][DN]=NN}getControlPointAt(e){return this._paths[this.pathIndex][e][DN]===NN}};const G0t=512;var xp,Qo;(function(t){t[t.Unknown=0]="Unknown",t[t.Point=1]="Point",t[t.LineString=2]="LineString",t[t.Polygon=3]="Polygon"})(xp||(xp={}));let Ca=class wF{constructor(e,r){this.x=e,this.y=r}clone(){return new wF(this.x,this.y)}equals(e,r){return e===this.x&&r===this.y}isEqual(e){return e.x===this.x&&e.y===this.y}setCoords(e,r){return this.x=e,this.y=r,this}normalize(){const e=this.x,r=this.y,i=Math.sqrt(e*e+r*r);return this.x/=i,this.y/=i,this}rightPerpendicular(){const e=this.x;return this.x=this.y,this.y=-e,this}leftPerpendicular(){const e=this.x;return this.x=-this.y,this.y=e,this}move(e,r){return this.x+=e,this.y+=r,this}assign(e){return this.x=e.x,this.y=e.y,this}assignAdd(e,r){return this.x=e.x+r.x,this.y=e.y+r.y,this}assignSub(e,r){return this.x=e.x-r.x,this.y=e.y-r.y,this}rotate(e,r){const i=this.x,n=this.y;return this.x=i*e-n*r,this.y=i*r+n*e,this}scale(e){return this.x*=e,this.y*=e,this}length(){const e=this.x,r=this.y;return Math.sqrt(e*e+r*r)}sub(e){return this.x-=e.x,this.y-=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}static distance(e,r){const i=r.x-e.x,n=r.y-e.y;return Math.sqrt(i*i+n*n)}static add(e,r){return new wF(e.x+r.x,e.y+r.y)}static sub(e,r){return new wF(e.x-r.x,e.y-r.y)}},FN=class{constructor(e,r,i){this.ratio=e,this.x=r,this.y=i}},j0t=class{constructor(e,r,i,n=8,s=8){this._lines=[],this._starts=[],this.validateTessellation=!0,this._pixelRatio=n,this._pixelMargin=s,this._tileSize=G0t*n,this._dz=e,this._yPos=r,this._xPos=i}setPixelMargin(e){e!==this._pixelMargin&&(this._pixelMargin=e,this.setExtent(this._extent))}setExtent(e){this._extent=e,this._finalRatio=this._tileSize/e*(1<<this._dz);let r=this._pixelRatio*this._pixelMargin;r/=this._finalRatio;const i=e>>this._dz;r>i&&(r=i),this._margin=r,this._xmin=i*this._xPos-r,this._ymin=i*this._yPos-r,this._xmax=this._xmin+i+2*r,this._ymax=this._ymin+i+2*r}reset(e){this._type=e,this._lines=[],this._starts=[],this._line=null,this._start=0}moveTo(e,r){this._pushLine(),this._prevIsIn=this._isIn(e,r),this._moveTo(e,r,this._prevIsIn),this._prevPt=new Ca(e,r),this._firstPt=new Ca(e,r),this._dist=0}lineTo(e,r){const i=this._isIn(e,r),n=new Ca(e,r),s=Ca.distance(this._prevPt,n);let o,a,l,c,u,h,p,f;if(i)this._prevIsIn?this._lineTo(e,r,!0):(o=this._prevPt,a=n,l=this._intersect(a,o),this._start=this._dist+s*(1-this._r),this._lineTo(l.x,l.y,!0),this._lineTo(a.x,a.y,!0));else if(this._prevIsIn)a=this._prevPt,o=n,l=this._intersect(a,o),this._lineTo(l.x,l.y,!0),this._lineTo(o.x,o.y,!1);else{const g=this._prevPt,_=n;if(g.x<=this._xmin&&_.x<=this._xmin||g.x>=this._xmax&&_.x>=this._xmax||g.y<=this._ymin&&_.y<=this._ymin||g.y>=this._ymax&&_.y>=this._ymax)this._lineTo(_.x,_.y,!1);else{const v=[];if((g.x<this._xmin&&_.x>this._xmin||g.x>this._xmin&&_.x<this._xmin)&&(c=(this._xmin-g.x)/(_.x-g.x),f=g.y+c*(_.y-g.y),f<=this._ymin?h=!1:f>=this._ymax?h=!0:v.push(new FN(c,this._xmin,f))),(g.x<this._xmax&&_.x>this._xmax||g.x>this._xmax&&_.x<this._xmax)&&(c=(this._xmax-g.x)/(_.x-g.x),f=g.y+c*(_.y-g.y),f<=this._ymin?h=!1:f>=this._ymax?h=!0:v.push(new FN(c,this._xmax,f))),(g.y<this._ymin&&_.y>this._ymin||g.y>this._ymin&&_.y<this._ymin)&&(c=(this._ymin-g.y)/(_.y-g.y),p=g.x+c*(_.x-g.x),p<=this._xmin?u=!1:p>=this._xmax?u=!0:v.push(new FN(c,p,this._ymin))),(g.y<this._ymax&&_.y>this._ymax||g.y>this._ymax&&_.y<this._ymax)&&(c=(this._ymax-g.y)/(_.y-g.y),p=g.x+c*(_.x-g.x),p<=this._xmin?u=!1:p>=this._xmax?u=!0:v.push(new FN(c,p,this._ymax))),v.length===0)u?h?this._lineTo(this._xmax,this._ymax,!0):this._lineTo(this._xmax,this._ymin,!0):h?this._lineTo(this._xmin,this._ymax,!0):this._lineTo(this._xmin,this._ymin,!0);else if(v.length>1&&v[0].ratio>v[1].ratio)this._start=this._dist+s*v[1].ratio,this._lineTo(v[1].x,v[1].y,!0),this._lineTo(v[0].x,v[0].y,!0);else{this._start=this._dist+s*v[0].ratio;for(let b=0;b<v.length;b++)this._lineTo(v[b].x,v[b].y,!0)}this._lineTo(_.x,_.y,!1)}}this._dist+=s,this._prevIsIn=i,this._prevPt=n}close(){if(this._line.length>2){const e=this._firstPt,r=this._prevPt;e.x===r.x&&e.y===r.y||this.lineTo(e.x,e.y);const i=this._line;let n=i.length;for(;n>=4&&(i[0].x===i[1].x&&i[0].x===i[n-2].x||i[0].y===i[1].y&&i[0].y===i[n-2].y);)i.pop(),i[0].x=i[n-2].x,i[0].y=i[n-2].y,--n}}result(e=!0){return this._pushLine(),this._lines.length===0?null:(this._type===xp.Polygon&&e&&H0t.simplify(this._tileSize,this._margin*this._finalRatio,this._lines),this._lines)}resultWithStarts(){if(this._type!==xp.LineString)throw new Error("Only valid for lines");this._pushLine();const e=this._lines,r=e.length;if(r===0)return null;const i=[];for(let n=0;n<r;n++)i.push({line:e[n],start:this._starts[n]||0});return i}_isIn(e,r){return e>=this._xmin&&e<=this._xmax&&r>=this._ymin&&r<=this._ymax}_intersect(e,r){let i,n,s;if(r.x>=this._xmin&&r.x<=this._xmax)n=r.y<=this._ymin?this._ymin:this._ymax,s=(n-e.y)/(r.y-e.y),i=e.x+s*(r.x-e.x);else if(r.y>=this._ymin&&r.y<=this._ymax)i=r.x<=this._xmin?this._xmin:this._xmax,s=(i-e.x)/(r.x-e.x),n=e.y+s*(r.y-e.y);else{n=r.y<=this._ymin?this._ymin:this._ymax,i=r.x<=this._xmin?this._xmin:this._xmax;const o=(i-e.x)/(r.x-e.x),a=(n-e.y)/(r.y-e.y);o<a?(s=o,n=e.y+o*(r.y-e.y)):(s=a,i=e.x+a*(r.x-e.x))}return this._r=s,new Ca(i,n)}_pushLine(){this._line&&(this._type===xp.Point?this._line.length>0&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===xp.LineString?this._line.length>1&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===xp.Polygon&&this._line.length>3&&(this._lines.push(this._line),this._starts.push(this._start))),this._line=[],this._start=0}_moveTo(e,r,i){this._type!==xp.Polygon?i&&(e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),r=Math.round((r-(this._ymin+this._margin))*this._finalRatio),this._line.push(new Ca(e,r))):(i||(e<this._xmin&&(e=this._xmin),e>this._xmax&&(e=this._xmax),r<this._ymin&&(r=this._ymin),r>this._ymax&&(r=this._ymax)),e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),r=Math.round((r-(this._ymin+this._margin))*this._finalRatio),this._line.push(new Ca(e,r)),this._isH=!1,this._isV=!1)}_lineTo(e,r,i){let n,s;if(this._type!==xp.Polygon)if(i){if(e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),r=Math.round((r-(this._ymin+this._margin))*this._finalRatio),this._line.length>0&&(n=this._line[this._line.length-1],n.equals(e,r)))return;this._line.push(new Ca(e,r))}else this._line&&this._line.length>0&&this._pushLine();else if(i||(e<this._xmin&&(e=this._xmin),e>this._xmax&&(e=this._xmax),r<this._ymin&&(r=this._ymin),r>this._ymax&&(r=this._ymax)),e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),r=Math.round((r-(this._ymin+this._margin))*this._finalRatio),this._line&&this._line.length>0){n=this._line[this._line.length-1];const o=n.x===e,a=n.y===r;if(o&&a)return;this._isH&&o||this._isV&&a?(n.x=e,n.y=r,s=this._line[this._line.length-2],s.x===e&&s.y===r?(this._line.pop(),this._line.length<=1?(this._isH=!1,this._isV=!1):(s=this._line[this._line.length-2],this._isH=s.x===e,this._isV=s.y===r)):(this._isH=s.x===e,this._isV=s.y===r)):(this._line.push(new Ca(e,r)),this._isH=o,this._isV=a)}else this._line.push(new Ca(e,r))}},rjt=class{setExtent(e){this._ratio=e===4096?1:4096/e}get validateTessellation(){return this._ratio<1}reset(e){this._lines=[],this._line=null}moveTo(e,r){this._line&&this._lines.push(this._line),this._line=[];const i=this._ratio;this._line.push(new Ca(e*i,r*i))}lineTo(e,r){const i=this._ratio;this._line.push(new Ca(e*i,r*i))}close(){const e=this._line;e&&!e[0].isEqual(e[e.length-1])&&e.push(e[0])}result(){return this._line&&this._lines.push(this._line),this._lines.length===0?null:this._lines}};(function(t){t[t.sideLeft=0]="sideLeft",t[t.sideRight=1]="sideRight",t[t.sideTop=2]="sideTop",t[t.sideBottom=3]="sideBottom"})(Qo||(Qo={}));let H0t=class k_{static simplify(e,r,i){if(!i)return;const n=-r,s=e+r,o=-r,a=e+r,l=[],c=[],u=i.length;for(let p=0;p<u;++p){const f=i[p];if(!f||f.length<2)continue;let g,_=f[0];const v=f.length;for(let b=1;b<v;++b)g=f[b],_.x===g.x&&(_.x<=n&&(_.y>g.y?(l.push(p),l.push(b),l.push(Qo.sideLeft),l.push(-1)):(c.push(p),c.push(b),c.push(Qo.sideLeft),c.push(-1))),_.x>=s&&(_.y<g.y?(l.push(p),l.push(b),l.push(Qo.sideRight),l.push(-1)):(c.push(p),c.push(b),c.push(Qo.sideRight),c.push(-1)))),_.y===g.y&&(_.y<=o&&(_.x<g.x?(l.push(p),l.push(b),l.push(Qo.sideTop),l.push(-1)):(c.push(p),c.push(b),c.push(Qo.sideTop),c.push(-1))),_.y>=a&&(_.x>g.x?(l.push(p),l.push(b),l.push(Qo.sideBottom),l.push(-1)):(c.push(p),c.push(b),c.push(Qo.sideBottom),c.push(-1)))),_=g}if(l.length===0||c.length===0)return;k_.fillParent(i,c,l),k_.fillParent(i,l,c);const h=[];k_.calcDeltas(h,c,l),k_.calcDeltas(h,l,c),k_.addDeltas(h,i)}static fillParent(e,r,i){const n=i.length,s=r.length;for(let o=0;o<s;o+=4){const a=r[o],l=r[o+1],c=r[o+2],u=e[a][l-1],h=e[a][l];let p=8092,f=-1;for(let g=0;g<n;g+=4){if(i[g+2]!==c)continue;const _=i[g],v=i[g+1],b=e[_][v-1],w=e[_][v];switch(c){case Qo.sideLeft:case Qo.sideRight:if(kN(u.y,b.y,w.y)&&kN(h.y,b.y,w.y)){const x=Math.abs(w.y-b.y);x<p&&(p=x,f=g)}break;case Qo.sideTop:case Qo.sideBottom:if(kN(u.x,b.x,w.x)&&kN(h.x,b.x,w.x)){const x=Math.abs(w.x-b.x);x<p&&(p=x,f=g)}}}r[o+3]=f}}static calcDeltas(e,r,i){const n=r.length;for(let s=0;s<n;s+=4){const o=[],a=k_.calcDelta(s,r,i,o);e.push(r[s]),e.push(r[s+1]),e.push(r[s+2]),e.push(a)}}static calcDelta(e,r,i,n){const s=r[e+3];if(s===-1)return 0;const o=n.length;return o>1&&n[o-2]===s?0:(n.push(s),k_.calcDelta(s,i,r,n)+1)}static addDeltas(e,r){const i=e.length;let n=0;for(let s=0;s<i;s+=4){const o=e[s+3];o>n&&(n=o)}for(let s=0;s<i;s+=4){const o=r[e[s]],a=e[s+1],l=n-e[s+3];switch(e[s+2]){case Qo.sideLeft:o[a-1].x-=l,o[a].x-=l,a===1&&(o[o.length-1].x-=l),a===o.length-1&&(o[0].x-=l);break;case Qo.sideRight:o[a-1].x+=l,o[a].x+=l,a===1&&(o[o.length-1].x+=l),a===o.length-1&&(o[0].x+=l);break;case Qo.sideTop:o[a-1].y-=l,o[a].y-=l,a===1&&(o[o.length-1].y-=l),a===o.length-1&&(o[0].y-=l);break;case Qo.sideBottom:o[a-1].y+=l,o[a].y+=l,a===1&&(o[o.length-1].y+=l),a===o.length-1&&(o[0].y+=l)}}}};const kN=(t,e,r)=>t>=e&&t<=r||t>=r&&t<=e,W0t=512;let Ng,q0t=class{constructor(e){this._geometry=e}next(){const e=this._geometry;return this._geometry=null,e}};function Gie(t,e){Ng||(Ng=new j0t(0,0,0,1));const r=t.geometryType==="esriGeometryPolygon",i=r?xp.Polygon:xp.LineString,n=r?3:2;let s,o;for(Ng.reset(i),Ng.setPixelMargin(e+1),Ng.setExtent(W0t);t.nextPath();)if(!(t.pathSize<n)){for(t.nextPoint(),s=t.x,o=-t.y,Ng.moveTo(s,o);t.nextPoint();)s=t.x,o=-t.y,Ng.lineTo(s,o);r&&Ng.close()}const a=Ng.result(!1);if(a){const l=zs.createEmptyOptimizedCIM(t.geometryType);for(const c of a){l.startPath();for(const u of c)l.pushXY(u.x,-u.y)}return l.reset(),l}return null}let Y0t=class{applyColorSubstituition(e,r){if(!r)return e;this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));const{width:i,height:n}=e,s=this._rasterizationCanvas,o=s.getContext("2d",{willReadFrequently:!0});e!==s&&(s.width=i,s.height=n,o.drawImage(e,0,0,i,n));const a=o.getImageData(0,0,i,n).data;if(r){for(const c of r)if(c&&c.oldColor&&c.oldColor.length===4&&c.newColor&&c.newColor.length===4){const[u,h,p,f]=c.oldColor,[g,_,v,b]=c.newColor;if(u===g&&h===_&&p===v&&f===b)continue;for(let w=0;w<a.length;w+=4)u===a[w]&&h===a[w+1]&&p===a[w+2]&&f===a[w+3]&&(a[w]=g,a[w+1]=_,a[w+2]=v,a[w+3]=b)}}const l=new ImageData(a,i,n);return o.putImageData(l,0,0),s}tintImageData(e,r){if(!r||r.length<4)return e;this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));const{width:i,height:n}=e,s=this._rasterizationCanvas,o=s.getContext("2d",{willReadFrequently:!0});e!==s&&(s.width=i,s.height=n,o.drawImage(e,0,0,i,n));const a=o.getImageData(0,0,i,n),l=new Uint8Array(a.data),c=[r[0]/255,r[1]/255,r[2]/255,r[3]/255];for(let h=0;h<l.length;h+=4)l[h]*=c[0],l[h+1]*=c[1],l[h+2]*=c[2],l[h+3]*=c[3];const u=new ImageData(new Uint8ClampedArray(l.buffer),i,n);return o.putImageData(u,0,0),s}},jIe=class UM{static local(){return UM.instance===null&&(UM.instance=new UM),UM.instance}execute(e,r,i,n,s){return new X0t(e,r,i)}};jIe.instance=null;let X0t=class{constructor(e,r,i){this._inputGeometries=e,this._angleTolerance=r.angleTolerance!==void 0?r.angleTolerance:120,this._maxCosAngle=Math.cos((1-Math.abs(this._angleTolerance)/180)*Math.PI)}next(){let e=this._inputGeometries.next();for(;e;){if(e.geometryType==="esriGeometryPolygon")this._isClosed=!0;else if(e.geometryType==="esriGeometryPolyline")this._isClosed=!1;else{if(e.geometryType!=="esriGeometryEnvelope"){e=this._inputGeometries.next();continue}if(this._maxCosAngle)return e;this._isClosed=!0}for(;e.nextPath();)this._processPath(e);return e.reset(),e}return null}_processPath(e){if(e.nextPoint()){const r=e.x,i=e.y;let n=r,s=i,o=e.pathSize,a=0,l=0,c=0,u=0,h=0,p=0;this._isClosed&&++o;for(let f=1;e.nextPoint()||f<o;++f){let g,_;this._isClosed&&f===o-1?(g=r,_=i):(g=e.x,_=e.y);const v=g-n,b=_-s,w=Math.sqrt(v*v+b*b);f>1&&w>0&&c>0&&(a*v+l*b)/w/c<=this._maxCosAngle&&e.setControlPointAt(f-1),f===1&&(u=v,h=b,p=w),w>0&&(n=g,s=_,a=v,l=b,c=w)}this._isClosed&&c>0&&p>0&&(a*u+l*h)/p/c<=this._maxCosAngle&&e.setControlPointAt(0)}}};function pG(t,e){t[4]=e}let uL=class{constructor(e,r=!0,i=!0,n=0){this.isClosed=!1,this.geometryCursor=null,this.geometryCursor=!r&&e.geometryType==="esriGeometryPolygon"||!i&&e.geometryType==="esriGeometryPolyline"?null:e,this.geomUnitsPerPoint=n,this.iteratePath=!1,this.internalPlacement=new rP}next(){if(!this.geometryCursor)return null;for(;this.iteratePath||this.geometryCursor.pathIndex<this.geometryCursor.totalSize-1;){this.iteratePath||this.geometryCursor.nextPath();const e=this.processPath(this.geometryCursor);if(e)return e}return this.geometryCursor=null,null}},VU=class{constructor(e,r,i,n=0){this.isClosed=!1,this.inputGeometries=e,this.acceptPolygon=r,this.acceptPolyline=i,this.geomUnitsPerPoint=n,this.iteratePath=!1,this.multiPathCursor=null}next(){for(;;){if(!this.multiPathCursor){let e=this.inputGeometries.next();for(;e&&(this.isClosed=this.acceptPolygon&&e.geometryType==="esriGeometryPolygon"||e.geometryType==="esriGeometryEnvelope",this.multiPathCursor=e,!this.multiPathCursor);)e=this.inputGeometries.next();if(!this.multiPathCursor)return null}for(;this.iteratePath||this.multiPathCursor.nextPath();){this.multiPathCursor.seekPathStart();const e=this.processPath(this.multiPathCursor);if(e)return e}this.multiPathCursor=null}}};var WZ,qZ,Kpe,efe,km,tfe,YZ,XZ,ZZ,rfe,ife,nfe,sfe,ofe,afe,JZ,QZ,lfe,cfe,cE,Fr,Yw,ufe,hfe,O0,dfe,pfe,yC,KZ,ffe,mfe,gfe,yfe,_fe,vfe,td,xa,bfe,wfe,zm,xfe,Tfe,Sfe,Cfe,dp,bR,Xw,_C,Efe,Pfe,Afe,Mfe,Ofe,Rfe,$fe,M8,vC,Ife,eJ,Lfe,Dfe;(function(t){t[t.BUTT=0]="BUTT",t[t.ROUND=1]="ROUND",t[t.SQUARE=2]="SQUARE",t[t.UNKNOWN=4]="UNKNOWN"})(WZ||(WZ={})),function(t){t[t.BEVEL=0]="BEVEL",t[t.ROUND=1]="ROUND",t[t.MITER=2]="MITER",t[t.UNKNOWN=4]="UNKNOWN"}(qZ||(qZ={})),function(t){t[t.SCREEN=0]="SCREEN",t[t.MAP=1]="MAP"}(Kpe||(Kpe={})),function(t){t[t.Tint=0]="Tint",t[t.Ignore=1]="Ignore",t[t.Multiply=99]="Multiply"}(efe||(efe={})),function(t){t.Both="Both",t.JustBegin="JustBegin",t.JustEnd="JustEnd",t.None="None"}(km||(km={})),function(t){t[t.Mosaic=0]="Mosaic",t[t.Centered=1]="Centered"}(tfe||(tfe={})),function(t){t[t.Normal=0]="Normal",t[t.Superscript=1]="Superscript",t[t.Subscript=2]="Subscript"}(YZ||(YZ={})),function(t){t[t.MSSymbol=0]="MSSymbol",t[t.Unicode=1]="Unicode"}(XZ||(XZ={})),function(t){t[t.Unspecified=0]="Unspecified",t[t.TrueType=1]="TrueType",t[t.PSOpenType=2]="PSOpenType",t[t.TTOpenType=3]="TTOpenType",t[t.Type1=4]="Type1"}(ZZ||(ZZ={})),function(t){t[t.Display=0]="Display",t[t.Map=1]="Map"}(rfe||(rfe={})),function(t){t.None="None",t.Loop="Loop",t.Oscillate="Oscillate"}(ife||(ife={})),function(t){t[t.Z=0]="Z",t[t.X=1]="X",t[t.Y=2]="Y"}(nfe||(nfe={})),function(t){t[t.XYZ=0]="XYZ",t[t.ZXY=1]="ZXY",t[t.YXZ=2]="YXZ"}(sfe||(sfe={})),function(t){t[t.Rectangle=0]="Rectangle",t[t.RoundedRectangle=1]="RoundedRectangle",t[t.Oval=2]="Oval"}(ofe||(ofe={})),function(t){t[t.None=0]="None",t[t.Alpha=1]="Alpha",t[t.Screen=2]="Screen",t[t.Multiply=3]="Multiply",t[t.Add=4]="Add"}(afe||(afe={})),function(t){t[t.TTB=0]="TTB",t[t.RTL=1]="RTL",t[t.BTT=2]="BTT"}(JZ||(JZ={})),function(t){t[t.None=0]="None",t[t.SignPost=1]="SignPost",t[t.FaceNearPlane=2]="FaceNearPlane"}(QZ||(QZ={})),function(t){t[t.Float=0]="Float",t[t.String=1]="String",t[t.Boolean=2]="Boolean"}(lfe||(lfe={})),function(t){t[t.Intersect=0]="Intersect",t[t.Subtract=1]="Subtract"}(cfe||(cfe={})),function(t){t.OpenEnded="OpenEnded",t.Block="Block",t.Crossed="Crossed"}(cE||(cE={})),function(t){t.FullGeometry="FullGeometry",t.PerpendicularFromFirstSegment="PerpendicularFromFirstSegment",t.ReversedFirstSegment="ReversedFirstSegment",t.PerpendicularToSecondSegment="PerpendicularToSecondSegment",t.SecondSegmentWithTicks="SecondSegmentWithTicks",t.DoublePerpendicular="DoublePerpendicular",t.OppositeToFirstSegment="OppositeToFirstSegment",t.TriplePerpendicular="TriplePerpendicular",t.HalfCircleFirstSegment="HalfCircleFirstSegment",t.HalfCircleSecondSegment="HalfCircleSecondSegment",t.HalfCircleExtended="HalfCircleExtended",t.OpenCircle="OpenCircle",t.CoverageEdgesWithTicks="CoverageEdgesWithTicks",t.GapExtentWithDoubleTicks="GapExtentWithDoubleTicks",t.GapExtentMidline="GapExtentMidline",t.Chevron="Chevron",t.PerpendicularWithArc="PerpendicularWithArc",t.ClosedHalfCircle="ClosedHalfCircle",t.TripleParallelExtended="TripleParallelExtended",t.ParallelWithTicks="ParallelWithTicks",t.Parallel="Parallel",t.PerpendicularToFirstSegment="PerpendicularToFirstSegment",t.ParallelOffset="ParallelOffset",t.OffsetOpposite="OffsetOpposite",t.OffsetSame="OffsetSame",t.CircleWithArc="CircleWithArc",t.DoubleJog="DoubleJog",t.PerpendicularOffset="PerpendicularOffset",t.LineExcludingLastSegment="LineExcludingLastSegment",t.MultivertexArrow="MultivertexArrow",t.CrossedArrow="CrossedArrow",t.ChevronArrow="ChevronArrow",t.ChevronArrowOffset="ChevronArrowOffset",t.PartialFirstSegment="PartialFirstSegment",t.Arch="Arch",t.CurvedParallelTicks="CurvedParallelTicks",t.Arc90Degrees="Arc90Degrees"}(Fr||(Fr={})),function(t){t.Mitered="Mitered",t.Bevelled="Bevelled",t.Rounded="Rounded",t.Square="Square",t.TrueBuffer="TrueBuffer"}(Yw||(Yw={})),function(t){t.ClosePath="ClosePath",t.ConvexHull="ConvexHull",t.RectangularBox="RectangularBox"}(ufe||(ufe={})),function(t){t.BeginningOfLine="BeginningOfLine",t.EndOfLine="EndOfLine"}(hfe||(hfe={})),function(t){t.Mitered="Mitered",t.Bevelled="Bevelled",t.Rounded="Rounded",t.Square="Square"}(O0||(O0={})),function(t){t.Fast="Fast",t.Accurate="Accurate"}(dfe||(dfe={})),function(t){t.BeginningOfLine="BeginningOfLine",t.EndOfLine="EndOfLine"}(pfe||(pfe={})),function(t){t.Sinus="Sinus",t.Square="Square",t.Triangle="Triangle",t.Random="Random"}(yC||(yC={})),function(t){t[t.None=0]="None",t[t.Default=1]="Default",t[t.Force=2]="Force"}(KZ||(KZ={})),function(t){t[t.Buffered=0]="Buffered",t[t.Left=1]="Left",t[t.Right=2]="Right",t[t.AlongLine=3]="AlongLine"}(ffe||(ffe={})),function(t){t[t.Linear=0]="Linear",t[t.Rectangular=1]="Rectangular",t[t.Circular=2]="Circular",t[t.Buffered=3]="Buffered"}(mfe||(mfe={})),function(t){t[t.Discrete=0]="Discrete",t[t.Continuous=1]="Continuous"}(gfe||(gfe={})),function(t){t[t.AcrossLine=0]="AcrossLine",t[t.AloneLine=1]="AloneLine"}(yfe||(yfe={})),function(t){t[t.Left=0]="Left",t[t.Right=1]="Right",t[t.Center=2]="Center",t[t.Justify=3]="Justify"}(_fe||(_fe={})),function(t){t[t.Base=0]="Base",t[t.MidPoint=1]="MidPoint",t[t.ThreePoint=2]="ThreePoint",t[t.FourPoint=3]="FourPoint",t[t.Underline=4]="Underline",t[t.CircularCW=5]="CircularCW",t[t.CircularCCW=6]="CircularCCW"}(vfe||(vfe={})),function(t){t.Butt="Butt",t.Round="Round",t.Square="Square"}(td||(td={})),function(t){t.NoConstraint="NoConstraint",t.HalfPattern="HalfPattern",t.HalfGap="HalfGap",t.FullPattern="FullPattern",t.FullGap="FullGap",t.Custom="Custom"}(xa||(xa={})),function(t){t[t.None=-1]="None",t[t.Custom=0]="Custom",t[t.Circle=1]="Circle",t[t.OpenArrow=2]="OpenArrow",t[t.ClosedArrow=3]="ClosedArrow",t[t.Diamond=4]="Diamond"}(bfe||(bfe={})),function(t){t[t.ExtraLeading=0]="ExtraLeading",t[t.Multiple=1]="Multiple",t[t.Exact=2]="Exact"}(wfe||(wfe={})),function(t){t.Bevel="Bevel",t.Round="Round",t.Miter="Miter"}(zm||(zm={})),function(t){t[t.Default=0]="Default",t[t.String=1]="String",t[t.Numeric=2]="Numeric"}(xfe||(xfe={})),function(t){t[t.InsidePolygon=0]="InsidePolygon",t[t.PolygonCenter=1]="PolygonCenter",t[t.RandomlyInsidePolygon=2]="RandomlyInsidePolygon"}(Tfe||(Tfe={})),function(t){t[t.Tint=0]="Tint",t[t.Replace=1]="Replace",t[t.Multiply=2]="Multiply"}(Sfe||(Sfe={})),function(t){t[t.ClipAtBoundary=0]="ClipAtBoundary",t[t.RemoveIfCenterOutsideBoundary=1]="RemoveIfCenterOutsideBoundary",t[t.DoNotTouchBoundary=2]="DoNotTouchBoundary",t[t.DoNotClip=3]="DoNotClip"}(Cfe||(Cfe={})),function(t){t.NoConstraint="NoConstraint",t.WithMarkers="WithMarkers",t.WithFullGap="WithFullGap",t.WithHalfGap="WithHalfGap",t.Custom="Custom"}(dp||(dp={})),function(t){t.Fixed="Fixed",t.Random="Random",t.RandomFixedQuantity="RandomFixedQuantity"}(bR||(bR={})),function(t){t.LineMiddle="LineMiddle",t.LineBeginning="LineBeginning",t.LineEnd="LineEnd",t.SegmentMidpoint="SegmentMidpoint"}(Xw||(Xw={})),function(t){t.OnPolygon="OnPolygon",t.CenterOfMass="CenterOfMass",t.BoundingBoxCenter="BoundingBoxCenter"}(_C||(_C={})),function(t){t[t.Low=0]="Low",t[t.Medium=1]="Medium",t[t.High=2]="High"}(Efe||(Efe={})),function(t){t[t.MarkerCenter=0]="MarkerCenter",t[t.MarkerBounds=1]="MarkerBounds"}(Pfe||(Pfe={})),function(t){t[t.None=0]="None",t[t.PropUniform=1]="PropUniform",t[t.PropNonuniform=2]="PropNonuniform",t[t.DifUniform=3]="DifUniform",t[t.DifNonuniform=4]="DifNonuniform"}(Afe||(Afe={})),function(t){t.Tube="Tube",t.Strip="Strip",t.Wall="Wall"}(Mfe||(Mfe={})),function(t){t[t.Random=0]="Random",t[t.Increasing=1]="Increasing",t[t.Decreasing=2]="Decreasing",t[t.IncreasingThenDecreasing=3]="IncreasingThenDecreasing"}(Ofe||(Ofe={})),function(t){t[t.Relative=0]="Relative",t[t.Absolute=1]="Absolute"}(Rfe||(Rfe={})),function(t){t[t.Normal=0]="Normal",t[t.LowerCase=1]="LowerCase",t[t.Allcaps=2]="Allcaps"}($fe||($fe={})),function(t){t[t.LTR=0]="LTR",t[t.RTL=1]="RTL"}(M8||(M8={})),function(t){t.Draft="Draft",t.Picture="Picture",t.Text="Text"}(vC||(vC={})),function(t){t[t.Top=0]="Top",t[t.Center=1]="Center",t[t.Baseline=2]="Baseline",t[t.Bottom=3]="Bottom"}(Ife||(Ife={})),function(t){t[t.Right=0]="Right",t[t.Upright=1]="Upright"}(eJ||(eJ={})),function(t){t[t.Small=0]="Small",t[t.Medium=1]="Medium",t[t.Large=2]="Large"}(Lfe||(Lfe={})),function(t){t[t.Calm=0]="Calm",t[t.Rippled=1]="Rippled",t[t.Slight=2]="Slight",t[t.Moderate=3]="Moderate"}(Dfe||(Dfe={}));const K$=.03;let Py=class{constructor(e=0,r=!1){}isEmpty(e){if(!e.nextPoint())return!0;let r,i,n,s;for(r=e.x,i=e.y;e.nextPoint();r=i,i=s)if(n=e.x,s=e.y,n!==r||s!==i)return e.seekPathStart(),!1;return e.seekPathStart(),!0}normalize(e){const r=Math.sqrt(e[0]*e[0]+e[1]*e[1]);r!==0&&(e[0]/=r,e[1]/=r)}getLength(e,r,i,n){const s=i-e,o=n-r;return Math.sqrt(s*s+o*o)}getSegLength(e){const[[r,i],[n,s]]=e;return this.getLength(r,i,n,s)}getCoord2D(e,r,i,n,s){return[e+(i-e)*s,r+(n-r)*s]}getSegCoord2D(e,r){const[[i,n],[s,o]]=e;return this.getCoord2D(i,n,s,o,r)}getAngle(e,r,i,n,s){const o=i-e,a=n-r;return Math.atan2(a,o)}getAngleCS(e,r,i,n,s){const o=i-e,a=n-r,l=Math.sqrt(o*o+a*a);return l>0?[o/l,a/l]:[1,0]}getSegAngleCS(e,r){const[[i,n],[s,o]]=e;return this.getAngleCS(i,n,s,o,r)}cut(e,r,i,n,s,o){return[s<=0?[e,r]:this.getCoord2D(e,r,i,n,s),o>=1?[i,n]:this.getCoord2D(e,r,i,n,o)]}getSubCurve(e,r,i){const n=zs.createEmptyOptimizedCIM("esriGeometryPolyline");return this.appendSubCurve(n,e,r,i)?n:null}appendSubCurve(e,r,i,n){e.startPath(),r.seekPathStart();let s=0,o=!0;if(!r.nextPoint())return!1;let a=r.x,l=r.y;for(;r.nextPoint();){const c=this.getLength(a,l,r.x,r.y);if(c!==0){if(o){if(s+c>i){const u=(i-s)/c;let h=1,p=!1;s+c>=n&&(h=(n-s)/c,p=!0);const f=this.cut(a,l,r.x,r.y,u,h);if(f&&e.pushPoints(f),p)break;o=!1}}else{if(s+c>n){const u=this.cut(a,l,r.x,r.y,0,(n-s)/c);u&&e.pushPoint(u[1]);break}e.pushXY(r.x,r.y)}s+=c,a=r.x,l=r.y}else a=r.x,l=r.y}return!0}getCIMPointAlong(e,r){if(!e.nextPoint())return null;let i,n,s,o,a=0;for(i=e.x,n=e.y;e.nextPoint();i=s,n=o){s=e.x,o=e.y;const l=this.getLength(i,n,s,o);if(l!==0){if(a+l>r){const c=(r-a)/l;return this.getCoord2D(i,n,s,o,c)}a+=l}}return null}offset(e,r,i,n,s){if(!e||e.length<2)return null;let o=0,a=e[o++],l=o;for(;o<e.length;){const p=e[o];p[0]===a[0]&&p[1]===a[1]||(o!==l&&(e[l]=e[o]),a=e[l++]),o++}const c=e[0][0]===e[l-1][0]&&e[0][1]===e[l-1][1];if(c&&--l,l<(c?3:2))return null;const u=[];a=c?e[l-1]:null;let h=e[0];for(let p=0;p<l;p++){const f=p===l-1?c?e[0]:null:e[p+1];if(a)if(f){const g=[f[0]-h[0],f[1]-h[1]];this.normalize(g);const _=[h[0]-a[0],h[1]-a[1]];this.normalize(_);const v=_[0]*g[1]-_[1]*g[0],b=_[0]*g[0]+_[1]*g[1];if(v===0&&b===1){h=f;continue}if(v>=0==r<=0){if(b<1){const w=[g[0]-_[0],g[1]-_[1]];this.normalize(w);const x=Math.sqrt((1+b)/2);if(x>1/n){const S=-Math.abs(r)/x;u.push([h[0]-w[0]*S,h[1]-w[1]*S])}}}else switch(i){case O0.Mitered:{const w=Math.sqrt((1+b)/2);if(w>0&&1/w<n){const x=[g[0]-_[0],g[1]-_[1]];this.normalize(x);const S=Math.abs(r)/w;u.push([h[0]-x[0]*S,h[1]-x[1]*S]);break}}case O0.Bevelled:u.push([h[0]+_[1]*r,h[1]-_[0]*r]),u.push([h[0]+g[1]*r,h[1]-g[0]*r]);break;case O0.Rounded:if(b<1){u.push([h[0]+_[1]*r,h[1]-_[0]*r]);const w=Math.floor(2.5*(1-b));if(w>0){const x=1/w;let S=x;for(let E=1;E<w;E++,S+=x){const A=[_[1]*(1-S)+g[1]*S,-_[0]*(1-S)-g[0]*S];this.normalize(A),u.push([h[0]+A[0]*r,h[1]+A[1]*r])}}u.push([h[0]+g[1]*r,h[1]-g[0]*r])}break;case O0.Square:default:if(v<0)u.push([h[0]+(_[1]+_[0])*r,h[1]+(_[1]-_[0])*r]),u.push([h[0]+(g[1]-g[0])*r,h[1]-(g[0]+g[1])*r]);else{const w=Math.sqrt((1+Math.abs(b))/2),x=[g[0]-_[0],g[1]-_[1]];this.normalize(x);const S=r/w;u.push([h[0]-x[0]*S,h[1]-x[1]*S])}}}else{const g=[h[0]-a[0],h[1]-a[1]];this.normalize(g),u.push([h[0]+g[1]*r,h[1]-g[0]*r])}else{const g=[f[0]-h[0],f[1]-h[1]];this.normalize(g),u.push([h[0]+g[1]*r,h[1]-g[0]*r])}a=h,h=f}return u.length<(c?3:2)?null:(c&&u.push([u[0][0],u[0][1]]),u)}};const fG=1.7320508075688772,Z0t=5,J0t=cE.OpenEnded;let HIe=class BM{static local(){return BM.instance===null&&(BM.instance=new BM),BM.instance}execute(e,r,i,n,s){return new Q0t(e,r,i)}};HIe.instance=null;let Q0t=class extends VU{constructor(e,r,i){super(e,!1,!0),this._curveHelper=new Py,this._width=(r.width!==void 0?r.width:Z0t)*i,this._arrowType=r.geometricEffectArrowType!==void 0?r.geometricEffectArrowType:r.arrowType!==void 0?r.arrowType:J0t,this._offsetFlattenError=K$*i}processPath(e){const r=zs.createEmptyOptimizedCIM(e.geometryType);switch(this._arrowType){case cE.OpenEnded:default:this._constructSimpleArrow(r,e,!0);break;case cE.Block:this._constructSimpleArrow(r,e,!1);break;case cE.Crossed:this._constructCrossedArrow(r,e)}return r}_constructSimpleArrow(e,r,i){const n=r.pathLength();let s=this._width;n<2*s&&(s=n/2);const o=this._curveHelper.getSubCurve(r,0,n-s);if(!o||!o.nextPath())return;o.seekPathStart();const a=s/2;if(this._curveHelper.isEmpty(o))return;const l=B1(o),c=this._constructOffset(l,-a);if(!c)return;const u=this._constructOffset(l,a);if(!u)return;const h=this._constructArrowBasePoint(c,-a/2);if(!h)return;const p=this._constructArrowBasePoint(u,a/2);if(!p)return;r.seekInPath(r.pathSize-1);const f=[r.x,r.y];e.pushPath(u),e.nextPath(),e.nextPoint(),e.setControlPoint(),e.pushPoint(p),e.nextPoint(),e.setControlPoint(),e.pushPoint(f),e.nextPoint(),e.setControlPoint(),e.pushPoint(h),e.nextPoint(),e.setControlPoint(),e.pushPoints(c.reverse()),e.setControlPoint(),i||(e.setControlPointAt(0),e.setControlPointAt(e.pathSize-1),e.pushPoint(u[0])),e.reset()}_constructCrossedArrow(e,r){const i=r.pathLength();let n=this._width;i<n*(1+fG+1)&&(n=i/(1+fG+1)),r.seekPathStart();const s=this._curveHelper.getSubCurve(r,0,i-n*(1+fG));if(!s)return;s.nextPath();const o=n/2;if(this._curveHelper.isEmpty(s))return;const a=B1(s),l=this._constructOffset(a,o);if(!l)return;const c=this._constructOffset(a,-o);if(!c)return;const u=this._curveHelper.getSubCurve(r,0,i-n);if(!u||(u.nextPath(),this._curveHelper.isEmpty(u)))return;const h=B1(u),p=this._constructOffset(h,o);if(!p)return;const f=this._constructOffset(h,-o);if(!f)return;const g=p[p.length-1],_=this._constructArrowBasePoint(p,o/2);if(!_)return;const v=f[f.length-1],b=this._constructArrowBasePoint(f,-o/2);if(!b)return;r.seekInPath(r.pathSize-1);const w=[r.x,r.y];e.pushPath(l),e.nextPath(),e.nextPoint(),e.setControlPoint(),e.pushPoint(v),e.nextPoint(),e.setControlPoint(),e.pushPoint(b),e.nextPoint(),e.setControlPoint(),e.pushPoint(w),e.nextPoint(),e.setControlPoint(),e.pushPoint(_),e.nextPoint(),e.setControlPoint(),e.pushPoint(g),e.nextPoint(),e.setControlPoint(),e.pushPoints(c.reverse()),e.nextPoint(),e.setControlPoint(),e.reset()}_constructOffset(e,r){return this._curveHelper.offset(e,r,O0.Rounded,4,this._offsetFlattenError)}_constructArrowBasePoint(e,r){if(!e||e.length<2)return null;const i=e[e.length-2],n=e[e.length-1],s=[n[0]-i[0],n[1]-i[1]];return this._curveHelper.normalize(s),[n[0]+s[1]*r,n[1]-s[0]*r]}},WIe=class VM{static local(){return VM.instance===null&&(VM.instance=new VM),VM.instance}execute(e,r,i,n,s,o){return new K0t(e,r,i,n,s,o)}};WIe.instance=null;let K0t=class{constructor(e,r,i,n,s,o){this._inputGeometries=e,this._tileKey=n,this._geometryEngine=s,this._curveHelper=new Py,this._size=(r.size!==void 0?r.size:1)*i,this._maxInflateSize=o*i,this._offsetFlattenError=K$*i}next(){let e;for(;e=this._inputGeometries.next();){if(this._size===0)return e;if(e.geometryType==="esriGeometryEnvelope"){if(this._size>0){const s=zs.createEmptyOptimizedCIM(e.geometryType),o=n9(e)[0],a=this._curveHelper.offset(o,this._size,O0.Rounded,4,this._offsetFlattenError);if(a)return s.pushPath(a),s}else if(this._size<0){const s=e.asJSON();if(Math.min(s.xmax-s.xmin,s.ymax-s.ymin)+2*this._size>0)return zs.fromJSONCIM({xmin:s.xmin-this._size,xmax:s.xmax+this._size,ymin:s.ymin-this._size,ymax:s.ymax+this._size})}}const r=this._geometryEngine;if(r==null)return null;const i=this._tileKey?Gie(e,this._maxInflateSize):e;if(!i)continue;const n=r.buffer(lt.WebMercator,i.asJSON(),this._size,1);return n?zs.fromJSONCIM(n):null}return null}},qIe=class GM{static local(){return GM.instance===null&&(GM.instance=new GM),GM.instance}execute(e,r,i,n,s){return new eyt(e,r,i)}};qIe.instance=null;let eyt=class{constructor(e,r,i){this._defaultPointSize=20,this._inputGeometries=e,this._geomUnitsPerPoint=i,this._rule=r.rule??Fr.FullGeometry,this._defaultSize=this._defaultPointSize*i}next(){let e;for(;e=this._inputGeometries.next();){const r=this._processGeom(n9(e));if(r&&r.length)return zs.fromJSONCIM({paths:r})}return null}_clone(e){return[e[0],e[1]]}_mid(e,r){return[(e[0]+r[0])/2,(e[1]+r[1])/2]}_mix(e,r,i,n){return[e[0]*r+i[0]*n,e[1]*r+i[1]*n]}_add(e,r){return[e[0]+r[0],e[1]+r[1]]}_add2(e,r,i){return[e[0]+r,e[1]+i]}_sub(e,r){return[e[0]-r[0],e[1]-r[1]]}_dist(e,r){return Math.sqrt((e[0]-r[0])*(e[0]-r[0])+(e[1]-r[1])*(e[1]-r[1]))}_norm(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}_normalize(e,r=1){const i=r/this._norm(e);e[0]*=i,e[1]*=i}_leftPerpendicular(e){const r=-e[1],i=e[0];e[0]=r,e[1]=i}_leftPerp(e){return[-e[1],e[0]]}_rightPerpendicular(e){const r=e[1],i=-e[0];e[0]=r,e[1]=i}_rightPerp(e){return[e[1],-e[0]]}_dotProduct(e,r){return e[0]*r[0]+e[1]*r[1]}_crossProduct(e,r){return e[0]*r[1]-e[1]*r[0]}_rotateDirect(e,r,i){const n=e[0]*r-e[1]*i,s=e[0]*i+e[1]*r;e[0]=n,e[1]=s}_makeCtrlPt(e){const r=[e[0],e[1]];return pG(r,1),r}_addAngledTicks(e,r,i,n){const s=this._sub(i,r);this._normalize(s);const o=this._crossProduct(s,this._sub(n,r));let a;a=o>0?this._rightPerp(s):this._leftPerp(s);const l=Math.abs(o)/2,c=[];c.push([r[0]+(a[0]-s[0])*l,r[1]+(a[1]-s[1])*l]),c.push(r),c.push(i),c.push([i[0]+(a[0]+s[0])*l,i[1]+(a[1]+s[1])*l]),e.push(c)}_addBezier2(e,r,i,n,s){if(s--==0)return void e.push(n);const o=this._mid(r,i),a=this._mid(i,n),l=this._mid(o,a);this._addBezier2(e,r,o,l,s),this._addBezier2(e,l,a,n,s)}_addBezier3(e,r,i,n,s,o){if(o--==0)return void e.push(s);const a=this._mid(r,i),l=this._mid(i,n),c=this._mid(n,s),u=this._mid(a,l),h=this._mid(l,c),p=this._mid(u,h);this._addBezier3(e,r,a,u,p,o),this._addBezier3(e,p,h,c,s,o)}_add90DegArc(e,r,i,n,s){const o=s??this._crossProduct(this._sub(i,r),this._sub(n,r))>0,a=this._mid(r,i),l=this._sub(a,r);o?this._leftPerpendicular(l):this._rightPerpendicular(l),a[0]+=l[0],a[1]+=l[1],this._addBezier3(e,r,this._mix(r,.33333,a,.66667),this._mix(i,.33333,a,.66667),i,4)}_addArrow(e,r,i){const n=r[0],s=r[1],o=r[r.length-1],a=this._sub(n,s);this._normalize(a);const l=this._crossProduct(a,this._sub(o,s)),c=.5*l,u=this._leftPerp(a),h=[o[0]-u[0]*l,o[1]-u[1]*l],p=r.length-1,f=[];f.push(i?[-u[0],-u[1]]:u);let g=[-a[0],-a[1]];for(let _=1;_<p-1;_++){const v=this._sub(r[_+1],r[_]);this._normalize(v);const b=this._dotProduct(v,g),w=this._crossProduct(v,g),x=Math.sqrt((1+b)/2),S=this._sub(v,g);this._normalize(S),S[0]/=x,S[1]/=x,f.push(w<0?[-S[0],-S[1]]:S),g=v}f.push(this._rightPerp(g));for(let _=f.length-1;_>0;_--)e.push([r[_][0]+f[_][0]*c,r[_][1]+f[_][1]*c]);e.push([h[0]+f[0][0]*c,h[1]+f[0][1]*c]),e.push([h[0]+f[0][0]*l,h[1]+f[0][1]*l]),e.push(n),e.push([h[0]-f[0][0]*l,h[1]-f[0][1]*l]),e.push([h[0]-f[0][0]*c,h[1]-f[0][1]*c]);for(let _=1;_<f.length;_++)e.push([r[_][0]-f[_][0]*c,r[_][1]-f[_][1]*c])}_cp2(e,r,i){return e.length>=2?e[1]:this._add2(e[0],r*this._defaultSize,i*this._defaultSize)}_cp3(e,r,i,n){if(e.length>=3)return e[2];const s=this._mix(e[0],1-i,r,i),o=this._sub(r,e[0]);return this._normalize(o),this._rightPerpendicular(o),[s[0]+o[0]*n*this._defaultSize,s[1]+o[1]*n*this._defaultSize]}_arrowPath(e){if(e.length>2)return e;const r=e[0],i=this._cp2(e,-4,0),n=this._sub(r,i);this._normalize(n);const s=this._rightPerp(n);return[r,i,[r[0]+(s[0]-n[0])*this._defaultSize,r[1]+(s[1]-n[1])*this._defaultSize]]}_arrowLastSeg(e){const r=e[0],i=this._cp2(e,-4,0);let n;if(e.length>=3)n=e[e.length-1];else{const s=this._sub(r,i);this._normalize(s);const o=this._rightPerp(s);n=[r[0]+(o[0]-s[0])*this._defaultSize,r[1]+(o[1]-s[1])*this._defaultSize]}return[i,n]}_processGeom(e){if(!e)return null;const r=[];for(const i of e){if(!i||i.length===0)continue;const n=i.length;let s=i[0];switch(this._rule){case Fr.PerpendicularFromFirstSegment:{const o=this._cp2(i,0,-1),a=this._cp3(i,o,.5,4),l=[];l.push(a),l.push(this._mid(s,o)),r.push(l);break}case Fr.ReversedFirstSegment:{const o=this._cp2(i,0,-1);r.push([o,s]);break}case Fr.PerpendicularToSecondSegment:{const o=this._cp2(i,-4,1),a=this._cp3(i,o,.882353,-1.94),l=[];l.push(this._mid(o,a)),l.push(s),r.push(l);break}case Fr.SecondSegmentWithTicks:{const o=this._cp2(i,-4,1),a=this._cp3(i,o,.882353,-1.94),l=this._sub(a,o);let c;c=this._crossProduct(l,this._sub(s,o))>0?this._rightPerp(c):this._leftPerp(l);const u=[];u.push([o[0]+(c[0]-l[0])/3,o[1]+(c[1]-l[1])/3]),u.push(o),u.push(a),u.push([a[0]+(c[0]+l[0])/3,a[1]+(c[1]+l[1])/3]),r.push(u);break}case Fr.DoublePerpendicular:{const o=this._cp2(i,0,-1),a=this._cp3(i,o,.5,3),l=this._mid(s,o),c=this._sub(l,a);this._normalize(c);const u=this._crossProduct(c,this._sub(s,a));this._leftPerpendicular(c);const h=[];h.push(s),h.push([a[0]+c[0]*u,a[1]+c[1]*u]),r.push(h);const p=[];p.push([a[0]-c[0]*u,a[1]-c[1]*u]),p.push(o),r.push(p);break}case Fr.OppositeToFirstSegment:{const o=this._cp2(i,0,-1),a=this._cp3(i,o,.5,3),l=this._mid(s,o),c=this._sub(l,a);this._normalize(c);const u=this._crossProduct(c,this._sub(s,a));this._leftPerpendicular(c);const h=[];h.push([a[0]+c[0]*u,a[1]+c[1]*u]),h.push([a[0]-c[0]*u,a[1]-c[1]*u]),r.push(h);break}case Fr.TriplePerpendicular:{const o=this._cp2(i,0,-1),a=this._cp3(i,o,.5,4),l=this._mid(s,o),c=this._sub(l,a);this._normalize(c);const u=this._crossProduct(c,this._sub(s,a));this._leftPerpendicular(c);const h=[];h.push([a[0]+c[0]*u*.8,a[1]+c[1]*u*.8]),h.push([l[0]+.8*(s[0]-l[0]),l[1]+.8*(s[1]-l[1])]),r.push(h),r.push([a,l]);const p=[];p.push([a[0]-c[0]*u*.8,a[1]-c[1]*u*.8]),p.push([l[0]+.8*(o[0]-l[0]),l[1]+.8*(o[1]-l[1])]),r.push(p);break}case Fr.HalfCircleFirstSegment:{const o=this._cp2(i,0,-1),a=this._cp3(i,o,.5,4),l=this._mid(s,o);let c=this._sub(o,s);const u=Math.cos(Math.PI/18),h=Math.sin(Math.PI/18),p=Math.sqrt((1+u)/2),f=Math.sqrt((1-u)/2),g=[];let _;this._crossProduct(c,this._sub(a,s))>0?(g.push(s),c=this._sub(s,l),_=o):(g.push(o),c=this._sub(o,l),_=s),this._rotateDirect(c,p,f),c[0]/=p,c[1]/=p;for(let v=1;v<=18;v++)g.push(this._add(l,c)),this._rotateDirect(c,u,h);g.push(_),r.push(g);break}case Fr.HalfCircleSecondSegment:{const o=this._cp2(i,0,-1),a=this._cp3(i,o,1,-1);let l=this._sub(s,o);this._normalize(l);const c=this._crossProduct(l,this._sub(a,o))/2;this._leftPerpendicular(l);const u=[o[0]+l[0]*c,o[1]+l[1]*c];l=this._sub(o,u);const h=Math.cos(Math.PI/18);let p=Math.sin(Math.PI/18);c>0&&(p=-p);const f=[o];for(let g=1;g<=18;g++)this._rotateDirect(l,h,p),f.push(this._add(u,l));r.push(f);break}case Fr.HalfCircleExtended:{const o=this._cp2(i,0,-2),a=this._cp3(i,o,1,-1);let l;if(n>=4)l=i[3];else{const g=this._sub(s,o);l=this._add(a,g)}const c=this._dist(o,a)/2/.75,u=this._sub(o,s);this._normalize(u,c);const h=this._sub(a,l);this._normalize(h,c);const p=[l,a];r.push(p);const f=[this._clone(a)];this._addBezier3(f,a,this._add(a,h),this._add(o,u),o,4),f.push(s),r.push(f);break}case Fr.OpenCircle:{const o=this._cp2(i,-2,0),a=this._sub(o,s),l=Math.cos(Math.PI/18),c=-Math.sin(Math.PI/18),u=[o];for(let h=1;h<=33;h++)this._rotateDirect(a,l,c),u.push(this._add(s,a));r.push(u);break}case Fr.CoverageEdgesWithTicks:{const o=this._cp2(i,0,-1);let a,l;if(n>=3)a=i[2];else{const p=this._sub(o,s),f=this._leftPerp(p);a=[s[0]+f[0]-.25*p[0],s[1]+f[1]-.25*p[1]]}if(n>=4)l=i[3];else{const p=this._mid(s,o),f=this._sub(s,o);this._normalize(f),this._leftPerpendicular(f);const g=this._crossProduct(f,this._sub(a,p));this._rightPerpendicular(f),l=[a[0]+f[0]*g*2,a[1]+f[1]*g*2]}const c=this._sub(o,s);let u,h;u=this._crossProduct(c,this._sub(a,s))>0?this._rightPerp(c):this._leftPerp(c),h=[],h.push(a),h.push(s),h.push([s[0]+(u[0]-c[0])/3,s[1]+(u[1]-c[1])/3]),r.push(h),u=this._crossProduct(c,this._sub(l,o))>0?this._rightPerp(u):this._leftPerp(c),h=[],h.push([o[0]+(u[0]+c[0])/3,o[1]+(u[1]+c[1])/3]),h.push(o),h.push(l),r.push(h);break}case Fr.GapExtentWithDoubleTicks:{const o=this._cp2(i,0,2),a=this._cp3(i,o,0,1);let l;if(n>=4)l=i[3];else{const c=this._sub(o,s);l=this._add(a,c)}this._addAngledTicks(r,s,o,this._mid(a,l)),this._addAngledTicks(r,a,l,this._mid(s,o));break}case Fr.GapExtentMidline:{const o=this._cp2(i,2,0),a=this._cp3(i,o,0,1);let l;if(n>=4)l=i[3];else{const u=this._sub(o,s);l=this._add(a,u)}const c=[];c.push(this._mid(s,a)),c.push(this._mid(o,l)),r.push(c);break}case Fr.Chevron:{const o=this._cp2(i,-1,-1);let a;if(n>=3)a=i[2];else{const l=this._sub(o,s);this._leftPerpendicular(l),a=this._add(s,l)}r.push([o,this._makeCtrlPt(s),a]);break}case Fr.PerpendicularWithArc:{const o=this._cp2(i,0,-2),a=this._cp3(i,o,.5,-1);let l=this._sub(o,s);const c=this._norm(l);l[0]/=c,l[1]/=c;const u=this._crossProduct(l,this._sub(a,s));let h=this._dotProduct(l,this._sub(a,s));h<.05*c?h=.05*c:h>.95*c&&(h=.95*c);const p=[s[0]+l[0]*h,s[1]+l[1]*h];this._leftPerpendicular(l);let f=[];f.push([p[0]-l[0]*u,p[1]-l[1]*u]),f.push([p[0]+l[0]*u,p[1]+l[1]*u]),r.push(f);const g=[o[0]+l[0]*u,o[1]+l[1]*u];l=this._sub(o,g);const _=Math.cos(Math.PI/18);let v=Math.sin(Math.PI/18);u<0&&(v=-v),f=[s,o];for(let b=1;b<=9;b++)this._rotateDirect(l,_,v),f.push(this._add(g,l));r.push(f);break}case Fr.ClosedHalfCircle:{const o=this._cp2(i,2,0),a=this._mid(s,o),l=this._sub(o,a),c=Math.cos(Math.PI/18),u=Math.sin(Math.PI/18),h=[s,o];for(let p=1;p<=18;p++)this._rotateDirect(l,c,u),h.push(this._add(a,l));r.push(h);break}case Fr.TripleParallelExtended:{const o=this._cp2(i,0,-2),a=this._cp3(i,o,1,-2),l=this._mid(s,o),c=this._sub(a,o);this._normalize(c);const u=Math.abs(this._crossProduct(c,this._sub(l,o)))/2,h=this._dist(o,a),p=[o,s];p.push([s[0]+c[0]*h*.5,s[1]+c[1]*h*.5]),r.push(p);const f=[];f.push([l[0]-c[0]*u,l[1]-c[1]*u]),f.push([l[0]+c[0]*h*.375,l[1]+c[1]*h*.375]),pG(f[f.length-1],1),f.push([l[0]+c[0]*h*.75,l[1]+c[1]*h*.75]),r.push(f);const g=[o,a];r.push(g);break}case Fr.ParallelWithTicks:{const o=this._cp2(i,3,0),a=this._cp3(i,o,.5,-1),l=this._sub(a,o);this._normalize(l);const c=this._crossProduct(l,this._sub(a,s));this._leftPerpendicular(l),this._addAngledTicks(r,s,o,a),this._addAngledTicks(r,this._mix(s,1,l,c),this._mix(o,1,l,c),this._mid(s,o));break}case Fr.Parallel:{const o=this._cp2(i,3,0),a=this._cp3(i,o,.5,-1),l=this._sub(o,s);this._normalize(l);const c=this._leftPerp(l),u=this._crossProduct(l,this._sub(a,s));let h=[s,o];r.push(h),h=[],h.push([s[0]+c[0]*u,s[1]+c[1]*u]),h.push([o[0]+c[0]*u,o[1]+c[1]*u]),r.push(h);break}case Fr.PerpendicularToFirstSegment:{const o=this._cp2(i,3,0),a=this._cp3(i,o,.5,-1),l=this._mid(s,o),c=this._sub(o,s);this._normalize(c);const u=this._crossProduct(c,this._sub(a,s));this._leftPerpendicular(c);const h=[];h.push([l[0]-c[0]*u*.25,l[1]-c[1]*u*.25]),h.push([l[0]+c[0]*u*1.25,l[1]+c[1]*u*1.25]),r.push(h);break}case Fr.ParallelOffset:{const o=this._cp2(i,3,0),a=this._cp3(i,o,.5,-1),l=this._sub(o,s);this._normalize(l);const c=this._crossProduct(l,this._sub(a,s));this._leftPerpendicular(l);const u=[];u.push([s[0]-l[0]*c,s[1]-l[1]*c]),u.push([o[0]-l[0]*c,o[1]-l[1]*c]),r.push(u);const h=[];h.push([s[0]+l[0]*c,s[1]+l[1]*c]),h.push([o[0]+l[0]*c,o[1]+l[1]*c]),r.push(h);break}case Fr.OffsetOpposite:{const o=this._cp2(i,3,0),a=this._cp3(i,o,.5,-1),l=this._sub(o,s);this._normalize(l);const c=this._crossProduct(l,this._sub(a,s));this._leftPerpendicular(l);const u=[];u.push([s[0]-l[0]*c,s[1]-l[1]*c]),u.push([o[0]-l[0]*c,o[1]-l[1]*c]),r.push(u);break}case Fr.OffsetSame:{const o=this._cp2(i,3,0),a=this._cp3(i,o,.5,-1),l=this._sub(o,s);this._normalize(l);const c=this._crossProduct(l,this._sub(a,s));this._leftPerpendicular(l);const u=[];u.push([s[0]+l[0]*c,s[1]+l[1]*c]),u.push([o[0]+l[0]*c,o[1]+l[1]*c]),r.push(u);break}case Fr.CircleWithArc:{let o=this._cp2(i,3,0);const a=this._cp3(i,o,.5,-1);let l,c;if(n>=4)l=i[3],c=this._crossProduct(this._sub(l,o),this._sub(a,o))>0;else{l=o,c=this._crossProduct(this._sub(l,s),this._sub(a,s))>0;const g=24*this._geomUnitsPerPoint,_=this._sub(l,s);this._normalize(_,g);const v=Math.sqrt(2)/2;this._rotateDirect(_,v,c?v:-v),o=this._add(s,_)}const u=this._sub(o,s),h=Math.cos(Math.PI/18),p=Math.sin(Math.PI/18),f=[o];for(let g=1;g<=36;g++)this._rotateDirect(u,h,p),f.push(this._add(s,u));this._add90DegArc(f,o,l,a,c),pG(f[f.length-8],1),r.push(f);break}case Fr.DoubleJog:{let o,a,l=this._cp2(i,-3,1);if(o=n>=3?i[2]:this._add(s,this._sub(s,l)),n>=4)a=i[3];else{const b=s;s=l,a=o;const w=this._dist(s,b),x=this._dist(a,b);let S=30*this._geomUnitsPerPoint;.5*w<S&&(S=.5*w),.5*x<S&&(S=.5*x),l=this._mix(s,S/w,b,(w-S)/w),o=this._mix(a,S/x,b,(x-S)/x)}const c=this._mid(s,l),u=this._mid(a,o),h=this._dist(s,l),p=this._dist(o,a);let f=Math.min(h,p)/8;f=Math.min(f,24*this._geomUnitsPerPoint);const g=Math.cos(Math.PI/4);let _=this._sub(s,l);this._normalize(_,f),this._crossProduct(_,this._sub(a,l))>0?this._rotateDirect(_,g,-g):this._rotateDirect(_,g,g);let v=[];v.push(l),v.push(this._add(c,_)),v.push(this._sub(c,_)),v.push(s),r.push(v),_=this._sub(a,o),this._normalize(_,f),this._crossProduct(_,this._sub(s,o))<0?this._rotateDirect(_,g,g):this._rotateDirect(_,g,-g),v=[],v.push(o),v.push(this._add(u,_)),v.push(this._sub(u,_)),v.push(a),r.push(v);break}case Fr.PerpendicularOffset:{const o=this._cp2(i,-4,1),a=this._cp3(i,o,.882353,-1.94),l=this._sub(a,o);this._crossProduct(l,this._sub(s,o))>0?this._rightPerpendicular(l):this._leftPerpendicular(l);const c=[l[0]/8,l[1]/8],u=this._sub(this._mid(o,a),c);r.push([u,s]);break}case Fr.LineExcludingLastSegment:{const o=this._arrowPath(i),a=[];let l=o.length-2;for(;l--;)a.push(o[l]);r.push(a);break}case Fr.MultivertexArrow:{const o=this._arrowPath(i),a=[];this._addArrow(a,o,!1),r.push(a);break}case Fr.CrossedArrow:{const o=this._arrowPath(i),a=[];this._addArrow(a,o,!0),r.push(a);break}case Fr.ChevronArrow:{const[o,a]=this._arrowLastSeg(i),l=10*this._geomUnitsPerPoint,c=this._sub(s,o);this._normalize(c);const u=this._crossProduct(c,this._sub(a,o)),h=this._leftPerp(c),p=[a[0]-h[0]*u*2,a[1]-h[1]*u*2],f=[];f.push([a[0]+c[0]*l,a[1]+c[1]*l]),f.push(s),f.push([p[0]+c[0]*l,p[1]+c[1]*l]),r.push(f);break}case Fr.ChevronArrowOffset:{const[o,a]=this._arrowLastSeg(i),l=this._sub(s,o);this._normalize(l);const c=this._crossProduct(l,this._sub(a,o));this._leftPerpendicular(l);const u=[a[0]-l[0]*c,a[1]-l[1]*c],h=[];h.push([u[0]+l[0]*c*.5,u[1]+l[1]*c*.5]),h.push(this._mid(u,s)),h.push([u[0]-l[0]*c*.5,u[1]-l[1]*c*.5]),r.push(h);break}case Fr.PartialFirstSegment:{const[o,a]=this._arrowLastSeg(i),l=this._sub(s,o);this._normalize(l);const c=this._crossProduct(l,this._sub(a,o));this._leftPerpendicular(l);const u=[a[0]-l[0]*c,a[1]-l[1]*c];r.push([o,u]);break}case Fr.Arch:{const o=this._cp2(i,0,-1),a=this._cp3(i,o,.5,1),l=this._sub(s,o),c=this._mix(a,1,l,.55),u=this._mix(a,1,l,-.55),h=[s];this._addBezier2(h,s,c,a,4),this._addBezier2(h,a,u,o,4),r.push(h);break}case Fr.CurvedParallelTicks:{const o=this._cp2(i,-4,1),a=this._cp3(i,o,.882353,-1.94),l=this._sub(a,o);this._crossProduct(l,this._sub(s,o))>0?this._rightPerpendicular(l):this._leftPerpendicular(l);const c=[l[0]/8,l[1]/8],u=this._sub(this._mid(o,a),c),h=this._sub(this._mix(o,.75,a,.25),c),p=this._sub(this._mix(o,.25,a,.75),c),f=[o];this._addBezier2(f,o,h,u,3),this._addBezier2(f,u,p,a,3),r.push(f);for(let g=0;g<8;g++){const _=f[2*g+1],v=[this._clone(_)];v.push(this._add(_,[l[0]/4,l[1]/4])),r.push(v)}break}case Fr.Arc90Degrees:{const o=this._cp2(i,0,-1),a=this._cp3(i,o,.5,1),l=[o];this._add90DegArc(l,o,s,a),r.push(l);break}case Fr.FullGeometry:default:r.push(i)}}return r}},YIe=class jM{static local(){return jM.instance===null&&(jM.instance=new jM),jM.instance}execute(e,r,i,n,s){return new tyt(e,r,i)}};YIe.instance=null;let tyt=class extends VU{constructor(e,r,i){super(e,!0,!0),this._curveHelper=new Py,this._beginCut=(r.beginCut!==void 0?r.beginCut:1)*i,this._endCut=(r.endCut!==void 0?r.endCut:1)*i,this._middleCut=(r.middleCut!==void 0?r.middleCut:0)*i,this._invert=r.invert!==void 0&&r.invert,this._beginCut<0&&(this._beginCut=0),this._endCut<0&&(this._endCut=0),this._middleCut<0&&(this._middleCut=0)}processPath(e){const{_beginCut:r,_endCut:i,_middleCut:n}=this,s=e.pathLength(),o=zs.createEmptyOptimizedCIM("esriGeometryPolyline");if(this._invert){if(r!==0||i!==0||n!==0)if(r+i+n>=s)for(o.startPath();e.nextPoint();)o.pushXY(e.x,e.y);else this._curveHelper.appendSubCurve(o,e,0,r),this._curveHelper.appendSubCurve(o,e,.5*(s-n),.5*(s+n)),this._curveHelper.appendSubCurve(o,e,s-i,i)}else if(r===0&&i===0&&n===0)for(o.startPath();e.nextPoint();)o.pushXY(e.x,e.y);else r+i+n<s&&(n===0?this._curveHelper.appendSubCurve(o,e,r,s-i):(this._curveHelper.appendSubCurve(o,e,r,.5*(s-n)),this._curveHelper.appendSubCurve(o,e,.5*(s+n),s-i)));return o.totalSize===0?null:o}};const Nfe=1e-7;let GU=class{constructor(){this._values=[],this.extPtGap=0,this.ctrlPtGap=0,this._length=0,this._currentValue=0}isEmpty(){return this._values.length===0}size(){return this._values.length}init(e,r,i=!0){if(this._setEmpty(),!e||e.length===0)return!1;for(let n=0;n<e.length;n++){let s=Math.abs(e[n]);i&&s<Nfe&&(s=Nfe),this._values.push(s),this._length+=s}return r&&1&e.length&&(this._length*=2),this._length!==0&&(this.ctrlPtGap=this.extPtGap=0,this._currentValue=-1,!0)}scale(e){const r=this._values?this._values.length:0;for(let i=0;i<r;++i)this._values[i]*=e;this._length*=e,this.extPtGap*=e,this.ctrlPtGap*=e}addValue(e){this._length+=e,this._values.push(e)}firstValue(){return this._values[0]}lastValue(){return this._values[this._values.length-1]}nextValue(){return this._currentValue++,this._currentValue===this._values.length&&(this._currentValue=0),this._values[this._currentValue]}reset(){this._currentValue=-1}length(){return this._length}_setEmpty(){this.extPtGap=this.ctrlPtGap=this._length=0,this._currentValue=-1,this._values.length=0}},g0=class{constructor(){this.pt=null,this.ca=0,this.sa=0}};var h1;(function(t){t[t.FAIL=0]="FAIL",t[t.END=1]="END",t[t.CONTINUE=2]="CONTINUE"})(h1||(h1={}));let zN=class{constructor(){this.reset()}reset(){this.segment=null,this.segmentLength=0,this.abscissa=0,this.isPathEnd=!1,this.isPartEnd=!1}isValid(){return this.segment!==null}copyTo(e){e.segment=this.segment,e.segmentLength=this.segmentLength,e.abscissa=this.abscissa,e.isPathEnd=this.isPathEnd,e.isPartEnd=this.isPartEnd}},jU=class extends Py{constructor(e=0,r=!1){super(e,r),this._tolerance=K$,this._currentPosition=new zN}updateTolerance(e){this._tolerance=K$*e}init(e,r,i=!0){return i?(this._patternLength=r.length(),this._partExtPtGap=r.extPtGap,this._partCtrlPtGap=r.ctrlPtGap):(this._patternLength=0,this._partExtPtGap=0,this._partCtrlPtGap=0),this._currentPosition.reset(),this._partSegCount=0,this._pathCursor=e,this._seg=-1,this._setPosAtNextPart()}curPositionIsValid(){return this._currentPosition.isValid()}nextPosition(e,r=h1.FAIL){const i=new zN;return!!this._nextPosition(e,i,null,r)&&(i.copyTo(this._currentPosition),!0)}curPointAndAngle(e){e.pt=this._getPoint(this._currentPosition);const[r,i]=this._getAngleCS(this._currentPosition);e.ca=r,e.sa=i}nextPointAndAngle(e,r,i=h1.FAIL){const n=new zN;if(!this._nextPosition(e,n,null,i))return!1;n.copyTo(this._currentPosition),r.pt=this._getPoint(n);const[s,o]=this._getAngleCS(n);return r.ca=s,r.sa=o,!0}nextCurve(e){if(e===0)return null;const r=zs.createEmptyOptimizedCIM("esriGeometryPolyline");r.startPath(),r.nextPath();const i=new zN;return this._nextPosition(e,i,r,h1.END)?(i.copyTo(this._currentPosition),r):null}isPathEnd(){return this._currentPosition.isPathEnd}getPathEnd(){return this._currentPosition.segment[1]}getPt(e){return this._pathCursor.seekInPath(e),[this._pathCursor.x,this._pathCursor.y]}getSeg(e){return[this.getPt(e),this.getPt(e+1)]}_nextPosition(e,r,i,n){if(this._currentPosition.isPathEnd)return!1;let s=this._currentPosition.abscissa;for(this._currentPosition.segmentLength>0&&(s/=this._currentPosition.segmentLength),this._currentPosition.copyTo(r);r.abscissa+e*this._partLengthRatio>r.segmentLength+this._tolerance;){if(i){if(i.pathSize===0)if(s===0){const a=r.segment[0];i.pushXY(a[0],a[1])}else i.pushPoint(this.getSegCoord2D(r.segment,s));const o=r.segment[1];i.pushXY(o[0],o[1])}if(s=0,e-=(r.segmentLength-r.abscissa)/this._partLengthRatio,this._partSegCount)r.segment=this._nextSegment(),r.segmentLength=this.getSegLength(r.segment),r.abscissa=0,this._partSegCount--;else{if(!this._setPosAtNextPart())return n!==h1.FAIL&&(r.segmentLength=this.getSegLength(r.segment),r.isPartEnd=!0,n===h1.END?(r.abscissa=r.segmentLength,r.isPathEnd=!0):r.abscissa=r.segmentLength+e,!0);this._currentPosition.copyTo(r)}}if(r.abscissa+=e*this._partLengthRatio,i){i.pathSize===0&&(s===0?i.pushPoint(r.segment[0]):i.pushPoint(this.getSegCoord2D(r.segment,s)));const o=r.abscissa/r.segmentLength;o===1?i.pushPoint(r.segment[1]):i.pushPoint(this.getSegCoord2D(r.segment,o))}return this._partSegCount||Math.abs(r.abscissa-r.segmentLength)<this._tolerance&&(r.isPathEnd=this._partIsLast,r.isPartEnd=!0),!0}_getPoint(e){const r=e.segmentLength<=0?0:e.abscissa/e.segmentLength;return this.getSegCoord2D(this._currentPosition.segment,r)}_getAngleCS(e){const r=e.segmentLength<=0?0:e.abscissa/e.segmentLength;return this.getSegAngleCS(this._currentPosition.segment,r)}_setPosAtNextPart(){for(;this._partSegCount;)this._hasNextSegment()&&this._nextSegment(),this._partSegCount--;if(!this._hasNextSegment())return!1;for(this._partLength=0,this._partIsLast=!0,this._partSegCount=0;this._hasNextSegment();)if(this._partLength+=this.getSegLength(this._nextSegment()),this._partSegCount++,this._pathCursor.getControlPointAt(this._getEndPointIndex())){this._partIsLast=!this._hasNextSegment();break}let e=this._partSegCount;for(;e;)this._previousSegment(),--e;this._currentPosition.segment=this._nextSegment(),this._currentPosition.segmentLength=this.getSegLength(this._currentPosition.segment),this._currentPosition.abscissa=0,this._currentPosition.isPathEnd=this._currentPosition.isPartEnd=!1,--this._partSegCount;const r=this._getStartPointIndex();this._ctrlPtBegin=this._pathCursor.getControlPointAt(r);let i=r+this._partSegCount+1;if(i>=this._pathCursor.pathSize&&(i=0),this._ctrlPtEnd=this._pathCursor.getControlPointAt(i),this._patternLength>0){const n=this._ctrlPtBegin?this._partCtrlPtGap:this._partExtPtGap,s=this._ctrlPtEnd?this._partCtrlPtGap:this._partExtPtGap;let o=Math.round((this._partLength-(n+s))/this._patternLength);o<=0&&(o=n+s>0?0:1),this._partLengthRatio=this._partLength/(n+s+o*this._patternLength),this._partLengthRatio<.01&&(this._partLengthRatio=1)}else this._partLengthRatio=1;return!0}_hasNextSegment(){return this._seg<this._pathCursor.pathSize-2}_previousSegment(){return this.getSeg(--this._seg)}_nextSegment(){return this.getSeg(++this._seg)}_getStartPointIndex(){return this._seg}_getEndPointIndex(){return this._seg+1}};const bC={CIMVectorMarker:{scalesymbolsproportionally:!1,respectframe:!0,anchorpointunits:"Relative",offsetX:0,offsetY:0,rotateclockwise:!1,rotation:0,size:10,enable:!0,colorlocked:!1},CIMPictureMarker:{scalex:1,texturefilter:"Draft",anchorpointunits:"Relative",offsetx:0,offsety:0,rotateclockwise:!1,rotation:0,size:10,enable:!0,colorlocked:!1},CIMTextSymbol:{angle:0,anglex:0,angley:0,halosize:1,height:10,horizontalalignment:"Left",kerning:!0,letterspacing:0,letterwidth:100,ligatures:!0,linegap:0,offsetx:0,offsety:0,strikethrough:!1,textcase:"Normal",textstring:"",underline:!1,verticalalignment:"Bottom",enable:!0,colorlocked:!1},CIMSolidStroke:{capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMPictureStroke:{texturefilter:"Draft",capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMGradientStroke:{capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMSolidFill:{enable:!0,colorocked:!1},CIMPictureFill:{offsetx:0,offsety:0,rotation:0,scalex:1,height:10,texturefilter:"Draft",enable:!0,colorlocked:!1},CIMHatchFill:{offsetx:0,offsety:0,rotation:0,separation:4,enable:!0,colorlocked:!1},CIMGeometricEffectAddControlPoints:{angletolerance:120},CIMGeometricEffectArrow:{arrowtype:"OpenEnded",width:5},CIMGeometricEffectBuffer:{size:1},CIMGeometricEffectCut:{begincut:1,endcut:1,middlecut:0,invert:!1},CIMGeometricEffectDashes:{customendingoffset:0,linedashending:"NoConstraint",offsetalongline:0},CIMGeometricEffectDonut:{method:"Mitered",option:"Accurate",width:2},CIMGeometricEffectJog:{angle:225,length:20,position:50},CIMGeometricEffectControlMeasureLine:{rule:"FullGeometry"},CIMGeometricEffectMove:{offsetx:1,offsety:-1},CIMGeometricEffectOffset:{method:"Square",offset:1,option:"Fast"},CIMGeometricEffectRotate:{angle:15},CIMGeometricEffectScale:{xscalefactor:1.15,yscalefactor:1.15},CIMGeometricEffectWave:{amplitude:2,period:3,seed:1,waveform:"Sinus"},CIMMarkerPlacementAlongLine:{customendingoffset:0,endings:"WithHalfGap",offsetalongline:0,placeperpart:!0,angletoline:!0,offset:0},CIMMarkerPlacementAtExtremities:{extremityplacement:"Both",offsetalongline:0,angletoline:!0,offset:0},CIMMarkerPlacementAtRatioPositions:{beginposition:0,endposition:0,flipfirst:!0,angletoline:!0,offset:0},CIMMarkerPlacementInsidePolygon:{gridangle:0,gridtype:"Fixed",offsetx:0,offsety:0,randomness:100,seed:0,shiftoddrows:!1,stepx:16,stepy:16,clipping:"ClipAtBoundary"},CIMMarkerPlacementOnLine:{relativeto:"LineMiddle",startpointoffset:0,angletoline:!0,offset:0},CIMMarkerPlacementOnVertices:{placeperpart:!0,placeoncontrolpoints:!0,placeonendpoints:!0,placeonregularvertices:!0,angletoline:!0,offset:0},CIMMarkerPlacementPolygonCenter:{method:"OnPolygon",offsetx:0,offsety:0,clipatboundary:!1},CIMAnimatedSymbolProperties:{playanimation:!1,reverseanimation:!1,randomizestarttime:!1,randomizestartseed:0,starttimeoffset:0,duration:3,endingduration:3,useendingduration:!1,repeattype:"Loop",repeatdelay:0}};function ryt(t){return typeof t=="function"}function iyt(t,e,r,i){return ryt(t)?t(e,r,i):t}const nyt=` /-,
`;function Ffe(t){let e=t.length;for(;e--;)if(!nyt.includes(t.charAt(e)))return!1;return!0}function syt(t,e){const r=[];let i=0,n=-1;do if(n=t.indexOf("[",i),n>=i){if(n>i){const s=t.substr(i,n-i);r.push([s,null,Ffe(s)])}if(i=n+1,n=t.indexOf("]",i),n>=i){if(n>i){const s=e[t.substr(i,n-i)];s&&r.push([null,s,!1])}i=n+1}}while(n!==-1);if(i<t.length-1){const s=t.substr(i);r.push([s,null,Ffe(s)])}return r}function oyt(t,e,r,i){let n="",s=null;for(const o of e){const[a,l,c]=o;if(a)c?s=a:(s&&(n+=s,s=null),n+=a);else{let u=l;r!=null&&(u=vyt(l,r));const h=t.attributes[u];h&&(s&&(n+=s,s=null),n+=h)}}return ayt(n,i)}function ayt(t,e){switch(typeof t!="string"&&(t=String(t)),e){case"LowerCase":return t.toLowerCase();case"Allcaps":return t.toUpperCase();default:return t}}function lyt(t){return t?[t[0],t[1],t[2],t[3]/255]:[0,0,0,0]}function cyt(t){var e;return((e=t.data)==null?void 0:e.symbol)??null}function uyt(t){return t.type==="CIMVectorMarker"||t.type==="CIMPictureMarker"||t.type==="CIMBarChartMarker"||t.type==="CIMCharacterMarker"||t.type==="CIMPieChartMarker"||t.type==="CIMStackedBarChartMarker"}function hyt(t){return t.type==="CIMGradientStroke"||t.type==="CIMPictureStroke"||t.type==="CIMSolidStroke"}function XIe(t){return t!=null&&(t.type==="CIMMarkerPlacementAlongLineRandomSize"||t.type==="CIMMarkerPlacementAlongLineSameSize"||t.type==="CIMMarkerPlacementAlongLineVariableSize"||t.type==="CIMMarkerPlacementAtExtremities"||t.type==="CIMMarkerPlacementAtMeasuredUnits"||t.type==="CIMMarkerPlacementAtRatioPositions"||t.type==="CIMMarkerPlacementOnLine"||t.type==="CIMMarkerPlacementOnVertices")}const wr=(t,e=0)=>t==null||isNaN(t)?e:t,dyt=t=>{if(!t)return!1;for(const e of t)switch(e.type){case"CIMGeometricEffectBuffer":case"CIMGeometricEffectOffset":case"CIMGeometricEffectDonut":return!0}return!1};function pyt(){return ge(()=>import("./geometryEngineJSON-DtHYPzsN.js").then(t=>t.g),__vite__mapDeps([26,27,28]))}function fyt(t){if(!t)return"normal";switch(t.toLowerCase()){case"italic":return"italic";case"oblique":return"oblique";default:return"normal"}}function myt(t){if(!t)return"normal";switch(t.toLowerCase()){case"bold":return"bold";case"bolder":return"bolder";case"lighter":return"lighter";default:return"normal"}}function ZIe(t){let e="normal",r="normal";if(t){const i=t.toLowerCase();i.includes("italic")?e="italic":i.includes("oblique")&&(e="oblique"),i.includes("bold")?r="bold":i.includes("light")&&(r="lighter")}return{style:e,weight:r}}function JIe(t){return t.underline?"underline":t.strikethrough?"line-through":"none"}function wR(t){if(!t)return null;switch(t.type){case"CIMPolygonSymbol":if(t.symbolLayers)for(const e of t.symbolLayers){const r=wR(e);if(r!=null)return r}break;case"CIMTextSymbol":return wR(t.symbol);case"CIMSolidFill":return t.color}return null}function tJ(t){if(t)switch(t.type){case"CIMPolygonSymbol":case"CIMLineSymbol":{const e=t.symbolLayers;if(e)for(const r of e){const i=tJ(r);if(i!=null)return i}break}case"CIMTextSymbol":return tJ(t.symbol);case"CIMSolidStroke":return t.color}}function rJ(t){if(t)switch(t.type){case"CIMPolygonSymbol":case"CIMLineSymbol":if(t.symbolLayers)for(const e of t.symbolLayers){const r=rJ(e);if(r!==void 0)return r}break;case"CIMTextSymbol":return rJ(t.symbol);case"CIMSolidStroke":case"CIMGradientStroke":case"CIMPictureStroke":return t.width}}function gyt(t){switch(t){case"Left":default:return"left";case"Right":return"right";case"Center":case"Justify":return"center"}}function yyt(t){switch(t){case"Top":default:return"top";case"Center":return"middle";case"Baseline":return"baseline";case"Bottom":return"bottom"}}function _yt(t){return(t?Object.keys(t):[]).map(e=>({name:e,alias:e,type:typeof t[e]=="string"?"esriFieldTypeString":"esriFieldTypeDouble"}))}const PT=t=>t.includes("data:image/svg+xml");function _jt(t){if(!t)return null;switch(t.type){case"CIMPointSymbol":case"CIMTextSymbol":return"esriGeometryPoint";case"CIMLineSymbol":return"esriGeometryPolyline";case"CIMPolygonSymbol":return"esriGeometryPolygon";default:return null}}function kfe(t){return t&&t.charAt(0).toLowerCase()+t.substring(1)}function vjt(t,e,r,i,n,s){const{infos:o}=s;let a=1,l=0,c=0,u=0;for(const{offsetX:f,offsetY:g,rotation:_,size:v,frameHeight:b,rotateClockWise:w}of o)c=Bfe(f,g,l,a,c),u=Ufe(f,g,l,a,u),b&&(a*=v/b),l=Vfe(_,w,l);const h=Bfe(i,n,l,a,c),p=Ufe(i,n,l,a,u);return{size:t*a,rotation:Vfe(e,r,l),offsetX:h,offsetY:p}}function QIe(t){return t!=null&&t.dashTemplate&&typeof t.dashTemplate=="string"&&(t.dashTemplate=t.dashTemplate.split(" ").map(Number)),t}function zfe(t){if(t==null)return"Normal";switch(t.type){case"CIMTextSymbol":return t.textCase??"Normal";case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":{const e=t.symbolLayers;if(!e)return"Normal";for(const r of e)if(r.type==="CIMVectorMarker")return zfe(r)}break;case"CIMVectorMarker":{const e=t.markerGraphics;if(!e)return"Normal";for(const r of e)if(r.symbol)return zfe(r.symbol)}}return"Normal"}function vyt(t,e){if(e!==null){const r=e.get(t);return r?r.name:t}return t}function Ufe(t,e,r,i,n){const s=r*Math.PI/180;if(s){const o=Math.cos(s);return(Math.sin(s)*t+o*e)*i+n}return e*i+n}function Bfe(t,e,r,i,n){const s=r*Math.PI/180;return s?(Math.cos(s)*t-Math.sin(s)*e)*i+n:t*i+n}function Vfe(t,e,r){return e?r-t:r+t}let KIe=class HM{static local(){return HM.instance===null&&(HM.instance=new HM),HM.instance}execute(e,r,i,n,s){return new byt(e,r,i)}};KIe.instance=null;let byt=class extends VU{constructor(e,r,i){super(e,!0,!0),this._firstCurve=null,this._walker=new jU,this._walker.updateTolerance(i),this._endings=r.lineDashEnding,this._customDashPos=-(r.offsetAlongLine??0)*i,this._offsetAtEnd=(r.customEndingOffset??0)*i,this._pattern=new GU,this._pattern.init(QIe(r).dashTemplate,!0),this._pattern.scale(i)}processPath(e){if(this._pattern.length()===0){this.iteratePath=!1;const n=B1(e);return zs.fromJSONCIM({paths:[n]})}if(!this.iteratePath){let n=!0;switch(this._endings){case xa.HalfPattern:case xa.HalfGap:default:this._pattern.extPtGap=0;break;case xa.FullPattern:this.isClosed||(this._pattern.extPtGap=.5*this._pattern.firstValue());break;case xa.FullGap:this.isClosed||(this._pattern.extPtGap=.5*this._pattern.lastValue());break;case xa.NoConstraint:this.isClosed||(n=!1);break;case xa.Custom:this.isClosed||(this._pattern.extPtGap=.5*this._offsetAtEnd)}const s=e.pathLength();if(this._pattern.isEmpty()||s<.1*this._pattern.length()){const o=B1(e);return zs.fromJSONCIM({paths:[o]})}if(!this._walker.init(e,this._pattern,n)){const o=B1(e);return zs.fromJSONCIM({paths:[o]})}}let r;if(this.iteratePath)r=this._pattern.nextValue();else{let n;switch(this._endings){case xa.HalfPattern:default:n=.5*this._pattern.firstValue();break;case xa.HalfGap:n=.5*-this._pattern.lastValue();break;case xa.FullGap:n=-this._pattern.lastValue();break;case xa.FullPattern:n=0;break;case xa.NoConstraint:case xa.Custom:n=-this._customDashPos}let s=n/this._pattern.length();s-=Math.floor(s),n=s*this._pattern.length(),this._pattern.reset(),r=this._pattern.nextValue();let o=!1;for(;n>=r;)n-=r,r=this._pattern.nextValue(),o=!o;r-=n,o?(this._walker.nextPosition(r),r=this._pattern.nextValue()):this.isClosed&&(this._firstCurve=this._walker.nextCurve(r),r=this._pattern.nextValue(),this._walker.nextPosition(r),r=this._pattern.nextValue())}let i=this._walker.nextCurve(r);if(i)if(this._walker.isPathEnd()){if(this.iteratePath=!1,this._firstCurve){for(this._firstCurve.nextPath();this._firstCurve.nextPoint();)i.pushXY(this._firstCurve.x,this._firstCurve.y);this._firstCurve=null}}else r=this._pattern.nextValue(),!this._walker.nextPosition(r)||this._walker.isPathEnd()?(this.iteratePath=!1,this._firstCurve&&(i.pushCursor(this._firstCurve),this._firstCurve=null)):this.iteratePath=!0;else this.iteratePath=!1,i=this._firstCurve,this._firstCurve=null;return i==null||i.reset(),i}},eLe=class WM{static local(){return WM.instance===null&&(WM.instance=new WM),WM.instance}execute(e,r,i,n,s,o){return new wyt(e,r,i,n,s,o)}};eLe.instance=null;let wyt=class{constructor(e,r,i,n,s,o){switch(this._inputGeometries=e,this._tileKey=n,this._geometryEngine=s,this._maxInflateSize=o*i,this._width=(r.width!==void 0?r.width:2)*i,r.method){case Yw.Mitered:case Yw.Bevelled:case Yw.Rounded:case Yw.TrueBuffer:case Yw.Square:}this._option=r.option}next(){let e;for(;e=this._inputGeometries.next();){if(e.geometryType==="esriGeometryEnvelope"&&this._width>0){const r=e.asJSON();return Math.min(r.xmax-r.xmin,r.ymax-r.ymin)-2*this._width<0?e:zs.fromJSONCIM({paths:[[[r.xmin+this._width,r.ymin+this._width],[r.xmax-this._width,r.ymin+this._width],[r.xmax-this._width,r.ymax-this._width],[r.xmin+this._width,r.ymax-this._width],[r.xmin+this._width,r.ymin+this._width]],[[r.xmin,r.ymin],[r.xmin,r.ymax],[r.xmax,r.ymax],[r.xmax,r.ymin],[r.xmin,r.ymin]]]})}if(e.geometryType==="esriGeometryPolygon"){if(this._width===0)return e.clone();const r=this._geometryEngine;if(r==null)return null;const i=this._tileKey?Gie(e,this._maxInflateSize):e.clone();if(!i)continue;const n=r.buffer(lt.WebMercator,i.asJSON(),-this._width,1);if(n){for(const s of n.rings)if(s){i.startPath();for(const o of s.reverse())i.pushXY(o[0],i.yFactor*o[1])}}return i}}return null}},tLe=class qM{static local(){return qM.instance===null&&(qM.instance=new qM),qM.instance}execute(e,r,i,n,s){return new xyt(e,r,i)}};tLe.instance=null;let xyt=class extends VU{constructor(e,r,i){super(e,!1,!0),this._curveHelper=new Py,this._length=(r.length!==void 0?r.length:20)*i,this._angle=r.angle!==void 0?r.angle:225,this._position=r.position!==void 0?r.position:50,this._length<0&&(this._length=-this._length),this._position<20&&(this._position=20),this._position>80&&(this._position=80),this._mirror=!1}processPath(e){const r=zs.createEmptyOptimizedCIM("esriGeometryPolyline");if(this._curveHelper.isEmpty(e))return null;e.seekInPath(0);const i=e.x,n=e.y;e.seekInPath(e.pathSize-1);const s=e.x,o=e.y,a=[s-i,o-n];this._curveHelper.normalize(a);const l=i+(s-i)*this._position/100,c=n+(o-n)*this._position/100,u=Math.cos((90-this._angle)/180*Math.PI);let h=Math.sin((90-this._angle)/180*Math.PI);this._mirror&&(h=-h),this._mirror=!this._mirror;const p=[l-this._length/2*u,c-this._length/2*h],f=[l+this._length/2*u,c+this._length/2*h];return r.pushPath([[i,n],p,f,[s,o]]),r}},rLe=class YM{static local(){return YM.instance===null&&(YM.instance=new YM),YM.instance}execute(e,r,i,n,s){return new Tyt(e,r,i)}};rLe.instance=null;let Tyt=class{constructor(e,r,i){this._inputGeometries=e,this._offsetX=r.offsetX!==void 0?r.offsetX*i:0,this._offsetY=r.offsetY!==void 0?r.offsetY*i:0}next(){let e=this._inputGeometries.next();for(;e;){if(e.totalSize>0)return this._move(e.clone(),this._offsetX,this._offsetY);e=this._inputGeometries.next()}return null}_move(e,r,i){for(;e.nextPath();)for(;e.nextPoint();)e.x=e.x+r,e.y=e.y+i;return e.reset(),e}};const Syt=10;let iLe=class XM{static local(){return XM.instance===null&&(XM.instance=new XM),XM.instance}execute(e,r,i,n,s,o){return new Cyt(e,r,i,n,s,o)}};iLe.instance=null;let Cyt=class{constructor(e,r,i,n,s,o){this._inputGeometries=e,this._tileKey=n,this._geometryEngine=s,this._curveHelper=new Py,this._offset=(r.offset??1)*i,this._method=r.method,this._maxInflateSize=Math.max(Math.abs(o*i),Syt),this._option=r.option,this._offsetFlattenError=K$*i}next(){let e;for(;e=this._inputGeometries.next();){if(this._offset===0)return e.clone();if(e.geometryType==="esriGeometryEnvelope"){if(this._method===O0.Rounded&&this._offset>0){const o=B1(e),a=this._curveHelper.offset(o,-this._offset,this._method,4,this._offsetFlattenError);if(a){const l=zs.createEmptyOptimizedCIM(e.geometryType);return l.pushPath(a),l}return null}const s=e.asJSON();if($p(s)&&Math.min(s.xmax-s.xmin,s.ymax-s.ymin)+2*this._offset>0)return zs.fromJSONCIM({xmin:s.xmin-this._offset,xmax:s.xmax+this._offset,ymin:s.ymin-this._offset,ymax:s.ymax+this._offset})}const r=this._geometryEngine;if(r==null)continue;const i=this._tileKey?Gie(e,this._maxInflateSize):e.clone();if(!i)continue;const n=r.offset(lt.WebMercator,i.asJSON(),-this._offset,1,this._method,4,this._offsetFlattenError);return n?zs.fromJSONCIM(n):null}return null}},nLe=class ZM{static local(){return ZM.instance===null&&(ZM.instance=new ZM),ZM.instance}execute(e,r,i,n,s){return new Eyt(e,r,i)}};nLe.instance=null;let Eyt=class{constructor(e,r,i){this._inputGeometries=e,this._reverse=r.reverse===void 0||r.reverse}next(){let e=this._inputGeometries.next();for(;e;){if(!this._reverse)return e;if(e.geometryType==="esriGeometryPolyline")return Pyt(e.clone());e=this._inputGeometries.next()}return null}};function Pyt(t){for(;t.nextPath();)for(let e=0;e<t.pathSize/2;e++){t.seekInPath(e);const r=t.x,i=t.y;t.seekInPath(t.pathSize-e-1);const n=t.x,s=t.y;t.x=r,t.y=i,t.seekInPath(e),t.x=n,t.y=s}return t.reset(),t}let sLe=class JM{static local(){return JM.instance===null&&(JM.instance=new JM),JM.instance}execute(e,r,i,n,s){return new Ayt(e,r,i)}};sLe.instance=null;let Ayt=class{constructor(e,r,i){this._inputGeometries=e,this._rotateAngle=r.angle!==void 0?r.angle*Math.PI/180:0}next(){let e=this._inputGeometries.next();for(;e;){if(this._rotateAngle===0||e.geometryType==="esriGeometryPoint")return e;if(e.totalSize>0){const r=u9(e),i=(r[2]+r[0])/2,n=(r[3]+r[1])/2;return e.reset(),this._rotate(e.clone(),i,n)}e=this._inputGeometries.next()}return null}_rotate(e,r,i){const n=Math.cos(this._rotateAngle),s=Math.sin(this._rotateAngle);for(;e.nextPath();)for(;e.nextPoint();){const o=e.x-r,a=e.y-i;e.x=r+o*n-a*s,e.y=i+o*s+a*n}return e.reset(),e}},oLe=class QM{static local(){return QM.instance===null&&(QM.instance=new QM),QM.instance}execute(e,r,i,n,s){return new Myt(e,r,i)}};oLe.instance=null;let Myt=class{constructor(e,r,i){this._inputGeometries=e,this._xFactor=r.XScaleFactor!==void 0?r.XScaleFactor:1.15,this._yFactor=r.YScaleFactor!==void 0?r.YScaleFactor:1.15}next(){const e=this._inputGeometries.next();if(e){if(this._xFactor===1&&this._yFactor===1||e.geometryType==="esriGeometryPoint")return e;if(e.totalSize>0){const r=u9(e),i=(r[2]+r[0])/2,n=(r[3]+r[1])/2;return e.reset(),this._scaleCursor(e.clone(),i,n)}}return null}_scaleCursor(e,r,i){for(;e.nextPath();)for(;e.nextPoint();)e.x=r+(e.x-r)*this._xFactor,e.y=i+(e.y-i)*this._yFactor;return e.reset(),e}},aLe=class KM{static local(){return KM.instance===null&&(KM.instance=new KM),KM.instance}execute(e,r,i,n,s){return new Oyt(e,r,i)}};aLe.instance=null;let Oyt=class{constructor(e,r,i){this._inputGeometries=e,this._height=(r.amplitude!==void 0?r.amplitude:2)*i,this._period=(r.period!==void 0?r.period:3)*i,this._style=r.waveform,this._height<=0&&(this._height=Math.abs(this._height)),this._period<=0&&(this._period=Math.abs(this._period)),this._pattern=new GU,this._pattern.addValue(this._period),this._pattern.addValue(this._period),this._walker=new jU,this._walker.updateTolerance(i)}next(){let e=this._inputGeometries.next();for(;e;){if(this._height===0||this._period===0)return e;const r=this._processGeom(e);if(r)return r;e=this._inputGeometries.next()}return null}_processGeom(e){const r=zs.createEmptyOptimizedCIM(e.geometryType);for(;e.nextPath();){r.startPath();const i=e.pathLength();if(this._walker.init(e,this._pattern))switch(this._style){case yC.Sinus:default:this._constructCurve(r,i,!1);break;case yC.Square:this._constructSquare(r,i);break;case yC.Triangle:this._constructTriangle(r,i);break;case yC.Random:this._constructCurve(r,i,!0)}else for(;e.nextPoint();)r.pushXY(e.x,e.y)}return r}_constructCurve(e,r,i){let n=Math.round(r/this._period);n===0&&(n=1);const s=n*16+1,o=r/n,a=this._period/16,l=1/s,c=2*Math.PI*r/o,u=2*Math.PI*Math.random(),h=2*Math.PI*Math.random(),p=2*Math.PI*Math.random(),f=.75-Math.random()/2,g=.75-Math.random()/2,_=new g0;this._walker.curPointAndAngle(_),e.pushPoint(_.pt);let v=0;for(;;){if(!this._walker.nextPointAndAngle(a,_)){e.pushPoint(this._walker.getPathEnd());break}{const b=v;let w;if(v+=l,i){const x=this._height/2*(1+.3*Math.sin(f*c*b+u));w=x*Math.sin(c*b+h),w+=x*Math.sin(g*c*b+p),w/=2}else w=.5*this._height*Math.sin(.5*c*b);e.pushXY(_.pt[0]-w*_.sa,_.pt[1]+w*_.ca)}}}_constructSquare(e,r){Math.round(r/this._period);let i=!0;for(;;){let n=!1;if(this._walker.curPositionIsValid()){const s=new g0;this._walker.curPointAndAngle(s);const o=new g0;if(this._walker.nextPointAndAngle(this._period,o)){const a=new g0;this._walker.nextPointAndAngle(this._period,a)&&(i?(e.pushPoint(s.pt),i=!1):e.pushPoint(s.pt),e.pushXY(s.pt[0]-this._height/2*s.sa,s.pt[1]+this._height/2*s.ca),e.pushXY(o.pt[0]-this._height/2*o.sa,o.pt[1]+this._height/2*o.ca),e.pushXY(o.pt[0]+this._height/2*o.sa,o.pt[1]-this._height/2*o.ca),e.pushXY(a.pt[0]+this._height/2*a.sa,a.pt[1]-this._height/2*a.ca),n=!0)}}if(!n){e.pushPoint(this._walker.getPathEnd());break}}}_constructTriangle(e,r){Math.round(r/this._period);let i=!0;for(;;){let n=!1;if(this._walker.curPositionIsValid()){const s=new g0;this._walker.curPointAndAngle(s);const o=new g0;if(this._walker.nextPointAndAngle(this._period/2,o)){const a=new g0;this._walker.nextPointAndAngle(this._period,a)&&(this._walker.nextPosition(this._period/2)&&(i?(e.pushPoint(s.pt),i=!1):e.pushPoint(s.pt),e.pushXY(o.pt[0]-this._height/2*o.sa,o.pt[1]+this._height/2*o.ca),e.pushXY(a.pt[0]+this._height/2*a.sa,a.pt[1]-this._height/2*a.ca)),n=!0)}}if(!n){e.pushPoint(this._walker.getPathEnd());break}}}},lLe=class eO{static local(){return eO.instance===null&&(eO.instance=new eO),eO.instance}execute(e,r,i,n,s){return new Ryt(e,r,i)}};lLe.instance=null;let Ryt=class extends uL{constructor(e,r,i){super(e),this._geometryWalker=new jU,this._geometryWalker.updateTolerance(i),this._angleToLine=r.angleToLine??!0,this._offset=(r.offset?r.offset:0)*i,this._originalEndings=r.endings,this._offsetAtEnd=(r.customEndingOffset?r.customEndingOffset:0)*i,this._position=-(r.offsetAlongLine?r.offsetAlongLine:0)*i,this._pattern=new GU,this._pattern.init(r.placementTemplate,!1),this._pattern.scale(i),this._endings=this._originalEndings}processPath(e){if(this._pattern.isEmpty())return null;let r;if(this.iteratePath)r=this._pattern.nextValue();else{this._originalEndings===dp.WithFullGap&&this.isClosed?this._endings=dp.WithMarkers:this._endings=this._originalEndings,this._pattern.extPtGap=0;let n,s=!0;switch(this._endings){case dp.NoConstraint:n=-this._position,n=this._adjustPosition(n),s=!1;break;case dp.WithHalfGap:default:n=-this._pattern.lastValue()/2;break;case dp.WithFullGap:n=-this._pattern.lastValue(),this._pattern.extPtGap=this._pattern.lastValue();break;case dp.WithMarkers:n=0;break;case dp.Custom:n=-this._position,n=this._adjustPosition(n),this._pattern.extPtGap=.5*this._offsetAtEnd}if(!this._geometryWalker.init(e,this._pattern,s))return null;this._pattern.reset();let o=0;for(;n>o;)n-=o,o=this._pattern.nextValue();o-=n,r=o,this.iteratePath=!0}const i=new g0;return this._geometryWalker.nextPointAndAngle(r,i)?this._endings===dp.WithFullGap&&this._geometryWalker.isPathEnd()?(this.iteratePath=!1,null):this._endings===dp.WithMarkers&&this._geometryWalker.isPathEnd()&&(this.iteratePath=!1,this.isClosed)?null:(this.internalPlacement.setTranslate(i.pt[0]-this._offset*i.sa,i.pt[1]+this._offset*i.ca),this._angleToLine&&this.internalPlacement.setRotateCS(i.ca,i.sa),this.internalPlacement):(this.iteratePath=!1,null)}_adjustPosition(e){let r=e/this._pattern.length();return r-=Math.floor(r),r*this._pattern.length()}},cLe=class tO{static local(){return tO.instance===null&&(tO.instance=new tO),tO.instance}execute(e,r,i,n,s){return new $yt(e,r,i)}};cLe.instance=null;let $yt=class extends uL{constructor(e,r,i){super(e,!1,!0),this._curveHelper=new Py,this._angleToLine=r.angleToLine===void 0||r.angleToLine,this._offset=r.offset!==void 0?r.offset*i:0,this._type=r.extremityPlacement,this._position=r.offsetAlongLine!==void 0?r.offsetAlongLine*i:0,this._beginProcessed=!1}processPath(e){let r;switch(this._type){case km.Both:default:this._beginProcessed?(r=this._atExtremities(e,this._position,!1),this._beginProcessed=!1,this.iteratePath=!1):(r=this._atExtremities(e,this._position,!0),this._beginProcessed=!0,this.iteratePath=!0);break;case km.JustBegin:r=this._atExtremities(e,this._position,!0);break;case km.JustEnd:r=this._atExtremities(e,this._position,!1);case km.None:}return r}_atExtremities(e,r,i){if(i||e.seekPathEnd(),i?e.nextPoint():e.prevPoint()){let n=0,[s,o]=[0,0],[a,l]=[e.x,e.y];for(;i?e.nextPoint():e.prevPoint();){s=a,o=l,a=e.x,l=e.y;const c=this._curveHelper.getLength(s,o,a,l);if(n+c>r){const u=(r-n)/c,[h,p]=this._curveHelper.getAngleCS(s,o,a,l,u),f=this._curveHelper.getCoord2D(s,o,a,l,u);return this.internalPlacement.setTranslate(f[0]-this._offset*p,f[1]+this._offset*h),this._angleToLine&&this.internalPlacement.setRotateCS(-h,-p),this.internalPlacement}n+=c}}return null}},uLe=class rO{static local(){return rO.instance===null&&(rO.instance=new rO),rO.instance}execute(e,r,i,n,s){return new Iyt(e,r,i)}};uLe.instance=null;let Iyt=class extends uL{constructor(e,r,i){super(e),this._walker=new jU,this._walker.updateTolerance(i),this._angleToLine=r.angleToLine===void 0||r.angleToLine,this._offset=r.offset!==void 0?r.offset*i:0,this._beginGap=r.beginPosition!==void 0?r.beginPosition*i:0,this._endGap=r.endPosition!==void 0?r.endPosition*i:0,this._flipFirst=r.flipFirst===void 0||r.flipFirst,this._pattern=new GU,this._pattern.init(r.positionArray,!1,!1),this._subPathLen=0,this._posCount=this._pattern.size(),this._isFirst=!0,this._prevPos=0}processPath(e){if(this._pattern.isEmpty())return null;let r;if(this.iteratePath){const a=this._pattern.nextValue()*this._subPathLen,l=this._beginGap+a;r=l-this._prevPos,this._prevPos=l}else{if(this._posCount=this._pattern.size(),this._isFirst=!0,this._prevPos=0,this._subPathLen=e.pathLength()-this._beginGap-this._endGap,this._subPathLen<0)return this.iteratePath=!1,null;if(!this._walker.init(e,this._pattern,!1))return null;this._pattern.reset();const a=this._pattern.nextValue()*this._subPathLen,l=this._beginGap+a;r=l-this._prevPos,this._prevPos=l,this.iteratePath=!0}const i=new g0;if(!this._walker.nextPointAndAngle(r,i,h1.END))return this.iteratePath=!1,null;this.internalPlacement.setTranslate(i.pt[0]-this._offset*i.sa,i.pt[1]+this._offset*i.ca);const n=this._isFirst&&this._flipFirst;let s,o;return this._angleToLine?(s=i.ca,o=i.sa):(s=1,o=0),n&&(s=-s,o=-o),this.internalPlacement.setRotateCS(s,o),this._isFirst=!1,this._posCount--,this._posCount===0&&(this.iteratePath=!1),this.internalPlacement}};const o_=512,Lyt=10,If=24,O8=1e-6;let hLe=class iO{static local(){return iO.instance===null&&(iO.instance=new iO),iO.instance}execute(e,r,i,n,s){return new Dyt(e,r,i,n,s)}};hLe.instance=null;let Dyt=class bw{constructor(e,r,i,n,s){if(this._xMin=0,this._xMax=0,this._yMin=0,this._yMax=0,this._currentX=0,this._currentY=0,this._accelerationMap=null,this._testInsidePolygon=!1,this._verticalSubdivision=!0,this._stepX=Math.abs(r.stepX??16)*i,this._stepY=Math.abs(r.stepY??16)*i,this._stepX=Math.round(128*this._stepX)/128,this._stepY=Math.round(128*this._stepY)/128,this._stepX!==0&&this._stepY!==0){if(this._gridType=r.gridType??bR.Fixed,this._gridType===bR.Random){const o=r.seed??13,a=1;this._randomLCG=new wx(o*a),this._randomness=(r.randomness??100)/100,this._gridAngle=0,this._shiftOddRows=!1,this._cosAngle=1,this._sinAngle=0,this._offsetX=0,this._offsetY=0,this._buildRandomValues()}else{if(this._randomness=0,this._gridAngle=r.gridAngle??0,this._shiftOddRows=r.shiftOddRows??!1,this._offsetX=(r.offsetX??0)*i,this._offsetY=(r.offsetY??0)*i,this._cosAngle=Math.cos(this._gridAngle/180*Math.PI),this._sinAngle=-Math.sin(this._gridAngle/180*Math.PI),this._stepX)if(this._offsetX<0)for(;this._offsetX<-.5*this._stepX;)this._offsetX+=this._stepX;else for(;this._offsetX>=.5*this._stepX;)this._offsetX-=this._stepX;if(this._stepY)if(this._offsetY<0)for(;this._offsetY<-.5*this._stepY;)this._offsetY+=this._stepY;else for(;this._offsetY>=.5*this._stepY;)this._offsetY-=this._stepY}if(this._graphicOriginX=0,this._graphicOriginY=0,n!=null){const[o,a,l,c]=n.split("/"),u=parseFloat(o),h=parseFloat(a),p=parseFloat(l),f=parseFloat(c);this._graphicOriginX=-(f*2**u+p)*o_,this._graphicOriginY=h*o_,this._testInsidePolygon=!0}this._internalPlacement=new rP,this._calculateMinMax(e),this._geometryCursor=e}}next(){return this._geometryCursor?this._nextInside():null}_buildRandomValues(){if(!bw._randValues){bw._randValues=[];for(let e=0;e<If;e++)for(let r=0;r<If;r++)bw._randValues.push(this._randomLCG.getFloat()),bw._randValues.push(this._randomLCG.getFloat())}}_calculateMinMax(e){let r,i,n,s,o,a,l,c,u,h,p,f,g,_;this._xMin=0,this._xMax=0,this._yMin=0,this._yMax=0,l=c=g=p=Number.MAX_VALUE,u=h=_=f=-Number.MAX_VALUE;const v=this._cosAngle!==1;for(e.reset();e.nextPath();)for(;e.nextPoint();)a=e.x,o=e.y,r=a-this._graphicOriginX-this._offsetX,i=o-this._graphicOriginY-this._offsetY,v?(n=this._cosAngle*r-this._sinAngle*i,s=this._sinAngle*r+this._cosAngle*i):(n=r,s=i),l=Math.min(l,n),u=Math.max(u,n),c=Math.min(c,s),h=Math.max(h,s),p=Math.min(p,o),f=Math.max(f,o),g=Math.min(g,a),_=Math.max(_,a);p=p!==Number.MAX_VALUE?p:-o_-this._stepY,f=f!==-Number.MAX_VALUE?f:this._stepY,g=g!==Number.MAX_VALUE?g:-this._stepX,_=_!==-Number.MAX_VALUE?_:o_+this._stepX;const b=f-p,w=_-g;if(this._verticalSubdivision=b>=w,this._polygonMin=this._verticalSubdivision?p:g,this._testInsidePolygon){let x=0-this._graphicOriginX-this._offsetX-this._stepX,S=o_-this._graphicOriginX-this._offsetX+this._stepX,E=-o_-this._graphicOriginY-this._offsetY-this._stepY,A=0-this._graphicOriginY-this._offsetY+this._stepY;if(v){const O=[[x,E],[x,A],[S,E],[S,A]];x=E=Number.MAX_VALUE,S=A=-Number.MAX_VALUE;for(const L of O){const z=this._cosAngle*L[0]-this._sinAngle*L[1],k=this._sinAngle*L[0]+this._cosAngle*L[1];x=Math.min(x,z),S=Math.max(S,z),E=Math.min(E,k),A=Math.max(A,k)}}l=l!==Number.MAX_VALUE?Math.max(l,x):x,c=c!==Number.MAX_VALUE?Math.max(c,E):E,u=u!==-Number.MAX_VALUE?Math.min(u,S):S,h=h!==-Number.MAX_VALUE?Math.min(h,A):A}this._xMin=Math.round(l/this._stepX),this._xMax=Math.round(u/this._stepX),this._yMin=Math.round(c/this._stepY),this._yMax=Math.round(h/this._stepY),this._currentX=this._xMax+1,this._currentY=this._yMin-1,this._buildAccelerationMap(e,g,_,p,f)}_buildAccelerationMap(e,r,i,n,s){e.reset();const o=new Map,a=this._verticalSubdivision,l=a?s-n:i-r;let c=Math.ceil(l/Lyt);if(c<=1)return;const u=Math.floor(l/c);let h,p,f,g,_,v,b,w,x,S,E;for(c++,this._delta=u,a?(x=-o_-2*this._stepY,S=2*this._stepY,E=n):(x=-2*this._stepX,S=o_+2*this._stepX,E=r);e.nextPath();)if(!(e.pathSize<2)&&e.nextPoint())for(h=e.x,p=e.y;e.nextPoint();h=f,p=g){if(f=e.x,g=e.y,a){if(p===g||p<x&&g<x||p>S&&g>S)continue;_=Math.min(p,g),v=Math.max(p,g)}else{if(h===f||h<x&&f<x||h>S&&f>S)continue;_=Math.min(h,f),v=Math.max(h,f)}for(;_<v;)b=Math.floor((_-E)/u),Gfe(b,h,p,f,g,o),_+=u;w=Math.floor((v-E)/u),w>b&&Gfe(w,h,p,f,g,o)}this._accelerationMap=o}_nextInside(){for(;;){if(this._currentX>this._xMax){if(this._currentY++,this._currentY>this._yMax)return null;this._currentX=this._xMin,this._shiftOddRows&&this._currentY%2&&this._currentX--}let e=this._currentX*this._stepX+this._offsetX;this._shiftOddRows&&this._currentY%2&&(e+=.5*this._stepX);const r=this._currentY*this._stepY+this._offsetY;let i,n;if(this._currentX++,this._gridType===bR.Random){const s=(this._currentX%If+If)%If,o=(this._currentY%If+If)%If;i=this._graphicOriginX+e+this._stepX*this._randomness*(.5-bw._randValues[o*If+s])*2/3,n=this._graphicOriginY+r+this._stepY*this._randomness*(.5-bw._randValues[o*If+s+1])*2/3}else i=this._graphicOriginX+this._cosAngle*e+this._sinAngle*r,n=this._graphicOriginY-this._sinAngle*e+this._cosAngle*r;if(!this._testInsidePolygon||this._isInsidePolygon(i,n,this._geometryCursor))return this._internalPlacement.setTranslate(i,n),this._internalPlacement}}_isInsidePolygon(e,r,i){if(this._accelerationMap==null)return Nyt(e,r,i);e+=O8,r+=O8;const n=this._verticalSubdivision,s=n?r:e,o=Math.floor((s-this._polygonMin)/this._delta),a=this._accelerationMap.get(o);if(!a)return!1;let l,c,u,h=0;for(const p of a){if(l=p[0],c=p[1],n){if(l[1]>r==c[1]>r)continue;u=(c[0]-l[0])*(r-l[1])-(c[1]-l[1])*(e-l[0])}else{if(l[0]>e==c[0]>e)continue;u=(c[1]-l[1])*(e-l[0])-(c[0]-l[0])*(r-l[1])}u>0?h++:h--}return h!==0}};function Nyt(t,e,r){let i,n,s,o,a=0;for(t+=O8,e+=O8,r.reset();r.nextPath();)if(r.nextPoint())for(i=r.x,n=r.y;r.nextPoint();i=s,n=o)s=r.x,o=r.y,n>e!=o>e&&((s-i)*(e-n)-(o-n)*(t-i)>0?a++:a--);return a!==0}function Gfe(t,e,r,i,n,s){let o=s.get(t);o||(o=[],s.set(t,o)),o.push([[e,r],[i,n]])}const Fyt=.001;let dLe=class nO{static local(){return nO.instance===null&&(nO.instance=new nO),nO.instance}execute(e,r,i,n,s){return new kyt(e,r,i)}};dLe.instance=null;let kyt=class extends uL{constructor(e,r,i){super(e),this._curveHelper=new Py,this._angleToLine=r.angleToLine===void 0||r.angleToLine,this._offset=r.offset!==void 0?r.offset*i:0,this._relativeTo=r.relativeTo,this._position=r.startPointOffset!==void 0?r.startPointOffset*i:0,this._epsilon=Fyt*i}processPath(e){const r=this._position;if(this._relativeTo===Xw.SegmentMidpoint){if(this.iteratePath||(this.iteratePath=!0),e.nextPoint()){let[n,s]=[e.x,e.y],[o,a]=[0,0];for(;e.nextPoint();){o=e.x,a=e.y;const l=this._curveHelper.getLength(n,s,o,a);if(l<this._epsilon){n=o,s=a;continue}const c=.5+this._position/l,[u,h]=this._curveHelper.getAngleCS(n,s,o,a,c),p=this._curveHelper.getCoord2D(n,s,o,a,c);return this.internalPlacement.setTranslate(p[0]-this._offset*h,p[1]+this._offset*u),this._angleToLine&&this.internalPlacement.setRotateCS(u,h),this.internalPlacement}}return this.iteratePath=!1,null}const i=this._relativeTo===Xw.LineEnd;return this.onLine(e,r,i)}onLine(e,r,i){let n,s=!1;switch(this._relativeTo){case Xw.LineMiddle:default:e.seekPathStart(),n=e.pathLength()/2+r;break;case Xw.LineBeginning:n=r;break;case Xw.LineEnd:n=r,s=!0}i?e.seekPathEnd():e.seekPathStart();let o=0;if(i?e.prevPoint():e.nextPoint()){let[a,l]=[e.x,e.y],[c,u]=[0,0];for(;i?e.prevPoint():e.nextPoint();){c=e.x,u=e.y;const h=this._curveHelper.getLength(a,l,c,u);if(o+h>n){const p=(n-o)/h,[f,g]=this._curveHelper.getAngleCS(a,l,c,u,p),_=this._curveHelper.getCoord2D(a,l,c,u,p),v=s?-this._offset:this._offset;return this.internalPlacement.setTranslate(_[0]-v*g,_[1]+v*f),this._angleToLine&&(s?this.internalPlacement.setRotateCS(-f,-g):this.internalPlacement.setRotateCS(f,g)),this.internalPlacement}a=c,l=u,o+=h}}return null}};const zyt=1e-15;let pLe=class sO{static local(){return sO.instance===null&&(sO.instance=new sO),sO.instance}execute(e,r,i,n,s){return new Uyt(e,r,i)}};pLe.instance=null;let Uyt=class extends uL{constructor(e,r,i){super(e),this._curveHelper=new Py,this._angleToLine=r.angleToLine===void 0||r.angleToLine,this._offset=r.offset!==void 0?r.offset*i:0,this._endPoints=r.placeOnEndPoints===void 0||r.placeOnEndPoints,this._controlPoints=r.placeOnControlPoints===void 0||r.placeOnControlPoints,this._regularVertices=r.placeOnRegularVertices===void 0||r.placeOnRegularVertices,this._tags=[],this._tagIterator=0}processPath(e){if(this.iteratePath||(this._preparePath(e),this.iteratePath=!0),this._tagIterator>=this._tags.length)return this._tags.length=0,this._tagIterator=0,this.iteratePath=!1,null;const r=this._tags[this._tagIterator];this._angleToLine&&this.internalPlacement.setRotate(r[2]);let i=r[0],n=r[1];if(this._offset!==0){const s=Math.cos(r[2]),o=Math.sin(r[2]);i-=this._offset*o,n+=this._offset*s}return this.internalPlacement.setTranslate(i,n),this._tagIterator++,this.internalPlacement}_preparePath(e){this._tags.length=0,this._tagIterator=0,e.seekPathStart();const r=e.isClosed();let i=0,n=!1,s=0,o=0;if(e.seekPathStart(),e.nextPoint()){let a=e.x,l=e.y,c=e.getControlPoint(),u=!0,h=e.nextPoint();for(;h;){const p=e.x,f=e.y,g=e.getControlPoint();(this._angleToLine||this._offset!==0)&&(s=this._curveHelper.getAngle(a,l,p,f,0)),u?(u=!1,r?(i=s,n=c):(this._endPoints||this._controlPoints&&c)&&this._tags.push([a,l,s])):c?this._controlPoints&&this._tags.push([a,l,UN(o,s)]):this._regularVertices&&this._tags.push([a,l,UN(o,s)]),(this._angleToLine||this._offset!==0)&&(o=this._curveHelper.getAngle(a,l,p,f,1)),h=e.nextPoint(),h||(r?g||n?this._controlPoints&&this._tags.push([p,f,UN(o,i)]):this._regularVertices&&this._tags.push([p,f,UN(o,i)]):(this._endPoints||this._controlPoints&&g)&&this._tags.push([p,f,o])),a=p,l=f,c=g}}this._tagIterator=0}};function UN(t,e){const r=Math.PI;for(;Math.abs(e-t)>r+2*zyt;)e-t>r?e-=2*r:e+=2*r;return(t+e)/2}const Byt=100*222045e-21;function Vyt(t){if(t.totalSize===0)return null;const e=u9(t);if(!e)return null;const r=4*(Math.abs(e[0])+Math.abs(e[2])+Math.abs(e[1])+Math.abs(e[3])+1)*Byt;let i=0,n=0;t.reset();for(let z=0;t.nextPath();z++){const k=t.getCurrentRingArea();k>n&&(n=k,i=z)}if(t.seekPath(i),t.pathSize===0)return null;t.seekPathStart();const s=u2e(t);if(Math.abs(n)<=2*r*r)return[(s[0]+s[2])/2,(s[1]+s[3])/2];t.seekPathStart();const o=EGe(t,Wt());if(o===null)return null;if(t.totalPoints<4)return o;const a=[[NaN,NaN],[NaN,NaN],[NaN,NaN],[NaN,NaN]],l=[NaN,NaN,NaN,NaN],c=[NaN,NaN,NaN,NaN];let u=!1,h=iA(o,t,!0);h.distance===0&&(u=!0,a[0][0]=o[0],a[0][1]=o[1],h=iA(o,t,!1)),l[0]=h.distance,c[0]=0;const p=[NaN,NaN];let f=!1,g=.25,_=-1,v=NaN;do if(v=NaN,a[1]=mG(t,gG(s[0],s[2],g),r,e),isNaN(a[1][0])||isNaN(a[1][1])||(h=iA(a[1],t,!1),v=h.distance),!isNaN(v)&&v>r&&xF(a[1],t))f=!0,l[1]=v,c[1]=ww(a[1],o);else if(!isNaN(v)&&v>_&&(_=v,p[0]=a[1][0],p[1]=a[1][1]),g-=.01,g<.1){if(!(_>=0))break;f=!0,l[1]=_,a[1][0]=p[0],a[1][1]=p[1],c[1]=ww(a[1],o)}while(!f);f=!1,g=.5,_=-1;let b=.01,w=1;do if(v=NaN,a[2]=mG(t,gG(s[0],s[2],g),r,e),isNaN(a[2][0])||isNaN(a[2][1])||(h=iA(a[2],t,!1),v=h.distance),!isNaN(v)&&v>r&&xF(a[2],t))f=!0,l[2]=v,c[2]=ww(a[2],o);else if(!isNaN(v)&&v>_)_=v,p[0]=a[2][0],p[1]=a[2][1];else if(v>_&&(_=v,p[0]=a[2][0],p[1]=a[2][1]),g=.5+b*w,b+=.01,w*=-1,g<.3||g>.7){if(!(_>=0))break;f=!0,l[2]=_,a[2][0]=p[0],a[2][1]=p[1],c[2]=ww(a[2],o)}while(!f);f=!1,g=.75,_=-1;do if(v=NaN,a[3]=mG(t,gG(s[0],s[2],g),r,e),isNaN(a[3][0])||isNaN(a[3][1])||(h=iA(a[3],t,!1),v=h.distance),!isNaN(v)&&v>r&&xF(a[3],t))f=!0,l[3]=v,c[3]=ww(a[3],o);else if(v>_&&(_=v,p[0]=a[3][0],p[1]=a[3][1]),g+=.01,g>.9){if(!(_>=0))break;f=!0,l[3]=_,a[3][0]=p[0],a[3][1]=p[1],c[3]=ww(a[3],o)}while(!f);const x=[0,1,2,3],S=u?0:1;let E;for(let z=S;z<4;z++)for(let k=S;k<3;k++){const q=c[k],B=c[k+1];Hyt(q,B)>0&&(E=x[k],x[k]=x[k+1],x[k+1]=E,c[k]=B,c[k+1]=q)}let A=S,O=0,L=0;for(let z=S;z<4;z++){switch(z){case 0:L=2*l[x[z]];break;case 1:L=1.66666666*l[x[z]];break;case 2:L=1.33333333*l[x[z]];break;case 3:L=l[x[z]]}L>O&&(O=L,A=x[z])}return a[A]}function xF(t,e){let r,i,n,s,o=0;for(e.reset();e.nextPath()&&e.nextPoint();)for(r=e.x,i=e.y;e.nextPoint();r=n,i=s)n=e.x,s=e.y,i>t[1]!=s>t[1]&&((n-r)*(t[1]-i)-(s-i)*(t[0]-r)>0?o++:o--);return o!==0}function iA(t,e,r){if(r&&xF(t,e))return{coord:t,distance:0};let i=1/0,n=0,s=0,o=[0,0],a=[0,0];const l=[0,0];for(e.reset();e.nextPath()&&e.nextPoint();)if(!(e.pathSize<2))for(o[0]=e.x,o[1]=e.y;e.nextPoint();o=a){a=[e.x,e.y],TGe(l,t,o,a);const c=ww(t,l);c<i&&(i=c,n=l[0],s=l[1])}return{coord:[n,s],distance:Math.sqrt(i)}}function mG(t,e,r,i){const n=[e,0];let s=1/0,o=1/0,a=!1,l=!1;const c=[[e,i[1]-1],[e,i[3]+1]],u=[0,0],h=[0,0],p=[0,0],f=[[0,0],[0,0]],g=Wt();for(t.reset();t.nextPath()&&t.nextPoint();)if(!(t.pathSize<2))for(f[0][0]=t.x,f[0][1]=t.y;t.nextPoint();f[0][0]=f[1][0],f[0][1]=f[1][1]){if(f[1][0]=t.x,f[1][1]=t.y,Gyt(g,f)===null||(h[0]=c[0][0],h[1]=c[0][1],p[0]=c[1][0],p[1]=c[1][1],jyt(g,h,p)===0)||!e6(c[0],c[1],f[0],f[1],u))continue;const _=u[1];s>o?_<s&&(s=_,a=!0):_<o&&(o=_,l=!0)}return a&&l?n[1]=(s+o)/2:n[0]=n[1]=NaN,n}function Gyt(t,e){if(e.length<2)return null;t||(t=Wt());const[r,i]=e[0],[n,s]=e[1];return t[0]=Math.min(r,n),t[1]=Math.min(i,s),t[2]=Math.max(r,n),t[3]=Math.max(i,s),t}const BN=1,VN=4,jfe=3,Hfe=12;function jyt(t,e,r){let i=Lf(e,t),n=Lf(r,t);const s=t[0],o=t[1],a=t[2],l=t[3];if(i&n)return 0;if(!(i|n))return 4;const c=(i?1:0)|(n?2:0);do{const u=r[0]-e[0],h=r[1]-e[1];if(u>h)i&jfe?(i&BN?(e[1]+=h*(s-e[0])/u,e[0]=s):(e[1]+=h*(a-e[0])/u,e[0]=a),i=Lf(e,t)):n&jfe?(n&BN?(r[1]+=h*(s-r[0])/u,r[0]=s):(r[1]+=h*(a-r[0])/u,r[0]=a),n=Lf(r,t)):i?(i&VN?(e[0]+=u*(o-e[1])/h,e[1]=o):(e[0]+=u*(l-e[1])/h,e[1]=l),i=Lf(e,t)):(n&VN?(r[0]+=u*(o-r[1])/h,r[1]=o):(r[0]+=u*(l-r[1])/h,r[1]=l),n=Lf(r,t));else if(i&Hfe?(i&VN?(e[0]+=u*(o-e[1])/h,e[1]=o):(e[0]+=u*(l-e[1])/h,e[1]=l),i=Lf(e,t)):n&Hfe?(n&VN?(r[0]+=u*(o-r[1])/h,r[1]=o):(r[0]+=u*(l-r[1])/h,r[1]=l),n=Lf(r,t)):i?(i&BN?(e[1]+=h*(s-e[0])/u,e[0]=s):(e[1]+=h*(a-e[0])/u,e[0]=a),i=Lf(e,t)):(n&BN?(r[1]+=h*(s-r[0])/u,r[0]=s):(r[1]+=h*(a-r[0])/u,r[0]=a),n=Lf(r,t)),i&n)return 0}while(i|n);return c}function Lf(t,e){return(t[0]<e[0]?1:0)|(t[0]>e[2]?1:0)<<1|(t[1]<e[1]?1:0)<<2|(t[1]>e[3]?1:0)<<3}function gG(t,e,r){return t+(e-t)*r}function ww(t,e){return(t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])}function Hyt(t,e){if(t<e)return-1;if(t>e)return 1;if(t===e)return 0;const r=isNaN(t),i=isNaN(e);return r<i?-1:r>i?1:0}let fLe=class oO{static local(){return oO.instance===null&&(oO.instance=new oO),oO.instance}execute(e,r,i,n,s){return new Wyt(e,r,i)}};fLe.instance=null;let Wyt=class{constructor(e,r,i){this._geometryCursor=e,this._offsetX=r.offsetX!==void 0?r.offsetX*i:0,this._offsetY=r.offsetY!==void 0?r.offsetY*i:0,this._method=r.method!==void 0?r.method:_C.OnPolygon,this._internalPlacement=new rP}next(){const e=this._geometryCursor;return this._geometryCursor=null,e?this._polygonCenter(e):null}_polygonCenter(e){let r=!1;switch(this._method){case _C.CenterOfMass:{const i=RGe(e);i&&(this._internalPlacement.setTranslate(i[0]+this._offsetX,i[1]+this._offsetY),r=!0)}break;case _C.BoundingBoxCenter:{const i=u9(e);i&&(this._internalPlacement.setTranslate((i[2]+i[0])/2+this._offsetX,(i[3]+i[1])/2+this._offsetY),r=!0)}break;case _C.OnPolygon:default:{const i=Vyt(e);i!==null&&(this._internalPlacement.setTranslate(i[0]+this._offsetX,i[1]+this._offsetY),r=!0)}}return r?this._internalPlacement:null}};function qyt(t){if(!t)return null;switch(t.type){case"CIMGeometricEffectAddControlPoints":return jIe.local();case"CIMGeometricEffectArrow":return HIe.local();case"CIMGeometricEffectBuffer":return WIe.local();case"CIMGeometricEffectControlMeasureLine":return qIe.local();case"CIMGeometricEffectCut":return YIe.local();case"CIMGeometricEffectDashes":return KIe.local();case"CIMGeometricEffectDonut":return eLe.local();case"CIMGeometricEffectJog":return tLe.local();case"CIMGeometricEffectMove":return rLe.local();case"CIMGeometricEffectOffset":return iLe.local();case"CIMGeometricEffectReverse":return nLe.local();case"CIMGeometricEffectRotate":return sLe.local();case"CIMGeometricEffectScale":return oLe.local();case"CIMGeometricEffectWave":return aLe.local()}return null}function Yyt(t){if(!t)return null;switch(t.type){case"CIMMarkerPlacementAlongLineSameSize":return lLe.local();case"CIMMarkerPlacementAtExtremities":return cLe.local();case"CIMMarkerPlacementAtRatioPositions":return uLe.local();case"CIMMarkerPlacementInsidePolygon":return hLe.local();case"CIMMarkerPlacementOnLine":return dLe.local();case"CIMMarkerPlacementOnVertices":return pLe.local();case"CIMMarkerPlacementPolygonCenter":return fLe.local()}return null}function yG(t){const e=t.getFrame(0);if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement)return e;const r=document.createElement("canvas");r.width=t.width,r.height=t.height;const i=r.getContext("2d");return e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0),r}let Xyt=class mLe{constructor(e=0,r=0,i=0,n=0){this.x=e,this.y=r,this.width=i,this.height=n}static fromExtent(e){return new mLe(e.xmin,-e.ymax,e.xmax-e.xmin,e.ymax-e.ymin)}get isEmpty(){return this.width<=0||this.height<=0}union(e){this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.width=Math.max(this.width,e.width),this.height=Math.max(this.height,e.height)}};function Zyt(t){return`rgb(${t.slice(0,3).toString()})`}function _G(t){return`rgba(${t.slice(0,3).toString()},${t[3]})`}let gLe=class{constructor(e){e&&(this._textRasterizationCanvas=e)}rasterizeText(e,r){var q,B;this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));const i=this._textRasterizationCanvas,n=i.getContext("2d",{willReadFrequently:!0});this._setFontProperties(n,r),this._parameters=r,this._textLines=e.split(/\r?\n/),this._lineHeight=this._computeLineHeight();const{decoration:s,weight:o}=r.font;this._lineThroughWidthOffset=s&&s==="line-through"?.1*this._lineHeight:0;const a=r.backgroundColor!=null||r.borderLine!=null,l=a?jet:0,c=this._computeTextWidth(n,r)+2*l,u=this._lineHeight*this._textLines.length+2*l;if(i.width=c+2*this._lineThroughWidthOffset,i.height=u,i.width===0||i.height===0)return i.width=i.height=1,{size:[0,0],image:new Uint32Array(0),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0,canvas:i};this._renderedLineHeight=Math.round(this._lineHeight*r.pixelRatio),this._renderedHaloSize=fs(r.halo.size)*r.pixelRatio,this._renderedWidth=c*r.pixelRatio,this._renderedHeight=u*r.pixelRatio,this._lineThroughWidthOffset*=r.pixelRatio;const h=r.color??[0,0,0,0],p=r.halo&&r.halo.color?r.halo.color:[0,0,0,0];this._fillStyle=_G(h),this._haloStyle=Zyt(p);const f=this._renderedLineHeight,g=this._renderedHaloSize;n.save(),n.clearRect(0,0,i.width,i.height),this._setFontProperties(n,r);const _=l*r.pixelRatio,v=Jyt(n.textAlign,this._renderedWidth-2*_)+g+_,b=g+_,w=g>0;let x=this._lineThroughWidthOffset,S=0;if(a){n.save();const J=r.backgroundColor??[0,0,0,0],W=((q=r.borderLine)==null?void 0:q.color)??[0,0,0,0],Y=2*fs(((B=r.borderLine)==null?void 0:B.size)??0);n.fillStyle=_G(J),n.strokeStyle=_G(W),n.lineWidth=Y,n.fillRect(0,0,i.width,i.height),n.strokeRect(0,0,i.width,i.height),n.restore()}w&&this._renderHalo(n,v,b,x,S,r),S+=b,x+=v;for(const J of this._textLines)w?(n.globalCompositeOperation="destination-out",n.fillStyle="rgb(0, 0, 0)",n.fillText(J,x,S),n.globalCompositeOperation="source-over",n.fillStyle=this._fillStyle,n.fillText(J,x,S)):(n.fillStyle=this._fillStyle,n.fillText(J,x,S)),s&&s!=="none"&&this._renderDecoration(n,x,S,s,o),S+=f;n.restore();const E=this._renderedWidth+2*this._lineThroughWidthOffset,A=this._renderedHeight,O=n.getImageData(0,0,E,A),L=new Uint8Array(O.data);if(r.premultiplyColors){let J;for(let W=0;W<L.length;W+=4)J=L[W+3]/255,L[W]=L[W]*J,L[W+1]=L[W+1]*J,L[W+2]=L[W+2]*J}let z,k;switch(r.horizontalAlignment){case"left":z=-.5;break;case"right":z=.5;break;default:z=0}switch(r.verticalAlignment){case"bottom":k=-.5;break;case"top":k=.5;break;case"baseline":k=-1/6;break;default:k=0}return{size:[E,A],image:new Uint32Array(L.buffer),sdf:!1,simplePattern:!1,anchorX:z,anchorY:k,canvas:i}}_renderHalo(e,r,i,n,s,o){const a=this._renderedWidth,l=this._renderedHeight;this._haloRasterizationCanvas||(this._haloRasterizationCanvas=document.createElement("canvas")),this._haloRasterizationCanvas.width=a,this._haloRasterizationCanvas.height=l;const c=this._haloRasterizationCanvas,u=c.getContext("2d");u.clearRect(0,0,a,l),this._setFontProperties(u,o);const{decoration:h,weight:p}=o.font;u.fillStyle=this._haloStyle,u.strokeStyle=this._haloStyle,u.lineJoin="round",this._renderHaloNative(u,r,i,h,p),e.globalAlpha=this._parameters.halo.color[3],e.drawImage(c,0,0,a,l,n,s,a,l),e.globalAlpha=1}_renderHaloNative(e,r,i,n,s){const o=this._renderedLineHeight,a=this._renderedHaloSize;for(const l of this._textLines){const c=2*a,u=5,h=.1;for(let p=0;p<u;p++){const f=(1-(u-1)*h+p*h)*c;e.lineWidth=f,e.strokeText(l,r,i),n&&n!=="none"&&this._renderDecoration(e,r,i,n,s,f)}i+=o}}_setFontProperties(e,r){const i=Math.max(r.size,.5),n=r.font,s=`${n.style} ${n.weight} ${fs(i*r.pixelRatio).toFixed(1)}px ${n.family}, sans-serif`;let o;switch(e.font=s,e.textBaseline="top",r.horizontalAlignment){case"left":default:o="left";break;case"right":o="right";break;case"center":o="center"}e.textAlign=o}computeTextSize(e,r){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));const i=this._textRasterizationCanvas,n=i.getContext("2d");this._setFontProperties(n,r),this._parameters=r,this._textLines=e.split(/\r?\n/),this._lineHeight=this._computeLineHeight();const s=this._computeTextWidth(n,r),o=this._lineHeight*this._textLines.length;return i.width=s,i.height=o,[s*r.pixelRatio,o*r.pixelRatio]}_computeTextWidth(e,r){let i=0;for(const s of this._textLines)i=Math.max(i,e.measureText(s).width);const n=r.font;return(n.style==="italic"||n.style==="oblique"||typeof n.weight=="string"&&(n.weight==="bold"||n.weight==="bolder")||typeof n.weight=="number"&&n.weight>600)&&(i+=.3*e.measureText("w").width),i+=2*fs(this._parameters.halo.size),Math.round(i)}_computeLineHeight(){let e=1.275*this._parameters.size;const r=this._parameters.font.decoration;return r&&r==="underline"&&(e*=1.3),Math.round(e+2*fs(this._parameters.halo.size))}_renderDecoration(e,r,i,n,s,o){const a=.9*this._lineHeight,l=s==="bold"?.06:s==="bolder"?.09:.04;switch(e.textAlign){case"center":r-=this._renderedWidth/2;break;case"right":r-=this._renderedWidth}const c=e.textBaseline;if(n==="underline")switch(c){case"top":i+=a;break;case"middle":i+=a/2}else if(n==="line-through")switch(c){case"top":i+=a/1.5;break;case"middle":i+=a/3}const u=o?1.5*o:Math.ceil(a*l);e.save(),e.beginPath(),e.strokeStyle=e.fillStyle,e.lineWidth=u,e.moveTo(r-this._lineThroughWidthOffset,i),e.lineTo(r+this._renderedWidth+2*this._lineThroughWidthOffset,i),e.stroke(),e.restore()}};function Jyt(t,e){return t==="center"?.5*e:t==="right"?e:0}const Njt=512,Fjt=128,kjt=511,zjt=29,Ujt=24;var Wfe;(function(t){t[t.FilterFlags=0]="FilterFlags",t[t.Animation=1]="Animation",t[t.GPGPU=2]="GPGPU",t[t.VV=3]="VV",t[t.DD0=4]="DD0",t[t.DD1=5]="DD1",t[t.DD2=6]="DD2"})(Wfe||(Wfe={}));const Bjt=1.05,Vjt=5,Gjt=6,jjt=1.15,Qyt=2,Hjt=128-2*Qyt,Wjt=10,Kyt=1024,qjt=256;function e_t(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function t_t(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function r_t(t,e,r,i,n,s,o){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t[4]=s,t[5]=o,t}function yLe(t,e){const r=e[0],i=e[1],n=e[2],s=e[3],o=e[4],a=e[5];let l=r*s-i*n;return l?(l=1/l,t[0]=s*l,t[1]=-i*l,t[2]=-n*l,t[3]=r*l,t[4]=(n*a-s*o)*l,t[5]=(i*o-r*a)*l,t):null}function i_t(t){return t[0]*t[3]-t[1]*t[2]}function _Le(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=r[0],u=r[1],h=r[2],p=r[3],f=r[4],g=r[5];return t[0]=i*c+s*u,t[1]=n*c+o*u,t[2]=i*h+s*p,t[3]=n*h+o*p,t[4]=i*f+s*g+a,t[5]=n*f+o*g+l,t}function jie(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=Math.sin(r),u=Math.cos(r);return t[0]=i*u+s*c,t[1]=n*u+o*c,t[2]=i*-c+s*u,t[3]=n*-c+o*u,t[4]=a,t[5]=l,t}function vLe(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=r[0],u=r[1];return t[0]=i*c,t[1]=n*c,t[2]=s*u,t[3]=o*u,t[4]=a,t[5]=l,t}function Hie(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=r[0],u=r[1];return t[0]=i,t[1]=n,t[2]=s,t[3]=o,t[4]=i*c+s*u+a,t[5]=n*c+o*u+l,t}function n_t(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=-r,t[3]=i,t[4]=0,t[5]=0,t}function s_t(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t}function Wie(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t}function o_t(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}function a_t(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+1)}function l_t(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t}function bLe(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t}function c_t(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t}function u_t(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t}function h_t(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function d_t(t,e){const r=t[0],i=t[1],n=t[2],s=t[3],o=t[4],a=t[5],l=e[0],c=e[1],u=e[2],h=e[3],p=e[4],f=e[5],g=Va();return Math.abs(r-l)<=g*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(i-c)<=g*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(n-u)<=g*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(s-h)<=g*Math.max(1,Math.abs(s),Math.abs(h))&&Math.abs(o-p)<=g*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(a-f)<=g*Math.max(1,Math.abs(a),Math.abs(f))}const p_t=_Le,f_t=bLe;Object.freeze(Object.defineProperty({__proto__:null,add:l_t,copy:e_t,determinant:i_t,equals:d_t,exactEquals:h_t,frob:a_t,fromRotation:n_t,fromScaling:s_t,fromTranslation:Wie,identity:t_t,invert:yLe,mul:p_t,multiply:_Le,multiplyScalar:c_t,multiplyScalarAndAdd:u_t,rotate:jie,scale:vLe,set:r_t,str:o_t,sub:f_t,subtract:bLe,translate:Hie},Symbol.toStringTag,{value:"Module"}));function wLe(){const t=new Float32Array(6);return t[0]=1,t[3]=1,t}function m_t(t){const e=new Float32Array(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function g_t(t,e,r,i,n,s){const o=new Float32Array(6);return o[0]=t,o[1]=e,o[2]=r,o[3]=i,o[4]=n,o[5]=s,o}function y_t(t,e){return new Float32Array(t,e,6)}function xLe(t,e,r,i){const n=e[i],s=e[i+1];t[i]=r[0]*n+r[2]*s+r[4],t[i+1]=r[1]*n+r[3]*s+r[5]}function __t(t,e,r,i=0,n=0,s=2){const o=n||e.length/s;for(let a=i;a<o;a++)xLe(t,e,r,a*s)}Object.freeze(Object.defineProperty({__proto__:null,clone:m_t,create:wLe,createView:y_t,fromValues:g_t,transform:xLe,transformMany:__t},Symbol.toStringTag,{value:"Module"}));const v_t=()=>re.getLogger("esri.views.2d.engine.webgl.alignmentUtils");var Mm,Dp;function Yjt(t){if(!t)return Mm.Center;switch(t){case"Left":case"left":return Mm.Left;case"Right":case"right":return Mm.Right;case"Justify":return v_t().warnOnce("Horizontal alignment 'justify' is not implemented. Falling back to 'center'."),Mm.Center;case"Center":case"center":return Mm.Center}}function Xjt(t){if(!t)return Dp.Center;switch(t){case"Top":case"top":return Dp.Top;case"Center":case"middle":return Dp.Center;case"Baseline":case"baseline":return Dp.Baseline;case"Bottom":case"bottom":return Dp.Bottom}}function Zjt(t){switch(t){case Mm.Right:case"right":return-1;case Mm.Center:case"center":return 0;case Mm.Left:case"left":return 1;default:return console.debug(`Found invalid horizontal alignment ${t}`),0}}function Jjt(t){switch(t){case Dp.Top:case"top":return 1;case Dp.Center:case"middle":return 0;case Dp.Bottom:case Dp.Baseline:case"baseline":case"bottom":return-1;default:return console.debug(`Found invalid vertical alignment ${t}`),0}}(function(t){t[t.Left=-1]="Left",t[t.Center=0]="Center",t[t.Right=1]="Right"})(Mm||(Mm={})),function(t){t[t.Top=1]="Top",t[t.Center=0]="Center",t[t.Bottom=-1]="Bottom",t[t.Baseline=2]="Baseline"}(Dp||(Dp={}));const _b=Math.PI/180,TLe=.5,b_t=()=>re.getLogger("esri.symbols.cim.CIMSymbolDrawHelper");let xw=class am{constructor(e){this._t=e}static createIdentity(){return new am([1,0,0,0,1,0])}clone(){const e=this._t;return new am(e.slice())}transform(e){const r=this._t;return[r[0]*e[0]+r[1]*e[1]+r[2],r[3]*e[0]+r[4]*e[1]+r[5]]}static createScale(e,r){return new am([e,0,0,0,r,0])}scale(e,r){const i=this._t;return i[0]*=e,i[1]*=e,i[2]*=e,i[3]*=r,i[4]*=r,i[5]*=r,this}scaleRatio(){return Math.sqrt(this._t[0]*this._t[0]+this._t[1]*this._t[1])}static createTranslate(e,r){return new am([0,0,e,0,0,r])}translate(e,r){const i=this._t;return i[2]+=e,i[5]+=r,this}static createRotate(e){const r=Math.cos(e),i=Math.sin(e);return new am([r,-i,0,i,r,0])}rotate(e){return am.multiply(this,am.createRotate(e),this)}angle(){const e=this._t[0],r=this._t[3],i=Math.sqrt(e*e+r*r);return[e/i,r/i]}static multiply(e,r,i){const n=e._t,s=r._t,o=n[0]*s[0]+n[3]*s[1],a=n[1]*s[0]+n[4]*s[1],l=n[2]*s[0]+n[5]*s[1]+s[2],c=n[0]*s[3]+n[3]*s[4],u=n[1]*s[3]+n[4]*s[4],h=n[2]*s[3]+n[5]*s[4]+s[5],p=i._t;return p[0]=o,p[1]=a,p[2]=l,p[3]=c,p[4]=u,p[5]=h,i}invert(){const e=this._t;let r=e[0]*e[4]-e[1]*e[3];if(r===0)return new am([0,0,0,0,0,0]);r=1/r;const i=(e[1]*e[5]-e[2]*e[4])*r,n=(e[2]*e[3]-e[0]*e[5])*r,s=e[4]*r,o=-e[1]*r,a=-e[3]*r,l=e[0]*r;return new am([s,o,i,a,l,n])}},SLe=class{constructor(e,r){this._resourceManager=e,this._transfos=[],this._sizeTransfos=[],this._geomUnitsPerPoint=1,this._placementPool=new ua(rP,void 0,void 0,100),this._earlyReturn=!1,this._mapRotation=0,this._transfos.push(r||xw.createIdentity()),this._sizeTransfos.push(r?r.scaleRatio():1)}setTransform(e,r){this._transfos=[e||xw.createIdentity()],this._sizeTransfos=[r||(e?e.scaleRatio():1)]}setGeomUnitsPerPoint(e){this._geomUnitsPerPoint=e}transformPt(e){return this._transfos[this._transfos.length-1].transform(e)}transformSize(e){return e*this._sizeTransfos[this._sizeTransfos.length-1]}reverseTransformPt(e){return this._transfos[this._transfos.length-1].invert().transform(e)}reverseTransformSize(e){return e/this._sizeTransfos[this._sizeTransfos.length-1]}reverseTransformScalar(e){return e/this._transfos[this._transfos.length-1].scaleRatio()}getTransformAngle(){return this._transfos[this._transfos.length-1].angle()}geomUnitsPerPoint(){return this.isEmbedded()?1:this._geomUnitsPerPoint}prevGeomUnitsPerPoint(){return this._transfos.length>2?1:this._geomUnitsPerPoint}isEmbedded(){return this._transfos.length>1}back(){return this._transfos[this._transfos.length-1]}push(e,r){const i=r?e.scaleRatio():1;xw.multiply(e,this.back(),e),this._transfos.push(e),this._sizeTransfos.push(this._sizeTransfos[this._sizeTransfos.length-1]*i)}pop(){this._transfos.splice(-1,1),this._sizeTransfos.splice(-1,1)}drawSymbol(e,r,i){if(e)switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":this.drawMultiLayerSymbol(e,r);break;case"CIMTextSymbol":this.drawTextSymbol(e,r,i)}}drawMultiLayerSymbol(e,r){if(!e||!r)return;const i=e.symbolLayers;if(!i)return;const n=e.effects;if(n&&n.length>0){const s=this.executeEffects(n,r);if(s){let o=s.next();for(;o;)this.drawSymbolLayers(i,o.asJSON()),o=s.next()}}else this.drawSymbolLayers(i,r)}executeEffects(e,r){const i=this._resourceManager.geometryEngine;let n=new q0t(zs.fromJSONCIM(r));for(const s of e){const o=qyt(s);o&&(n=o.execute(n,s,this.geomUnitsPerPoint(),null,i))}return n}drawSymbolLayers(e,r){let i=e.length;for(;i--;){const n=e[i];if(!n||n.enable===!1)continue;const s=n.effects;if(s&&s.length>0){const o=this.executeEffects(s,r);if(o){let a=null;for(;(a=o.next())&&(this.drawSymbolLayer(n,a.asJSON()),!this._earlyReturn););}}else this.drawSymbolLayer(n,r);if(this._earlyReturn)return}}drawSymbolLayer(e,r){switch(e.type){case"CIMSolidFill":this.drawSolidFill(r,e.color);break;case"CIMHatchFill":this.drawHatchFill(r,e);break;case"CIMPictureFill":this.drawPictureFill(r,e);break;case"CIMGradientFill":this.drawGradientFill(r,e);break;case"CIMSolidStroke":this.drawSolidStroke(r,e.color,e.width,e.capStyle,e.joinStyle,e.miterLimit);break;case"CIMPictureStroke":this.drawPictureStroke(r,e);break;case"CIMGradientStroke":this.drawGradientStroke(r,e);break;case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":this.drawMarkerLayer(e,r)}}drawHatchFill(e,r){const i=this._buildHatchPolyline(r,e,this.geomUnitsPerPoint());i&&(this.pushClipPath(e),this.drawMultiLayerSymbol(r.lineSymbol,i),this.popClipPath())}drawPictureFill(e,r){}drawGradientFill(e,r){}drawPictureStroke(e,r){}drawGradientStroke(e,r){}drawMarkerLayer(e,r){const i=e.markerPlacement;if(i){const n=Yyt(i);if(n){const s=i.type==="CIMMarkerPlacementInsidePolygon"||i.type==="CIMMarkerPlacementPolygonCenter"&&i.clipAtBoundary;s&&this.pushClipPath(r);const o=n.execute(zs.fromJSONCIM(r),i,this.geomUnitsPerPoint(),null,this._resourceManager.geometryEngine);if(o){let a=null;for(;(a=o.next())&&(this.drawMarker(e,a),!this._earlyReturn););}s&&this.popClipPath()}}else{const n=this._placementPool.acquire();if(zE(r))n.tx=r.x,n.ty=r.y,this.drawMarker(e,n);else if(zc(r)){const s=Kxe(r);s&&([n.tx,n.ty]=s,this.drawMarker(e,n))}else for(const s of r.points)if(n.tx=s[0],n.ty=s[1],this.drawMarker(e,n),this._earlyReturn)break;this._placementPool.release(n)}}drawMarker(e,r){switch(e.type){case"CIMCharacterMarker":case"CIMPictureMarker":this.drawPictureMarker(e,r);break;case"CIMVectorMarker":this.drawVectorMarker(e,r)}}drawPictureMarker(e,r){if(!e)return;const i=this._resourceManager.getResource(e.url),n=wr(e.size,bC.CIMPictureMarker.size);if(i==null||n<=0)return;const s=i.width,o=i.height;if(!s||!o)return;const a=s/o,l=wr(e.scaleX,1),c=xw.createIdentity(),u=e.anchorPoint;if(u){let v=u.x,b=u.y;e.anchorPointUnits!=="Absolute"&&(v*=n*a*l,b*=n),c.translate(-v,-b)}let h=wr(e.rotation);e.rotateClockwise&&(h=-h),this._mapRotation&&(h+=this._mapRotation),h&&c.rotate(h*_b);let p=wr(e.offsetX),f=wr(e.offsetY);if(p||f){if(this._mapRotation){const v=_b*this._mapRotation,b=Math.cos(v),w=Math.sin(v),x=p*w+f*b;p=p*b-f*w,f=x}c.translate(p,f)}const g=this.geomUnitsPerPoint();g!==1&&c.scale(g,g);const _=r.getAngle();_&&c.rotate(_),c.translate(r.tx,r.ty),this.push(c,!1),this.drawImage(e,n),this.pop()}drawVectorMarker(e,r){if(!e)return;const i=e.markerGraphics;if(!i)return;const n=wr(e.size,bC.CIMVectorMarker.size),s=e.frame,o=s?s.ymax-s.ymin:0,a=n&&o?n/o:1,l=xw.createIdentity();s&&l.translate(.5*-(s.xmax+s.xmin),.5*-(s.ymax+s.ymin));const c=e.anchorPoint;if(c){let _=c.x,v=c.y;e.anchorPointUnits!=="Absolute"?s&&(_*=s.xmax-s.xmin,v*=s.ymax-s.ymin):(_/=a,v/=a),l.translate(-_,-v)}a!==1&&l.scale(a,a);let u=wr(e.rotation);e.rotateClockwise&&(u=-u),this._mapRotation&&(u+=this._mapRotation),u&&l.rotate(u*_b);let h=wr(e.offsetX),p=wr(e.offsetY);if(h||p){if(this._mapRotation){const _=_b*this._mapRotation,v=Math.cos(_),b=Math.sin(_),w=h*b+p*v;h=h*v-p*b,p=w}l.translate(h,p)}const f=this.geomUnitsPerPoint();f!==1&&l.scale(f,f);const g=r.getAngle();g&&l.rotate(g),l.translate(r.tx,r.ty),this.push(l,e.scaleSymbolsProportionally);for(const _ of i){_!=null&&_.symbol&&_.geometry||b_t().error("Invalid marker graphic",_);let v=_.textString;if(typeof v=="number"&&(v=v.toString()),this.drawSymbol(_.symbol,_.geometry,v),this._earlyReturn)break}this.pop()}drawTextSymbol(e,r,i){if(!e||!zE(r)||wr(e.height,bC.CIMTextSymbol.height)<=0)return;const n=xw.createIdentity();let s=wr(e.angle);s=-s,s&&n.rotate(s*_b);const o=wr(e.offsetX),a=wr(e.offsetY);(o||a)&&n.translate(o,a);const l=this.geomUnitsPerPoint();l!==1&&n.scale(l,l),n.translate(r.x,r.y),this.push(n,!1),this.drawText(e,i),this.pop()}_buildHatchPolyline(e,r,i){let n=wr(e.separation,bC.CIMHatchFill.separation)*i,s=wr(e.rotation);if(n===0)return null;n<0&&(n=-n);let o=0;const a=.5*n;for(;o>a;)o-=n;for(;o<-a;)o+=n;const l=Wt();kGe(l,r),l[0]-=a,l[1]-=a,l[2]+=a,l[3]+=a;const c=[[l[0],l[1]],[l[0],l[3]],[l[2],l[3]],[l[2],l[1]]];for(;s>180;)s-=180;for(;s<0;)s+=180;const u=Math.cos(s*_b),h=Math.sin(s*_b),p=-n*h,f=n*u;let g,_,v,b;o=wr(e.offsetX)*i*h-wr(e.offsetY)*i*u,g=v=Number.MAX_VALUE,_=b=-Number.MAX_VALUE;for(const L of c){const z=L[0],k=L[1],q=u*z+h*k,B=-h*z+u*k;g=Math.min(g,q),v=Math.min(v,B),_=Math.max(_,q),b=Math.max(b,B)}v=Math.floor(v/n)*n;let w=u*g-h*v-p*o/n,x=h*g+u*v-f*o/n,S=u*_-h*v-p*o/n,E=h*_+u*v-f*o/n;const A=1+Math.round((b-v)/n),O=[];for(let L=0;L<A;L++)w+=p,x+=f,S+=p,E+=f,O.push([[w,x],[S,E]]);return{paths:O}}},w_t=class extends SLe{constructor(e,r){super(e,r),this.reset()}reset(){this._xmin=this._ymin=1/0,this._xmax=this._ymax=-1/0,this._clipCount=0}envelope(){return new Xyt(this._xmin,this._ymin,this._xmax-this._xmin,this._ymax-this._ymin)}bounds(){return o9(this._xmin,this._ymin,this._xmax,this._ymax)}drawSolidFill(e){if(e&&!(this._clipCount>0))if(zc(e))this._processPath(e.rings,0);else if(Ip(e))this._processPath(e.paths,0);else if($p(e)){const r=Zw(e);r&&this._processPath(r.rings,0)}else console.error("drawSolidFill Unexpected geometry type!")}drawSolidStroke(e,r,i){if(!e||this._clipCount>0||i==null||i<=0)return;const n=Math.max(.5*this.transformSize(wr(i,bC.CIMSolidStroke.width)),.5*TLe);if(zc(e))this._processPath(e.rings,n);else if(Ip(e))this._processPath(e.paths,n);else if($p(e)){const s=Zw(e);s&&this._processPath(s.rings,n)}else console.error("drawSolidStroke unexpected geometry type!")}drawMarkerLayer(e,r){zc(r)&&e.markerPlacement&&(e.markerPlacement.type==="CIMMarkerPlacementInsidePolygon"||e.markerPlacement.type==="CIMMarkerPlacementPolygonCenter"&&e.markerPlacement.clipAtBoundary)?this._processPath(r.rings,0):super.drawMarkerLayer(e,r)}drawHatchFill(e,r){this.drawSolidFill(e)}drawPictureFill(e,r){this.drawSolidFill(e)}drawGradientFill(e,r){this.drawSolidFill(e)}drawPictureStroke(e,r){this.drawSolidStroke(e,null,r.width)}drawGradientStroke(e,r){this.drawSolidStroke(e,null,r.width)}pushClipPath(e){this.drawSolidFill(e),this._clipCount++}popClipPath(){this._clipCount--}drawImage(e,r){const{url:i}=e,n=wr(e.scaleX,1);let s=n*r,o=r;const a=this._resourceManager.getResource(i);if(a!=null){const l=a.height/a.width;s=n*(r?l>1?r:r/l:a.width),o=r?l>1?r*l:r:a.height}this._merge(this.transformPt([-s/2,-o/2]),0),this._merge(this.transformPt([-s/2,o/2]),0),this._merge(this.transformPt([s/2,-o/2]),0),this._merge(this.transformPt([s/2,o/2]),0)}drawText(e,r){if(!r||r.length===0)return;this._textRasterizer||(this._textRasterizer=new gLe);const i=CLe(e);let[n,s]=this._textRasterizer.computeTextSize(r,i);n=xl(n),s=xl(s);let o=0;switch(e.horizontalAlignment){case"Left":o=n/2;break;case"Right":o=-n/2}let a=0;switch(e.verticalAlignment){case"Bottom":a=s/2;break;case"Top":a=-s/2;break;case"Baseline":a=s/6}this._merge(this.transformPt([-n/2+o,-s/2+a]),0),this._merge(this.transformPt([-n/2+o,s/2+a]),0),this._merge(this.transformPt([n/2+o,-s/2+a]),0),this._merge(this.transformPt([n/2+o,s/2+a]),0)}_processPath(e,r){if(e)for(const i of e){const n=i?i.length:0;if(n>1){this._merge(this.transformPt(i[0]),r);for(let s=1;s<n;s++)this._merge(this.transformPt(i[s]),r)}}}_merge(e,r){e[0]-r<this._xmin&&(this._xmin=e[0]-r),e[0]+r>this._xmax&&(this._xmax=e[0]+r),e[1]-r<this._ymin&&(this._ymin=e[1]-r),e[1]+r>this._ymax&&(this._ymax=e[1]+r)}},x_t=class extends SLe{constructor(e,r,i,n){super(r,i),this._applyAdditionalRenderProps=n,this._colorSubstitutionHelper=new Y0t,this._ctx=e}drawSolidFill(e,r){if(!e)return;if(zc(e))this._buildPath(e.rings,!0);else if(Ip(e))this._buildPath(e.paths,!0);else if($p(e))this._buildPath(Zw(e).rings,!0);else{if(!Cx(e))return;console.log("CanvasDrawHelper.drawSolidFill - No implementation!")}const i=this._ctx;i.fillStyle=typeof r=="string"?r:"rgba("+Math.round(r[0])+","+Math.round(r[1])+","+Math.round(r[2])+","+(r[3]??255)/255+")",i.fill("evenodd")}drawSolidStroke(e,r,i,n,s,o){if(!e||!r||i===0)return;if(zc(e))this._buildPath(e.rings,!0);else if(Ip(e))this._buildPath(e.paths,!1);else{if(!$p(e))return void console.log("CanvasDrawHelper.drawSolidStroke isn't implemented!");this._buildPath(Zw(e).rings,!0)}const a=this._ctx;a.strokeStyle=typeof r=="string"?r:"rgba("+Math.round(r[0])+","+Math.round(r[1])+","+Math.round(r[2])+","+(r[3]??255)/255+")",a.lineWidth=Math.max(this.transformSize(i),TLe),this._setCapStyle(n),this._setJoinStyle(s),a.miterLimit=o,a.stroke()}pushClipPath(e){if(this._ctx.save(),zc(e))this._buildPath(e.rings,!0);else if(Ip(e))this._buildPath(e.paths,!0);else{if(!$p(e))return;this._buildPath(Zw(e).rings,!0)}this._ctx.clip("evenodd")}popClipPath(){this._ctx.restore()}drawImage(e,r){const{colorSubstitutions:i,url:n,tintColor:s}=e,o=wr(e.scaleX,1),a=this._resourceManager.getResource(n);if(a==null)return;let l=r*(a.width/a.height),c=r;r||(l=a.width,c=a.height);const u=PT(n)||"src"in a&&PT(a.src);let h="getFrame"in a?yG(a):a;i&&(h=this._colorSubstitutionHelper.applyColorSubstituition(h,i)),this._applyAdditionalRenderProps&&!u&&s&&(h=this._colorSubstitutionHelper.tintImageData(h,s));const p=this.transformPt([0,0]),[f,g]=this.getTransformAngle(),_=this.transformSize(1),v=this._ctx;v.save(),v.setTransform({m11:o*_*f,m12:o*_*g,m21:-_*g,m22:_*f,m41:p[0],m42:p[1]}),v.drawImage(h,-l/2,-c/2,l,c),v.restore()}drawText(e,r){if(!r||r.length===0)return;this._textRasterizer||(this._textRasterizer=new gLe);const i=CLe(e);i.size*=this.transformSize(xl(1));const n=this._textRasterizer.rasterizeText(r,i);if(!n)return;const{size:s,anchorX:o,anchorY:a,canvas:l}=n,c=s[0]*(o+.5),u=s[1]*(a-.5),h=this._ctx,p=this.transformPt([0,0]),[f,g]=this.getTransformAngle(),_=1;h.save(),h.setTransform({m11:_*f,m12:_*g,m21:-_*g,m22:_*f,m41:p[0]-_*c,m42:p[1]+_*u}),h.drawImage(l,0,0),h.restore()}drawPictureFill(e,r){if(!e)return;let{colorSubstitutions:i,height:n,offsetX:s,offsetY:o,rotation:a,scaleX:l,tintColor:c,url:u}=r;const h=this._resourceManager.getResource(u);if(h==null)return;if(zc(e))this._buildPath(e.rings,!0);else if(Ip(e))this._buildPath(e.paths,!0);else if($p(e))this._buildPath(Zw(e).rings,!0);else{if(!Cx(e))return;console.log("CanvasDrawHelper.drawPictureFill - No implementation!")}const p=this._ctx,f=PT(u)||"src"in h&&PT(h.src);let g,_="getFrame"in h?yG(h):h;if(i&&(_=this._colorSubstitutionHelper.applyColorSubstituition(_,i)),this._applyAdditionalRenderProps){f||c&&(_=this._colorSubstitutionHelper.tintImageData(_,c)),g=p.createPattern(_,"repeat");const v=this.transformSize(1);a||(a=0),s?s*=v:s=0,o?o*=v:o=0,n&&(n*=v);const b=n?n/h.height:1,w=l&&n?l*n/h.width:1;if(a!==0||b!==1||w!==1||s!==0||o!==0){const x=new DOMMatrix;x.rotateSelf(0,0,-a).translateSelf(s,o).scaleSelf(w,b,1),g.setTransform(x)}}else g=p.createPattern(_,"repeat");p.save(),p.fillStyle=g,p.fill("evenodd"),p.restore()}drawPictureStroke(e,r){if(!e)return;let{colorSubstitutions:i,capStyle:n,joinStyle:s,miterLimit:o,tintColor:a,url:l,width:c}=r;const u=this._resourceManager.getResource(l);if(u==null)return;let h;if(zc(e))h=e.rings;else if(Ip(e))h=e.paths;else{if(!$p(e))return Cx(e)?void console.log("CanvasDrawHelper.drawPictureStroke - No implementation!"):void 0;h=Zw(e).rings}c||(c=u.width);const p=PT(l)||"src"in u&&PT(u.src);let f="getFrame"in u?yG(u):u;i&&(f=this._colorSubstitutionHelper.applyColorSubstituition(f,i)),this._applyAdditionalRenderProps&&(p||a&&(f=this._colorSubstitutionHelper.tintImageData(f,a)));const g=Math.max(this.transformSize(fs(c)),.5),_=g/f.width,v=this._ctx,b=v.createPattern(f,"repeat-y");let w,x;v.save(),this._setCapStyle(n),this._setJoinStyle(s),o!==void 0&&(v.miterLimit=o),v.lineWidth=g;for(let S of h)if(S=_e(S),C_t(S),S&&!(S.length<=1)){w=this.transformPt(S[0]);for(let E=1;E<S.length;E++){x=this.transformPt(S[E]);const A=T_t(w,x),O=new DOMMatrix;O.translateSelf(0,w[1]-g/2).scaleSelf(_,_,1).rotateSelf(0,0,90-A),b.setTransform(O),v.strokeStyle=b,v.beginPath(),v.moveTo(w[0],w[1]),v.lineTo(x[0],x[1]),v.stroke(),w=x}}v.restore()}_buildPath(e,r){const i=this._ctx;if(i.beginPath(),e)for(const n of e){const s=n?n.length:0;if(s>1){let o=this.transformPt(n[0]);i.moveTo(o[0],o[1]);for(let a=1;a<s;a++)o=this.transformPt(n[a]),i.lineTo(o[0],o[1]);r&&i.closePath()}}}_setCapStyle(e){switch(e){case td.Butt:this._ctx.lineCap="butt";break;case td.Round:this._ctx.lineCap="round";break;case td.Square:this._ctx.lineCap="square"}}_setJoinStyle(e){switch(e){case zm.Bevel:this._ctx.lineJoin="bevel";break;case zm.Round:this._ctx.lineJoin="round";break;case zm.Miter:this._ctx.lineJoin="miter"}}};function T_t(t,e){const r=e[0]-t[0],i=e[1]-t[1];return 180/Math.PI*Math.atan2(i,r)}const Zw=t=>t?{spatialReference:t.spatialReference,rings:[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]]}:null;function CLe(t,e=1){var b;const r=JIe(t),i=ZIe(t.fontStyleName),n=t.fontFamilyName??kIe,{weight:s,style:o}=i,a=e*(t.height||5),l=gyt(t.horizontalAlignment),c=yyt(t.verticalAlignment),u=wR(t),h=wR(t.haloSymbol),p=h!=null?e*(t.haloSize??0):0,f=((b=t.callout)==null?void 0:b.type)==="CIMBackgroundCallout"?t.callout.backgroundSymbol:null,g=wR(f),_=rJ(f),v=tJ(f);return{color:u,size:a,horizontalAlignment:l,verticalAlignment:c,font:{family:n,style:fyt(o),weight:myt(s),decoration:r},halo:{size:p||0,color:h,style:o},backgroundColor:g,borderLine:_!=null&&v!=null?{size:_,color:v}:null,pixelRatio:1,premultiplyColors:!0}}const S_t=1e-4;function C_t(t){let e,r,i,n,s,o=t[0],a=1;for(;a<t.length;)e=t[a][0]-o[0],r=t[a][1]-o[1],n=e!==0?r/e:Math.PI/2,i!==void 0&&n-i<=S_t?(t.splice(a-1,1),o=s):(s=o,o=t[a],a++),i=n}const ELe=[252,146,31,255],tHt=[153,153,153,255],E_t={type:"esriSMS",style:"esriSMSCircle",size:6,color:ELe,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},P_t={type:"esriSLS",style:"esriSLSSolid",width:.75,color:ELe},A_t={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},M_t={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},O_t={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},R_t={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},$_t={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null},rHt=j3.fromJSON(E_t),I_t=vy.fromJSON(P_t),iHt=VI.fromJSON(A_t),nHt=H3.fromJSON(M_t);j3.fromJSON(O_t);vy.fromJSON(R_t);VI.fromJSON($_t);const sHt=Number.POSITIVE_INFINITY,qie=Math.PI,oHt=2*qie,L_t=128/qie,D_t=256/360,aHt=qie/180,N_t=1/Math.LN2;function PLe(t,e){return(t%=e)>=0?t:t+e}function lHt(t){return PLe(t*L_t,256)}function cHt(t){return PLe(t*D_t,256)}function uHt(t){return Math.log(t)*N_t}function hHt(t,e,r){return t*(1-r)+e*r}const F_t=8,k_t=14,z_t=16;function dHt(t){return F_t+Math.max((t-k_t)*z_t,0)}function pHt(t,e,r){let i,n,s,o=0;for(const a of r){i=a.length;for(let l=1;l<i;++l)n=a[l-1],s=a[l],n.y>e!=s.y>e&&((s.x-n.x)*(e-n.y)-(s.y-n.y)*(t-n.x)>0?o++:o--)}return o!==0}function fHt(t,e,r,i){let n,s,o,a;const l=i*i;for(const c of r){const u=c.length;if(!(u<2)){n=c[0].x,s=c[0].y;for(let h=1;h<u;++h){if(o=c[h].x,a=c[h].y,SGe(t,e,n,s,o,a)<l)return!0;n=o,s=a}}}return!1}function U_t(t,e,r,i,n,s,o){const a=Math.max(i,Math.min(e,s))-e,l=Math.max(n,Math.min(r,o))-r;return a*a+l*l<=t*t}function mHt(t,e){if(e===0||Number.isNaN(e))return t;const r=[],i=new Ca(0,0),n=new Ca(0,0),s=new Ca(0,0);for(let o=0;o<t.length;o++){const a=t[o],l=[];for(let c=0;c<a.length;c++){const u=a[c-1],h=a[c],p=a[c+1];c===0?i.setCoords(0,0):i.assignSub(h,u).normalize().rightPerpendicular(),c===a.length-1?n.setCoords(0,0):n.assignSub(p,h).normalize().rightPerpendicular(),s.assignAdd(i,n).normalize();const f=s.x*n.x+s.y*n.y;f!==0&&s.scale(1/f),l.push(Ca.add(h,s.scale(e)))}r.push(l)}return r}function gHt(t,e,r,i){const n=new Ca(t[0],t[1]);if(n.scale(i),e==="viewport"){const s=-r*(Math.PI/180),o=Math.cos(s),a=Math.sin(s);n.rotate(o,a)}return n}const ALe=Math.PI,B_t=ALe/2,Df=96/72,qfe=4,R8=()=>re.getLogger("esri.symbols.cim.CIMSymbolHelper");function TF(t,e,r){switch(e.type){case"CIMSymbolReference":return TF(t,e.symbol,r);case"CIMPointSymbol":r==null&&(r={x:0,y:0}),t.drawSymbol(e,r);break;case"CIMLineSymbol":r==null&&(r={paths:[[[0,0],[10,0]]]}),t.drawSymbol(e,r);break;case"CIMPolygonSymbol":r==null&&(r={rings:[[[0,0],[0,10],[10,10],[10,0],[0,0]]]}),t.drawSymbol(e,r);break;case"CIMTextSymbol":{const i={x:0,y:0};t.drawSymbol(e,i);break}case"CIMVectorMarker":{const i=new rP;t.drawMarker(e,i);break}}return t.envelope()}function V_t(t){if(!t)return 0;switch(t.type){case"CIMGeometricEffectArrow":return Math.abs(.5*t.width);case"CIMGeometricEffectBuffer":return Math.abs(t.size);case"CIMGeometricEffectExtension":case"CIMGeometricEffectRadial":return Math.abs(t.length);case"CIMGeometricEffectJog":return Math.abs(.5*t.length);case"CIMGeometricEffectMove":return Math.max(Math.abs(wr(t.offsetX)),Math.abs(wr(t.offsetY)));case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":return Math.abs(t.offset);case"CIMGeometricEffectRegularPolygon":return Math.abs(t.radius);case"CIMGeometricEffectRotate":case"CIMGeometricEffectScale":default:return 0;case"CIMGeometricEffectTaperedPolygon":return .5*Math.max(Math.abs(t.fromWidth),Math.abs(t.toWidth));case"CIMGeometricEffectWave":return Math.abs(t.amplitude);case"CIMGeometricEffectDonut":return Math.abs(t.width)}}function yHt(t){if(!t)return 0;let e=0;for(const r of t)e+=V_t(r);return e}let vG=class SF{static getEnvelope(e,r,i){if(!e)return null;const n=new w_t(i);if(Array.isArray(e)){let s;for(const o of e)s?s.union(TF(n,o,r)):s=TF(n,o,r);return s}return TF(n,e,r)}static getTextureAnchor(e,r){const i=this.getEnvelope(e,null,r);if(!i)return[0,0,0];const n=(i.x+.5*i.width)*Df,s=(i.y+.5*i.height)*Df,o=i.width*Df+2,a=i.height*Df+2;return[-n/o,-s/a,a]}static rasterize(e,r,i,n,s=!0){const o=i||this.getEnvelope(r,null,n);if(!o)return[null,0,0,0,0];const a=(o.x+.5*o.width)*Df,l=(o.y+.5*o.height)*Df;e.width=o.width*Df,e.height=o.height*Df,i||(e.width+=2,e.height+=2);const c=e.getContext("2d",{willReadFrequently:!0}),u=xw.createScale(Df,-Df);u.translate(.5*e.width-a,.5*e.height+l);const h=new x_t(c,n,u);switch(r.type){case"CIMPointSymbol":{const g={type:"point",x:0,y:0};h.drawSymbol(r,g);break}case"CIMVectorMarker":{const g=new rP;h.drawMarker(r,g);break}}const p=c.getImageData(0,0,e.width,e.height),f=new Uint8Array(p.data);if(s){let g;for(let _=0;_<f.length;_+=4)g=f[_+3]/255,f[_]=f[_]*g,f[_+1]=f[_+1]*g,f[_+2]=f[_+2]*g}return[f,e.width,e.height,-a/e.width,-l/e.height]}static fromTextSymbol(e){const{text:r}=e;return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPointUnits:"Relative",dominantSizeAxis3D:"Y",size:10,billboardMode3D:"FaceNearPlane",frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{x:0,y:0},symbol:SF.createCIMTextSymbolfromTextSymbol(e),textString:r}],scaleSymbolsProportionally:!0,respectFrame:!0}],scaleX:1,angleAlignment:"Display"}}static fromPictureFillSymbol(e){const{height:r,outline:i,width:n,xoffset:s,xscale:o,yoffset:a,yscale:l}=e,c=[],u={type:"CIMPolygonSymbol",symbolLayers:c};if(i){const _=Yfe(i);_&&c.push(_)}let h=e.url;e.type==="esriPFS"&&e.imageData&&(h=e.imageData);const p="angle"in e?e.angle??0:0,f=(n??0)*(o||1),g=(r??0)*(l||1);return c.push({type:"CIMPictureFill",invertBackfaceTexture:!1,scaleX:1,textureFilter:vC.Picture,tintColor:null,url:h,height:g,width:f,offsetX:wr(s),offsetY:wr(a),rotation:wr(-p),colorSubstitutions:null}),u}static fromSimpleFillSymbol(e){const{color:r,style:i,outline:n}=e,s=[],o={type:"CIMPolygonSymbol",symbolLayers:s};if(n){const a=Yfe(n);a&&s.push(a)}if(i&&i!=="solid"&&i!=="none"&&i!=="esriSFSSolid"&&i!=="esriSFSNull"){const a={type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",color:bu(r),capStyle:td.Butt,joinStyle:zm.Miter,width:.75}]};let l=0;const c=xl(Y_t(i)?8:10);switch(i){case"vertical":case"esriSFSVertical":l=90;break;case"forward-diagonal":case"esriSFSForwardDiagonal":case"diagonal-cross":case"esriSFSDiagonalCross":l=-45;break;case"backward-diagonal":case"esriSFSBackwardDiagonal":l=45;break;case"cross":case"esriSFSCross":l=0}s.push({type:"CIMHatchFill",lineSymbol:a,offsetX:0,offsetY:0,rotation:l,separation:c}),i==="cross"||i==="esriSFSCross"?s.push({type:"CIMHatchFill",lineSymbol:_e(a),offsetX:0,offsetY:0,rotation:90,separation:c}):i!=="diagonal-cross"&&i!=="esriSFSDiagonalCross"||s.push({type:"CIMHatchFill",lineSymbol:_e(a),offsetX:0,offsetY:0,rotation:45,separation:c})}else!i||i!=="solid"&&i!=="esriSFSSolid"||s.push({type:"CIMSolidFill",enable:!0,color:bu(r)});return o}static fromSimpleLineSymbol(e){const{cap:r,color:i,join:n,marker:s,miterLimit:o,style:a,width:l}=e;let c=null;a!=="solid"&&a!=="none"&&a!=="esriSLSSolid"&&a!=="esriSLSNull"&&(c=[{type:"CIMGeometricEffectDashes",dashTemplate:iJ(a,r),lineDashEnding:"NoConstraint",scaleDash:!0,offsetAlongLine:null}]);const u=[];if(s){let h;switch(s.placement){case"begin-end":h=km.Both;break;case"begin":h=km.JustBegin;break;case"end":h=km.JustEnd;break;default:h=km.None}const p=SF.fromSimpleMarker(s,l,i).symbolLayers[0];p.markerPlacement={type:"CIMMarkerPlacementAtExtremities",angleToLine:!0,offset:0,extremityPlacement:h,offsetAlongLine:0},u.push(p)}return u.push({type:"CIMSolidStroke",color:a!=="none"&&a!=="esriSLSNull"?bu(i):[0,0,0,0],capStyle:OLe(r),joinStyle:RLe(n),miterLimit:o,width:l,effects:c}),{type:"CIMLineSymbol",symbolLayers:u}}static fromPictureMarker(e){const{angle:r,height:i,width:n,xoffset:s,yoffset:o}=e;let a=e.url;return e.type==="esriPMS"&&e.imageData&&(a=e.imageData),{type:"CIMPointSymbol",symbolLayers:[{type:"CIMPictureMarker",invertBackfaceTexture:!1,scaleX:1,textureFilter:vC.Picture,tintColor:null,url:a,size:i,width:n,offsetX:wr(s),offsetY:wr(o),rotation:wr(-r)}]}}static createCIMTextSymbolfromTextSymbol(e){const{angle:r,color:i,font:n,haloColor:s,haloSize:o,horizontalAlignment:a,kerning:l,text:c,verticalAlignment:u,xoffset:h,yoffset:p,backgroundColor:f,borderLineColor:g,borderLineSize:_}=e;let v,b,w,x,S,E;n&&(v=n.family,b=n.style,w=n.weight,x=n.size,S=n.decoration);let A=!1;return c&&(A=L0t(c)[1]),(f||_)&&(E={type:"CIMBackgroundCallout",margin:null,backgroundSymbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",color:bu(f)},{type:"CIMSolidStroke",color:bu(g),width:_}]},accentBarSymbol:null,gap:null,leaderLineSymbol:null,lineStyle:null}),{type:"CIMTextSymbol",angle:r,blockProgression:JZ.BTT,depth3D:1,extrapolateBaselines:!0,fontEffects:YZ.Normal,fontEncoding:XZ.Unicode,fontFamilyName:v||"Arial",fontStyleName:H_t(b,w),fontType:ZZ.Unspecified,haloSize:o,height:x,hinting:KZ.Default,horizontalAlignment:G_t(a??"center"),kerning:l,letterWidth:100,ligatures:!0,lineGapType:"Multiple",offsetX:wr(h),offsetY:wr(p),strikethrough:S==="line-through",underline:S==="underline",symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:bu(i)}]},haloSymbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:bu(s)}]},shadowColor:[0,0,0,255],shadowOffsetX:1,shadowOffsetY:1,textCase:"Normal",textDirection:A?M8.RTL:M8.LTR,verticalAlignment:j_t(u??"baseline"),verticalGlyphOrientation:eJ.Right,wordSpacing:100,billboardMode3D:QZ.FaceNearPlane,callout:E}}static createPictureMarkerRasterizationParam(e){var l,c;const{angle:r,height:i,width:n,xoffset:s,yoffset:o}=e,a=e.url??((l=e.source)==null?void 0:l.url)??((c=e.source)==null?void 0:c.imageData);return a?{type:"sprite-rasterization-param",overrides:[],resource:{type:"CIMPictureMarker",invertBackfaceTexture:!1,scaleX:1,textureFilter:vC.Picture,tintColor:null,url:a,size:i,width:n,offsetX:wr(s),offsetY:wr(o),rotation:wr(-r)}}:null}static createPictureFillRasterizationParam(e){const{width:r,height:i,xoffset:n,yoffset:s,url:o}=e;return o?{type:"sprite-rasterization-param",overrides:[],resource:{type:"CIMPictureFill",scaleX:1,textureFilter:vC.Picture,tintColor:null,url:o,width:r,height:i,offsetX:wr(n),offsetY:wr(s),rotation:0}}:null}static fromSimpleMarker(e,r,i){const{style:n}=e,s=e.color??i;if(n==="path"||n==="esriSMSPath"){const h=[];if("outline"in e&&e.outline){const g=e.outline;h.push({type:"CIMSolidStroke",enable:!0,width:g.width,color:bu(g.color),path:e.path})}h.push({type:"CIMSolidFill",enable:!0,color:bu(s),path:e.path});const[p,f]=nA("square");return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:-wr(e.angle),size:wr(e.size||6),offsetX:wr(e.xoffset),offsetY:wr(e.yoffset),scaleSymbolsProportionally:!1,frame:p,markerGraphics:[{type:"CIMMarkerGraphic",geometry:f,symbol:{type:"CIMPolygonSymbol",symbolLayers:h}}]}]}}const o=[];let a,l,c=e.size;if("outline"in e&&e.outline&&e.outline.style!=="none"&&e.outline.style!=="esriSLSNull"){const h=e.outline,p=h.style!=="solid"&&h.style!=="esriSLSSolid";[a,l]=p?nA(n,e.size):nA(n);const f=h.width??I_t.width;if(p){const v=f/e.size,b=(a.xmax-a.xmin)*v/2,w=(a.ymax-a.ymin)*v/2;a.xmin-=b,a.xmax+=b,a.ymin-=w,a.ymax+=w,c&&(c+=f)}const g=e.style!=="cross"&&e.style!=="x"||(e==null?void 0:e.outline.style)==="dot"||(e==null?void 0:e.outline.style)==="short-dot"?xa.HalfGap:xa.FullPattern,_=p?[{type:"CIMGeometricEffectAddControlPoints"},{type:"CIMGeometricEffectDashes",dashTemplate:iJ(h.style,null).map(v=>h.width&&h.width>0?v*h.width:v),lineDashEnding:g,controlPointEnding:xa.FullPattern}]:void 0;o.push({type:"CIMSolidStroke",capStyle:p?td.Round:td.Butt,enable:!0,width:f,color:bu(h.color),effects:_})}else!r||e.type!=="line-marker"||e.style!=="cross"&&e.style!=="x"?[a,l]=nA(n):([a,l]=nA(n),o.push({type:"CIMSolidStroke",enable:!0,width:r,color:bu(s)}));o.push({type:"CIMSolidFill",enable:!0,color:bu(s)});const u={type:"CIMPolygonSymbol",symbolLayers:o};return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:wr(-e.angle),size:wr(c||6*r),offsetX:wr(e.xoffset),offsetY:wr(e.yoffset),scaleSymbolsProportionally:!1,frame:a,markerGraphics:[{type:"CIMMarkerGraphic",geometry:l,symbol:u}]}]}}static fromCIMHatchFill(e,r){var l;const i=r*(e.separation??bC.CIMHatchFill.separation),n=i/2,s=_e(e.lineSymbol);(l=s.symbolLayers)==null||l.forEach(c=>{var u;switch(c.type){case"CIMSolidStroke":c.width!=null&&(c.width*=r),(u=c.effects)==null||u.forEach(h=>{if(h.type==="CIMGeometricEffectDashes"){const p=h.dashTemplate;h.dashTemplate=p.map(f=>f*r)}});break;case"CIMVectorMarker":{c.size!=null&&(c.size*=r);const h=c.markerPlacement;h!=null&&"placementTemplate"in h&&(h.placementTemplate=h.placementTemplate.map(p=>p*r));break}}});let o=this._getLineSymbolPeriod(s)||qfe;for(;o<qfe;)o*=2;const a=o/2;return{type:"CIMVectorMarker",frame:{xmin:-a,xmax:a,ymin:-n,ymax:n},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{paths:[[[-a,0],[a,0]]]},symbol:s}],size:i}}static fetchResources(e,r,i,n=null){return e&&r&&MLe(e,s=>{X_t(s,r,i),"url"in s&&s.url&&i.push(r.fetchResource(s.url,{signal:n}))}),i}static fetchFonts(e,r,i){if(e&&r){if("symbolLayers"in e&&e.symbolLayers){for(const n of e.symbolLayers)if(n.type==="CIMVectorMarker"&&n.markerGraphics)for(const s of n.markerGraphics)s!=null&&s.symbol&&SF.fetchFonts(s.symbol,r,i)}else if(e.type==="CIMTextSymbol"){const{fontFamilyName:n,fontStyleName:s}=e;if(!n||n.toLowerCase()==="calcitewebcoreicons")return;const{style:o,weight:a}=ZIe(s),l=JIe(e),c=new zI({family:n,style:o,weight:a,decoration:l});i.push(r.loadFont(c).catch(()=>{R8().error(`Unsupported font ${n} in CIM symbol`)}))}}}static _getLineSymbolPeriod(e){if(e){const r=this._getEffectsRepeat(e.effects);if(r)return r;if(e.symbolLayers){for(const i of e.symbolLayers)if(i){const n=this._getEffectsRepeat(i.effects);if(n)return n;switch(i.type){case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":case"CIMObjectMarker3D":case"CIMglTFMarker3D":{const s=this._getPlacementRepeat(i.markerPlacement);if(s)return s}}}}}return 0}static _getEffectsRepeat(e){if(e){for(const r of e)if(r)switch(r.type){case"CIMGeometricEffectDashes":{const i=r.dashTemplate;if(i&&i.length){let n=0;for(const s of i)n+=s;return 1&i.length&&(n*=2),n}break}case"CIMGeometricEffectWave":return r.period;default:R8().error(`unsupported geometric effect type ${r.type}`)}}return 0}static _getPlacementRepeat(e){if(e)switch(e.type){case"CIMMarkerPlacementAlongLineSameSize":case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineVariableSize":{const r=e.placementTemplate;if(r&&r.length){let i=0;for(const n of r)i+=+n;return 1&r.length&&(i*=2),i}break}}return 0}static fromCIMInsidePolygon(e){const r=e.markerPlacement,i={...e};i.markerPlacement=null,i.anchorPoint=null;const n=Math.abs(r.stepX),s=Math.abs(r.stepY),o=(r.randomness??100)/100;let a,l,c,u;if(r.gridType==="Random"){const h=xl(Kyt),p=Math.max(Math.floor(h/n),1),f=Math.max(Math.floor(h/s),1);a=p*n/2,l=f*s/2,c=2*l;const g=new wx(r.seed),_=o*n/1.5,v=o*s/1.5;u=[];for(let b=0;b<p;b++)for(let w=0;w<f;w++){const x=b*n-a+_*(.5-g.getFloat()),S=w*s-l+v*(.5-g.getFloat());u.push({x,y:S}),b===0&&u.push({x:x+2*a,y:S}),w===0&&u.push({x,y:S+2*l})}}else r.shiftOddRows===!0?(a=n/2,l=s,c=2*s,u=[{x:-a,y:0},{x:a,y:0},{x:0,y:l},{x:0,y:-l}]):(a=n/2,l=s/2,c=s,u=[{x:-n,y:0},{x:0,y:-s},{x:-n,y:-s},{x:0,y:0},{x:n,y:0},{x:0,y:s},{x:n,y:s},{x:-n,y:s},{x:n,y:-s}]);return{type:"CIMVectorMarker",frame:{xmin:-a,xmax:a,ymin:-l,ymax:l},markerGraphics:u.map(h=>({type:"CIMMarkerGraphic",geometry:h,symbol:{type:"CIMPointSymbol",symbolLayers:[i]}})),size:c}}};function MLe(t,e){if(t)switch(t.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":{const r=t.symbolLayers;if(!r)return;for(const i of r)if(e(i),i.type==="CIMVectorMarker"){const n=i.markerGraphics;if(!n)continue;for(const s of n)if(s){const o=s.symbol;o&&MLe(o,e)}}break}}}const OLe=t=>{if(!t)return td.Butt;switch(t){case"butt":return td.Butt;case"square":return td.Square;case"round":return td.Round}},RLe=t=>{if(!t)return zm.Miter;switch(t){case"miter":return zm.Miter;case"round":return zm.Round;case"bevel":return zm.Bevel}},G_t=t=>{if(t==null)return"Center";switch(t){case"left":return"Left";case"right":return"Right";case"center":return"Center"}},j_t=t=>{if(t==null)return"Center";switch(t){case"baseline":return"Baseline";case"top":return"Top";case"middle":return"Center";case"bottom":return"Bottom"}},bu=t=>{if(!t)return[0,0,0,0];const{r:e,g:r,b:i,a:n}=t;return[e,r,i,255*n]},H_t=(t,e)=>{const r=W_t(e),i=q_t(t);return r&&i?`${r}-${i}`:`${r}${i}`},W_t=t=>{if(!t)return"";switch(t.toLowerCase()){case"bold":case"bolder":return"bold"}return""},q_t=t=>{if(!t)return"";switch(t.toLowerCase()){case"italic":case"oblique":return"italic"}return""},iJ=(t,e)=>{const r=se("safari")?.001:0,i=e==="butt";switch(t){case"dash":case"esriSLSDash":return i?[4,3]:[3,4];case"dash-dot":case"esriSLSDashDot":return i?[4,3,1,3]:[3,4,r,4];case"dot":case"esriSLSDot":return i?[1,3]:[r,4];case"long-dash":case"esriSLSLongDash":return i?[8,3]:[7,4];case"long-dash-dot":case"esriSLSLongDashDot":return i?[8,3,1,3]:[7,4,r,4];case"long-dash-dot-dot":case"esriSLSDashDotDot":return i?[8,3,1,3,1,3]:[7,4,r,4,r,4];case"short-dash":case"esriSLSShortDash":return i?[4,1]:[3,2];case"short-dash-dot":case"esriSLSShortDashDot":return i?[4,1,1,1]:[3,2,r,2];case"short-dash-dot-dot":case"esriSLSShortDashDotDot":return i?[4,1,1,1,1,1]:[3,2,r,2,r,2];case"short-dot":case"esriSLSShortDot":return i?[1,1]:[r,2];case"solid":case"esriSLSSolid":case"none":return R8().error("Unexpected: style does not require rasterization"),[0,0];default:return R8().error(`Tried to rasterize SLS, but found an unexpected style: ${t}!`),[0,0]}},nA=(t,e=100)=>{const r=e/2;let i,n;const s=t;if(s==="circle"||s==="esriSMSCircle"){let a=Math.acos(1-.25/r),l=Math.ceil(ALe/a/4);l===0&&(l=1),a=B_t/l,l*=4;const c=[];c.push([r,0]);for(let u=1;u<l;u++)c.push([r*Math.cos(u*a),-r*Math.sin(u*a)]);c.push([r,0]),i={rings:[c]},n={xmin:-r,ymin:-r,xmax:r,ymax:r}}else if(s==="cross"||s==="esriSMSCross")i={paths:[[[0,r],[0,-r]],[[r,0],[-r,0]]]},n={xmin:-r,ymin:-r,xmax:r,ymax:r};else if(s==="diamond"||s==="esriSMSDiamond")i={rings:[[[-r,0],[0,r],[r,0],[0,-r],[-r,0]]]},n={xmin:-r,ymin:-r,xmax:r,ymax:r};else if(s==="square"||s==="esriSMSSquare")i={rings:[[[-r,-r],[-r,r],[r,r],[r,-r],[-r,-r]]]},n={xmin:-r,ymin:-r,xmax:r,ymax:r};else if(s==="x"||s==="esriSMSX")i={paths:[[[r,r],[-r,-r]],[[r,-r],[-r,r]]]},n={xmin:-r,ymin:-r,xmax:r,ymax:r};else if(s==="triangle"||s==="esriSMSTriangle"){const o=e*.5773502691896257,a=-o,l=2/3*e,c=l-e;i={rings:[[[a,c],[0,l],[o,c],[a,c]]]},n={xmin:a,ymin:c,xmax:o,ymax:l}}else s==="arrow"&&(i={rings:[[[-50,50],[50,0],[-50,-50],[-33,-20],[-33,20],[-50,50]]]},n={xmin:-r,ymin:-r,xmax:r,ymax:r});return[n,i]},Y_t=t=>t==="vertical"||t==="horizontal"||t==="cross"||t==="esriSFSCross"||t==="esriSFSVertical"||t==="esriSFSHorizontal";function X_t(t,e,r){if(!(!t.effects||e.geometryEngine!=null)){if(e.geometryEnginePromise)return void r.push(e.geometryEnginePromise);dyt(t.effects)&&(e.geometryEnginePromise=pyt(),r.push(e.geometryEnginePromise),e.geometryEnginePromise.then(i=>e.geometryEngine=i))}}function Yfe(t){if(!t)return null;let e=null;const{cap:r,color:i,join:n,miterLimit:s,style:o,width:a}=t;return o!=="solid"&&o!=="none"&&o!=="esriSLSSolid"&&o!=="esriSLSNull"&&(e=[{type:"CIMGeometricEffectDashes",dashTemplate:iJ(o,r),lineDashEnding:"NoConstraint",scaleDash:!0,offsetAlongLine:null}]),{type:"CIMSolidStroke",color:o!=="esriSLSNull"&&o!=="none"?bu(i):[0,0,0,0],capStyle:OLe(r),joinStyle:RLe(n),miterLimit:s,width:a,effects:e}}function $Le(t,e,r,i,n){if(t==null)return null;const s=t.referencesGeometry()&&n?Z_t(e,i,n):e,o=t.repurposeFeature(s);try{return t.evaluate({...r,$feature:o},t.services)}catch(a){return re.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",a),null}}const bG=new Map;function Z_t(t,e,r){const{transform:i,hasZ:n,hasM:s}=r;bG.has(e)||bG.set(e,J_t(e));const o=bG.get(e)(t.geometry,i,n,s);return{...t,geometry:o}}function J_t(t){const e={};switch(t){case"esriGeometryPoint":return(r,i,n,s)=>v$e(i,e,r,n,s);case"esriGeometryPolygon":return(r,i,n,s)=>b$e(i,e,r,n,s);case"esriGeometryPolyline":return(r,i,n,s)=>w$e(i,e,r,n,s);case"esriGeometryMultipoint":return(r,i,n,s)=>_$e(i,e,r,n,s);default:return re.getLogger("esri.views.2d.support.arcadeOnDemand").error(new K("mapview-arcade",`Unable to handle geometryType: ${t}`)),r=>r}}const Q_t=t=>{if(!t)return[0,0,0,0];const{r:e,g:r,b:i,a:n}=t;return[e,r,i,255*n]};let aO=class rs{static findApplicableOverrides(e,r,i){if(e&&r){if(e.primitiveName){let n=!1;for(const s of i)if(s.primitiveName===e.primitiveName){n=!0;break}if(!n)for(const s of r)s.primitiveName===e.primitiveName&&i.push(s)}switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(e.effects)for(const n of e.effects)rs.findApplicableOverrides(n,r,i);if(e.symbolLayers)for(const n of e.symbolLayers)rs.findApplicableOverrides(n,r,i);break;case"CIMTextSymbol":break;case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":case"CIMSolidFill":case"CIMPictureFill":case"CIMHatchFill":case"CIMGradientFill":case"CIMVectorMarker":case"CIMCharacterMarker":case"CIMPictureMarker":if(e.effects)for(const n of e.effects)rs.findApplicableOverrides(n,r,i);if(e.markerPlacement&&rs.findApplicableOverrides(e.markerPlacement,r,i),e.type==="CIMVectorMarker"){if(e.markerGraphics)for(const n of e.markerGraphics)rs.findApplicableOverrides(n,r,i),rs.findApplicableOverrides(n.symbol,r,i)}else e.type==="CIMCharacterMarker"?rs.findApplicableOverrides(e.symbol,r,i):e.type==="CIMHatchFill"?rs.findApplicableOverrides(e.lineSymbol,r,i):e.type==="CIMPictureMarker"&&rs.findApplicableOverrides(e.animatedSymbolProperties,r,i)}}}static findEffectOverrides(e,r){if(!e)return null;if(e.type==="CIMGeometricEffectDashes"&&QIe(e),!r||!e.primitiveName)return{type:"cim-effect-info",effect:e,overrides:[]};const i=e.primitiveName,n=[];for(const s of r)s.primitiveName===i&&n.push({...s,propertyName:kfe(s.propertyName)});return{type:"cim-effect-info",effect:e,overrides:n}}static async resolveSymbolOverrides(e,r,i,n,s,o,a){if(!(e!=null&&e.symbol))return null;let{symbol:l,primitiveOverrides:c}=e;const u=!!c;if(!u&&!n)return l;l=_e(l),c=_e(c);let h=!0;if(r||(r={attributes:{}},h=!1),u){if(h||(c=c.filter(p=>{var f;return!((f=p.valueExpressionInfo)!=null&&f.expression.includes("$feature"))})),a||(c=c.filter(p=>{var f;return!((f=p.valueExpressionInfo)!=null&&f.expression.includes("$view"))})),c.length>0){const p={spatialReference:i,fields:_yt(r.attributes),geometryType:s};await rs.createRenderExpressions(c,p),rs.evaluateOverrides(c,r,s??"esriGeometryPoint",o,a)}rs.applyOverrides(l,c)}return n&&rs.applyDictionaryTextOverrides(l,r,n,null),l}static async createRenderExpressions(e,r){const i=[];for(const n of e){const s=n.valueExpressionInfo;if(!s||rs._expressionToRenderExpression.has(s.expression))continue;const o=OEe(s.expression,r.spatialReference,r.fields);i.push(o),o.then(a=>rs._expressionToRenderExpression.set(s.expression,a))}i.length>0&&await Promise.all(i)}static evaluateOverrides(e,r,i,n,s){const o={$view:{scale:s==null?void 0:s.scale}};for(const a of e){a.value&&typeof a.value=="object"&&oPe(a.value)&&(a.propertyName==="Color"||a.propertyName==="StrokeColor")&&(a.value=Q_t(a.value));const l=a.valueExpressionInfo;if(!l)continue;const c=rs._expressionToRenderExpression.get(l.expression);c&&(a.value=$Le(c,r,o,i,n))}}static applyDictionaryTextOverrides(e,r,i,n,s="Normal"){if(e!=null&&e.type)switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":case"CIMTextSymbol":{const o=e.symbolLayers;if(!o)return;for(const a of o)a&&a.type==="CIMVectorMarker"&&rs.applyDictionaryTextOverrides(a,r,i,n,e.type==="CIMTextSymbol"?e.textCase:s)}break;case"CIMVectorMarker":{const o=e.markerGraphics;if(!o)return;for(const a of o)a&&rs.applyDictionaryTextOverrides(a,r,i,n)}break;case"CIMMarkerGraphic":{const o=e.textString;if(o&&o.includes("[")){const a=syt(o,i);e.textString=oyt(r,a,n,s)}}}}static applyOverrides(e,r,i,n){if(e.primitiveName){for(const s of r)if(s.primitiveName===e.primitiveName){const o=kfe(s.propertyName);if(n&&n.push({cim:e,nocapPropertyName:o,value:e[o]}),i){let a=!1;for(const l of i)l.primitiveName===e.primitiveName&&(a=!0);a||i.push(s)}s.value!=null&&(e[o]=s.value)}}switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(e.effects)for(const s of e.effects)rs.applyOverrides(s,r,i,n);if(e.symbolLayers)for(const s of e.symbolLayers)rs.applyOverrides(s,r,i,n);break;case"CIMTextSymbol":break;case"CIMSolidStroke":case"CIMSolidFill":case"CIMVectorMarker":if(e.effects)for(const s of e.effects)rs.applyOverrides(s,r,i,n);if(e.type==="CIMVectorMarker"&&e.markerGraphics)for(const s of e.markerGraphics)rs.applyOverrides(s,r,i,n),rs.applyOverrides(s.symbol,r,i,n)}}static restoreOverrides(e){for(const r of e)r.cim[r.nocapPropertyName]=r.value}static buildOverrideKey(e){let r="";for(const i of e)i.value!==void 0&&(r+=`${i.primitiveName}${i.propertyName}${JSON.stringify(i.value)}`);return r}static toValue(e,r){if(e==="DashTemplate")return r.split(" ").map(i=>Number(i));if(e==="Color"){const i=new Xe(r).toRgba();return i[3]*=255,i}return r}};aO._expressionToRenderExpression=new Map;function Yie(t,e,r,i){if(t)if(t.type!=="CIMTextSymbol"){if(r&&t.effects)for(const n of t.effects)t1t(n,e);if(t.symbolLayers)for(const n of t.symbolLayers)switch(n.type){case"CIMPictureMarker":case"CIMVectorMarker":K_t(n,e,i);break;case"CIMPictureStroke":case"CIMSolidStroke":!(i!=null&&i.preserveOutlineWidth)&&n.width&&(n.width*=e);break;case"CIMPictureFill":n.height&&(n.height*=e),n.offsetX&&(n.offsetX*=e),n.offsetY&&(n.offsetY*=e);break;case"CIMHatchFill":Yie(n.lineSymbol,e,!0,{...i,preserveOutlineWidth:!1}),n.offsetX&&(n.offsetX*=e),n.offsetY&&(n.offsetY*=e),n.separation&&(n.separation*=e)}}else t.height!=null&&(t.height*=e)}function K_t(t,e,r){if(t&&(t.markerPlacement&&e1t(t.markerPlacement,e),t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e),t.anchorPoint&&t.anchorPointUnits==="Absolute"&&(t.anchorPoint={x:t.anchorPoint.x*e,y:t.anchorPoint.y*e}),t.size=t.size!=null?t.size*e:0,t.type==="CIMVectorMarker"&&t.markerGraphics))for(const i of t.markerGraphics)t.scaleSymbolsProportionally||Yie(i.symbol,e,!0,r)}function e1t(t,e){switch(XIe(t)&&t.offset&&(t.offset*=e),t.type){case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineSameSize":if(t.customEndingOffset&&(t.customEndingOffset*=e),t.offsetAlongLine&&(t.offsetAlongLine*=e),t.placementTemplate&&t.placementTemplate.length){const r=t.placementTemplate.map(i=>i*e);t.placementTemplate=r}break;case"CIMMarkerPlacementAlongLineVariableSize":if(t.maxRandomOffset&&(t.maxRandomOffset*=e),t.placementTemplate&&t.placementTemplate.length){const r=t.placementTemplate.map(i=>i*e);t.placementTemplate=r}break;case"CIMMarkerPlacementOnLine":t.startPointOffset&&(t.startPointOffset*=e);break;case"CIMMarkerPlacementAtExtremities":t.offsetAlongLine&&(t.offsetAlongLine*=e);break;case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementOnVertices":break;case"CIMMarkerPlacementAtRatioPositions":t.beginPosition&&(t.beginPosition*=e),t.endPosition&&(t.endPosition*=e);break;case"CIMMarkerPlacementPolygonCenter":t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e);break;case"CIMMarkerPlacementInsidePolygon":t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e),t.stepX&&(t.stepX*=e),t.stepY&&(t.stepY*=e)}}function t1t(t,e){switch(t.type){case"CIMGeometricEffectArrow":case"CIMGeometricEffectDonut":t.width&&(t.width*=e);break;case"CIMGeometricEffectBuffer":t.size&&(t.size*=e);break;case"CIMGeometricEffectCut":t.beginCut&&(t.beginCut*=e),t.endCut&&(t.endCut*=e),t.middleCut&&(t.middleCut*=e);break;case"CIMGeometricEffectDashes":if(t.customEndingOffset&&(t.customEndingOffset*=e),t.offsetAlongLine&&(t.offsetAlongLine*=e),t.dashTemplate&&t.dashTemplate.length){const r=t.dashTemplate.map(i=>i*e);t.dashTemplate=r}break;case"CIMGeometricEffectExtension":case"CIMGeometricEffectJog":case"CIMGeometricEffectRadial":t.length&&(t.length*=e);break;case"CIMGeometricEffectMove":t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e);break;case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":t.offset&&(t.offset*=e);break;case"CIMGeometricEffectRegularPolygon":t.radius&&(t.radius*=e);break;case"CIMGeometricEffectTaperedPolygon":t.fromWidth&&(t.fromWidth*=e),t.length&&(t.length*=e),t.toWidth&&(t.toWidth*=e);break;case"CIMGeometricEffectWave":t.amplitude&&(t.amplitude*=e),t.period&&(t.period*=e)}}function r1t(t){const e=[];return nJ(cyt(t),e),e.length?new Xe(lyt(e[0])):null}function nJ(t,e){var n;if(!t)return;let r;r=t.type==="CIMTextSymbol"?t.symbol:t;const i=t.type==="CIMPolygonSymbol";if(r!=null&&r.symbolLayers){for(const s of r.symbolLayers)if(!(s.colorLocked||i&&(hyt(s)||uyt(s)&&s.markerPlacement&&XIe(s.markerPlacement))))switch(s.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":s.tintColor&&Xfe(e,s.tintColor);break;case"CIMVectorMarker":(n=s.markerGraphics)==null||n.forEach(o=>{nJ(o.symbol,e)});break;case"CIMSolidStroke":case"CIMSolidFill":Xfe(e,s.color);break;case"CIMHatchFill":nJ(s.lineSymbol,e)}}}function Xfe(t,e){for(const r of t)if(r.join(".")===e.join("."))return;t.push(e)}var Zfe,Jfe,ILe={exports:{}};Jfe=function(){function t(n,s){function o(){this.constructor=n}o.prototype=s.prototype,n.prototype=new o}function e(n,s,o,a){var l=Error.call(this,n);return Object.setPrototypeOf&&Object.setPrototypeOf(l,e.prototype),l.expected=s,l.found=o,l.location=a,l.name="SyntaxError",l}function r(n,s,o){return o=o||" ",n.length>s?n:(s-=n.length,n+(o+=o.repeat(s)).slice(0,s))}function i(n,s){var o,a={},l=(s=s!==void 0?s:{}).grammarSource,c={start:Eg},u=Eg,h="none",p=")",f=",",g="(",_="%",v="px",b="cm",w="mm",x="in",S="pt",E="pc",A="deg",O="rad",L="grad",z="turn",k="#",q=".",B="e",J=/^[ \t\n\r]/,W=/^[a-z\-]/,Y=/^[0-9a-fA-F]/,le=/^[+\-]/,D=/^[0-9]/,I=Tl("none"),F=io("none",!1),G=io(")",!1),H=io(",",!1),Z=Tl("whitespace"),te=Hv([" ","	",`
`,"\r"],!1,!1),me=Tl("function"),Me=io("(",!1),it=Tl("identifier"),Et=Hv([["a","z"],"-"],!1,!1),St=Tl("percentage"),ht=io("%",!1),Ke=Tl("length"),je=io("px",!1),_r=io("cm",!1),Cr=io("mm",!1),Ni=io("in",!1),Ue=io("pt",!1),pr=io("pc",!1),Oe=Tl("angle"),Ve=io("deg",!1),xt=io("rad",!1),zt=io("grad",!1),We=io("turn",!1),At=Tl("number"),Ie=Tl("color"),et=io("#",!1),Mt=Hv([["0","9"],["a","f"],["A","F"]],!1,!1),ui=Hv(["+","-"],!1,!1),Gr=Hv([["0","9"]],!1,!1),Mi=io(".",!1),Dr=io("e",!1),qr=function(){return[]},fr=function(X,ve){return{type:"function",name:X,parameters:ve||[]}},Nr=function(X,ve){return ve.length>0?aP(X,ve,3):[X]},vr=function(X){return{type:"quantity",value:X.value,unit:X.unit}},Jr=function(X){return{type:"color",colorType:X.type,value:X.value}},Ct=function(X){return X},or=function(){return uc()},br=function(X){return{value:X,unit:"%"}},hi=function(X){return{value:X,unit:"px"}},Kn=function(X){return{value:X,unit:"cm"}},ur=function(X){return{value:X,unit:"mm"}},Fi=function(X){return{value:X,unit:"in"}},Pn=function(X){return{value:X,unit:"pt"}},So=function(X){return{value:X,unit:"pc"}},ja=function(X){return{value:X,unit:"deg"}},Ha=function(X){return{value:X,unit:"rad"}},Co=function(X){return{value:X,unit:"grad"}},as=function(X){return{value:X,unit:"turn"}},An=function(X){return{value:X,unit:null}},mr=function(){return{type:"hex",value:uc()}},ji=function(X){return{type:"function",value:X}},ws=function(){return{type:"named",value:uc()}},to=function(){return parseFloat(uc())},ae=0,jr=0,Pd=[{line:1,column:1}],ro=0,Ad=[],ut=0;if("startRule"in s){if(!(s.startRule in c))throw new Error(`Can't start parsing from rule "`+s.startRule+'".');u=c[s.startRule]}function uc(){return n.substring(jr,ae)}function io(X,ve){return{type:"literal",text:X,ignoreCase:ve}}function Hv(X,ve,Ee){return{type:"class",parts:X,inverted:ve,ignoreCase:Ee}}function Wv(){return{type:"end"}}function Tl(X){return{type:"other",description:X}}function Cg(X){var ve,Ee=Pd[X];if(Ee)return Ee;for(ve=X-1;!Pd[ve];)ve--;for(Ee={line:(Ee=Pd[ve]).line,column:Ee.column};ve<X;)n.charCodeAt(ve)===10?(Ee.line++,Ee.column=1):Ee.column++,ve++;return Pd[X]=Ee,Ee}function qv(X,ve,Ee){var gr=Cg(X),ls=Cg(ve),Oi={source:l,start:{offset:X,line:gr.line,column:gr.column},end:{offset:ve,line:ls.line,column:ls.column}};return Ee&&l&&typeof l.offset=="function"&&(Oi.start=l.offset(Oi.start),Oi.end=l.offset(Oi.end)),Oi}function Qt(X){ae<ro||(ae>ro&&(ro=ae,Ad=[]),Ad.push(X))}function Ay(X,ve,Ee){return new e(e.buildMessage(X,ve),X,ve,Ee)}function Eg(){var X;return(X=My())===a&&(X=Wa()),X}function My(){var X,ve;return ut++,X=ae,bn(),n.substr(ae,4)===h?(ve=h,ae+=4):(ve=a,ut===0&&Qt(F)),ve!==a?(bn(),jr=X,X=qr()):(ae=X,X=a),ut--,X===a&&ut===0&&Qt(I),X}function Wa(){var X,ve;if(X=[],(ve=hc())!==a)for(;ve!==a;)X.push(ve),ve=hc();else X=a;return X}function hc(){var X,ve,Ee,gr;return X=ae,bn(),(ve=Oy())!==a?(bn(),(Ee=wf())===a&&(Ee=null),bn(),n.charCodeAt(ae)===41?(gr=p,ae++):(gr=a,ut===0&&Qt(G)),gr!==a?(bn(),jr=X,X=fr(ve,Ee)):(ae=X,X=a)):(ae=X,X=a),X}function wf(){var X,ve,Ee,gr,ls,Oi,qa,Jv;if(X=ae,(ve=no())!==a){for(Ee=[],gr=ae,ls=bn(),n.charCodeAt(ae)===44?(Oi=f,ae++):(Oi=a,ut===0&&Qt(H)),Oi===a&&(Oi=null),qa=bn(),(Jv=no())!==a?gr=ls=[ls,Oi,qa,Jv]:(ae=gr,gr=a);gr!==a;)Ee.push(gr),gr=ae,ls=bn(),n.charCodeAt(ae)===44?(Oi=f,ae++):(Oi=a,ut===0&&Qt(H)),Oi===a&&(Oi=null),qa=bn(),(Jv=no())!==a?gr=ls=[ls,Oi,qa,Jv]:(ae=gr,gr=a);jr=X,X=Nr(ve,Ee)}else ae=X,X=a;return X}function no(){var X,ve;return X=ae,(ve=Xv())===a&&(ve=W2())===a&&(ve=Zv())===a&&(ve=Ry()),ve!==a&&(jr=X,ve=vr(ve)),(X=ve)===a&&(X=ae,(ve=xL())!==a&&(jr=X,ve=Jr(ve)),X=ve),X}function bn(){var X,ve;for(ut++,X=[],J.test(n.charAt(ae))?(ve=n.charAt(ae),ae++):(ve=a,ut===0&&Qt(te));ve!==a;)X.push(ve),J.test(n.charAt(ae))?(ve=n.charAt(ae),ae++):(ve=a,ut===0&&Qt(te));return ut--,ve=a,ut===0&&Qt(Z),X}function Oy(){var X,ve,Ee;return ut++,X=ae,(ve=Yv())!==a?(n.charCodeAt(ae)===40?(Ee=g,ae++):(Ee=a,ut===0&&Qt(Me)),Ee!==a?(jr=X,X=Ct(ve)):(ae=X,X=a)):(ae=X,X=a),ut--,X===a&&(ve=a,ut===0&&Qt(me)),X}function Yv(){var X,ve,Ee;if(ut++,X=ae,ve=[],W.test(n.charAt(ae))?(Ee=n.charAt(ae),ae++):(Ee=a,ut===0&&Qt(Et)),Ee!==a)for(;Ee!==a;)ve.push(Ee),W.test(n.charAt(ae))?(Ee=n.charAt(ae),ae++):(Ee=a,ut===0&&Qt(Et));else ve=a;return ve!==a&&(jr=X,ve=or()),ut--,(X=ve)===a&&(ve=a,ut===0&&Qt(it)),X}function Xv(){var X,ve,Ee;return ut++,X=ae,bn(),(ve=Sl())!==a?(n.charCodeAt(ae)===37?(Ee=_,ae++):(Ee=a,ut===0&&Qt(ht)),Ee!==a?(jr=X,X=br(ve)):(ae=X,X=a)):(ae=X,X=a),ut--,X===a&&ut===0&&Qt(St),X}function W2(){var X,ve,Ee;return ut++,X=ae,bn(),(ve=Sl())!==a?(n.substr(ae,2)===v?(Ee=v,ae+=2):(Ee=a,ut===0&&Qt(je)),Ee!==a?(jr=X,X=hi(ve)):(ae=X,X=a)):(ae=X,X=a),X===a&&(X=ae,bn(),(ve=Sl())!==a?(n.substr(ae,2)===b?(Ee=b,ae+=2):(Ee=a,ut===0&&Qt(_r)),Ee!==a?(jr=X,X=Kn(ve)):(ae=X,X=a)):(ae=X,X=a),X===a&&(X=ae,bn(),(ve=Sl())!==a?(n.substr(ae,2)===w?(Ee=w,ae+=2):(Ee=a,ut===0&&Qt(Cr)),Ee!==a?(jr=X,X=ur(ve)):(ae=X,X=a)):(ae=X,X=a),X===a&&(X=ae,bn(),(ve=Sl())!==a?(n.substr(ae,2)===x?(Ee=x,ae+=2):(Ee=a,ut===0&&Qt(Ni)),Ee!==a?(jr=X,X=Fi(ve)):(ae=X,X=a)):(ae=X,X=a),X===a&&(X=ae,bn(),(ve=Sl())!==a?(n.substr(ae,2)===S?(Ee=S,ae+=2):(Ee=a,ut===0&&Qt(Ue)),Ee!==a?(jr=X,X=Pn(ve)):(ae=X,X=a)):(ae=X,X=a),X===a&&(X=ae,bn(),(ve=Sl())!==a?(n.substr(ae,2)===E?(Ee=E,ae+=2):(Ee=a,ut===0&&Qt(pr)),Ee!==a?(jr=X,X=So(ve)):(ae=X,X=a)):(ae=X,X=a)))))),ut--,X===a&&ut===0&&Qt(Ke),X}function Zv(){var X,ve,Ee;return ut++,X=ae,(ve=Sl())!==a?(n.substr(ae,3)===A?(Ee=A,ae+=3):(Ee=a,ut===0&&Qt(Ve)),Ee!==a?(jr=X,X=ja(ve)):(ae=X,X=a)):(ae=X,X=a),X===a&&(X=ae,(ve=Sl())!==a?(n.substr(ae,3)===O?(Ee=O,ae+=3):(Ee=a,ut===0&&Qt(xt)),Ee!==a?(jr=X,X=Ha(ve)):(ae=X,X=a)):(ae=X,X=a),X===a&&(X=ae,(ve=Sl())!==a?(n.substr(ae,4)===L?(Ee=L,ae+=4):(Ee=a,ut===0&&Qt(zt)),Ee!==a?(jr=X,X=Co(ve)):(ae=X,X=a)):(ae=X,X=a),X===a&&(X=ae,(ve=Sl())!==a?(n.substr(ae,4)===z?(Ee=z,ae+=4):(Ee=a,ut===0&&Qt(We)),Ee!==a?(jr=X,X=as(ve)):(ae=X,X=a)):(ae=X,X=a)))),ut--,X===a&&(ve=a,ut===0&&Qt(Oe)),X}function Ry(){var X,ve;return ut++,X=ae,bn(),(ve=Sl())!==a?(jr=X,X=An(ve)):(ae=X,X=a),ut--,X===a&&ut===0&&Qt(At),X}function xL(){var X,ve,Ee,gr;if(ut++,X=ae,n.charCodeAt(ae)===35?(ve=k,ae++):(ve=a,ut===0&&Qt(et)),ve!==a){if(Ee=[],Y.test(n.charAt(ae))?(gr=n.charAt(ae),ae++):(gr=a,ut===0&&Qt(Mt)),gr!==a)for(;gr!==a;)Ee.push(gr),Y.test(n.charAt(ae))?(gr=n.charAt(ae),ae++):(gr=a,ut===0&&Qt(Mt));else Ee=a;Ee!==a?(jr=X,X=mr()):(ae=X,X=a)}else ae=X,X=a;return X===a&&(X=ae,(ve=hc())!==a&&(jr=X,ve=ji(ve)),(X=ve)===a&&(X=ae,(ve=Yv())!==a&&(jr=X,ve=ws()),X=ve)),ut--,X===a&&(ve=a,ut===0&&Qt(Ie)),X}function Sl(){var X,ve,Ee,gr,ls,Oi,qa;for(X=ae,le.test(n.charAt(ae))?(n.charAt(ae),ae++):ut===0&&Qt(ui),ve=ae,Ee=[],D.test(n.charAt(ae))?(gr=n.charAt(ae),ae++):(gr=a,ut===0&&Qt(Gr));gr!==a;)Ee.push(gr),D.test(n.charAt(ae))?(gr=n.charAt(ae),ae++):(gr=a,ut===0&&Qt(Gr));if(n.charCodeAt(ae)===46?(gr=q,ae++):(gr=a,ut===0&&Qt(Mi)),gr!==a){if(ls=[],D.test(n.charAt(ae))?(Oi=n.charAt(ae),ae++):(Oi=a,ut===0&&Qt(Gr)),Oi!==a)for(;Oi!==a;)ls.push(Oi),D.test(n.charAt(ae))?(Oi=n.charAt(ae),ae++):(Oi=a,ut===0&&Qt(Gr));else ls=a;ls!==a?ve=Ee=[Ee,gr,ls]:(ae=ve,ve=a)}else ae=ve,ve=a;if(ve===a)if(ve=[],D.test(n.charAt(ae))?(Ee=n.charAt(ae),ae++):(Ee=a,ut===0&&Qt(Gr)),Ee!==a)for(;Ee!==a;)ve.push(Ee),D.test(n.charAt(ae))?(Ee=n.charAt(ae),ae++):(Ee=a,ut===0&&Qt(Gr));else ve=a;if(ve!==a){if(Ee=ae,n.charCodeAt(ae)===101?(gr=B,ae++):(gr=a,ut===0&&Qt(Dr)),gr!==a){if(le.test(n.charAt(ae))?(ls=n.charAt(ae),ae++):(ls=a,ut===0&&Qt(ui)),ls===a&&(ls=null),Oi=[],D.test(n.charAt(ae))?(qa=n.charAt(ae),ae++):(qa=a,ut===0&&Qt(Gr)),qa!==a)for(;qa!==a;)Oi.push(qa),D.test(n.charAt(ae))?(qa=n.charAt(ae),ae++):(qa=a,ut===0&&Qt(Gr));else Oi=a;Oi!==a?Ee=gr=[gr,ls,Oi]:(ae=Ee,Ee=a)}else ae=Ee,Ee=a;Ee===a&&(Ee=null),jr=X,X=to()}else ae=X,X=a;return X}function oP(X,ve){return X.map(function(Ee){return Ee[ve]})}function aP(X,ve,Ee){return[X].concat(oP(ve,Ee))}if((o=u())!==a&&ae===n.length)return o;throw o!==a&&ae<n.length&&Qt(Wv()),Ay(Ad,ro<n.length?n.charAt(ro):null,ro<n.length?qv(ro,ro+1):qv(ro,ro))}return t(e,Error),e.prototype.format=function(n){var s="Error: "+this.message;if(this.location){var o,a=null;for(o=0;o<n.length;o++)if(n[o].source===this.location.source){a=n[o].text.split(/\r\n|\n|\r/g);break}var l=this.location.start,c=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(l):l,u=this.location.source+":"+c.line+":"+c.column;if(a){var h=this.location.end,p=r("",c.line.toString().length," "),f=a[l.line-1],g=(l.line===h.line?h.column:f.length+1)-l.column||1;s+=`
 --> `+u+`
`+p+` |
`+c.line+" | "+f+`
`+p+" | "+r("",l.column-1," ")+r("",g,"^")}else s+=`
 at `+u}return s},e.buildMessage=function(n,s){var o={literal:function(f){return'"'+l(f.text)+'"'},class:function(f){var g=f.parts.map(function(_){return Array.isArray(_)?c(_[0])+"-"+c(_[1]):c(_)});return"["+(f.inverted?"^":"")+g.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(f){return f.description}};function a(f){return f.charCodeAt(0).toString(16).toUpperCase()}function l(f){return f.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(g){return"\\x0"+a(g)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(g){return"\\x"+a(g)})}function c(f){return f.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(g){return"\\x0"+a(g)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(g){return"\\x"+a(g)})}function u(f){return o[f.type](f)}function h(f){var g,_,v=f.map(u);if(v.sort(),v.length>0){for(g=1,_=1;g<v.length;g++)v[g-1]!==v[g]&&(v[_]=v[g],_++);v.length=_}switch(v.length){case 1:return v[0];case 2:return v[0]+" or "+v[1];default:return v.slice(0,-1).join(", ")+", or "+v[v.length-1]}}function p(f){return f?'"'+l(f)+'"':"end of input"}return"Expected "+h(n)+" but "+p(s)+" found."},{SyntaxError:e,parse:i}},(Zfe=ILe).exports&&(Zfe.exports=Jfe());var i1t=ILe.exports;function LLe(t){if(!t||t.length===0)return null;if(typeof t=="string"){const r=Qfe(t);return r&&r.length!==0?r:null}const e=t.map(r=>{if(!Number.isFinite(r.scale)||r.scale<=0)throw new K("effect:invalid-scale","scale must be finite and greater than 0",{stop:r});return{scale:r.scale,effects:Qfe(r.value)}});e.sort((r,i)=>i.effects.length-r.effects.length);for(let r=0;r<e.length-1;r++){if(!fGe(e[r].effects,e[r+1].effects))throw new K("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:e[r].effects,b:e[r+1].effects});mGe(e[r].effects,e[r+1].effects)}return e.sort((r,i)=>i.scale-r.scale),e}function Qfe(t){let e;if(!t)return[];try{e=i1t.parse(t)}catch(r){throw new K("effect:invalid-syntax","Invalid effect syntax",{value:t,error:r})}return e.map(r=>n1t(r))}function n1t(t){try{switch(t.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return s1t(t);case"opacity":return o1t(t);case"hue-rotate":return a1t(t);case"blur":return l1t(t);case"drop-shadow":return c1t(t);case"bloom":return u1t(t)}}catch(e){throw e.details.filter=t,e}throw new K("effect:unknown-effect",`Effect '${t.name}' is not supported`,{effect:t})}function s1t(t){let e=1;return iP(t.parameters,1),t.parameters.length===1&&(e=Tp(t.parameters[0])),new NW(t.name,e)}function o1t(t){let e=1;return iP(t.parameters,1),t.parameters.length===1&&(e=Tp(t.parameters[0])),new qxe(e)}function a1t(t){let e=0;return iP(t.parameters,1),t.parameters.length===1&&(e=g1t(t.parameters[0])),new Hxe(e)}function l1t(t){let e=0;return iP(t.parameters,1),t.parameters.length===1&&(e=Jie(t.parameters[0]),hL(e,t.parameters[0])),new Uxe(e)}function c1t(t){const e=[];let r=null;for(const i of t.parameters)if(i.type==="color"){if(e.length&&Object.freeze(e),r)throw new K("effect:type-error","Accepts only one color",{});r=y1t(i)}else{const n=Jie(i);if(Object.isFrozen(e))throw new K("effect:type-error","<length> parameters not consecutive",{lengths:e});e.push(n),e.length===3&&hL(n,i)}if(e.length<2||e.length>3)throw new K("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${e.length}}`,{lengths:e});return new Gxe(e[0],e[1],e[2]||0,r||DLe("black"))}function u1t(t){let e=1,r=0,i=0;return iP(t.parameters,3),t.parameters[0]&&(e=Tp(t.parameters[0])),t.parameters[1]&&(r=Jie(t.parameters[1]),hL(r,t.parameters[1])),t.parameters[2]&&(i=Tp(t.parameters[2])),new kxe(e,r,i)}function iP(t,e){if(t.length>e)throw new K("effect:type-error",`Function supports up to ${e} parameters, Actual: ${t.length}`,{parameters:t})}function HU(t){if(t.type==="color")return"<color>";if(t.unit){if(t.unit in Zie)return"<length>";if(t.unit in Xie)return"<angle>";if(t.unit==="%")return"<percentage>"}return"<double>"}function hL(t,e){if(t<0)throw new K("effect:type-error",`Negative values are not allowed, Actual: ${t}`,{term:e})}function h1t(t){if(t.type!=="quantity"||t.unit!==null)throw new K("effect:type-error",`Expected <double>, Actual: ${HU(t)}`,{term:t})}function d1t(t){if(t.type!=="quantity"||t.unit!==null&&t.unit!=="%")throw new K("effect:type-error",`Expected <double> or <percentage>, Actual: ${HU(t)}`,{term:t})}const Xie={deg:1,grad:.9,rad:180/Math.PI,turn:360};function p1t(t){if(t.type!=="quantity"||!(t.value===0&&t.unit===null||t.unit&&Xie[t.unit]!=null))throw new K("effect:type-error",`Expected <angle>, Actual: ${HU(t)}`,{term:t})}const Zie={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function f1t(t){if(t.type!=="quantity"||!(t.value===0&&t.unit===null||t.unit&&Zie[t.unit]!=null))throw new K("effect:type-error",`Expected <length>, Actual: ${HU(t)}`,{term:t})}function Tp(t){d1t(t);const e=t.value;return hL(e,t),t.unit==="%"?.01*e:e}function m1t(t){return h1t(t),hL(t.value,t),t.value}function g1t(t){return p1t(t),t.value*Xie[t.unit]||0}function Jie(t){return f1t(t),t.value*Zie[t.unit]||0}function y1t(t){switch(t.colorType){case"hex":return p7e(t.value);case"named":return DLe(t.value);case"function":return b1t(t.value)}}function DLe(t){if(!pxe(t))throw new K("effect:unknown-color",`color '${t}' isn't valid`,{namedColor:t});return d7e(t)}const _1t=/^rgba?/i,v1t=/^hsla?/i;function b1t(t){if(iP(t.parameters,4),_1t.test(t.name))return[Tp(t.parameters[0]),Tp(t.parameters[1]),Tp(t.parameters[2]),t.parameters[3]?Tp(t.parameters[3]):1];if(v1t.test(t.name))return fxe(m1t(t.parameters[0]),Tp(t.parameters[1]),Tp(t.parameters[2]),t.parameters[3]?Tp(t.parameters[3]):1);throw new K("effect:syntax-error",`Invalid color function '${t.name}'`,{colorFunction:t})}function w1t(t,e,r){var i;try{return S1t(t)}catch(n){(i=r==null?void 0:r.messages)==null||i.push(n)}return null}function x1t(t,e,r,i){try{const n=T1t(t);E2(r,n,e)}catch(n){i.messages&&i.messages.push(n)}}function T1t(t){const e=LLe(t);return e?gGe(e)?e.map(r=>r.toJSON()):e.map(({scale:r,effects:i})=>({scale:r,value:i.map(n=>n.toJSON())})):null}function S1t(t){if(!t||t.length===0)return null;if(C1t(t)){const e=[];for(const r of t)e.push({scale:r.scale,value:Kfe(r.value)});return e}return Kfe(t)}function C1t(t){const e=t[0];return!!e&&"scale"in e}function Kfe(t){if(!(t!=null&&t.length))return"";const e=[];for(const r of t){let i=[];switch(r.type){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":case"opacity":i=[Fg(r,"amount")];break;case"blur":i=[Fg(r,"radius","pt")];break;case"hue-rotate":i=[Fg(r,"angle","deg")];break;case"drop-shadow":i=[Fg(r,"xoffset","pt"),Fg(r,"yoffset","pt"),Fg(r,"blurRadius","pt"),E1t(r,"color")];break;case"bloom":i=[Fg(r,"strength"),Fg(r,"radius","pt"),Fg(r,"threshold")]}const n=`${r.type}(${i.filter(Boolean).join(" ")})`;LLe(n),e.push(n)}return e.join(" ")}function Fg(t,e,r){if(t[e]==null)throw new K("effect:missing-parameter",`Missing parameter '${e}' in ${t.type} effect`,{effect:t});return r?t[e]+r:""+t[e]}function E1t(t,e){if(t[e]==null)throw new K("effect:missing-parameter",`Missing parameter '${e}' in ${t.type} effect`,{effect:t});const r=t[e];return`rgba(${r[0]||0}, ${r[1]||0}, ${r[2]||0}, ${r[3]/255||0})`}let P1t=class{constructor(e,r){this._storage=new CIe,this.id="",this.name="",this.size=0,this._storage.maxSize=e,this._storage.register(this),r&&this._storage.registerRemoveFunc("",r)}destroy(){this._storage.deregister(this),this._storage.destroy()}put(e,r,i=1){this._storage.put(this,e,r,i,1)}pop(e){return this._storage.pop(this,e)}get(e){return this._storage.get(this,e)}clear(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(e){this._storage.maxSize=e}resetHitRate(){}};new P1t(1e3);new Xe([128,128,128]);const A1t=new Xe("white");function M1t(t){var e;return((e=t.resource)==null?void 0:e.href)??""}function vHt(t,e){if(!t)return null;let r=null;return h2(t)?r=O1t(t):Q9(t)&&(r=t.type==="cim"?r1t(t):t.color?new Xe(t.color):null),r?eI(r,e):null}function O1t(t){const e=t.symbolLayers;if(!e)return null;let r=null;return e.forEach(i=>{var n;i.type==="object"&&((n=i.resource)!=null&&n.href)||(r=i.type==="water"?i.color:i.material?i.material.color:null)}),r?new Xe(r):null}function eI(t,e){if(e==null||t==null)return t;const r=t.toRgba();return r[3]=r[3]*e,new Xe(r)}function R1t(t,e,r){const i=t.symbolLayers;if(!i)return;const n=s=>eI(e=e??s??(r!=null?A1t:null),r);i.forEach(s=>{var o,a;if(s.type!=="object"||!((o=s.resource)!=null&&o.href)||e)if(s.type==="water")s.color=n(s.color);else{const l=s.material!=null?s.material.color:null,c=n(l);s.material==null?s.material=new Yu({color:c}):s.material.color=c,r!=null&&"outline"in s&&((a=s.outline)==null?void 0:a.color)!=null&&(s.outline.color=eI(s.outline.color,r))}})}function $1t(t,e,r){var i;(e=e??t.color)&&(t.color=eI(e,r)),r!=null&&"outline"in t&&((i=t.outline)!=null&&i.color)&&(t.outline.color=eI(t.outline.color,r))}function bHt(t,e,r){t&&(e||r!=null)&&(e&&(e=new Xe(e)),h2(t)?R1t(t,e,r):Q9(t)&&$1t(t,e,r))}async function I1t(t,e){const r=t.symbolLayers;r&&await jz(r,async i=>L1t(i,e))}async function L1t(t,e){switch(t.type){case"extrude":N1t(t,e);break;case"icon":case"line":case"text":D1t(t,e);break;case"path":k1t(t,e);break;case"object":await F1t(t,e)}}function D1t(t,e){const r=NLe(e);r!=null&&(t.size=r)}function NLe(t){for(const e of t)if(typeof e=="number")return e;return null}function N1t(t,e){t.size=typeof e[2]=="number"?e[2]:0}async function F1t(t,e){const{resourceSize:r,symbolSize:i}=await z1t(t),n=FLe(e,r,i);t.width=xR(e[0],i[0],r[0],n),t.depth=xR(e[1],i[1],r[1],n),t.height=xR(e[2],i[2],r[2],n)}function k1t(t,e){const r=FLe(e,Im,[t.width,void 0,t.height]);t.width=xR(e[0],t.width,1,r),t.height=xR(e[2],t.height,1,r)}function FLe(t,e,r){for(let i=0;i<3;i++){const n=t[i];switch(n){case"symbol-value":{const s=r[i];return s!=null?s/e[i]:1}case"proportional":break;default:if(n&&e[i])return n/e[i]}}return 1}async function z1t(t){const{computeObjectLayerResourceSize:e}=await ge(()=>import("./symbolLayerUtils-BTsPbDen.js"),__vite__mapDeps([])),r=await e(t,10),{width:i,height:n,depth:s}=t,o=[i,s,n];let a=1;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/r[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=r[l]*a);return{resourceSize:r,symbolSize:o}}function xR(t,e,r,i){switch(t){case"proportional":return r*i;case"symbol-value":return e??r;default:return t}}function U1t(t,e){const r=NLe(e);if(r!=null)switch(t.type){case"simple-marker":t.size=r;break;case"picture-marker":{const i=t.width/t.height;i>1?(t.width=r,t.height=r*i):(t.width=r*i,t.height=r);break}case"simple-line":t.width=r;break;case"text":t.font.size=r}}async function wHt(t,e){if(t&&e)return h2(t)?I1t(t,e):void(Q9(t)&&U1t(t,e))}function xHt(t,e,r){if(t&&e!=null)if(h2(t)){const i=t.symbolLayers;i&&i.forEach(n=>{if(n&&n.type==="object")switch(r){case"tilt":n.tilt=(n.tilt??0)+e;break;case"roll":n.roll=(n.roll??0)+e;break;default:n.heading=(n.heading??0)+e}})}else Q9(t)&&(t.type!=="simple-marker"&&t.type!=="picture-marker"&&t.type!=="text"||(t.angle+=e))}function THt(t){return t!=null&&t.type==="polygon-3d"&&t.symbolLayers.some(e=>e.type==="extrude")}async function SHt(t,e){return await t.fetchSymbol(e)||t.fetchCIMSymbol(e)}const CHt=1.2,B1t=qu,V1t=4;let WU=class{constructor(e,r,i,n){this.graphics3DSymbolLayer=e,this.renderGeometries=r,this.boundingBox=i,this._drapeSourceRenderer=n,this.type="draped",this.stage=null,this._visible=!1,this._addedToStage=!1,this.isElevationSource=!1}initialize(e){this.stage=e.stage}setVisibility(e){if(this.stage!=null&&this._visible!==e){if(this._visible=e,e&&!this._addedToStage)return this._addedToStage=!0,void this._drapeSourceRenderer.addGeometries(this.renderGeometries,en.ADD);if(e||this._addedToStage){for(const r of this.renderGeometries)r.visible=this._visible;this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,Is.VISIBILITY)}}}destroy(){this.stage&&this._addedToStage&&this._drapeSourceRenderer.removeGeometries(this.renderGeometries,en.REMOVE),this._addedToStage=!1,this._visible=!1,this.stage=null}getCenterObjectSpace(e=C()){return ie(e,0,0,0)}getBoundingBoxObjectSpace(e=vs()){return Li(e)}addObjectState(e,r){e===oy.Highlight&&(this.renderGeometries.forEach(i=>{const n=i.geometry.addHighlight();r.addRenderGeometry(i,n,this)}),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,Is.HIGHLIGHT))}removeObjectState(e){this.renderGeometries.forEach(r=>{e.removeRenderGeometry(r)})}removeRenderGeometryObjectState(e,r){e.geometry.removeHighlight(r),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,Is.HIGHLIGHT)}computeAttachmentOrigin(e){for(const r of this.renderGeometries)r.geometry.computeAttachmentOrigin(AT)&&(e.draped.origin[0]+=AT[0],e.draped.origin[1]+=AT[1],e.draped.num++)}async getProjectedBoundingBox(e,r,i,n,s){Li(s);for(let o=0;o<this.renderGeometries.length;o++){const a=this.renderGeometries[o];this._getRenderGeometryProjectedBoundingRect(a,e,eme,i),Aet(s,eme)}if(r){let o;kp(s,AT);const a=oie(s,r.service.spatialReference,r);try{o=await r.service.queryElevation(AT[0],AT[1],n,a,"ground")}catch{}o!=null&&(s[2]=Math.min(s[2],o),s[5]=Math.max(s[5],o))}return s}_getRenderGeometryProjectedBoundingRect(e,r,i,n){if(this.boundingBox)Y9(Nf,this.boundingBox);else{const s=e.boundingSphere,o=s[3];Nf[0]=s[0]-o,Nf[1]=s[1]-o,Nf[2]=s[2]-o,Nf[3]=s[0]+o,Nf[4]=s[1]+o,Nf[5]=s[2]+o}return r(Nf,0,2),this.calculateRelativeScreenBounds&&n.push({location:kp(Nf),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()}),$te(Nf,i)}};const eme=Wt(),Nf=vs(),AT=C();function $8(t,e,r){return t.canvas||(t.canvas=document.createElement("canvas")),t.canvas.width=e,t.canvas.height=r,t.canvas}function kLe(t){const{size:e}=t.definition,r=t.fontString(e);let i=tme.get(r);if(!i){const n=$8(j1t,0,0).getContext("2d");t.setFontProperties(n,e);const s=n.measureText(H1t);i=new G1t(s.actualBoundingBoxAscent,s.actualBoundingBoxDescent),tme.set(r,i)}return i}const tme=new Map;let G1t=class{get maxHeight(){return this.maxAscent+this.maxDescent}constructor(e,r){this.maxAscent=e,this.maxDescent=r}};const j1t={canvas:null},H1t=(()=>{let t="";for(let e=32;e<127;e++)t+=String.fromCharCode(e);return t})(),I8=1;let zLe=class{constructor(e,r,i,n){this.text=e,this._alignment=r,this._parameters=i,this._maxSize=n,this._textWidths=[],this._lineWidths=[],this._renderPixelRatio=null,this._metricsCached=null,this.key=`TextRenderer-${this._parameters.key}-${this._alignment}--${e}`,this._lines=e.replaceAll(" "," ").split(/\r?\n/)}get displayWidth(){return Math.ceil(this._displayWidth+2*this._horizontalPadding)}get displayHeight(){let e=this._metrics.firstLineAscent;for(let r=0;r<this._lines.length-1;r++)e+=this._lineSpacing;return e+=this._metrics.lastLineDescent,Math.ceil(e+2*this._haloSize+2*this._verticalPadding)}get renderedWidth(){return this._toRoundedRenderUnit(this.displayWidth)}get renderedHeight(){return this._toRoundedRenderUnit(this.displayHeight)}get firstRenderedBaselinePosition(){return this._toRenderUnit(this._firstLineYOffset+this._metrics.firstLineAscent)}get _firstLineYOffset(){return this._verticalPadding+this._haloSize}get _metrics(){if(this._metricsCached==null){const e=$8(rme,GN,GN).getContext("2d"),r=this._parameters.definition.pixelRatio,i=this._fontSize*r;this._parameters.setFontProperties(e,i);let n=2*this._haloSize;const s=this._parameters.definition.font;s.style!=="italic"&&s.style!=="oblique"&&s.weight!=="bold"&&s.weight!=="bolder"||(n+=.3*e.measureText("A").width),this._textWidths.length=0,this._lineWidths.length=0;let o=0,a=0,l=0,c=0,u=0;this._lines.forEach((b,w)=>{const x=e.measureText(b),S=x.width/r,E=S+n;this._textWidths.push(S),this._lineWidths.push(E),o=Math.max(o,E),c=Math.max(c,x.actualBoundingBoxAscent/r),u=Math.max(u,x.actualBoundingBoxDescent/r),w===0&&(a=x.actualBoundingBoxAscent/r),w===this._lines.length-1&&(l=x.actualBoundingBoxDescent/r)});const h=kLe(this._parameters),p=Math.max(c,h.maxAscent),f=Math.max(u,h.maxDescent),g=a,_=this._parameters.definition.font.decoration==="underline"?f:l,v=o;this._metricsCached=new q1t(g,_,p,f,v)}return this._metricsCached}get _lineSpacing(){return(this._midLineHeight+this._linePadding)*this._parameters.definition.lineSpacingFactor}get _midLineHeight(){return this._metrics.midLineHeight}get _linePadding(){return this._midLineHeight*W1t}get _midLineAscent(){return this._metrics.maxLineAscent}get _renderedFontSize(){return this._toRenderUnit(this._fontSize)}get _fontSize(){return this._parameters.definition.size}get _renderedHaloSize(){return this._toRenderUnit(this._haloSize)}get _haloSize(){return this._parameters.haloSize}get _horizontalPadding(){return this._hasBackground?this._parameters.definition.background.padding[0]:0}get _verticalPadding(){return Math.max(this._hasBackground?this._parameters.definition.background.padding[1]:0,I8)}get _hasBackground(){return!!this._parameters.backgroundStyle}get renderPixelRatio(){if(this._renderPixelRatio==null){const e=this._parameters.definition.pixelRatio;this._renderPixelRatio=Math.min(e,Math.min(this._maxSize[0]/this.displayWidth,this._maxSize[1]/this.displayHeight))}return this._renderPixelRatio}_getLineXOffset(e){switch(this._alignment){case Y1.Left:return this._horizontalPadding;case Y1.Center:return(this.displayWidth-this._lineWidths[e])/2;case Y1.Right:return this.displayWidth-this._horizontalPadding-this._lineWidths[e]}}render(e,r,i){e.save();const n=r/=this.renderPixelRatio,s=i/=this.renderPixelRatio,o=this._haloSize,a=this._firstLineYOffset+this._metrics.firstLineAscent;r+=o,i+=a;const l=this._haloSize>0;l&&this._renderHalo(e,n,s,o,a),this._parameters.setFontProperties(e,this._renderedFontSize);for(let c=0;c<this._lines.length;++c){const u=this._lines[c],h=this._getLineXOffset(c);l&&(e.globalCompositeOperation="destination-out",e.fillStyle="rgb(0, 0, 0)",this._fillText(e,u,r+h,i),this._renderLineDecoration(e,r+h,i,this._textWidths[c])),e.globalCompositeOperation="source-over",e.fillStyle=this._parameters.textStyle,this._fillText(e,u,r+this._getLineXOffset(c),i),this._renderLineDecoration(e,r+h,i,this._textWidths[c]),i+=this._lineSpacing}if(yi.TEXT_SHOW_BASELINE){e.strokeStyle=ime,e.setLineDash([2,2]),e.lineWidth=1;let c=s+a;for(let u=0;u<this._lines.length;++u)this._drawLine(e,[n,c],[n+this.displayWidth,c]),c+=this._lineSpacing}if(yi.TEXT_SHOW_BORDER&&(e.strokeStyle=ime,e.setLineDash([]),e.lineWidth=1,this._drawBox(e,[n,s],[this.displayWidth,this.displayHeight])),this._hasBackground){const c=this._parameters.definition.background.borderRadius*this.renderPixelRatio;this._roundedRect(e,n,s,c),e.globalCompositeOperation="destination-over",e.fillStyle=this._parameters.backgroundStyle,e.fill()}e.restore()}_renderLineDecoration(e,r,i,n,s=!1){if(this._parameters.definition.font.decoration==="none"||n===0)return;const o=1,a=Math.max(this._parameters.definition.size/16,o);switch(this._parameters.definition.font.decoration){case"underline":i+=2*a;break;case"line-through":i-=.33*this._midLineAscent}const l=s?this._haloSize:0;e.strokeStyle=s?this._parameters.haloStyle:this._parameters.textStyle,e.lineWidth=this._toRenderUnit(a+2*l),e.beginPath(),e.moveTo(this._toRenderUnit(r-l),this._toRenderUnit(i)),e.lineTo(this._toRenderUnit(r+n+l),this._toRenderUnit(i)),e.stroke()}_roundedRect(e,r,i,n){r=this._toRenderUnit(r),i=this._toRenderUnit(i);const s=this.renderedWidth,o=this.renderedHeight;n!==0?(n=we(n,0,Math.floor(o/2)),e.beginPath(),e.moveTo(r,i+n),e.arcTo(r,i,r+n,i,n),e.lineTo(r+s-n,i),e.arcTo(r+s,i,r+s,i+n,n),e.lineTo(r+s,i+o-n),e.arcTo(r+s,i+o,r+s-n,i+o,n),e.lineTo(r+n,i+o),e.arcTo(r,i+o,r,i+o-n,n),e.closePath()):e.rect(r,i,s,o)}_renderHalo(e,r,i,n,s){const o=this.renderedWidth,a=this.renderedHeight,l=$8(rme,Math.max(o,GN),Math.max(a,GN)),c=l.getContext("2d");c.clearRect(0,0,o,a),this._parameters.setFontProperties(c,this._renderedFontSize),c.fillStyle=this._parameters.haloStyle,c.strokeStyle=this._parameters.haloStyle;const u=this._renderedHaloSize<3;c.lineJoin=u?"miter":"round",u?this._renderHaloEmulated(c,n,s):this._renderHaloNative(c,n,s);let h=s;for(let p=0;p<this._lines.length;++p){const f=this._getLineXOffset(p);this._renderLineDecoration(c,n+f,h,this._textWidths[p],!0),h+=this._lineSpacing}e.globalAlpha=this._parameters.definition.halo.color[3],e.drawImage(l,0,0,o,a,this._toRenderUnit(r),this._toRenderUnit(i),o,a),e.globalAlpha=1}_renderHaloEmulated(e,r,i){for(let n=0;n<this._lines.length;++n){const s=this._lines[n],o=this._getLineXOffset(n);for(const[a,l]of ULe)this._fillText(e,s,r+o+this._haloSize*a,i+this._haloSize*l);i+=this._lineSpacing}}_renderHaloNative(e,r,i){const n=2*this._haloSize;for(let s=0;s<this._lines.length;++s){const o=this._lines[s],a=this._getLineXOffset(s),l=5,c=.1;for(let u=0;u<l;u++){const h=1-(l-1)*c+u*c;e.lineWidth=this._toRenderUnit(h*n),this._strokeText(e,o,r+a,i)}i+=this._lineSpacing}}get _displayWidth(){return this._metrics.displayWidth}_toRenderUnit(e){return e*this.renderPixelRatio}_toRoundedRenderUnit(e){return Math.round(e*this.renderPixelRatio)}_fillText(e,r,i,n){e.fillText(r,this._toRenderUnit(i),this._toRenderUnit(n))}_strokeText(e,r,i,n){e.strokeText(r,this._toRenderUnit(i),this._toRenderUnit(n))}_drawLine(e,r,i){e.beginPath(),e.moveTo(this._toRoundedRenderUnit(r[0])+.5,this._toRoundedRenderUnit(r[1])+.5),e.lineTo(this._toRoundedRenderUnit(i[0])+.5,this._toRoundedRenderUnit(i[1])+.5),e.stroke()}_drawBox(e,r,i){const n=this._toRenderUnit(r[0]),s=this._toRenderUnit(r[1]),o=this._toRenderUnit(i[0]),a=this._toRenderUnit(i[1]),l=Math.floor(n)+.5,c=Math.ceil(n+o)-.5,u=Math.floor(s)+.5,h=Math.ceil(s+a)-.5;e.beginPath(),e.moveTo(l,u),e.lineTo(c,u),e.lineTo(c,h),e.lineTo(l,h),e.lineTo(l,u),e.stroke()}};const ULe=[];for(let e=0;e<360;e+=360/16)ULe.push([Math.cos(Math.PI*e/180),Math.sin(Math.PI*e/180)]);var Y1;(function(t){t[t.Left=0]="Left",t[t.Center=1]="Center",t[t.Right=2]="Right"})(Y1||(Y1={}));const rme={canvas:null},W1t=.2,GN=512,ime="rgb(255, 0, 255, 0.5)";let q1t=class{get firstLineHeight(){return this.firstLineAscent+this.maxLineDescent}get midLineHeight(){return this.maxLineAscent+this.maxLineDescent}get lastLineHeight(){return this.maxLineAscent+this.lastLineDescent}constructor(e,r,i,n,s){this.firstLineAscent=e,this.lastLineDescent=r,this.maxLineAscent=i,this.maxLineDescent=n,this.displayWidth=s}};const Y1t=Object.freeze({left:0,center:.5,right:1}),CF=Object.freeze({"bottom-left":lr(0,0),bottom:lr(.5,0),"bottom-right":lr(1,0),left:lr(0,.5),center:lr(.5,.5),right:lr(1,.5),"top-left":lr(0,1),top:lr(.5,1),"top-right":lr(1,1)});function BLe(t){switch(t){case"left":return Y1.Left;case"right":return Y1.Right;default:return Y1.Center}}function nme(t){switch(t){case"bottom-left":case"left":case"top-left":return"left";case"bottom":case"center":case"top":return"center";case"bottom-right":case"right":case"top-right":return"right"}}function X1t(t){switch(t){case"bottom-left":case"bottom":case"bottom-right":return"bottom";case"left":case"center":case"right":return"center";case"top-left":case"top":case"top-right":return"top"}}function Z1t(t,e){switch(e){case"bottom":return t==="left"?"bottom-left":t==="right"?"bottom-right":"bottom";case"center":return t;case"top":return t==="left"?"top-left":t==="right"?"top-right":"top"}}function J1t(t){return t==="middle"?"center":t}function Q1t(t,e){switch(t){case"top":return cr(e,0,I8);case"bottom":return cr(e,0,-I8);default:return eo(e,ty)}}let v3=class{constructor(e,r={}){this.geometry=e,this.screenToWorldRatio=1,this._transformation=xe(),this._shaderTransformation=null,this._boundingSphere=null,this.id=Gu(),this.layerUid=r.layerUid,this.graphicUid=r.graphicUid,this.castShadow=r.castShadow??!1,r.objectShaderTransformation!=null&&this.objectShaderTransformationChanged(r.objectShaderTransformation)}get transformation(){return this._transformation}set transformation(e){Zn(this._transformation,e),this._boundingSphere=null}get boundingInfo(){return this.geometry.boundingInfo}objectShaderTransformationChanged(e){e==null?this._shaderTransformation=null:(this._shaderTransformation??(this._shaderTransformation=xe()),Hr(this._shaderTransformation,e,this.geometry.transformation)),this._boundingSphere=null}get boundingSphere(){return this.boundingInfo?(this._boundingSphere==null&&(this._boundingSphere??(this._boundingSphere=Jn()),Ge(this._boundingSphere,this.boundingInfo.center,this.shaderTransformation),this._boundingSphere[3]=this.boundingInfo.radius*qE(this.shaderTransformation)),this._boundingSphere):GSe}get material(){return this.geometry.material}get type(){return this.geometry.type}get shaderTransformation(){return this._shaderTransformation??this.transformation}get attributes(){return this.geometry.attributes}get highlights(){return this.geometry.highlights}get occludees(){return this.geometry.occludees}get visible(){return this.geometry.visible}set visible(e){this.geometry.visible=e}};const sme=Ce(0,0,1),K1t=16,evt=1.5,mx=$ie,tvt=[mx/2,mx/2,1-mx/2,1-mx/2],rvt=[x8*mx,x8*mx];let sJ=class VLe extends Sg{getCachedSize(){return{size:this._getIconSize()}}constructor(e,r,i,n){super(e,r,i,n),this._cimSymbolMaterials=new Map,this._cimSymbolTextures=new Map,this._cimMaterialParametersInfo=null,this._size=null,this._symbolTextureRatio=1,this._outlineSize=0,this._patchTask=null,this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0}}async doLoad(e){this._validateOrThrow();const r=this._prepareMaterialParameters(),i=this._getPrimitive();if(i!=null)this._prepareResourcesPrimitive(r,i);else{const n=M1t(this.symbolLayer),s=rv(n);s&&s.mediaType==="application/json"?await this._prepareResourcesCIM(r,JSON.parse(s.data),e):await this._prepareResourcesHref(r,n,e)}}_validateOrThrow(){if(this._drivenProperties.size)return;const e=RU(this._getIconSize());if(e)throw new K("graphics3diconsymbollayer:invalid-size",e)}_getIconSize(){const e=this.symbolLayer,r=Math.round(e.size!=null?fs(e.size):K1t);return this._drivenProperties.size?Math.max(r,64):r}_generateTextureCIM(e){let r=this._cimData;if(r&&r.symbol||this.logger.error("Can't create texture, CIM data is undefined"),r.primitiveOverrides){r=_e(r);const c=r.primitiveOverrides;aO.evaluateOverrides(c,e,this._arcadeInfo.geometryType,null,null),aO.applyOverrides(r.symbol,c)}const i=CK(JSON.stringify(r));let n=this._cimSymbolTextures.get(i);if(n)return n;const s=this._context.sharedResources.cimSymbolRasterizer,o=this._context.renderer&&this._context.renderer.type==="dictionary"?this._context.renderer.fieldMap:null;o&&aO.applyDictionaryTextOverrides(r.symbol,e,o,null);const a=this._cimScaleFactorOrFunction!=null?iyt(this._cimScaleFactorOrFunction,e):1;a!==1&&r.symbol&&Yie(r.symbol,a,!0);const l=vG.getEnvelope(r,null,s.resourceManager);if(l&&l.width&&l.height){const c=l.x+l.width/2,u=l.y+l.height/2,h=s.rasterize({type:"cim",data:r},l.width,l.height,c,u,1,"esriGeometryPoint"),p=new dx({x:-l.x/l.width-.5,y:(l.height+l.y)/l.height-.5});this._cimMaterialParametersInfo.anchorPosition=this._getAnchorPos("relative",p),n=new Pv(h,{width:(h==null?void 0:h.width)??1,height:(h==null?void 0:h.height)??1})}else n=new Pv(new ImageData(1,1),{width:1,height:1});return this._cimSymbolTextures.set(i,n),this._context.stage.add(n),n}_prepareMaterialParameters(){const e={anchorPosition:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},r=this.symbol;if(ivt(r)){const{screenLength:i,minWorldLength:n,maxWorldLength:s}=r.verticalOffset;e.verticalOffset={screenLength:fs(i),minWorldLength:n||0,maxWorldLength:s??1/0}}return this._context.screenSizePerspectiveEnabled&&(e.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),e.occlusionTest=!0,e.hasSlicePlane=this._context.slicePlaneEnabled,e}_prepareResourcesPrimitive(e,r){const i=this._getOutlineSize();if(wG(r)&&i===0)throw new Error("Nothing to render");if(this._outlineSize=i,e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,this._context.sharedResources.textures!=null){const s=this._context.sharedResources.textures.fromData(`${r}-icon`,()=>Umt(r));this._textureHandle=s,e.textureId=s.texture.id}e.textureIsSignedDistanceField=!0,e.sampleSignedDistanceFieldTexelCenter=zmt(r),e.distanceFieldBoundingBox=tvt;const n=this._getIconSize();this._size=[n,n],this._symbolTextureRatio=1/mx,this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesHref(e,r,i){this._outlineSize=this._getOutlineSize(),e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,e.textureIsSignedDistanceField=!1;const n=this._getIconSize(),s=n*this._context.graphicsCoreOwner.view.state.rasterPixelRatio;if(this._context.sharedResources.textures!=null){const o=await sg(this._context.sharedResources.textures.fromUrl(r,s,{signal:i}));if(o.ok===!1)throw J0(o.error),new K("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${r})`);this._textureHandle=o.value;const a=o.value.texture;this._size=this._computeSizeFromTexture(a,n),e.textureId=a.id}this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesCIM(e,r,i){if(this._cimData=r,!this._context.sharedResources.cimSymbolRasterizer){const u=(await ge(()=>import("./CIMSymbolRasterizer-D1D8-atg.js"),__vite__mapDeps([]))).CIMSymbolRasterizer;vt(i),this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new u(this._context.renderCoordsHelper.spatialReference))}const n=this._context.sharedResources.cimSymbolRasterizer,s=[],o=r,a=o==null?void 0:o.symbol;vG.fetchResources(a,n.resourceManager,s,i),vG.fetchFonts(a,n.resourceManager,s);const l=this._context.layer.fields?this._context.layer.fields.map(u=>u.toJSON()):[],c=this._context.renderCoordsHelper.spatialReference;if(this._arcadeInfo={spatialReference:c,fields:l,geometryType:"esriGeometryPoint"},o!=null&&o.primitiveOverrides&&s.push(aO.createRenderExpressions(o.primitiveOverrides,this._arcadeInfo)),s.length>0&&(await Promise.all(s),vt(i)),this._context.renderer&&this._context.renderer.type==="dictionary"&&this._context.renderer.scaleExpression){const u=this._context.renderer;if(u.scaleExpression){const h=u.scaleExpression,p=await OEe(h,this._context.layer.spatialReference,l);this._cimScaleFactorOrFunction=(f,g,_)=>{const v=$Le(p,f,{$view:_},"esriGeometryPoint",g);return v!==null?v:1}}}vt(i),this._cimMaterialParametersInfo=e,this._cimMaterialParametersInfo.color=this._getFillColor(),this._cimMaterialParametersInfo.outlineColor=[0,0,0,0],this._cimMaterialParametersInfo.outlineSize=0,this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1}_getPrimitive(){return this.symbolLayer.resource&&this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||Wet}_getOutlineSize(){var i;let e=0;const r=this.symbolLayer;return((i=r.outline)==null?void 0:i.size)!=null?Math.max(fs(r.outline.size),0):(e=wG(this._getPrimitive())?evt:0,Math.max(e,0))}_getOutlineColor(){var n;const e=this._getLayerOpacity(),r=this.symbolLayer,i=(n=r==null?void 0:r.outline)==null?void 0:n.color;if(i!=null){const s=Xe.toUnitRGB(i),o=i.a*e;return[s[0],s[1],s[2],o]}return[0,0,0,0]}_getFillColor(){var i,n;if(wG(this._getPrimitive()))return B1t;const e=this._getPrimitive()==null,r=(n=(i=this.symbolLayer)==null?void 0:i.material)==null?void 0:n.color;return this._getCombinedOpacityAndColor(r,{hasIntrinsicColor:e})}_getAnchorPos(e,r){return e==="relative"?lr((r.x||0)+.5,.5-(r.y||0)):e in CF?CF[e]:CF.center}_createMaterialAndAddToStage(e,r){if(this._cimData){this._fastUpdates=null;let i=e.textureId?this._cimSymbolMaterials.get(e.textureId):null;return i||(i=new p3(e),this._cimSymbolMaterials.set(e.textureId??0,i),r.add(i)),i}return this._fastUpdates=u3(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates&&(e={...e,...this._fastUpdates.materialParameters}),this._materials[0]=new p3(e),r.add(this._materials[0]),this._materials[0]}_setDrapingDependentMaterialParameters(){this.draped&&(this._forEachMaterial(e=>{e.setParameters({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,hasSlicePlane:!1,shaderPolygonOffset:0,draped:this.draped})}),this.layerOpacityChanged())}destroy(){super.destroy(),this._patchTask=wl(this._patchTask),this._forEachMaterial(e=>this._context.stage.remove(e)),this._materials.length=0,this._cimSymbolMaterials.clear(),this._cimSymbolTextures.forEach(e=>this._context.stage.remove(e)),this._cimSymbolTextures.clear(),this._textureHandle=tr(this._textureHandle)}_getScaleFactor(e,r){if(this._drivenProperties.size&&e.size){for(let i=0;i<3;i++){const n=e.size[i];n&&n!=="symbol-value"&&n!=="proportional"&&(e.size[i]=fs(n))}if(e.size[0]==="symbol-value")return 1;if(isFinite(+e.size[0]))return+e.size[0]/r;if(isFinite(+e.size[2]))return+e.size[2]/r}return 1}createGraphics3DGraphic(e){var h;const r=e.graphic;if(!this._validateGeometry(r.geometry))return null;let i,n=[0,0];if(this._cimData){if(!this._cimData.symbol)return null;const p=this._generateTextureCIM(r),f={textureId:p.id,...this._cimMaterialParametersInfo};i=this._createMaterialAndAddToStage(f,this._context.stage),n=[p.parameters.width,p.parameters.height]}else n=this._size,i=this._materials[0];const s=q$(r.geometry);if(s==null)return this.logger.warn(`unsupported geometry type for icon symbol: ${r.geometry.type}`),null;const o=e.renderingInfo,a=this._getVertexOpacityAndColor(o);let l=1;if(!((h=this._fastUpdates)!=null&&h.visualVariables.size)){const p=n[0]>n[1]?n[0]:n[1];l=this._getScaleFactor(o,p)}l*=this._symbolTextureRatio;const c=lr(n[0]*l,n[1]*l),u=this.setGraphicElevationContext(r);return this.ensureDrapedStatus(u.mode==="on-the-ground")&&this._setDrapingDependentMaterialParameters(),this.draped?this._createAsOverlay(r,s,i,a,c,e.layer.uid):this._createAs3DShape(r,s,i,a,c,u,r.uid)}layerOpacityChanged(){const e=this._getFillColor(),r=this._getOutlineColor();this._forEachMaterial(i=>{i.setParameters({color:e}),i.setParameters({outlineColor:r})})}layerElevationInfoChanged(e,r,i){const n=this._elevationContext.mode,s=eL(VLe.elevationModeChangeTypes,i,n);if(s!==En.UPDATE)return s;const o=bd(n)||n==="absolute-height";return this.updateGraphics3DGraphicElevationInfo(e,r,()=>o)}slicePlaneEnabledChanged(){return this.draped||this._forEachMaterial(e=>{e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}get pixelRatioChanged(){return this._getPrimitive()!=null}applyRendererDiff(e,r){var i;for(const n in e.diff){if(n!=="visualVariables"||!h3(this._fastUpdates,r,this._fastVisualVariableConvertOptions()))return Xn.RecreateSymbol;(i=this._materials[0])==null||i.setParameters(this._fastUpdates.materialParameters)}return Xn.FastUpdate}prepareSymbolLayerPatch(e){var i;if((i=this._patchTask)==null||i.abort(),e.diff.type!=="partial")return;const r=e.diff.diff;this._preparePatchResource(e,r)}_preparePatchResource(e,r){var l;if(!r.resource||r.resource.type!=="partial")return;const i=r.resource.diff;if(((l=i==null?void 0:i.href)==null?void 0:l.type)!=="complete")return;const n=i.href.newValue,{textures:s}=this._context.sharedResources;if(n==null||s==null)return;const o=this._getIconSize(),a=o*this._context.graphicsCoreOwner.view.state.pixelRatio;e.symbolLayerStatePatches.push(()=>{this._patchTask=wl(this._patchTask),this._patchTask=dy(c=>this._context.schedule(async(u,h)=>{const p=await sg(s.fromUrl(n,a,{signal:h}));vt(h);const f=!p.ok;if(f&&J0(p.error),this._textureHandle=tr(this._textureHandle),this._patchTask=null,f){this._forEachMaterial(v=>{v.visible=!1,v.setParameters({textureId:null})});const _=`Failed to load (Request for icon resource failed: ${n})`;return void this.logger.error(new K("graphics3diconsymbollayer:request-failed",_))}this._textureHandle=p.value;const g=p.value.texture;this._size=this._computeSizeFromTexture(g,o),this._forEachMaterial(_=>{_.setParameters({textureId:g.id}),_.visible=!0})},c))}),delete i.href}_defaultElevationInfoNoZ(){return nvt}_createAs3DShape(e,r,i,n,s,o,a){const l=this.getFastUpdateAttrValues(e),c=this._context.layer.uid,u=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:a,layerUid:c}),h=oZ(i,sme,null,n,s,svt,null,l,u),p=mie(this._context,r,h,o,a);if(p==null)return null;const f=new Tg(this,p.object,[h],null,null,Lx,o);return f.alignedSampledElevation=p.sampledElevation,f.needsElevationUpdates=bd(o.mode)||o.mode==="absolute-height",f.getScreenSize=this._createScreenSizeGetter(s,l),f.calculateRelativeScreenBounds=g=>i.calculateRelativeScreenBounds(f.getScreenSize(),1,g),W$(f,r,this._context.elevationProvider),f}_createAsOverlay(e,r,i,n,s,o){i.renderPriority=this._renderPriority;const a=C();_n(r,a,this._context.overlaySR),a[2]=Uie;const l=this._context.clippingExtent;if(l!=null&&!Rte(l,a))return null;const c=this.getFastUpdateAttrValues(e),u=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:e.uid,layerUid:this._context.layer.uid}),h=oZ(i,sme,a,n,s,null,null,c,u),p=new v3(h,{layerUid:o,graphicUid:e.uid}),f=new WU(this,[p],null,this._context.drapeSourceRenderer);return f.getScreenSize=this._createScreenSizeGetter(s,c),f.calculateRelativeScreenBounds=g=>i.calculateRelativeScreenBounds(f.getScreenSize(),1,g),f}_createScreenSizeGetter(e,r){const i=this._outlineSize+2;if(this._fastUpdates&&r){const o=e[0]/this._symbolTextureRatio,a=e[1]/this._symbolTextureRatio;return(l=He())=>{const[c,u]=Hre(ovt,this._fastUpdates.materialParameters,r);return l[0]=c*o+i,l[1]=u*a+i,l}}const n=e[0]/this._symbolTextureRatio+i,s=e[1]/this._symbolTextureRatio+i;return(o=He())=>(o[0]=n,o[1]=s,o)}_fastVisualVariableConvertOptions(){const e=Math.max(this._size[0],this._size[1]),r=Ce(e,e,e),i=xl(1),n=e*i,s=Ce(n,n,n);return new JI({size:!0,color:!0,rotation:!0,opacity:!1},r,s,i)}_forEachMaterial(e){this._materials.forEach(e),this._cimSymbolMaterials.forEach(e)}_computeSizeFromTexture({parameters:e},r){const i=(e.width??1)/(e.height??1);return i>1?[r,Math.round(r/i)]:[Math.round(r*i),r]}test(){return{...super.test(),material:this._materials[0]}}};function ivt(t){return t&&t.type==="point-3d"&&t.hasVisibleVerticalOffset()}function wG(t){return t!=null&&(t==="cross"||t==="x")}sJ.PRIMITIVE_SIZE=rvt,sJ.elevationModeChangeTypes={definedChanged:En.UPDATE,staysOnTheGround:En.NONE,onTheGroundChanged:En.RECREATE};const nvt={mode:"relative-to-ground",offset:0},svt=Bt(0,0,0,1),ovt=C();function oJ(t){switch(t){case"butt":return sd.BUTT;case"square":return sd.SQUARE;case"round":return sd.ROUND;default:return null}}function ome(t){return t==="diamond"?"kite":t}function aJ(t,e,r=null){const i=[],n=e.mapPositions;avt(e,i);const s=i[0][1].data,o=i[0][1].indices.length,a=Uv(o);return lvt(e,i,a),hvt(e,i,a),cvt(e,i,a),uvt(e,i,a),dvt(e,i,a),pvt(e,i,a),fvt(e,i,s),new gs(t,i,n,Cn.Line,r)}function avt(t,e){const{attributeData:{position:r},removeDuplicateStartEnd:i}=t,n=mvt(r)&&i,s=r.length/3-(n?1:0),o=new Array(2*(s-1)),a=n?r.slice(0,-3):r;let l=0;for(let c=0;c<s-1;c++)o[l++]=c,o[l++]=c+1;e.push([R.POSITION,new Ye(a,o,3,n)])}function lvt(t,e,r){if(t.attributeData.colorFeature!=null)return;const i=t.attributeData.color;e.push([R.COLOR,new Ye(i??qh,r,4)])}function cvt(t,e,r){t.attributeData.normal&&e.push([R.NORMAL,new Ye(t.attributeData.normal,r,3)])}function uvt(t,e,r){t.attributeData.colorFeature!=null&&e.push([R.COLORFEATUREATTRIBUTE,new Ye([t.attributeData.colorFeature],r,1,!0)])}function hvt(t,e,r){t.attributeData.sizeFeature==null&&e.push([R.SIZE,new Ye([t.attributeData.size??1],r,1,!0)])}function dvt(t,e,r){t.attributeData.sizeFeature!=null&&e.push([R.SIZEFEATUREATTRIBUTE,new Ye([t.attributeData.sizeFeature],r,1,!0)])}function pvt(t,e,r){t.attributeData.opacityFeature!=null&&e.push([R.OPACITYFEATUREATTRIBUTE,new Ye([t.attributeData.opacityFeature],r,1,!0)])}function fvt(t,e,r){if(t.overlayInfo==null||t.overlayInfo.renderCoordsHelper.viewingMode!==De.Global||!t.overlayInfo.spatialReference.isGeographic)return;const i=xo(r.length),n=Br(t.overlayInfo.spatialReference);for(let h=0;h<i.length;h+=3)Dee(r,h,i,h,n);const s=r.length/3,o=mn(s+1);let a=gvt,l=yvt,c=0,u=0;cr(a,i[u++],i[u++]),u++,o[0]=0;for(let h=1;h<s+1;++h)h===s&&(u=0),cr(l,i[u++],i[u++]),u++,c+=bPe(a,l),o[h]=c,[a,l]=[l,a];e.push([R.DISTANCETOSTART,new Ye(o,e[0][1].indices,1,!0)])}function mvt(t){const e=t.length;return t[0]===t[e-3]&&t[1]===t[e-2]&&t[2]===t[e-1]}const gvt=He(),yvt=He();function RHt(t,e){if(t==null||t.length===0)return[];const r=[];return t.forEach(i=>{const n=i.length,s=xo(3*n);i.forEach((a,l)=>{s[3*l]=a[0],s[3*l+1]=a[1],s[3*l+2]=a[2]});const o={attributeData:{position:s,normal:e},removeDuplicateStartEnd:!1};r.push(o)}),r}function _vt(t,e,r,i){const n=t.type==="polygon"?fg.CCW_IS_HOLE:fg.NONE,s=t.type==="polygon"?t.rings:t.paths,{position:o,outlines:a}=aL(s,!!t.hasZ,n,t.spatialReference),l=xo(o.length),c=rRe(o,t.spatialReference,0,l,0,o,0,o.length/3,e,r,i),u=c!=null;return{lines:u?GLe(a,o,l):[],projectionSuccess:u,sampledElevation:c}}function vvt(t,e){const r=t.type==="polygon"?fg.CCW_IS_HOLE:fg.NONE,i=t.type==="polygon"?t.rings:t.paths,{position:n,outlines:s}=aL(i,!1,r),o=Ji(n,t.spatialReference,0,n,e,0,n.length/3);for(let a=2;a<n.length;a+=3)n[a]=Uie;return{lines:o?GLe(s,n):[],projectionSuccess:o}}function GLe(t,e,r=null){const i=new Array;for(const{index:n,count:s}of t){if(s<=1)continue;const o=3*n,a=3*s;i.push({position:nd(e,3*n,3*s),mapPositions:r!=null?nd(r,o,a):void 0})}return i}function jLe(t){const e=new Or,r=t.multipassEnabled&&(t.output===U.Color||t.output===U.Alpha),i=t.space===rc.World;e.include(J$e,t),e.include(fIe,t),t.output===U.LinearDepth&&e.include(ly,t);const{vertex:n,fragment:s}=e;return s.include(Td),Zc(n,t),e.attributes.add(R.POSITION,"vec3"),e.attributes.add(R.PREVPOSITION,"vec3"),e.attributes.add(R.UV0,"vec2"),e.varyings.add("vColor","vec4"),e.varyings.add("vpos","vec3"),e.varyings.add("vUV","vec2"),e.varyings.add("vSize","float"),_v(e),r&&e.varyings.add("depth","float"),t.hasTip&&e.varyings.add("vLineWidth","float"),n.uniforms.add(new ti("nearFar",(o,a)=>a.camera.nearFar),new xr("viewport",(o,a)=>a.camera.fullViewport)),n.code.add(T`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),n.code.add(T`void clip(vec4 pos, inout vec4 prev) {
float vnp = nearFar[0] * 0.99;
if (prev.z > -nearFar[0]) {
float interpolation = (-vnp - pos.z) / (prev.z - pos.z);
prev = mix(pos, prev, interpolation);
}
}`),i?(e.attributes.add(R.NORMAL,"vec3"),o3(n),n.constants.add("tiltThreshold","float",.7),n.code.add(T`vec3 perpendicular(vec3 v) {
vec3 n = (viewNormal * vec4(normal.xyz, 1.0)).xyz;
vec3 n2 = cross(v, n);
vec3 forward = vec3(0.0, 0.0, 1.0);
float tiltDot = dot(forward, n);
return abs(tiltDot) < tiltThreshold ? n : n2;
}`)):n.code.add(T`vec2 perpendicular(vec2 v) {
return vec2(v.y, -v.x);
}`),n.code.add(T`
      #define vecN ${i?"vec3":"vec2"}

      vecN normalizedSegment(vecN pos, vecN prev) {
        vecN segment = pos - prev;
        float segmentLen = length(segment);

        // normalize or zero if too short
        return (segmentLen > 0.001) ? segment / segmentLen : ${i?"vec3(0.0, 0.0, 0.0)":"vec2(0.0, 0.0)"};
      }

      vecN displace(vecN pos, vecN prev, float displacementLen) {
        vecN segment = normalizedSegment(pos, prev);

        vecN displacementDirU = perpendicular(segment);
        vecN displacementDirV = segment;

        ${t.anchor===_2.Tip?"pos -= 0.5 * displacementLen * displacementDirV;":""}

        return pos + displacementLen * (uv0.x * displacementDirU + uv0.y * displacementDirV);
      }
    `),t.space===rc.Screen&&(n.uniforms.add(new ln("inverseProjectionMatrix",(o,a)=>a.camera.inverseProjectionMatrix)),n.code.add(T`vec3 inverseProject(vec4 posScreen) {
posScreen.xy = (posScreen.xy / viewport.zw) * posScreen.w;
return (inverseProjectionMatrix * posScreen).xyz;
}`),n.code.add(T`bool rayIntersectPlane(vec3 rayDir, vec3 planeOrigin, vec3 planeNormal, out vec3 intersection) {
float cos = dot(rayDir, planeNormal);
float t = dot(planeOrigin, planeNormal) / cos;
intersection = t * rayDir;
return abs(cos) > 0.001 && t > 0.0;
}`),n.uniforms.add(new $e("perScreenPixelRatio",(o,a)=>a.camera.perScreenPixelRatio)),n.code.add(T`
      vec4 toFront(vec4 displacedPosScreen, vec3 posLeft, vec3 posRight, vec3 prev, float lineWidth) {
        // Project displaced position back to camera space
        vec3 displacedPos = inverseProject(displacedPosScreen);

        // Calculate the plane that we want the marker to lie in. Note that this will always be an approximation since ribbon lines are generally
        // not planar and we do not know the actual position of the displaced prev vertices (they are offset in screen space, too).
        vec3 planeNormal = normalize(cross(posLeft - posRight, posLeft - prev));
        vec3 planeOrigin = posLeft;

        ${t.hasCap?`
                if(prev.z > posLeft.z) {
                  vec2 diff = posLeft.xy - posRight.xy;
                  planeOrigin.xy += perpendicular(diff) / 2.0;
                }
              `:""};

        // Move the plane towards the camera by a margin dependent on the line width (approximated in world space). This tolerance corrects for the
        // non-planarity in most cases, but sharp joins can place the prev vertices at arbitrary positions so markers can still clip.
        float offset = lineWidth * perScreenPixelRatio;
        planeOrigin *= (1.0 - offset);

        // Intersect camera ray with the plane and make sure it is within clip space
        vec3 rayDir = normalize(displacedPos);
        vec3 intersection;
        if (rayIntersectPlane(rayDir, planeOrigin, planeNormal, intersection) && intersection.z < -nearFar[0] && intersection.z > -nearFar[1]) {
          return vec4(intersection.xyz, 1.0);
        }

        // Fallback: use depth of pos or prev, whichever is closer to the camera
        float minDepth = planeOrigin.z > prev.z ? length(planeOrigin) : length(prev);
        displacedPos *= minDepth / length(displacedPos);
        return vec4(displacedPos.xyz, 1.0);
      }
  `)),Y3(n),sU(e),n.code.add(T`void main(void) {
if (uv0.y == 0.0) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
}
else {
float lineWidth = getLineWidth();
float screenMarkerSize = getScreenMarkerSize();
vec4 pos  = view * vec4(position, 1.0);
vec4 prev = view * vec4(prevPosition, 1.0);
clip(pos, prev);`),i?(t.hideOnShortSegments&&n.code.add(T`if (areWorldMarkersHidden(pos, prev)) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
return;
}`),n.code.add(T`pos.xyz = displace(pos.xyz, prev.xyz, getWorldMarkerSize(pos));
vec4 displacedPosScreen = projectAndScale(pos);`)):(n.code.add(T`vec4 posScreen = projectAndScale(pos);
vec4 prevScreen = projectAndScale(prev);
vec4 displacedPosScreen = posScreen;
displacedPosScreen.xy = displace(posScreen.xy, prevScreen.xy, screenMarkerSize);`),t.space===rc.Screen&&n.code.add(T`vec2 displacementDirU = perpendicular(normalizedSegment(posScreen.xy, prevScreen.xy));
vec3 lineRight = inverseProject(posScreen + lineWidth * vec4(displacementDirU.xy, 0.0, 0.0));
vec3 lineLeft = pos.xyz + (pos.xyz - lineRight);
pos = toFront(displacedPosScreen, lineLeft, lineRight, prev.xyz, lineWidth);
displacedPosScreen = projectAndScale(pos);`)),n.code.add(T`
        ${r?"depth = pos.z;":""}
        linearDepth = calculateLinearDepth(nearFar,pos.z);

        // Convert back into NDC
        displacedPosScreen.xy = (displacedPosScreen.xy / viewport.zw) * displacedPosScreen.w;

        // Convert texture coordinate into [0,1]
        vUV = (uv0 + 1.0) / 2.0;

        ${i?"":"vUV *= displacedPosScreen.w;"}

        ${t.hasTip?"vLineWidth = lineWidth;":""}

        vSize = screenMarkerSize;
        vColor = getColor();

        // Use camera space for slicing
        vpos = pos.xyz;

        gl_Position = displacedPosScreen;
      }
    }
  `),r&&e.include(iu,t),e.include(Fn,t),s.uniforms.add(new xr("intrinsicColor",o=>o.color),new ct("tex",o=>o.markerTexture)),s.include(xg),e.constants.add("texelSize","float",1/Fx),s.code.add(T`float markerAlpha(vec2 samplePos) {
samplePos += vec2(0.5, -0.5) * texelSize;
float sdf = rgba2float(texture(tex, samplePos)) - 0.5;
float distance = sdf * vSize;
distance -= 0.5;
return clamp(0.5 - distance, 0.0, 1.0);
}`),t.hasTip&&(e.constants.add("relativeMarkerSize","float",Iie/Fx),e.constants.add("relativeTipLineWidth","float",Xmt),s.code.add(T`
    float tipAlpha(vec2 samplePos) {
      // Convert coordinates s.t. they are in pixels and relative to the tip of an arrow marker
      samplePos -= vec2(0.5, 0.5 + 0.5 * relativeMarkerSize);
      samplePos *= vSize;

      float halfMarkerSize = 0.5 * relativeMarkerSize * vSize;
      float halfTipLineWidth = 0.5 * max(1.0, relativeTipLineWidth * vLineWidth);

      ${i?"halfTipLineWidth *= fwidth(samplePos.y);":""}

      float distance = max(abs(samplePos.x) - halfMarkerSize, abs(samplePos.y) - halfTipLineWidth);
      return clamp(0.5 - distance, 0.0, 1.0);
    }
  `)),e.constants.add("symbolAlphaCutoff","float",Fo),s.code.add(T`
  void main() {
    discardBySlice(vpos);
    ${r?"terrainDepthTest(depth);":""}

    vec4 finalColor = intrinsicColor * vColor;

    ${i?"vec2 samplePos = vUV;":"vec2 samplePos = vUV * gl_FragCoord.w;"}

    ${t.hasTip?"finalColor.a *= max(markerAlpha(samplePos), tipAlpha(samplePos));":"finalColor.a *= markerAlpha(samplePos);"}

    ${t.output===U.ObjectAndLayerIdColor?T`finalColor.a = 1.0;`:""}

    if (finalColor.a < symbolAlphaCutoff) {
      discard;
    }

    ${t.output===U.Alpha?T`fragColor = vec4(finalColor.a);`:""}
    ${t.output===U.Color?T`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===U.Color&&t.transparencyPassType===ft.Color?"fragColor = premultiplyAlpha(fragColor);":""}
    ${t.output===U.Highlight?T`fragColor = vec4(1.0);`:""}
    ${t.output===U.LinearDepth?T`outputDepth(linearDepth);`:""}
  }
  `),e}const bvt=Object.freeze(Object.defineProperty({__proto__:null,build:jLe},Symbol.toStringTag,{value:"Module"})),HLe=new Map([[R.POSITION,0],[R.PREVPOSITION,1],[R.UV0,2],[R.NORMAL,3],[R.COLOR,4],[R.COLORFEATUREATTRIBUTE,4],[R.SIZE,5],[R.SIZEFEATUREATTRIBUTE,5],[R.OPACITYFEATUREATTRIBUTE,6]]);let WLe=class qLe extends Vr{initializeProgram(e){return new Lr(e.rctx,qLe.shader.get().build(this.configuration),HLe)}_makePipelineState(e,r){const i=this.configuration,n=e===ft.NONE;return kt({blending:i.output===U.Color||i.output===U.Alpha?n?Zu:Cy(e):null,depthTest:i.space===rc.Draped?null:{func:Gv(e)},depthWrite:i.space===rc.Draped?null:n?i.writeDepth?ru:null:EU(e),colorWrite:Yt,stencilWrite:i.hasOccludees?pg:null,stencilTest:i.hasOccludees?r?Cv:jv:null,polygonOffset:{factor:0,units:-10}})}initializePipeline(){return this.configuration.occluder&&(this._occluderPipelineTransparent=kt({blending:Zu,depthTest:m8,depthWrite:null,colorWrite:Yt,stencilWrite:null,stencilTest:ERe}),this._occluderPipelineOpaque=kt({blending:Zu,depthTest:m8,depthWrite:null,colorWrite:Yt,stencilWrite:SRe,stencilTest:CRe}),this._occluderPipelineMaskWrite=kt({blending:null,depthTest:lie,depthWrite:null,colorWrite:null,stencilWrite:pg,stencilTest:Cv})),this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}getPipeline(e,r,i){return e?this._occludeePipelineState:this.configuration.occluder?i?this._occluderPipelineTransparent:r?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipeline()}};WLe.shader=new Ir(bvt,()=>ge(()=>Promise.resolve().then(()=>JNt),void 0));let wvt=class extends Bv{constructor(e){super(e,new Tvt),this.produces=new Map([[ue.OPAQUE_MATERIAL,r=>r===U.Highlight||z0(r)&&this.parameters.renderOccluded===kr.OccludeAndTransparentStencil],[ue.OPAQUE_NO_SSAO_DEPTH,r=>r===U.LinearDepth],[ue.OCCLUDER_MATERIAL,r=>Wue(r)&&this.parameters.renderOccluded===kr.OccludeAndTransparentStencil],[ue.TRANSPARENT_OCCLUDER_MATERIAL,r=>Wue(r)&&this.parameters.renderOccluded===kr.OccludeAndTransparentStencil],[ue.TRANSPARENT_MATERIAL,r=>z0(r)&&this.parameters.writeDepth],[ue.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,r=>z0(r)&&!this.parameters.writeDepth],[ue.DRAPED_MATERIAL,r=>r===U.Color||r===U.Highlight]]),this._vertexAttributeLocations=HLe,this._configuration=new lo,this._layout=this.createLayout()}getConfiguration(e,r){return this._configuration.output=e,this._configuration.space=r.slot===ue.DRAPED_MATERIAL?rc.Draped:this.parameters.worldSpace?rc.World:rc.Screen,this._configuration.hideOnShortSegments=this.parameters.hideOnShortSegments,this._configuration.hasCap=this.parameters.cap!==sd.BUTT,this._configuration.anchor=this.parameters.anchor,this._configuration.hasTip=this.parameters.hasTip,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.occluder=this.parameters.renderOccluded===kr.OccludeAndTransparentStencil,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.multipassEnabled=r.multipassEnabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}intersect(){}createLayout(){const e=Qi().vec3f(R.POSITION).vec3f(R.PREVPOSITION).vec2f(R.UV0);return this.parameters.worldSpace&&e.vec3f(R.NORMAL),this.parameters.vvSize?e.f32(R.SIZEFEATUREATTRIBUTE):e.f32(R.SIZE),this.parameters.vvColor?e.f32(R.COLORFEATUREATTRIBUTE):e.vec4f(R.COLOR),this.parameters.vvOpacity&&e.f32(R.OPACITYFEATUREATTRIBUTE),e}createBufferWriter(){return new Svt(this._layout,this.parameters)}createGLMaterial(e){return new xvt(e)}},xvt=class extends tre{constructor(){super(...arguments),this._markerPrimitive=null}dispose(){super.dispose(),this._markerTextureRepository.release(this._markerPrimitive),this._markerPrimitive=null}_updateParameters(e){const r=this._material.parameters.markerPrimitive;return r!==this._markerPrimitive&&(this._material.setParameters({markerTexture:this._markerTextureRepository.swap(r,this._markerPrimitive)}),this._markerPrimitive=r),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(WLe,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==U.Color&&this._output!==U.Alpha||this._updateOccludeeState(e),this._updateParameters(e)}},Tvt=class extends KI{constructor(){super(...arguments),this.width=0,this.color=[1,1,1,1],this.markerPrimitive="arrow",this.placement="end",this.cap=sd.BUTT,this.anchor=_2.Center,this.hasTip=!1,this.worldSpace=!1,this.hideOnShortSegments=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.hasOccludees=!1,this.markerTexture=null}},Svt=class{constructor(e,r){this.vertexBufferLayout=e,this._parameters=r}elementCount(){return this._parameters.placement==="begin-end"?12:6}write(e,r,i,n,s){const o=i.attributes.get(R.POSITION).data,a=o.length/3;let l=[1,0,0];const c=i.attributes.get(R.NORMAL);this._parameters.worldSpace&&c!=null&&(l=c.data);let u=1,h=0;this._parameters.vvSize?h=i.attributes.get(R.SIZEFEATUREATTRIBUTE).data[0]:i.attributes.has(R.SIZE)&&(u=i.attributes.get(R.SIZE).data[0]);let p=[1,1,1,1],f=0;this._parameters.vvColor?f=i.attributes.get(R.COLORFEATUREATTRIBUTE).data[0]:i.attributes.has(R.COLOR)&&(p=i.attributes.get(R.COLOR).data);let g=0;this._parameters.vvOpacity&&(g=i.attributes.get(R.OPACITYFEATUREATTRIBUTE).data[0]);const _=new Float32Array(n.buffer);let v=s*(this.vertexBufferLayout.stride/4);const b=(E,A,O,L)=>{if(_[v++]=E[0],_[v++]=E[1],_[v++]=E[2],_[v++]=A[0],_[v++]=A[1],_[v++]=A[2],_[v++]=O[0],_[v++]=O[1],this._parameters.worldSpace&&(_[v++]=l[0],_[v++]=l[1],_[v++]=l[2]),this._parameters.vvSize?_[v++]=h:_[v++]=u,this._parameters.vvColor)_[v++]=f;else{const z=Math.min(4*L,p.length-4);_[v++]=p[z],_[v++]=p[z+1],_[v++]=p[z+2],_[v++]=p[z+3]}this._parameters.vvOpacity&&(_[v++]=g)};let w;(function(E){E[E.ASCENDING=1]="ASCENDING",E[E.DESCENDING=-1]="DESCENDING"})(w||(w={}));const x=(E,A)=>{const O=ie(Cvt,o[3*E],o[3*E+1],o[3*E+2]),L=Evt;let z=E+A;do ie(L,o[3*z],o[3*z+1],o[3*z+2]),z+=A;while(i2(O,L)&&z>=0&&z<a);e&&(Ge(O,O,e),Ge(L,L,e)),b(O,L,[-1,-1],E),b(O,L,[1,-1],E),b(O,L,[1,1],E),b(O,L,[-1,-1],E),b(O,L,[1,1],E),b(O,L,[-1,1],E)},S=this._parameters.placement;S!=="begin"&&S!=="begin-end"||x(0,w.ASCENDING),S!=="end"&&S!=="begin-end"||x(a-1,w.DESCENDING)}};const Cvt=C(),Evt=C(),ga={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},Pvt={dash:ga.dash,"dash-dot":[...ga.dash,...ga.dot],dot:ga.dot,"long-dash":ga["long-dash"],"long-dash-dot":[...ga["long-dash"],...ga.dot],"long-dash-dot-dot":[...ga["long-dash"],...ga.dot,...ga.dot],none:null,"short-dash":ga["short-dash"],"short-dash-dot":[...ga["short-dash"],...ga["short-dot"]],"short-dash-dot-dot":[...ga["short-dash"],...ga["short-dot"],...ga["short-dot"]],"short-dot":ga["short-dot"],solid:null},Avt=8;function Mvt(t,e){return t==null?t:{pattern:t.slice(),pixelRatio:e}}function NHt(t){return{pattern:[t,t],pixelRatio:2}}function YLe(t){return t!=null&&t.type==="style"?Ovt(t.style):null}function Ovt(t){return t!=null?Mvt(Pvt[t],Avt):null}const Rvt=["polyline","polygon","extent"],ame=new JI({size:!0,color:!0,rotation:!1,opacity:!0});let XLe=class ZLe extends Sg{constructor(e,r,i,n){super(e,r,i,n)}async doLoad(){if(this._fastUpdates=u3(this._context.renderer,ame),!this._drivenProperties.size&&(this.symbolLayer.size!=null?this.symbolLayer.size:xl(1))<0)throw new K("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values")}_getMaterialParameters(e,r=!1){var s,o;const i=this._getCombinedOpacityAndColor(r&&this._markerColor||this._materialColor);this._patternHidesLine&&!r&&(i[3]=0);const n={width:this._computeMaterialWidth((s=this.symbolLayer)==null?void 0:s.size),color:i,hasPolygonOffset:!0,join:this.symbolLayer.join||"miter",cap:oJ(this.symbolLayer.cap||"butt"),hasSlicePlane:this._context.slicePlaneEnabled,isClosed:e,stipplePattern:YLe(this.symbolLayer.pattern)};return(o=this._fastUpdates)!=null&&o.visualVariables?{...n,...this._fastUpdates.materialParameters}:n}get _materialColor(){var e;return(e=this.symbolLayer.material)==null?void 0:e.color}get _markerColor(){var e;return(e=this.symbolLayer.marker)==null?void 0:e.color}get _lineMaterial(){return this._materials[On.Line]==null&&(this._materials[On.Line]=new gC(this._getMaterialParameters(!1)),this._context.stage.add(this._materials[On.Line])),this._materials[On.Line]}get _ringMaterial(){return this._materials[On.Ring]==null&&(this._materials[On.Ring]=new gC(this._getMaterialParameters(!0)),this._context.stage.add(this._materials[On.Ring])),this._materials[On.Ring]}get _wireframeLineMaterial(){return this._materials[On.LineWireframe]==null&&(this._materials[On.LineWireframe]=new gC({...this._getMaterialParameters(!1),wireframe:!0}),this._context.stage.add(this._materials[On.LineWireframe])),this._materials[On.LineWireframe]}get _wireframeRingMaterial(){return this._materials[On.RingWireframe]==null&&(this._materials[On.RingWireframe]=new gC({...this._getMaterialParameters(!0),wireframe:!0}),this._context.stage.add(this._materials[On.RingWireframe])),this._materials[On.RingWireframe]}get _markerMaterial(){return this._materials[On.Marker]==null&&this.symbolLayer.marker!=null&&(this._materials[On.Marker]=new wvt({...this._getMaterialParameters(!1,!0),placement:this.symbolLayer.marker.placement,markerPrimitive:ome(this.symbolLayer.marker.style)}),this._context.stage.add(this._materials[On.Marker])),this._materials[On.Marker]}destroy(){super.destroy(),this._forEachMaterial(e=>this._context.stage.remove(e)),this._materials.length=0}_getDrivenSize(e){return this._drivenProperties.size&&e.size?fs(xft(e.size)):1}_getDrivenColor(e){const r=Bt(1,1,1,1);return this._drivenProperties.color&&e.color&&(r[0]=e.color[0],r[1]=e.color[1],r[2]=e.color[2],e.color.length>0&&(r[3]=e.color[3])),this._drivenProperties.opacity&&e.opacity&&(r[3]=e.opacity),r}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,Rvt,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(r);return this.ensureDrapedStatus(i.mode==="on-the-ground"),this.draped?this._createAsOverlay(e,this._context.layer.uid):this._createAs3DShape(e,i,r.uid)}applyRendererDiff(e,r){for(const i in e.diff){if(i!=="visualVariables")return Xn.RecreateSymbol;{const n=this._fastUpdates;if(!h3(n,r,ame))return Xn.RecreateSymbol;this._forEachMaterial(s=>s==null?void 0:s.setParameters(n.materialParameters))}}return Xn.FastUpdate}prepareSymbolLayerPatch(e){var s,o;if(e.diff.type!=="partial")return;const r=e.diff.diff,i={};((s=r.size)==null?void 0:s.type)==="complete"&&(i.width=this._computeMaterialWidth(r.size.newValue),delete r.size),((o=r.cap)==null?void 0:o.type)==="complete"&&(i.cap=oJ(r.cap.newValue??"butt"),delete r.cap);const n=this._prepareMarkerPatch(e,r);this._prepareMaterialPatch(e,r,n),e.symbolLayerStatePatches.push(()=>this._forEachMaterial(a=>a==null?void 0:a.setParameters(i)))}layerOpacityChanged(){this._forEachMaterial((e,r)=>this._updateMaterialLayerOpacity(e,r===On.Marker))}_forEachMaterial(e){this._materials.forEach(e)}_updateMaterialLayerOpacity(e,r=!1){var a,l;if(e==null)return;const i=e.parameters.color,n=(l=(a=this.symbolLayer)==null?void 0:a.material)==null?void 0:l.color,s=this._patternHidesLine&&!r?0:this._getCombinedOpacity(n),o=Bt(i[0],i[1],i[2],s);e.setParameters({color:o})}layerElevationInfoChanged(e,r,i){const n=this._elevationContext.mode,s=eL(ZLe.elevationModeChangeTypes,i,n);if(s!==En.UPDATE)return s;const o=bd(n);return this.updateGraphics3DGraphicElevationInfo(e,r,()=>o)}slicePlaneEnabledChanged(){const e={hasSlicePlane:this._context.slicePlaneEnabled};return this._forEachMaterial(r=>r==null?void 0:r.setParameters(e)),!0}physicalBasedRenderingChanged(){return!0}_getGeometryAsPolygonOrPolyline(e){switch(e.type){case"extent":if(e instanceof ei)return nf.fromExtent(e);break;case"polygon":case"polyline":return e}return null}_createAs3DShape(e,r,i){const n=e.graphic,s=this._getGeometryAsPolygonOrPolyline(n.geometry),o=s.type==="polygon"?s.rings:s.paths,a=new Array,l=vs(),c=_vt(s,this._context.elevationProvider,this._context.renderCoordsHelper,r),u=s.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(c,o,u,"LineSymbol3DLayer");for(let f=0;f<c.lines.length;f++){const g=c.lines[f],_=g.position,v=g.mapPositions;if(this._context.clippingExtent!=null&&(Li(l),Hc(l,v),!zp(l,this._context.clippingExtent)))continue;const b=this._createGeometry(s.type==="polygon"?this._ringMaterial:this._lineMaterial,e,_,v,s.type,TR.ELEVATED,i);a.push(b),yi.LINE_WIREFRAMES&&a.push(b.instantiate({material:s.type==="polygon"?this._wireframeRingMaterial:this._wireframeLineMaterial})),this._markerMaterial!=null&&a.push(b.instantiate({material:this._markerMaterial}))}if(a.length===0)return null;const h=new Ey({geometries:a,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:i}),p=new Tg(this,h,a,null,null,Uht,r);return p.alignedSampledElevation=c.sampledElevation,p.needsElevationUpdates=bd(r.mode),p}_createGeometry(e,r,i,n,s,o,a){var _,v,b;const l=o===TR.DRAPED?{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper}:null,c=s==="polygon",u=(_=this._fastUpdates)==null?void 0:_.visualVariables.color,h=(v=this._fastUpdates)==null?void 0:v.visualVariables.size,p=(b=this._fastUpdates)==null?void 0:b.visualVariables.opacity,f=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:a,layerUid:this._context.layer.uid}),g={position:i,size:h?null:this._getDrivenSize(r.renderingInfo),color:u?null:this._getDrivenColor(r.renderingInfo),sizeFeature:h?Qp(h.field,r.graphic):null,colorFeature:u?Qp(u.field,r.graphic):null,opacityFeature:p?Qp(p.field,r.graphic):null};return aJ(e,{overlayInfo:l,removeDuplicateStartEnd:c,mapPositions:n,attributeData:g},f)}_createAsOverlay(e,r){const i=e.graphic,n=this._getGeometryAsPolygonOrPolyline(i.geometry),s=n.type==="polygon"?n.rings:n.paths,o=n.type==="polygon"?this._ringMaterial:this._lineMaterial;o.renderPriority=this._renderPriority;const a=yi.LINE_WIREFRAMES?n.type==="polygon"?this._wireframeRingMaterial:this._wireframeLineMaterial:null,l=this._markerMaterial;a!=null&&(a.renderPriority=this._renderPriority-.001),l!=null&&(l.renderPriority=this._renderPriority-.002);const c=new Array,u=vs(),h=Li(),p=vvt(n,this._context.overlaySR),f=n.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(p,s,f,"LineSymbol3DLayer");for(const g of p.lines){if(Li(u),Hc(u,g.position),!zp(u,this._context.clippingExtent))continue;t3(h,u);const _=v=>{const b=this._createGeometry(v,e,g.position,void 0,n.type,TR.DRAPED,i.uid),w=new v3(b,{layerUid:r,graphicUid:i.uid});c.push(w)};if(l!=null){_(l);const v=this.symbolLayer.marker.placement;v!=="begin"&&v!=="begin-end"||Hc(u,g.position,0,1),v!=="end"&&v!=="begin-end"||Hc(u,g.position,g.position.length-3,1)}_(o),yi.LINE_WIREFRAMES&&_(a)}return new WU(this,c,h,this._context.drapeSourceRenderer)}get _patternHidesLine(){const e=this.symbolLayer.pattern;return e!=null&&e.type==="style"&&e.style==="none"}_computeMaterialWidth(e){var r;return e=e??xl(1),this._drivenProperties.size?(r=this._fastUpdates)!=null&&r.visualVariables.size?fs(1):1:fs(e)}_prepareMaterialPatch(e,r,i){var a,l;const n=r.material;if(n==null)return void(i.changed&&i.useMaterialColor&&this._patchMaterialColor(this._getCombinedOpacityAndColor(this._materialColor),this._materials[On.Marker],e));if(n.type==="collection")return;const s=n.type==="complete"?(a=n.newValue)==null?void 0:a.color:((l=n.diff.color)==null?void 0:l.type)==="complete"?n.diff.color.newValue:null,o=this._getCombinedOpacityAndColor(s);i.useMaterialColor&&this._patchMaterialColor(NI(o),this._materials[On.Marker],e),this._patternHidesLine&&(o[3]=0),this._patchMaterialColor(o,this._materials[On.Line],e),delete r.material}_prepareMarkerPatch(e,r){var u;const i=r.marker,n=this._markerMaterial;if(i==null||i.type!=="partial"||i.diff==null||i.diff.placement!=null||i.diff.style!=null&&i.diff.style.type!=="complete"||i.diff.color!=null&&i.diff.color.type!=="complete"||n==null)return{changed:!1,useMaterialColor:this._markerColor==null};const s=i.diff.color,o=s!=null,a=o?s.newValue:null,l=a==null&&this._markerColor==null;a&&this._patchMaterialColor(this._getCombinedOpacityAndColor(a),n,e);const c=(u=i.diff.style)==null?void 0:u.newValue;return c&&e.symbolLayerStatePatches.push(()=>n.setParameters({markerPrimitive:ome(c)})),delete r.marker,{changed:o,useMaterialColor:l}}_patchMaterialColor(e,r,i){r!=null&&i.symbolLayerStatePatches.push(()=>r.setParameters({color:e}))}};var TR,On;XLe.elevationModeChangeTypes={definedChanged:En.RECREATE,staysOnTheGround:En.NONE,onTheGroundChanged:En.RECREATE},function(t){t[t.DRAPED=0]="DRAPED",t[t.ELEVATED=1]="ELEVATED"}(TR||(TR={})),function(t){t[t.Line=0]="Line",t[t.Ring=1]="Ring",t[t.LineWireframe=2]="LineWireframe",t[t.RingWireframe=3]="RingWireframe",t[t.Marker=4]="Marker"}(On||(On={}));let sA=null,L8=!0;function xG(t,e,r){if(!t||!e)throw new Error("Cannot construct image data without dimensions");if(L8)try{return new ImageData(t,e)}catch{L8=!1}return JLe(t,e,r)}function $vt(t,e,r,i){if(!e||!r)throw new Error("Cannot construct image data without dimensions");if(L8)try{return new ImageData(t,e,r)}catch{L8=!1}const n=JLe(e,r,i);return n.data.set(t,0),n}function Ivt(){return sA||(sA=document.createElement("canvas"),sA.width=1,sA.height=1),sA}function JLe(t,e,r){return r||(r=Ivt()),r.getContext("2d").createImageData(t,e)}async function Lvt(t,e){const r=window.URL.createObjectURL(t);try{const{data:i}=await Xi(r,{...e,responseType:"image"});return i}catch(i){throw _s(i)?i:new K("invalid-image",`Could not fetch requested image at ${r}`)}finally{window.URL.revokeObjectURL(r)}}async function FHt(t,e){const{arrayBuffer:r,mediaType:i}=await Dvt(t,e),n=i==="image/png";if(i==="image/gif"){const{isAnimatedGIF:s,parseGif:o}=await ge(()=>import("./gif-BgGmUa_z.js"),__vite__mapDeps([]));if(s(r))return o(r,e)}if(n){const{isAnimatedPNG:s,parseApng:o}=await ge(()=>import("./apng-R3yjGeRK.js"),__vite__mapDeps([]));if(s(r))return o(r,e)}return Lvt(new Blob([r],{type:i}),e)}async function Dvt(t,e){var n;const r=rv(t);if(r!=null&&r.isBase64)return{arrayBuffer:mwe(r.data),mediaType:r.mediaType};const i=await Xi(t,{responseType:"array-buffer",...e});return{arrayBuffer:i.data,mediaType:((n=i.getHeader)==null?void 0:n.call(i,"Content-Type"))??""}}var PS;const TG=new WeakMap;let Nvt=0,lm=PS=class extends ze{constructor(t){super(t),this.wrap="repeat"}get url(){return this._get("url")||null}set url(t){this._set("url",t),t&&this._set("data",null)}get data(){return this._get("data")||null}set data(t){this._set("data",t),t&&this._set("url",null)}writeData(t,e,r,i){if(t instanceof HTMLImageElement){const n={type:"image-element",src:OE(t.src,i),crossOrigin:t.crossOrigin};e[r]=n}else if(t instanceof HTMLCanvasElement){const n=t.getContext("2d").getImageData(0,0,t.width,t.height),s={type:"canvas-element",imageData:this._encodeImageData(n)};e[r]=s}else if(t instanceof HTMLVideoElement){const n={type:"video-element",src:OE(t.src,i),autoplay:t.autoplay,loop:t.loop,muted:t.muted,crossOrigin:t.crossOrigin,preload:t.preload};e[r]=n}else if(t instanceof ImageData){const n={type:"image-data",imageData:this._encodeImageData(t)};e[r]=n}}readData(t){switch(t.type){case"image-element":{const e=new Image;return e.src=t.src,e.crossOrigin=t.crossOrigin,e}case"canvas-element":{const e=this._decodeImageData(t.imageData),r=document.createElement("canvas");return r.width=e.width,r.height=e.height,r.getContext("2d").putImageData(e,0,0),r}case"image-data":return this._decodeImageData(t.imageData);case"video-element":{const e=document.createElement("video");return e.src=t.src,e.crossOrigin=t.crossOrigin,e.autoplay=t.autoplay,e.loop=t.loop,e.muted=t.muted,e.preload=t.preload,e}default:return}}get transparent(){const t=this.data,e=this.url;if(t instanceof HTMLCanvasElement)return this._imageDataContainsTransparent(t.getContext("2d").getImageData(0,0,t.width,t.height));if(t instanceof ImageData)return this._imageDataContainsTransparent(t);if(e){const r=e.substr(e.length-4,4).toLowerCase(),i=e.substr(0,15).toLocaleLowerCase();if(r===".png"||i==="data:image/png;")return!0}return!1}set transparent(t){this._overrideIfSome("transparent",t)}get contentHash(){const t=typeof this.wrap=="string"?this.wrap:typeof this.wrap=="object"?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",e=(r="")=>`d:${r},t:${this.transparent},w:${t}`;return this.url!=null?e(this.url):this.data!=null?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?e(this.data.src):(TG.has(this.data)||TG.set(this.data,++Nvt),e(TG.get(this.data))):e()}get memoryUsage(){let t=0;if(t+=this.url!=null?this.url.length:0,this.data!=null){const e=this.data;"data"in e?t+=e.data.byteLength:e instanceof HTMLImageElement?t+=e.naturalWidth*e.naturalHeight*3:e instanceof HTMLCanvasElement&&(t+=e.width*e.height*3)}return t}clone(){const t={url:this.url,data:this.data,wrap:this._cloneWrap()};return new PS(t)}cloneWithDeduplication(t){const e=t.get(this);if(e)return e;const r=this.clone();return t.set(this,r),r}_cloneWrap(){return typeof this.wrap=="string"?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}_encodeImageData(t){let e="";for(let r=0;r<t.data.length;r++)e+=String.fromCharCode(t.data[r]);return{data:btoa(e),width:t.width,height:t.height}}_decodeImageData(t){const e=atob(t.data),r=new Uint8ClampedArray(e.length);for(let i=0;i<e.length;i++)r[i]=e.charCodeAt(i);return $vt(r,t.width,t.height)}_imageDataContainsTransparent(t){for(let e=3;e<t.data.length;e+=4)if(t.data[e]!==255)return!0;return!1}static from(t){return typeof t=="string"?new PS({url:t}):t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof ImageData||t instanceof HTMLVideoElement?new PS({data:t}):Yx(PS,t)}};d([m({type:String,json:{write:r2}})],lm.prototype,"url",null),d([m({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),m()],lm.prototype,"data",null),d([hr("data")],lm.prototype,"writeData",null),d([Tr("data")],lm.prototype,"readData",null),d([m({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],lm.prototype,"transparent",null),d([m({json:{write:!0}})],lm.prototype,"wrap",void 0),d([m({readOnly:!0})],lm.prototype,"contentHash",null),lm=PS=d([V("esri.geometry.support.MeshTexture")],lm);const SR=lm;let AS=class extends nh(ze){constructor(e){super(e),this.offset=[0,0],this.rotation=0,this.scale=[1,1]}};d([m({type:[Number],nonNullable:!0,json:{write:!0}})],AS.prototype,"offset",void 0),d([m({type:Number,nonNullable:!0,json:{write:!0}})],AS.prototype,"rotation",void 0),d([m({type:[Number],nonNullable:!0,json:{write:!0}})],AS.prototype,"scale",void 0),AS=d([V("esri.geometry.support.MeshTextureTransform")],AS);const uE=AS;var lJ;let ip=lJ=class extends ze{constructor(t){super(t),this.color=null,this.colorTexture=null,this.colorTextureTransform=null,this.normalTexture=void 0,this.normalTextureTransform=void 0,this.alphaMode="auto",this.alphaCutoff=.5,this.doubleSided=!0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(t,e){const r=t!=null?t.get(this):null;if(r)return r;const i=new lJ(this.clonePropertiesWithDeduplication(e));return t!=null&&t.set(this,i),i}clonePropertiesWithDeduplication(t){var e,r,i,n;return{color:this.color!=null?this.color.clone():null,colorTexture:(e=this.colorTexture)==null?void 0:e.cloneWithDeduplication(t),normalTexture:(r=this.normalTexture)==null?void 0:r.cloneWithDeduplication(t),alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided,colorTextureTransform:(i=this.colorTextureTransform)==null?void 0:i.clone(),normalTextureTransform:(n=this.normalTextureTransform)==null?void 0:n.clone()}}get memoryUsage(){return this.getMemoryUsage()}getMemoryUsage(){let t=0;return t+=this.color!=null?16:0,this.colorTexture!=null&&(t+=this.colorTexture.memoryUsage),t+=this.colorTextureTransform!=null?20:0,this.normalTexture!=null&&(t+=this.normalTexture.memoryUsage),t+=this.normalTextureTransform!=null?20:0,t}};d([m({type:Xe,json:{write:!0}})],ip.prototype,"color",void 0),d([m({type:SR,json:{write:!0}})],ip.prototype,"colorTexture",void 0),d([m({type:uE,json:{write:!0}})],ip.prototype,"colorTextureTransform",void 0),d([m({type:SR,json:{write:!0}})],ip.prototype,"normalTexture",void 0),d([m({type:uE,json:{write:!0}})],ip.prototype,"normalTextureTransform",void 0),d([m({nonNullable:!0,json:{write:!0}})],ip.prototype,"alphaMode",void 0),d([m({nonNullable:!0,json:{write:!0}})],ip.prototype,"alphaCutoff",void 0),d([m({nonNullable:!0,json:{write:!0}})],ip.prototype,"doubleSided",void 0),ip=lJ=d([V("esri.geometry.support.MeshMaterial")],ip);const Qie=ip;var cJ;let Eh=cJ=class extends Qie{constructor(t){super(t),this.emissiveColor=null,this.emissiveTexture=null,this.emissiveTextureTransform=void 0,this.occlusionTexture=null,this.occlusionTextureTransform=void 0,this.metallic=1,this.roughness=1,this.metallicRoughnessTexture=null,this.metallicRoughnessTextureTransform=void 0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(t,e){const r=t!=null?t.get(this):null;if(r)return r;const i=new cJ(this.clonePropertiesWithDeduplication(e));return t!=null&&t.set(this,i),i}getMemoryUsage(){let t=super.getMemoryUsage();return t+=this.emissiveColor!=null?16:0,this.emissiveTexture!=null&&(t+=this.emissiveTexture.memoryUsage),t+=this.emissiveTextureTransform!=null?20:0,this.occlusionTexture!=null&&(t+=this.occlusionTexture.memoryUsage),t+=this.occlusionTextureTransform!=null?20:0,this.metallicRoughnessTexture!=null&&(t+=this.metallicRoughnessTexture.memoryUsage),t+=this.metallicRoughnessTextureTransform!=null?20:0,t}clonePropertiesWithDeduplication(t){var e,r,i,n,s,o,a;return{...super.clonePropertiesWithDeduplication(t),emissiveColor:(e=this.emissiveColor)==null?void 0:e.clone(),emissiveTexture:(r=this.emissiveTexture)==null?void 0:r.cloneWithDeduplication(t),emissiveTextureTransform:(i=this.emissiveTextureTransform)==null?void 0:i.clone(),occlusionTexture:(n=this.occlusionTexture)==null?void 0:n.cloneWithDeduplication(t),occlusionTextureTransform:(s=this.occlusionTextureTransform)==null?void 0:s.clone(),metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:(o=this.metallicRoughnessTexture)==null?void 0:o.cloneWithDeduplication(t),metallicRoughnessTextureTransform:(a=this.metallicRoughnessTextureTransform)==null?void 0:a.clone()}}};d([m({type:Xe,json:{write:!0}})],Eh.prototype,"emissiveColor",void 0),d([m({type:SR,json:{write:!0}})],Eh.prototype,"emissiveTexture",void 0),d([m({type:uE,json:{write:!0}})],Eh.prototype,"emissiveTextureTransform",void 0),d([m({type:SR,json:{write:!0}})],Eh.prototype,"occlusionTexture",void 0),d([m({type:uE,json:{write:!0}})],Eh.prototype,"occlusionTextureTransform",void 0),d([m({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],Eh.prototype,"metallic",void 0),d([m({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],Eh.prototype,"roughness",void 0),d([m({type:SR,json:{write:!0}})],Eh.prototype,"metallicRoughnessTexture",void 0),d([m({type:uE,json:{write:!0}})],Eh.prototype,"metallicRoughnessTextureTransform",void 0),Eh=cJ=d([V("esri.geometry.support.MeshMaterialMetallicRoughness")],Eh);const QLe=Eh;var EF;let ll=EF=class extends ze{constructor(t){super(t),this.color=null,this.position=new Float64Array(0),this.uv=null,this.normal=null,this.tangent=null}castColor(t){return MS(t,Uint8Array,[Uint8ClampedArray],{loggerTag:".color=",stride:4},re.getLogger(this))}castPosition(t){return t&&t instanceof Float32Array&&re.getLogger(this).warn(".position=","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array"),MS(t,Float64Array,[Float32Array],{loggerTag:".position=",stride:3},re.getLogger(this))}castUv(t){return MS(t,Float32Array,[Float64Array],{loggerTag:".uv=",stride:2},re.getLogger(this))}castNormal(t){return MS(t,Float32Array,[Float64Array],{loggerTag:".normal=",stride:3},re.getLogger(this))}castTangent(t){return MS(t,Float32Array,[Float64Array],{loggerTag:".tangent=",stride:4},re.getLogger(this))}clone(){const t={position:_e(this.position),uv:_e(this.uv),normal:_e(this.normal),tangent:_e(this.tangent),color:_e(this.color)};return new EF(t)}clonePositional(){const t={position:_e(this.position),normal:_e(this.normal),tangent:_e(this.tangent),uv:this.uv,color:this.color};return new EF(t)}get memoryUsage(){let t=0;return t+=this.position.byteLength,this.uv!=null&&(t+=this.uv.byteLength),this.normal!=null&&(t+=this.normal.byteLength),this.tangent!=null&&(t+=this.tangent.byteLength),this.color!=null&&(t+=this.color.byteLength),t}};function SG(t,e,r,i){const{loggerTag:n,stride:s}=e;return t.length%s!=0?(i.error(n,`Invalid array length, expected a multiple of ${s}`),new r([])):t}function MS(t,e,r,i,n){if(!t)return t;if(t instanceof e)return SG(t,i,e,n);for(const s of r)if(t instanceof s)return SG(new e(t),i,e,n);if(Array.isArray(t))return SG(new e(t),i,e,n);{const s=r.map(o=>`'${o.name}'`);return n.error(`Failed to set property, expected one of ${s}, but got ${t.constructor.name}`),new e([])}}function oA(t,e,r){e[r]=Fvt(t)}function Fvt(t){const e=new Array(t.length);for(let r=0;r<t.length;r++)e[r]=t[r];return e}d([m({json:{write:oA}})],ll.prototype,"color",void 0),d([ai("color")],ll.prototype,"castColor",null),d([m({nonNullable:!0,json:{write:oA}})],ll.prototype,"position",void 0),d([ai("position")],ll.prototype,"castPosition",null),d([m({json:{write:oA}})],ll.prototype,"uv",void 0),d([ai("uv")],ll.prototype,"castUv",null),d([m({json:{write:oA}})],ll.prototype,"normal",void 0),d([ai("normal")],ll.prototype,"castNormal",null),d([m({json:{write:oA}})],ll.prototype,"tangent",void 0),d([ai("tangent")],ll.prototype,"castTangent",null),ll=EF=d([V("esri.geometry.support.MeshVertexAttributes")],ll);var lO;let cm=lO=class extends ze{static from(t){return Yx(lO,t)}constructor(t){super(t),this.faces=null,this.material=null,this.name=void 0,this.shading="source",this.trustSourceNormals=!1}castFaces(t){return MS(t,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},re.getLogger(this))}castMaterial(t){return Yx(t&&typeof t=="object"&&("metallic"in t||"roughness"in t||"metallicRoughnessTexture"in t)?QLe:Qie,t)}clone(){return new lO({faces:_e(this.faces),shading:this.shading,material:_e(this.material),trustSourceNormals:this.trustSourceNormals,name:this.name})}cloneWithDeduplication(t,e){const r={faces:_e(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(t,e):null,trustSourceNormals:this.trustSourceNormals,name:this.name};return new lO(r)}get memoryUsage(){let t=0;return this.faces!=null&&(t+=this.faces.byteLength),this.material!=null&&(t+=this.material.memoryUsage),t}};d([m({json:{write:!0}})],cm.prototype,"faces",void 0),d([ai("faces")],cm.prototype,"castFaces",null),d([m({type:Qie,json:{write:!0}})],cm.prototype,"material",void 0),d([ai("material")],cm.prototype,"castMaterial",null),d([m()],cm.prototype,"name",void 0),d([m({type:String,json:{write:!0}})],cm.prototype,"shading",void 0),d([m({type:Boolean})],cm.prototype,"trustSourceNormals",void 0),cm=lO=d([V("esri.geometry.support.MeshComponent")],cm);const b2=cm;let cO=class extends nh(ze){constructor(e){super(e),this.type="georeferenced",this.origin=null}};d([It({georeferenced:"georeferenced"},{readOnly:!0})],cO.prototype,"type",void 0),d([m({type:[Number],nonNullable:!1,json:{write:!0}})],cO.prototype,"origin",void 0),cO=d([V("esri.geometry.support.MeshGeoreferencedVertexSpace")],cO);const R0=cO;let uO=class extends nh(ze){constructor(e){super(e),this.type="local",this.origin=C()}};d([It({local:"local"},{readOnly:!0})],uO.prototype,"type",void 0),d([m({type:[Number],nonNullable:!0,json:{write:!0}})],uO.prototype,"origin",void 0),uO=d([V("esri.geometry.support.MeshLocalVertexSpace")],uO);const CR=uO;function lme(){return re.getLogger("esri.geometry.Mesh")}function BHt(t){const{vertexSpace:e}=t;if(e.origin!=null)return t.clone();const{anchor:r}=t,i=r.clone(),n=new R0({origin:[i.x,i.y,i.z]}),s=t.cloneWithVertexSpace(n),{position:o}=s.vertexAttributes;return s.vertexAttributes.position=Sie(new Float64Array(o.length),o,[-i.x,-i.y,-(i.z??0)]),s.vertexAttributesChanged(),s}function gf(t){return t.origin!=null}function KLe(t){return gf(t.vertexSpace)}function D8(t,e){if(!gf(t))return null;const[r,i,n]=t.origin;return new ke({x:r,y:i,z:n,spatialReference:e})}function kvt(t,e){const{x:r,y:i,z:n,spatialReference:s}=t,o=[r,i,n??0];if((e==null?void 0:e.geographic)!==void 0){if(ev(lme(),"option: geographic",{replacement:"use vertexSpace option instead",version:"4.29",warnOnce:!0}),!(e!=null&&e.vertexSpace))return e!=null&&e.geographic?new CR({origin:o}):new R0({origin:o});lme().warn("Deprecated geographic flag ignored since vertexSpace option is provided.")}if(!(e!=null&&e.vertexSpace))return s.isGeographic||s.isWebMercator?new CR({origin:o}):new R0({origin:o});switch(e.vertexSpace){case"local":return new CR({origin:o});case"georeferenced":return new R0({origin:o});case"georeferenced-absolute":return new R0}}function cme(t){return t.isGeographic||t.isWebMercator?"local":"georeferenced"}function ume(t,e){return t==="local"?new CR({origin:e}):new R0({origin:e})}var uJ;let um=uJ=class extends ze{constructor(t){super(t),this.translation=C(),this.rotationAxis=Ea(ZPe),this.rotationAngle=0,this.scale=Ce(1,1,1)}get rotation(){return K5(this.rotationAxis,this.rotationAngle)}set rotation(t){this.rotationAxis=Zi(t),this.rotationAngle=Git(t)}get localMatrix(){const t=xe();return ZE(hme,this.rotation,D$(this.rotation)),Ixe(t,hme,this.translation,this.scale),t}get localMatrixInverse(){return os(xe(),this.localMatrix)}applyLocal(t,e){return Ge(e,t,this.localMatrix)}applyLocalInverse(t,e){return Ge(e,t,this.localMatrixInverse)}equals(t){return this===t||t!=null&&pee(this.localMatrix,t.localMatrix)}clone(){const t={translation:Zi(this.translation),rotationAxis:Zi(this.rotationAxis),rotationAngle:this.rotationAngle,scale:Zi(this.scale)};return new uJ(t)}};d([m({type:[Number],nonNullable:!0,json:{write:!0}})],um.prototype,"translation",void 0),d([m({type:[Number],nonNullable:!0,json:{write:!0}})],um.prototype,"rotationAxis",void 0),d([m({type:Number,nonNullable:!0,json:{write:!0}})],um.prototype,"rotationAngle",void 0),d([m({type:[Number],nonNullable:!0,json:{write:!0}})],um.prototype,"scale",void 0),d([m()],um.prototype,"rotation",null),d([m()],um.prototype,"localMatrix",null),d([m()],um.prototype,"localMatrixInverse",null),um=uJ=d([V("esri.geometry.support.MeshTransform")],um);const hme=lc(),w2=um;function eDe(t,e){return t.isGeographic||t.isWebMercator&&(e??!0)}function tDe(t,e){switch(t.type){case"georeferenced":return e.isGeographic;case"local":return e.isGeographic||e.isWebMercator}}function Kie(t,e,r,i){if(i!==void 0){ev(re.getLogger(t),"option: geographic",{replacement:"use mesh vertexSpace and spatial reference to control how operations are performed",version:"4.29",warnOnce:!0});const n=e.type==="local";if(!gf(e)||i===n)return r.isGeographic||r.isWebMercator&&i;re.getLogger(t).warnOnce(`Specifying the 'geographic' parameter (${i}) for a Mesh vertex space of type "${e.type}" is not supported. This parameter will be ignored.`)}return tDe(e,r)}const qU=()=>re.getLogger("esri.geometry.support.meshUtils.normalProjection");function YU(t,e,r,i,n){return JU(i)?(ZU(j0.TO_PCPF,Qs.fromTypedArray(t),vd.fromTypedArray(e),vd.fromTypedArray(r),i,Qs.fromTypedArray(n)),n):(qU().error("Cannot convert spatial reference to PCPF"),n)}function ene(t,e,r,i,n){return JU(i)?(ZU(j0.FROM_PCPF,Qs.fromTypedArray(t),vd.fromTypedArray(e),vd.fromTypedArray(r),i,Qs.fromTypedArray(n)),n):(qU().error("Cannot convert to spatial reference from PCPF"),n)}function tne(t,e,r){return Ji(t,e,0,r,nc(e),0,t.length/3),r}function rne(t,e,r){return Ji(t,nc(r),0,e,r,0,t.length/3),e}function rDe(t,e,r){return iy(fo,r),ff(e,t,fo),dte(fo)||FU(e,e),e}function iDe(t,e,r){if(iy(fo,r),ff(e,t,fo,4),dte(fo)||FU(e,e,4),t!==e)for(let i=3;i<t.length;i+=4)e[i]=t[i];return e}function XU(t,e,r,i,n){if(!JU(i))return qU().error("Cannot convert spatial reference to PCPF"),n;ZU(j0.TO_PCPF,Qs.fromTypedArray(t,4*Float32Array.BYTES_PER_ELEMENT),vd.fromTypedArray(e),vd.fromTypedArray(r),i,Qs.fromTypedArray(n,4*Float32Array.BYTES_PER_ELEMENT));for(let s=3;s<t.length;s+=4)n[s]=t[s];return n}function ine(t,e,r,i,n){if(!JU(i))return qU().error("Cannot convert to spatial reference from PCPF"),n;ZU(j0.FROM_PCPF,Qs.fromTypedArray(t,16),vd.fromTypedArray(e),vd.fromTypedArray(r),i,Qs.fromTypedArray(n,16));for(let s=3;s<t.length;s+=4)n[s]=t[s];return n}function ZU(t,e,r,i,n,s){if(!e)return;const o=r.count,a=nc(n);if(nDe(n))for(let l=0;l<o;l++)i.getVec(l,jN),e.getVec(l,Ff),La(a,jN,HN,a),th(fo,HN),t===j0.FROM_PCPF&&gd(fo,fo),Zs(Ff,Ff,fo),s.setVec(l,Ff);else for(let l=0;l<o;l++){i.getVec(l,jN),e.getVec(l,Ff),La(a,jN,HN,a),th(fo,HN);const c=Qk(r.get(l,1));let u=Math.cos(c);t===j0.TO_PCPF&&(u=1/u),fo[0]*=u,fo[1]*=u,fo[2]*=u,fo[3]*=u,fo[4]*=u,fo[5]*=u,t===j0.FROM_PCPF&&gd(fo,fo),Zs(Ff,Ff,fo),pe(Ff,Ff),s.setVec(l,Ff)}return s}function JU(t){return nDe(t)||zvt(t)}function nDe(t){return t.isWGS84||jwe(t)||Iv(t)||Lv(t)}function zvt(t){return t.isWebMercator}var j0;(function(t){t[t.TO_PCPF=0]="TO_PCPF",t[t.FROM_PCPF=1]="FROM_PCPF"})(j0||(j0={}));const jN=C(),Ff=C(),HN=xe(),fo=li();function nne(t,e,r){return eDe(e.spatialReference,r==null?void 0:r.geographic)?QU(t,e,!1,r):Bvt(t,e,r)}function sDe(t,e=sn){const{position:r,normal:i,tangent:n}=t;return{position:pf(new Float64Array(r.length),r,e),normal:i!=null?rDe(i,new Float32Array(i.length),e):null,tangent:n!=null?iDe(n,new Float32Array(n.length),e):null}}function oDe(t,e,r,i){const{position:n,normal:s,tangent:o}=t;if(!gf(e))return{position:n,normal:s,tangent:o};const a=D8(e,i);return nne(sDe(t,r==null?void 0:r.localMatrix),a,{geographic:e.type==="local"})}function aDe(t,e,r){const i=kvt(e,r),n=e.spatialReference,s=gf(i);if(!s)return{vertexAttributes:nne(t,e,r),vertexSpace:i,transform:null};const{position:o,normal:a,tangent:l}=t,c=tDe(i,n);switch(i.type){case"georeferenced":return c?{vertexAttributes:QU(t,e,s,r),vertexSpace:i,transform:null}:{vertexAttributes:{position:o,normal:a,tangent:l},vertexSpace:i,transform:new w2};case"local":return{vertexAttributes:{position:o,normal:a,tangent:l},vertexSpace:i,transform:new w2}}}function hJ(t,e,r){return eDe(e.spatialReference,r==null?void 0:r.geographic)?one(t,e,r):lDe(t,e,r)}function Uvt(t,e,r,i,n){if(!gf(e))return hJ(t,i,n);const{spatialReference:s}=i,o=oDe(t,e,r,s);return i.equals(D8(e,s))?lDe(o,i,n):hJ(o,i,n)}function sne({positions:t,transform:e,vertexSpace:r,inSpatialReference:i,outSpatialReference:n,outPositions:s,localMode:o}){const a=r.origin??zn,l=r.origin!=null?(e==null?void 0:e.localMatrix)??sn:sn;if(r.type==="georeferenced"){const p=s??xo(t.length);if(r9(l,sn)?hst(p,t):pf(p,t,l),!zo(a,zn)){const[f,g,_]=a;for(let v=0;v<p.length;v+=3)p[v]+=f,p[v+1]+=g,p[v+2]+=_}return Ji(p,i,0,p,n,0,p.length/3),p}let c=i;const u=nc(i);c=n.isWebMercator&&o||!md(i,u)?c:u,La(i,a,gx,c),Hr(gx,gx,l);const h=s??xo(t.length);return pf(h,t,gx),Ji(h,c,0,h,n,0,h.length/3),h}function Bvt(t,e,r){const i=new Float64Array(t.position.length),n=t.position,s=e.x,o=e.y,a=e.z??0,l=dL(r?r.unit:null,e.spatialReference);for(let c=0;c<n.length;c+=3)i[c]=n[c]*l+s,i[c+1]=n[c+1]*l+o,i[c+2]=n[c+2]*l+a;return{position:i,normal:t.normal,tangent:t.tangent}}function QU(t,e,r,i){const n=e.spatialReference,s=cDe(e,i,gx),o=new Float64Array(t.position.length),a=Vvt(t.position,s,n,o),l=iy(uDe,s),c=Gvt(a,o,t.normal,l,n),u=jvt(a,o,t.tangent,l,n);if(r){const{x:h,y:p,z:f}=e;Sie(a,a,[-h,-p,-(f??0)])}return{position:a,normal:c,tangent:u}}function Vvt(t,e,r,i){pf(i,t,e);const n=new Float64Array(t.length);return rne(i,n,r)}function Gvt(t,e,r,i,n){if(r==null)return null;const s=new Float32Array(r.length);return ff(s,r,i),ene(s,t,e,n,s),s}function jvt(t,e,r,i,n){if(r==null)return null;const s=new Float32Array(r.length);ff(s,r,i,4);for(let o=3;o<s.length;o+=4)s[o]=r[o];return ine(s,t,e,n,s),s}function lDe(t,e,r){const i=new Float64Array(t.position.length),n=t.position,s=e.x,o=e.y,a=e.z??0,l=dL(r?r.unit:null,e.spatialReference);for(let c=0;c<n.length;c+=3)i[c]=(n[c]-s)/l,i[c+1]=(n[c+1]-o)/l,i[c+2]=(n[c+2]-a)/l;return{position:i,normal:t.normal,tangent:t.tangent}}function one(t,e,r){const i=e.spatialReference;cDe(e,r,gx);const n=os(Yvt,gx),s=new Float64Array(t.position.length),o=Hvt(t.position,i,n,s),a=iy(uDe,n);return{position:o,normal:Wvt(t.normal,t.position,s,i,a),tangent:qvt(t.tangent,t.position,s,i,a)}}function cDe(t,e,r){La(t.spatialReference,[t.x,t.y,t.z??0],r,nc(t.spatialReference));const i=dL(e?e.unit:null,t.spatialReference);return P2(r,r,[i,i,i]),r}function Hvt(t,e,r,i){const n=tne(t,e,i),s=new Float64Array(n.length);return pf(s,n,r),s}function Wvt(t,e,r,i,n){if(t==null)return null;const s=YU(t,e,r,i,new Float32Array(t.length));return ff(s,s,n),s}function qvt(t,e,r,i,n){if(t==null)return null;const s=XU(t,e,r,i,new Float32Array(t.length));return ff(s,s,n,4),s}function dL(t,e){if(t==null)return 1;const r=xW(e);return 1/mo(r,"meters",t)}const gx=xe(),Yvt=xe(),uDe=li(),VHt=Object.freeze(Object.defineProperty({__proto__:null,applyTransform:sDe,georeference:nne,georeferenceApplyTransform:oDe,georeferenceByTransform:aDe,georeferenceGlobal:QU,getUnitScale:dL,project:sne,ungeoreference:hJ,ungeoreferenceByTransform:Uvt,ungeoreferenceGlobal:one},Symbol.toStringTag,{value:"Module"}));var Jw;(function(t){t[t.EnableFastUpdates=0]="EnableFastUpdates",t[t.DisableFastUpdates=1]="DisableFastUpdates",t[t.UpdateFastLocalOrigin=2]="UpdateFastLocalOrigin"})(Jw||(Jw={}));let hDe=class{constructor(e){this.data=e,this.type="encoded-mesh-texture",this.encoding=F0.KTX2_ENCODING}};function ER(t){return(t==null?void 0:t.type)==="encoded-mesh-texture"}async function Xvt(t){const e=new Blob([t]),r=await e.text();return JSON.parse(r)}async function Zvt(t,e){if(e===F0.KTX2_ENCODING)return new hDe(t);const r=new Blob([t],{type:e}),i=URL.createObjectURL(r),n=new Image;if(se("esri-iPhone"))return new Promise((s,o)=>{const a=()=>{c(),s(n)},l=u=>{c(),o(u)},c=()=>{URL.revokeObjectURL(i),n.removeEventListener("load",a),n.removeEventListener("error",l)};n.addEventListener("load",a),n.addEventListener("error",l),n.src=i});try{n.src=i,await n.decode()}catch{console.warn("Failed decoding HTMLImageElement")}return URL.revokeObjectURL(i),n}function Om(t){if(t==null)return null;const e=t.offset!=null?t.offset:o$e,r=t.rotation!=null?t.rotation:0,i=t.scale!=null?t.scale:a$e,n=QO(1,0,0,0,1,0,e[0],e[1],1),s=QO(Math.cos(r),-Math.sin(r),0,Math.sin(r),Math.cos(r),0,0,0,1),o=QO(i[0],0,0,0,i[1],0,0,0,1),a=li();return XE(a,s,o),XE(a,n,a),a}let Jvt=class extends Tg{constructor(){super(...arguments),this._originalGeometries=[],this._fastTransformUpdatesEnabled=!1}get fastTransformUpdatesEnabled(){return this._fastTransformUpdatesEnabled}enableFastTransformUpdates(e,r){if(this._fastTransformUpdatesEnabled)return;this._fastTransformUpdatesEnabled=!0;const{stageObject:i}=this,n=i.geometries.slice();i.removeAllGeometries();const s=NE(CG,i.transformation),o=r.getOrigin(s);for(const a of n){const l=e(a.material),c=a.instantiate({material:l});c.localOrigin=o,i.addGeometry(c)}this._originalGeometries=n}disableFastTransformUpdates(e){if(!this._fastTransformUpdatesEnabled)return;this._fastTransformUpdatesEnabled=!1;const{stageObject:r}=this,i=r.geometries.map(n=>e(n.material));r.removeAllGeometries();for(let n=0;n<this._originalGeometries.length;n++){const s=this._originalGeometries[n],o=i[n];o.setParameters({modelTransformation:null}),o===s.material?r.addGeometry(s):r.addGeometry(s.instantiate({material:o}))}this._originalGeometries.length=0}updateFastLocalOrigin(e,r,i){if(!this._fastTransformUpdatesEnabled)return;const{stageObject:n}=this;if(n.geometries.length===0)return;const s=n.geometries[0].localOrigin,o=NE(CG,e),a=i.getOrigin(o);if(a===s)return;const l=(r==null?void 0:r.localMatrix)??sn;n.shaderTransformation=null,n.transformation=e,n.geometries.forEach(c=>{c.transformation=l,c.localOrigin=a})}updateTransform(e,r,i){const{stageObject:n}=this,s=(r==null?void 0:r.localMatrix)??sn;if(!this._fastTransformUpdatesEnabled)return n.shaderTransformation=null,n.transformation=e,n.geometries.forEach(f=>{f.transformation=s}),void(this._fastUpdateEdgeTransform()||this.resetEdgeObject(i));const o=n.transformation,a=n.geometries[0].transformation,l=e,c=s,u=Hr(dme,o,a),h=Hr(pme,l,c),p=Hr(fme,h,os(fme,a));n.shaderTransformation=p,this._setFastMaterialTransformation({matA:u,matB:h}),this._fastUpdateEdgeTransform()||this.resetEdgeObject(i)}alignWithElevation(e,r,i,n){if(!this._fastTransformUpdatesEnabled)return void super.alignWithElevation(e,r,i,n);i!=null&&OU(this.elevationContext.featureExpressionInfoContext,i);const s=(g,_)=>Tv(g,e,this.elevationContext,r,_),{stageObject:o}=this;if(!o.geometries[0].material.parameters.modelTransformation)return;const a=o.transformation,l=o.geometries[0].transformation,c=Hr(dme,a,l),u=o.effectiveTransformation,h=Zn(Qvt,u);this.alignedSampledElevation=Lx(this,this.elevationContext,e.spatialReference,s,r,h),o.shaderTransformation=h;const p=o.geometries[0].transformation,f=Hr(pme,h,p);this._setFastMaterialTransformation({matA:c,matB:f}),this._fastUpdateEdgeTransform()||this.resetEdgeObject(n)}_setFastMaterialTransformation({matA:e,matB:r}){const{stageObject:i}=this;if(i.geometries.length===0)return;const n=i.geometries[0].localOrigin,s=MI(Kvt,ne(CG,n.vec3,-1)),o=Hr(mme,s,e),a=Hr(gme,s,r),l=os(mme,o),c=Hr(gme,a,l);for(const u of i.geometries)u.material.setParameters({modelTransformation:c})}_fastUpdateEdgeTransform(){return this._stageLayer.stage.renderer.ensureEdgeView().fastUpdateObject3DEdgesTransform(this.stageObject)}};const CG=C(),dme=xe(),pme=xe(),Qvt=xe(),fme=xe(),mme=xe(),gme=xe(),Kvt=xe();let ebt=class{constructor(){this._fastTransformOriginalMaterials=new Map,this._fastTransformClonedMaterials=new Map,this._graphicReferenceCount=0}enable(e,r,i){e.enableFastTransformUpdates(n=>{if(this._graphicReferenceCount<=1){if(this._fastTransformOriginalMaterials.has(n))return n;const o=r.byMaterial(n);return this._fastTransformOriginalMaterials.set(n,o),r.delete(n),n}const s=new hf(n.parameters);return i.stage.add(s),this._fastTransformClonedMaterials.set(s,n),s},i.localOriginFactory)}disable(e,r,i){const n=new Set,s=new Set;e.disableFastTransformUpdates(o=>{if(!this._fastTransformClonedMaterials.has(o)){const c=o,u=this._fastTransformOriginalMaterials.get(c);return r.has(u.uid)?(n.add(c),r.byUid(u.uid).material):(s.add(c),u.material)}const a=o,l=this._fastTransformClonedMaterials.get(a);return this._fastTransformClonedMaterials.delete(a),i.stage.remove(a),l});for(const o of n)this._fastTransformOriginalMaterials.delete(o),i.stage.remove(o);for(const o of s){const a=this._fastTransformOriginalMaterials.get(o);this._fastTransformOriginalMaterials.delete(o),r.set(a.uid,a)}}onAddGraphic(){this._graphicReferenceCount++}onRemoveGraphic(e,r,i){this._graphicReferenceCount--,this.disable(e,r,i)}forEachMaterialInfo(e){this._fastTransformOriginalMaterials.forEach(e)}forEachClonedMaterial(e){this._fastTransformClonedMaterials.forEach(e)}destroy(e){e.removeMany(Array.from(this._fastTransformClonedMaterials.keys())),e.removeMany(Array.from(this._fastTransformOriginalMaterials.values(),({material:r})=>r)),this._fastTransformClonedMaterials.clear(),this._fastTransformOriginalMaterials.clear()}},tbt=class{constructor(){this._byUid=new Map,this._byMaterial=new Map}get materials(){return Array.from(this._byUid.values(),e=>e.material)}byUid(e){return this._byUid.get(e)}byMaterial(e){return this._byMaterial.get(e)}set(e,r){this._byUid.set(e,r),this._byMaterial.set(r.material,r)}delete(e){var i;const r=(i=this._byMaterial.get(e))==null?void 0:i.uid;r&&(this._byUid.delete(r),this._byMaterial.delete(e))}has(e){return this._byUid.has(e)}forEachMaterialInfo(e){this._byUid.forEach(e)}clear(){this._byUid.clear(),this._byMaterial.clear()}};const rbt=Qi().vec3f(R.POSITION),ibt=Qi().vec3f(R.POSITION).vec2f(R.UV0),nbt=Qi().vec3f(R.POSITION).vec4u8(R.COLOR);Qi().vec3f(R.POSITION).vec4u8(R.OBJECTANDLAYERIDCOLOR);const sbt=Qi().vec3f(R.POSITION).vec2f(R.UV0).vec4u8(R.OBJECTANDLAYERIDCOLOR);Qi().vec3f(R.POSITION).vec4u8(R.COLOR).vec4u8(R.OBJECTANDLAYERIDCOLOR);function dDe(t){const e=new Or,{vertex:r,fragment:i}=e;return e.include(Kl,t),e.include(H2,t),Zc(r,t),e.attributes.add(R.POSITION,"vec3"),e.varyings.add("vpos","vec3"),r.code.add(T`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);
}`),t.output===U.Highlight&&e.include(Vv,t),e.include(Fn,t),i.uniforms.add(new $e("alphaCoverage",(n,s)=>Math.min(1,n.width*s.camera.pixelRatio))),t.hasVertexColors||i.uniforms.add(new xr("constantColor",n=>n.color)),i.code.add(T`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${t.hasVertexColors?"vColor":"constantColor"};

    ${t.output===U.ObjectAndLayerIdColor?T`color.a = 1.0;`:""}

    if (color.a < ${T.float(Fo)}) {
      discard;
    }

    ${t.output===U.Color?T`fragColor = highlightSlice(color, vpos);`:""}
    ${t.output===U.Highlight?T`outputHighlight();`:""}
  }
  `),e}const obt=Object.freeze(Object.defineProperty({__proto__:null,build:dDe},Symbol.toStringTag,{value:"Module"}));let pDe=class fDe extends Vr{initializeProgram(e){return new Lr(e.rctx,fDe.shader.get().build(this.configuration),Mr)}initializePipeline(){const e=this.configuration,r=Wo(Se.SRC_ALPHA,Se.ONE,Se.ONE_MINUS_SRC_ALPHA,Se.ONE_MINUS_SRC_ALPHA),i=(n,s=null,o=null)=>kt({blending:s,depthTest:lie,depthWrite:o,colorWrite:Yt,stencilWrite:e.hasOccludees?pg:null,stencilTest:e.hasOccludees?n?Cv:jv:null});return e.output===U.Color?(this._occludeePipelineState=i(!0,e.transparent?r:null,ru),i(!1,e.transparent?r:null,ru)):i(!1)}get primitiveType(){return sr.LINES}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}};pDe.shader=new Ir(obt,()=>ge(()=>Promise.resolve().then(()=>QNt),void 0));let OS=class extends vl{constructor(){super(...arguments),this.output=U.Color,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.hasOccludees=!1}};d([j({count:U.COUNT})],OS.prototype,"output",void 0),d([j()],OS.prototype,"hasSlicePlane",void 0),d([j()],OS.prototype,"hasVertexColors",void 0),d([j()],OS.prototype,"transparent",void 0),d([j()],OS.prototype,"hasOccludees",void 0);let yme=class extends Bv{constructor(e){super(e,new lbt),this._configuration=new OS,this.produces=new Map([[ue.OPAQUE_MATERIAL,r=>r===U.Color||r===U.Highlight||r===U.ObjectAndLayerIdColor]])}getConfiguration(e){return this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.transparent=this.parameters.color[3]<1||this.parameters.width<1,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration}intersect(e,r,i,n,s,o){if(!i.options.selectionMode||!e.visible)return;if(!xPe(r))return void re.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial").error("intersection assumes a translation-only matrix");const a=e.attributes.get(R.POSITION).data,l=i.camera,c=ubt;eo(c,i.point);const u=2;ie(aA[0],c[0]-u,c[1]+u,0),ie(aA[1],c[0]+u,c[1]+u,0),ie(aA[2],c[0]+u,c[1]-u,0),ie(aA[3],c[0]-u,c[1]-u,0);for(let _=0;_<4;_++)if(!l.unprojectFromRenderScreen(aA[_],kg[_]))return;Ma(l.eye,kg[0],kg[1],EG),Ma(l.eye,kg[1],kg[2],PG),Ma(l.eye,kg[2],kg[3],AG),Ma(l.eye,kg[3],kg[0],MG);let h=Number.MAX_VALUE,p=0;for(let _=0;_<a.length-5;_+=3){if($l[0]=a[_]+r[12],$l[1]=a[_+1]+r[13],$l[2]=a[_+2]+r[14],Il[0]=a[_+3]+r[12],Il[1]=a[_+4]+r[13],Il[2]=a[_+5]+r[14],bi(EG,$l)<0&&bi(EG,Il)<0||bi(PG,$l)<0&&bi(PG,Il)<0||bi(AG,$l)<0&&bi(AG,Il)<0||bi(MG,$l)<0&&bi(MG,Il)<0)continue;if(l.projectToRenderScreen($l,bb),l.projectToRenderScreen(Il,wb),bb[2]<0&&wb[2]>0){ye(kf,$l,Il);const b=l.frustum,w=-bi(b[si.NEAR],$l)/de(kf,b[si.NEAR]);ne(kf,kf,w),fe($l,$l,kf),l.projectToRenderScreen($l,bb)}else if(bb[2]>0&&wb[2]<0){ye(kf,Il,$l);const b=l.frustum,w=-bi(b[si.NEAR],Il)/de(kf,b[si.NEAR]);ne(kf,kf,w),fe(Il,Il,kf),l.projectToRenderScreen(Il,wb)}else if(bb[2]<0&&wb[2]<0)continue;bb[2]=0,wb[2]=0;const v=jee(Ax(bb,wb,bme),c);v<h&&(h=v,ce(_me,$l),ce(vme,Il),p=_/3)}const f=i.rayBegin,g=i.rayEnd;if(h<u*u){let _=Number.MAX_VALUE;if(ySe(Ax(_me,vme,bme),Ax(f,g,cbt),vb)){ye(vb,vb,f);const v=Te(vb);ne(vb,vb,1/v),_=v/Di(f,g)}o(_,vb,p,!1)}}intersectDraped(e,r,i,n,s,o){if(!i.options.selectionMode)return;const a=e.attributes.get(R.POSITION).data,l=e.attributes.get(R.SIZE),c=l?l.data[0]:0,u=n[0],h=n[1],p=((c+1)/2+4)*e.screenToWorldRatio;let f=Number.MAX_VALUE,g=0;for(let _=0;_<a.length-5;_+=3){const v=a[_],b=a[_+1],w=u-v,x=h-b,S=a[_+3]-v,E=a[_+4]-b,A=we((S*w+E*x)/(S*S+E*E),0,1),O=S*A-w,L=E*A-x,z=O*O+L*L;z<f&&(f=z,g=_/3)}f<p*p&&s(o.dist,o.normal,g,!1)}createGLMaterial(e){return new abt(e)}createBufferWriter(){const e=this.parameters.hasVertexColors?nbt:rbt;return new eP(e)}},abt=class extends zv{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output===U.Color&&this._updateOccludeeState(e),this.ensureTechnique(pDe,e)}},lbt=class extends Zre{constructor(){super(...arguments),this.color=qh,this.hasVertexColors=!1,this.hasSlicePlane=!1,this.width=1,this.hasOccludees=!1}};const $l=C(),Il=C(),kf=C(),vb=C(),bb=oa(),wb=oa(),_me=C(),vme=C(),bme=yf(),cbt=yf(),ubt=C(),aA=[oa(),oa(),oa(),oa()],kg=[C(),C(),C(),C()],EG=zr(),PG=zr(),AG=zr(),MG=zr(),hbt=["mesh"];let dbt=class extends Sg{constructor(e,r,i,n){super(e,r,i,n),this._materialInfoCache=new tbt,this._fastUpdateProcessor=new ebt,this._textures=new Map,this.ensureDrapedStatus(!1)}async doLoad(){yi.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new yme({color:[1,0,1,1]}),this._debugFaceNormalMaterial=new yme({color:[0,1,1,1]}))}destroy(){super.destroy(),this._textures.forEach(e=>e.unload()),this._context.stage.removeMany(this._materialInfoCache.materials),this._context.stage.removeMany(Array.from(this._textures.values())),this._materialInfoCache.clear(),this._textures.clear(),this._fastUpdateProcessor.destroy(this._context.stage)}get materials(){return this._materialInfoCache.materials}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,hbt,"fill on mesh-3d"))return null;const i=this.setGraphicElevationContext(r),n=e.renderingInfo;return this._createAs3DShape(r,n,i,r.uid)}onRemoveGraphic(e){this._fastUpdateProcessor.onRemoveGraphic(e,this._materialInfoCache,this._context)}layerOpacityChanged(e,r){const i=this._getLayerOpacity();this._updateMaterialParameters(n=>{n.material.setParameters({layerOpacity:i});const s=n.material.parameters;this._setMaterialTransparentParameter(s,n),n.material.setParameters({transparent:s.transparent})}),e.forEach(n=>{var s;return(s=r(n))==null?void 0:s.layerOpacityChanged(i,this._context.isAsync)})}layerElevationInfoChanged(e,r){return this.updateGraphics3DGraphicElevationInfo(e,r,Sv)}slicePlaneEnabledChanged(e,r){return this._updateMaterialParameters(({material:i})=>{i.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),e.forEach(i=>{var n;return(n=r(i))==null?void 0:n.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){const e=this._usePBR();return this._updateMaterialParameters(({material:r})=>r.setParameters({usePBR:e})),!0}updateTransform(e,r,i,n){const s=e.fastTransformUpdatesEnabled;switch(n){case Jw.EnableFastUpdates:if(s)return!0;break;case Jw.DisableFastUpdates:if(!s)return!0;break;default:if(!s)return!1}const o=this._context.renderCoordsHelper.spatialReference,a=pbt,{origin:l,transform:c}=i;if(!La(r,ie(so,l.x,l.y,l.z??0),a,o))return!1;switch(n){case Jw.EnableFastUpdates:this._fastUpdateProcessor.enable(e,this._materialInfoCache,this._context);break;case Jw.DisableFastUpdates:this._fastUpdateProcessor.disable(e,this._materialInfoCache,this._context);break;case Jw.UpdateFastLocalOrigin:e.updateFastLocalOrigin(a,c,this._context.localOriginFactory)}const{elevationContext:u}=e;u.centerPointInElevationSR=this._getCenterPointInElevationSR(a);const{elevationProvider:h,renderCoordsHelper:p}=this._context,f=(g,_)=>Tv(g,h,u,p,_);return e.alignedSampledElevation=Lx(e,u,h.spatialReference,f,p,a),e.updateTransform(a,c,this._context.isAsync),!0}_requiresSymbolVertexColors(){return this._drivenProperties.color||this._drivenProperties.opacity}_colorOrTextureUid(e){return e==null?"-":e instanceof Xe?e.toHex():e.contentHash}_materialPropertiesDefault(e,r){const i=this._requiresSymbolVertexColors(),n=!!e.vertexAttributes.color,s=!!e.vertexAttributes.tangent;return{hasSymbolVertexColors:i,hasVertexColors:n,hasVertexTangents:s,uid:`vc:${n},vt:${s},vct${r},svc:${i}`}}_textureTransformUid(e){const{offset:r,scale:i,rotation:n}=e??mbt;return`${r[0]},${r[1]},${n},${i[0]},${i[1]}`}_materialProperties(e,r,i){const n=this._materialPropertiesDefault(e,i);if(!r.material)return n;const{color:s,colorTexture:o,colorTextureTransform:a,normalTexture:l,normalTextureTransform:c,doubleSided:u,alphaCutoff:h,alphaMode:p}=r.material,f=this._colorOrTextureUid(s),g=this._colorOrTextureUid(o),_=this._textureTransformUid(a),v=this._colorOrTextureUid(l),b=this._textureTransformUid(c);if(n.color=s,n.colorTexture=o,n.normalTexture=l,n.uid=`${n.uid},cmuid:${f},ctmuid:${g},cttuid:${_},ntmuid:${v},nttuid:${b},ds:${u},ac:${h},am:${p}`,r.material instanceof QLe){const{metallic:w,roughness:x,metallicRoughnessTexture:S,metallicRoughnessTextureTransform:E,emissiveColor:A,emissiveTexture:O,emissiveTextureTransform:L,occlusionTexture:z,occlusionTextureTransform:k}=r.material,q=this._colorOrTextureUid(S),B=this._textureTransformUid(E),J=this._colorOrTextureUid(A),W=this._colorOrTextureUid(O),Y=this._textureTransformUid(L),le=this._colorOrTextureUid(z),D=this._textureTransformUid(k);n.metallic=w,n.roughness=x,n.metallicRoughnessTexture=S,n.emissiveColor=A,n.emissiveTexture=O,n.occlusionTexture=z,n.colorTextureTransform=this._convertTextureTransform(a),n.normalTextureTransform=this._convertTextureTransform(c),n.emissiveTextureTransform=this._convertTextureTransform(L),n.occlusionTextureTransform=this._convertTextureTransform(k),n.metallicRoughnessTextureTransform=this._convertTextureTransform(E),n.uid=`${n.uid},mrm:${w},mrr:${x},mrt:${q},mrtt:${B},emuid:${J},etmuid:${W},ett:${Y},otmuid:${le},ott:${D}`}return n}_convertTextureTransform(e){if(!e)return null;const{scale:r,offset:i,rotation:n}=e;return{scale:r,offset:i,rotation:Nt(n)}}_setInternalColorValueParameters(e,r){r.diffuse=Xe.toUnitRGB(e),r.opacity=e.a}_getLoadableTextureResource(e){return e.data??e.url}_getInternalTextureId(e){const r=this._getInternalTexture(e,fi.Opaque);return r==null?void 0:r.id}_getInternalTexture(e,r){const i=this._getLoadableTextureResource(e);if(!i)return null;const n=`${e.contentHash}/${r}`;let s=this._textures.get(n);if(!s){let o=null;const a=this._context.stage.renderView.renderingContext.parameters.maxMaxAnisotropy,l={wrap:this._castTextureWrap(e.wrap),noUnpackFlip:!0,maxAnisotropy:a,mipmap:a>1};ER(i)?(o=i.data,l.preMultiplyAlpha=!1,l.encoding=i.encoding):(o=i,l.preMultiplyAlpha=r!==fi.Opaque,l.downsampleUncompressed=this._context.graphicsCoreOwner.view.qualitySettings.graphics3D.uncompressedTextureDownsamplingEnabled),s=new Pv(o,l),this._textures.set(n,s),s.load(this._context.stage.renderView.renderingContext),this._context.stage.add(s)}return s}_castTextureWrap(e="repeat"){if(typeof e=="string"){const r=this._castTextureWrapIndividual(e);return{s:r,t:r}}return{s:this._castTextureWrapIndividual(e.horizontal),t:this._castTextureWrapIndividual(e.vertical)}}_castTextureWrapIndividual(e){switch(e){case"clamp":return Jt.CLAMP_TO_EDGE;case"mirror":return Jt.MIRRORED_REPEAT;default:return Jt.REPEAT}}_setInternalMaterialParameters(e,r){var n,s;if(e.color!=null&&this._setInternalColorValueParameters(e.color,r),e.colorTexture!=null){const o=this._getInternalTexture(e.colorTexture,r.textureAlphaMode);o?(r.textureId=o.id,r.textureAlphaPremultiplied=!!o.parameters.preMultiplyAlpha):r.textureId=void 0}e.normalTexture&&(r.normalTextureId=this._getInternalTextureId(e.normalTexture)),e.emissiveColor&&(r.emissiveFactor=Xe.toUnitRGB(e.emissiveColor)),e.emissiveTexture&&(r.emissiveTextureId=this._getInternalTextureId(e.emissiveTexture)),e.occlusionTexture&&(r.occlusionTextureId=this._getInternalTextureId(e.occlusionTexture)),e.metallicRoughnessTexture&&(r.metallicRoughnessTextureId=this._getInternalTextureId(e.metallicRoughnessTexture)),r.colorTextureTransformMatrix=Om(e.colorTextureTransform),r.normalTextureTransformMatrix=Om(e.normalTextureTransform);const i=((n=e.normalTextureTransform)==null?void 0:n.scale)!=null?(s=e.normalTextureTransform)==null?void 0:s.scale:E9;r.scale=[i[0],i[1]],r.occlusionTextureTransformMatrix=Om(e.occlusionTextureTransform),r.emissiveTextureTransformMatrix=Om(e.emissiveTextureTransform),r.metallicRoughnessTextureTransformMatrix=Om(e.metallicRoughnessTextureTransform)}_setExternalMaterialParameters(e){var n,s;const r=this._drivenProperties.color;let i=((n=this.symbolLayer.material)==null?void 0:n.colorMixMode)??null;if(r)e.externalColor=qh;else{const o=((s=this.symbolLayer.material)==null?void 0:s.color)??null;o?e.externalColor=Xe.toUnitRGBA(o):(i=null,e.externalColor=qh)}i&&(e.colorMixMode=i),e.castShadows=!!this.symbolLayer.castShadows}_hasTransparentVertexColors(e){const r=e.vertexAttributes.color;if(r==null)return!1;for(let i=3;i<r.length;i+=4)if(r[i]!==255)return!0;return!1}_getOrCreateMaterial(e,r){var g,_,v;const i=(g=r.material)==null?void 0:g.color,n=(_=r.material)==null?void 0:_.colorTexture,s=(v=r.material)==null?void 0:v.alphaMode,o=s==="blend",a=s!=="opaque"&&(this._hasTransparentVertexColors(e)||i!=null&&i.a<1||(n==null?void 0:n.transparent)||o),l=this._materialProperties(e,r,a),c=this._materialInfoCache.byUid(l.uid);if(c)return c.material;const u={uid:l.uid,material:null,isComponentTransparent:a,alphaMode:r.material?r.material.alphaMode:"opaque"},h=PRe({normalTexture:l.normalTexture,metallicRoughnessTexture:l.metallicRoughnessTexture,metallicFactor:l.metallic,roughnessFactor:l.roughness,emissiveTexture:l.emissiveTexture,emissiveFactor:Xe.toUnitRGB(l.emissiveColor),occlusionTexture:l.occlusionTexture}),p={usePBR:this._usePBR(),isSchematic:h,hasVertexColors:l.hasVertexColors,hasSymbolColors:l.hasSymbolVertexColors,hasVertexTangents:l.hasVertexTangents,ambient:zn,diffuse:Im,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:Pi.None,layerOpacity:this._getLayerOpacity(),hasSlicePlane:this._context.slicePlaneEnabled,initTextureTransparent:!0};p.mrrFactors=h?[...cie]:[l.metallic,l.roughness,IU[2]],r.material&&(p.doubleSided=r.material.doubleSided,p.cullFace=r.material.doubleSided?Pi.None:Pi.Back,p.textureAlphaCutoff=r.material.alphaCutoff),this._setExternalMaterialParameters(p),this._setMaterialTransparentParameter(p,u),this._setInternalMaterialParameters(l,p);const f=new hf(p);return u.material=f,this._materialInfoCache.set(l.uid,u),this._context.stage.add(f),f}_usePBR(){return this._context.physicalBasedRenderingEnabled}_setMaterialTransparentParameter(e,r){e.transparent=this.needsDrivenTransparentPass||r.isComponentTransparent||e.layerOpacity<1||e.opacity<1||e.externalColor&&e.externalColor[3]<1,r.alphaMode==="auto"?e.textureAlphaMode=e.transparent?fi.MaskBlend:fi.Opaque:e.textureAlphaMode=r.alphaMode==="opaque"?fi.Opaque:r.alphaMode==="mask"?fi.Mask:fi.Blend}_addDebugNormals(e,r){const i=r.length,n=e.spatialReference.isGeographic?20015077/180:1,s=.1*Math.max(e.extent.width*n,e.extent.height*n,e.extent.zmax-e.extent.zmin),o=[],a=[],l=[],c=[];for(let f=0;f<i;f++){const g=r[f],_=g.attributes.get(R.POSITION),v=g.attributes.get(R.NORMAL),b=_.data,w=_.indices,x=v.data,S=v.indices;for(let E=0;E<w.length;E++){const A=3*w[E],O=3*S[E];for(let L=0;L<3;L++)o.push(b[A+L]);for(let L=0;L<3;L++)o.push(b[A+L]+x[O+L]*s);if(a.push(a.length),a.push(a.length),E%3==0){this._calculateFaceNormal(b,w,E,RT),this._getFaceVertices(b,w,E,so,MT,OT),fe(so,so,MT),fe(so,so,OT),ne(so,so,1/3);for(let L=0;L<3;L++)l.push(so[L]);for(let L=0;L<3;L++)l.push(so[L]+RT[L]*s);c.push(c.length),c.push(c.length)}}}const u=r[0].transformation,h=new gs(this._debugVertexNormalMaterial,[[R.POSITION,new Ye(o,a,3,!0)]],null,Cn.Line);r.push(h),h.transformation=u;const p=new gs(this._debugFaceNormalMaterial,[[R.POSITION,new Ye(l,c,3,!0)]],null,Cn.Line);p.transformation=u,r.push(p)}_createAs3DShape(e,r,i,n){const s=e.geometry;if(s.type!=="mesh")return null;const o=this._createGeometryInfo(s,r,n);if(o==null)return null;const{geometries:a,objectTransformation:l}=o;yi.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(s,a);const c=new Ey({geometries:a,layerUid:this._context.layer.uid,graphicUid:n,isElevationSource:!0});c.transformation=l;const u=bRe(this.symbolLayer,{opacity:this._getLayerOpacity()}),h=u?new edt(a[0].material,[u],{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}):null,p=new Jvt(this,c,a,null,null,Lx,i,h);this._fastUpdateProcessor.onAddGraphic(),p.needsElevationUpdates=Sv(i.mode),p.useObjectOriginAsAttachmentOrigin=!0,i.centerPointInElevationSR=this._getCenterPointInElevationSR(c.transformation);const{elevationProvider:f,renderCoordsHelper:g}=this._context,_=(v,b)=>Tv(v,f,i,g,b);return p.alignedSampledElevation=Lx(p,i,f.spatialReference,_,g),p}_getCenterPointInElevationSR(e){const r=Nv(0,0,0,this._context.elevationProvider.spatialReference!=null?this._context.elevationProvider.spatialReference:null);return ag([e[12],e[13],e[14]],this._context.renderCoordsHelper.spatialReference,r),r}_createComponentNormals(e,r,i,n){switch(i.shading||"flat"){default:case"source":return this._createComponentNormalsSource(e,r,i,n);case"flat":return this._createComponentNormalsFlat(e,n);case"smooth":return this._createComponentNormalsSmooth(e,n)}}_createComponentNormalsSource(e,r,i,n){if(r==null)return this._createComponentNormalsFlat(e,n);let s=!1;if(!i.trustSourceNormals)for(let o=0;o<n.length;o+=3){this._calculateFaceNormal(e,n,o,RT);for(let a=0;a<3;a++){const l=3*n[o+a];so[0]=r[l],so[1]=r[l+1],so[2]=r[l+2],de(RT,so)<0&&(r[l]=-r[l],r[l+1]=-r[l+1],r[l+2]=-r[l+2],s=!0)}}return new OG(r,n,s)}_createComponentNormalsFlat(e,r){const i=mn(r.length),n=new Array(3*r.length);for(let s=0;s<r.length;s+=3){const o=this._calculateFaceNormal(e,r,s,RT);for(let a=0;a<3;a++)i[s+a]=o[a],n[s+a]=s/3}return new OG(i,n,!1)}_createComponentNormalsSmooth(e,r){const i={};for(let o=0;o<r.length;o+=3){const a=this._calculateFaceNormal(e,r,o,RT);for(let l=0;l<3;l++){const c=r[o+l];let u=i[c];u||(u={normal:C(),count:0},i[c]=u),fe(u.normal,u.normal,a),u.count++}}const n=mn(3*r.length),s=new Array(3*r.length);for(let o=0;o<r.length;o++){const a=i[r[o]];a.count!==1&&(pe(a.normal,a.normal),a.count=1);for(let l=0;l<3;l++)n[3*o+l]=a.normal[l];s[o]=o}return new OG(n,s,!1)}_getFaceVertices(e,r,i,n,s,o){const a=3*r[i],l=3*r[i+1],c=3*r[i+2];n[0]=e[a],n[1]=e[a+1],n[2]=e[a+2],s[0]=e[l],s[1]=e[l+1],s[2]=e[l+2],o[0]=e[c],o[1]=e[c+1],o[2]=e[c+2]}_calculateFaceNormal(e,r,i,n){return this._getFaceVertices(e,r,i,so,MT,OT),ye(MT,MT,so),ye(OT,OT,so),Je(so,MT,OT),pe(n,so),n}_getOrCreateComponents(e){return e.components??fbt}_createPositionBuffer(e,r){let i=e.vertexAttributes.position;const n=r.reprojection===Tc.RENDER?r.transformBeforeProject:null;if(n&&(i=pf(new Float64Array(i.length),i,n)),r.reprojection===Tc.NONE)return r.needsBufferCopy?new Float64Array(i):i;const s=n?i:new Float64Array(i.length);return Ji(i,e.spatialReference,0,s,this._context.renderCoordsHelper.spatialReference,0,i.length/3),s}_createNormalBuffer(e,r,i){let n=e.vertexAttributes.normal;if(n==null)return null;const s=i.reprojection===Tc.RENDER?i.transformBeforeProject:null;if(s&&(n=rDe(n,new Float32Array(n.length),s)),this._context.graphicsCoreOwner.view.viewingMode==="local"||i.reprojection===Tc.NONE)return i.needsBufferCopy&&e.vertexAttributes.normal===n?new Float32Array(n):n;const o=e.vertexAttributes.position,a=s?n:new Float32Array(n.length);return YU(n,o,r,e.spatialReference,a)}_createTangentBuffer(e,r,i){let n=e.vertexAttributes.tangent;if(n==null)return null;const s=i.reprojection===Tc.RENDER?i.transformBeforeProject:null;if(s&&(n=iDe(n,new Float32Array(n.length),s)),this._context.graphicsCoreOwner.view.viewingMode==="local"||i.reprojection===Tc.NONE)return i.needsBufferCopy&&e.vertexAttributes.normal===n?new Float32Array(n):n;const o=e.vertexAttributes.position,a=s?n:new Float32Array(n.length);return XU(n,o,r,e.spatialReference,a)}_createColorBuffer(e){return e.vertexAttributes.color}_createSymbolColorBuffer(e){var r,i;if(this._requiresSymbolVertexColors()){const n=this._getVertexOpacityAndColor(e),s=ydt((i=(r=this.symbolLayer)==null?void 0:r.material)==null?void 0:i.colorMixMode),o=new Uint8Array(4);return MRe(n,s,o),o}return null}_createBuffers(e,r){const i=e.vertexAttributes&&e.vertexAttributes.position;if(!i)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;const n=e.vertexAttributes.normal,s=e.vertexAttributes.uv,o=e.vertexAttributes.tangent;if(n&&n.length!==i.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(o&&o.length/4!=i.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(s&&s.length/2!=i.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;const a=this._computeReprojectionInfo(e),l=this._createPositionBuffer(e,a),c=this._createColorBuffer(e),u=this._createSymbolColorBuffer(r),h=this._createNormalBuffer(e,l,a),p=this._createTangentBuffer(e,l,a);return{positionBuffer:l,normalBuffer:h,tangentBuffer:p,uvBuffer:s,colorBuffer:c,symbolColorBuffer:u,objectTransformation:a.reprojection===Tc.NONE&&a.objectTransformation?a.objectTransformation:this._transformOriginLocal(e,l,h,p),geometryTransformation:a.reprojection===Tc.NONE&&a.geometryTransformation?a.geometryTransformation:xe()}}_computeReprojectionInfo(e){var n;const{vertexSpace:r}=e,i=r.type==="georeferenced"?To(this._context.renderCoordsHelper.spatialReference,e.spatialReference)?Tc.NONE:Tc.RENDER:Tc.NONE;if(gf(r)){const s=r.origin,o=xe(),a=((n=e.transform)==null?void 0:n.localMatrix)??sn;if(i===Tc.NONE)return La(e.spatialReference,s,o,this._context.renderCoordsHelper.spatialReference),{reprojection:i,objectTransformation:o,geometryTransformation:WE(a),needsBufferCopy:!1};const l=MI(xe(),s);return Hr(l,l,a),{reprojection:i,transformBeforeProject:l,needsBufferCopy:!0}}return{reprojection:i,needsBufferCopy:!0}}_transformOriginLocal(e,r,i,n){const s=this._context.renderCoordsHelper.spatialReference,o=e.anchor;WN[0]=o.x,WN[1]=o.y,WN[2]=o.z??0;const a=xe();return La(e.spatialReference,WN,a,s),os(wme,a),pf(r,r,wme),(i||n)&&(th(lA,a),gd(lA,lA),i&&ff(i,i,lA),n&&ff(n,n,lA,4)),a}_validateFaces(e,r){const i=e.vertexAttributes.position.length/3,n=r.faces;if(n){let s=-1;for(let o=0;o<n.length;o++){const a=n[o];a>s&&(s=a)}if(i<=s)return this.logger.warn(`Vertex index ${s} is out of bounds of the mesh position buffer`),!1}else if(i%3!=0)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0}_getOrCreateFaces(e,r){return r.faces??B2(e.vertexAttributes.position.length/3)}_isOutsideClippingArea(e){var o;if(!this._context.clippingExtent)return!1;const r=(o=e.vertexAttributes)==null?void 0:o.position;if(!r)return!1;const i=this._context.elevationProvider.spatialReference,n=sne({positions:r,transform:e.transform,vertexSpace:e.vertexSpace,inSpatialReference:e.spatialReference,outSpatialReference:i??e.spatialReference,localMode:this._context.stage.viewingMode===De.Local}),s=n.length/3;return Li(RG),Hc(RG,n,0,s),!zp(RG,this._context.clippingExtent)}_createGeometryInfo(e,r,i){if(!md(e.spatialReference,this._context.renderCoordsHelper.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(!this._validateVertexSpace(e)||this._isOutsideClippingArea(e))return null;const n=this._createBuffers(e,r);if(n==null)return null;const{positionBuffer:s,uvBuffer:o,colorBuffer:a,symbolColorBuffer:l,normalBuffer:c,tangentBuffer:u,objectTransformation:h,geometryTransformation:p}=n,f=this._getOrCreateComponents(e),g=new Array;let _=!1;const v=NE(so,h),b=this._context.localOriginFactory.getOrigin(v);for(const w of f){if(!this._validateFaces(e,w))return null;const x=this._getOrCreateFaces(e,w);if(x.length===0)continue;const S=this._createComponentNormals(s,c,w,x);S.didFlipNormals&&(_=!0);const E=[[R.POSITION,new Ye(s,x,3,!0)],[R.NORMAL,new Ye(S.normals,S.indices,3,!0)]];a&&E.push([R.COLOR,new Ye(a,x,4,!0)]),l&&E.push([R.SYMBOLCOLOR,new Ye(l,Uv(x.length),4,!0)]),o&&E.push([R.UV0,new Ye(o,x,2,!0)]),u&&E.push([R.TANGENT,new Ye(u,x,4,!0)]);const A=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:i,layerUid:this._context.layer.uid}),O=this._getOrCreateMaterial(e,w),L=new gs(O,E,null,Cn.Mesh,A);L.transformation=p,L.localOrigin=b,g.push(L)}return _&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals."),{geometries:g,objectTransformation:h}}_updateMaterialParameters(e){this._materialInfoCache.forEachMaterialInfo(e),this._fastUpdateProcessor.forEachMaterialInfo(e),this._fastUpdateProcessor.forEachClonedMaterial((r,i)=>{i.setParameters(r.parameters)})}_validateVertexSpace(e){const{_context:{graphicsCoreOwner:{view:{state:{viewingMode:r}}}}}=this,{vertexSpace:i}=e;return r!==De.Local||i.type!=="local"||(this.logger.warn("Displaying a mesh with a local vertex space in a view in local viewing mode is not supported."),!1)}test(){return{...super.test(),materials:this._materialInfoCache.materials}}},OG=class{constructor(e,r,i){this.normals=e,this.indices=r,this.didFlipNormals=i}};const WN=C(),so=C(),MT=C(),OT=C(),RT=C(),wme=xe(),lA=li(),pbt=xe(),RG=vs(),fbt=[new b2],mbt=new uE;var Tc;(function(t){t[t.NONE=0]="NONE",t[t.RENDER=1]="RENDER"})(Tc||(Tc={}));let gbt=class{constructor(e,r,i,n){this.graphics3DSymbolLayer=e,this.instanceIndex=r,this.elevationAligner=i,this.elevationContext=n,this.type="lod-instance",this._highlights=new Set,this.alignedSampledElevation=0,this.isElevationSource=!1,this.needsElevationUpdates=!1}initialize(){}setVisibility(e){const r=this._lodRenderer.instanceData;e!==r.getVisible(this.instanceIndex)&&r.setVisible(this.instanceIndex,e)}destroy(){this.instanceIndex!=null&&(this._lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))}alignWithElevation(e,r,i){if(this.elevationAligner){OU(this.elevationContext.featureExpressionInfoContext,i);const n=(o,a)=>Tv(o,e,this.elevationContext,r,a),s=this.elevationAligner(this,this.elevationContext,e.spatialReference,n,r);s!=null&&(this.alignedSampledElevation=s)}}getCenterObjectSpace(e=C()){return this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,zf),Ge(e,this._lodRenderer.baseBoundingSphere.center,zf)}getBoundingBoxObjectSpace(e=vs()){this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,zf);const r=this._lodRenderer.baseBoundingBox;Li(e);for(let i=0;i<8;++i)ie(fh,1&i?r[3]:r[0],2&i?r[4]:r[1],4&i?r[5]:r[2]),Ge(fh,fh,zf),lf(e,fh);return e}computeAttachmentOrigin(e){this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,zf),e.render.origin[0]+=zf[12],e.render.origin[1]+=zf[13],e.render.origin[2]+=zf[14],e.render.num++}async getProjectedBoundingBox(e,r,i,n,s){const o=this.getBoundingBoxObjectSpace(s),a=ybt,l=Ite(o)?1:a.length;this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,zf);for(let u=0;u<l;u++){const h=a[u];fh[0]=o[h[0]],fh[1]=o[h[1]],fh[2]=o[h[2]],Ge(fh,fh,zf),xb[3*u]=fh[0],xb[3*u+1]=fh[1],xb[3*u+2]=fh[2]}if(!e(xb,0,l))return null;Li(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let u=0;u<3*l;u+=3){for(let h=0;h<3;h++)o[h]=Math.min(o[h],xb[u+h]),o[h+3]=Math.max(o[h+3],xb[u+h]);c&&i.push({location:xb.slice(u,u+3),screenSpaceBoundingRect:c})}if(r&&(kp(o,$G),this.elevationContext.mode!=="absolute-height")){let u;const h=oie(o,r.service.spatialReference,r);try{u=await r.service.queryElevation($G[0],$G[1],n,h,"ground")}catch{}u!=null&&s3e(o,0,0,-this.alignedSampledElevation+u)}return o}addObjectState(e,r){if(e===oy.Highlight){const i=new Z6(e);this._addHighlightId(i),r.addExternal(n=>{this._removeHighlightId(n)},i)}}removeObjectState(e){this._highlights.forEach(r=>e.remove(r))}_addHighlightId(e){this._highlights.add(e),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)}_removeHighlightId(e){this._highlights.delete(e),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,this._highlights.size>0)}get _lodRenderer(){return this.graphics3DSymbolLayer.lodRenderer}};const xb=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],fh=C(),$G=C(),ybt=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],zf=xe();function _bt(t,e){const r=t.stageResources.geometries.map(n=>new mRe(n,t.stageResources.textures)),i=t.lodThreshold==null||t.lodThreshold===0&&e>0?bbt(r):t.lodThreshold;return new gRe(r,i,t.pivotOffset)}function vbt(t){return new yRe(t.map((e,r)=>_bt(e,r)))}function bbt(t){const e=t.reduce((r,{geometry:i})=>r+i.indexCount/3,0);return Math.sqrt(e*wbt/Math.PI)}const wbt=20;function xbt(t){return t=t||globalThis.location.hostname,Tbt.some(e=>(t==null?void 0:t.match(e))!=null)}function dJ(t,e){return t&&(e=e||globalThis.location.hostname)?e.match(mDe)!=null||e.match(yDe)!=null?t.replace("static.arcgis.com","staticdev.arcgis.com"):e.match(gDe)!=null||e.match(_De)!=null?t.replace("static.arcgis.com","staticqa.arcgis.com"):t:t}const mDe=/^devext.arcgis.com$/,gDe=/^qaext.arcgis.com$/,yDe=/^[\w-]*\.mapsdevext.arcgis.com$/,_De=/^[\w-]*\.mapsqa.arcgis.com$/,Tbt=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local.esri.com$/,mDe,gDe,/^jsapps.esri.com$/,yDe,_De];function Sbt(t,e,r){if(t.count!==e.count)return void Tie().error("source and destination buffers need to have the same number of elements");const i=t.count,n=r[0],s=r[1],o=r[2],a=r[3],l=r[4],c=r[5],u=r[6],h=r[7],p=r[8],f=r[9],g=r[10],_=r[11],v=r[12],b=r[13],w=r[14],x=r[15],S=t.typedBuffer,E=t.typedBufferStride,A=e.typedBuffer,O=e.typedBufferStride;for(let L=0;L<i;L++){const z=L*E,k=L*O,q=A[k],B=A[k+1],J=A[k+2],W=A[k+3];S[z]=n*q+l*B+p*J+v*W,S[z+1]=s*q+c*B+f*J+b*W,S[z+2]=o*q+u*B+g*J+w*W,S[z+3]=a*q+h*B+_*J+x*W}}function Cbt(t,e,r){ane(t.typedBuffer,e.typedBuffer,r,t.typedBufferStride,e.typedBufferStride)}function ane(t,e,r,i=4,n=i){if(t.length/i!=e.length/n)return void Tie().error("source and destination buffers need to have the same number of elements");const s=t.length/i,o=r[0],a=r[1],l=r[2],c=r[3],u=r[4],h=r[5],p=r[6],f=r[7],g=r[8];let _=0,v=0;for(let b=0;b<s;b++){const w=e[_],x=e[_+1],S=e[_+2],E=e[_+3];t[v]=o*w+c*x+p*S,t[v+1]=a*w+u*x+f*S,t[v+2]=l*w+h*x+g*S,t[v+3]=E,_+=n,v+=i}}function Ebt(t,e){const r=Math.min(t.count,e.count),i=t.typedBuffer,n=t.typedBufferStride,s=e.typedBuffer,o=e.typedBufferStride;for(let a=0;a<r;a++){const l=a*n,c=a*o,u=s[c],h=s[c+1],p=s[c+2],f=u*u+h*h+p*p;if(f>0){const g=1/Math.sqrt(f);i[l]=g*u,i[l+1]=g*h,i[l+2]=g*p}}}function Pbt(t,e,r){N8(t.typedBuffer,e,r,t.typedBufferStride)}function N8(t,e,r,i=4){const n=Math.min(t.length/i,e.count),s=e.typedBuffer,o=e.typedBufferStride;let a=0,l=0;for(let c=0;c<n;c++)t[l]=r*s[a],t[l+1]=r*s[a+1],t[l+2]=r*s[a+2],t[l+3]=r*s[a+3],a+=o,l+=i}Object.freeze(Object.defineProperty({__proto__:null,normalize:Ebt,scale:N8,scaleView:Pbt,transformMat3:ane,transformMat3View:Cbt,transformMat4:Sbt},Symbol.toStringTag,{value:"Module"}));function Abt(t,e){lne(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function lne(t,e,r=2,i=r){const n=e.length/2;let s=0,o=0;if(cd(e)||xze(e)){for(let l=0;l<n;++l)t[s]=e[o],t[s+1]=e[o+1],s+=r,o+=i;return}const a=Tze(e);if(wze(e))for(let l=0;l<n;++l)t[s]=Math.max(e[o]/a,-1),t[s+1]=Math.max(e[o+1]/a,-1),s+=r,o+=i;else for(let l=0;l<n;++l)t[s]=e[o]/a,t[s+1]=e[o+1]/a,s+=r,o+=i}function Mbt(t,e,r,i){const n=t.typedBuffer,s=t.typedBufferStride,o=(i==null?void 0:i.count)??t.count;let a=((i==null?void 0:i.dstIndex)??0)*s;for(let l=0;l<o;++l)n[a]=e,n[a+1]=r,a+=s}Object.freeze(Object.defineProperty({__proto__:null,fill:Mbt,normalizeIntegerBuffer:lne,normalizeIntegerBufferView:Abt},Symbol.toStringTag,{value:"Module"}));function Obt(t,e){pL(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function pL(t,e,r=3,i=r){const n=e.length/i;let s=0,o=0;for(let a=0;a<n;++a)t[s]=e[o],t[s+1]=e[o+1],t[s+2]=e[o+2],s+=r,o+=i}function Rbt(t,e,r,i,n){const s=t.typedBuffer,o=t.typedBufferStride,a=(n==null?void 0:n.count)??t.count;let l=((n==null?void 0:n.dstIndex)??0)*o;for(let c=0;c<a;++c)s[l]=e,s[l+1]=r,s[l+2]=i,l+=o}Object.freeze(Object.defineProperty({__proto__:null,copy:pL,copyView:Obt,fill:Rbt},Symbol.toStringTag,{value:"Module"}));function $bt(t,e){cne(t.typedBuffer,e,t.typedBufferStride)}function cne(t,e,r=4){const i=e.typedBuffer,n=e.typedBufferStride,s=e.count;let o=0,a=0;for(let l=0;l<s;++l)t[o]=i[a],t[o+1]=i[a+1],t[o+2]=i[a+2],t[o+3]=i[a+3],o+=r,a+=n}function Ibt(t,e,r,i,n,s){const o=t.typedBuffer,a=t.typedBufferStride,l=(s==null?void 0:s.count)??t.count;let c=((s==null?void 0:s.dstIndex)??0)*a;for(let u=0;u<l;++u)o[c]=e,o[c+1]=r,o[c+2]=i,o[c+3]=n,c+=a}Object.freeze(Object.defineProperty({__proto__:null,copy:cne,copyView:$bt,fill:Ibt},Symbol.toStringTag,{value:"Module"}));let vDe=class{constructor(e){this._streamDataRequester=e}async loadJSON(e,r){return this._load("json",e,r)}async loadBinary(e,r){return mg(e)?(vt(r),VK(e)):this._load("binary",e,r)}async loadImage(e,r){return this._load("image",e,r)}async _load(e,r,i){if(this._streamDataRequester==null)return(await Xi(r,{responseType:Lbt[e]})).data;const n=await sg(this._streamDataRequester.request(r,e,i));if(n.ok===!0)return n.value;throw J0(n.error),new K("",`Request for resource failed: ${n.error}`)}};const Lbt={image:"image",binary:"array-buffer",json:"json","image+type":void 0};function Dbt(t={}){return{color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,colorTextureTransform:null,normalTextureTransform:null,occlusionTextureTransform:null,emissiveTextureTransform:null,metallicRoughnessTextureTransform:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply",...t}}function Nbt(t,e={}){return{data:t,parameters:{wrap:{s:Jt.REPEAT,t:Jt.REPEAT,...e.wrap},noUnpackFlip:!0,mipmap:!1,...e}}}let KU=class pJ{constructor(e,r,i=""){this.major=e,this.minor=r,this._context=i}lessThan(e,r){return this.major<e||e===this.major&&this.minor<r}since(e,r){return!this.lessThan(e,r)}validate(e){if(this.major!==e.major){const r=this._context&&this._context+":",i=this._context&&this._context+" ";throw new K(r+"unsupported-version",`Required major ${i}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:e})}}clone(){return new pJ(this.major,this.minor,this._context)}static parse(e,r=""){const[i,n]=e.split("."),s=/^\s*\d+\s*$/;if(!(i!=null&&i.match)||!s.test(i))throw new K((r&&r+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:e});if(!(n!=null&&n.match)||!s.test(n))throw new K((r&&r+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:e});const o=parseInt(i,10),a=parseInt(n,10);return new pJ(o,a,r)}};function PF(t,e){const r=t.count;e||(e=new t.TypedArrayConstructor(r));for(let i=0;i<r;i++)e[i]=t.get(i);return e}Object.freeze(Object.defineProperty({__proto__:null,makeDense:PF},Symbol.toStringTag,{value:"Module"}));let xme=class{constructor(e){this._data=e,this._offset4=0,this._dataUint32=new Uint32Array(this._data,0,Math.floor(this._data.byteLength/4))}readUint32(){const e=this._offset4;return this._offset4+=1,this._dataUint32[e]}readUint8Array(e){const r=4*this._offset4;return this._offset4+=e/4,new Uint8Array(this._data,r,e)}remainingBytes(){return this._data.byteLength-4*this._offset4}};var PR,Tme;(function(t){t.SCALAR="SCALAR",t.VEC2="VEC2",t.VEC3="VEC3",t.VEC4="VEC4",t.MAT2="MAT2",t.MAT3="MAT3",t.MAT4="MAT4"})(PR||(PR={})),function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"}(Tme||(Tme={}));const bDe={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},Fbt={pbrMetallicRoughness:bDe,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},kbt={ESRI_externalColorMixMode:"tint",ESRI_receiveShadows:!0,ESRI_receiveAmbientOcclusion:!0},Sme=(t={})=>{const e={...bDe,...t.pbrMetallicRoughness},r=zbt({...kbt,...t.extras});return{...Fbt,...t,pbrMetallicRoughness:e,extras:r}};function zbt(t){switch(t.ESRI_externalColorMixMode){case"multiply":case"tint":case"ignore":case"replace":break;default:t.ESRI_externalColorMixMode,t.ESRI_externalColorMixMode="tint"}return t}const Ubt={magFilter:Ht.LINEAR,minFilter:Ht.LINEAR_MIPMAP_LINEAR,wrapS:Jt.REPEAT,wrapT:Jt.REPEAT},Bbt=t=>({...Ubt,...t});function Vbt(t){let e,r;return t.replace(/^(.*\/)?([^/]*)$/,(i,n,s)=>(e=n||"",r=s||"","")),{dirPart:e,filePart:r}}const qN={MAGIC:1179937895,CHUNK_TYPE_JSON:1313821514,CHUNK_TYPE_BIN:5130562,MIN_HEADER_LENGTH:20};let Gbt=class z_{constructor(e,r,i,n){if(this._context=e,this.uri=r,this.json=i,this._glbBuffer=n,this._bufferLoaders=new Map,this._textureLoaders=new Map,this._textureCache=new Map,this._materialCache=new Map,this._nodeParentMap=new Map,this._nodeTransformCache=new Map,this._supportedExtensions=["KHR_texture_basisu","KHR_texture_transform"],this._baseUri=Vbt(this.uri).dirPart,this._checkVersionSupported(),this._checkRequiredExtensionsSupported(),i.scenes==null)throw new K("gltf-loader-unsupported-feature","Scenes must be defined.");if(i.meshes==null)throw new K("gltf-loader-unsupported-feature","Meshes must be defined");if(i.nodes==null)throw new K("gltf-loader-unsupported-feature","Nodes must be defined.");this._computeNodeParents()}static async load(e,r,i){if(mg(r)){const o=rv(r);if(o&&o.mediaType!=="model/gltf-binary")try{const l=JSON.parse(o.isBase64?atob(o.data):o.data);return new z_(e,r,l)}catch{}const a=VK(r);if(z_._isGLBData(a))return this._fromGLBData(e,r,a)}if(Xbt.test(r)||(i==null?void 0:i.expectedType)==="gltf"){const o=await e.loadJSON(r,i);return new z_(e,r,o)}const n=await e.loadBinary(r,i);if(z_._isGLBData(n))return this._fromGLBData(e,r,n);if(Zbt.test(r)||(i==null?void 0:i.expectedType)==="glb")throw new K("gltf-loader-invalid-glb","This is not a valid glb file.");const s=await e.loadJSON(r,i);return new z_(e,r,s)}static _isGLBData(e){if(e==null)return!1;const r=new xme(e);return r.remainingBytes()>=4&&r.readUint32()===qN.MAGIC}static async _fromGLBData(e,r,i){const n=await z_._parseGLBData(i);return new z_(e,r,n.json,n.binaryData)}static async _parseGLBData(e){const r=new xme(e);if(r.remainingBytes()<12)throw new K("gltf-loader-error","glb binary data is insufficiently large.");const i=r.readUint32(),n=r.readUint32(),s=r.readUint32();if(i!==qN.MAGIC)throw new K("gltf-loader-error","Magic first 4 bytes do not fit to expected glb value.");if(e.byteLength<s)throw new K("gltf-loader-error","glb binary data is smaller than header specifies.");if(n!==2)throw new K("gltf-loader-unsupported-feature","An unsupported glb container version was detected. Only version 2 is supported.");let o,a,l=0;for(;r.remainingBytes()>=8;){const c=r.readUint32(),u=r.readUint32();if(l===0){if(u!==qN.CHUNK_TYPE_JSON)throw new K("gltf-loader-error","First glb chunk must be JSON.");if(c<0)throw new K("gltf-loader-error","No JSON data found.");o=await Xvt(r.readUint8Array(c))}else if(l===1){if(u!==qN.CHUNK_TYPE_BIN)throw new K("gltf-loader-unsupported-feature","Second glb chunk expected to be BIN.");a=r.readUint8Array(c)}else re.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] More than 2 glb chunks detected. Skipping.");l+=1}if(!o)throw new K("gltf-loader-error","No glb JSON chunk detected.");return{json:o,binaryData:a}}async getBuffer(e,r){const i=this.json.buffers[e];if(i.uri==null){if(this._glbBuffer==null)throw new K("gltf-loader-error","glb buffer not present");return this._glbBuffer}const n=await this._getBufferLoader(e,r);if(n.byteLength!==i.byteLength)throw new K("gltf-loader-error","Buffer byte lengths should match.");return n}async _getBufferLoader(e,r){const i=this._bufferLoaders.get(e);if(i)return i;const n=this.json.buffers[e].uri,s=this._context.loadBinary(this._resolveUri(n),r).then(o=>new Uint8Array(o));return this._bufferLoaders.set(e,s),s}async getAccessor(e,r){if(!this.json.accessors)throw new K("gltf-loader-unsupported-feature","Accessors missing.");const i=this.json.accessors[e];if((i==null?void 0:i.bufferView)==null)throw new K("gltf-loader-unsupported-feature","Some accessor does not specify a bufferView.");if(i.type in[PR.MAT2,PR.MAT3,PR.MAT4])throw new K("gltf-loader-unsupported-feature",`AttributeType ${i.type} is not supported`);const n=this.json.bufferViews[i.bufferView],s=await this.getBuffer(n.buffer,r),o=Wbt[i.type],a=qbt[i.componentType],l=o*a,c=n.byteStride||l;return{raw:s.buffer,byteStride:c,byteOffset:s.byteOffset+(n.byteOffset||0)+(i.byteOffset||0),entryCount:i.count,isDenselyPacked:c===l,componentCount:o,componentByteSize:a,componentType:i.componentType,min:i.min,max:i.max,normalized:!!i.normalized}}async getIndexData(e,r){if(e.indices==null)return;const i=await this.getAccessor(e.indices,r);if(i.isDenselyPacked)switch(i.componentType){case qe.UNSIGNED_BYTE:return new Uint8Array(i.raw,i.byteOffset,i.entryCount);case qe.UNSIGNED_SHORT:return new Uint16Array(i.raw,i.byteOffset,i.entryCount);case qe.UNSIGNED_INT:return new Uint32Array(i.raw,i.byteOffset,i.entryCount)}else switch(i.componentType){case qe.UNSIGNED_BYTE:return PF(this._wrapAccessor(a3,i));case qe.UNSIGNED_SHORT:return PF(this._wrapAccessor(hU,i));case qe.UNSIGNED_INT:return PF(this._wrapAccessor(pU,i))}}async getPositionData(e,r){if(e.attributes.POSITION==null)throw new K("gltf-loader-unsupported-feature","No POSITION vertex data found.");const i=await this.getAccessor(e.attributes.POSITION,r);if(i.componentType!==qe.FLOAT)throw new K("gltf-loader-unsupported-feature","Expected type FLOAT for POSITION vertex attribute, but found "+qe[i.componentType]);if(i.componentCount!==3)throw new K("gltf-loader-unsupported-feature","POSITION vertex attribute must have 3 components, but found "+i.componentCount.toFixed());return this._wrapAccessor(Qs,i)}async getNormalData(e,r){if(e.attributes.NORMAL==null)throw new K("gltf-loader-error","No NORMAL vertex data found.");const i=await this.getAccessor(e.attributes.NORMAL,r);if(i.componentType!==qe.FLOAT)throw new K("gltf-loader-unsupported-feature","Expected type FLOAT for NORMAL vertex attribute, but found "+qe[i.componentType]);if(i.componentCount!==3)throw new K("gltf-loader-unsupported-feature","NORMAL vertex attribute must have 3 components, but found "+i.componentCount.toFixed());return this._wrapAccessor(Qs,i)}async getTangentData(e,r){if(e.attributes.TANGENT==null)throw new K("gltf-loader-error","No TANGENT vertex data found.");const i=await this.getAccessor(e.attributes.TANGENT,r);if(i.componentType!==qe.FLOAT)throw new K("gltf-loader-unsupported-feature","Expected type FLOAT for TANGENT vertex attribute, but found "+qe[i.componentType]);if(i.componentCount!==4)throw new K("gltf-loader-unsupported-feature","TANGENT vertex attribute must have 4 components, but found "+i.componentCount.toFixed());return new uf(i.raw,i.byteOffset,i.byteStride,i.byteOffset+i.byteStride*i.entryCount)}async getTextureCoordinates(e,r){if(e.attributes.TEXCOORD_0==null)throw new K("gltf-loader-error","No TEXCOORD_0 vertex data found.");const i=await this.getAccessor(e.attributes.TEXCOORD_0,r);if(i.componentCount!==2)throw new K("gltf-loader-unsupported-feature","TEXCOORD_0 vertex attribute must have 2 components, but found "+i.componentCount.toFixed());if(i.componentType===qe.FLOAT)return this._wrapAccessor(U2,i);if(!i.normalized)throw new K("gltf-loader-unsupported-feature","Integer component types are only supported for a normalized accessor for TEXCOORD_0.");return Ybt(i)}async getVertexColors(e,r){if(e.attributes.COLOR_0==null)throw new K("gltf-loader-error","No COLOR_0 vertex data found.");const i=await this.getAccessor(e.attributes.COLOR_0,r);if(i.componentCount!==4&&i.componentCount!==3)throw new K("gltf-loader-unsupported-feature","COLOR_0 attribute must have 3 or 4 components, but found "+i.componentCount.toFixed());if(i.componentCount===4){if(i.componentType===qe.FLOAT)return this._wrapAccessor(uf,i);if(i.componentType===qe.UNSIGNED_BYTE)return this._wrapAccessor(za,i);if(i.componentType===qe.UNSIGNED_SHORT)return this._wrapAccessor(WI,i)}else if(i.componentCount===3){if(i.componentType===qe.FLOAT)return this._wrapAccessor(Qs,i);if(i.componentType===qe.UNSIGNED_BYTE)return this._wrapAccessor(uU,i);if(i.componentType===qe.UNSIGNED_SHORT)return this._wrapAccessor(dU,i)}throw new K("gltf-loader-unsupported-feature","Unsupported component type for COLOR_0 attribute: "+qe[i.componentType])}hasPositions(e){return e.attributes.POSITION!==void 0}hasNormals(e){return e.attributes.NORMAL!==void 0}hasVertexColors(e){return e.attributes.COLOR_0!==void 0}hasTextureCoordinates(e){return e.attributes.TEXCOORD_0!==void 0}hasTangents(e){return e.attributes.TANGENT!==void 0}async getMaterial(e,r,i){var s,o,a,l,c,u,h,p,f,g;let n=e.material?this._materialCache.get(e.material):void 0;if(!n){const _=e.material!=null?Sme(this.json.materials[e.material]):Sme(),v=_.pbrMetallicRoughness,b=this.hasVertexColors(e),w=this.getTexture(v.baseColorTexture,r),x=this.getTexture(_.normalTexture,r),S=i?this.getTexture(_.occlusionTexture,r):void 0,E=i?this.getTexture(_.emissiveTexture,r):void 0,A=i?this.getTexture(v.metallicRoughnessTexture,r):void 0,O=e.material!=null?e.material:-1;n={alphaMode:_.alphaMode,alphaCutoff:_.alphaCutoff,color:v.baseColorFactor,doubleSided:!!_.doubleSided,colorTexture:await w,normalTexture:await x,name:_.name,id:O,occlusionTexture:await S,emissiveTexture:await E,emissiveFactor:_.emissiveFactor,metallicFactor:v.metallicFactor,roughnessFactor:v.roughnessFactor,metallicRoughnessTexture:await A,hasVertexColors:b,ESRI_externalColorMixMode:_.extras.ESRI_externalColorMixMode,colorTextureTransform:(o=(s=v==null?void 0:v.baseColorTexture)==null?void 0:s.extensions)==null?void 0:o.KHR_texture_transform,normalTextureTransform:(l=(a=_.normalTexture)==null?void 0:a.extensions)==null?void 0:l.KHR_texture_transform,occlusionTextureTransform:(u=(c=_.occlusionTexture)==null?void 0:c.extensions)==null?void 0:u.KHR_texture_transform,emissiveTextureTransform:(p=(h=_.emissiveTexture)==null?void 0:h.extensions)==null?void 0:p.KHR_texture_transform,metallicRoughnessTextureTransform:(g=(f=v==null?void 0:v.metallicRoughnessTexture)==null?void 0:f.extensions)==null?void 0:g.KHR_texture_transform,receiveAmbientOcclusion:_.extras.ESRI_receiveAmbientOcclusion,receiveShadows:_.extras.ESRI_receiveShadows}}return n}async getTexture(e,r){if(!e)return;if((e.texCoord||0)!==0)throw new K("gltf-loader-unsupported-feature","Only TEXCOORD with index 0 is supported.");const i=e.index,n=this.json.textures[i],s=Bbt(n.sampler!=null?this.json.samplers[n.sampler]:{}),o=this._getTextureSourceId(n),a=this.json.images[o],l=await this._loadTextureImageData(i,n,r);return $K(this._textureCache,i,()=>{const c=h=>h===33071||h===33648||h===10497,u=h=>{throw new K("gltf-loader-error",`Unexpected TextureSampler WrapMode: ${h}`)};return{data:l,wrapS:c(s.wrapS)?s.wrapS:u(s.wrapS),wrapT:c(s.wrapT)?s.wrapT:u(s.wrapT),minFilter:s.minFilter,name:a.name,id:i}})}getNodeTransform(e){if(e===void 0)return jbt;let r=this._nodeTransformCache.get(e);if(!r){const i=this.getNodeTransform(this._getNodeParent(e)),n=this.json.nodes[e];n.matrix?r=Hr(xe(),i,n.matrix):n.translation||n.rotation||n.scale?(r=WE(i),n.translation&&ic(r,r,n.translation),n.rotation&&(YN[3]=U9(YN,n.rotation),Gc(r,r,YN[3],YN)),n.scale&&P2(r,r,n.scale)):r=WE(i),this._nodeTransformCache.set(e,r)}return r}_wrapAccessor(e,r){return new e(r.raw,r.byteOffset,r.byteStride,r.byteOffset+r.byteStride*(r.entryCount-1)+r.componentByteSize*r.componentCount)}_resolveUri(e){return Du(e,this._baseUri)}_getNodeParent(e){return this._nodeParentMap.get(e)}_checkVersionSupported(){const e=KU.parse(this.json.asset.version,"glTF");Hbt.validate(e)}_checkRequiredExtensionsSupported(){const e=this.json;if(e.extensionsRequired&&!e.extensionsRequired.every(r=>this._supportedExtensions.includes(r)))throw new K("gltf-loader-unsupported-feature","gltf loader was not able to load unsupported feature. Required extensions: "+e.extensionsRequired.join(", "))}_computeNodeParents(){this.json.nodes.forEach((e,r)=>{e.children&&e.children.forEach(i=>{this._nodeParentMap.set(i,r)})})}async _loadTextureImageData(e,r,i){const n=this._textureLoaders.get(e);if(n)return n;const s=this._createTextureLoader(r,i);return this._textureLoaders.set(e,s),s}_getTextureSourceId(e){if(e.extensions!==void 0&&e.extensions.KHR_texture_basisu!==null)return e.extensions.KHR_texture_basisu.source;if(e.source!==null)return e.source;throw new K("gltf-loader-unsupported-feature","Source is expected to be defined for a texture. It can also be omitted in favour of an KHR_texture_basisu extension tag.")}async _createTextureLoader(e,r){const i=this._getTextureSourceId(e),n=this.json.images[i];if(n.uri){if(n.uri.endsWith(".ktx2")){const l=await this._context.loadBinary(this._resolveUri(n.uri),r);return new hDe(new Uint8Array(l))}return this._context.loadImage(this._resolveUri(n.uri),r)}if(n.bufferView==null)throw new K("gltf-loader-unsupported-feature","Image bufferView must be defined.");if(n.mimeType==null)throw new K("gltf-loader-unsupported-feature","Image mimeType must be defined.");const s=this.json.bufferViews[n.bufferView],o=await this.getBuffer(s.buffer,r);if(s.byteStride!=null)throw new K("gltf-loader-unsupported-feature","byteStride not supported for image buffer");const a=o.byteOffset+(s.byteOffset||0);return Zvt(new Uint8Array(o.buffer,a,s.byteLength),n.mimeType)}async getLoadedBuffersSize(){if(this._glbBuffer)return this._glbBuffer.byteLength;const e=await $k(Array.from(this._bufferLoaders.values())),r=await $k(Array.from(this._textureLoaders.values()));return e.reduce((i,n)=>i+((n==null?void 0:n.byteLength)??0),0)+r.reduce((i,n)=>i+(n?ER(n)?n.data.byteLength:n.width*n.height*4:0),0)}};const jbt=Mxe(xe(),Math.PI/2),Hbt=new KU(2,0,"glTF"),YN=lc(),Wbt={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},qbt={[qe.BYTE]:1,[qe.UNSIGNED_BYTE]:1,[qe.SHORT]:2,[qe.UNSIGNED_SHORT]:2,[qe.FLOAT]:4,[qe.INT]:4,[qe.UNSIGNED_INT]:4};function Ybt(t){switch(t.componentType){case qe.BYTE:return new fU(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case qe.UNSIGNED_BYTE:return new cU(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case qe.SHORT:return new qI(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case qe.UNSIGNED_SHORT:return new _re(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case qe.UNSIGNED_INT:return new vre(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case qe.FLOAT:return new U2(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount)}}const Xbt=/\.gltf$/i,Zbt=/\.glb$/i;let Jbt=0;async function wDe(t,e,r={},i=!0){var h,p;const n=await Gbt.load(t,e,r),s="gltf_"+Jbt++,o={lods:[],materials:new Map,textures:new Map,meta:Qbt(n)},a=!(!n.json.asset.extras||n.json.asset.extras.ESRI_type!=="symbolResource"),l=(p=(h=n.json.asset.extras)==null?void 0:h.ESRI_webstyleSymbol)==null?void 0:p.webstyle,c=new Map;await Kbt(n,async(f,g,_,v)=>{var J;const b=c.get(_)??0;c.set(_,b+1);const w=f.mode!==void 0?f.mode:sr.TRIANGLES,x=w===sr.TRIANGLES||w===sr.TRIANGLE_STRIP||w===sr.TRIANGLE_FAN?w:null;if(x==null)return void re.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Unsupported primitive mode ("+sr[w]+"). Skipping primitive.");if(!n.hasPositions(f))return void re.getLogger("esri.views.3d.glTF").warn("Skipping primitive without POSITION vertex attribute.");const S=n.getPositionData(f,r),E=n.getMaterial(f,r,i),A=n.hasNormals(f)?n.getNormalData(f,r):null,O=n.hasTangents(f)?n.getTangentData(f,r):null,L=n.hasTextureCoordinates(f)?n.getTextureCoordinates(f,r):null,z=n.hasVertexColors(f)?n.getVertexColors(f,r):null,k=n.getIndexData(f,r),q={name:v,transform:WE(g),attributes:{position:await S,normal:A?await A:null,texCoord0:L?await L:null,color:z?await z:null,tangent:O?await O:null},indices:await k,primitiveType:x,material:twt(o,await E,s)};let B=null;((J=o.meta)==null?void 0:J.ESRI_lod)!=null&&o.meta.ESRI_lod.metric==="screenSpaceRadius"&&(B=o.meta.ESRI_lod.thresholds[_]),o.lods[_]=o.lods[_]||{parts:[],name:v,lodThreshold:B},o.lods[_].parts[b]=q});for(const f of o.lods)f.parts=f.parts.filter(g=>!!g);const u=await n.getLoadedBuffersSize();return{model:o,meta:{isEsriSymbolResource:a,uri:n.uri,ESRI_webstyle:l},customMeta:{},size:u}}function Qbt(t){const e=t.json;let r=null;return e.nodes.forEach(i=>{const n=i.extras;n!=null&&(n.ESRI_proxyEllipsoid||n.ESRI_lod)&&(r=n)}),r}async function Kbt(t,e){const r=t.json,i=r.scenes[r.scene||0].nodes,n=i.length>1,s=[];for(const a of i){const l=r.nodes[a];s.push(o(a,0)),ewt(l)&&!n&&l.extensions.MSFT_lod.ids.forEach((c,u)=>o(c,u+1))}async function o(a,l){const c=r.nodes[a],u=t.getNodeTransform(a);if(c.weights!=null&&re.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Morph targets are not supported."),c.mesh!=null){const h=r.meshes[c.mesh];for(const p of h.primitives)s.push(e(p,u,l,h.name))}for(const h of c.children||[])s.push(o(h,l))}await Promise.all(s)}function ewt(t){var e;return((e=t.extensions)==null?void 0:e.MSFT_lod)&&Array.isArray(t.extensions.MSFT_lod.ids)}function twt(t,e,r){const i=s=>{const o=`${r}_tex_${s&&s.id}${s!=null&&s.name?"_"+s.name:""}`;if(s&&!t.textures.has(o)){const a=Nbt(s.data,{wrap:{s:s.wrapS,t:s.wrapT},mipmap:rwt.has(s.minFilter),noUnpackFlip:!0});t.textures.set(o,a)}return o},n=`${r}_mat_${e.id}_${e.name}`;if(!t.materials.has(n)){const s=Dbt({color:[e.color[0],e.color[1],e.color[2]],opacity:e.color[3],alphaMode:e.alphaMode,alphaCutoff:e.alphaCutoff,doubleSided:e.doubleSided,colorMixMode:e.ESRI_externalColorMixMode,textureColor:e.colorTexture?i(e.colorTexture):void 0,textureNormal:e.normalTexture?i(e.normalTexture):void 0,textureOcclusion:e.occlusionTexture?i(e.occlusionTexture):void 0,textureEmissive:e.emissiveTexture?i(e.emissiveTexture):void 0,textureMetallicRoughness:e.metallicRoughnessTexture?i(e.metallicRoughnessTexture):void 0,emissiveFactor:[e.emissiveFactor[0],e.emissiveFactor[1],e.emissiveFactor[2]],colorTextureTransform:e.colorTextureTransform,normalTextureTransform:e.normalTextureTransform,occlusionTextureTransform:e.occlusionTextureTransform,emissiveTextureTransform:e.emissiveTextureTransform,metallicRoughnessTextureTransform:e.metallicRoughnessTextureTransform,metallicFactor:e.metallicFactor,roughnessFactor:e.roughnessFactor,receiveShadows:e.receiveShadows,receiveAmbientOcclustion:e.receiveAmbientOcclusion});t.materials.set(n,s)}return n}const rwt=new Set([Ht.LINEAR_MIPMAP_LINEAR,Ht.LINEAR_MIPMAP_NEAREST]);function iwt(t,e){switch(e){case sr.TRIANGLES:return nwt(t);case sr.TRIANGLE_STRIP:return swt(t);case sr.TRIANGLE_FAN:return owt(t)}}function nwt(t){return typeof t=="number"?B2(t):g1(t)?new Uint16Array(t):t}function swt(t){const e=typeof t=="number"?t:t.length;if(e<3)return[];const r=e-2,i=X6(3*r);if(typeof t=="number"){let n=0;for(let s=0;s<r;s+=1)s%2==0?(i[n++]=s,i[n++]=s+1,i[n++]=s+2):(i[n++]=s+1,i[n++]=s,i[n++]=s+2)}else{let n=0;for(let s=0;s<r;s+=1)s%2==0?(i[n++]=t[s],i[n++]=t[s+1],i[n++]=t[s+2]):(i[n++]=t[s+1],i[n++]=t[s],i[n++]=t[s+2])}return i}function owt(t){const e=typeof t=="number"?t:t.length;if(e<3)return new Uint16Array(0);const r=e-2,i=r<=65536?new Uint16Array(3*r):new Uint32Array(3*r);if(typeof t=="number"){let a=0;for(let l=0;l<r;++l)i[a++]=0,i[a++]=l+1,i[a++]=l+2;return i}const n=t[0];let s=t[1],o=0;for(let a=0;a<r;++a){const l=t[a+2];i[o++]=n,i[o++]=s,i[o++]=l,s=l}return i}let awt=class{constructor(){this.geometries=new Array,this.materials=new Array,this.textures=new Array}},lwt=class{constructor(e,r,i){this.name=e,this.lodThreshold=r,this.pivotOffset=i,this.stageResources=new awt,this.numberOfVertices=0}};const i0=()=>re.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");async function xDe(t,e){const r=await cwt(t,e),i=await fwt(r.textureDefinitions??{},e);let n=0;for(const s in i)if(i.hasOwnProperty(s)){const o=i[s];n+=o!=null&&o.image?o.image.width*o.image.height*4:0}return{resource:r,textures:i,size:n+sbe(r)}}async function cwt(t,e){const r=e==null?void 0:e.streamDataRequester;if(r)return uwt(t,r,e);const i=await sg(Xi(t,e));if(i.ok===!0)return i.value.data;J0(i.error),TDe(i.error)}async function uwt(t,e,r){const i=await sg(e.request(t,"json",r));if(i.ok===!0)return i.value;J0(i.error),TDe(i.error.details.url)}function TDe(t){throw new K("",`Request for object resource failed: ${t}`)}function hwt(t){const e=t.params,r=e.topology;let i=!0;switch(e.vertexAttributes||(i0().warn("Geometry must specify vertex attributes"),i=!1),e.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:{const s=e.faces;if(s){if(e.vertexAttributes)for(const o in e.vertexAttributes){const a=s[o];a!=null&&a.values?(a.valueType!=null&&a.valueType!=="UInt32"&&(i0().warn(`Unsupported indexed geometry indices type '${a.valueType}', only UInt32 is currently supported`),i=!1),a.valuesPerElement!=null&&a.valuesPerElement!==1&&(i0().warn(`Unsupported indexed geometry values per element '${a.valuesPerElement}', only 1 is currently supported`),i=!1)):(i0().warn(`Indexed geometry does not specify face indices for '${o}' attribute`),i=!1)}}else i0().warn("Indexed geometries must specify faces"),i=!1;break}default:i0().warn(`Unsupported topology '${r}'`),i=!1}t.params.material||(i0().warn("Geometry requires material"),i=!1);const n=t.params.vertexAttributes;for(const s in n)n[s].values||(i0().warn("Geometries with externally defined attributes are not yet supported"),i=!1);return i}function dwt(t,e){var g,_;const r=new Array,i=new Array,n=new Array,s=new xv,o=t.resource,a=KU.parse(o.version||"1.0","wosr");gwt.validate(a);const l=o.model.name,c=o.model.geometries,u=o.materialDefinitions??{},h=t.textures;let p=0;const f=new Map;for(let v=0;v<c.length;v++){const b=c[v];if(!hwt(b))continue;const w=mwt(b),x=b.params.vertexAttributes,S=[],E=Y=>{if(b.params.topology==="PerAttributeArray")return null;const le=b.params.faces;for(const D in le)if(D===Y)return le[D].values;return null},A=x[R.POSITION],O=A.values.length/A.valuesPerElement;for(const Y in x){const le=x[Y],D=le.values,I=E(Y)??B2(O);S.push([Y,new Ye(D,I,le.valuesPerElement,!0)])}const L=w.texture,z=h&&h[L];if(z&&!f.has(L)){const{image:Y,parameters:le}=z,D=new Pv(Y,le);i.push(D),f.set(L,D)}const k=f.get(L),q=k?k.id:void 0,B=w.material;let J=s.get(B,L);if(J==null){const Y=u[B.substring(B.lastIndexOf("/")+1)].params;Y.transparency===1&&(Y.transparency=0);const le=z&&z.alphaChannelUsage,D=Y.transparency>0||le==="transparency"||le==="maskAndTransparency",I=z?SDe(z.alphaChannelUsage):void 0,F={ambient:Ea(Y.diffuse),diffuse:Ea(Y.diffuse),opacity:1-(Y.transparency||0),transparent:D,textureAlphaMode:I,textureAlphaCutoff:.33,textureId:q,initTextureTransparent:!0,doubleSided:!0,cullFace:Pi.None,colorMixMode:Y.externalColorMixMode||"tint",textureAlphaPremultiplied:(z==null?void 0:z.parameters.preMultiplyAlpha)??!1};e!=null&&e.materialParameters&&Object.assign(F,e.materialParameters),J=new hf(F),s.set(B,L,J)}n.push(J);const W=new gs(J,S);p+=((_=(g=S.find(Y=>Y[0]===R.POSITION))==null?void 0:g[1])==null?void 0:_.indices.length)??0,r.push(W)}return{engineResources:[{name:l,stageResources:{textures:i,materials:n,geometries:r},pivotOffset:o.model.pivotOffset,numberOfVertices:p,lodThreshold:null}],referenceBoundingBox:pwt(r)}}function pwt(t){const e=Li();return t.forEach(r=>{const i=r.boundingInfo;i!=null&&(lf(e,i.bbMin),lf(e,i.bbMax))}),e}async function fwt(t,e){const r=new Array;for(const s in t){const o=t[s],a=o.images[0].data;if(!a){i0().warn("Externally referenced texture data is not yet supported");continue}const l=o.encoding+";base64,"+a,c="/textureDefinitions/"+s,u=o.channels==="rgba"?o.alphaChannelUsage||"transparency":"none",h={noUnpackFlip:!0,wrap:{s:Jt.REPEAT,t:Jt.REPEAT},preMultiplyAlpha:SDe(u)!==fi.Opaque},p=e!=null&&e.disableTextures?Promise.resolve(null):cy(l,e);r.push(p.then(f=>({refId:c,image:f,parameters:h,alphaChannelUsage:u})))}const i=await Promise.all(r),n={};for(const s of i)n[s.refId]=s;return n}function SDe(t){switch(t){case"mask":return fi.Mask;case"maskAndTransparency":return fi.MaskBlend;case"none":return fi.Opaque;default:return fi.Blend}}function mwt(t){const e=t.params;return{id:1,material:e.material,texture:e.texture,region:e.texture}}const gwt=new KU(1,2,"wosr"),$T=2.1;async function CDe(t,e){var h;const r=EDe(dJ(t));if(r.fileType==="wosr"){const p=await(e.cache?e.cache.loadWOSR(r.url,e):xDe(r.url,e)),{engineResources:f,referenceBoundingBox:g}=dwt(p,e);return{lods:f,referenceBoundingBox:g,isEsriSymbolResource:!1,isWosr:!0}}const i=await(e.cache?e.cache.loadGLTF(r.url,e,!!e.usePBR):wDe(new vDe(e.streamDataRequester),r.url,e,e.usePBR)),n=(h=i.model.meta)==null?void 0:h.ESRI_proxyEllipsoid,s=i.meta.isEsriSymbolResource&&n!=null&&i.meta.ESRI_webstyle==="EsriRealisticTreesStyle";s&&!i.customMeta.esriTreeRendering&&(i.customMeta.esriTreeRendering=!0,bwt(i,n));const o=!!e.usePBR,a=i.meta.isEsriSymbolResource?{usePBR:o,isSchematic:!1,treeRendering:s,mrrFactors:[...gdt]}:{usePBR:o,isSchematic:!1,treeRendering:!1,mrrFactors:[...IU]},l={...e.materialParameters,treeRendering:s},{engineResources:c,referenceBoundingBox:u}=PDe(i,a,l,e.skipHighLods&&r.specifiedLodIndex==null?{skipHighLods:!0}:{skipHighLods:!1,singleLodIndex:r.specifiedLodIndex});return{lods:c,referenceBoundingBox:u,isEsriSymbolResource:i.meta.isEsriSymbolResource,isWosr:!1}}function EDe(t){const e=t.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return e?{fileType:"gltf",url:e[1],specifiedLodIndex:e[4]!=null?Number(e[4]):null}:t.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:t,specifiedLodIndex:null}:{fileType:"unknown",url:t,specifiedLodIndex:null}}function PDe(t,e,r,i){const n=t.model,s=new Array,o=new Map,a=new Map,l=n.lods.length,c=Li();return n.lods.forEach((u,h)=>{const p=i.skipHighLods===!0&&(l>1&&h===0||l>3&&h===1)||i.skipHighLods===!1&&i.singleLodIndex!=null&&h!==i.singleLodIndex;if(p&&h!==0)return;const f=new lwt(u.name,u.lodThreshold,[0,0,0]);u.parts.forEach(g=>{const _=p?new hf({}):ywt(n,g,f,e,r,o,a),{geometry:v,vertexCount:b}=_wt(g,_??new hf({})),w=v.boundingInfo;w!=null&&h===0&&(lf(c,w.bbMin),lf(c,w.bbMax)),_!=null&&(f.stageResources.geometries.push(v),f.numberOfVertices+=b)}),p||s.push(f)}),{engineResources:s,referenceBoundingBox:c}}function ywt(t,e,r,i,n,s,o){var f,g;const a=e.material+(e.attributes.normal?"_normal":"")+(e.attributes.color?"_color":"")+(e.attributes.texCoord0?"_texCoord0":"")+(e.attributes.tangent?"_tangent":""),l=t.materials.get(e.material),c=e.attributes.texCoord0!=null,u=e.attributes.normal!=null;if(l==null)return null;const h=vwt(l.alphaMode);if(!s.has(a)){if(c){const L=(z,k=!1)=>{if(z!=null&&!o.has(z)){const q=t.textures.get(z);if(q!=null){const B=q.data;o.set(z,new Pv(ER(B)?B.data:B,{...q.parameters,preMultiplyAlpha:!ER(B)&&k,encoding:ER(B)&&B.encoding!=null?B.encoding:void 0}))}}};L(l.textureColor,h!==fi.Opaque),L(l.textureNormal),L(l.textureOcclusion),L(l.textureEmissive),L(l.textureMetallicRoughness)}const _=l.color[0]**(1/$T),v=l.color[1]**(1/$T),b=l.color[2]**(1/$T),w=l.emissiveFactor[0]**(1/$T),x=l.emissiveFactor[1]**(1/$T),S=l.emissiveFactor[2]**(1/$T),E=l.textureColor!=null&&c?o.get(l.textureColor):null,A=PRe({normalTexture:l.textureNormal,metallicRoughnessTexture:l.textureMetallicRoughness,metallicFactor:l.metallicFactor,roughnessFactor:l.roughnessFactor,emissiveTexture:l.textureEmissive,emissiveFactor:l.emissiveFactor,occlusionTexture:l.textureOcclusion}),O=((f=l.normalTextureTransform)==null?void 0:f.scale)!=null?(g=l.normalTextureTransform)==null?void 0:g.scale:E9;s.set(a,new hf({...i,transparent:h===fi.Blend,customDepthTest:d2.Lequal,textureAlphaMode:h,textureAlphaCutoff:l.alphaCutoff,diffuse:[_,v,b],ambient:[_,v,b],opacity:l.opacity,doubleSided:l.doubleSided,doubleSidedType:"winding-order",cullFace:l.doubleSided?Pi.None:Pi.Back,hasVertexColors:!!e.attributes.color,hasVertexTangents:!!e.attributes.tangent,normalType:u?$r.Attribute:$r.ScreenDerivative,castShadows:!0,receiveShadows:l.receiveShadows,receiveAmbientOcclusion:l.receiveAmbientOcclustion,textureId:E!=null?E.id:void 0,colorMixMode:l.colorMixMode,normalTextureId:l.textureNormal!=null&&c?o.get(l.textureNormal).id:void 0,textureAlphaPremultiplied:E!=null&&!!E.parameters.preMultiplyAlpha,occlusionTextureId:l.textureOcclusion!=null&&c?o.get(l.textureOcclusion).id:void 0,emissiveTextureId:l.textureEmissive!=null&&c?o.get(l.textureEmissive).id:void 0,metallicRoughnessTextureId:l.textureMetallicRoughness!=null&&c?o.get(l.textureMetallicRoughness).id:void 0,emissiveFactor:[w,x,S],mrrFactors:A?[...cie]:[l.metallicFactor,l.roughnessFactor,i.mrrFactors[2]],isSchematic:A,colorTextureTransformMatrix:Om(l.colorTextureTransform),normalTextureTransformMatrix:Om(l.normalTextureTransform),scale:[O[0],O[1]],occlusionTextureTransformMatrix:Om(l.occlusionTextureTransform),emissiveTextureTransformMatrix:Om(l.emissiveTextureTransform),metallicRoughnessTextureTransformMatrix:Om(l.metallicRoughnessTextureTransform),...n}))}const p=s.get(a);if(r.stageResources.materials.push(p),c){const _=v=>{v!=null&&r.stageResources.textures.push(o.get(v))};_(l.textureColor),_(l.textureNormal),_(l.textureOcclusion),_(l.textureEmissive),_(l.textureMetallicRoughness)}return p}function _wt(t,e){const r=t.attributes.position.count,i=iwt(t.indices||r,t.primitiveType),n=mn(3*r),{typedBuffer:s,typedBufferStride:o}=t.attributes.position;pf(n,s,t.transform,3,o);const a=[[R.POSITION,new Ye(n,i,3,!0)]];if(t.attributes.normal!=null){const l=mn(3*r),{typedBuffer:c,typedBufferStride:u}=t.attributes.normal;iy(XN,t.transform),ff(l,c,XN,3,u),a.push([R.NORMAL,new Ye(l,i,3,!0)])}if(t.attributes.tangent!=null){const l=mn(4*r),{typedBuffer:c,typedBufferStride:u}=t.attributes.tangent;iy(XN,t.transform),ane(l,c,XN,4,u),a.push([R.TANGENT,new Ye(l,i,4,!0)])}if(t.attributes.texCoord0!=null){const l=mn(2*r),{typedBuffer:c,typedBufferStride:u}=t.attributes.texCoord0;lne(l,c,2,u),a.push([R.UV0,new Ye(l,i,2,!0)])}if(t.attributes.color!=null){const l=new Uint8Array(4*r);t.attributes.color.elementCount===4?t.attributes.color instanceof uf?N8(l,t.attributes.color,255):t.attributes.color instanceof za?cne(l,t.attributes.color):t.attributes.color instanceof WI&&N8(l,t.attributes.color,1/256):(l.fill(255),t.attributes.color instanceof Qs?y8(l,t.attributes.color,255,4):t.attributes.color instanceof uU?pL(l,t.attributes.color.typedBuffer,4,t.attributes.color.typedBufferStride):t.attributes.color instanceof dU&&y8(l,t.attributes.color,1/256,4)),a.push([R.COLOR,new Ye(l,i,4,!0)])}return{geometry:new gs(e,a),vertexCount:r}}const XN=li();function vwt(t){switch(t){case"BLEND":return fi.Blend;case"MASK":return fi.Mask;case"OPAQUE":case null:case void 0:return fi.Opaque}}function bwt(t,e){for(let r=0;r<t.model.lods.length;++r){const i=t.model.lods[r];for(const n of i.parts){const s=n.attributes.normal;if(s==null)return;const o=n.attributes.position,a=o.count,l=C(),c=C(),u=C(),h=new Uint8Array(4*a),p=new Float64Array(3*a),f=os(xe(),n.transform);let g=0,_=0;for(let v=0;v<a;v++){o.getVec(v,c),s.getVec(v,l),Ge(c,c,n.transform),ye(u,c,e.center),r6(u,u,e.radius);const b=u[2],w=Te(u),x=Math.min(.45+.55*w*w,1);r6(u,u,e.radius),f!==null&&Ge(u,u,f),pe(u,u),r+1!==t.model.lods.length&&t.model.lods.length>1&&ni(u,u,l,b>-1?.2:Math.min(-4*b-3.8,1)),p[g]=u[0],p[g+1]=u[1],p[g+2]=u[2],g+=3,h[_]=255*x,h[_+1]=255*x,h[_+2]=255*x,h[_+3]=255,_+=4}n.attributes.normal=new Qs(p),n.attributes.color=new za(h)}}}const nWt=Object.freeze(Object.defineProperty({__proto__:null,fetch:CDe,gltfToEngineResources:PDe,parseUrl:EDe},Symbol.toStringTag,{value:"Module"})),wwt=()=>!!se("enable-feature:force-wosr"),sWt=()=>!!se("enable-feature:direct-3d-object-feature-layer-display"),xwt=()=>se.add("enable-feature:direct-3d-object-feature-layer-display",!0,!0,!0),Twt=()=>se.add("enable-feature:direct-3d-object-feature-layer-display",!1,!0,!0),oWt=()=>!!se("enable-i3s-patching"),Swt=()=>se.add("enable-i3s-patching",!0,!0,!0),Cwt=()=>se.add("enable-i3s-patching",!1,!0,!0),aWt=()=>!!se("enable-feature:SceneLayer-editing"),Ewt=(t="i3s-patching")=>{switch(Cwt(),Twt(),se.add("enable-feature:SceneLayer-editing",!0,!0,!0),t){case"feature-layer-view":xwt();break;case"i3s-patching":Swt()}};Ewt("i3s-patching");let IG={};async function Pwt(t,e){try{return{data:(await une(t,e)).data,baseUrl:Vz(t),styleUrl:t}}catch(r){return J0(r),null}}function Awt(t,e,r){const i=e.portal!=null?e.portal:ud.getDefault();let n;const s=`${i.url} - ${i.user&&i.user.username} - ${t}`;return IG[s]||(IG[s]=Mwt(t,i,r).then(o=>(n=o,o.fetchData())).then(o=>({data:o,baseUrl:n.itemUrl??"",styleName:t}))),IG[s]}function Mwt(t,e,r){return e.load(r).then(()=>{const i=new Tm({disableExtraQuery:!0,query:`owner:${Cme} AND type:${Eme} AND typekeywords:"${t}"`});return e.queryItems(i,r)}).then(({results:i})=>{var o;let n=null;const s=t.toLowerCase();if(i&&Array.isArray(i)){for(const a of i)if(((o=a.typeKeywords)==null?void 0:o.some(c=>c.toLowerCase()===s))&&a.type===Eme&&a.owner===Cme){n=a;break}}if(!n)throw new K("symbolstyleutils:style-not-found",`The style '${t}' could not be found`,{styleName:t});return n.load(r)})}function ADe(t,e,r){return(t==null?void 0:t.styleUrl)!=null?Pwt(t.styleUrl,r):(t==null?void 0:t.styleName)!=null?Awt(t.styleName,e,r):Promise.reject(new K("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function MDe(t){return t===null||t.type==="CIMSymbolReference"?t:{type:"CIMSymbolReference",symbol:t}}function ODe(t,e,r=["gltf"]){if(e==="cimRef")return t.cimRef;if(t.formatInfos&&!wwt())for(const i of r){const n=t.formatInfos.find(s=>s.type===i);if(n)return n.href}return t.webRef}function une(t,e){const r={responseType:"json",query:{f:"json"},...e};return Xi(L0(t),r)}const Cme="esri_en",Eme="Style",Owt="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json",cA={retainId:!1,ignoreDrivers:!1,hasLabelingContext:!0};function Rwt(t,e=cA){var a,l;if(!t)return{symbol:null};const{retainId:r=cA.retainId,ignoreDrivers:i=cA.ignoreDrivers,hasLabelingContext:n=cA.hasLabelingContext,retainCIM:s=cA.retainCIM}=e;let o=null;if(h2(t)||t instanceof W3)o=t.clone();else if(t.type==="cim"){const c=(l=(a=t.data)==null?void 0:a.symbol)==null?void 0:l.type;if(c!=="CIMPointSymbol")return{error:new K("symbol-conversion:unsupported-cim-symbol",`CIM symbol of type '${c||"unknown"}' is unsupported in 3D`,{symbol:t})};o=s?t.clone():E1.fromCIMSymbol(t)}else if(t instanceof vy)o=Z9.fromSimpleLineSymbol(t);else if(t instanceof j3)o=E1.fromSimpleMarkerSymbol(t);else if(t instanceof J9)o=E1.fromPictureMarkerSymbol(t);else if(t instanceof VI)o=e.geometryType&&e.geometryType==="mesh"?G3.fromSimpleFillSymbol(t):BI.fromSimpleFillSymbol(t);else{if(!(t instanceof H3))return{error:new K("symbol-conversion:unsupported-2d-symbol",`2D symbol of type '${t.type||t.declaredClass}' is unsupported in 3D`,{symbol:t})};o=n?X9.fromTextSymbol(t):E1.fromTextSymbol(t)}return r&&o&&o.type!=="cim"&&(o.id=t.id),i&&h2(o)&&o.symbolLayers.forEach(c=>c.ignoreDrivers=!0),{symbol:o}}function F8(t,e,r,i){const n=RDe(t,{},{context:i,isLabelSymbol:!1});n!=null&&(e[r]=n)}function lWt(t,e,r,i){const n=RDe(t,{},{context:i,isLabelSymbol:!0});n!=null&&(e[r]=n)}function Pme(t){return t instanceof V3||t instanceof W3}function RDe(t,e,r){if(t==null)return null;const{context:i,isLabelSymbol:n}=r,s=i==null?void 0:i.origin,o=i==null?void 0:i.messages;if(s==="web-scene"&&!Pme(t)){const a=Rwt(t,{retainCIM:!0,hasLabelingContext:n});return a.symbol!=null?a.symbol.write(e,i):(o==null||o.push(new K("symbol:unsupported",`Symbols of type '${t.declaredClass}' are not supported in scenes. Use 3D symbology instead when working with WebScene and SceneView`,{symbol:t,context:i,error:a.error})),null)}return(s==="web-map"||s==="portal-item"&&!YVe(i==null?void 0:i.layer))&&Pme(t)?(o==null||o.push(new K("symbol:unsupported",`Symbols of type '${t.declaredClass}' are not supported in web maps and portal items. Use 2D symbology and CIMSymbol instead when working with MapView`,{symbol:t,context:i})),null):t.write(e,i)}function $De(t,e){return itt(t,null,e)}function $wt(t,e,r,i){const n=t.name;return n==null?Promise.reject(new K("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference")):t.styleName&&t.styleName==="Esri2DPointSymbolsStyle"?Iwt(n,e,i):ADe(t,e,i).then(s=>dne(s,n,e,r,ODe,i))}function hne(t,e){return e.items.find(r=>r.name===t)}function dne(t,e,r,i,n,s){var f,g;const o=(r==null?void 0:r.portal)!=null?r.portal:ud.getDefault(),a={portal:o,url:da(t.baseUrl),origin:"portal-item"},l=hne(e,t.data);if(!l){const _=`The symbol name '${e}' could not be found`;return Promise.reject(new K("symbolstyleutils:symbol-name-not-found",_,{symbolName:e}))}let c=t2(n(l,i),a),u=((f=l.thumbnail)==null?void 0:f.href)??null;const h=(g=l.thumbnail)==null?void 0:g.imageData;xbt()&&(c=dJ(c)??"",u=dJ(u));const p={portal:o,url:da(Vz(c)),origin:"portal-item"};return une(c,s).then(_=>{const v=i==="cimRef"?MDe(_.data):_.data,b=$De(v,p);if(b&&h2(b)){if(u){const w=t2(u,a);b.thumbnail=new Mx({url:w})}else h&&(b.thumbnail=new Mx({url:`data:image/png;base64,${h}`}));t.styleUrl?b.styleOrigin=new O$({portal:r.portal,styleUrl:t.styleUrl,name:e}):t.styleName&&(b.styleOrigin=new O$({portal:r.portal,styleName:t.styleName,name:e}))}return b})}function Iwt(t,e,r){const i=Owt.replaceAll(/\{SymbolName\}/gi,t),n=e.portal!=null?e.portal:ud.getDefault();return une(i,r).then(s=>{const o=MDe(s.data);return $De(o,{portal:n,url:da(Vz(i)),origin:"portal-item"})})}const Lwt=Object.freeze(Object.defineProperty({__proto__:null,fetchSymbolFromStyle:dne,getStyleItemFromStyle:hne,resolveWebStyleSymbol:$wt},Symbol.toStringTag,{value:"Module"}));async function Dwt(t){var a;if(t===null||t.styleName==null&&t.styleUrl==null)return null;const e=t.name;if(e==null)throw new K("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference");const r={portal:t.portal},i=await ADe(t,r).catch(()=>null);if(i===null)return null;const n=hne(e,i.data);if(n&&!((a=n.formatInfos)!=null&&a.some(l=>l.type==="gltf_basisu")))return null;const s=await dne(i,e,r,"webRef",(l,c)=>ODe(l,c,["gltf_basisu","gltf"])).catch(()=>null);if(s===null||s.type!=="point-3d")return null;const o=s.symbolLayers.items[0];return o.type==="object"?o.resource:null}let Nwt=class{constructor(e,r,i){this._elementSize=r,this._buffer=Wr.createVertex(e,Ar.STATIC_DRAW),this.resize(i)}destroy(){this._buffer.dispose()}get elementSize(){return this._elementSize}get capacity(){return this._capacity}get array(){return this._array}get buffer(){return this._buffer}get usedMemory(){return this._array.byteLength+this._buffer.usedMemory}copyRange(e,r,i,n=0){const s=new Uint8Array(this.array,e*this.elementSize,(r-e)*this.elementSize);new Uint8Array(i.array,n*this.elementSize).set(s)}transferAll(){this._buffer.setData(this._array)}transferRange(e,r){const i=e*this._elementSize,n=r*this._elementSize;this._buffer.setSubData(new Uint8Array(this._array),i,i,n)}resize(e){const r=e*this._elementSize,i=new ArrayBuffer(r);this._array&&(e>=this._capacity?new Uint8Array(i).set(new Uint8Array(this._array)):new Uint8Array(i).set(new Uint8Array(this._array).subarray(0,e*this._elementSize))),this._array=i,this._buffer.setSize(r),this._capacity=e}},Fwt=class{constructor(e){this.modelOriginHi=e.getField(R.INSTANCEMODELORIGINHI,Qs),this.modelOriginLo=e.getField(R.INSTANCEMODELORIGINLO,Qs),this.model=e.getField(R.INSTANCEMODEL,vv),this.modelNormal=e.getField(R.INSTANCEMODELNORMAL,vv),this.featureAttribute=e.getField(R.INSTANCEFEATUREATTRIBUTE,uf),this.color=e.getField(R.INSTANCECOLOR,za),this.objectAndLayerIdColor=e.getField(R.INSTANCEOBJECTANDLAYERIDCOLOR,za)}},Ame=class{constructor(e,r){this._rctx=e,this._instanceBufferLayout=r,this._headIndex=0,this._tailIndex=0,this._firstIndex=null,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._capacity=1}destroy(){this._buffer&&this._buffer.destroy()}get buffer(){return this._buffer.buffer}get view(){return this._view}get capacity(){return this._capacity}get size(){const e=this._headIndex,r=this._tailIndex;return e>=r?e-r:e+this._capacity-r}get isEmpty(){return this._headIndex===this._tailIndex}get isFull(){return this._tailIndex===(this._headIndex+1)%this._capacity}get headIndex(){return this._headIndex}get tailIndex(){return this._tailIndex}get firstIndex(){return this._firstIndex}get usedMemory(){var e;return((e=this._buffer)==null?void 0:e.usedMemory)??0}reset(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null}startUpdateCycle(){this._captureFirstIndex=!0}beginUpdate(){pt(!this._updating,"already updating"),this._updating=!0,this._prevHeadIndex=this._headIndex}endUpdate(){pt(this._updating,"not updating"),this.size<uze*this.capacity&&this._shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1}allocateHead(){pt(this._updating,"not updating"),this.isFull&&this._grow();const e=this.headIndex;return this._captureFirstIndex&&(this._firstIndex=e,this._captureFirstIndex=!1),this._incrementHead(),pt(this._headIndex!==this._tailIndex,"invalid pointers"),e}freeTail(){pt(this._updating,"not updating"),pt(this.size>0,"invalid size");const e=this._tailIndex===this._firstIndex;this._incrementTail(),e&&(this._firstIndex=this._tailIndex)}_grow(){const e=Math.max(k8,Math.floor(this._capacity*Ez));this._resize(e)}_shrink(){const e=Math.max(k8,Math.floor(this._capacity*cze));this._resize(e)}_resize(e){if(pt(this._updating,"not updating"),e===this._capacity)return;const r=new Nwt(this._rctx,this._instanceBufferLayout.stride,e);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const i=this.size,n=this._compactInstances(r);pt(n===i,"invalid compaction"),this._buffer.destroy(),this._tailIndex=0,this._headIndex=n,this._prevHeadIndex=0}this._resized=!0,this._capacity=e,this._buffer=r,this._view=new Fwt(this._instanceBufferLayout.createView(this._buffer.array))}_compactInstances(e){const r=this._headIndex,i=this._tailIndex;return i<r?(this._buffer.copyRange(i,r,e),r-i):i>r?(this._buffer.copyRange(i,this._capacity,e),r>0&&this._buffer.copyRange(0,r,e,this._capacity-i),r+(this._capacity-i)):0}_incrementHead(e=1){this._headIndex=(this._headIndex+e)%this._capacity}_incrementTail(e=1){this._tailIndex=(this._tailIndex+e)%this._capacity}_transferRange(e,r){e<r?this._buffer.transferRange(e,r):e>r&&(r>0&&this._buffer.transferRange(0,r),this._buffer.transferRange(e,this._capacity))}};const k8=64;var Hi;function kwt(t){let e=Qi().mat4f64(R.LOCALTRANSFORM).mat4f64(R.GLOBALTRANSFORM).vec4f64(R.BOUNDINGSPHERE).vec3f64(R.MODELORIGIN).mat3f(R.INSTANCEMODEL).mat3f(R.INSTANCEMODELNORMAL).vec2f(R.MODELSCALEFACTORS);return t.includes(R.FEATUREATTRIBUTE)&&(e=e.vec4f(R.FEATUREATTRIBUTE)),t.includes(R.COLOR)&&(e=e.vec4u8(R.COLOR)),t.includes(R.OBJECTANDLAYERIDCOLOR)&&(e=e.vec4u8(R.OBJECTANDLAYERIDCOLOR)),e=e.u8(R.STATE).u8(R.LODLEVEL),e}(function(t){t[t.ALLOCATED=1]="ALLOCATED",t[t.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE",t[t.VISIBLE=4]="VISIBLE",t[t.HIGHLIGHT=8]="HIGHLIGHT",t[t.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE",t[t.REMOVE=32]="REMOVE",t[t.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED",t[t.ACTIVE=18]="ACTIVE"})(Hi||(Hi={}));let Mme=class{constructor(e){this.localTransform=e.getField(R.LOCALTRANSFORM,F$),this.globalTransform=e.getField(R.GLOBALTRANSFORM,F$),this.modelOrigin=e.getField(R.MODELORIGIN,vd),this.model=e.getField(R.INSTANCEMODEL,vv),this.modelNormal=e.getField(R.INSTANCEMODELNORMAL,vv),this.modelScaleFactors=e.getField(R.MODELSCALEFACTORS,U2),this.boundingSphere=e.getField(R.BOUNDINGSPHERE,lU),this.featureAttribute=e.getField(R.FEATUREATTRIBUTE,uf),this.color=e.getField(R.COLOR,za),this.objectAndLayerIdColor=e.getField(R.OBJECTANDLAYERIDCOLOR,za),this.state=e.getField(R.STATE,a3),this.lodLevel=e.getField(R.LODLEVEL,a3)}},RS=class extends Ae{constructor(e,r){super(e),this.events=new Qn,this._capacity=0,this._size=0,this._next=0,this._layout=kwt(r),this._capacity=k8,this._buffer=this._layout.createBuffer(this._capacity),this._view=new Mme(this._buffer)}get capacity(){return this._capacity}get size(){return this._size}get view(){return this._view}addInstance(){this._size+1>this._capacity&&this._grow();const e=this._findSlot();return this._view.state.set(e,Hi.ALLOCATED),this._size++,this.events.emit("instances-changed"),e}removeInstance(e){const r=this._view.state;pt(e>=0&&e<this._capacity&&(r.get(e)&Hi.ALLOCATED)!=0,"invalid instance handle"),this._getStateFlag(e,Hi.ACTIVE)?this._setStateFlags(e,Hi.REMOVE):this.freeInstance(e),this.events.emit("instances-changed")}freeInstance(e){const r=this._view.state;pt(e>=0&&e<this._capacity&&(r.get(e)&Hi.ALLOCATED)!=0,"invalid instance handle"),r.set(e,0),this._size--}setLocalTransform(e,r,i=!0){this._view.localTransform.setMat(e,r),i&&this.updateModelTransform(e)}getLocalTransform(e,r){this._view.localTransform.getMat(e,r)}setGlobalTransform(e,r,i=!0){this._view.globalTransform.setMat(e,r),i&&this.updateModelTransform(e)}getGlobalTransform(e,r){this._view.globalTransform.getMat(e,r)}updateModelTransform(e){const r=this._view,i=mc,n=kd;r.localTransform.getMat(e,Ome),r.globalTransform.getMat(e,LG);const s=Hr(LG,LG,Ome);ie(i,s[12],s[13],s[14]),r.modelOrigin.setVec(e,i),th(n,s),r.model.setMat(e,n);const o=Jqe(mc,s);o.sort(),r.modelScaleFactors.set(e,0,o[1]),r.modelScaleFactors.set(e,1,o[2]),L2(n,n),gd(n,n),r.modelNormal.setMat(e,n),this._setStateFlags(e,Hi.TRANSFORM_CHANGED),this.events.emit("instance-transform-changed",{index:e})}getModelTransform(e,r){const i=this._view;i.model.getMat(e,kd),i.modelOrigin.getVec(e,mc),r[0]=kd[0],r[1]=kd[1],r[2]=kd[2],r[3]=0,r[4]=kd[3],r[5]=kd[4],r[6]=kd[5],r[7]=0,r[8]=kd[6],r[9]=kd[7],r[10]=kd[8],r[11]=0,r[12]=mc[0],r[13]=mc[1],r[14]=mc[2],r[15]=1}applyShaderTransformation(e,r){this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,r)}getCombinedModelTransform(e,r){return this.getModelTransform(e,r),this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,r),r}getCombinedLocalTransform(e,r){this._view.localTransform.getMat(e,r),this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,r)}getCombinedMaxScaleFactor(e){let r=this._view.modelScaleFactors.get(e,1);return this.shaderTransformation!=null&&(this.shaderTransformation.scaleFactor(mc,this,e),r*=Math.max(mc[0],mc[1],mc[2])),r}getCombinedMedianScaleFactor(e){let r=this._view.modelScaleFactors.get(e,0);return this.shaderTransformation!=null&&(this.shaderTransformation.scaleFactor(mc,this,e),r*=zwt(mc[0],mc[1],mc[2])),r}getModel(e,r){this._view.model.getMat(e,r)}setFeatureAttribute(e,r){this._view.featureAttribute.setVec(e,r)}getFeatureAttribute(e,r){this._view.featureAttribute.getVec(e,r)}setColor(e,r){this._view.color.setVec(e,r)}setObjectAndLayerIdColor(e,r){this._view.objectAndLayerIdColor.setVec(e,r)}setVisible(e,r){r!==this.getVisible(e)&&(this._setStateFlag(e,Hi.VISIBLE,r),this.events.emit("instance-visibility-changed",{index:e}))}getVisible(e){return this._getStateFlag(e,Hi.VISIBLE)}setHighlight(e,r){r!==this.getHighlight(e)&&(this._setStateFlag(e,Hi.HIGHLIGHT,r),this.events.emit("instance-highlight-changed"))}getHighlight(e){return this._getStateFlag(e,Hi.HIGHLIGHT)}getState(e){return this._view.state.get(e)}getLodLevel(e){return this._view.lodLevel.get(e)}countFlags(e){let r=0;for(let i=0;i<this._capacity;++i)this.getState(i)&e&&++r;return r}_setStateFlags(e,r){const i=this._view.state;r=i.get(e)|r,i.set(e,r)}_clearStateFlags(e,r){const i=this._view.state;r=i.get(e)&~r,i.set(e,r)}_setStateFlag(e,r,i){i?this._setStateFlags(e,r):this._clearStateFlags(e,r)}_getStateFlag(e,r){return!!(this._view.state.get(e)&r)}_grow(){this._capacity=Math.max(k8,Math.floor(this._capacity*Ez)),this._buffer=this._layout.createBuffer(this._capacity).copyFrom(this._buffer),this._view=new Mme(this._buffer)}_findSlot(){const e=this._view.state;let r=this._next;for(;e.get(r)&Hi.ALLOCATED;)r=r+1===this._capacity?0:r+1;return this._next=r+1===this._capacity?0:r+1,r}};function zwt(t,e,r){return Math.max(Math.min(t,e),Math.min(Math.max(t,e),r))}d([m({constructOnly:!0})],RS.prototype,"shaderTransformation",void 0),d([m()],RS.prototype,"_size",void 0),d([m({readOnly:!0})],RS.prototype,"size",null),RS=d([V("esri.views.3d.webgl-engine.lib.lodRendering.InstanceData")],RS);const mc=C(),kd=li(),Ome=xe(),LG=xe();let Uwt=class extends Bp{constructor(e,r){super(i=>this._instanceData.view.boundingSphere.getVec(i,this._tmpSphere),{maximumDepth:25}),this._instanceData=e,this._boundingSphere=r,this._tmpSphere=Jn(),this._tmpMat4=xe()}addInstance(e){const r=this._instanceData.view.boundingSphere,i=this._instanceData.getCombinedModelTransform(e,this._tmpMat4);Ge(this._tmpSphere,this._boundingSphere.center,i),this._tmpSphere[3]=this._boundingSphere.radius*qE(i),r.setVec(e,this._tmpSphere),this.add([e])}removeInstance(e){this.remove([e])}},Bwt=class{constructor(e,r){this._worldSpaceRadius=e,this._minScreenSpaceRadii=r}selectLevel(e,r,i){const n=i.computeScreenPixelSizeAt(e),s=this._worldSpaceRadius*r/n;let o=0;for(let a=1;a<this._minScreenSpaceRadii.length;++a)s>=this._minScreenSpaceRadii[a]&&(o=a);return o}},Vwt=class extends kI{constructor(e,r,i,n,s,o){super(e,r),this.layerUid=e,this.graphicUid=r,this.geometryId=i,this.triangleNr=n,this.baseBoundingSphere=s,this.numLodLevels=o}};function pne(t){return xd(t)&&t.intersector===Bi.LOD&&!!t.target}let Gwt=class{constructor(e,r){const i=e.renderContext.rctx,n=r.geometry;this._materialRepository=e.materialRepository,n.material.setParameters({instancedDoublePrecision:!0});const s=n.material.createBufferWriter(),o=s.vertexBufferLayout,a=s.elementCount(n),l=o.createBuffer(a);s.write(null,null,n,l,0),this.geometry=n,this.material=n.material,this.glMaterials=new TIe(n.material,this._materialRepository),this.vertexBufferLayout=o,this.vbo=Wr.createVertex(i,Ar.STATIC_DRAW,l.buffer),this.vao=new _f(i,Mr,{geometry:ou(o)},{geometry:this.vbo}),this.vertexCount=a}destroy(){this.glMaterials.dispose(),this.vbo.dispose(),this.vao.dispose()}get boundingInfo(){return this.geometry.boundingInfo}get triangleCount(){return this.vertexCount/3}intersect(e,r,i,n,s,o,a,l){const c=this.geometry.id;this.material.intersect(this.geometry,e.transform.transform,e,i,n,(u,h,p,f,g)=>{if(u>=0){if(r!=null&&!r(e.rayBegin,e.rayEnd,u))return;const _=new Vwt(o.layerUid,o.graphicUid(s),c,p,a,l);if((e.results.min.drapedLayerOrder==null||g>=e.results.min.drapedLayerOrder)&&(e.results.min.dist==null||u<e.results.min.dist)&&e.results.min.set(Bi.LOD,_,u,h,e.transform.transform,g),e.options.store!==Go.MIN&&(e.results.max.drapedLayerOrder==null||g>=e.results.max.drapedLayerOrder)&&(e.results.max.dist==null||u>e.results.max.dist)&&e.results.max.set(Bi.LOD,_,u,h,e.transform.transform,g),e.options.store===Go.ALL){const v=mte(e.results.min.ray);v.set(Bi.LOD,_,u,h,e.transform.transform,g),e.results.all.push(v)}}})}},jwt=class IDe{static async create(e,r,i){const n=await Promise.allSettled(r.components.map(o=>e.controller.schedule(()=>new Gwt(e,o),i))),s=n.map(o=>o.status==="fulfilled"?o.value:null).filter(P3);if(Ls(i)||s.length!==n.length){s.forEach(o=>o.destroy()),vt(i);for(const o of n)if(o.status==="rejected")throw o.reason}return new IDe(r.minScreenSpaceRadius,s)}constructor(e,r){this.minScreenSpaceRadius=e,this.components=r}destroy(){this.components.forEach(e=>e.destroy())}intersect(e,r,i,n,s,o,a){this.components.forEach(l=>l.intersect(e,r,i,n,s,o,this.boundingSphere,a))}get boundingBox(){if(this._boundingBox==null){const e=Li();this.components.forEach(r=>{r.boundingInfo!=null&&(lf(e,r.boundingInfo.bbMin),lf(e,r.boundingInfo.bbMax))}),this._boundingBox=e}return this._boundingBox}get boundingSphere(){if(this._boundingSphere==null){const e=this.boundingBox,r=C();kp(e,r),this._boundingSphere={center:r,radius:.5*n3e(e)}}return this._boundingSphere}get triangleCount(){return this.components.reduce((e,r)=>e+r.triangleCount,0)}};const Hwt=t=>{const e=t.baseBoundingSphere.radius,r=t.levels.map(i=>i.minScreenSpaceRadius);return new Bwt(e,r)};let Ph=class extends cot{constructor(e,r){super(e),this.type=Bi.LOD,this.isGround=!1,this._levels=[],this._defaultRenderInstanceData=[new Array],this._highlightRenderInstanceData=[new Array],this._allRenderInstanceData=[this._defaultRenderInstanceData[0],this._highlightRenderInstanceData[0]],this._instanceIndex=0,this._cycleStartIndex=0,this._slicePlane=!1,this._camera=new Qe,this._updateCyclesWithStaticCamera=-1,this._needFullCycle=!1,this.produces=new Map([[ue.OPAQUE_MATERIAL,i=>this._produces(i)],[ue.TRANSPARENT_MATERIAL,i=>!!this._hasTransparentLevels()&&this._produces(i)]]),this._instanceData=new RS({shaderTransformation:e.shaderTransformation},e.optionalFields),this.addHandles(r.registerTask(bt.LOD_RENDERER,this))}initialize(){this._instanceBufferLayout=qwt(this.optionalFields),this._glInstanceBufferLayout=ou(this._instanceBufferLayout,1),this.addHandles([this._instanceData.events.on("instances-changed",()=>this._requestUpdateCycle()),this._instanceData.events.on("instance-transform-changed",({index:e})=>{this._requestUpdateCycle(),this.metadata.notifyGraphicGeometryChanged(e)}),this._instanceData.events.on("instance-visibility-changed",({index:e})=>{this._requestUpdateCycle(!0),this.metadata.notifyGraphicVisibilityChanged(e)}),this._instanceData.events.on("instance-highlight-changed",()=>this._requestUpdateCycle(!0))])}get _enableLevelSelection(){return this.symbol.levels.length>1}get levels(){return this._levels}get baseBoundingBox(){return this._levels[this._levels.length-1].boundingBox}get baseBoundingSphere(){return this._levels[this._levels.length-1].boundingSphere}get baseMaterial(){return this._levels[this._levels.length-1].components[0].material}get slicePlaneEnabled(){return this._slicePlane}set slicePlaneEnabled(e){this._slicePlane=e}get layerUid(){return this.metadata.layerUid}get instanceData(){return this._instanceData}get usedMemory(){return this._allRenderInstanceData.reduce((e,r)=>r.reduce((i,n)=>i+n.usedMemory,e),0)}get renderStats(){const e=this._instanceData.size,r=[];return this._levels.forEach((i,n)=>{const s=this._allRenderInstanceData[0][n].size+this._allRenderInstanceData[1][n].size,o=i.triangleCount;r.push({renderedInstances:s,renderedTriangles:s*o,trianglesPerInstance:o})}),{totalInstances:e,renderedInstances:r.reduce((i,n)=>i+n.renderedInstances,0),renderedTriangles:r.reduce((i,n)=>i+n.renderedTriangles,0),levels:r}}async initializeRenderContext(e,r){this._context=e;const i=e.renderContext.rctx,n=await Promise.allSettled(this.symbol.levels.map(o=>(this._defaultRenderInstanceData[0].push(new Ame(i,this._instanceBufferLayout)),this._highlightRenderInstanceData[0].push(new Ame(i,this._instanceBufferLayout)),jwt.create(e,o,r)))),s=n.map(o=>o.status==="fulfilled"?o.value:null).filter(P3);if(Ls(r)||s.length!==n.length){s.forEach(o=>o.destroy()),vt(r);for(const o of n)if(o.status==="rejected")throw o.reason}this._levels=s,this._levelSelector=Hwt(this)}uninitializeRenderContext(){this._invalidateOctree(),this._levels.forEach(e=>e.destroy()),this._defaultRenderInstanceData[0].forEach(e=>e.destroy()),this._highlightRenderInstanceData[0].forEach(e=>e.destroy())}_hasTransparentLevels(){return this._levels.some(e=>e.components.some(r=>{const i=r.material.produces.get(ue.TRANSPARENT_MATERIAL);return i&&i(U.Color)}))}hasHighlights(){return this._highlightRenderInstanceData[0].some(e=>e.size>0)}_produces(e){return e!==U.Highlight&&e!==U.ShadowHighlight||this.hasHighlights()}prepareRender(e){if(!yi.LOD_INSTANCE_RENDERER_DISABLE_UPDATES){if(this._enableLevelSelection){const r=e.bindParameters.contentCamera.equals(this._camera);this._camera.copyFrom(e.bindParameters.contentCamera),r||this._requestUpdateCycle()}this._needFullCycle&&(this.runTask(yl),this._needFullCycle=!1)}}prepareTechniques(e){if(!this.baseMaterial.isVisible()||!this.baseMaterial.isVisibleForOutput(e.output))return null;const r=this._getInstanceDatas(e.output);if(!r)return null;const i=new Array;return r.forEach(n=>this.levels.forEach((s,o)=>{s.components.forEach(a=>i.push(this._beginComponent(e,n[o],a)))})),i}renderNode(e,r){const i=this._getInstanceDatas(e.output);if(!i||r==null)return;let n=0;e.rctx.bindVAO(),i.forEach(s=>this.levels.forEach((o,a)=>{o.components.forEach(l=>this._renderComponent(e,r[n++],s[a],l,a))}))}_getInstanceDatas(e){const r=e!==U.Highlight&&e!==U.ShadowHighlight,i=e!==U.ShadowExcludeHighlight;return r&&i?this._allRenderInstanceData:r?this._defaultRenderInstanceData:i?this._highlightRenderInstanceData:null}intersect(e,r,i,n){if(!this.baseMaterial.isVisible()||this._octree==null)return;const s=C();ye(s,n,i);const o=a=>{this._instanceData.getCombinedModelTransform(a,Ime),e.transform.set(Ime),Ge(Lme,i,e.transform.inverse),Ge(Dme,n,e.transform.inverse);const l=this._instanceData.getState(a),c=this._instanceData.getLodLevel(a),u=this._levels.length;pt((l&Hi.ACTIVE)!=0,"invalid instance state"),pt(c>=0&&c<u,"invaid lod level"),this._levels[c].intersect(e,r,Lme,Dme,a,this.metadata,u)};this.baseMaterial.parameters.verticalOffset?this._octree.forEach(o):this._octree.forEachAlongRay(i,s,o)}notifyShaderTransformationChanged(){this._invalidateOctree(),this._requestUpdateCycle()}get _octree(){var e;if(this._octreeCached==null){const r=this._instanceData,i=(e=r.view)==null?void 0:e.state;if(!i)return null;this._octreeCached=new Uwt(r,this.baseBoundingSphere);for(let n=0;n<r.capacity;++n)i.get(n)&Hi.ACTIVE&&this._octreeCached.addInstance(n)}return this._octreeCached}_invalidateOctree(){this._octreeCached=Pe(this._octreeCached)}queryDepthRange(e){if(this._octree==null)return{near:1/0,far:-1/0};const r=e.viewForward,i=this._octree.findClosest(r,Bp.DepthOrder.FRONT_TO_BACK,e.frustum),n=this._octree.findClosest(r,Bp.DepthOrder.BACK_TO_FRONT,e.frustum);if(i==null||n==null)return{near:1/0,far:-1/0};const s=e.eye,o=this._instanceData.view;o.boundingSphere.getVec(i,Uf),ye(Uf,Uf,s);const a=de(Uf,r)-Uf[3];o.boundingSphere.getVec(n,Uf),ye(Uf,Uf,s);const l=de(Uf,r)+Uf[3];return{near:Math.max(e.near,a),far:Math.min(e.far,l)}}_requestUpdateCycle(e=!1){this._updateCyclesWithStaticCamera=-1,this._cycleStartIndex=this._instanceIndex,e&&(this._needFullCycle=!0,this._context.requestRender())}_startUpdateCycle(){this._updateCyclesWithStaticCamera++,this._allRenderInstanceData.forEach(e=>e.forEach(r=>r.startUpdateCycle()))}get running(){return this._instanceData.size>0&&this._updateCyclesWithStaticCamera<1}runTask(e){const{_enableLevelSelection:r,_camera:i,_levelSelector:n}=this;this._allRenderInstanceData.forEach(h=>h.forEach(p=>p.beginUpdate()));const s=this._instanceData,o=s.view;let a=s.size;const l=s.capacity;let c=this._instanceIndex;const u=Math.ceil(l/500);for(let h=0;h<a&&!e.done;++h){c===this._cycleStartIndex&&this._startUpdateCycle();const p=o.state.get(c);let f=0;if(!(p&Hi.ALLOCATED)){c=c+1===l?0:c+1,a++;continue}const g=o.lodLevel.get(c);if(p&Hi.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[0][g].freeTail(),p&Hi.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[0][g].freeTail(),p&Hi.REMOVE)s.freeInstance(c);else if(p&Hi.VISIBLE){let _=0;r&&(o.modelOrigin.getVec(c,$me),_=n.selectLevel($me,s.getCombinedMedianScaleFactor(c),i)),f=p&~(Hi.ACTIVE|Hi.TRANSFORM_CHANGED),_>=0&&(p&Hi.HIGHLIGHT?(Rme(this._highlightRenderInstanceData[0][_],o,c),f|=Hi.HIGHLIGHT_ACTIVE):(Rme(this._defaultRenderInstanceData[0][_],o,c),f|=Hi.DEFAULT_ACTIVE)),o.state.set(c,f),o.lodLevel.set(c,_)}else f=p&~(Hi.ACTIVE|Hi.TRANSFORM_CHANGED),o.state.set(c,f);if(this._octreeCached!=null){const _=!!(p&Hi.ACTIVE),v=!!(f&Hi.ACTIVE);!_&&v?this._octreeCached.addInstance(c):_&&!v?this._octreeCached.removeInstance(c):_&&v&&p&Hi.TRANSFORM_CHANGED&&(this._octreeCached.removeInstance(c),this._octreeCached.addInstance(c))}c=c+1===l?0:c+1,c%u==0&&e.madeProgress()}this._instanceIndex=c,this._allRenderInstanceData.forEach(h=>h.forEach(p=>p.endUpdate())),this._context.requestRender()}_beginComponent(e,r,i){if(r.size===0)return null;const n=i.glMaterials.load(e.rctx,e.bindParameters.slot,e.output);return n!=null?n.beginSlot(e.bindParameters):null}_renderComponent(e,r,i,n,s){if(!r)return;const{bindParameters:o,rctx:a}=e;a.runAppleAmdDriverHelper();const l=a.bindTechnique(r,o,n.material.parameters,Ywt);a.bindVAO(n.vao),r.ensureAttributeLocations(n.vao),yi.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&e.output===U.Color&&(l.setUniform4fv("externalColor",Nme[Math.min(s,Nme.length-1)]),l.setUniform1i("colorMixMode",MOe.replace));const c=i.capacity,u=i.headIndex,h=i.tailIndex,p=i.firstIndex,f=this._glInstanceBufferLayout,g=(_,v)=>{Zte(a,Mr,i.buffer,f,_),a.drawArraysInstanced(r.primitiveType,0,n.vertexCount,v-_),zPe(a,Mr,i.buffer,f)};n.material.parameters.transparent&&p!=null?u>h?(pt(p>=h&&p<=u,"invalid firstIndex"),g(p,u),g(h,p)):u<h&&(p<=u?(pt(p>=0&&p<=u,"invalid firstIndex"),g(p,u),g(h,c),g(0,p)):(pt(p>=h&&p<=c,"invalid firstIndex"),g(p,c),g(0,u),g(h,p))):u>h?g(h,u):u<h&&(g(0,u),g(h,c)),a.bindVAO(null)}};function Rme(t,e,r){const i=t.allocateHead();Wwt(e,r,t.view,i)}function Wwt(t,e,r,i){wst(t.modelOrigin,e,r.modelOriginHi,r.modelOriginLo,i),r.model.copyFrom(i,t.model,e),r.modelNormal.copyFrom(i,t.modelNormal,e),t.color&&r.color&&r.color.copyFrom(i,t.color,e),t.objectAndLayerIdColor&&r.objectAndLayerIdColor&&r.objectAndLayerIdColor.copyFrom(i,t.objectAndLayerIdColor,e),t.featureAttribute&&r.featureAttribute&&r.featureAttribute.copyFrom(i,t.featureAttribute,e)}function qwt(t){let e=Qi().vec3f(R.INSTANCEMODELORIGINHI).vec3f(R.INSTANCEMODELORIGINLO).mat3f(R.INSTANCEMODEL).mat3f(R.INSTANCEMODELNORMAL);return t!=null&&t.includes("featureAttribute")&&(e=e.vec4f(R.INSTANCEFEATUREATTRIBUTE)),t!=null&&t.includes("color")&&(e=e.vec4u8(R.INSTANCECOLOR)),t!=null&&t.includes("objectAndLayerIdColor")&&(e=e.vec4u8(R.INSTANCEOBJECTANDLAYERIDCOLOR)),e}d([m({constructOnly:!0})],Ph.prototype,"symbol",void 0),d([m({constructOnly:!0})],Ph.prototype,"optionalFields",void 0),d([m({constructOnly:!0})],Ph.prototype,"metadata",void 0),d([m({constructOnly:!0})],Ph.prototype,"shaderTransformation",void 0),d([m()],Ph.prototype,"_instanceData",void 0),d([m()],Ph.prototype,"_cycleStartIndex",void 0),d([m({readOnly:!0})],Ph.prototype,"_enableLevelSelection",null),d([m()],Ph.prototype,"_updateCyclesWithStaticCamera",void 0),d([m({readOnly:!0})],Ph.prototype,"running",null),Ph=d([V("esri.views.3d.webgl-engine.lib.lodRendering.LodRenderer")],Ph);const $me=C(),Uf=Zt(),Ime=xe(),Lme=C(),Dme=C(),Nme=[Bt(1,0,1,1),Bt(0,0,1,1),Bt(0,1,0,1),Bt(1,1,0,1),Bt(1,0,0,1)],Ywt=new jdt;let Fme=class{constructor(e,r,i,n,s,o,a,l,c,u,h,p){this.lodResources=e,this.lodRenderer=r,this.stageResources=i,this.originalMaterialParameters=n,this.resourceSize=s,this.isEsriSymbolResource=o,this.isWosr=a,this.resourceBoundingBox=l,this.symbolSize=c,this.extentPadding=u,this.physicalBasedRenderingEnabled=h,this.pivotOffset=p}},Xwt=class extends Sg{getCachedSize(){const[e,r,i]=this._resources!=null?this._resources.symbolSize:[1,1,1];return{width:e,depth:r,height:i}}constructor(e,r,i,n){super(e,r,i,n),this._resources=null,this._optionalFields=new Array,this._instanceIndexToGraphicUid=new Map,this._hasLoadedPBRTextures=!1,this._disposeResourceHandles=new Array,this.skipHighSymbolLodsChanged=!1,this.ensureDrapedStatus(!1),this._hasLoadedPBRTextures=i.physicalBasedRenderingEnabled}async doLoad(e){if(!this._drivenProperties.size&&RU(this.symbolLayer))throw new Error;if(this._isPrimitive){const r=this.symbolLayer.resource,i=r&&rdt(r.primitive)?r.primitive:p3e;this._resources=await this._createResourcesForPrimitive(i,e)}else{const r=await Dwt(this.symbol.styleOrigin),i=(r==null?void 0:r.href)??this.symbolLayer.resource.href;this._resources=await this._createResourcesForUrl(i,e)}this.layerOpacityChanged(),this.slicePlaneEnabledChanged(),this.physicalBasedRenderingChanged(),this.complexity=this.computeComplexity()}get extentPadding(){return this._resources!=null?this._resources.extentPadding:0}get _isPrimitive(){var e;return!((e=this.symbolLayer.resource)!=null&&e.href)}get lodRenderer(){var e;return(e=this._resources)==null?void 0:e.lodRenderer}get materials(){var e;return((e=this._resources)==null?void 0:e.stageResources.materials)??[]}_setMaterialTransparencyParameters(e,r=(n=>(n=(i=>(i=this.symbolLayer)==null?void 0:i.material)())==null?void 0:n.color)()){const s=this._getCombinedOpacity(r),o=s<1||this.needsDrivenTransparentPass;return e.transparent=o,e.opacity=s,e.cullFace=o?Pi.None:Pi.Back,e}async _createResourcesForPrimitive(e,r){const i=this.symbolLayer,n=vs(Fet(e)),s=Ea($D(n)),o=Ea(EV(s,i)),a=Te(o),l=!1,c=!1,u={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,mrrFactors:[...cie],ambient:Im,diffuse:Im,hasSlicePlane:this._context.slicePlaneEnabled,hasSliceHighlight:!1,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive},h=!!u.usePBR;this._setMaterialTransparencyParameters(u);const p=this.symbol;if(p.type==="point-3d"&&p.verticalOffset){const{screenLength:w,minWorldLength:x,maxWorldLength:S}=p.verticalOffset;u.verticalOffset={screenLength:fs(w),minWorldLength:x||0,maxWorldLength:S??1/0},u.castShadows=!1}if(this._context.screenSizePerspectiveEnabled&&(u.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),this._drivenProperties.color)u.externalColor=qh;else{const w=i.material!=null?i.material.color:null,x=w!=null?Xe.toUnitRGBA(w):qh;u.externalColor=x}this._fastUpdates=u3(this._context.renderer,this._fastVisualVariableConvertOptions(n,o,s,null)),u.isInstanced=!0,this._fastUpdates?(Object.assign(u,this._fastUpdates.materialParameters),this._optionalFields.push(R.FEATUREATTRIBUTE)):this._hasPerInstanceColor()&&(u.hasInstancedColor=!0,this._optionalFields.push(R.COLOR)),se("enable-feature:objectAndLayerId-rendering")&&this._optionalFields.push(R.OBJECTANDLAYERIDCOLOR);const f=new hf(u),g=_Re(e,f);if(!g)throw new Error(`Unknown object symbol primitive: ${e}`);const _=vN(g).map(w=>({opacity:1,transparent:w.parameters.transparent})),v=await this._createStageResources(g,h,r),b=await this._createLodRenderer(g,r);return new Fme(g,b,v,_,s,l,c,n,o,a,h,null)}async _createResourcesForUrl(e,r){var k,q;const i={materialParameters:{isInstanced:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};this._fastUpdates=u3(this._context.renderer,this._fastVisualVariableConvertOptions(null,null,null,null)),this._fastUpdates?(Object.assign(i.materialParameters,this._fastUpdates.materialParameters),this._optionalFields.push(R.FEATUREATTRIBUTE)):this._hasPerInstanceColor()&&(i.materialParameters.hasInstancedColor=!0,this._optionalFields.push(R.COLOR)),se("enable-feature:objectAndLayerId-rendering")&&this._optionalFields.push(R.OBJECTANDLAYERIDCOLOR);const n=this.symbol;if(n.type==="point-3d"&&n.verticalOffset){const{screenLength:B,minWorldLength:J,maxWorldLength:W}=n.verticalOffset;i.materialParameters.verticalOffset={screenLength:fs(B),minWorldLength:J||0,maxWorldLength:W??1/0},i.materialParameters.castShadows=!1}const s=this._context.physicalBasedRenderingEnabled;i.signal=r,i.usePBR=s,i.skipHighLods=this._context.skipHighSymbolLods;const o=await CDe(e,i),a=o.isEsriSymbolResource,l=o.isWosr,c=vbt(o.lods),u=this._context,h=this.symbolLayer.material,p=this._getExternalColorParameters(h),f=(q=(k=this.symbolLayer)==null?void 0:k.material)==null?void 0:q.color,g=this._getCombinedOpacity(f,{hasIntrinsicColor:!0}),_=this.needsDrivenTransparentPass,v=vN(c),b=vN(c).map(B=>({opacity:B.parameters.opacity||1,transparent:B.parameters.transparent}));v.forEach(B=>{const J=B.parameters;B.setParameters(p);const W=J.opacity*g,Y=W<1||_||J.transparent;B.setParameters({opacity:W,transparent:Y}),u.screenSizePerspectiveEnabled&&B.setParameters({screenSizePerspective:u.sharedResources.screenSizePerspectiveSettings})});const w=o.referenceBoundingBox,x=Ea($D(w)),S=Ea(c.levels[0].pivotOffset),E=Ea(EV(x,this.symbolLayer)),A=Te(E),O=this._fastUpdates;h3(O,this._context.renderer,this._fastVisualVariableConvertOptions(w,E,x,S))&&v.forEach(B=>B.setParameters(O.materialParameters));const L=await this._createStageResources(c,s,r),z=await this._createLodRenderer(c,r);return new Fme(c,z,L,b,x,a,l,w,E,A,s,S)}_addDisposeResource(e){this._disposeResourceHandles.push(e)}async _createStageResources(e,r,i){const n=this._context.stage,s=vN(e);r!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged(),n.addMany(s),this._addDisposeResource(()=>n.removeMany(s));const o=Ide(e);n.addMany(o),this._addDisposeResource(()=>{o.forEach(l=>l.unload()),n.removeMany(o)}),await Promise.all(o.map(l=>this._context.stage.schedule(()=>l.load(n.renderView.renderingContext),i))),vt(i);const a=Lde(e);return n.addMany(a),this._addDisposeResource(()=>n.removeMany(a)),{materials:s,textures:o,geometries:a}}async _createLodRenderer(e,r){const i=this._context.stage,n={layerUid:this._context.layer.uid,graphicUid:l=>this._instanceIndexToGraphicUid.get(l),notifyGraphicGeometryChanged:l=>this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(l)),notifyGraphicVisibilityChanged:l=>this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(l))},s=this._fastUpdates,o=s?{applyTransform:(l,c,u)=>{l.getFeatureAttribute(c,ZN),Zn(u,fut(s.materialParameters,ZN,u))},scaleFactor:(l,c,u)=>{c.getFeatureAttribute(u,ZN),Hre(l,s.materialParameters,ZN)}}:null,a=new Ph({symbol:e,optionalFields:this._optionalFields,metadata:n,shaderTransformation:o},this._context.scheduler);return a.slicePlaneEnabled=this._context.slicePlaneEnabled,this._addDisposeResource(()=>{i.removeRenderPlugin(a),a.destroy()}),await i.addRenderPlugin(a,r),a}_getExternalColorParameters(e){const r={};return this._drivenProperties.color?r.externalColor=qh:(e==null?void 0:e.color)!=null?r.externalColor=Xe.toUnitRGBA(e.color):(r.externalColor=qh,r.colorMixMode="ignore"),r}destroy(){super.destroy(),this._cleanupResources()}_cleanupResources(){this._disposeResourceHandles.forEach(e=>e()),this._disposeResourceHandles.length=0,this._resources=null}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry))return null;const i=q$(r.geometry);if(i==null)return this.logger.warn(`unsupported geometry type for icon symbol: ${r.geometry.type}`),null;const n=this.setGraphicElevationContext(r),s=e.renderingInfo;return this._createAs3DShape(r,i,s,n,r.uid,e.layer.uid)}notifyDestroyGraphicLayer(e){this._instanceIndexToGraphicUid.delete(e.instanceIndex)}graphicLayerToGraphicId(){return 0}layerOpacityChanged(){var s,o;if(this._resources==null)return;const e=this._drivenProperties.opacity,r=!this._isPrimitive,i=this._resources.stageResources.materials,n=this._resources.originalMaterialParameters;for(let a=0;a<i.length;a++){const l=i[a],c=(o=(s=this.symbolLayer)==null?void 0:s.material)==null?void 0:o.color,u=n[a],h=this._getCombinedOpacity(c,{hasIntrinsicColor:r})*u.opacity,p=h<1||e||u.transparent;l.setParameters({opacity:h,transparent:p}),this._isPrimitive&&l.setParameters({cullFace:p?Pi.None:Pi.Back})}}layerElevationInfoChanged(e,r){return this.updateGraphics3DGraphicElevationInfo(e,r,Sv)}slicePlaneEnabledChanged(){if(this._resources==null)return!0;this._resources.lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;for(const e of this._resources.stageResources.materials)e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){if(this._resources==null)return!0;const{stageResources:e,isWosr:r}=this._resources;for(const i of e.materials)this._isPrimitive?i.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):r||i.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return this._hasLoadedPBRTextures!==!1||this._context.physicalBasedRenderingEnabled!==!0||(this._hasLoadedPBRTextures=!0,!1)}applyRendererDiff(e,r){if(this._resources==null)return Xn.RecreateSymbol;const{stageResources:{materials:i},lodRenderer:n,resourceBoundingBox:s,symbolSize:o,resourceSize:a,pivotOffset:l}=this._resources;for(const c in e.diff){if(c!=="visualVariables"||!h3(this._fastUpdates,r,this._fastVisualVariableConvertOptions(s,o,a,l)))return Xn.RecreateSymbol;for(const u of i)u.setParameters(this._fastUpdates.materialParameters);n.notifyShaderTransformationChanged()}return Xn.FastUpdate}computeComplexity(){if(this._resources==null)return super.computeComplexity();const e=this._resources.lodResources,r=KRe(e.levels),i=a=>Array.from(a.attributes.values()).reduce((l,c)=>l+K1(c.data,c.indices),0),n=Lde(e).reduce((a,l)=>a+i(l),0),s=Ide(e).reduce((a,l)=>a+l.memoryEstimate,0)+n,o={...QRe(this.symbol,this.symbolLayer),resourceBytes:s};return new Fh({verticesPerFeature:r,memory:o})}_hasLodRenderer(){return this._resources!=null}_createAs3DShape(e,r,i,n,s,o){if(!this._hasLodRenderer()||this._resources==null)return null;const a=this.getFastUpdateAttrValues(e),l=this._context.clippingExtent;if(_n(r,IT,this._context.elevationProvider.spatialReference),l!=null&&!Rte(l,IT))return null;const c=this._requiresTerrainElevation(n),u=this._computeGlobalTransform(r,n,DG,JN),h=this._computeLocalTransform(this._resources,this.symbolLayer,i,kme),p=this._resources.lodRenderer.instanceData,f=p.addInstance();this._instanceIndexToGraphicUid.set(f,s),p.setLocalTransform(f,h,!1),p.setGlobalTransform(f,u),a&&p.setFeatureAttribute(f,a),this._fastUpdates==null&&this._hasPerInstanceColor()&&p.setColor(f,pR(i.color,i.opacity,255)),this._context.stage.renderView.objectAndLayerIdRenderHelper!=null&&p.setObjectAndLayerIdColor(f,this._context.stage.renderView.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor({graphicUid:s,layerUid:o}));const g=new gbt(this,f,zht,n);return c&&(g.alignedSampledElevation=JN.sampledElevation),g.needsElevationUpdates=Sv(n.mode),W$(g,r,this._context.elevationProvider),g}_computeGlobalTransform(e,r,i,n){return Tv(e,this._context.elevationProvider,r,this._context.renderCoordsHelper,n),IT[0]=e.x,IT[1]=e.y,IT[2]=n.z,La(e.spatialReference,IT,i,this._context.renderCoordsHelper.spatialReference),i}_computeLocalTransform(e,r,i,n){return pd(n),this._applyObjectRotation(i,!1,n),this._applyObjectRotation(r,!0,n),this._applyObjectScale(e,i,n),this._applyAnchor(e,r,n),n}_applyObjectScale(e,r,i){var o;if((o=this._fastUpdates)!=null&&o.requiresShaderTransformation)return;const n=this._drivenProperties.size&&r.size?r.size:e.symbolSize,s=Rde(n,e.symbolSize,e.resourceSize,this._context.renderCoordsHelper.unitInMeters);s[0]===1&&s[1]===1&&s[2]===1||P2(i,i,s)}prepareSymbolLayerPatch(e){if(e.diff.type!=="partial")return;const r=e.diff.diff;this._preparePatchTransform(e,r),this._preparePatchColor(e,r)}updateGeometry(e,r){if(this._resources==null)return!0;const i=r&&q$(r);if(i==null)return!1;const n=this.getGeometryElevationMode(r);return e.elevationContext.mode===n&&(this._computeGlobalTransform(i,e.elevationContext,DG,JN),this._requiresTerrainElevation(e.elevationContext)&&(e.alignedSampledElevation=JN.sampledElevation),this._resources.lodRenderer.instanceData.setGlobalTransform(e.instanceIndex,DG,!0),W$(e,i,this._context.elevationProvider),!0)}_preparePatchTransform(e,r){if(!(r.heading||r.tilt||r.roll||r.width||r.height||r.depth||r.anchor||r.anchorPosition)||this._resources==null)return;const i=(g,_,v)=>(g!=null&&g.type==="complete"?g.newValue:_)??v,n=i(r.heading,this.symbolLayer.heading,0),s=i(r.tilt,this.symbolLayer.tilt,0),o=i(r.roll,this.symbolLayer.roll,0),a=i(r.width,this.symbolLayer.width,void 0),l=i(r.height,this.symbolLayer.height,void 0),c=i(r.depth,this.symbolLayer.depth,void 0),u=i(r.anchor,this.symbolLayer.anchor,void 0),h=i(r.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete r.heading,delete r.tilt,delete r.roll,delete r.width,delete r.height,delete r.depth,delete r.anchor,delete r.anchorPosition;const p={heading:n,tilt:s,roll:o,anchor:u,anchorPosition:h},f=this._resources;this.loadStatus===Iu.LOADED&&e.symbolLayerStatePatches.push(()=>{f.symbolSize=Ea(EV(f.resourceSize,{width:a,height:l,depth:c,isPrimitive:this.symbolLayer.isPrimitive}))}),e.graphics3DGraphicPatches.push((g,_)=>{const v=this._computeLocalTransform(f,p,_,kme),b=g.instanceIndex;f.lodRenderer.instanceData.setLocalTransform(b,v,!0)})}_preparePatchColor(e,r){if(!r.material||r.material.type!=="partial")return;const i=r.material.diff;if(!i.color||i.color.type!=="complete"||i.color.newValue==null||i.color.oldValue==null)return;const n=i.color.newValue,s=n!=null?Xe.toUnitRGBA(n):qh;delete i.color;const o=this._resources;o!=null&&e.graphics3DGraphicPatches.push(a=>{let l;this._hasPerInstanceColor()?(o.lodRenderer.instanceData.setColor(a.instanceIndex,s),l=this._setMaterialTransparencyParameters({},n)):l=this._setMaterialTransparencyParameters({externalColor:s},n);for(const c of o.stageResources.materials)c.setParameters(l)})}_requiresTerrainElevation(e){return e.mode!=="absolute-height"}_applyObjectRotation(e,r,i){var n;if(!((n=this._fastUpdates)!=null&&n.requiresShaderTransformation)||!r)return Kht(e.heading,e.tilt,e.roll,i)}_computeAnchor(e,r,i){const n=C();switch(i.anchor){case"center":ce(n,kp(e)),Bo(n,n);break;case"top":{const s=kp(e);ie(n,-s[0],-s[1],-e[5]);break}case"bottom":{const s=kp(e);ie(n,-s[0],-s[1],-e[2]);break}case"relative":{const s=kp(e),o=$D(e),a=i.anchorPosition,l=a?Ce(a.x,a.y,a.z):zn;Jz(n,o,l),fe(n,n,s),Bo(n,n);break}default:r!=null?Bo(n,r):ce(n,zn)}return n}_applyAnchor(e,r,i){var s;if((s=this._fastUpdates)!=null&&s.requiresShaderTransformation)return;const n=this._computeAnchor(e.resourceBoundingBox,e.pivotOffset,r);n&&ic(i,i,n)}_hasPerInstanceColor(){return this._drivenProperties.color||this._drivenProperties.opacity}_fastVisualVariableConvertOptions(e,r,i,n){const s=e!=null?Ea($D(e)):Im,o=e!=null?this._computeAnchor(e,n,this.symbolLayer):zn,a=this._context.renderCoordsHelper.unitInMeters,l=Rde(r??void 0,r,i,a),c=Ce(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return new JI({size:!0,color:!0,rotation:!0,opacity:!1},s,r??Im,a,o,l,c)}};const IT=C(),kme=xe(),DG=xe(),ZN=Zt(),JN=new tL;let Zwt=class{constructor(e,r,i,n){this.vertices=e,this.positionsES=r,this.offset=n;const s=e.length,o=Math.floor(s/2),a=this.offset+3*o,l=i[a],c=i[a+1],u=i[a+2];this.origin=Ce(l,c,u),this.positions=mn(3*s);const h=this.offset+3*s;for(let p=this.offset;p<h;p+=3)this.positions[p]=i[p]-l,this.positions[p+1]=i[p+1]-c,this.positions[p+2]=i[p+2]-u;this.updatePathVertexInformation()}get usedMemory(){return K1(this.positions)}updatePathVertexInformation(){const e=this.vertices.length,r=this.vertices[0];let i=this.offset;const n=this.positions;r.vRight[0]=n[i+3]-n[i],r.vRight[1]=n[i+4]-n[i+1],r.vRight[2]=n[i+5]-n[i+2],i+=3;let s=Te(r.vRight);r.vMinSiblingLength=s,pe(r.vRight,r.vRight);let o=r;for(let a=1;a<e;++a){const l=this.vertices[a];if(l.vLeft=o.vRight,a<e-1){l.vRight[0]=n[i+3]-n[i],l.vRight[1]=n[i+4]-n[i+1],l.vRight[2]=n[i+5]-n[i+2];const c=Te(l.vRight);l.vMinSiblingLength=Math.min(s,c),s=c,pe(l.vRight,l.vRight)}else ce(l.vRight,l.vLeft),l.vMinSiblingLength=s;o=l,i+=3}}},Jwt=class{constructor(e,r,i,n,s,o={}){this.path=e,this.profile=r,this.extruder=i,this.startCap=n,this.endCap=s,this.options=o,this._extrusionVertexCount=0;const a=this.path.vertices.length-2;this.numExtrusionProfiles=i.numProfilesPerJoin()*a+2,this.numVerticesTotal=r.vertices.length*this.numExtrusionProfiles,this.startCap.vertexBufferStart=this.numVerticesTotal;const l=this.startCap.numVertices;this.numVerticesTotal+=l,this.endCap.vertexBufferStart=this.numVerticesTotal;const c=this.endCap.numVertices;this.numVerticesTotal+=c,this.pathVertexData=pst(1*this.numVerticesTotal),this.profileRightAxes=mn(4*this.numVerticesTotal),this.profileUpAxes=mn(4*this.numVerticesTotal),this.profileVertexAndNormals=mn(4*this.numVerticesTotal),this.positions=Y6(e.positions,e.offset,3*e.vertices.length),this._rebuildGeometry(),this.buildTopology()}get usedMemory(){return K1(this.pathVertexData,this.profileRightAxes,this.profileUpAxes,this.profileVertexAndNormals)+this.path.usedMemory+this.profile.usedMemory}emitVertex(e,r,i,n,s){const o=4*this._extrusionVertexCount;if(this.profileRightAxes[o]=r.right[0],this.profileRightAxes[o+1]=r.right[1],this.profileRightAxes[o+2]=r.right[2],this.profileUpAxes[o]=r.up[0],this.profileUpAxes[o+1]=r.up[1],this.profileUpAxes[o+2]=r.up[2],this.profileVertexAndNormals[o]=i[0],this.profileVertexAndNormals[o+1]=i[1],this.profileVertexAndNormals[o+2]=n[0],this.profileVertexAndNormals[o+3]=n[1],this.pathVertexData[this._extrusionVertexCount]=e,s){const a=this.path.vertices[e],l=a.maxStretchDistance;this.profileRightAxes[o+3]=a.rotationRight[0]*l,this.profileUpAxes[o+3]=a.rotationRight[1]*l}else this.profileRightAxes[o+3]=0,this.profileUpAxes[o+3]=0;++this._extrusionVertexCount}emitCapVertex(e,r,i,n,s,o){const a=4*this._extrusionVertexCount;this.profileRightAxes[a]=r.right[0],this.profileRightAxes[a+1]=r.right[1],this.profileRightAxes[a+2]=r.right[2],this.profileRightAxes[a+3]=s,this.profileUpAxes[a]=r.up[0],this.profileUpAxes[a+1]=r.up[1],this.profileUpAxes[a+2]=r.up[2],this.profileUpAxes[a+3]=o,this.profileVertexAndNormals[a]=i[0],this.profileVertexAndNormals[a+1]=i[1],this.profileVertexAndNormals[a+2]=n[0],this.profileVertexAndNormals[a+3]=n[1],this.pathVertexData[this._extrusionVertexCount]=e,++this._extrusionVertexCount}_rebuildGeometry(){this._extrusionVertexCount=0;const{positions:e,offset:r,vertices:i}=this.path;this.positions=Y6(e,r,3*i.length);let n=0;const s=(a,l,c,u,h)=>this.emitCapVertex(n,a,l,c,u,h),o=(a,l,c,u)=>this.emitVertex(n,a,l,c,u);for(this.startCap.rebuildConnectingProfileGeometry(i[n],this.profile,s),n=1;n<i.length-1;++n)this.extruder.extrude(i[n],this.profile,o);this.endCap.rebuildConnectingProfileGeometry(i[n],this.profile,s),n=0,this.startCap.rebuildCapGeometry(i[n],s),n=i.length-1,this.endCap.rebuildCapGeometry(i[n],s)}buildTopology(){const e=this.profile.vertices.length,r=this.profile.numSegments,i=this.numExtrusionProfiles-1;let n=3*(2*(r*i));this.startCap.indexBufferStart=n,this.startCap.firstProfileVertexIndex=0,n+=this.startCap.numIndices,this.endCap.indexBufferStart=n,this.endCap.firstProfileVertexIndex=e*(this.numExtrusionProfiles-1);const s=new Array,o=new Array,a=new Array,l=(c,u,h)=>{s.push(c),s.push(u),s.push(h),o.push(c),o.push(u),o.push(h),a.push(this.pathVertexData[c]),a.push(this.pathVertexData[u]),a.push(this.pathVertexData[h])};for(let c=0;c<r;++c){const u=this.profile.indices[2*c],h=this.profile.indices[2*c+1];for(let p=0;p<i;++p){const f=p*e+u,g=(p+1)*e+h,_=p*e+h;l(f,(p+1)*e+u,g),l(f,g,_)}}this.startCap.buildTopology(this.path.vertices[0],l),this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],l),this.vertexIndices=Xm(s),this.normalIndices=Xm(o),this.pathVertexIndices=Xm(a)}onPathChanged(){this._rebuildGeometry()}},fne=class{rebuildConnectingProfileGeometry(e,r,i){for(let n=0;n<r.vertices.length;++n)i(e.frame,r.vertices[n],r.normals[n],0,0)}},zme=class extends fne{constructor(){super(),this.numVertices=0,this.numIndices=0}rebuildCapGeometry(){}buildTopology(){}},QN=class extends fne{constructor(e,r=0,i=!1){super(),this.profile=e,this.profilePlaneOffset=r,this.flip=i}get numVertices(){return this.profile.vertices.length}get numIndices(){return 3*this.profile.numSegments}rebuildConnectingProfileGeometry(e,r,i){const n=this.profilePlaneOffset;for(let s=0;s<r.vertices.length;++s)i(e.frame,r.vertices[s],r.normals[s],n,0)}rebuildCapGeometry(e,r){const i=this.profile,n=this.flip?1:-1,s=this.profilePlaneOffset,o=LDe;cr(o,0,0);for(let a=0;a<i.vertices.length;++a)r(e.frame,i.vertices[a],o,s,n)}buildTopology(e,r){const i=this.profile,n=this.vertexBufferStart+i.indices[0];for(let s=1;s<i.numSegments;++s){const o=i.indices[2*s],a=i.indices[2*s+1],l=this.vertexBufferStart+o,c=this.vertexBufferStart+a;this.flip?r(c,l,n):r(n,l,c)}}},Ume=class extends fne{constructor(e){super(),this.flip=!1,this.sign=0,this.breakNormals=!1,this.numSegments=3,this.profile=e.profile,this.flip=e.flip,this.sign=this.flip?1:-1,this.breakNormals=e.breakNormals,this.numSegments=e.subdivisions}get numVertices(){let e=this.profile.vertices.length*(this.numSegments-1)+this.profile.poles.length;return this.breakNormals&&(e+=this.profile.vertices.length),e}get numIndices(){let e=0;const r=this.profile;e+=2*r.numSegments*(this.numSegments-1);for(let i=0;i<r.numSegments;++i){const n=r.indices[2*i],s=r.indices[2*i+1];r.poleIndices[n]===r.poleIndices[s]?e+=1:e+=2}return 3*e}rebuildCapGeometry(e,r){const i=this.profile,n=e.frame,s=.5*this.sign,o=Qwt,a=LDe;cr(a,0,0);for(const l of i.poles)l.normal?r(n,l.position,l.normal,s,0):r(n,l.position,a,s,this.sign);if(this.breakNormals)for(let l=0;l<i.vertices.length;++l)r(n,i.vertices[l],i.normals[l],0,0);for(let l=0;l<this.numSegments-1;++l){const c=(1-(l+1)/this.numSegments)*Math.PI*.5,u=Math.sin(c),h=Math.cos(c);for(let p=0;p<i.vertices.length;++p){const f=i.poles[i.poleIndices[p]];Em(o,i.vertices[p],f.position),Uc(o,o,u),f.normal?(vp(o,o,f.position),r(n,o,f.normal,s*h,0)):(L$(a,o),Uc(a,a,u),vp(o,o,f.position),r(n,o,a,s*h,this.sign*h))}}}buildTopology(e,r){const i=this.profile,n=this.breakNormals?this.vertexBufferStart+i.poles.length:this.firstProfileVertexIndex,s=this.breakNormals?this.vertexBufferStart+i.poles.length+i.vertices.length:this.vertexBufferStart+i.poles.length;for(let o=0;o<i.numSegments;++o){const a=i.indices[2*o],l=i.indices[2*o+1],c=this.vertexBufferStart+i.poleIndices[a],u=this.vertexBufferStart+i.poleIndices[l];let h=n+a,p=n+l;for(let f=0;f<this.numSegments-1;++f){const g=s+f*i.vertices.length+a,_=s+f*i.vertices.length+l;this.flip?(r(g,p,h),r(p,g,_)):(r(h,p,g),r(_,g,p)),h=g,p=_}this.flip?(r(c,p,h),c!==u&&r(c,u,p)):(r(h,p,c),c!==u&&r(p,u,c))}}};const Qwt=He(),LDe=He();let Kwt=class{numProfilesPerJoin(){return 1}extrude(e,r,i){for(let n=0;n<r.vertices.length;++n)i(e.frame,r.vertices[n],r.normals[n],!1)}},NG=class{constructor(e,r){this.cutoffAngle=e,this.numBendSubdivisions=r}numProfilesPerJoin(){return this.numBendSubdivisions+1}extrude(e,r,i){const n=txt,{rotationAngle:s,rotationRight:o,frame:a}=e;if(Math.abs(s)>=this.cutoffAngle){const l=e.rotationFrameUp;for(let c=0;c<this.numBendSubdivisions+1;++c){Kc(Vme,.5*-s+c*s/this.numBendSubdivisions,l),ext(n,a,Vme);for(let u=0;u<r.vertices.length;++u)As(r.vertices[u],o)*s>=0?i(n,r.vertices[u],r.normals[u],!1):i(a,e.applyMiterStretch(Bme,r.vertices[u]),r.normals[u],!0)}}else for(let l=0;l<this.numBendSubdivisions+1;++l)for(let c=0;c<r.vertices.length;++c){const u=As(r.vertices[c],o)*s>=0;i(a,e.applyMiterStretch(Bme,r.vertices[c]),r.normals[c],!u)}}},DDe=class{constructor(){this.up=C(),this.right=C()}};function ext(t,e,r){Ge(t.up,e.up,r),Ge(t.right,e.right,r)}const Bme=He(),Vme=xe(),txt=new DDe;let rxt=class extends gs{constructor(e,r,i,n,s,o){super(e,r,null,Cn.Mesh,o),this.path=i,this.geometrySR=n,this.stencilWidth=s}};var Zm;function NDe(t){return"path"in t}(function(t){t[t.World=0]="World",t[t.Path=1]="Path"})(Zm||(Zm={}));let FDe=class{constructor(e){this.builder=e}onPathChanged(e){this.builder.onPathChanged()}},kDe=class extends FDe{constructor(e){super(e),this.vertexAttributeColor=Bt(255,255,255,255),this.size=new Array,this.vertexAttributePosition=mn(3*this.builder.numVerticesTotal),this.vertexAttributeNormal=new Int16Array(2*this.builder.numVerticesTotal)}bakeVertexColors(e){this.vertexAttributeColor[0]=255*e[0],this.vertexAttributeColor[1]=255*e[1],this.vertexAttributeColor[2]=255*e[2],this.vertexAttributeColor[3]=255*(e.length>3?e[3]:1)}bake(e){this.size=e;const{numVerticesTotal:r,pathVertexData:i,path:n,positions:s,profileRightAxes:o,profileUpAxes:a,profileVertexAndNormals:l}=this.builder;for(let c=0;c<r;++c){let u=i[c];const h=u===0||u===n.vertices.length-1;u*=3;const p=axt;let f=0,g=0;const _=4*c,v=ie(lxt,o[_],o[_+1],o[_+2]),b=ie(cxt,a[_],a[_+1],a[_+2]),w=cr(Gme,l[_]*e[0],l[_+1]*e[1]);if(h)Je(p,b,v),f=o[_+3]*e[0],g=a[_+3];else{const A=nxt,O=sxt;cr(A,o[_+3],a[_+3]);const L=Hte(A);L$(A,A);const z=As(w,A);if(Math.abs(z)>L){cr(O,-A[1],A[0]);const k=As(w,O);Uc(A,A,L*Math.sign(z)),Uc(O,O,k),vp(w,A,O)}ie(p,0,0,0)}const x=ie(oxt,v[0]*w[0]+b[0]*w[1],v[1]*w[0]+b[1]*w[1],v[2]*w[0]+b[2]*w[1]),S=3*c;this.vertexAttributePosition[S]=s[u]+x[0]+p[0]*f,this.vertexAttributePosition[S+1]=s[u+1]+x[1]+p[1]*f,this.vertexAttributePosition[S+2]=s[u+2]+x[2]+p[2]*f;const E=cr(Gme,l[_+2],l[_+3]);mf(this.vertexAttributeNormal,c,v[0]*E[0]+b[0]*E[1]+p[0]*g,v[1]*E[0]+b[1]*E[1]+p[1]*g,v[2]*E[0]+b[2]*E[1]+p[2]*g)}}createGeometryData(){const e=this.builder.vertexIndices.length,{normalIndices:r,vertexIndices:i}=this.builder;return[[R.POSITION,new Ye(this.vertexAttributePosition,i,3,!0)],[R.NORMALCOMPRESSED,new Ye(this.vertexAttributeNormal,r,2,!0)],[R.COLOR,new Ye(this.vertexAttributeColor,Uv(e),4)]]}onPathChanged(e){super.onPathChanged(e),this.bake(this.size)}intersect(e,r,i){const n=this.builder.vertexIndices,s=new U3(this.vertexAttributePosition,3),o=n.length/3;QI(e,r,0,o,n,s,void 0,void 0,i)}},ixt=class extends FDe{constructor(e,r,i,n){super(e),this.sizeAttributeValue=r,this.colorAttributeValue=i,this.opacityAttributeValue=n,this.vvData=null,this.baked=new kDe(e),this.vvData=mn(4*this.builder.path.vertices.length);for(let s=0;s<this.builder.path.vertices.length;++s){this.vvData[4*s]=r,this.vvData[4*s+1]=i,this.vvData[4*s+2]=n;const o=s===0||s===this.builder.path.vertices.length-1;this.vvData[4*s+3]=o?1:0}}createGeometryData(){const{positions:e,profileRightAxes:r,profileUpAxes:i,profileVertexAndNormals:n,pathVertexIndices:s,vertexIndices:o}=this.builder;return[[R.POSITION,new Ye(e,s,3,!0)],[R.PROFILERIGHT,new Ye(r,o,4,!0)],[R.PROFILEUP,new Ye(i,o,4,!0)],[R.PROFILEVERTEXANDNORMAL,new Ye(n,o,4,!0)],[R.FEATUREVALUE,new Ye(this.vvData,s,4,!0)]]}onPathChanged(e){super.onPathChanged(e);const r=e.getMutableAttribute(R.POSITION);r&&(r.data=this.builder.positions)}};const Gme=He(),nxt=He(),sxt=He(),oxt=C(),axt=C(),lxt=C(),cxt=C();function uxt(t,e){let r=null;const i=t.vertices.length,n=.99619469809,s=C(),o=C(),a=C(),l=C(),c=C(),u=C(),h=zr();let p=t.vertices[0];ce(o,e),ie(s,0,1,0),J6(p.vRight,o,s,s,a,o,n),ce(p.frame.up,o),ce(p.frame.right,a);const f=t.positions;let g=t.offset;r=p;for(let _=1;_<i;++_){p=t.vertices[_],fe(c,p.vLeft,p.vRight);let v=Te(c);v>0?(v=1/Math.sqrt(v),c[0]=c[0]*v,c[1]=c[1]*v,c[2]=c[2]*v):(c[0]=p.vRight[0],c[1]=p.vRight[1],c[2]=p.vRight[2]),u[0]=f[g]+r.frame.up[0],u[1]=f[g+1]+r.frame.up[1],u[2]=f[g+2]+r.frame.up[2],g+=3;const b=ie(hxt,f[g],f[g+1],f[g+2]);FI(b,c,h),R2(h,eh(u,p.vLeft),l)?(l[0]-=f[g],l[1]-=f[g+1],l[2]-=f[g+2],pe(o,l),Je(a,c,o),pe(a,a)):J6(c,r.frame.up,r.frame.right,s,a,o,n),ce(p.frame.up,o),ce(p.frame.right,a),r=p}}const hxt=C();let zDe=class{constructor(){this.vertices=new Array,this.normals=new Array,this.indices=new Array,this.poles=new Array,this.poleIndices=new Array}addVertex(e,r){return this.vertices.push(UA(e)),this.normals.push(UA(r)),this.vertices.length-1}addPole(e,r=null){return this.poles.push({position:UA(e),normal:r?UA(r):null}),this.poles.length-1}addSegment(e,r=null){this.indices.push(e.v0),this.indices.push(e.v1),r&&(this.poleIndices.push(r.v0),this.poleIndices.push(r.v1))}get numSegments(){return this.indices.length/2}translate(e,r){for(const i of this.vertices)i[0]+=e,i[1]+=r;for(const i of this.poles)i.position[0]+=e,i.position[1]+=r}get usedMemory(){return this.vertices.length*K1(this.vertices[0])*2+K1(this.indices)}};const UDe={top:[0,-.5],bottom:[0,.5]};function FG(t){const r=fRe,i=new zDe,n={v0:0,v1:0};i.addPole(lr(0,0));for(let o=0;o<r;++o){const a=2*o*Math.PI/r,l=Math.cos(a),c=Math.sin(a),u=lr(l*.5,c*.5),h=lr(l,c);i.addVertex(u,h)}for(let o=0;o<r-1;++o){const a={v0:o,v1:o+1};i.addSegment(a,n)}const s={v0:r-1,v1:0};if(i.addSegment(s,n),t!=="center"){const o=UDe[t];i.translate(o[0],o[1])}return i}const dxt={center:FG("center"),top:FG("top"),bottom:FG("bottom")},pxt={center:kG("center"),top:kG("top"),bottom:kG("bottom")};function kG(t){const i=new zDe,n=lr(.5*-1,.5*-1),s=lr(.5*1,.5*-1),o=lr(.5*1,.5*1),a=lr(.5*-1,.5*1),l=lr(0,-1),c=lr(1,0),u=lr(0,1),h=lr(-1,0);if(i.addPole(lr(0,.5*1),u),i.addPole(lr(0,.5*1)),i.addPole(lr(0,.5*-1)),i.addPole(lr(0,.5*-1),l),i.addVertex(n,l),i.addVertex(s,l),i.addSegment({v0:0,v1:1},{v0:3,v1:3}),i.addVertex(s,c),i.addVertex(o,c),i.addSegment({v0:2,v1:3},{v0:2,v1:1}),i.addVertex(o,u),i.addVertex(a,u),i.addSegment({v0:4,v1:5},{v0:0,v1:0}),i.addVertex(a,h),i.addVertex(n,h),i.addSegment({v0:6,v1:7},{v0:1,v1:2}),t!=="center"){const p=UDe[t];i.translate(p[0],p[1])}return i}function fxt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function mxt(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t}function BDe(t,e,r,i,n){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t}function gxt(t,e){if(t===e){const r=e[1];t[1]=e[2],t[2]=r}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t}function yxt(t,e){const r=e[0],i=e[1],n=e[2],s=e[3];let o=r*s-n*i;return o?(o=1/o,t[0]=s*o,t[1]=-i*o,t[2]=-n*o,t[3]=r*o,t):null}function _xt(t,e){const r=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=r,t}function vxt(t){return t[0]*t[3]-t[2]*t[1]}function VDe(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=r[0],l=r[1],c=r[2],u=r[3];return t[0]=i*a+s*l,t[1]=n*a+o*l,t[2]=i*c+s*u,t[3]=n*c+o*u,t}function bxt(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=Math.sin(r),l=Math.cos(r);return t[0]=i*l+s*a,t[1]=n*l+o*a,t[2]=i*-a+s*l,t[3]=n*-a+o*l,t}function wxt(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=r[0],l=r[1];return t[0]=i*a,t[1]=n*a,t[2]=s*l,t[3]=o*l,t}function xxt(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=-r,t[3]=i,t}function Txt(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t}function Sxt(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function Cxt(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2)}function Ext(t,e,r,i){return t[2]=i[2]/i[0],r[0]=i[0],r[1]=i[1],r[3]=i[3]-t[2]*r[1],[t,e,r]}function Pxt(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function GDe(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function Axt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function Mxt(t,e){const r=t[0],i=t[1],n=t[2],s=t[3],o=e[0],a=e[1],l=e[2],c=e[3],u=Va();return Math.abs(r-o)<=u*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-a)<=u*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(n-l)<=u*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(s-c)<=u*Math.max(1,Math.abs(s),Math.abs(c))}function Oxt(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function Rxt(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t}const $xt=VDe,Ixt=GDe;Object.freeze(Object.defineProperty({__proto__:null,LDU:Ext,add:Pxt,adjoint:_xt,copy:fxt,determinant:vxt,equals:Mxt,exactEquals:Axt,frob:Cxt,fromRotation:xxt,fromScaling:Txt,identity:mxt,invert:yxt,mul:$xt,multiply:VDe,multiplyScalar:Oxt,multiplyScalarAndAdd:Rxt,rotate:bxt,scale:wxt,set:BDe,str:Sxt,sub:Ixt,subtract:GDe,transpose:gxt},Symbol.toStringTag,{value:"Module"}));function jDe(){return[1,0,0,1]}function Lxt(t){return[t[0],t[1],t[2],t[3]]}function Dxt(t,e,r,i){return[t,e,r,i]}function Nxt(t,e){return new Float64Array(t,e,4)}Object.freeze(Object.defineProperty({__proto__:null,clone:Lxt,create:jDe,createView:Nxt,fromValues:Dxt},Symbol.toStringTag,{value:"Module"}));let HDe=class{constructor(){this.vLeft=C(),this.vRight=C(),this.vMinSiblingLength=0,this.frame=new DDe}setFrameFromUpVector(e){ce(this.frame.up,e),fe(hA,this.vLeft,this.vRight),pe(hA,hA),ne(Wme,this.frame.up,de(hA,this.frame.up)),ye(KN,hA,Wme),pe(KN,KN),Je(this.frame.right,KN,this.frame.up)}get foldingAngle(){return Math.PI-this.rotationAngle}},Fxt=class extends HDe{get rotationFrameUp(){return this.frame.up}get rotationRight(){return uSe}get rotationAngle(){return ne(a_,this.frame.up,de(this.frame.up,this.vLeft)),ye(a_,this.vLeft,a_),Bo(a_,a_),pe(a_,a_),ne(DT,this.frame.up,de(this.frame.up,this.vRight)),ye(DT,this.vRight,DT),pe(DT,DT),Je(z8,this.rotationFrameUp,this.vLeft),Math.sign(de(z8,this.vRight))*(Math.PI-Ks(de(a_,DT)))}get maxStretchDistance(){return Math.abs(this.vMinSiblingLength/Math.cos(.5*this.foldingAngle))}applyMiterStretch(e,r){const i=this.rotationAngle;if(Math.abs(i)<=0)return r;const n=RW(Math.cos(.5*i));return cr(e,(n-1+1)*r[0],r[1])}},kxt=class extends HDe{get rotationFrameUp(){const e=Math.sign(de(this.frame.right,this.vRight));return Je(uA,this.vRight,this.vLeft),ne(uA,uA,e),pe(uA,uA)}get rotationRight(){const e=this.rotationFrameUp,r=de(e,this.frame.up),i=de(e,this.frame.right);return ne(LT,this.frame.up,-i),ne(Hme,this.frame.right,r),fe(LT,LT,Hme),pe(LT,LT),zxt(jme,this.frame,LT),jme}get rotationAngle(){const e=Math.sign(de(this.frame.right,this.vRight));return Bo(z8,this.vLeft),-e*(Math.PI-Ks(de(z8,this.vRight)))}get maxStretchDistance(){return Math.abs(this.vMinSiblingLength*RW(Math.cos(.5*this.foldingAngle)))}applyMiterStretch(e,r){const i=this.rotationAngle;if(Math.abs(i)===0)return r;const n=RW(Math.cos(.5*i)),s=this.rotationRight,o=BDe(Bxt,1+(n-1)*s[0]*s[0],(n-1)*s[0]*s[1],(n-1)*s[0]*s[1],1+(n-1)*s[1]*s[1]);return yPe(e,r,o)}};function zxt(t,e,r){cr(t,de(r,e.right),de(r,e.up))}function Uxt(t){switch(t){case Zm.World:return new Fxt;case Zm.Path:return new kxt}}const uA=C(),jme=He(),LT=C(),Hme=C(),z8=C(),a_=C(),DT=C(),Wme=C(),hA=C(),KN=C(),Bxt=jDe(),zG=8;function Vxt(t,e){const r=R.FEATUREVALUE;t.attributes.add(r,"vec4");const i=t.vertex;i.code.add(T`
  bool isCapVertex() {
    return ${r}.w == 1.0;
  }
  `),i.uniforms.add(new ti("size",n=>n.size)),e.vvSize?(i.uniforms.add(new Ft("vvSizeMinSize",n=>n.vvSize.minSize),new Ft("vvSizeMaxSize",n=>n.vvSize.maxSize),new Ft("vvSizeOffset",n=>n.vvSize.offset),new Ft("vvSizeFactor",n=>n.vvSize.factor)),i.code.add(T`
    vec2 getSize() {
      return size * clamp(vvSizeOffset + ${r}.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;
    }
    `)):i.code.add(T`vec2 getSize(){
return size;
}`),e.vvOpacity?(i.constants.add("vvOpacityNumber","int",zG),i.uniforms.add(new Zl("vvOpacityValues",n=>n.vvOpacity.values,zG),new Zl("vvOpacityOpacities",n=>n.vvOpacity.opacityValues,zG)),i.code.add(T`
    vec4 applyOpacity(vec4 color) {
      float value = ${r}.z;
      if (value <= vvOpacityValues[0]) {
        return vec4( color.xyz, vvOpacityOpacities[0]);
      }

      for (int i = 1; i < vvOpacityNumber; ++i) {
        if (vvOpacityValues[i] >= value) {
          float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
          return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));
        }
      }

      return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);
    }
    `)):i.code.add(T`vec4 applyOpacity(vec4 color){
return color;
}`),e.vvColor?(i.constants.add("vvColorNumber","int",aE),i.uniforms.add(new Zl("vvColorValues",n=>n.vvColor.values,aE),new GOe("vvColorColors",n=>n.vvColor.colors,aE)),i.code.add(T`
    vec4 getColor() {
      float value = ${r}.y;
      if (value <= vvColorValues[0]) {
        return applyOpacity(vvColorColors[0]);
      }

      for (int i = 1; i < vvColorNumber; ++i) {
        if (vvColorValues[i] >= value) {
          float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
          return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));
        }
      }

      return applyOpacity(vvColorColors[vvColorNumber - 1]);
    }
    `)):i.code.add(T`vec4 getColor(){
return applyOpacity(vec4(1, 1, 1, 1));
}`),t.include(HI),t.attributes.add(R.PROFILERIGHT,"vec4"),t.attributes.add(R.PROFILEUP,"vec4"),t.attributes.add(R.PROFILEVERTEXANDNORMAL,"vec4"),i.code.add(T`vec3 calculateVPos() {
vec2 size = getSize();
vec3 origin = position;
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileVertex = profileVertexAndNormal.xy * size;
vec2 profileNormal = profileVertexAndNormal.zw;
float positionOffsetAlongProfilePlaneNormal = 0.0;
float normalOffsetAlongProfilePlaneNormal = 0.0;`),i.code.add(T`if(!isCapVertex()) {
vec2 rotationRight = vec2(profileRight.w, profileUp.w);
float maxDistance = length(rotationRight);`),i.code.add(T`rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);
float rx = dot(profileVertex, rotationRight);
if (abs(rx) > maxDistance) {
vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);
float ry = dot(profileVertex, rotationUp);
profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;
}
}else{
positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];
normalOffsetAlongProfilePlaneNormal = profileUp.w;
}
vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;
return origin + offset;
}`),i.code.add(T`vec3 localNormal() {
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileNormal = profileVertexAndNormal.zw;
vec3 normal = right * profileNormal.x + up * profileNormal.y;
if(isCapVertex()) {
normal += forward * profileUp.w;
}
return normal;
}`)}let Gxt=class extends KI{constructor(){super(...arguments),this.size=lr(1,1)}};function tI(t,e){e.spherical?t.vertex.code.add(T`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):t.vertex.code.add(T`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`),e.spherical?t.vertex.code.add(T`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):t.vertex.code.add(T`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)}function WDe(t){const e=new Or,{vertex:r,fragment:i}=e;switch(Zc(r,t),e.varyings.add("vpos","vec3"),e.include(Vxt,t),t.output!==U.Color&&t.output!==U.Alpha||(e.include(Kl,t),e.include(f3,t),e.include(X3,t),e.varyings.add("vnormal","vec3"),e.varyings.add("vcolor","vec4"),t.multipassEnabled&&e.varyings.add("depth","float"),r.code.add(T`
      void main() {
        vpos = calculateVPos();
        vnormal = normalize(localNormal());

        ${t.multipassEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}
        gl_Position = transformPosition(proj, view, vpos);

        ${t.output===U.Color?"forwardLinearDepth();":""}

        vcolor = getColor();
      }
    `)),e.include(iu,t),t.output){case U.Alpha:e.include(Fn,t),i.uniforms.add(new $e("opacity",n=>n.opacity)),i.code.add(T`
      void main() {
        discardBySlice(vpos);
        ${t.multipassEnabled?"terrainDepthTest(depth);":""}
        float combinedOpacity = vcolor.a * opacity;
        fragColor = vec4(combinedOpacity);
      }
    `);break;case U.Color:e.include(Fn,t),e.include(y2,t),e.include(iL,t),e.include(f3,t),e.include(wRe,t),cf(i,t),nL(i),tP(i),i.uniforms.add(r.uniforms.get("localOrigin"),new Ft("ambient",n=>n.ambient),new Ft("diffuse",n=>n.diffuse),new Ft("specular",n=>n.specular),new $e("opacity",n=>n.opacity)),i.include(xg),_g(i),i.code.add(T`
        void main() {
          discardBySlice(vpos);
          ${t.multipassEnabled?"terrainDepthTest(depth);":""}

          shadingParams.viewDirection = normalize(vpos - cameraPosition);
          shadingParams.normalView = vnormal;
          vec3 normal = shadingNormal(shadingParams);
          float ssao = evaluateAmbientOcclusionInverse();

          float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
          ${t.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":t.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
          vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one
          float combinedOpacity = vcolor.a * opacity;
          albedo += 0.25 * specular; // don't completely ignore specular for now

          vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);
          fragColor = vec4(shadedColor, combinedOpacity);
          fragColor = highlightSlice(fragColor, vpos);
          ${t.transparencyPassType===ft.Color?"fragColor = premultiplyAlpha(fragColor);":""}
        }
      `);break;case U.LinearDepth:case U.Shadow:case U.ShadowHighlight:case U.ShadowExcludeHighlight:e.include(Kl,t),f2(e),e.varyings.add("depth","float"),r.code.add(T`void main() {
vpos = calculateVPos();
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
}`),e.include(Fn,t),e.include(ly,t),i.code.add(T`void main() {
discardBySlice(vpos);
outputDepth(depth);
}`);break;case U.Normal:e.include(Kl,t),e.include(tI,t),o3(r),e.varyings.add("vnormal","vec3"),r.code.add(T`void main(void) {
vpos = calculateVPos();
vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);
gl_Position = transformPosition(proj, view, vpos);
}`),e.include(Fn,t),i.code.add(T`void main() {
discardBySlice(vpos);
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) normal = -normal;
fragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
}`);break;case U.Highlight:e.include(Kl,t),e.include(tI,t),e.varyings.add("vnormal","vec3"),r.code.add(T`void main(void) {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),e.include(Fn,t),e.include(Vv,t),i.code.add(T`void main() {
discardBySlice(vpos);
outputHighlight();
}`)}return e}const jxt=Object.freeze(Object.defineProperty({__proto__:null,build:WDe},Symbol.toStringTag,{value:"Module"})),qDe=new Map([[R.POSITION,0],[R.PROFILERIGHT,1],[R.PROFILEUP,2],[R.PROFILEVERTEXANDNORMAL,3],[R.FEATUREVALUE,4]]);let Hxt=class extends Gxt{constructor(){super(...arguments),this.ambient=Ce(.2,.2,.2),this.diffuse=Ce(.8,.8,.8),this.specular=Ce(0,0,0),this.opacity=1,this.origin=C(),this.modelTransformation=null}},YDe=class XDe extends Vr{initializeConfiguration(e,r){r.spherical=e.viewingMode===De.Global,r.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new Lr(e.rctx,XDe.shader.get().build(this.configuration),qDe)}initializePipeline(){const e=this.configuration.transparencyPassType,r=this.configuration,i=e===ft.NONE,n=e===ft.FrontFace;return kt({blending:r.output!==U.Color&&r.output!==U.Alpha||!r.transparent?null:i?Zu:Cy(e),culling:r.hasSlicePlane&&!r.transparent&&r.doubleSidedMode!==gn.None?PPe:null,depthTest:{func:Gv(e)},depthWrite:i||n?ru:null,colorWrite:Yt,stencilWrite:r.hasOccludees?pg:null,stencilTest:r.hasOccludees?jv:null,polygonOffset:i||n?null:AU})}};YDe.shader=new Ir(jxt,()=>ge(()=>Promise.resolve().then(()=>KNt),void 0));let Ts=class extends vl{constructor(){super(...arguments),this.output=U.Color,this.doubleSidedMode=gn.None,this.transparencyPassType=ft.NONE,this.spherical=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.doublePrecisionRequiresObfuscation=!1}};d([j({count:U.COUNT})],Ts.prototype,"output",void 0),d([j({count:gn.COUNT})],Ts.prototype,"doubleSidedMode",void 0),d([j({count:ft.COUNT})],Ts.prototype,"transparencyPassType",void 0),d([j()],Ts.prototype,"spherical",void 0),d([j()],Ts.prototype,"receiveShadows",void 0),d([j()],Ts.prototype,"receiveAmbientOcclusion",void 0),d([j()],Ts.prototype,"vvSize",void 0),d([j()],Ts.prototype,"vvColor",void 0),d([j()],Ts.prototype,"vvOpacity",void 0),d([j()],Ts.prototype,"hasSlicePlane",void 0),d([j()],Ts.prototype,"transparent",void 0),d([j()],Ts.prototype,"hasOccludees",void 0),d([j()],Ts.prototype,"multipassEnabled",void 0),d([j()],Ts.prototype,"cullAboveGround",void 0),d([j()],Ts.prototype,"doublePrecisionRequiresObfuscation",void 0),d([j({constValue:!1})],Ts.prototype,"occlusionPass",void 0),d([j({constValue:ot.Disabled})],Ts.prototype,"pbrMode",void 0),d([j({constValue:!0})],Ts.prototype,"hasVvInstancing",void 0),d([j({constValue:!1})],Ts.prototype,"useCustomDTRExponentForWater",void 0),d([j({constValue:!1})],Ts.prototype,"useFillLights",void 0),d([j({constValue:!1})],Ts.prototype,"hasColorTexture",void 0);let Wxt=class ZDe extends Bv{constructor(e){super(e,new Yxt),this.supportsEdges=!0,this.produces=new Map([[ue.OPAQUE_MATERIAL,r=>(this.parameters.castShadows&&KC(r)||oR(r))&&!this.parameters.transparent],[ue.TRANSPARENT_MATERIAL,r=>(this.parameters.castShadows&&KC(r)||oR(r))&&this.parameters.transparent]]),this._vertexAttributeLocations=qDe,this._configuration=new Ts,this._vertexBufferLayout=ZDe.getVertexBufferLayout()}getConfiguration(e,r){return this._configuration.output=e,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasOccludees=this.parameters.hasOccludees,e!==U.Color&&e!==U.Alpha||(this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?gn.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?gn.WindingOrder:gn.None,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.receiveAmbientOcclusion=r.ssao!=null),this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.multipassEnabled=r.multipassEnabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}isVisibleForOutput(e){return e!==U.Shadow&&e!==U.ShadowExcludeHighlight&&e!==U.ShadowHighlight||this.parameters.castShadows}isVisible(){return super.isVisible()&&this.parameters.opacity>0}intersect(e,r,i,n,s,o){const a=e;if(!NDe(a))return;const l=a.path,c=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSize){const{offset:v,factor:b,minSize:w,maxSize:x}=this.parameters.vvSize,S=l.sizeAttributeValue;c[0]*=we(v[0]+S*b[0],w[0],x[0]),c[1]*=we(v[2]+S*b[2],w[2],x[2])}const u=Math.max(c[0],c[1]),h=e.boundingInfo;if(h==null)return void this._intersectTriangles(l,c,n,s,o);const p=u2(h.bbMin[0]-u,h.bbMin[1]-u,h.bbMin[2]-u,h.bbMax[0]+u,h.bbMax[1]+u,h.bbMax[2]+u),f=[s[0]-n[0],s[1]-n[1],s[2]-n[2]],g=Math.sqrt(f[0]*f[0]+f[1]*f[1]+f[2]*f[2]),_=[g/f[0],g/f[1],g/f[2]];Yre(p,n,_,i.tolerance)&&this._intersectTriangles(l,c,n,s,o)}_intersectTriangles(e,r,i,n,s){e.baked.size&&e.baked.size[0]===r[0]&&e.baked.size[1]===r[1]||e.baked.bake(r),e.baked.intersect(i,n,s)}createBufferWriter(){return new eP(this._vertexBufferLayout)}createGLMaterial(e){return new qxt(e)}static getVertexBufferLayout(){return Qi().vec3f(R.POSITION).vec4f(R.PROFILERIGHT).vec4f(R.PROFILEUP).vec4f(R.PROFILEVERTEXANDNORMAL).vec4f(R.FEATUREVALUE)}},qxt=class extends zv{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}_updateShadowState(e){this.technique!=null&&e.shadowMap.enabled===this.technique.configuration.receiveShadows||this._material.setParameters({receiveShadows:e.shadowMap.enabled})}beginSlot(e){return this._output!==U.Color&&this._output!==U.Alpha||(this._updateShadowState(e),this._updateOccludeeState(e)),this.ensureTechnique(YDe,e)}},Yxt=class extends Hxt{constructor(){super(...arguments),this.doubleSided=!1,this.doubleSidedType="normal",this.receiveShadows=!1,this.castShadows=!0,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1}};const Xxt=["polyline"];let Zxt=class extends Sg{constructor(e,r,i,n){super(e,r,i,n),this._intrinsicSize=lr(1,1),this._upVectorAlignment=Zm.Path,this._stencilWidth=.1,this.usedMemory=0,this.ensureDrapedStatus(!1)}async doLoad(){var p,f,g,_,v;const e=this.symbolLayer.width!=null?this.symbolLayer.width:this.symbolLayer.height,r=this.symbolLayer.height!=null?this.symbolLayer.height:e;this._vvConvertOptions=new JI({size:!0,color:!0,rotation:!1,opacity:!0},[1,1,1],[e,1,r],this._context.renderCoordsHelper.unitInMeters),this._fastUpdates=((f=(p=this._context.renderer)==null?void 0:p.visualVariables)==null?void 0:f.length)>0?u3(this._context.renderer,this._vvConvertOptions):null;const i=this.symbolLayer.anchor||"center";this._upVectorAlignment=this.symbolLayer.profileRotation==="heading"?Zm.World:Zm.Path;const n=this.symbolLayer.profile||"circle";switch(n){default:case"circle":this._profile=dxt[i];break;case"quad":this._profile=pxt[i]}switch(this.symbolLayer.join){case"round":this._extruder=new NG(0,pRe);break;case"bevel":this._extruder=new NG(0,1);break;case"miter":this._extruder=new NG(.8*Math.PI,1);break;default:this._extruder=new Kwt}const s=this.symbolLayer.cap||"butt";switch(s){case"none":this._startCap=new zme,this._endCap=new zme;break;case"butt":default:this._startCap=new QN(this._profile,0),this._endCap=new QN(this._profile,0,!0);break;case"square":this._startCap=new QN(this._profile,-.5),this._endCap=new QN(this._profile,.5,!0);break;case"round":{const b=n==="quad";this._startCap=new Ume({profile:this._profile,flip:!1,breakNormals:b,subdivisions:$Z}),this._endCap=new Ume({profile:this._profile,flip:!0,breakNormals:b,subdivisions:$Z});break}}const o=(_=(g=this.symbolLayer)==null?void 0:g.material)==null?void 0:_.color,a=this._getCombinedOpacityAndColor(o),l=Ea(a),c=a[3],u=c<1||this.needsDrivenTransparentPass,h={diffuse:l,ambient:l,opacity:c,transparent:u,hasVertexColors:!1,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,cullFace:u||s==="none"?Pi.None:Pi.Back,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&(cr(this._intrinsicSize,e,r),!RZ(this._intrinsicSize[0])||!RZ(this._intrinsicSize[1])))throw new K("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");if((v=this._fastUpdates)!=null&&v.visualVariables.size||Uc(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters),this._fastUpdates){const b={...h,...this._fastUpdates.materialParameters,size:sSe(this._intrinsicSize)};this._materials[0]=new Wxt(b)}else h.hasVertexColors=this._drivenProperties.color||this._drivenProperties.opacity,h.normalType=$r.Compressed,this._materials[0]=new hf(h);this._materials[0].setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._context.stage.add(this._materials[0])}destroy(){super.destroy(),this._context.stage.remove(this._materials[0]),this._materials[0]=null,this._materials.length=0}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,Xxt,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(r),n=e.renderingInfo;return this._createAs3DShape(r,n,i,r.uid)}layerOpacityChanged(){var n,s,o;const e=(s=(n=this.symbolLayer)==null?void 0:n.material)==null?void 0:s.color,r=this._getCombinedOpacity(e),i=r<1||this.needsDrivenTransparentPass;(o=this._materials[0])==null||o.setParameters({opacity:r,transparent:i})}layerElevationInfoChanged(e,r){return this.updateGraphics3DGraphicElevationInfo(e,r,Sv)}slicePlaneEnabledChanged(){var e;return(e=this._materials[0])==null||e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){var e;return(e=this._materials[0])==null||e.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}applyRendererDiff(e,r){var i;for(const n in e.diff){if(n!=="visualVariables"||!h3(this._fastUpdates,r,this._vvConvertOptions))return Xn.RecreateSymbol;(i=this._materials[0])==null||i.setParameters(this._fastUpdates.materialParameters)}return Xn.FastUpdate}_getVertexData(e){let r=0;const i=e.paths,n=[],s=e.spatialReference,o=this._context.elevationProvider.spatialReference,a=this._context.renderCoordsHelper.spatialReference;for(const h of i)r+=h.length;const l=xo(3*r);let c,u=0;for(const h of i){n.push({offset:u,numVertices:h.length});for(const p of h)l[u++]=p[0],l[u++]=p[1],l[u++]=e.hasZ?p[2]:0}return o==null||s.equals(o)||Ji(l,s,0,l,o,0,r)?(o==null||o.equals(a)?c=KAe(l):(c=xo(3*r),Ji(l,o,0,c,a,0,r)),{pathVertexDataInfos:n,vertexDataES:l,vertexDataRS:c}):null}_createAs3DShape(e,r,i,n){var g,_,v;this.usedMemory=0;const s=e.geometry,o=this._getVertexData(s);if(o==null)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),null;if(o.pathVertexDataInfos.length===0)return s.paths.length!==0&&s.paths.some(b=>b.length>0)||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)"),null;const a=new Array,l=s.spatialReference,c=vs(),u=this._context.renderCoordsHelper,h=new yte(o.vertexDataES);for(const b of o.pathVertexDataInfos){const w=b.numVertices;if(w<2)continue;const x=b.offset;if(this._context.clippingExtent!=null&&(Li(c),Hc(c,o.vertexDataES,x,w),!zp(c,this._context.clippingExtent)))continue;const S=new Array,E=x+3*w;for(let B=x;B<E;B+=3){h.offset=B;const J=Mht(h,this._context.elevationProvider,i,u);ie(In,o.vertexDataRS[B],o.vertexDataRS[B+1],o.vertexDataRS[B+2]),u.setAltitude(In,J),o.vertexDataRS[B]=In[0],o.vertexDataRS[B+1]=In[1],o.vertexDataRS[B+2]=In[2],S.push(Uxt(this._upVectorAlignment))}const A=new Zwt(S,o.vertexDataES,o.vertexDataRS,x);JDe(A,this._upVectorAlignment,this._context.renderCoordsHelper);const O=new Jwt(A,this._profile,this._extruder,this._startCap,this._endCap);let L=null;if(this._fastUpdates){const B=this._fastUpdates.visualVariables,J=Qp((g=B.size)==null?void 0:g.field,e)??0,W=Qp((_=B.color)==null?void 0:_.field,e)??0,Y=Qp((v=B.opacity)==null?void 0:v.field,e)??0;L=new ixt(O,J,W,Y)}else{const B=[this._intrinsicSize[0],this._intrinsicSize[1]];if(this._drivenProperties.size){const Y=r.size;B[0]*=qme(Y[0],Y[2]==="symbol-value"?this.symbolLayer.height||0:Y[2],this.symbolLayer.width||0),B[1]*=qme(Y[2],Y[0]==="symbol-value"?this.symbolLayer.width||0:Y[0],this.symbolLayer.height||0)}let J;this._drivenProperties.color&&(J=r.color),this._drivenProperties.opacity&&r.opacity!=null&&(J=J?[J[0],J[1],J[2],r.opacity]:[1,1,1,r.opacity]);const W=new kDe(O);W.bake(B),J&&W.bakeVertexColors(J),L=W}const z=L.createGeometryData(),k=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:n,layerUid:this._context.layer.uid}),q=new rxt(this._materials[0],z,L,l,this._stencilWidth,k);q.transformation=ic(xe(),sn,O.path.origin),a.push(q),this.usedMemory+=O.usedMemory}if(a.length===0)return null;const p=new Ey({geometries:a,layerUid:this._context.layer.uid,graphicUid:n}),f=new Tg(this,p,a,null,null,(b,w,x,S,E)=>Qxt(b,w,S,E,this._upVectorAlignment),i);return f.alignedSampledElevation=0,f.needsElevationUpdates=Sv(i.mode),f}};function JDe(t,e,r){const{origin:i,positions:n}=t;let s=t.offset;switch(e){default:case Zm.World:for(const o of t.vertices)In[0]=n[s++]+i[0],In[1]=n[s++]+i[1],In[2]=n[s++]+i[2],r.worldUpAtPosition(In,In),o.setFrameFromUpVector(In);break;case Zm.Path:In[0]=n[s]+i[0],In[1]=n[s+1]+i[1],In[2]=n[s+2]+i[2],r.worldUpAtPosition(In,In),uxt(t,In)}}function qme(t,e,r){switch(t){case"symbol-value":return r;case"proportional":return e;default:return t}}function Jxt(t,e,r,i){let n=0;const{origin:s,vertices:o,positions:a,positionsES:l}=t,c=t.offset+3*o.length;for(let u=t.offset;u<c;u+=3)ie(In,l[u],l[u+1],l[u+2]),r(In,UG),n+=UG.sampledElevation,In[0]=a[u]+s[0],In[1]=a[u+1]+s[1],In[2]=a[u+2]+s[2],i.setAltitude(In,UG.z),a[u]=In[0]-s[0],a[u+1]=In[1]-s[1],a[u+2]=In[2]-s[2];return t.updatePathVertexInformation(),n/o.length}function Qxt(t,e,r,i,n){const s=t.stageObject,o=s.geometries;let a=0;for(const l of o){if(!NDe(l))continue;const c=l.path,u=c.builder.path;a+=Jxt(u,e,r,i),n!==Zm.World&&JDe(u,n,i),c.onPathChanged(l),l.invalidateBoundingInfo(),s.geometryVertexAttributeUpdated(l,R.POSITION)}return a/o.length}const In=C(),UG=new tL;function Kxt(t,e,r,i,n=1){if(r.isGeographic&&i===De.Global){const c=xo(e.length),u=e.length,h=Br(r);for(let p=0;p<u;p+=3)Dee(e,p,c,p,h);e=c}cr(Os,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(let c=0;c<e.length;c+=3)Os[0]=Math.min(Os[0],e[c]),Os[1]=Math.min(Os[1],e[c+1]);const s=Os[0]%n,o=Os[1]%n,a=Os[0]-s,l=Os[1]-o;for(let c=0;c<e.length;c+=3){const u=c/3*4;t[u]=(e[c]-a)/n,t[u+1]=(e[c+1]-l)/n,t[u+2]=a/n,t[u+3]=l/n}}function QDe(t,e,r,i,n=1){ie(Tb,1,0,0),ie(Sb,0,1,0),ie(FT,0,0,1),t2t(BG,r),tYe(Yme,r)&&e2t(Yme,Tb,Sb,FT,i,BG),cr(Os,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),cr(Cb,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let u=0;u<r.length;u+=3){ie(NT,r[u],r[u+1],r[u+2]);const h=de(Tb,NT),p=de(Sb,NT);Os[0]=Math.min(Os[0],h),Os[1]=Math.min(Os[1],p),Cb[0]=Math.max(Cb[0],h),Cb[1]=Math.max(Cb[1],p)}const s=de(FT,BG);GG(l_,Os[0],Os[1],s,Tb,Sb,FT),GG(Eb,Cb[0],Os[1],s,Tb,Sb,FT),GG(Pb,Os[0],Cb[1],s,Tb,Sb,FT),ye(Eb,Eb,l_),ne(Eb,Eb,.5),ye(Pb,Pb,l_),ne(Pb,Pb,.5),fe(l_,l_,Eb),fe(l_,l_,Pb);const o=Os[0]%n,a=Os[1]%n,l=Os[0]-o,c=Os[1]-a;for(let u=0;u<r.length;u+=3){ie(NT,r[u],r[u+1],r[u+2]);const h=u/3,p=4*h;t[p]=(de(Tb,NT)-l)/n,t[p+1]=(de(Sb,NT)-c)/n,t[p+2]=l/n,t[p+3]=c/n;const f=9*h;for(let g=0;g<3;g++)e[f+g]=l_[g],e[f+g+3]=Eb[g],e[f+g+6]=Pb[g]}}const BG=C(),NT=C(),Yme=zr(),Tb=C(),Sb=C(),FT=C(),Os=He(),Cb=He(),l_=C(),Eb=C(),Pb=C();function e2t(t,e,r,i,n,s){n!=null?(n.basisMatrixAtPosition(s,Bf),ie(e4,Bf[0],Bf[1],Bf[2]),ie(t4,Bf[4],Bf[5],Bf[6]),ie(VG,Bf[8],Bf[9],Bf[10])):(ie(e4,1,0,0),ie(t4,0,1,0),ie(VG,0,0,1));const o=t;de(o,VG)<0&&ne(o,o,-1),ce(i,o);const a=de(o,t4),l=de(o,e4);Math.abs(a)>Math.abs(l)?(Xs(e,e4,o,-l),pe(e,e),Je(r,e,o),pe(r,r),ne(r,r,-1)):(Xs(r,t4,o,-a),pe(r,r),Je(e,r,o),pe(e,e))}const Bf=xe(),e4=C(),t4=C(),VG=C();function t2t(t,e){ie(dA,0,0,0);for(let r=0;r<e.length-3;r+=3)dA[0]+=e[r],dA[1]+=e[r+1],dA[2]+=e[r+2];ne(t,dA,1/(e.length/3-1))}const dA=C();function GG(t,e,r,i,n,s,o){ie(t,e*n[0]+r*s[0]+i*o[0],e*n[1]+r*s[1]+i*o[1],e*n[2]+r*s[2]+i*o[2])}let mne=class extends Bv{intersect(e,r,i,n,s,o){return TOe(e,i,n,s,void 0,o)}};function KDe(t){const e=new Or,{vertex:r,fragment:i,attributes:n,varyings:s}=e;Zc(r,t),e.include(Kl,t),e.include(H2,t),e.include(B0,t),e.include(Q3,t),n.add(R.POSITION,"vec3"),t.vvColor&&n.add(R.COLORFEATUREATTRIBUTE,"float"),s.add("vColor","vec4"),s.add("vpos","vec3");const o=t.multipassEnabled&&(t.output===U.Color||t.output===U.Alpha);o&&s.add("depth","float"),r.uniforms.add(new xr("eColor",c=>c.color));const a=t.output===U.LinearDepth;a&&(e.include(ly,t),f2(e),_v(e)),r.code.add(T`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();

      ${t.hasVertexColors?"vColor *= eColor;":t.vvColor?"vColor = eColor * interpolateVVColor(colorFeatureAttribute);":"vColor = eColor;"}
      ${o?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = ${a?T`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:T`transformPosition(proj, view, vpos);`}
    }
  `),e.include(Fn,t),o&&e.include(iu,t),i.include(xg);const l=t.output===U.Highlight;return l&&e.include(Vv,t),i.code.add(T`
  void main() {
    discardBySlice(vpos);
    ${o?"terrainDepthTest(depth);":""}
    vec4 fColor = vColor;

    ${t.output===U.ObjectAndLayerIdColor?T`fColor.a = 1.0;`:""}

    if (fColor.a < ${T.float(Fo)}) {
      discard;
    }

    ${t.output===U.Alpha?T`fragColor = vec4(fColor.a);`:""}

    ${t.output===U.Color?T`fragColor = highlightSlice(fColor, vpos); ${t.transparencyPassType===ft.Color?"fragColor = premultiplyAlpha(fragColor);":""}`:""}
    ${l?T`outputHighlight();`:""};
    ${t.output===U.LinearDepth?T`outputDepth(linearDepth);`:""};
    ${t.output===U.ObjectAndLayerIdColor?T`outputObjectAndLayerIdColor();`:""}
  }
  `),e}const r2t=Object.freeze(Object.defineProperty({__proto__:null,build:KDe},Symbol.toStringTag,{value:"Module"}));let eNe=class tNe extends Vr{initializeProgram(e){return new Lr(e.rctx,tNe.shader.get().build(this.configuration),Mr)}_createPipeline(e,r){const i=this.configuration,n=e===ft.NONE,s=e===ft.FrontFace;return kt({blending:i.output!==U.Color&&i.output!==U.Alpha||!i.transparent?null:n?Zu:Cy(e),culling:rU(i.cullFace),depthTest:i.draped?null:{func:Gv(e)},depthWrite:i.draped?null:(n||s)&&i.writeDepth?ru:null,colorWrite:Yt,stencilWrite:i.hasOccludees?pg:null,stencilTest:i.hasOccludees?r?Cv:jv:null,polygonOffset:n||s?i.polygonOffset?i2t:null:MU(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,!0),this._createPipeline(this.configuration.transparencyPassType,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}};eNe.shader=new Ir(r2t,()=>ge(()=>Promise.resolve().then(()=>e4t),void 0));const i2t={factor:1,units:1};let co=class extends vl{constructor(){super(...arguments),this.output=U.Color,this.cullFace=Pi.None,this.transparencyPassType=ft.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.objectAndLayerIdColorInstanced=!1,this.vvColor=!1,this.draped=!1}};d([j({count:U.COUNT})],co.prototype,"output",void 0),d([j({count:Pi.COUNT})],co.prototype,"cullFace",void 0),d([j({count:ft.COUNT})],co.prototype,"transparencyPassType",void 0),d([j()],co.prototype,"hasSlicePlane",void 0),d([j()],co.prototype,"hasVertexColors",void 0),d([j()],co.prototype,"transparent",void 0),d([j()],co.prototype,"polygonOffset",void 0),d([j()],co.prototype,"enableOffset",void 0),d([j()],co.prototype,"writeDepth",void 0),d([j()],co.prototype,"hasOccludees",void 0),d([j()],co.prototype,"multipassEnabled",void 0),d([j()],co.prototype,"cullAboveGround",void 0),d([j()],co.prototype,"objectAndLayerIdColorInstanced",void 0),d([j()],co.prototype,"vvColor",void 0),d([j()],co.prototype,"draped",void 0),d([j({constValue:!1})],co.prototype,"occlusionPass",void 0),d([j({constValue:!0})],co.prototype,"hasVvInstancing",void 0),d([j({constValue:!1})],co.prototype,"vvSize",void 0),d([j({constValue:!1})],co.prototype,"vvOpacity",void 0);let Xme=class extends mne{constructor(e){super(e,new s2t),this.supportsEdges=!0,this.produces=new Map([[ue.OPAQUE_MATERIAL,r=>r===U.Highlight||jV(r)&&!this._isTransparent],[ue.OPAQUE_NO_SSAO_DEPTH,r=>r===U.LinearDepth&&this.parameters.writeLinearDepth&&!this._isTransparent],[ue.TRANSPARENT_MATERIAL,r=>jV(r)&&this._isTransparent&&this.parameters.writeDepth],[ue.TRANSPARENT_NO_SSAO_DEPTH,r=>r===U.LinearDepth&&this.parameters.writeLinearDepth&&this._isTransparent&&this.parameters.writeDepth],[ue.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,r=>(jV(r)||r===U.LinearDepth&&this.parameters.writeLinearDepth)&&this._isTransparent&&!this.parameters.writeDepth],[ue.DRAPED_MATERIAL,r=>AAe(r)]]),this._configuration=new co}getConfiguration(e,r){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this._isTransparent,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<PU,this._configuration.multipassEnabled=r.multipassEnabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.draped=this.parameters.draped,this._configuration}createGLMaterial(e){return new n2t(e)}createBufferWriter(){const e=Qi().vec3f(R.POSITION);return se("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(R.OBJECTANDLAYERIDCOLOR),this.parameters.vvColor?e.f32(R.COLORFEATUREATTRIBUTE):e.vec4u8(R.COLOR),new eP(e)}get _isTransparent(){return this.parameters.color[3]<1||this.parameters.forceTransparentMode}},n2t=class extends zv{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==U.Color&&this._output!==U.Alpha||this._updateOccludeeState(e),this.ensureTechnique(eNe,e)}},s2t=class extends KI{constructor(){super(...arguments),this.color=qu,this.forceTransparentMode=!1,this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=Pi.None,this.hasOccludees=!1,this.draped=!1}};var No;(function(t){t[t.Horizontal=0]="Horizontal",t[t.Vertical=1]="Vertical",t[t.Cross=2]="Cross",t[t.ForwardDiagonal=3]="ForwardDiagonal",t[t.BackwardDiagonal=4]="BackwardDiagonal",t[t.DiagonalCross=5]="DiagonalCross",t[t.COUNT=6]="COUNT"})(No||(No={}));const fJ=.70710678118,Zme=fJ,o2t=.08715574274;function rNe(t){const e=new Or,r=t.multipassEnabled&&(t.output===U.Color||t.output===U.Alpha),{vertex:i,fragment:n,attributes:s,varyings:o}=e;Zc(i,t),e.include(Kl,t),e.include(H2,t),e.include(B0,t),e.include(Q3,t),t.draped?i.uniforms.add(new $e("worldToScreenRatio",(c,u)=>1/u.screenToPCSRatio)):s.add(R.BOUNDINGRECT,"mat3"),s.add(R.POSITION,"vec3"),s.add(R.UVMAPSPACE,"vec4"),t.vvColor&&s.add(R.COLORFEATUREATTRIBUTE,"float"),o.add("vColor","vec4"),o.add("vpos","vec3"),o.add("vuv","vec2"),r&&o.add("depth","float"),i.uniforms.add(new xr("uColor",c=>c.color));const a=t.style===No.ForwardDiagonal||t.style===No.BackwardDiagonal||t.style===No.DiagonalCross;a&&i.code.add(T`
      const mat2 rotate45 = mat2(${T.float(fJ)}, ${T.float(-Zme)},
                                 ${T.float(Zme)}, ${T.float(fJ)});
    `),t.draped||(cf(i,t),i.uniforms.add(new $e("worldToScreenPerDistanceRatio",(c,u)=>1/u.camera.perScreenPixelRatio)),i.code.add(T`vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {
float projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);
return center + halfVector * clamp(projectedLength, -1.0, 1.0);
}`),i.code.add(T`vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {
float d = dot(planeNormal, planePoint);
float t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);
return rayOrigin + t * rayDir;
}`),i.code.add(T`
      float boundingRectDistanceToCamera() {
        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);
        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);
        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);
        vec3 n = normalize(cross(halfU, halfV));

        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);

        float viewAngle = dot(viewDir, n);
        float minViewAngle = ${T.float(o2t)};

        if (abs(viewAngle) < minViewAngle) {
          // view direction is (almost) parallel to plane -> clamp it to min angle
          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;
          viewDir = normalize(viewDir + normalComponent * n);
        }

        // intersect view direction with infinite plane that contains bounding rect
        vec3 planeProjected = intersectRayPlane(viewDir, cameraPosition, n, center);

        // clip to bounds by projecting to u and v line segments individually
        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);
        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);

        // use to calculate the closest point to camera on bounding rect
        vec3 closestPoint = uProjected + vProjected - center;

        return length(closestPoint - cameraPosition);
      }
    `)),i.code.add(T`
    vec2 scaledUV() {
      vec2 uv = uvMapSpace.xy ${a?" * rotate45":""};
      vec2 uvCellOrigin = uvMapSpace.zw ${a?" * rotate45":""};

      ${t.draped?"":T`
            float distanceToCamera = boundingRectDistanceToCamera();
            float worldToScreenRatio = worldToScreenPerDistanceRatio / distanceToCamera;
          `}

      // Logarithmically discretize ratio to avoid jittering
      float step = 0.1;
      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);

      vec2 uvOffset = mod(uvCellOrigin * discreteWorldToScreenRatio, ${T.float(t.patternSpacing)});
      return uvOffset + (uv * discreteWorldToScreenRatio);
    }
  `);const l=t.output===U.LinearDepth;return l&&(e.include(ly,t),f2(e),_v(e)),i.code.add(T`
    void main(void) {
      vuv = scaledUV();
      vpos = position;
      ${r?"depth = (view * vec4(vpos, 1.0)).z;":""}
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();
      ${t.hasVertexColors?"vColor *= uColor;":t.vvColor?"vColor = uColor * interpolateVVColor(colorFeatureAttribute);":"vColor = uColor;"}
      gl_Position = ${l?T`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:T`transformPosition(proj, view, vpos);`}
    }
  `),e.include(Fn,t),n.include(xg),t.draped&&n.uniforms.add(new $e("texelSize",(c,u)=>1/u.camera.pixelRatio)),t.output===U.Highlight&&e.include(Vv,t),r&&e.include(iu,t),t.output!==U.Highlight&&(n.code.add(T`
      const float lineWidth = ${T.float(t.lineWidth)};
      const float spacing = ${T.float(t.patternSpacing)};
      const float spacingINV = ${T.float(1/t.patternSpacing)};

      float coverage(float p, float txlSize) {
        p = mod(p, spacing);

        float halfTxlSize = txlSize / 2.0;

        float start = p - halfTxlSize;
        float end = p + halfTxlSize;

        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;
        coverage -= min(lineWidth, mod(start, spacing));
        coverage -= max(lineWidth - mod(end, spacing), 0.0);

        return coverage / txlSize;
      }
    `),t.draped||n.code.add(T`const int maxSamples = 5;
float sampleAA(float p) {
vec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));
float fwidth = dxdy.x + dxdy.y;
ivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));
vec2 invSamples = 1.0 / vec2(samples);
float accumulator = 0.0;
for (int j = 0; j < maxSamples; j++) {
if(j >= samples.y) {
break;
}
for (int i = 0; i < maxSamples; i++) {
if(i >= samples.x) {
break;
}
vec2 step = vec2(i,j) * invSamples - 0.5;
accumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);
}
}
accumulator /= float(samples.x * samples.y);
return accumulator;
}`)),n.code.add(T`
    void main() {
      discardBySlice(vpos);
      ${r?"terrainDepthTest(depth);":""}
      vec4 color = vColor;
      color = highlightSlice(color, vpos);

      ${t.output!==U.Highlight?T`color.a *= ${a2t(t)};`:""}

      ${t.output===U.ObjectAndLayerIdColor?T`color.a = 1.0;`:""}

      if (color.a < ${T.float(Fo)}) {
        discard;
      }

      ${t.output===U.Alpha?T`fragColor = vec4(color.a);`:""}

      ${t.output===U.Color?T`fragColor = color; ${t.transparencyPassType===ft.Color?"fragColor = premultiplyAlpha(fragColor);":""}`:""}
      ${t.output===U.Highlight?T`outputHighlight();`:""}
      ${t.output===U.LinearDepth?T`outputDepth(linearDepth);`:""};
      ${t.output===U.ObjectAndLayerIdColor?T`outputObjectAndLayerIdColor();`:""}
    }
  `),e}function a2t(t){function e(r){return t.draped?T`coverage(vuv.${r}, texelSize)`:T`sampleAA(vuv.${r})`}switch(t.style){case No.ForwardDiagonal:case No.Horizontal:return e("y");case No.BackwardDiagonal:case No.Vertical:return e("x");case No.DiagonalCross:case No.Cross:return T`
        1.0 - (1.0 - ${e("x")}) * (1.0 - ${e("y")})
      `;default:return"0.0"}}const l2t=Object.freeze(Object.defineProperty({__proto__:null,build:rNe},Symbol.toStringTag,{value:"Module"}));let iNe=class nNe extends Vr{initializeProgram(e){return new Lr(e.rctx,nNe.shader.get().build(this.configuration),se("enable-feature:objectAndLayerId-rendering")?oNe:sNe)}_setPipelineState(e,r){const i=this.configuration,n=e===ft.NONE,s=e===ft.FrontFace;return kt({blending:i.output===U.Color||i.output===U.Alpha?n?Zu:Cy(e):null,culling:rU(i.cullFace),depthTest:i.draped?null:{func:Gv(e)},depthWrite:i.draped?null:n?ru:EU(e),colorWrite:Yt,stencilWrite:i.hasOccludees?pg:null,stencilTest:i.hasOccludees?r?Cv:jv:null,polygonOffset:n||s?i.polygonOffset?c2t:null:MU(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}};iNe.shader=new Ir(l2t,()=>ge(()=>Promise.resolve().then(()=>t4t),void 0));const c2t={factor:1,units:1};let Bs=class extends vl{constructor(){super(...arguments),this.output=U.Color,this.cullFace=Pi.None,this.transparencyPassType=ft.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasOccludees=!1,this.enableOffset=!0,this.multipassEnabled=!1,this.cullAboveGround=!1,this.vvColor=!1,this.objectAndLayerIdColorInstanced=!1}};d([j({count:U.COUNT})],Bs.prototype,"output",void 0),d([j({count:Pi.COUNT})],Bs.prototype,"cullFace",void 0),d([j({count:No.COUNT})],Bs.prototype,"style",void 0),d([j({count:ft.COUNT})],Bs.prototype,"transparencyPassType",void 0),d([j()],Bs.prototype,"hasSlicePlane",void 0),d([j()],Bs.prototype,"hasVertexColors",void 0),d([j()],Bs.prototype,"polygonOffset",void 0),d([j()],Bs.prototype,"hasOccludees",void 0),d([j()],Bs.prototype,"patternSpacing",void 0),d([j()],Bs.prototype,"lineWidth",void 0),d([j()],Bs.prototype,"enableOffset",void 0),d([j()],Bs.prototype,"draped",void 0),d([j()],Bs.prototype,"multipassEnabled",void 0),d([j()],Bs.prototype,"cullAboveGround",void 0),d([j()],Bs.prototype,"vvColor",void 0),d([j({constValue:!0})],Bs.prototype,"writeDepth",void 0),d([j({constValue:!1})],Bs.prototype,"occlusionPass",void 0),d([j({constValue:!1})],Bs.prototype,"hasVvInstancing",void 0),d([j({constValue:!1})],Bs.prototype,"vvSize",void 0),d([j({constValue:!1})],Bs.prototype,"vvOpacity",void 0);const sNe=new Map([[R.POSITION,0],[R.COLOR,3],[R.UVMAPSPACE,4],[R.COLORFEATUREATTRIBUTE,5],[R.BOUNDINGRECT,6]]),oNe=new Map([[R.POSITION,0],[R.COLOR,3],[R.UVMAPSPACE,4],[R.COLORFEATUREATTRIBUTE,5],[R.BOUNDINGRECT,6],[R.OBJECTANDLAYERIDCOLOR,9]]);let gne=class extends mne{constructor(e){super(e,new d2t),this.supportsEdges=!0,this.produces=new Map([[ue.OPAQUE_MATERIAL,r=>$x(r)],[ue.TRANSPARENT_MATERIAL,r=>z0(r)],[ue.TRANSPARENT_NO_SSAO_DEPTH,r=>r===U.LinearDepth&&this.parameters.writeLinearDepth],[ue.DRAPED_MATERIAL,r=>this.parameters.draped&&r===U.Color||$x(r)]]),this._vertexAttributeLocations=se("enable-feature:objectAndLayerId-rendering")?oNe:sNe,this._configuration=new Bs}getConfiguration(e,r){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.style=this.parameters.style,this._configuration.patternSpacing=this.parameters.patternSpacing,this._configuration.lineWidth=this.parameters.lineWidth,this._configuration.draped=this.parameters.draped,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<PU,this._configuration.multipassEnabled=r.multipassEnabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration}createGLMaterial(e){return new u2t(e)}createBufferWriter(){const e=Qi().vec3f(R.POSITION).vec4f(R.UVMAPSPACE);return this.parameters.draped||e.mat3f(R.BOUNDINGRECT),this.parameters.vvColor?e.f32(R.COLORFEATUREATTRIBUTE):e.vec4u8(R.COLOR),se("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(R.OBJECTANDLAYERIDCOLOR),new h2t(e)}},u2t=class extends zv{_updateParameters(e){return this.ensureTechnique(iNe,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==U.Color&&this._output!==U.Alpha||this._updateOccludeeState(e),this._updateParameters(e)}},h2t=class extends eP{write(e,r,i,n,s){DOe(i,this.vertexBufferLayout,e,r,n,s);for(const o of this.vertexBufferLayout.fields.keys()){const a=i.attributes.get(o),l=a==null?void 0:a.indices;if(a&&l)switch(o){case R.UVMAPSPACE:{pt(a.size===4);const c=n.getField(o,uf);c&&d3(a,c,s);break}case R.BOUNDINGRECT:{pt(a.size===9);const c=n.getField(o,vv);c&&this.writeBoundingRect(a,e,c,s);break}}}}writeBoundingRect(e,r,i,n){const{data:s,indices:o}=e,a=r,l=i.typedBuffer,c=i.typedBufferStride,u=o.length;n*=c;for(let h=0;h<u;++h){const p=9*o[h],f=s[p],g=s[p+1],_=s[p+2];l[n]=a[0]*f+a[4]*g+a[8]*_+a[12],l[n+1]=a[1]*f+a[5]*g+a[9]*_+a[13],l[n+2]=a[2]*f+a[6]*g+a[10]*_+a[14];for(let v=3;v<9;++v)l[n+v]=s[p+v];n+=c}}},d2t=class extends KI{constructor(){super(...arguments),this.color=Bt(1,1,1,1),this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=Pi.None,this.hasOccludees=!1,this.style=No.Cross,this.patternSpacing=10,this.lineWidth=1,this.draped=!0}};function p2t(t,e){const r=(t==null?void 0:t.pattern)??null;return r==null?new Xme(e):r.style==="none"||r.style==="solid"?(r.style==="none"&&(e.color=Bt(0,0,0,0),e.forceTransparentMode=!0),new Xme(e)):(e.style=f2t(r.style),new gne(e))}function f2t(t){switch(t){case"horizontal":return No.Horizontal;case"vertical":return No.Vertical;case"cross":return No.Cross;case"forward-diagonal":return No.ForwardDiagonal;case"backward-diagonal":return No.BackwardDiagonal;case"diagonal-cross":return No.DiagonalCross;default:return}}function m2t(t){return t.material instanceof gne&&!t.material.parameters.draped}function g2t(t,e){if(m2t(t)){const r=t.attributes.get(R.POSITION).data,i=t.getMutableAttribute(R.UVMAPSPACE).data,n=t.getMutableAttribute(R.BOUNDINGRECT).data;QDe(i,n,r,e)}}function y2t(t,e,r,i,n){const s=nRe(t,e,r,i,n),o=t.stageObject.geometries;for(const a of o)g2t(a,n);return s}const _2t=["polyline","polygon","extent"],Jme=new JI({size:!1,color:!0,rotation:!1,opacity:!1});let aNe=class lNe extends Sg{constructor(e,r,i,n){super(e,r,i,n),this._needsUV=!1}async doLoad(){this._fastUpdates=u3(this._context.renderer,Jme)}_createMaterials(){var n,s,o;if(this._materials.length>0)return;const e=(s=(n=this.symbolLayer)==null?void 0:n.material)==null?void 0:s.color,r=this._getCombinedOpacityAndColor(e);this._materials[Rn.Fill]=p2t(this.symbolLayer,{color:r,forceTransparentMode:this.needsDrivenTransparentPass,polygonOffset:!1,hasVertexColors:!0,writeLinearDepth:!0,draped:this.draped,hasSlicePlane:this._context.slicePlaneEnabled,...(o=this._fastUpdates)==null?void 0:o.materialParameters}),this._needsUV=this._materials[Rn.Fill]instanceof gne;const i=this.symbolLayer.outline;if(this._isValidOutline(i)){const a=YLe(i.pattern);this._materials[Rn.Outline]=new gC({width:fs(i.size),color:this._getOutlineColor(),hasPolygonOffset:!0,hasSlicePlane:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:a,cap:oJ(i.patternCap||"butt")})}this._context.stage.addMany(this._materials)}_isValidOutline(e){return(e==null?void 0:e.size)!=null&&e.size>0&&e.color!=null&&(e.pattern==null||e.pattern.type!=="style"||e.pattern.style!=="none")}destroy(){super.destroy(),this._context.stage.removeMany(this._materials),this._materials.length=0}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,_2t,this.symbolLayer.type))return null;const i=this._getVertexOpacityAndColor(e.renderingInfo,255),n=this.setGraphicElevationContext(r);return this.ensureDrapedStatus(n.mode==="on-the-ground"),this._createMaterials(),this.draped?this._createAsOverlay(r,i):this._createAs3DShape(r,i,n)}applyRendererDiff(e,r){var i;for(const n in e.diff){if(n!=="visualVariables"||!h3(this._fastUpdates,r,Jme))return Xn.RecreateSymbol;(i=this._materials[Rn.Fill])==null||i.setParameters(this._fastUpdates.materialParameters)}return Xn.FastUpdate}layerOpacityChanged(){var e,r;if(this._materials[Rn.Fill]!=null){const i=this._materials[Rn.Fill].parameters.color,n=(r=(e=this.symbolLayer)==null?void 0:e.material)==null?void 0:r.color,s=this._getCombinedOpacity(n);this._materials[Rn.Fill].setParameters({color:[i[0],i[1],i[2],s],forceTransparentMode:this.needsDrivenTransparentPass})}if(this._materials[Rn.Outline]!=null){const i=this._materials[Rn.Outline].parameters.color;this._materials[Rn.Outline].setParameters({color:[i[0],i[1],i[2],this._getOutlineOpacity()]})}}layerElevationInfoChanged(e,r,i){const n=this._elevationContext.mode,s=eL(lNe.elevationModeChangeTypes,i,n);if(s!==En.UPDATE)return s;const o=bd(n);return this.updateGraphics3DGraphicElevationInfo(e,r,()=>o)}slicePlaneEnabledChanged(){var e;if((e=this._materials[Rn.Fill])==null||e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._materials[Rn.Outline]){const r={hasSlicePlane:this._context.slicePlaneEnabled};this._materials[Rn.Outline].setParameters(r)}return!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(e,r,i){var u;const n=X$(e.geometry);if(!n)return null;const s=Bie(n,this._context.elevationProvider,this._context.renderCoordsHelper,i),o=new v2t(s,r,this._context.layer.uid,e.uid),a=o.renderData.position.length/3;if(this._needsUV&&(o.uvMapSpace=mn(4*a,!0),o.boundingRect=xo(9*a,!0),QDe(o.uvMapSpace,o.boundingRect,o.renderData.position,this._context.renderCoordsHelper)),o.objectAndLayerIdColor=(u=this._context.stage.renderView)==null?void 0:u.getObjectAndLayerIdColor(o),this._createAs3DShapeFill(e,o),this._materials[Rn.Outline]&&this._createAs3DShapeOutline(o),this._logGeometryCreationWarnings(o.renderData,n.rings,"rings","FillSymbol3DLayer"),o.outGeometries.length===0)return null;const l=new Ey({geometries:o.outGeometries,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:e.uid}),c=new Tg(this,l,o.outGeometries,null,null,y2t,i);return c.alignedSampledElevation=o.renderData.sampledElevation,c.needsElevationUpdates=bd(i.mode),c}_createAs3DShapeFill(e,r){var n;const i=r.renderData.polygons;for(const{position:s,mapPositions:o,holeIndices:a,index:l,count:c}of i){if(this._context.clippingExtent!=null&&(Li(zd),Hc(zd,o),!zp(zd,this._context.clippingExtent)))continue;const u=Sft(o,a,this._context.elevationProvider.spatialReference);if(u.length===0)continue;const h=(n=this._fastUpdates)==null?void 0:n.visualVariables.color,p=npe({material:this._materials[Rn.Fill],indices:u,mapPositions:o,attributeData:{position:s,color:h?null:r.color,colorFeature:h?Qp(h.field,e):null,uvMapSpace:this._needsUV?Y6(r.uvMapSpace,4*l,4*c):null,boundingRect:this._needsUV?nd(r.boundingRect,9*l,9*c):null,objectAndLayerIdColor:r.objectAndLayerIdColor}});r.outGeometries.push(p)}}_createAs3DShapeOutline(e){if(this._materials[Rn.Outline]==null)return;const r=e.renderData.outlines;for(const{mapPositions:i,position:n}of r){if(this._context.clippingExtent!=null&&(Li(zd),Hc(zd,i),!zp(zd,this._context.clippingExtent)))continue;const s=aJ(this._materials[Rn.Outline],{overlayInfo:null,removeDuplicateStartEnd:!0,mapPositions:i,attributeData:{position:n}},e.objectAndLayerIdColor);e.outGeometries.push(s)}}_createAsOverlay(e,r){var a;const i=X$(e.geometry);if(i==null)return null;this._materials[Rn.Fill].renderPriority=this._renderPriority+this._renderPriorityStep/2,this._materials[Rn.Outline]!=null&&(this._materials[Rn.Outline].renderPriority=this._renderPriority);const n=RIe(i,this._context.overlaySR),s=new b2t(n,r,this._context.layer.uid,e.uid),o=s.renderData.position.length/3;return this._needsUV&&(s.uvMapSpace=mn(4*o,!0),Kxt(s.uvMapSpace,s.renderData.position,this._context.overlaySR,this._context.graphicsCoreOwner.view.state.viewingMode)),s.outBoundingBox=Li(),s.objectAndLayerIdColor=(a=this._context.stage.renderView)==null?void 0:a.getObjectAndLayerIdColor(s),this._createAsOverlayFill(e,s),this._materials[Rn.Outline]&&this._createAsOverlayOutline(s),this._logGeometryCreationWarnings(s.renderData,i.rings,"rings","FillSymbol3DLayer"),s.outGeometries.length===0?null:new WU(this,s.outGeometries,s.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayFill(e,r){var n;const i=r.renderData.polygons;for(const{position:s,holeIndices:o,index:a,count:l}of i){const c=Li(zd);if(Hc(c,s),!zp(c,this._context.clippingExtent))continue;const u=y3(s,o,3);if(u.length===0)continue;t3(r.outBoundingBox,c);const h=(n=this._fastUpdates)==null?void 0:n.visualVariables.color,p=npe({material:this._materials[Rn.Fill],indices:u,attributeData:{position:s,color:h?null:r.color,colorFeature:h?Qp(h.field,e):null,uvMapSpace:this._needsUV?Y6(r.uvMapSpace,4*a,4*l):null,objectAndLayerIdColor:r.objectAndLayerIdColor}});r.outGeometries.push(new v3(p,r))}}_createAsOverlayOutline(e){if(this._materials[Rn.Outline]==null)return;const r=e.renderData.outlines;for(let i=0;i<r.length;++i){const{position:n}=r[i];if(Li(zd),Hc(zd,n),!zp(zd,this._context.clippingExtent))continue;t3(e.outBoundingBox,zd);const s=aJ(this._materials[Rn.Outline],{overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:!0,attributeData:{position:n}},e.objectAndLayerIdColor);e.outGeometries.push(new v3(s,e))}}_getOutlineOpacity(){var r,i;const e=(i=(r=this.symbolLayer)==null?void 0:r.outline)==null?void 0:i.color;return(this.draped?1:this._getLayerOpacity())*(e!=null?e.a:0)}_getOutlineColor(){var i,n;const e=(n=(i=this.symbolLayer)==null?void 0:i.outline)==null?void 0:n.color,r=this._getOutlineOpacity();return pR(e!=null?Xe.toUnitRGB(e):null,r)}test(){return{...super.test(),createAsOverlay:(e,r)=>this._createAsOverlay(e,r),createAs3DShape:(e,r,i)=>this._createAs3DShape(e,r,i)}}};aNe.elevationModeChangeTypes={definedChanged:En.RECREATE,staysOnTheGround:En.NONE,onTheGroundChanged:En.RECREATE};const zd=vs();let v2t=class extends UU{constructor(e,r,i,n){super(e,i,n),this.color=r}},b2t=class extends UU{constructor(e,r,i,n){super(e,i,n),this.color=r}};var Rn;(function(t){t[t.Fill=0]="Fill",t[t.Outline=1]="Outline"})(Rn||(Rn={}));let cNe=class{constructor(e,r="center",i=!1,n=He(),s=Bt(0,0,0,-1),o="world",a=C(),l=0){this.verticalOffset=e,this.anchor=r,this.hasLabelVerticalOffset=i,this.screenOffset=n,this.centerOffset=s,this.centerOffsetUnits=o,this.translation=a,this.elevationOffset=l}},uNe=class{constructor(e,r="center",i="center",n=null,s=He()){this.placement=e,this.horizontalPlacement=r,this.verticalPlacement=i,this.text=n,this.displaySize=s}},hNe=class dNe{constructor(e){this.definition=e,this.key=JSON.stringify(e),this.haloSize=Math.round(e.halo.size),this.textStyle=this._colorToRGBA(e.color),this.haloStyle=this._colorToRGB(e.halo.color),this.backgroundStyle=e.background.color[3]!==0?this._colorToRGBA(e.background.color):null}fontString(e){const r=this.definition.font;return`${r.style} ${r.weight} ${e}px ${r.family}, sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol, Noto Color Emoji`}setFontProperties(e,r){e.font=this.fontString(r),e.textAlign="left",e.textBaseline="alphabetic"}_colorToRGB(e){return`rgb(${e.slice(0,3).map(r=>Math.floor(255*r)).toString()})`}_colorToRGBA(e){return`rgba(${e.slice(0,3).map(r=>Math.floor(255*r)).toString()},${e[3]})`}static async fromSymbol(e,r){var p,f,g,_,v;const i=(p=e==null?void 0:e.material)==null?void 0:p.color,n=Xe.toUnitRGBA(i)??qu,s=e.size!=null?fs(e.size):12,o=e.lineHeight,a=e.background!=null?Xe.toUnitRGBA(e.background.color):qu,l={family:((f=e.font)==null?void 0:f.family)??"sans-serif",decoration:((g=e.font)==null?void 0:g.decoration)??"none",weight:((_=e.font)==null?void 0:_.weight)??"normal",style:((v=e.font)==null?void 0:v.style)??"normal"},c=e.halo,u=(c==null?void 0:c.color)!=null&&c.size>0?{size:fs(c.size),color:Xe.toUnitRGBA(c.color)}:{size:0,color:qu},h=new dNe({color:n,size:s,background:{color:a,padding:e.background!=null?[.65*s,.5*s]:[0,0],borderRadius:e.background!=null?s*(6/16):0},lineSpacingFactor:o,font:l,halo:u,pixelRatio:r});if(e.font){let b=!1;const w=h.fontString(s);try{b=(await document.fonts.load(w)).some(x=>!F0t(x))}catch{re.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters").warnOnce(`Failed to preload font '${w}'. Some text symbology may be rendered using the default browser font.`)}if(!b&&!w2t.has(e.font.family))try{await N0t(e.font)}catch{}}return h}};const w2t=new Set(["Arial","Times New Roman","Courier New","serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","math","emoji","fangsong"]),c_=4096;let yx=class extends Ae{constructor(e){super(e),this.type=Cn.Texture,this.id=Gu(),this.events=new Qn,this._glTexture=null,this._atlas=new S2t(256,256),this._needsRepack=!1,this._canRepack=!0,this._elementsToRender=new Map,this._elements=new Map,this._stageObjects=new Map,this.updating=!1}initialize(){this._canvas=document.createElement("canvas"),this._canvas.setAttribute("id","textAtlasCanvas"),this._canvas.setAttribute("style","display:none"),this._ctx=this._canvas.getContext("2d"),this._stage=this.view._stage,this._stage.add(this),this._updateCanvasElementSize(this._atlas),this._reset()}unload(){this._glTexture=gt(this._glTexture),this.updating=!1,this.events.emit("unloaded")}get glTexture(){return this._glTexture}static get maxSize(){return AR=0,[c_-u_-AR,c_-u_-AR-Qme]}load(e){if(this._glTexture)return this._glTexture;const r=new ri;return r.wrapMode=Jt.CLAMP_TO_EDGE,r.samplingMode=Ht.LINEAR_MIPMAP_LINEAR,r.hasMipmap=!0,r.preMultiplyAlpha=!0,r.maxAnisotropy=e.parameters.maxMaxAnisotropy,this._glTexture=new Sr(e,r,this._canvas),this._frameWorker=this.view.resourceController.scheduler.registerTask(bt.TEXT_TEXTURE_ATLAS,this),this.setDirty(),this._glTexture}dispose(){this._elements.clear(),this._elementsToRender.clear(),this._frameWorker=wi(this._frameWorker),this._glTexture&&(this._stage.remove(this),this._glTexture=gt(this._glTexture)),this._canvas.width=0,this._canvas.height=0,this._canvas=null,this._ctx=null}_updateCanvasElementSize(e){this._canvas.setAttribute("width",e.width.toString()),this._canvas.setAttribute("height",e.height.toString())}_resizeAtlas(e,r){var s,o;const{width:i,height:n}=this._atlas;i===e&&n===r||(this._atlas.width=e,this._atlas.height=r,(s=this._glTexture)==null||s.resize(e,r),(o=this._glTexture)==null||o.updateData(0,0,0,i,n,this._canvas),this._updateCanvasElementSize(this._atlas),this._elements.forEach(a=>{const l=this._stageObjects.get(a.textRenderer.key);l==null||l.forEach(c=>jG(c,a))}),this._reset())}_reset(){this._elementsToRender.clear(),this._atlas.reset(),this._needsRepack=!0,this.setDirty()}_addAtlasElement(e,r,i,n){const s=this._atlas;if(s.width<i||s.height<n)return!1;let o=s.cursors.get(n);if(!o){if(s.height<s.nextY+n)return!1;o=[new Kme(s.nextY)],s.cursors.set(n,o),s.nextY+=n}let a=o.find(l=>s.width>=l.x+i);if(a==null){if(s.height<s.nextY+n)return!1;a=new Kme(s.nextY),s.nextY+=n,o.push(a)}return e.setNewPosition(a),this._elements.set(r,e),this._elementsToRender.set(r,e),a.x+=i,!0}_ensureStageObjects(e){const r=this._stageObjects.get(e);if(r)return r;const i=new Set;return this._stageObjects.set(e,i),i}_addStageObject(e,r){this._ensureStageObjects(e).add(r)}_removeStageObject(e,r){const i=this._stageObjects.get(e);i!=null&&i.delete(r)&&(r.geometries[0].setAttributeData(R.SIZE,[0,0]),r.geometryVertexAttributeUpdated(r.geometries[0],R.SIZE),this._elementsToRender.delete(e))}_processAddition(e){const r=e.textRenderer.key;if(this._needsRepack)return void this._elements.set(r,e);const i=this._atlas,n=e.textRenderer.renderedWidth,s=e.textRenderer.renderedHeight,o=n+u_,a=s+u_+Qme;if(!this._addAtlasElement(e,r,o,a)){if(this._canRepack)this._reset();else if(i.width<o){const l=Math.min(Rx(Math.max(o,1.5*i.width)),c_);this._resizeAtlas(l,i.height)}else{const l=i.nextY+a,c=Math.min(Rx(Math.max(l,1.5*i.height)),c_);if(c>i.height)this._resizeAtlas(i.width,c);else if(i.width<c_){const u=Math.min(Rx(1.5*i.width),c_);this._resizeAtlas(u,i.height)}}this._elements.set(r,e)}}_renderElement(e){const r=e.commitNewPosition(),i=e.textRenderer;this._ctx.clearRect(r[0]-u_,r[1]-u_,i.renderedWidth+2*u_,i.renderedHeight+2*u_),i.render(this._ctx,r[0],r[1]);const n=this._stageObjects.get(i.key);n==null||n.forEach(s=>jG(s,e))}get running(){return this.updating}runTask(e){if(this._glTexture==null)return Ho;for(;this._needsRepack&&(this._canRepack||this._atlas.height<c_&&this._atlas.height<c_);){this._canRepack=this._needsRepack=!1;const r=this._elements;this._elements=new Map,r.forEach(i=>this._processAddition(i)),e.madeProgress()}if(this._elementsToRender.size>0){for(const[r,i]of this._elementsToRender){if(e.done)break;this._renderElement(i),this._elementsToRender.delete(r),e.madeProgress()}this._glTexture.setData(this._canvas)}this.updating=this._elementsToRender.size>0}addTextTexture(e,r){const i=e.key;this._addStageObject(i,r);let n=this._elements.get(i);n==null&&(n=new T2t(this._atlas,e),this._processAddition(n),this.setDirty()),x2t(r,n),jG(r,n)}removeTextTexture(e,r){const i=e.key;if(!this._elements.get(i))return;this._removeStageObject(i,r);const n=this._stageObjects.get(i);n&&n.size!==0||this._elements.delete(i),(n==null?void 0:n.size)===0&&this._stageObjects.delete(i),this._canRepack=!0}setDirty(){this._glTexture&&(this.updating=!0)}get test(){const{_elements:e,_stageObjects:r,_atlas:i}=this,n=this;return{elements:e,stageObjects:r,atlas:i,resizeAtlas:(s,o)=>n._resizeAtlas(s,o),run:s=>n.runTask(s)}}};function x2t(t,e){t.geometries[0].setAttributeData(R.SIZE,[e.textRenderer.displayWidth,e.textRenderer.displayHeight]),t.geometryVertexAttributeUpdated(t.geometries[0],R.SIZE)}function jG(t,e){t.geometries[0].setAttributeData(R.UV0,e.uv),t.geometryVertexAttributeUpdated(t.geometries[0],R.UV0,!0)}d([m({constructOnly:!0})],yx.prototype,"view",void 0),d([m({type:Boolean})],yx.prototype,"updating",void 0),yx=d([V("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],yx);const u_=2,Qme=2;let T2t=class{constructor(e,r){this._atlas=e,this.textRenderer=r,this._uv=Zt(),this._newPosition=[0,0]}get uv(){if(this._xOffset==null||this._yOffset==null)return qu;const{renderedWidth:e,renderedHeight:r}=this.textRenderer;return nn(this._uv,this._xOffset/this._atlas.width,(this._yOffset+r)/this._atlas.height,(this._xOffset+e)/this._atlas.width,this._yOffset/this._atlas.height)}setNewPosition(e){this._newPosition[0]=e.x,this._newPosition[1]=e.y}commitNewPosition(){return this._xOffset=this._newPosition[0],this._yOffset=this._newPosition[1],this._newPosition}get xOffset(){return this._xOffset}get yOffset(){return this._yOffset}},S2t=class{constructor(e,r){this.width=e,this.height=r,this.cursors=new Map,this.nextY=0}reset(){this.cursors.clear(),this.nextY=AR}},Kme=class{constructor(e){this.y=e,this.x=AR}},AR=0,C2t=class{constructor(e,r,i){this._renderer=new zLe(e,r,i,yx.maxSize)}get key(){return this._renderer.key}get baselineAnchorY(){return 1-this._renderer.firstRenderedBaselinePosition/this._renderer.renderedHeight}get displayWidth(){return this._renderer.displayWidth}get displayHeight(){return this._renderer.displayHeight}create(){const e=$8(E2t,this._renderer.renderedWidth,this._renderer.renderedHeight),r=e.getContext("2d");return r.save(),this._renderer.render(r,0,0),r.restore(),new Pv(e,{wrap:{s:Jt.CLAMP_TO_EDGE,t:Jt.CLAMP_TO_EDGE},noUnpackFlip:!1,mipmap:!0,preMultiplyAlpha:!0})}};const E2t={canvas:null},P2t=Ce(0,0,1);let A2t=class extends Sg{constructor(e,r,i,n){super(e,r,i,n),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const e=RU(this.symbolLayer.size);if(e)throw new K("graphics3dtextsymbollayer:invalid-size",e)}await this._createTextRenderParameters()}async _createTextRenderParameters(){const e=this._context.graphicsCoreOwner.view.state.rasterPixelRatio;this._textRenderParameters=await hNe.fromSymbol(this.symbolLayer,e)}destroy(){super.destroy()}createGraphics3DGraphic(e){const r=e.graphic,i=q$(r.geometry);if(i==null)return this.logger.warn(`unsupported geometry type for text symbol: ${r.geometry.type}`),null;const n=this.symbolLayer.text;if(n==null||n==="")return null;const s=zte(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol.verticalOffset:null;if(s!=null&&!v3e(this.symbolLayer))return this.logger.errorOncePerTick(`Callouts and vertical offset on text symbols are currently only supported with 'center' horizontal alignment (not with '${this.symbolLayer.horizontalAlignment}' alignment)`),null;const{verticalAlignment:o}=this.symbolLayer,a=new cNe(s);Q1t(o,a.screenOffset);const l=new uNe(a,this.symbolLayer.horizontalAlignment,J1t(o));return this._createAs3DShape(r,i,n,l)}createLabel(e,r,i,n,s){const o=e.graphic,a=q$(o.geometry);if(a==null)return this.logger.warn(`unsupported geometry type for label: ${o.geometry.type}`),null;const l=r.text;return!l||/^\s+$/.test(l)?null:this._createAs3DShape(o,a,l,r,i,n,s)}setGraphicElevationContext(e,r,i=0){return super.setGraphicElevationContext(e,r),r.addOffsetRenderUnits(i),r}layerOpacityChanged(){return this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer"),!1}layerElevationInfoChanged(e,r){return ege(e,r,(i,n)=>{this.updateGraphicElevationContext(n,i)}),En.UPDATE}slicePlaneEnabledChanged(e,r){return ege(e,r,i=>{for(const n of i.stageObject.geometries)n.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}get pixelRatioChanged(){return!1}updateGraphicElevationContext(e,r){const i=r.elevationContext;this.setGraphicElevationContext(e,i,r.metadata!=null?r.metadata.elevationOffset:0),r.needsElevationUpdates=bd(i.mode)||i.mode==="absolute-height"}_defaultElevationInfoNoZ(){return O2t}_createAs3DShape(e,r,i,n,s=null,o=null,a=()=>n.placement.elevationOffset){var q;const l=this.setGraphicElevationContext(e,new f8,n.placement.elevationOffset),c=((q=e.geometry)==null?void 0:q.type)==="polyline",u=e.uid;let h=null,p=null;if(o==null){const B=BLe(n.horizontalPlacement);h=new C2t(i,B,this._textRenderParameters);let J=null;if(this._context.sharedResources.textures!=null){p=this._context.sharedResources.textures.fromData(h.key,()=>h.create()),p.texture.events.on("unloaded",()=>J==null?void 0:J.release());const W=this._context.stage.renderView.textureRepository.acquire(p.texture.id);if(W==null||nu(W))return p.release(),null;J=W}}const f=M2t(h,n),g={occlusionTest:!0,screenOffset:n.placement.screenOffset,anchorPosition:f,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:n.placement.centerOffsetUnits,drawInSecondSlot:!0};if(o?g.textureId=o.id:p&&(g.textureId=p.texture.id),n.placement.verticalOffset!=null){const{screenLength:B,minWorldLength:J,maxWorldLength:W}=n.placement.verticalOffset;g.verticalOffset={screenLength:fs(B),minWorldLength:J||0,maxWorldLength:W??1/0}}if(this._context.screenSizePerspectiveEnabled){const{screenSizePerspectiveSettings:B,screenSizePerspectiveSettingsLabels:J}=this._context.sharedResources,W=kLe(this._textRenderParameters);g.screenSizePerspective=J.overrideFontHeight(W.maxHeight),g.screenSizePerspectiveAlignment=B}c&&(g.shaderPolygonOffset=1e-4),g.hasSlicePlane=this._context.slicePlaneEnabled;const _=(B,J)=>{const W=JSON.stringify(J);let Y=B.get(W);return Y==null&&(Y=new p3(J),B.add(W,Y)),Y},v=s?_(s,g):new p3(g),b=n.placement.translation,w=h?lr(h.displayWidth,h.displayHeight):ty,x=n.placement.centerOffset,S=P2t,E=He(),A=oZ(v,S,b,null,w,x,E,null),O=mie(this._context,r,A,l,u);if(O==null)return null;const L=(B,J,W,Y,le,D)=>{const I=a()||n.placement.elevationOffset,F=this.setGraphicElevationContext(e,J,I);return Lx(B,F,W,Y,le,D)},z=new Tg(this,O.object,[A],s==null?[v]:null,p,L,l);z.alignedSampledElevation=O.sampledElevation,z.needsElevationUpdates=bd(l.mode)||l.mode==="absolute-height",z.getScreenSize=(B=He())=>(B[0]=h?h.displayWidth:n.displaySize[0],B[1]=h?h.displayHeight:n.displaySize[1],B);const k=new dRe(n.placement.elevationOffset,i);return z.metadata=k,W$(z,r,this._context.elevationProvider),z}};function ege(t,e,r){t&&t.forEach(i=>{const n=e(i);n!=null&&r(n,i.graphic)})}function M2t(t,e){if(e.verticalPlacement==="baseline"){const i=Y1t[e.horizontalPlacement],n=t!=null?t.baselineAnchorY:0;return lr(i,n)}const r=Z1t(e.horizontalPlacement,e.verticalPlacement);return CF[r]}const O2t={mode:"relative-to-ground",offset:0};function tge(t){t.fragment.uniforms.add(new ct("texWaveNormal",e=>e.waveNormal),new ct("texWavePerturbation",e=>e.wavePerturbation),new xr("waveParams",e=>nn(R2t,e.waveStrength,e.waveTextureRepeat,e.flowStrength,e.flowOffset)),new ti("waveDirection",e=>cr($2t,e.waveDirection[0]*e.waveVelocity,e.waveDirection[1]*e.waveVelocity))),t.include(kft),t.fragment.code.add(T`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)}const R2t=Zt(),$2t=He();function pNe(t){const e=new Or,{vertex:r,fragment:i}=e;Zc(r,t),e.include(Kl,t),e.attributes.add(R.POSITION,"vec3"),e.attributes.add(R.UV0,"vec2");const n=new xr("waterColor",s=>s.color);if(t.output===U.Color&&t.draped)return e.varyings.add("vpos","vec3"),r.uniforms.add(n),r.code.add(T`
        void main(void) {
          if (waterColor.a < ${T.float(Fo)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),i.uniforms.add(n),i.code.add(T`void main() {
fragColor = waterColor;
}`),e;switch(t.output!==U.Color&&t.output!==U.Alpha||(e.include(tI,t),e.include(X3,t),e.varyings.add("vuv","vec2"),e.varyings.add("vpos","vec3"),e.varyings.add("vnormal","vec3"),e.varyings.add("vtbnMatrix","mat3"),t.multipassEnabled&&e.varyings.add("depth","float"),r.uniforms.add(n),r.code.add(T`
      void main(void) {
        if (waterColor.a < ${T.float(Fo)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${t.multipassEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${t.output===U.Color?"forwardLinearDepth();":""}
      }
    `)),e.include(iu,t),t.output){case U.Alpha:e.include(Fn,t),i.uniforms.add(n),i.code.add(T`
        void main() {
          discardBySlice(vpos);
          ${t.multipassEnabled?"terrainDepthTest(depth);":""}

          fragColor = vec4(waterColor.a);
        }
      `);break;case U.Color:e.include(k6),e.include(ire,{pbrMode:ot.Disabled,lightingSphericalHarmonicsOrder:2}),e.include(tge),e.include(Fn,t),e.include(f3,t),e.include(G$e,t),i.uniforms.add(n,new $e("timeElapsed",s=>s.timeElapsed),r.uniforms.get("view"),r.uniforms.get("localOrigin")),cf(i,t),i.include(xg),by(i),_g(i),i.code.add(T`
      void main() {
        discardBySlice(vpos);
        ${t.multipassEnabled?"terrainDepthTest(depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - cameraPosition);
        float shadow = ${t.receiveShadows?T`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view * vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, mainLightDirection, waterColor.rgb, mainLightIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);

        // gamma correction
        fragColor = delinearizeGamma(final);
        fragColor = highlightSlice(fragColor, vpos);
        ${t.transparencyPassType===ft.Color?"fragColor = premultiplyAlpha(fragColor);":""}
      }
    `);break;case U.Normal:e.include(tI,t),e.include(tge,t),e.include(Fn,t),e.varyings.add("vpos","vec3"),e.varyings.add("vuv","vec2"),r.uniforms.add(n),r.code.add(T`
        void main(void) {
          if (waterColor.a < ${T.float(Fo)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `),i.uniforms.add(new $e("timeElapsed",s=>s.timeElapsed)),i.code.add(T`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
fragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`);break;case U.Highlight:e.include(Vv,t),e.varyings.add("vpos","vec3"),r.uniforms.add(n),r.code.add(T`
      void main(void) {
        if (waterColor.a < ${T.float(Fo)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `),e.include(Fn,t),i.code.add(T`void main() {
discardBySlice(vpos);
outputHighlight();
}`);break;case U.ObjectAndLayerIdColor:e.include(Q3,t),e.varyings.add("vpos","vec3"),r.uniforms.add(n),r.code.add(T`
      void main(void) {
        if (waterColor.a < ${T.float(Fo)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
        forwardObjectAndLayerIdColor();
      }
    `),e.include(Fn,t),i.code.add(T`void main() {
discardBySlice(vpos);
outputObjectAndLayerIdColor();
}`)}return e}const I2t=Object.freeze(Object.defineProperty({__proto__:null,build:pNe},Symbol.toStringTag,{value:"Module"}));let fNe=class mNe extends Vr{initializeConfiguration(e,r){r.spherical=e.viewingMode===De.Global,r.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new Lr(e.rctx,mNe.shader.get().build(this.configuration),Mr)}_setPipelineState(e){const r=this.configuration,i=e===ft.NONE,n=e===ft.FrontFace;return kt({blending:r.output!==U.Normal&&r.output!==U.Highlight&&r.output!==U.ObjectAndLayerIdColor&&r.transparent?i?Zu:Cy(e):null,depthTest:r.draped?null:{func:Gv(e)},depthWrite:r.draped?null:i?r.writeDepth?ru:null:EU(e),colorWrite:Yt,polygonOffset:i||n?null:MU(r.enableOffset)})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}};fNe.shader=new Ir(I2t,()=>ge(()=>Promise.resolve().then(()=>r4t),void 0));let Vs=class extends vl{constructor(){super(...arguments),this.output=U.Color,this.transparencyPassType=ft.NONE,this.spherical=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!1,this.hasScreenSpaceReflections=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasCloudsReflections=!1,this.objectAndLayerIdColorInstanced=!1,this.draped=!1,this.multipassEnabled=!1,this.cullAboveGround=!1}};d([j({count:U.COUNT})],Vs.prototype,"output",void 0),d([j({count:ft.COUNT})],Vs.prototype,"transparencyPassType",void 0),d([j()],Vs.prototype,"spherical",void 0),d([j()],Vs.prototype,"receiveShadows",void 0),d([j()],Vs.prototype,"hasSlicePlane",void 0),d([j()],Vs.prototype,"transparent",void 0),d([j()],Vs.prototype,"enableOffset",void 0),d([j()],Vs.prototype,"writeDepth",void 0),d([j()],Vs.prototype,"hasScreenSpaceReflections",void 0),d([j()],Vs.prototype,"doublePrecisionRequiresObfuscation",void 0),d([j()],Vs.prototype,"hasCloudsReflections",void 0),d([j()],Vs.prototype,"objectAndLayerIdColorInstanced",void 0),d([j()],Vs.prototype,"draped",void 0),d([j()],Vs.prototype,"multipassEnabled",void 0),d([j()],Vs.prototype,"cullAboveGround",void 0),d([j({constValue:!1})],Vs.prototype,"occlusionPass",void 0),d([j({constValue:ot.Water})],Vs.prototype,"pbrMode",void 0),d([j({constValue:!0})],Vs.prototype,"useCustomDTRExponentForWater",void 0),d([j({constValue:!0})],Vs.prototype,"highStepCount",void 0),d([j({constValue:!1})],Vs.prototype,"useFillLights",void 0);let L2t=class extends zv{_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:e.shadowMap.enabled})}_updateSSRState(e){const r=e.ssr.lastFrameColor!=null;r!==this._material.parameters.hasScreenSpaceReflections&&this._material.setParameters({hasScreenSpaceReflections:r})}_updateCloudsReflectionState(e){const r=e.cloudsFade.data!=null;r!==this._material.parameters.hasCloudsReflections&&this._material.setParameters({hasCloudsReflections:r})}ensureResources(e){return this._techniqueRepository.constructionContext.waterTextureRepository.ensureResources(e)}beginSlot(e){return this._output===U.Color&&(this._updateShadowState(e),this._updateSSRState(e),this._updateCloudsReflectionState(e)),this._material.setParameters(this._techniqueRepository.constructionContext.waterTextureRepository.passParameters),this.ensureTechnique(fNe,e)}},D2t=class extends mne{constructor(e){super(e,new gNe),this._configuration=new Vs,this._animation=new lMe,this.produces=new Map([[ue.OPAQUE_MATERIAL,r=>z0(r)&&!this.parameters.transparent||$x(r)],[ue.TRANSPARENT_MATERIAL,r=>z0(r)&&this.parameters.transparent||$x(r)],[ue.DRAPED_MATERIAL,r=>this.parameters.draped&&r===U.Color||$x(r)],[ue.DRAPED_WATER,r=>r===U.Normal]])}getConfiguration(e,r){return this._configuration.output=e,this._configuration.writeDepth=!0,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasScreenSpaceReflections=this.parameters.hasScreenSpaceReflections,this._configuration.hasCloudsReflections=this.parameters.hasCloudsReflections,this._configuration.draped=this.parameters.draped,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<PU,this._configuration.multipassEnabled=r.multipassEnabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}update(e){const r=Math.min(e.camera.relativeElevation,e.camera.distance);this._animation.enabled=Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*r<N2t;const i=this._animation.advance(e);return this.setParameters({timeElapsed:OK(this._animation.time)*this.parameters.animationSpeed},!1),this._animation.enabled&&i}createGLMaterial(e){return new L2t(e)}createBufferWriter(){return new eP(se("enable-feature:objectAndLayerId-rendering")?sbt:ibt)}get test(){return{animationEnabled:this._animation.enabled}}},gNe=class extends Zre{constructor(){super(...arguments),this.waveStrength=.06,this.waveTextureRepeat=32,this.waveDirection=lr(1,0),this.waveVelocity=.05,this.flowStrength=.015,this.flowOffset=-.5,this.animationSpeed=.35,this.timeElapsed=0,this.color=Bt(0,0,0,0),this.transparent=!0,this.hasSlicePlane=!1,this.draped=!1,this.receiveShadows=!0,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.origin=C(),this.modelTransformation=null}};const N2t=35e3,F2t={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}},k2t=["polyline","polygon","extent"];let mJ=class Tw extends Sg{constructor(e,r,i,n){super(e,r,i,n)}async doLoad(){}destroy(){super.destroy(),this._context.stage.remove(this._materials[0]),this._materials.length=0}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,k2t,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(r);return this.ensureDrapedStatus(i.mode==="on-the-ground"),this.ensureMaterial(),this.draped?this._createAsOverlay(r):this._createAs3DShape(r,i,r.uid)}ensureMaterial(){if(this._materials[0])return;const e=new gNe,r=this.symbolLayer.color;r!=null&&(e.color=Xe.toUnitRGBA(r));const i=this._getCombinedOpacity(r,{hasIntrinsicColor:!0});e.color=[e.color[0],e.color[1],e.color[2],i],e.transparent=i<1||this.needsDrivenTransparentPass,e.waveDirection=this.symbolLayer.waveDirection!=null?Tw.headingVectorFromAngle(this.symbolLayer.waveDirection):lr(0,0);const n=this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize,s=F2t[n];e.waveStrength=s.waveStrength,e.waveTextureRepeat=s.textureRepeat,e.waveVelocity=s.waveVelocity,e.flowStrength=s.perturbationStrength,e.hasSlicePlane=this._context.slicePlaneEnabled,e.draped=this.draped,this._materials[0]=new D2t(e),this._context.stage.add(this._materials[0])}layerOpacityChanged(){if(this._materials[0]==null)return;const e=this._materials[0].parameters.color,r=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0}),i=r<1||this.needsDrivenTransparentPass;this._materials[0].setParameters({color:[e[0],e[1],e[2],r],transparent:i})}layerElevationInfoChanged(e,r,i){const n=this._elevationContext.mode,s=eL(Tw.elevationModeChangeTypes,i,n);if(s!==En.UPDATE)return s;const o=bd(n);return this.updateGraphics3DGraphicElevationInfo(e,r,()=>o)}slicePlaneEnabledChanged(){var e;return(e=this._materials[0])==null||e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(e,r,i){var h;const n=X$(e.geometry);if(n==null)return null;const s=Bie(n,this._context.elevationProvider,this._context.renderCoordsHelper,r),o=s.position.length/3,a=xo(2*o);this._createUVCoordsFromVertices(a,s.mapPositions,o,this._context.elevationProvider.spatialReference);const l=new z2t(s,a,this._context.layer.uid,e.uid);if(l.objectAndLayerIdColor=(h=this._context.stage.renderView)==null?void 0:h.getObjectAndLayerIdColor(l),this._create3DShapeGeometries(l),this._logGeometryCreationWarnings(l.renderData,n.rings,"rings","WaterSymbol3DLayer"),l.outGeometries.length===0)return null;const c=new Ey({geometries:l.outGeometries,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:i}),u=new Tg(this,c,l.outGeometries,null,null,nRe,r);return u.alignedSampledElevation=l.renderData.sampledElevation,u.needsElevationUpdates=bd(r.mode),u}_createUVCoordsFromVertices(e,r,i,n){const s=Ba(n);Ku(h_);for(let l=0;l<i;l++)cr(rge,r[3*l],r[3*l+1]),mee(h_,rge);s2(h_,h_,s);const o=h_[0]%Tw.unitSizeOfTexture,a=h_[1]%Tw.unitSizeOfTexture;r4[0]=h_[0]-o,r4[1]=h_[1]-a;for(let l=0;l<i;l++)e[2*l]=(r[3*l]*s-r4[0])/Tw.unitSizeOfTexture,e[2*l+1]=(r[3*l+1]*s-r4[1])/Tw.unitSizeOfTexture}_create3DShapeGeometries(e){const r=e.renderData.polygons,i=e.uvCoords;for(const{count:n,index:s,position:o,mapPositions:a,holeIndices:l}of r){if(this._context.clippingExtent!=null&&(Li(Ab),Hc(Ab,a),!zp(Ab,this._context.clippingExtent)))continue;const c=y3(a,l,3);if(c.length===0)continue;const u=nd(i,2*s,2*n),h=spe({material:this._materials[0],indices:c,mapPositions:a,attributeData:{position:o,uv0:u}},e.objectAndLayerIdColor);e.outGeometries.push(h)}}_createAsOverlay(e){var a;const r=X$(e.geometry);if(r==null)return null;this._materials[0].renderPriority=this._renderPriority;const i=RIe(r,this._context.overlaySR),n=i.position.length/3,s=xo(2*n);this._createUVCoordsFromVertices(s,i.position,n,this._context.overlaySR);const o=new U2t(i,s,this._context.layer.uid,e.uid);return o.objectAndLayerIdColor=(a=this._context.stage.renderView)==null?void 0:a.getObjectAndLayerIdColor(o),o.outBoundingBox=Li(),this._createAsOverlayWater(o),this._logGeometryCreationWarnings(o.renderData,r.rings,"rings","WaterSymbol3DLayer"),o.outGeometries.length===0?null:new WU(this,o.outGeometries,o.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayWater(e){const r=e.uvCoords,i=e.renderData.polygons;for(const{position:n,holeIndices:s,index:o,count:a}of i){if(Li(Ab),Hc(Ab,n),!zp(Ab,this._context.clippingExtent))continue;t3(e.outBoundingBox,Ab);const l=y3(n,s,3);if(l.length===0)continue;const c=nd(r,2*o,2*a),u=spe({material:this._materials[0],indices:l,attributeData:{position:n,uv0:c}},e.objectAndLayerIdColor);e.outGeometries.push(new v3(u,e))}}static headingVectorFromAngle(e){const r=He(),i=Zz(e);return r[0]=Math.sin(i),r[1]=Math.cos(i),r}test(){return{...super.test(),create3DShape:e=>this._createAs3DShape(e.graphic,e.elevationContext,e.graphicUid),ensureMaterial:()=>this.ensureMaterial()}}};mJ.unitSizeOfTexture=100,mJ.elevationModeChangeTypes={definedChanged:En.RECREATE,staysOnTheGround:En.NONE,onTheGroundChanged:En.RECREATE};const r4=He(),h_=Wt(),rge=He(),Ab=vs();let z2t=class extends UU{constructor(e,r,i,n){super(e,i,n),this.uvCoords=r}},U2t=class extends UU{constructor(e,r,i,n){super(e,i,n),this.uvCoords=r}};function B2t(t,e,r,i){var s;const n=((s=G2t[t.type])==null?void 0:s[e.type])||V2t[e.type];return n?new n(t,e,r,i):(re.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory").error("GraphicsLayerFactory#make",`unknown symbol type ${e.type}`),null)}const V2t={icon:sJ,object:Xwt,line:XLe,path:Zxt,fill:aNe,extrude:Ugt,text:A2t,water:mJ},G2t={"mesh-3d":{fill:dbt}};let j2t=class extends fie{set symbol(e){this._symbol=e,e.symbolLayers.forEach((r,i)=>{const n=this.symbolLayers[i];n!=null&&(n.symbol=e,n.symbolLayer=r)})}get symbol(){return this._symbol}constructor(e,r,i){super(r.schedule),this._symbol=e,this._context=r,this._backgroundLayers=i,this._destroyed=!1,this.symbolLayers=new Array,this.referenced=0,this._extentPadding=0}async doLoad(e){let r=this._symbol.symbolLayers;this._extentPadding=0,this._backgroundLayers&&(r=this._backgroundLayers.concat(r));const i=r.length;for(;this.symbolLayers.length<r.length;)this.symbolLayers.push(null);this.symbolLayers.length=r.length;const n=[];for(let s=0;s<i;s++){const o=r.at(s);if(o.enabled===!1)continue;i4.renderPriority=1-(1+s)/i,i4.renderPriorityStep=1/i,i4.ignoreDrivers=o.ignoreDrivers;const a=B2t(this.symbol,o,this._context,i4),l=Dz(e,()=>{this.symbolLayers[s]=null,a.destroy()});l&&n.push(l),this.symbolLayers[s]=a}if(await jz(this.symbolLayers,async(s,o)=>{if(s!=null)try{await s.load(),this._extentPadding+=Math.max(this._extentPadding,s.extentPadding)}catch{this.symbolLayers[o]=null}}),n.forEach(s=>s.remove()),vt(e),this.symbolLayers.length&&!this.symbolLayers.some(s=>!!s))throw new Error}getSymbolLayerSize(e){const r=this.symbolLayers[e];return r!=null?r.getCachedSize():null}get extentPadding(){return this._extentPadding}get symbologySnappingSupported(){return this.symbolLayers.some(e=>e==null?void 0:e.queryForSnapping)}createGraphics3DGraphic(e,r){var o,a;const i=e.graphic,n=this.symbolLayers.map(l=>(l==null?void 0:l.createGraphics3DGraphic(e))??null),s=this._context.arcade||((a=(o=this._context.featureExpressionInfoContext)==null?void 0:o.arcade)==null?void 0:a.modules)||null;return new tft(i,r||this,n,e.layer,s)}get complexity(){return pie(this.symbolLayers.map(e=>e!=null?e.complexity:null))}globalPropertyChanged(e,r){const i=this.symbolLayers.length;for(let n=0;n<i;n++){const s=this.symbolLayers[n],o=a=>{const l=a.layers[n];return l instanceof Tg?l:null};if(s!=null&&!s.globalPropertyChanged(e,r,o))return!1}return!0}applyRendererDiff(e,r){return this.loadStatus!==Iu.LOADED?Xn.RecreateSymbol:this.symbolLayers.reduce((i,n)=>i!==Xn.RecreateSymbol&&n!=null?Math.min(i,n.applyRendererDiff(e,r)):i,Xn.FastUpdate)}prepareSymbolPatch(e){if(this.loadStatus===Iu.FAILED||e.diff.type!=="partial")return;const r=e.diff.diff;if(!r.symbolLayers||r.symbolLayers.type!=="partial")return;const i=r.symbolLayers.diff;this.symbolLayers.forEach((n,s)=>{if(n==null)return;const o=i[s];if(o){const a={diff:o,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};n.prepareSymbolLayerPatch(a),e.symbolStatePatches.push(...a.symbolLayerStatePatches),a.graphics3DGraphicPatches.length&&e.graphics3DGraphicPatches.push((l,c)=>{const u=l.layers[s];u!=null&&a.graphics3DGraphicPatches.forEach(h=>h(u,c))})}})}updateGeometry(e,r){return this._updateGeometryOrTransform(e,(i,n)=>i.updateGeometry(n,r))}updateTransform(e,r,i,n){return this._updateGeometryOrTransform(e,(s,o)=>s.updateTransform(o,r,i,n))}_updateGeometryOrTransform(e,r){for(let i=0;i<this.symbolLayers.length;i++){const n=this.symbolLayers[i];if(n==null)continue;const s=e.layers[i];if(!s||!r(n,s))return!1}return!0}onRemoveGraphic(e){for(let r=0;r<this.symbolLayers.length;r++){const i=this.symbolLayers[r];if(i==null)continue;const n=e.layers[r];n!=null&&i.onRemoveGraphic(n)}}getFastUpdateStatus(){let e=0,r=0,i=0;return this.symbolLayers.forEach(n=>{n!=null&&(n.loadStatus===Iu.LOADING?e++:n.isFastUpdatesEnabled()?i++:r++)}),{loading:e,slow:r,fast:i}}async queryForSnapping(e,r,i,n){const s=this.symbolLayers.filter(P3).filter(a=>a.queryForSnapping!=null).map(a=>a.queryForSnapping(e,r,i,n)),o=await Promise.all(s);return vt(n),o.flat()}destroy(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{super.destroy();for(const e of this.symbolLayers)e!=null&&e.destroy();this.symbolLayers.length=0,this._destroyed=!0}}get destroyed(){return this._destroyed}};const i4=new rft;let H2t=class extends fie{constructor(e,r,i){super(r),this.symbol=e,this._convert=i,this.symbologySnappingSupported=!1,this.graphics3DSymbol=null,this.referenced=0}getSymbolLayerSize(e){return this.graphics3DSymbol!=null?this.graphics3DSymbol.getSymbolLayerSize(e):null}get symbolLayers(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.extentPadding:0}async doLoad(e){const r=await this.symbol.fetchSymbol({signal:e});r.id=this.symbol.id,this.graphics3DSymbol=this._convert(r),this.graphics3DSymbol!=null&&await this.graphics3DSymbol.load()}createGraphics3DGraphic(e){return this.graphics3DSymbol!=null?this.graphics3DSymbol.createGraphics3DGraphic(e,this):null}get complexity(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.complexity:ZRe}globalPropertyChanged(e,r){return this.graphics3DSymbol!=null&&this.graphics3DSymbol.globalPropertyChanged(e,r)}applyRendererDiff(e,r){return this.graphics3DSymbol!=null?this.graphics3DSymbol.applyRendererDiff(e,r):Xn.RecreateSymbol}prepareSymbolPatch(e){this.graphics3DSymbol!=null&&this.graphics3DSymbol.prepareSymbolPatch(e)}updateGeometry(e,r){return this.graphics3DSymbol!=null&&this.graphics3DSymbol.updateGeometry(e,r)}updateTransform(e,r,i,n){var s;return((s=this.graphics3DSymbol)==null?void 0:s.updateTransform(e,r,i,n))??!1}onRemoveGraphic(){}getFastUpdateStatus(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}}destroy(){this.graphics3DSymbol!=null&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,super.destroy()}get destroyed(){return this.graphics3DSymbol===void 0}};function yne(t){return t instanceof H2t?t.graphics3DSymbol:t instanceof j2t?t:null}const rI=()=>re.getLogger("esri.views.3d.layers.graphics.labelPlacement");let W2t=class{constructor(e,r,i,n=null){this.graphics3DGraphic=e,this.labelSymbol=r,this.labelClass=i,this.disablePlacement=n}};function ige(t){const e=tTt(t);if(e==null)return null;const r=q2t(t,e);if(r==null)return null;const i=r.anchor,n=!!e.hasLabelVerticalOffset,s=e.verticalOffset;return X2t(new cNe(s,i,n),r,t)}function q2t(t,e){if(e.anchor)return e;const r=t.labelClass.labelPlacement,i=Vp[r],n=i||U8(t);return r&&!i&&rI().warnOncePerTick(`the requested label placement '${r}' is currently unsupported in SceneView.`),Y2t(n,t)}function _ne(t){const e=t.graphics3DGraphic.graphics3DSymbol,r=yne(e);return r!=null?r.symbol.symbolLayers.at(0):null}function Y2t(t,e){const r=e.graphics3DGraphic.graphic.geometry;if(r==null)return null;if(e.disablePlacement!=null)return e.labelClass.labelPlacement?(rI().warnOncePerTick(nge(t==null?void 0:t.placement,e.disablePlacement.logEntityDescription)),U8(e)):t;const i=r.type;switch(i){case"polyline":case"polygon":case"extent":case"multipoint":if(e.labelClass.labelPlacement)return rI().warnOncePerTick(nge(t==null?void 0:t.placement,`'${i}' geometries`)),U8(e);break;case"point":case"mesh":return t}return t}function nge(t,e){return`the requested label placement '${t}' is currently unsupported for ${e} in SceneView.`}function U8(t){const e=t.graphics3DGraphic.graphic.geometry;if(e==null)return null;switch(e.type){case"polyline":case"extent":case"multipoint":return{placement:"center-center",normalizedOffset:zn,anchor:"center"};case"polygon":{const r=_ne(t);return r!=null&&r.type==="extrude"?Vp["above-center"]:{placement:"center-center",normalizedOffset:zn,anchor:"center"}}case"point":case"mesh":return Vp["above-center"];default:return}}function X2t(t,e,r){const i=r.graphics3DGraphic.graphic.geometry;if(i==null)return null;switch(i.type){case"point":J2t(t,e,r);break;case"polygon":Z2t(t,e,r);break;case"mesh":vne(t,e,r.graphics3DGraphic.layers[0])}const n=V1t-I8;return t.screenOffset[0]+=n*e.normalizedOffset[0],t.screenOffset[1]+=n*e.normalizedOffset[1],t}function Z2t(t,e,r){const i=_ne(r);if(i!=null)switch(i.type){case"extrude":{const n=r.graphics3DGraphic.layers[0];n!=null?(n.getBoundingBoxObjectSpace(MR),kp(MR,t.translation),t.translation[2]=kv(MR)/2):ie(t.translation,0,0,0),vne(t,e,n);break}}}function J2t(t,e,r){const i=_ne(r);if(i==null)return;const n=r.graphics3DGraphic.layers[0];switch(n!=null?n.getCenterObjectSpace(t.translation):ie(t.translation,0,0,0),i.type){case"icon":case"text":Q2t(t,e,r,n);break;case"object":vne(t,e,n)}}function Q2t(t,e,r,i){const{graphics3DGraphic:n}=r,s=i!=null?i.getScreenSize():null;if(n.isDraped||s==null)t.hasLabelVerticalOffset||t.anchor==="center"||(Vp[r.labelClass.labelPlacement]&&rI().warnOncePerTick(`the requested placement '${e.placement}' is currently unsupported for draped graphics`),t.anchor="center");else{const o=K2t(r);t.screenOffset[0]=s[0]/2*(e.normalizedOffset[0]-o[0]);const a=s[1]/2*(e.normalizedOffset[1]-o[1]);t.hasLabelVerticalOffset?(t.centerOffset[1]=a,t.centerOffsetUnits="screen"):t.screenOffset[1]=a}}function K2t(t,e=rTt){const{graphics3DGraphic:r}=t,i=r.layers[0],n=(i==null?void 0:i.stageObject.geometries[0].material)??null;if(n&&n instanceof p3){const s=n.parameters.anchorPosition;e[0]=2*(s[0]-.5),e[1]=2*(s[1]-.5)}else e[0]=0,e[1]=0;return e}function vne(t,e,r){const i=r!=null?r.getBoundingBoxObjectSpace(MR):MR,n=Ce(i[3]-i[0],i[4]-i[1],i[5]-i[2]),s=Math.sqrt(n[0]*n[0]+n[1]*n[1]);t.centerOffset[0]=s/2*e.normalizedOffset[0];const o=t.translation[2],a=n[2]/2*e.normalizedOffset[1];t.translation[2]=0,t.elevationOffset=o+a;const l=Te(n);t.centerOffset[2]=l/2*e.normalizedOffset[2]}function eTt(t){return t==="above-center"}function tTt(t){const e=t.labelClass.labelPlacement,{labelSymbol:r,graphics3DGraphic:i}=t,n=yne(i.graphics3DSymbol),s=(n==null?void 0:n.symbol.type)==="point-3d"?n.symbol:null,o=Vp[e]||U8(t);return s!=null&&s.supportsCallout()&&s.hasVisibleVerticalOffset()&&!i.isDraped?{placement:null,hasLabelVerticalOffset:!1,verticalOffset:sge(s.verticalOffset),anchor:null,normalizedOffset:null}:!r||!r.hasVisibleVerticalOffset()||s!=null&&s.supportsCallout()&&s.verticalOffset&&!i.isDraped?{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}:o&&eTt(o.placement)?{placement:"above-center",verticalOffset:sge(r.verticalOffset),anchor:"bottom",normalizedOffset:[0,o.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(rI().errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+e+" placement)"),null)}function sge(t){const{screenLength:e,minWorldLength:r,maxWorldLength:i}=t;return{screenLength:e,minWorldLength:r,maxWorldLength:i}}const Vp={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},oge={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const t in oge){const e=oge[t],r=Vp[t];e.forEach(i=>{Vp[i]=r})}Object.freeze&&(Object.freeze(Vp),Object.keys(Vp).forEach(t=>{var e;Object.freeze(Vp[t]),Object.freeze((e=Vp[t])==null?void 0:e.normalizedOffset)}));const rTt=[0,0],MR=vs();let age=class{constructor(e){this._stage=e,this._materials=new Map}get(e){return this._materials.get(e)}add(e,r){this._materials.set(e,r),this._stage.add(r)}dispose(){this._stage.removeMany(Array.from(this._materials.values())),this._materials.clear()}},lge=class{constructor(e,r){this.labelingContext=e,this.graphics3DGraphic=r,this.hasGraphics3DResources=!1,this.visible=!1,this.addedToTextureAtlas=!1,this.textInitialized=!1,this.textRenderers=new Array,this.textLabelPlacements=new Array}},iTt=class{constructor(e,r,i,n,s){this.labelClass=e,this.graphics3DSymbol=r,this.graphics3DCalloutSymbolLayer=i,this.textRenderParameters=n,this.labelFunction=s,this.calloutSymbolLayerIndex=0}},nTt=class{constructor(e,r,i,n,s,o,a,l){this.layer=r,this.graphics3DCore=i,this.scaleVisibility=n,this.emptySymbolLabelSupported=s,this.elevationInfoOverride=o,this.disablePlacement=a,this.active=l,this.labelClassAbortController=new AbortController,this.labelClassContexts=new Array,this.graphics=new Map,this.labelsToInitialize=new Map,this.stageLayer=new Z$e(e,{pickable:!0,disableOctree:!0},r.uid)}destroy(){this.stageLayer.destroy()}},Sw=class extends Ae{constructor(e){super(e),this._dirty=!1,this._labels=new Map,this._labelingContexts=new Array}setup(){this.dispose(),this.addHandles([he(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},()=>this.setDirty()),he(()=>{var e;return(e=this.view.state)==null?void 0:e.rasterPixelRatio},()=>this._resetAllLabels()),this.view.resourceController.scheduler.registerTask(bt.LABELER,this)]),this._textTextureAtlas=new yx({view:this.view}),this._hudMaterialCollection=new age(this.view._stage),this._calloutMaterialCollection=new age(this.view._stage)}dispose(){this.removeAllHandles(),this._textTextureAtlas=gt(this._textTextureAtlas),this._hudMaterialCollection=gt(this._hudMaterialCollection),this._calloutMaterialCollection=gt(this._calloutMaterialCollection),this._labelingContexts.length=0,this._labels.clear()}destroy(){this.dispose(),Ud.graphic=null,Ud.renderingInfo=null,Ud.layer=null}_activateLabelingContext(e){e.graphics.forEach((r,i)=>{const n=new lge(e,r);this._labels.set(i,n),e.labelsToInitialize.set(i,n),r.setVisibilityFlag(vo.LABEL,sa.USER,!0)}),e.active=!0}_deactivateLabelingContext(e){e.graphics.forEach((r,i)=>{r.setVisibilityFlag(vo.LABEL,sa.USER,!1),this.setLabelGraphicVisibility(r,!1),r.clearLabelGraphics(),this._labels.delete(i)}),e.active=!1}_addLabelTextureToAtlas(e){for(const r of e.graphics3DGraphic.labelLayers){if(!r._labelClass)continue;const i=e.textRenderers[r._labelIndex];i&&(this._textTextureAtlas.addTextTexture(i,r.stageObject),e.addedToTextureAtlas=!0)}}_removeLabelTextureFromAtlas(e){for(const r of e.graphics3DGraphic.labelLayers){if(!r._labelClass)continue;const i=e.textRenderers[r._labelIndex];i!=null&&(this._textTextureAtlas.removeTextTexture(i,r.stageObject),e.addedToTextureAtlas=!1)}}get running(){return this.view.ready&&(this._dirty||this.deconflictor.running)}runTask(e){return this._updateLabels(e),!this._dirty&&this.deconflictor.running&&this.deconflictor.runTask(e),Ho}_updateLabels(e){if(this._dirty){this._dirty=!1;for(const r of this._labelingContexts)if(r.active)if(HG(r))this._dirty=!0;else if(WG(r.labelClassContexts)){if(r.labelClassContexts===null){this._deactivateLabelingContext(r);continue}this._createLabelClassContext(r),this._dirty=!0}else Zh(r.labelsToInitialize,(i,n)=>(this._ensureGraphics3DResources(i)&&(this._labels.set(n,i),this.deconflictor.setDirty(),e.madeProgress()),(i.visible&&i.textInitialized||!i.visible&&i.hasGraphics3DResources)&&(r.labelsToInitialize.delete(n),e.madeProgress()),e.done))&&(this._dirty=!0);this._dirty||this.notifyChange("updating")}}async _createLabelClassContextAsync(e){var o,a;const r=(o=e.labelClassAbortController)==null?void 0:o.signal;e.layer.when&&await e.layer.when(),vt(r),e.scaleVisibility&&e.scaleVisibility.updateScaleRangeActive();const i=e.graphics3DCore,n=i.layer,s=(a=n.labelingInfo)==null?void 0:a.filter(l=>!!l.symbol);!s||s.length===0||(await jz(s,async(l,c)=>{const u=l.symbol,h=yne(i.getOrCreateGraphics3DSymbol(u));if(h==null)return void re.getLogger(this).error("Failed to create Graphics3DSymbol for label");await h.load(),vt(r);let p=null;zte(u)&&u.hasVisibleCallout()&&(p=_pt(u,i.symbolCreationContext),await p.load(),vt(r));const f=await sg(Pht(l,e.layer.fieldsIndex,this.view.spatialReference));if(vt(r),f.ok===!0){const g=await this._createTextRenderParameters(h.symbol);vt(r),e.labelClassContexts[c]=new iTt(l,h,p,g,f.value)}else re.getLogger(this).error(`Label expression failed to evaluate: ${f.error}`)}),vt(r))}async _createLabelClassContext(e){return e.labelClassPromise==null&&(e.labelClassPromise=this._createLabelClassContextAsync(e).catch(r=>{if(_s(r))throw r;e.labelClassContexts.length=0}).then(()=>{e.labelClassAbortController=null,this.notifyChange("updating")}).catch(()=>{}),this.notifyChange("updating")),e.labelClassPromise}async _createTextRenderParameters(e){const r=e.symbolLayers.at(0);return(r==null?void 0:r.type)!=="text"?null:hNe.fromSymbol(r,this.view.state.rasterPixelRatio)}_destroyLabelClassContext(e){for(const i of e.labelClassContexts)--i.graphics3DSymbol.referenced;const r=e.labelClassAbortController;e.labelClassAbortController=new AbortController,wl(r),e.labelClassContexts.length=0,e.labelClassPromise=null,this.notifyChange("updating")}_createTextSymbolGraphic(e,r,i,n,s,o){const a=new uNe(i,nme(i.anchor),X1t(i.anchor),e.text,lr(e.displayWidth,e.displayHeight));return Ud.graphic=r,Ud.renderingInfo=null,Ud.layer=n,s.createLabel(Ud,a,this._hudMaterialCollection,this._textTextureAtlas,()=>{const l=ige(o);return l?l.elevationOffset:null})}_createLineCalloutGraphic(e,r,i,n,s){Ud.graphic=e,Ud.layer=s;const o=n.screenOffset[0];return Ud.renderingInfo=new gpt(null,r,n.translation,n.centerOffset,o,n.centerOffsetUnits,n.elevationOffset,this._calloutMaterialCollection),i.createGraphics3DGraphic(Ud)}_ensureGraphics3DResources(e){var c;if(e.hasGraphics3DResources)return!1;const r=e.graphics3DGraphic;if(r.destroyed)return!1;this._ensureTextTextureResources(e);const i=e.labelingContext,n=i.labelClassContexts;if(WG(n)||!i.emptySymbolLabelSupported&&r.layers.length===0)return!1;let s=!1;const o=r.graphic,a=i.layer,l=n4(i.layer);for(let u=0;u<n.length;u++){const h=e.textRenderers[u],p=e.textLabelPlacements[u];if(h==null||p==null)continue;const f=n[u],g=f.graphics3DSymbol,_=g.symbol&&g.symbol.type==="label-3d"?g.symbol:null,v=g.symbolLayers[0];if(!v)continue;v.setElevationInfoOverride(i.elevationInfoOverride);const b=new W2t(r,_,f.labelClass),w=this._createTextSymbolGraphic(h,o,p,a,v,b);if(w==null)return!1;w._labelClass=f.labelClass,w._labelIndex=u,r.addLabelGraphic(w,i.stageLayer),r.deconflictionPriority=((c=f.textRenderParameters)==null?void 0:c.definition.size)??0,r.setVisibilityFlag(vo.LABEL,sa.USER,l),r.setVisibilityFlag(vo.LABEL,sa.SCALE_RANGE,!0),r.setVisibilityFlag(vo.LABEL,sa.DECONFLICTION,!1),s=!0;const x=f.graphics3DCalloutSymbolLayer;if(x&&p.hasLabelVerticalOffset){x.setElevationInfoOverride(i.elevationInfoOverride);const S=this._createLineCalloutGraphic(o,_,x,p,a);S!=null&&(f.calloutSymbolLayerIndex=r.labelLayers.length,r.addLabelGraphic(S,i.stageLayer))}break}return i.scaleVisibility&&s&&i.scaleVisibility.updateGraphicLabelScaleVisibility(r),e.hasGraphics3DResources=!0,!0}_destroyGraphics3DResources(e){const r=e.labelingContext.labelClassContexts;for(const i of e.graphics3DGraphic.labelLayers){if(i._labelClass==null)continue;const n=r[i._labelIndex].graphics3DSymbol.symbolLayers[0];n==null||n.onRemoveGraphic(i)}e.graphics3DGraphic.deconflictionPriority=0,e.graphics3DGraphic.clearLabelGraphics(),e.hasGraphics3DResources=!1}_ensureTextTextureResources(e){var s;if(e.textInitialized)return;const r=e.labelingContext,i=r.labelClassContexts;if(WG(i))return;const n=e.graphics3DGraphic.graphic;for(let o=0;o<i.length;o++){const a=i[o];if(e.textRenderers[o]=null,e.textLabelPlacements[o]=null,(a==null?void 0:a.textRenderParameters)==null)continue;const l=a.labelFunction;let c;if(l.type==="arcade")try{const w=l.needsHydrationToEvaluate()?hht(n,r.layer):n;c=l.evaluate(w)}catch{c=null}else c=l.evaluate(n);if(c==null||c===""||/^\s+$/.test(c))continue;const u=a.graphics3DSymbol,h=((s=u.symbol)==null?void 0:s.type)==="label-3d"?u.symbol:null;if(!u.symbolLayers[0])continue;const p=e.graphics3DGraphic,f=a.labelClass,g=r.disablePlacement,_=ige({graphics3DGraphic:p,labelSymbol:h,labelClass:f,disablePlacement:g});if(_==null)continue;const v=nme(_.anchor),b=BLe(v);e.textRenderers[o]=new zLe(c,b,a.textRenderParameters,yx.maxSize),e.textLabelPlacements[o]=_}e.textInitialized=!0}_destroyTextTextureResources(e){e.textInitialized=!1,e.textRenderers.length=0,e.textLabelPlacements.length=0}_addGraphic(e,r){const i=r.graphic.uid;if(e.graphics.set(i,r),e.active){const n=new lge(e,r);this._labels.set(i,n),e.labelsToInitialize.set(i,n)}this.setDirty(),this.deconflictor.setDirty()}_removeGraphic(e,r){const i=r.graphic.uid,n=this._labels.get(i);e.graphics.delete(i),n&&(this._destroyGraphic(n,i),e.labelsToInitialize.delete(i),this.setDirty(),this.deconflictor.setDirty())}_destroyGraphic(e,r){this._labels.delete(r),e.addedToTextureAtlas&&this._removeLabelTextureFromAtlas(e),this._destroyTextTextureResources(e),e.hasGraphics3DResources&&this._destroyGraphics3DResources(e)}async _labelingInfoChange(e,r){if(!r)return this._visibilityInfoChange(e),this._resetLabels(e),this._createLabelClassContext(e);for(const i of r){const n=e.graphics.get(i);n&&(this._removeGraphic(e,n),this._addGraphic(e,n))}}_globalPropertyChanged(e,r){for(const i of r.labelClassContexts){const n=new Map;r.graphics.forEach(o=>n.set(o.graphic.uid,o));const s=o=>o.labelLayers[0];if(i.graphics3DSymbol.symbolLayers[0].globalPropertyChanged(e,n,s),i.graphics3DCalloutSymbolLayer){const o=a=>a.labelLayers[i.calloutSymbolLayerIndex];i.graphics3DCalloutSymbolLayer.globalPropertyChanged(e,n,o)}}}_visibilityInfoChange(e){const r=n4(e.layer);r&&!e.active&&this._activateLabelingContext(e),!r&&e.active&&this._deactivateLabelingContext(e),this.setDirty()}_resetAllLabels(){for(const e of this._labelingContexts)this._resetLabels(e)}_resetLabels(e){e.graphics.forEach((r,i)=>{const n=this._labels.get(i);n&&(this._destroyGraphic(n,i),n.visible=!1,e.labelsToInitialize.set(i,n))}),this._destroyLabelClassContext(e),this.setDirty(),this.deconflictor.setDirty()}_findLabelingContext(e){for(const r of this._labelingContexts)if(r.graphics3DCore===e)return r;return null}addGraphicsOwner(e,r,i){const n=i&&i.emptySymbolLabelSupported||!1,s=(i==null?void 0:i.elevationInfoOverride)||null,o=(i==null?void 0:i.disablePlacement)||null;if(this._findLabelingContext(e))return;const a=e.layer,l=new nTt(this.view._stage,a,e,r,n,s,o,n4(a));return this._labelingContexts.push(l),this.setDirty(),{addGraphic:c=>this._addGraphic(l,c),removeGraphic:c=>this._removeGraphic(l,c),featureReductionChange:()=>{},layerLabelsEnabled:()=>n4(l.layer),labelingInfoChange:c=>this._labelingInfoChange(l,c),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",l),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",l),visibilityInfoChange:()=>this._visibilityInfoChange(l),reset:()=>this._resetLabels(l),clear:()=>{}}}removeGraphicsOwner(e){const r=this._findLabelingContext(e);if(!r)return;const i=this._labelingContexts.indexOf(r);this._labelingContexts.splice(i,1),r.graphics.forEach(n=>this._removeGraphic(r,n)),r.destroy(),this.setDirty()}setLabelGraphicVisibility(e,r){const i=e.graphic.uid,n=this._labels.get(i);n&&n.visible!==r&&(r&&!n.addedToTextureAtlas?(this._addLabelTextureToAtlas(n),n.textInitialized||n.labelingContext.labelsToInitialize.set(i,n)):!r&&n.addedToTextureAtlas&&this._removeLabelTextureFromAtlas(n),n.visible=r,this.setDirty())}setDirty(){!this._dirty&&this._labelingContexts.length>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){var e;return this._dirty||((e=this._textTextureAtlas)==null?void 0:e.updating)||this.deconflictor.updating||this._labelingContexts.some(r=>HG(r))}get updatingProgress(){if(!this.updating||!this._textTextureAtlas)return 1;const e=this._labelingContexts.length>0?this._labelingContexts.reduce((r,i)=>r+(HG(i)?0:1),0)/this._labelingContexts.length:1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*e+.5*this.deconflictor.updatingProgress}get test(){return{textTextureAtlas:this._textTextureAtlas,resetAllLabels:()=>this._resetAllLabels()}}};function HG(t){return!!t.labelClassPromise&&!!t.labelClassAbortController}function WG(t){return!t||t.length===0}function n4(t){var e;return t.labelsVisible===!0&&!!((e=t.labelingInfo)!=null&&e.some(r=>!!r.symbol))}d([m({constructOnly:!0})],Sw.prototype,"view",void 0),d([m({constructOnly:!0})],Sw.prototype,"deconflictor",void 0),d([m()],Sw.prototype,"_textTextureAtlas",void 0),d([m({type:Boolean,readOnly:!0})],Sw.prototype,"updating",null),Sw=d([V("esri.views.3d.layers.graphics.Labeler")],Sw);const Ud=new ypt(null,null,null);let hO=class $S{constructor(e,r,i,n=null){this.lij=[0,0,0],this.extent=Wt(),this.resolution=0,this.loadPriority=0,this.measures={visibility:Wl.VISIBLE_ON_SURFACE,screenRect:Wt(),distance:0,shouldSplit:!1},this.used=!1,n&&this.acquire(e,r,i,n)}acquire(e,r,i,n){this.tilingScheme=n,this.id=$S.id(e,r,i),this.lij[0]=e,this.lij[1]=r,this.lij[2]=i,n.getExtent(e,r,i,this.extent),this.resolution=n.resolutionAtLevel(e)}release(){this.tilingScheme=null}getChildren(e){const r=this.lij[0]+1,i=2*this.lij[1],n=2*this.lij[2];return e?(e[0].acquire(r,i,n,this.tilingScheme),e[1].acquire(r,i+1,n,this.tilingScheme),e[2].acquire(r,i,n+1,this.tilingScheme),e[3].acquire(r,i+1,n+1,this.tilingScheme),e):[new $S(r,i,n,this.tilingScheme),new $S(r,i+1,n,this.tilingScheme),new $S(r,i,n+1,this.tilingScheme),new $S(r,i+1,n+1,this.tilingScheme)]}copyMeasurementsFrom(e){this.measures.visibility=e.measures.visibility,this.measures.shouldSplit=e.measures.shouldSplit,this.measures.distance=e.measures.distance,ey(e.measures.screenRect,this.measures.screenRect)}static id(e,r,i){return`${e}/${r}/${i}`}};var Wl;(function(t){t[t.INVISIBLE=0]="INVISIBLE",t[t.VISIBLE_WHEN_EXTENDED=1]="VISIBLE_WHEN_EXTENDED",t[t.VISIBLE_ON_SURFACE=2]="VISIBLE_ON_SURFACE"})(Wl||(Wl={}));function sTt(t,e,r,i,n,s,o=1){const a=lv(e,n,b9);if(a==null)return!1;if(a===zi){if(t===i&&r===s)return!0;const c=r+o;for(let u=r,h=s;u<c;++u,++h)ce(i[h],t[u]);return!0}const l=r+o;for(let c=r,u=s;c<l;++c,++u)a(t[c],0,i[u],0);return!0}const yNe=.5*Math.PI,oTt=yNe/Math.PI*180;let aTt=class{constructor(e){this._renderCoordsHelper=e.renderCoordsHelper,this._extent=new Array(4),this._planes=new Array(6),this._maxSpan=0,this._center={origin:C(),direction:C()};for(let r=0;r<4;r++)this._extent[r]={origin:C(),direction:C(),cap:{next:null,direction:C()}},this._planes[r]=zr();this._planes[si.NEAR]=zr(),this._planes[si.FAR]=zr(),this._planesWithoutFar=this._planes.slice(0,5)}update(e,r,i,n=!0){const s=this._extent;this._toRenderBoundingExtent(e,r,i),fe(this._center.origin,s[0].origin,s[2].origin),ne(this._center.origin,this._center.origin,.5),this._renderCoordsHelper.worldUpAtPosition(this._center.origin,this._center.direction),n||ne(this._center.direction,this._center.direction,-1);for(let o=0;o<4;o++){const a=s[o];this._renderCoordsHelper.worldUpAtPosition(a.origin,a.direction);const l=s[o===3?0:o+1];a.cap.next=l.origin,fy(a.cap.direction,a.origin,l.origin),C$(a.direction,a.cap.direction,a.origin,this._planes[o]),n||ne(a.direction,a.direction,-1)}C$(s[0].cap.direction,s[1].cap.direction,s[0].origin,this._planes[si.NEAR]),n?lq(this._planes[si.NEAR],this._planes[si.FAR]):(A9(this._planes[si.FAR],this._planes[si.NEAR]),lq(this._planes[si.NEAR],this._planes[si.NEAR])),this._maxSpan=Math.max(Math.abs(e[0]-e[2]),Math.abs(e[1]-e[3])),this._maxSpanSpatialReference=r,this._minGlobalAltitude=.9*Br(this._maxSpanSpatialReference).radius}isVisibleInFrustum(e,r,i=!1){if(e==null)return!1;if(this._renderCoordsHelper.viewingMode===De.Global){const s=this._maxSpanSpatialReference.isGeographic?oTt:yNe*r;if(this._maxSpan>s)return!0;if(e.altitude!=null&&e.altitude>=this._minGlobalAltitude)return this._isVisibleInFrustumGlobal(e)}if(this._maxSpan===0){const s=this._extent[0];return!(i||!e.intersectsRay(eh(s.origin,s.direction)))}for(let s=0;s<this._extent.length;s++){const o=this._extent[s];if(!i&&e.intersectsRay(eh(o.origin,o.direction))||e.intersectsLineSegment(Ax(o.origin,o.cap.next,cTt),o.cap.direction))return!0}const n=i?this._planes:this._planesWithoutFar;for(let s=0;s<e.lines.length;s++){const o=e.lines[s];if(Eot(n,o.origin,o.endpoint,o.direction))return!0}return!1}_toRenderBoundingExtentGlobal(e,r,i){gee(e,Bd),Bd[2]=i,La(r,Bd,qG,this._renderCoordsHelper.spatialReference),os(cge,qG),Li(gc);for(const{x0:s,x1:o,y0:a,y1:l}of lTt)for(let c=0;c<5;c++){const u=c/4;Bd[0]=Rt(e[s],e[o],u),Bd[1]=Rt(e[a],e[l],u),Bd[2]=i,ka(Bd,r,Bd,this._renderCoordsHelper.spatialReference),Ge(Bd,Bd,cge),lf(gc,Bd)}ie(this._extent[0].origin,gc[0],gc[1],gc[2]),ie(this._extent[1].origin,gc[3],gc[1],gc[2]),ie(this._extent[2].origin,gc[3],gc[4],gc[2]),ie(this._extent[3].origin,gc[0],gc[4],gc[2]);for(let s=0;s<4;++s)Ge(this._extent[s].origin,this._extent[s].origin,qG)}_toRenderBoundingExtentLocal(e,r,i){S9(e,r,zg,this._renderCoordsHelper.spatialReference),ie(this._extent[0].origin,zg[0],zg[1],i),ie(this._extent[1].origin,zg[2],zg[1],i),ie(this._extent[2].origin,zg[2],zg[3],i),ie(this._extent[3].origin,zg[0],zg[3],i)}_toRenderBoundingExtent(e,r,i){switch(this._renderCoordsHelper.viewingMode){case De.Global:this._toRenderBoundingExtentGlobal(e,r,i);break;case De.Local:this._toRenderBoundingExtentLocal(e,r,i);break;default:this._renderCoordsHelper.viewingMode}}_isVisibleInFrustumGlobal(e){if(bi(e.planes[si.NEAR],this._center.origin)<0&&de(this._center.direction,e.direction)<0)return!0;for(let r=0;r<4;r++){const i=this._extent[r];if(bi(e.planes[si.NEAR],i.origin)<0&&de(i.direction,e.direction)<0)return!0}return!1}};const lTt=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],Bd=C(),qG=xe(),cge=xe(),gc=vs(),zg=Wt(),cTt=yf();let uTt=class{constructor(e){this._renderCoordsHelper=e,this._surfaceElevation=0,this._cache=new Map,this._frustumBoundingSphereCenter=C(),this._frustumBoundingSphereRadius=0,this._frustum=new u1(e),this._extendedFrustum=new u1(e),this._intersector=new aTt({renderCoordsHelper:e}),this._renderCoordsHelper=e}begin(e,r){this._surfaceElevation=r,this._aboveGround=this._renderCoordsHelper.getAltitude(e.eye)>r,this._frustum.update(e),this._shortenFrustumFarPlane(this._frustum),this._updateExtendedFrustum(e),this._updateFrustumBoundingSphere()}end(){this._cache.clear()}calculate(e){const r=this._renderCoordsHelper.viewingMode===De.Global&&e.lij[0]>=hTt&&e.lij[0]<dTt,i=this._getOrCalculateSingleTileVisibility(e,!r);return i!==Wl.INVISIBLE&&r?this._calculateAggregatedChildrenVisibility(e):i}_shortenFrustumFarPlane(e){const r=u1.nearFarLineIndices,i=e.mutablePoints;for(const n of r){const[s,o]=n,a=i[s],l=i[o];ye(fu,l,a),ne(fu,fu,fTt),fe(i[o],a,fu)}e.updatePoints(i)}_calculateAggregatedChildrenVisibility(e){let r=Wl.INVISIBLE;const i=this._cache.get(e.id);if(i!=null)return i;const n=pge.acquire();e.getChildren(n);for(const s of n){const o=this.calculate(s);if(o!==Wl.INVISIBLE&&(r=o,o===Wl.VISIBLE_ON_SURFACE))break}return pge.release(n),this._cache.set(e.id,r),r}_getOrCalculateSingleTileVisibility(e,r){const i=this._cache.get(e.id);if(i!=null)return i;const n=this._calculateSingleTileVisibility(e);return r&&this._cache.set(e.id,n),n}_calculateSingleTileVisibility(e){return!this._aboveGround&&this._renderCoordsHelper.viewingMode===De.Global&&e.lij[0]<pTt?this._calculateSingleTileVisibilitySided(e,!1)===Wl.INVISIBLE?this._calculateSingleTileVisibilitySided(e,!0):void 0:this._calculateSingleTileVisibilitySided(e,this._aboveGround)}_isTileVisibleInFrustum(e){return this._renderCoordsHelper.viewingMode===De.Local?this._isTileVisibleInFrustumLocal(e):this._isTileVisibleInFrustumGlobal(e)}_updateFrustumBoundingSphere(){const e=this._frustum,r=e.origin,i=ETt;pe(i,e.direction);const n=e.points,s=PTt;Yi(s,n[4],r);const o=.5*de(s,s)/de(i,s),a=this._frustumBoundingSphereCenter;Xs(a,r,i,o);const l=1+o;this._frustumBoundingSphereRadius=l}_isTileVisibleInFrustumLocal(e){const r=e.tilingScheme.spatialReference,i=e.extent,n=this._renderCoordsHelper.spatialReference,s=vTt;if(s[0]=i[0],s[1]=i[1],s[2]=0,s[3]=i[2],s[4]=i[3],s[5]=0,!Ji(s,r,0,s,n,0,2))return!1;const o=mge;ie(o[0],s[0],s[1],0),ie(o[1],s[3],s[1],0),ie(o[2],s[3],s[4],0),ie(o[3],s[0],s[4],0);const a=gge;ie(a,.5*(s[0]+s[3]),.5*(s[1]+s[4]),.5*(s[2]+s[5]));const l=bTt;ie(l,0,0,1);const c=.5*D0(o[0],o[2]),u=this._frustum,h=this._frustumBoundingSphereRadius,p=this._frustumBoundingSphereCenter,f=MTt;Yi(f,p,a);const g=de(l,f),_=ATt;if(Xs(_,a,l,g),D0(_,p)>c+h)return!1;const v=_Tt,b=g+h,w=g-h;for(let x=0;x<4;++x)Xs(v[x],o[x],l,b),Xs(v[x+4],o[x],l,w);return!gJ(u.planes,v,8)}_isTileVisibleInFrustumGlobal(e){const r=e.tilingScheme.spatialReference,i=e.extent,n=this._renderCoordsHelper.spatialReference;if(e.lij[0]<_Ne)return!0;const s=mge,o=.5*(i[0]+i[2]);if(ie(s[0],i[0],i[1],0),ie(s[1],i[2],i[1],0),ie(s[2],i[2],i[3],0),ie(s[3],i[0],i[3],0),ie(s[4],o,i[1],0),ie(s[5],o,i[3],0),!sTt(s,r,0,s,n,0,6))return!1;const a=s[0][2]>0,l=s[3][2]<0,c=a||l,u=Br(n).radius;if(c){const I=Ce(0,0,1),F=wTt;U_(F,I,s[0]);const G=xTt;if(U_(G,I,s[1]),a){const H=yge,Z=s[4],te=_ge;U_(te,Z,I),U_(H,te,Z);const me=s[0];Je(me,F,H),pA(me,u);const Me=s[1];Je(Me,G,H),pA(Me,u)}else if(l){const H=yge,Z=s[5],te=_ge;U_(te,Z,I),U_(H,Z,te);const me=s[3];Je(me,H,F),pA(me,u);const Me=s[2];Je(Me,H,G),pA(Me,u)}}const h=gge;{const I=ITt;Yi(I,s[3],s[0]),pe(I,I);const F=LTt;fe(F,s[0],s[3]),ne(F,F,.5);const G=-de(F,I),H=DTt,Z=NTt;fe(H,s[0],s[1]),ne(H,H,.5),fe(Z,s[2],s[3]),ne(Z,Z,.5);const te=FTt;Yi(te,Z,H),pe(te,te);const me=-(G+de(I,H))/de(I,te);Xs(h,H,te,me),pA(h,u)}const p=this._frustumBoundingSphereRadius,f=this._frustumBoundingSphereCenter,g=this._frustum,_=g.planes;if(s.some(I=>g.intersectsPoint(I))||g.intersectsPoint(h))return!0;const v=TTt;pe(v,h);const b=OTt;Yi(b,f,vge);const w=de(b,v);if(w<-p)return!1;const x=CTt;pe(x,s[0]);const S=de(x,v);if(S<=0)return!0;const E=STt;ne(E,v,w);const A=D0(E,f),O=r.isWGS84,L=e.lij,z=O&&L[2]===2**L[0]-1,k=O&&L[2]===0,q=k?qTt:z?HTt:GTt,B=k?YTt:z?WTt:jTt,J=g.points;{const I=s,F=XTt,G=kTt,H=zTt,Z=vge;for(const te of q){const me=I[te];if(fge(G,I[(te+1)%4],me),fge(H,Z,me),U_(F,H,G),yTt(F,J,1))return!1}}let W=null;if(w<2*p){const I=2.5*p;if(A>S*I+p)return!1;const F=$Tt,G=I/S;for(let H=0;H<4;++H)ne(F[H],s[H],G/u);ie(F[4],0,0,0),W=F}else{const I=(w+p)/S,F=(w-p)/S,G=RTt;for(let H=0;H<4;++H){const Z=s[H];ne(G[H+4],Z,F/u),ne(G[H],Z,I/u)}W=G}if(gJ(_,W,W.length))return!1;const Y=g.lines,le=UTt,D=BTt;for(const I of B){pe(le,s[I]);for(const F of Y)if(pe(D,F.direction),KTt(D,le,W,J))return!1}return!0}_calculateSingleTileVisibilitySided(e,r){if(this._isTileVisibleInFrustum(e)){this._intersector.update(e.extent,e.tilingScheme.spatialReference,this._surfaceElevation,r);const i=Br(e.tilingScheme.spatialReference).radius;return this._intersector.isVisibleInFrustum(this._frustum,i,!0)?Wl.VISIBLE_ON_SURFACE:Wl.VISIBLE_WHEN_EXTENDED}return Wl.INVISIBLE}_updateExtendedFrustum(e){this._extendedFrustum.update(e),this._shortenFrustumFarPlane(this._extendedFrustum);const r=this._renderCoordsHelper.worldUpAtPosition(e.eye,fu);this._aboveGround||Bo(r,r);const i=Ks(-de(r,e.viewForward));if(this._hasExtendedFrustum=i>e.fovY/2,!this._hasExtendedFrustum)return;const n=this._extendedFrustumParameters(),s=this._extendedFrustum.mutablePoints;for(let o=0;o<4;o++){const a=n.pointIndices[o],l=s[a],c=this._renderCoordsHelper.getAltitude(l);if(n.needsAltitudeAdjustment(c)){switch(this._renderCoordsHelper.worldUpAtPosition(l,fu),a){case st.FAR_BOTTOM_LEFT:case st.FAR_TOP_LEFT:case st.NEAR_BOTTOM_LEFT:case st.NEAR_TOP_LEFT:cq(this._extendedFrustum.planes[si.LEFT],fu,fu);break;case st.FAR_BOTTOM_RIGHT:case st.FAR_TOP_RIGHT:case st.NEAR_BOTTOM_RIGHT:case st.NEAR_TOP_RIGHT:cq(this._extendedFrustum.planes[si.RIGHT],fu,fu)}ne(fu,fu,n.direction),this._renderCoordsHelper.intersectInfiniteManifold(eh(l,fu),n.zWithMargin,l)}}if(this._extendedFrustum.updatePoints(s),Ma(s[st.NEAR_BOTTOM_LEFT],s[st.NEAR_BOTTOM_RIGHT],s[st.NEAR_TOP_RIGHT],hge),Ma(s[st.NEAR_BOTTOM_RIGHT],s[st.NEAR_TOP_RIGHT],s[st.NEAR_TOP_LEFT],dge),de(hge,dge)<0){const o=this._extendedFrustum.mutablePoints;this._aboveGround?[o[st.NEAR_BOTTOM_LEFT],o[st.NEAR_BOTTOM_RIGHT]]=[o[st.NEAR_BOTTOM_RIGHT],o[st.NEAR_BOTTOM_LEFT]]:[o[st.NEAR_TOP_LEFT],o[st.NEAR_TOP_RIGHT]]=[o[st.NEAR_TOP_RIGHT],o[st.NEAR_TOP_LEFT]],this._extendedFrustum.updatePoints(o)}}_extendedFrustumParameters(){return this._aboveGround?this._extendedFrustumParametersAboveSurface():this._extendedFrustumParametersBelowSurface()}_extendedFrustumParametersAboveSurface(){const e=this._surfaceElevation-uge;return{zWithMargin:e,pointIndices:u1.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment:r=>r>e}}_extendedFrustumParametersBelowSurface(){const e=this._surfaceElevation+uge;return{zWithMargin:e,pointIndices:u1.planePointIndices.top,direction:1,needsAltitudeAdjustment:r=>r<e}}};const hTt=2,dTt=6,pTt=12,fTt=.95,uge=1,fu=C(),hge=zr(),dge=zr(),pge=new ua(Array,t=>{t.length!==4&&(t[0]=new hO,t[1]=new hO,t[2]=new hO,t[3]=new hO)},t=>{t[0].release(),t[1].release(),t[2].release(),t[3].release()});function U_(t,e,r){return Je(t,e,r),pe(t,t),t}function fge(t,e,r){return Yi(t,e,r),pe(t,t),t}function pA(t,e){return ne(t,t,e/Pc(t)),t}const mTt=[si.LEFT,si.RIGHT,si.BOTTOM,si.TOP,si.FAR];function gTt(t,e,r){for(let i=0;i<r;++i)if(bi(t,e[i])<0)return!1;return!0}function gJ(t,e,r){for(const i of mTt)if(gTt(t[i],e,r))return!0;return!1}const _Ne=3;function yTt(t,e,r){for(const i of e)if(de(i,t)<r)return!1;return!0}const _Tt=[C(),C(),C(),C(),C(),C(),C(),C()],vTt=[0,0,0,0,0,0],mge=[C(),C(),C(),C(),C(),C()],gge=C(),bTt=C(),yge=C(),wTt=C(),xTt=C(),_ge=C(),TTt=C(),STt=C(),CTt=C(),ETt=C(),PTt=C(),ATt=C(),MTt=C(),vge=Ce(0,0,0),OTt=C(),RTt=[C(),C(),C(),C(),C(),C(),C(),C()],$Tt=[C(),C(),C(),C(),C()],ITt=C(),LTt=C(),DTt=C(),NTt=C(),FTt=C(),kTt=C(),zTt=C(),UTt=C(),BTt=C(),VTt=C(),GTt=[0,1,2,3],jTt=[0,1,2,3],HTt=[0,1,3],WTt=[0,1,3],qTt=[1,2,3],YTt=[1,2,3],XTt=C();function ZTt(t,e,r){let i=1/0,n=-1/0;for(const s of r){const o=de(e,s);i=Math.min(i,o),n=Math.max(n,o)}t[0]=i,t[1]=n}function JTt(t,e,r,i){let n=1/0,s=-1/0;for(const o of i){const a=de(r,o);if(n=Math.min(n,a),s=Math.max(s,a),n<=e&&s>=t)return!1}return!0}const QTt=[0,0];function KTt(t,e,r,i){const n=VTt;U_(n,t,e);const s=QTt;return ZTt(s,n,r),JTt(s[0],s[1],n,i)}let eSt=class{constructor(e){this._camera=new Qe,this._focusOnMap=[0,0],this._screenRect=Wt(),this._tileSize=e.tileSize,this._renderCoordsHelper=e.renderCoordsHelper,this._tilingScheme=e.tilingScheme,this._visibility=new uTt(e.renderCoordsHelper)}begin(e,r,i){this._camera.copyFrom(e),this._surfaceElevation=i,this._focusOnMap[0]=r.x,this._focusOnMap[1]=r.y,o9(0,0,e.fullWidth,e.fullHeight,this._screenRect),this._visibility.begin(this._camera,i)}end(){this._visibility.end()}updateTile(e){e.measures.visibility=this._visibility.calculate(e),e.measures.distance=DGe(e.extent,this._focusOnMap),e.measures.visibility!==Wl.INVISIBLE&&this._updateScreenMeasure(e)}_updateScreenMeasure(e){const r=tSt,i=1<<r,n=e.measures.screenRect;Ku(n);let s=0;const o=e.lij,a=o[0],l=a+r,c=o[1]<<r,u=o[2]<<r,h=this._tileSizeWithBias(e),p=h*h,f=this._camera,{frustum:g,viewport:_}=f;if(this._renderCoordsHelper.viewingMode===De.Local||a>_Ne){const v=bge;this._tilingScheme.getExtent(o[0],o[1],o[2],v);const b=kT,w=nSt,x=Ku();for(let A=0;A<4;++A)this._toRenderCoords(v,Tge[A][0],Tge[A][1],w[A]),f.projectToScreen(w[A],b[A]),mee(x,b[A]);const S=gJ(g,w,4),E=x[0]>_[2]||x[1]>_[3]||x[2]<_[0]||x[3]<_[1];if(S||E)return void(e.measures.shouldSplit=!1)}for(let v=0;v<i;v++)for(let b=0;b<i;b++)if(s+=this._computeScreenArea(l,c+v,u+b,n),s>p)return void(e.measures.shouldSplit=!0);e.measures.shouldSplit=!1}_tileSizeWithBias(e){return e.measures.visibility===Wl.VISIBLE_WHEN_EXTENDED?this._tileSize*rSt:this._tileSize}_computeScreenArea(e,r,i,n){this._tilingScheme.ensureMaxLod(e);const s=bge;this._tilingScheme.getExtent(e,r,i,s);const o=iSt;return this._toRenderCoords(s,0,3,o[0]),this._toRenderCoords(s,2,3,o[1]),this._toRenderCoords(s,2,1,o[2]),this._toRenderCoords(s,0,1,o[3]),this._computeTriangleScreenArea([o[0],o[1],o[2]],n)+this._computeTriangleScreenArea([o[2],o[1],o[3]],n)}_computeTriangleScreenArea(e,r){const i=this._camera.frustum[si.NEAR];let n=0,s=-1,o=-1;for(let a=0;a<3;++a)bi(i,e[a])>0?(n++,s===-1&&(s=a)):o===-1&&(o=a);if(n===0)return this._computeTriangleScreenAreaInside(e,r);if(n===1){const a=xge,l=(s+1)%3,c=(s+2)%3,u=s;ce(a[0],e[l]),ce(a[1],e[c]),o4(a[2],e[c],e[u],i);const h=this._computeTriangleScreenAreaInside(a,r);return o4(a[1],e[l],e[u],i),h+this._computeTriangleScreenAreaInside(a,r)}if(n===2){const a=xge,l=o;ce(a[0],e[l]);const c=(o+1)%3,u=(o+2)%3;return o4(a[1],e[l],e[c],i),o4(a[2],e[l],e[u],i),this._computeTriangleScreenAreaInside(a,r)}return 0}_computeTriangleScreenAreaInside(e,r){for(let i=0;i<3;i++)this._camera.projectToRenderScreen(e[i],wge),this._camera.renderToScreen(wge,kT[i]),V1(r,kT[i],r);return gst(kT[0],kT[1],kT[2])}_toRenderCoords(e,r,i,n){return s4[0]=e[r],s4[1]=e[i],s4[2]=this._surfaceElevation,this._renderCoordsHelper.toRenderCoords(s4,this._tilingScheme.spatialReference,n),n}};const tSt=2,rSt=5,kT=[pn(),pn(),pn(),pn()],bge=Wt(),s4=C(),iSt=[C(),C(),C(),C()],wge=oa(),xge=[C(),C(),C()];function o4(t,e,r,i){const n=bi(i,e),s=bi(i,r),o=Math.abs(s-n);ne(t,e,Math.abs(s)/o),Xs(t,t,r,Math.abs(n)/o)}const nSt=[C(),C(),C(),C()],Tge=[[0,3],[2,3],[2,1],[0,1]];function Pqt(t,e,r){if(t==null||r==null)return!1;let i=!0;return Ms[0]=t.xmin!=null?t.xmin:0,Ms[1]=t.ymin!=null?t.ymin:0,Ms[2]=t.zmin!=null?t.zmin:0,i=i&&Ji(Ms,t.spatialReference,0,e,r,0,1),Ms[0]=t.xmax!=null?t.xmax:0,Ms[1]=t.ymax!=null?t.ymax:0,Ms[2]=t.zmax!=null?t.zmax:0,i=i&&Ji(Ms,t.spatialReference,0,e,r,3,1),t.xmin==null&&(e[0]=-1/0),t.ymin==null&&(e[1]=-1/0),t.zmin==null&&(e[2]=-1/0),t.xmax==null&&(e[3]=1/0),t.ymax==null&&(e[4]=1/0),t.zmax==null&&(e[5]=1/0),i}function vNe(t,e,r){if(t==null||r==null)return!1;let i=!0;return Ms[0]=t.xmin!=null?t.xmin:0,Ms[1]=t.ymin!=null?t.ymin:0,Ms[2]=t.zmin!=null?t.zmin:0,i=i&&Ji(Ms,t.spatialReference,0,Ms,r,0,1),e[0]=Ms[0],e[1]=Ms[1],Ms[0]=t.xmax!=null?t.xmax:0,Ms[1]=t.ymax!=null?t.ymax:0,Ms[2]=t.zmax!=null?t.zmax:0,i=i&&Ji(Ms,t.spatialReference,0,Ms,r,0,1),e[2]=Ms[0],e[3]=Ms[1],t.xmin==null&&(e[0]=-1/0),t.ymin==null&&(e[1]=-1/0),t.xmax==null&&(e[2]=1/0),t.ymax==null&&(e[3]=1/0),i}const Ms=C();let $o=class extends Ae{get tilingScheme(){const e=this.tilingSchemeOwner.tilingScheme;return e?e.clone():null}set filterExtent(e){if(e!=null&&!e.spatialReference.equals(this.viewState.spatialReference))return void re.getLogger(this).error("#extent","extent spatial reference needs to be in the same spatial reference as the view");const r=this._get("filterExtent");if(r===e||r!=null&&e&&r.equals(e))return;const i=e!=null?e.clone():null;this._set("filterExtent",i),this._setDirty()}get _filterExtentRect(){if(this.filterExtent==null)return null;const e=Wt();return vNe(this.filterExtent,e,this.tilingScheme.spatialReference),e}get _rootTileIds(){const{tilingScheme:e}=this;return this._filterExtentRect&&e?e.rootTilesInExtent(this._filterExtentRect):[[0,0,0]]}set suspended(e){e!==this._get("suspended")&&(this._set("suspended",e),this._setDirty())}get updating(){return this._dirty||!!this._pendingTiles}constructor(e){super(e),this.tiles=new $t,this.tileSize=512,this._idToTile=new Map,this._clients=new Set,this._dirty=!1,this._pendingTiles=null,this._newTiles=new Vt}initialize(){this.addHandles([he(()=>[this.tilingScheme,this.tileSize],()=>this._reset(),Qr),he(()=>{var e,r,i;return[this.tileSize,(e=this.cameraOnSurface)==null?void 0:e.location,this.tilingScheme,(r=this.viewState)==null?void 0:r.contentCamera,(i=this.focus)==null?void 0:i.location]},()=>this._setDirty(),Kr)]),this.scheduler&&(this._frameWorker=this.scheduler.registerTask(bt.FEATURE_TILE_TREE,this))}destroy(){this._frameWorker=wi(this._frameWorker)}addClient(){const e=Gu();return this._clients.add(e),this._clients.size===1&&this._setDirty(),Zr(()=>this._removeClient(e))}_removeClient(e){this._clients.delete(e),this._hasClients||this._clear()}get _hasClients(){return this._clients.size>0}_setDirty(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this.runTask(yl))}_clear(){this.tiles.removeAll(),this._idToTile.clear(),this._reset(),this._dirty=!1,this.notifyChange("updating")}get running(){return this.updating}runTask(e){this._dirty=!1,this._pendingTiles||(this._startUpdate(),this._frameWorker!=null&&(this._frameWorker.priority=bt.FEATURE_TILE_TREE_ACTIVE)),this._subdivideTilesForView(e),this._pendingTiles||this._frameWorker==null||(this._frameWorker.priority=bt.FEATURE_TILE_TREE),this.notifyChange("updating")}_startUpdate(){if(this.suspended)return;if(!this.tilingScheme)return void this._clear();this._tileMeasurements||(this._tileMeasurements=new eSt({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize}));const e=this.viewState.contentCamera;this._tileMeasurements.begin(e,this.focus.location,this.cameraOnSurface.location.z??0),this._pendingTiles=this._getRootTiles()}_reset(){this._newTiles.clear(),this._tileMeasurements=null,this._pendingTiles=null,this._setDirty()}_getRootTiles(){const{tilingScheme:e}=this;return this._rootTileIds.map(r=>new hO(r[0],r[1],r[2],e))}_purgeHorizonTiles(e){if(e.sort((r,i)=>{const n=r.measures.screenRect,s=i.measures.screenRect;return n[1]+n[3]-(s[1]+s[3])}),!(e.length>oSt))return e.toArray();Ku(a4);for(let r=0;r<e.length;r++)if(V1(a4,e.data[r].measures.screenRect,a4),Jl(a4)>sSt)return e.data.slice(r,e.length);return[]}_subdivideTilesForView(e){if(!this._pendingTiles)return;const{tilingScheme:r}=this;for(;this._pendingTiles.length>0&&!e.done;){const i=this._pendingTiles.pop();e.madeProgress(),this._filterExtentRect&&!c9(this._filterExtentRect,i.extent)||(this._tileMeasurements.updateTile(i),i.measures.visibility!==Wl.INVISIBLE&&(i.measures.shouldSplit?(r.ensureMaxLod(i.lij[0]+1),this._pendingTiles.push(...i.getChildren())):this._newTiles.push(i)))}this._pendingTiles.length===0&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}_updateTiles(e){for(const n of this.tiles.items)n.used=!1;const r=e.filter(n=>{const s=this._idToTile.get(n.id);return s?(s.copyMeasurementsFrom(n),s.used=!0):this._idToTile.set(n.id,n),!s}),i=this.tiles.items.filter(n=>!n.used&&(this._idToTile.delete(n.id),!0));this.tiles.removeMany(i),this.tiles.addMany(r),this._sortTiles()}_sortTiles(){this.viewState.fixedContentCamera||this.tiles.sort((e,r)=>e.measures.visibility!==r.measures.visibility?e.measures.visibility===Wl.VISIBLE_ON_SURFACE?-1:1:e.measures.distance-r.measures.distance),this.tiles.forEach((e,r)=>e.loadPriority=r)}};d([m({constructOnly:!0})],$o.prototype,"scheduler",void 0),d([m({constructOnly:!0})],$o.prototype,"renderCoordsHelper",void 0),d([m({constructOnly:!0})],$o.prototype,"tilingSchemeOwner",void 0),d([m({constructOnly:!0})],$o.prototype,"cameraOnSurface",void 0),d([m({constructOnly:!0})],$o.prototype,"focus",void 0),d([m({constructOnly:!0})],$o.prototype,"viewState",void 0),d([m({constructOnly:!0})],$o.prototype,"terrain",void 0),d([m()],$o.prototype,"tiles",void 0),d([m()],$o.prototype,"tileSize",void 0),d([m({readOnly:!0})],$o.prototype,"tilingScheme",null),d([m()],$o.prototype,"filterExtent",null),d([m({readOnly:!0})],$o.prototype,"_filterExtentRect",null),d([m({readOnly:!0})],$o.prototype,"_rootTileIds",null),d([m({value:!1})],$o.prototype,"suspended",null),d([m({readOnly:!0})],$o.prototype,"updating",null),$o=d([V("esri.views.3d.layers.support.FeatureTileTree3D")],$o);const a4=Wt(),sSt=10,oSt=50;let xn=class extends Ae{constructor(){super(...arguments),this._propertiesPool=new ny({camera:Qe},this),this._lastSeenCameraProjectionValues=new Qe,this.mode=Ur.ANIMATING,this._cssCamera=new Qe,this._camera=new Qe,this.rasterPixelRatio=1,this.contentPixelRatio=1,this.events=new Qn,this.viewingMode=De.Global,this._cameraChanged=!1,this._updateQueue=new Array,this._processingUpdates=!1}init(e,r){this._set("viewingMode",e),this._set("spatialReference",r),this._set("constraints",new r0({mode:this.viewingMode}))}exit(){this.cameraController=null,this._propertiesPool.destroy(),this._propertiesPool=new ny({camera:Qe},this)}destroy(){var e;this.cameraController=null,(e=this._propertiesPool)==null||e.destroy(),this._propertiesPool=null}createInitialCamera(){if(this.viewingMode===De.Global){const e=Br(this.spatialReference).radius;this.camera=new Qe({eye:Ce(4*e,0,0),center:Ce(e,0,0),up:Ce(0,0,1)})}else this.camera=new Qe({eye:Ce(0,0,100),center:Ce(0,0,0),up:Ce(0,1,0)})}get animation(){return this.cameraController instanceof U$&&this.cameraController.viewAnimation!=null?this.cameraController.viewAnimation:null}get cssCamera(){const e=this._cssCamera.copyFrom(this.camera),{height:r,width:i,pixelRatio:n}=this.camera;return e.pixelRatio=1,e.height=Math.round(r/n),e.width=Math.round(i/n),e}get camera(){return this._camera}set camera(e){e!==mh&&mh.copyFrom(e),mh.computeUp(this.viewingMode),this.events.emit("before-camera-change",mh);const r=this._camera;if(this._cameraProjectionChanged(this._lastSeenCameraProjectionValues,mh)&&(this._lastSeenCameraProjectionValues.copyFrom(mh),this.events.emit("camera-projection-changed",this._lastSeenCameraProjectionValues)),!r.equals(mh)&&(this._camera=this._propertiesPool.get("camera").copyFrom(mh),this._cameraChanged=!r.almostEquals(mh),this._cameraChanged)){const i=qbe(()=>{this._cameraChanged=!1,i.remove()})}}get pixelRatio(){return this.camera.pixelRatio}get alignPixelEnabled(){return this.pixelRatio===this.rasterPixelRatio&&this.mode===Ur.IDLE}get updating(){return this.mode!==Ur.IDLE}get contentCamera(){return this._contentCamera??this.camera}set contentCamera(e){this._contentCamera=e!=null?e.clone():null}get fixedContentCamera(){return this._contentCamera!=null}get isGlobal(){return this.viewingMode===De.Global}get isLocal(){return this.viewingMode===De.Local}get navigating(){return!(!this.cameraController||!this.cameraController.isInteractive)}get stationary(){return!this._cameraChanged&&!this.navigating}get cameraController(){return this._get("cameraController")}set cameraController(e){var r;this.stopActiveCameraController()?((r=this.cameraController)==null||r.destroy(),e&&(this.removeHandles(Sge),this.addHandles(fd(()=>e.state===rn.Finished||e.state===rn.Stopped,()=>{this._set("cameraController",null),this.updateCamera(i=>e.onControllerEnd(i))},{sync:!0,once:!0}),Sge),e.onControllerStart(this.camera)),this._set("cameraController",e)):e&&(e.state=rn.Rejected)}switchCameraController(e){return this.cameraController=e,e.state!==rn.Rejected}stopActiveCameraController(){return!(this.cameraController&&!this.cameraController.stopController())}updateCamera(e){this._updateQueue.push(e),this._processUpdateQueue()}_processUpdateQueue(){if(this._updateQueue.length===0||this._processingUpdates)return;this._processingUpdates=!0;const e=this._updateQueue.shift();mh.copyFrom(this._get("camera")),e(mh),this.camera=mh,this._processingUpdates=!1,this._processUpdateQueue()}_cameraProjectionChanged(e,r){return e.fov!==r.fov||e.fullViewport[0]!==r.fullViewport[0]||e.fullViewport[1]!==r.fullViewport[1]||e.fullViewport[2]!==r.fullViewport[2]||e.fullViewport[3]!==r.fullViewport[3]||e.padding[Kt.TOP]!==r.padding[Kt.TOP]||e.padding[Kt.RIGHT]!==r.padding[Kt.RIGHT]||e.padding[Kt.BOTTOM]!==r.padding[Kt.BOTTOM]||e.padding[Kt.LEFT]!==r.padding[Kt.LEFT]}};d([m()],xn.prototype,"mode",void 0),d([m({readOnly:!0,type:r3})],xn.prototype,"animation",null),d([m({type:Qe})],xn.prototype,"cssCamera",null),d([m()],xn.prototype,"_cssCamera",void 0),d([m({type:Qe})],xn.prototype,"camera",null),d([m()],xn.prototype,"_camera",void 0),d([m({readOnly:!0})],xn.prototype,"pixelRatio",null),d([m()],xn.prototype,"rasterPixelRatio",void 0),d([m()],xn.prototype,"contentPixelRatio",void 0),d([m({readOnly:!0})],xn.prototype,"alignPixelEnabled",null),d([m({readOnly:!0})],xn.prototype,"updating",null),d([m({})],xn.prototype,"_contentCamera",void 0),d([m({type:Qe})],xn.prototype,"contentCamera",null),d([m({readOnly:!0})],xn.prototype,"fixedContentCamera",null),d([m({readOnly:!0})],xn.prototype,"constraints",void 0),d([m({readOnly:!0})],xn.prototype,"events",void 0),d([m({readOnly:!0})],xn.prototype,"isGlobal",null),d([m({readOnly:!0})],xn.prototype,"isLocal",null),d([m({readOnly:!0})],xn.prototype,"viewingMode",void 0),d([m({readOnly:!0})],xn.prototype,"spatialReference",void 0),d([m()],xn.prototype,"navigating",null),d([m()],xn.prototype,"stationary",null),d([m()],xn.prototype,"_cameraChanged",void 0),d([m()],xn.prototype,"cameraController",null),xn=d([V("esri.views.3d.state.ViewState")],xn);const aSt=xn,mh=new Qe,Sge="ViewStateHandles";function bNe(t){return t?fSt:mSt}function lSt(t,e){return e!=null&&e.mode?e.mode:bNe(t).mode}function cSt(t,e){return e??bNe(t)}function uSt(t,e){return lSt(t!=null&&t.hasZ,e)}function Oqt(t,e){return cSt(t!=null&&!!t.hasZ,e)}function Rqt(t){const e=hSt(t),r=uSt(t.geometry,e);return{mode:r,offset:e!=null&&r!=="on-the-ground"?TNe(e):0}}function hSt(t){return t.layer&&"elevationInfo"in t.layer?t.layer.elevationInfo:null}function wNe(t,e){if(!(t!=null&&t.offset))return 0;const{offset:r,unit:i}=t;if(i==="decimal-degrees")return 0;const n=i!=="unknown"&&i?i:"meters",s=JBe(e);return s?mo(r,n,s):0}function $qt(t,e,r,i=null){return xNe(t,e.x,e.y,e.hasZ?e.z:0,e.spatialReference,r,i)}function Iqt(t,e,r,i,n=null){return xNe(t,e[0],e[1],e.length>2?e[2]:0,r,i,n)}function xNe(t,e,r,i,n,s,o=null){if(s==null)return;const a=o!=null?o.mode:"absolute-height";if(a==="on-the-ground")return 0;const{absoluteZ:l}=dSt(e,r,i,n,t,s);return pSt(l,e,r,i,n,t,o,a)}function dSt(t,e,r,i,n,s){const o=wNe(s,i);switch(s.mode){case"absolute-height":return{absoluteZ:r+o,elevation:0};case"on-the-ground":{const a=n.elevationProvider.getElevation(t,e,0,i,"ground")??0;return{absoluteZ:a,elevation:a}}case"relative-to-ground":{const a=n.elevationProvider.getElevation(t,e,r,i,"ground")??0;return{absoluteZ:r+a+o,elevation:a}}case"relative-to-scene":{const a=n.elevationProvider.getElevation(t,e,r,i,"scene")??0;return{absoluteZ:r+a+o,elevation:a}}}}function pSt(t,e,r,i,n,s,o,a){const l=wNe(o,n);switch(a){case"absolute-height":return t-l;case"relative-to-ground":return t-((s.elevationProvider.getElevation(e,r,i,n,"ground")??0)+l);case"relative-to-scene":return t-((s.elevationProvider.getElevation(e,r,i,n,"scene")??0)+l)}}function Lqt(t,e){if(e==null)return!1;const{mode:r}=e;return r!=null&&(t==="scene"&&r==="relative-to-scene"||t==="ground"&&r!=="absolute-height")}function Dqt(t,e,r){return r&&r.mode!==e?`${t} only support ${e} elevation mode`:null}function Nqt(t,e,r){return(r==null?void 0:r.mode)===e?`${t} do not support ${e} elevation mode`:null}function Fqt(t,e){return(e==null?void 0:e.featureExpressionInfo)!=null&&e.featureExpressionInfo.expression!=="0"?`${t} do not support featureExpressionInfo`:null}function kqt(t,e){e&&t.warn(".elevationInfo=",e)}function TNe(t){return((t==null?void 0:t.offset)??0)*aRe(t==null?void 0:t.unit)}const fSt={mode:"absolute-height",offset:0},mSt={mode:"on-the-ground",offset:null},gSt="OBJECTID";let zqt=class extends kI{constructor(e,r,i,n){super(r,i),this.point=e,this.createGraphic=n}};function SNe(t){return xd(t)&&t.intersector===Bi.PCL&&!!t.target}let Bqt=class extends xCe{constructor(e,r,i,n,s){super(e),this.layerUid=e,this.sublayerUid=r,this.nodeIndex=i,this.componentIndex=n,this.triangleNr=s}},Gqt=class extends kI{constructor(e,r,i){super(r,null),this.point=e,this.createVoxelGraphic=i}},Hqt=class extends kI{constructor(e,r){super(e,null),this.createTiles3DGraphic=r}};function eB(t){return xd(t)&&t.intersector===Bi.I3S&&!!t.target}function CNe(t){return xd(t)&&t.intersector===Bi.VOXEL&&!!t.target}function ySt(t){return xd(t)&&t.intersector===Bi.TILES3D&&!!t.target}function ENe(t,e){var r,i;return F9(t)||k9(t)?iI((r=t.target)==null?void 0:r.object,e):fgt(t)?(i=e.map)==null?void 0:i.ground:SNe(t)||eB(t)||wIe(t)||CNe(t)?iI(t.target,e):null}function qqt(t,e){const r=bne(t,e);return r!=null&&r.type==="graphic"?r.graphic:null}function bne(t,e){var r;if(t==null)return null;if(F9(t)||k9(t))return Cge((r=t.target)==null?void 0:r.object,e);if(SNe(t)){const i=t.target.createGraphic();return{type:"graphic",graphic:i,layer:i.layer}}if(CNe(t)){const i=t.target.createVoxelGraphic();return{type:"graphic",graphic:i,layer:i.layer}}if(ySt(t)){const i=t.target.createTiles3DGraphic();return{type:"graphic",graphic:i,layer:i.layer}}return wIe(t)||pne(t)?Cge(t.target,e):eB(t)?_St(t.target,e):null}function Cge(t,e){if((t==null?void 0:t.graphicUid)==null)return null;const r=iI(t,e);if(r==null)return null;if(r===e.graphics)return e.graphicsView==null||typeof t.graphicUid!="number"?null:e.graphicsView.getHit(t.graphicUid);const i=e.allLayerViews.find(n=>n.layer===r);return!i||i.suspended||t.graphicUid==null?null:"getHit"in i?i.getHit(t.graphicUid):null}function _St(t,e){const r=iI(t,e);if(r==null)return null;const i=e.allLayerViews.find(n=>n.layer===r);return i&&!i.suspended&&"getGraphicFromIntersectorTarget"in i?bSt(i.getGraphicFromIntersectorTarget(t)):null}function vSt(t,e){const r=iI(t,e);if(r==null)return null;const i=e.allLayerViews.find(n=>n.layer===r);return i&&!i.suspended&&"getAABBFromIntersectorTarget"in i?i.getAABBFromIntersectorTarget(t):null}function bSt(t){return t!=null?{type:"graphic",graphic:t,layer:t.layer}:null}function iI(t,e){return(t==null?void 0:t.layerUid)==null?null:e.graphicsView!=null&&t.layerUid===e.graphicsView.processor.layer.id?e.graphics:e.map.allLayers.find(r=>r.uid===t.layerUid)}function Yqt(t,e){if(F9(t)||k9(t))return N0(t.target.object.boundingVolumeWorldSpace.bounds);if(pne(t)){e9(l4,t.transformation);const r=Math.max(l4[0],l4[1],l4[2]);return t.target.baseBoundingSphere.radius*r}if(eB(t)){const r=vSt(t.target,e);return r?.5*n3e(r):null}return null}function Xqt(t){return!F9(t)&&!k9(t)&&(pne(t)?t.target.numLodLevels>1:!!eB(t))}const l4=C();async function wSt(t,e,r,i){const n=r?ANe(t,r):i,s=pn(e.x,e.y);n.requiresGroundFeedback=!0,n.enableDraped=!0;const o=yd(t.state.viewingMode);o.options.selectionMode=!0,o.options.store=Go.ALL,t.sceneIntersectionHelper.intersectIntersectorScreen(s,o,n);const a=TSt(t,o.results.all,n.graphics),l=o.results.ground,c=ENe(l,t),u=c!=null&&"type"in c&&m$(c.type)?c:null,h={screenPoint:e,results:a,ground:{mapPoint:OR(t,l),distance:xd(l)?l.distanceInRenderSpace:0,layer:u}};return yi.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(h.intersector=o),h}function xSt(t,e,r,i){const n=r?ANe(t,r):i,s=n.graphics!=null&&(n.graphics.include!=null||n.graphics.exclude!=null),o=Rp(e);n.enableDraped=n.include&&!n.include.has(pv)||n.exclude&&n.exclude.has(pv);const a=t.sceneIntersectionHelper,l=yd(t.state.viewingMode);if(l.options.selectionMode=!0,l.options.store=s?Go.ALL:Go.MIN,l.options.hud=!(r!=null&&r.excludeHud),a.intersectIntersectorScreen(o,l,n),s){for(const c of l.results.all){const u=bne(c,t);if(u==null||u.type!=="graphic"||PNe(n.graphics,u.graphic))return OR(t,c)}return null}return OR(t,l.results.min)}function TSt(t,e,r){const i=new Array;let n=null;for(let s=0;s<e.length;s++){const o=e[s],a=ENe(o,t);if(a!=null&&(a===t.map.ground||"type"in a&&m$(a.type)))break;const l=bne(o,t);if(l==null)continue;if(l.type==="graphic"){if(n==null&&s!==e.length-1&&(n=new Set),n!=null){const h=wne(l.graphic);if(n.has(h))continue;n.add(h)}if(!PNe(r,l.graphic))continue}const c=OR(t,o),u=o.distanceInRenderSpace;if(l.type==="media"){const h=l.element.toSource(c);i.push({...l,mapPoint:c,distance:u,sourcePoint:h})}else i.push({...l,mapPoint:c,distance:u})}return i}function OR(t,e,r){return e.getIntersectionPoint(wC)?(r=yJ(t,wC,r),e.intersector===Bi.TERRAIN&&t.basemapTerrain&&(r.z=Lm(t.basemapTerrain,r)??0),r):null}function wne(t){var n;const e=t.sourceLayer,r=t.layer,i=e&&"objectIdField"in e?e:r&&"objectIdField"in r?r:e;if(i){const s=i.objectIdField??gSt,o=(n=t.attributes)==null?void 0:n[s];if(o)return`o-${i.id}-${o}`}return`u-${t.uid}`}function PNe(t,e){const r=wne(e);return t==null||(t.include==null||t.include.has(r))&&(t.exclude==null||!t.exclude.has(r))}function yJ(t,e,r){let i=t.spatialReference||lt.WGS84;return ka(e,t.renderSpatialReference,wC,i)?e=wC:(i=lt.WGS84,ka(e,t.renderSpatialReference,wC,i)&&(e=wC)),r?(r.x=e[0],r.y=e[1],r.z=e[2],r.spatialReference=i):r=new ke(e,i),r}function ANe(t,e){const r=_J(t,e.include,nI.INCLUDE),i=_J(t,e.exclude,nI.EXCLUDE);return{include:r.layerUids,exclude:i.layerUids,graphics:{include:r.graphicUids,exclude:i.graphicUids}}}function _J(t,e,r,i={layerUids:void 0,graphicUids:void 0}){if(!e)return i;if(e instanceof fv)SSt(i,wne(e)),r===nI.INCLUDE&&(t.graphicsView!=null&&e.layer===t?fA(i,t.graphicsView.processor.layer.id):e.layer&&fA(i,e.layer.uid));else if(jH(e))for(const n of e)n===t.graphics&&t.graphicsView!=null?fA(i,t.graphicsView.processor.layer.id):n===t.map.ground?fA(i,pv):_J(t,n,r,i);else"uid"in e&&fA(i,e.uid);return i}function fA(t,e){t.layerUids||(t.layerUids=new Set),t.layerUids.add(e)}function SSt(t,e){t.graphicUids||(t.graphicUids=new Set),t.graphicUids.add(e)}const wC=C();var nI;(function(t){t[t.INCLUDE=0]="INCLUDE",t[t.EXCLUDE=1]="EXCLUDE"})(nI||(nI={}));let CSt=class{constructor(e,r,i){this.viewingMode=e,this._forEachLayer=r,this._view=i,this._externalIntersectionHandlers=new Vt,this._tolerance=QE,this._tmpRay=Js(),this._tmpRegion=Wt(),this._validateHUDIntersector=yd(this.viewingMode),this._validateHUDIntersector.options.hud=!1}intersectScreen(e,r,i){return this.intersectRay(this._getPickRay(e,this._tmpRay),Ege(this.viewingMode),r,i)}intersectScreenFreePointFallback(e,r,i){return this.intersectRayFreePointFallback(this._getPickRay(e,this._tmpRay),r,i)}intersectRayFreePointFallback(e,r,i){return this.intersectRay(e,Ege(this.viewingMode),r,i)||this._intersectRayFreePointLocal(e,r)}intersectRay(e,r,i,n){return r.options.selectionMode=!1,r.options.store=Go.MIN,this.computeIntersection(e,r,n),!!r.results.min&&r.results.min.getIntersectionPoint(i)}getCenterRayWithSubpixelOffset(e,r,i=.5,n=.5){return e.getRenderCenter(u4,i,n),u4[0]+=.0466,u4[1]-=.0123,Lre(e,u4,r)}intersectIntersectorScreen(e,r,i){this.computeIntersection(this._getPickRay(e,this._tmpRay),r,i)}intersectToolIntersectorScreen(e,r,i){const n=this._getPickRay(e,this._tmpRay);this.intersectToolIntersectorRay(n,r,i)}intersectToolIntersectorRay(e,r,i){r.options.selectionMode=!0,this.computeIntersection(e,r,i);const n=r.results.min;this._view.basemapTerrain&&this._view.basemapTerrain.opaque||xd(n)&&n.intersector!==Bi.TERRAIN||(r.options.selectionMode=!1,this.computeIntersection(e,r,i))}setTolerance(e=QE){this._tolerance=e}addIntersectionHandler(e){this._externalIntersectionHandlers.push(e),this._externalIntersectionHandlers.sort((r,i)=>r.type===Bi.TERRAIN?1:i.type===Bi.TERRAIN?-1:0)}removeIntersectionHandler(e){this._externalIntersectionHandlers.removeUnordered(e)!=null&&this._externalIntersectionHandlers.sort((r,i)=>r.type===Bi.TERRAIN?1:i.type===Bi.TERRAIN?-1:0)}_getPickRay(e,r){const i=this._view.state.camera;return Ire(i,e,r)}_intersectRayFreePointLocal(e,r){return this.viewingMode!==De.Local||e==null||fe(r,e.origin,pe(Be.get(),e.direction)),!1}intersectElevationFromScreen(e,r,i=0,n=null){return this._intersectElevation(this._getPickRay(e,this._tmpRay),r,i,n)}_intersectElevation(e,r,i=0,n=null){if(e==null)return null;const s=this._view,{renderCoordsHelper:o}=s,a=p$(s.spatialReference),l=r!=null?r.mode:"absolute-height",c=TNe(r)/a,u=(l!=="on-the-ground"?c+i:0)*a/o.unitInMeters,{camera:h}=s.state;if(l==="absolute-height"){const S=o==null?void 0:o.getAltitude(h.eye),E=de(pe(mA,e.direction),o.worldUpAtPosition(h.eye,ASt));if(S<u&&E<0||S>=u&&E>0)return null;if(o.intersectInfiniteManifold(e,u,mA)){const A=yJ(s,mA);return A.z??(A.z=0),A.z-=c,A}return null}const p=Be.get();h.projectToRenderScreen(e.origin,p);const f=new Pge(null,this._forEachLayer),{slicePlane:g}=s,_=g!=null?sce(g):null,v=yd(this.viewingMode);v.options.store=Go.MIN,v.options.verticalOffset=u;const b=e.origin,w=fe(Be.get(),b,e.direction);v.reset(b,w,h),v.point=p;const x=n?"type"in n&&n.type==="graphics"?S=>S.layerUid!==n.uid:S=>S.graphicUid!==n.uid:null;switch(l){case"relative-to-scene":{const S=E=>(!x||x(E))&&!!E.lastValidElevationBB;v.intersect(f.layers,p,this._tolerance,null,S),this._externalIntersectionHandlers.forAll(E=>{if(E.type===Bi.I3S||E.type===Bi.TERRAIN||E.type===Bi.TILES3D){const A=E.slicePlaneEnabled?_:null;E.intersect(v,A,v.rayBegin,v.rayEnd,p)}});break}case"on-the-ground":case"relative-to-ground":this._externalIntersectionHandlers.forAll(S=>{if(S.isGround){const E=S.slicePlaneEnabled?_:null;S.intersect(v,E,v.rayBegin,v.rayEnd,p)}})}if(v.results.min.getIntersectionPoint(mA)){const S=yJ(s,mA);return S.z=i,S}return null}computeIntersection(e,r,i,n){var _;if(e==null)return;const s=this._view.state.camera,o=Be.get();s.projectToRenderScreen(e.origin,o);const a=new Pge(i,this._forEachLayer);r.options.selectOpaqueTerrainOnly=!i||!("include"in i||"exclude"in i);const l=e.origin,c=fe(Be.get(),e.origin,e.direction);r.reset(l,c,s),r.intersect(a.layers,o,this._tolerance);const u=this._view.slicePlane,h=u!=null?sce(u):null;r.intersect(a.sliceableLayers,o,this._tolerance,h);const p=i&&(i.requiresGroundFeedback||i.enableDraped);this._externalIntersectionHandlers.forAll(v=>{const b=v.layerUid,w=Array.isArray(b),x=w?b:[b];w&&(r.options.filteredLayerUids=[]);let S=!1;for(const E of x)a.filterLayerUid(E)?S=!0:w&&r.options.filteredLayerUids.push(E);if(r.options.isFiltered=!S,v.isGround&&p||!r.options.isFiltered){const E=v.slicePlaneEnabled?h:null;v.intersect(r,E,l,c,o,n)}});const f=Be.get(),g=this._view.basemapTerrain;if(i&&i.enableDraped&&g.spatialReference!=null&&r.results.ground.getIntersectionPoint(f)){const v=g.overlayManager.renderer,b=this._view.renderCoordsHelper.spatialReference,w=Be.get();this._view.renderCoordsHelper.fromRenderCoords(f,w,g.spatialReference),w[2]=((_=this._view.elevationProvider)==null?void 0:_.getElevation(f[0],f[1],f[2],b,"ground"))??0,v.intersect(r,w,r.results.ground,x=>a.filterRenderGeometry(x))}r.sortResults(),this._processHUDResults(r)}_processHUDResults(e){const r=e.results.hud;ey(this._tmpRegion,BW);const i=this._view.state.camera,n=[],s=this._tmpRegion,o=b=>{const w=new PSt(b);i.projectToRenderScreen(b.target.center,w.screenPoint),w.screenPoint[0]=Math.floor(w.screenPoint[0]),w.screenPoint[1]=Math.floor(w.screenPoint[1]),n.push(w),mee(s,w.screenPoint)};e.sortResults(r.all),r.min.dist!=null&&o(r.min);for(const b of r.all)r.min.target.object!==b.target.object&&r.max.target.object!==b.target.object&&o(b);if(r.max.dist!=null&&r.max.target.object!==r.min.target.object&&o(r.max),!n.length)return;s[0]===s[2]&&(s[2]+=1),s[1]===s[3]&&(s[3]+=1);const a=i.fullWidth,l=i.fullHeight,c=Math.max(0,s[0]-dO),u=Math.max(0,s[1]-dO),h=Math.min($a(s)+2*dO,a-c),p=Math.min(Jl(s)+2*dO,l-u);if(h<=0||p<=0)return;const f=new Uint8Array(h*p*4);this._view._stage.renderer.readHUDVisibility(c,u,h,p,f);let g=!0;const _=e.results.max.dist==null;let v=0;for(const b of n)for(const w of ESt){const x=4*(Math.min(b.screenPoint[0]+w[0],a)-s[0]+(Math.min(b.screenPoint[1]+w[1],l)-s[1])*h);if(!(x<0||x>=f.length)&&f[x]){g&&(e.results.min.copy(b.result),g=!1),_&&e.results.max.copy(b.result),e.options.store===Go.ALL&&e.results.all.splice(v++,0,b.result);break}}}};const dO=1,ESt=(()=>{const t=[],e=dO;for(let r=-e;r<=e;r++)for(let i=-e;i<=e;i++)t.push([i+e,r+e]);return t})();let PSt=class{constructor(e){this.result=e,this.screenPoint=oa()}},c4;function Ege(t){return c4&&c4.viewingMode===t||(c4=yd(t)),c4}let Pge=class{constructor(e,r){this.layers=new Array,this.sliceableLayers=new Array,this.include=e==null?void 0:e.include,this.exclude=e==null?void 0:e.exclude,r(i=>{i.pickable&&this.filterLayerUid(i.apiLayerUid)&&(i.sliceable?this.sliceableLayers:this.layers).push(i)})}filterLayerUid(e){const{include:r,exclude:i}=this;return e==null?r==null&&i==null:(r==null||r.has(e))&&(i==null||!i.has(e))}filterRenderGeometry(e){return this.filterLayerUid(e.layerUid)}};function Age(t){return typeof t=="object"&&"intersect"in t}const mA=C(),ASt=C(),u4=oa();let Kqt=class{constructor(e,r){this.spatialReference=e,this._view=r}getElevation(e,r,i){return this._view.elevationProvider.getElevation(e,r,0,this.spatialReference,i)}async queryElevation(e,r,i,n,s){return this._view.elevationProvider.queryElevation(e,r,0,this.spatialReference,s,i,n)}},MSt=class{constructor(e,r,i,n){this.spatialReference=r,this._getElevationQueryProvider=i,this._queries=new Array,this._queryOptions={...n,ignoreInvisibleLayers:!0},this._frameTask=e.registerTask(bt.ELEVATION_QUERY,this)}destroy({completeTasks:e}={completeTasks:!1}){if(this._frameTask.remove(),this.running)if(e)this.runTask(yl);else for(const r of this._queries)r.result.reject(dr())}queryElevation(e,r,i,n=0){const s=ha(),o={x:e,y:r,minDemResolution:n,result:s,signal:i};return this._queries.push(o),ca(i,()=>{_K(this._queries,o),s.reject(dr())}),s.promise}get running(){return this._queries.length>0}runTask(e){const r=this._queries;this._queries=[];const i=this._getElevationQueryProvider();if(!i)return r.forEach(u=>u.result.reject()),void e.madeProgress();const n=r.map(u=>[u.x,u.y]),s=r.reduce((u,h)=>Math.min(u,h.minDemResolution),1/0),o=new $3({points:n,spatialReference:this.spatialReference}),a=r.length>1&&r.some(u=>!!u.signal)?new AbortController:null,l=a!=null?a.signal:r[0].signal;if(a!=null){let u=0;r.forEach(h=>ca(h.signal,()=>{u++,h.result.reject(dr()),u===r.length&&a.abort()}))}const c={...this._queryOptions,minDemResolution:s,signal:l};i.queryElevation(o,c).then(u=>{r.forEach((h,p)=>{h.signal!=null&&h.signal.aborted?h.result.reject(dr()):h.result.resolve(u.geometry.points[p][2])})}).catch(u=>{r.forEach(h=>h.result.reject(u))}),e.madeProgress()}get test(){const e=this;return{update:()=>e._queries.length>0&&e.runTask(yl)}}},B8=class{constructor(e=1/0,r=-1/0){this.elevationRangeMin=e,this.elevationRangeMax=r}get elevationRangeValid(){return!Number.isNaN(this.elevationRangeMin)}invalidateElevationRange(){this.elevationRangeMin=NaN}expandElevationRangeValues(e,r){this.elevationRangeMin=Math.min(this.elevationRangeMin,e),this.elevationRangeMax=Math.max(this.elevationRangeMax,r)}expandElevationRange(e){this.elevationRangeMin=Math.min(this.elevationRangeMin,e.elevationRangeMin),this.elevationRangeMax=Math.max(this.elevationRangeMax,e.elevationRangeMax)}setElevationRange(e){this.elevationRangeMin=e.elevationRangeMin,this.elevationRangeMax=e.elevationRangeMax}},pO=class extends Qn.EventedMixin(Ae){get spatialReference(){var e,r;return(r=(e=this.view)==null?void 0:e.basemapTerrain)==null?void 0:r.spatialReference}constructor(e){super(e),this._im=new Array,this._ground=new Array,this._scene=new Array,this.lastElevationQuery=null,this._cacheEnabled=!1}destroy(){this._cachedQuery=Pe(this._cachedQuery)}enableCache(e){e||(this.lastElevationQuery=null),this._cacheEnabled=e}getElevation(e,r,i,n,s){if(this._cacheEnabled&&this.lastElevationQuery!=null){const a=this.lastElevationQuery;if(e===a.x&&r===a.y&&i===a.z&&To(n,a.spatialReference)&&s===a.queryContext)return a.result}let o=null;return o=h4(o,this._im,e,r,i,n,s),o==null&&(o=h4(o,this._ground,e,r,i,n,s)),s==="scene"&&(o=h4(o,this._scene,e,r,i,n,s)),this._cacheEnabled&&(this.lastElevationQuery={x:e,y:r,z:i,spatialReference:n,queryContext:s,result:o}),o}getSphereElevationBounds(e,r,i){const n=new B8;function s(o){for(const a of o)if(a.getSphereElevationBounds){const l=a.getSphereElevationBounds(e,r,i);l!=null&&n.expandElevationRangeValues(l.elevationRangeMin,l.elevationRangeMax)}}return s(this._ground),s(this._im),i==="scene"&&s(this._scene),n}getRootElevationBounds(){const e=new B8;for(const r of[this._im,this._ground,this._scene])r.forEach(i=>{if(i.getRootElevationBounds){const n=i.getRootElevationBounds();n!=null&&e.expandElevationRangeValues(n.elevationRangeMin,n.elevationRangeMax)}});return e}async queryElevation(e,r,i,n,s,o=null,a=0){const l=this._getElevationQuery(n);try{const c=await l.queryElevation(e,r,o,a);return s==="scene"?h4(c,this._scene,e,r,i,n,s):c}catch(c){return J0(c),this.getElevation(e,r,i,n,s)}}register(e,r){this.addHandles(r.on("elevation-change",i=>this.emit("elevation-change",i)),r),this._providersFromContext(e).push(r)}unregister(e){this.removeHandles(e);for(const r of[this._im,this._ground,this._scene]){const i=r.indexOf(e);i>-1&&r.splice(i,1)}}_providersFromContext(e){switch(e){case"ground":return this._ground;case"im":return this._im;case"scene":return this._scene}}_getElevationQuery(e=this.view.spatialReference){const r=this._cachedQuery;if(r!=null&&To(e,r.spatialReference))return r;r==null||r.destroy({completeTasks:!0});const{wkid:i,wkt:n,wkt2:s,latestWkid:o}=e,a=new MSt(this.view.resourceController.scheduler,new lt({wkid:i,wkt:n,wkt2:s,latestWkid:o}),()=>{var l;return(l=this.view.map)==null?void 0:l.ground},{maximumAutoTileRequests:4});return this._cachedQuery=a,a}};function h4(t,e,r,i,n,s,o){for(const a of e){const l=a.getElevation(r,i,n,s,o);l!=null&&(t=t!=null?Math.max(l,t):l)}return t}d([m({constructOnly:!0})],pO.prototype,"view",void 0),d([m()],pO.prototype,"spatialReference",null),pO=d([V("esri.views.3d.support.CombinedElevationProvider")],pO);let sI=class vJ{static isValidProfile(e){return e in vJ.profiles}static getDefaultProfile(){return se("esri-iPhone")?"low":"medium"}static apply(e,r){const i=vJ.profiles[e];r.graphics3D.maxTotalNumberOfFeatures=i.graphics3D.maxTotalNumberOfFeatures,r.graphics3D.maxNumberOfDrawCalls=i.graphics3D.maxNumberOfDrawCalls,r.graphics3D.maxTotalNumberOfVertices=i.graphics3D.maxTotalNumberOfVertices,r.graphics3D.polygonLodFactor=i.graphics3D.polygonLodFactor,r.graphics3D.polylineLodFactor=i.graphics3D.polylineLodFactor,r.graphics3D.snapshotAvailable=i.graphics3D.snapshotAvailable,r.graphics3D.skipHighSymbolLods=i.graphics3D.skipHighSymbolLods,r.graphics3D.uncompressedTextureDownsamplingEnabled=i.graphics3D.uncompressedTextureDownsamplingEnabled;const n=r.sceneService.object,s=i.sceneService.object;n.lodFactor=s.lodFactor,r.sceneService.point.lodFactor=i.sceneService.point.lodFactor,r.sceneService.integratedMesh.lodFactor=i.sceneService.integratedMesh.lodFactor,r.sceneService.pointCloud.lodFactor=i.sceneService.pointCloud.lodFactor,r.sceneService.uncompressedTextureDownsamplingEnabled=i.sceneService.uncompressedTextureDownsamplingEnabled,r.tiledSurface.lodBias=i.tiledSurface.lodBias,r.tiledSurface.angledSplitBias=i.tiledSurface.angledSplitBias,r.tiledSurface.vtlContentZoom=i.tiledSurface.vtlContentZoom,r.tiledSurface.reduceTileLevelDifferences=i.tiledSurface.reduceTileLevelDifferences,r.heatmap.pixelRatio=i.heatmap.pixelRatio,r.heatmap.maxTotalNumberOfFeatures=i.heatmap.maxTotalNumberOfFeatures,r.fadeDuration=i.fadeDuration,r.antialiasingEnabled=i.antialiasingEnabled,r.physicallyBasedRenderingEnabled=i.physicalBasedRenderingEnabled,r.highQualityTransparency=i.highQualityTransparency,r.highResolutionAtmosphere=i.highResolutionAtmosphere,r.reflections=i.reflections,r.ambientOcclusion=i.ambientOcclusion,r.memoryLimit=i.memoryLimit,r.additionalCacheMemory=i.additionalCacheMemory,r.frameRate=i.frameRate,r.maximumPixelRatio=i.maximumPixelRatio}};sI.test={reset(){const t=MNe();for(const e of Object.keys(t))sI.profiles[e]=t[e]}};const gA={IPhone12Pro:120,GalaxyS20:200,FullHD:240,SurfacePro7:300,FullHDRetina:430};function MNe(){const t=!!se("esri-mobile"),e=!!se("ios"),r=400;return{low:{graphics3D:{maxTotalNumberOfFeatures:25e3,maxNumberOfDrawCalls:8e3,maxTotalNumberOfVertices:255e4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1,skipHighSymbolLods:!0,uncompressedTextureDownsamplingEnabled:!0},heatmap:{pixelRatio:.125,maxTotalNumberOfFeatures:5e4},sceneService:{object:{lodFactor:.2},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,vtlContentZoom:.75,reduceTileLevelDifferences:!0},fadeDuration:0,antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:200+gA.IPhone12Pro,additionalCacheMemory:0,frameRate:0,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:1e5,maxNumberOfDrawCalls:17e3,maxTotalNumberOfVertices:625e4,polygonLodFactor:t?.8:1,polylineLodFactor:t?1.2:1.5,snapshotAvailable:!e,skipHighSymbolLods:!1,uncompressedTextureDownsamplingEnabled:t},heatmap:{pixelRatio:.25,maxTotalNumberOfFeatures:13e4},sceneService:{object:{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:t},tiledSurface:{lodBias:0,angledSplitBias:1,vtlContentZoom:1.5,reduceTileLevelDifferences:!se("disable-feature:reduce-map-tile-levels")},fadeDuration:r,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:t?600+gA.GalaxyS20:750+gA.FullHD,additionalCacheMemory:t?-100:150,frameRate:0,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:1e5,maxNumberOfDrawCalls:17e3,maxTotalNumberOfVertices:125e5,polygonLodFactor:t?1.2:2,polylineLodFactor:t?1.2:2,snapshotAvailable:!e,skipHighSymbolLods:!1,uncompressedTextureDownsamplingEnabled:!1},heatmap:{pixelRatio:.5,maxTotalNumberOfFeatures:23e4},sceneService:{object:{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,vtlContentZoom:1.5,reduceTileLevelDifferences:!se("disable-feature:reduce-map-tile-levels")},fadeDuration:r,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!0,reflections:!0,ambientOcclusion:!0,memoryLimit:t?900+gA.SurfacePro7:1500+gA.FullHDRetina,additionalCacheMemory:t?-150:0,frameRate:0,maximumPixelRatio:t?1:1/0}}}(function(t){t.profiles=MNe()})(sI||(sI={}));const AF=sI,ONe=new Xe([0,255,255]),RNe=1,$Ne=.25,INe=new Xe([0,0,0]),LNe=.4,DNe=.2;let hm=class extends Ae{constructor(){super(...arguments),this.color=ONe.clone(),this.haloColor=null,this.haloOpacity=RNe,this.fillOpacity=$Ne,this.shadowOpacity=LNe,this.shadowColor=INe.clone(),this.shadowDifference=DNe}};d([m({type:Xe})],hm.prototype,"color",void 0),d([m({type:Xe})],hm.prototype,"haloColor",void 0),d([m()],hm.prototype,"haloOpacity",void 0),d([m()],hm.prototype,"fillOpacity",void 0),d([m()],hm.prototype,"shadowOpacity",void 0),d([m({type:Xe})],hm.prototype,"shadowColor",void 0),d([m()],hm.prototype,"shadowDifference",void 0),hm=d([V("esri.views.3d.support.HighlightOptions")],hm);const NNe=hm;function OSt(t,e){return e?{...e,query:{...t??{},...e.query}}:{query:t}}function FNe(t){return typeof t=="string"?da(t):_e(t)}function RSt(t,e,r){const i={};for(const n in t){if(n==="declaredClass")continue;const s=t[n];if(s!=null&&typeof s!="function")if(Array.isArray(s))i[n]=s.map(o=>RSt({item:o},e,r).item);else if(typeof s=="object")if(s.toJSON){const o=s.toJSON(r==null?void 0:r[n]);i[n]=e?o:JSON.stringify(o)}else i[n]=e?s:JSON.stringify(s);else i[n]=s}return i}function $St(t){return{geometryType:OI(t[0]),geometries:t.map(e=>e.toJSON())}}function kNe(t,e,r){const i=YGe(e);return t.map(n=>{const s=i.fromJSON(n);return s.spatialReference=r,s})}let Cw=class extends ze{constructor(e){super(e),this.geometries=[],this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const e=this.geometries.map(n=>n.toJSON()),r=this.geometries[0],i={};return i.outSR=Zk(this.outSpatialReference),i.inSR=Zk(r.spatialReference),i.geometries=JSON.stringify({geometryType:OI(r),geometries:e}),this.transformation&&(i.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),this.transformForward!=null&&(i.transformForward=this.transformForward),i}};d([m()],Cw.prototype,"geometries",void 0),d([m({json:{read:{source:"outSR"}}})],Cw.prototype,"outSpatialReference",void 0),d([m()],Cw.prototype,"transformation",void 0),d([m()],Cw.prototype,"transformForward",void 0),Cw=d([V("esri.rest.support.ProjectParameters")],Cw);const xne=Cw,ISt=Na(xne);async function zNe(t,e,r){e=ISt(e);const i=FNe(t),n={...i.query,f:"json",...e.toJSON()},s=e.outSpatialReference,o=OI(e.geometries[0]),a=OSt(n,r);return Xi(i.path+"/project",a).then(({data:{geometries:l}})=>kNe(l,o,s))}async function Tne(t=null,e){var n,s;if(mi.geometryServiceUrl)return mi.geometryServiceUrl;if(!t)throw new K("internal:geometry-service-url-not-configured");let r;r="portal"in t?t.portal||ud.getDefault():t,await r.load({signal:e});const i=(s=(n=r.helperServices)==null?void 0:n.geometry)==null?void 0:s.url;if(!i)throw new K("internal:geometry-service-url-not-configured");return i}async function LSt(t,e,r=null,i){const n=await Tne(r,i),s=new xne;s.geometries=[t],s.outSpatialReference=e;const o=await zNe(n,s,{signal:i});if(o&&Array.isArray(o)&&o.length===1)return o[0];throw new K("internal:geometry-service-projection-failed")}const DSt=Object.freeze(Object.defineProperty({__proto__:null,getGeometryServiceURL:Tne,projectGeometry:LSt},Symbol.toStringTag,{value:"Module"}));let NSt=class{constructor(e,r){this.spatialReference=r,this.unitInMeters=Ba(this.spatialReference,Br(this.spatialReference).metersPerDegree);const i=e&&"portalItem"in e?e.portalItem:void 0;this._geometryServiceURLPromise=Tne(i).catch(()=>{throw new K("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config")})}async toGeographic(e){const r=await this._geometryServiceURLPromise;let i,n=!0;Array.isArray(e[0])&&typeof e[0]!="number"?i=e:(i=[e],n=!1);const s=i.map(l=>l instanceof ke?l:new ke(l,this.spatialReference)),o=new xne({geometries:s,outSpatialReference:lt.WGS84}),a=(await zNe(r,o)).map(l=>l.type==="point"?[l.x,l.y]:void 0).filter(l=>!!l);return n?a:a[0]}};var Gt;(function(t){t[t.ELEVATION=0]="ELEVATION",t[t.MAP=1]="MAP"})(Gt||(Gt={}));const Ew=[Gt.ELEVATION,Gt.MAP];async function FSt(t,e){if(t.type==="2d")return t.hitTest(e);const r=await t.hitTest(e);if(r.results.length===0)return r;const i=r.results[0],n=(i.distance??0)*(1+kSt),s=r.results.findIndex(o=>(o.distance??0)>n);return s!==-1&&(r.results=r.results.slice(0,s)),i&&r.ground.distance>n&&(r.ground.mapPoint=null),r}const kSt=.05;async function zSt(t,e){var p,f,g,_,v;const{results:r,ground:i}=await FSt(t,e),n=(!i.layer||!m$(i.layer.type))&&i.mapPoint,s=[],o=VSt(t),a=n?USt(t,o):BSt;let l=0,c=0;const u=()=>{const b=a.layerViews[c];n&&b&&"fetchPopupFeaturesAtLocation"in b&&s.push({mapPoint:i.mapPoint,layerView:b}),++c};let h=null;for(;l<r.length||c<a.layerViews.length;){const b=r[l];if(b&&b.type!=="graphic")++l;else if(((p=b==null?void 0:b.layer)==null?void 0:p.type)!=="scene"||((f=b==null?void 0:b.layer)==null?void 0:f.parent)!==((g=t==null?void 0:t.map)==null?void 0:g.basemap))if(b){const w=(_=b.layer)==null?void 0:_.uid,x=a.layerUids.has(w)&&b.distance===i.distance,S=o.get((v=b.layer)==null?void 0:v.uid);if(h??(h=b.mapPoint),c<a.layerViews.length&&(x||(b.distance??0)>i.distance)&&a.layerViews[c]!==S){u();continue}s.push({graphic:b.graphic,layerView:S}),++l}else u();else++l}return h??(h=i.mapPoint),{hits:s,location:h}}function USt(t,e){const r=new Set,i=[];for(let s=t.basemapTerrain.numLayers(Gt.MAP)-1;s>=0;s--){const o=t.basemapTerrain.layerViewByIndex(s,Gt.MAP);r.add(o.layer.uid),i.push(o)}const n=t.basemapTerrain.overlayManager.renderer.layers;for(const{uid:s}of n){const o=e.get(s);o&&(r.add(s),i.push(o))}return i.reverse(),{layerUids:r,layerViews:i}}const BSt={layerUids:new Set,layerViews:[]};function VSt(t){const e=new Map;for(const r of t.allLayerViews){const i=r.layer.uid;e.set(i,r)}return e}let Cu=class extends Ae{constructor(){super(...arguments),this.minTotalNumberOfFeatures=2e3,this.maxTotalNumberOfFeatures=5e4,this.maxNumberOfDrawCalls=17e3,this.maxTotalNumberOfVertices=17e5,this.snapshotAvailable=!0,this.polygonLodFactor=1,this.polylineLodFactor=1,this.skipHighSymbolLods=!1,this.uncompressedTextureDownsamplingEnabled=!1}};d([m()],Cu.prototype,"minTotalNumberOfFeatures",void 0),d([m()],Cu.prototype,"maxTotalNumberOfFeatures",void 0),d([m()],Cu.prototype,"maxNumberOfDrawCalls",void 0),d([m()],Cu.prototype,"maxTotalNumberOfVertices",void 0),d([m()],Cu.prototype,"snapshotAvailable",void 0),d([m()],Cu.prototype,"polygonLodFactor",void 0),d([m()],Cu.prototype,"polylineLodFactor",void 0),d([m()],Cu.prototype,"skipHighSymbolLods",void 0),d([m()],Cu.prototype,"uncompressedTextureDownsamplingEnabled",void 0),Cu=d([V("esri.views.3d.support.QualitySettings.Graphics3DSettings")],Cu);let Gp=class extends Ae{constructor(){super(...arguments),this.lodFactor=1}};d([m()],Gp.prototype,"lodFactor",void 0),Gp=d([V("esri.views.3d.support.QualitySettings.LoDFactorSettings")],Gp);let y0=class extends Ae{constructor(){super(...arguments),this.object=new Gp,this.point=new Gp,this.integratedMesh=new Gp,this.pointCloud=new Gp,this.uncompressedTextureDownsamplingEnabled=!1}};d([m({type:Gp})],y0.prototype,"object",void 0),d([m({type:Gp})],y0.prototype,"point",void 0),d([m({type:Gp})],y0.prototype,"integratedMesh",void 0),d([m({type:Gp})],y0.prototype,"pointCloud",void 0),d([m()],y0.prototype,"uncompressedTextureDownsamplingEnabled",void 0),y0=d([V("esri.views.3d.support.QualitySettings.SceneServiceSettings")],y0);let r1=class extends Ae{constructor(){super(...arguments),this.lodBias=0,this.angledSplitBias=1,this.vtlContentZoom=1,this.reduceTileLevelDifferences=!0}};d([m()],r1.prototype,"lodBias",void 0),d([m()],r1.prototype,"angledSplitBias",void 0),d([m()],r1.prototype,"vtlContentZoom",void 0),d([m()],r1.prototype,"reduceTileLevelDifferences",void 0),r1=d([V("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],r1);let xC=class extends Ae{constructor(){super(...arguments),this.pixelRatio=1,this.maxTotalNumberOfFeatures=5e4}};d([m()],xC.prototype,"pixelRatio",void 0),d([m()],xC.prototype,"maxTotalNumberOfFeatures",void 0),xC=d([V("esri.views.3d.support.QualitySettings.HeatmapSettings")],xC);let Jo=class extends Ae{constructor(){super(...arguments),this.graphics3D=new Cu,this.sceneService=new y0,this.tiledSurface=new r1,this.heatmap=new xC,this.fadeDuration=400,this.antialiasingEnabled=!0,this.physicallyBasedRenderingEnabled=!1,this.highQualityTransparency=!0,this.highResolutionAtmosphere=!1,this.reflections=!1,this.ambientOcclusion=!1,this.memoryLimit=750,this.additionalCacheMemory=0,this.frameRate=void 0,this.maximumPixelRatio=1/0}};d([m({type:Cu})],Jo.prototype,"graphics3D",void 0),d([m({type:y0})],Jo.prototype,"sceneService",void 0),d([m({type:r1})],Jo.prototype,"tiledSurface",void 0),d([m({type:xC})],Jo.prototype,"heatmap",void 0),d([m()],Jo.prototype,"fadeDuration",void 0),d([m()],Jo.prototype,"antialiasingEnabled",void 0),d([m()],Jo.prototype,"physicallyBasedRenderingEnabled",void 0),d([m()],Jo.prototype,"highQualityTransparency",void 0),d([m()],Jo.prototype,"highResolutionAtmosphere",void 0),d([m()],Jo.prototype,"reflections",void 0),d([m()],Jo.prototype,"ambientOcclusion",void 0),d([m()],Jo.prototype,"memoryLimit",void 0),d([m()],Jo.prototype,"additionalCacheMemory",void 0),d([m()],Jo.prototype,"frameRate",void 0),d([m()],Jo.prototype,"maximumPixelRatio",void 0),Jo=d([V("esri.views.3d.support.QualitySettings.QualitySettings")],Jo);const Mge=Jo;let GSt=class bJ{constructor(e,r,i,n){this.viewingMode=e,this.spatialReference=r,this.unitInMeters=i,this._coordinateSystem=n,this._tmpCoordinateSystem=WYe(n),this.referenceEllipsoid=Br(r),this.sphericalPCPF=nc(r)}set extent(e){e&&qYe(this._coordinateSystem,e,this._coordinateSystem)}getAltitude(e){return tXe(this._coordinateSystem,e)}setAltitude(e,r,i=e){return QSe(this._coordinateSystem,i,r,e)}setAltitudeOfTransformation(e,r){rXe(this._coordinateSystem,r,e,r)}worldUpAtPosition(e,r){return JYe(this._coordinateSystem,e,r)}worldBasisAtPosition(e,r,i){return QYe(this._coordinateSystem,e,r,i)}basisMatrixAtPosition(e,r){const i=this.worldBasisAtPosition(e,hn.X,Be.get()),n=this.worldBasisAtPosition(e,hn.Y,Be.get()),s=this.worldBasisAtPosition(e,hn.Z,Be.get());return gg(r,i[0],i[1],i[2],0,n[0],n[1],n[2],0,s[0],s[1],s[2],0,0,0,0,1),r}headingAtPosition(e,r){const i=this.worldUpAtPosition(e,Be.get()),n=this.worldBasisAtPosition(e,hn.Y,Be.get()),s=ESe(r,n,i);return Fa(s)}intersectManifoldClosestSilhouette(e,r,i){return dV(this._coordinateSystem,r,this._tmpCoordinateSystem),eXe(this._tmpCoordinateSystem,e,i),i}intersectManifold(e,r,i){dV(this._coordinateSystem,r,this._tmpCoordinateSystem);const n=Be.get();return KYe(this._tmpCoordinateSystem,e,n)?ce(i,n):null}intersectInfiniteManifold(e,r,i){if(this.viewingMode===De.Global)return this.intersectManifold(e,r,i);dV(this._coordinateSystem,r,this._tmpCoordinateSystem);const n=this._tmpCoordinateSystem.value,s=Be.get();return R2(n.plane,e,s)?ce(i,s):null}toRenderCoords(e,r,i){return P6(e)?_n(e,r,this.spatialReference):ka(e,r,i,this.spatialReference)}fromRenderCoords(e,r,i=null){return P6(r)?(i!=null&&(r.spatialReference=i),ag(e,this.spatialReference,r)?r:null):ka(e,this.spatialReference,r,i)?r:null}static create(e,r){switch(e){case De.Local:return new bJ(De.Local,r,Ba(r),ZYe());case De.Global:return new bJ(De.Global,r,1,XYe(r))}}static renderUnitScaleFactor(e,r){return xW(e)/xW(r)}};var Rm;(function(t){t[t.ELEVATION=0]="ELEVATION",t[t.BASEMAP=1]="BASEMAP",t[t.I3S_INDEX=2]="I3S_INDEX",t[t.I3S_DATA=3]="I3S_DATA",t[t.SYMBOLOGY=4]="SYMBOLOGY"})(Rm||(Rm={}));const jSt=(()=>{const t=new Array;return t[Rm.ELEVATION]=10,t[Rm.BASEMAP]=10,t[Rm.I3S_INDEX]=10,t[Rm.I3S_DATA]=10,t[Rm.SYMBOLOGY]=5,t})(),HSt=30;function WSt(t){return"usedMemory"in t&&"unloadedMemory"in t&&"ignoresMemoryFactor"in t}function qSt(t){return new il({view:t})}const Oge=.1,d4=1,YG=1,YSt=.75,XSt=.6,Rge=1.3;let il=class extends Ae{constructor(e){super(e),this._quality=1,this._usedMemory=0,this._updating=!1,this._stableQuality=0,this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._memoryPredicted=0,this._cacheStorage=new CIe,this._warnMemoryUsage=null,this._numQualityChanges=0,this._maxMemory=750,this._additionalCacheMemory=0,this.addHandles(qx({prepare:()=>this._updateMemory()}))}destroy(){this._cacheStorage.destroy()}get maxMemory(){return this._maxMemory}set maxMemory(e){e==null||e<=0||(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<e&&this._updateQuality(d4),this._maxMemory=e)}get additionalCacheMemory(){return this._additionalCacheMemory}set additionalCacheMemory(e){e!=null&&(this._additionalCacheMemory=e)}get memoryFactor(){return this._quality}get updating(){return this._updating}get usedMemory(){return this._usedMemory}get usedCacheMemory(){return this._cacheStorage.size}newCache(e,r){return new Tgt(e,this._cacheStorage,r)}resetStableQuality(){this._stableQuality=0}disableMemCache(){this.additionalCacheMemory=-4096}update(){if(this._memoryPredicted<=0&&!this._updating)return;let e=this._layersUpdating();this._memoryPredicted<XSt&&this._canFastRecover?(this._downscaleMemoryUsed=0,this._stableQuality=0,this._canFastRecover=!1,this._updateQuality(d4)):e?(this._memoryPredicted>1.1*YG||this._usedMemory>YG)&&(this._stableQuality>0?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._quality>Oge&&this._downscaleMemoryUsed<this._usedMemory&&(this._updateQuality(this._quality/Rge),this._downscaleMemoryUsed=this._usedMemory,this._canFastRecover=!1)):(this._downscaleMemoryUsed=0,this._usedMemory>YG?(this._stableQuality=0,this._canFastRecover=!1,e=this._updateQuality(this._quality/Rge),this._downscaleMemoryUsed=this._memoryPredicted):this._stableQuality!==this._quality&&(this._usedMemory<YSt&&this._quality<d4?(this._stableQuality=this._quality,e=this._updateQuality(this._quality+.05)):this._quality<1&&(this._canFastRecover=!0))),this._updating=e}_updateQuality(e){return(e=Math.min(Math.max(e,Oge),d4))!==this._quality&&(this._quality=e,++this._numQualityChanges,!0)}_layersUpdating(){return this.view.allLayerViews.some(e=>!!e.updating)}_updateMemory(){var a,l,c,u,h;if(!this.view)return;(l=(a=this.view._stage)==null?void 0:a.renderer)==null||l.tick();const e=(u=(c=this.view._stage)==null?void 0:c.renderer)==null?void 0:u.usedMemory;let r=(((h=this.view.basemapTerrain)==null?void 0:h.usedMemory)??0)+(e?e.fbos+e.edges+e.plugins:0),i=0;this.view.allLayerViews&&this.view.allLayerViews.forEach(p=>{if(WSt(p)){const f=p.ignoresMemoryFactor?this._quality:1;r+=p.usedMemory*f,i+=p.unloadedMemory*f}});const n=this._warnMemoryUsage==null||Math.round(10*r)!==Math.round(10*this._warnMemoryUsage),s=1048576*this.maxMemory;if(r>s&&n){this._warnMemoryUsage=r;const p=g=>(g/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB",f=Math.round(100*this._quality);re.getLogger(this).warn(`Memory Limit exceeded! Limit: ${p(s)} Current: ${p(r)} Projected: ${p(r+i)} Quality: ${f}%`)}this._usedMemory=r/s,this._memoryPredicted=(r+i)/s;const o=s-r;this._cacheStorage.maxSize=Math.max(0,o+1048576*this.additionalCacheMemory)}get test(){const e=this;return{cacheStorage:this._cacheStorage,resetQualityChanges:()=>{const r=e._numQualityChanges;return e._numQualityChanges=0,r},disableMemCache:()=>e.disableMemCache()}}};d([m({constructOnly:!0})],il.prototype,"view",void 0),d([m()],il.prototype,"maxMemory",null),d([m()],il.prototype,"additionalCacheMemory",null),d([m({readOnly:!0})],il.prototype,"memoryFactor",null),d([m({readOnly:!0})],il.prototype,"updating",null),d([m({readOnly:!0})],il.prototype,"usedMemory",null),d([m({readOnly:!0})],il.prototype,"usedCacheMemory",null),d([m()],il.prototype,"_quality",void 0),d([m()],il.prototype,"_usedMemory",void 0),d([m()],il.prototype,"_updating",void 0),d([m()],il.prototype,"_stableQuality",void 0),d([m()],il.prototype,"_maxMemory",void 0),d([m()],il.prototype,"_additionalCacheMemory",void 0),il=d([V("esri.views.3d.support.MemoryController")],il);let ZSt=class{constructor(e){this.client=e,this._cancelled=!1,this.size=0,this.duration=0}},JSt=class{constructor(e){this.typeWorkerQuota=e,this.tasks=new Array,this.numWorkers=0,this.statistics=new QSt}},QSt=class{constructor(){this.requests=0,this.size=0,this.duration=0,this.speed=0}},KSt=class{constructor(e,r,i,n){this._workerFunc=e,this._callbackFunc=r,this._maxTotalNumWorkers=i,this._totalNumWorkers=0,this._clients=n.map(s=>new JSt(s))}destroy(){this._clients.length=0}hasQuota(e){const r=this._clients[e];return!!r&&(this._totalNumWorkers<this._maxTotalNumWorkers||r.numWorkers+r.tasks.length<r.typeWorkerQuota)}push(e){const r=this._clients[e.client];r&&(this._totalNumWorkers<this._maxTotalNumWorkers?(r.numWorkers++,this._totalNumWorkers++,this._workerFunc(e,(i,n)=>this._taskCallback(i,n))):r.tasks.push(e))}cancel(e){this._taskFinished(e),e._cancelled=!0}_taskFinished(e){const r=this._clients[e.client];this._totalNumWorkers--,r&&(r.numWorkers--,r.statistics.requests++,r.statistics.size+=e.size||0,r.statistics.duration+=e.duration||0,r.statistics.speed=r.statistics.duration>0?r.statistics.size/r.statistics.duration:0,pt(r.numWorkers>=0)),this._next()}_next(){for(const e of this._clients)if(e&&e.numWorkers<e.typeWorkerQuota&&this._processQueue(e))return;for(const e of this._clients)if(e&&this._processQueue(e))return}_processQueue(e){for(;e.tasks.length>0;)if(this._workerFunc(e.tasks.shift(),(r,i)=>this._taskCallback(r,i)))return e.numWorkers++,this._totalNumWorkers++,!0;return!1}_taskCallback(e,r){e._cancelled||(this._callbackFunc(e,r),this._taskFinished(e))}getStatsForType(e){const r=this._clients[e];return r?{quota:r.typeWorkerQuota,workers:r.numWorkers,queueSize:r.tasks.length,requestStats:r.statistics}:null}get test(){const e=this;return{set workerFunc(r){e._workerFunc=r}}}},MF=class extends Ae{constructor(){super(...arguments),this._tasks=new Map,this._onLoadQueue=new Array,this._doneQueue=new Array,this.updating=!1}setup(e,r,i){this._loadQueue=new KSt((n,s)=>this._startLoading(n,s),(n,s)=>this._doneLoadingCB(n,s),e,r),i&&(this._frameTask=i.registerTask(bt.STREAM_DATA_LOADER,this))}destroy(){this._frameTask=wi(this._frameTask),this._tasks.forEach(e=>wl(e.abortController)),this._loadQueue=Pe(this._loadQueue),this._onLoadQueue=null,this._doneQueue=null,this._tasks=null}hasDownloadSlots(e){return this._loadQueue.hasQuota(e)}request(e,r,i,n={}){const s=ha();s.__signal=n!=null?n.signal:null;const o=this._createOrUpdateTask(e,r,i,n,s);return ca(n,()=>this._cancelRequest(o,s)),s.promise}_createTask(e,r,i,n,s,o){const a=new iCt(e,r,i,n,s);return this._updateTask(a,o),this._tasks.set(s,a),this._tasks.size===1&&this._set("updating",!0),this._loadQueue.push(a),a}_cancelRequest(e,r){var i;t$(e.resolvers,r),r.reject(dr()),e.resolvers.length===0&&(e.status===Rh.DOWNLOADING&&(e.status=Rh.CANCELLED,this._loadQueue.cancel(e),(i=e.abortController)==null||i.abort(),e.request=null,e.abortController=null),e.status=Rh.CANCELLED,this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1))}_updateTask(e,r){e.resolvers.push(r)}_createOrUpdateTask(e,r,i,n,s){const o=nCt((n==null?void 0:n.uid)||e,r,i),a=this._tasks.get(o);return a?(this._updateTask(a,s),a):this._createTask(e,n,r,i,o,s)}_doneLoadingCB(e,r){this._loadQueue&&(pt(e.status===Rh.DOWNLOADING),e.status=Rh.DOWNLOADED,this._frameTask?this._doneQueue.push({task:e,err:r}):this._doneLoading(e,r))}get running(){return this._doneQueue.length>0||this._onLoadQueue.length>0}runTask(e){for(;!e.done&&this._onLoadQueue.length>0;){const r=this._onLoadQueue.shift();vt(r.task.abortController),r.task.abortController=null,r.callback(r.task),e.madeProgress()}for(;!e.done&&this._doneQueue.length>0;){const r=this._doneQueue.shift();r.task.status!==Rh.DOWNLOADED&&(r.err=r.err||dr()),this._doneLoading(r.task,r.err),e.madeProgress()}}_doneLoading(e,r){if(r&&!_s(r)&&e.numRetries>0)return--e.numRetries,void this._loadQueue.push(e);let i=e.result instanceof HTMLImageElement?0:e.resolvers.length;for(const n of e.resolvers)if(r)_s(r)?n.reject(r):n.reject(new K("stream-data-loader:request-error",`Failed to request resource at '${e.url}'. ${r}`,{url:e.url,error:r}));else{--i;const s=i>0?_e(e.result):e.result;n.resolve(s)}this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1)}_startLoading(e,r){if(e.status===Rh.CANCELLED)return!1;let i,n;switch(e.startTime=performance.now(),e.status=Rh.DOWNLOADING,e.docType){case"binary":n="array-buffer",i=0;break;case"image":n="image";break;case"image+type":n="array-buffer";break;default:n="json"}e.abortController=new AbortController;const s=e.abortController.signal;e.request=Xi(e.url,{...e.options,responseType:n,timeout:i,signal:s});let o=()=>{};const a=c=>{e.duration=performance.now()-e.startTime,e.size=c instanceof ArrayBuffer?c.byteLength:e.size||0,e.result=c,this._frameTask?this._onLoadQueue.push({callback:r,task:e}):(e.abortController=null,r(e))},l=c=>{e.status===Rh.DOWNLOADING&&r(e,c),o()};return e.docType!=="image+type"?(e.request.then(c=>a(c.data),l),!0):(e.request.then(c=>{const u=c.data,h=tCt(u);if(n="image",e.size=u.byteLength,h==="unknown")return e.request=Xi(e.url,{responseType:n,timeout:i,signal:s}),void e.request.then(g=>a(g.data),l);const p=new Blob([u],{type:h}),f=window.URL.createObjectURL(p);o=()=>window.URL.revokeObjectURL(f),e.request=Xi(f,{responseType:n,timeout:i,signal:s}),e.request.then(g=>a(new Sne(g.data,h,o)),l)},l),!0)}get test(){return{loadQueue:this._loadQueue}}};d([m({readOnly:!0})],MF.prototype,"updating",void 0),MF=d([V("esri.views.3d.support.StreamDataLoader")],MF);const eCt={numRetries:0};function tCt(t){if(t.byteLength<2)return"unknown";const e=new Uint8Array(t,0,t.byteLength);return e[0]===137&&e[1]===80?"image/png":e[0]===71&&e[1]===73?"image/gif":e[0]===66&&e[1]===77?"image/bmp":e[0]===255&&e[1]===216?"image/jpeg":"unknown"}let Sne=class{constructor(e,r,i){this.image=e,this.type=r,this.release=i}get isOpaque(){return this.type==="image/jpeg"}};function rCt(t){return"image"in t&&"type"in t}let iCt=class extends ZSt{constructor(e,r,i,n,s){super(n),this.url=e,this.options=r,this.docType=i,this.key=s,this.result=null,this.status=Rh.QUEUED,this.request=null,this.abortController=null,this.resolvers=new Array,this.startTime=0,this.numRetries=eCt.numRetries}};function nCt(t,e,r){return`${t}:${e}:${r}`}var Rh;(function(t){t[t.QUEUED=1]="QUEUED",t[t.DOWNLOADING=2]="DOWNLOADING",t[t.DOWNLOADED=3]="DOWNLOADED",t[t.CANCELLED=4]="CANCELLED"})(Rh||(Rh={}));let OF=class extends Ae{constructor(){super(...arguments),this.updating=!1}};function sCt(t){return new np({view:t})}d([m({readOnly:!0})],OF.prototype,"updating",void 0),OF=d([V("esri.views.3d.support.ResourceControllerMain")],OF);let np=class extends OF{constructor(){super(...arguments),this._immediateTask=s3,this._normalTask=s3,this._updatingObjects=Wm([]),this._frameTask=null}get immediate(){return this._immediateTask}get normal(){return this._normalTask}initialize(){this._scheduler=Gnt(),this._memoryController=qSt(this.view),this._streamDataLoader=new MF,this._streamDataLoader.setup(HSt,jSt,this._scheduler),this.addHandles([he(()=>{var e;return(e=this.view.state)==null?void 0:e.mode},e=>{e!=null&&(this._scheduler.state=e)},Qr),he(()=>this.view.stationary,()=>this._stationaryChangedHandler())]),this._frameTask=qx({update:e=>this._frame(e)}),this._immediateTask=this._scheduler.registerTask(bt.RESOURCE_CONTROLLER_IMMEDIATE),this._normalTask=this._scheduler.registerTask(bt.RESOURCE_CONTROLLER)}destroy(){this._immediateTask.remove(),this._normalTask.remove(),this._frameTask=wi(this._frameTask),this._streamDataLoader=Pe(this._streamDataLoader),this._memoryController=Pe(this._memoryController),this._scheduler=Pe(this._scheduler),this.view=null}get updating(){var e,r,i,n;return!!((e=this._memoryController)!=null&&e.updating||(r=this._streamDataLoader)!=null&&r.updating||(i=this._immediateTask)!=null&&i.updating)||((n=this._updatingObjects)==null?void 0:n.value.some(s=>s.updating))}get scheduler(){return this._scheduler}get memoryController(){return this._memoryController}createStreamDataRequester(e){const r=this._streamDataLoader;return{request:(i,n,s)=>r.request(i,n,e,s),get busy(){return!r.hasDownloadSlots(e)}}}addUpdatingObject(e){const r=this._updatingObjects;return r.value=[...r.value,e],Zr(()=>{r.value=r.value.filter(i=>i!==e)})}_frame(e){this.view.suspended||this.view.stateManager&&(this.view.stateManager.step(OK(e.deltaTime)),!this._scheduler)||(this._memoryController.update(),this._scheduler.updateBudget(e)&&this._scheduler.frame())}_stationaryChangedHandler(){this.memoryController.resetStableQuality()}get test(){return{getQueueStats:e=>this._streamDataLoader.test.loadQueue.getStatsForType(e)}}};d([m()],np.prototype,"view",void 0),d([m()],np.prototype,"_scheduler",void 0),d([m()],np.prototype,"_memoryController",void 0),d([m()],np.prototype,"_streamDataLoader",void 0),d([m()],np.prototype,"_immediateTask",void 0),d([m()],np.prototype,"_normalTask",void 0),d([m()],np.prototype,"_updatingObjects",void 0),d([m({readOnly:!0})],np.prototype,"updating",null),np=d([V("esri.views.3d.support.ResourceControllerImpl")],np);var wJ;(function(t){t[t.KILOBYTES=1024]="KILOBYTES",t[t.MEGABYTES=1048576]="MEGABYTES",t[t.GIGABYTES=1073741824]="GIGABYTES"})(wJ||(wJ={}));let TYt=class{constructor(e,r=0,i=0,n=0,s=0,o=null){this.usedMemory=e,this.displayedFeatures=r,this.totalFeatures=i,this.maximumFeatures=n,this.nodes=s,this.core=o}};function oCt(t){return"performanceInfo"in t}let aCt=class{constructor(e){this.layer=null,this.memory=0,this.displayedNumberOfFeatures=0,this.maximumNumberOfFeatures=null,this.totalNumberOfFeatures=null,this.layer=e.layer;const r=e.performanceInfo;this.memory=r.usedMemory,this.displayedNumberOfFeatures=r.displayedFeatures,this.maximumNumberOfFeatures=r.maximumFeatures,this.totalNumberOfFeatures=r.totalFeatures}},lCt=class{constructor(e){var r;if(this.totalMemory=0,this.usedMemory=0,this.quality=1,this.load=0,this.terrainMemory=0,this.edgesMemory=0,this.layerPerformanceInfos=new Array,this.cachedMemory=0,this.fboMemory=0,e.resourceController!=null){const i=e.resourceController.memoryController;this.totalMemory=(i.maxMemory??0)*wJ.MEGABYTES,this.usedMemory=Math.round(i.usedMemory*this.totalMemory),this.quality=e.quality,this.load=e.resourceController.scheduler.load,this.cachedMemory=i.usedCacheMemory}this.terrainMemory=((r=e.basemapTerrain)==null?void 0:r.usedMemory)??0,this.edgesMemory=e._stage.renderer.usedMemory.edges??0,this.fboMemory=e._stage.renderer.usedMemory.fbos??0,e.allLayerViews.items.forEach(i=>{oCt(i)&&this.layerPerformanceInfos.push(new aCt(i))}),this.layerPerformanceInfos.sort((i,n)=>n.memory-i.memory)}},cCt=class{constructor(e){this._gltfLoading=new Map,this._wosrLoading=new Map,this._gltfMemCache=e("gltf-resources",()=>{}),this._wosrMemCache=e("wosr-resources",()=>{})}destroy(){this._gltfLoading.forEach(e=>e.abortController.abort()),this._wosrLoading.forEach(e=>e.abortController.abort()),this._gltfMemCache.destroy(),this._wosrMemCache.destroy()}loadGLTF(e,r,i){const n=i?`gltfPBR:${e}`:`gltf:${e}`,s=this._gltfMemCache.get(n);return s!=null?Promise.resolve(s):this._loadOnce(this._gltfLoading,this._gltfMemCache,n,o=>wDe(new vDe(o.streamDataRequester),e,o,i),r)}loadWOSR(e,r){const i=`wosr:${e}:${r.disableTextures}`,n=this._wosrMemCache.get(i);return n!=null?Promise.resolve(n):this._loadOnce(this._wosrLoading,this._wosrMemCache,i,s=>xDe(e,s),r)}async _loadOnce(e,r,i,n,s){vt(s);const o=ca(s,()=>this._abortLoad(e,i));let a=e.get(i);if(a)a.refCount++;else{const l=new AbortController;a={refCount:1,abortController:l,promise:n({...s,signal:l.signal})},e.set(i,a)}try{const l=await a.promise;return r.put(i,l,l.size),e.delete(i),vt(s),l}finally{wi(o)}}_abortLoad(e,r){const i=e.get(r);i!=null&&--i.refCount>0||(e.delete(r),i!=null&&i.abortController.abort())}},TC=class extends Ae{constructor(e,r){super({}),this._stage=e,this._textureRequests=new Map,this._frameTask=(r==null?void 0:r.registerTask(bt.TEXTURE_UNLOAD))??s3}normalizeCtorArgs(){return{}}destroy(){var e,r,i;super.destroy(),(e=this._frameTask)==null||e.remove(),(r=this._textureRequests)==null||r.forEach(n=>this._releaseTextureRequest(n)),(i=this._textureRequests)==null||i.clear()}get updating(){return this._frameTask.updating}fromData(e,r){const i=this.makeUid(e);let n=this._textureRequests.get(i);if(!n){const s=new BNe;s.texture=r(),this._stage&&(s.texture.load(this._stage.renderView.renderingContext),this._stage.add(s.texture)),this._textureRequests.set(i,s),n=s}return n.referenceCount++,new UNe(i,n.texture,()=>this._release(i))}_release(e){const r=this._textureRequests.get(e);r?(r.referenceCount<1&&console.warn("TextureCollection: reference count is < 1 for "+e),r.referenceCount--,r.referenceCount<1&&this._frameTask.schedule(()=>this._releaseNow(e))):console.warn(`TextureCollection: texture doesn't exist: '${e}'`)}get test(){return{textureRequests:this._textureRequests}}_releaseNow(e){var i;if(!this._textureRequests)return;const r=this._textureRequests.get(e);!r||r.referenceCount>0||((i=r.texture)==null||i.unload(),this._releaseTextureRequest(r),this._textureRequests.delete(e))}_releaseTextureRequest(e){var r;e.texture?(r=this._stage)==null||r.remove(e.texture):e.abortController&&(e.abortController.abort(),e.abortController=null)}makeUid(e,r=null){return r!=null?`${e}.${r}px`:e}};d([m()],TC.prototype,"_frameTask",void 0),d([m()],TC.prototype,"updating",null),TC=d([V("esri.views.3d.support.TextureCollection")],TC);let UNe=class{constructor(e,r,i){this.uid=e,this.texture=r,this.release=i}},BNe=class{constructor(){this.referenceCount=0}},uCt=class extends TC{constructor(e,r,i){super(r,i),this._streamDataRequester=e}async fromUrl(e,r,i){vt(i);const n=i==null?void 0:i.signal,s=this.makeUid(e,r);let o=this._textureRequests.get(s);if(!o){const a=new AbortController,l=this._streamDataRequester.request(e,"image",{uid:s,signal:a.signal});o=new BNe,o.abortController=a;const c=o;this._textureRequests.set(s,o),o.textureAsync=l.then(async u=>{const h=this._createTexture(e,u,r);return c.texture=h,c.abortController=null,await h.load(this._stage.renderView.renderingContext),this._stage.add(h),new UNe(s,h,()=>this._release(s))},u=>{throw c.abortController=null,u})}o.referenceCount++;try{return await AK(o.textureAsync,n)}catch(a){throw this._release(s),a}}_createTexture(e,r,i){var s;const n={width:r.width,height:r.height,wrap:{s:Jt.CLAMP_TO_EDGE,t:Jt.CLAMP_TO_EDGE},preMultiplyAlpha:!0,reloadable:!0};if(xwe(e)){if(i||r.width===0&&r.height===0){const o=r.width?r.height/r.width:1;i=i||64,o>1?(r.width=Math.round(i/o),r.height=i):(r.width=i,r.height=Math.round(i*o))}(s=this._stage.renderView)!=null&&s.renderingContext.driverTest.svgPremultipliesAlpha.result&&(n.preMultiplyAlpha=!1)}return new Pv(r,n)}},hCt=class{constructor(e){this.streamDataRequester=null,this._graphicsOwners=[],this._screenSizePerspectiveHandles=null,this.cimSymbolRasterizer=null,this._viewState=e.viewState,this._view=e.view,this._pointsOfInterest=e.pointsOfInterest,this.streamDataRequester=e.resourceController.createStreamDataRequester(Rm.SYMBOLOGY),this.objectResourceCache=new cCt((i,n)=>e.resourceController.memoryController.newCache(i,n)),this.textures=new uCt(this.streamDataRequester,e.view._stage,e.resourceController.scheduler);const r=Br(this._view.spatialReference).radius;this.screenSizePerspectiveSettings=cOe(e.viewingMode,r),this.screenSizePerspectiveSettingsLabels=Yct(e.viewingMode,r)}destroy(){this.textures.destroy(),this.streamDataRequester=null}addGraphicsOwner(e){if(!e)return Zr();this._graphicsOwners.push(e);const r=he(()=>{var i;return(i=e.layer)==null?void 0:i.screenSizePerspectiveEnabled},()=>this._updateScreenSizePerspectiveEnabled());return this._updateScreenSizePerspectiveEnabled(),Zr(()=>{r.remove(),t$(this._graphicsOwners,e),this._updateScreenSizePerspectiveEnabled()})}_updateScreenSizePerspectiveEnabled(){const e=this._graphicsOwners.some(r=>{var i;return((i=r.layer)==null?void 0:i.screenSizePerspectiveEnabled)===!0});if(e&&!this._screenSizePerspectiveHandles){this._screenSizePerspectiveHandles=new $v;const r=()=>this._updateScreenSizePerspectiveSettings();this._screenSizePerspectiveHandles.add([he(()=>this._pointsOfInterest.centerOnSurfaceInfrequent.distance,r,Qr),this._viewState.events.on("camera-projection-changed",r)]),this._updateScreenSizePerspectiveSettings()}else e||(this._screenSizePerspectiveHandles=Pe(this._screenSizePerspectiveHandles))}_updateScreenSizePerspectiveSettings(){const e=this._pointsOfInterest;p4.distance=e.centerOnSurfaceInfrequent.distance,p4.fovY=this._viewState.camera.fovY,this.screenSizePerspectiveSettings.update(p4),this.screenSizePerspectiveSettingsLabels.update(p4),this._view._stage.renderView.requestRender()}get test(){return{screenSizePerspectiveHandles:this._screenSizePerspectiveHandles}}};const p4={distance:0,fovY:0};let IS=class{constructor(e,r,i=""){this.graphics=e,this._symbol=new E1({symbolLayers:new $t([new C1({material:{color:r},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new z2({text:i,halo:{color:"white",size:1/.75},material:{color:r},size:12})])})}show(e,r){if(r==null)return;this.hide();const i=new ke({x:e[0],y:e[1],z:e[2],spatialReference:r});this._graphic=new fv({geometry:i,symbol:this._symbol}),this.graphics.add(this._graphic)}hide(){this._graphic!=null&&(this.graphics.remove(this._graphic),this._graphic=null)}},d1=class extends Ae{constructor(e){super(e)}};d([m({constructOnly:!0})],d1.prototype,"renderCoordsHelper",void 0),d([m({constructOnly:!0})],d1.prototype,"surface",void 0),d([m({constructOnly:!0})],d1.prototype,"state",void 0),d1=d([V("esri.views.3d.support.PointOfInterest")],d1);const dCt=Array;let sp=class extends d1{constructor(e){super(e),this._dirty=!1,this._propertiesPool=new ny({location:ke,renderLocation:dCt},this),this._estimatedSurfaceAltitude=0,this._pendingElevationQueryController=null,this.renderLocation=C(),this._tmpPoint=new ke}initialize(){if(this.scheduler&&this.addHandles(this.scheduler.registerTask(this.task,this)),this.runTask(),this.map){const e=()=>this._setDirty();this.addHandles(Vo(()=>{var r,i;return(i=(r=this.map)==null?void 0:r.ground)==null?void 0:i.layers},"change",e,{onListenerAdd:e,onListenerRemove:e}))}this._updateRenderLocation()}destroy(){this._cancelPendingRequest(),this._propertiesPool=Pe(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return e.spatialReference=this.state.spatialReference,this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e),e}get scale(){const e=this._camera,r=Di(e.eye,this.renderLocation),i={renderCoordsHelper:this.renderCoordsHelper,state:{camera:e}};return l2(i,r,0)}get updating(){return this._dirty||this._pendingElevationQueryController!=null}updateRenderLocation(){this._setDirty(),this._updateRenderLocation()}_setDirty(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))}_cancelPendingRequest(){const e=this._pendingElevationQueryController;e&&(this._pendingElevationQueryController=null,e.abort(),this.notifyChange("updating"))}get running(){return!this._pendingElevationQueryController&&this._dirty}runTask(){var n;if(this._cancelPendingRequest(),this._dirty=!1,this.notifyChange("updating"),!((n=this.map)!=null&&n.ground))return this._updateSurfaceAltitude(0),Ho;const e=this.state.spatialReference;this._tmpPoint.spatialReference=e,this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this._tmpPoint);const r=(this._tmpPoint.z??0)>pCt&&this.renderCoordsHelper.viewingMode===De.Global&&(e.isWGS84||e.isWebMercator);let i=new AbortController;return this.map.ground.queryElevation(this._tmpPoint,{signal:i.signal,cache:this.cache,minDemResolution:r?fCt:0}).then(s=>this._updateSurfaceAltitude(s.geometry.z??0)).catch(s=>{_s(s)||this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._pendingElevationQueryController===i&&(this._pendingElevationQueryController=null,this.notifyChange("updating")),i=null}),this._pendingElevationQueryController=i,Ho}_updateSurfaceAltitude(e){this._estimatedSurfaceAltitude!==e&&(this._estimatedSurfaceAltitude=e,this._updateRenderLocation())}_updateRenderLocation(){this.renderCoordsHelper.setAltitude(XG,this._estimatedSurfaceAltitude,this._camera.eye),zo(this._get("renderLocation"),XG)||(this._set("renderLocation",ce(this._propertiesPool.get("renderLocation"),XG)),this.notifyChange("renderLocation"))}};d([m({constructOnly:!0})],sp.prototype,"scheduler",void 0),d([m({constructOnly:!0})],sp.prototype,"cache",void 0),d([m({constructOnly:!0})],sp.prototype,"task",void 0),d([m()],sp.prototype,"location",null),d([m({constructOnly:!0})],sp.prototype,"map",void 0),d([m()],sp.prototype,"renderLocation",void 0),d([m()],sp.prototype,"scale",null),d([m()],sp.prototype,"updating",null),sp=d([V("esri.views.3d.support.CameraOnSurface")],sp);const XG=C(),pCt=1e5,fCt=1e6,mCt=Array;let $h=class extends d1{constructor(e){super(e),this._propertiesPool=new ny({location:ke,renderLocation:mCt},this),this._currentSurfaceAltitude=0,this._latestSurfaceAltitude=0,this.distance=0,this.renderLocation=C(),this.updating=!1}initialize(){this._frameWorker=this.scheduler.registerTask(this.task,this),this.runTask()}destroy(){this._frameWorker=wi(this._frameWorker),this._propertiesPool=Pe(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return e.spatialReference=this.state.spatialReference,this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e),e}updateRenderLocation(){this.updating=!0,this._updateRenderLocation()}get estimatedSurfaceAltitude(){return this._latestSurfaceAltitude}get running(){return this.updating}runTask(){return this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter(),this._updateRenderLocation(),this.updating=!1,Ho}_updateRenderLocation(){const e=yCt;let r=this._calculateSurfaceIntersection(this._currentSurfaceAltitude,e);const i=this._currentSurfaceAltitude!==this._latestSurfaceAltitude;!r&&i&&(r=this._calculateSurfaceIntersection(this._latestSurfaceAltitude,e),r&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude));const n=_Ct;r&&this._latestSurfaceAltitudeChangesDistanceSignificantly(e,n)&&(ce(e,n),this._currentSurfaceAltitude=this._latestSurfaceAltitude),r?this.distance=Di(this._camera.eye,e):(ne(e,this._camera.viewForward,this._get("distance")),fe(e,e,this._camera.eye)),zo(this._get("renderLocation"),e)||this._set("renderLocation",ce(this._propertiesPool.get("renderLocation"),e))}_calculateSurfaceIntersection(e,r){var n,s;const i=this._camera;if(!this.renderCoordsHelper.intersectInfiniteManifold(i.ray,e,r))return!1;if(this.state.isGlobal){const o=Br(this.renderCoordsHelper.spatialReference).radius,a=o+e,l=Ra(i.eye),c=l<a*a,u=Di(i.eye,r);if(c&&u>o/4){const h=a-Math.sqrt(l);return ne(r,i.viewForward,h),fe(r,r,i.eye),!0}}else{const o=(n=this.surface)!=null&&n.ready?this.surface.extent:null;o!=null&&S9(o,(s=this.surface)==null?void 0:s.spatialReference,yA,this.renderCoordsHelper.spatialReference)&&(r[0]=we(r[0],yA[0],yA[2]),r[1]=we(r[1],yA[1],yA[3]))}return!0}_latestSurfaceAltitudeChangesDistanceSignificantly(e,r){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||e==null)return!1;if(this._calculateSurfaceIntersection(this._latestSurfaceAltitude,r)){if(yi.TESTS_DISABLE_OPTIMIZATIONS)return!0;const i=this._camera.eye,n=Di(i,e),s=Di(i,r);if(Math.abs(s-n)/n>gCt)return!0}return!1}};d([m({constructOnly:!0})],$h.prototype,"scheduler",void 0),d([m({constructOnly:!0})],$h.prototype,"task",void 0),d([m()],$h.prototype,"distance",void 0),d([m({constructOnly:!0})],$h.prototype,"estimateSurfaceAltitudeAtCenter",void 0),d([m({readOnly:!0})],$h.prototype,"location",null),d([m({readOnly:!0})],$h.prototype,"renderLocation",void 0),d([m()],$h.prototype,"updating",void 0),$h=d([V("esri.views.3d.support.CenterOnSurface")],$h);const gCt=.05,yCt=C(),_Ct=C(),yA=Wt();let vCt=class{constructor(e){this._handles=new $v,this.events=new Qn,this._contentLayerViews=e.contentLayerViews,this._handles.add(this._contentLayerViews.on("change",r=>this._layerViewsChanged(r))),this._layerViewsChanged({added:this._contentLayerViews.toArray(),removed:[],moved:[],target:this._contentLayerViews})}destroy(){this._handles=Pe(this._handles),this._contentLayerViews.destroy()}_layerViewsChanged(e){e.added.forEach(r=>{r.declaredClass==="esri.views.3d.layers.SceneLayerView3D"&&this._handles.add(r.on("visible-geometry-changed",()=>this._contentChanged()),r.uid)}),e.removed.forEach(r=>this._handles.remove(r.uid))}_contentChanged(){this.events.emit("request-update",bCt)}};const bCt={},wCt=Array;let op=class extends d1{constructor(e){super(e),this._propertiesPool=new ny({location:ke,renderLocation:wCt},this),this._dirty=!0,this.renderLocation=this._propertiesPool.get("renderLocation")}initialize(){this.addHandles([he(()=>this.centerOnSurface.renderLocation,()=>this.updateRenderLocation()),he(()=>this.state.contentCamera,()=>this.updateRenderLocation())]),this.scheduler&&this.addHandles(this.scheduler.registerTask(bt.POINT_OF_INTEREST_FREQUENT,this))}destroy(){this._propertiesPool=Pe(this._propertiesPool)}get updating(){return this._dirty||this.centerOnSurface.updating}get location(){const e=this._propertiesPool.get("location");return e.spatialReference=this.state.spatialReference,this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e),e}get worldUnitsPerContentPixel(){const{camera:e,contentPixelRatio:r}=this.state;return e.computeRenderPixelSizeAt(this.renderLocation)*(e.pixelRatio/r)}get running(){return this._dirty}runTask(){const e=this._get("renderLocation"),r=this.centerOnSurface.renderLocation,i=this.renderCoordsHelper,n=this.state.contentCamera;this._dirty=!1,i.worldUpAtPosition(r,$ge);const s=Math.max(0,(Math.acos(de($ge,n.viewForward))-.5*Math.PI)*(n.aboveGround?1:-1));if(Number.isNaN(s)){if(!e||!i2(e,r)){const c=this._propertiesPool.get("renderLocation");ce(c,r),this._set("renderLocation",c)}return Ho}const o=1-we(s/(.5*Math.PI),0,1),a=o*o*o;this._calculateScreenHorizontalEdgeOnSurface(Ige);const l=this._propertiesPool.get("renderLocation");return ni(l,r,Ige,a),e&&i2(e,l)||this._set("renderLocation",l),Ho}_calculateScreenHorizontalEdgeOnSurface(e){const r=this.state.contentCamera,i=r.getRenderCenter(oa());if(i[1]=r.aboveGround?r.padding[Kt.BOTTOM]:r.fullHeight-r.padding[Kt.TOP],this.estimateSurfaceIntersectionAtRenderPoint(i,e))return e;const n=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);if(r.unprojectFromRenderScreen(i,_A)){ye(_A,_A,r.eye);const s=pe(_A,_A);if(this.renderCoordsHelper.intersectInfiniteManifold(eh(r.eye,s),n,e))return e}return this.renderCoordsHelper.setAltitude(e,n,r.eye)}updateRenderLocation(){this._dirty=!0}};d([m()],op.prototype,"_dirty",void 0),d([m({constructOnly:!0})],op.prototype,"scheduler",void 0),d([m({constructOnly:!0})],op.prototype,"centerOnSurface",void 0),d([m({constructOnly:!0})],op.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0),d([m()],op.prototype,"updating",null),d([m()],op.prototype,"location",null),d([m()],op.prototype,"renderLocation",void 0),d([m()],op.prototype,"worldUnitsPerContentPixel",null),op=d([V("esri.views.3d.support.pointsOfInterest.Focus")],op);const $ge=C(),_A=C(),Ige=C();let n0=class extends Ae{get surface(){var e;return(e=this.view.map)==null?void 0:e.ground}get surfaceView(){return this.view.basemapTerrain}get renderLocation(){if(!this.location)return null;const e=C();return this.view.renderCoordsHelper.toRenderCoords(this.location,e),e}constructor(e){super(e),this.location=null,this._updateController=null}initialize(){this.view.state.isLocal&&(this.addHandles([he(()=>{var e,r;return[(e=this.surfaceView)==null?void 0:e.spatialReference,(r=this.surfaceView)==null?void 0:r.extent]},()=>this._update()),Vo(()=>{var e;return(e=this.surface)==null?void 0:e.layers},"change",()=>this._update())]),this._update())}_update(){var i;if(this._updateController&&(this._updateController.abort(),this._updateController=null),((i=this.surfaceView)==null?void 0:i.extent)==null||this.surfaceView.spatialReference==null)return void this._set("location",null);const e=gee(this.surfaceView.extent),r=new ke({x:e[0],y:e[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&this.surface.layers.length>0?(this._set("location",null),this._updateController=new AbortController,this.surface.queryElevation(r,{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then(n=>{this._updateController=null,this._set("location",n.geometry)}).catch(n=>{_s(n)||n&&n.name==="elevation-query:invalid-layer"||console.error("StableSurfaceCenter failed to update: ",n)})):this._set("location",r)}};d([m({constructOnly:!0})],n0.prototype,"view",void 0),d([m({constructOnly:!0})],n0.prototype,"cache",void 0),d([m()],n0.prototype,"surface",null),d([m()],n0.prototype,"surfaceView",null),d([m({readOnly:!0})],n0.prototype,"location",void 0),d([m({readOnly:!0})],n0.prototype,"renderLocation",null),n0=d([V("esri.views.3d.terrain.StableSurfaceCenter")],n0);let s0=class extends Ae{constructor(e){super(e),this._tileGeometryUpdateExtent=Ku(),this._tileGeometryUpdateSpatialReference=null,this.events=new Qn,this.updating=!1}initialize(){this.addHandles([this.surface.on("elevation-change",e=>this._tileGeometryChanged(e)),this.scheduler.registerTask(bt.SURFACE_GEOMETRY_UPDATES,this)])}get running(){return this.updating}runTask(){return this.updating&&(this._tileGeometryUpdateSpatialReference&&this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",xCt),Ku(this._tileGeometryUpdateExtent),this._set("updating",!1)),Ho}_tileGeometryChanged(e){this._tileGeometryUpdateSpatialReference=e.spatialReference,V1(this._tileGeometryUpdateExtent,e.extent,this._tileGeometryUpdateExtent),this._set("updating",!0)}_furthestCenterOnSurface(){let e=this.centerOnSurfaces[0];for(let r=1;r<this.centerOnSurfaces.length;r++){const i=this.centerOnSurfaces[r];i.distance>e.distance&&(e=i)}return e}_centerIntersectsExtent(e,r){const i=this.state.contentCamera.eye,n=TCt,s=this._furthestCenterOnSurface();return this.renderCoordsHelper.fromRenderCoords(i,Mb,r),this.renderCoordsHelper.fromRenderCoords(s.renderLocation,Ob,r),Mb[0]<Ob[0]?(n[0]=Mb[0],n[2]=Ob[0]):(n[0]=Ob[0],n[2]=Mb[0]),Mb[1]<Ob[1]?(n[1]=Mb[1],n[3]=Ob[1]):(n[1]=Ob[1],n[3]=Mb[1]),c9(n,e)}};d([m({constructOnly:!0})],s0.prototype,"state",void 0),d([m({constructOnly:!0})],s0.prototype,"centerOnSurfaces",void 0),d([m({constructOnly:!0})],s0.prototype,"renderCoordsHelper",void 0),d([m({constructOnly:!0})],s0.prototype,"scheduler",void 0),d([m({constructOnly:!0})],s0.prototype,"surface",void 0),d([m({readOnly:!0})],s0.prototype,"updating",void 0),s0=d([V("esri.views.3d.support.SurfaceGeometryUpdates")],s0);const xCt={},Mb=C(),Ob=C(),TCt=Ku();let Vl=class extends Ae{constructor(e){super(e),this.renderPointOfView=C(),this._pois=new Array,this._debugCenters=new Map,this._tmpRay=Js(),this._centerRayDirty=!0,this._surfaceAltitudeAtCenter=0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenter=0,this._contentAltitudeAtCenterDirty=!0,this._propertiesPool=new ny({renderPointOfView:SCt},this)}initialize(){var u;const{state:e,basemapTerrain:r,renderCoordsHelper:i,map:n}=this.view;this._surfaceIntersector=yd(e.viewingMode),e.isGlobal?this._surfaceIntersector.options.backfacesTerrain=!1:this._surfaceIntersector.options.backfacesTerrain=!0,this._surfaceIntersector.options.invisibleTerrain=!1,this._surfaceIntersector.options.store=Go.MIN,this._contentIntersector=yd(e.viewingMode);const s=()=>this._estimateSurfaceAltitudeAtCenter(),o=this.view.resourceController.scheduler,a=(u=this.view.basemapTerrain)==null?void 0:u.elevationQueryCache,l={state:e,scheduler:o,surface:r,renderCoordsHelper:i};this._set("centerOnSurfaceInfrequent",new $h({...l,task:bt.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:s})),this._set("centerOnSurfaceFrequent",new $h({...l,task:bt.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:s})),this._set("centerOnContent",new $h({...l,task:bt.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()})),this._set("cameraOnSurface",new sp({...l,cache:a,task:bt.POINT_OF_INTEREST_INFREQUENT,map:n})),this._set("surfaceGeometryUpdates",new s0({...l,centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]})),this._set("contentGeometryUpdates",new vCt({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:i})),this._set("surfaceOrigin",new n0({cache:a,view:this.view})),this._set("focus",new op({state:e,scheduler:o,surface:r,renderCoordsHelper:i,centerOnSurface:this.centerOnSurfaceFrequent,estimateSurfaceIntersectionAtRenderPoint:(h,p)=>this._estimateSurfaceIntersectionAtRenderPoint(h,this.view.state.contentCamera,p)})),this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.cameraOnSurface,this.focus);const c=this.view.graphics;this._debugCenters.set(this.centerOnContent,new IS(c,"red","CenterOnContent")),this._debugCenters.set(this.centerOnSurfaceFrequent,new IS(c,"red","CenterOnSurface")),this._debugCenters.set(this.centerOnSurfaceInfrequent,new IS(c,"red","CenterOnSurface")),this._debugCenters.set(this.cameraOnSurface,new IS(c,"blue","CameraOnSurface")),this._debugCenters.set(this.focus,new IS(c,"green","Focus")),this.addHandles([he(()=>e.contentCamera,h=>this._cameraChanged(h),Qr),he(()=>r.extent,()=>this._updateCenterPointsOfInterest()),fd(()=>!r.updating,()=>this._updateCenterPointsOfInterest(),Qr),Vo(()=>this.surfaceGeometryUpdates.events,"request-update",()=>this._updateCenterPointsOfInterest()),Vo(()=>this.contentGeometryUpdates.events,"request-update",()=>this._updateCenterOnContent()),fd(()=>yi.SHOW_POI,h=>this._setDebug(h),gi)]),this._cameraChanged(this.view.state.contentCamera);for(const h of this._pois)h.runTask()}destroy(){this._setDebug(!1),this._propertiesPool.destroy();for(const e of this._pois)e.destroy();this.surfaceOrigin.destroy()}get updating(){var e;return!(!((e=this.surfaceGeometryUpdates)!=null&&e.updating)&&!this._pois.some(r=>r.updating))}get _centerRay(){return this._centerRayDirty&&(this._centerRayCached=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.contentCamera,this._tmpRay),this._centerRayDirty=!1),this._centerRayCached}_estimateContentAltitudeAtCenter(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const e=this._centerRay;return e==null||(this.view.sceneIntersectionHelper.intersectRay(e,this._contentIntersector,zT,ECt)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(zT):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter()),this._contentAltitudeAtCenter}_estimateSurfaceAltitudeAtCenter(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const e=this._centerRay;if(e==null)return this._surfaceAltitudeAtCenter;const r=e.origin,i=fe(zT,e.origin,e.direction);return this._surfaceIntersector.resetWithRay(e,this.view.state.contentCamera),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,r,i),this._surfaceIntersector.results.min.getIntersectionPoint(zT)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(zT)),this._surfaceAltitudeAtCenter}_estimateSurfaceIntersectionAtRenderPoint(e,r,i){const n=Lre(r,e,CCt);if(n==null)return null;const s=n.origin,o=fe(zT,n.origin,n.direction);return this._surfaceIntersector.resetWithRay(n,r),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,s,o),this._surfaceIntersector.results.min.getIntersectionPoint(i)?i:null}_cameraChanged(e){this._updateCenterPointsOfInterest();const r=e.eye;zo(this.renderPointOfView,r)||this._set("renderPointOfView",ce(this._propertiesPool.get("renderPointOfView"),r))}_updateCenterPointsOfInterest(){this._centerRayDirty=!0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenterDirty=!0;for(const e of this._pois)e.updateRenderLocation()}_updateCenterOnContent(){this._contentAltitudeAtCenterDirty=!0,this.centerOnContent.updateRenderLocation()}_setDebug(e){if(!e)return this._debugCenters.forEach(r=>r.hide()),void this.removeHandles("debug");for(const r of this._pois)this.addHandles(he(()=>r.renderLocation,i=>{var n;return(n=this._debugCenters.get(r))==null?void 0:n.show(i,r.renderCoordsHelper.spatialReference)},gi),"debug")}get test(){return{update:()=>{this.surfaceGeometryUpdates.runTask();for(const e of this._pois)e.runTask()},surfaceGeometryUpdates:this.surfaceGeometryUpdates}}};d([m()],Vl.prototype,"centerOnContent",void 0),d([m()],Vl.prototype,"centerOnSurfaceFrequent",void 0),d([m()],Vl.prototype,"centerOnSurfaceInfrequent",void 0),d([m()],Vl.prototype,"cameraOnSurface",void 0),d([m()],Vl.prototype,"focus",void 0),d([m()],Vl.prototype,"renderPointOfView",void 0),d([m()],Vl.prototype,"surfaceOrigin",void 0),d([m()],Vl.prototype,"contentGeometryUpdates",void 0),d([m()],Vl.prototype,"surfaceGeometryUpdates",void 0),d([m({constructOnly:!0})],Vl.prototype,"view",void 0),d([m()],Vl.prototype,"updating",null),Vl=d([V("esri.views.3d.support.PointsOfInterest")],Vl);const SCt=Array,zT=C(),CCt=Js(),ECt={exclude:new Set([pv])},PCt=(t=>t)(["operational-layers","basemap","ground"]),M1=new $t,RR=new WeakMap;function ACt(t){OCt(t)&&M1.push(new WeakRef(t))}function MCt(t){const e=M1.find(r=>r.deref()===t);e&&M1.remove(e)}function OCt(t){return t!=null&&typeof t=="object"&&"refreshInterval"in t&&"refresh"in t}function VNe(t,e){return Number.isFinite(t)&&Number.isFinite(e)?e<=0?t:VNe(e,t%e):0}let ZG=0,f4=0;function RCt(){const t=Date.now();let e=!1;for(const r of M1){const i=r.deref();i?i.refreshInterval&&t-(RR.get(i)??0)+5>=6e4*i.refreshInterval&&(RR.set(i,t),i.refresh(t)):e=!0}if(e)for(let r=M1.length-1;r>=0;r--)M1.at(r).deref()||M1.removeAt(r)}jbe(()=>{const t=Date.now();let e=0;for(const r of M1){const i=r.deref();i&&(e=VNe(Math.round(6e4*i.refreshInterval),e),i.refreshInterval?RR.get(i)||RR.set(i,t):RR.delete(i))}if(e!==f4){if(f4=e,clearInterval(ZG),f4===0)return void(ZG=0);ZG=setInterval(RCt,f4)}});function $Ct(t){return t!=null&&typeof t=="object"&&"refreshTimestamp"in t&&"refresh"in t}const Lge=.1,VYt=t=>{let e=class extends t{constructor(...r){super(...r),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=Fbe(()=>this.hasDataChanged()),this.when().then(()=>{this.destroyed||ACt(this)},()=>{})}destroy(){MCt(this)}castRefreshInterval(r){return r>=Lge?r:r<=0?0:Lge}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(r=Date.now()){r$(this._debounceHasDataChanged()).then(i=>{i&&this._set("refreshTimestamp",r),this.emit("refresh",{dataChanged:i})},i=>{re.getLogger(this).error(i),this.emit("refresh",{dataChanged:!1,error:i})})}async hasDataChanged(){return!0}get test(){const r=this;return{set refreshInterval(i){r._set("refreshInterval",i)}}}};return d([m({type:Number,json:{write:!0,origins:{"web-scene":{write:{enabled:!0,layerContainerTypes:PCt}}}}})],e.prototype,"refreshInterval",void 0),d([ai("refreshInterval")],e.prototype,"castRefreshInterval",null),d([m({readOnly:!0})],e.prototype,"refreshTimestamp",void 0),d([m({readOnly:!0})],e.prototype,"refreshParameters",null),e=d([V("esri.layers.mixins.RefreshableLayer")],e),e};let ICt=class{constructor(e){this._store=e}destroy(){this._store.destroy()}get(e){return this._store.get(e)}put(e,r){this._store.put(e,r,r.values.byteLength+256)}},LCt=class{constructor(e,r,i,n){this._hasNoDataValues=null,this._minValue=null,this._maxValue=null,"pixelData"in e?(this.values=e.pixelData,this.width=e.width,this.height=e.height,this.noDataValue=e.noDataValue):(this.values=e,this.width=r,this.height=i,this.noDataValue=n)}get hasNoDataValues(){if(this._hasNoDataValues==null){const e=this.noDataValue;this._hasNoDataValues=this.values.includes(e)}return this._hasNoDataValues}get minValue(){return this._ensureBounds(),this._minValue}get maxValue(){return this._ensureBounds(),this._maxValue}_ensureBounds(){if(this._minValue!=null)return;const{noDataValue:e,values:r}=this;let i=1/0,n=-1/0,s=!0;for(const o of r)o===e?this._hasNoDataValues=!0:(i=o<i?o:i,n=o>n?o:n,s=!1);s?(this._minValue=0,this._maxValue=0):(this._minValue=i,this._maxValue=n>-3e38?n:0)}},GNe=class{constructor(e,r,i,n,s={}){this._mainMethod=r,this._transferLists=i,this._listeners=[],this._promise=HWe(e,{...s,schedule:n}).then(o=>{if(this._thread===void 0){this._thread=o,this._promise=null,s.hasInitialize&&this.broadcast({},"initialize");for(const a of this._listeners)this._connectListener(a)}else o.close()}),this._promise.catch(o=>re.getLogger("esri.core.workers.WorkerHandle").error(`Failed to initialize ${e} worker: ${o}`))}on(e,r){const i={removed:!1,eventName:e,callback:r,threadHandle:null};return this._listeners.push(i),this._connectListener(i),Zr(()=>{i.removed=!0,_K(this._listeners,i),this._thread&&i.threadHandle!=null&&i.threadHandle.remove()})}destroy(){this._thread&&(this._thread.close(),this._thread=null),this._promise=null,this._listeners.length=0,this._transferLists={}}invoke(e,r){return this.invokeMethod(this._mainMethod,e,r)}invokeMethod(e,r,i){if(this._thread){const n=this._transferLists[e],s=n?n(r):[];return this._thread.invoke(e,r,{transferList:s,signal:i})}return this._promise?this._promise.then(()=>(vt(i),this.invokeMethod(e,r,i))):Promise.reject(null)}broadcast(e,r){return this._thread?Promise.all(this._thread.broadcast(r,e)).then(()=>{}):this._promise?this._promise.then(()=>this.broadcast(e,r)):Promise.reject()}get promise(){return this._promise}_connectListener(e){this._thread&&this._thread.on(e.eventName,e.callback).then(r=>{e.removed||(e.threadHandle=r)})}},Dge=class extends GNe{constructor(e=null){super("LercWorker","_decode",{_decode:r=>[r.buffer]},e,{strategy:"dedicated"}),this.schedule=e,this.ref=0}decode(e,r,i){return e&&e.byteLength!==0?this.invoke({buffer:e,options:r},i):Promise.resolve(null)}release(){--this.ref<=0&&($R.forEach((e,r)=>{e===this&&$R.delete(r)}),this.destroy())}};const $R=new Map;function DCt(t=null){let e=$R.get(t);return e||(t!=null?(e=new Dge(r=>t.immediate.schedule(r)),$R.set(t,e)):(e=new Dge,$R.set(null,e))),++e.ref,e}function Jm(){const t=new Float32Array(9);return t[0]=1,t[4]=1,t[8]=1,t}function NCt(t){const e=new Float32Array(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function FCt(t,e,r,i,n,s,o,a,l){const c=new Float32Array(9);return c[0]=t,c[1]=e,c[2]=r,c[3]=i,c[4]=n,c[5]=s,c[6]=o,c[7]=a,c[8]=l,c}function kCt(t,e){return new Float32Array(t,e,9)}Object.freeze(Object.defineProperty({__proto__:null,clone:NCt,create:Jm,createView:kCt,fromValues:FCt},Symbol.toStringTag,{value:"Module"}));var $c,Nge,Fge;(function(t){t[t.FILL=1]="FILL",t[t.LINE=2]="LINE",t[t.SYMBOL=3]="SYMBOL",t[t.CIRCLE=4]="CIRCLE"})($c||($c={})),function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.FILL=1]="FILL",t[t.OUTLINE=2]="OUTLINE",t[t.LINE=3]="LINE",t[t.ICON=4]="ICON",t[t.CIRCLE=5]="CIRCLE",t[t.TEXT=6]="TEXT",t[t.TILEINFO=7]="TILEINFO"}(Nge||(Nge={})),function(t){t[t.PAINTER_CHANGED=0]="PAINTER_CHANGED",t[t.LAYOUT_CHANGED=1]="LAYOUT_CHANGED",t[t.LAYER_CHANGED=2]="LAYER_CHANGED",t[t.LAYER_REMOVED=3]="LAYER_REMOVED",t[t.SPRITES_CHANGED=4]="SPRITES_CHANGED"}(Fge||(Fge={}));let uy=class Pw{static getId(e,r,i,n){return typeof e=="object"?`${e.level}/${e.row}/${e.col}/${e.world}`:`${e}/${r}/${i}/${n}`}constructor(e,r,i,n){this.set(e,r,i,n)}get key(){return this}get id(){return this.toString()}get normalizedId(){return`${this.level}/${this.row}/${this.col}`}set id(e){this.set(e)}get hash(){const e=4095&this.row,r=4095&this.col,i=63&this.level;return(3&this.world)<<30|r<<22|e<<8|i}acquire(e,r,i,n){this.set(e,r,i,n)}contains(e){const r=e.level-this.level;return r>=0&&this.row===e.row>>r&&this.col===e.col>>r&&this.world===e.world}containsChild(e){const r=e.level-this.level;return r>0&&this.row===e.row>>r&&this.col===e.col>>r&&this.world===e.world}equals(e){return this.level===e.level&&this.row===e.row&&this.col===e.col&&this.world===e.world}clone(){return new Pw(this)}release(){this.level=0,this.row=0,this.col=0,this.world=0}set(e,r,i,n){if(e==null)this.level=0,this.row=0,this.col=0,this.world=0;else if(typeof e=="object")this.level=e.level||0,this.row=e.row||0,this.col=e.col||0,this.world=e.world||0;else if(typeof e=="string"){const[s,o,a,l]=e.split("/");this.level=parseFloat(s),this.row=parseFloat(o),this.col=parseFloat(a),this.world=parseFloat(l)}else this.level=+e,this.row=+r,this.col=+i,this.world=+n||0;return this}toString(){return`${this.level}/${this.row}/${this.col}/${this.world}`}getParentKey(){return this.level<=0?null:new Pw(this.level-1,this.row>>1,this.col>>1,this.world)}getNeighborId(e,r){return`${this.level}/${this.row+r}/${this.col+e}/${this.world}`}getChildKeys(){const e=this.level+1,r=this.row<<1,i=this.col<<1,n=this.world;return[new Pw(e,r,i,n),new Pw(e,r,i+1,n),new Pw(e,r+1,i,n),new Pw(e,r+1,i+1,n)]}compareRowMajor(e){return this.row<e.row?-1:this.row>e.row?1:this.col<e.col?-1:this.col>e.col?1:0}};uy.pool=new ua(uy,null,null,25,50);function d_(t,e){return[t,e]}function Rb(t,e,r){return t[0]=e,t[1]=r,t}function zCt(t,e,r,i,n){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t}const Vd=new uy("0/0/0/0");let UCt=class jNe{static create(e,r,i=null){const n=Xp(e.spatialReference),s=r.origin||d_(e.origin.x,e.origin.y),o=d_(e.size[0]*r.resolution,e.size[1]*r.resolution),a=d_(-1/0,-1/0),l=d_(1/0,1/0),c=d_(1/0,1/0);i!=null&&(Rb(a,Math.max(0,Math.floor((i.xmin-s[0])/o[0])),Math.max(0,Math.floor((s[1]-i.ymax)/o[1]))),Rb(l,Math.max(0,Math.floor((i.xmax-s[0])/o[0])),Math.max(0,Math.floor((s[1]-i.ymin)/o[1]))),Rb(c,l[0]-a[0]+1,l[1]-a[1]+1));const{cols:u,rows:h}=r;let p,f,g,_;return!i&&u&&h&&(Rb(a,u[0],h[0]),Rb(l,u[1],h[1]),Rb(c,u[1]-u[0]+1,h[1]-h[0]+1)),e.isWrappable?(p=d_(Math.ceil(Math.round((n.valid[1]-n.valid[0])/r.resolution)/e.size[0]),c[1]),f=d_(Math.floor((n.origin[0]-s[0])/o[0]),a[1]),g=d_(p[0]+f[0]-1,l[1]),_=!0):(f=a,g=l,p=c,_=!1),new jNe(r.level,r.resolution,r.scale,s,a,l,c,o,f,g,p,_)}constructor(e,r,i,n,s,o,a,l,c,u,h,p){this.level=e,this.resolution=r,this.scale=i,this.origin=n,this.first=s,this.last=o,this.size=a,this.norm=l,this.worldStart=c,this.worldEnd=u,this.worldSize=h,this.wrap=p}normalizeCol(e){if(!this.wrap)return e;const r=this.worldSize[0];return e<0?r-1-Math.abs((e+1)%r):e%r}denormalizeCol(e,r){return this.wrap?this.worldSize[0]*r+e:e}getWorldForColumn(e){return this.wrap?Math.floor(e/this.worldSize[0]):0}getFirstColumnForWorld(e){return e*this.worldSize[0]+this.first[0]}getLastColumnForWorld(e){return e*this.worldSize[0]+this.first[0]+this.size[0]-1}getColumnForX(e){return(e-this.origin[0])/this.norm[0]}getXForColumn(e){return this.origin[0]+e*this.norm[0]}getRowForY(e){return(this.origin[1]-e)/this.norm[1]}getYForRow(e){return this.origin[1]-e*this.norm[1]}getTileBounds(e,r,i=!1){Vd.set(r);const n=i?Vd.col:this.denormalizeCol(Vd.col,Vd.world),s=Vd.row;return zCt(e,this.getXForColumn(n),this.getYForRow(s+1),this.getXForColumn(n+1),this.getYForRow(s)),e}getTileCoords(e,r,i=!1){Vd.set(r);const n=i?Vd.col:this.denormalizeCol(Vd.col,Vd.world);return Array.isArray(e)?Rb(e,this.getXForColumn(n),this.getYForRow(Vd.row)):(e.x=this.getXForColumn(n),e.y=this.getYForRow(Vd.row)),e}},xJ=class{constructor(){this.spans=[]}acquire(e){this.lodInfo=e}release(){this.lodInfo=null,this.spans.length=0}*keys(){const e=this.lodInfo;for(const{row:r,colFrom:i,colTo:n}of this.spans)for(let s=i;s<=n;s++){const o=e.getWorldForColumn(s);yield new uy(e.level,r,e.normalizeCol(s),o)}}forEach(e,r){const{spans:i,lodInfo:n}=this,{level:s}=n;if(i.length!==0)for(const{row:o,colFrom:a,colTo:l}of i)for(let c=a;c<=l;c++)e.call(r,s,o,n.normalizeCol(c),n.getWorldForColumn(c))}};xJ.pool=new ua(xJ);let JG=class{constructor(e,r,i){this.row=e,this.colFrom=r,this.colTo=i}};const Un=new uy("0/0/0/0");let BCt=class HNe{static create(e,r){e[1]>r[1]&&([e,r]=[r,e]);const[i,n]=e,[s,o]=r,a=s-i,l=o-n,c=l!==0?a/l:0,u=(Math.ceil(n)-n)*c,h=(Math.floor(n)-n)*c;return new HNe(i,Math.floor(n),Math.ceil(o),c,a<0?u:h,a<0?h:u,a<0?s:i,a<0?i:s)}constructor(e,r,i,n,s,o,a,l){this.x=e,this.ymin=r,this.ymax=i,this.invM=n,this.leftAdjust=s,this.rightAdjust=o,this.leftBound=a,this.rightBound=l}incrRow(){this.x+=this.invM}getLeftCol(){return Math.max(this.x+this.leftAdjust,this.leftBound)}getRightCol(){return Math.min(this.x+this.rightAdjust,this.rightBound)}};const mu=[[0,0],[0,0],[0,0],[0,0]],VCt=1e-6;let XYt=class{constructor(e,r=null,i=e.lods[0].level,n=e.lods[e.lods.length-1].level){this.tileInfo=e,this.fullExtent=r,this.scales=[],this._infoByScale={},this._infoByLevel={};const s=e.lods.filter(a=>a.level>=i&&a.level<=n);this.minScale=s[0].scale,this.maxScale=s[s.length-1].scale;const o=this._lodInfos=s.map(a=>UCt.create(e,a,r));s.forEach((a,l)=>{this._infoByLevel[a.level]=o[l],this._infoByScale[a.scale]=o[l],this.scales[l]=a.scale},this),this._wrap=e.isWrappable}get spatialReference(){return this.tileInfo.spatialReference}getLODInfoAt(e){return this._infoByLevel[typeof e=="number"?e:e.level]}getTileBounds(e,r,i=!1){Un.set(r);const n=this._infoByLevel[Un.level];return n?n.getTileBounds(e,Un,i):e}getTileCoords(e,r,i=!1){Un.set(r);const n=this._infoByLevel[Un.level];return n?n.getTileCoords(e,Un,i):e}getTileCoverage(e,r=192,i=!0,n="closest"){if(!i&&(e.scale>this.minScale||e.scale<this.maxScale))return null;const s=n==="closest"?this.getClosestInfoForScale(e.scale):this.getSmallestInfoForScale(e.scale),o=xJ.pool.acquire(s),a=this._wrap;let l,c,u,h=1/0,p=-1/0;const f=o.spans;mu[0][0]=mu[0][1]=mu[1][1]=mu[3][0]=-r,mu[1][0]=mu[2][0]=e.size[0]+r,mu[2][1]=mu[3][1]=e.size[1]+r;for(const b of mu)e.toMap(b,b),b[0]=s.getColumnForX(b[0]),b[1]=s.getRowForY(b[1]);const g=[];let _=3;for(let b=0;b<4;b++){if(mu[b][1]===mu[_][1]){_=b;continue}const w=BCt.create(mu[b],mu[_]);h=Math.min(w.ymin,h),p=Math.max(w.ymax,p),g[w.ymin]===void 0&&(g[w.ymin]=[]),g[w.ymin].push(w),_=b}if(h==null||p==null||p-h>100)return null;let v=[];for(l=h;l<p;){g[l]!=null&&(v=v.concat(g[l])),c=1/0,u=-1/0;for(let b=v.length-1;b>=0;b--){const w=v[b];c=Math.min(c,w.getLeftCol()),u=Math.max(u,w.getRightCol())}if(c=Math.floor(c),u=Math.floor(u),l>=s.first[1]&&l<=s.last[1])if(a)if(s.size[0]<s.worldSize[0]){const b=Math.floor(u/s.worldSize[0]);for(let w=Math.floor(c/s.worldSize[0]);w<=b;w++)f.push(new JG(l,Math.max(s.getFirstColumnForWorld(w),c),Math.min(s.getLastColumnForWorld(w),u)))}else f.push(new JG(l,c,u));else c>s.last[0]||u<s.first[0]||(c=Math.max(c,s.first[0]),u=Math.min(u,s.last[0]),f.push(new JG(l,c,u)));l+=1;for(let b=v.length-1;b>=0;b--){const w=v[b];w.ymax>=l?w.incrRow():v.splice(b,1)}}return o}getTileParentId(e){Un.set(e);const r=this._infoByLevel[Un.level],i=this._lodInfos.indexOf(r)-1;return i<0?null:(this._getTileIdAtLOD(Un,this._lodInfos[i],Un),Un.id)}getTileResolution(e){const r=this._infoByLevel[typeof e=="object"?e.level:e];return r?r.resolution:-1}getTileScale(e){const r=this._infoByLevel[e.level];return r?r.scale:-1}intersects(e,r){Un.set(r);const i=this._infoByLevel[Un.level],n=e.lodInfo;if(n.resolution>i.resolution){this._getTileIdAtLOD(Un,n,Un);const o=n.denormalizeCol(Un.col,Un.world);for(const a of e.spans)if(a.row===Un.row&&a.colFrom<=o&&a.colTo>=o)return!0}if(n.resolution<i.resolution){const[o,a,l,c]=e.spans.reduce((_,v)=>(_[0]=Math.min(_[0],v.row),_[1]=Math.max(_[1],v.row),_[2]=Math.min(_[2],v.colFrom),_[3]=Math.max(_[3],v.colTo),_),[1/0,-1/0,1/0,-1/0]),u=i.denormalizeCol(Un.col,Un.world),h=n.getColumnForX(i.getXForColumn(u)),p=n.getRowForY(i.getYForRow(Un.row)),f=n.getColumnForX(i.getXForColumn(u+1))-1,g=n.getRowForY(i.getYForRow(Un.row+1))-1;return!(h>c||f<l||p>a||g<o)}const s=n.denormalizeCol(Un.col,Un.world);return e.spans.some(o=>o.row===Un.row&&o.colFrom<=s&&o.colTo>=s)}normalizeBounds(e,r,i){if(e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],this._wrap){const n=Xp(this.tileInfo.spatialReference),s=-i*(n.valid[1]-n.valid[0]);e[0]+=s,e[2]+=s}return e}getSmallestInfoForScale(e){const r=this.scales;if(this._infoByScale[e])return this._infoByScale[e];if(e>r[0])return this._infoByScale[r[0]];for(let i=1;i<r.length-1;i++)if(e>r[i]+VCt)return this._infoByScale[r[i-1]];return this._infoByScale[r[r.length-1]]}getClosestInfoForScale(e){const r=this.scales;return this._infoByScale[e]||(e=r.reduce((i,n)=>Math.abs(n-e)<Math.abs(i-e)?n:i,r[0])),this._infoByScale[e]}scaleToLevel(e){const r=this.scales;if(this._infoByScale[e])return this._infoByScale[e].level;for(let i=r.length-1;i>=0;i--)if(e<r[i])return i===r.length-1?this._infoByScale[r[r.length-1]].level:this._infoByScale[r[i]].level+(r[i]-e)/(r[i]-r[i+1]);return this._infoByScale[r[0]].level}scaleToZoom(e){return this.tileInfo.scaleToZoom(e)}_getTileIdAtLOD(e,r,i){const n=this._infoByLevel[i.level];return e.set(i),r.resolution<n.resolution?null:(r.resolution===n.resolution||(e.level=r.level,e.col=Math.floor(i.col*n.resolution/r.resolution+.01),e.row=Math.floor(i.row*n.resolution/r.resolution+.01)),e)}},GCt=class{constructor(e,r){this.item=e,this.controller=r,this.promise=null}},jCt=class{constructor(e){this._schedule=null,this._task=null,this._deferreds=new W5,this._controllers=new W5,this._processingItems=new W5,this._pausedSignal=Wm(!1),this.concurrency=1,e.concurrency&&(this.concurrency=e.concurrency),this._queue=new l6(e.peeker),this.process=e.process;const r=e.scheduler;e.priority&&r&&(this._task=r.registerTask(e.priority,this))}destroy(){this.clear(),this._schedule=wi(this._schedule),this._task=wi(this._task)}get updating(){var e;return!!((e=this._task)!=null&&e.updating)||this.running}get length(){return this._processingItems.size+this._queue.length}abort(e){const r=this._controllers.get(e);r&&r.abort()}clear(){this._queue.clear();const e=[];this._controllers.forEach(r=>e.push(r)),this._controllers.clear(),e.forEach(r=>r.abort()),this._processingItems.clear(),this._cancelNext()}forEach(e){this._deferreds.forEach((r,i)=>e(i))}get(e){const r=this._deferreds.get(e);return r?r.promise:void 0}isOngoing(e){return this._processingItems.has(e)}has(e){return this._deferreds.has(e)}pause(){this._pausedSignal.value||(this._pausedSignal.value=!0,this._cancelNext())}push(e,r){const i=this.get(e);if(i)return i;const n=new AbortController;let s=null;r&&(s=ca(r,()=>n.abort()));const o=()=>{const u=this._processingItems.get(e);u&&u.controller.abort(),a(),c.reject(dr())},a=()=>{l.remove(),s!=null&&s.remove(),this._removeItem(e),this._queue.remove(e),this._scheduleNext()},l=Dz(n.signal,o),c=ha();return this._deferreds.set(e,c),this._controllers.set(e,n),c.promise.then(a,a),this._queue.push(e),this._scheduleNext(),c.promise}last(){return this._queue.last()}lastPromise(){const e=this.last();return e?this.get(e):null}peek(){return this._queue.peek()}popLast(){var r;const e=this._queue.popLast();return e&&((r=this._deferreds.get(e))==null||r.reject(dr("Removed from queue")),this._removeItem(e)),e}reset(){const e=[];this._processingItems.forEach(r=>e.push(r)),this._processingItems.clear();for(const r of e)this._queue.push(r.item),r.controller.abort();this._scheduleNext()}resume(){this._pausedSignal.value&&(this._pausedSignal.value=!1,this._scheduleNext())}takeAll(){const e=[];for(;this._queue.length;)e.push(this._queue.pop());return this.clear(),e}get running(){return!this._pausedSignal.value&&this._queue.length>0&&this._processingItems.size<this.concurrency}runTask(e){for(;!e.done&&this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop()),e.madeProgress()}_removeItem(e){this._deferreds.delete(e),this._controllers.delete(e),this._processingItems.delete(e)}_scheduleNext(){this._task||this._pausedSignal.value||this._schedule||(this._schedule=M3(()=>{this._schedule=null,this._next()}))}_next(){for(;this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop())}_cancelNext(){this._schedule&&(this._schedule.remove(),this._schedule=null)}_processResult(e,r){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).resolve(r))}_processError(e,r){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).reject(r))}_canProcessFulfillment(e){return!!this._deferreds.get(e.item)&&this._processingItems.get(e.item)===e}_process(e){if(e==null)return;let r;const i=new AbortController,n=new GCt(e,i);this._processingItems.set(e,n);try{r=this.process(e,i.signal)}catch(s){this._processError(n,s)}nu(r)?(n.promise=r,r.then(s=>this._processResult(n,s),s=>this._processError(n,s))):this._processResult(n,r)}get test(){return{update:e=>this.runTask(e)}}};function HCt(t,e){return t.length=0,e.forEach(r=>t.push(r)),t}const QG=new Set,m4=[],UT=new Map,kge=[0,0];let $b=class extends Ae{constructor(e){super(e),this._keyToItem=new Map,this.concurrency=6,this.strategy="scale-first",this.tileInfoView=null}initialize(){const{concurrency:e,process:r,strategy:i}=this;this._queue=new jCt({concurrency:e,process:(n,s)=>{const o=this._keyToItem.get(n);return r(o,{signal:s})},peeker:i==="scale-first"?n=>this._peekByScaleFirst(n):n=>this._peekByCenterFirst(n)})}destroy(){this.clear(),this._queue=Pe(this._queue)}get length(){return this._queue?this._queue.length:0}get onGoingCount(){return this._keyToItem.size}abort(e){const r=typeof e=="string"?e:e.id;this._queue.abort(r)}clear(){this._queue.clear(),this._keyToItem.clear()}has(e){return typeof e=="string"?this._keyToItem.has(e):this._keyToItem.has(e.id)}isOngoing(e){const r=typeof e=="string"?e:e.id;return this.has(r)&&this._queue.isOngoing(r)}pause(){this._queue.pause()}push(e){const r=e.key.id;if(this._queue.has(r))return this._queue.get(r);const i=this._queue.push(r),n=()=>{this._keyToItem.delete(r)};return this._keyToItem.set(r,e),i.then(n,n),i}reset(){this._queue.reset()}resume(){this._queue.resume()}_peekByScaleFirst(e){if(!this.state)return e.values().next().value;const r=this.tileInfoView;let i=Number.NEGATIVE_INFINITY,n=Number.POSITIVE_INFINITY;e.forEach(u=>{const h=this._keyToItem.get(u),p=this.tileInfoView.getTileScale(h.key);UT.has(p)||(UT.set(p,[]),i=Math.max(p,i),n=Math.min(p,n)),UT.get(p).push(h.key),QG.add(p)});let s=this.state.scale;UT.has(s)||(HCt(m4,QG),m4.sort((u,h)=>u-h),s=m4.reduce((u,h)=>Math.abs(h-s)<Math.abs(u-s)?h:u,m4[0])),s=Math.min(s,i),s=Math.max(s,n);const o=UT.get(s),a=r.getClosestInfoForScale(s),l=a.getColumnForX(this.state.center[0]),c=a.getRowForY(this.state.center[1]);return o.sort((u,h)=>{const p=a.denormalizeCol(u.col,u.world),f=a.denormalizeCol(h.col,h.world);return Math.sqrt((l-p)*(l-p)+(c-u.row)*(c-u.row))-Math.sqrt((l-f)*(l-f)+(c-h.row)*(c-h.row))}),QG.clear(),UT.clear(),o[0].id}_peekByCenterFirst(e){if(!this.state)return e.values().next().value;const r=this.tileInfoView,i=this.state.center;let n,s=Number.POSITIVE_INFINITY;return e.forEach(o=>{const a=this._keyToItem.get(o);r.getTileCoords(kge,a.key);const l=mv(kge,i);l<s&&(s=l,n=a.key)}),n.id}};d([m({constructOnly:!0})],$b.prototype,"concurrency",void 0),d([m({constructOnly:!0})],$b.prototype,"process",void 0),d([m()],$b.prototype,"state",void 0),d([m({constructOnly:!0})],$b.prototype,"strategy",void 0),d([m({constructOnly:!0})],$b.prototype,"tileInfoView",void 0),$b=d([V("esri.views.2d.tiling.TileQueue")],$b);new uy(0,0,0,0);let WCt=class{constructor(e,r){this.sourceTile=r,this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.featureIndex=0,this.colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=e}},tXt=class{constructor(){this.tileSymbols=[],this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1}};function iXt(t,e,r,i,n,s){const o=r-n;if(o>=0)return(e>>o)+(i-(s<<o))*(t>>o);const a=-o;return e-(s-(i<<a))*(t>>a)<<a}let nXt=class{constructor(e,r,i){this._rows=Math.ceil(r/i),this._columns=Math.ceil(e/i),this._cellSize=i,this.cells=new Array(this._rows);for(let n=0;n<this._rows;n++){this.cells[n]=new Array(this._columns);for(let s=0;s<this._columns;s++)this.cells[n][s]=[]}}getCell(e,r){const i=Math.min(Math.max(Math.floor(r/this._cellSize),0),this._rows-1),n=Math.min(Math.max(Math.floor(e/this._cellSize),0),this._columns-1);return this.cells[i]&&this.cells[i][n]||null}getCellSpan(e,r,i,n){return[Math.min(Math.max(Math.floor(e/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(r/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(i/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(n/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}};function qCt(t,e,r,i,n,s,o){const a=e[i++];for(let l=0;l<a;l++){const c=new WCt(s,o);c.xTile=e[i++],c.yTile=e[i++],c.hash=e[i++],c.priority=e[i++],c.featureIndex=e[i++];const u=e[i++];for(let f=0;f<u;f++){const g=e[i++],_=e[i++],v=e[i++],b=e[i++],w=!!e[i++],x=e[i++],S=r[i++],E=r[i++],A=e[i++],O=e[i++];c.colliders.push({xTile:g,yTile:_,dxPixels:v,dyPixels:b,hard:w,partIndex:x,width:A,height:O,minLod:S,maxLod:E})}const h=t[i++];for(let f=0;f<h;f++)c.textVertexRanges.push([t[i++],t[i++]]);const p=t[i++];for(let f=0;f<p;f++)c.iconVertexRanges.push([t[i++],t[i++]]);n.push(c)}return i}function oXt(t,e,r){for(const[i,n]of t.symbols)YCt(t,e,r,n,i)}function YCt(t,e,r,i,n){const s=t.layerData.get(n);if(s.type===$c.SYMBOL){for(const o of i){const a=o.unique;let l;if(o.selectedForRendering){const c=a.parts[0],u=c.startOpacity,h=c.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&h===0;const p=r?Math.floor(127*u)|h<<7:h?255:0;l=p<<24|p<<16|p<<8|p}else l=0;for(const[c,u]of o.iconVertexRanges)for(let h=c;h<c+u;h+=4)s.iconOpacity[h/4]=l;if(o.selectedForRendering){const c=a.parts[1],u=c.startOpacity,h=c.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&h===0;const p=r?Math.floor(127*u)|h<<7:h?255:0;l=p<<24|p<<16|p<<8|p}else l=0;for(const[c,u]of o.textVertexRanges)for(let h=c;h<c+u;h+=4)s.textOpacity[h/4]=l}s.lastOpacityUpdate=e,s.opacityChanged=!0}}function aXt(t,e,r,i){const n=t.colliders;let s,o,a,l;for(const c of n)if(t.unique.show&&t.unique.parts[c.partIndex].show&&(s=c.xScreen-i[0]+c.dxScreen,o=c.yScreen-i[1]+c.dyScreen,a=s+c.width,l=o+c.height,U_t(r,e.x,e.y,s,o,a,l)))return!0;return!1}let tB=class{constructor(e,r){this.layerUIDs=[],this.isDestroyed=!1,this._data=e;let i=1;const n=new Uint32Array(e);this.layerUIDs=[];const s=n[i++];for(let o=0;o<s;o++)this.layerUIDs[o]=n[i++];this.bufferDataOffset=i,r&&(this.layer=r.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return this._data==null}get offset(){return this.bufferDataOffset}get data(){return this._data}destroy(){this.isDestroyed||(this.doDestroy(),this._data=null,this.isDestroyed=!0)}prepareForRendering(e){this._data!=null&&(this.doPrepareForRendering(e,this._data,this.bufferDataOffset),this._data=null)}},XCt=class extends tB{constructor(e,r){super(e,r),this.type=$c.LINE,this.lineIndexStart=0,this.lineIndexCount=0;const i=new Uint32Array(e);let n=this.bufferDataOffset;this.lineIndexStart=i[n++],this.lineIndexCount=i[n++];const s=i[n++];if(s>0){this.patternMap=new Map;for(let o=0;o<s;o++){const a=i[n++],l=i[n++],c=i[n++];this.patternMap.set(a,[l,c])}}this.bufferDataOffset=n}get memoryUsed(){var e,r;return(((e=this.data)==null?void 0:e.byteLength)??0)+(((r=this.vao)==null?void 0:r.usedMemory)??0)}hasData(){return this.lineIndexCount>0}triangleCount(){return this.lineIndexCount/3}doDestroy(){this.vao=gt(this.vao)}doPrepareForRendering(e,r,i){const n=new Uint32Array(r),s=new Int32Array(n.buffer),o=n[i++],a=Wr.createVertex(e,Ar.STATIC_DRAW,new Int32Array(s.buffer,4*i,o));i+=o;const l=n[i++],c=Wr.createIndex(e,Ar.STATIC_DRAW,new Uint32Array(n.buffer,4*i,l));i+=l;const u=this.layer.lineMaterial;this.vao=new _d(e,u.getAttributeLocations(),u.getLayoutInfo(),{geometry:a},c)}},ZCt=class extends tB{constructor(e,r){super(e,r),this.type=$c.FILL,this.fillIndexStart=0,this.fillIndexCount=0,this.outlineIndexStart=0,this.outlineIndexCount=0;const i=new Uint32Array(e);let n=this.bufferDataOffset;this.fillIndexStart=i[n++],this.fillIndexCount=i[n++],this.outlineIndexStart=i[n++],this.outlineIndexCount=i[n++];const s=i[n++];if(s>0){this.patternMap=new Map;for(let o=0;o<s;o++){const a=i[n++],l=i[n++],c=i[n++];this.patternMap.set(a,[l,c])}}this.bufferDataOffset=n}get memoryUsed(){var e,r,i;return(((e=this.data)==null?void 0:e.byteLength)??0)+(((r=this.fillVAO)==null?void 0:r.usedMemory)??0)+(((i=this.outlineVAO)==null?void 0:i.usedMemory)??0)}hasData(){return this.fillIndexCount>0||this.outlineIndexCount>0}triangleCount(){return(this.fillIndexCount+this.outlineIndexCount)/3}doDestroy(){this.fillVAO=gt(this.fillVAO),this.outlineVAO=gt(this.outlineVAO)}doPrepareForRendering(e,r,i){const n=new Uint32Array(r),s=new Int32Array(n.buffer),o=n[i++],a=Wr.createVertex(e,Ar.STATIC_DRAW,new Int32Array(s.buffer,4*i,o));i+=o;const l=n[i++],c=Wr.createIndex(e,Ar.STATIC_DRAW,new Uint32Array(n.buffer,4*i,l));i+=l;const u=n[i++],h=Wr.createVertex(e,Ar.STATIC_DRAW,new Int32Array(s.buffer,4*i,u));i+=u;const p=n[i++],f=Wr.createIndex(e,Ar.STATIC_DRAW,new Uint32Array(n.buffer,4*i,p));i+=p;const g=this.layer,_=g.fillMaterial,v=g.outlineMaterial;this.fillVAO=new _d(e,_.getAttributeLocations(),_.getLayoutInfo(),{geometry:a},c),this.outlineVAO=new _d(e,v.getAttributeLocations(),v.getLayoutInfo(),{geometry:h},f)}},JCt=class extends tB{constructor(e,r,i){super(e,r),this.type=$c.SYMBOL,this.iconPerPageElementsMap=new Map,this.glyphPerPageElementsMap=new Map,this.symbolInstances=[],this.isIconSDF=!1,this.opacityChanged=!1,this.lastOpacityUpdate=0,this.symbols=[];const n=new Uint32Array(e),s=new Int32Array(e),o=new Float32Array(e);let a=this.bufferDataOffset;this.isIconSDF=!!n[a++];const l=n[a++],c=n[a++],u=n[a++],h=new uy(l,c,u,0),p=n[a++];for(let v=0;v<p;v++){const b=n[a++],w=n[a++],x=n[a++];this.iconPerPageElementsMap.set(b,[w,x])}const f=n[a++];for(let v=0;v<f;v++){const b=n[a++],w=n[a++],x=n[a++];this.glyphPerPageElementsMap.set(b,[w,x])}const g=n[a++],_=n[a++];this.iconOpacity=new Int32Array(g),this.textOpacity=new Int32Array(_),a=qCt(n,s,o,a,this.symbols,i,h),this.bufferDataOffset=a}get memoryUsed(){var e,r,i;return(((e=this.data)==null?void 0:e.byteLength)??0)+(((r=this.iconVAO)==null?void 0:r.usedMemory)??0)+(((i=this.textVAO)==null?void 0:i.usedMemory)??0)+K1(this.iconOpacity)+K1(this.textOpacity)}hasData(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0}triangleCount(){let e=0;for(const[r,i]of this.iconPerPageElementsMap)e+=i[1];for(const[r,i]of this.glyphPerPageElementsMap)e+=i[1];return e/3}doDestroy(){this.iconVAO=gt(this.iconVAO),this.textVAO=gt(this.textVAO)}updateOpacityInfo(){if(!this.opacityChanged)return;this.opacityChanged=!1;const e=this.iconOpacity,r=this.iconVAO.vertexBuffers.opacity;e.length>0&&e.byteLength===r.usedMemory&&r.setSubData(e,0,0,e.length);const i=this.textOpacity,n=this.textVAO.vertexBuffers.opacity;i.length>0&&i.byteLength===n.usedMemory&&n.setSubData(i,0,0,i.length)}doPrepareForRendering(e,r,i){const n=new Uint32Array(r),s=new Int32Array(n.buffer),o=n[i++],a=Wr.createVertex(e,Ar.STATIC_DRAW,new Int32Array(s.buffer,4*i,o));i+=o;const l=n[i++],c=Wr.createIndex(e,Ar.STATIC_DRAW,new Uint32Array(n.buffer,4*i,l));i+=l;const u=n[i++],h=Wr.createVertex(e,Ar.STATIC_DRAW,new Int32Array(s.buffer,4*i,u));i+=u;const p=n[i++],f=Wr.createIndex(e,Ar.STATIC_DRAW,new Uint32Array(n.buffer,4*i,p));i+=p;const g=Wr.createVertex(e,Ar.STATIC_DRAW,this.iconOpacity.buffer),_=Wr.createVertex(e,Ar.STATIC_DRAW,this.textOpacity.buffer),v=this.layer,b=v.iconMaterial,w=v.textMaterial;this.iconVAO=new _d(e,b.getAttributeLocations(),b.getLayoutInfo(),{geometry:a,opacity:g},c),this.textVAO=new _d(e,w.getAttributeLocations(),w.getLayoutInfo(),{geometry:h,opacity:_},f)}},QCt=class extends tB{constructor(e,r){super(e,r),this.type=$c.CIRCLE,this.circleIndexStart=0,this.circleIndexCount=0;const i=new Uint32Array(e);let n=this.bufferDataOffset;this.circleIndexStart=i[n++],this.circleIndexCount=i[n++],this.bufferDataOffset=n}get memoryUsed(){var e,r;return(((e=this.data)==null?void 0:e.byteLength)??0)+(((r=this.vao)==null?void 0:r.usedMemory)??0)}hasData(){return this.circleIndexCount>0}triangleCount(){return this.circleIndexCount/3}doDestroy(){this.vao=gt(this.vao)}doPrepareForRendering(e,r,i){const n=new Uint32Array(r),s=new Int32Array(n.buffer),o=n[i++],a=Wr.createVertex(e,Ar.STATIC_DRAW,new Int32Array(s.buffer,4*i,o));i+=o;const l=n[i++],c=Wr.createIndex(e,Ar.STATIC_DRAW,new Uint32Array(n.buffer,4*i,l));i+=l;const u=this.layer.circleMaterial;this.vao=new _d(e,u.getAttributeLocations(),u.getLayoutInfo(),{geometry:a},c)}};const pXt=!0,fXt=32,zge=200,Uge=se("mapview-transitions-duration")===0?0:1/se("mapview-transitions-duration");let KCt=class extends Qn{constructor(){super(...arguments),this._fadeOutResolver=null,this._fadeInResolver=null,this._clips=null,this.computedVisible=!0,this.computedOpacity=1,this.fadeTransitionEnabled=!1,this.inFadeTransition=!1,this._isReady=!1,this._opacity=1,this.parent=null,this._stage=null,this._visible=!0}get clips(){return this._clips}set clips(e){this._clips=e,this.requestRender()}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(e){this._opacity!==e&&(this._opacity=Math.min(1,Math.max(e,0)),this.requestRender())}get stage(){return this._stage}set stage(e){var i;if(this._stage===e)return;const r=this._stage;this._stage=e,e?(i=this._stage)!=null&&i.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):r==null||r.trashDisplayObject(this)}get transforms(){return this._getTransforms()}_getTransforms(){return this._transforms==null&&(this._transforms=this._createTransforms()),this._transforms}get visible(){return this._visible}set visible(e){this._visible!==e&&(this._visible=e,this.requestRender())}get hasLabels(){return!1}get hasHighlight(){return!1}get hasBlending(){return!1}fadeIn(){return this._fadeInResolver||(this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.opacity=1,this.computedOpacity=0,this.fadeTransitionEnabled=!0,this._fadeInResolver=ha(),this.requestRender()),this._fadeInResolver.promise}fadeOut(){return this._fadeOutResolver||(this.opacity=0,this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this.fadeTransitionEnabled=!0,this._fadeOutResolver=ha(),this.requestRender()),this._fadeOutResolver.promise}endTransitions(){var e,r;(e=this._fadeInResolver)==null||e.call(this),this._fadeInResolver=null,(r=this._fadeOutResolver)==null||r.call(this),this._fadeOutResolver=null,this.computedOpacity=this.visible?this.opacity:0,this.requestRender()}beforeRender(e){this.updateTransitionProperties(e.deltaTime,e.state.scale),this.setTransform(e.state)}afterRender(e){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&this.computedOpacity===0&&(this._fadeOutResolver(),this._fadeOutResolver=null)}remove(){var e;(e=this.parent)==null||e.removeChild(this)}setTransform(e){}processRender(e){this.stage&&this.computedVisible&&this.doRender(e)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.onDetach(),this.emit("detach")}updateTransitionProperties(e,r){if(this.fadeTransitionEnabled&&Uge!==0){const i=this._fadeOutResolver||!this.visible?0:this.opacity,n=this.computedOpacity;if(n===i)this.computedVisible=this.visible;else{const s=e*Uge;this.computedOpacity=n>i?Math.max(i,n-s):Math.min(i,n+s),this.computedVisible=this.computedOpacity>0;const o=i===this.computedOpacity;this.inFadeTransition=!o,o||this.requestRender()}}else this.computedOpacity=this.opacity,this.computedVisible=this.visible}onAttach(){}onDetach(){}doRender(e){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}},WNe=class extends KCt{constructor(e,r,i,n,s,o,a=s,l=o){super(),this.tileDebugInfoTexture=null,this.debugInfo={display:{length:0,minOrderedLength:0,minUnorderedLength:0,triangleCount:0},memory:{bytesUsed:0,bytesReserved:0}},this._destroyed=!1,this.key=new uy(e),this.resolution=r,this.x=i,this.y=n,this.width=s,this.height=o,this.rangeX=a,this.rangeY=l}destroy(){this.tileDebugInfoTexture&&(this.tileDebugInfoTexture.dispose(),this.tileDebugInfoTexture=null),this._destroyed=!0}get debugSlot(){let e=this;for(;e.parent!==this._stage;){if(!e.parent)return 0;e=e.parent}return this._stage.children.indexOf(e)}setTransform(e){const r=this.resolution/(e.resolution*e.pixelRatio),i=this.transforms.tileMat3,[n,s]=e.toScreenNoRotation([0,0],[this.x,this.y]),o=this.width/this.rangeX*r,a=this.height/this.rangeY*r;cte(i,o,0,0,0,a,0,n,s,1),XE(this.transforms.displayViewScreenMat3,e.displayViewMat3,i)}get destroyed(){return this._destroyed}},KG=class qNe extends WNe{constructor(e,r,i,n,s,o,a,l=null){super(e,r,i,n,s,o,4096,4096),this.styleRepository=a,this._memCache=l,this.type="vector-tile",this._referenced=0,this._hasSymbolBuckets=!1,this._memoryUsedByLayerData=0,this.layerData=new Map,this.status="loading",this.allSymbolsFadingOut=!1,this.lastOpacityUpdate=0,this.symbols=new Map,this.isCoverage=!1,this.neededForCoverage=!1,this.decluttered=!1,this.parentTile=null,this.childrenTiles=new Set,this.featureIndex=null,this.triangleCount=0,this._processed=!1,this._referenced=1,this.id=e.id}get hasSymbolBuckets(){return this._hasSymbolBuckets}get isFading(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<zge}get isHoldingForFade(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<zge)}get wasRequested(){return this.status==="errored"||this.status==="loaded"||this.status==="reloading"}setData(e){this.changeDataImpl(e),this.requestRender(),this.ready(),this._processed=!0}deleteLayerData(e){var i,n;let r=!1;for(const s of e){const o=this.layerData.get(s);o&&(this._memoryUsedByLayerData-=o.memoryUsed,o.type===$c.SYMBOL&&this.symbols.delete(s)&&(r=!0),o.destroy(),this.layerData.delete(s))}(i=this._memCache)==null||i.updateSize(this.key.id,this,this._memoryUsedByLayerData),r&&((n=this.featureIndex)==null||n.clear(),this.emit("symbols-changed")),this.requestRender()}processed(){return this._processed}hasData(){return this.layerData.size>0}dispose(){this.status!=="unloaded"&&(this.featureIndex=null,YNe.delete(this),qNe._destroyRenderBuckets(this.layerData),this.layerData.clear(),this._memoryUsedByLayerData=0,this.destroy(),this.status="unloaded")}release(){return--this._referenced==0&&(this.dispose(),this.stage=null,!0)}retain(){++this._referenced}get referenced(){return this._referenced}get usedMemory(){return this._memoryUsedByLayerData+256}changeDataImpl(e){var i,n;(i=this.featureIndex)==null||i.clear();let r=!1;if(e){const{bucketsWithData:s,emptyBuckets:o}=e,a=this._createRenderBuckets(s);if(o&&o.byteLength>0){const l=new Uint32Array(o);for(const c of l)this._deleteLayerData(c)}for(const[l,c]of a)this._deleteLayerData(l),c.type===$c.SYMBOL&&(this.symbols.set(l,c.symbols),r=!0),this._memoryUsedByLayerData+=c.memoryUsed,this.layerData.set(l,c);(n=this._memCache)==null||n.updateSize(this.key.id,this,this.usedMemory)}this._hasSymbolBuckets=!1;for(const[s,o]of this.layerData)o.type===$c.SYMBOL&&(this._hasSymbolBuckets=!0);r&&this.emit("symbols-changed")}attachWithContext(e){this.stage={context:e,trashDisplayObject(r){r.processDetach()},untrashDisplayObject:()=>!1}}setTransform(e){super.setTransform(e);const r=this.resolution/(e.resolution*e.pixelRatio),i=this.width/this.rangeX*r,n=this.height/this.rangeY*r,s=[0,0];e.toScreen(s,[this.x,this.y]);const o=this.transforms.tileUnitsToPixels;ute(o),C6(o,o,s),hte(o,o,Math.PI*e.rotation/180),z9(o,o,[i,n,1])}_createTransforms(){return{displayViewScreenMat3:Jm(),tileMat3:Jm(),tileUnitsToPixels:Jm()}}static _destroyRenderBuckets(e){if(!e)return;const r=new Set;for(const i of e.values())r.has(i)||(i.destroy(),r.add(i));e.clear()}_createRenderBuckets(e){const r=new Map,i=new Map;for(const n of e){const s=this._deserializeBucket(n,i);for(const o of s.layerUIDs)r.set(o,s)}return r}_deserializeBucket(e,r){let i=r.get(e);if(i)return i;switch(new Uint32Array(e)[0]){case $c.FILL:i=new ZCt(e,this.styleRepository);break;case $c.LINE:i=new XCt(e,this.styleRepository);break;case $c.SYMBOL:i=new JCt(e,this.styleRepository,this);break;case $c.CIRCLE:i=new QCt(e,this.styleRepository)}return r.set(e,i),i}_deleteLayerData(e){if(!this.layerData.has(e))return;const r=this.layerData.get(e);this._memoryUsedByLayerData-=r.memoryUsed,r.destroy(),this.layerData.delete(e)}};const YNe=new Map;function eEt(){YNe.forEach((t,e)=>{console.log(`
${e.key}:`),t[0].forEach(r=>console.log(r)),console.log("========"),t[1].forEach(r=>console.log(r))})}let tEt=class{constructor(e="scene"){this.context=e,this.extent=Ku()}};const _Xt={value:.5,readOnly:!0},rEt={readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:1}};let SC=class{constructor(e=0,r=0){this.min=e,this.max=r,this.level=0,this.hasNoDataValues=!1}copyFrom(e){this.min=e.min,this.max=e.max,this.level=e.level,this.hasNoDataValues=e.hasNoDataValues}},iEt=class{constructor(e,r){this.data=e,this.safeWidth=.99999999*(e.width-1),this.dx=(e.width-1)/(r[2]-r[0]),this.dy=(e.width-1)/(r[3]-r[1]),this.x0=r[0],this.y1=r[3]}},nEt=class{constructor(e,r,i){this.type="elevation",this.level=e[0],this.i=e[1],this.j=e[2],this.extent=r,this.samplerData=new iEt(i,r)}computeMinMaxValue(e,r,i,n){n.min=1/0,n.max=-1/0,n.hasNoDataValues=!1;const s=e-this.level;if(s<=0)return n;const o=2**s;if(!(Math.floor(r/o)===this.i&&Math.floor(i/o)===this.j))return n;let a=1/0,l=-1/0;const c=this.samplerData.data.width,u=this.samplerData.data.values,h=.5*A$;let p=(c-1)/o,f=(i-this.j*o)*p,g=(r-this.i*o)*p;if(p<1){const _=Math.floor(f),v=Math.floor(g),b=_+v*c,w=u[b],x=u[b+1],S=u[b+c],E=u[b+c+1];if(w+x+S+E<h){const A=f-_,O=g-v,L=fD(w,x,S,E,A,O),z=fD(w,x,S,E,A+p,O),k=fD(w,x,S,E,A,O+p),q=fD(w,x,S,E,A+p,O+p);return n.min=Math.min(L,z,k,q),n.max=Math.max(L,z,k,q),n}f=_,g=v,p=1}else f=Math.floor(f),g=Math.floor(g),p=Math.ceil(p);for(let _=f;_<=f+p;_++)for(let v=g;v<=g+p;v++){const b=u[_+v*c];b<h?(a=Math.min(a,b),l=Math.max(l,b)):n.hasNoDataValues=!0}return n.min=a,n.max=l,n}};const sEt=.5*A$;function dn(t,e,r){if(r==null)return null;for(const i of r){if(!i)continue;const n=i.safeWidth;let s=we(i.dy*(i.y1-e),0,n),o=we(i.dx*(t-i.x0),0,n);const a=Math.floor(s),l=Math.floor(o),c=i.data.width,u=a*c+l,h=i.data.values,p=h[u],f=h[u+1],g=u+c,_=h[g],v=h[g+1];if(p+_+f+v<sEt){s-=a,o-=l;const b=p+(f-p)*o;return b+(_+(v-_)*o-b)*s}}return null}var Pa,mt;(function(t){t[t.INSIDE=0]="INSIDE",t[t.INTERSECTS=1]="INTERSECTS",t[t.OUTSIDE=2]="OUTSIDE"})(Pa||(Pa={})),function(t){t[t.NORTH=0]="NORTH",t[t.NORTH_EAST=1]="NORTH_EAST",t[t.EAST=2]="EAST",t[t.SOUTH_EAST=3]="SOUTH_EAST",t[t.SOUTH=4]="SOUTH",t[t.SOUTH_WEST=5]="SOUTH_WEST",t[t.WEST=6]="WEST",t[t.NORTH_WEST=7]="NORTH_WEST"}(mt||(mt={}));const BT=C(),oEt=C(),Ug=C(),Bg=C();function aEt(t,e,r=0){const i=t.extent;if(i==null)return!1;if(r===0)return i2e(i,e);const n=Math.min(i[2]-i[0],i[3]-i[1]);return LGe(i,e,r*n)}function g4(t,e,r,i){ce(BT,r),BT[i]=e[i];const n=ye(BT,BT,e),s=ye(oEt,t,e),o=de(s,n),a=de(n,n);let l;l=o<=0?e:a<=o?r:fe(BT,e,ne(n,n,o/a));const c=ye(BT,t,l);return Math.PI/2-Math.atan(c[2]/Math.sqrt(c[0]*c[0]+c[1]*c[1]))}function lEt(t,e,r){const i=t.extent;if(i==null)return 0;Ug[0]=i[0],Ug[1]=i[1],Ug[2]=r,Bg[0]=i[2],Bg[1]=i[3],Bg[2]=r;let n=1/0,s=1/0;return e[0]<Ug[0]?n=g4(e,Ug,Bg,0):e[0]>Bg[0]&&(n=g4(e,Bg,Ug,0)),e[1]<Ug[1]?s=g4(e,Ug,Bg,1):e[1]>Bg[1]&&(s=g4(e,Bg,Ug,1)),Math.min(n,s)}function cEt(t,e,r){if(t==null)return wte();if(t.spatialReference.isGeographic&&!dv(t.spatialReference))return new K("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");const i=Fc.checkUnsupported(t);if(i!=null)return i;if(r==null)return new K("tilingscheme:extent-not-exist","The layer does not provide a layer extent.");const n=uEt(t,r);if(n)return n;const s=t.spatialReference;return e==null||s.equals(e)||e.isWGS84&&s.isWebMercator?null:new K("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene")}function uEt(t,e){const r=t.lods,i=r[0].resolution*2**r[0].level,n=[i*t.size[0],i*t.size[1]],s=[t.origin.x,t.origin.y],o=r2e(e),a=Wt();Fc.computeRowColExtent(o,n,s,a);const l=(a[2]-a[0])*(a[3]-a[1]);if(l>oC){const c=r[0].scale*2**r[0].level;let u=Math.max((o[3]-o[1])/t.size[1],(o[2]-o[0])/t.size[0])*c/i;const h=Math.floor(Math.log(u)/Math.log(10));return u=Math.ceil(u/10**h)*10**h,new K("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(c).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+u.toLocaleString()+".",{level0Scale:c,suggestedLevel0Scale:u,requiredNumRootTiles:l,allowedNumRootTiles:oC})}return null}const hEt=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:cEt,isInsideExtent:aEt,tiltToExtentEdge:lEt},Symbol.toStringTag,{value:"Module"}));function dEt(){return!0}function pEt(){return 0}function fEt(t,e){if(t==null)return wte();const r=t.lods.length-1,i=t.spatialReference,n=dv(i)||Iv(i)||Lv(i);if(i.isWebMercator){if(!Fc.makeWebMercatorAuxiliarySphere(r).compatibleWith(t))return new K("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else{if(!n)return new K("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!Fc.makeGCSWithTileSize(t.spatialReference,t.size[0],r).compatibleWith(t))return t.spatialReference.isWGS84?new K("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new K("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}return e==null||t.spatialReference.equals(e)?void 0:new K("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene")}const mEt=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:fEt,isInsideExtent:dEt,tiltToExtentEdge:pEt},Symbol.toStringTag,{value:"Module"})),gEt={[De.Global]:mEt,[De.Local]:hEt};function Ss(t,e){t||console.warn("Terrain: "+e)}let Ys=!1,V8=!1;function yEt(t){V8=t,Ys=Ys||t}function _Et(t){Ys=t}function Re(t,e){var r;if(Ys&&!t){const i=(r=new Error().stack)==null?void 0:r.slice(5);throw console.warn("Terrain internal: "+(e??"")+" at "+i),new Error("Assertion failed"+(e?": "+e:""))}}function TJ(t){return rB(t)?{fullExtent:t.fullExtent,minScale:t.layer.minScale,maxScale:t.layer.maxScale,tilemapCache:null}:t.layer}function G8(t){return(t==null?void 0:t.type)==="imagery-tile"||(t==null?void 0:t.type)==="wcs"}function rB(t){return(t==null?void 0:t.type)==="imagery-tile-3d"}function Cne(t){return(t==null?void 0:t.type)==="tile-3d"}function kx(t){return(t==null?void 0:t.type)==="vector-tile-3d"}function XNe(t){return(t==null?void 0:t.type)==="wmts-3d"}function SJ(t){return(t==null?void 0:t.type)==="elevation-3d"}function vA(t){return(t==null?void 0:t.type)==="group"}function oI(t){return t&&(Cne(t)||XNe(t)||rB(t)||kx(t))}function CJ(t){return t&&(Cne(t)||rB(t)||kx(t)||XNe(t))}function EJ(t){return CJ(t)||SJ(t)}function vEt(t){var r;const e=(r=t==null?void 0:t.sourceLayerInfo)==null?void 0:r.data;return e!=null&&"type"in e&&e.type==="raster-tile"}function bEt(t){return ZNe(t==null?void 0:t.sourceLayerInfo)||!!(t!=null&&t.isVTLBackground)}function wEt(t){var r;const e=(r=t==null?void 0:t.sourceLayerInfo)==null?void 0:r.data;return e!=null&&"type"in e&&e.type==="tile-texture"}function xEt(t){var r;const e=(r=t==null?void 0:t.sourceLayerInfo)==null?void 0:r.data;return e instanceof HTMLImageElement||e instanceof Sne||e instanceof HTMLCanvasElement||e instanceof ImageData}function ZNe(t){return(t==null?void 0:t.data)!=null&&"type"in t.data&&t.data.type==="vector-tile"}function hE(t){return t!=null&&"release"in t&&t.release(),null}function Bge(t){return t.fetchTile&&t.hasOverriddenFetchTile!==!1}function Ene(t,e,r,i){return gEt[i].checkIfTileInfoSupportedForViewSR(t,r,e)}function iB(t,e,r){let i=null,n=null;if((t==null?void 0:t.type)==="wmts"){const s=TEt(t,e,r);i=s.tileInfo,n=s.fullExtent}else{n=G8(t)?t.getCompatibleFullExtent(e):t.fullExtent;const s=r===De.Local;if(G8(t))i=t.getCompatibleTileInfo(e,n,s);else if((t==null?void 0:t.type)==="vector-tile"){const o=s&&!SEt(e)||CEt.force512VTL,a=t.tileInfo.spatialReference.isGeographic;i=o?t.tileInfo:t.tileInfo.getOrCreateCompatible(256,a?1:2)}else i=t.tileInfo}return i!=null&&n!=null&&Ene(i,n,e,r)==null?{tileInfo:i,fullExtent:n}:null}function TEt(t,e,r){const i=ZVe(t);if(i!=null){if(!$t.isCollection(i))return{tileInfo:i.tileInfo,fullExtent:i.fullExtent};{const n=i.find(s=>Ene(s.tileInfo,s.fullExtent,e,r)==null);if(n)return{tileInfo:n.tileInfo,fullExtent:n.fullExtent}}}return{tileInfo:null,fullExtent:null}}function SEt(t){return t.isWGS84||t.isWebMercator||jwe(t)||!c$(t)}const CEt={force512VTL:!1};function Vge(t){return"["+t[0]+","+t[1]+","+t[2]+"]"}function Vg(t){return"("+t[0]+","+t[1]+","+t[2]+")"}function Hh(t,e,r=AEt){return Math.abs(t-e)<r}function j8(t){return t===mt.NORTH_EAST?mt.SOUTH_WEST:t===mt.NORTH_WEST?mt.SOUTH_EAST:t===mt.SOUTH_WEST?mt.NORTH_EAST:mt.NORTH_WEST}function Pne(t){return t===mt.NORTH?mt.SOUTH:t===mt.EAST?mt.WEST:t===mt.SOUTH?mt.NORTH:mt.EAST}function EEt(t){return t===mt.NORTH_WEST||t===mt.SOUTH_WEST}function PEt(t){return t===mt.NORTH_WEST||t===mt.NORTH_EAST}function Gge(t){return t===mt.NORTH_WEST||t===mt.WEST||t===mt.SOUTH_WEST}function jge(t){return t===mt.NORTH_EAST||t===mt.EAST||t===mt.SOUTH_EAST}function Hge(t){return t===mt.SOUTH_EAST||t===mt.SOUTH||t===mt.SOUTH_WEST}function Wge(t){return t===mt.NORTH_EAST||t===mt.NORTH||t===mt.NORTH_WEST}const jp=[mt.NORTH,mt.EAST,mt.SOUTH,mt.WEST],H8=[mt.NORTH_EAST,mt.SOUTH_EAST,mt.SOUTH_WEST,mt.NORTH_WEST],AEt=1e-5;let Oh=class extends Ae{constructor(e){super(e)}initialize(){this.addHandles([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])}destroy(){}get layerViewsExtent(){return this._computeLayerViewsExtent()}get tiledLayersExtent(){return this._computeTiledLayersExtent()}get stencilEnabledExtents(){return this._computeStencilEnabledExtents()}_computeStencilEnabledExtents(){const e=[];return this.layerViews.forEach(r=>{const i=r.layer;if(XVe(i.operationalLayerType)&&this.viewSpatialReference!=null){const n=JNe(i.fullExtent,this.viewSpatialReference);n!=null&&e.push(r2e(n))}}),e}};function MEt(t,e){return t===De.Global?new PJ(e):new AJ(e)}d([m({readOnly:!0})],Oh.prototype,"layerViewsExtent",null),d([m({readOnly:!0})],Oh.prototype,"tiledLayersExtent",null),d([m({readOnly:!0})],Oh.prototype,"stencilEnabledExtents",null),d([m()],Oh.prototype,"viewSpatialReference",void 0),d([m()],Oh.prototype,"tilingScheme",void 0),d([m()],Oh.prototype,"defaultTiledLayersExtent",void 0),d([m({constructOnly:!0})],Oh.prototype,"layers",void 0),d([m({constructOnly:!0})],Oh.prototype,"layerViews",void 0),Oh=d([V("esri.views.3d.terrain.ExtentHelper")],Oh);let PJ=class extends Oh{_computeLayerViewsExtent(){return this._globalExtent}_computeTiledLayersExtent(){return this._globalExtent}get _globalExtent(){return this.viewSpatialReference.isWebMercator?xEe:zQe}};PJ=d([V("esri.views.3d.terrain.ExtentHelperGlobal")],PJ);let AJ=class extends Oh{_computeLayerViewsExtent(){const e=Ku(),r=this.viewSpatialReference;this.layerViews.forEach(s=>{const o=s.layer;if(s.isResolved()&&(o.type!=="graphics"||!o.internal)){const a=JNe("fullExtentInLocalViewSpatialReference"in s&&s.fullExtentInLocalViewSpatialReference||s.layer.fullExtent,r);V1(e,a,e)}});const i=kW(e)?e:null,n=this._get("layerViewsExtent");return Sx(i,n)?n:i}_computeTiledLayersExtent(){const e=this.tilingScheme;if(!e)return null;const r=this.viewSpatialReference,i=Ku();this.layers.forEach(o=>{if(o.loaded&&HO(o)){const a=iB(o,r,De.Local);if(a==null)return;const{tileInfo:l,fullExtent:c}=a;l!=null&&c!=null&&(G8(o)||e.compatibleWith(l)&&c.spatialReference.equals(e.spatialReference))&&V1(i,c,i)}}),V1(i,this.defaultTiledLayersExtent,i);const n=kW(i)?i:null,s=this._get("tiledLayersExtent");return Sx(n,s)?s:n}};function JNe(t,e){return t==null||t.spatialReference.equals(e)?t:JO(t,t.spatialReference,e)}AJ=d([V("esri.views.3d.terrain.ExtentHelperLocal")],AJ);function QNe(){var e;const t=(e=globalThis.require)==null?void 0:e.modules;if(t){const r=Object.keys(t);for(const i of r)i.includes(".glsl")&&delete t[i]}}const KNe=1.3,OEt=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let p_,Ul=class extends Ae{constructor(e){super(e),this._spatialReference=null,this._renderSR=null,this._overlaySREqualsRenderSR=!0,this._drapeSources=new Set,this._drapeTargets=new Set,this._placementDirty=!1,this._contentUpdated=!1,this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1,this._longitudeCyclical=null,this._latestOriginId=0,this._maxResolution=se("esri-mobile")?2048:4096,this._animationTimeLast=0}initialize(){const e=this.view;this.renderer=new Ch({view:e,worldToPCSRatio:this._worldToPCSRatio,spatialReference:this._spatialReference}),e._stage.renderer.plugins.add(this.renderer);const r=()=>this.setDrawTexturesDirty();this._groundIntersector=yd(this.view.state.viewingMode),this._groundIntersector.options.backfacesTerrain=!0,this._groundIntersector.options.invisibleTerrain=!0,this._groundIntersector.options.hud=!1,this.addHandles([he(()=>this.renderer.hasHighlights,r),this.renderer.events.on("has-water",i=>{var n;return(n=e._stage)==null?void 0:n.renderer.setParameters({hasOverlayWater:i})}),this.renderer.events.on("content-changed",r),he(()=>e.state.camera.pixelRatio,r),he(()=>e.state.alignPixelEnabled,r),this.renderer.events.on("textures-disposed",()=>this.surface.requestRender()),he(()=>{var i,n,s;return[(i=e.pointsOfInterest)==null?void 0:i.renderPointOfView,(s=(n=e.pointsOfInterest)==null?void 0:n.centerOnSurfaceFrequent)==null?void 0:s.location]},()=>this.setPlacementDirty()),he(()=>{var i,n;return[(i=e.state)==null?void 0:i.pixelRatio,(n=e.state)==null?void 0:n.contentPixelRatio]},()=>this.setPlacementDirty(),Qr),this.surface.on("elevation-change",()=>this.setPlacementDirty()),e.on("resize",()=>this.setPlacementDirty()),e.resourceController.scheduler.registerTask(bt.OVERLAY,this),e._stage.renderView.events.on("force-camera-for-screenshot",i=>{this._updateOverlays(yl,i.camera,Dn.BACKGROUND),this.renderer.hasOverlays&&this._drawOverlays(Dn.BACKGROUND,i)})]),e._stage.renderer.renderOverlay=i=>this._renderOverlay(i)}destroy(){var e;(e=this.view)!=null&&e._stage&&(this.view._stage.renderer.plugins.remove(this.renderer),this.view._stage.renderer.renderOverlay=()=>{}),p_&&(p_.hide(),p_=null),this.renderer=Pe(this.renderer)}get running(){return this._placementDirty&&(this._drapeSources.size>0||this.view.graphics.length>0||yi.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&this.surface.ready}get _isSpherical(){return this.view.state.isGlobal}get _worldToPCSRatio(){return this._spatialReference!=null&&this._spatialReference.isGeographic&&!this.view.state.isLocal?Br(this._spatialReference).metersPerDegree:1}get _overlayStretch(){return KNe/this.view.resolutionScale}get suspended(){return this.surface.suspended}get updating(){return this.running||this.renderer.updating||this._contentUpdated}get rendersOccludedDraped(){return this.renderer.rendersOccludedDraped}_renderOverlay(e){if(this._contentUpdated=!1,this.renderer.processSyncDrapeSources(),this.renderer.hasOverlays)return this._dispatchAnimationUpdate(e),this._drawOverlays(Dn.UPDATE,this.view.state)}get hasOverlays(){return this.renderer.hasOverlays}setSpatialReference(e){this._spatialReference=e,this.renderer.spatialReference=e,this._longitudeCyclical=null;const r=this.view.renderSpatialReference;e!=null&&r!=null?(this._renderSR=r,this._overlaySREqualsRenderSR=e.equals(this._renderSR),this._isSpherical&&(this._longitudeCyclical=e.isWebMercator?new sv(-20037508342787e-6,20037508342787e-6):new sv(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical),this.renderer&&(this.renderer.worldToPCSRatio=this._worldToPCSRatio)):this.renderer.disposeOverlays()}registerDrapeSource(e,r,i){this._drapeSources.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const n=this.renderer.createDrapeSourceRenderer(e,r,i);return this._updateDrapeSourceExtent(e),this._setContentDirty(),this.notifyChange("running"),n}registerGeometryDrapeSource(e){return this.registerDrapeSource(e,Tu)}_updateDrapeSourceExtent(e){this.renderer.overlays.length===2&&e.setDrapingExtent!=null&&this._spatialReference!=null&&e.setDrapingExtent(this.renderer.overlays,this._spatialReference)}unregisterDrapeSource(e){this._drapeSources.has(e)&&(this._drapeSources.delete(e),this.renderer.removeDrapeSourceRenderer(e),this.renderer.ensureDrapeSources(this._drapeSources),this._setContentDirty(),this.notifyChange("running"))}registerDrapeTarget(e){this._drapeTargets.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)}unregisterDrapeTarget(e){this._drapeTargets.delete(e),this.renderer.ensureDrapeTargets(this._drapeTargets)}_setContentDirty(){this.setPlacementDirty(),this.setDrawTexturesDirty()}setPlacementDirty(){this._placementDirty=!0}runTask(e){return this._updateOverlays(e,this.view.state.contentCamera,Dn.UPDATE)}_updateOverlays(e,r,i){if(!this._spatialReference)return Ho;const n=this._computeOverlayResolution(r);this._computeOverlayExtents(r,n,Vf),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources,Vf.stretch);const s=this._updateOverlay(us.INNER,Vf.inner,n,1*Vf.pixelRatioAdjustment,Vf.mapUnitsPerPixel),o=$a(Vf.inner)/$a(Vf.outer),a=this._updateOverlay(us.OUTER,Vf.outer,n,o*Vf.pixelRatioAdjustment,Vf.mapUnitsPerPixel);s!==vm.EXTENT&&a!==vm.EXTENT||(this._drapeSources.forEach(l=>this._updateDrapeSourceExtent(l)),this.surface.updateTileOverlayParams(i)),s===vm.NONE&&a===vm.NONE||this.setDrawTexturesDirty(),this._placementDirty=!1,e.madeProgress()}_computeOverlayResolution(e){const r=this.view.state.contentPixelRatio*this.view.resolutionScale,i=e.fullWidth/e.pixelRatio*r,n=e.fullHeight/e.pixelRatio*r,s=Math.ceil(1.5*Math.max(i,n));return Math.min(Rx(s),this._maxResolution)}_updateOverlay(e,r,i,n,s){if(this.renderer.overlays.length===0)return vm.NONE;const o=this.renderer.overlays[e],a=o.mapUnitsPerPixel;if(o.mapUnitsPerPixel=s,o.pixelRatio=n,REt(r,o.extent)&&i===o.resolution)return a===s?vm.NONE:vm.RERENDER_ONLY;ey(o.extent,r),o.resolution=i;const l=gee(o.extent);return o.renderLocalOrigin=v8(l[0],l[1],0,"OV_"+this._latestOriginId++),vm.EXTENT}setTileParameters(e){const r=e.renderData.overlay;if(this.renderer.overlays.length>0){const i=this.renderer.overlays[us.INNER],n=this.renderer.overlays[us.OUTER],s=e.extent;this._rectInsideRect(i.extent,s)||this._rectanglesOverlap(s,i.extent)||this._rectanglesOverlap(s,n.extent)?(this._setTileOverlayData(s,us.INNER,r),this._setTileOverlayData(s,us.OUTER,r)):(this._clearTileOverlayData(us.INNER,r),this._clearTileOverlayData(us.OUTER,r))}else this._clearTileOverlayData(us.INNER,r),this._clearTileOverlayData(us.OUTER,r)}overlayPixelSizeInMapUnits(e,r){if(this.renderer.overlays.length===0)return r();const i=this.renderer.overlays[us.INNER],n=this.renderer.overlays[us.OUTER],s=this._pointIsInExtent(e,i.extent)?i:n;return(s.extent[2]-s.extent[0])/s.resolution}_setTileOverlayData(e,r,i){if(this.renderer.overlays.length===0)return;const n=this.renderer.overlays[r].extent,s=$a(n),o=Jl(n);let a=e[0];if(this._longitudeCyclical){a=this._longitudeCyclical.minimalMonotonic(n[0],a);const l=this._longitudeCyclical.minimalMonotonic(n[0],e[2]);a>l&&(a=l-(e[2]-e[0]))}i.setScale(r,$a(e)/s,Jl(e)/o),i.setOffset(r,(a-n[0])/s,(e[1]-n[1])/o)}_clearTileOverlayData(e,r){r.setScale(e,-1,-1),r.setOffset(e,-1,-1)}async reloadShaders(){QNe(),await this.renderer.reloadShaders(),this.setDrawTexturesDirty(),this.runTask(yl)}_dispatchAnimationUpdate(e){const r=e-this._animationTimeLast;if(r>=this.surface.view._stage.renderer.animationTimestep||this.view.state.forcedAnimationTime!=null||this._drawTexturesDirty||this._drawTexturesAnimateDirty){const i=r/this.surface.view._stage.renderer.animationTimeDilation,n=new OOe(this.view.state.camera,i,this.view.state.forcedAnimationTime);this.renderer.updateAnimation(n)&&(this._drawTexturesAnimateDirty=!0),this._animationTimeLast=e}}setDrawTexturesDirty(){this.renderer.hasOverlays?(this._contentUpdated=!0,this._drawTexturesDirty=!0,this.view._stage.renderView.requestRender()):this.setPlacementDirty()}_intersectGroundFromView(e,r,i,n){const s=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(e,DEt,r,i);if(s==null)return!1;const o=s.origin,a=fe(y4,s.origin,s.direction);return this._groundIntersector.reset(o,a,e),this._groundIntersector.intersect([]),this.view.basemapTerrain.intersect(this._groundIntersector,null,o,a),this._groundIntersector.results.min.getIntersectionPoint(n)}_findHorizonBasedPointOfInterest(e,r){let i=.5;const n=.55,s=this.view.renderCoordsHelper.getAltitude(e.eye),o=this.view.pointsOfInterest.centerOnSurfaceFrequent,a=1e-5,l=we(o.estimatedSurfaceAltitude,e.aboveGround?-1/0:s+a,e.aboveGround?s-a:1/0),c=e.aboveGround;if(this.view.viewingMode==="global"){const u=y4;z3($9(I9,Br(this.view.spatialReference).radius+l),eh(e.eye,e.viewForward),u),ye(u,u,e.eye);const h=ov.normalize(ESe(e.viewForward,u,e.viewRight))/e.fovY+.5,p=h<=0||h>=1?.5:n;i=c?p*h:h+p*(1-h)}else{const u=.5*Math.PI-Math.acos(-e.viewForward[2]),h=Math.tan(u),p=Bt(0,h,1,0),f=jc(p,p,e.projectionMatrix)[1],g=we(.5+.5*f,0,1);i=g===1||g===0?.5:c?g*n:1-(1-g)*n}return!!this._intersectGroundFromView(e,.5,i,r)&&g$(r,e.eye)<o.distance*o.distance}_computeOverlayExtents(e,r,i){const n=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,s=C();this._findHorizonBasedPointOfInterest(e,s)||ce(s,n),yi.OVERLAY_SHOW_CENTER?(p_==null&&(p_=new IS(this.view.graphics,"red")),p_.show(s,this._renderSR)):p_!=null&&p_.hide();const o=Math.max(.1,Di(e.eye,s)),a=bv(this.view.renderCoordsHelper,n,e.eye);this._overlaySREqualsRenderSR||ka(s,this._renderSR,s,this._spatialReference);const l=this.surface.extent,c=!this._isSpherical&&this._spatialReference&&this._spatialReference.isGeographic,u=c&&this._spatialReference?1/Br(this._spatialReference).metersPerDegree:1,h=this.view.state.contentPixelRatio,p=e.perScreenPixelRatio/h*o*u;i.mapUnitsPerPixel=p/this._worldToPCSRatio,i.stretch=this._overlayStretch;let f=r*p/2*i.stretch,g=!1,_=c?90:1/0;this._isSpherical&&l&&this._spatialReference&&(this._spatialReference.isWebMercator?(f/=Math.cos(Qk(s[1])),_=l[3]):(g=!0,f/=Br(this._spatialReference).metersPerDegree,_=90),f>=_&&(f=_,s[1]=0,this._spatialReference.isWebMercator&&(s[0]=0)));let v=1;g&&(v=1/Math.max(.2,Math.cos(Math.abs(Nt(s[1])))),f*v>180&&(v=180/f),i.mapUnitsPerPixel*=v);const b=Math.log(2)/12;f=Math.exp(Math.round(Math.log(f)/b)*b);const w=f*v,x=32,S=.5*r/(x*w),E=.5*r/(x*f);s[0]=Math.round(s[0]*S)/S,s[1]=Math.round(s[1]*E)/E;const A=i.inner;A[0]=s[0]-w,A[1]=s[1]-f,A[2]=s[0]+w,A[3]=s[1]+f,this._isSpherical&&this._shiftExtentToFitBounds(A,1/0,_);const O=i.outer;if(6*w>$a(l))ey(O,l);else if(Math.PI/2-Math.abs(a-Math.PI/2)<=.25*Math.PI)O[0]=A[0]-w,O[1]=A[1]-f,O[2]=A[2]+w,O[3]=A[3]+f;else{ka(e.eye,this._renderSR,y4,this._spatialReference),Em(Ib,s,y4);let z=-Math.atan2(Ib[1],Ib[0])+.125*Math.PI;z<0&&(z+=2*Math.PI);const k=Math.floor(z/(.25*Math.PI));s2(Ib,OEt[k],2*f),Ib[0]*=v,Ib[2]*=v,Hee(O,A,Ib)}if(this._isSpherical)O[0]=this._longitudeCyclical.clamp(O[0]),O[2]=this._longitudeCyclical.clamp(O[2]),O[1]=Math.max(O[1],-_),O[3]=Math.min(O[3],_);else{const z=zW(A,l,IEt),k=zW(O,l,LEt);Bae(z,k)&&(O[2]=O[0],O[3]=O[1])}const L=Math.abs(A[2]-A[0])/r;i.mapUnitsPerPixel=Math.max(i.mapUnitsPerPixel,L),i.pixelRatioAdjustment=i.mapUnitsPerPixel/L}_drawOverlays(e,r){if(!this.renderer.hasOverlays)return;if(!this._drawTexturesDirty&&!this._drawTexturesAnimateDirty)return this.renderer;const i=this._drawTexturesDirty;this._drawTexturesDirty=this._drawTexturesAnimateDirty=!1;const n=this.renderer.computeValidity();return this.renderer.releaseRenderTargets(),this.renderer.drawOverlays(r),n!==this.renderer.computeValidity()&&this.surface.updateTileOverlayParams(Dn.UPDATE),i?(this.surface.requestRender(e),e===Dn.UPDATE&&this.surface.requestUpdate()):this.surface.requestRender(Dn.BACKGROUND),this.renderer}_rectanglesOverlap(e,r){return e!=null&&(this._longitudeCyclical?(this._longitudeCyclical.contains(r[0],r[2],e[0])||this._longitudeCyclical.contains(r[0],r[2],e[2])||this._longitudeCyclical.contains(e[0],e[2],r[0]))&&!(e[1]>r[3]||e[3]<r[1]):c9(e,r))}_rectInsideRect(e,r){return r!=null&&(this._longitudeCyclical?this._longitudeCyclical.contains(e[0],e[2],r[0])&&this._longitudeCyclical.contains(e[0],e[2],r[2])&&r[1]>e[1]&&r[3]<e[3]:Bae(e,r))}_pointIsInExtent(e,r){if(this._longitudeCyclical)return this._longitudeCyclical.contains(r[0],r[2],e.x)&&e.y>=r[1]&&e.y<=r[3];const i=e.x,n=e.y;return i>r[0]&&i<r[2]&&n>r[1]&&n<r[3]}_shiftExtentToFitBounds(e,r,i){let n=0,s=0;e[0]<-r?n=e[0]+r:e[2]>r&&(n=r-e[2]),e[1]<-i?s=e[1]+i:e[3]>i&&(s=i-e[3]),a6(e,n,s)}get test(){return{renderer:this.renderer,update:()=>this.runTask(yl)}}};function REt(t,e){const i=yi.TESTS_DISABLE_OPTIMIZATIONS?0:1e-5*Math.max(t[2]-t[0],t[3]-t[1],e[2]-e[0],e[3]-e[1]);return Math.abs(e[0]-t[0])<=i&&Math.abs(e[1]-t[1])<=i&&Math.abs(e[2]-t[2])<=i&&Math.abs(e[3]-t[3])<=i}d([m()],Ul.prototype,"_spatialReference",void 0),d([m({readOnly:!0})],Ul.prototype,"running",null),d([m()],Ul.prototype,"_placementDirty",void 0),d([m()],Ul.prototype,"_contentUpdated",void 0),d([m()],Ul.prototype,"_isSpherical",null),d([m()],Ul.prototype,"_worldToPCSRatio",null),d([m()],Ul.prototype,"renderer",void 0),d([m({constructOnly:!0})],Ul.prototype,"view",void 0),d([m({constructOnly:!0})],Ul.prototype,"surface",void 0),d([m()],Ul.prototype,"suspended",null),d([m()],Ul.prototype,"updating",null),d([m({type:Boolean})],Ul.prototype,"rendersOccludedDraped",null),Ul=d([V("esri.views.3d.terrain.OverlayManager")],Ul);let $Et=class{constructor(){this.inner=Wt(),this.outer=Wt(),this.mapUnitsPerPixel=0,this.pixelRatioAdjustment=1,this.stretch=KNe}};const Ib=Zt(),y4=C(),Vf=new $Et,IEt=Wt(),LEt=Wt(),DEt=Js();var vm;(function(t){t[t.NONE=0]="NONE",t[t.EXTENT=1]="EXTENT",t[t.RERENDER_ONLY=2]="RERENDER_ONLY"})(vm||(vm={}));let NEt=class{constructor(){this.indices=null,this.indexCount=0,this.edgeIndicesStartIndex=0,this.poleIndicesStartIndex=0,this.vertexAttributes=null,this.edgeVerticesStartIndex=0,this.poleVerticesStartIndex=0,this.maxEdgeVertexCount=0,this.boundingBox=Li(),this.numVerticesPerSide=0,this.minu=0,this.minv=0,this.maxu=1,this.maxv=1,this.outerEdgesOffsetAndLength=[0,0,0,0,0,0,0,0]}release(){this.vertexAttributes=tr(this.vertexAttributes),this.indices=null}reset(){this.indices=null,this.vertexAttributes=null,Li(this.boundingBox),this.numVerticesPerSide=0}getEdgeFirstVertexIndex(e){return this.outerEdgesOffsetAndLength[2*e]}getEdgeCount(e){return this.outerEdgesOffsetAndLength[2*e+1]}getEdgeVertexIndex(e,r){return this.getEdgeAttributeIndex(e,r)}getEdgeVertexPosition(e,r,i,n){this._getEdgeVertexRaw(this.getEdgeAttributeIndex(e,n),r),fe(r,r,i)}getEdgeNormal(e,r,i){const{typedBuffer:n,typedBufferStride:s}=this.vertexAttributes.normalCompressed;kgt(r,n,this.getEdgeAttributeIndex(e,i),s)}setEdgeNormalFromValues(e,r,i,n,s){this._setNormal(this.getEdgeAttributeIndex(e,r),i,n,s)}setEdgeVertexFromValuesRawPositionUV(e,r,i,n,s,o,a){const l=this.getEdgeAttributeIndex(e,r);this.vertexAttributes.position.setValues(l,i,n,s),this._setUV(l,o,a)}setEdgeVertexFromValuesRawPositionUVNormal(e,r,i,n,s,o,a,l,c,u){const h=this.getEdgeAttributeIndex(e,r);this.vertexAttributes.position.setValues(h,i,n,s),this._setUV(h,o,a),this._setNormal(h,l,c,u)}_getEdgeVertexRaw(e,r){this.vertexAttributes.position.getVec(e,r)}_setNormal(e,r,i,n){const{typedBuffer:s,typedBufferStride:o}=this.vertexAttributes.normalCompressed;mf(s,e,r,i,n,o)}_setUV(e,r,i){ef(this.vertexAttributes.uv0,e,r,i)}getEdgeAttributeIndex(e,r){return Re(0<=r&&r<this.getEdgeCount(e)),this.getEdgeFirstVertexIndex(e)+r}};const qge=16384;function ef(t,e,r,i){t.setValues(e,r*qge,i*qge)}let FEt=class{constructor(){this.sinLonLUT=new Array(HA+1),this.cosLonLUT=new Array(HA+1),this.sinLatLUT=new Array(HA+1),this.cosLatLUT=new Array(HA+1)}update(e,r,i){const n=r[0],s=r[2];for(let o=0;o<=e;o++){const a=o/e,l=n*(1-a)+s*a;this.sinLonLUT[o]=Math.sin(l),this.cosLonLUT[o]=Math.cos(l);const c=i(a);this.sinLatLUT[o]=Math.sin(c),this.cosLatLUT[o]=Math.cos(c)}}},kEt=class{constructor(){this.numVerticesPerSide=0,this.samplerData=null,this.samplerDataVersion=0,this.clippingArea=null,this.wireframe=!1,this.cornerPeerNeighbors=[null,null,null,null],this.cornerNeighborCornerTiles=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],this.cornerNeighborCornerTileSamplerVersions=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],this.edgeResolutions=[-1,-1,-1,-1],this.edgePeerNeighbors=[null,null,null,null],this.edgePeerNeighborSamplerVersions=[-1,-1,-1,-1]}},e4e=class RF{constructor(e){this._getFadeDuration=e,this._fadeStart=0,this._delayedTime=0}clear(){this._current=Pe(this._current),this._next=Pe(this._next),this._waiting=Pe(this._waiting),this._delayed=Pe(this._delayed)}get current(){if(this._current==null)return null;if(!this._isFadingEnabled){const r=this._delayed||this._waiting||this._next||this._current;r!==this._current&&(this._current=null,this.clear(),this._current=r)}let e=RF.test.fadeMoment;if(this._delayed!=null&&(e=e||performance.now(),e>=this._delayedTime&&(this._push(this._delayed,X1.Immediate),this._delayed=null)),this._next!=null){e=e||performance.now();const r=this._fadeDuration,i=this._current!=null&&this._next.texture===this._current.texture,n=this._next.type!==ps.FADING,s=e-this._fadeStart>=r;(i||n||s)&&(Pe(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(e))}return this._current}get next(){return this._next}get fadeFactor(){if(this._next==null)return 1;const e=RF.test.fadeMoment||performance.now(),r=Math.max(0,e-this._fadeStart),i=this._fadeDuration;return r>i?0:1-r/i}get isFading(){return this._next!=null||this._delayed!=null}push(e,r=X1.Immediate){this._delayed=Pe(this._delayed),this._push(e,r)}_push(e,r){if(this._isFadingEnabled||this.clear(),this._current==null)return void(this._current=e);const i=RF.test.fadeMoment||performance.now();return r!==X1.Immediate?(this._delayed=e,void(this._delayedTime=i+r)):this._next==null?(this._next=e,void(this._fadeStart=this._alignFadeStart(i))):void(e!=null&&(Pe(this._waiting),this._waiting=e))}get _fadeDuration(){return this._waiting==null?this._getFadeDuration():.5*this._getFadeDuration()}_alignFadeStart(e){const r=this._getFadeDuration();return e+r-e%r}get _isFadingEnabled(){return this._getFadeDuration()>0}};var X1;e4e.test={fadeMoment:0},function(t){t[t.Immediate=0]="Immediate",t[t.Delayed=5e3]="Delayed"}(X1||(X1={}));var b3;(function(t){t[t.BACK_TO_FRONT=-1]="BACK_TO_FRONT",t[t.NONE=0]="NONE",t[t.FRONT_TO_BACK=1]="FRONT_TO_BACK"})(b3||(b3={}));let t4e=class{constructor(){this._queue=new Vt,this.remove=()=>{}}get done(){return this._queue.length===0&&(!this._last||this._last.isLeaf)}resetOne(e){this._queue.clear(),this._queue.push(e),this._last=void 0}reset(e=null){this._queue.clear(),e!=null&&this._queue.pushArray(e),this._last=void 0}skipSubtree(){this._last=void 0}next(){var r;const e=(r=this._last)==null?void 0:r.children;return e!=null&&e[0]&&this._queue.pushArray(e),this._last=this._queue.pop(),this._last}},zEt=class{constructor(){this._q=new Vt}get done(){return this._q.length===0}reset(e){if(this._q.clear(),e!=null){this._q.pushArray(e);for(let r=0;r<this._q.length;++r){const i=this._q.data[r];i.isLeaf||this._q.pushArray(i.children)}}}next(){return this._q.pop()}};function IR(t,e,r){if((e==null?void 0:e.fullExtent)==null)return!1;const i=e.fullExtent,n=t.extent;if(r){if(n[0]<i.xmin||n[1]<i.ymin||n[2]>i.xmax||n[3]>i.ymax)return!1}else if(i.xmin>n[2]||i.ymin>n[3]||i.xmax<n[0]||i.ymax<n[1])return!1;const s=t.surface.tilingScheme.levels[t.level].scale,o=e.minScale;if(o>0&&s>1.00000001*o)return!1;const a=e.maxScale;return!(a>0&&s<.99999999*a)}function H0(t,e){const r=t.lij,i=e.lij;return r[0]-i[0]||r[1]-i[1]||r[2]-i[2]}function r4e(t,e,r=null){r==null||r.length===0?t===b3.BACK_TO_FRONT?e.sort(UEt):e.sort(BEt):e.sort((i,n)=>VEt(i,n,t,r))}function UEt(t,e){const r=e.screenDepth-t.screenDepth;if(r!==0)return r;const i=t.lij,n=e.lij;return i[0]-n[0]||i[1]-n[1]||i[2]-n[2]}function BEt(t,e){const r=t.screenDepth-e.screenDepth;if(r!==0)return r;const i=t.lij,n=e.lij;return i[0]-n[0]||i[1]-n[1]||i[2]-n[2]}function i4e(t,e,r){const i=t.screenDepth,n=e.screenDepth;return i<n?-r:i>n?r:H0(t,e)}function VEt(t,e,r,i){return Yge(t,i)===Yge(e,i)?i4e(t,e,r):t?r:-r}function Yge(t,e){for(const r of e)if(t.intersectsExtent(r))return!0;return!1}function GEt(t,e){const r=t.distanceToPOI-e.distanceToPOI;if(r!==0)return r;const i=t.lij,n=e.lij;return i[0]-n[0]||i[1]-n[1]||i[2]-n[2]}function jEt(t,e){const r=t.length;for(let i=0;i<r;++i)t.at(i).updateDistanceToPOI(e);t.sort(GEt)}function HEt(t,e,r){let i=1,n=0,s=0;for(;t!==e;)if(i*=.5,n*=.5,s*=.5,1&t.lij[2]&&(n+=.5),!(1&t.lij[1])&&(s+=.5),(t=t.parent)==null)throw new Error("tile was not a descendant of upsampleTile");r.init(e,n,s,i)}function WEt(t){for(let e=0;e<t.length;e++){const r=t[e],i=r.parent;if(i)for(let n=0;n<4;n++){const s=i.children[n];if(s&&s!==r)return!0}}return!1}function $Xt(t,e){if(!t||!e||t[0]===e[0])return!1;const r=t[0]<e[0],i=r?t:e,n=r?e:t,s=1<<n[0]-i[0];return Math.floor(n[1]/s)===i[1]&&Math.floor(n[2]/s)===i[2]}let Ane=class{get updating(){return!!this._tileRequested}init(e,r,i,n){this.tile=e,this._layerIdx=r,this._layerClass=i,this._suspended=n,this._tileLayerInfo=e.getLayerInfo(r,i),this._tileRequested=null;const s=this._findAncestorWithData();this._setUpsampleTile(s)}startLoading(){return this._requestNext()}dispose(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null),this.tile=null,this._tileLayerInfo=null}setSuspension(e){e!==this._suspended&&(this._suspended=e,e?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())}update(){const e=this._findAncestorWithData();return this._setUpsampleTile(e),this._requestNext()}dataArrived(e,r){this._setUpsampleTile(e,r),this._tileRequested=null,e===this.tile?this.tile.updateRenderData(this._layerClass,ps.FADING,r):this._requestNext()}dataMissing(){this._tileRequested=null,this._tileLayerInfo.data=null,this._requestNext()}_agentDone(){this.tile.agentDone(this._layerIdx,this._layerClass),this.dispose()}_requestNext(){if(this._suspended)return!0;const e=this._findNextDownload();if(this._tileRequested){if(e===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null}return e!=null?e.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=e):this._agentDone(),!!this._tileRequested}_findNextDownload(){const e=this._layerIdx,r=this._layerClass,i=this.tile.surface.layerViewByIndex(e,r),n=TJ(i),{minLevel:s,maxLevel:o}=i.dataLevelRange,a=this._desiredMinLevelDelta,l=this._progressiveLevelModulo+a,c=this._scaleRangeEnabled?IR:()=>!0;let u=this.tile;const h=u.level;let p;const f=this._tileLayerInfo.upsampleInfo,g=f!=null?f.tile.level:-1,_=f!=null&&g-h>=a,v=n==null?void 0:n.tilemapCache,b=i.type==="vector-tile-3d"?i.schemaHelper:null;for(;u&&c(u,n,!1)&&u.level>=s;){const w=u.level,x=h-w,S=u.layerInfo[r][e];if(S.data&&x>=a){(!_||w>g)&&this._setUpsampleTile(u),S.dataInvalidated&&(p=u);break}const E=(b==null?void 0:b.getLevelRowColumn(u.lij))??u.lij;if((v==null?void 0:v.getAvailability(E[0],E[1],u.lij[2]))!=="unavailable"&&w<=o&&!S.data&&!S.dataMissing&&((!p||u.level===s||w%wEe==0||h-p.level<a)&&(p=u),x>=l))break;u=u.parent}if(p!=null&&h-p.level<a)if(f)p=null;else{const w=this._findAncestorWithData();w!=null&&(this._setUpsampleTile(w),p=w.layerInfo[r][e].dataInvalidated?w:null)}return p}_findAncestorWithData(){const e=this.tile.elevationLevel,r=this._desiredMinLevelDelta;let i;for(let n=this.tile;n;n=n.parent)if(n.hasLayerData(this._layerIdx,this._layerClass)){if(e-n.level>=r)return n;i=n}return i}_setUpsampleTile(e,r){this._tileLayerInfo.setUpsampleInfo(this.tile,e),this.tile.updateRenderData(this._layerClass,ps.FADING,r)}get test(){return{findNextDownload:()=>this._findNextDownload(),tileLayerInfo:this._tileLayerInfo}}},qEt=class extends Ane{get _desiredMinLevelDelta(){throw Xge}get _progressiveLevelModulo(){throw Xge}dispose(){}};const Xge=new Error("Abstract method called on TileAgent"),yc=new qEt;let n4e=class extends Ane{constructor(){super(...arguments),this._scaleRangeEnabled=!1}get _desiredMinLevelDelta(){return Cq(this.tile.level)-(this.tile.elevationLevel-this.tile.level)}get _progressiveLevelModulo(){return 0}},s4e=class extends Ane{constructor(){super(),this._scaleRangeEnabled=!0}get _desiredMinLevelDelta(){return 0}get _progressiveLevelModulo(){return wEe}};var zx,x2;(function(t){t[t.Stretch=0]="Stretch",t[t.Lut=1]="Lut",t[t.Hillshade=2]="Hillshade",t[t.COUNT=3]="COUNT"})(zx||(zx={})),function(t){t[t.Noop=0]="Noop",t[t.PerBand=1]="PerBand",t[t.COUNT=2]="COUNT"}(x2||(x2={}));function YEt(t){t.fragment.uniforms.add(new ct("u_colormap",e=>e.u_colormap),new $e("u_colormapOffset",e=>e.colormap.u_colormapOffset),new $e("u_colormapMaxIndex",e=>e.colormap.u_colormapMaxIndex),new $e("u_opacity",e=>e.common.u_opacity)),t.fragment.code.add(T`vec4 colormap(vec4 currentPixel, bool isFloat) {
float colorIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
vec4 result;
if (currentPixel.a == 0.0 || colorIndex > u_colormapMaxIndex) {
result = vec4(0.0, 0.0, 0.0, 0.0);
} else {
vec2 texelCoordinates = vec2((colorIndex + 0.5), 0.5);
result = texelFetch(u_colormap, ivec2(texelCoordinates), 0);
}
return result;
}`)}function XEt(t){t.fragment.uniforms.add(new ct("u_transformGrid",e=>e.u_transformGrid),new ti("u_transformSpacing",e=>e.common.u_transformSpacing),new ti("u_targetImageSize",e=>e.common.u_targetImageSize)),t.fragment.code.add(T`vec2 projectPixelLocation(vec2 coords) {
vec2 index_image = floor(coords * u_targetImageSize);
vec2 oneTransformPixel = vec2(4.0, 1.0);
vec2 index_transform = floor(index_image / u_transformSpacing) * oneTransformPixel;
vec2 pos = fract((index_image + 0.5) / u_transformSpacing);
vec2 transform_location = index_transform + 0.5;
vec2 srcLocation;
if (pos.s <= pos.t) {
vec3 ll_abc = texelFetch(u_transformGrid, ivec2(transform_location), 0).rgb;
vec3 ll_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 1.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ll_abc, vec3(pos, 1.0));
srcLocation.t = dot(ll_def, vec3(pos, 1.0));
} else {
vec3 ur_abc = texelFetch(u_transformGrid, ivec2(transform_location.s + 2.0, transform_location.t), 0).rgb;
vec3 ur_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 3.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ur_abc, vec3(pos, 1.0));
srcLocation.t = dot(ur_def, vec3(pos, 1.0));
}
return srcLocation;
}`)}let o4e=class extends Ai{constructor(){super(...arguments),this.scale=1,this.offset=ty}};function a4e(t){t.attributes.add(R.POSITION,"vec2"),t.attributes.add(R.UV0,"vec2"),t.vertex.uniforms.add(new $e("scale",e=>e.scale)),t.vertex.uniforms.add(new ti("offset",e=>e.offset)),t.varyings.add("uv","vec2"),t.varyings.add("vuv","vec2"),t.vertex.code.add(T`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
vuv = uv0;
}`)}let ZEt=class extends o4e{constructor(e,r,i){super(),this.common=e,this.u_image=r,this.u_transformGrid=i}};function JEt(t,e){t.include(XEt),t.fragment.uniforms.add(new ct("u_image",i=>i.u_image),new Ym("u_flipY",i=>i.common.u_flipY),new Ym("u_applyTransform",i=>i.common.u_applyTransform));const{requireBilinearWithNN:r}=e;r&&t.fragment.uniforms.add(new ti("u_srcImageSize",i=>i.common.u_srcImageSize)),t.fragment.code.add(T`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}`),r?t.fragment.code.add(T`vec4 sampleBilinear(sampler2D sampler, vec2 coords, vec2 texSize) {
vec2 texelStart = floor(coords * texSize);
vec2 coord0 = texelStart / texSize;
vec2 coord1 = (texelStart +  vec2(1.0, 0.0)) / texSize;
vec2 coord2 = (texelStart +  vec2(0.0, 1.0)) / texSize;
vec2 coord3 = (texelStart +  vec2(1.0, 1.0)) / texSize;
vec4 color0 = texture(sampler, coord0);
vec4 color1 = texture(sampler, coord1);
vec4 color2 = texture(sampler, coord2);
vec4 color3 = texture(sampler, coord3);
vec2 blend = fract(coords * texSize);
vec4 color01 = mix(color0, color1, blend.x);
vec4 color23 = mix(color2, color3, blend.x);
vec4 color = mix(color01, color23, blend.y);
float alpha = floor(color0.a * color1.a * color2.a * color3.a + 0.5);
color = color * alpha + (1.0 - alpha) * texture(sampler, coords);
return color;
}
vec4 getPixel(vec2 pixelLocation) {
return sampleBilinear(u_image, pixelLocation, u_srcImageSize);
}`):t.fragment.code.add(T`vec4 getPixel(vec2 pixelLocation) {
return texture(u_image, pixelLocation);
}`)}var Le;(function(t){t[t.Normal=0]="Normal",t[t.Average=1]="Average",t[t.Lighten=2]="Lighten",t[t.Lighter=3]="Lighter",t[t.Plus=4]="Plus",t[t.Screen=5]="Screen",t[t.ColorDodge=6]="ColorDodge",t[t.Darken=7]="Darken",t[t.Multiply=8]="Multiply",t[t.ColorBurn=9]="ColorBurn",t[t.Overlay=10]="Overlay",t[t.SoftLight=11]="SoftLight",t[t.HardLight=12]="HardLight",t[t.VividLight=13]="VividLight",t[t.Hue=14]="Hue",t[t.Saturation=15]="Saturation",t[t.Luminosity=16]="Luminosity",t[t.Color=17]="Color",t[t.DestinationOver=18]="DestinationOver",t[t.DestinationAtop=19]="DestinationAtop",t[t.DestinationIn=20]="DestinationIn",t[t.DestinationOut=21]="DestinationOut",t[t.SourceAtop=22]="SourceAtop",t[t.SourceIn=23]="SourceIn",t[t.SourceOut=24]="SourceOut",t[t.Xor=25]="Xor",t[t.Difference=26]="Difference",t[t.Exclusion=27]="Exclusion",t[t.Minus=28]="Minus",t[t.Invert=29]="Invert",t[t.Reflect=30]="Reflect",t[t.COUNT=31]="COUNT"})(Le||(Le={}));const MJ={normal:Le.Normal,average:Le.Average,lighten:Le.Lighten,lighter:Le.Lighter,screen:Le.Screen,plus:Le.Plus,"color-dodge":Le.ColorDodge,darken:Le.Darken,multiply:Le.Multiply,"color-burn":Le.ColorBurn,overlay:Le.Overlay,"soft-light":Le.SoftLight,"hard-light":Le.HardLight,"vivid-light":Le.VividLight,hue:Le.Hue,saturation:Le.Saturation,luminosity:Le.Luminosity,color:Le.Color,difference:Le.Difference,exclusion:Le.Exclusion,minus:Le.Minus,invert:Le.Invert,reflect:Le.Reflect,"destination-over":Le.DestinationOver,"destination-atop":Le.DestinationAtop,"destination-in":Le.DestinationIn,"destination-out":Le.DestinationOut,"source-atop":Le.SourceAtop,"source-in":Le.SourceIn,"source-out":Le.SourceOut,xor:Le.Xor};function QEt(t){return t===Le.DestinationOver||t===Le.DestinationAtop||t===Le.DestinationIn||t===Le.DestinationOut||t===Le.SourceAtop||t===Le.SourceIn||t===Le.SourceOut||t===Le.Xor}function Mne(t){t.code.add(T`
    float lineFactorAtPosition(float value) {
      float pos = value * ${T.float(257)};
      if(pos < 0.5 || pos > ${T.float(257-.5)}) {
        return 1.0;
      }

      pos = pos + 0.5;
      float modulo = mod(pos, 16.0);
      return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
    }

    float lineFactorAtUV(vec2 uv) {
      return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
    }

    float lineFactor(vec2 uv) {
      vec2 offset = fwidth(uv) * 0.25;
      return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
    }

    vec3 gridColor(vec2 uv) {
      float line = lineFactor(uv) * 0.1 + 0.9;
      return vec3(1.0, 0.972, 0.918) * line;
    }`)}function KEt(t,e){const r=e.blendMode;r!==Le.Normal&&(r===Le.Reflect&&t.code.add(T`float reflectBlend(in float cb, in float cl) {
return (cl == 1.0) ? cl : min(cb * cb / (1.0 - cl), 1.0);
}`),r!==Le.ColorDodge&&r!==Le.VividLight||t.code.add(T`float colorDodge(in float cb, in float cl) {
return (cb == 0.0) ? 0.0 : (cl == 1.0) ? 1.0 : min(1.0, cb / (1.0 - cl));
}`),r!==Le.ColorBurn&&r!==Le.VividLight||t.code.add(T`float colorBurn(in float cb, in float cl) {
return (cb == 1.0) ? 1.0 : (cl == 0.0) ? 0.0 : 1.0 - min(1.0, (1.0 - cb) / cl);
}`),r===Le.Overlay&&t.code.add(T`float overlay(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (1.0 - 2.0 * (1.0 - cl ) * (1.0 - cb)) + step(0.5, cl) * (2.0 * cl * cb);
}`),r===Le.HardLight&&t.code.add(T`float hardLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (2.0 * cl * cb) + step(0.5, cl) * (1.0 - 2.0 * (1.0 - cl) * (1.0 - cb));
}`),r===Le.SoftLight&&t.code.add(T`float softLight(in float cb, in float cl) {
if (cl <= 0.5) {
return cb - (1.0 - 2.0 * cl) * cb * (1.0 - cb);
}
if (cb <= 0.25) {
return cb + (2.0 * cl - 1.0) * cb * ((16.0 * cb - 12.0) * cb + 3.0);
}
return cb + (2.0 * cl - 1.0) * (sqrt(cb) - cb);
}`),r===Le.VividLight&&t.code.add(T`float vividLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * colorBurn(cb, 2.0 * cl) + step(0.5, cl) * colorDodge(cb, (2.0 * (cl - 0.5)));
}`),r!==Le.Hue&&r!==Le.Saturation&&r!==Le.Color&&r!==Le.Luminosity||(t.code.add(T`float minv3(in vec3 c) {
return min(min(c.r, c.g), c.b);
}
float maxv3(in vec3 c) {
return max(max(c.r, c.g), c.b);
}
float lumv3(in vec3 c) {
return dot(c, vec3(0.3, 0.59, 0.11));
}
vec3 clipColor(vec3 color) {
float lum = lumv3(color);
float mincol = minv3(color);
float maxcol = maxv3(color);
if (mincol < 0.0) {
color = lum + ((color - lum) * lum) / (lum - mincol);
}
if (maxcol > 1.0) {
color = lum + ((color - lum) * (1.0 - lum)) / (maxcol - lum);
}
return color;
}
vec3 setLum(vec3 cbase, vec3 clum) {
return clipColor(cbase + vec3(lumv3(clum) - lumv3(cbase)));
}`),r!==Le.Hue&&r!==Le.Saturation||t.code.add(T`float satv3(vec3 c) {
return maxv3(c) - minv3(c);
}
vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum)
{
float minbase = minv3(cbase);
float sbase = satv3(cbase);
float ssat = satv3(csat);
return setLum(sbase > 0.0 ? (cbase - minbase) * ssat / sbase : vec3(0.0), clum);
}`)),t.code.add(T`
    vec4 applyBlendMode(vec3 cl, float ol, vec3 cb, float ob) {
      ${r===Le.Multiply?T`return vec4(cl * ol * cb * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Le.Average?T`return vec4((cb + cl) * 0.5 * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Le.Lighten?T`return vec4(max(cb, cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Le.Darken?T`return vec4(min(cl, cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Le.Lighter?T`return vec4(cl * ol + cb * ob, ol + ob);`:r===Le.Plus?T`return clamp(vec4(cl.rgb + cb.rgb, ol + ob), 0.0, 1.0);`:r===Le.Minus?T`return vec4(clamp(vec3(cb.rgb - cl.rgb), 0.0, 1.0), ob * ol);`:r===Le.Screen?T`return vec4((cl + cb - cl * cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Le.Difference?T`return vec4(abs(cb - cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Le.Invert?T`return vec4((1.0 - cb) * ol * ob + cb * ob * (1.0 - ol), ob);`:r===Le.DestinationOver?T`return vec4(cl * ol * (1.0 - ob) + cb * ob, ol + ob - ol * ob);`:r===Le.DestinationAtop?T`return vec4(cl * ol * (1.0 - ob) + cb * ob * ol, ol);`:r===Le.DestinationOut?T`return vec4(cb * ob * (1.0 - ol), ob * (1.0 - ol));`:r===Le.SourceAtop?T`return vec4(cl * ol * ob + cb * ob * (1.0 - ol), ob);`:r===Le.SourceOut?T`return vec4(cl * ol * (1.0 - ob), ol * (1.0 - ob));`:r===Le.Xor?T`return vec4(cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), ol * (1.0 - ob) + ob * (1.0 - ol));`:r===Le.DestinationIn?T`return vec4(cb * ob * ol, ol * ob);`:r===Le.SourceIn?T`return vec4(cl * ol * ob, ol * ob);`:r===Le.Hue?T`
          vec3 f = setLumSat(cl, cb, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Le.Saturation?T`
          vec3 f = setLumSat(cb, cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Le.Color?T`
          vec3 f = setLum(cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Le.Luminosity?T`
          vec3 f = setLum(cb, cl);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Le.Exclusion?T`
          vec3 f = cl + cb - 2.0 * cl * cb;
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Le.Reflect?T`
          vec3 f = vec3(reflectBlend(cb.r, cl.r), reflectBlend(cb.g, cl.g), reflectBlend(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Le.ColorDodge?T`
          vec3 f = vec3(colorDodge(cb.r, cl.r), colorDodge(cb.g, cl.g), colorDodge(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Le.ColorBurn?T`
          vec3 f = vec3(colorBurn(cb.r, cl.r), colorBurn(cb.g, cl.g), colorBurn(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Le.Overlay?T`
          vec3 f = vec3(overlay(cb.r, cl.r), overlay(cb.g, cl.g), overlay(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Le.SoftLight?T`
          vec3 f = vec3(softLight(cb.r, cl.r), softLight(cb.g, cl.g), softLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Le.HardLight?T`
          vec3 f = vec3(hardLight(cb.r, cl.r), hardLight(cb.g, cl.g), hardLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Le.VividLight?T`
          vec3 f = vec3(vividLight(cb.r, cl.r), vividLight(cb.g, cl.g), vividLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:T``}
    }
  `))}var ds,Ta,Sp;(function(t){t[t.Composite=0]="Composite",t[t.ColorComposite=1]="ColorComposite",t[t.GridComposite=2]="GridComposite",t[t.GroupBackgroundComposite=3]="GroupBackgroundComposite",t[t.COUNT=4]="COUNT"})(ds||(ds={})),function(t){t[t.NotRequired=0]="NotRequired",t[t.Required=1]="Required",t[t.COUNT=2]="COUNT"}(Ta||(Ta={})),function(t){t[t.Off=0]="Off",t[t.On=1]="On",t[t.COUNT=2]="COUNT"}(Sp||(Sp={}));function l4e(t,e){const r=e.output===ds.GridComposite,i=e.output===ds.ColorComposite,n=e.output===ds.GroupBackgroundComposite,s=e.output===ds.Composite;r&&t.fragment.include(Mne),i&&t.fragment.uniforms.add(new Ft("backgroundColor",c=>c.backgroundColor));const o=e.baseOpacityMode===Ta.Required;o&&t.fragment.uniforms.add(new $e("baseOpacity",c=>c.baseOpacity)),s&&t.fragment.uniforms.add(new ct("fboColor",c=>c.fboTexture));const a=e.blendMode!==Le.Normal,l=e.premultipliedSource===Sp.On;t.fragment.include(KEt,e),t.fragment.code.add(T`
    vec4 getBackground(vec2 uv) {
      return ${o?T`baseOpacity *`:""} ${n?T`vec4(0.0, 0.0, 0.0, 0.0)`:i?T`vec4(backgroundColor, 1.0)`:r?T`vec4(gridColor(uv), 1.0)`:T`texelFetch(fboColor, ivec2(gl_FragCoord.xy), 0)`};
    }

    vec4 blendLayers(vec4 bgColor, vec4 colorLayer, float opacity) {
      ${a?T`
          vec3 cl = colorLayer.a == 0.0 ? colorLayer.rgb : colorLayer.rgb / colorLayer.a;
          vec3 cb = bgColor.a == 0.0 ? bgColor.rgb : bgColor.rgb / bgColor.a;
          return applyBlendMode(clamp(cl, vec3(0.0), vec3(1.0)), colorLayer.a * opacity, cb, bgColor.a);`:T`
          float composeAlpha = colorLayer.a * opacity;
          return ${!l&&(s&&!o||n)?T`colorLayer * opacity;`:T`bgColor * (1.0 - composeAlpha) + colorLayer * opacity;`}`}
    }`)}let fL=class extends ZEt{constructor(e,r,i,n,s,o){super(e,n,s),this.colormap=r,this.symbolizer=i,this.u_colormap=o,this.backgroundColor=zn,this.fboTexture=null,this.baseOpacity=1}},c4e=class extends fL{},u4e=class extends fL{};function h4e(t){const e=new Or;return e.include(a4e),e.include(JEt,t),e.include(YEt,t),e.include(l4e,t),e.fragment.code.add(T`vec4 applyBackgroundBlend(vec4 layerColor) {
vec4 bgColor = getBackground(vuv);
return blendLayers(bgColor, layerColor, u_opacity);
}`),t.colorizerType===zx.Stretch?t3t(e,t):t.colorizerType===zx.Lut?e3t(e):t.colorizerType===zx.Hillshade&&r3t(e,t),e}function e3t(t){t.fragment.code.add(T`void main() {
vec2 pixelLocation = getPixelLocation(uv);
if (isOutside(pixelLocation)) {
fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
return;
}
vec4 currentPixel = getPixel(pixelLocation);
fragColor = applyBackgroundBlend(colormap(currentPixel, true));
}`)}function t3t(t,e){t.fragment.uniforms.add(new rL("u_bandCount",i=>i.symbolizer.u_bandCount),new Zl("u_minCutOff",i=>i.symbolizer.u_minCutOff,3),new Zl("u_maxCutOff",i=>i.symbolizer.u_maxCutOff,3),new Zl("u_factor",i=>i.symbolizer.u_factor,3),new $e("u_minOutput",i=>i.symbolizer.u_minOutput),new $e("u_maxOutput",i=>i.symbolizer.u_maxOutput),new Ym("u_useGamma",i=>i.symbolizer.u_useGamma),new Zl("u_gamma",i=>i.symbolizer.u_gamma,3),new Zl("u_gammaCorrection",i=>i.symbolizer.u_gammaCorrection,3),new $e("u_opacity",i=>i.common.u_opacity)),t.fragment.code.add(T`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const r=e.applyColormap?T`fragColor = applyBackgroundBlend(colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma));`:T`fragColor = applyBackgroundBlend(vec4(grayVal, grayVal, grayVal, currentPixel.a));`;t.fragment.code.add(T`
      void main() {
        vec2 pixelLocation = getPixelLocation(uv);
        if (isOutside(pixelLocation)) {
          fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }

        vec4 currentPixel = getPixel(pixelLocation);
        ${e.stretchType===x2.Noop?T`
        fragColor = applyBackgroundBlend(currentPixel);`:T`
        if (currentPixel.a == 0.0) {
          fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }
        if (u_bandCount == 1) {
          float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          ${r}
        } else {
          float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
          float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
          fragColor = applyBackgroundBlend(vec4(redVal, greenVal, blueVal, currentPixel.a));
        }`}
      }`)}function r3t(t,e){const r=t.fragment;r.uniforms.add(new ct("u_image",n=>n.u_image),new rL("u_hillshadeType",n=>n.symbolizer.u_hillshadeType),new Zl("u_sinZcosAs",n=>n.symbolizer.u_sinZcosAs,6),new Zl("u_sinZsinAs",n=>n.symbolizer.u_sinZsinAs,6),new Zl("u_cosZs",n=>n.symbolizer.u_cosZs,6),new Zl("u_weights",n=>n.symbolizer.u_weights,6),new ti("u_factor",n=>n.symbolizer.u_factor),new $e("u_minValue",n=>n.symbolizer.u_minValue),new $e("u_maxValue",n=>n.symbolizer.u_maxValue),new ti("u_srcImageSize",n=>n.common.u_srcImageSize)),r.include(xg),r.code.add(T`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec4 color = colormap(vec4(val, val, val, 1.0), false);
vec3 hsv = rgb2hsv(color.rgb);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv), 1.0) * alpha * color.a;
}`),r.code.add(T`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`);const i=e.applyColormap?T`fragColor = applyBackgroundBlend(overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha));`:T`hillshade *= alpha;
fragColor = applyBackgroundBlend(vec4(hillshade, hillshade, hillshade, alpha));`;r.code.add(T`
    void main() {
      vec2 pixelLocation = getPixelLocation(uv);
      if (isOutside(pixelLocation)) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture(u_image, pixelLocation);
      vec4 vf = texture(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${i}
    }
  `)}const i3t=Object.freeze(Object.defineProperty({__proto__:null,ColorizerHillshadeUniforms:u4e,ColorizerStretchUniforms:c4e,ColorizerUniforms:fL,build:h4e},Symbol.toStringTag,{value:"Module"}));function n3t(t,e,r="nearest",i=!1){var c;const n=!(i&&e.pixelType==="u8"),s=n?ks.FLOAT:ks.UNSIGNED_BYTE,o=e.pixels==null||e.pixels.length===0?null:n?e.getAsRGBAFloat():e.getAsRGBA(),a=(c=t.capabilities.textureFloat)==null?void 0:c.textureFloatLinear,l=new ri;return l.width=e.width,l.height=e.height,l.internalFormat=n?tt.RGBA32F:Tt.RGBA,l.samplingMode=!a||r!=="bilinear"&&r!=="cubic"?Ht.NEAREST:Ht.LINEAR,l.dataType=s,l.wrapMode=Jt.CLAMP_TO_EDGE,new Sr(t,l,o)}function s3t(t,e){const{spacing:r,offsets:i,coefficients:n,size:[s,o]}=e,a=r[0]>1,l=new ri;l.width=a?4*s:s,l.height=o,l.internalFormat=tt.RGBA32F,l.dataType=ks.FLOAT,l.samplingMode=Ht.NEAREST,l.wrapMode=Jt.CLAMP_TO_EDGE;const c=new Float32Array(a?s*o*16:2*i.length);if(a&&n!=null)for(let u=0,h=0;u<n.length;u++)c[h++]=n[u],u%3==2&&(c[h++]=1);else for(let u=0;u<o;u++)for(let h=0;h<s;h++){const p=4*(u*s+h),f=2*(h*o+u);c[p]=i[f],c[p+1]=i[f+1],c[p+3]=i[f]===-1?0:1}return new Sr(t,l,c)}function Zge(t,e){const r=new ri;return r.internalFormat=Tt.RGBA,r.width=e.length/4,r.height=1,r.samplingMode=Ht.NEAREST,r.wrapMode=Jt.CLAMP_TO_EDGE,new Sr(t,r,e)}function o3t(t,e,r,i=1,n=!0){return{u_flipY:n,u_applyTransform:!!t,u_opacity:i,u_transformSpacing:t?t.spacing:ty,u_transformGridSize:t?t.size:ty,u_targetImageSize:e,u_srcImageSize:r}}function a3t(t,e){return{u_colormapOffset:e||0,u_colormapMaxIndex:t?t.length/4-1:0}}function l3t(t){return{u_bandCount:t.bandCount,u_minOutput:t.outMin,u_maxOutput:t.outMax,u_minCutOff:t.minCutOff,u_maxCutOff:t.maxCutOff,u_factor:t.factor,u_useGamma:t.useGamma,u_gamma:t.gamma,u_gammaCorrection:t.gammaCorrection}}function c3t(t){return{u_hillshadeType:t.hillshadeType,u_sinZcosAs:t.sinZcosAs,u_sinZsinAs:t.sinZsinAs,u_cosZs:t.cosZs,u_weights:t.weights,u_factor:t.factor,u_minValue:t.minValue,u_maxValue:t.maxValue}}const Jge={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:"none",type:"stretch"};let u3t=class{constructor(e,r,i=null,n=null){this.lij=e,this.type="raster-tile",this._memoryUsed=null,this._source=null,this._symbolizerParameters=null,this._bandIds=null,this._interpolation=null,this._dirty=!1,this._transformGrid=null,this.isRendereredSource=!1,this.symbolizerRenderer=null,this.rawPixelData=null,this.opacity=1,this.source=r,this.width=i||r.width,this.height=n||r.height}get source(){return this._source}set source(e){this._source=e,this._rasterTexture=gt(this._rasterTexture),this._memoryUsed=null}get symbolizerParameters(){return this.isRendereredSource?{...Jge,maxCutOff:[1,1,1],factor:[1,1,1]}:this._symbolizerParameters||Jge}set symbolizerParameters(e){this._symbolizerParameters=e}get bandIds(){return this._bandIds}set bandIds(e){e!=null&&e.length>0?this._bandIds&&e.every((r,i)=>{var n;return!!((n=this._bandIds)!=null&&n[i])&&r===this._bandIds[i]})||(this._bandIds=e,this._dirty=!0):this._bandIds=null}get interpolation(){return this._interpolation||"nearest"}set interpolation(e){if(this._interpolation=e,this._rasterTexture!=null){const r=this._getRasterTextureInterpolation(e);this._rasterTexture.setSamplingMode(r==="bilinear"?Ht.LINEAR:Ht.NEAREST)}}get transformGrid(){return this._transformGrid}set transformGrid(e){this._transformGrid=e,this._transformGridTexture=gt(this._transformGridTexture),this._memoryUsed=null}bind(e){return!!(this.source&&this.source.pixels&&this.source.pixels.length>0)&&((this._rasterTexture==null||this._dirty)&&this._updateRasterTexture(e,this.bandIds),this._rasterTexture!=null&&(this._updateColormapTexture(e),this.transformGrid&&this._transformGridTexture==null&&(this._transformGridTexture=s3t(e,this.transformGrid))),!0)}getUniforms(){const{symbolizerParameters:e,transformGrid:r,width:i,height:n,opacity:s}=this,o=o3t(r,[i,n],[this.source.width,this.source.height],s),a=a3t(e.colormap,e.colormapOffset),l=this.symbolizerParameters.type==="stretch"?l3t(this.symbolizerParameters):null,c=this.symbolizerParameters.type==="hillshade"?c3t(this.symbolizerParameters):null;return new fL(o,a,l||c,this._rasterTexture,this._transformGridTexture,this._colormapTexture)}get isBilinearWithStretchColorRamp(){const{symbolizerParameters:e}=this;return this.interpolation==="bilinear"&&e.colormap!=null&&e.type==="stretch"}get memoryUsage(){if(this._memoryUsed==null){const e=[this._rasterTexture,this._transformGridTexture,this._colormapTexture];this._memoryUsed=e.map(r=>r!=null?r.descriptor.width*r.descriptor.height*4:0).reduce((r,i)=>r+i,0)}return this._memoryUsed}release(){return this._rasterTexture=gt(this._rasterTexture),this._transformGridTexture=gt(this._transformGridTexture),this._colormapTexture=gt(this._colormapTexture),this.source=null,this.transformGrid=null,this.rawPixelData=null,!0}_updateRasterTexture(e,r){const i=this.source?this.source.extractBands(r):null;if(!(i&&i.pixels&&i.pixels.length>0))return void(this._rasterTexture=gt(this._rasterTexture));const n=r==null&&this.bandIds==null||r!=null&&this.bandIds!=null&&r.join("")===this.bandIds.join("");if(this._rasterTexture!=null&&n)return;this._rasterTexture=gt(this._rasterTexture);const s=this._getRasterTextureInterpolation(this.interpolation);this._rasterTexture=n3t(e,i,s,this.isRendereredSource||this.hasStretchTypeNone())}hasStretchTypeNone(){return"stretchType"in this.symbolizerParameters&&this.symbolizerParameters.stretchType==="none"&&!this.symbolizerParameters.useGamma&&this.source.pixelType==="u8"}_getRasterTextureInterpolation(e){return this.symbolizerParameters.type==="lut"||e==="nearest"||e==="majority"||this.isBilinearWithStretchColorRamp?"nearest":"bilinear"}_updateColormapTexture(e){const r=this._colormap,i=this.symbolizerParameters.colormap;return i?r?i.length!==r.length||i.some((n,s)=>n!==r[s])?(this._colormapTexture=gt(this._colormapTexture),this._colormapTexture=Zge(e,i),void(this._colormap=i)):void 0:(this._colormapTexture=Zge(e,i),void(this._colormap=i)):(this._colormapTexture=gt(this._colormapTexture),void(this._colormap=null))}},$F=class{constructor(){this.waitingAgents=new Vt,this._upsampleInfo=null,this.loadingAgent=null,this.requestPromise=null,this.requestAbort=null,this.pendingUpdates=0}static acquire(e){const r=ej.acquire();return r._init(e),r}release(){this.dispose(),IF.delete(this),ej.release(this)}dispose(){this.loadingAgent=gt(this.loadingAgent),this.abortRequest(),this._unsetUpsampleInfo(),this.pendingUpdates=0,this._data=hE(this._data)}static prune(){ej.prune(0)}_init(e){this.waitingAgents.clear(),this._data=hE(this._data),this.dataMissing=!1,this.dataInvalidated=!1,this._unsetUpsampleInfo(),this.abortRequest(),this.loadingAgent=null,this.pendingUpdates=0,this._pool=e,this.elevationBounds=null}invalidateSourceData(){this.dataInvalidated=!0,this.dataMissing=!1,this._unsetUpsampleInfo()}abortRequest(){this.requestAbort=wl(this.requestAbort),this.requestPromise=null}get upsampleInfo(){return this._upsampleInfo}_unsetUpsampleInfo(){this._upsampleInfo!=null&&(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)}setUpsampleInfo(e,r){if(e!==r&&r!=null){if(this._upsampleInfo==null)this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===r)return;this._upsampleInfo.tile.unrefMapData()}r.refMapData(),HEt(e,r,this._upsampleInfo)}else this._unsetUpsampleInfo()}get data(){return this._data}set data(e){hE(this._data),this._data=e}};const ej=new ua($F,null,()=>{}),IF=new Map;function h3t(){IF.size>0&&(console.log(`${IF.size} live TilePerLayerInfo allocations:`),IF.forEach(t=>console.log(t,`
`)))}let fO=class{constructor(e,r){this._texture=e,this._cache=r,this.type="tile-texture",this._refCount=1}retain(){++this._refCount}release(){if(--this._refCount,this._refCount===0)if(this._cache){const e=`${this._texture.descriptor.width} ${this._texture.descriptor.pixelFormat}`;this._cache.put(e,this)}else this.dispose()}dispose(){this._texture.dispose()}get texture(){return this._texture}generateMipmap(){this._texture.generateMipmap()}get descriptor(){return this._texture.descriptor}get usedMemory(){return this._texture.usedMemory}};var at;(function(t){t[t.NONE=0]="NONE",t[t.SPLIT=1]="SPLIT",t[t.ELEVATION=2]="ELEVATION",t[t.MERGE=4]="MERGE",t[t.GEOMETRY=8]="GEOMETRY",t[t.TEXTURE_NOFADING=16]="TEXTURE_NOFADING",t[t.TEXTURE_FADING=32]="TEXTURE_FADING"})(at||(at={}));const d3t=.1;let One=class{constructor(){this._lij=[0,0,0],this._children=[null,null,null,null],this._pendingUpdates=0,this.renderData=null,this._dirty=!0,this._previouslyRendered=!1,this.extent=Wt(),this._elevationBoundsMin=NaN,this._elevationBoundsMax=0,this.layerInfo=[[],[]],this.extentInRadians=Wt(),this.centerAtSeaLevel=C(),this._center=[C(),Jn(),C()],this.up=see(),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._maxTesselation=0,this._usedMemory=null,this._mapTileMemoryInternal=0,this._mapDataRefCount=0,this.screenDepth=0,this.renderOrder=0,this._edgeLen=0,this._edgeLen2=0,this._curvatureHeight=0,this.extentMidX=0,this.extentMidY=0,this.distanceToPOI=-1,this._lastPOI=C(),this.maxLevelDeltaNeighborCount=0,this.unmergableChildCount=0}get lij(){return this._lij}static prune(){Rne.prune(0),$ne.prune(0),$F.prune()}get _isCached(){return!this.isLeaf&&this._mapDataRefCount<=0}get maxTesselation(){return this._maxTesselation}get isWithinClippingArea(){return this._isWithinClippingArea}get intersectsClippingArea(){return this._intersectsClippingArea}get clippingArea(){return this._clippingArea}get parent(){return this._parent}get children(){return this._children}get surface(){return this._surface}get elevationBoundsMin(){return this._elevationBoundsMin}get elevationBoundsMax(){return this._elevationBoundsMax}get level(){return this._lij[0]}get key(){return`${this._lij[0]}/${this._lij[1]}/${this._lij[2]}`}get edgeLen(){return this._edgeLen}get radius(){return this._center[is.MIDDLE][3]}get visible(){return this._dirty&&this.computeVisibility(),this._visible}get frustumVisibility(){return this._dirty&&this.computeVisibility(),this._frustumVisibility}computeVisibility(){this._dirty=!1;const e=this.parent,r=(e==null?void 0:e.frustumVisibility)??Pa.INTERSECTS;this._frustumVisibility=r===Pa.INSIDE?Pa.INSIDE:r===Pa.OUTSIDE?Pa.OUTSIDE:this._calculateFrustumVisibilityStatus(this.surface.frustum);const i=this._frustumVisibility!==Pa.OUTSIDE&&this._intersectsClippingArea;i!==this._visible&&(this._visible=i,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setDirty(),this.updateAgentSuspension())}get loadable(){return this.visible||this._surface.view.state.fixedContentCamera}get rendered(){const e=!!this.renderData;return e!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=e,this._surface.renderer.setDirty()),e}init(e,r,i,n,s){this._lij[0]=e,this._lij[1]=r,this._lij[2]=i,this.ellipsoid=Br(s.tilingScheme.spatialReference),s.tilingScheme.getExtent(e,r,i,this.extent),s.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians),this.extentMidX=.5*(this.extent[0]+this.extent[2]),this.extentMidY=.5*(this.extent[1]+this.extent[3]),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._clippingArea=null,this._mapDataRefCount=0,s.upsampleMapCache.pop(this.key),this._edgeLen=0,this._edgeLen2=0,this._center[is.MIDDLE][3]=0,this.elevationLevel=e,n&&!Number.isNaN(n.elevationBoundsMin)?(this._elevationBoundsMin=n.elevationBoundsMin,this._elevationBoundsMax=n.elevationBoundsMax):(this._elevationBoundsMin=0,this._elevationBoundsMax=0),this._pendingUpdates=0,this.renderData=null,this.screenDepth=0,this._visible=!1,this._previouslyRendered=!1,this._parent=n,this.unsetChildren(),this._surface=s,this.updateVisibility(),this.maxLevelDeltaNeighborCount=0,this.unmergableChildCount=0;for(const o of Ew){const a=s.numLayers(o),l=this.layerInfo[o];for(const c of l)c.release();l.length=a;for(let c=0;c<a;c++)l[c]=$F.acquire(this._surface.upsampleInfoPool),o===Gt.ELEVATION&&this.findElevationBoundsForLayer(c,-1)}this.computeElevationBounds(),this._maxTesselation=Math.min(s.tilingScheme.pixelSize,HA)}dispose(){Ss(!this.renderData,"tile.renderData was not unloaded"),this._surface.upsampleMapCache.pop(this.key);for(const e of Ew){for(const r of this.layerInfo[e])r.release();this.layerInfo[e].length=0}this._parent=null;for(let e=0;e<4;++e)this._children[e]=null;this._surface=null,this.setMemoryDirty()}refMapData(){++this._mapDataRefCount,this._isCached||this._surface.upsampleMapCache.pop(this.key)}unrefMapData(){if(--this._mapDataRefCount,this._isCached){this.setMemoryDirty();const e=this._cachedMemory;e>0&&this._surface.upsampleMapCache.put(this.key,this,e)}}setMemoryDirty(){this._usedMemory=null}get usedMemory(){return this._ensureUsedMemory()+(this._isCached?0:this._mapTileMemoryInternal)}get _cachedMemory(){return this._isCached?this._mapTileMemory:0}get _mapTileMemory(){return this._ensureUsedMemory(),this.layerInfo[Gt.MAP].reduce((e,r)=>e+(r instanceof KG?r.usedMemory/r.referenced:0),this._mapTileMemoryInternal)}get _cpuImageMemorySize(){const r=this._surface.tilingScheme.pixelSize;return r*r*4}_ensureUsedMemory(){var i;if(this._usedMemory!=null)return this._usedMemory;this._usedMemory=this._baseUsedMemory,this._mapTileMemoryInternal=0;let e=0;for(const{data:n}of this.layerInfo[Gt.MAP])n instanceof KG?e+=this._getTerrainDataMemory(n):this._mapTileMemoryInternal+=this._getTerrainDataMemory(n);const r=this._cpuImageMemorySize;for(const n of this.layerInfo[Gt.ELEVATION])this._usedMemory+=n.data?r:0;return this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._mapTileMemoryInternal+=((i=this.renderData.texture)==null?void 0:i.usedMemory)??0),this._isCached&&this._surface.upsampleMapCache.updateSize(this.key,this,this._mapTileMemoryInternal+e),this._usedMemory}getUsedMemoryForLayer(e,r){const i=this.layerInfo[e][r];return i!=null&&i.data?e===Gt.MAP?this._isCached?0:this._getTerrainDataMemory(i.data):e===Gt.ELEVATION?this._cpuImageMemorySize:0:0}_getTerrainDataMemory(e){return e instanceof fO?e.texture.usedMemory:e instanceof HTMLImageElement||e instanceof Sne?this._cpuImageMemorySize:e instanceof u3t?e.memoryUsage:e instanceof KG?e.usedMemory/e.referenced:0}updateScreenDepth(e){const r=this._center[is.MIDDLE],i=e,n=r[0],s=r[1],o=r[2],a=i[2]*n+i[6]*s+i[10]*o+i[14];this.screenDepth=a<0?0:a/(i[3]*n+i[7]*s+i[11]*o+i[15])}shouldSplit(e,r,i){if(!this.visible||e.frustum&&(!this._intersectsClippingArea||this._calculateFrustumVisibilityStatus(e.frustum)===Pa.OUTSIDE))return at.NONE;const n=this.level;ye(v4,this._center[is.MIDDLE],r);let s=Ra(v4),o=v4,a=this._center[is.MIDDLE];ye(tj,this._center[is.TOP],r);const l=Ra(tj);l<s&&(s=l,o=tj,a=this._center[is.TOP]),ye(rj,this._center[is.BOTTOM],r);const c=Ra(rj);if(c<s&&(s=c,o=rj,a=this._center[is.BOTTOM]),this._edgeLen2>s&&n<e.maxLod)return at.SPLIT;const u=Math.sqrt(s),h=e.fovX*u*2,p=this._edgeLen/h,f=()=>{if(n<e.maxLod)return this.elevationLevel=n,at.NONE;const O=n+Math.ceil(-Math.log2(e.relativeWidthLimit/p));return O!==this.elevationLevel?(this.elevationLevel=O,at.ELEVATION):at.NONE},g=i!=null?i-n:1/0;if(g<=.5)return f();const _=de(this.up,v4),v=this._elevationBoundsMax-this._elevationBoundsMin,b=v/this.edgeLen;if(e.aboveGround&&_>0&&b<.001&&_/u-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-b>0)return at.NONE;const w=i!=null?3-Math.min(g,2):1;if(p*w<e.relativeWidthLimit||n>=e.maxLod)return f();if(n<7)return at.SPLIT;ne(Po,this.up,_),ye(Po,Po,o);const x=Ra(Po);if(x<=this.radius*this.radius)return at.SPLIT;ne(Po,Po,this.radius/Math.sqrt(x)),fe(Po,Po,a),ye(Po,r,Po);const S=Math.min(1,(Math.abs(de(Po,this.up))+.5*v+this._curvatureHeight)/Te(Po)),E=d3t/e.angledSplitBias,A=e.fovY*u*2;return S*(this._edgeLen/A*w)<E*e.relativeHeightLimit?at.NONE:at.SPLIT}setChildren(e,r,i,n){Ss(!!(e&&r&&i&&n),"Null child passed");const s=this._children;return s[0]=e,s[1]=r,s[2]=i,s[3]=n,s}unsetChildren(){this._children[0]=null,this._children[1]=null,this._children[2]=null,this._children[3]=null}get isLoaded(){var e;return((e=this.renderData)==null?void 0:e.hasGeometry)??!1}load(){this.refMapData();for(const e of Ew)this._createOrUpdateAgents(0,e);this.surface.renderer.loadTile(this)}unload(e){e.unloadTile(this);for(const r of Ew){const i=this.layerInfo[r];for(const n of i)n.loadingAgent&&n.loadingAgent!==yc&&(_4(n.loadingAgent),n.loadingAgent=null),n.pendingUpdates=0}this.resetPendingUpdate(at.GEOMETRY),this.resetPendingUpdate(at.TEXTURE_NOFADING),this.resetPendingUpdate(at.TEXTURE_FADING),this.unrefMapData()}unloadMapData(){const e=this.layerInfo[Gt.MAP];for(const r of e)r.loadingAgent&&r.loadingAgent!==yc&&(_4(r.loadingAgent),r.loadingAgent=null),r.pendingUpdates=0;this.renderData&&this.renderData.releaseTexture(),this.setMemoryDirty()}updateClippingStatus(e){if(Sx(e,this._clippingArea))return!1;const r=this._intersectsClippingArea,i=this._isWithinClippingArea;e!=null?(this._intersectsClippingArea=this.intersectsExtent(e),this._isWithinClippingArea=this._isWithinExtent(e)):(this._intersectsClippingArea=!0,this._isWithinClippingArea=!0),this._clippingArea=e,this.updateVisibility();const n=i&&this._isWithinClippingArea,s=!(i||r||this._isWithinClippingArea||this._intersectsClippingArea);return!this.renderData||n||s||this.setPendingUpdate(at.GEOMETRY),!0}updateVisibility(){this._dirty=!0,this._surface.setTileTreeDirty()}getLayerInfo(e,r){return this.layerInfo[r][e]}hasLayerData(e,r){const i=this.layerInfo[r][e];return!(!(i!=null&&i.data)||i.dataInvalidated)}get updating(){if(this.hasPendingUpdates)return!0;for(const e of Ew){const r=this.layerInfo[e];for(const i of r)if(i.loadingAgent&&i.loadingAgent!==yc&&i.loadingAgent.updating)return!0}return!1}_isSuspended(e){return!!this.hasPendingUpdate(at.SPLIT)||e!==Gt.ELEVATION&&!this.loadable}get hasPendingUpdates(){return this._pendingUpdates!==0}hasPendingUpdate(e){return(this._pendingUpdates&e)===e}setPendingUpdate(e){const r=this._pendingUpdates;return this._pendingUpdates|=e,e===at.SPLIT||e===at.MERGE?this._surface.setTileTreeDirty():this._surface.requestUpdate(),r!==this._pendingUpdates}resetPendingUpdate(e){return!!this.hasPendingUpdate(e)&&(this._pendingUpdates&=~e,!0)}requestLayerData(e,r,i){const n=this.layerInfo[r][e];if(n.waitingAgents.has(i))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this._lij.toString(),i.tile.lij.toString(),r,e),!0;if(n.waitingAgents.push(i),n.data&&!n.dataInvalidated){console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this._lij.toString(),i.tile.lij.toString(),r,e);const a=n.data&&"type"in n.data&&n.data.type==="vector-tile";return i.dataArrived(this,a),!0}if(n.requestPromise)return!0;wl(n.requestAbort),n.requestAbort=new AbortController;const s=this._surface.requestTileData(this,e,r,n.requestAbort);if(!s)return n.requestAbort=null,!1;const o=()=>{n.requestPromise===s&&(n.requestPromise=null,n.requestAbort=null)};return n.requestPromise=s,s.then(o,o),!0}get isLeaf(){return this._children[0]==null}hasLij(e){return this._lij[0]===e[0]&&this._lij[1]===e[1]&&this._lij[2]===e[2]}findByLij(e){if(this.hasLij(e))return this;const r=this._children;return r[0]?r[0].findByLij(e)||r[1].findByLij(e)||r[2].findByLij(e)||r[3].findByLij(e):null}distanceToSquared(e){return Ra(ye(Po,this._center[is.MIDDLE],e))}containsPoint(e){const r=this.extent;return e[0]>=r[0]&&e[1]>=r[1]&&e[0]<=r[2]&&e[1]<=r[3]}containsPointXY(e,r){const i=this.extent;return e>=i[0]&&r>=i[1]&&e<=i[2]&&r<=i[3]}unrequestLayerData(e,r,i){const n=this.layerInfo[r][e],s=n.waitingAgents,o=s.removeUnordered(i)!=null;Ss(o,"agent has not requested this piece of map data"),s.length<1&&(n.abortRequest(),this.setMemoryDirty())}dataArrived(e,r,i){const n=i!=null&&"type"in i&&i.type==="vector-tile",s=this.layerInfo[r][e];s.data=i,s.dataInvalidated=!1,s.waitingAgents.forAll(o=>o.dataArrived(this,n)),s.waitingAgents.clear(),this.setMemoryDirty()}dataMissing(e,r,i){i.notInTilemap||console.error(`Tile ${this._lij.toString()} layer ${r}/${e} error ${i}`);const n=this.layerInfo[r][e];n.dataMissing=!0,n.waitingAgents.forAll(s=>s.dataMissing()),n.waitingAgents.clear(),this.setMemoryDirty()}updateRenderData(e,r,i){switch(i&&this.forEachLoadedNeighbor(n=>n.updateRenderData(e,r)),e){case Gt.MAP:return this._updateTexture(r);case Gt.ELEVATION:return this._updateGeometry()}}_updateTexture(e){this.renderData&&(this.resetPendingUpdate(e===ps.FADING?at.TEXTURE_NOFADING:at.TEXTURE_FADING),this.setPendingUpdate(e===ps.FADING?at.TEXTURE_FADING:at.TEXTURE_NOFADING))}_updateGeometry(){this.setPendingUpdate(at.GEOMETRY);for(const e of this.layerInfo[Gt.ELEVATION])e.pendingUpdates|=at.GEOMETRY}invalidateLayerData(e,r){this.layerInfo[r][e].invalidateSourceData(),this.restartAgents(r)}computeElevationBounds(){const e=this._elevationBoundsMin,r=this._elevationBoundsMax;let i=1/0,n=-1/0;const s=this.layerInfo[Gt.ELEVATION];let o=!0;for(const a of s)a.elevationBounds!=null&&(i=Math.min(i,a.elevationBounds.min),n=Math.max(n,a.elevationBounds.max),a.elevationBounds.hasNoDataValues||(o=!1));o&&(i=Math.min(i,0),n=Math.max(n,0)),e===i&&r===n||(this._elevationBoundsMin=i,this._elevationBoundsMax=n,this.updateRadiusAndCenter(),this._surface.setTileTreeDirty())}_updateCenter(){const e=this._elevationBoundsMin,r=this._elevationBoundsMax,i=.5*(e+r),n=this._center;ne(Po,this.up,i),fe(n[is.MIDDLE],this.centerAtSeaLevel,Po),ne(Po,this.up,e),fe(n[is.TOP],this.centerAtSeaLevel,Po),ne(Po,this.up,r),fe(n[is.BOTTOM],this.centerAtSeaLevel,Po)}findElevationBoundsForLayer(e,r){const i=this.layerInfo[Gt.ELEVATION][e],n=Cq(this.level),s=Math.max(this.elevationLevel-n,0),o=i.elevationBounds;if(o!=null&&o.level>=r&&o.level<=s)return;const a=this._surface.layerViewByIndex(e,Gt.ELEVATION),l=TJ(a);if(!IR(this,l,!1))return;const c=f3t;let u=!1;const h=i.data;if(h&&h.level<=s){const p=i.data;c.min=p.samplerData.data.minValue,c.max=p.samplerData.data.maxValue,c.hasNoDataValues=p.samplerData.data.hasNoDataValues,c.level=this.level,u=!0}else{let p,f,g=0;for(let _=this._parent;_&&(!f||g<n)&&(g=this.elevationLevel-_.level,p=f||p,f=_.layerInfo[Gt.ELEVATION][e].data,!(!f&&p&&_.level<=s));_=_.parent);f=f||p,f&&(f.computeMinMaxValue(this._lij[0],this._lij[1],this._lij[2],c),c.min!==1/0&&(c.level=f.level,u=!0))}u&&(i.elevationBounds==null&&(i.elevationBounds=new SC),i.elevationBounds.copyFrom(c))}modifyLayers(e,r,i){const n=this.layerInfo[i];for(const a of n)a.loadingAgent&&a.loadingAgent!==yc&&(_4(a.loadingAgent),a.loadingAgent=null),a.waitingAgents.clear();for(let a=0;a<n.length;++a)e[a]===void 0&&n[a].release();const s=new Array(...n),o=r.length;n.length=o;for(let a=0;a<o;a++){const l=r[a];n[a]=l>-1?s[l]:$F.acquire(this._surface.upsampleInfoPool)}this.setMemoryDirty()}restartAgents(e){this.renderData&&(this._createOrUpdateAgents(0,e),this.updateRenderData(e,ps.FADING))}updateAgents(e){if(this.renderData){const r=this.layerInfo[e];for(const i of r)i.loadingAgent===yc&&(i.loadingAgent=null);this._createOrUpdateAgents(0,e)}}updateAgentSuspension(){for(const e of Ew){const r=this._isSuspended(e);for(const i of this.layerInfo[e])i.loadingAgent&&i.loadingAgent!==yc&&(i.loadingAgent.setSuspension(r),i.loadingAgent===yc&&this.updateRenderData(e,ps.FADING))}}removeLayerAgent(e,r){const i=this.layerInfo[r][e];i.loadingAgent&&i.loadingAgent!==yc&&i.loadingAgent.dispose(),i.loadingAgent=null}agentDone(e,r){const i=this.layerInfo[r][e];i.loadingAgent=yc,i.data||i.upsampleInfo!=null||this._createOrUpdateAgents(e+1,r)}_hasBlendableAncestor(e){return e.blendMode!=="normal"||RE(e.parent)&&this._hasBlendableAncestor(e.parent)}_hasBlendModes(e,r,i){var n,s,o;for(let a=e;a<r;++a){const l=this._surface.layerViewByIndex(a,i);if(oI(l)&&((n=l==null?void 0:l.layer)==null?void 0:n.blendMode)!=="normal"||RE((s=l==null?void 0:l.layer)==null?void 0:s.parent)&&this._hasBlendableAncestor((o=l==null?void 0:l.layer)==null?void 0:o.parent))return!0}return!1}_createOrUpdateAgents(e,r){const i=this.layerInfo[r];if(i.length===0)return;const n=this._isSuspended(r);for(let s=e;s<i.length;++s){const o=i[s];let a=!1;const l=this._surface.layerViewByIndex(s,r),c=TJ(l);if(o.loadingAgent?IR(this,c,!1)?(o.loadingAgent!==yc&&o.loadingAgent.setSuspension(n),o.loadingAgent!==yc&&(a=o.loadingAgent.update())):o.dispose():IR(this,c,!1)&&(o.loadingAgent=p3t(this,s,r,n),a=o.loadingAgent.startLoading(),a?o.loadingAgent===yc&&this.setPendingUpdate(at.GEOMETRY):(_4(o.loadingAgent),o.loadingAgent=yc)),o.loadingAgent===yc&&this.updateRenderData(r,ps.FADING),!this._hasBlendModes(e,i.length,r)&&a&&l.isOpaque)return}}_isWithinExtent(e){const r=this.extent;return r[0]>=e[0]&&e[2]>=r[2]&&r[1]>=e[1]&&e[3]>=r[3]}intersectsExtent(e){const r=this.extent;return r[2]>=e[0]&&e[2]>=r[0]&&r[3]>=e[1]&&e[3]>=r[1]}getElevationVerticesPerSide(e){const r=this.elevationLevel-this.level,i=Math.max(this.level-e,Cq(this.level)-r),n=we(1+(this.maxTesselation>>i),2,this.maxTesselation+1),s=this.getDefaultVerticesPerSide();return Math.max(n,s)}get test(){return{cachedMemory:this._cachedMemory}}_findLIJ(e,r){if(!e)return null;const i=this.surface.rootTiles;if(i!=null){for(const n of i)if(m3t(n,e)){let s=n,o=e[0]-s.level-1;for(;o>=0&&!s.isLeaf&&!r(s);){const a=e[1]>>o&1,l=e[2]>>o&1;s=s.children[2*a+l],o--}return r(s)?s:null}}return null}findNeighborTile(e,r){const i=this._lij,n=this.getNeighborLIJ(i,e);return n?LF(i,n)?r(this)?this:null:this._findLIJ(n,r):null}findCorner(e,r){const i=e===mt.NORTH_EAST?1:e===mt.NORTH_WEST?0:e===mt.SOUTH_WEST?2:3;let n=this;for(;n.children[0]&&(!r||!r(n));)n=n.children[i];return n}findNeighborCornerTileExact(e,r){var i;return((i=this.findNeighborTile(e,n=>r(n)||n.level===this.level))==null?void 0:i.findCorner(j8(e),r))||null}forAllSubtreeOnSide(e,r){const i=e===mt.NORTH?[0,1]:e===mt.NORTH_EAST?[1]:e===mt.EAST?[1,3]:e===mt.SOUTH_EAST?[3]:e===mt.SOUTH?[2,3]:e===mt.SOUTH_WEST?[2]:e===mt.WEST?[0,2]:[0],n=s=>{const o=s.children;!r(s)&&o[0]&&i.forEach(a=>n(o[a]))};n(this)}getNeighborEdgeStartVertexIndex(e,r){if(!r)return 0;const i=this.level-r.level;if(Re(!Ys||i>=0),i===0)return 0;const n=2**i,s=(1&e)==1,o=s?0:1,a=r.lij[o+1]*n,l=this._lij[o+1],c=l-a,u=s?n-1-c:c;return Ys&&(Re(a<=l&&l<a+n),Re(0<=u&&u<n)),u}forEachLoadedNeighbor(e){const r=this.level,i=n=>n.level===r||n.isLoaded;jp.forEach(n=>{const s=this.findNeighborTile(n,i);s!=null&&s!==this&&s.forAllSubtreeOnSide(Pne(n),o=>!!o.isLoaded&&(e(o,n),!0))}),H8.forEach(n=>{var o;const s=(o=this.findNeighborTile(n,i))==null?void 0:o.findCorner(j8(n),a=>a.isLoaded);Re(!s||OJ(this,s,n)),s!=null&&s.isLoaded&&e(s,n)})}getNeighborLIJ(e,r){const i=Wge(r)?-1:Hge(r)?1:0,n=Gge(r)?-1:jge(r)?1:0,s=[e[0],e[1]+i,e[2]+n];return s[1]<0?null:this.surface.isGlobal?this.wrapLIJ(s):s[2]<0?null:s}wrapLIJ(e){return!e||e[1]<0||e[1]>=2**e[0]?null:this.surface.wrapEastWest(e)}get westNeighborWestExtent(){return this.extent[0]*(this.isWestEnd?-1:1)}get eastNeighborEastExtent(){return this.extent[2]*(this.isEastEnd?-1:1)}get isEastEnd(){return this._lij[2]===this.surface.lijEastEnd(this.level)-1}get isWestEnd(){return this._lij[2]===0}get isNorthEnd(){return this._lij[1]===0}get isSouthEnd(){const e=this.surface.extent,r=(e==null?void 0:e[1])??null;return r!=null&&this.extent[1]+Va()>=r}checkGeometryWaterproofness(){var e;V8&&(Re(this.isLoaded),(e=this.renderData)==null||e.checkGeometryWaterproofness())}shouldHaveNeighbor(e){const r=this.extent,i=this.surface.rootTilesExtent,n=.25*(r[2]-r[0]);if(Wge(e)&&r[3]+n>=i[3]||Hge(e)&&r[1]-n<=i[1])return!1;const s=this.surface.isGlobal;return!(!s&&Gge(e)&&r[0]-n<=i[0])&&!(!s&&jge(e)&&r[2]+n>=i[2])}updateDistanceToPOI(e){const r=this._lastPOI;if(this.distanceToPOI>=0&&r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2])return;ce(this._lastPOI,e);const i=this._center[is.MIDDLE],n=e[0]-i[0],s=e[1]-i[1],o=e[2]-i[2];this.distanceToPOI=n*n+s*s+o*o}};function p3t(t,e,r,i){const n=r===Gt.ELEVATION?$ne.acquire():Rne.acquire();return n.init(t,e,r,i),n}function _4(t){t.dispose(),t instanceof n4e?$ne.release(t):t instanceof s4e&&Rne.release(t)}const Rne=new ua(s4e),$ne=new ua(n4e),f3t=new SC;var is;function m3t(t,e){const r=t.lij,i=e[0]-r[0];return!(i<0)&&e[1]>>i===r[1]&&e[2]>>i===r[2]}function LF(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function g3t(t,e,r){if(t==null||e==null)return!1;if(t.level===0&&e.level===0&&(t.isEastEnd&&e.isWestEnd&&r===mt.EAST||t.isWestEnd&&e.isEastEnd&&r===mt.WEST))return!0;const i=Math.max(1e-6*(t.extent[2]-t.extent[0]),1);switch(r){case mt.NORTH:return Hh(t.extent[3],e.extent[1],i);case mt.SOUTH:return Hh(t.extent[1],e.extent[3],i);case mt.EAST:return Hh(t.extent[2],e.extent[0],i)||Hh(t.extent[2],-e.extent[0],i);case mt.WEST:return Hh(t.extent[0],e.extent[2],i)||Hh(t.extent[0],-e.extent[2],i)}}function OJ(t,e,r){return t!=null&&e!=null&&e!==t&&(t.level>=e.level?Qge(t,e,r):Qge(e,t,j8(r)))}function Qge(t,e,r){Re(t.level>=e.level);const i=EEt(r),n=PEt(r),s=t.extent,o=e.extent,a=[i?s[0]:s[2],n?s[3]:s[1]],l=[i?o[2]:o[0],n?o[1]:o[3]],c=1e-5*(s[2]-s[0]),u=Hh(a[0],l[0],c)||t.surface.isGlobal&&Hh(a[0],-l[0],c),h=Hh(a[1],l[1],c);if(u&&h)return!0;if(t.level===e.level||!u&&!h)return Re(!1),!1;const p=u?Kge(o[1],o[3],s[1],s[3],c):Kge(o[0],o[2],s[0],s[2],c);return Re(p),p}function Kge(t,e,r,i,n){return t-n<=r&&r<=i&&i<=e+n}(function(t){t[t.TOP=0]="TOP",t[t.MIDDLE=1]="MIDDLE",t[t.BOTTOM=2]="BOTTOM"})(is||(is={}));const v4=C(),tj=C(),rj=C(),Po=C();let y3t=class{constructor(){this._scales=Bt(-1,-1,-1,-1),this._offsets=Bt(-1,-1,-1,-1)}clear(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1,this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=-1}setScale(e,r,i){this._scales[2*e]=r,this._scales[2*e+1]=i}setOffset(e,r,i){this._offsets[2*e]=r,this._offsets[2*e+1]=i}get scales(){return this._scales}get offsets(){return this._offsets}};function _3t(t,e){t.varyings.add("tbnTangent","vec3"),t.varyings.add("tbnBiTangent","vec3"),e.spherical?t.vertex.code.add(T`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`):t.vertex.code.add(T`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`),t.fragment.code.add(T`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)}var Um;(function(t){t[t.LayerOnly=0]="LayerOnly",t[t.ColorComposite=1]="ColorComposite",t[t.GridComposite=2]="GridComposite",t[t.COUNT=3]="COUNT"})(Um||(Um={}));let v3t=class extends hie{constructor(){super(...arguments),this.overlayOpacity=1}};function b3t(t,e){const{vertex:r,fragment:i,varyings:n}=t;n.add("vtc","vec2"),r.uniforms.add(new e0e("texOffsetAndScale")),i.uniforms.add(new t0e("tex")),i.uniforms.add(new ij("textureOpacities"));const s=e.textureFadingEnabled&&!e.renderOccluded;s&&(r.uniforms.add(new e0e("nextTexOffsetAndScale")),n.add("nvtc","vec2"),i.uniforms.add(new t0e("texNext")),i.uniforms.add(new ij("nextTexOpacities")),i.uniforms.add(new w3t("fadeFactor")));const o=e.tileBlendInput===Um.ColorComposite,a=e.tileBlendInput===Um.GridComposite;a&&i.include(Mne),o&&i.uniforms.add(new ij("backgroundColor")),r.code.add(T`
  void forwardTextureCoordinatesWithTransform(in vec2 uv) {
    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;
    ${s?T`nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;`:T``}
  }`),i.code.add(T`
    vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
      ${a||o?T`
              if (opacities.y <= 0.0) {
                return color * opacities.z * opacities.x;
              }
              vec4 bg = vec4(${o?T`backgroundColor`:T`gridColor(uv)`} * opacities.y, opacities.y);
              vec4 layer = color * opacities.z;
              return (bg * (1.0 - layer.a) + layer) * opacities.x;`:T`return color;`}
    }`),s?i.code.add(T`vec4 getTileColor() {
vec4 color = getColor(texture(tex, vtc), vtc, textureOpacities);
if (fadeFactor >= 1.0) {
return color;
}
vec4 nextColor = getColor(texture(texNext, nvtc), nvtc, nextTexOpacities);
return mix(nextColor, color, fadeFactor);
}`):i.code.add(T`vec4 getTileColor() {
return getColor(texture(tex, vtc), vtc, textureOpacities);
}`)}let w3t=class extends vn{constructor(e){super(e,"float")}},ij=class extends vn{constructor(e){super(e,"vec3")}},e0e=class extends vn{constructor(e){super(e,"vec4")}},t0e=class extends vn{constructor(e){super(e,"sampler2D")}},Ine=class extends v3t{};function d4e(t){const e=new Or,{vertex:r,fragment:i,varyings:n}=e;e.include(HI),e.include(K3,t),e.include(qm,t);const s=()=>{e.include(tI,t),r.code.add(T`vec3 getNormal() {
float z = 1.0 - abs(normalCompressed.x) - abs(normalCompressed.y);
vec3 n = vec3(normalCompressed + vec2(normalCompressed.x >= 0.0 ? 1.0 : -1.0,
normalCompressed.y >= 0.0 ? 1.0 : -1.0) * min(z, 0.0), z);
return normalize(n);
}`)};Zc(r,t),e.include(Kl,t);const o=t.overlayMode!==Fm.Disabled,a=o&&t.invisible;switch(t.output){case U.Color:{e.include(b3t,t),e.include(y2,t),o&&e.include(KP,{...t,pbrMode:t.pbrMode===ot.Simplified?ot.TerrainWithWater:ot.Water});const l=t.overlayMode===Fm.EnabledWithWater;l&&e.include(_3t,t),n.add("vnormal","vec3"),n.add("vpos","vec3"),n.add("vup","vec3"),s(),t.screenSizePerspective&&o3(r);const c=t.receiveShadows&&!t.renderOccluded;c&&e.include(X3,t),t.screenSizePerspective&&(n.add("screenSizeDistanceToCamera","float"),n.add("screenSizeCosAngle","float")),r.code.add(T`
        void main(void) {
          //Position
          vpos = position;
          vec3 positionWorld = position + localOrigin;
          gl_Position = transformPosition(proj, view, vpos);

          //Normal
          vnormal = getNormal();

          //Up
          vup = getLocalUp(position, localOrigin);

          ${l?T`forwardVertexTangent(vnormal);`:T``}

          //Texture UV
          vec2 uv = getUV0();
          forwardTextureCoordinatesWithTransform(uv);
          ${o?T`setOverlayVTC(uv);`:""}
          ${t.tileBorders?T`forwardTextureCoordinates();`:""}

          ${t.screenSizePerspective?T`
          vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
          screenSizeDistanceToCamera = length(viewPos);
          vec3 viewSpaceNormal = (viewNormal * vec4(normalize(positionWorld), 1.0)).xyz;
          screenSizeCosAngle = abs(viewSpaceNormal.z);`:""}

          ${c?T`forwardLinearDepth();`:""}

        }
      `),e.include(Fn,t),e.include(y2,t),e.include(iL,t),e.include(f3,t),cf(i,t),nL(i),tP(i),i.uniforms.add(r.uniforms.get("localOrigin"),new Ft("viewDirection",(u,h)=>pe(r0e,ie(r0e,h.camera.viewMatrix[12],h.camera.viewMatrix[13],h.camera.viewMatrix[14])))),l&&i.uniforms.add(new ct("ovWaterTex",(u,h)=>{var p;return(p=h.overlay)==null?void 0:p.getTexture(Ui.WaterNormal)}),new MAe("view",(u,h)=>ic(x3t,h.camera.viewMatrix,u.origin))),i.code.add(T`const float sliceOpacity = 0.2;
float lum(vec3 c) {
return (min(min(c.r, c.g), c.b) + max(max(c.r, c.g), c.b)) * 0.5;
}`),by(i),_g(i),i.code.add(T`
        void main() {
          vec3 normal = normalize(vnormal);
          float vndl = dot(normal, mainLightDirection);

          float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));
          float shadow = ${t.receiveShadows&&!t.renderOccluded?"readShadowMap(vpos, linearDepth)":t.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

          float ssao = evaluateAmbientOcclusionInverse();
          vec4 tileColor = getTileColor();

          ${o?T`
              vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
              vec4 overlayColor = overlayOpacity * overlayColorOpaque;
              ${t.invisible?T`if (overlayColor.a == 0.0) { discard; }`:""}
              vec4 groundColor = tileColor;
              tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`:""}

          // If combined alpha is 0 we can discard pixel. The performance impact by having a discard here
          // is neglectable because terrain typically renders first into the framebuffer.
          if(tileColor.a <= 0.0) {
            discard;
          }

          bool sliced = rejectBySlice(vpos);
          if (sliced) {
            tileColor *= sliceOpacity;
          }

          vec3 albedo = tileColor.rgb;

          // heuristic shading function used in the old terrain, now used to add ambient lighting

          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

          ${t.pbrMode===ot.Simplified||t.pbrMode===ot.TerrainWithWater?T`fragColor = vec4(evaluatePBRSimplifiedLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight, normalize(vpos - cameraPosition), vup), tileColor.a);`:T`fragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);`}
          ${l?T`
              vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
                vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
                vec4 viewPosition = view*vec4(vpos, 1.0);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - cameraPosition), shadow, vnormal, tbnMatrix, viewPosition.xyz,  vpos + localOrigin);
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                float opacity = sliced ? sliceOpacity : 1.0;
                // un-gamma the ground color to mix in linear space
                fragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w) * opacity;
              }`:""}
          ${t.screenSizePerspective?T`
            float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, vec4(0.0, 0.0, 0.0, 0.0));
            if (perspectiveScale <= 0.25) {
              fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
            }
            else if (perspectiveScale <= 0.5) {
              fragColor = mix(fragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
            }
            else if (perspectiveScale >= 0.99) {
              fragColor = mix(fragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
            }
            else {
              fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
            }`:""}
          ${t.visualizeNormals?t.spherical?T`
                  vec3 localUp = normalize(vpos + localOrigin);
                  vec3 right = normalize(cross(vec3(0.0, 0.0, 1.0), localUp));
                  vec3 forward = normalize(cross(localUp, right));
                  mat3 tbn = mat3(right, forward, localUp);
                  vec3 tNormal = normalize(normal * tbn);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:T`
                  vec3 tNormal = normalize(normal);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:""}
          ${t.tileBorders?T`
              vec2 dVuv = fwidth(vuv0);
              vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv0, 1.0 - vuv0));
              float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
              fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`:""}
          fragColor = highlightSlice(fragColor, vpos);
        }
      `)}break;case U.LinearDepth:a&&e.include(KP,t),e.include(ly,t),_v(e),f2(e),r.code.add(T`
              void main(void) {
                ${a?T`setOverlayVTC(getUV0());`:""}
                gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
              }
          `),i.code.add(T`
              void main() {
                ${a?T`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
                outputDepth(linearDepth);
              }
          `);break;case U.Shadow:case U.ShadowHighlight:case U.ShadowExcludeHighlight:e.include(ly,t),_v(e),f2(e),r.code.add(T`void main(void) {
gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
}`),i.code.add(T`void main() {
outputDepth(linearDepth);
}`);break;case U.Normal:a&&e.include(KP,t),n.add("vnormal","vec3"),o3(r),s(),r.code.add(T`
        void main(void) {
          ${a?T`setOverlayVTC(getUV0());`:""}
          gl_Position = transformPosition(proj, view, position);
          vnormal = normalize((viewNormal * vec4(getNormal(), 1.0)).xyz);
        }
      `),i.code.add(T`
        void main() {
          ${a?T`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
          vec3 normal = normalize(vnormal);
          if (gl_FrontFacing == false) {
            normal = -normal;
          }
          fragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
        }
      `);break;case U.Highlight:o&&e.include(KP,t),r.code.add(T`
          void main() {
            ${o?T`setOverlayVTC(getUV0());`:""}
            gl_Position = transformPosition(proj, view, position);
          }
        `),e.include(Vv,t),i.code.add(T`
          void main() {
            ${o?T`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
            outputHighlight();
          }
        `)}return t.output===U.ObjectAndLayerIdColor&&(o?(e.include(KP,{...t,pbrMode:ot.Disabled}),r.code.add(T`void main(void) {
gl_Position = transformPosition(proj, view, position);
setOverlayVTC(getUV0());
}`),i.code.add(T`void main() {
fragColor = getOverlayColorTexel(vtcOverlay);
}`)):(r.code.add(T`void main(void) {}`),i.code.add(T`void main() {
fragColor = vec4(0.0);
}`))),e}const x3t=xe(),r0e=C(),T3t=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:Ine,build:d4e},Symbol.toStringTag,{value:"Module"}));let p4e=class f4e extends Vr{constructor(){super(...arguments),this.useStencil=!1}initializeConfiguration(e,r){r.spherical=e.viewingMode===De.Global}initializeProgram(e){return new Lr(e.rctx,f4e.shader.get().build(this.configuration),m4e)}initializePipeline(){return this._stencilPipelineState=this._createPipeline(!0),this._createPipeline(!1)}_createPipeline(e){const r=this.configuration,i=r.backfaceCullingEnabled&&!r.renderOccluded;return kt({blending:r.renderOccluded?tu(Se.ONE,Se.ONE_MINUS_SRC_ALPHA):null,culling:i?Yte:null,depthTest:r.renderOccluded?null:{func:Xr.LESS},depthWrite:r.renderOccluded?null:ru,colorWrite:Yt,stencilTest:e?fdt(tc.IntegratedMeshMaskExcluded):null})}getPipeline(){return this.useStencil?this._stencilPipelineState:super.getPipeline()}};p4e.shader=new Ir(T3t,()=>ge(()=>Promise.resolve().then(()=>i4t),void 0));const m4e=new Map([[R.POSITION,0],[R.UV0,1],[R.NORMALCOMPRESSED,2]]);let S3t=class{constructor(){this.geometry=new NEt,this.intersectionData=null,this.geometryState=null,this._vao=null,this._texture=null,this._textureRef=new e4e(()=>this.tile.surface.fadeDuration),this.overlay=new y3t,this._localOrigin=null,this._geometryStateChangedSinceLastUpdate=!0,this._hasGeometry=!1,this._modifiedFlags=0}get tile(){return this._tile}get localOrigin(){return this._localOrigin}init(e,r){this.clear(),this._tile=e,this.geometry.reset(),this.intersectionData=null,this.geometryState=new kEt,this._localOrigin=r,this.overlay.clear()}clear(){this.releaseGeometry(),this.releaseTexture(),this._textureRef.clear(),this._tile=null,this.intersectionData=null,this.geometryState=null}updateGeometryIfNeeded(e){if((!this._vao||this._geometryStateChangedSinceLastUpdate||this.wireframeChanged||this.clippingAreaChanged||this.samplerDataChanged||this.numVerticesPerSideChanged||this.dirtyCorners||this.dirtyEdgeResolutions||this.dirtyEdges)&&(this._updateGeometry(e),this._geometryStateChangedSinceLastUpdate=!1),Ys&&this.tile.intersectsClippingArea)for(let r=0;r<4;++r)Re(this.geometry.getEdgeCount(r)===this.geometryState.edgeResolutions[r]+1)}_calculateEdgeResolution(e,r){var l;const i=this.tile,n=this.geometryState.numVerticesPerSide-1;if(!i.surface.isGlobal){const c=i.surface.extent;if(c!=null&&(e===0&&i.extent[3]>c[3]||e===1&&i.extent[2]>c[2]||e===2&&i.extent[1]<c[1]||e===3&&i.extent[0]<c[0]))return n}const s=i.level,o=jp[e];if(!r)return Re(((l=i.surface)==null?void 0:l.rootTiles)==null||i.surface.updatingRootTiles||!i.shouldHaveNeighbor(o)),n;if(r.isLoaded){const c=r,u=c.renderData.geometryState,h=s-c.level;if(Re(h>=0),h===0){const g=u.numVerticesPerSide-1;return Math.max(g,n)}const p=2**h,f=u.edgeResolutions[(e+2)%4]/p;return Math.max(1,f)}Re(!r.isLeaf);let a=n;return r.forAllSubtreeOnSide(Pne(o),c=>c===i||(c.isLoaded?(a=Math.max(a,2**(c.level-s)),!0):(Re(!c.isLeaf),!1))),a}updateNeighborData(){var o;const e=this.tile;if(!e.intersectsClippingArea)return;const r=e.renderData.geometryState,i=a=>(a.isLoaded||a.level===e.level)&&(a==null?void 0:a.intersectsClippingArea),n=r.edgePeerNeighbors,s=r.edgePeerNeighborSamplerVersions;for(let a=0;a<4;++a){const l=e.findNeighborTile(jp[a],i),c=Qw(e,l),u=((o=c==null?void 0:c.renderData)==null?void 0:o.geometryState.samplerDataVersion)??-1,h=n[a],p=c!==Qw(e,h),f=s[a]!==u;Ys&&l&&(Re(e.level>=l.level),Re(e.level-l.level<=Ps)),n[a]=l,(p||f)&&(s[a]=u,this._markEdgeDirty(a));const g=r.edgeResolutions[a],_=this._calculateEdgeResolution(a,l);Re(y$(_)),Re(_>=1),r.edgeResolutions[a]=_,g!==_&&this._markEdgeResolutionDirty(a)}for(let a=0;a<4;++a){const l=e.findNeighborTile(H8[a],i);r.cornerPeerNeighbors[a]=l;const c=Qw(e,n[a]),u=Qw(e,n[(a+1)%4]),h=Qw(e,l);Gd[a]=h,Gd[(a+1)%4]=u,Gd[(a+2)%4]=e,Gd[(a+3)%4]=c,Re(Gd.some(_=>(_==null?void 0:_.isLoaded)||_===e));const p=Gd.reduce((_,v)=>Math.min(_,(v==null?void 0:v.level)??1/0),1/0);Gd.forEach((_,v)=>{_&&(_==null?void 0:_.level)>p&&(Gd[v]=null)}),Re(Gd.some(_=>(_==null?void 0:_.isLoaded)||_===e));const f=r.cornerNeighborCornerTiles,g=r.cornerNeighborCornerTileSamplerVersions;for(let _=0;_<4;++_){const v=Gd[_],b=(v==null?void 0:v.renderData.geometryState.samplerDataVersion)??-1,w=4*a+_,x=f[w]!==v,S=!x&&g[w]!==b;(x||S)&&(f[w]=v,g[w]=b,this._markCornerDirty(a))}Ys&&Re(Lne.some(_=>{var v;return((v=f[4*a+_])==null?void 0:v.isLoaded)||f[4*a+_]===e}))}Ys&&Re(this.geometryState.edgeResolutions.every(a=>a>0));for(let a=0;a<4;++a)Gd[a]=null}_updateGeometry(e){if(!this.tile.intersectsClippingArea)return;Ys&&Re(!this.tile.intersectsClippingArea||this.geometryState.edgeResolutions.every(f=>f>0)),this.intersectionData=null;const{tile:r,_vao:i,geometry:n,geometryState:s}=this,o=!i||!1||this.wireframeChanged||this.samplerDataChanged||this.clippingAreaChanged||this.numVerticesPerSideChanged,a=this.dirtyEdgeResolutions!==0,l=s.edgeResolutions.reduce((f,g)=>f+g+1,0),c=o||a&&l>((n==null?void 0:n.maxEdgeVertexCount)??0),u=!c&&a,h=!u&&(this.dirtyEdges!==0||a),p=!h&&this.dirtyCorners!==0;c?(this.releaseGeometry(),this._createGeometry(e)):u?r.updateEdgeElevationsAndResolutions():h||p?r.updateEdgeElevations():p?r.updateCornerElevations():console.warn("Update for no reason?"),this._modifiedFlags=0}get hasGeometry(){return this._hasGeometry}releaseGeometry(){return this._hasGeometry=!1,this.intersectionData=null,!!this._vao&&(this._vao=gt(this._vao),this.geometry.release(),!0)}ensureTexture(e,r,i){const n=r?Tt.RGBA:Tt.RGB;return this._texture==null||this._texture.descriptor.width===e&&this._texture.descriptor.pixelFormat===n||this.releaseTexture(),this._texture==null&&(this._texture=i(),this.tile.setMemoryDirty()),this._texture}releaseTexture(){this._texture!=null&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())}get numVerticesPerSideChanged(){return(this._modifiedFlags&E3t)!=0}get samplerDataChanged(){return(this._modifiedFlags&P3t)!=0}get clippingAreaChanged(){return(this._modifiedFlags&A3t)!=0}get wireframeChanged(){return(this._modifiedFlags&M3t)!=0}get dirtyEdges(){return this._modifiedFlags>>nj&15}get dirtyCorners(){return this._modifiedFlags>>sj&15}get dirtyEdgeResolutions(){return this._modifiedFlags>>oj&15}_markCornerDirty(e){const r=1<<e<<sj;this._modifiedFlags|=r}_markEdgeDirty(e){const r=1<<e<<nj;this._modifiedFlags|=r,this._markCornerDirty((e+0)%4),this._markCornerDirty((e+3)%4)}_markEdgeResolutionDirty(e){const r=1<<e<<oj;this._modifiedFlags|=r,this._markEdgeDirty(e)}_markAllEdgesAndCornersDirty(){this._modifiedFlags|=15<<sj|15<<nj|15<<oj}updateGeometryState(){const e=this._getElevationInfo(),r=this.tile,i=e.samplerData?r.getElevationVerticesPerSide(e.maxTileLevel):r.getDefaultVerticesPerSide(),n=Math.max(i,5);let s=r.clippingArea;r.intersectsClippingArea&&!r.isWithinClippingArea||(s=null);const o=this.geometryState;let a=!1;o.numVerticesPerSide!==n&&(this._modifiedFlags|=1,o.numVerticesPerSide=n,o.samplerDataVersion++,a=!0),e.changed&&(this._modifiedFlags|=2,o.samplerData=e.samplerData,o.samplerDataVersion++,a=!0),tg(o.clippingArea,s)||(this._modifiedFlags=4,o.clippingArea=s,a=!0);const l=r.surface.wireframe;return o.wireframe!==l&&(this._modifiedFlags=8,o.wireframe=l,a=!0),this._geometryStateChangedSinceLastUpdate||(this._geometryStateChangedSinceLastUpdate=a),a&&this._markAllEdgesAndCornersDirty(),this._hasGeometry=!0,this._geometryStateChangedSinceLastUpdate}_createGeometry(e){this.tile.createGeometry();const r=this.geometry.vertexAttributes,i=this.geometry.indices,n=e.gl;this._vao=new _f(e,m4e,{geometry:ou(r.layout)},{geometry:Wr.createVertex(e,n.STATIC_DRAW,r.buffer)},Wr.createIndex(e,n.STATIC_DRAW,i)),this._hasGeometry=!0}get vao(){return this._vao}setTextureReference(e,r=X1.Immediate){e!=null&&e.texture!==this._texture&&this.releaseTexture(),this._textureRef.push(e,r)}get textureReference(){return this._textureRef.current}get nextTextureReference(){return this._textureRef.next}get textureFadeFactor(){return this._textureRef.fadeFactor}get textureIsFading(){return this._textureRef.isFading}_getElevationInfo(){const e=this.geometryState.samplerData,r=this.tile.layerInfo[Gt.ELEVATION],i=r.length,n=new Array(i);let s=0,o=0,a=!1;for(let u=0;u<i;u++){const h=r[u];if(h.upsampleInfo!=null){const p=h.upsampleInfo.tile,f=p.layerInfo[Gt.ELEVATION][u].data,g=f&&f.samplerData;e&&e[s]===g||(a=!0),n[s++]=g,o=Math.max(o,p.lij[0])}else if(h.data){const p=this.tile.surface.layerViewByIndex(u,Gt.ELEVATION);if(IR(this.tile,p.layer,!1)){const f=h.data;e&&e[s]===f.samplerData||(a=!0),n[s++]=f.samplerData,o=this.tile.level}}}e!=null&&e.length!==s&&(a=!0);const l=s>0,c=l?n:null;return l&&(n.length=s),{changed:a,samplerData:c,maxTileLevel:o}}get estimatedGeometryMemoryUsage(){var r,i,n;const e=((r=this.intersectionData)==null?void 0:r.estimatedMemoryUsage)??0;return(((i=this.geometry.indices)==null?void 0:i.byteLength)??0)+(((n=this.geometry.vertexAttributes)==null?void 0:n.byteLength)??0)+e}get texture(){return this._texture}get test(){return{hasTexture:this._texture!=null}}checkGeometryWaterproofness(){if(!Ys)return;const e=this.tile;if(!e.isLoaded||!e.intersectsClippingArea||e.level===0)return void Re(e==null?void 0:e.isLoaded);const r=e.surface.extent;if(r!=null&&!e.intersectsExtent(r))return;const i=jp.map((a,l)=>r!=null&&(l<2?-1:1)*(e.extent[3-l]-r[3-l])<0),n=e.level;Re(this.dirtyCorners===0),Re(this.dirtyEdges===0),Re(this.dirtyEdgeResolutions===0),Re(!this.numVerticesPerSideChanged),Re(!this.samplerDataChanged),Re(!this.clippingAreaChanged),Re(!this.wireframeChanged);const s=H8.map(a=>e.findNeighborCornerTileExact(a,l=>!l.intersectsClippingArea||l.isLoaded||l.level===e.level)??null).map(a=>a!=null&&a.intersectsClippingArea?a:null),o=this.geometryState;for(let a=0;a<4;++a){const l=o.cornerPeerNeighbors[a],c=s[a];Re(c===l,`Tile[${e.lij}].corner[${a}] out of date: cur=[${l==null?void 0:l.lij}] exp=[${c==null?void 0:c.lij}]`)}jp.forEach((a,l)=>{if(i[l])return;const c=e.findNeighborTile(a,H=>(H.level===n||(H==null?void 0:H.isLoaded))&&(H==null?void 0:H.intersectsClippingArea));if(!c){const H=!e.surface.updatingRootTiles&&e.surface.rootTiles!=null&&e.surface.rootTiles.length>0&&e.shouldHaveNeighbor(a);return void Re(!H)}Re(c.isLoaded||c.level===e.level),Re(c===this.geometryState.edgePeerNeighbors[l]);const u=n-c.level;if(!c.isLoaded)return Re(!c.isLeaf),void Re(u===0);const h=c.renderData;Re(g3t(e,c,a)),Re(u>=0);const p=2**u;if(u<0)return void Re(!1);const f=e.renderData,g=f.geometry,_=f.localOrigin,v=g.getEdgeCount(l),b=g.numVerticesPerSide-1,w=h.geometry;if(!w)return void Re(!1);const x=h.localOrigin,S=this.geometryState.edgePeerNeighbors[l];if(S!=null&&S.isLoaded){const H=S.renderData;Re(f.geometryState.edgePeerNeighborSamplerVersions[l]===H.geometryState.samplerDataVersion),Re(this.geometryState.edgePeerNeighborSamplerVersions[l]===H.geometryState.samplerDataVersion)}const E=(l+2)%4,A=w.getEdgeCount(E),O=v-1,L=A-1;Re(O*p===L,`Tile[${e.lij}]:e${l},res=${O} edgeRes mismatch with Neighbor[${c.lij}]:e${E},res=${L} (expected:${O*p})`);const z=e.extent,k=a===mt.NORTH||a===mt.SOUTH,q=A-1,B=q>>u,J=v-1;if(B<1)return void Re(J===1);Re(B===J),Re(y$(B));const W=w.numVerticesPerSide-1;Re(u>0||B===Math.max(W,b));const Y=e.getNeighborEdgeStartVertexIndex(l,c);Re(0<=Y&&Y<p);const le=Y*B;Re(0<=le&&le<=q-B);let D=0,I=le;g.getEdgeVertexPosition(l,Gf,_,0),g.getEdgeVertexPosition(l,jf,_,v-1);const F=Di(Gf,jf),G=Math.max(C3t,1e-4*F);for(let H=0;H<=B;++H){g.getEdgeVertexPosition(l,Gf,_,D),w.getEdgeVertexPosition(E,jf,x,I);const Z=H/B,te=k?z[0]+Z*(z[2]-z[0]):a===mt.WEST?z[0]:z[2],me=k?a===mt.SOUTH?z[1]:z[3]:z[1]+Z*(z[3]-z[1]),Me=e.surface.extent;if(Me==null||l9(Me,te,me)){const it=D0(Gf,jf),Et=Pc(Gf)-Yr.radius,St=Pc(jf)-Yr.radius,ht=it<G;if(!ht){console.warn(`Tile edge vertex position mismatch: between [${e.lij}].edge${l}[${D}/${v}] and [${c.lij}].edge${E}[${I}/${A}]`),Me!=null&&console.warn("  surface extent= ",Me," x,y=",te,",",me);const _r=C();ye(_r,f.localOrigin,h.localOrigin),Pc(_r)>0&&console.warn(`   localOrigins: ${f.localOrigin} vs ${h.localOrigin} d=${Pc(_r)} [${_r}]`),(()=>{const Ue=Zi(Gf),pr=Zi(jf);e.updateEdgeElevations(),c.updateEdgeElevations(),g.getEdgeVertexPosition(l,Gf,_,D),w.getEdgeVertexPosition(E,jf,x,I);const Oe=C();Yi(Oe,Gf,Ue),Pc(Oe)>0&&console.warn(`  XXX Tile[${e.lij}] edge out of date: ${Ue} vs ${Gf} d=${Pc(Oe)} [${Oe}]`),Yi(Oe,jf,pr),Pc(Oe)>0&&console.warn(`  XXX Neighbor[${c.lij}] edge out of date: ${pr} vs ${jf} d=${Pc(Oe)} [${Oe}]`)})();const Cr=g.getEdgeCount(l),Ni=w.getEdgeCount(A);Re(ht,`Mismatch in tile [${e.lij}].edge[${l}][${D}/${Cr}] vs neighbor [${c.lij}].edge[${E}][${I}/${Ni}] ${Vg(Gf)} vs ${Vg(jf)}  dist=${it} h(t|n|d)=${Et}|${St}|${St-Et}`)}g.getEdgeNormal(l,VT,D),w.getEdgeNormal(E,GT,I),pe(i0e,VT),pe(n0e,GT);const Ke=de(i0e,n0e),je=1-Ke<.01||!1||e===c;if(!je){const _r=C();Yi(_r,VT,GT);const Cr=()=>`Mismatch in tile edge normal ${Vge(e.lij)} (${D}/${v-1}) edge ${l} vs neighbor ${Vge(c.lij)}  (${I}/${A-1}) nedge ${E} :${Vg(VT)} vs ${Vg(GT)}  dot = ${Ke} : ${Vg(_r)}`;console.warn("Mismatch in tile edge normal: ",Cr());{e.updateEdgeElevations(),c.updateEdgeElevations();const Ni=C(),Ue=C();g.getEdgeNormal(l,Ni,D),w.getEdgeNormal(E,Ue,I),i2(VT,Ni)||console.warn("Missing update in tile normal: ",Vg(VT)," => ",Vg(Ni)),i2(GT,Ue)||console.warn("Missing update in neighbor normal: ",Vg(GT)," => ",Vg(Ue))}Re(je,Cr())}}D+=1,I+=1}})}};const Gf=C(),jf=C(),VT=C(),GT=C(),i0e=C(),n0e=C(),C3t=1,Gd=[null,null,null,null];function Qw(t,e){return e!=null&&e.isLoaded||e===t?e:null}const E3t=1,P3t=2,A3t=4,M3t=8,nj=4,sj=8,oj=12,Lne=[0,1,2,3],O3t=65536;function R3t(t,e){const{tile:r,geometry:i,geometryState:n}=t,{extentInRadians:s,surface:o}=r,{isWebMercator:a,renderer:l}=o,{numVerticesPerSide:c,wireframe:u}=n,h=c-1,p=(c-2)**2,f=a&&(e===jh.HAS_SOUTH_POLE||e===jh.HAS_BOTH_POLES),g=a&&(e===jh.HAS_NORTH_POLE||e===jh.HAS_BOTH_POLES),_=((f?1:0)+(g?1:0))*DF*c,v=O4e(n),b=p+_+4*v,w=l.tileGeometryCache.acquire(b);i.numVerticesPerSide=c,i.vertexAttributes=w,i.maxEdgeVertexCount=v;const{boundingBox:x}=i;Li(x);const S=Nne(t);Io.update(h,s,S),I3t(t),i.poleVerticesStartIndex=p;const E=$3t(t,f,g);i.edgeVerticesStartIndex=p+_,kne(t),Dne(t),x4e(i,E,u),t.intersectionData=null}function $3t(t,e,r){const{tile:i,localOrigin:n,geometry:s}=t,{extent:o,ellipsoid:a}=i,{boundingBox:l,numVerticesPerSide:c,vertexAttributes:u,poleVerticesStartIndex:h}=s,p=c-1,f=n[0],g=n[1],_=n[2],v=a.radius,b=o[1],w=o[3],x=[];let S=h;const E=(A,O)=>{const L=O*c;od(-f,-g,A*v-_,l),x.push({connectedRowOffset:L,connectedOuterEdgeOffset:A===1?0:2,rowOffset:S,latitudeResolution:DF});const z=_4e(A===-1?b:w,v),k=A*Math.PI/2-z,q=.99*(A===1?1:-1),B=v+0,{position:J,uv0:W}=u,{typedBuffer:Y,typedBufferStride:le}=u.normalCompressed;for(let D=1;D<=DF;++D){const I=z+k*(D/DF),F=Math.cos(I),G=Math.sin(I);for(let H=0;H<=p;H++){const Z=H/p,te=Io.sinLonLUT[H],me=Io.cosLonLUT[H]*F,Me=te*F,it=G,Et=me*B-f,St=Me*B-g,ht=it*B-_;od(Et,St,ht,l),J.setValues(S,Et,St,ht),ef(W,S,Z,q),mf(Y,S,me,Me,it,le),++S}}};return e&&E(-1,0),r&&E(1,p),x}function I3t(t){const{tile:e}=t;if(!e.intersectsClippingArea)return;const{geometry:r,geometryState:i,localOrigin:n}=t,{numVerticesPerSide:s,samplerData:o}=i,a=s-2,l=s-1,{vertexAttributes:c,boundingBox:u}=r,h=c.position,p=c.uv0,{typedBuffer:f,typedBufferStride:g}=c.normalCompressed,{extent:_}=e,v=_[0],b=_[2],w=_[1],x=_[3],S=e.ellipsoid.radius,E=n[0],A=n[1],O=n[2],L=h.typedBuffer,z=h.typedBufferStride,k=1/l;let q=0;if(1<=a){const B=k,J=w*(1-B)+x*B,W=Io.sinLatLUT[1],Y=Io.cosLatLUT[1];for(let le=1;le<=a;le++){const D=le*k,I=v*(1-D)+b*D,F=Io.sinLonLUT[le],G=Io.cosLonLUT[le],H=S+dn(I,J,o),Z=H*G*Y-E,te=H*F*Y-A,me=H*W-O;od(Z,te,me,u);const Me=(le-1)*z;L[Me]=Z,L[Me+1]=te,L[Me+2]=me,ef(p,le-1,D,B)}}for(let B=1;B<=a;B++){const J=B*k,W=w*(1-J)+x*J,Y=Io.sinLatLUT[B],le=Io.cosLatLUT[B],D=B+1,I=D*k,F=w*(1-I)+x*I,G=Io.sinLatLUT[D],H=Io.cosLatLUT[D],Z=Io.sinLonLUT[0],te=Io.cosLonLUT[0],me=S+dn(v,W,o);let Me=te*le*me-E,it=Z*le*me-A,Et=Y*me-O;const St=q*z;let ht=L[St],Ke=L[St+1],je=L[St+2];for(let _r=1;_r<=a;_r++){const Cr=_r*k,Ni=v*(1-Cr)+b*Cr,Ue=Io.sinLonLUT[_r],pr=Io.cosLonLUT[_r];let Oe=0,Ve=0,xt=0;if(_r<a){const ur=(q+1)*z;Oe=L[ur],Ve=L[ur+1],xt=L[ur+2]}else{const ur=Io.sinLonLUT[l],Fi=Io.cosLonLUT[l],Pn=S+dn(b,W,o);Oe=Fi*le*Pn-E,Ve=ur*le*Pn-A,xt=Y*Pn-O}const zt=Me,We=it,At=Et;Me=ht,it=Ke,Et=je,ht=Oe,Ke=Ve,je=xt;const Ie=Oe-zt,et=Ve-We,Mt=xt-At;let ui=0,Gr=0,Mi=0;if(B>1){const ur=(q-a)*z;ui=L[ur],Gr=L[ur+1],Mi=L[ur+2]}else{const ur=Io.sinLatLUT[0],Fi=Io.cosLatLUT[0],Pn=S+dn(Ni,w,o);ui=pr*Fi*Pn-E,Gr=Ue*Fi*Pn-A,Mi=ur*Pn-O}const Dr=S+dn(Ni,F,o),qr=pr*H*Dr-E,fr=Ue*H*Dr-A,Nr=G*Dr-O;if(B<a){const ur=q+a,Fi=ur*z;L[Fi]=qr,L[Fi+1]=fr,L[Fi+2]=Nr,od(qr,fr,Nr,u),ef(p,ur,Cr,I)}const vr=ui-qr,Jr=Gr-fr,Ct=Mi-Nr;let or=pr*le,br=Ue*le,hi=Y;hi*hi<.999&&(or=Mt*Jr-et*Ct,br=Ie*Ct-Mt*vr,hi=et*vr-Ie*Jr);const Kn=1/Math.sqrt(or*or+br*br+hi*hi);mf(f,q,or*Kn,br*Kn,hi*Kn,g),++q}}}function L3t(t){t.tile.intersectsClippingArea&&(Dne(t),nP(t),t.intersectionData=null)}function D3t(t){t.tile.intersectsClippingArea&&(C4e(t),Dne(t),nP(t),A4e(t),t.intersectionData=null)}function N3t(t){t.tile.intersectsClippingArea&&(y4e(t),g4e(t,!0),nP(t),t.intersectionData=null)}function Dne(t){t.tile.intersectsClippingArea&&(y4e(t),g4e(t))}function g4e(t,e=!1){const{geometry:r,geometryState:i,tile:n,localOrigin:s}=t,{level:o,extent:a,extentInRadians:l,ellipsoid:c}=n,u=c.radius,h=l[0],p=l[2],f=l[1],g=l[3],{samplerData:_}=i,v=a[0],b=a[2],w=a[1],x=a[3],S=Nne(t),{boundingBox:E,vertexAttributes:A}=r,O=s[0],L=s[1],z=s[2],k=A.position,q=k.typedBuffer,B=k.typedBufferStride,J=A.uv0;for(let W=0;W<4;++W){const Y=W===1||W===3,le=i.edgeResolutions[W];Re(y$(le));const D=le+1,I=Qw(n,i.edgePeerNeighbors[W]);if(M4e(n,I,W)){E4e(t,W,I);continue}const F=I!=null;Re(!F||I.level===n.level),Re(!F||H0(n,I)<=0);const G=I==null?void 0:I.renderData,H=G==null?void 0:G.geometryState;if(Ys){const Ie=n.surface;if(!I&&Ie&&!Ie.updatingRootTiles){const et=jp[W],Mt=n.findNeighborTile(et,ui=>ui.isLoaded||ui.isLeaf||ui.level===n.level);Mt?Mt.intersectsClippingArea&&(Re(!Mt.isLoaded),Re(!Mt.isLeaf),Re(Mt.level===o)):Re((Ie==null?void 0:Ie.rootTiles)==null||!n.shouldHaveNeighbor(et))}}const Z=W===1?a[2]:a[0],te=I==null?void 0:I.extent,me=te&&Y?W===1?te[0]:te[2]:Z,Me=W===0?a[3]:a[1],it=W===1?1:0,Et=W===0?1:0,St=W===1?p:h,ht=W===0?g:f,Ke=Math.sin(St),je=Math.cos(St),_r=Math.sin(ht),Cr=Math.cos(ht),Ni=H==null?void 0:H.samplerData,Ue=F?(Ie,et,Mt)=>.5*(dn(Ie,et,_)+dn(Mt,et,Ni)):(Ie,et,Mt)=>dn(Ie,et,_),pr=r.outerEdgesOffsetAndLength[2*W+0],Oe=e&&D>3?D-3:1,Ve=_!=null&&_.some(Ie=>Ie!=null),xt=Ni!=null&&Ni.some(Ie=>Ie!=null),zt=Ve||xt,We=1/le,At=pr;Re(!te||Hh(te[2]-te[0],a[2]-a[0])),(()=>{const Ie=W===1?-1:W===3?1:0,et=W===0?-1:W===2?1:0,Mt=(a[2]-a[0])*We,ui=Ie*Mt,Gr=et*Mt,Mi=Y?Ie*((p-h)*We):0,Dr=Y?0:et*We,qr=Et,fr=Y?St+Mi:St,Nr=Y?Math.sin(fr):Ke,vr=Y?Math.cos(fr):je,Jr=Y?St-Mi:St,Ct=Y?Math.sin(Jr):Ke,or=Y?Math.cos(Jr):je,br=Y?ht:S(qr+Dr),hi=Y?_r:Math.sin(br),Kn=Y?Cr:Math.cos(br),ur=Y?ht:S(qr-Dr),Fi=Y?_r:Math.sin(ur),Pn=Y?Cr:Math.cos(ur);let So=0,ja=0,Ha=0;{const mr=0*We,ji=Y?Z:v*(1-mr)+b*mr,ws=Y?me:ji,to=Y?w*(1-mr)+x*mr:Me,ae=Y?St:h*(1-mr)+p*mr,jr=Y?Ke:Math.sin(ae),Pd=Y?je:Math.cos(ae),ro=Y?S(mr):ht,Ad=Y?Math.sin(ro):_r,ut=Y?Math.cos(ro):Cr,uc=u+Ue(ji,to,ws);So=Pd*ut*uc,ja=jr*ut*uc,Ha=Ad*uc}let Co=0,as=0,An=0;{const mr=1*We,ji=Y?Z:v*(1-mr)+b*mr,ws=Y?me:ji,to=Y?w*(1-mr)+x*mr:Me,ae=Y?St:h*(1-mr)+p*mr,jr=Y?Ke:Math.sin(ae),Pd=Y?je:Math.cos(ae),ro=Y?S(mr):ht,Ad=Y?Math.sin(ro):_r,ut=Y?Math.cos(ro):Cr,uc=u+Ue(ji,to,ws);Co=Pd*ut*uc,as=jr*ut*uc,An=Ad*uc}for(let mr=1;mr<D-1;mr+=Oe){let ji=0,ws=0,to=0;{const Wa=(mr+1)*We,hc=Y?Z:v*(1-Wa)+b*Wa,wf=Y?me:hc,no=Y?w*(1-Wa)+x*Wa:Me,bn=Y?St:h*(1-Wa)+p*Wa,Oy=Y?Ke:Math.sin(bn),Yv=Y?je:Math.cos(bn),Xv=Y?S(Wa):ht,W2=Y?Math.sin(Xv):_r,Zv=Y?Math.cos(Xv):Cr,Ry=u+Ue(hc,no,wf);ji=Yv*Zv*Ry,ws=Oy*Zv*Ry,to=W2*Ry}const ae=ji,jr=ws,Pd=to,ro=Co,Ad=as,ut=An;Co=ae,as=jr,An=Pd;{const Wa=At+mr,hc=Wa*B,wf=ro-O,no=Ad-L,bn=ut-z;q[hc]=wf,q[hc+1]=no,q[hc+2]=bn,od(wf,no,bn,E);const Oy=mr*We;ef(J,Wa,Y?it:Oy,Y?Oy:Et)}const uc=So,io=ja,Hv=Ha;So=ro,ja=Ad,Ha=ut;const Wv=ro,Tl=Ad,Cg=ut,qv=1/Math.sqrt(Wv*Wv+Tl*Tl+Cg*Cg),Qt=Cg*qv;let Ay=0,Eg=0,My=0;if(zt&&Qt*Qt<.999){let Wa=0,hc=0,wf=0;{const no=W===0?-1:1;Wa=no*(ae-uc),hc=no*(jr-io),wf=no*(Pd-Hv)}{const no=mr*We,bn=Y?Z:v*(1-no)+b*no,Oy=Y?me:bn,Yv=Y?w*(1-no)+x*no:Me,Xv=Y?St:h*(1-no)+p*no,W2=Y?Ke:Math.sin(Xv),Zv=Y?je:Math.cos(Xv),Ry=Y?S(no):ht,xL=Y?Math.sin(Ry):_r,Sl=Y?Math.cos(Ry):Cr;let oP=Wv,aP=Tl,X=Cg;if(F){const ve=u+dn(Oy-ui,Yv-Gr,Ni),Ee=Y?Sl:Pn;oP=(Y?or:Zv)*Ee*ve,aP=(Y?Ct:W2)*Ee*ve,X=(Y?xL:Fi)*ve}{const ve=u+dn(bn+ui,Yv+Gr,_),Ee=Y?Sl:Kn,gr=(Y?vr:Zv)*Ee*ve,ls=(Y?Nr:W2)*Ee*ve,Oi=(Y?xL:hi)*ve;F||(oP=2*Wv-gr,aP=2*Tl-ls,X=2*Cg-Oi);const qa=W===3?-1:1,Jv=qa*(oP-gr),_se=qa*(aP-ls),vse=qa*(X-Oi);Ay=wf*_se-hc*vse,Eg=Wa*vse-wf*Jv,My=hc*Jv-Wa*_se;const uB=1/Math.sqrt(Ay*Ay+Eg*Eg+My*My);Ay*=uB,Eg*=uB,My*=uB}}}else Ay=Wv*qv,Eg=Tl*qv,My=Cg*qv;r.setEdgeNormalFromValues(W,mr,Ay,Eg,My)}})()}}function y4e(t){P4e(t)}function _4e(t,e){return Math.PI/2-2*Math.atan(Math.exp(-t/e))}function F3t(t,e,r,i){return _4e(t*(1-i)+e*i,r)}function k3t(t,e,r){return t*(1-r)+e*r}function Nne(t){const{tile:e}=t;if(e.surface.isWebMercator){const i=e.extent,n=e.ellipsoid.radius;return s=>F3t(i[1],i[3],n,s)}const r=e.extentInRadians;return i=>k3t(r[1],r[3],i)}function z3t(t,e){const{tile:r,geometryState:i,geometry:n}=t,{extent:s,surface:o}=r,{wireframe:a}=i,l=s[0],c=s[1],u=s[2]-l,h=s[3]-c,{numVerticesPerSide:p,clippingArea:f}=i,g=f!=null?Math.max(0,(f[0]-l)/u):0,_=f!=null?Math.max(0,(f[1]-c)/h):0,v=f!=null?Math.min(1,(f[2]-l)/u):1,b=f!=null?Math.min(1,(f[3]-c)/h):1,w=(p-2)**2,x=O4e(i),S=w+4*x,E=o.renderer.tileGeometryCache.acquire(S),{boundingBox:A}=n;Li(A),n.numVerticesPerSide=p,n.vertexAttributes=E,n.maxEdgeVertexCount=x,n.minu=g,n.minv=_,n.maxu=v,n.maxv=b,U3t(t),n.edgeVerticesStartIndex=w,kne(t),Fne(t),x4e(n,[],a),t.intersectionData=null}function U3t(t){const{tile:e}=t;if(!e.intersectsClippingArea)return;const{geometry:r,geometryState:i,localOrigin:n}=t,{samplerData:s,clippingArea:o,numVerticesPerSide:a}=i,{surface:l,extent:c,ellipsoid:u}=e,{isWebMercatorOnPlateCarree:h}=l,p=o??zne,f=c[0],g=c[1],_=c[2],v=c[3],b=Math.max(f,p[0]),w=Math.min(_,p[2]),x=Math.max(g,p[1]),S=Math.min(v,p[3]),E=u.radius,A=e.horizontalScale,O=a-1,L=a-2,{minu:z,minv:k,maxu:q,maxv:B,boundingBox:J,vertexAttributes:W}=r,Y=W.position,le=W.uv0,{typedBuffer:D,typedBufferStride:I}=W.normalCompressed,F=n[0],G=n[1],H=n[2],Z=Y.typedBuffer,te=Y.typedBufferStride;let me=0;const Me=we(g,x,S),it=h?(Math.PI/2-2*Math.atan(Math.exp(-Me/E)))*E:Me*A,Et=1/O,St=we(g*(1-Et)+v*Et,x,S);let ht=it,Ke=h?(Math.PI/2-2*Math.atan(Math.exp(-St/E)))*E:St*A;for(let je=1;je<=L;je++){const _r=je/O,Cr=we(g*(1-_r)+v*_r,x,S),Ni=we(_r,k,B),Ue=Ke,pr=(je-1)/O,Oe=we(g*(1-pr)+v*pr,x,S),Ve=ht,xt=(je+1)/O,zt=we(g*(1-xt)+v*xt,x,S),We=h?(Math.PI/2-2*Math.atan(Math.exp(-zt/E)))*E:zt*A,At=we(xt,k,B);ht=Ke,Ke=We;const Ie=we(f,b,w);let et=Ie*A,Mt=dn(Ie,Cr,s);const ui=1/O,Gr=we(ui,z,q),Mi=we(f*(1-Gr)+_*Gr,b,w);let Dr=Gr,qr=Mi,fr=Mi*A,Nr=dn(Mi,Cr,s);if(je===1){const vr=fr-F,Jr=ht-G,Ct=Nr-H,or=0*te;Z[or]=vr,Z[or+1]=Jr,Z[or+2]=Ct,od(vr,Jr,Ct,J);const br=we(ui,z,q);ef(le,me,br,Ni)}for(let vr=1;vr<=L;vr++){const Jr=fr,Ct=Nr,or=(vr+1)/O,br=we(or,z,q),hi=we(f*(1-or)+_*or,b,w),Kn=qr;qr=hi;{const as=me+1,An=as*te;if(je===1||vr===L){const mr=hi*A,ji=dn(hi,Cr,s);if(je===1&&vr<L){const ws=mr-F,to=Ue-G,ae=ji-H;Z[An]=ws,Z[An+1]=to,Z[An+2]=ae,od(ws,to,ae,J),ef(le,as,br,Ni)}fr=mr,Nr=ji}else fr=Z[An]+F,Nr=Z[An+2]+H}const ur=fr,Fi=Nr,Pn=et,So=Mt;et=Jr,Mt=Ct;const ja=(me-L)*te,Ha=je===1?dn(Kn,Oe,s):Z[ja+2]+H,Co=dn(Kn,zt,s);if(je<L){const as=me+L,An=as*te,mr=Jr-F,ji=We-G,ws=Co-H;Z[An]=mr,Z[An+1]=ji,Z[An+2]=ws,od(mr,ji,ws,J);const to=Dr;Dr=br,ef(le,as,to,At)}{const as=ur-Pn,An=Ve-We,mr=An*(Fi-So),ji=as*(Ha-Co),ws=-An*as,to=mr*mr+ji*ji+ws*ws;if(to===0)mf(D,me,0,0,1,I);else{const ae=1/Math.sqrt(to);mf(D,me,mr*ae,ji*ae,ws*ae,I)}}++me}}}function B3t(t,e){t.tile.intersectsClippingArea&&(b4e(t),v4e(t,!0),nP(t),t.intersectionData=null)}function V3t(t,e){t.tile.intersectsClippingArea&&(C4e(t),Fne(t),nP(t),A4e(t),t.intersectionData=null)}function G3t(t,e){t.tile.intersectsClippingArea&&(Fne(t),nP(t),t.intersectionData=null)}function Fne(t,e){t.tile.intersectsClippingArea&&(b4e(t),v4e(t,!1))}function v4e(t,e){const{geometry:r,geometryState:i,tile:n,localOrigin:s}=t,{surface:o,extent:a}=n,{clippingArea:l,samplerData:c}=i,u=l??zne,h=a[0],p=a[2],f=a[1],g=a[3],_=[g>u[3],p>u[2],f<u[1],h<u[0]],v=n.horizontalScale,b=w4e(o.isWebMercatorOnPlateCarree,n.ellipsoid.radius,v),{minu:w,minv:x,maxu:S,maxv:E,boundingBox:A}=r,O=Math.max(h,u[0]),L=Math.min(p,u[2]),z=Math.max(f,u[1]),k=Math.min(g,u[3]),q=s[0],B=s[1],J=s[2];for(let W=0;W<4;++W){const Y=W===1||W===3,le=i.edgeResolutions[W];Re(y$(le));const D=le+1,I=_[W],F=Qw(n,i.edgePeerNeighbors[W]);if(!I&&M4e(n,F,W)){E4e(t,W,F);continue}const G=F!=null&&!I,H=F==null?void 0:F.renderData,Z=H==null?void 0:H.geometryState;if(Ys&&(Re(!G||F.level===n.level),Re(!G||H0(n,F)<=0),n&&!F&&!o.updatingRootTiles)){const We=jp[W],At=n.findNeighborTile(We,Ie=>Ie.isLoaded||Ie.isLeaf||Ie.level===n.level);o.updatingRootTiles||(At?At.intersectsClippingArea&&(Re(!At.isLoaded),Re(!At.isLeaf),Re(At.level===n.level)):Re((o==null?void 0:o.rootTiles)==null||!n.shouldHaveNeighbor(We)))}const te=we(W===1?p:h,O,L),me=we(W===0?g:f,z,k),Me=Z==null?void 0:Z.samplerData,it=e&&D>3?D-3:1,Et=we(W===1?1:0,w,S),St=we(W===0?1:0,x,E),ht=G?(We,At)=>.5*(dn(We,At,Me)+dn(We,At,c)):(We,At)=>dn(We,At,c),Ke=(p-h)/le,je=Y?W===1?Ke:-Ke:0,_r=Y?0:W===0?Ke:-Ke,Cr=-je,Ni=-_r;let Ue=0,pr=0,Oe=0;{const We=0/le,At=Y?te:we(h*(1-We)+p*We,O,L),Ie=Y?we(f*(1-We)+g*We,z,k):me,et=ht(At,Ie);Ue=At*v,pr=b(Ie),Oe=et}let Ve=0,xt=0,zt=0;{const We=1/le,At=Y?te:we(h*(1-We)+p*We,O,L),Ie=Y?we(f*(1-We)+g*We,z,k):me,et=ht(At,Ie);Ve=At*v,xt=b(Ie),zt=et}for(let We=1;We<D-1;We+=it){const At=We/le,Ie=Ve,et=xt,Mt=zt;{const Ct=Y?Et:we(At,w,S),or=Y?we(At,x,E):St,br=Ie-q,hi=et-B,Kn=Mt-J;od(Ie,hi,Kn,A),r.setEdgeVertexFromValuesRawPositionUV(W,We,br,hi,Kn,Ct,or)}{const Ct=(We+1)/le,or=Y?te:we(h*(1-Ct)+p*Ct,O,L),br=Y?we(f*(1-Ct)+g*Ct,z,k):me,hi=ht(or,br);Ve=or*v,xt=b(br),zt=hi}const ui=Ve,Gr=zt,Mi=Ue,Dr=pr,qr=Oe;Ue=Ie,pr=et,Oe=Mt;let fr=0,Nr=0,vr=0;if(Y){const Ct=xt-et,or=Gr-Mt,br=Dr-et,hi=qr-Mt,Kn=we(f*(1-At)+g*At,z,k),ur=te+Cr,Fi=ur*v-Ie,Pn=dn(ur,Kn,c)-Mt,So=W===3?-1:1;if(fr=So*(-br+Ct)*Pn,Nr=So*Fi*(-hi+or),vr=-So*Fi*(-br+Ct),G){const ja=te+je,Ha=ja*v-Ie;fr=(-br+Ct)*(Pn-(dn(ja,Kn,Me)-Mt)),Nr=(Fi-Ha)*(-hi+or),vr=-(Fi-Ha)*(-br+Ct)}}else{const Ct=ui-Ie,or=Gr-Mt,br=Mi-Ie,hi=qr-Mt,Kn=we(h*(1-At)+p*At,O,L),ur=me+Ni,Fi=dn(Kn,ur,c)-Mt,Pn=b(ur)-et,So=W===2?-1:1;if(fr=So*Pn*(-hi+or),Nr=So*(-br+Ct)*Fi,vr=-So*Pn*(-br+Ct),G){const ja=Kn,Ha=me+_r,Co=b(Ha)-et;fr=(-Pn+Co)*(-hi+or),Nr=(-br+Ct)*(-Fi+(dn(ja,Ha,Me)-Mt)),vr=-(-Pn+Co)*(-br+Ct)}}const Jr=1/Math.sqrt(fr*fr+Nr*Nr+vr*vr);r.setEdgeNormalFromValues(W,We,fr*Jr,Nr*Jr,vr*Jr)}}}function b4e(t,e){P4e(t)}function j3t(t,e){return(Math.PI/2-2*Math.atan(Math.exp(-t/e)))*e}function H3t(t,e){return t*e}function w4e(t,e,r){return t?i=>j3t(i,e):i=>H3t(i,r)}function x4e(t,e,r){const{numVerticesPerSide:i,vertexAttributes:n,maxEdgeVertexCount:s}=t,o=i-1,a=n.count,l=2*(i-3)*(i-3),c=4*(o+s-3),u=Lne.reduce((_,v)=>_+(o+t.getEdgeCount(v)-3),0),h=e.reduce((_,v)=>_+o*(2*(v.latitudeResolution-1)+1),0),p=3*(r?2:1),f=(l+c+h)*p,g=a>=O3t?new Uint32Array(f):new Uint16Array(f);for(let _=0;_<f;++_)g[_]=0;t.indices=g,t.indexCount=(l+u+h)*p,t.poleIndicesStartIndex=l*p,t.edgeIndicesStartIndex=(l+h)*p,r?(Y3t(t),X3t(t,e),S4e(t)):(W3t(t),q3t(t,e),T4e(t))}function W3t(t){const{numVerticesPerSide:e,indices:r,vertexAttributes:i}=t,{position:n}=i,{typedBuffer:s,typedBufferStride:o}=n,a=e-2,l=e-3,c=0,u=e-3;let h=0;for(let p=0;p<l;++p){const f=p*a;for(let g=c;g<u;++g){const _=f+g,v=_+1,b=v+a,w=b-1;R4e(_,v,b,w,o,s)?(r[h]=_,r[h+1]=v,r[h+2]=b,r[h+3]=b,r[h+4]=w,r[h+5]=_):(r[h]=_,r[h+1]=v,r[h+2]=w,r[h+3]=w,r[h+4]=v,r[h+5]=b),h+=6}}}function q3t(t,e){const{numVerticesPerSide:r,indices:i,poleIndicesStartIndex:n}=t,s=r-1;let o=n;for(const a of e){let l=t.getEdgeVertexIndex(a.connectedOuterEdgeOffset,0),c=1;for(let u=0;u<a.latitudeResolution;++u){const h=u===0?a.rowOffset:l+r;for(let p=0;p<s;p++){const f=h+p;i[o]=l,i[o+1]=l+1,i[o+2]=f,u<a.latitudeResolution-1?(i[o+3]=l+1,i[o+4]=f+1,i[o+5]=f,o+=6):o+=3,l+=c}l=h,c=1}}}function T4e(t){const{indices:e,numVerticesPerSide:r,edgeIndicesStartIndex:i}=t,n=r-1,s=n-2;let o=i;for(let a=0;a<4;++a){const l=Une[a];let c=0,u=0;const h=t.getEdgeCount(a),p=l.count;Re(p===n-1);const f=a===1||a===2,g=f?1:2,_=f?2:1,v=t.getEdgeFirstVertexIndex(a),b=1,w=l.vertex0Index,x=l.stride;for(;c<h-1||u<p-1;){const S=w+u*x,E=v+c*b,A=c<h-1,O=u<p-1,L=A&&(!O||(A?0+n*(c+.5)/(h-1):0)<=(O?1+s*(u+.5)/(p-1):0));L?++c:++u;const z=L?E+b:S+x;e[o]=S,e[o+g]=E,e[o+_]=z,o+=3}}t.indexCount=o}function Y3t(t){const{indices:e,numVerticesPerSide:r,vertexAttributes:i}=t,{position:n}=i,{typedBuffer:s,typedBufferStride:o}=n,a=r-2;let l=0;for(let c=0;c<r-3;++c){const u=c*a;for(let h=0;h<r-3;++h){const p=c*a+h,f=p+1,g=f+a,_=g-1,v=u+h,b=v+1,w=b+a;R4e(v,b,w,w-1,o,s)?(CC(e,l,p,f,g),l+=6,CC(e,l,g,_,p)):(CC(e,l,p,f,_),l+=6,CC(e,l,_,g,f)),l+=6}}}function X3t(t,e){const{indices:r,numVerticesPerSide:i,poleIndicesStartIndex:n}=t,s=i-1;let o=n;for(const a of e){const l=a.connectedOuterEdgeOffset;let c=t.getEdgeVertexIndex(l,0),u=1;for(let h=0;h<a.latitudeResolution;++h){const p=h===0?a.rowOffset:c+i;for(let f=0;f<s;f++)CC(r,o,c,c+1,p+f),o+=6,h<a.latitudeResolution-1&&(CC(r,o,c+1,p+f+1,p+f),o+=6),c+=u;c=p,u=1}}}function S4e(t){const{indices:e,numVerticesPerSide:r,edgeIndicesStartIndex:i}=t,n=r-1,s=n-2;let o=i;for(let a=0;a<4;++a){const l=Une[a];let c=0,u=0;const h=t.getEdgeCount(a),p=l.count;Re(p===n-1);const f=a===1||a===2,g=f?1:3,_=f?3:1,v=t.getEdgeFirstVertexIndex(a),b=1,w=l.vertex0Index,x=l.stride;for(;c<h-1||u<p-1;){const S=w+u*x,E=v+c*b,A=c<h-1,O=u<p-1,L=A&&(!O||(A?0+n*(c+.5)/(h-1):0)<=(O?1+s*(u+.5)/(p-1):0));L?++c:++u;const z=L?E+b:S+x;e[o]=S,e[o+g]=E,e[o+g+1]=E,e[o+_]=z,e[o+_+1]=z,e[o+5]=S,o+=6}}t.indexCount=o}function kne(t){const{geometry:e,geometryState:r}=t,{edgeResolutions:i}=r,{numVerticesPerSide:n,edgeVerticesStartIndex:s}=e,o=n-2;let a=s;for(let l=0;l<4;++l){{const c=l===0||l===2,u=(l===0?o-1:0)*o+(l===1?o-1:0),h=(c?0:1)*o+(c?1:0),p=Une[l];p.vertex0Index=u,p.stride=h,p.count=o}{const c=i[l]+1;e.outerEdgesOffsetAndLength[2*l+0]=a,e.outerEdgesOffsetAndLength[2*l+1]=c,a+=c}}}function C4e(t){kne(t),t.geometryState.wireframe?S4e(t.geometry):T4e(t.geometry)}function E4e(t,e,r){const i=(e+2)%4,{geometryState:n,geometry:s,tile:o,localOrigin:a}=t,l=o.level-r.level,c=e===1||e===3,u=n.edgeResolutions[e];Re(y$(u));const h=u+1,{boundingBox:p,minu:f,minv:g,maxu:_,maxv:v,vertexAttributes:b}=s,w=we(e===1?1:0,f,_),x=we(e===0?1:0,g,v),S=r.renderData,E=S.geometryState,A=S.geometry,O=A.getEdgeCount(i),L=o.getNeighborEdgeStartVertexIndex(e,r)*u,z=u*2**l;Re(E.edgeResolutions[i]===z),Re(O-1===z);const k=S.localOrigin[0]-a[0],q=S.localOrigin[1]-a[1],B=S.localOrigin[2]-a[2],J=s.getEdgeFirstVertexIndex(e),W=b.position,Y=W.typedBuffer,le=W.typedBufferStride,D=b.normalCompressed,I=D.typedBuffer,F=D.typedBufferStride,G=b.uv0,H=A.vertexAttributes,Z=A.getEdgeFirstVertexIndex(i),te=H.position.typedBuffer,me=H.position.typedBufferStride,Me=H.normalCompressed.typedBuffer,it=H.normalCompressed.typedBufferStride;for(let Et=1;Et<h-1;++Et){const St=J+Et,ht=Z+(L+Et),Ke=St*le,je=ht*me,_r=te[je]+k,Cr=te[je+1]+q,Ni=te[je+2]+B;Y[Ke]=_r,Y[Ke+1]=Cr,Y[Ke+2]=Ni,od(_r,Cr,Ni,p);const Ue=St*F,pr=ht*it;I[Ue]=Me[pr],I[Ue+1]=Me[pr+1];const Oe=Et/u,Ve=c?w:we(Oe,f,_),xt=c?we(Oe,g,v):x;ef(G,St,Ve,xt)}}function P4e(t){var Ni;const{geometry:e,geometryState:r,localOrigin:i,tile:n}=t,{clippingArea:s,samplerData:o}=r,{minu:a,minv:l,maxu:c,maxv:u,boundingBox:h,vertexAttributes:p}=e,{surface:f,ellipsoid:g,extent:_,extentInRadians:v,horizontalScale:b}=n,w=((Ni=f.view)==null?void 0:Ni.viewingMode)==="local",x=g.radius;let S=0,E=0,A=0;const O=(Ue,pr,Oe)=>{const Ve=v[pr===0?1:3],xt=v[Ue===0?0:2],zt=Math.cos(Ve),We=Math.sin(Ve),At=Math.sin(xt),Ie=Math.cos(xt),et=x+Oe;S=Ie*zt*et,E=At*zt*et,A=We*et},L=w?(()=>{const Ue=s,pr=Ue!=null&&(_[3]>Ue[3]||_[2]>Ue[2]||_[1]<Ue[1]||_[0]<Ue[0]),Oe=w4e(f.isWebMercatorOnPlateCarree,x,b);return(Ve,xt,zt)=>{const We=Ve===0?_[0]:_[2],At=xt===0?_[1]:_[3],Ie=pr?we(We,Ue[0],Ue[2]):We,et=pr?we(At,Ue[1],Ue[3]):At,Mt=zt;S=Ie*b,E=Oe(et),A=Mt}})():O;let z=0,k=0,q=0,B=0,J=0,W=0,Y=0,le=0,D=0;const I=w&&f.isWebMercatorOnPlateCarree,F=(Ue,pr,Oe,Ve,xt)=>{let zt=0,We=0,At=0;if(w){const Ie=pr*b,et=I?(Math.PI/2-2*Math.atan(Math.exp(-Oe/x)))*x:Oe*b;zt=Ie-S,We=et-E,At=Ve-A}else{const Ie=Nne(Ue),et=Ue.tile,Mt=et.extent,ui=et.extentInRadians,Gr=(pr-Mt[0])/(Mt[2]-Mt[0]),Mi=(Oe-Mt[1])/(Mt[3]-Mt[1]),Dr=ui[0]*(1-Gr)+ui[2]*Gr,qr=Ie(Mi),fr=Math.cos(qr),Nr=Math.sin(qr),vr=Math.sin(Dr),Jr=Math.cos(Dr),Ct=x+Ve;zt=Jr*fr*Ct-S,We=vr*fr*Ct-E,At=Nr*Ct-A}switch(xt){case 0:Y+=zt,le+=We,D+=At;break;case 1:B-=zt,J-=We,W-=At;break;case 2:Y-=zt,le-=We,D-=At;break;case 3:B+=zt,J+=We,W+=At}},G=s??zne,H=_[0],Z=_[2],te=_[1],me=_[3],Me=[me>G[3],Z>G[2],te<G[1],H<G[0]],it=Math.max(H,G[0]),Et=Math.min(Z,G[2]),St=Math.max(te,G[1]),ht=Math.min(me,G[3]),Ke=Ue=>Math.max(G[0],Math.min(G[2],Ue)),je=Ue=>Math.max(G[1],Math.min(G[3],Ue)),_r=Ue=>{const pr=r.cornerNeighborCornerTiles;z=0,k=0,q=1,B=0,J=0,W=0,Y=0,le=0,D=0;let Oe=1/0;for(let Ie=0;Ie<4;++Ie){const et=pr[4*Ue+Ie];Oe=Math.min(Oe,(et==null?void 0:et.level)??1/0)}for(let Ie=0;Ie<4;++Ie){const et=pr[4*Ue+Ie];bA[Ie]=(et==null?void 0:et.level)===Oe?et:null}let Ve=1,xt=0;for(let Ie=0;Ie<4;++Ie){const et=bA[Ie];et&&(Ve=Math.max(Ve,et==null?void 0:et.renderData.geometryState.numVerticesPerSide),xt=et.extent[2]-et.extent[0])}const zt=xt,We=Ve;Re(We>1);const At=zt/We;for(let Ie=0;Ie<4;++Ie){const et=bA[(Ie+3)%4],Mt=bA[Ie%4];if(!et&&!Mt)continue;const ui=Ie===0?1:Ie===1?2:Ie===2?3:0,Gr=Ie===0?2:Ie===1?3:Ie===2?0:1;if(et&&Mt){const Mi=aj[Ie][0]*At,Dr=aj[Ie][1]*At,qr=et.extent,fr=Ke(qr[ui===0||ui===1?2:0]+Mi),Nr=je(qr[ui===0||ui===3?3:1]+Dr),vr=Mt.extent,Jr=Ke(vr[Gr===0||Gr===1?2:0]+Mi),Ct=je(vr[Gr===0||Gr===3?3:1]+Dr),or=et.renderData,br=Mt.renderData,hi=dn(fr,Nr,or.geometryState.samplerData),Kn=dn(Jr,Ct,br.geometryState.samplerData);F(or,fr,Nr,.5*(hi+Kn),Ie)}else{const Mi=et??Mt,Dr=et?ui:Gr,qr=Mi.extent,fr=aj[Ie],Nr=Ke(qr[Dr===0||Dr===1?2:0]+fr[0]*At),vr=je(qr[Dr===0||Dr===3?3:1]+fr[1]*At),Jr=Mi.renderData,Ct=dn(Nr,vr,Jr.geometryState.samplerData);F(Jr,Nr,vr,Ct,Ie)}}if(!w){const Ie=Math.sqrt(S*S+E*E+A*A);z=S/Ie,k=E/Ie,q=A/Ie}if(w||q*q<.999){const Ie=Math.sqrt(B*B+J*J+W*W);B/=Ie,J/=Ie,W/=Ie;const et=Math.sqrt(Y*Y+le*le+D*D);Y/=et,le/=et,D/=et,z=W*le-J*D,k=B*D-W*Y,q=J*Y-B*le;const Mt=1/Math.sqrt(z*z+k*k+q*q);z*=Mt,k*=Mt,q*=Mt}},Cr=r.cornerNeighborCornerTiles;for(let Ue=0;Ue<4;++Ue){const pr=Ue,Oe=(Ue+1)%4,Ve=Ue===0||Ue===1?1:0,xt=Ue===0||Ue===3?1:0,zt=we(Ve,a,c),We=we(xt,l,u),At=e.getEdgeFirstVertexIndex(pr),Ie=e.getEdgeCount(pr),et=Ue===0||Ue===3?Ie-1:0,Mt=e.getEdgeFirstVertexIndex(Oe),ui=e.getEdgeCount(Oe),Gr=Ue===0||Ue===1?ui-1:0;let Mi=-1;for(let fr=0;fr<4;++fr){const Nr=Cr[4*Ue+fr],vr=Cr[4*Ue+Mi];Nr&&(Mi===-1||H0(vr,Nr)>0)&&(Mi=fr)}const Dr=Mi,qr=Cr[4*Ue+Dr];if(qr!==n){const fr=n.level-qr.level,Nr=2**fr,vr=[qr.lij[0]+fr,qr.lij[1]*Nr,qr.lij[2]*Nr],Jr=[vr[1]+Nr===n.lij[1],Ue===0&&(Dr===1||Dr===0&&qr!==Cr[4*Ue+3])||Ue===1&&(Dr===0||Dr===1&&qr!==Cr[4*Ue+2]),vr[1]===n.lij[1]+1,Ue===2&&(Dr===3||Dr===2&&qr!==Cr[4*Ue+1])||Ue===3&&(Dr===2||Dr===3&&qr!==Cr[4*Ue+0])],Ct=Jr.reduce((ur,Fi)=>ur+(Fi?1:0),0);Re(Ct===1||Ct===2);let or=-1,br=-1;const hi=qr.renderData;if(Ct===1){const ur=Jr.findIndex(Pn=>Pn);Re(0<=ur&&ur<=3),or=(ur+2)%4;const Fi=r.edgeResolutions[ur];br=n.getNeighborEdgeStartVertexIndex(ur,qr)*Fi+Fi*(ur===0&&Ue===0||ur===1&&Ue===0||ur===2&&Ue===1||ur===3&&Ue===3?1:0)}else{Re(Jr[1]||Jr[3]),or=Jr[1]?3:1;const ur=hi.geometryState.edgeResolutions[or];br=Ue===0||Ue===3?0:ur}const Kn=hi.geometry;{const ur=At+et,Fi=Mt+Gr,Pn=Kn.getEdgeFirstVertexIndex(or)+br,So=Kn.vertexAttributes,ja=hi.localOrigin;{const Co=So.position,as=Co.typedBuffer,An=Pn*Co.typedBufferStride,mr=as[An]+ja[0]-i[0],ji=as[An+1]+ja[1]-i[1],ws=as[An+2]+ja[2]-i[2];od(mr,ji,ws,h);const to=p.position,ae=to.typedBuffer;{const jr=ur*to.typedBufferStride;ae[jr]=mr,ae[jr+1]=ji,ae[jr+2]=ws}{const jr=Fi*to.typedBufferStride;ae[jr]=mr,ae[jr+1]=ji,ae[jr+2]=ws}}const Ha=p.uv0;ef(Ha,ur,zt,We),ef(Ha,Fi,zt,We);{const Co=So.normalCompressed.typedBuffer,as=Pn*So.normalCompressed.typedBufferStride,An=p.normalCompressed,mr=An.typedBuffer;{const ji=ur*An.typedBufferStride;mr[ji]=Co[as],mr[ji+1]=Co[as+1]}{const ji=Fi*An.typedBufferStride;mr[ji]=Co[as],mr[ji+1]=Co[as+1]}}}}else{const fr=Me[pr],Nr=Me[Oe];let vr;if(fr||Nr){const br=we(H*(1-Ve)+Z*Ve,it,Et),hi=we(te*(1-xt)+me*xt,St,ht);vr=dn(br,hi,o)}else vr=Z3t(Cr,Ue);L(Ve,xt,vr),_r(Ue);const Jr=S-i[0],Ct=E-i[1],or=A-i[2];od(Jr,Ct,or,h),e.setEdgeVertexFromValuesRawPositionUVNormal(pr,et,Jr,Ct,or,zt,We,z,k,q),e.setEdgeVertexFromValuesRawPositionUVNormal(Oe,Gr,Jr,Ct,or,zt,We,z,k,q)}}for(let Ue=0;Ue<4;++Ue)bA[Ue]=null}function Z3t(t,e){var a,l;const r=4*e,i=Lne.reduce((c,u)=>{var h;return Math.min(c,((h=t[r+u])==null?void 0:h.level)??1/0)},1/0);Ys&&(Re(!t[r+0]||!t[r+2]||OJ(t[r+0],t[r+2],mt.SOUTH_WEST)),Re(!t[r+1]||!t[r+3]||OJ(t[r+1],t[r+3],mt.NORTH_WEST)));let n=0,s=0;for(let c=0;c<4;++c){const u=t[r+c];if(u&&u.level===i){const h=c===0||c===1,p=c===0||c===3,f=u.extent,g=f[h?0:2],_=f[p?1:3],v=(l=(a=u.renderData)==null?void 0:a.geometryState)==null?void 0:l.samplerData;s+=dn(g,_,v),n++}}const o=n?s/n:0;return Re(o!=null),o}function nP(t){const{vao:e,geometry:r}=t,{vertexAttributes:i,edgeVerticesStartIndex:n}=r,s=i.position.typedBuffer;e.vertexBuffers.geometry.setSubData(s,n,n,s.length)}function A4e(t){const{vao:e,geometry:r}=t,{indices:i,indexCount:n,edgeIndicesStartIndex:s}=r;e.indexBuffer.setSubData(i,s,s,n)}const aj=[[0,1],[1,0],[0,-1],[-1,0]],Io=new FEt,zne=o9(-1/0,-1/0,1/0,1/0),bA=[null,null,null,null];function M4e(t,e,r){if(!e)return!1;const i=H0(t,e);return i>0||i===0&&r>=2}let b4=class{constructor(){this.vertex0Index=0,this.stride=1,this.count=0}getVertexIndex(e){return Re(0<=e&&e<this.count),this.vertex0Index+this.stride*e}};const Une=[new b4,new b4,new b4,new b4];function od(t,e,r,i){t<i[0]?i[0]=t:t>i[3]&&(i[3]=t),e<i[1]?i[1]=e:e>i[4]&&(i[4]=e),r<i[2]?i[2]=r:r>i[5]&&(i[5]=r)}function O4e(t){const{edgeResolutions:e,numVerticesPerSide:r}=t,i=1+Math.max(...e);return Math.max(r,i)}function R4e(t,e,r,i,n,s){const o=t*n,a=s[o],l=s[o+1],c=s[o+2],u=e*n,h=s[u],p=s[u+1],f=s[u+2],g=r*n,_=s[g],v=s[g+1],b=s[g+2],w=i*n,x=s[w],S=s[w+1],E=s[w+2];return(h-x)*(h-x)+(p-S)*(p-S)+(f-E)*(f-E)>(a-_)*(a-_)+(l-v)*(l-v)+(c-b)*(c-b)}function CC(t,e,r,i,n){t[e]=r,t[e+1]=i,t[e+2]=i,t[e+3]=n,t[e+4]=n,t[e+5]=r}const DF=6;let J3t=class extends One{constructor(e,r,i,n,s){super(),this._horizontalScaleFactor=1,this._extentInRenderSR=Wt(),this._baseUsedMemory=900,this.init(e,r,i,n,s)}init(e,r,i,n,s){super.init(e,r,i,n,s);const o=s.view.renderSpatialReference,a=s.spatialReference,l=o!=null&&h$(o)&&a!=null&&a.isGeographic?this.ellipsoid.radius*Math.PI/180:1;this._horizontalScaleFactor=l;const{isWebMercatorOnPlateCarree:c}=s,u=this._extentInRenderSR,h=this.extent;if(c){const p=Ce(h[0],h[1],0);ka(p,lt.WebMercator,p,lt.PlateCarree);const f=Ce(h[2],h[3],0);ka(f,lt.WebMercator,f,lt.PlateCarree),u[0]=p[0],u[1]=p[1],u[2]=f[0],u[3]=f[1]}else for(let p=0;p<4;++p)u[p]=h[p]*l;this.centerAtSeaLevel[0]=.5*(u[0]+u[2]),this.centerAtSeaLevel[1]=.5*(u[1]+u[3]),this.centerAtSeaLevel[2]=0,this._edgeLen=Math.max(u[2]-u[0],u[3]-u[1]),this._edgeLen2=this._edgeLen*this._edgeLen,this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateCenter();const e=this._extentInRenderSR,r=.5*(e[2]-e[0]),i=.5*(e[3]-e[1]),n=Math.sqrt(r*r+i*i),s=.5*(this.elevationBoundsMax-this.elevationBoundsMin),o=Math.max(n,s);this._center[is.MIDDLE][3]=o}_calculateFrustumVisibilityStatus(e){const r=this._aabb(),i=r[0],n=r[1],s=r[2],o=r[3],a=r[4],l=r[5];let c=!0;for(let u=0;u<6;u++){const h=e[u],p=h[0],f=h[1],g=h[2],_=h[3];if(p*(p>0?i:o)+f*(f>0?n:a)+g*(g>0?s:l)+_>=0)return Pa.OUTSIDE;c=c&&p*(p<0?i:o)+f*(f<0?n:a)+g*(g<0?s:l)+_<=0}return c?Pa.INSIDE:Pa.INTERSECTS}_aabb(){const e=this._extentInRenderSR;return $et(e[0],e[1],this.elevationBoundsMin,e[2],e[3],this.elevationBoundsMax)}intersectsRay(e,r,i,n){return w4[0]=1/r[0],w4[1]=1/r[1],w4[2]=1/r[2],Xre(this._aabb(),e,w4,i,n)}createGeometry(){z3t(this.renderData,this._horizontalScaleFactor),this.setMemoryDirty()}getDefaultVerticesPerSide(){return this.level<9?3:2}updateCornerElevations(){B3t(this.renderData,this._horizontalScaleFactor)}updateEdgeElevations(){G3t(this.renderData,this._horizontalScaleFactor)}updateEdgeElevationsAndResolutions(){V3t(this.renderData,this._horizontalScaleFactor)}get horizontalScale(){return this._horizontalScaleFactor}};const w4=C();let Q3t=class{constructor(){this.extent=Zt(),this.minLevel=0,this.maxLevel=0,this.callback=null}},NF=class extends Ae{constructor(){super(...arguments),this._queries=new Vt({initialSize:10}),this._queriesInvPtr=0,this._queryQueue=new Vt({initialSize:30}),this._queryPool=new ua(Q3t)}queryVisibleLevelRange(e,r,i,n){const s=this._queryPool.acquire();Kh(s.extent,e),s.minLevel=r??-Number.MAX_VALUE,s.maxLevel=i??Number.MAX_VALUE,s.callback=n,this._queryQueue.push(s),this.notifyChange("updating")}get updating(){return this._queryQueue.length!==0}prepare(){for(;this._queries.length<this._queries.data.length&&this._queryQueue.length>0;){const e=this._queryQueue.pop();this._queries.push(e)}this._queriesInvPtr=this._queries.length}process(){for(let e=0;e<this._queries.length;e++){const r=this._queries.data[e];this._queryPool.release(r),r.callback(e>=this._queriesInvPtr),r.callback=null}this._queries.clear(),this.notifyChange("updating")}queriesForTile(e){const r=e.level;let i=0;for(;i<this._queriesInvPtr;){const n=this._queries.data[i],s=n.extent;r>=n.minLevel&&r<=n.maxLevel&&s[0]<=e.extent[2]&&s[2]>=e.extent[0]&&s[1]<=e.extent[3]&&s[3]>=e.extent[1]?(this._queries.swapElements(i,this._queriesInvPtr-1),this._queriesInvPtr--):i++}}};d([m()],NF.prototype,"updating",null),NF=d([V("esri.views.3d.terrain.ScaleRangeQueries")],NF);function K3t(t,e,r,i){const n=Math.cos(r);t[0]=Math.cos(e)*n*i,t[1]=Math.sin(e)*n*i,t[2]=Math.sin(r)*i}let ePt=class extends One{constructor(e,r,i,n,s){super(),this._convexHull=new Array(24),this._boundingSphere=Jn(),this._baseUsedMemory=1816,this.init(e,r,i,n,s)}init(e,r,i,n,s){super.init(e,r,i,n,s);const o=this.ellipsoid.radius,a=this.extentInRadians[0],l=this.extentInRadians[1],c=this.extentInRadians[2],u=this.extentInRadians[3],h=Rt(l,u,.5),p=Rt(a,c,.5),f=e===0?0:Math.min(Math.abs(l),Math.abs(u));this._edgeLen=(c-a)*Math.cos(f)*o,this._edgeLen2=this._edgeLen*this._edgeLen,this._curvatureHeight=o-Math.sqrt(o*o-this._edgeLen2/4),K3t(this.centerAtSeaLevel,p,h,this.ellipsoid.radius),pe(this.up,this.centerAtSeaLevel),this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateBoundingVolumes();const e=this._center;if(this.lij[0]===0)ie(e[is.MIDDLE],0,0,0),ie(e[is.TOP],0,0,0),ie(e[is.BOTTOM],0,0,0),e[is.MIDDLE][3]=this.ellipsoid.radius+this.elevationBoundsMax;else{this._updateCenter();const r=e[is.MIDDLE],i=this.convexHull;let n=0;for(let s=0;s<8;++s)n=Math.max(n,tPt(r,i,3*s));e[is.MIDDLE][3]=Math.sqrt(n)}}_calculateFrustumVisibilityStatus(e){if(!P1(e,this._boundingSphere))return Pa.OUTSIDE;if(this.lij[0]<10)return Pa.INTERSECTS;const r=this.convexHull,i=this.surface.view.state.camera.near;let n=!0;for(let s=0;s<q3;s++){const o=s===si.NEAR,a=e[s],l=a[0],c=a[1],u=a[2],h=a[3]-(o?i:0);let p=!1;for(let f=0;f<8;++f){const g=3*f;if(l*r[g]+c*r[g+1]+u*r[g+2]+h<0){if(p=!0,!n)break}else n=!1}if(!p)return Pa.OUTSIDE}return n?Pa.INSIDE:Pa.INTERSECTS}computeElevationBounds(){super.computeElevationBounds(),this._updateBoundingVolumes()}createGeometry(){R3t(this.renderData,this._getPatchType()),this._updateBoundingVolumes(),this.setMemoryDirty()}_updateBoundingVolumes(){this._updateConvexHull(),this._updateBoundingSphere(),Ys&&this._checkBVs()}_updateBoundingSphere(){const e=this._boundingSphere,r=e,i=this.elevationBoundsMin,n=this.elevationBoundsMax,s=this.ellipsoid.radius,o=n;if(this.level===0)ie(r,0,0,0),e[3]=s+o;else{const a=this.extentInRadians,l=.5*(a[0]+a[2]),c=a[1],u=a[3];Lb(a0e,l,c,s),Lb(l0e,l,u,s),fe(r,a0e,l0e),ne(r,r,(s+.5*(i+n))/Pc(r));const h=this.convexHull;let p=0;const f=(_,v)=>{const b=_[0]-h[3*v],w=_[1]-h[3*v+1],x=_[2]-h[3*v+2];return Math.sqrt(b*b+w*w+x*x)};for(let _=0;_<8;++_){const v=f(r,_);p=Math.max(p,v)}const g=p;e[3]=g+2}}_updateConvexHull(){const e=this.extentInRadians,r=this.ellipsoid.radius;if(this.level===0)return;const i=this.elevationBoundsMin,n=this.elevationBoundsMax,s=this._getPatchType(),o=this.surface.isWebMercator,a=o&&s===jh.HAS_NORTH_POLE,l=o&&s===jh.HAS_SOUTH_POLE,c=l||a,u=Math.PI/2,h=e[0],p=e[2],f=l?-u:e[1],g=a?u:e[3],_=.5*(h+p),v=i,b=r+(c?Math.min(0,v-1):v),w=(D,I,F)=>Lb(D,I,F,b),x=C(),S=C(),E=C(),A=C();w(x,h,f),w(S,h,g),w(E,p,g),w(A,p,f);const O=(D,I)=>{for(let F=0;F<3;++F)this._convexHull[3*I+F]=D[F]};O(x,0),O(S,1),O(E,2),O(A,3);const L=n,z=r+(c?Math.max(0,L+1):L),k=C(),q=C(),B=C();Lb(q,_,g,b),Lb(B,_,f,b),fe(k,q,B),pe(k,k);const J=C(),W=C(),Y=(D,I)=>{Yi(W,D,I),pe(W,W);const F=-de(D,J)/de(W,J);Re(F>=0),ne(W,W,F),fe(D,D,W)};if(2**this.lij[0]>2*this.lij[1]){const D=B,I=C();Je(I,o0e,D),pe(I,I),Je(J,D,I),pe(J,J),Re(Hh(de(J,D)/Pc(D),0)),Y(x,S),Y(A,E),O(x,0),O(A,3)}else if(2**this.lij[0]!==2*this.lij[1]){const D=q,I=C();Je(I,o0e,D),pe(I,I),Je(J,I,D),pe(J,J),Y(S,x),Y(E,A),O(S,1),O(E,2)}const le=(D,I)=>{const F=z/de(I,k);for(let G=0;G<3;++G)this._convexHull[3*D+G]=I[G]*F};le(4,x),le(5,S),le(6,E),le(7,A)}_getPatchType(){const e=this.lij[1],r=e===0,i=e===(1<<this.level)-1;return r?i?jh.HAS_BOTH_POLES:jh.HAS_NORTH_POLE:i?jh.HAS_SOUTH_POLE:jh.REGULAR}intersectsRay(e,r,i,n){const s=this._boundingSphere,o=s[3]+i,a=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],l=s[0]-e[0],c=s[1]-e[1],u=s[2]-e[2],h=(l*r[0]+c*r[1]+u*r[2])/a,p=r[0]*h-l,f=r[1]*h-c,g=r[2]*h-u;return p*p+f*f+g*g<o*o}getDefaultVerticesPerSide(){return this.level<s0e.length?s0e[this.level]+1:2}updateCornerElevations(){N3t(this.renderData),this._updateBoundingVolumes()}updateEdgeElevations(){L3t(this.renderData),this._updateBoundingVolumes()}updateEdgeElevationsAndResolutions(){D3t(this.renderData),this._updateBoundingVolumes()}_checkBVs(){var pr;if(!Ys||this.level<=2)return;const e=this._boundingSphere,r=e[3],i=e,n=C(),s=this.ellipsoid.radius,o=this.elevationBoundsMin,a=this.elevationBoundsMax,l=s+o,c=1,u=0,h=this._center[is.MIDDLE][3],p=this.convexHull,f=(Oe,Ve)=>{for(let xt=0;xt<3;++xt)Oe[xt]=p[3*Ve+xt]};{const Oe=C(),Ve=C(),xt=C(),zt=C(),We=C(),At=(Ie,et,Mt,ui)=>{f(Ve,Ie),f(xt,et),f(zt,Mt),Yi(Ve,Ve,xt),Yi(zt,zt,xt),Je(Oe,Ve,zt),pe(Oe,Oe);const Gr=de(Oe,xt);f(We,ui);const Mi=de(Oe,We),Dr=Math.abs(Mi-Gr);Re(Hh(Dr,0),`Non coplanar ${Ie},${et},${Mt},${ui} diff = ${Dr}`)};At(0,1,2,3),At(4,5,6,7),At(0,1,4,5),At(1,2,5,6),At(2,3,6,7),At(3,0,7,4)}const g=xo(24),_=(Oe,Ve,xt)=>{const zt=4*Oe;for(let We=0;We<3;++We)g[zt+We]=Ve[We];g[zt+3]=xt},v=C(),b=C(),w=C(),x=C(),S=(Oe,Ve,xt,zt)=>{f(v,Ve),f(b,xt),f(w,zt),Yi(v,v,b),pe(v,v),Yi(w,w,b),pe(w,w),Je(x,v,w),pe(x,x);const We=de(x,b);_(Oe,x,We)};S(0,0,1,2),S(1,1,0,4),S(2,1,5,2),S(3,3,2,6),S(4,4,0,3),S(5,4,6,5);const E=1,A=(Oe,Ve,xt,zt)=>{const We=4*Oe;return g[We]*Ve+g[We+1]*xt+g[We+2]*zt-g[We+3]},O=(Oe,Ve,xt,zt)=>A(Oe,Ve,xt,zt)>=-E,L=(Oe,Ve)=>O(Oe,Ve[0],Ve[1],Ve[2]),z=2**this.lij[0]>2*this.lij[1],k=(Oe,Ve,xt)=>Math.sqrt($4e(Oe,Ve,xt,i[0],i[1],i[2]))<r,q=Oe=>k(Oe[0],Oe[1],Oe[2]),B=(Oe,Ve)=>k(Oe[Ve],Oe[Ve+1],Oe[Ve+2]),J=this.extentInRadians,W=.5*(J[0]+J[2]),Y=J[1],le=J[3],D=C(),I=C();Lb(D,W,le,l),Lb(I,W,Y,l);const F=z?"Upper":"Lower";let G=!0;for(let Oe=0;Oe<6;++Oe){for(let Ve=0;Ve<8;++Ve){const xt=3*Ve,zt=O(Oe,p[xt],p[xt+1],p[xt+2]);G&&(G=zt),Re(zt,`Tile[${this.lij}] Convex hull point ${Ve} outside of plane ${Oe}`)}Re(L(Oe,I),`Tile[${this.lij}] (${F}) bottom mid outside of plane ${Oe}`),Re(L(Oe,D),`Tile[${this.lij}] (${F}) top mid outside of plane ${Oe}`)}Re(G,"Not all convex hull points are inside  convex hull polyhedron"),Re(q(I),`Tile[${this.lij}] (${F}) bottom mid outside of bounding sphere`),Re(q(D),`Tile[${this.lij}] (${F}) top mid outside of bounding sphere`);for(let Oe=0;Oe<8;++Oe){const Ve=B(p,3*Oe);Re(Ve,`Tile[${this.lij}] Convex hull point ${Oe} outside of bounding sphere`)}for(let Oe=0;Oe<6;++Oe)for(let Ve=0;Ve<8;++Ve){const xt=3*Ve;O(Oe,p[xt],p[xt+1],p[xt+2])||console.error(`Tile[${this.lij}] Convex hull point ${Ve} outside of plane ${Oe}`)}const{extentInRadians:H}=this,Z=Math.max(H[2]-H[0],H[3]-H[1]),te=Math.round(Z*s),{renderData:me}=this;if(!me)return;const{geometry:Me,geometryState:it,localOrigin:Et}=me,St=(pr=Me.vertexAttributes)==null?void 0:pr.position;if(!St)return;const ht=C(),Ke=Me.numVerticesPerSide-2,{indices:je,indexCount:_r,edgeVerticesStartIndex:Cr,poleVerticesStartIndex:Ni}=Me;if(!je)return;const Ue=new Set;for(let Oe=0;Oe<_r;++Oe){const Ve=je[Oe];if(Ue.has(Ve))continue;Ue.add(Ve);const xt=Ve<Ni,zt=Ve>=Cr;let We=!1,At=-1;if(zt){let Ct=Cr;for(let or=0;or<4;++or){const br=it.edgeResolutions[or];if(Ve===Ct||Ve===Ct+br-1){We=!0;break}if(Ct+=br,Ve<Ct){At=or;break}}}const Ie=zt?it.edgePeerNeighbors[At]:null,et=zt&&Ie&&H0(this,Ie)>0;St.getVec(Ve,n),fe(ht,n,Et);const Mt=Pc(ht)-s;let ui=0,Gr=!1;const Mi=o-Mt,Dr=Mt-a,qr=Mi>c,fr=Dr>c,Nr=qr||fr,vr=()=>{const Ct=xt?"internal":zt&&!We?"edge":We?"corner":"pole";return`Tile[${this.lij}].vertex[${Ve}]:${Ct}`+(qr?"(below)":fr?"(above)":"")+(et?"(Neighbor)":"")},Jr=D0(ht,i);if(Jr>=r+u){const Ct=Jr-r;Nr||(console.error(`${vr()} is out of the bounding sphere by ${Ct.toFixed(0)} / ${r.toFixed(0)}[tol=${u}] h=${Mt.toFixed(0)} / [${o.toFixed(0)}..${a.toFixed(0)}] (${(Ct/r).toFixed(0)})`),Gr=!0)}for(let Ct=0;Ct<6;++Ct)if(!O(Ct,ht[0],ht[1],ht[2])){const or=A(Ct,ht[0],ht[1],ht[2]),br=Ve%Ke,hi=(Ve-br)/Ke;Ct===0&&Mi||Ct===5&&Dr||(console.error(`${vr()} (${br},${hi})|${Ke}] is out of the bounding trapezoid plane ${Ct} h=${Math.round(Mt)} / [${Math.round(o)}..${Math.round(a)}] dist=${Math.round(or)} radii = ${Math.round(r)}/${Math.round(h)}} : maxL = ${te}`),++ui)}if(Gr||ui>0)break}}get convexHull(){return this._convexHull}};const s0e=[128,64,64,32,16,8,8,4];function tPt(t,e,r){return $4e(t[0],t[1],t[2],e[r],e[r+1],e[r+2])}function $4e(t,e,r,i,n,s){const o=i-t,a=n-e,l=s-r;return o*o+a*a+l*l}const Lb=(t,e,r,i)=>{const n=Math.cos(e),s=Math.sin(e),o=Math.cos(r),a=Math.sin(r);t[0]=i*o*n,t[1]=i*o*s,t[2]=i*a},o0e=[0,0,1],a0e=C(),l0e=C();let ap=class extends Ae{constructor(){super(...arguments),this.fovX=0,this.fovY=0,this.relativeWidthLimit=0,this.relativeHeightLimit=0,this.maxLod=0,this.angledSplitBias=0,this.aboveGround=!0}};d([m()],ap.prototype,"fovX",void 0),d([m()],ap.prototype,"fovY",void 0),d([m()],ap.prototype,"relativeWidthLimit",void 0),d([m()],ap.prototype,"relativeHeightLimit",void 0),d([m()],ap.prototype,"maxLod",void 0),d([m()],ap.prototype,"angledSplitBias",void 0),d([m()],ap.prototype,"aboveGround",void 0),d([m()],ap.prototype,"frustum",void 0),ap=d([V("esri.views.3d.terrain.SplitLimits")],ap);const rPt=Qi().vec3f(R.POSITION).vec2i16(R.UV0).vec2i16(R.NORMALCOMPRESSED,{glNormalized:!0});let iPt=class{constructor(e){this._storage=new cL((r,i)=>e.newCache(r,i),"TileGeometry")}acquire(e){const i=Math.ceil(e/4)*4,n=this._storage,s=nPt(i),o=n.pop(s);if(o)return o;const a=rPt.createBuffer(i);return a.release=()=>n.put(s,a),a}clear(){this._storage.clear()}destroy(){this._storage.destroy()}};function nPt(t){return t.toString()}let I4e=class extends cc{constructor(){super(...arguments),this.blendMode=Le.Normal}};d([j({count:Le.COUNT})],I4e.prototype,"blendMode",void 0);let LR=class extends I4e{constructor(){super(...arguments),this.output=ds.Composite,this.baseOpacityMode=Ta.NotRequired,this.premultipliedSource=Sp.Off}};d([j({count:ds.COUNT})],LR.prototype,"output",void 0),d([j({count:Ta.COUNT})],LR.prototype,"baseOpacityMode",void 0),d([j()],LR.prototype,"premultipliedSource",void 0);var Av;function L4e(t){const e=new Or;if(e.include(a4e),t.background===Av.Only){const r=t.output===ds.ColorComposite;return r?e.fragment.uniforms.add(new Ft("backgroundColor",i=>i.backgroundColor)):e.fragment.include(Mne),e.fragment.code.add(T`
    void main() {
      fragColor = vec4(${r?T`backgroundColor`:T`gridColor(uv)`}, 1.0);
    }
  `),e}return e.include(l4e,t),e.fragment.uniforms.add(new ct("tex",r=>r.texture)),e.fragment.uniforms.add(new $e("opacity",r=>r.opacity)),e.fragment.code.add(T`void main() {
vec4 bgColor = getBackground(uv);
fragColor = blendLayers(bgColor, texture(tex, uv), opacity);
}`),e}(function(t){t[t.BelowLayer=0]="BelowLayer",t[t.Only=1]="Only",t[t.COUNT=2]="COUNT"})(Av||(Av={}));const sPt=Object.freeze(Object.defineProperty({__proto__:null,get BackgroundMode(){return Av},build:L4e},Symbol.toStringTag,{value:"Module"}));let oPt=class extends o4e{constructor(){super(...arguments),this.opacity=1,this.baseOpacity=1,this.texture=null,this.fboTexture=null,this.backgroundColor=zn}},D4e=class N4e extends Vr{initializeProgram(e){return new Lr(e.rctx,N4e.shader.get().build(this.configuration),Mr)}initializePipeline(){return kt({blending:tu(Se.ONE,Se.ONE_MINUS_SRC_ALPHA),colorWrite:Yt})}};D4e.shader=new Ir(sPt,()=>ge(()=>Promise.resolve().then(()=>n4t),void 0));let F4e=class extends LR{constructor(){super(...arguments),this.background=Av.BelowLayer}};d([j()],F4e.prototype,"background",void 0);let lj=class{constructor(e,r,i,n,s,o){this.texture=e,this.type=r,e.retain(),this.offsetAndScale=Bt(i.offset[0],i.offset[1],i.scale,i.scale),this.opacities=Ce(n,s,o)}destroy(){this.texture.release()}};function DR(){return[1,0,0,1,0,0]}function aPt(t){return[t[0],t[1],t[2],t[3],t[4],t[5]]}function lPt(t,e,r,i,n,s){return[t,e,r,i,n,s]}function cPt(t,e){return new Float64Array(t,e,6)}const uPt=DR();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:uPt,clone:aPt,create:DR,createView:cPt,fromValues:lPt},Symbol.toStringTag,{value:"Module"}));function hPt(t){return t instanceof Float32Array&&t.length>=2}function dPt(t){return Array.isArray(t)&&t.length>=2}function x4(t){return hPt(t)||dPt(t)}const T4={102100:{maxX:20037508342788905e-9,minX:-20037508342788905e-9,plus180Line:new Np({paths:[[[20037508342788905e-9,-20037508342788905e-9],[20037508342788905e-9,20037508342788905e-9]]],spatialReference:lt.WebMercator}),minus180Line:new Np({paths:[[[-20037508342788905e-9,-20037508342788905e-9],[-20037508342788905e-9,20037508342788905e-9]]],spatialReference:lt.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new Np({paths:[[[180,-180],[180,180]]],spatialReference:lt.WGS84}),minus180Line:new Np({paths:[[[-180,-180],[-180,180]]],spatialReference:lt.WGS84})}};function _x(t,e){return Math.ceil((t-e)/(2*e))}function k4e(t,e){const r=NR(t);for(const i of r)for(const n of i)n[0]+=e;return t}function NR(t){return zc(t)?t.rings:t.paths}async function pPt(t,e,r,i){const n=FNe(t),s=e[0].spatialReference,o={...i,responseType:"json",query:{...n.query,f:"json",sr:Zk(s),target:JSON.stringify({geometryType:OI(e[0]),geometries:e}),cutter:JSON.stringify(r)}},a=await Xi(n.path+"/cut",o),{cutIndexes:l,geometries:c=[]}=a.data;return{cutIndexes:l,geometries:c.map(u=>{const h=n2(u);return h.spatialReference=s,h})}}async function fPt(t,e,r){const i=typeof t=="string"?da(t):t,n=e[0].spatialReference,s=OI(e[0]),o={...r,query:{...i.query,f:"json",sr:Zk(n),geometries:JSON.stringify($St(e))}},{data:a}=await Xi(i.path+"/simplify",o);return kNe(a.geometries,s,n)}const z4e=()=>re.getLogger("esri.geometry.support.normalizeUtils");function mPt(t){return t.type==="polygon"}function gPt(t){return t[0].type==="polygon"}function yPt(t){return t[0].type==="polyline"}function _Pt(t,e){if(!(t instanceof Np||t instanceof nf)){const n="straightLineDensify: the input geometry is neither polyline nor polygon";throw z4e().error(n),new K(n)}const r=NR(t),i=[];for(const n of r){const s=[];i.push(s),s.push([n[0][0],n[0][1]]);for(let o=0;o<n.length-1;o++){const a=n[o][0],l=n[o][1],c=n[o+1][0],u=n[o+1][1],h=Math.sqrt((c-a)*(c-a)+(u-l)*(u-l)),p=(u-l)/h,f=(c-a)/h,g=h/e;if(g>1){for(let w=1;w<=g-1;w++){const x=w*e,S=f*x+a,E=p*x+l;s.push([S,E])}const _=(h+Math.floor(g-1)*e)/2,v=f*_+a,b=p*_+l;s.push([v,b])}s.push([c,u])}}return mPt(t)?new nf({rings:i,spatialReference:t.spatialReference}):new Np({paths:i,spatialReference:t.spatialReference})}function c0e(t,e,r){if(e){const i=_Pt(t,1e6);t=IA(i,!0)}return r&&(t=k4e(t,r)),t}function u0e(t,e,r){if(Array.isArray(t)){const i=t[0];if(i>e){const n=_x(i,e);t[0]=i+n*(-2*e)}else if(i<r){const n=_x(i,r);t[0]=i+n*(-2*r)}}else{const i=t.x;if(i>e){const n=_x(i,e);t=t.clone().offset(n*(-2*e),0)}else if(i<r){const n=_x(i,r);t=t.clone().offset(n*(-2*r),0)}}return t}function vPt(t,e){let r=-1;for(let i=0;i<e.cutIndexes.length;i++){const n=e.cutIndexes[i],s=e.geometries[i],o=NR(s);for(let a=0;a<o.length;a++){const l=o[a];l.some(c=>{if(c[0]<180)return!0;{let u=0;for(let p=0;p<l.length;p++){const f=l[p][0];u=f>u?f:u}u=Number(u.toFixed(9));const h=-360*_x(u,180);for(let p=0;p<l.length;p++){const f=s.getPoint(a,p);s.setPoint(a,p,f.clone().offset(h,0))}return!0}})}if(n===r){if(gPt(t))for(const a of NR(s))t[n]=t[n].addRing(a);else if(yPt(t))for(const a of NR(s))t[n]=t[n].addPath(a)}else r=n,t[n]=s}return t}async function bPt(t,e,r){if(!Array.isArray(t))return bPt([t],e);e&&typeof e!="string"&&z4e().warn("normalizeCentralMeridian()","The url object is deprecated, use the url string instead");const i=typeof e=="string"?e:(e==null?void 0:e.url)??mi.geometryServiceUrl;let n,s,o,a,l,c,u,h,p=0;const f=[],g=[];for(const S of t)if(S!=null)if(n||(n=S.spatialReference,s=Xp(n),o=n.isWebMercator,c=o?102100:4326,a=T4[c].maxX,l=T4[c].minX,u=T4[c].plus180Line,h=T4[c].minus180Line),s)if(S.type==="mesh")g.push(S);else if(S.type==="point")g.push(u0e(S.clone(),a,l));else if(S.type==="multipoint"){const E=S.clone();E.points=E.points.map(A=>u0e(A,a,l)),g.push(E)}else if(S.type==="extent"){const E=S.clone()._normalize(!1,!1,s);g.push(E.rings?new nf(E):E)}else if(S.extent){const E=S.extent,A=_x(E.xmin,l)*(2*a);let O=A===0?S.clone():k4e(S.clone(),A);E.offset(A,0),E.intersects(u)&&E.xmax!==a?(p=E.xmax>p?E.xmax:p,O=c0e(O,o),f.push(O),g.push("cut")):E.intersects(h)&&E.xmin!==l?(p=E.xmax*(2*a)>p?E.xmax*(2*a):p,O=c0e(O,o,360),f.push(O),g.push("cut")):g.push(O)}else g.push(S.clone());else g.push(S);else g.push(S);let _=_x(p,a),v=-90;const b=_,w=new Np;for(;_>0;){const S=360*_-180;w.addPath([[S,v],[S,-1*v]]),v*=-1,_--}if(f.length>0&&b>0){const S=vPt(f,await pPt(i,f,w,r)),E=[],A=[];for(let z=0;z<g.length;z++){const k=g[z];if(k!=="cut")A.push(k);else{const q=S.shift(),B=t[z];B!=null&&B.type==="polygon"&&B.rings&&B.rings.length>1&&q.rings.length>=B.rings.length?(E.push(q),A.push("simplify")):A.push(o?z1(q):q)}}if(!E.length)return A;const O=await fPt(i,E,r),L=[];for(let z=0;z<A.length;z++){const k=A[z];k!=="simplify"?L.push(k):L.push(o?z1(O.shift()):O.shift())}return L}const x=[];for(let S=0;S<g.length;S++){const E=g[S];if(E!=="cut")x.push(E);else{const A=f.shift();x.push(o===!0?z1(A):A)}}return x}function wPt(t,e,r){const i=Xp(r);if(i==null)return t;const[n,s]=i.valid,o=2*s;let a=0,l=0;e>s?a=Math.ceil(Math.abs(e-s)/o):e<n&&(a=-Math.ceil(Math.abs(e-n)/o)),t>s?l=Math.ceil(Math.abs(t-s)/o):t<n&&(l=-Math.ceil(Math.abs(t-n)/o));let c=t+(a-l)*o;const u=c-e;return u>s?c-=o:u<n&&(c+=o),c}const xPt=96,TPt=39.37;function Bne(t,e){return e.type?cr(t,e.x,e.y):eo(t,e)}function SPt(t){return Ba(t)}function CPt(t,e){const r=t.targetGeometry,i=e.targetGeometry;return r.x=i.x,r.y=i.y,r.spatialReference=i.spatialReference,t.scale=e.scale,t.rotation=e.rotation,t}const EPt=function(){const t=He();return function(e,r,i){const n=r.targetGeometry;Bne(t,n);const s=.5*nB(r);return e.xmin=t[0]-s*i[0],e.ymin=t[1]-s*i[1],e.xmax=t[0]+s*i[0],e.ymax=t[1]+s*i[1],e.spatialReference=n.spatialReference,e}}();function nB(t){return t.scale*PPt(t.targetGeometry)}function PPt(t){return t!=null&&$m(t.spatialReference)?1/(SPt(t.spatialReference)*TPt*xPt):1}function APt(t){return Zz(t.rotation)||0}const Vne=function(){const t=He(),e=He(),r=He();return function(i,n,s,o,a,l){return Wte(t,n),Uc(e,s,.5*l),cr(r,1/o*l,-1/o*l),Wie(i,e),a&&jie(i,i,a),vLe(i,i,r),Hie(i,i,t),i}}(),MPt=function(){const t=He();return function(e,r,i,n){const s=nB(r),o=APt(r);return Bne(t,r.targetGeometry),Vne(e,t,i,s,o,n)}}(),OPt=function(){const t=He();return function(e,r,i,n){const s=nB(r);return Bne(t,r.targetGeometry),Vne(e,t,i,s,0,n)}}();function RPt(t){const e=Xp(t);return e?e.valid[1]-e.valid[0]:0}function $Pt(t,e){return Math.round(RPt(t)/e)}var RJ;const Qa=[0,0];let B_=RJ=class extends ze{constructor(t){super(t),this._viewpoint2D={center:He(),rotation:0,scale:0,spatialReference:void 0},this.center=[0,0],this.extent=new ei,this.id=0,this.inverseTransform=DR(),this.resolution=0,this.rotation=0,this.scale=0,this.transform=DR(),this.transformNoRotation=DR(),this.displayMat3=Jm(),this.displayViewMat3=Jm(),this.viewMat3=Jm(),this.viewMat2d=wLe(),this.worldScreenWidth=0,this.size=[0,0]}set pixelRatio(t){this._set("pixelRatio",t),this._update()}set size(t){this._set("size",t),this._update()}set viewpoint(t){if(t){const e=this._viewpoint2D,r=t.targetGeometry;e.center[0]=r.x,e.center[1]=r.y,e.rotation=t.rotation,e.scale=t.scale,e.spatialReference=r.spatialReference}this._update()}copy(t){const e=this.size,r=this.viewpoint;return r&&e?(this.viewpoint=CPt(r,t.viewpoint),this._set("size",eo(e,t.size))):(this.viewpoint=t.viewpoint.clone(),this._set("size",[t.size[0],t.size[1]])),this._set("pixelRatio",t.pixelRatio),this}clone(){return new RJ({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})}toMap(t,e,r){return x4(e)?N_(t,e,this.inverseTransform):(Qa[0]=e,Qa[1]=r,N_(t,Qa,this.inverseTransform))}toScreen(t,e,r){return x4(e)?N_(t,e,this.transform):(Qa[0]=e,Qa[1]=r,N_(t,Qa,this.transform))}toScreenNoRotation(t,e,r){return x4(e)?N_(t,e,this.transformNoRotation):(Qa[0]=e,Qa[1]=r,N_(t,Qa,this.transformNoRotation))}toScreenClosest(t,e,r){x4(e)?(Qa[0]=e[0],Qa[1]=e[1]):(Qa[0]=e,Qa[1]=r);const[i]=Qa,{center:n,extent:s,spatialReference:o,transform:a}=this;return(i<s.xmin||i>s.xmax)&&(Qa[0]=wPt(i,n[0],o)),N_(t,Qa,a)}getScreenTransform(t,e){const{center:r}=this._viewpoint2D,i=this._get("pixelRatio")||1,n=this._get("size");return Vne(t,r,n,e,0,i),t}_update(){const{center:t,spatialReference:e,scale:r,rotation:i}=this._viewpoint2D,n=this._get("pixelRatio")||1,s=this._get("size"),o=new sf({targetGeometry:new ke(t[0],t[1],e),scale:r,rotation:i});if(this._set("viewpoint",o),!s||!e||!r)return;this.resolution=nB(o),this.rotation=i,this.scale=r,this.spatialReference=e,eo(this.center,t);const a=s[0]!==0?2/s[0]:0,l=s[1]!==0?-2/s[1]:0;cte(this.displayMat3,a,0,0,0,l,0,-1,1,1);const c=ute(this.viewMat3),u=Gh(s[0]/2,s[1]/2),h=Gh(-s[0]/2,-s[1]/2),p=Zz(i);C6(c,c,u),hte(c,c,p),C6(c,c,h),XE(this.displayViewMat3,this.displayMat3,c);const f=Wie(this.viewMat2d,u);return jie(f,f,p),Hie(f,f,h),EPt(this.extent,o,s),MPt(this.transform,o,s,n),yLe(this.inverseTransform,this.transform),OPt(this.transformNoRotation,o,s,n),this.worldScreenWidth=$Pt(this.spatialReference,this.resolution),this._set("id",this.id+1),this}};d([m({readOnly:!0})],B_.prototype,"id",void 0),d([m({value:1,json:{write:!0}})],B_.prototype,"pixelRatio",null),d([m({json:{write:!0}})],B_.prototype,"size",null),d([m()],B_.prototype,"spatialReference",void 0),d([m({type:sf,json:{write:!0}})],B_.prototype,"viewpoint",null),B_=RJ=d([V("esri.views.2d.ViewState")],B_);const IPt=B_;var $J,Kw,IJ,W8,LJ,q8,DJ,ex,NJ;(function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.FILL=1]="FILL",t[t.LINE=2]="LINE",t[t.SYMBOL=3]="SYMBOL",t[t.CIRCLE=4]="CIRCLE"})($J||($J={})),function(t){t[t.VISIBLE=0]="VISIBLE",t[t.NONE=1]="NONE"}(Kw||(Kw={})),function(t){t[t.POINT=0]="POINT",t[t.LINE=1]="LINE",t[t.LINE_CENTER=2]="LINE_CENTER"}(IJ||(IJ={})),function(t){t[t.MAP=0]="MAP",t[t.VIEWPORT=1]="VIEWPORT",t[t.AUTO=2]="AUTO"}(W8||(W8={})),function(t){t[t.AUTO=0]="AUTO",t[t.LEFT=1]="LEFT",t[t.CENTER=2]="CENTER",t[t.RIGHT=3]="RIGHT"}(LJ||(LJ={})),function(t){t[t.CENTER=0]="CENTER",t[t.LEFT=1]="LEFT",t[t.RIGHT=2]="RIGHT",t[t.TOP=3]="TOP",t[t.BOTTOM=4]="BOTTOM",t[t.TOP_LEFT=5]="TOP_LEFT",t[t.TOP_RIGHT=6]="TOP_RIGHT",t[t.BOTTOM_LEFT=7]="BOTTOM_LEFT",t[t.BOTTOM_RIGHT=8]="BOTTOM_RIGHT"}(q8||(q8={})),function(t){t[t.NONE=0]="NONE",t[t.UPPERCASE=1]="UPPERCASE",t[t.LOWERCASE=2]="LOWERCASE"}(DJ||(DJ={})),function(t){t[t.MAP=0]="MAP",t[t.VIEWPORT=1]="VIEWPORT"}(ex||(ex={})),function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL"}(NJ||(NJ={}));let jd=class{};jd.backgroundLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:Kw.VISIBLE}},jd.fillLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:Kw.VISIBLE}},jd.lineLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:Kw.VISIBLE},"line-cap":{type:"enum",values:["butt","round","square"],default:WZ.BUTT},"line-join":{type:"enum",values:["bevel","round","miter"],default:qZ.MITER},"line-miter-limit":{type:"number",default:2},"line-round-limit":{type:"number",default:1.05}},jd.symbolLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:Kw.VISIBLE},"symbol-avoid-edges":{type:"boolean",default:!1},"symbol-placement":{type:"enum",values:["point","line","line-center"],default:IJ.POINT},"symbol-sort-key":{type:"number",default:-1},"symbol-spacing":{type:"number",minimum:1,default:250},"icon-allow-overlap":{type:"boolean",default:!1},"icon-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:q8.CENTER},"icon-ignore-placement":{type:"boolean",default:!1},"icon-image":{type:"string"},"icon-keep-upright":{type:"boolean",default:!1},"icon-offset":{type:"array",value:"number",length:2,default:[0,0]},"icon-optional":{type:"boolean",default:!1},"icon-padding":{type:"number",minimum:0,default:2},"icon-rotate":{type:"number",default:0},"icon-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:W8.AUTO},"icon-size":{type:"number",minimum:0,default:1},"text-allow-overlap":{type:"boolean",default:!1},"text-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:q8.CENTER},"text-field":{type:"string"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"]},"text-ignore-placement":{type:"boolean",default:!1},"text-justify":{type:"enum",values:["auto","left","center","right"],default:LJ.CENTER},"text-keep-upright":{type:"boolean",default:!0},"text-letter-spacing":{type:"number",default:0},"text-line-height":{type:"number",default:1.2},"text-max-angle":{type:"number",minimum:0,default:45},"text-max-width":{type:"number",minimum:0,default:10},"text-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-optional":{type:"boolean",default:!1},"text-padding":{type:"number",minimum:0,default:2},"text-rotate":{type:"number",default:0},"text-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:W8.AUTO},"text-size":{type:"number",minimum:0,default:16},"text-transform":{type:"enum",values:["none","uppercase","lowercase"],default:DJ.NONE},"text-writing-mode":{type:"array",value:"enum",values:["horizontal","vertical"],default:[NJ.HORIZONTAL]}},jd.circleLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:Kw.VISIBLE}},jd.backgroundPaintDefinition={"background-color":{type:"color",default:[0,0,0,1]},"background-opacity":{type:"number",minimum:0,maximum:1,default:1},"background-pattern":{type:"string"}},jd.fillPaintDefinition={"fill-antialias":{type:"boolean",default:!0},"fill-color":{type:"color",default:[0,0,0,1]},"fill-opacity":{type:"number",minimum:0,maximum:1,default:1},"fill-outline-color":{type:"color",default:[0,0,0,0]},"fill-pattern":{type:"string"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0]},"fill-translate-anchor":{type:"enum",values:["map","viewport"],default:ex.MAP}},jd.linePaintDefinition={"line-blur":{type:"number",minimum:0,default:0},"line-color":{type:"color",default:[0,0,0,1]},"line-dasharray":{type:"array",value:"number",default:[]},"line-gap-width":{type:"number",minimum:0,default:0},"line-offset":{type:"number",default:0},"line-opacity":{type:"number",minimum:0,maximum:1,default:1},"line-pattern":{type:"string"},"line-translate":{type:"array",value:"number",length:2,default:[0,0]},"line-translate-anchor":{type:"enum",values:["map","viewport"],default:ex.MAP},"line-width":{type:"number",minimum:0,default:1}},jd.symbolPaintDefinition={"icon-color":{type:"color",default:[0,0,0,1]},"icon-halo-blur":{type:"number",minimum:0,default:0},"icon-halo-color":{type:"color",default:[0,0,0,0]},"icon-halo-width":{type:"number",minimum:0,default:0},"icon-opacity":{type:"number",minimum:0,maximum:1,default:1},"icon-translate":{type:"array",value:"number",length:2,default:[0,0]},"icon-translate-anchor":{type:"enum",values:["map","viewport"],default:ex.MAP},"text-color":{type:"color",default:[0,0,0,1]},"text-halo-blur":{type:"number",minimum:0,default:0},"text-halo-color":{type:"color",default:[0,0,0,0]},"text-halo-width":{type:"number",minimum:0,default:0},"text-opacity":{type:"number",minimum:0,maximum:1,default:1},"text-translate":{type:"array",value:"number",length:2,default:[0,0]},"text-translate-anchor":{type:"enum",values:["map","viewport"],default:ex.MAP}},jd.rasterPaintDefinition={"raster-opacity":{type:"number",minimum:0,maximum:1,default:1},"raster-hue-rotate":{type:"number",default:0},"raster-brightness-min":{type:"number",minimum:0,maximum:1,default:0},"raster-brightness-max":{type:"number",minimum:0,maximum:1,default:1},"raster-saturation":{type:"number",minimum:-1,maximum:1,default:0},"raster-contrast":{type:"number",minimum:-1,maximum:1,default:0},"raster-fade-duration":{type:"number",minimum:0,default:300}},jd.circlePaintDefinition={"circle-blur":{type:"number",minimum:0,default:0},"circle-color":{type:"color",default:[0,0,0,1]},"circle-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-radius":{type:"number",minimum:0,default:5},"circle-stroke-color":{type:"color",default:[0,0,0,1]},"circle-stroke-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-stroke-width":{type:"number",minimum:0,default:0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0]},"circle-translate-anchor":{type:"enum",values:["map","viewport"],default:ex.MAP}};let LPt=class extends WNe{_createTransforms(){return{displayViewScreenMat3:Jm(),tileMat3:Jm()}}},DPt=class{constructor(){this._candidateTiles=[]}schedule(e){this._candidateTiles.includes(e)||this._candidateTiles.push(e)}reshuffle(e){const r=[];for(const i of this._candidateTiles)e>0?(i.reshuffle(),e--):r.push(i);this._candidateTiles=r}};const NPt=.125;let FPt=class{constructor(){this._renderParams={reshuffleManager:new DPt,context:null,drawPhase:1,state:new IPt({viewpoint:new sf({targetGeometry:new ke(0,0),scale:1,rotation:0}),size:[256,256]}),stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,requestRender:null,allowDelayedRender:!1,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1,highlightGradient:null,stencilSymbols:!0,is3D:!0,backgroundColor:null},this._backgroundTile=new LPt(new uy(0,0,0,0),0,0,0,512,512,4096,4096)}dispose(){this._renderParams=null}renderBackground(e,r,i,n,s,o,a,l,c,u){const h=this._backgroundTile;this._updateRenderParameters(e,r,h,i,s,o,a,l,c,u),this._renderParams.stencilSymbols=!1,i.drawBackground(this._renderParams,h,n)}renderContent(e,r,i,n,s,o,a,l,c,u,h,p){this._stencilSymbols(e,r,i,n,s,o,a,Math.round(1/l),c,u,h,p);let f=1;i.stencilRef=f++,e.setStencilFunction(Xr.EQUAL,i.stencilRef,255),this._render(e,r,i,s,o,a,l,c,u,h,p),n.forAll(g=>{g.sourceLayerInfo.data.stencilRef=f++,this._renderSymbols(e,g.sourceLod,g.sourceLayerInfo.data,s,o,a,Math.round(1/l),g.offset,u,h,p)})}_stencilSymbols(e,r,i,n,s,o,a,l,c,u,h,p){let f=1;i.stencilRef=f++,e.setDepthTestEnabled(!1),e.setDepthWriteEnabled(!1),e.setStencilTestEnabled(!0),e.setBlendingEnabled(!1),e.setColorMask(!1,!1,!1,!1),e.setStencilOp(cn.KEEP,cn.KEEP,cn.REPLACE),e.setStencilWriteMask(255),e.setStencilFunction(Xr.ALWAYS,i.stencilRef,255),this._stencilTileSymbols(e,r,i,s,o,a,l,c,u,h,p);for(const g of n.toArray()){const{sourceLod:_,offset:v,sourceLayerInfo:b}=g;b.data.stencilRef=f++,e.setStencilFunction(Xr.ALWAYS,b.data.stencilRef,255),this._stencilTileSymbols(e,_,b.data,s,o,a,l,v,u,h,p)}e.setStencilWriteMask(0),e.setBlendingEnabled(!0),e.setDepthTestEnabled(!0),e.setColorMask(!0,!0,!0,!0)}_renderSymbols(e,r,i,n,s,o,a,l,c,u,h){e.setStencilFunction(Xr.EQUAL,i.stencilRef,255),this._render(e,r,i,n,s,o,a,l,c,u,h,$J.SYMBOL)}_render(e,r,i,n,s,o,a,l,c,u,h,p){this._updateRenderParameters(e,r,i,n,o,a,l,c,u,h),this._renderParams.stencilSymbols=!1,n.drawTile(this._renderParams,i,s,p)}_stencilTileSymbols(e,r,i,n,s,o,a,l,c,u,h){this._updateRenderParameters(e,r,i,n,o,a,l,c,u,h),this._renderParams.stencilSymbols=!0,i.triangleCount=0,n.drawSymbols(this._renderParams,i,s)}_updateRenderParameters(e,r,i,n,s,o,a,l,c,u){"type"in i&&i.type==="vector-tile"&&!i.stage&&i.attachWithContext(e);const h=r[0]-s.getLevelShift(r[0]),p=this._renderParams;p.context=e,p.painter=n,p.glyphMosaic=n.glyphMosaic,p.spriteMosaic=n.spriteMosaic,p.pixelRatio=c*u,p.displayLevel=h,p.requiredLevel=h;const f=s.getScale(r[0]),[g,_]=s.getOffset(r,o*f),v=NPt*o*f/l,b=i.transforms.displayViewScreenMat3;b[0]=v,b[4]=-v,b[6]=-1-g-a[0]*o*2,b[7]=1+_+(1-a[1])*o*2-2,p.state.size[0]=l/u,p.state.size[1]=l/u,p.state.pixelRatio=u}},U4e=class B4e extends Vr{initializeProgram(e){return new Lr(e.rctx,B4e.shader.get().build(this.configuration),Mr)}initializePipeline(){return kt({blending:tu(Se.ONE,Se.ONE_MINUS_SRC_ALPHA),colorWrite:Yt})}};U4e.shader=new Ir(i3t,()=>ge(()=>Promise.resolve().then(()=>s4t),void 0));let mO=class extends LR{constructor(){super(...arguments),this.colorizerType=zx.Stretch,this.stretchType=x2.Noop,this.applyColormap=!0,this.requireBilinearWithNN=!1}};d([j({count:zx.COUNT})],mO.prototype,"colorizerType",void 0),d([j({count:x2.COUNT})],mO.prototype,"stretchType",void 0),d([j()],mO.prototype,"applyColormap",void 0),d([j()],mO.prototype,"requireBilinearWithNN",void 0);let h0e=class{constructor(e){this._rctx=e,this._fbos=new Map}get(e){return this._getPool(e)}dispose(){this._fbos.forEach(e=>e.dispose()),this._fbos.clear()}_getPool(e){const r=this._fbos.get(e);if(r)return r;const i=new bf(this._rctx,new ri(e),new uAe(ia.DEPTH24_STENCIL8,e));return this._fbos.set(e,i),i}};const kPt=()=>re.getLogger("esri.views.3d.terrain");let zPt=class{constructor(e,r){this._rctx=e,this._techniqueRepository=r,this._fbos=[],this._vectorTileHelper=new FPt,this._bindParameters=new nU(null,null),this._blendLayersTechniqueConfig=new F4e,this._current=0,this._lastUsedIds=new Array,this._lastCreatedBufferId=0,this._onHoldIds=new Array,this._vaoQuad=wg(this._rctx,GI)}dispose(){this._fbos.forEach(gt),this._fbos=null,this._vtFBO=gt(this._vtFBO),this._vaoQuad=gt(this._vaoQuad),this._vectorTileHelper=gt(this._vectorTileHelper),this._backgroundTechnique=tr(this._backgroundTechnique),this._applyOpacityTechnique=tr(this._applyOpacityTechnique),this._blendLayersTechnique=tr(this._blendLayersTechnique)}_getBlendLayersTechnique(e,r,i,n=Sp.Off,s=Av.BelowLayer){return this._blendLayersTechniqueConfig.output=r,this._blendLayersTechniqueConfig.blendMode=e,this._blendLayersTechniqueConfig.baseOpacityMode=i,this._blendLayersTechniqueConfig.premultipliedSource=n,this._blendLayersTechniqueConfig.background=s,this._blendLayersTechnique=this._techniqueRepository.releaseAndAcquire(D4e,this._blendLayersTechniqueConfig,this._blendLayersTechnique),this._blendLayersTechnique}drawBackground(e,r){const i=this._getBlendLayersTechnique(Le.Normal,r?ds.ColorComposite:ds.GridComposite,Ta.NotRequired,Sp.Off,Av.Only),n=this._rctx.bindTechnique(i,this._bindParameters,e);this._render(n)}_render(e){this._rctx.bindVAO(this._vaoQuad),e.assertCompatibleVertexAttributeLocations(this._vaoQuad),this._rctx.drawArrays(sr.TRIANGLE_STRIP,0,k0(this._vaoQuad,"geometry"))}drawGroup(e,r,i,n,s=Sp.On){r===ds.Composite&&(e.fboTexture=this._fbos[this.getLastOnHoldId()].get(i).colorTexture),e.texture=this.currentFBO(i).colorTexture,this.closeGroup(i);const o=e.baseOpacity<1?Ta.Required:Ta.NotRequired,a=this._getBlendLayersTechnique(n,r,o,s),l=this._rctx.bindTechnique(a,this._bindParameters,e);this._render(l)}drawRasterData(e,r,i,n,s=Sp.Off){if(e.texture==null)return;const o=e.baseOpacity<1?Ta.Required:Ta.NotRequired;e.fboTexture=r===ds.GroupBackgroundComposite||n===Le.Normal&&o===Ta.NotRequired&&s===Sp.Off?null:this.switch(i).colorTexture;const a=this._getBlendLayersTechnique(n,r,o,s),l=this._rctx.bindTechnique(a,this._bindParameters,e);this._render(l)}drawImageryTileData(e,r,i,n,s){const o=s.sourceLayerInfo.data;if(!o.source||(s.tile.surface.layerViewByIndex(s.layerIndex,Gt.MAP).ensureSymbolizerParameters(o),!o.bind(this._rctx)))return;const a=e.baseOpacity<1?Ta.Required:Ta.NotRequired;e.fboTexture=n===Le.Normal&&a===Ta.NotRequired?null:this.switch(i).colorTexture;const l=this._getRasterColorizerTechnique(o,r,n,a);o.opacity=e.opacity;const c=o.getUniforms();c.scale=s.scale,c.offset=s.offset,c.backgroundColor=e.backgroundColor,c.fboTexture=e.fboTexture,c.baseOpacity=e.baseOpacity;const u=this._rctx.bindTechnique(l,null,c);this._render(u)}_getRasterColorizerTechnique(e,r,i,n){const s=e.symbolizerParameters,o=["stretch","lut","hillshade"].indexOf(s.type);return this._rasterColorizerConfig==null&&(this._rasterColorizerConfig=new mO,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),this._rctx.gl.getExtension("OES_texture_float")),this._rasterColorizerConfig.output=r,this._rasterColorizerConfig.blendMode=i,this._rasterColorizerConfig.baseOpacityMode=n,this._rasterColorizerConfig.colorizerType=o,this._rasterColorizerConfig.applyColormap=!!s.colormap,this._rasterColorizerConfig.requireBilinearWithNN=e.isBilinearWithStretchColorRamp,this._rasterColorizerConfig.stretchType=e.hasStretchTypeNone()?x2.Noop:x2.PerBand,this._rasterColorizerTechnique=this._techniqueRepository.releaseAndAcquire(U4e,this._rasterColorizerConfig,this._rasterColorizerTechnique),this._rasterColorizerTechnique}drawVectorData(e,r,i,n,s,o,a,l){const c=this._rctx,u=s.sourceLayerInfo.data,h=s.tile.surface.layerViewByIndex(s.layerIndex,Gt.MAP),p=e.baseOpacity<1?Ta.Required:Ta.NotRequired,f=p===Ta.Required||e.opacity<1||n!==Le.Normal||r!==ds.Composite,g=f?Sp.On:Sp.Off,_=this._getBlendLayersTechnique(n,r,p,g);c.setPipelineState(_.getPipeline());let v=null,b=null;f?(b=this.currentFBO(i),this._vtFBO==null&&(this._vtFBO=new h0e(this._rctx)),v=this._vtFBO.get(i),c.bindFramebuffer(v),this._clearCurrentFBO()):l&&c.clearSafe(Ci.DEPTH_BUFFER_BIT);try{this._vectorTileHelper.renderBackground(c,s.sourceLod,h.painter,h.layer.styleRepository,h.schemaHelper,Math.round(1/s.scale),s.offset,a,o,h.contentZoom),u&&this._vectorTileHelper.renderContent(c,s.sourceLod,u,s.vtlNeighborInfos,h.painter,h.layer.styleRepository,h.schemaHelper,Math.round(1/s.scale),s.offset,a,o,h.contentZoom)}catch(w){kPt().warnOnce("A render call containing vector tiles did not resolve correctly.",w)}return v==null||(c.bindFramebuffer(b),e.texture=v.colorTexture,e.offset=ty,e.scale=1,this.drawRasterData(e,r,i,n,g),l)}copyFBOToTexture(e){const r=this._rctx,i=r.bindTexture(e.texture,Sr.TEXTURE_UNIT_FOR_UPDATES),n=e.descriptor;r.gl.copyTexImage2D(Sn.TEXTURE_2D,0,n.pixelFormat,0,0,n.width,n.height,0),e.generateMipmap(),r.bindTexture(i,Sr.TEXTURE_UNIT_FOR_UPDATES)}_clearCurrentFBO(){this._rctx.setStencilWriteMask(255),this._rctx.setClearColor(0,0,0,0),this._rctx.setClearDepth(1),this._rctx.setClearStencil(0),this._rctx.clearSafe(Ci.COLOR_BUFFER_BIT|Ci.DEPTH_BUFFER_BIT|Ci.STENCIL_BUFFER_BIT)}_initFBO(e,r,i){this._rctx.bindFramebuffer(e),i&&(this._rctx.setViewport(0,0,r,r),this._clearCurrentFBO())}ensureBuffer(e){this._lastUsedIds.length=0,this._lastUsedIds.push(1),this._lastCreatedBufferId=1,this._onHoldIds.length=0,this.bind(e)}bind(e,r=0,i=!0){if(this._current=r,r>=this._fbos.length)for(let n=this._fbos.length;n<=r;n++)this._fbos.push(new h0e(this._rctx));this._initFBO(this._fbos[r].get(e),e,i)}_bindNextFreeBuffer(e){this._lastUsedIds.length>0?this.bind(e,this._lastUsedIds.pop()):(this._lastCreatedBufferId++,this.bind(e,this._lastCreatedBufferId))}openGroup(e){this._onHoldIds.push(this._current),this._bindNextFreeBuffer(e)}switch(e){const r=this.currentFBO(e),i=this._current;return this._bindNextFreeBuffer(e),this._lastUsedIds.push(i),r}getLastOnHoldId(){return this._onHoldIds[this._onHoldIds.length-1]}closeGroup(e){const r=this._current;this._bindNextFreeBuffer(e),this._lastUsedIds.push(r),this._lastUsedIds.push(this._onHoldIds.pop())}unbind(){this._rctx.bindFramebuffer(null)}currentFBO(e){return this._fbos[this._current].get(e)}},UPt=class{constructor(){this.sourceLod=[0,0,0],this.offset=[0,0],this.scale=1,this.layerIndex=0,this.isVTLBackground=!1,this.vtlNeighborInfos=new Vt({allocator:e=>e||new BPt})}},BPt=class{constructor(){this.sourceLayerInfo=null,this.sourceLod=[0,0,0],this.offset=[-1,0]}},VPt=class{constructor(e,r,i,n,s,o){this.start=e,this.end=r,this.blendMode=i,this.opacity=n,this.output=s,this.baseOpacity=o}},GPt=class{constructor(e,r,i,n){this._rctx=e,this.tileSize=r,this._techniques=i,this._cache=n,this._passParameters=new oPt,this._backgroundTexture=null,this._backgroundColor=null,this._backgroundDirty=!1,this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy,this._composition=new zPt(this._rctx,this._techniques),this._ensureBackgroundTexture(this.tileSize)}dispose(){this._composition=gt(this._composition),this._backgroundTexture=tr(this._backgroundTexture)}get backgroundIsGrid(){return this._backgroundColor==null}get backgroundColor(){return this._backgroundColor}updateTileTexture(e,r){if(!e.renderData)return;const i=e.surface,n=i.baseOpacity;let s=0,o=0,a=this.tileSize,l=!1,c=!1;const u=i.view.state.contentPixelRatio;let h=!1;Y8.clear(),jT.length=0;const p=e.layerInfo[Gt.MAP];let f=0,g=null;for(;f<p.length;f++){const b=i.layerViewByIndex(f,Gt.MAP),w=b.layer.opacity,x=b.fullOpacity;if(c=c||c5(b.layer),oI(b)){let A=b.layer.blendMode!=="normal";if(RE(b.layer.parent)){const O=FJ(b.layer.parent);O!=null&&O!==""&&(A=V4e(b.layer.parent)||A)}A&&(h=A,l=!1)}if(w===0&&!h){p[f].pendingUpdates&=~(at.TEXTURE_NOFADING&at.TEXTURE_FADING);continue}++o;const S=kx(b),E=cj(e,f,S);if(E){if(p[f].pendingUpdates&=~(at.TEXTURE_NOFADING&at.TEXTURE_FADING),RE(b.layer.parent)){const A=FJ(b.layer.parent);A!=null&&A!==""&&G4e(b.layer.parent,f)}S?a=Math.max(a,this.tileSize*u):n===1&&x===1&&(b.isOpaque||this._dataToTexture(E)&&E.sourceLayerInfo.data.descriptor.isOpaque)&&(l=!0),++s,g===null&&(g=f)}}const _=a/this.tileSize,v=this._ensureBackgroundTexture(this.tileSize);s!==0&&g!==null?s===1&&!h&&this._useLayerTexture(e,g)||this._composeMapLayers(e,r,f-1,c,a,_,!l||h,Y8,h):this._useBackgroundTexture(e,o,v,r!==ps.FADING)}_ensureBackgroundTexture(e){return this._backgroundTexture==null&&(this._backgroundTexture=this._buildTexture(e,!1),this._backgroundDirty=!0),this._backgroundDirty&&(this._composition.bind(e),this._passParameters.offset=ty,this._passParameters.scale=1,this._passParameters.opacity=1,this.backgroundColor&&(this._passParameters.backgroundColor=this.backgroundColor),this._composition.drawBackground(this._passParameters,this.backgroundColor!=null),this._composition.copyFBOToTexture(this._backgroundTexture),this._composition.unbind(),this._backgroundDirty=!1),this._backgroundTexture}_useBackgroundTexture(e,r,i,n){const s=e.renderData,o=!n&&s.textureReference!=null&&(e.surface.view.layerViewManager.updating||r>0)?X1.Delayed:X1.Immediate;s.setTextureReference(new lj(i,ps.FADING,d0e,e.surface.baseOpacity,0,1),o)}_useLayerTexture(e,r){const i=e.surface.layerViewByIndex(r,Gt.MAP),n=c5(i.layer),s=n?e.surface.baseOpacity:1,o=n?1:e.surface.baseOpacity,a=i.fullOpacity,l=cj(e,r,!1);return!!this._dataToTexture(l)&&(e.renderData.setTextureReference(new lj(l.sourceLayerInfo.data,ps.FADING,l,s,o,a)),!0)}_composeMapLayers(e,r,i,n,s,o,a,l,c){this._composition.ensureBuffer(s);const u=e.surface.baseOpacity;let h=!1,p=Ht.LINEAR_MIPMAP_LINEAR,f=!1,g=0;for(let w=i;w>=0;w--){const x=e.surface.layerViewByIndex(w,Gt.MAP),S=kx(x),E=cj(e,w,S),A=x.layer.opacity;if(!E||A===0&&!c)continue;const O=!c5(x.layer)&&!h;O&&(h=!0);let L=!1;l.forEach(B=>{B.start===w&&(B.output=n?ds.Composite:a&&O?this.backgroundIsGrid?ds.GridComposite:ds.ColorComposite:ds.Composite,B.baseOpacity=O?u:1,jT.push(B),this._composition.openGroup(s),L=!0)}),this._passParameters.baseOpacity=O&&!L&&u<1?u:1;const z=g===0,k=L?ds.GroupBackgroundComposite:a&&z?this.backgroundIsGrid?ds.GridComposite:ds.ColorComposite:ds.Composite,q=MJ[oI(x)?x.layer.blendMode:"normal"];for(this._passParameters.opacity=A,bEt(E)?f=this._composition.drawVectorData(this._passParameters,k,s,q,E,o,this.tileSize,f):vEt(E)?(this._composition.drawImageryTileData(this._passParameters,k,s,q,E),this._hasNearestInterpolation(E)&&(p=Ht.NEAREST)):this._dataToTexture(E)&&(this._passParameters.texture=E.sourceLayerInfo.data.texture,this._passParameters.offset=E.offset,this._passParameters.scale=E.scale,this._composition.drawRasterData(this._passParameters,k,s,q));jT.length>0&&jT[jT.length-1].end===w;){const B=jT.pop();this._passParameters.baseOpacity=B.baseOpacity,this._passParameters.opacity=B.opacity,this._passParameters.offset=ty,this._passParameters.scale=1,this._composition.drawGroup(this._passParameters,B.output,s,MJ[B.blendMode])}g++}const _=e.renderData,v=c||h&&u<1,b=_.ensureTexture(s,v,()=>this._buildTexture(s,v,p));this._composition.copyFBOToTexture(b),this._composition.unbind(),_.setTextureReference(new lj(b,r,d0e,h?1:u,0,1))}_hasNearestInterpolation(e){const r=e.sourceLayerInfo.data;return!!r.source&&r.interpolation==="nearest"}_dataToTexture(e){if(xEt(e)){const r=e.sourceLayerInfo;r.data=this._buildTexture(r.data,!0),e.tile.setMemoryDirty()}return wEt(e)}setBackground(e){this._backgroundColor!==e&&(this._backgroundColor=e,this._backgroundDirty=!0)}_buildTexture(e,r,i=Ht.LINEAR_MIPMAP_LINEAR){if(e==null)return null;const n=new ri;n.wrapMode=Jt.CLAMP_TO_EDGE,n.samplingMode=i,n.maxAnisotropy=this._maxAnisotropy,n.preMultiplyAlpha=!0,n.flipped=!0,n.hasMipmap=!0,r||(n.pixelFormat=Tt.RGB);const s=this._rctx;let o;if(typeof e=="number"){n.width=n.height=e;const l=`${e} ${n.pixelFormat}`;o=this._cache.pop(l),o?o.retain():o=new fO(new Sr(s,n),this._cache)}else if(rCt(e)){n.isOpaque=e.isOpaque,n.isOpaque&&(n.pixelFormat=Tt.RGB);const l=`${e} ${n.pixelFormat}`;o=this._cache.pop(l),o?(o.retain(),o.texture.setData(e.image)):o=new fO(new Sr(s,n,e.image),this._cache),e.release()}else try{n.width=e.width,n.height=e.height,o=new fO(new Sr(s,n,e))}catch{o=new fO(BPe(s)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}const a=s.bindTexture(o.texture,Sr.TEXTURE_UNIT_FOR_UPDATES);return o.generateMipmap(),s.bindTexture(a,Sr.TEXTURE_UNIT_FOR_UPDATES),o}get test(){return{backgroundTexture:this._backgroundTexture}}};function cj(t,e,r){ya.layerIndex=e,ya.vtlNeighborInfos.clear();const i=t.layerInfo[Gt.MAP][e];if(cr(ya.offset,0,0),ya.tile=t,ya.scale=1,ya.sourceLod=t.lij,ya.sourceLayerInfo=i,ya.isVTLBackground=r,i.data)return r&&t.forEachLoadedNeighbor((s,o)=>{if(s.level!==t.level)return;const a=s.layerInfo[Gt.MAP][e];if(!ZNe(a)||i.data===a.data)return;const l=ya.vtlNeighborInfos.pushNew();l.offset=o0[o],l.sourceLod=s.lij,l.sourceLayerInfo=a}),ya;const n=i.upsampleInfo;if(n){const s=n.tile.layerInfo[Gt.MAP][e];return ya.tile=n.tile,eo(ya.offset,n.offset),ya.scale=n.scale,ya.sourceLod=n.tile.lij,ya.sourceLayerInfo=s,ya}return r?ya:null}function FJ(t){return t.uid}function V4e(t){let e=t.blendMode!=="normal";return RE(t.parent)&&(e=V4e(t.parent)||e),e}function G4e(t,e){RE(t.parent)&&G4e(t.parent,e);const r=FJ(t);if(r!=null&&r!==""){const i=Y8.get(r);i?i.start=e:Y8.set(r,new VPt(e,e,t.blendMode,t.opacity,ds.Composite,1))}}const Y8=new Map,jT=new Array,ya=new UPt,d0e={offset:[0,0],scale:1},o0=new Array;o0[mt.NORTH]=[0,-1],o0[mt.NORTH_EAST]=[-1,-1],o0[mt.EAST]=[-1,0],o0[mt.SOUTH_EAST]=[-1,1],o0[mt.SOUTH]=[0,1],o0[mt.SOUTH_WEST]=[1,1],o0[mt.WEST]=[1,0],o0[mt.NORTH_WEST]=[1,-1];const j4e=200,uj=40,jPt=.8,HPt=10,gO=1e-6;function WPt(t,e,r){const i=e,n=r;let s=0,o=1/0;for(let a=0;a<3;++a){{const l=t[a];if(i[a]<l){if(n[a]<=gO)return!1;const c=(l-i[a])/n[a];s=Math.max(s,c)}else if(n[a]<=-gO){const c=(l-i[a])/n[a];o=Math.min(o,c)}if(s>o)return!1}{const l=t[a+3];if(i[a]>l){if(n[a]>=-gO)return!1;const c=(l-i[a])/n[a];s=Math.max(s,c)}else if(n[a]>=gO){const c=(l-i[a])/n[a];o=Math.min(o,c)}if(s>o)return!1}}return!0}let p0e=class{constructor(e,r,i,n,s){this.aabb=e,this.axis=r,this.d=i,this.midStartIndex=n,this.rightStartIndex=s}},Gne=class kJ{constructor(e,r,i,n){this.globalTriangleVertexIndices=e,this.firstTriangleIndex=r,this.positions=n,this._rayDirection=C(),this.bspNodeTree=new Array;const s=i-r,o=s<=H4e?new Uint16Array(s):new Uint32Array(s);this.indices=o;for(let a=0;a<s;++a)o[a]=a;{const a=JPt(e,r,i,n.data,n.stride),l=we(Math.log2(s/uj),2,HPt),c=(u,h,p)=>{const f=XPt(o,a,u,h),g=h-u;if(g<=uj){const S=new p0e(f,void 0,0,u,h);return this.bspNodeTree.push(S),S}const{axis:_,midValue:v}=ZPt(f),b=YPt(o,a,u,h,_,v),w=(S,E)=>{if(p>l)return;const A=E-S;return A<uj||A>=jPt*g?void 0:c(S,E,p+1)},x=new p0e(f,_,v,b.next,b.mid);return this.bspNodeTree.push(x),x.leftNode=w(u,b.next),x.rightNode=w(b.mid,h),x};c(0,s,0),this.triangleVertexIndices=QPt(o,e,r,i)}}intersectRayTriangleRange(e,r){if(e>=r)return;const i=this.triangleVertexIndices,n=this.positions.data,s=this.positions.stride,o=this._rayOrigin,a=o[0],l=o[1],c=o[2],u=this._rayDirection,h=u[0],p=u[1],f=u[2];for(let g=e,_=3*e;g<r;++g){const v=i[_]*s,b=n[v],w=n[v+1],x=n[v+2],S=i[_+1]*s,E=n[S],A=n[S+1],O=n[S+2],L=i[_+2]*s;_+=3;const z=E-b,k=A-w,q=O-x,B=n[L]-b,J=n[L+1]-w,W=n[L+2]-x,Y=p*W-J*f,le=f*B-W*h,D=h*J-B*p,I=z*Y+k*le+q*D;if(Math.abs(I)<=Number.EPSILON)continue;const F=a-b,G=l-w,H=c-x,Z=F*Y+G*le+H*D;if(I>0){if(Z<0||Z>I)continue}else if(Z>0||Z<I)continue;const te=G*q-k*H,me=H*z-q*F,Me=F*k-z*G,it=h*te+p*me+f*Me;if(I>0){if(it<0||Z+it>I)continue}else if(it>0||Z+it<I)continue;const Et=(B*te+J*me+W*Me)/I;if(Et>=0){const St=this.indices[g]+this.firstTriangleIndex,ht=qre(z,k,q,B,J,W,qPt);this._callback(Et,ht,St,!1)}}kJ.numFacesTested+=r-e}intersectRay(e,r,i){kJ.numFacesTested=0;const n=e,s=r,o=s[0]-n[0],a=s[1]-n[1],l=s[2]-n[2];if(o*o+a*a+l*l<gO)return;this._rayOrigin=n;const c=this._rayDirection;c[0]=o,c[1]=a,c[2]=l;const u=this.triangleVertexIndices.length/3;this._callback=i;const h=this.bspNodeTree[0];this.intersectRayBSP(h,0,u)}intersectRayBSP(e,r,i){const n=this._rayOrigin,s=this._rayDirection;if(!WPt(e.aabb,n,s))return;const o=e.axis,a=e.d;if(n[o]<a||s[o]<0){const l=r,c=e.midStartIndex;if(l<c){const u=e.leftNode;u!==void 0?this.intersectRayBSP(u,l,c):this.intersectRayTriangleRange(l,c)}}if(this.intersectRayTriangleRange(e.midStartIndex,e.rightStartIndex),n[o]>a||s[o]>0){const l=e.rightStartIndex,c=i;if(l<c){const u=e.rightNode;u!==void 0?this.intersectRayBSP(u,l,c):this.intersectRayTriangleRange(l,c)}}}get estimatedMemoryUsage(){return this.triangleVertexIndices.byteLength+this.indices.byteLength}};Gne.numFacesTested=0;const qPt=C(),HT=[1/0,1/0,1/0],WT=[-1/0,-1/0,-1/0];function YPt(t,e,r,i,n,s){let o=r,a=i;for(;o<a;){const c=t[o];e[6*c+n+3]<=s?++o:(--a,t[o]=t[a],t[a]=c)}let l=o;for(a=i;l<a;){const c=t[a-1];e[6*c+n]>=s?--a:(t[a-1]=t[l],t[l]=c,++l)}return{next:o,mid:l}}function XPt(t,e,r,i){if(i<=r)return u2(NaN,NaN,NaN,NaN,NaN,NaN);{const n=6*t[r];for(let s=0;s<3;++s)HT[s]=e[n+0+s],WT[s]=e[n+3+s]}for(let n=r+1;n<i;++n){const s=6*t[n];for(let o=0;o<3;++o)HT[o]=Math.min(HT[o],e[s+0+o]),WT[o]=Math.max(WT[o],e[s+3+o])}return u2(HT[0],HT[1],HT[2],WT[0],WT[1],WT[2])}function ZPt(t){const e=t[3]-t[0],r=t[4]-t[1],i=t[5]-t[2],n=e>r?e>i?0:r>i?1:2:r>i?1:i>e?2:0;return{axis:n,midValue:(t[n]+t[n+3])/2}}function JPt(t,e,r,i,n){const s=r-e,o=new Float32Array(6*s);for(let a=0;a<s;++a){const l=3*(a+e),c=t[l]*n,u=t[l+1]*n,h=t[l+2]*n;for(let p=0;p<3;++p){const f=i[c+p],g=i[u+p],_=i[h+p];o[6*a+p]=Math.min(f,g,_),o[6*a+3+p]=Math.max(f,g,_)}}return o}function QPt(t,e,r,i){const n=i-r;let s=0;for(let a=r;a<i;++a)for(let l=0;l<3;++l)s=Math.max(e[3*a+l],s);const o=s<=H4e?new Uint16Array(3*n):new Uint32Array(3*n);for(let a=0;a<n;++a){const l=3*(t[a]+r);for(let c=0;c<3;++c){const u=e[l+c];o[3*a+c]=u}}return o}const H4e=65535;let jn=class extends vl{constructor(){super(...arguments),this.output=U.Color,this.overlayMode=Fm.Disabled,this.tileBlendInput=Um.LayerOnly,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.backfaceCullingEnabled=!1,this.textureFadingEnabled=!1,this.renderOccluded=!1,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.invisible=!1,this.tileBorders=!1,this.visualizeNormals=!1,this.screenSizePerspective=!1,this.receiveAmbientOcclusion=!1,this.pbrMode=ot.Simplified}};d([j({count:U.COUNT})],jn.prototype,"output",void 0),d([j({count:Fm.COUNT})],jn.prototype,"overlayMode",void 0),d([j({count:Um.COUNT})],jn.prototype,"tileBlendInput",void 0),d([j()],jn.prototype,"spherical",void 0),d([j()],jn.prototype,"doublePrecisionRequiresObfuscation",void 0),d([j()],jn.prototype,"receiveShadows",void 0),d([j()],jn.prototype,"hasSlicePlane",void 0),d([j()],jn.prototype,"backfaceCullingEnabled",void 0),d([j()],jn.prototype,"textureFadingEnabled",void 0),d([j()],jn.prototype,"renderOccluded",void 0),d([j()],jn.prototype,"hasScreenSpaceReflections",void 0),d([j()],jn.prototype,"hasCloudsReflections",void 0),d([j()],jn.prototype,"invisible",void 0),d([j()],jn.prototype,"tileBorders",void 0),d([j()],jn.prototype,"visualizeNormals",void 0),d([j()],jn.prototype,"screenSizePerspective",void 0),d([j()],jn.prototype,"receiveAmbientOcclusion",void 0),d([j({count:ot.COUNT})],jn.prototype,"pbrMode",void 0),d([j({constValue:$r.Compressed})],jn.prototype,"normalType",void 0),d([j({constValue:on.Compressed})],jn.prototype,"textureCoordinateType",void 0),d([j({constValue:!1})],jn.prototype,"highStepCount",void 0),d([j({constValue:!1})],jn.prototype,"useCustomDTRExponentForWater",void 0),d([j({constValue:!1})],jn.prototype,"useFillLights",void 0),d([j({constValue:!0})],jn.prototype,"hasColorTexture",void 0);const hj=7,KPt=10,dj=vs();var fl;(function(t){t[t.Opaque=0]="Opaque",t[t.Semitransparent=1]="Semitransparent",t[t.TransparentWithDraped=2]="TransparentWithDraped",t[t.Empty=3]="Empty"})(fl||(fl={}));let Ah=class extends mMe{get _isGlobal(){return this._stage.viewingMode===De.Global}get _techniques(){return this._context.techniqueRepository}get _rctx(){return this._context.renderContext.rctx}constructor(e,r,i,n,s){super({}),this._overlayRenderer=e,this._stage=r,this._allTiles=i,this._ellipsoidRadius=n,this.type=Bi.TERRAIN,this.isGround=!0,this._tileSize=256,this._techniqueConfiguration=new jn,this._passParameters=new Ine,this._drawParameters=new VZ,this._renderDataPool=new ua(S3t),this._visiblePatchesByOrigin=new Map,this._allPatchesByOrigin=new Map,this._patchesByOriginDirty=!0,this._patchSortingDirty=!0,this._tileIterator=new t4e,this._transparencyState=fl.Opaque,this._castShadows=!1,this._emptyTex=null,this._tileRenderer=null,this._stencilEnabledLayerExtents=new Array,this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0,this.renderOccludedFlags=kr.Occlude,this.produces=new Map([[ue.OPAQUE_TERRAIN,()=>this._produces()],[ue.TRANSPARENT_TERRAIN,()=>this._produces()],[ue.OCCLUDED_TERRAIN,()=>this._produces()]]),this._tileTextureCache=new cL((o,a)=>s.newCache(o,a),"TileTexture"),this.tileGeometryCache=new iPt(s)}normalizeCtorArgs(){return{}}initialize(){this._stage.addRenderPlugin(this),this.addHandles(he(()=>this._overlayRenderer.rendersOccludedDraped,e=>{this.renderOccludedFlags=e?C8:kr.Occlude,this.setNeedsRender()},Qr))}destroy(){this._stage.removeRenderPlugin(this),this._tileTextureCache.destroy(),this.tileGeometryCache.destroy()}_produces(){return this.visible&&!!this._rootTiles&&!this.renderingDisabled}consumes(){return this._overlayRenderer.hasWater?dMe:mU}set renderingDisabled(e){this._set("renderingDisabled",!!e),this.setDirty()}set visible(e){this._set("visible",!!e),this.setDirty()}set transparency(e){this._transparencyState!==e&&(this._techniqueConfiguration.invisible=e===fl.TransparentWithDraped||e===fl.Empty,this._transparencyState=e,this.setNeedsRender())}get transparency(){return this._transparencyState}get renderPatchBorders(){return!!this._techniqueConfiguration.tileBorders}set renderPatchBorders(e){this._techniqueConfiguration.tileBorders!==e&&(this._techniqueConfiguration.tileBorders=e,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}get visualizeNormals(){return!!this._techniqueConfiguration.visualizeNormals}set visualizeNormals(e){this._techniqueConfiguration.visualizeNormals!==e&&(this._techniqueConfiguration.visualizeNormals=e,this.setNeedsRender(),this.notifyChange("visualizeNormals"))}get cullBackFaces(){return this._techniqueConfiguration.backfaceCullingEnabled}set cullBackFaces(e){this._techniqueConfiguration.backfaceCullingEnabled!==e&&(this._techniqueConfiguration.backfaceCullingEnabled=e,this.notifyChange("cullBackFaces"),this.setNeedsRender())}set renderOrder(e){this._set("renderOrder",e),this._setSortingDirty()}get layerUid(){return pv}get slicePlaneEnabled(){return this._techniqueConfiguration.hasSlicePlane}set slicePlaneEnabled(e){this._techniqueConfiguration.hasSlicePlane!==e&&(this._techniqueConfiguration.hasSlicePlane=e,this.setNeedsRender())}set textureFadingEnabled(e){this._techniqueConfiguration.textureFadingEnabled!==e&&(this._techniqueConfiguration.textureFadingEnabled=e,this.setNeedsRender())}set pbrMode(e){this._techniqueConfiguration.pbrMode!==e&&(this._techniqueConfiguration.pbrMode=e,this.setNeedsRender())}setDebugScreenSizePerspective(e){this._techniqueConfiguration.screenSizePerspective!==e&&(this._techniqueConfiguration.screenSizePerspective=e,this.setNeedsRender())}setRootTiles(e){this._rootTiles=e,this.setDirty()}setStencilEnabledLayerExtents(e){this._stencilEnabledLayerExtents=e,this._setSortingDirty()}setTileSize(e){this._tileSize=e,this._tileRenderer!=null&&(this._tileRenderer.tileSize=e),this.setDirty()}_prepareTileForLoading(e){e.renderData||(e.renderData=this._renderDataPool.acquire(),e.renderData.init(e,this._getLocalOriginOfTile(e)))}loadTile(e){this._prepareTileForLoading(e),this.updateTileGeometryState(e),this.updateTileTexture(e,at.TEXTURE_FADING)}updateTileTexture(e,r){this._tileRenderer!=null&&(this._tileRenderer.updateTileTexture(e,r===at.TEXTURE_FADING?ps.FADING:ps.UNFADED),this.setNeedsRender(),e.resetPendingUpdate(r))}updateTileGeometryState(e){for(const i of e.layerInfo[Gt.ELEVATION])i.pendingUpdates&=~at.GEOMETRY;e.resetPendingUpdate(at.GEOMETRY);const r=e.renderData.updateGeometryState();return r&&this.setDirty(),r}updateGeometryIfNeeded(e){e.isLoaded&&e.renderData.updateGeometryIfNeeded(this._rctx)}unloadTile(e){const r=e.renderData;r&&(r.releaseGeometry(),this._renderDataPool.release(r),r.clear(),e.renderData=null,e.setMemoryDirty(),this.setDirty())}_getLocalOriginOfTile(e){const r=KPt-hj,i=Math.max(0,Math.floor((e.level-r)/hj)*hj);if(this._isGlobal&&i===0)return zn;for(;e.parent&&e.level>i;)e=e.parent;return e.centerAtSeaLevel}getStats(){return{numTilesRendered:this._numTilesRendered,numTilesCulled:this._numTilesCulled,numOriginsRendered:this._numOriginsRendered}}set wireframe(e){this._get("wireframe")!==e&&(this._set("wireframe",e),this.setNeedsRender())}setDirty(e=Dn.UPDATE){this._patchesByOriginDirty=!0,this._context.requestRender(e)}_setSortingDirty(e=Dn.UPDATE){this._patchSortingDirty=!0,this._context.requestRender(e)}setNeedsRender(e=Dn.UPDATE){this._context.requestRender(e)}initializeRenderContext(e){this._context=e,this._tileRenderer=new GPt(this._rctx,this._tileSize,this._techniques,this._tileTextureCache),this.updateTileBackground(),this._emptyTex=BPe(this._rctx)}uninitializeRenderContext(){this._emptyTex=gt(this._emptyTex),this._tileRenderer=gt(this._tileRenderer)}intersect(e,r,i,n){if(!this._rootTiles||e.options.selectOpaqueTerrainOnly&&e.options.selectionMode&&this.transparency!==fl.Opaque)return;const s=eAt,o=tAt;ye(s,n,i),ie(o,1/s[0],1/s[1],1/s[2]);const a=e.results.min,l=e.results.max,c=e.results.ground,u=e.options.store===Go.MIN,h=!!e.results.ground.target,p=WJe(e.verticalOffset),f=e.tolerance;let g,_=u&&a.dist!=null?a.dist:1/0;const v=w=>{const x=w.renderData;if(!(x!=null&&x.vao))return;const S=x.geometry;Y9(dj,S.boundingBox);const E=x.localOrigin;p!=null&&(p.localOrigin=E,p.applyToAabb(dj));const A=dj;if(qT[0]=i[0]-E[0],qT[1]=i[1]-E[1],qT[2]=i[2]-E[2],!Xre(A,qT,o,f,_))return;const O=(le,D,I)=>{le.set(this.type,w,D,I,sn),_=u&&a.dist!=null?a.dist:1/0},L=(le,D)=>{if(D!=null&&le>=0&&(e.options.backfacesTerrain||de(D,s)<0)&&(e.options.invisibleTerrain||!e.options.selectionMode||r==null||r(i,n,le))){if((c.dist==null||le<c.dist)&&O(c,le,D),e.options.isFiltered)return;e.options.store===Go.ALL&&(g==null?(g=mte(e.ray),O(g,le,D),e.results.all.push(g)):le<g.dist&&O(g,le,D)),(a.dist==null||le<a.dist)&&O(a,le,D),e.options.store!==Go.MIN&&(l.dist==null||le>l.dist)&&O(l,le,D)}},z=rAt;ye(z,n,E);const{indices:k,indexCount:q}=S,B=S.vertexAttributes,J=B.getField(R.POSITION,Qs),W=new U3(J.typedBuffer,3,B.stride/4),Y=q/3;if(!p&&Y>j4e){const le=w.renderData;le.intersectionData==null&&(le.intersectionData=new Gne(k,0,Y,W)),le.intersectionData.intersectRay(qT,z,L)}else QI(qT,z,0,Y,k,W,null,p,L)},b=this._rootTiles;b!=null&&(()=>{const w=this._tileIterator;w.reset(b);const x=e.options.invisibleTerrain;for(let S=w.next();S;S=w.next())!(S.visible||x&&S.intersectsClippingArea)||p==null&&!S.intersectsRay(i,s,f,_)||h&&this._useStencilForTile(S)?w.skipSubtree():v(S)})()}processScaleRangeQueries(e,r){var i;if(!r.done)for(this._updatePatchGroups();e.updating&&!r.done;){e.prepare();for(const n of this._visiblePatchesByOrigin.values())for(const s of n)((i=s.renderData)==null?void 0:i.textureReference)!=null&&e.queriesForTile(s);e.process(),r.madeProgress()}}prepareTechnique(e){const r=se("enable-feature:terrain-shadows")&&e.bindParameters.shadowMap.enabled;if(r!==this._castShadows&&(this._castShadows=r,this._patchesByOriginDirty=!0),e.bindParameters.slot===ue.OCCLUDED_TERRAIN){if(!(e.renderOccludedMask&C8))return null}else{const i=this.transparency===fl.Opaque?ue.OPAQUE_TERRAIN:ue.TRANSPARENT_TERRAIN;if(e.bindParameters.slot!==i)return null}if(this.transparency===fl.Empty)return null;switch(e.output){case U.Color:return this._techniqueConfiguration.hasScreenSpaceReflections=e.bindParameters.ssr.lastFrameColor!=null,this._techniqueConfiguration.hasCloudsReflections=e.bindParameters.cloudsFade.data!=null,this._techniqueConfiguration.receiveShadows=e.bindParameters.shadowMap.ready,this._techniqueConfiguration.receiveAmbientOcclusion=e.bindParameters.ssao!=null,this._techniqueConfiguration.overlayMode=this._overlayRenderer.mode,this._updateTechnique(U.Color,e.bindParameters.slot===ue.OCCLUDED_TERRAIN);case U.Shadow:case U.ShadowExcludeHighlight:return this._castShadows?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(U.Shadow,!1)):null;case U.LinearDepth:return this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(U.LinearDepth,!1);case U.Normal:return this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(U.Normal,!1);case U.ObjectAndLayerIdColor:return this._updateTechnique(U.ObjectAndLayerIdColor,!1);case U.Highlight:return this._overlayRenderer.hasHighlights?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(U.Highlight,!1)):null}return null}renderNode(e,r){switch(this._updatePatchGroups(),r.useStencil=!1,e.output){case U.Color:{const i=e.bindParameters.slot===ue.OCCLUDED_TERRAIN?Ui.Occluded:Ui.Color;this._renderMaterialPass(e,r,i);break}case U.LinearDepth:case U.Normal:this._renderAuxiliaryPass(e,r,Ui.Color,this._visiblePatchesByOrigin);break;case U.Highlight:this._renderAuxiliaryPass(e,r,Ui.Highlight,this._visiblePatchesByOrigin);break;case U.Shadow:case U.ShadowExcludeHighlight:this._renderAuxiliaryPass(e,r,null,this._allPatchesByOrigin);break;case U.ObjectAndLayerIdColor:this._renderAuxiliaryPass(e,r,Ui.ObjectAndLayerIdColor,this._visiblePatchesByOrigin)}}updateTileBackground(e){if(this._tileRenderer==null)return;const r=this._tileRenderer;let i;if(e!=null){const n=Xe.toUnitRGBA(e);i=Ce(n[0]||0,n[1]||0,n[2]||0)}r.setBackground(i),this._allTiles.forAll(n=>r.updateTileTexture(n,ps.FADING)),this._techniqueConfiguration.tileBlendInput=r.backgroundIsGrid?Um.GridComposite:r.backgroundColor!=null?Um.ColorComposite:Um.LayerOnly,this.setNeedsRender()}_updatePatchGroups(){if(this._patchesByOriginDirty&&(this._rebuildPatchGroups(),this._patchesByOriginDirty=!1,this._patchSortingDirty=!0),this._patchSortingDirty&&this.renderOrder!==b3.NONE){const e=Array.from(this._visiblePatchesByOrigin.values()),r=this._stencilEnabledLayerExtents;for(const i of e)r4e(this.renderOrder,i,r);e.sort((i,n)=>i4e(i[0],n[0],this.renderOrder)),this._visiblePatchesByOrigin=new Map(e.map(i=>[i[0].renderData.localOrigin,i])),this._patchSortingDirty=!1}}_rebuildPatchGroups(){var r;const e=this._rootTiles;if(e!=null){(r=e[0])==null||r.surface.checkAllTilesWaterproofness(),this._visiblePatchesByOrigin.clear(),this._allPatchesByOrigin.clear();for(const i of e)this._rebuildPatchGroupsForRootTile(i)}}_rebuildPatchGroupsForRootTile(e){const r=this._tileIterator;for(r.resetOne(e);!r.done;){const i=r.next(),n=i.renderData;if(!n){this._numTilesCulled++;continue}const s=n.localOrigin;if(this._castShadows){let a=this._allPatchesByOrigin.get(s);a||(a=[],this._allPatchesByOrigin.set(s,a)),a.push(i)}if(!i.visible){this._numTilesCulled++,r.skipSubtree();continue}let o=this._visiblePatchesByOrigin.get(s);o||(o=[],this._visiblePatchesByOrigin.set(s,o)),o.push(i),r.skipSubtree()}}_useStencilForTile(e){for(const r of this._stencilEnabledLayerExtents)if(e.intersectsExtent(r))return!0;return!1}_renderAuxiliaryPass(e,r,i,n){const s=e.rctx;this._passParameters.overlayContent=i,s.bindTechnique(r,e.bindParameters,this._passParameters);const o=this._stencilEnabledLayerExtents.length>0;n.forEach(a=>{this._drawParameters.origin=a[0].renderData.localOrigin,r.program.bindDraw(this._drawParameters,e.bindParameters,this._passParameters);for(let l=0;l<a.length;l++)this._renderPatch(e,r,a[l],sr.TRIANGLES,o,i)}),e.rctx.bindVAO(null)}_renderMaterialPass(e,r,i){var p;const{rctx:n}=e;this._passParameters.overlayContent=i,n.bindTechnique(r,e.bindParameters,this._passParameters),this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0;const s=e.bindParameters.camera,o=r.program;if(this._techniqueConfiguration.screenSizePerspective&&this.pointsOfInterest){const f=cOe(this._stage.viewingMode,this._ellipsoidRadius),g=this.pointsOfInterest.centerOnSurfaceFrequent.distance;f.update({distance:g,fovY:s.fovY})}const a=this._stencilEnabledLayerExtents.length>0,l=i===Ui.Occluded;l&&(o.bindTexture("tex",this._emptyTex),o.setUniform3fv("textureOpacities",zn),o.setUniform4fv("texOffsetAndScale",qu));const c=((p=this._tileRenderer)==null?void 0:p.backgroundColor)!=null?this._tileRenderer.backgroundColor:zn;this._techniqueConfiguration.tileBlendInput===Um.ColorComposite&&o.setUniform3fv("backgroundColor",c);const u=this.wireframe?sr.LINES:sr.TRIANGLES;this._techniqueConfiguration.textureFadingEnabled&&o.bindTexture("texNext",this._emptyTex);const h=this._visiblePatchesByOrigin;for(const f of h.values()){const g=f[0].renderData.localOrigin;r.program.bindDraw(new VZ(g),e.bindParameters,this._passParameters),this._numOriginsRendered++;for(const _ of f){const v=_.renderData,b=v.textureReference;if(b!=null){if(!l){o.setUniform4fv("texOffsetAndScale",b.offsetAndScale),o.bindTexture("tex",b.texture.texture);const w=v.textureFadeFactor,x=w<1?v.nextTextureReference:null;this._techniqueConfiguration.textureFadingEnabled&&x!=null&&w<1?(o.setUniform1f("fadeFactor",w),o.setUniform4fv("nextTexOffsetAndScale",x.offsetAndScale),o.setUniform3fv("nextTexOpacities",x.opacities),o.bindTexture("texNext",x.texture.texture)):o.setUniform1f("fadeFactor",1),v.textureIsFading&&this.setNeedsRender(),o.setUniform3fv("textureOpacities",b.opacities)}this._renderPatch(e,r,_,u,a,i),_.renderOrder=this._numTilesRendered,this._numTilesRendered++}}}e.rctx.bindVAO(null)}_renderPatch(e,r,i,n,s,o){const a=i.renderData,l=a.vao,c=l==null?void 0:l.indexBuffer;if(!l||c==null)return void(Ys&&console.error("Rendered tile with no indices: ",i.lij," : ",a));const u=r.program;o==null||this._overlayRenderer.isEmpty||this._bindOverlayPatchData(u,a.overlay),s&&(r.useStencil=this._useStencilForTile(i),e.rctx.setPipelineState(r.getPipeline()));const h=a.geometry.indexCount;e.rctx.bindVAO(l),u.assertCompatibleVertexAttributeLocations(l),e.rctx.drawElements(n,h,c.indexType,0)}_bindOverlayPatchData(e,r){e.setUniform4fv("overlayTexOffset",r.offsets),e.setUniform4fv("overlayTexScale",r.scales)}_updateTechnique(e,r){return this._techniqueConfiguration.output=e,this._techniqueConfiguration.renderOccluded=r,this._shaderTechnique=this._techniques.releaseAndAcquire(p4e,this._techniqueConfiguration,this._shaderTechnique),this._shaderTechnique}get test(){return{tileRenderer:this._tileRenderer}}};d([m({readOnly:!0})],Ah.prototype,"_isGlobal",null),d([m()],Ah.prototype,"renderOccludedFlags",void 0),d([m({value:!1})],Ah.prototype,"renderingDisabled",null),d([m({value:!0})],Ah.prototype,"visible",null),d([m()],Ah.prototype,"renderPatchBorders",null),d([m()],Ah.prototype,"visualizeNormals",null),d([m()],Ah.prototype,"cullBackFaces",null),d([m({value:b3.FRONT_TO_BACK})],Ah.prototype,"renderOrder",null),d([m()],Ah.prototype,"wireframe",null),Ah=d([V("esri.views.3d.terrain.TerrainRenderer")],Ah);const eAt=C(),tAt=C(),qT=C(),rAt=C();let iAt=class{constructor(){this.numNodes=0,this.numLeaves=0,this.numVisible=0,this.numRendered=0,this.numSplit=0,this.numMerged=0,this.numRenderedPerLevel=new Array,this.numLoadedPerLevel=new Array}},dm=class extends Ae{constructor(e){super(e)}initialize(){this.addHandles([this.layers.on("change",()=>this._update()),he(()=>this.extentHelper.layerViewsExtent,()=>this._setAdHocTilingScheme())]),this._update(),this.tilingSchemeLocked||this._setAdHocTilingScheme()}destroy(){this._waitTask=null,this.layers.destroy()}_update(){if(this._waitTask=null,this.tilingSchemeLocked)return;let e;if(this.layers.some(r=>!(!HO(r)||r.isRejected())&&!(r.isFulfilled()&&!nAt(r,this.viewSpatialReference,this.viewingMode))&&(e=r,!((r==null?void 0:r.type)==="vector-tile"||G8(r)))),e)if(e.isResolved()){const r=iB(e,this.viewSpatialReference,this.viewingMode);if(r!=null){const i=new Fc(r.tileInfo);this._lockTilingScheme(i)}}else this._updateWhen(e)}_updateWhen(e){const r=e.when().catch(()=>{}).then(()=>{r!==this._waitTask||this.destroyed||this._update()});this._waitTask=r}_lockTilingScheme(e){if(this.viewingMode===De.Global){const r=e.levels.length-1;e.spatialReference.isWebMercator?e=Fc.makeWebMercatorAuxiliarySphere(r):dv(e.spatialReference)&&(e=Fc.makeGCSWithTileSize(e.spatialReference,e.pixelSize,r))}this.tilingSchemeLocked=!0,this.tilingScheme=e,this.extentHelper.tilingScheme=this.tilingScheme,this._updateTiledLayerExtent(),this.removeAllHandles(),this.addHandles(he(()=>this.extentHelper.tiledLayersExtent,()=>this._updateTiledLayerExtent()))}_updateTiledLayerExtent(){this._set("extent",this.extentHelper.tiledLayersExtent)}_setAdHocTilingScheme(){if(this.viewingMode===De.Global){const e=this.extentHelper.viewSpatialReference,r=dv(e)||Iv(e)||Lv(e);e.isWebMercator?this.tilingScheme=Fc.WebMercatorAuxiliarySphere:r&&(this.tilingScheme=Fc.makeGCSWithTileSize(e,256)),this._set("extent",this.extentHelper.layerViewsExtent)}else{const e=this.extentHelper.layerViewsExtent;e==null||Sx(e,this.extent)||(this.tilingScheme=Fc.fromExtent(e,this.extentHelper.viewSpatialReference),this._set("extent",e))}}get test(){return{lockTilingScheme:e=>this._lockTilingScheme(e),done:!this._waitTask}}};function nAt(t,e,r){return iB(t,e,r)!=null}d([m()],dm.prototype,"tilingScheme",void 0),d([m({readOnly:!0})],dm.prototype,"extent",void 0),d([m({value:!1})],dm.prototype,"tilingSchemeLocked",void 0),d([m({constructOnly:!0})],dm.prototype,"viewSpatialReference",void 0),d([m({constructOnly:!0})],dm.prototype,"layers",void 0),d([m({constructOnly:!0})],dm.prototype,"extentHelper",void 0),d([m({constructOnly:!0})],dm.prototype,"viewingMode",void 0),dm=d([V("esri.views.3d.terrain.TilingSchemeLogic")],dm);let sAt=class{constructor(){this.offset=He(),this.scale=0,this.tile=null}init(e,r,i,n){this.tile=e,this.offset[0]=r,this.offset[1]=i,this.scale=n}dispose(){this.tile=null,this.offset[0]=0,this.offset[1]=0,this.scale=0}};var FF;let qt=FF=class extends Qn.EventedMixin(Ae){constructor(t){var e,r,i;super(t),this._scaleRangeQueries=new NF,this._iteratorPool=new ua(t4e,n=>n.remove=()=>this._iteratorPool.release(n)),this._postorderIterator=new zEt,this._hasPendingUpdates=!1,this._pendingUpdates=0,this._asyncWorkItems=0,this._allTilesDirty=!0,this._allTilesSorted=!0,this._usedMemory=null,this._performanceInfo=new iAt,this._viewChanged=!1,this._inFrameTask=!1,this._viewChangeUpdateDirty=!1,this._eyePosRenderSR=C(),this._eyePosSurfaceSR=C(),this._splitLimits=new ap,this._frustum=N$(),this._viewProjectionMatrix=xe(),this._layerViews=[new Array,new Array],this._layerIndexByUid=[new Map,new Map],this._basemapLayerViewHandles=new Map,this._watchUpdatingTracking=new Jp,this._frameTask=s3,this._allTiles=new Vt,this._upsampleInfoPool=new ua(sAt),this._shouldEmitChangeEvent=!1,this._rootTilesExtent=Wt(),this.updatingProgress=.5,this._maxNumUpdating=1,this.maxTextureScale=1.2,this._spatialReference=lt.WebMercator,this._elevationProjectorCache=new Map,this.visibleElevationBounds=new SC(1/0,-1/0),this.rootTileElevationBounds=new SC(1/0,-1/0),this._sebProjectorMap=new Map,this._sebProjectorCache=kee(),this._tilingSchemeSpatialReference=null,this._updatingRootTiles=!1,this._pendingTilesForElevationUpdateEvent=new Set,this._pendingTilesToUpdate=new Set,this.totalGeometryUpdates=0,this.totalTileUpdates=0,this._oneBatchPerFrameTask=!0,this._layerViewsDirty=!1,this.unloadedMemory=0,this.ignoresMemoryFactor=!1,this._isWebMercator=!1,this._isWebMercatorOnPlateCarree=!1,this.overlayManager=new Ul({...t,surface:this}),this._isGlobal=!((r=(e=t.view)==null?void 0:e.state)!=null&&r.isLocal),this._isGeographic=((i=this._spatialReference)==null?void 0:i.isGeographic)??!1,this._tileConstructor=this._isGlobal?ePt:J3t}initialize(){const t=this.view,e=t.resourceController;this._lercDecoder=DCt(e);const r=e.memoryController;this._tileCache=new cL((l,c)=>r.newCache(l,c),"terrain-tile"),this._upsampleMapCache=r.newCache("terrain-upsample",l=>l.unloadMapData()),this._elevationQueryCache=new ICt(r.newCache("elevation-query"));const i=this.overlayManager;this._renderer=new Ah(i.renderer,t._stage,this._allTiles,Br(t.spatialReference).radius,r),this.addHandles([he(()=>i.renderer.isEmpty,()=>this._evaluateTransparency()),he(()=>this.renderer.visible,l=>this.suspended=!l)],"overlayManager"),this.addHandles([he(()=>this.baseOpacity,()=>{this._handleLayerViewChanges(),this._updateTileTextures(this._evaluateTransparency()?ps.UNFADED:ps.IMMEDIATE)},Kr),he(()=>this.hasCompositeBlendMode,()=>this._updateTileTextures(this._evaluateTransparency()?ps.UNFADED:ps.IMMEDIATE),Kr),he(()=>this.backgroundColor,(l,c)=>{l!=null&&l.equals(c)||(this._handleLayerViewChanges(),this._renderer.updateTileBackground(l))},Qr),he(()=>this.snapLevel,()=>this._viewChanged=!0,Qr),he(()=>this.view.pointsOfInterest,l=>{this._renderer.pointsOfInterest=l,this._watchUpdatingTracking.removeAll(),l&&this._watchUpdatingTracking.add(()=>l.focus.renderLocation,()=>this._allTilesSorted=!1)}),he(()=>yi.TERRAIN_TILE_TREE_SHOW_TILES,l=>{l&&!this._treeDebugger?ge(()=>import("./TerrainTileTree3DDebugger-DbgLkkcm.js"),__vite__mapDeps([215,216])).then(({TerrainTileTree3DDebugger:c})=>{!this._treeDebugger&&yi.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new c({view:t}))}):l||(this._treeDebugger=Pe(this._treeDebugger))},gi)]);const{spatialReference:n}=t;this._extentHelper=MEt(this.viewingMode,{layers:t.map.allLayers,layerViews:t.allLayerViews,viewSpatialReference:n});const s=new v$({getCollections:()=>{var l,c;return(c=(l=t.defaultsFromMap)==null?void 0:l.mapCollections)==null?void 0:c.map(({layers:u})=>u)},getChildrenFunction:l=>l&&"layers"in l?l.layers:null}),o=new dm({layers:s,extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:n});this._set("tilingSchemeLogic",o),this._updateTilingScheme(),this._elevationDataRequester=e.createStreamDataRequester(Rm.ELEVATION),this._mapDataRequester=e.createStreamDataRequester(Rm.BASEMAP);const a=e.scheduler;this._frameTask=a.registerTask(bt.TERRAIN_SURFACE,this),this.addHandles([he(()=>this._extentHelper.stencilEnabledExtents,l=>this._renderer.setStencilEnabledLayerExtents(l),gi),he(()=>this.tilingSchemeLogic.tilingScheme,()=>this._updateTilingScheme(),Qr),he(()=>this.extent,()=>this._updateRootTiles(),gi),t.on("resize",()=>this._viewChangeUpdate()),he(()=>{const l=t.state;return[this._lodBias,this.lodSnapping,t.quality,l.camera,l.contentCamera,l.fixedContentCamera]},()=>this._viewChangeUpdate(),Kr),he(()=>{var l;return(l=t.qualitySettings)==null?void 0:l.fadeDuration},l=>this._renderer.textureFadingEnabled=l>0,gi),he(()=>{var l;return(l=t.qualitySettings)==null?void 0:l.physicallyBasedRenderingEnabled},l=>this._renderer.pbrMode=l?ot.Simplified:ot.Disabled,gi),he(()=>this._userClippingExtent,()=>this._updateClippingExtent(),Qr)]),this.addHandles(t.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0)),this._layerViewsDirty=!0,this._handleLayerViewChanges(),this._renderer.updateTileBackground(this.backgroundColor)}destroy(){this._frameTask.remove(),this._watchUpdatingTracking.destroy(),this._lercDecoder=tr(this._lercDecoder),this._removeAllTiles(),this._set("tilingSchemeLogic",Pe(this.tilingSchemeLogic)),this._basemapLayerViewHandles.forEach((t,e)=>this._unregisterTiledLayerView(e)),this._elevationDataRequester=null,this._mapDataRequester=null,this._set("overlayManager",Pe(this.overlayManager)),this._tileCache=Pe(this._tileCache),One.prune(),this._treeDebugger=Pe(this._treeDebugger),this._renderer=Pe(this._renderer),this._iteratorPool=Pe(this._iteratorPool),this._upsampleMapCache=Pe(this._upsampleMapCache),this._elevationQueryCache=Pe(this._elevationQueryCache),this._set("view",null),this._extentHelper=Pe(this._extentHelper),this._upsampleInfoPool=Pe(this._upsampleInfoPool),eEt(),h3t()}get renderer(){return this._renderer}get frustum(){return this._frustum}get snapLevel(){var t,e;if(this.lodSnapping===yR.ON){const r=this.view,i=this.tilingScheme,n=(e=(t=r.pointsOfInterest)==null?void 0:t.cameraOnSurface)==null?void 0:e.scale;if(i&&n){const s=r.state.contentCamera;let o=j9(r,s.eye,s.viewForward,s.up).tilt;o>90&&(o=180-o);const a=2*(o/90)**2,l=i.levelAtScale(n)-a,c=Math.min(l+r.qualitySettings.tiledSurface.lodBias,this._splitLimits.maxLod||1/0);return c<=0?null:c}}return null}get lodSnapping(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?yR.ON:yR.OFF}get upsampleInfoPool(){return this._upsampleInfoPool}get upsampleMapCache(){return this._upsampleMapCache}get elevationQueryCache(){return this._elevationQueryCache}get mapTileRequester(){return this._mapDataRequester}get _userClippingExtent(){const{spatialReference:t}=this,{clippingArea:e}=this.view;if(e==null||t==null)return null;const r=Wt(),i=vNe(e,r,t)?r:null,n=this._get("extent");return Sx(i,n)?n:i}get rootTilesExtent(){return this._rootTilesExtent}get extent(){const t=zW(this.groundExtent,this._userClippingExtent,Wt()),e=this._get("extent");return Sx(t,e)?e:t}get groundExtent(){return this._tilingSchemeExtent!=null?this._tilingSchemeExtent:this._rootTilesExtent}get _tilingSchemeExtent(){var t;return(t=this.tilingSchemeLogic)==null?void 0:t.extent}get updating(){var t,e;return this._hasPendingUpdates||(this._maxNumUpdating=1),!!((this.running||(t=this._watchUpdatingTracking)!=null&&t.updating||this._asyncWorkItems>0)&&this.ready&&!this.suspended||(e=this.overlayManager)!=null&&e.updating)}get running(){return(this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||!this._allTilesSorted||this._layerViewsDirty||this._scaleRangeQueries.updating||this._frameTask.updating)&&this.ready&&!this.suspended}get updatingProgressValue(){return this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating),1-this._pendingUpdates/this._maxNumUpdating}get baseOpacity(){var t,e,r;return((r=(e=(t=this.view)==null?void 0:t.map)==null?void 0:e.ground)==null?void 0:r.opacity)??1}set baseOpacity(t){this.view.map.ground.opacity=t}get viewingMode(){return this.view.state.viewingMode}get ready(){return this._rootTiles!=null}set renderOrder(t){this._renderer.renderOrder=t,this._set("renderOrder",t)}get rootTiles(){return this._rootTiles}get spatialReference(){var t;return((t=this.tilingScheme)==null?void 0:t.spatialReference)??null}get backgroundColor(){var t,e,r;return(r=(e=(t=this.view)==null?void 0:t.map)==null?void 0:e.ground)==null?void 0:r.surfaceColor}set backgroundColor(t){this.view.map.ground.surfaceColor=t}set slicePlaneEnabled(t){this._renderer.slicePlaneEnabled=t,this._set("slicePlaneEnabled",t),this._evaluateTransparency()}get tilingSchemeLocked(){var t;return((t=this.tilingSchemeLogic)==null?void 0:t.tilingSchemeLocked)??!1}get wireframe(){var t;return(t=this._renderer)==null?void 0:t.wireframe}set wireframe(t){t!==this._renderer.wireframe&&(this._renderer.wireframe=t,this._updateAllTileGeometries())}get opaque(){return this._renderer.transparency===fl.Opaque}set suspended(t){this._set("suspended",t),this._viewChangeUpdate()}get fadeDuration(){return this.view.qualitySettings.fadeDuration??0}intersect(t,e,r,i){this._renderer.intersect(t,e,r,i)}getElevation(t,e,r,i){const n=this._rootTiles;if(!(n!=null&&n.length)||n[0].layerInfo[Gt.ELEVATION].length===0)return null;let s=this._elevationProjectorCache.get(i);if(s===void 0&&(s=lv(i,this._spatialReference)??null,this._elevationProjectorCache.set(i,s)),s==null)return re.getLogger(this).error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;const o=ie(wA,t,e,r);return s(o,0,o,0),f0e(n,o[0],o[1])}getElevations(t,e,r){const i=this._rootTiles,n=i?i[0].layerInfo[Gt.ELEVATION].length:0;if(i!=null&&i.length&&n!==0)for(let s=0;s<e;++s){const o=3*s;r(s,f0e(i,t[o],t[o+1]))}else for(let s=0;s<e;++s)r(s,null)}getScale(t){if(!this.tilingScheme)return null;if(!_n(t,wA,this.spatialReference))return re.getLogger(this).error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),null;const e=this._rootTiles;if(e!=null){for(const r of e)if(r!=null&&r.containsPoint(wA)){let i=r;for(;i.children[0]&&!i.rendered;){const n=i.children[0].extent;let s=0;wA[0]>n[2]&&(s+=1),wA[1]<n[1]&&(s+=2),i=i.children[s]}return this._getLodBiasCorrectedScale(i.level)}}return 1/0}_ensureSEBProject(t){const e=this._sebProjectorMap.get(t);if(e)return e;const r=lv(t,this._tilingSchemeSpatialReference,this._sebProjectorCache)??null;return this._sebProjectorMap.set(t,r),r}getSphereElevationBounds(t,e){const r=this._ensureSEBProject(e);if(r==null)return re.getLogger(this).error("TerrainSurface.getSphereElevationBounds(): could not project given point to tiling scheme coordinate system"),null;a2(t,YT);const i=YT;r(i,0,i,0);const n=new B8,s=this._rootTiles;if(s!=null){const o=[];for(const l of s)o.push(l);let a=0;for(;a<o.length;){const l=o[a];if(++a,!Uae(l.extent,YT))continue;const c=l.children;if(c[0]==null||l.rendered)n.expandElevationRangeValues(l.elevationBoundsMin,l.elevationBoundsMax);else for(const u of c)o.push(u)}}return n}getRootElevationBounds(){return new B8(this.rootTileElevationBounds.min,this.rootTileElevationBounds.max)}getSphereScale(t,e){if(!this.tilingScheme)return null;if(!_n(t,YT,this.spatialReference))return re.getLogger(this).error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),null;YT[3]=e;let r=null;const i=s=>{if(s&&Uae(s.extent,YT)){const o=s.children;if(o[0]&&!s.rendered)for(const a of o)i(a);else{const a=this._getLodBiasCorrectedScale(s.level);r=r==null?a:Math.min(r,a)}}},n=this._rootTiles;if(n!=null)for(const s of n)i(s);return r}queryVisibleScaleRange(t,e,r,i){const n=e?this.tilingScheme.levelAtScale(e):0,s=r?this.tilingScheme.levelAtScale(r):1/0,o=this._lodBias;this._scaleRangeQueries.queryVisibleLevelRange(t,n+o,s+o,i)}_evaluateTransparency(){var s,o;const t=this.baseOpacity,e=this.overlayManager.renderer.isEmpty,r=this._renderer.transparency,i=this._allSurfaceLayersTransparent()?e?fl.Empty:fl.TransparentWithDraped:t>=1&&!this.hasCompositeBlendMode&&!this._renderer.slicePlaneEnabled?fl.Opaque:fl.Semitransparent,n=r!==i;return n&&(this._renderer.transparency=i,(o=(s=this.view)==null?void 0:s._stage)==null||o.renderer.setParameters({terrainTransparency:this._renderer.transparency})),n}_updateTilingScheme(){var r,i,n,s;const t=this.tilingSchemeLogic.tilingScheme;if(t===this.tilingScheme)return;Ss(!!t,"tiling scheme cannot be reset to undefined"),this._isGlobal=!((i=(r=this.view)==null?void 0:r.state)!=null&&i.isLocal),this.tilingScheme&&this._removeAllTiles();const e=(t==null?void 0:t.spatialReference)??lt.WebMercator;this._spatialReference=e,this._isWebMercator=!!(e!=null&&e.isWebMercator),this._isWebMercatorOnPlateCarree=this._isWebMercator&&h$((n=this.view)==null?void 0:n.renderSpatialReference),this._isGeographic=(e==null?void 0:e.isGeographic)??!1,this._set("tilingScheme",t),this._tilingSchemeSpatialReference=(s=this.tilingScheme)==null?void 0:s.spatialReference,this._sebProjectorMap.clear(),this._updateClippingExtent(),t&&(this._updateTiledLayers(),this._renderer.setTileSize(t.pixelSize),this.overlayManager.setSpatialReference(t.spatialReference),this._updateRootTiles())}_acquireTile(t,e,r,i){const n=this._tileCache.pop(FF._tileMemcacheKey);return n?(n.init(t,e,r,i,this),n):new this._tileConstructor(t,e,r,i,this)}get updatingRootTiles(){return this._updatingRootTiles}_updateRootTiles(){const{extent:t,tilingScheme:e}=this;if(!e)return;const r=aAt;let i=e.rootTilesInExtent(t,r,5*oC);if(this._rootTiles!=null){if(i.length>oC)return void re.getLogger(this).warn(UQe);const n=this._rootTiles.map(o=>o.lij),s=BH(n,i,LF);if(this._updatingRootTiles=!0,s.removed.length>0||s.added.length>0){const o=this._rootTiles.filter(a=>!(s.removed.findIndex(l=>LF(l,a.lij))>-1)||(this._purgeTile(a),!1));s.added.forEach(a=>o.push(this._newRootTile(a))),this._setRootTiles(o)}}else this._updatingRootTiles=!0,i.length>oC&&(re.getLogger(this).warn(BQe),i=e.rootTilesInExtent(t,r,oC)),this._setRootTiles(i.map(n=>this._newRootTile(n)));Sx(r,this._rootTilesExtent)||(this._rootTilesExtent=Wt(r)),this.renderer.visible=!0,this._viewChangeUpdate(),this.overlayManager.setPlacementDirty(),this.notifyChange("ready"),this._updateAllTileGeometries(),this._updatingRootTiles=!1,this.checkAllTilesWaterproofness()}_updateAllTileGeometries(){const t=this._allTiles.filter(e=>e.isLoaded&&e.intersectsClippingArea);t.forEach(e=>this._renderer.updateTileGeometryState(e)),t.forEach(e=>e.renderData.updateNeighborData()),this._updateTilesGeometries(t),this._pendingTilesToUpdate.clear()}_updateTilesGeometries(t){if(t.length===0)return;t.sort(H0);const e=this.renderer;t.forEach(r=>e.updateGeometryIfNeeded(r)),t.forEach(r=>this._pendingTilesForElevationUpdateEvent.add(r))}_shouldSplit(t){return t.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.snapLevel)===at.SPLIT}_newRootTile(t){const e=this._acquireTile(0,t[1],t[2],null);return this._shouldSplit(e)&&e.setPendingUpdate(at.SPLIT),this._loadTile(e),this._markTileToUpdate(e),this._updateRootTileElevationBounds(),e}_setRootTiles(t){if(this._rootTiles=t,this._allTiles.clear(),t!=null){const e=this._iteratorPool.acquire();for(e.reset(t);!e.done;)this._allTiles.push(e.next());e.remove()}this._renderer.setRootTiles(this._rootTiles),this._updateTilesVisibility(t)}_runViewChangeUpdateIfDirty(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())}_viewChangeUpdate(){this.view&&!this.suspended&&this.tilingScheme&&this.renderer.visible&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateTilesVisibility(this._rootTiles)))}_updateClippingStatus(t){t.updateClippingStatus(this.extent)&&t.resetPendingUpdate(at.GEOMETRY)&&this._updateTileGeometryState(t)}_updateTilesVisibility(t){if(t==null)return;const e=WEt(t),r=this.visibleElevationBounds;let i=e?r.min:1/0,n=e?r.max:-1/0;const s=this.extent,o=this._viewProjectionMatrix;this.setTileTreeDirty();const a=this._iteratorPool.acquire();for(a.reset(t);!a.done;){const l=a.next();l.updateClippingStatus(s)&&l.resetPendingUpdate(at.GEOMETRY)&&this._updateTileGeometryState(l),l.computeVisibility(),l.updateScreenDepth(o),l.renderData&&(i=Math.min(l.elevationBoundsMin,i),n=Math.max(l.elevationBoundsMax,n))}a.remove(),this._viewChanged=!0,this._allTilesDirty=!0,this._updatePendingTileGeometries(),isFinite(i)&&isFinite(n)&&(r.min!==i||r.max!==n)&&(this.visibleElevationBounds=new SC(i,n))}_updateRootTileElevationBounds(){let t=1/0,e=-1/0;const r=this._rootTiles;r!=null&&r.forEach(({elevationBoundsMin:n,elevationBoundsMax:s})=>{t=Math.min(t,n),e=Math.max(e,s)});const i=this.rootTileElevationBounds;i.min===t&&i.max===e||(this.rootTileElevationBounds=new SC(t,e))}_updateViewDependentParameters(){const{camera:t,contentCamera:e}=this.view.state,r=Math.tan(.5*e.fovX),i=Math.tan(.5*e.fovY),n=this.tilingScheme.pixelSize,s=2**-this._lodBias*t.pixelRatio;this._splitLimits.aboveGround=t.aboveGround,this._splitLimits.fovX=r,this._splitLimits.fovY=i,this._splitLimits.relativeWidthLimit=n/t.width*this.maxTextureScale*s,this._splitLimits.relativeHeightLimit=n/t.height*this.maxTextureScale*s,this._splitLimits.maxLod=this.tilingScheme.getMaxLod(),this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias,this.view.state.fixedContentCamera?this._splitLimits.frustum=G6(this._splitLimits.frustum??N$(),e.frustum):this._splitLimits.frustum=null,G6(this._frustum,t.frustum),Hr(this._viewProjectionMatrix,e.projectionMatrix,e.viewMatrix),ce(this._eyePosRenderSR,e.eye),ka(t.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)}_updateTileGeometryState(t){t.updateVisibility(),this._renderer.updateTileGeometryState(t)&&this._markTileToUpdate(t),this._usedMemory=null}_markAllTileNeighborsForUpdate(t){t.forEachLoadedNeighbor(e=>{this._layerViews[Gt.MAP].some(kx)&&e.setPendingUpdate(at.TEXTURE_FADING),this._pendingTilesToUpdate.add(e)})}_updateTileTexture(t,e){const r=t.resetPendingUpdate(at.TEXTURE_FADING)?at.TEXTURE_FADING:!!t.resetPendingUpdate(at.TEXTURE_NOFADING)&&at.TEXTURE_NOFADING;r&&(this._renderer.updateTileTexture(t,r),this._usedMemory=null,e.madeProgress())}_emitElevationUpdateEventForTiles(){if(!this._shouldEmitChangeEvent)return;const t=fj.extent;Ku(t),this._pendingTilesForElevationUpdateEvent.forEach(e=>V1(t,e.extent,t)),this._pendingTilesForElevationUpdateEvent.clear(),fj.spatialReference=this.spatialReference,this.emit("elevation-change",fj),this._shouldEmitChangeEvent=!1}runTask(t){this._handleLayerViewChanges(t),this._frameTask.processQueue(t),this.renderer.processScaleRangeQueries(this._scaleRangeQueries,t),this._inFrameTask=!0,this._pendingUpdates=0,this._hasPendingUpdates=!1,this._updateAllTilesStatus(t),this._sortTiles(t);const e=!this.view.state.fixedContentCamera;if(this._mergeAndSplit(t,e),this._updateElevation(t),this._updateTextures(t),e||this._mergeAndSplit(t,!0),this._inFrameTask=!1,this._runViewChangeUpdateIfDirty(),this._updatePendingTileGeometries(),this._emitElevationUpdateEventForTiles(),t.done&&t.hasProgressed&&this.requestUpdate(),this.notifyChange("updatingProgressValue"),Ys&&this._checkTileInvariant(),!t.hasProgressed)return Ho}_checkTileInvariant(){const t=new Map;this._allTiles.forAll(e=>t.set(e,new Set)),this._allTiles.forAll(e=>{var r;if(Ss(e.rendered===e.isLeaf,` rendered ${e.rendered} != ${e.isLeaf} leaf`),!e.isLeaf){const i=s=>s.unmergableChildCount===0&&s.maxLevelDeltaNeighborCount===0,n=e.children.reduce((s,o)=>s+(i(o)?0:1),0);if(Ss(e.unmergableChildCount===n,` Tile[${e.lij.toString()}] unmergeable child count mismatch: actual ${e.unmergableChildCount} vs ${n}`),e.hasPendingUpdate(at.MERGE)){Ss(!e.hasPendingUpdate(at.SPLIT),"Tile can be both split and merge at the same time");for(const s of e.children)Ss(s.isLeaf||s.hasPendingUpdate(at.MERGE),"Child of tile to merge must also merge")}}for(let i=0;i<4;++i){if(e.rendered){const a=(r=e.renderData)==null?void 0:r.geometryState.edgePeerNeighbors[i];if(a!=null){{const l=e.level-a.level<=Ps;l||(console.log(`tile level delta [${e.lij.toString()}] vs [${a.lij.toString()}] > ${Ps}  (edge[${i}])`),Ss(l,`tile level delta [${e.level}] vs [${a.level}] > ${Ps}`))}Ss(e.level-a.level<=Ps,`Max tile lod delta exceeded: [${e.lij.toString()}] vs [${a.lij.toString()}]`)}}const n=e.level-Ps,s=a=>a.isLeaf||a.level===e.level,o=e.findNeighborTile(jp[i],s);if(o!=null){if(e.isLeaf&&e.level>=Ps){let a=o;for(;e.level-a.level<Ps;)a=a.parent;const l=[n,e.lij[1]>>Ps,e.lij[2]>>Ps];if(!LF(l,a.lij)){const c=t.get(a);Ss(!c.has(e),"Cannot already have neighbor"),c.add(e)}}Ss(o.rendered||o.level===e.level,"Non-same-level-neighbor of rendered must be rendered"),Ss(e.level-o.level<=Ps,`Tile level delta [${e.level}] vs [${o.level}] > ${Ps}`)}}}),this._allTiles.forAll(e=>{const r=e.maxLevelDeltaNeighborCount,i=t.get(e);Ss(r===i.size,`Tile[${e.lij.toString()}] merge-blocker mismatch: actual ${r} vs ${i.size}`)})}_updateAllTilesStatus(t){if(!this._viewChanged||!this._rootTiles||t.done)return;this._viewChanged=!1;const e=new lAt(this._allTiles.length);e.pushAll(this._rootTiles);const r=this.snapLevel,i=this._splitLimits,n=this._eyePosRenderSR;this._allTiles.forAll(o=>{o.maxLevelDeltaNeighborCount=0,o.unmergableChildCount=0});const s=this._viewProjectionMatrix;for(;!e.empty;){const o=e.pop(),a=o.parent,l=a!=null&&a.hasPendingUpdate(at.MERGE),c=l?at.MERGE:o.shouldSplit(i,n,r),u=c===at.SPLIT;o.isLeaf?mj(o,u):e.pushAll(o.children),l?(o.resetPendingUpdate(at.SPLIT),o.isLeaf||o.setPendingUpdate(at.MERGE),this._updateClippingStatus(o),o.updateVisibility(),o.updateScreenDepth(s)):u?(o.resetPendingUpdate(at.MERGE),o.isLeaf&&o.setPendingUpdate(at.SPLIT)):(o.resetPendingUpdate(at.SPLIT)&&o.updateAgentSuspension(),c===at.ELEVATION&&o.updateAgents(Gt.ELEVATION),o.isLeaf||(o.setPendingUpdate(at.MERGE),o.resetPendingUpdate(at.SPLIT)))}this.requestUpdate(),(this._shortBatches||!this._oneBatchPerFrameTask)&&this._updatePendingTileGeometries(),t.madeProgress()}_sortTiles(t){t.done||this._allTilesSorted||(jEt(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),t.madeProgress())}_markTileToUpdate(t){Re(t.isLoaded),t.intersectsClippingArea&&(this._pendingTilesToUpdate.add(t),this._markAllTileNeighborsForUpdate(t))}_updatePendingTileGeometries(){const t=this._pendingTilesToUpdate,e=Array.from(t.keys()).filter(n=>n.isLoaded&&n.intersectsClippingArea);if(e.length===0)return void t.clear();const r=(n,s)=>{!(s!=null&&s.isLoaded)||!s.intersectsClippingArea||s.level<n.level||t.has(s)||(t.add(s),e.push(s),s.renderData.updateNeighborData())};e.sort(H0);const i=e.length;for(let n=0;n<i;++n){const s=e[n];Re(s.isLoaded),Re(s.intersectsClippingArea);const o=s.renderData;o.updateNeighborData();const a=o.dirtyEdgeResolutions,l=o.geometryState,c=u=>{var p;const h=H8[u];r(s,(p=l.cornerPeerNeighbors[u])==null?void 0:p.findCorner(j8(h),f=>f.isLoaded))};for(let u=0;u<4;++u)if(a&1<<u){const h=o.geometryState.edgePeerNeighbors[u];h&&(h==null?void 0:h.level)>=s.level&&h.forAllSubtreeOnSide(Pne(jp[u]),p=>!(!p.isLoaded||!p.intersectsClippingArea)&&(Re(t.has(p)||H0(s,p)<0),r(s,p),!0)),c((u+1)%4),c(u)}}t.clear(),this._updateTilesGeometries(e),this._shouldEmitChangeEvent=!0,Ys&&V8&&this.checkAllTilesWaterproofness()}_mergeAndSplit(t,e){if(this.suspended||t.done||!this._allTilesDirty)return;this._allTilesDirty=!1,this.requestUpdate();let r=!1;const i=this.view.state.fixedContentCamera;let n=!1;for(;!t.done;){n=!0;let s=!1;const o=!this._allTiles.some(a=>{if(!r&&!i&&!a.visible)return t.done;let l=a;if(a.hasPendingUpdate(at.MERGE)){if(!e||a.unmergableChildCount>0)return t.done;for(a.resetPendingUpdate(at.MERGE);l.parent!=null&&l.parent.unmergableChildCount===0&&l.parent.resetPendingUpdate(at.MERGE);)l=l.parent;this._mergeTile(l),s=!0,t.madeProgress()}else if(a.resetPendingUpdate(at.SPLIT)){let c=!0;const u=a.level;if(u>=Ps){const h=p=>p.isLeaf||u-p.level<Ps;for(let p=0;p<4;++p){const f=a.findNeighborTile(jp[p],h);f!=null&&u-f.level===Ps&&(c=!1,Ys&&(Re(f.isLeaf),Re(f.hasPendingUpdate(at.SPLIT))))}}c?(this._splitTile(a),t.madeProgress(),s=!0):a.setPendingUpdate(at.SPLIT)}return t.done});if(s&&(this._allTilesSorted=!1,this._allTilesDirty=!0,!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries()),o){if(!r){r=!0;continue}if(!s)break}else this._allTilesDirty=!0}n?t.madeProgress():this._allTilesDirty=!0,!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries(),this._sortTiles(t)}_updateElevation(t){t.done||(this._allTiles.some(e=>(e.resetPendingUpdate(at.GEOMETRY)&&(this._updateTileGeometryState(e),this._shortBatches&&this._updatePendingTileGeometries(),t.madeProgress()),t.done)),!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries())}_updateTextures(t){t.done||this._allTiles.some(e=>(this._updateTileTexture(e,t),t.done))}_updateClippingExtent(){this.spatialReference&&(this.updateTileOverlayParams(Dn.UPDATE),this.overlayManager.setPlacementDirty(),this._updateRootTiles())}get _lodBias(){const t=this.view.quality;return this.view.qualitySettings.tiledSurface.lodBias-(1-t)*kQe}_getLodBiasCorrectedScale(t){const e=this.tilingScheme.levels,r=we(t-this._lodBias,0,e.length-1),i=r-Math.floor(r);return e[Math.floor(r)].scale*(1-i)+e[Math.ceil(r)].scale*i}_removeAllTiles(){this._rootTiles!=null&&(this._rootTiles.forEach(t=>this._purgeTile(t)),this._setRootTiles(null),this.notifyChange("ready")),this._allTiles.clear(),this.renderer.visible=!1}_purgeDescendantTiles(t){if(!t.children[0])return;const e=t.children.slice();t.unsetChildren();for(let r=0;r<4;++r)this._purgeTile(e[r])}_purgeTile(t){t.isLeaf?m0e(t):this._purgeDescendantTiles(t),this._allTiles.removeUnordered(t),this._unloadTile(t),this._tileCache.put(FF._tileMemcacheKey,t)}_unloadTile(t){this._pendingTilesToUpdate.delete(t),this._pendingTilesForElevationUpdateEvent.delete(t),t.unload(this._renderer)}_splitTile(t){Ss(t.isLeaf,"Tile that is already split should not be split again!"),Ss(t.rendered,"Tile marked to split is not rendered"),m0e(t);const e=t.level+1,r=2*t.lij[1],i=2*t.lij[2],n=t.setChildren(this._createTile(e,r,i,t),this._createTile(e,r,i+1,t),this._createTile(e,r+1,i,t),this._createTile(e,r+1,i+1,t));this._allTiles.pushArray(n),t.updateAgentSuspension(),Ss(t.rendered,"parent should be rendered"),this._unloadTile(t),n.forEach(s=>this._loadTile(s)),n.forEach(s=>this._pendingTilesToUpdate.add(s)),this._markAllTileNeighborsForUpdate(t),this._emitTileScaleChange(t,t.level+1),this._allTilesDirty=!0,this._shortBatches&&this._updatePendingTileGeometries(),n.forEach(s=>mj(s,s.hasPendingUpdate(at.SPLIT))),++this._performanceInfo.numSplit}_emitTileScaleChange(t,e=t.level){S4.spatialReference=this.spatialReference,S4.extent=t.extent,S4.scale=this._getLodBiasCorrectedScale(e),this.emit("scale-change",S4)}_createTile(t,e,r,i){Ss(!!i,"_createTile sanity check");const n=this._acquireTile(t,e,r,i);return n.updateClippingStatus(this.extent),n.updateScreenDepth(this._viewProjectionMatrix),this._shouldSplit(n)&&n.setPendingUpdate(at.SPLIT),n}get _shortBatches(){return this.view.state.mode!==Ur.IDLE}_mergeTile(t){Ss(!t.hasPendingUpdate(at.SPLIT),"_mergeTile sanity check"),Ss(!t.isLeaf,"Cannot merge a leaf"),t.isLeaf||(this._purgeDescendantTiles(t),Ss(!t.renderData,"_mergeTile sanity check"),this._loadTile(t),this._markTileToUpdate(t),this._emitTileScaleChange(t),this._shortBatches&&this._updatePendingTileGeometries(),mj(t,!1),this._allTilesDirty=!0,++this._performanceInfo.numMerged)}_loadTile(t){t.load(),this.requestUpdate(),this._allTilesDirty=!0,this.overlayManager&&this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(t)}_elevationDataArrived(t,e,r){const i=new nEt(t.lij,t.extent,r);t.dataArrived(e,Gt.ELEVATION,i);const n=[t],s=t.level,o=this._iteratorPool.acquire();for(o.reset(n);!o.done;){const a=o.next();a.findElevationBoundsForLayer(e,s),a.computeElevationBounds()}s===0&&this._updateRootTileElevationBounds(),o.remove(),this._updateTilesVisibility(n)}_handleLayerViewChanges(t=yl){if(!this._layerViewsDirty)return;this._layerViewsDirty=!1;let e=!1;const r=new Set;let i=-1;for(let n=this.view.allLayerViews.length-1;n>=0;n--){const s=this.view.allLayerViews.items[n];if(r.add(s.uid),EJ(s)||vA(s))if(this._basemapLayerViewHandles.has(s.uid)&&!vA(s)){const o=this._layerClassFromLayerView(s),a=this._getLayerIdxByUID(o,s.uid);a!=null&&((a<i||i==null)&&(e=!0),i=a)}else this._registerTiledLayerView(s),s.layer.loaded&&(e=!0)}this._basemapLayerViewHandles.forEach((n,s)=>{r.has(s)||(this._unregisterTiledLayerView(s),e=!0)}),e&&this._updateTiledLayers(),this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._evaluateTransparency(),t.madeProgress()}_allSurfaceLayersTransparent(){var e,r;let t=((r=(e=this.view.map)==null?void 0:e.ground)==null?void 0:r.opacity)===0;for(const i of this.view.allLayerViews.items)if(CJ(i)&&!c5(i.layer)&&i.fullOpacity!==0)return t=!1,t;return t}_hasCompositeBlendMode(){for(const t of this.view.allLayerViews.items)if((oI(t)||vA(t))&&QEt(MJ[t.layer.blendMode]))return!0;return!1}_layerClassFromLayerView(t){return SJ(t)?Gt.ELEVATION:Gt.MAP}_registerTiledLayerView(t){const e=[];if((oI(t)||vA(t))&&e.push(he(()=>t.layer.blendMode,()=>{this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._updateTileTextures(ps.UNFADED)})),!vA(t)){const r=this._layerClassFromLayerView(t);e.push(he(()=>t.suspended,()=>this._updateTiledLayers())),e.push(he(()=>t.fullOpacity,()=>this._updateTileTextures(ps.UNFADED))),e.push(he(()=>"effectiveScaleRange"in t.layer?t.layer.effectiveScaleRange:null,()=>this._restartAllAgents(r))),e.push(t.on("data-changed",()=>{const i=this._getLayerIdxByUID(r,t.uid);i!=null&&this._invalidateLayerData(i,r)}))}this._unregisterTiledLayerView(t.uid),this._basemapLayerViewHandles.set(t.uid,e)}_unregisterTiledLayerView(t){const e=this._basemapLayerViewHandles.get(t);if(e){for(const r of e)r.remove();this._basemapLayerViewHandles.delete(t)}}_updateTiledLayers(){if(!this.tilingScheme||this.view.suspended)return;const t=this.view.allLayerViews,e=[[],[]];let r=null;t.forEach(i=>{if(!i.layer||i.suspended||!EJ(i)||!i.fullExtent)return;const n=this._layerClassFromLayerView(i);if(n===Gt.MAP){const s=i.displayLevelRange.maxLevel;s!==1/0&&(r===null||s>r)&&(r=s)}e[n].push(i)});for(const i of Ew){const n=this._layerViews[i],s=e[i];s.reverse();const o=s.length;let a=n.length!==o;const l=new Array(o),c=new Array(n.length);this._layerIndexByUid[i].clear();for(let u=0;u<o;u++){const h=s[u].uid;this._layerIndexByUid[i].set(h,u);const p=n.indexOf(s[u]);l[u]=p,u!==p&&(a=!0),p>-1&&(c[p]=u)}if(a){const u=this._postorderIterator;for(u.reset(this._rootTiles);!u.done;)u.next().modifyLayers(c,l,i);this._layerViews[i]=s,this._restartAllAgents(i),this._updateTilesVisibility(this._rootTiles)}}this.tilingScheme.ensureMaxLod(r)&&this._viewChangeUpdate()}_restartAllAgents(t){const e=this._postorderIterator;for(e.reset(this._rootTiles);!e.done;){const r=e.next();r.restartAgents(t),t===Gt.ELEVATION&&r.computeElevationBounds()}this._updateRootTileElevationBounds()}layerViewByIndex(t,e){return this._layerViews[e][t]}numLayers(t){return this._layerViews[t].length}_updateTileTextures(t){this._allTiles.forAll(e=>{e.updateAgents(Gt.MAP),t===ps.IMMEDIATE?this.renderer.updateTileTexture(e,at.TEXTURE_NOFADING):e.updateRenderData(Gt.MAP,t)}),this._evaluateTransparency()}_invalidateLayerData(t,e){this._allTiles.forAll(r=>r.removeLayerAgent(t,e)),this._allTiles.forAll(r=>r.invalidateLayerData(t,e))}setTileTreeDirty(){this._allTilesDirty=!0}requestRender(t=Dn.UPDATE){this.renderer.setNeedsRender(t)}requestUpdate(){++this._pendingUpdates==1&&(this._hasPendingUpdates=!0)}requestTileData(t,e,r,i){const n=this.layerViewByIndex(e,r),s=n.layer;return!s.tilemapCache||kx(n)?this._requestTileData(t,r,n,i):(++this._asyncWorkItems,s.tilemapCache.fetchAvailability(t.lij[0],t.lij[1],t.lij[2],{...i,timeout:6e3}).then(()=>--this._asyncWorkItems).catch(o=>{throw--this._asyncWorkItems,vt(i),_s(o)||this._dataMissing(t,r,n,{notInTilemap:!0}),o}).then(()=>this._frameTask.schedule(()=>this._requestTileData(t,r,n,i),i.signal)))}_requestTileData(t,e,r,i){return e===Gt.ELEVATION?SJ(r)?this._requestElevationTileData(t,r,i):Promise.reject():CJ(r)?this._requestMapTileData(t,r,i):Promise.reject()}_requestElevationTileData(t,e,r){++this._asyncWorkItems;const i=o=>{if(Ls(r))return;const a=this._layerIndexByUid[Gt.ELEVATION].get(e.uid);a!=null?(this._usedMemory=null,this.requestUpdate(),this._elevationDataArrived(t,a,o)):re.getLogger(this).warn("TerrainSurface: received data from unknown layer %d %s",Gt.ELEVATION,t.lij.toString())},n=o=>{_s(o)||(this._dataMissing(t,Gt.ELEVATION,e,o),this.requestUpdate())};if(Bge(e.layer))return e.layer.fetchTile(t.lij[0],t.lij[1],t.lij[2],{noDataValue:A$,signal:r.signal}).then(o=>{if(!Ls(r))return this._frameTask.schedule(()=>i(o),r.signal,n);re.getLogger(this).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true.")},n).finally(()=>{--this._asyncWorkItems});const s=e.getTileUrl(t.lij[0],t.lij[1],t.lij[2]);return this._elevationDataRequester.request(s,"binary",r).then(o=>this._lercDecoder.decode(o,{noDataValue:A$},r.signal)).then(o=>{o?i(new LCt(o)):n(new Error("LERC decoding failed"))},n).finally(()=>{--this._asyncWorkItems})}_requestMapTileData(t,e,r){++this._asyncWorkItems;const i=(c,u)=>{--this._asyncWorkItems,hE(u),Ls(r)||(this._dataMissing(t,Gt.MAP,e,c),this.requestUpdate())},n=c=>u=>i(u,c),s=c=>this._frameTask.schedule(()=>{--this._asyncWorkItems,this.requestUpdate(),Ls(r)?hE(c):this._mapTileDataArrived(t,e,c)},r.signal,n(c)).catch(n(c)),o=(c,u=null)=>this._frameTask.schedule(()=>i(c,u));if(kx(e)){const c=e.schemaHelper.getLevelRowColumn(t.lij);return e.fetchTile(c[0],c[1],c[2],r).then(s,o)}if(rB(e))return e.fetchTile(t.lij[0],t.lij[1],t.lij[2],r).then(s,o);if(Cne(e)&&Bge(e.layer))return e.layer.fetchTile(t.lij[0],t.lij[1],t.lij[2],r).then(c=>{if(Ls(r))return re.getLogger(this).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),void o(dr());s(c)},o);let a=e.getTileUrl(t.lij[0],t.lij[1],t.lij[2]);$Ct(e.layer)&&e.layer.refreshTimestamp&&(a+=`${a.includes("?")?"&":"?"}_ts=${e.layer.refreshTimestamp}`);const l=e.hasMixedImageFormats?"image+type":"image";return this._mapDataRequester.request(a,l,r).then(s,o)}_mapTileDataArrived(t,e,r){const i=this._getLayerIdxByUID(Gt.MAP,e.uid);i!=null?t.dataArrived(i,Gt.MAP,r):(hE(r),re.getLogger(this).warn("TerrainSurface: received data from unknown layer"))}_getLayerIdxByUID(t,e){return this._layerIndexByUid[t].get(e)}_dataMissing(t,e,r,i){const n=this._getLayerIdxByUID(e,r.uid);n!=null?t.dataMissing(n,e,i):re.getLogger(this).warn("TerrainSurface: received data from unknown layer")}updateTileOverlayParams(t){this._rootTiles&&this.overlayManager&&(this._allTiles.forAll(e=>{e.renderData&&this.overlayManager.setTileParameters(e)}),this._renderer.setNeedsRender(t))}get performanceInfo(){const t=this._performanceInfo;return t.numNodes=this._allTiles.length,t.numLeaves=t.numVisible=t.numRendered=t.numLoadedPerLevel.length=t.numRenderedPerLevel.length=0,this._allTiles.forAll(e=>{e.isLeaf&&t.numLeaves++;const r=e.level;e.renderData&&(t.numLoadedPerLevel[r]=(t.numLoadedPerLevel[r]||0)+1),e.visible&&(t.numVisible++,e.rendered&&(t.numRenderedPerLevel[r]=(t.numRenderedPerLevel[r]||0)+1,t.numRendered++))}),t}get usedMemory(){return this.tilingScheme?(this._usedMemory==null&&(this._usedMemory=this._recalculateUsedMemory()),this._usedMemory??0):0}_recalculateUsedMemory(){return this.tilingScheme?Math.round(this._allTiles.reduce((t,e)=>t+e.usedMemory,0)):null}getUsedMemoryForLayerView(t){let e=0;const r=this._layerClassFromLayerView(t),i=this._getLayerIdxByUID(r,t.uid);return i!=null&&this._allTiles.forAll(n=>e+=n.getUsedMemoryForLayer(r,i)),e}getTile(t){if(t==null||this._rootTiles==null)return null;const e=t.split("/").map(o=>+o);if(e[0]===0)return this._rootTiles.find(o=>o.lij[1]===e[1]&&o.lij[2]===e[2]);const r=e[0],i=e[1]>>r,n=e[2]>>r;let s;if(this._rootTiles.some(o=>o.lij[1]===i&&o.lij[2]===n&&(s=o,!0)),s){let o=1<<e[0]-1;for(;s.lij[0]<e[0];){let a=e[1]&o?2:0;if((e[2]&o)>0&&a++,!s.children[a])return null;s=s.children[a],o>>=1}return Ss(s.lij[0]===e[0]&&s.lij[1]===e[1]&&s.lij[2]===e[2],"not the right tile?"),s}return null}get renderPatchBorders(){return this._renderer.renderPatchBorders}set renderPatchBorders(t){this._renderer.renderPatchBorders=t}get visualizeNormals(){return this._renderer.visualizeNormals}set visualizeNormals(t){this._renderer.visualizeNormals=t}get renderingDisabled(){return this._renderer.renderingDisabled}set renderingDisabled(t){this._renderer.renderingDisabled=t}get test(){const t=this;return{renderer:t._renderer,lercDecoder:t._lercDecoder,forceReload:()=>{t._rootTiles!=null&&t._rootTiles.length>0&&(t._mergeTile(t._rootTiles[0]),t._viewChangeUpdate())},getTiles:()=>t._allTiles.toArray(),getRenderedTiles(){pj.clear(),t._allTiles.forAll(r=>{r.visible&&r.rendered&&pj.push(r)});const e=pj.toArray();return r4e(t.renderOrder,e),e},lockTilingScheme(e,r){t._extentHelper.defaultTiledLayersExtent=r,t.tilingSchemeLogic.test.lockTilingScheme(e)}}}checkAllTilesWaterproofness(){if(!V8)return;const t=this._rootTiles;if(t==null)return;const e=s=>{var o,a,l;return((l=(a=(o=s==null?void 0:s.renderData)==null?void 0:o.geometry)==null?void 0:a.indices)==null?void 0:l.length)>0},r=(s,o)=>{e(s)&&console.error("Tile[",s.lij,"] has geometry although parent[",o.lij,"] has geom")},i=s=>{var o,a;if(s.intersectsClippingArea)if(s.renderData&&!s.renderData.geometryState&&console.error("Tile[",s.lij,"] has renderData but not geometryState"),s.renderData&&!s.renderData.geometry&&console.error("Tile[",s.lij,"] has renderData but not geometryInfo"),!((o=s.renderData)!=null&&o.geometry)||(((a=s.renderData.geometry.indices)==null?void 0:a.length)??0)>0||console.error("Tile[",s.lij,"] has renderData but no indices - geometryInfo: ",s.renderData.geometry),e(s)){s.checkGeometryWaterproofness();for(const l of s.children)r(l,s)}else if(s.isLeaf)console.error("Tile[",s.lij,"] has no geometry and no children, from root to leaf");else for(const l of s.children)i(l)},n=s=>{var c;const o=((c=s.parent)==null?void 0:c.visible)??!0,a=s.visible;s.computeVisibility();const l=s.visible;if(a!==l&&o&&console.error(" Tile[",s.lij,"] has out of date visibility: ",a," instead of ",l),!s.isLeaf)for(const u of s.children)n(u)};for(const s of t)i(s),n(s)}get isGlobal(){return this._isGlobal}get isGeographic(){return this._isGeographic}get isWebMercator(){return this._isWebMercator}get isWebMercatorOnPlateCarree(){return this._isWebMercatorOnPlateCarree}isEastEndWrap(t){return this._isGlobal&&t[2]===this.lijEastEnd(t[0])-1}isWestEndWrap(t){return this._isGlobal&&t[2]===0}lijEastEnd(t){return 1<<t+(this._isGeographic?1:0)}wrapEastWest(t){const e=this.lijEastEnd(t[0]),r=t[2];if(0<=r&&r<e)return t;if(!this._isGlobal)return null;const i=(r+(r<0?e:0))%e;return[t[0],t[1],i]}enableInternalChecks(t){_Et(t)}enableWaterproofnessChecks(t){yEt(t)}};qt._tileMemcacheKey="TerrainTileMemcache",d([m()],qt.prototype,"_renderer",void 0),d([m({constructOnly:!0})],qt.prototype,"_scaleRangeQueries",void 0),d([m({constructOnly:!0})],qt.prototype,"view",void 0),d([m({constructOnly:!0})],qt.prototype,"overlayManager",void 0),d([m()],qt.prototype,"_hasPendingUpdates",void 0),d([m()],qt.prototype,"_asyncWorkItems",void 0),d([m()],qt.prototype,"_allTilesDirty",void 0),d([m()],qt.prototype,"_allTilesSorted",void 0),d([m()],qt.prototype,"_viewChanged",void 0),d([m()],qt.prototype,"_splitLimits",void 0),d([m({readOnly:!0})],qt.prototype,"_watchUpdatingTracking",void 0),d([m()],qt.prototype,"_frameTask",void 0),d([m({readOnly:!0})],qt.prototype,"snapLevel",null),d([m({readOnly:!0})],qt.prototype,"lodSnapping",null),d([m()],qt.prototype,"_userClippingExtent",null),d([m()],qt.prototype,"_rootTilesExtent",void 0),d([m({readOnly:!0})],qt.prototype,"extent",null),d([m({readOnly:!0})],qt.prototype,"groundExtent",null),d([m({readOnly:!0})],qt.prototype,"_tilingSchemeExtent",null),d([m({readOnly:!0})],qt.prototype,"updating",null),d([m({readOnly:!0})],qt.prototype,"running",null),d([m(rEt)],qt.prototype,"updatingProgress",void 0),d([m({readOnly:!0})],qt.prototype,"updatingProgressValue",null),d([m()],qt.prototype,"_maxNumUpdating",void 0),d([m()],qt.prototype,"baseOpacity",null),d([m()],qt.prototype,"hasCompositeBlendMode",void 0),d([m({readOnly:!0})],qt.prototype,"viewingMode",null),d([m()],qt.prototype,"maxTextureScale",void 0),d([m({readOnly:!0})],qt.prototype,"ready",null),d([m({value:b3.FRONT_TO_BACK})],qt.prototype,"renderOrder",null),d([m({readOnly:!0})],qt.prototype,"rootTiles",null),d([m()],qt.prototype,"_rootTiles",void 0),d([m({readOnly:!0})],qt.prototype,"spatialReference",null),d([m({type:Xe})],qt.prototype,"backgroundColor",null),d([m({value:!1})],qt.prototype,"slicePlaneEnabled",null),d([m({readOnly:!0})],qt.prototype,"tilingScheme",void 0),d([m({readOnly:!0})],qt.prototype,"tilingSchemeLocked",null),d([m({readOnly:!0})],qt.prototype,"tilingSchemeLogic",void 0),d([m()],qt.prototype,"wireframe",null),d([m({value:!1})],qt.prototype,"suspended",null),d([m()],qt.prototype,"fadeDuration",null),d([m()],qt.prototype,"visibleElevationBounds",void 0),d([m()],qt.prototype,"rootTileElevationBounds",void 0),d([m()],qt.prototype,"_layerViewsDirty",void 0),d([m()],qt.prototype,"renderPatchBorders",null),d([m()],qt.prototype,"visualizeNormals",null),d([m()],qt.prototype,"renderingDisabled",null),qt=FF=d([V("esri.views.3d.terrain.TerrainSurface")],qt);const oAt=qt,wA=C(),YT=Jn(),aAt=Wt(),pj=new Vt,fj=new tEt("ground"),S4={spatialReference:null,extent:null,scale:0};function f0e(t,e,r){var i;for(const n of t){if(!n.containsPointXY(e,r))continue;let s=n;for(;s&&!s.renderData;){const a=(e>s.extentMidX?1:0)+(r<s.extentMidY?2:0);s=s.children[a]}const o=((i=s==null?void 0:s.renderData)==null?void 0:i.geometryState.samplerData)??null;return dn(e,r,o)}return null}class lAt{constructor(e){this.capacity=e,this._head=0,this._tail=0,this._data=new Array(e)}push(e){const r=this._tail;if(!(r<this.capacity))throw new Error("Queue full");this._data[r]=e,this._tail=r+1}pushAll(e){const r=e.length;if(r===0)return;const i=this._tail;if(!(i+r<=this.capacity))throw new Error("Queue full");for(let n=0;n<r;++n)this._data[i+n]=e[n];this._tail=i+r}pop(){const e=this._head;if(e<this._tail){const r=this._data[e];return this._head=e+1,r}}get empty(){return this._head>=this._tail}get full(){return this._tail>=this._data.length}}function mj(t,e){!t.isLeaf||t.level<Ps||jne(t,r=>{e&&W4e(r);const i=zJ(r);if(r.maxLevelDeltaNeighborCount++,i){let n=r.parent;for(;n;){const s=zJ(n);if(n.unmergableChildCount++,!s)break;n=n.parent}}})}function W4e(t){if(t.hasPendingUpdate(at.SPLIT))return;let e=t.parent;for(;e&&e.resetPendingUpdate(at.MERGE);)e=e.parent;t.resetPendingUpdate(at.MERGE),t.isLeaf&&t.setPendingUpdate(at.SPLIT),t.level<Ps||jne(t,r=>{W4e(r)})}function m0e(t){t.level<Ps||jne(t,e=>{if(e.maxLevelDeltaNeighborCount--,e.maxLevelDeltaNeighborCount===0&&e.unmergableChildCount===0){let r=e.parent;for(;r&&(r.unmergableChildCount--,zJ(r));)r=r.parent}})}function zJ(t){return t.maxLevelDeltaNeighborCount===0&&t.unmergableChildCount===0}function jne(t,e){if(t.level<Ps)return;const r=t.level-Ps,i=t.lij[1]>>Ps,n=t.lij[2]>>Ps,s=o=>o.isLeaf||o.level===r;for(let o=0;o<4;++o){const a=t.findNeighborTile(jp[o],s);if(!a||a.level!==r)continue;const l=a.lij;l[1]===i&&l[2]===n||e(a)}}let cAt=class{constructor(e,r,i,n){this.operation=e,this.geometry=r,this.states=i,this.sync=n}},yO=class extends Ae{constructor(e){super(e),this._residentGeomRecords=new Map,this._dirtyGeomRecords=new Map,this.dirty=!1}commitLayer(e,r){const i=this._dirtyGeomRecords.get(e);i&&(i.forEach((n,s)=>{const o=this._ensureGeomRecord(e,s);n.forEach(({geometry:a,operation:l,states:c},u)=>{let h=!1;if(l===en.UPDATE){const p=o.get(u);if(p){if(c&Is.TRANSFORMATION){const f=this.model.getObject(s);this.model.updateRenderGeometryTransformation(f,a,p)&&(h=!0)}h||r.updates.push({renderGeometry:p,updateType:c})}else pt(!1,"ModelDirtySet.commitLayer: invalid update")}if(l===en.REMOVE||h){const p=o.get(u);p?(r.removes.push(p),o.delete(u)):l===en.REMOVE&&pt(!1,"ModelDirtySet.commitLayer: invalid remove")}if(l===en.ADD||h){const p=this.model.getObject(s);if(p!=null){const f=this.model.getRenderGeometry(p,a);r.adds.push(f),o.set(u,f)}}}),o.size===0&&this._residentGeomRecords.get(e).delete(s)}),this._residentGeomRecords.get(e).size===0&&this._residentGeomRecords.delete(e),this._dirtyGeomRecords.delete(e),this.dirty=this._hasDirtyGeometryRecords)}commitSyncUpdates(e,r){const i=this._dirtyGeomRecords.get(e);i&&i.forEach((n,s)=>{const o=this._ensureGeomRecord(e,s);n.forEach(({geometry:a,operation:l,states:c,sync:u},h)=>{let p=!1;if(l===en.UPDATE&&u){const f=o.get(h);if(f){if(c&Is.TRANSFORMATION){const g=this.model.getObject(s);this.model.updateRenderGeometryTransformation(g,a,f)&&(p=!0)}p||r.updates.push({renderGeometry:f,updateType:c})}else pt(!1,"ModelDirtySet.commitSyncUpdates: invalid update")}})})}getResidentRenderGeometries(e,r){const i=this._residentGeomRecords.get(e);i&&i.forEach(n=>n.forEach(s=>r.push(s)))}_objectStateChanged(e,r){for(const i of r.geometries)this._updateOrCreateDirtyRecord(r,i,null,en.UPDATE,e)}visibilityChanged(e){this._objectStateChanged(Is.VISIBILITY,e)}highlightChanged(e){this._objectStateChanged(Is.HIGHLIGHT,e)}occlusionChanged(e){this._objectStateChanged(Is.OCCLUDEE,e)}attributesChanged({object:e,geometry:r,sync:i}){this._updateOrCreateDirtyRecord(e,r,null,en.UPDATE,Is.GEOMETRY,i)}layerAdded(e){e.objects.forAll(r=>this._layerObjectAdded(e,r))}layerRemoved(e){e.objects.forAll(r=>this._layerObjectRemoved(e,r))}layerObjectAdded(e){this._layerObjectAdded(e.layer,e.object)}_layerObjectAdded(e,r){const i=e.id;for(const n of r.geometries)this._geometryAdded(r,n,i)}layerObjectRemoved(e){this._layerObjectRemoved(e.layer,e.object)}layerObjectsAdded(e){for(const r of e.objects)this._layerObjectAdded(e.layer,r)}layerObjectsRemoved(e){for(const r of e.objects)this._layerObjectRemoved(e.layer,r)}_layerObjectRemoved(e,r){const i=e.id;for(const n of r.geometries)this._geometryRemoved(r,n,i)}transformationChanged(e){const r=this._getParentLayerId(e),i=e.id;this._ensureGeomRecord(r,i).forEach(n=>{this._updateOrCreateDirtyRecord(e,n.geometry,r,en.UPDATE,Is.TRANSFORMATION)})}shaderTransformationChanged(e){const r=this._getParentLayerId(e),i=e.id;this._ensureGeomRecord(r,i).forEach(n=>{n.objectShaderTransformationChanged(e.shaderTransformation)})}geometryAdded(e){this._geometryAdded(e.object,e.geometry)}_geometryAdded(e,r,i=null){this._updateOrCreateDirtyRecord(e,r,i,en.ADD)}geometryRemoved(e){this._geometryRemoved(e.object,e.geometry)}_geometryRemoved(e,r,i=null){this._updateOrCreateDirtyRecord(e,r,i,en.REMOVE)}_updateOrCreateDirtyRecord(e,r,i,n,s=Is.NONE,o=!1){i=i??this._getParentLayerId(e);const a=e.id,l=r.id,c=this._ensureDirtyRecord(i,a),u=c.get(l);if(u){const h=u.operation;h===en.REMOVE&&n===en.ADD&&u.states!==Is.NONE?u.operation=en.UPDATE:h===en.REMOVE&&n===en.ADD||h===en.ADD&&n===en.REMOVE?c.delete(l):h!==en.UPDATE||n!==en.REMOVE&&n!==en.UPDATE?(pt((h===en.REMOVE||h===en.ADD)&&n===en.UPDATE,"ModelDirtySet.objectGeometryAdded: inconsistent state"),u.states|=s):(u.operation=n,u.states|=s),u.sync=u.sync||o}else c.set(l,new cAt(n,r,s,o));this.dirty=this._hasDirtyGeometryRecords}_ensureGeomRecord(e,r){let i=this._residentGeomRecords.get(e);i||(i=new Map,this._residentGeomRecords.set(e,i));let n=i.get(r);return n||(n=new Map,i.set(r,n)),n}get _hasDirtyGeometryRecords(){return Zh(this._dirtyGeomRecords,e=>Zh(e,r=>r&&r.size>0))}_ensureDirtyRecord(e,r){let i=this._dirtyGeomRecords.get(e);i||(i=new Map,this._dirtyGeomRecords.set(e,i));let n=i.get(r);return n||(n=new Map,i.set(r,n)),n}_getParentLayerId(e){return e.parentLayer?e.parentLayer.id:w9e}formatDebugInfo(){const e=["ADD","UPD",void 0,"REM"];let r="";return this._dirtyGeomRecords.forEach((i,n)=>{i.forEach((s,o)=>{r.length>0&&(r+=`
`),r+=n+"."+o;const a=[];s.forEach(l=>{const c=l.operation;a[c]||(a[c]=[]),a[c].push(l.geometry.id)});for(let l=0;l<a.length;l++)if(a[l]){r+=" "+e[l-1]+": ";for(let c=0;c<a[l].length;c++)r+=a[l][c]+", "}})}),r}get test(){const e=this;return{get residentLayerCount(){return e._residentGeomRecords.size},get residentObjectCount(){return Array.from(e._residentGeomRecords.values()).reduce((r,i)=>r+i.size,0)},commit:r=>e._dirtyGeomRecords.forEach((i,n)=>e.commitLayer(n,r))}}};d([m({constructOnly:!0})],yO.prototype,"model",void 0),d([m()],yO.prototype,"dirty",void 0),yO=d([V("esri.views.3d.webgl-engine.lib.ModelDirtySet")],yO);const uAt=yO;let kF=class extends Ae{constructor(){super(...arguments),this.dirtySet=new uAt({model:this}),this._content=new Map,this._originFactory=new Lie(null)}getObject(e){return this._content.get(e)}add(e){const r=e.id;pt(!this._content.has(r),"Model/Stage already contains object to be added"),this._content.set(r,e),w8(e)&&this.dirtySet.layerAdded(e)}remove(e){return!!this._content.has(e.id)&&(this._content.delete(e.id),w8(e)&&this.dirtySet.layerRemoved(e),!0)}addMany(e){for(const r of e)r&&(pt(!this._content.has(r.id),"Model/Stage already contains object to be added"),this._content.set(r.id,r))}removeMany(e){for(const r of e)r&&(pt(this._content.has(r.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(r.id))}has(e){return this._content.has(e.id)}forEachOfType(e,r){this._content.forEach(i=>{i.type===e&&r(i)})}getRenderGeometry(e,r){const i=new v3(r,{castShadow:e.castShadow,objectShaderTransformation:e.shaderTransformation});i.transformation=e.getCombinedStaticTransformation(r,g0e);const{localOrigin:n}=r;return i.localOrigin=n??this._originFactory.getOrigin(i.boundingSphere),i}updateRenderGeometryTransformation(e,r,i){if(e==null)return!1;i.transformation=e.getCombinedStaticTransformation(r,g0e);const n=this._originFactory.getOrigin(i.boundingSphere);return i.localOrigin!==n}getStats(){const e={},r=Array.from(this._content.values());for(let i=0;i<Cn.COUNT;++i)e[i]=r.filter(n=>n.type===i).length;return{contentTypes:e,dirtySet:this.dirtySet.formatDebugInfo()}}get test(){return{content:Array.from(this._content.values())}}};d([m({constructOnly:!0})],kF.prototype,"dirtySet",void 0),kF=d([V("esri.views.3d.webgl-engine.parts.Model")],kF);const g0e=xe();let hAt=class{constructor(e){this._totalCount=e,this._componentCountCache=-1,this._indexRanges=[0,e]}allVisible(){return this.componentCount===this._totalCount}allInvisible(){return this._indexRanges.length===0}isVisible(e){if(e<0||e>=this._totalCount)return!1;if(this.allVisible())return!0;{const r=this._indexRanges;let i=0,n=r.length/2;if(e<r[2*i]||e>r[2*n]+r[2*n+1])return!1;for(;n-i>0;){const s=Math.floor(.5*(i+n)),o=r[2*s];if(e<o){if(n-i==1)return!1;n=s;continue}if(e<o+r[2*s+1])return!0;if(n-i==1)return!1;i=s+1}return!1}}get componentCount(){if(this._componentCountCache===-1){const e=this._indexRanges;let r=0;for(let i=0;i<e.length;i+=2)r+=e[i+1];this._componentCountCache=r}return this._componentCountCache}reset(e){e==="all"||e.length===this._totalCount?this._indexRanges=[0,this._totalCount]:this._indexRanges=dAt(e),this._componentCountCache=-1}forEachComponent(e){const r=this._indexRanges;for(let i=0;i<r.length;i+=2){const n=r[i],s=n+r[i+1];for(let o=n;o<s;o++)if(!e(o))return!1}return!0}forEachComponentRange(e){const r=this._indexRanges;for(let i=0;i<r.length;i+=2){const n=r[i];if(!e(n,n+r[i+1]))return!1}return!0}computeOffsetRanges(e){const r=new Array(this._indexRanges.length),i=this._indexRanges;for(let n=0;n<i.length;n+=2){const s=i[n],o=s+i[n+1],a=e[s],l=e[o];r[n]=a,r[n+1]=l-a}return r}};function dAt(t){const e=new Array;if(t.length===0)return e;let r=t[0],i=1;for(let n=1;n<t.length;n++){const s=t[n];r+i===s?i+=1:(e.push(r),e.push(i),r=s,i=1)}return e.push(r),e.push(i),e}let pAt=class{constructor(e,r){this.offsets=r,this.pickability=null,this.highlightCounts=null,this.verticalOffsets=null,this.cachedGeometryRanges=null,this.cachedHighlightRanges=null,this.cachedDefaultRanges=null;const i=this.count;this.visibility=new hAt(i),this.materialDataBuffer=e.getBuffer(i),this.materialDataIndices=new Uint16Array(i);for(let n=0;n<i;n++)this.materialDataIndices[n]=this.materialDataBuffer.acquireIndex()}destroy(){for(let e=0;e<this.count;e++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[e])}get count(){return this.offsets.length-1}get geometryRanges(){return this.cachedGeometryRanges==null&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets)),this.cachedGeometryRanges}get highlightRanges(){return this.highlightCounts==null?null:(this._updateCachedHighlightRanges(),this.cachedHighlightRanges)}get defaultShadowMapRanges(){return this.highlightCounts==null?this.geometryRanges:(this._updateCachedHighlightRanges(),this.cachedDefaultRanges)}highlightsDirty(){this.cachedHighlightRanges=null,this.cachedDefaultRanges=null}visibilityDirty(){this.cachedGeometryRanges=null,this.highlightsDirty()}_updateCachedHighlightRanges(){if((this.cachedHighlightRanges==null||this.cachedDefaultRanges==null)&&this.highlightCounts!=null){const{highlightRanges:e,defaultRanges:r}=fAt(this.highlightCounts,this.visibility,this.offsets);this.cachedHighlightRanges=e,this.cachedDefaultRanges=r}}};function fAt(t,e,r){const i=[],n=[];let s=r.length,o=r.length;return e.forEachComponent(a=>(t[a]>0?(s!==a-1&&(i.length&&i.push(r[s+1]-i[i.length-1]),i.push(r[a])),s=a):(o!==a-1&&(n.length&&n.push(r[o+1]-n[n.length-1]),n.push(r[a])),o=a),!0)),i.length&&i.push(r[s+1]-i[i.length-1]),n.length&&n.push(r[o+1]-n[n.length-1]),{highlightRanges:i,defaultRanges:n}}let mAt=class{constructor(e,r,i,n,s,o){this.transform=e,this.toMapSpace=r,this.obb=i,this.components=n,this.renderable=s,this.intersectionGeometry=o,this.visible=!1,this.offsetObb=null}destroy(){this.intersectionGeometry=Pe(this.intersectionGeometry),this.renderable=Pe(this.renderable),this.components=Pe(this.components)}};function gAt(t,e,r,i){if(r>=e)return t;t==null&&(t=yAt());const n=t.isVisibleBit;let s=t.data;const o=q4e(s),a=r/o|0,l=r-o*a,c=(e-1)/o|0,u=s,h=i===n;if(!(r<u.length*o)&&h){const p=a+1,f=Math.ceil(u.length*Ez),g=c+1;let _=Math.max(p,f);_=Math.min(_,g),s=new Uint32Array(_),s.set(u)}return a<s.length&&(s[a]=vAt(s[a],l,h)),t.data=s,t}function UJ(t,e){if(t==null)return!0;const{isVisibleBit:r,data:i}=t,n=q4e(i);return e<i.length*n?_At(r,i,e,n):!t.isVisibleBit}function yAt(t=!0){return{isVisibleBit:!t,data:new Uint32Array(0)}}function _At(t,e,r,i){const n=r/i|0,s=r-n*i;return bAt(e[n],s)===t}function q4e(t){return t.BYTES_PER_ELEMENT*8}function vAt(t,e,r){return t&~(1<<e)|(r?1:0)<<e}function bAt(t,e){return(t&1<<e)!=0}let wAt=class{constructor(e,r,i){this.viewingMode=e,this.positionData=r,this._components=i,this._planetCenter=C(),this._planetNorth=C(),this._componentIndicesForBsp=null,this._componentBspNodes=[],this._aabb=[0,0,0,0,0,0],this._indices=r.indices?Xm(r.indices):B2(r.positions.length/3),this._positions=r.positions,this._componentIntersectionData=new Array(i.count)}destroy(){this._positions=null,this._indices=null,this._componentIntersectionData.length=0,this._perComponentAabbs=null}getComponentAabb(e,r){const i=this._ensureComponentAabbs(),n=6*e;return r[0]=i[n],r[1]=i[n+1],r[2]=i[n+2],r[3]=i[n+3],r[4]=i[n+4],r[5]=i[n+5],r}getComponentAabbs(){return this._ensureComponentAabbs()}_ensureComponentAabbs(){return this._perComponentAabbs||(this._perComponentAabbs=this._computePerComponentAabbs()),this._perComponentAabbs}getComponentPositions(e,r){r.indices=this._indices,r.data=this._positions,r.stride=3,r.startIndex=this._components.offsets[e],r.endIndex=this._components.offsets[e+1]}intersect(e,r,i,n,s,o,a,l){const{position:c}=a,u=Yi(SAt,e,c),h=Yi(CAt,r,c),p=L2(EAt,a.rotationScale);Zs(u,u,p),Zs(h,h,p);const f=gd(PAt,p),g=new U3(this._positions,3),_=this._indices,v=this._components.offsets,b=EOe(u,h,xAt);if(this.viewingMode===De.Global){const A=this._planetCenter;Bo(A,c),Zs(A,A,p);const O=this._planetNorth;ie(O,0,0,1),Zs(O,O,p),pe(O,O)}const w=ce(AAt,u),x=ce(MAt,h),S=Yi(OAt,h,u);pe(S,S);const E=A=>{const O=this.getComponentAabb(A,TAt);if(s!=null){const q=s[A];n==null||l?(u[2]=w[2]-q,h[2]=x[2]-q):n.componentOffset=q}if(n==null||l||n.applyToAabb(O),!Yre(O,u,b,i))return;const L=v[A]/3,z=v[A+1]/3,k=(q,B,J)=>o(A,q,Zs(B,B,f),J);(n==null||l)&&z-L>j4e?(this._componentIntersectionData[A]==null&&(this._componentIntersectionData[A]=new Gne(this._indices,L,z,g)),this._componentIntersectionData[A].intersectRay(u,h,k)):QI(u,h,L,z,_,g,void 0,n,k)};this._intersectComponents(E,l,u,h)}_intersectComponents(e,r,i,n){const s=this._components.pickability,o=this._components.visibility;if(this._components.visibility.componentCount<NAt){const u=h=>(UJ(s,h)&&e(h),!0);return void o.forEachComponent(u)}this._componentBspNodes.length===0&&this._generateComponentBspRoot();const a=this._componentIndicesForBsp,l=u=>{UJ(s,u)&&o.isVisible(u)&&e(u)},c=(u,h)=>{for(let p=u;p<h;++p)l(a[p])};if(r){let u=0;for(;u>=0;){const h=this._componentBspNodes[u],p=h.plane;if(!p||h.child0===-1&&h.child1===-1){c(h.minComponentIndexIndex,h.maxComponentIndexIndex);break}{c(h.minMidComponentIndexIndex,h.maxMidComponentIndexIndex);const f=de(p,i)-p[3];if(f<0){if(h.child0===-1){c(h.minComponentIndexIndex,h.minMidComponentIndexIndex);break}u=h.child0}else{if(!(f>0))break;if(h.child1===-1){c(h.maxMidComponentIndexIndex,h.maxComponentIndexIndex);break}u=h.child1}}}}else{const u=FAt;Yi(u,n,i),pe(u,u);const h=this._componentBspNodes,p=f=>{const g=h[f],_=g.plane;if(!_||g.child0===-1&&g.child1===-1)c(g.minComponentIndexIndex,g.maxComponentIndexIndex);else{const v=de(_,i)-_[3],b=de(_,u);g.minComponentIndexIndex<g.minMidComponentIndexIndex&&(v<=0||b<0)&&(g.child0!==-1?p(g.child0):c(g.minComponentIndexIndex,g.minMidComponentIndexIndex)),c(g.minMidComponentIndexIndex,g.maxMidComponentIndexIndex),g.maxMidComponentIndexIndex<g.maxComponentIndexIndex&&(v>=0||b>0)&&(g.child1!==-1?p(g.child1):c(g.maxMidComponentIndexIndex,g.maxComponentIndexIndex))}};p(0)}}_generateComponentBspRoot(){const e=this._components.count,r=new Uint16Array(e);this._componentIndicesForBsp=r;for(let b=0;b<e;++b)r[b]=b;const i=this._ensureComponentAabbs(),n=this._planetCenter,s=this._planetNorth,o=IAt;Bo(o,n),pe(o,o),Je(LAt,s,o);const a=this._aabb,l=a[2],c=[];let u=0;const h=this._componentBspNodes;h.length=0;const p=(b,w)=>{const x=6*b,S=i[x],E=i[x+1],A=i[x+2],O=i[x+3],L=i[x+4],z=i[x+5],k=ie(_0e,.5*(S+O),.5*(E+L),.5*(A+z)),q=.5*(O-S),B=.5*(L-E),J=.5*(z-A),W=Math.sqrt(q*q+B*B+J*J),Y=w,le=w[3],D=de(Y,k)-le;return Math.abs(D)>W?Math.sign(D):0},f=(b,w,x)=>{let S=1/0,E=1/0,A=1/0,O=-1/0,L=-1/0,z=-1/0;for(let k=w;k<x;++k){const q=6*r[k];S=Math.min(S,i[q]),O=Math.max(O,i[q+3]),E=Math.min(E,i[q+1]),L=Math.max(L,i[q+4]),A=Math.min(A,i[q+2]),z=Math.max(z,i[q+5])}b[0]=S,b[1]=E,b[2]=A,b[3]=O,b[4]=L,b[5]=z},g=this.viewingMode===De.Local;let _=!1;if(!g){const b=ie(_0e,.5*(a[0]+a[3]),.5*(a[1]+a[4]),.5*(a[2]+a[5])),w=D0(n,b);_=l>.5*w}const v=(b,w,x,S,E)=>{const A=h.length;let O;if(_||x>=DAt||w-b<gj)O=new y0e(b,w,w,w,null);else{f(XT,b,w);const L=XT[0],z=XT[1],k=XT[2],q=XT[3],B=XT[4],J=q-L,W=B-z,Y=Zt(),le=Y;if(g)J>=W?(ie(le,1,0,0),Y[3]=-.5*(L+q)):(ie(le,0,1,0),Y[3]=-.5*(z+B));else{const F=RAt,G=$At;ie(F,.5*(L+q),.5*(z+B),k),Yi(F,F,n),pe(F,F),Je(G,F,s),pe(G,G),J>=W?ce(le,G):(Je(le,G,F),pe(le,le)),Y[3]=de(le,n)}let D,I;{let F=b,G=w;for(;F<G;){const Z=r[F];p(Z,Y)<0?++F:(--G,r[F]=r[G],r[G]=Z)}D=F;let H=F;for(G=w;H<G;){const Z=r[G-1];p(Z,Y)>0?--G:(r[G-1]=r[H],r[H]=Z,++H)}I=G}O=new y0e(b,D,I,w,Y),D>=b+gj&&c.push(()=>v(b,D,x+1,A,!0)),w>=I+gj&&c.push(()=>v(I,w,x+1,A,!1))}if(h.push(O),S!==-1){const L=h[S];E?L.child0=A:L.child1=A}};for(c.push(()=>v(0,e,0,-1,!1));u<c.length;)(0,c[u])(),++u}_computePerComponentAabbs(){const e=this._components.count,r=mn(6*e),i=this._indices,n=this._positions,s=this._components.offsets;let o=0,a=1/0,l=1/0,c=1/0,u=-1/0,h=-1/0,p=-1/0;for(let f=0;f<e;f++){const g=s[f],_=s[f+1];let v=1/0,b=1/0,w=1/0,x=-1/0,S=-1/0,E=-1/0;for(let A=g;A<_;A++){const O=3*i[A],L=n[O],z=n[O+1],k=n[O+2];v=Math.min(v,L),b=Math.min(b,z),w=Math.min(w,k),x=Math.max(x,L),S=Math.max(S,z),E=Math.max(E,k)}r[o++]=v,r[o++]=b,r[o++]=w,r[o++]=x,r[o++]=S,r[o++]=E,a=Math.min(a,v),l=Math.min(l,b),c=Math.min(c,w),u=Math.max(u,x),h=Math.max(h,S),p=Math.max(p,E)}return this._aabb[0]=a,this._aabb[1]=l,this._aabb[2]=c,this._aabb[3]=u,this._aabb[4]=h,this._aabb[5]=p,r}get positions(){return this._positions}get indices(){return this._indices}get aabb(){return this._ensureComponentAabbs(),this._aabb}},y0e=class{constructor(e,r,i,n,s){this.minComponentIndexIndex=e,this.minMidComponentIndexIndex=r,this.maxMidComponentIndexIndex=i,this.maxComponentIndexIndex=n,this.plane=s,this.child0=-1,this.child1=-1}};const xAt=C(),TAt=vs(),XT=[0,0,0,0,0,0],SAt=C(),CAt=C(),EAt=li(),PAt=li(),AAt=C(),MAt=C(),OAt=C(),RAt=C(),$At=C(),IAt=C(),LAt=C(),_0e=C(),gj=5,DAt=10,NAt=7,FAt=C();let kAt=class{constructor(e,r,i){this.material=e,this.geometry=r,this.meta=i}destroy(){this.material.dispose(),this.geometry.dispose()}},zAt=class{constructor(e,r,i,n){this.vao=e,this.primitiveType=r,this.parameters=i,this.indexed=n}dispose(){this.vao.dispose()}},Hne=class{constructor(){this.near=Number.MAX_VALUE,this.far=-Number.MAX_VALUE}};function UAt(t,e){return{near:t,far:e}}function mL(t){return t?aI(t,1/0,-1/0):UAt(1/0,-1/0)}function aI(t,e,r){return t.near=e,t.far=r,t}function w3(t,e){e!=null&&(t.near=Math.min(t.near,e.near),t.far=Math.max(t.far,e.far))}function C4(t,e){return t.near<=e&&e<=t.far}const BJ={near:0,far:0};function BAt(t,e){const r=mL(),{eye:i,frustum:n,viewForward:s}=t;e.forAll(o=>{const a=o.offsetObb!=null?o.offsetObb:o.obb,l=de(Yi(wu,a.center,i),s),c=a.projectedRadius(s);if(C4(r,l-c)&&C4(r,l+c))return;const u=WAt(a,n);if(u===-1)return;if(u===0)return Gg.far=l+c,Gg.near=l-c,void w3(r,Gg);const h=E4.pushNew();h.near=l-c,h.far=l+c,h.mask=u,h.object=o});for(let o=0;o<E4.length;o++){const a=E4.data[o];if(C4(r,a.near)&&C4(r,a.far))continue;Gg.far=a.far,Gg.near=1/0,HAt(a.object.offsetObb!=null?a.object.offsetObb:a.object.obb,i,VAt,c=>{let u=GAt;for(let h=0;h<Y4e&&c.length>0;h++){if(!(a.mask&1<<h))continue;jAt(n[h],c,u);const p=c;c=u,u=p}for(let h=0;h<c.length;h+=3){ie(Gl,c.data[h],c.data[h+1],c.data[h+2]);const p=de(Yi(Gl,Gl,i),s);Gg.near=Math.min(Gg.near,p)}})===0&&(Gg.near=0),w3(r,Gg)}return E4.length=0,r}const E4=new Vt({allocator:t=>t||{near:1/0,far:-1/0,mask:0,object:null},deallocator:t=>(t.object=null,t)}),Gg=mL(),Gl=C(),Db=C(),VAt=new Vt({deallocator:null}),GAt=new Vt({deallocator:null});function jAt(t,e,r){r.length=0;const i=e.length-3;yj(Gl,e,i);const n=bi(t,Gl);n<=0&&(r.push(Gl[0]),r.push(Gl[1]),r.push(Gl[2]));let s=0,o=n;for(;s<i;s+=3){yj(Db,e,s);const a=bi(t,Db);o*a<0&&(ni(Gl,Db,Gl,a/(a-o)),jl(r,Gl)),a<=0&&jl(r,Db),o=a,ce(Gl,Db)}o*n<0&&(yj(Db,e,i),ni(Gl,Db,Gl,n/(n-o)),jl(r,Gl))}function yj(t,e,r){return ie(t,e.data[r],e.data[r+1],e.data[r+2])}function jl(t,e){t.push(e[0]),t.push(e[1]),t.push(e[2])}function HAt(t,e,r,i){G1(b0e,t.quaternion),Yi(wu,e,t.center),Oc(wu,wu,b0e);const n=t.halfSize,s=8*((wu[0]<-n[0]?-1:wu[0]>n[0]?1:0)+3*(wu[1]<-n[1]?-1:wu[1]>n[1]?1:0)+9*(wu[2]<-n[2]?-1:wu[2]>n[2]?1:0)+13),o=v0e[s];if(o===0)return o;P$(P4,t.quaternion),z9(P4,P4,t.halfSize);const a=(l,c)=>{const u=v0e[s+c+1];return ie(l,((1&u)<<1)-1,(2&u)-1,((4&u)>>1)-1),Zs(l,l,P4),fe(l,t.center,l)};return r.length=0,jl(r,a(_j,0)),jl(r,a(w0e,1)),jl(r,a(wu,2)),jl(r,a(x0e,3)),i(r),o===1||(r.length=0,jl(r,_j),jl(r,x0e),jl(r,a(wu,4)),jl(r,a(T0e,5)),i(r),o===2||(r.length=0,jl(r,_j),jl(r,T0e),jl(r,a(wu,6)),jl(r,w0e),i(r))),o}const v0e=(()=>{const t=new Array(216);let e=0;const r=i=>{for(let n=0;n<i.length;n++)t[e+n]=i[n];e+=8};return r([3,0,6,2,3,1,5,4]),r([2,0,2,3,1,5,4,0]),r([3,1,0,2,3,7,5,4]),r([2,0,1,3,2,6,4,0]),r([1,0,1,3,2,0,0,0]),r([2,1,5,7,3,2,0,0]),r([3,2,0,1,3,7,6,4]),r([2,2,0,1,3,7,6,0]),r([3,3,0,1,5,7,6,2]),r([2,0,1,5,4,6,2,0]),r([1,0,1,5,4,0,0,0]),r([2,1,3,7,5,4,0,0]),r([1,0,2,6,4,0,0,0]),r([0,0,0,0,0,0,0,0]),r([1,1,3,7,5,0,0,0]),r([2,2,3,7,6,4,0,0]),r([1,2,3,7,6,0,0,0]),r([2,3,1,5,7,6,2,0]),r([3,4,0,1,5,7,6,2]),r([2,5,7,6,4,0,1,0]),r([3,5,0,1,3,7,6,4]),r([2,4,5,7,6,2,0,0]),r([1,4,5,7,6,0,0,0]),r([2,5,1,3,7,6,4,0]),r([3,6,0,2,3,7,5,4]),r([2,6,2,3,7,5,4,0]),r([3,7,6,2,3,1,5,4]),t})(),Y4e=4;function WAt(t,e){let r=0;for(let i=0;i<Y4e;i++){const n=t.intersectPlane(e[i]);if(n>0)return-1;n===0&&(r|=1<<i)}return r}const P4=li(),b0e=lc(),wu=C(),_j=C(),w0e=C(),x0e=C(),T0e=C();let qAt=class{constructor(e){this._objects=e}submit(e,r){this._objects.preSubmit(r),this._objects.visibleObjects.forAll(i=>i.renderable.material.submit(e,r,i))}queryShadowCasterDepthRange(e){return this._objects.visibleObjects.length?BAt(e,this._objects.visibleObjects):null}};function YAt(t){const e=Qi().vec3f(R.POSITION);return t.hasNormals&&e.vec2i16(R.NORMALCOMPRESSED,{glNormalized:!0}),t.textureCoordinates===on.Default?e.vec2f(R.UV0):t.textureCoordinates===on.Atlas&&(e.vec2f(R.UV0),e.vec4u16(R.UVREGION,{glNormalized:!0})),t.colors&&e.vec4u8(R.COLOR,{glNormalized:!0}),e}let XAt=class{constructor(){this.externalColor=Zt(),this.externalColorMixMode=Ns.Multiply,this.castShadows=!0,this.pickable=!0,this.elevationOffset=0}},ZAt=class extends vn{constructor(e,r){super(e,"int",Rr.Draw,(i,n,s)=>i.setUniform1i(e,r(n,s)))}};var Qm;(function(t){t[t.Uniform=0]="Uniform",t[t.Varying=1]="Varying",t[t.COUNT=2]="COUNT"})(Qm||(Qm={}));const Wne=429496.7296;function X4e(t,e){Z$(t/Wne*.5+.5,e)}function JAt(t,e){switch(e.componentData){case Qm.Varying:return QAt(t,e);case Qm.Uniform:return KAt(t,e);case Qm.COUNT:return;default:e.componentData}}function QAt(t,e){const{vertex:r,fragment:i}=t;r.include(Td),r.uniforms.add(new id("componentColorTex",s=>s.componentParameters.texture.texture)),t.attributes.add(R.COMPONENTINDEX,"float"),t.varyings.add("vExternalColorMixMode","mediump float"),t.varyings.add("vExternalColor","vec4");const n=e.output===U.ObjectAndLayerIdColor;n&&t.varyings.add("vObjectAndLayerIdColor","vec4"),t.include(ORe),r.constants.add("elevationScale","float",2*Wne),r.constants.add("stride","float",se("enable-feature:objectAndLayerId-rendering")?3:2),r.code.add(T`vec2 getComponentTextureCoordinates(float componentIndex, float typeOffset) {
float index = componentIndex * stride + typeOffset;
float texSize = float(textureSize(componentColorTex, 0).x);
float coordX = mod(index, texSize);
float coordY = floor(index / texSize);
return vec2(coordX, coordY) + 0.5;
}`),r.code.add(T`
  vec4 _readComponentColor() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 0.0);

    return texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
   }

   float readElevationOffset() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 1.0);

    vec4 encodedElevation = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
    return (rgba2float(encodedElevation) - 0.5) * elevationScale;
  }

  ${n?T`
          void forwardObjectAndLayerIdColor() {
            vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 2.0);

            vObjectAndLayerIdColor = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
          }`:T`void forwardObjectAndLayerIdColor() {}`}

  vec4 forwardExternalColor(out bool castShadows) {
    vec4 componentColor = _readComponentColor() * 255.0;

    float shadowFlag = mod(componentColor.b * 255.0, 2.0);
    componentColor.b -= shadowFlag;
    castShadows = shadowFlag >= 1.0;

    int decodedColorMixMode;
    vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451; // = 1/255;
    vExternalColorMixMode = float(decodedColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts

    return vExternalColor;
  }
`),i.code.add(T`
  void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
    externalColor = vExternalColor;
    externalColorMixMode = int(vExternalColorMixMode);
  }

  void outputObjectAndLayerIdColor() {
     ${n?T`fragColor = vObjectAndLayerIdColor;`:""}
  }
`)}function KAt(t,e){const{vertex:r,fragment:i}=t;r.uniforms.add(new b8("externalColor",s=>s.componentParameters.externalColor)),i.uniforms.add(new ZAt("externalColorMixMode",s=>s.componentParameters.externalColorMixMode)),t.varyings.add("vExternalColor","vec4"),r.code.add(T`float readElevationOffset() {
return 0.0;
}
void forwardObjectAndLayerIdColor() {}
vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`);const n=e.output===U.ObjectAndLayerIdColor;i.code.add(T`
  void readExternalColor(out vec4 color, out int colorMixMode) {
    color = vExternalColor;
    colorMixMode = externalColorMixMode;
  }

  void outputObjectAndLayerIdColor() {
    ${n?T`fragColor = vec4(0,0,0,0);`:""}
 }
`)}var zu;function eMt(t,e){const r=t.vertex;switch(r.code.add(T`#define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)`),e.vertexDiscardMode){case zu.None:r.code.add(T`#define vertexDiscardByOpacity(_opacity_) {}`);break;case zu.Opaque:r.code.add(T`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case zu.Transparent:r.code.add(T`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case zu.COUNT:break;default:e.vertexDiscardMode}}(function(t){t[t.None=0]="None",t[t.Transparent=1]="Transparent",t[t.Opaque=2]="Opaque",t[t.COUNT=3]="COUNT"})(zu||(zu={}));var Km;function GZt(t){return t&&Iv(t)?Km.Mars:t&&Lv(t)?Km.Moon:Km.Earth}(function(t){t[t.Earth=1]="Earth",t[t.Mars=2]="Mars",t[t.Moon=3]="Moon",t[t.COUNT=4]="COUNT"})(Km||(Km={}));var Yh;(function(t){t[t.None=0]="None",t[t.NoOverlay=1]="NoOverlay",t[t.ColorOverlay=2]="ColorOverlay",t[t.ColorOverlayWithWater=3]="ColorOverlayWithWater",t[t.COUNT=4]="COUNT"})(Yh||(Yh={}));let nr=class extends cc{constructor(){super(...arguments),this.output=U.Color,this.textureCoordinateType=on.None,this.componentData=Qm.Uniform,this.cullFace=Pi.Back,this.vertexDiscardMode=zu.None,this.doubleSidedMode=gn.WindingOrder,this.alphaDiscardMode=fi.Opaque,this.integratedMeshMode=Yh.None,this.transparencyPassType=ft.NONE,this.ellipsoidMode=Km.Earth,this.pbrMode=ot.Disabled,this.normalType=$r.Attribute,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasVertexColors=!1,this.hasNormals=!1,this.hasSlicePlane=!1,this.hasColorTexture=!1,this.receiveAmbientOcclusion=!0,this.receiveShadows=!0,this.blendingEnabled=!0,this.hasScreenSpaceReflections=!1,this.hasPolygonOffset=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.hasNormalTextureTransform=!1,this.hasCloudsReflections=!0,this.snowCover=!1,this.objectAndLayerIdColor=!1}};d([j({count:U.COUNT})],nr.prototype,"output",void 0),d([j({count:on.COUNT})],nr.prototype,"textureCoordinateType",void 0),d([j({count:Qm.COUNT})],nr.prototype,"componentData",void 0),d([j({count:Pi.COUNT})],nr.prototype,"cullFace",void 0),d([j({count:zu.COUNT})],nr.prototype,"vertexDiscardMode",void 0),d([j({count:gn.COUNT})],nr.prototype,"doubleSidedMode",void 0),d([j({count:fi.COUNT})],nr.prototype,"alphaDiscardMode",void 0),d([j({count:Yh.COUNT})],nr.prototype,"integratedMeshMode",void 0),d([j({count:ft.COUNT})],nr.prototype,"transparencyPassType",void 0),d([j({count:Km.COUNT})],nr.prototype,"ellipsoidMode",void 0),d([j({count:ot.COUNT})],nr.prototype,"pbrMode",void 0),d([j({count:$r.COUNT})],nr.prototype,"normalType",void 0),d([j()],nr.prototype,"spherical",void 0),d([j()],nr.prototype,"doublePrecisionRequiresObfuscation",void 0),d([j()],nr.prototype,"hasVertexColors",void 0),d([j()],nr.prototype,"hasNormals",void 0),d([j()],nr.prototype,"hasSlicePlane",void 0),d([j()],nr.prototype,"hasColorTexture",void 0),d([j()],nr.prototype,"receiveAmbientOcclusion",void 0),d([j()],nr.prototype,"receiveShadows",void 0),d([j()],nr.prototype,"blendingEnabled",void 0),d([j()],nr.prototype,"hasScreenSpaceReflections",void 0),d([j()],nr.prototype,"hasPolygonOffset",void 0),d([j()],nr.prototype,"hasMetallicRoughnessTexture",void 0),d([j()],nr.prototype,"hasEmissionTexture",void 0),d([j()],nr.prototype,"hasOcclusionTexture",void 0),d([j()],nr.prototype,"hasNormalTexture",void 0),d([j()],nr.prototype,"hasOccludees",void 0),d([j()],nr.prototype,"multipassEnabled",void 0),d([j()],nr.prototype,"cullAboveGround",void 0),d([j()],nr.prototype,"hasNormalTextureTransform",void 0),d([j()],nr.prototype,"hasCloudsReflections",void 0),d([j()],nr.prototype,"snowCover",void 0),d([j()],nr.prototype,"objectAndLayerIdColor",void 0),d([j({constValue:!1})],nr.prototype,"occlusionPass",void 0),d([j({constValue:Rr.Draw})],nr.prototype,"pbrTextureBindType",void 0),d([j({constValue:!0})],nr.prototype,"hasSliceHighlight",void 0),d([j({constValue:!1})],nr.prototype,"hasSliceInVertexProgram",void 0),d([j({constValue:!1})],nr.prototype,"useCustomDTRExponentForWater",void 0),d([j({constValue:!1})],nr.prototype,"hasVertexTangents",void 0),d([j({constValue:!0})],nr.prototype,"supportsTextureAtlas",void 0),d([j({constValue:!1})],nr.prototype,"highStepCount",void 0),d([j({constValue:!1})],nr.prototype,"instancedDoublePrecision",void 0),d([j({constValue:!1})],nr.prototype,"hasModelTransformation",void 0),d([j({constValue:!0})],nr.prototype,"useFillLights",void 0),d([j({constValue:!1})],nr.prototype,"objectAndLayerIdColorInstanced",void 0);function S0e(t,e){t.include(H2,e),t.fragment.include(H$);const r=t.fragment;r.uniforms.add(new b8("baseColor",i=>i.baseColor)),r.uniforms.add(new Dx("objectOpacity",i=>i.objectOpacity)),e.hasVertexColors?r.code.add(T`vec3 _baseColor() {
return baseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return baseColor.a * vColor.a;
}`):r.code.add(T`vec3 _baseColor() {
return baseColor.rgb;
}
float _baseOpacity() {
return baseColor.a;
}`),r.code.add(T`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = objectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)}function C0e(t,e){const r=t.fragment;switch(e.doubleSidedMode){case gn.None:r.code.add(T`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`);break;case gn.View:t.include(eE,e),r.code.add(T`vec3 _adjustDoublesided(vec3 normal) {
return dot(normal, vPositionWorldCameraRelative) > 0.0 ? -normal : normal;
}`);break;case gn.WindingOrder:r.code.add(T`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`);break;default:e.doubleSidedMode;case gn.COUNT:}switch(e.normalType){case $r.Attribute:case $r.Compressed:t.include($U,e),r.code.add(T`vec3 shadingNormalWorld() {
return _adjustDoublesided(normalize(vNormalWorld));
}
vec3 shadingNormal_view() {
vec3 normal = normalize(vNormalView);
return gl_FrontFacing ? normal : -normal;
}`);break;case $r.ScreenDerivative:t.include(eE,e),r.code.add(T`vec3 shadingNormalWorld() {
return normalize(cross(
dFdx(vPositionWorldCameraRelative),
dFdy(vPositionWorldCameraRelative)
));
}
vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));
}`);break;case $r.Ground:e.spherical?(t.include(eE,e),r.code.add(T`vec3 shadingNormalWorld() {
return normalize(positionWorld());
}`)):r.code.add(T`vec3 shadingNormalWorld() {
return vec3(0.0, 0.0, 1.0);
}`),r.code.add(T`vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;
}`);break;default:e.normalType;case $r.COUNT:}}function tMt(t,e){const r=t.fragment;if(e.hasColorTexture&&(e.output===U.Color||e.alphaDiscardMode!==fi.Opaque)){t.include(ere,e);const i=e.textureCoordinateType===on.Atlas;r.uniforms.add(new id("baseColorTexture",n=>n.texture)),i?(t.include(WPe),r.code.add(T`vec4 readBaseColorTexture() {
return textureAtlasLookup(baseColorTexture, vuv0, vuvRegion);
}`)):r.code.add(T`vec4 readBaseColorTexture() {
return texture(baseColorTexture, vuv0);
}`)}else r.code.add(T`vec4 readBaseColorTexture() { return vec4(1.0); }`)}function Z4e(t){const e=new Or;e.include(eE,t),e.include($U,t),e.include(H2,t),e.include(qm,t),e.include(X3,t),e.include(JAt,t),e.include(wdt,t),e.include(Eut,t),e.include(tMt,t),e.include(eMt,t);const{vertex:r,fragment:i}=e;t.pbrMode!==ot.Normal&&t.pbrMode!==ot.Schematic||(e.include(rre,t),t.hasNormalTexture&&e.include(DRe,t));const n=t.output===U.Shadow||t.output===U.ShadowHighlight||t.output===U.ShadowExcludeHighlight;n&&t.componentData===Qm.Varying?r.code.add(T`#define discardShadows(castShadows) { if(!castShadows) { gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`):r.code.add(T`#define discardShadows(castShadows) {}`);const s=t.integratedMeshMode===Yh.ColorOverlay||t.integratedMeshMode===Yh.ColorOverlayWithWater,o=s&&t.output===U.Color&&t.pbrMode===ot.WaterOnIntegratedMesh;return s&&(e.include(y2,t),e.include(Bft,t),t.spherical?r.code.add(T`
      const float invEllipsoidRadius = ${T.float(1/(t.ellipsoidMode===Km.Earth?Yr.radius:t.ellipsoidMode===Km.Mars?Yp.radius:K0.radius))};
      vec2 projectOverlay(vec3 pos) {
        return pos.xy / (1.0 + invEllipsoidRadius * pos.z);
      }
      `):r.code.add(T`vec2 projectOverlay(vec3 pos) { return pos.xy; }`)),o&&(e.varyings.add("tbnTangent","vec3"),e.varyings.add("tbnBiTangent","vec3"),e.varyings.add("groundNormal","vec3")),r.code.add(T`
    void main() {
      bool castShadows;
      vec4 externalColor = forwardExternalColor(castShadows);
      discardShadows(castShadows);

      vertexDiscardByOpacity(externalColor.a);

      ${t.output===U.ObjectAndLayerIdColor?T`externalColor.a = 1.0;`:""}

      if (externalColor.a < ${T.float(Fo)}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }

      forwardPosition(readElevationOffset());
      forwardNormal();
      forwardTextureCoordinates();
      forwardVertexColor();
      forwardLinearDepth();
      ${t.output===U.ObjectAndLayerIdColor?T`forwardObjectAndLayerIdColor();`:""}
      ${o?t.spherical?T`
                groundNormal = normalize(positionWorld());
                tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
                tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:T`
                groundNormal = vec3(0.0, 0.0, 1.0);
                tbnTangent = vec3(1.0, 0.0, 0.0);
                tbnBiTangent = vec3(0.0, 1.0, 0.0);`:""}
      ${s?T`setOverlayVTC(projectOverlay(position));`:""}
    }
  `),t.output===U.Alpha&&(i.include(cg),e.include(iu,t),e.include(S0e,t),s&&i.uniforms.add(new ct("ovColorTex",(a,l)=>kZ(a,l))),i.code.add(T`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${t.multipassEnabled?T`terrainDepthTest(vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${s?T`
                vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);
                materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        fragColor = vec4(materialColor.a);
      }
    `)),t.output===U.Color&&(i.include(cg),e.include(iu,t),e.include(S0e,t),e.include(C0e,t),e.include(y2,t),t.receiveShadows?(e.include(sL,t),i.code.add(T`float evaluateShadow() {
return readShadowMap(vPositionWorldCameraRelative, linearDepth);
}`)):i.code.add(T`float evaluateShadow() { return 0.0; }`),s&&i.uniforms.add(new ct("ovColorTex",(a,l)=>kZ(a,l))),i.code.add(T`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${t.multipassEnabled?T`terrainDepthTest(vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${s?T`vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);`:""}
    `),t.pbrMode===ot.Normal||t.pbrMode===ot.Schematic||t.pbrMode===ot.Simplified?(_g(i),i.code.add(T`
        ${t.pbrMode===ot.Normal?T`
                applyPBRFactors();
                if (int(externalColorMixMode) == 3) {
                  mrr = vec3(0.0, 0.6, 0.2);
                }`:""}
        vec3 normalVertex = shadingNormalWorld();
        float additionalIrradiance = 0.02 * mainLightIntensity[2];
      `),t.hasNormalTexture?i.code.add(T`mat3 tangentSpace = computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);
vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`):i.code.add(T`vec3 shadingNormal = normalVertex;`),i.code.add(T`${t.spherical?T`vec3 normalGround = normalize(positionWorld());`:T`vec3 normalGround = vec3(0.0, 0.0, 1.0);`}
      `),i.code.add(T`
        vec3 viewDir = normalize(vPositionWorldCameraRelative);
        ${t.pbrMode===ot.Simplified?T` float ssao = 1.0 - evaluateAmbientOcclusionInverse();`:T` float ssao = 1.0 - occlusion * evaluateAmbientOcclusionInverse();`}
        ${t.snowCover?T`
                vec3 surfaceNormal = normalize(shadingNormalWorld());
                float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
                materialColor.rgb = mix(materialColor.rgb, vec3(1.1), snow);
                ssao = mix(ssao, 0.5 * ssao, snow);
                shadingNormal = mix(shadingNormal, surfaceNormal, snow);`:""}

        ${s?T` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
        ${t.pbrMode===ot.Simplified?T` vec4 shadedColor = vec4(evaluatePBRSimplifiedLighting(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround), materialColor.a);`:"vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);"}
        `)):(t.receiveShadows?i.code.add(T`float shadow = evaluateShadow();`):t.spherical?(tP(i),i.code.add(T`float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());
float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);`)):i.code.add(T`float shadow = 0.0;`),o&&i.uniforms.add(new ct("ovNormalTex",(a,l)=>{var c;return(c=l.overlay)==null?void 0:c.getTexture(Ui.WaterNormal)})),t.snowCover&&i.code.add(T`vec3 surfaceNormal = normalize(cross(dFdx(vPositionWorldCameraRelative), dFdy(vPositionWorldCameraRelative)));
float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);`),i.code.add(T`
        float ambientOcclusion = evaluateAmbientOcclusion();
        vec3 additionalLight = evaluateAdditionalLighting(ambientOcclusion, positionWorld());

        ${s?T` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec4 shadedColor = vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);
      ${o?T`
              vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, overlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, vPosition_view, positionWorld());
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                // un-gamma the ground color to mix in linear space
                shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
              }`:""}
      `)),i.code.add(T`
        fragColor = highlightSlice(shadedColor, vPositionWorldCameraRelative);
        ${t.transparencyPassType===ft.Color?"fragColor = premultiplyAlpha(fragColor);":""}
      }
    `)),(t.output===U.LinearDepth||n)&&(e.include(ly,t),i.code.add(T`void main() {
discardBySlice(vPositionWorldCameraRelative);
vec4 textureColor = readBaseColorTexture();
discardOrAdjustAlpha(textureColor);
outputDepth(linearDepth);
}`)),t.output===U.Normal&&(e.include(C0e,t),i.code.add(T`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        // note: the alpha component needs to be 1.0 in order for this material to influence ambient occlusion,
        // see the ssao fragment shader
        float alpha = ${t.normalType===$r.Ground?"0.0":"1.0"};
        fragColor = vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);
      }
    `)),t.output===U.ObjectAndLayerIdColor&&e.fragment.code.add(T`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${s?T`fragColor = getOverlayColorTexel(vtcOverlay);`:"outputObjectAndLayerIdColor();"}
      }
    `),t.output===U.Highlight&&(e.include(Vv),i.code.add(T`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${s?T`
                vec4 overlayColor = getCombinedOverlayColor();
                if (overlayColor.a == 0.0) {
                  fragColor = vec4(0.0);
                  return;
                }`:""}

        outputHighlight();
      }
    `)),e}const rMt=Object.freeze(Object.defineProperty({__proto__:null,build:Z4e},Symbol.toStringTag,{value:"Module"}));let J4e=class Q4e extends Vr{initializeConfiguration(e,r){r.spherical=e.viewingMode===De.Global,r.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new Lr(e.rctx,Q4e.shader.get().build(this.configuration),K4e)}_setPipelineState(e){const r=this.configuration,i=r.integratedMeshMode!==Yh.None,n=e===ft.NONE,s=e===ft.FrontFace;return kt({blending:r.output!==U.Color&&r.output!==U.Alpha||!r.blendingEnabled?null:n?Zu:Cy(e),culling:rU(r.cullFace),depthTest:{func:Gv(e)},depthWrite:n||s?ru:null,colorWrite:Yt,stencilWrite:i||r.hasOccludees?pg:null,stencilTest:i?mdt(tc.IntegratedMeshMaskExcluded):r.hasOccludees?jv:null,polygonOffset:n||s?r.hasPolygonOffset?{factor:2,units:2}:null:AU})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}};J4e.shader=new Ir(rMt,()=>ge(()=>Promise.resolve().then(()=>o4t),void 0));const K4e=new Map([[R.POSITION,0],[R.NORMAL,1],[R.NORMALCOMPRESSED,1],[R.COLOR,2],[R.UV0,3],[R.UVREGION,4],[R.COMPONENTINDEX,5]]);let iMt=class extends Ai{constructor(){super(...arguments),this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){if(this._dirty=!1,this._parameterBlocks!=null)for(const e of this._parameterBlocks)this[e]._setClean()}get dirty(){return this._dirty||this._checkParameterBlocksDirty()}_checkParameterBlocksDirty(){if(this._parameterBlocks==null)return!1;for(const e of this._parameterBlocks)if(this[e].dirty)return!0;return!1}},qne=class{constructor(){this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){this._dirty=!1}get dirty(){return this._dirty}};function Tn(t={}){return(e,r)=>{const i=e._parameterCount??0;if(e._parameterCount=i+1,t.vectorOps){const n=t.vectorOps;Object.defineProperty(e,r,{get(){return this[i]},set(s){const o=this[i];if(o==null)this[i]=s;else{if(n.equals(o,s))return;n.copy(o,s)}this._setDirty()}})}else Object.defineProperty(e,r,{get(){return this[i]},set(n){this[i]!==n&&(t.dispose&&this[i]&&this[i].dispose(),this[i]=n,this._setDirty())}})}}function E0e(){return(t,e)=>{const r=t._parameterCount??0;t._parameterCount=r+1,t._parameterBlocks=t._parameterBlocks||[],t._parameterBlocks.push(r),Object.defineProperty(t,e,{get(){return this[r]},set(i){this[r]!==i&&(this[r]=i,this._setDirty())}})}}let sB=class{constructor(e){this._low=C(),this._high=C(),e&&this.set(e)}get low(){return this._low}get high(){return this._high}set(e){ce(this._low,ce(P0e,e));const r=Yi(P0e,e,this._low);ce(this._high,r)}get(e){return fe(e,this._low,this._high)}getLowScaled(e){return ne(e,this._low,1)}};const P0e=kc();let uo=class extends iMt{constructor(e,r){super(),this.toMapSpace=r,this.baseColor=Bt(1,1,1,1),this.usePBR=!1,this.hasParametersFromSource=!1,this.mrrFactors=Ea(IU),this.emissiveFactor=Ce(0,0,0),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null,this.objectOpacity=1,this.commonMaterialParameters=new zF,this.componentParameters=new FR,this.textureAlphaCutoff=d8,this.alphaDiscardMode=fi.Opaque,this.isIntegratedMesh=!1,this.polygonOffsetEnabled=!1,this.ellipsoidMode=Km.Earth,this.hasOccludees=!1,this._techniqueConfiguration=new nr;const i=new sB(e.position),n=nSe(e.rotationScale);L2(n,n),gd(n,n),this.transformNormalGlobalFromModel=n,this.transformWorldFromModelTL=i.low,this.transformWorldFromModelTH=i.high,this.transformWorldFromModelRS=e.rotationScale}dispose(){this._technique=tr(this._technique),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null}get texture(){return this.baseColorTexture!=null?this.baseColorTexture.glTexture:null}get textureMetallicRoughness(){return this.metallicRoughnessTexture!=null?this.metallicRoughnessTexture.glTexture:null}get textureEmissive(){return this.emissionTexture!=null?this.emissionTexture.glTexture:null}get textureOcclusion(){return this.occlusionTexture!=null?this.occlusionTexture.glTexture:null}get textureNormal(){return this.normalTexture!=null?this.normalTexture.glTexture:null}prepareTechnique(e,r,i,n){const s=this._techniqueConfiguration;s.hasVertexColors=n.colors,s.hasNormals=n.hasNormals,s.textureCoordinateType=n.textureCoordinates,s.hasMetallicRoughnessTexture=this.metallicRoughnessTexture!=null,s.hasEmissionTexture=this.emissionTexture!=null,s.hasOcclusionTexture=this.occlusionTexture!=null,s.hasNormalTexture=this.normalTexture!=null,s.transparencyPassType=r.identifier===Bc.Material&&i.transparencyPassType!=null?i.transparencyPassType:ft.NONE,s.multipassEnabled=r.identifier===Bc.Material&&i.multipassEnabled,s.cullAboveGround=r.identifier===Bc.Material&&i.multipassTerrain.cullAboveGround,s.ellipsoidMode=this.ellipsoidMode,s.componentData=this.componentParameters.type,s.cullFace=this.commonMaterialParameters.cullFace,s.doubleSidedMode=this.commonMaterialParameters.doubleSided?gn.View:gn.None,s.hasColorTexture=this.baseColorTexture!=null;const o=this._computeWhichMaterialPass();if(s.blendingEnabled=o===ol.Transparent||o===ol.OpaqueAndTransparent,s.alphaDiscardMode=this.alphaDiscardMode,s.integratedMeshMode=this.isIntegratedMesh?oMt(i)?sMt(i)?Yh.ColorOverlayWithWater:Yh.ColorOverlay:Yh.NoOverlay:Yh.None,s.hasPolygonOffset=this.polygonOffsetEnabled,s.pbrMode=s.integratedMeshMode===Yh.ColorOverlayWithWater?ot.WaterOnIntegratedMesh:this.usePBR?this.hasParametersFromSource?se("enable-feature:im-shading")&&this.isIntegratedMesh?ot.Simplified:ot.Schematic:ot.Normal:ot.Disabled,s.normalType=n.needsNormals?s.hasNormals?$r.Compressed:$r.ScreenDerivative:$r.Ground,s.hasSlicePlane=i.slicePlane!=null&&this.commonMaterialParameters.hasSlicePlane,r.identifier===Bc.ShadowMap)s.output=U.Shadow,s.vertexDiscardMode=zu.None;else if(r.identifier===Bc.Highlight)s.output=U.Highlight,s.vertexDiscardMode=zu.None;else{switch(o===ol.OpaqueAndTransparent?s.vertexDiscardMode=r.transparent?zu.Opaque:zu.Transparent:s.vertexDiscardMode=zu.None,s.output=r.output,s.receiveAmbientOcclusion=!1,s.receiveShadows=!1,r.output){case U.Color:s.receiveAmbientOcclusion=i.ssao!=null,s.hasOccludees=i.hasOccludees,s.receiveShadows=i.shadowMap.ready,s.hasScreenSpaceReflections=i.ssr.lastFrameColor!=null,s.hasCloudsReflections=i.cloudsFade.data!=null;break;case U.Alpha:s.hasOccludees=i.hasOccludees;break;case U.ObjectAndLayerIdColor:s.objectAndLayerIdColor=!0}s.snowCover=this.hasSnowCover(i)}return this._technique=e.releaseAndAcquire(J4e,s,this._technique),this._setClean(),this._technique}hasSnowCover(e){return e.weather!=null&&e.weatherVisible&&e.weather.type==="snowy"&&e.weather.snowCover==="enabled"}submit(e,r,i){if(this.objectOpacity===0)return;const n=i.renderable.geometry,s=i.components,o=i.renderable.meta.cameraDepthSquared,a=s.geometryRanges,l=s.highlightRanges,c=s.defaultShadowMapRanges;switch(this._computeWhichMaterialPass()){case ol.Opaque:e.materialOpaque.submitDraw(this,n,a,o);break;case ol.Transparent:e.materialTransparent.submitDraw(this,n,a,o);break;case ol.OpaqueAndTransparent:e.materialOpaque.submitDraw(this,n,a,o),e.materialTransparent.submitDraw(this,n,a,o);break;case ol.IntegratedMesh:e.materialIntegratedMesh.submitDraw(this,n,a,o),nMt(r)&&e.highlightIntegratedMesh.submitDraw(this,n,a,o)}const u=this.componentParameters.castShadows!==Hs.None;u&&e.shadowMap.submitDraw(this,n,a,o),l!=null&&(e.highlight.submitDraw(this,n,l,o),u&&e.highlightShadowMap.submitDraw(this,n,l,o)),u&&c!=null&&e.defaultShadowMap.submitDraw(this,n,c,o)}_computeWhichMaterialPass(){return this.isIntegratedMesh?ol.IntegratedMesh:this.objectOpacity<1?ol.Transparent:this.componentParameters.opaqueOverride===Hs.All?ol.Opaque:this.baseColor[3]<1||this.alphaDiscardMode===fi.Blend||this.alphaDiscardMode===fi.MaskBlend?ol.Transparent:this.componentParameters.transparent===Hs.None?ol.Opaque:this.componentParameters.transparent===Hs.All?ol.Transparent:ol.OpaqueAndTransparent}};var ol,Hs;d([Tn({vectorOps:CSe})],uo.prototype,"baseColor",void 0),d([Tn()],uo.prototype,"usePBR",void 0),d([Tn()],uo.prototype,"hasParametersFromSource",void 0),d([Tn({vectorOps:Iae})],uo.prototype,"mrrFactors",void 0),d([Tn({vectorOps:Iae})],uo.prototype,"emissiveFactor",void 0),d([Tn({dispose:!0})],uo.prototype,"baseColorTexture",void 0),d([Tn({dispose:!0})],uo.prototype,"metallicRoughnessTexture",void 0),d([Tn({dispose:!0})],uo.prototype,"emissionTexture",void 0),d([Tn({dispose:!0})],uo.prototype,"occlusionTexture",void 0),d([Tn({dispose:!0})],uo.prototype,"normalTexture",void 0),d([Tn()],uo.prototype,"objectOpacity",void 0),d([E0e()],uo.prototype,"commonMaterialParameters",void 0),d([E0e()],uo.prototype,"componentParameters",void 0),d([Tn()],uo.prototype,"textureAlphaCutoff",void 0),d([Tn()],uo.prototype,"alphaDiscardMode",void 0),d([Tn()],uo.prototype,"isIntegratedMesh",void 0),d([Tn()],uo.prototype,"polygonOffsetEnabled",void 0),d([Tn()],uo.prototype,"ellipsoidMode",void 0),d([Tn()],uo.prototype,"hasOccludees",void 0),function(t){t[t.Opaque=0]="Opaque",t[t.Transparent=1]="Transparent",t[t.OpaqueAndTransparent=2]="OpaqueAndTransparent",t[t.IntegratedMesh=3]="IntegratedMesh"}(ol||(ol={}));let zF=class extends qne{constructor(){super(...arguments),this.doubleSided=!1,this.cullFace=Pi.Back,this.hasSlicePlane=!0}};d([Tn()],zF.prototype,"doubleSided",void 0),d([Tn()],zF.prototype,"cullFace",void 0),d([Tn()],zF.prototype,"hasSlicePlane",void 0);let FR=class extends qne{constructor(){super(...arguments),this.externalColor=Bt(1,1,1,1),this.externalColorMixMode=Ns.Multiply,this.castShadows=Hs.All}get transparent(){return this.externalColor[3]<1?Hs.All:Hs.None}get opaqueOverride(){return this.externalColorMixMode===Ns.Replace&&this.externalColor[3]===1?Hs.All:Hs.None}get visible(){return this.externalColor[3]>0?Hs.All:Hs.None}get type(){return Qm.Uniform}};d([Tn({vectorOps:CSe})],FR.prototype,"externalColor",void 0),d([Tn()],FR.prototype,"externalColorMixMode",void 0),d([Tn()],FR.prototype,"castShadows",void 0),function(t){t[t.All=0]="All",t[t.Some=1]="Some",t[t.None=2]="None"}(Hs||(Hs={}));let _O=class extends qne{constructor(){super(...arguments),this.texture=null,this.transparent=Hs.None,this.opaqueOverride=Hs.None,this.castShadows=Hs.None}get type(){return Qm.Varying}};function nMt(t){var e;return((e=t.overlay)==null?void 0:e.getTexture(Ui.Highlight))!=null}function sMt(t){var e;return((e=t.overlay)==null?void 0:e.getTexture(Ui.WaterNormal))!=null}function oMt(t){var e;return((e=t.overlay)==null?void 0:e.getTexture(Ui.ColorNoRasterImage))!=null}d([Tn()],_O.prototype,"texture",void 0),d([Tn()],_O.prototype,"transparent",void 0),d([Tn()],_O.prototype,"opaqueOverride",void 0),d([Tn()],_O.prototype,"castShadows",void 0);const X8=Qi().vec3f(R.POSITION).u16(R.COMPONENTINDEX),e5e=Qi().vec2u8(R.SIDENESS),aMt=ou(e5e),VJ=Qi().vec3f(R.POSITION0).vec3f(R.POSITION1).vec2i16(R.NORMALCOMPRESSED).u16(R.COMPONENTINDEX).u8(R.VARIANTOFFSET,{glNormalized:!0}).u8(R.VARIANTSTROKE).u8(R.VARIANTEXTENSION,{glNormalized:!0}),GJ=Qi().vec3f(R.POSITION0).vec3f(R.POSITION1).vec2i16(R.NORMALCOMPRESSED).vec2i16(R.NORMAL2COMPRESSED).u16(R.COMPONENTINDEX).u8(R.VARIANTOFFSET,{glNormalized:!0}).u8(R.VARIANTSTROKE).u8(R.VARIANTEXTENSION,{glNormalized:!0}),t5e=new Map([[R.POSITION0,0],[R.POSITION1,1],[R.COMPONENTINDEX,2],[R.VARIANTOFFSET,3],[R.VARIANTSTROKE,4],[R.VARIANTEXTENSION,5],[R.NORMALCOMPRESSED,6],[R.NORMAL2COMPRESSED,7],[R.SIDENESS,8]]);function A0e(t,e,r){const i=e/3,n=new Uint32Array(r+1),s=new Uint32Array(r+1),o=(b,w)=>{b<w?n[b+1]++:s[w+1]++};for(let b=0;b<i;b++){const w=t[3*b],x=t[3*b+1],S=t[3*b+2];o(w,x),o(x,S),o(S,w)}let a=0,l=0;for(let b=0;b<r;b++){const w=n[b+1],x=s[b+1];n[b+1]=a,s[b+1]=l,a+=w,l+=x}const c=new Uint32Array(6*i),u=n[r],h=(b,w,x)=>{if(b<w){const S=n[b+1]++;c[2*S]=w,c[2*S+1]=x}else{const S=s[w+1]++;c[2*u+2*S]=b,c[2*u+2*S+1]=x}};for(let b=0;b<i;b++){const w=t[3*b],x=t[3*b+1],S=t[3*b+2];h(w,x,b),h(x,S,b),h(S,w,b)}const p=(b,w)=>{const x=2*b,S=w-b;for(let E=1;E<S;E++){const A=c[x+2*E],O=c[x+2*E+1];let L=E-1;for(;L>=0&&c[x+2*L]>A;L--)c[x+2*L+2]=c[x+2*L],c[x+2*L+3]=c[x+2*L+1];c[x+2*L+2]=A,c[x+2*L+3]=O}};for(let b=0;b<r;b++)p(n[b],n[b+1]),p(u+s[b],u+s[b+1]);const f=new Int32Array(3*i),g=(b,w)=>b===t[3*w]?0:b===t[3*w+1]?1:b===t[3*w+2]?2:-1,_=(b,w)=>{const x=g(b,w);f[3*w+x]=-1},v=(b,w,x,S)=>{const E=g(b,w);f[3*w+E]=S;const A=g(x,S);f[3*S+A]=w};for(let b=0;b<r;b++){let w=n[b];const x=n[b+1];let S=s[b];const E=s[b+1];for(;w<x&&S<E;){const A=c[2*w],O=c[2*u+2*S];A===O?(v(b,c[2*w+1],O,c[2*u+2*S+1]),w++,S++):A<O?(_(b,c[2*w+1]),w++):(_(O,c[2*u+2*S+1]),S++)}for(;w<x;)_(b,c[2*w+1]),w++;for(;S<E;)_(c[2*u+2*S],c[2*u+2*S+1]),S++}return f}let r5e=class{updateSettings(e){this.settings=e,this._edgeHashFunction=e.reducedPrecision?cMt:lMt}write(e,r,i){const n=this._edgeHashFunction(i);A4.seed=n;const s=A4.getIntRange(0,255),o=A4.getIntRange(0,this.settings.variants-1),a=.7,l=A4.getFloat(),c=255*(.5*uMt(-(1-Math.min(l/a,1))+Math.max(0,l-a)/(1-a),1.2)+.5);e.position0.setVec(r,i.position0),e.position1.setVec(r,i.position1),e.componentIndex.set(r,i.componentIndex),e.variantOffset.set(r,s),e.variantStroke.set(r,o),e.variantExtension.set(r,c)}trim(e,r){return e.slice(0,r)}};const Yne=new Float32Array(6),Z8=new Uint32Array(Yne.buffer),O1=new Uint32Array(1);function lMt(t){const e=Yne;e[0]=t.position0[0],e[1]=t.position0[1],e[2]=t.position0[2],e[3]=t.position1[0],e[4]=t.position1[1],e[5]=t.position1[2],O1[0]=5381;for(let r=0;r<Z8.length;r++)O1[0]=31*O1[0]+Z8[r];return O1[0]}function cMt(t){const e=Yne;e[0]=ZT(t.position0[0]),e[1]=ZT(t.position0[1]),e[2]=ZT(t.position0[2]),e[3]=ZT(t.position1[0]),e[4]=ZT(t.position1[1]),e[5]=ZT(t.position1[2]),O1[0]=5381;for(let r=0;r<Z8.length;r++)O1[0]=31*O1[0]+Z8[r];return O1[0]}const M0e=1e4;function ZT(t){return Math.round(t*M0e)/M0e}function uMt(t,e){const r=t<0?-1:1;return Math.abs(t)**e*r}let J8=class{constructor(){this._commonWriter=new r5e}updateSettings(e){this._commonWriter.updateSettings(e)}allocate(e){return VJ.createBuffer(e)}write(e,r,i){this._commonWriter.write(e,r,i),fe(JT,i.faceNormal0,i.faceNormal1),pe(JT,JT);const{typedBuffer:n,typedBufferStride:s}=e.normalCompressed;mf(n,r,JT[0],JT[1],JT[2],s)}trim(e,r){return this._commonWriter.trim(e,r)}};J8.Layout=VJ,J8.glLayout=ou(VJ,1);let Q8=class{constructor(){this._commonWriter=new r5e}updateSettings(e){this._commonWriter.updateSettings(e)}allocate(e){return GJ.createBuffer(e)}write(e,r,i){this._commonWriter.write(e,r,i);{const{typedBuffer:n,typedBufferStride:s}=e.normalCompressed;mf(n,r,i.faceNormal0[0],i.faceNormal0[1],i.faceNormal0[2],s)}{const{typedBuffer:n,typedBufferStride:s}=e.normal2Compressed;mf(n,r,i.faceNormal1[0],i.faceNormal1[1],i.faceNormal1[2],s)}}trim(e,r){return this._commonWriter.trim(e,r)}};Q8.Layout=GJ,Q8.glLayout=ou(GJ,1);const JT=C(),A4=new wx,Aw=-1;var K8;function hMt(t,e,r,i=yMt){const n=t.vertices.position,s=t.vertices.componentIndex,o=Nt(i.anglePlanar),a=Nt(i.angleSignificantEdge),l=Math.cos(a),c=Math.cos(o),u=jJ.edge,h=u.position0,p=u.position1,f=u.faceNormal0,g=u.faceNormal1,_=gMt(t),v=mMt(t),b=v.length/4,w=e.allocate(b);let x=0;const S=b,E=r.allocate(S);let A=0,O=0,L=0;const z=pze(0,b),k=new Float32Array(b);k.forEach((Y,le,D)=>{n.getVec(v[4*le],h),n.getVec(v[4*le+1],p),D[le]=Di(h,p)}),z.sort((Y,le)=>k[le]-k[Y]);const q=new Array,B=new Array;for(let Y=0;Y<b;Y++){const le=z[Y],D=k[le],I=v[4*le],F=v[4*le+1],G=v[4*le+2],H=v[4*le+3],Z=H===Aw;if(n.getVec(I,h),n.getVec(F,p),Z)ie(f,_[3*G],_[3*G+1],_[3*G+2]),ce(g,f),u.componentIndex=s.get(I),u.cosAngle=de(f,g);else{if(ie(f,_[3*G],_[3*G+1],_[3*G+2]),ie(g,_[3*H],_[3*H+1],_[3*H+2]),u.componentIndex=s.get(I),u.cosAngle=de(f,g),pMt(u,c))continue;u.cosAngle<-.9999&&ce(g,f)}O+=D,L++,Z||dMt(u,l)?(e.write(w,x++,u),q.push(D)):fMt(u,o)&&(r.write(E,A++,u),B.push(D))}const J=new Float32Array(q.reverse()),W=new Float32Array(B.reverse());return{regular:{instancesData:e.trim(w,x),lodInfo:{lengths:J}},silhouette:{instancesData:r.trim(E,A),lodInfo:{lengths:W}},averageEdgeLength:O/L}}function dMt(t,e){return t.cosAngle<e}function pMt(t,e){return t.cosAngle>e}function fMt(t,e){const r=Ks(t.cosAngle),i=jJ.fwd,n=jJ.ortho;return fy(i,t.position1,t.position0),r*(de(Je(n,t.faceNormal0,t.faceNormal1),i)>0?-1:1)>e}function mMt(t){const e=t.faces.length/3,r=t.faces,i=t.neighbors;let n=0;for(let a=0;a<e;a++){const l=i[3*a],c=i[3*a+1],u=i[3*a+2],h=r[3*a],p=r[3*a+1],f=r[3*a+2];n+=l===Aw||h<p?1:0,n+=c===Aw||p<f?1:0,n+=u===Aw||f<h?1:0}const s=new Int32Array(4*n);let o=0;for(let a=0;a<e;a++){const l=i[3*a],c=i[3*a+1],u=i[3*a+2],h=r[3*a],p=r[3*a+1],f=r[3*a+2];(l===Aw||h<p)&&(s[o++]=h,s[o++]=p,s[o++]=a,s[o++]=l),(c===Aw||p<f)&&(s[o++]=p,s[o++]=f,s[o++]=a,s[o++]=c),(u===Aw||f<h)&&(s[o++]=f,s[o++]=h,s[o++]=a,s[o++]=u)}return s}function gMt(t){const e=t.faces.length/3,r=t.vertices.position,i=t.faces,n=vj.v0,s=vj.v1,o=vj.v2,a=new Float32Array(3*e);for(let l=0;l<e;l++){const c=i[3*l],u=i[3*l+1],h=i[3*l+2];r.getVec(c,n),r.getVec(u,s),r.getVec(h,o),ye(s,s,n),ye(o,o,n),Je(n,s,o),pe(n,n),a[3*l]=n[0],a[3*l+1]=n[1],a[3*l+2]=n[2]}return a}(function(t){t[t.SOLID=0]="SOLID",t[t.SKETCH=1]="SKETCH"})(K8||(K8={}));const jJ={edge:{position0:C(),position1:C(),faceNormal0:C(),faceNormal1:C(),componentIndex:0,cosAngle:0},ortho:C(),fwd:C()},vj={v0:C(),v1:C(),v2:C()},yMt={anglePlanar:4,angleSignificantEdge:35};function _Mt(t){const e=vMt(t.data,t.skipDeduplicate,t.indices,t.indicesLength);return O0e.updateSettings(t.writerSettings),R0e.updateSettings(t.writerSettings),hMt(e,O0e,R0e)}function vMt(t,e,r,i){if(e){const o=A0e(r,i,t.count);return new bMt(r,i,o,t)}const n=NZ(t.buffer,t.stride/4,{originalIndices:r,originalIndicesLength:i}),s=A0e(n.indices,i,n.uniqueCount);return{faces:n.indices,facesLength:n.indices.length,neighbors:s,vertices:X8.createView(n.buffer)}}let bMt=class{constructor(e,r,i,n){this.faces=e,this.facesLength=r,this.neighbors=i,this.vertices=n}};const O0e=new J8,R0e=new Q8,rJt=Qi().vec3f(R.POSITION0).vec3f(R.POSITION1),wMt=Qi().vec3f(R.POSITION0).vec3f(R.POSITION1).u16(R.COMPONENTINDEX);let xMt=class{constructor(e){this._maxCount=e,this._nextIndex=0,this._recycledIndices=[]}get activeCount(){return this._nextIndex-this._recycledIndices.length}get availableCount(){return this._recycledIndices.length+this._maxCount-this._nextIndex}acquire(){return this._recycledIndices.length>0?this._recycledIndices.pop():this.availableCount?this._nextIndex++:void 0}release(e){this._recycledIndices.push(e)}},TMt=class{constructor(e,r=1){this._rctx=e,this._fieldCount=r,this.textureWidth=4096,this._dirty=!0;const i=new ri(this.textureWidth,1);i.samplingMode=Ht.NEAREST,i.wrapMode=Jt.CLAMP_TO_EDGE,this._texture=new Sr(this._rctx,i),this._data=new za(new ArrayBuffer(4*this.textureWidth))}dispose(){this._texture.dispose(),this._texture=void 0,this._data=void 0}setData(e,r,i,n,s,o){const a=e*this._fieldCount+r;this._dirty=!0,this._data.set(a,0,i),this._data.set(a,1,n),this._data.set(a,2,s),this._data.set(a,3,o)}setDataElement(e,r,i,n){const s=e*this._fieldCount+r;this._dirty=!0,this._data.set(s,i,n)}getDataElement(e,r,i){const n=e*this._fieldCount+r;return this._dirty=!0,this._data.get(n,i)}resizeToFit(e){const r=(e+1)*this._fieldCount;if(r>this._data.count){const i=Math.ceil(r/this.textureWidth)*this.textureWidth,n=new za(new ArrayBuffer(4*i));n.typedBuffer.set(this._data.typedBuffer),this._data=n}}updateTexture(){if(!this._dirty)return;const e=this._texture.descriptor.width,r=this._texture.descriptor.height;this._data.count>e*r&&this._texture.resize(e,this._data.count/e),this._texture.setData(this._data.typedBuffer),this._dirty=!1}get texture(){return this._texture}};const i5e=65536;let SMt=class{constructor(e,r=1){this.textureBuffer=new TMt(e,r),this._indexManager=new xMt(i5e)}dispose(){this.textureBuffer.dispose(),this.textureBuffer=void 0}get availableCount(){return this._indexManager.availableCount}get activeCount(){return this._indexManager.activeCount}acquireIndex(){const e=this._indexManager.acquire();return this.textureBuffer.resizeToFit(e),e}releaseIndex(e){this._indexManager.release(e)}},n5e=class{constructor(e,r=1){this._rctx=e,this._fieldCount=r,this._buffers=[]}garbageCollect(){this._buffers=this._buffers.filter(e=>e.activeCount!==0||(e.dispose(),!1))}destroy(){this._buffers.forEach(e=>e.dispose()),this._buffers=[]}getBuffer(e){for(const i of this._buffers)if(i.availableCount>=e)return i;if(e>i5e)return null;const r=new SMt(this._rctx,this._fieldCount);return this._buffers.push(r),r}updateTextures(){for(const e of this._buffers)e.textureBuffer.updateTexture()}};const $0e=()=>re.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");let CMt=class{constructor(e,r){this._renderManager=e,this._viewingMode=r,this._elevationRangeCacheVerticalOffset=NaN,this._elevationRangeCacheMin=NaN,this._elevationRangeCacheMax=NaN,this._visible=new Vt,this._hidden=new Vt,this._renderSubmit=new qAt(this),this._renderManager.register(this._renderSubmit),this._hasObjectAndLayerId=se("enable-feature:objectAndLayerId-rendering"),this._componentBufferManager=new n5e(e.rctx,2+(this._hasObjectAndLayerId?1:0))}destroy(){pt(this._hidden.length===0&&this._visible.length===0,"ObjectCollection should be empty upon disposal"),this._componentBufferManager.destroy(),this._visible.forAll(e=>e.destroy()),this._hidden.forAll(e=>e.destroy()),this._visible.clear(),this._hidden.clear()}createObject(e){const r=e.geometry,i=new pAt(this._componentBufferManager,Xm(r.componentOffsets)),n=this._createRenderable(e,i),s=new wAt(this._viewingMode,r.positionData,i),o=new mAt(e.transform,e.toMapSpace,e.obb.clone(),i,n,s);return(o.visible?this._visible:this._hidden).push(o),o}destroyObject(e){const r=e;(r.visible?this._visible:this._hidden).removeUnordered(r),r.destroy(),this._notifyDirty()}setObjectVisibility(e,r){const i=e;r!==i.visible&&(r?(this._hidden.removeUnordered(i),this._visible.push(i)):(this._visible.removeUnordered(i),this._hidden.push(i)),i.visible=r,this._notifyDirty())}preSubmit(e){const r=e.camera.eye;this.visibleObjects.forAll(i=>i.renderable.meta.cameraDepthSquared=Uo(r,i.obb.center))}getMaterial(e){return e.renderable.material}updateMaterial(e,r){const i=e.renderable.material;r(i),i.dirty&&this._notifyDirty()}setAllComponentVisibilities(e,r){const i=e;i.components.visibility.reset(r),i.components.visibilityDirty(),this._notifyDirty()}forEachVisibleComponent(e,r){return e.components.visibility.forEachComponent(r)}getComponentCount(e){const r=e,i=r.components.visibility.componentCount;return{visible:i,invisible:r.components.count-i}}setComponentData(e,r){const i=e,n=i.renderable.material,s=i.components,o=s.materialDataBuffer,a=s.materialDataIndices,l=new XAt,c=o.textureBuffer,u=new Uint8Array(4),h=new Uint32Array(u.buffer);let p=0,f=0,g=0,_=s.verticalOffsets,v=1/0,b=-1/0,w=!1,x=!1,S=0;for(let E=0;E<s.count;E++){r(E,l),p+=+(l.externalColor[3]<1),f+=+(l.externalColorMixMode===Ns.Replace&&l.externalColor[3]===1),g+=+l.castShadows,MRe(l.externalColor,l.externalColorMixMode,u),u[2]=254&u[2]|+l.castShadows,c.setData(a[E],0,u[0],u[1],u[2],u[3]),w||(w=E>0&&S!==h[0]),S=h[0],x||(x=l.elevationOffset!==0),x&&_==null&&(_=new Array(E).fill(0)),_!=null&&(_[E]=l.elevationOffset),v=Math.min(v,l.elevationOffset),b=Math.max(b,l.elevationOffset),X4e(l.elevationOffset,u),c.setData(a[E],1,u[0],u[1],u[2],u[3]);const A=l.objectAndLayerIdColor;A!=null&&c.setData(a[E],2,A[0],A[1],A[2],A[3]),l.pickable!==UJ(s.pickability,E)&&(s.pickability=gAt(s.pickability,s.count,E,l.pickable))}s.verticalOffsets=x?_:null,i.offsetObb=x?DCe(i.obb,v,b,this._viewingMode,i.offsetObb??i.obb.clone()):null,w||x||this._hasObjectAndLayerId?(n.componentParameters=new _O,n.componentParameters.castShadows=bj(g,s.count),n.componentParameters.transparent=bj(p,s.count),n.componentParameters.opaqueOverride=bj(f,s.count),n.componentParameters.texture=c,c.updateTexture()):(n.componentParameters=new FR,n.componentParameters.castShadows=l.castShadows?Hs.All:Hs.None,n.componentParameters.externalColor=l.externalColor,n.componentParameters.externalColorMixMode=l.externalColorMixMode),this._elevationRangeCacheVerticalOffset=NaN,this._notifyDirty()}getComponentAabb(e,r,i,n=!1){e.intersectionGeometry.getComponentAabb(r,i);const s=e,o=s.components.verticalOffsets;if(n||o==null)return i;const a=o[r];if(this._viewingMode===De.Local||a===0)return i[2]+=a,i[5]+=a,i;const l=_ce(a);return l.localOrigin=s.transform.position,l.applyToAabb(i)}getComponentObb(e){return e.obb}getObjectTransform(e){return e.transform}getComponentPositions(e,r,i){return e.intersectionGeometry.getComponentPositions(r,i)}expandRangeWithComponentObjectElevationRange(e,r,i,n){Number.isNaN(this._elevationRangeCacheVerticalOffset)||this._elevationRangeCacheVerticalOffset!==r||n.expandElevationRangeValues(this._elevationRangeCacheMin,this._elevationRangeCacheMax);const s=e,o=s.components,a=o.count,l=o.verticalOffsets,c=s.intersectionGeometry,u=this._viewingMode===De.Local,h=c.getComponentAabbs(),p=PMt;let f=1/0,g=-1/0;for(let _=0;_<a;_++){const v=6*_,b=(l==null?void 0:l[_])??0;let w=1/0,x=-1/0;if(u)w=h[v+2]+b+r,x=h[v+5]+b+r;else{if(p[0]=h[v],p[1]=h[v+1],p[2]=h[v+2],p[3]=h[v+3],p[4]=h[v+4],p[5]=h[v+5],b!==0){const O=_ce(b);O.localOrigin=s.transform.position,O.applyToAabb(p)}const S=Math.max(Math.abs(p[3]),Math.abs(p[0])),E=Math.max(Math.abs(p[4]),Math.abs(p[1])),A=r+p[5]+i;n.expandElevationRangeValues(r+p[2],Math.sqrt(S*S+E*E+A*A)-i)}n.expandElevationRangeValues(w,x),f=Math.min(f,w),g=Math.max(g,x)}this._elevationRangeCacheVerticalOffset=r,this._elevationRangeCacheMin=f,this._elevationRangeCacheMax=g}intersect(e,r,i,n,s,o,a){const l=e,{transform:c}=l,{position:u}=c;return s!=null&&(s.localOrigin=u),l.intersectionGeometry.intersect(r,i,n,s,l.components.verticalOffsets,o,c,a??!1)}addEdges(e,r,i,n){const s=e,{indices:o,positions:a}=s.intersectionGeometry,l=s.components.offsets;return r.addComponentObject(s,a,o,l,i,n)}async extractEdgeInformation(e,r,i){const n=e,s=n.components.visibility;if(s.allInvisible())return{buffer:wMt.createBuffer(0),origin:[0,0,0]};const{indices:o,positions:a}=n.intersectionGeometry,l=n.components.offsets,c=X8.createBuffer(a.length/3);pL(c.position.typedBuffer,a,c.position.typedBufferStride,3),L$e(c.position,c.position,n.transform.rotationScale),this._setComponentIndices(c.componentIndex,o,l);const u=c.count,h=this._computeVisibilityIndices(o,s,l,u);return{origin:Zi(n.transform.position),buffer:await r.extractComponentsEdgeLocations({indices:h,indicesLength:h.length,skipDeduplicate:!0,data:c,writerSettings:{reducedPrecision:!1,variants:0}},i)}}_setComponentIndices(e,r,i){let n=0;for(let s=0;s<i.length-1;s++){const o=i[s],a=i[s+1];for(let l=o;l<a;l++){const c=r?r[l]:l;e.set(c,n)}n++}}_computeVisibilityIndices(e,r,i,n){if(e&&r.allVisible())return e;let s=0;r.forEachComponentRange((l,c)=>(s+=i[c]-i[l],!0));const o=cd(e)?new Array(s):(e==null?void 0:e.BYTES_PER_ELEMENT)===2||n<=65536?new Uint16Array(s):new Uint32Array(s);let a=0;return r.forEachComponentRange((l,c)=>{const u=i[l],h=i[c];for(let p=u;p<h;p++)o[a++]=e?e[p]:p;return!0}),o}addComponentHighlight(e,r){const i=e.components;i.highlightCounts==null&&(i.highlightCounts=new Uint32Array(i.count+1)),i.highlightCounts[r]++===0&&(i.highlightsDirty(),this._notifyDirty()),i.highlightCounts[i.count]++}removeComponentHighlight(e,r){const i=e.components;if(i.highlightCounts==null)return void $0e().warn("Removing non-existing highlight.");const n=i.highlightCounts[r],s=i.highlightCounts[i.count];if(n!==0){if(n>1)return i.highlightCounts[r]=n-1,void(i.highlightCounts[i.count]=s-1);i.highlightCounts[r]=0,i.highlightsDirty(),this._notifyDirty(),s===1?i.highlightCounts=null:i.highlightCounts[i.count]=s-1}else $0e().warn("Removing non-existing highlight.")}clearHighlights(e){const r=e.components;r.highlightCounts!=null&&(r.highlightCounts=null,r.highlightsDirty(),this._notifyDirty())}getObjectGPUMemoryUsage(e){return e.renderable.meta.gpuMemoryEstimate}get visibleObjects(){return this._visible}_createRenderable(e,r){const i=this._renderManager.rctx,n=e.geometry,s=n.vertices.layoutParameters,o=Wr.createVertex(i,Ar.STATIC_DRAW,n.vertices.data),a=n.indices?Wr.createIndex(i,Ar.STATIC_DRAW,n.indices):null,l=ou(YAt(s)),c=new Uint16Array(n.vertices.count);for(let _=0;_<r.count;_++){const v=r.offsets[_],b=r.offsets[_+1],w=r.materialDataIndices[_];if(n.indices!=null)for(let x=v;x<b;x++)c[n.indices[x]]=w;else for(let x=v;x<b;x++)c[x]=w}const u=Wr.createVertex(i,Ar.STATIC_DRAW,c.buffer),h=new uo(e.transform,e.toMapSpace),p=new _d(i,K4e,{data:l,componentIndices:EMt},{data:o,componentIndices:u},a),f=new zAt(p,sr.TRIANGLES,s,a!=null),g={cameraDepthSquared:.5,gpuMemoryEstimate:o.usedMemory+u.usedMemory+(a!=null?a.usedMemory:0)};return new kAt(h,f,g)}_notifyDirty(){this._renderManager.notifyDirty()}};const EMt=ou(Qi().u16(R.COMPONENTINDEX));function bj(t,e){return t===e?Hs.All:t===0?Hs.None:Hs.Some}const PMt=vs();let oB=class extends Ai{constructor(){super(...arguments),this.opacity=1}};function s5e(t){const e=new Or;return e.include(Ga),e.fragment.uniforms.add(new ct("tex",r=>r.texture)),t.hasOpacityFactor&&e.fragment.uniforms.add(new $e("opacity",r=>r.opacity)),e.fragment.code.add(T`
    void main() {
      fragColor = texture(tex, uv) ${t.hasOpacityFactor?"* opacity":""};
    }`),e}const AMt=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:oB,build:s5e},Symbol.toStringTag,{value:"Module"}));var Aa;(function(t){t[t.None=0]="None",t[t.Alpha=1]="Alpha",t[t.PremultipliedAlpha=2]="PremultipliedAlpha",t[t.COUNT=3]="COUNT"})(Aa||(Aa={}));let ez=class extends cc{constructor(){super(...arguments),this.alphaMode=Aa.None,this.hasOpacityFactor=!1}};d([j({count:Aa.COUNT})],ez.prototype,"alphaMode",void 0),d([j()],ez.prototype,"hasOpacityFactor",void 0);let Xne=class o5e extends Vr{initializeProgram(e){return new Lr(e.rctx,o5e.shader.get().build(this.configuration),Mr)}initializePipeline(){switch(this.configuration.alphaMode){case Aa.None:return kt({colorWrite:Yt});case Aa.Alpha:return kt({blending:Wo(Se.SRC_ALPHA,Se.ONE,Se.ONE_MINUS_SRC_ALPHA,Se.ONE_MINUS_SRC_ALPHA),colorWrite:Yt});case Aa.PremultipliedAlpha:case Aa.COUNT:return kt({blending:tu(Se.ONE,Se.ONE_MINUS_SRC_ALPHA),colorWrite:Yt})}}};Xne.shader=new Ir(AMt,()=>ge(()=>Promise.resolve().then(()=>a4t),void 0));let Zne=class extends Ai{};function a5e(){const t=new Or;return t.include(Ga),t.fragment.uniforms.add(new ct("tex",e=>e.texture)),t.fragment.code.add(T`void main() {
fragColor = vec4(1.0 - texture(tex, uv).a);
}`),t}const MMt=Object.freeze(Object.defineProperty({__proto__:null,HUDCompositingPassParameters:Zne,build:a5e},Symbol.toStringTag,{value:"Module"}));let l5e=class c5e extends Vr{initializeProgram(e){return new Lr(e.rctx,c5e.shader.get().build(),Mr)}initializePipeline(){return kt({colorWrite:{r:!1,g:!0,b:!1,a:!1}})}};l5e.shader=new Ir(MMt,()=>ge(()=>Promise.resolve().then(()=>l4t),void 0));let Jne=class extends Ai{};function u5e(){const t=new Or;return t.include(Ga),t.fragment.uniforms.add(new ct("colorTexture",e=>e.colorTexture),new ct("alphaTexture",e=>e.alphaTexture),new ct("frontFaceTexture",e=>e.frontFaceTexture)),t.fragment.code.add(T`void main() {
vec4 srcColor = texture(colorTexture, uv);
if(srcColor.a <= 1e-5){
discard;
}
float srcAlpha = texture(alphaTexture, uv).r;
vec4 frontFace = texture(frontFaceTexture, uv);
fragColor = vec4(mix(srcColor.rgb / srcColor.a, frontFace.rgb, frontFace.a), 1.0 - srcAlpha);
}`),t}const OMt=Object.freeze(Object.defineProperty({__proto__:null,OITCompositingPassParameters:Jne,build:u5e},Symbol.toStringTag,{value:"Module"}));let h5e=class d5e extends Vr{initializeProgram(e){return new Lr(e.rctx,d5e.shader.get().build(),Mr)}initializePipeline(){return kt({blending:Wo(Se.SRC_ALPHA,Se.ONE,Se.ONE_MINUS_SRC_ALPHA,Se.ONE_MINUS_SRC_ALPHA),colorWrite:Yt})}};h5e.shader=new Ir(OMt,()=>ge(()=>Promise.resolve().then(()=>c4t),void 0));let RMt=class{constructor(e,r){this._rctx=e,this._techniqueRepository=r,this._configuration=new ez,this._passParameters=new oB,this._oitParameters=new Jne,this._hudParameters=new Zne}compositeOIT(e,r,i,n){this._oitParameters.colorTexture=r,this._oitParameters.alphaTexture=i,this._oitParameters.frontFaceTexture=n;const s=this._techniqueRepository.acquire(h5e);this._rctx.bindTechnique(s,e,this._oitParameters),this._rctx.screen.draw(),s.release()}compositeHUD(e,r){this._hudParameters.texture=r;const i=this._techniqueRepository.acquire(l5e);this._rctx.bindTechnique(i,e,this._hudParameters),this._rctx.screen.draw(),i.release()}composite(e,r,i=Aa.None,n=1){this._configuration.alphaMode=i,this._configuration.hasOpacityFactor=n!==1,this._passParameters.texture=r,this._passParameters.opacity=n;const s=this._techniqueRepository.acquire(Xne,this._configuration);this._rctx.bindTechnique(s,e,this._passParameters),this._rctx.screen.draw(),s.release()}};const $Mt=1e4,HJ=100,IMt=500,LMt=500,DMt=.1;function NMt(t,e,r){return Mie(e,t)*(r[1]-r[0])+r[0]}function FMt(t,e,r){let i=0;if(!e.some(s=>!!s.materialReference&&(i+=s.numGeometries,i>=$Mt)))return HMt.compute(t,e);const n=mL();return r.forAll(s=>w3(n,kMt(t,s))),n}function kMt(t,e){if(!e.visible)return;const r=mL(),i=e.getSpatialQueryAccelerator();return i?zMt(r,t,i):UMt(r,t,e.objects),r}function zMt(t,e,r){const i=e.eye,n=e.viewForward,s=e.frustum,o=l=>l.visible,a=r.objectCount;if(a<IMt)aI(Dh,e.near,Math.min(t.near,e.far)),r.forEachInDepthRange(i,n,Bp.DepthOrder.FRONT_TO_BACK,Dh,(l,c)=>{WJ(t,e,l),Dh.far=t.near,c.setRange(Dh)},s,o),aI(Dh,Math.max(t.far,e.near),e.far),r.forEachInDepthRange(i,n,Bp.DepthOrder.BACK_TO_FRONT,Dh,(l,c)=>{WJ(t,e,l),Dh.near=t.far,c.setRange(Dh)},s,o);else{const l=Math.max(Math.min(a,LMt),Math.ceil(a*DMt)),c=r.findClosest(n,Bp.DepthOrder.FRONT_TO_BACK,s,o,l),u=r.findClosest(n,Bp.DepthOrder.BACK_TO_FRONT,s,o,l);c&&u&&(I0e(t,e,c.boundingVolumeWorldSpace.bounds),I0e(t,e,u.boundingVolumeWorldSpace.bounds))}}function UMt(t,e,r){QT.clear(),r.forAll(i=>{i.visible&&i.geometries.length!==0&&QT.add(i)}),QT.empty||(QT.sort(e),aI(Dh,e.near,Math.min(t.near,e.far)),QT.forEachInDepthRange(Dh,Bp.DepthOrder.FRONT_TO_BACK,(i,n)=>{n<t.near&&WJ(t,e,i)}),aI(Dh,Math.max(t.far,e.near),e.far),QT.forEachInDepthRange(Dh,Bp.DepthOrder.BACK_TO_FRONT,(i,n,s)=>{t.far=Math.max(t.far,s)}))}function WJ(t,e,r){if(!r.visible||!P1(e.frustum,r.boundingVolumeWorldSpace.bounds))return;const i=r.transformation,n=jMt;r.geometries.forEach(s=>{Hr(n,i,s.transformation);const o=qE(n);p5e(t,e,s.boundingInfo,n,o)})}function p5e(t,e,r,i,n){if(r==null)return;Ge(hl,r.center,i);const{eye:s,viewForward:o}=e,a=o[0]*(hl[0]-s[0])+o[1]*(hl[1]-s[1])+o[2]*(hl[2]-s[2]);if(hl[3]=r.radius*n,!(a-hl[3]>t.near&&a+hl[3]<t.far)&&P1(e.frustum,hl))if(r.radius>HJ&&r.getChildren())for(const l of r.getChildren())p5e(t,e,l,i,n);else qJ.unionDepthRangeWithAABB(t,e.viewProjectionMatrix,i,r.bbMin,r.bbMax)}function I0e(t,e,r){const i=e.eye,n=e.viewForward,s=(r[0]-i[0])*n[0]+(r[1]-i[1])*n[1]+(r[2]-i[2])*n[2];t.near=Math.min(t.near,s-r[3]),t.far=Math.max(t.far,s+r[3])}let BMt=class{constructor(){this._items=new Vt({allocator:e=>e||{object:null,distance:0,near:0,far:0},deallocator:e=>(e.object=null,e.distance=0,e.near=0,e.far=0,e)})}get length(){return this._items.length}get empty(){return this._items.length===0}clear(){this._items.clear()}add(e){this._items.pushNew().object=e}sort(e){const r=e.eye,i=e.viewForward;this._items.forAll(n=>{const s=n.object.boundingVolumeWorldSpace.bounds,o=(s[0]-r[0])*i[0]+(s[1]-r[1])*i[1]+(s[2]-r[2])*i[2];n.distance=o,n.near=o-s[3],n.far=o+s[3]}),this._items.sort((n,s)=>n.distance-s.distance)}forEachInDepthRange(e,r,i){if(r===Bp.DepthOrder.FRONT_TO_BACK)for(let n=0;n<this._items.length;++n){const s=this._items.data[n];s.far<e.near||s.near>e.far||i(s.object,s.near,s.far)}else for(let n=this._items.length-1;n>=0;--n){const s=this._items.data[n];s.far<e.near||s.near>e.far||i(s.object,s.near,s.far)}}},VMt=class{constructor(){this._view=xe(),this._viewProj=xe(),this._frustum=N$(),this._geometries=new Array,this._near=[],this._far=[],this._nearCandidates=[],this._farCandidates=[],this._looseRange={near:0,far:0}}compute(e,r){this._reset(),Zn(this._view,e.viewMatrix),Hr(this._viewProj,e.projectionMatrix,this._view),G6(this._frustum,e.frustum);const i=this._view,n=i[2],s=i[6],o=i[10],a=i[14];r.forAll(p=>{p.materialReference&&p.forEachGeometry&&p.forEachGeometry(f=>{if(!f.visible||!f.castShadow)return;const g=f.boundingSphere,_=n*g[0]+s*g[1]+o*g[2]+a,v=_-g[3],b=_+g[3];this._geometries.push(f),this._near.push(-b),this._far.push(-v)})});const l=new Hne;if(this._geometries.length===0)return l;for(let p=0;p<this._geometries.length;++p)this._near[p]>l.far&&(l.far=this._near[p]),this._near[p]>2&&this._far[p]<l.near&&(l.near=this._far[p]);const c=this._looseRange;c.near=Math.max(.5*l.near,2),c.far=2*l.far;let u=0,h=0;for(let p=0;p<this._geometries.length;++p)this._near[p]<l.near&&(this._near[p]>=c.near?l.near=this._near[p]:this._nearCandidates[u++]=p),this._far[p]>l.far&&(this._far[p]<=c.far?l.far=this._far[p]:this._farCandidates[h++]=p);if(this._nearCandidates.length===0&&this._farCandidates.length===0)return l;this._nearCandidates.sort((p,f)=>this._near[p]<this._near[f]?-1:this._near[p]>this._near[f]?1:0),this._farCandidates.sort((p,f)=>this._far[p]<this._far[f]?1:this._far[p]>this._far[f]?-1:0);for(let p=0;p<this._nearCandidates.length;++p){const f=this._nearCandidates[p];if(this._near[f]<l.near){const g=this._geometries[f],_=g.boundingInfo;this._includeNearBoundingInfoRec(_,g.shaderTransformation,l)}}for(let p=0;p<this._farCandidates.length;++p){const f=this._farCandidates[p];if(this._far[f]>l.far){const g=this._geometries[f],_=g.boundingInfo;this._includeFarBoundingInfoRec(_,g.shaderTransformation,l)}}return this._reset(),l}_reset(){this._geometries.length=0,this._near.length=0,this._far.length=0,this._nearCandidates.length=0,this._farCandidates.length=0}_includeNearBoundingInfoRec(e,r,i){if(e==null)return;const n=e.center;Ge(hl,n,r);const s=qE(r),o=hl[0],a=hl[1],l=hl[2],c=e.radius*s,u=this._frustum;if(u[0][0]*o+u[0][1]*a+u[0][2]*l+u[0][3]>c||u[1][0]*o+u[1][1]*a+u[1][2]*l+u[1][3]>c||u[2][0]*o+u[2][1]*a+u[2][2]*l+u[2][3]>c||u[3][0]*o+u[3][1]*a+u[3][2]*l+u[3][3]>c)return;const h=this._view[2]*o+this._view[6]*a+this._view[10]*l+this._view[14],p=h+c;if(!(-(h-c)<2||-p>=i.near))if(-p>this._looseRange.near)i.near=-p;else{if(c>HJ){const f=e.getChildren();if(f!==void 0){for(const g of f)this._includeNearBoundingInfoRec(g,r,i);return}}qJ.unionDepthRangeWithAABB(i,this._viewProj,r,e.bbMin,e.bbMax)}}_includeFarBoundingInfoRec(e,r,i){if(e==null)return;let n=e.radius;const s=e.center;Ge(hl,s,r);const o=qE(r),a=hl[0],l=hl[1],c=hl[2];n*=o;const u=this._frustum;if(u[0][0]*a+u[0][1]*l+u[0][2]*c+u[0][3]>n||u[1][0]*a+u[1][1]*l+u[1][2]*c+u[1][3]>n||u[2][0]*a+u[2][1]*l+u[2][2]*c+u[2][3]>n||u[3][0]*a+u[3][1]*l+u[3][2]*c+u[3][3]>n)return;const h=this._view[2]*a+this._view[6]*l+this._view[10]*c+this._view[14]-n;if(!(-h<=i.far))if(-h<this._looseRange.far)i.far=-h;else{if(n>HJ){const p=e.getChildren();if(p!==void 0){for(const f of p)this._includeFarBoundingInfoRec(f,r,i);return}}qJ.unionDepthRangeWithAABB(i,this._viewProj,r,e.bbMin,e.bbMax)}}},GMt=class{constructor(){this._modelViewProj=xe(),this._clipPosition=[Zt(),Zt(),Zt(),Zt(),Zt(),Zt(),Zt(),Zt()]}unionDepthRangeWithAABB(e,r,i,n,s){const o=this._modelViewProj;Hr(o,r,i);let a=!1;for(let l=0;l<8;++l){const c=this._clipPosition[l],u=l===0||l===3||l===4||l===7?n[0]:s[0],h=l===0||l===1||l===4||l===5?n[1]:s[1],p=l<4?n[2]:s[2];c[0]=o[0]*u+o[4]*h+o[8]*p+o[12],c[1]=o[1]*u+o[5]*h+o[9]*p+o[13],c[2]=o[2]*u+o[6]*h+o[10]*p+o[14],c[3]=o[3]*u+o[7]*h+o[11]*p+o[15]}for(let l=0;l<12;++l){const c=this._clipPosition[wj[l][0]],u=this._clipPosition[wj[l][1]],h=this._clipPosition[wj[l][2]],p=this._clipTriangle(c,u,h);let f=!0;for(let g=0;g<p.length;++g)if(p[g][3]>=2){f=!1;break}if(!f){a=!0;for(let g=0;g<p.length;++g){const _=p[g][3];Number.isFinite(_)&&(e.near=Math.min(_,e.near),e.far=Math.max(_,e.far))}}}return a}_inside(e,r){return r===0?e[0]>=-e[3]:r===1?e[1]>=-e[3]:r===2?e[0]<=e[3]:r===3?e[1]<=e[3]:void pt(!1)}_intersect(e,r,i){let n=0;return i===0?n=(-e[3]-e[0])/(r[0]-e[0]+r[3]-e[3]):i===1?n=(-e[3]-e[1])/(r[1]-e[1]+r[3]-e[3]):i===2?n=(e[3]-e[0])/(r[0]-e[0]-r[3]+e[3]):i===3&&(n=(e[3]-e[1])/(r[1]-e[1]-r[3]+e[3])),Yee(Zt(),e,r,n)}_clipTriangle(e,r,i){let n=[e,r,i];for(let s=0;s<4;++s){const o=n;n=[];for(let a=0;a<o.length;++a){const l=o[a],c=o[(a+1)%o.length];this._inside(c,s)?(this._inside(l,s)||n.push(this._intersect(l,c,s)),n.push(c)):this._inside(l,s)&&n.push(this._intersect(l,c,s))}}return n}};const wj=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],hl=Jn(),jMt=xe(),Dh=mL(),QT=new BMt,HMt=new VMt,qJ=new GMt;let WMt=class{},qMt=class extends Ai{constructor(){super(...arguments),this.textures=new WMt}};function YMt(){const t=new Or;return t.attributes.add(R.POSITION,"vec2"),t.vertex.uniforms.add(new xr("drawPosition",(e,r)=>XMt(e,r))),t.varyings.add("vUV","vec2"),t.vertex.code.add(T`void main(void) {
vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);
}`),t.fragment.uniforms.add(new ct("textureInput",e=>e.textures.input)),t.fragment.uniforms.add(new ct("textureMask",e=>e.textures.mask)),t.fragment.uniforms.add(new ct("textureOverlay",e=>e.textures.overlay)),t.fragment.uniforms.add(new Ym("maskEnabled",e=>e.magnifier.maskEnabled)),t.fragment.uniforms.add(new Ym("overlayEnabled",e=>e.magnifier.overlayEnabled)),t.fragment.code.add(T`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}
void main() {
float mask = maskEnabled ? texture(textureMask, vUV).a : 1.0;
vec4 inputColor = texture(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture(textureOverlay, vUV) : vec4(0);
fragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;
}`),t}function XMt(t,e){const r=e.camera.pixelRatio,i=t.magnifier.offset.x*r,n=t.magnifier.offset.y*r;Rp(t.magnifier.position,L0e);const s=e.camera.screenToRender(L0e,ZMt),o=Math.ceil(r*t.magnifier.size),a=e.camera.fullWidth,l=e.camera.fullHeight;return nn(JMt,(s[0]+i)/a*2-1,(s[1]-n)/l*2-1,o/a*2,o/l*2)}const L0e=pn(),ZMt=Axe(),JMt=Zt();async function QMt(t){const e=ge(()=>import("./mask-svg-cNit2NTT.js"),__vite__mapDeps([])),r=ge(()=>import("./overlay-svg-DioSRl-7.js"),__vite__mapDeps([])),i=cy((await e).default,{signal:t}),n=cy((await r).default,{signal:t}),s={mask:await i,overlay:await n};return vt(t),s}let LS=class extends Ae{constructor(){super(...arguments),this._magnifier=null,this._imageSources=null,this._imageLoadTask=null,this._resources=null,this._passParameters=new qMt,this.events=new Qn,this.attributeLocations=new Map([[R.POSITION,0]]),this._tmpScreenPoint=pn(),this._tmpRenderPoint=Axe()}get updating(){return this._imageSources==null&&this._imageLoadTask!=null&&!this._imageLoadTask.task.finished}get magnifier(){return this._magnifier}set magnifier(e){if(e===this._magnifier)return;this.removeAllHandles(),this._magnifier=e;const r=()=>{this._updateResourceLoading(),this.events.emit("request-render")};this._magnifier!=null&&this.addHandles(he(()=>{var i;return(i=this._magnifier)==null?void 0:i.version},r)),r()}get enabled(){return this._validMagnifier!=null}get _validMagnifier(){return this._magnifier!=null&&this._magnifier.visible&&this._magnifier.position!=null&&this._magnifier.size>0?this._magnifier:null}get _factor(){return this._magnifier!=null&&this._magnifier.factor||1}destroy(){this._magnifier=null,this._imageLoadTask!=null&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null),this._disposeResources()}render(e,r){const i=this._validMagnifier;if(i==null)return;const n=r.camera.pixelRatio,s=Math.ceil(n*i.size);if(this._updateResources(e,s),this._resources==null)return;const o=this._passParameters.textures,a=Math.ceil(1/this._factor*s);o.input.resize(a,a),Rp(i.position,this._tmpScreenPoint);const l=r.camera.screenToRender(this._tmpScreenPoint,this._tmpRenderPoint),c=r.camera.fullWidth,u=r.camera.fullHeight,h=.5*a,p=.5*a;l[0]=we(l[0],h,c-h-1),l[1]=we(l[1],p,u-p-1);const f=Math.floor(l[0]-h),g=Math.floor(l[1]-p),_=this._resources.program;_.bindTexture("textureInput",o.input),e.gl.copyTexImage2D(o.input.descriptor.target,0,o.input.descriptor.pixelFormat,f,g,a,a,0),this._passParameters.magnifier=i,e.useProgram(_),_.bindPass(this._passParameters,r),e.bindVAO(this._resources.vao),e.setPipelineState(this._resources.pipelineState),e.drawArrays(sr.TRIANGLE_STRIP,0,4)}_updateResourceLoading(){const e=this._validMagnifier;if(e==null)return;const r=e.maskUrl,i=e.overlayUrl;this._imageLoadTask==null||this._imageLoadTask.maskUrl===r&&this._imageLoadTask.overlayUrl===i||(this._imageLoadTask.task.abort(),this._imageLoadTask=null,this._imageSources=null),this._imageSources==null&&this._imageLoadTask==null&&(this._imageLoadTask={maskUrl:r,overlayUrl:i,task:dy(async n=>{const s=r==null||i==null?QMt(n):null,o=r!=null?cy(r,{signal:n}):s.then(l=>l.mask),a=i!=null?cy(i,{signal:n}):s.then(l=>l.overlay);this._imageSources={mask:await o,overlay:await a},this._disposeResources(),this.events.emit("request-render")})},this._imageLoadTask.task.promise.then(()=>this.notifyChange("updating"),()=>this.notifyChange("updating")))}_updateResources(e,r){if(!this.enabled)return void this._disposeResources();if(this._resources!=null){if(this._passParameters.textures.size!==r){const n=this._createTextureResources(e,r);if(n==null)return void this._disposeResources();this._disposeTextureResources(this._passParameters.textures),this._passParameters.textures=n}return}const i=this._createTextureResources(e,r);i!=null&&(this._resources={program:this._createProgram(e),vao:wg(e,Xte,this.attributeLocations,0,1),pipelineState:kt({blending:tu(Se.ONE,Se.ONE_MINUS_SRC_ALPHA),depthTest:null,depthWrite:null,colorWrite:Yt})},this._passParameters.textures=i)}_disposeResources(){this._resources!=null&&(this._disposeTextureResources(this._passParameters.textures),this._resources.program.dispose(),this._resources.vao.dispose(),this._resources=null)}_disposeTextureResources(e){e.mask.dispose(),e.overlay.dispose(),e.input.dispose()}_createTextureResources(e,r){if(this._imageSources==null)return null;this._imageSources.overlay.width=r,this._imageSources.overlay.height=r,this._imageSources.mask.width=r,this._imageSources.mask.height=r;const i=new ri;i.internalFormat=Tt.RGBA,i.wrapMode=Jt.CLAMP_TO_EDGE,i.flipped=!0,i.preMultiplyAlpha=!xwe(this._imageSources.overlay.src)||!e.driverTest.svgPremultipliesAlpha.result;const n=new Sr(e,i,this._imageSources.overlay);i.pixelFormat=i.internalFormat=Tt.ALPHA,i.preMultiplyAlpha=!1;const s=new Sr(e,i,this._imageSources.mask);return i.pixelFormat=i.internalFormat=Tt.RGBA,i.flipped=!1,{input:new Sr(e,i),mask:s,overlay:n,size:r}}_createProgram(e){return new Lr(e,YMt(),this.attributeLocations)}};d([m()],LS.prototype,"_imageSources",void 0),d([m()],LS.prototype,"_imageLoadTask",void 0),d([m({readOnly:!0})],LS.prototype,"updating",null),LS=d([V("esri/views/3d/webgl-engine/lib/MagnifierHelper")],LS);let KMt=class{constructor(){this.declaredClass="esri.views.3d.webgl-engine.lib.ObjectAndLayerIdRenderHelper",this.colorZero=new za(new ArrayBuffer(4)),this._layerToOidToColor=new xv,this._colorToUID=new Map,this._layerUidToGraphicsUidToObjectId=new xv,this._layerUidToId=new Map,this._layerUidToPopupEnabled=new Map}setUidToObjectAndLayerId(e,r,i,n,s,o=null,a=null,l=null){e&&r&&i&&n&&(this._layerUidToId.set(n,i),this._layerUidToPopupEnabled.set(n,s),s&&this._layerUidToGraphicsUidToObjectId.set(n,r,{objectId:e,attributeNodeId:o,attributeIndex:a,subLayerId:l}))}getObjectAndLayerIdColor(e){const r=this.getObjectAndLayerIdColorArray(e);return Bt(r.get(0,1),r.get(0,2),r.get(0,3),255)}getObjectAndLayerIdColorArray(e){var o;if(!e.layerUid||!e.graphicUid)return this.colorZero;const r=this._layerUidToPopupEnabled.get(e.layerUid);if(r===void 0)return re.getLogger(this).warn("popupEnabled is undefined for layerUid "+e.layerUid),this.colorZero;if(r===!1)return this.colorZero;const i=(o=this._layerUidToGraphicsUidToObjectId.get(e.layerUid,e.graphicUid))==null?void 0:o.objectId;if(!i)return this.colorZero;let n=this._layerToOidToColor.get(e.layerUid,i);if(!n){for(;!n;){const a=Math.floor(16777214*Math.random())+1;this._colorToUID.has(a)||(n=a)}if(n>16777215)throw new Error("Object ID Overflow");this._layerToOidToColor.set(e.layerUid,i,n),this._colorToUID.set(n,e)}const s=new ArrayBuffer(4);return new DataView(s).setUint32(0,n,!1),new za(s)}getColorToObjectAndLayerIdMapping(){const e=new Map;for(const[r,i]of this._colorToUID.entries()){const n=this._layerUidToGraphicsUidToObjectId.get(i.layerUid,i.graphicUid);n||re.getLogger(this).warn("getColorMapping: no entry found for graphicsId "+i.graphicUid);const s=this._layerUidToId.get(i.layerUid);s||re.getLogger(this).warn("no layerId found for uid "+i.layerUid),n&&s&&e.set(r,n.attributeNodeId?{type:"object-and-layer-and-i3s-id",oid:n.objectId,lid:s,attrId:n.attributeNodeId,attrIdx:n.attributeIndex,subLayerId:n.subLayerId}:{type:"object-and-layer-id",oid:n.objectId,lid:s})}return e}},f5e=class{constructor(e,r){this.key=e,this.free=r,this.incarnation=0,this._refCount=1}retain(){++this._refCount}release(){return this._refCount===0?(console.log(`Releasing already released FBO attachment in ${new Error().stack}`),!0):(--this._refCount,this._refCount===0&&(this.free(),!0))}};var x3;(function(t){t[t.FBO=0]="FBO",t[t.DEPTH=1]="DEPTH",t[t.COLOR=2]="COLOR"})(x3||(x3={}));let m5e=class extends f5e{constructor(e,r,i){super(e,i),this.attachment=r,this.name=""}dispose(){this.attachment.dispose()}get usedMemory(){return this.attachment.usedMemory}},eOt=class extends m5e{constructor(e,r,i){super(e,r,i),this.attachment=r,this.type=x3.COLOR}},D0e=class extends m5e{constructor(){super(...arguments),this.type=x3.DEPTH}},tOt=class extends f5e{constructor(e,r,i,n,s,o){super(e,o),this.type=x3.FBO,this._colors=new Map,this._name="composite-color",this.acquireDepth=null,this.acquireColor=null,this._name=r,this.fbo=i,this.acquireDepth=n,this.acquireColor=s}dispose(){this.fbo.dispose()}get usedMemory(){return this.fbo.usedMemory}get name(){return this._name}setName(e){this._name=e}getTexture(e=cl.COLOR_ATTACHMENT0){var r,i;return e===n3?(r=this.fbo)==null?void 0:r.depthStencilTexture:(i=this.fbo)==null?void 0:i.getColorTexture(e)}getAttachment(e=cl.COLOR_ATTACHMENT0){return e===n3?this._depth:this._colors.get(e)}attachDepth(e){return e==null||e.retain(),this.detachDepth(),e&&this.fbo.attachDepthStencil(e.attachment),this._depth=e,this}detachDepth(){this.fbo.detachDepthStencilTexture(),this.fbo.detachDepthStencilBuffer(),this._depth=tr(this._depth)}attachColor(e,r){return e.retain(),this.detachColor(r),this.fbo.attachColorTexture(e.attachment,r),this._colors.set(r,e),this}detachColor(e){this.fbo.detachColorTexture(e);const r=this._colors.get(e);this._colors.delete(e),r==null||r.release()}detachAll(){this._colors.forEach((e,r)=>this.detachColor(r)),this.detachDepth()}},xj=class{constructor(e,r){this._last=new Vt,this._incarnation=0,this._cache=new cL(e,r)}destroy(){var e;(e=this._last)==null||e.forAll(r=>r.dispose()),this._last=null,this._cache.destroy()}set interactive(e){var r;e&&!this._last?this._last=new Vt:e||((r=this._last)==null||r.forAll(i=>i.dispose()),this._last=null)}clean(){var e;(e=this._last)==null||e.filterInPlace(r=>!(r.incarnation<this._incarnation)||(this._cache.put(r.key,r),!1))}frame(){++this._incarnation}pop(e){if(this._last){const r=this._last.find(i=>i.key===e);if(r)return this._last.removeUnordered(r),r}return this._cache.pop(e)}put(e){e.incarnation=this._incarnation,this._last?this._last.push(e):this._cache.put(e.key,e)}get usedMemory(){var e;return((e=this._last)==null?void 0:e.reduce((r,i)=>r+i.usedMemory,0))??0}},rOt=class{constructor(e){this.rctx=e,this._acquired=new Set,this._cache=new xj(e.newCache,"FBOCache"),this._depthCache=new xj(e.newCache,"DepthAttachmentCache"),this._colorCache=new xj(e.newCache,"ColorAttachmentCache")}destroy(){this._cache.destroy(),this._depthCache.destroy(),this._colorCache.destroy()}clean(){this._cache.clean(),this._colorCache.clean(),this._depthCache.clean()}frameStart(){this._cache.frame(),this._colorCache.frame(),this._depthCache.frame(),this.debugCallback&&this.debugCallback()}frameEnd(){const e=this.debugCallback;e&&this._acquired.forEach(r=>r.type===x3.FBO&&e(r.name,r.fbo))}get usedMemory(){return Array.from(this._acquired.values()).reduce((e,r)=>{var i;return e+("getTexture"in r?((i=r.getTexture())==null?void 0:i.usedMemory)??0:r.usedMemory)},this._cache.usedMemory+this._colorCache.usedMemory+this._depthCache.usedMemory)}set interactive(e){this._cache.interactive=this._colorCache.interactive=this._depthCache.interactive=e}acquire(e,r,i,n=qi.RGBA){const s=Tj(n,e,r);let o=this._cache.pop(s);return o?(o.retain(),o.setName(i)):o=new tOt(s,i,new bf(this.rctx,{...N0e[n],width:e,height:r}),a=>{a??(a=ra.DEPTH_STENCIL_TEXTURE);const l=this._acquireDepth(a,o.fbo.width,o.fbo.height,`${o.name} depth`);return o.attachDepth(l),l.release(),o},(a,l)=>{l??(l=qi.RGBA);const c=this._acquireColor(l,e,r,`${o.name} color ${a}`);return o.attachColor(c,a),c.release(),o},()=>{this.debugCallback&&this.debugCallback(o.name,o.fbo),this._acquired.delete(o),o.detachAll(),this._cache.put(o)}),this._trackHandle(o)}acquireDepth(e,r,i,n){return this._acquireDepth(e,r,i,n)}_acquireDepth(e,r,i,n){const s=Tj(e,r,i),o=this._depthCache.pop(s);if(o)return o.retain(),o.name=n,this._trackHandle(o);const a=e===ra.DEPTH_STENCIL_TEXTURE?new D0e(s,new Sr(this.rctx,{...F0e[e],width:r,height:i}),()=>{this._acquired.delete(a),this._depthCache.put(a)}):new D0e(s,new hAe(this.rctx,{...F0e[e],width:r,height:i}),()=>{this._acquired.delete(a),this._depthCache.put(a)});return a.name=n,this._trackHandle(a)}_acquireColor(e,r,i,n){const s=Tj(e,r,i),o=this._colorCache.pop(s);if(o)return o.retain(),o.name=n,this._trackHandle(o);const a=new eOt(s,new Sr(this.rctx,{...N0e[e],width:r,height:i}),()=>{this._acquired.delete(a),this._colorCache.put(a)});return a.name=n,this._trackHandle(a)}_trackHandle(e){return this._acquired.add(e),e}};function Tj(t,e,r){return`${t}x${e}x${r}`}const UF=new ri;UF.pixelFormat=Tt.RED,UF.internalFormat=tt.R8,UF.wrapMode=Jt.CLAMP_TO_EDGE;const BF=new ri;BF.pixelFormat=Tt.RG,BF.internalFormat=tt.RG8,BF.wrapMode=Jt.CLAMP_TO_EDGE;const VF=new ri;VF.internalFormat=tt.RGBA4,VF.dataType=ks.UNSIGNED_SHORT_4_4_4_4,VF.wrapMode=Jt.CLAMP_TO_EDGE;const g5e=new ri;g5e.wrapMode=Jt.CLAMP_TO_EDGE;const vO=new ri;vO.wrapMode=Jt.CLAMP_TO_EDGE,vO.samplingMode=Ht.LINEAR_MIPMAP_LINEAR,vO.hasMipmap=!0,vO.maxAnisotropy=8;const bO=new ri;bO.pixelFormat=Tt.RED,bO.dataType=ks.HALF_FLOAT,bO.internalFormat=tt.R16F,bO.samplingMode=Ht.NEAREST;const GF=new ri;GF.dataType=ks.HALF_FLOAT,GF.internalFormat=tt.RGBA16F,GF.samplingMode=Ht.NEAREST;const N0e={[qi.RED]:UF,[qi.RG]:BF,[qi.RGBA4]:VF,[qi.RGBA]:g5e,[qi.RGBA_MIPMAP]:vO,[qi.R16F]:bO,[qi.RGBA16F]:GF},wO=new ri;wO.pixelFormat=Tt.DEPTH_STENCIL,wO.dataType=ks.UNSIGNED_INT_24_8,wO.samplingMode=Ht.NEAREST,wO.wrapMode=Jt.CLAMP_TO_EDGE;const F0e={[ra.DEPTH_STENCIL_TEXTURE]:wO,[ra.DEPTH16_BUFFER]:new uAe(ia.DEPTH_COMPONENT16,4)};var lI;(function(t){t[t.FrontToBack=0]="FrontToBack",t[t.BackToFront=1]="BackToFront"})(lI||(lI={}));let f_=class{constructor(e,r,i=lI.FrontToBack){this._rctx=e,this._techniqueRepository=r,this._sorting=i,this._draws=new Vt({initialSize:32,allocator:n=>n||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}),this._previouslyBoundDraw=new Map}submitDraw(e,r,i,n){const s=this._draws.pushNew();s.geometry=r,s.geometryRanges=i,s.material=e,s.depthSquaredHint=n,s.indexType=(r.indexed?r.vao.indexBuffer.indexType:null)??0}prepare(e,r){return this._draws.map(i=>i.material.prepareTechnique(this._techniqueRepository,e,r,i.geometry.parameters))}dispatch(e,r,i){const n=this._rctx;this._previouslyBoundDraw.clear();let s=null;const o=this._draws.length;for(let a=0;a<o;a++){const l=i[a];l===s&&l.configuration.transparencyPassType===ft.NONE||(n.bindTechnique(l,r,e),s=l);const c=this._draws.data[a],u=c.geometry;n.bindVAO(u.vao),this._previouslyBoundDraw.get(l)!==c.material&&(l.program.bindDraw(c.material,r,e),this._previouslyBoundDraw.set(l,c.material));const h=c.geometryRanges,p=h.length;if(c.indexType!==0){const f=jF.get(c.indexType);for(let g=0;g<p;g+=2){const _=h[g],v=h[g+1];n.drawElements(u.primitiveType,v,c.indexType,_*f)}}else for(let f=0;f<p;f+=2){const g=h[f],_=h[f+1];n.drawArrays(u.primitiveType,g,_)}}}prepareSubmit(){this._draws.clear()}finishSubmit(){const e=this._sorting===lI.FrontToBack?1:-1;this._draws.sort((r,i)=>{const n=e*(r.depthSquaredHint-i.depthSquaredHint);return n!==0?n:r.geometry.vao.byteSize-i.geometry.vao.byteSize})}get count(){return this._draws.length}};const jF=new Map;jF.set(qe.UNSIGNED_BYTE,1),jF.set(qe.UNSIGNED_SHORT,2),jF.set(qe.UNSIGNED_INT,4);let YJ=class extends lot{constructor(){super({}),this._passes=null,this.produces=new Map([[ue.OPAQUE_MATERIAL,e=>this._produces(e)],[ue.TRANSPARENT_MATERIAL,e=>!!(this._passes&&this._passes.materialTransparent.count>0)&&this._produces(e)],[ue.INTEGRATED_MESH,e=>this._produces(e)]]),this._materialPassParameters=new Dft,this._shadowPassParameters=new Nft,this._highlightPassParameters=new Fft,this._systems=new Set}initializeRenderContext(e){this._context=e;const r=e.renderContext.rctx,i=e.techniqueRepository;this._passes={materialOpaque:new f_(r,i),materialTransparent:new f_(r,i,lI.BackToFront),materialIntegratedMesh:new f_(r,i),shadowMap:new f_(r,i),highlight:new f_(r,i),highlightIntegratedMesh:new f_(r,i),highlightShadowMap:new f_(r,i),defaultShadowMap:new f_(r,i)}}get rctx(){return this._context.renderContext.rctx}uninitializeRenderContext(){}dispose(){this._context=null,this._systems.clear()}register(e){this._systems.add(e)}_produces(e){return this._systems.size!==0&&this._passes!==null&&(e===U.Highlight?this._passes.highlight.count>0||this._passes.highlightIntegratedMesh.count>0:e!==U.ShadowHighlight||this._passes.highlight.count>0)}prepareRender(e){if(this._systems.size!==0&&this._passes!==null){for(const r of Object.values(this._passes))r.prepareSubmit();this._systems.forEach(r=>r.submit(this._passes,e.bindParameters));for(const r of Object.values(this._passes))r.finishSubmit();this._context.techniqueRepository.frameUpdate()}}prepareTechniques(e){if(this._systems.size===0)return null;const r=e.output===U.Shadow||e.output===U.ShadowHighlight||e.output===U.ShadowExcludeHighlight?this._shadowPassParameters:e.output===U.Highlight?this._highlightPassParameters:this._materialPassParameters,i=e.bindParameters;return this._updateParameters(i.camera,r,i.slot===ue.TRANSPARENT_MATERIAL),this._materialPassParameters.output=e.output,this._invoke(e,(n,s)=>n.prepare(s,e.bindParameters))}renderNode(e,r){this._invoke(e,(i,n)=>i.dispatch(n,e.bindParameters,r))}_invoke(e,r){if(this._passes===null)return null;switch(e.bindParameters.slot){case ue.OPAQUE_MATERIAL:switch(e.output){case U.Color:case U.LinearDepth:case U.Normal:case U.ObjectAndLayerIdColor:return r(this._passes.materialOpaque,this._materialPassParameters);case U.Highlight:return r(this._passes.highlight,this._highlightPassParameters);case U.Shadow:return r(this._passes.shadowMap,this._shadowPassParameters);case U.ShadowHighlight:return r(this._passes.highlightShadowMap,this._shadowPassParameters);case U.ShadowExcludeHighlight:return r(this._passes.defaultShadowMap,this._shadowPassParameters)}break;case ue.TRANSPARENT_MATERIAL:switch(e.output){case U.Color:case U.Alpha:case U.LinearDepth:case U.Normal:case U.ObjectAndLayerIdColor:return r(this._passes.materialTransparent,this._materialPassParameters)}break;case ue.INTEGRATED_MESH:switch(e.output){case U.Color:case U.LinearDepth:case U.Normal:case U.ObjectAndLayerIdColor:return r(this._passes.materialIntegratedMesh,this._materialPassParameters);case U.Highlight:return r(this._passes.highlightIntegratedMesh,this._highlightPassParameters)}}return null}notifyDirty(){this._context.requestRender()}queryDepthRange(e){const r=new Hne;return this._systems.forEach(i=>w3(r,i.queryShadowCasterDepthRange(e))),r}_updateParameters(e,r,i){const n=e.viewInverseTransposeMatrix;ie(Sj,n[3],n[7],n[11]),Cj.set(Sj),ce(r.transformWorldFromViewTH,Cj.high),ce(r.transformWorldFromViewTL,Cj.low),ce(r.slicePlaneLocalOrigin,Sj),th(r.transformViewFromCameraRelativeRS,e.viewMatrix),Zn(r.transformProjFromView,e.projectionMatrix),r.identifier===Bc.Material&&(this._materialPassParameters.transparent=i,gd(k0e,r.transformViewFromCameraRelativeRS),L2(r.transformNormalViewFromGlobal,k0e))}};YJ=d([V("esri.views.3d.webgl-engine.core.renderPasses.RenderPassManager")],YJ);const Sj=C(),k0e=li(),Cj=new sB;let iOt=class{constructor(e){this._context=e,this._nodes=new Vt}destroy(){this._nodes.forEach(e=>e.destroy()),this._nodes.clear()}add(e){this._nodes.push(e),U6&&console.log(`Registered render nodes: ${this._nodes.map(({declaredClass:r})=>r).join(", ")}`)}remove(e){this._nodes.remove(e),U6&&console.log(`Registered render nodes: ${this._nodes.map(({declaredClass:r})=>r).join(", ")}`)}produces(e){return this._nodes.some(({produces:r})=>r===e)}require(e,r){return this._nodes.reduce((i,{consumes:n,produces:s})=>i+(n.required.includes(e)&&s===r?1:0),0)}optional(e,r){return this._nodes.reduce((i,{consumes:n,produces:s})=>{var o;return i+((o=n.optional)!=null&&o.includes(e)&&s===r?1:0)},0)}updateAnimation(){return this._nodes.reduce((e,r)=>r.updateAnimation()||e,!1)}render(e,r,i){const n=e.name,s=this._nodes.filter(({produces:o})=>o===n);return s.length===0||(s.forEach(o=>{const a=[e];for(const l of o.consumes.required){if(l===n)continue;const c=r.get(l);if(!c)return void i(a);a.push(c)}if(o.consumes.optional)for(const l of o.consumes.optional){if(l===n)continue;const c=r.get(l);c&&a.push(c)}try{const l=o.doRender(a,this._context);l&&l!==e&&(e.release(),e=l,r.set(n,e))}catch(l){re.getLogger(o).errorOnce(l)}i(a)}),this._context.rctx.enforceState()),e}},nOt=class{constructor(e){this._context=e,this._renderPlugins=new Vt,this._slots=new Array,this._renderVersion=Wm(0);for(let r=0;r<ue.MAX_SLOTS;++r)this._slots[r]=[]}destroy(){this._renderPlugins.forEach(e=>e.destroy()),this._renderPlugins.clear()}get plugins(){return this._renderPlugins}add(e,r){const i=()=>{if(r!=null&&r.aborted)throw e.uninitializeRenderContext(),dr();this._renderPlugins.push(e),e.produces.forEach((s,o)=>{this._slots[o].push(e)}),this._context.requestRender(),this._renderVersion.value++},n=e.initializeRenderContext(this._context,r);if(nu(n))return n.then(i);i()}remove(e){if(this._renderPlugins.removeUnordered(e)!=null){for(let r=0;r<this._slots.length;++r)this._slots[r]=this._slots[r].filter(i=>i!==e);e.uninitializeRenderContext(),this._context.requestRender(),this._renderVersion.value++}}prepareRender(){this._renderPlugins.forAll(e=>{e.prepareRender&&e.prepareRender(this._context.renderContext)})}updateAnimation(e){let r=!1;return this._renderPlugins.forAll(i=>{i.updateAnimation&&(r=i.updateAnimation(e)||r)}),r}renderFeatureChanged(){this._renderPlugins.forAll(e=>{e.renderFeatureChanged&&e.renderFeatureChanged()})}prepare(e){this._context.renderContext.bindParameters.slot=e,this._slots[e].forEach(r=>{const i=r.produces.get(e);i&&i(U.Color)&&(uZ(r)&&r.prepareTechnique(this._context.renderContext),hhe(r)&&r.prepareTechniques(this._context.renderContext))})}_getRenderables(e){this._context.renderContext.bindParameters.slot=e;const r=this._context.renderContext.output??U.Color,i=new Map;return this._slots[e].forEach(n=>{const s=n.produces.get(e);if(s&&s(r)&&(!n.isDecoration||this._context.renderContext.bindParameters.decorations!==Xl.OFF))if(uZ(n)){const o=n.prepareTechnique(this._context.renderContext);o!=null&&i.set(n,o)}else if(hhe(n)){const o=n.prepareTechniques(this._context.renderContext);o!=null&&i.set(n,o)}else i.set(n,null)}),i}render(e,r=null,i=null){return this._getRenderables(e).forEach((n,s)=>i=s.renderNode(this._context.renderContext,n,r,i)),i}queryDepthRange(e){const r=new Hne;return this._renderPlugins.forAll(i=>{var s;const n=(s=i.queryDepthRange)==null?void 0:s.call(i,e);w3(r,n)}),r}get updating(){return this._renderVersion.value>=0&&this._renderPlugins.some(e=>e.running)}produces(e,r=U.Color){return this._slots[e].some(i=>{const n=i.produces.get(e);return!!n&&n(r)})}consumes(e){return this._renderPlugins.some(r=>r.consumes().required.includes(e))}getMaterialRenderer(e){return this._renderPlugins.find(r=>r.materialReference===e)}removeEmptyMaterialRenderers(){this._renderPlugins.filterInPlace(e=>!e.materialReference||e.numGeometries!==0||(e.destroy(),!1))}get hasDecorations(){return this._renderPlugins.some(e=>e.isDecoration)}get hasOccludees(){return this._renderPlugins.some(e=>e.hasOccludees)}get renderOccludedFlags(){return this._renderPlugins.reduce((e,r)=>e|r.renderOccludedFlags,kr.None)}get usedMemory(){return this._renderPlugins.reduce((e,r)=>r.materialReference!==null?e:e+(r.usedMemory??0),0)}get test(){return{plugins:this._renderPlugins}}},DS=class extends V2{constructor(e){super(e),this._context=null,this.opacity=1,this.alphaMode=Aa.None,this._blitConfiguration=new ez,this._blitParameters=new oB,this.produces=new Map([[ue.BLIT,()=>this._context!=null]])}consumes(){return pMe}initializeRenderContext(e){this._context=e}uninitializeRenderContext(){this._context=null}destroy(){}renderNode(e,r,i,n){var a;const s=(a=i==null?void 0:i.get("composite-color"))==null?void 0:a.getTexture();if(!this._context||!s)return n;const o=this._context.techniqueRepository.acquire(Xne,this._blitConfiguration);return o!=null&&o.compiled?(e.rctx.bindFramebuffer(n==null?void 0:n.fbo),this._blitParameters.texture=s,this._blitParameters.opacity=this.opacity,e.rctx.bindTechnique(o,e.bindParameters,this._blitParameters),e.rctx.screen.draw(),o.release(),n):(this._context.requestRender(),n)}};d([m()],DS.prototype,"_context",void 0),d([m()],DS.prototype,"opacity",void 0),d([m()],DS.prototype,"alphaMode",void 0),DS=d([V("esri.views.3d.webgl-engine.effects.blit.Blit")],DS);let Qne=class extends Ai{};function y5e(){const t=new Or,{outputs:e,fragment:r}=t;return t.include(Ga),r.uniforms.add(new id("textureInput",i=>i.input)),r.constants.add("sampleArea","int",Math.ceil(cI/2)),e.add("fragGrid","vec2"),r.code.add(T`
    void main() {
      float red = 0.0;
      float green = 1.0;
      int cellSize = ${T.int(mp)};
      vec2 texelSize = 1.0 / vec2(textureSize(textureInput, 0));
      vec2 offset = floor(gl_FragCoord.xy) * vec2(float(cellSize));

      for(int x = -sampleArea; x < cellSize + sampleArea; x += 2) {
        for(int y = -sampleArea; y < cellSize + sampleArea; y += 2) {
          vec2 coord = (offset + vec2(float(x), float(y))) * texelSize;
          vec4 value = texture(textureInput, coord);
          float mx = floor(max(value.g, value.b));

          red = max(red, ceil(value.r));
          green = min(green, mx);
          if(red == 1.0 && green == 0.0) {
            fragGrid = vec2(red, green);
            return;
          }
        }
      }
      fragGrid = vec2(red, green);
    }`),t}const mp=32,cI=9,Kne=.4,sOt=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:Qne,blurSize:Kne,build:y5e,gridCellPixelSize:mp,outlineSize:cI},Symbol.toStringTag,{value:"Module"}));function _5e(){const t=new Or,{vertex:e,fragment:r}=t,i=e.code,n=r.code;return t.attributes.add(R.POSITION,"vec2"),t.varyings.add("uv","vec2"),t.attributes.add(R.UV0,"vec2"),e.uniforms.add(new ct("coverageTex",s=>s.coverageTexture),new ti("coverageRounding",s=>s.coverageRounding)),i.add(T`void main() {
vec4 cov = texture(coverageTex, uv0 * coverageRounding);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
return;
}
gl_Position = vec4(position, 0.0, 1.0);
uv = position.xy * 0.5 + vec2(0.5);
}`),r.uniforms.add(new ct("tex",s=>s.blurTexture),new ct("highlightTexture",s=>s.highlightTexture),new xr("uColor",s=>s.color),new xr("haloColor",s=>s.haloColor),new xr("opacities",s=>nn(oOt,s.haloOpacity,s.haloOpacityOccluded,s.fillOpacity,s.fillOpacityOccluded))),r.constants.add("inner","float",1-(cI-Kne)/cI),n.add(T`void main() {
vec4 blurredHighlightValue = texture(tex, uv);
float highlightIntensity = blurredHighlightValue.a;
if (highlightIntensity == 0.0) {
discard;
}
vec4 origin_color = texture(highlightTexture, uv);
float outlineIntensity;
float fillIntensity;
if (blurredHighlightValue.g > blurredHighlightValue.b) {
outlineIntensity = haloColor.w * opacities[1];
fillIntensity = uColor.w * opacities[3];
}
else {
outlineIntensity = haloColor.w * opacities[0];
fillIntensity = uColor.w * opacities[2];
}
float outlineFactor = smoothstep(0.0, inner, highlightIntensity);
float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;
float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;
fragColor = vec4(mix(haloColor.rgb, uColor.rgb, fillFactor), intensity);
}`),t}const oOt=Zt(),aOt=Object.freeze(Object.defineProperty({__proto__:null,build:_5e},Symbol.toStringTag,{value:"Module"}));let v5e=class b5e extends Vr{initializeProgram(e){return new Lr(e.rctx,b5e.shader.get().build(),Mr)}initializePipeline(){return kt({blending:Wo(Se.SRC_ALPHA,Se.ONE,Se.ONE_MINUS_SRC_ALPHA,Se.ONE_MINUS_SRC_ALPHA),colorWrite:Yt})}};v5e.shader=new Ir(aOt,()=>ge(()=>Promise.resolve().then(()=>u4t),void 0));let ese=class extends Ai{constructor(){super(...arguments),this.blurSize=He()}};function w5e(){const t=new Or,{attributes:e,varyings:r,vertex:i,fragment:n}=t;return e.add(R.POSITION,"vec2"),e.add(R.UV0,"vec2"),r.add("blurCoordinate","vec3"),i.uniforms.add(new ct("coverageTex",s=>s.coverageTexture),new ti("coverageRounding",s=>s.coverageRounding)),i.code.add(T`void main() {
gl_Position = vec4(position, 0.0, 1.0);
vec4 cov = texture(coverageTex, uv0 * coverageRounding);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
}
blurCoordinate = vec3(gl_Position.xy * 0.5 + vec2(0.5), cov.g);
}`),n.uniforms.add(new FRe("blurSize",s=>s.blurSize),new id("tex",s=>s.blurInputTexture)),n.code.add(T`void main() {
vec2 uv = blurCoordinate.xy;
vec4 center = texture(tex, uv);
if (blurCoordinate.z == 1.0) {
fragColor = center;
} else {
vec4 sum = center * 0.204164;
sum += texture(tex, uv + blurSize * 1.407333) * 0.304005;
sum += texture(tex, uv - blurSize * 1.407333) * 0.304005;
sum += texture(tex, uv + blurSize * 3.294215) * 0.093913;
sum += texture(tex, uv - blurSize * 3.294215) * 0.093913;
fragColor = sum;
}
}`),t}const lOt=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:ese,build:w5e},Symbol.toStringTag,{value:"Module"}));let x5e=class T5e extends Vr{initializeProgram(e){return new Lr(e.rctx,T5e.shader.get().build(),Mr)}initializePipeline(){return kt({colorWrite:Yt})}};x5e.shader=new Ir(lOt,()=>ge(()=>Promise.resolve().then(()=>h4t),void 0));let S5e=class C5e extends Vr{initializeProgram(e){return new Lr(e.rctx,C5e.shader.get().build(),Mr)}initializePipeline(){return kt({colorWrite:Yt})}};S5e.shader=new Ir(sOt,()=>ge(()=>Promise.resolve().then(()=>d4t),void 0));let cOt=class extends Ai{constructor(){super(...arguments),this.color=Bt(1,0,1,1),this.haloColor=Bt(1,0,1,1),this.haloOpacity=1,this.haloOpacityOccluded=.25,this.fillOpacity=.2,this.fillOpacityOccluded=.05,this.coverageRounding=lr(1,1)}},xO=class extends V2{constructor(e){super(e),this._context=null,this._passParameters=new cOt,this._downsampleDrawParameters=new Qne,this._blurDrawParameters=new ese,this._blurColorFormat=se("mac")?qi.RGBA:qi.RGBA4,this._grid={coverage:null,vao:null,verticalCellCount:0,horizontalCellCount:0,viewportWidth:0,viewportHeight:0},this.produces=new Map([[ue.HIGHLIGHT,()=>!0]])}consumes(){return fMe}initializeRenderContext(e){this._context=e,this._blurTechnique==null&&(this._blurTechnique=this._context.techniqueRepository.acquire(x5e)),this._downsampleTechnique==null&&(this._downsampleTechnique=this._context.techniqueRepository.acquire(S5e)),this._applyTechnique==null&&(this._applyTechnique=this._context.techniqueRepository.acquire(v5e)),this.addHandles([he(()=>this.view.highlightOptions.color,r=>{this._passParameters.color=I$(r??ONe),this.view.highlightOptions.haloColor||(this._passParameters.haloColor=this._passParameters.color),this._context.requestRender()},Kr),he(()=>this.view.highlightOptions.haloColor,r=>{this._passParameters.haloColor=r!=null?I$(r):this._passParameters.color,this._context.requestRender()},Kr),he(()=>this.view.highlightOptions.haloOpacity,r=>{this._passParameters.haloOpacity=r??RNe,this._passParameters.haloOpacityOccluded=.25*this._passParameters.haloOpacity,this._context.requestRender()},Kr),he(()=>this.view.highlightOptions.fillOpacity,r=>{this._passParameters.fillOpacity=r??$Ne,this._passParameters.fillOpacityOccluded=.25*this._passParameters.fillOpacity,this._context.requestRender()},Kr)])}uninitializeRenderContext(){this._context=null}dispose(){this._blurTechnique=tr(this._blurTechnique),this._downsampleTechnique=tr(this._downsampleTechnique),this._applyTechnique=tr(this._applyTechnique),this._grid.coverage=tr(this._grid.coverage),this._grid.vao=gt(this._grid.vao)}renderNode(e,r,i,n){var S,E;const s=(S=i==null?void 0:i.get("highlights"))==null?void 0:S.getTexture();if(!this._context||!s)return;if(!(this._blurTechnique.compiled&&this._downsampleTechnique.compiled&&this._applyTechnique.compiled))return void this._context.requestRender();const o=e.bindParameters.camera,a=o.fullWidth,l=o.fullHeight,c=o.pixelRatio,u=Math.ceil(a/c),h=Math.ceil(l/c),p=this._context.fbos,f=p.rctx;this._gridUpdateResources(s),this._gridComputeCoverage(s,e.bindParameters),this._passParameters.highlightTexture=s,this._passParameters.coverageTexture=(E=this._grid.coverage)==null?void 0:E.getTexture();const{width:g,height:_}=s.descriptor;cr(this._passParameters.coverageRounding,g/(Math.ceil(g/mp)*mp),_/(Math.ceil(_/mp)*mp));const v=this._grid.vao;f.bindVAO(v);const b=p.acquire(u,h,"highlight blur",this._blurColorFormat);f.unbindTexture(b.fbo.colorTexture),f.bindFramebuffer(b.fbo),f.setClearColor(0,0,0,0),f.clearSafe(Ci.COLOR_BUFFER_BIT),f.setViewport(0,0,u,h),this._blurDrawParameters.blurInputTexture=s,cr(this._blurDrawParameters.blurSize,1/u,0);const w=f.bindTechnique(this._blurTechnique,e.bindParameters,this._passParameters,this._blurDrawParameters);f.drawArrays(this._blurTechnique.primitiveType,0,k0(v,"geometry"));const x=p.acquire(u,h,"highlight blur",this._blurColorFormat);f.unbindTexture(x.fbo.colorTexture),f.bindFramebuffer(x.fbo),f.setClearColor(0,0,0,0),f.clearSafe(Ci.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=b.getTexture(),cr(this._blurDrawParameters.blurSize,0,1/h),w.bindDraw(this._blurDrawParameters,e.bindParameters,this._passParameters),f.drawArrays(this._blurTechnique.primitiveType,0,k0(v,"geometry")),f.bindFramebuffer(n==null?void 0:n.fbo),f.setViewport4fv(o.fullViewport),this._passParameters.blurTexture=x.getTexture(),f.bindTechnique(this._applyTechnique,e.bindParameters,this._passParameters),f.drawArrays(this._applyTechnique.primitiveType,0,k0(v,"geometry")),b.release(),x.release()}_gridUpdateResources(e){var p;if(!this._context)return;const r=this._context.fbos.rctx,i=this._grid,n=Math.ceil(e.descriptor.height/mp),s=Math.ceil(e.descriptor.width/mp);if(i.vao&&i.verticalCellCount===n&&i.horizontalCellCount===s)return;i.verticalCellCount=n,i.horizontalCellCount=s;const o=n+1,a=s+1,l=1/n,c=1/s,u=new Float32Array(6*4*o*a);let h=0;for(let f=0;f<o;f++)for(let g=0;g<a;g++)u[h++]=(g-.5)*c*2-1,u[h++]=(f-.5)*l*2-1,u[h++]=g*c,u[h++]=f*l,u[h++]=(g+.5)*c*2-1,u[h++]=(f-.5)*l*2-1,u[h++]=g*c,u[h++]=f*l,u[h++]=(g-.5)*c*2-1,u[h++]=(f+.5)*l*2-1,u[h++]=g*c,u[h++]=f*l,u[h++]=(g-.5)*c*2-1,u[h++]=(f+.5)*l*2-1,u[h++]=g*c,u[h++]=f*l,u[h++]=(g+.5)*c*2-1,u[h++]=(f-.5)*l*2-1,u[h++]=g*c,u[h++]=f*l,u[h++]=(g+.5)*c*2-1,u[h++]=(f+.5)*l*2-1,u[h++]=g*c,u[h++]=f*l;(p=i.vao)==null||p.dispose(),i.vao=new _f(r,Mr,{geometry:GI},{geometry:Wr.createVertex(r,Ar.STATIC_DRAW,u)})}_gridComputeCoverage(e,r){var l;if(!this._context)return;const i=this._context.fbos.rctx,n=this._grid,s=e.descriptor,o=Math.ceil(s.width/mp),a=Math.ceil(s.height/mp);this._downsampleDrawParameters.input=e,(l=n.coverage)==null||l.release(),n.coverage=this._context.fbos.acquire(o,a,"highlight coverage",qi.RG),i.unbindTexture(n.coverage.fbo.colorTexture),i.bindFramebuffer(n.coverage.fbo),i.bindTechnique(this._downsampleTechnique,r,this._passParameters,this._downsampleDrawParameters),i.setViewport(0,0,o,a),i.screen.draw()}get test(){return{coverage:this._grid.coverage}}};d([m()],xO.prototype,"_context",void 0),d([m()],xO.prototype,"view",void 0),xO=d([V("esri.views.3d.webgl-engine.effects.highlight.Highlight")],xO);let tse=class extends cc{constructor(){super(...arguments),this.receiveShadows=!0}};d([j()],tse.prototype,"receiveShadows",void 0);const uOt=.99999,hOt=.025;function E5e(t){const e=new Or;e.include(sL,t),e.include(LU),e.include(Ga);const r=e.fragment;return r.include(Td),r.include(cg),r.uniforms.add(new ct("defaultDepthTex",(i,n)=>n.shadowMap.getSnapshot(v2.ExcludeHighlight)),new ct("highlightDepthTex",(i,n)=>n.shadowMap.getSnapshot(v2.Highlight)),new ct("depthMap",(i,n)=>{var s;return(s=n.linearDepth)==null?void 0:s.getTexture()}),new ct("highlightTexture",i=>i.highlight),new xr("uColor",i=>i.shadowColor),new ti("nearFar",(i,n)=>n.camera.nearFar),new $e("opacity",i=>i.shadowOpacity),new $e("occludedOpacity",i=>i.occludedShadowOpacity),new $e("terminationFactor",i=>i.opacityElevation*i.dayNightTerminator),new Ft("lightingMainDirectionView",(i,n)=>pe(U0e,Ge(U0e,n.lighting.mainLight.direction,n.camera.viewInverseTransposeMatrix))),new ln("inverseViewMatrix",(i,n)=>os(z0e,ic(z0e,n.camera.viewMatrix,n.camera.center)))),r.constants.add("unoccludedHighlightFlag","vec4",Kre),r.code.add(T`
    vec3 normalFromDepth(vec3 pixelPos, vec2 fragCoord, ivec2 iuv) {
      float leftPixelDepth = linearDepthFromRGBA(texelFetch(depthMap, iuv + ivec2(-1, 0), 0), nearFar);
      float rightPixelDepth = linearDepthFromRGBA(texelFetch(depthMap, iuv + ivec2(1, 0), 0), nearFar);
      float bottomPixelDepth = linearDepthFromRGBA(texelFetch(depthMap, iuv + ivec2(0, -1), 0), nearFar);
      float topPixelDepth = linearDepthFromRGBA(texelFetch(depthMap, iuv + ivec2(0, 1), 0), nearFar);

      bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
      bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);

      vec3 fragCoordHorizontal = pickLeft
                                  ? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
                                  : vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
      vec3 fragCoordVertical = pickBottom
                                  ? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
                                  : vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);

      vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
      vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);

      vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
      // Flip normal depending on triangle winding order for consistency
      return pickLeft == pickBottom ? normal : -normal;
    }

    void main(void) {
      vec4 highlightInfo = texture(highlightTexture, uv);
      float visiblyHighlighted = (1.0 - clamp(distance(unoccludedHighlightFlag, highlightInfo), 0.0, 1.0)) * highlightInfo.a;
      if (visiblyHighlighted > ${T.float(uOt)}) {
        discard;
      }

      ivec2 iuv = ivec2(uv * vec2(textureSize(depthMap, 0)));
      float depth = rgba2float(texelFetch(depthMap, iuv, 0));
      // 0.0 is the clear value of depthMap, which means nothing has been drawn there and we should discard
      if (depth == 0.0) {
        discard;
      }

      float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
      if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
        discard;
      }

      vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
      vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;

      mat4 shadowMatrix;
      float linearDepth = -currentPixelDepth;
      int i = chooseCascade(linearDepth, shadowMatrix);
      if (i >= numCascades) {
        discard;
      }

      vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);

      // vertex completely outside? -> no shadow
      if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
        discard;
      }

      ivec2 texSize = textureSize(highlightDepthTex, 0);
      ivec2 uvShadow = ivec2(cascadeCoordinates(i, texSize, lvpos) * vec2(texSize));

      float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
      bool shadowHighlight = depthHighlight < lvpos.z;
      if (!shadowHighlight) {
        discard;
      }

      float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
      bool shadowDefault = depthDefault < lvpos.z;

      vec3 normal = normalFromDepth(currentPixelPos.xyz, gl_FragCoord.xy, iuv);
      bool shaded = dot(normal, lightingMainDirectionView) < ${T.float(hOt)};

      float fragOpacity = (shadowDefault || shaded) ? occludedOpacity : opacity;
      fragColor = vec4(uColor.rgb, uColor.a * fragOpacity * terminationFactor);
    }
  `),e}const z0e=xe(),U0e=C(),dOt=Object.freeze(Object.defineProperty({__proto__:null,build:E5e},Symbol.toStringTag,{value:"Module"}));let pOt=class extends hie{constructor(){super(...arguments),this.shadowColor=Bt(1,0,1,1),this.shadowOpacity=.2,this.occludedShadowOpacity=.1,this.opacityElevation=1,this.dayNightTerminator=1}},P5e=class A5e extends Vr{constructor(e){super(e,new tse,()=>this.destroy())}initializeProgram(e){return new Lr(e.rctx,A5e.shader.get().build(this.configuration),Mr)}initializePipeline(){return kt({blending:Wo(Se.SRC_ALPHA,Se.ONE,Se.ONE_MINUS_SRC_ALPHA,Se.ONE_MINUS_SRC_ALPHA),colorWrite:Yt,depthTest:null,depthWrite:null})}get primitiveType(){return sr.TRIANGLE_STRIP}};P5e.shader=new Ir(dOt,()=>ge(()=>Promise.resolve().then(()=>p4t),void 0));const fOt=.001953125,mOt=4e4,gOt=5e4;let NS=class extends V2{constructor(e){super(e),this._maxOpacity=1,this._passParameters=new pOt,this._shadowDifference=.2,this._context=null,this.produces=new Map([[ue.SHADOW_HIGHLIGHT,()=>this._isVisible]])}consumes(){return fMe}initializeRenderContext(e){this._context=e,this.addHandles([he(()=>this.view.highlightOptions.shadowOpacity,r=>{this._passParameters.shadowOpacity=r??LNe,this._updateOccludedShadowOpacity(),this._updateMaxOpacity()},Kr),he(()=>this.view.highlightOptions.shadowDifference,r=>{this._shadowDifference=r??DNe,this._updateOccludedShadowOpacity(),this._updateMaxOpacity()},Kr),he(()=>this.view.highlightOptions.shadowColor,r=>{this._passParameters.shadowColor=I$(r??INe),this._updateMaxOpacity()},Kr)])}_updateOccludedShadowOpacity(){this._passParameters.occludedShadowOpacity=this._passParameters.shadowOpacity*(1-this._shadowDifference)}_updateMaxOpacity(){const e=Math.max(this._passParameters.shadowOpacity,this._passParameters.occludedShadowOpacity);this._maxOpacity=e*this._passParameters.shadowColor[3]}uninitializeRenderContext(){this._context=null}enable(){this._context&&this._technique==null&&(this._technique=this._context.techniqueRepository.acquire(P5e))}renderNode(e,r,i,n){var l,c;const s=(l=i==null?void 0:i.get("highlights"))==null?void 0:l.getTexture();if(!this._context||!s||!this._isVisible)return;if(!((c=this._technique)!=null&&c.compiled))return void this._context.requestRender();const o=e.bindParameters;if(!o.shadowMap.enabled||!o.linearDepth)return;this._passParameters.highlight=s,this._passParameters.origin=o.camera.center;const a=e.rctx;a.bindFramebuffer(n==null?void 0:n.fbo),a.bindTechnique(this._technique,o,this._passParameters),a.screen.draw()}updateParameters(e,r){this._passParameters.opacityElevation=1-_$(mOt,gOt,e.relativeElevation);const i=this.viewingMode===De.Global?pe(B0e,e.center):ie(B0e,0,0,1),n=de(i,r);this._passParameters.dayNightTerminator=_$(0,1,we(30*n,0,1)),this._isVisible&&this.enable()}get _isVisible(){const{opacityElevation:e,dayNightTerminator:r}=this._passParameters;return this._maxOpacity*e*r>=fOt}};d([m()],NS.prototype,"_context",void 0),d([m()],NS.prototype,"view",void 0),d([m()],NS.prototype,"viewingMode",void 0),NS=d([V("esri.views.3d.webgl-engine.effects.highlight.ShadowHighlight")],NS);const B0e=C(),KT={maxSearchSteps:8,maxDistanceAreaTex:16};function M5e(){const t=new Or;return t.include(Ga),t.fragment.uniforms.add(new ct("edgesTexture",e=>e.inputTexture),new ct("areaTexture",e=>e.areaTexture),new ct("searchTexture",e=>e.searchTexture)),t.fragment.code.add(T`
    #define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )
    #define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )

    vec4 sampleLevelZeroOffset(sampler2D tex, vec2 coord, vec2 offset, vec2 resolution) {
      return texture(tex, coord + offset.x * resolution, 0.0);
    }

    float searchLength(sampler2D searchTex, vec2 e, float bias, float scale) {
      e.r = bias + e.r * scale;
      return 255.0 * texture( searchTex, e, 0.0 ).r;
    }

    float searchLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
      vec2 e = vec2( 0.0, 1.0 );
      for ( int i = 0; i < ${T.int(KT.maxSearchSteps)}; i ++ ) {
        e = texture( edgesTex, texcoord, 0.0 ).rg;
        texcoord -= vec2( 2.0, 0.0 ) * resolution;
        if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;
      }
      texcoord.x += 0.25 * resolution.x;
      texcoord.x += resolution.x;
      texcoord.x += 2.0 * resolution.x;
      texcoord.x -= resolution.x * searchLength(searchTex, e, 0.0, 0.5);
      return texcoord.x;
    }

    float searchRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
      vec2 e = vec2( 0.0, 1.0 );
      for ( int i = 0; i < ${T.int(KT.maxSearchSteps)}; i ++ ) {
        e = texture( edgesTex, texcoord, 0.0 ).rg;
        texcoord += vec2( 2.0, 0.0 ) * resolution;
        if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;
      }
      texcoord.x -= 0.25 * resolution.x;
      texcoord.x -= resolution.x;
      texcoord.x -= 2.0 * resolution.x;
      texcoord.x += resolution.x * searchLength( searchTex, e, 0.5, 0.5 );
      return texcoord.x;
    }

    float searchUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
      vec2 e = vec2( 1.0, 0.0 );
      for ( int i = 0; i < ${T.int(KT.maxSearchSteps)}; i ++ ) {
        e = texture( edgesTex, texcoord, 0.0 ).rg;
        texcoord += vec2( 0.0, 2.0 ) * resolution;
        if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;
      }
      texcoord.y -= 0.25 * resolution.y;
      texcoord.y -= resolution.y;
      texcoord.y -= 2.0 * resolution.y;
      texcoord.y += resolution.y * searchLength( searchTex, e.gr, 0.0, 0.5 );
      return texcoord.y;
    }

    float searchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
      vec2 e = vec2( 1.0, 0.0 );
      for ( int i = 0; i < ${T.int(KT.maxSearchSteps)}; i ++ ) {
        e = texture( edgesTex, texcoord, 0.0 ).rg;
        texcoord -= vec2( 0.0, 2.0 ) * resolution;
        if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;
      }
      texcoord.y += 0.25 * resolution.y;
      texcoord.y += resolution.y;
      texcoord.y += 2.0 * resolution.y;
      texcoord.y -= resolution.y * searchLength( searchTex, e.gr, 0.5, 0.5 );
      return texcoord.y;
    }

    vec2 getArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {
      vec2 texcoord = float( ${T.int(KT.maxDistanceAreaTex)} ) * round( 4.0 * vec2( e1, e2 ) ) + dist;
      texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );
      texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;
      return texture( areaTex, texcoord, 0.0 ).rg;
    }

    void main() {
      vec2 size = vec2(textureSize(edgesTexture, 0));
      vec2 resolution = 1.0 / size;
      vec2 pixelCoord = uv * size;
      vec4 offsets[2];
      offsets[0] = uv.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );
      offsets[1] = uv.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );
      vec4 maxOffset = vec4( offsets[0].xz, offsets[1].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( ${T.int(KT.maxSearchSteps)} );

      ivec4 subsampleIndices = ivec4(0.0);
      vec4 weights = vec4(0.0);
      vec2 e = texture( edgesTexture, uv ).rg;
      if ( e.g > 0.0 ) {
        vec2 d;
        vec2 coords;
        coords.x = searchLeft( edgesTexture, searchTexture, offsets[0].xy, maxOffset.x, resolution );
        coords.y = offsets[1].y;
        d.x = coords.x;
        float e1 = texture( edgesTexture, coords, 0.0 ).r;
        coords.x = searchRight( edgesTexture, searchTexture, offsets[0].zw, maxOffset.y, resolution );
        d.y = coords.x;
        d = d * size.x - pixelCoord.x;
        vec2 sqrt_d = sqrt( abs(d) );
        coords.y -= 1.0 * resolution.y;
        float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2( 1.0, 0.0 ), resolution).r;
        weights.rg = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.y ) );
      }

      if ( e.r > 0.0 ) {
        vec2 d;
        vec2 coords;
        coords.y = searchUp( edgesTexture, searchTexture, offsets[1].xy, maxOffset.z, resolution );
        coords.x = offsets[0].x;
        d.x = coords.y;
        float e1 = texture( edgesTexture, coords, 0.0 ).g;
        coords.y = searchYDown( edgesTexture, searchTexture, offsets[1].zw, maxOffset.w, resolution );
        d.y = coords.y;
        d = d * size.y - pixelCoord.y;
        vec2 sqrt_d = sqrt(abs(d));
        coords.y -= 1.0 * resolution.y;
        float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2(0.0, 1.0), resolution).g;
        weights.ba = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.x ) );

        // for some reason the following lines are necessary to prevent
        // texture lookup precision issues on some Intel integrated graphics chips
        vec4 dbg = (offsets[0] + offsets[1] + maxOffset + coords.xyyx);
        weights.r += 0.00000001 * dot(vec4(0, 1, 0, 1), dbg);
      }
      fragColor = weights;
    }`),t}const yOt=Object.freeze(Object.defineProperty({__proto__:null,build:M5e},Symbol.toStringTag,{value:"Module"}));let O5e=class R5e extends Vr{initializeProgram(e){return new Lr(e.rctx,R5e.shader.get().build(),Mr)}initializePipeline(){return kt({colorWrite:Yt})}};O5e.shader=new Ir(yOt,()=>ge(()=>Promise.resolve().then(()=>f4t),void 0));function $5e(){const t=new Or;return t.include(Ga),t.fragment.uniforms.add(new ct("blendWeightsTexture",e=>e.inputTexture),new ct("colorTexture",e=>e.color)),t.fragment.code.add(T`void main() {
vec2 resolution = 1.0 / vec2(textureSize(colorTexture, 0));
vec4 offsets = vec4(uv.x + resolution.x, uv.y, uv.x, uv.y - resolution.y);
vec4 a;
a.rb = texture(blendWeightsTexture, uv).rb;
a.g = texture(blendWeightsTexture, offsets.zw).g;
a.a = texture(blendWeightsTexture, offsets.xy).a;
if ( dot(a, vec4(1.0)) < 1e-5 ) {
fragColor = texture( colorTexture, uv, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture( colorTexture, uv, 0.0 );
vec4 Cop = texture( colorTexture, uv + sign( offset ) * resolution.xy, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
fragColor = mix(C, Cop, s);
}
}`),t}const _Ot=Object.freeze(Object.defineProperty({__proto__:null,build:$5e},Symbol.toStringTag,{value:"Module"}));let I5e=class L5e extends Vr{initializeProgram(e){return new Lr(e.rctx,L5e.shader.get().build(),Mr)}initializePipeline(){return kt({colorWrite:Yt})}};I5e.shader=new Ir(_Ot,()=>ge(()=>Promise.resolve().then(()=>m4t),void 0));const V0e={threshold:.05,localConstrastAdaption:2};function D5e(){const t=new Or;return t.include(Ga),t.fragment.uniforms.add(new ct("colorTexture",e=>e.color)),t.outputs.add("fragEdges","vec2"),t.fragment.code.add(T`
    float absMax3(vec3 v) {
      vec3 t = abs(v);
      return max(max(t.r, t.g), t.b);
    }

    void main() {
      vec2 resolution = 1.0 / vec2(textureSize(colorTexture, 0));
      vec4 offsets[3];
      offsets[0] = vec4(uv.x - resolution.x, uv.y, uv.x, uv.y + resolution.y);
      offsets[1] = vec4(uv.x + resolution.x, uv.y, uv.x, uv.y - resolution.y);
      offsets[2] = vec4(uv.x - 2.0 * resolution.x, uv.y, uv.x, uv.y + 2.0 * resolution.y);

      // Calculate color deltas:
      vec4 delta;
      vec3 C = texture(colorTexture, uv).rgb;

      vec3 Cleft = texture(colorTexture, offsets[0].xy).rgb;
      delta.x = absMax3(C - Cleft);

      vec3 Ctop = texture(colorTexture, offsets[0].zw).rgb;
      delta.y = absMax3(C - Ctop);

      vec2 edges = step(vec2(${T.float(V0e.threshold)}), delta.xy);

      // discard if there is no edge:
      if (dot(edges, vec2(1.0)) == 0.0) {
        discard;
      }

      // Calculate right and bottom deltas:
      vec3 Cright = texture(colorTexture, offsets[1].xy).rgb;
      delta.z = absMax3(C - Cright);

      vec3 Cbottom  = texture(colorTexture, offsets[1].zw).rgb;
      delta.w = absMax3(C - Cbottom);

      // Calculate the maximum delta in the direct neighborhood:
      float maxDelta = max(max(max(delta.x, delta.y), delta.z), delta.w);

      // Calculate left-left and top-top deltas:
      vec3 Cleftleft  = texture(colorTexture, offsets[2].xy).rgb;
      delta.z = absMax3(C - Cleftleft);

      vec3 Ctoptop = texture(colorTexture, offsets[2].zw).rgb;
      delta.w = absMax3(C - Ctoptop);

      // Calculate the final maximum delta:
      maxDelta = max(max(maxDelta, delta.z), delta.w);

      // Local contrast adaptation in action:
      edges *= step(maxDelta, float(${T.float(V0e.localConstrastAdaption)}) * delta.xy);

      fragEdges = edges;
    }
  `),t}const vOt=Object.freeze(Object.defineProperty({__proto__:null,build:D5e},Symbol.toStringTag,{value:"Module"}));let N5e=class F5e extends Vr{initializeProgram(e){return new Lr(e.rctx,F5e.shader.get().build(),Mr)}initializePipeline(){return kt({colorWrite:Yt})}};N5e.shader=new Ir(vOt,()=>ge(()=>Promise.resolve().then(()=>g4t),void 0));let bOt=class extends Ai{},Mw=class extends V2{constructor(e){super(e),this._context=null,this._areaTexture=null,this._searchTexture=null,this._isEnabled=!1,this._smaaParameters=new bOt,this.produces=new Map([[ue.ANTIALIASING,()=>this._isEnabled&&this._context!=null]])}consumes(){return pMe}get updating(){return this._abortController!=null}initializeRenderContext(e){this._context=e,this.addHandles([he(()=>this.view.qualitySettings.antialiasingEnabled,()=>this.renderFeatureChanged(),Kr)])}renderFeatureChanged(){var e;this.view.qualitySettings.antialiasingEnabled||(e=this._context)!=null&&e.isFeatureEnabled(Rs.Antialiasing)?this.enable():this.disable()}uninitializeRenderContext(){this.disable(),this._context=null}async enable(){var r;if(this._isEnabled||!this._context||this._abortController)return;if(this._edgeTechnique??(this._edgeTechnique=this._context.techniqueRepository.acquire(N5e)),this._blendTechnique??(this._blendTechnique=this._context.techniqueRepository.acquire(O5e)),this._blurTechnique??(this._blurTechnique=this._context.techniqueRepository.acquire(I5e)),this._areaTexture&&this._searchTexture)return void(this._isEnabled=!0);this._abortController=new AbortController;const e=this._abortController.signal;try{const i=await ge(()=>import("./SMAAData-DCEZ61Cs.js"),__vite__mapDeps([]));await this._loadTextures(this._context,i,e),(r=this._context)==null||r.requestRender()}catch{}this._abortController=null}async _loadTextures(e,r,i){if(vt(i),!e)throw dr();const[n,s]=await Promise.allSettled([cy(r.areaTexture,{signal:i}),cy(r.searchTexure,{signal:i})]);vt(i),n.status==="fulfilled"&&s.status==="fulfilled"&&(this._areaTexture=G0e(e.fbos.rctx,Ht.LINEAR,Tt.RGB,n.value),this._searchTexture=G0e(e.fbos.rctx,Ht.NEAREST,Tt.LUMINANCE,s.value),this._isEnabled=!0)}_disposeTextures(){this._areaTexture=gt(this._areaTexture),this._searchTexture=gt(this._searchTexture)}disable(){this._abortController=wl(this._abortController),this._isEnabled=!1}destroy(){this.disable(),this._disposeTextures()}renderNode(e,r,i,n){var p,f,g,_;const s=(p=i==null?void 0:i.get("composite-color"))==null?void 0:p.getTexture();if(!(this._isEnabled&&this._context&&i&&s))return n;if(!((f=this._edgeTechnique)!=null&&f.compiled&&((g=this._blendTechnique)!=null&&g.compiled)&&((_=this._blurTechnique)!=null&&_.compiled)))return this._context.requestRender(),n;const o=s.descriptor.width,a=s.descriptor.height,l=this._context.fbos,c=e.rctx;c.setViewport(0,0,o,a);const u=l.acquire(o,a,"smaa edges",qi.RG);c.unbindTexture(u.fbo.colorTexture),c.bindFramebuffer(u.fbo),c.setClearColor(0,0,0,1),c.clear(Ci.COLOR_BUFFER_BIT),this._smaaParameters.color=s,c.bindTechnique(this._edgeTechnique,null,this._smaaParameters),c.screen.draw();const h=l.acquire(o,a,"smaa blend");return c.unbindTexture(h.fbo.colorTexture),c.bindFramebuffer(h.fbo),c.setClearColor(0,0,1,1),c.clear(Ci.COLOR_BUFFER_BIT),this._smaaParameters.inputTexture=u.getTexture(),this._smaaParameters.areaTexture=this._areaTexture,this._smaaParameters.searchTexture=this._searchTexture,c.bindTechnique(this._blendTechnique,null,this._smaaParameters),c.screen.draw(),c.bindFramebuffer(n==null?void 0:n.fbo),u.release(),c.setClearColor(0,1,0,1),c.clear(Ci.COLOR_BUFFER_BIT),this._smaaParameters.inputTexture=h.getTexture(),c.bindTechnique(this._blurTechnique,null,this._smaaParameters),c.screen.draw(),h.release(),n}};function G0e(t,e,r,i){const n=new ri;return n.pixelFormat=r,n.wrapMode=Jt.CLAMP_TO_EDGE,n.width=i.width,n.height=i.height,n.samplingMode=e,new Sr(t,n,i)}d([m()],Mw.prototype,"view",void 0),d([m()],Mw.prototype,"_context",void 0),d([m()],Mw.prototype,"_abortController",void 0),d([m({readOnly:!0})],Mw.prototype,"updating",null),Mw=d([V("esri.views.3d.webgl-engine.effects.smaa.SMAA")],Mw);let wOt=class{constructor(){this._step=W0e,this._dilation=1,this._firstIdleTime=0}frame(e,r){if(r?this._firstIdleTime===0&&(this._firstIdleTime=performance.now()):this._firstIdleTime=0,se("disable-feature:high-quality-idle"))this._dilation=1;else{const n=r?performance.now()-this._firstIdleTime:0;if(n>=j0e+TOt)return this._step=1/0,void(this._dilation=1);this._dilation=n>=j0e?SOt:1}const i=we(e/xOt,W0e,EOt);this._step===1/0?this._step=i:this._step=this._step*H0e+i*(1-H0e)}get value(){return this._step}get timeDilation(){return this._dilation}clear(){this._step=this._firstIdleTime=0}};const xOt=.5,j0e=12e4,TOt=1e4,SOt=10,H0e=.9,COt=30,W0e=1e3/1,EOt=1e3/COt;let POt=class{constructor(e,r){this._fbos=e,this.compositingHelper=r,this._width=4,this._height=4,this._clearColor=Zt()}dispose(){this._color=tr(this._color),this.releaseBuffers()}get framebuffer(){return this.color.attachDepth(this.depth),this.color.fbo}get colorTexture(){return this.color.getTexture()}get depthTexture(){return this.depth.attachment}initializeFrame(e,r,i){this._fbos.interactive=i===Op.Default;const n=this._fbos.rctx;this._width=e.fullWidth,this._height=e.fullHeight,px(this,n.parameters.maxTextureSize);const s=this._color;return this._color=null,this.releaseBuffers(),Kh(this._clearColor,r),s}releaseBuffers(){var e;(e=this._color)==null||e.detachDepth(),this._depth=tr(this._depth)}renderHUDVisibility(e,r,i){return(e==null?void 0:e.fbo.width)===this._width&&(e==null?void 0:e.fbo.height)===this._height||(e==null||e.release(),e=this._fbos.acquire(this._width,this._height,"hud visibility",qi.RGBA4)),e.attachDepth(i||this.depth),this._fbos.rctx.bindFramebuffer(e.fbo),this._fbos.rctx.clearFramebuffer(AOt),r(),e.detachDepth(),e}compositeToHUDVisibility(e,r){var i;this._fbos.rctx.bindFramebuffer((i=e.hudVisibility)==null?void 0:i.fbo),this.compositingHelper.compositeHUD(e,r)}renderOITPass(e,r,i){let n,s;const{_width:o,_height:a}=this;switch(r){case ft.Color:n=this._fbos.acquire(o,a,i?"oit hud color":"oit color",qi.RGBA16F),s=[0,0,0,0];break;case ft.Alpha:n=this._fbos.acquire(o,a,i?"oit hud alpha":"oit alpha",qi.R16F),s=[1,1,1,1];break;case ft.FrontFace:n=this._fbos.acquire(o,a,i?"oit hud front":"oit front"),s=[0,0,0,0]}return i?n.acquireDepth(ra.DEPTH16_BUFFER):n.attachDepth(this.depth),this._fbos.rctx.bindFramebuffer(n.fbo),this._fbos.rctx.clearFramebuffer(s,i,i),e(),n.detachDepth(),n}compositeToFramebuffer(e,r,i,n){this.bindFbo(),this.compositingHelper.composite(e,r,i,n)}compositeTransparentOntoOpaque(e,r,i,n,s){s?(this._fbos.rctx.bindFramebuffer(s.fbo),this._fbos.rctx.setClearColor(0,0,0,1e-13),this._fbos.rctx.clearSafe(Ci.COLOR_BUFFER_BIT)):this.bindFbo(),this.compositingHelper.compositeOIT(e,r.getTexture(),i.getTexture(),n.getTexture())}renderDepthDetached(e){this._bindTarget(this.color),e(),this._bindTarget(this.color,this.depth)}renderToCachedFBO(e,r,i,n,s=qi.RGBA,o=ra.DEPTH16_BUFFER,a=this._width,l=this._height,c=null){return(e==null?void 0:e.fbo.width)===a&&(e==null?void 0:e.fbo.height)===l||(e=tr(e)),e=e??this._fbos.acquire(a,l,r,s),c==null||c.forEach(u=>e.acquireColor(u.attachment,u.format)),o!=null&&e.acquireDepth(o),this._fbos.rctx.bindFramebuffer(e.fbo),this._fbos.rctx.clearFramebuffer(n,!0,!0),i(),e}renderToTargets(e,r,i,n,s=!1,o=!1){this._bindTarget(r,i),this._fbos.rctx.clearFramebuffer(n,s,o),e(),r.detachDepth()}bindFbo(){const e=this._color==null;if(this._bindTarget(this.color,this.depth),e){const r=this._fbos.rctx;r.setClearStencil(0),r.setClearColor(this._clearColor[0],this._clearColor[1],this._clearColor[2],this._clearColor[3]),r.clearSafe(Ci.COLOR_BUFFER_BIT|Ci.DEPTH_BUFFER_BIT|Ci.STENCIL_BUFFER_BIT)}}_bindTarget(e,r){e.attachDepth(r),this._fbos.rctx.bindFramebuffer(e.fbo)}get width(){return this._width}get height(){return this._height}get color(){return this._ensureColor()}_ensureColor(){return this._color||(this._color=this._fbos.acquire(this._width,this._height,"composite-color")),this._color}updateColor(e,r){const i=this._ensureColor();i.attachDepth(this.depth),i.setName(r),this._color=e(i)}get depth(){return this._depth||(this._depth=this._fbos.acquireDepth(ra.DEPTH_STENCIL_TEXTURE,this._width,this._height,"depth")),this._depth}};const AOt=[0,1,0,1],gL=255,MOt=1/gL;function k5e(t){const e=new Or,r=e.fragment;return r.include(Td),r.include(cg),e.include(LU),e.include(Ga),e.include(sL,t),r.uniforms.add(new ct("shadowMap",(i,n)=>n.shadowMap.depthTexture),new ct("depthMap",(i,n)=>{var s;return(s=n.linearDepth)==null?void 0:s.getTexture()}),new ln("inverseViewMatrix",(i,n)=>os(q0e,ic(q0e,n.camera.viewMatrix,n.camera.center))),new ti("nearFar",(i,n)=>n.camera.nearFar)),r.constants.add("sampleValue","float",MOt),e.outputs.add("sampleCount","float"),r.code.add(T`void main(void) {
float depth = rgba2float(texture(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth > nearFar.y || -currentPixelDepth < nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
ivec2 texSize = textureSize(shadowMap, 0);
ivec2 uvShadow = ivec2(cascadeCoordinates(i, texSize, lvpos) * vec2(texSize));
float depthShadow = readShadowMapDepth(uvShadow, shadowMap);
bool shadow = depthShadow < lvpos.z;
if (!shadow) {
discard;
}
sampleCount = sampleValue;
}`),e}const q0e=xe(),OOt=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastMaxSamples:gL,build:k5e},Symbol.toStringTag,{value:"Module"}));var T3;(function(t){t[t.Gradient=0]="Gradient",t[t.Threshold=1]="Threshold",t[t.COUNT=2]="COUNT"})(T3||(T3={}));let XJ=class extends cc{constructor(){super(...arguments),this.visualization=T3.Gradient,this.bandsEnabled=!1}};d([j({count:T3.COUNT})],XJ.prototype,"visualization",void 0),d([j()],XJ.prototype,"bandsEnabled",void 0);let rse=class extends Ai{constructor(e){super(),this._data=e,this.sampleScale=0,this.opacityFromElevation=1,this.color=NI(ROt),this.bandSize=.1,this.threshold=.5}get shadowCastMap(){return this._data.shadowCastTexture}};const ROt=Bt(.01,0,.25,1);function z5e(t){const e=new Or,r=e.fragment;r.include(Td),r.include(cg),e.include(LU),e.include(Ga);const{visualization:i,bandsEnabled:n}=t;r.constants.add("inverseSampleValue","float",gL),r.uniforms.add(new ct("shadowCastMap",a=>a.shadowCastMap),new $e("sampleScale",a=>a.sampleScale),new $e("opacityFromElevation",a=>a.opacityFromElevation),new xr("uColor",a=>a.color));const s=i===T3.Gradient,o=i===T3.Threshold;return s&&n?r.uniforms.add(new $e("bandSize",a=>a.bandSize)):o&&r.uniforms.add(new $e("threshold",a=>a.threshold)),r.code.add(T`
    void main(void) {
      float record = texture(shadowCastMap, uv).r;
      float pixelSamples = record * inverseSampleValue;
      if (pixelSamples < 1.0) {
        discard;
      }

      float strength = pixelSamples * sampleScale;

      ${o?T`
          if (strength <= threshold) {
            discard;
          }`:""}

      ${s&&n?T`strength = ceil(strength / bandSize) * bandSize;`:""}

      fragColor = vec4(uColor.xyz, uColor.a * opacityFromElevation ${s?T`* strength`:""});
    }
  `),e}const $Ot=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastVisualizePassParameters:rse,build:z5e},Symbol.toStringTag,{value:"Module"}));let U5e=class B5e extends Vr{constructor(e,r){super(e,r,()=>this.destroy())}initializeProgram(e){return new Lr(e.rctx,B5e.shader.get().build(this.configuration),Mr)}initializePipeline(){return kt({blending:Zu,colorWrite:Yt,depthTest:null,depthWrite:null})}get primitiveType(){return sr.TRIANGLE_STRIP}};U5e.shader=new Ir($Ot,()=>ge(()=>Promise.resolve().then(()=>y4t),void 0));const IOt=4e4,LOt=5e4,V5e=1/512;let HF=class extends Ae{constructor(e,r,i,n){super({}),this._techniqueRepository=e,this._rctx=r,this._data=i,this._requestRender=n,this._passParameters=new rse(this._data),this._techniqueConfig=new XJ,this._enabled=!1,this._vao=wg(r)}normalizeCtorArgs(){return{}}dispose(){this._stop(),this._vao=gt(this._vao),this._techniqueRepository.release(this._technique),this._technique=null}get _visualizeShadowCastTechnique(){return this._technique=this._techniqueRepository.releaseAndAcquire(U5e,this._techniqueConfig,this._technique),this._technique}render(e){if(!this._showVisualization)return;this._passParameters.sampleScale=1/this._data.computedSamples;const r=this._visualizeShadowCastTechnique;this._rctx.bindVAO(this._vao),this._rctx.bindTechnique(r,e,this._passParameters),this._rctx.drawArrays(r.primitiveType,0,k0(this._vao,"geometry"))}setOptions(e){e.enabled!==void 0&&this._setEnabled(e.enabled),e.color!==void 0&&this._setColor(e.color),e.threshold!==void 0&&(this._threshold=e.threshold),e.visualization!==void 0&&(this._visualization=e.visualization),e.bandSize!==void 0&&(this._bandSize=e.bandSize),e.bandsEnabled!==void 0&&(this._bandsEnabled=e.bandsEnabled)}get opacityFromElevation(){return this._passParameters.opacityFromElevation}set opacityFromElevation(e){this._passParameters.opacityFromElevation!==e&&(this._passParameters.opacityFromElevation=e,this.notifyChange("opacityFromElevation"))}get _showVisualization(){return this._enabled&&this._data.computedSamples>0&&this.opacityFromElevation>V5e}get _threshold(){return this._passParameters.threshold}set _threshold(e){this._threshold!==e&&(this._passParameters.threshold=e,this._requestRenderIfRunning())}get _visualization(){return this._techniqueConfig.visualization}set _visualization(e){e!==this._visualization&&(this._techniqueConfig.visualization=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}get _bandSize(){return this._passParameters.bandSize}set _bandSize(e){e!==this._bandSize&&(this._passParameters.bandSize=e,this._requestRenderIfRunning())}get _bandsEnabled(){return this._techniqueConfig.bandsEnabled}set _bandsEnabled(e){e!==this._bandsEnabled&&(this._techniqueConfig.bandsEnabled=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}_setColor(e){const r=this._passParameters.color;jC(e,r)||(Kh(this._passParameters.color,e),this._requestRenderIfRunning())}_setEnabled(e){e!==this._enabled&&(e?this._start():this._stop())}_requestRenderIfRunning(){this._enabled&&this._requestRender()}_start(){this._enabled=!0,this._requestRender()}_stop(){this._enabled=!1,this._requestRender()}};d([m()],HF.prototype,"opacityFromElevation",null),HF=d([V("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],HF);let G5e=class j5e extends Vr{constructor(e){super(e,new tse,()=>this.destroy())}initializeProgram(e){return new Lr(e.rctx,j5e.shader.get().build(this.configuration),Mr)}initializePipeline(){return kt({blending:Wo(Se.ONE,Se.ONE,Se.ONE,Se.ONE),colorWrite:Yt,depthTest:null,depthWrite:null})}get primitiveType(){return sr.TRIANGLE_STRIP}};G5e.shader=new Ir(OOt,()=>ge(()=>Promise.resolve().then(()=>_4t),void 0));let Bl=class extends Ae{constructor(e,r,i,n,s,o){super({}),this.fbos=e,this._stage=i,this._prepareForShadowMapPass=n,this._renderToShadowMap=s,this._requestRender=o,this._progress=0,this._sampleCount=0,this._passParameters=new hie,this._cachedLightDirections=[],this._depthRange=BJ,this._previewing=!1,this._cameraForcedForScreenshot=!1,this._shadowAccumulatorKey="shadowAccumulator",this._rctx=e.rctx,this._bindParameters=new nU(new Die(e,i.viewingMode),null),this._bindParameters.shadowMap.enabled=!0,this._vao=wg(this._rctx),this._accumulationRenderer=new HF(r,this._rctx,this,o);const a=this._stage.view.resourceController.scheduler;this.addHandles([a.registerTask(bt.SHADOW_ACCUMULATOR,this),he(()=>i.renderView,l=>{this.removeHandles(Y0e),l!=null&&this.addHandles(l.events.on("force-camera-for-screenshot",()=>this._cameraForcedForScreenshot=!0),Y0e)},Kr),he(()=>this._previewing,()=>this._requestRenderIfEnabled(),Qr)],this._shadowAccumulatorKey)}normalizeCtorArgs(){return{}}dispose(){this._disable(),this.removeHandles(this._shadowAccumulatorKey),this._accumulationRenderer=gt(this._accumulationRenderer),this._bindParameters.shadowMap.dispose(),this._fbo=gt(this._fbo),this._vao=gt(this._vao),this._accumulationTechniqueCached=tr(this._accumulationTechniqueCached),this._cachedLightDirections.length=0,this._sampleCount=0}get computedSamples(){return this._progress}get shadowCastTexture(){var e;return(e=this._fbo)==null?void 0:e.colorTexture}get isAccumulating(){return this._isPreviewing||this._isRefining}get _accumulationTechnique(){if(this._accumulationTechniqueCached==null){const e={rctx:this._rctx,viewingMode:this._stage.viewingMode};this._accumulationTechniqueCached=new G5e(e)}return this._accumulationTechniqueCached}get _isRefining(){return this._isActive&&!this._isDoneAccumulating&&!this._previewing}get _isPreviewing(){return this._isActive&&this._previewing}get _isActive(){return this._fbo!=null&&this._sampleCount>0}get canAccumulate(){var e;return((e=this._bindParameters.linearDepth)==null?void 0:e.getTexture())!==null&&this._depthRange!==BJ&&this._opacityFromElevation>V5e}get _isDoneAccumulating(){return this._progress>=this._sampleCount}get _lightDirections(){return this._cachedLightDirections}set _lightDirections(e){const r=this._cachedLightDirections;if(tg(r,e,i2))return;const i=Math.min(gL,e.length);r.length=i,this._sampleCount=i;for(let n=0;n<i;++n)r[n]=ce(r[n]??C(),e[n]);this._invalidate()}get _opacityFromElevation(){return this._accumulationRenderer.opacityFromElevation}set _opacityFromElevation(e){this._accumulationRenderer.opacityFromElevation=e}get running(){return this._isRefining&&this.canAccumulate&&this._progress>0}runTask(e){for(this._prepareForShadowMapPass(this._bindParameters);!e.done&&!this._isDoneAccumulating;)this._accumulateShadow(),e.madeProgress();this._requestRender()}renderAccumulation(e,r,i,n){if(this._depthRange=r,this._updateCamera(i),this._bindParameters.contentCamera=n,this._bindParameters.linearDepth=e,this._passParameters.origin=this._bindParameters.camera.center,this.notifyChange("canAccumulate"),!this.isAccumulating||!this.canAccumulate)return;(this._previewing||this._progress===0||this._cameraForcedForScreenshot)&&this._clear();const s=this._cameraForcedForScreenshot?this._sampleCount:Math.min(DOt,this._sampleCount-this._progress);for(let o=0;o<s;++o)this._accumulateShadow();this._cameraForcedForScreenshot=!1,this._requestRender()}render(e){this._accumulationRenderer.render(e)}setOptions(e){if(e.enabled!==void 0){const r=this._fbo!=null;e.enabled!==r&&(e.enabled?this._enable():this._disable())}e.previewing!==void 0&&(this._previewing=e.previewing),e.lightDirections!==void 0&&(this._lightDirections=e.lightDirections),this._accumulationRenderer.setOptions(e)}readAccumulatedShadow(e,r){return!this._isActive||!this._fbo||this._progress<1||e<0||e>=this._fbo.width||r<0||r>=this._fbo.height?0:(this._fbo.readPixels(e,r,1,1,Tt.RED,ks.UNSIGNED_BYTE,X0e),X0e[0]/this._progress)}_enable(){this._progress=0;const e=new ri;e.pixelFormat=Tt.RED,e.internalFormat=tt.R8,e.wrapMode=Jt.CLAMP_TO_EDGE,this._fbo=new bf(this._rctx,e),this._requestRender()}_disable(){this._fbo=gt(this._fbo),this._requestRender()}_invalidate(){this._progress=0,this._requestRenderIfEnabled()}_clear(){this._rctx.bindFramebuffer(this._fbo),this._rctx.setClearColor(0,0,0,0),this._rctx.clearSafe(Ci.COLOR_BUFFER_BIT),this._progress=0}_accumulateShadow(){this._renderToShadowMap(this._bindParameters,this._lightDirections[this._progress++],this._depthRange);const e=this._accumulationTechnique;this._rctx.bindFramebuffer(this._fbo),this._rctx.bindTechnique(e,this._bindParameters,this._passParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(e.primitiveType,0,k0(this._vao,"geometry"))}_updateCamera(e){const r=this._fbo;if(r==null)return;const i=this._bindParameters.camera;e.equals(i)||i.copyFrom(e),r.resize(e.fullWidth,e.fullHeight),this._opacityFromElevation=1-_$(IOt,LOt,e.relativeElevation)}_requestRenderIfEnabled(){this._fbo&&this._requestRender()}get test(){const e=this;return{lightDirections:this._lightDirections,get isDone(){return e._isDoneAccumulating},get isActive(){return e._isActive}}}};d([m()],Bl.prototype,"_progress",void 0),d([m()],Bl.prototype,"_sampleCount",void 0),d([m()],Bl.prototype,"_fbo",void 0),d([m()],Bl.prototype,"_depthRange",void 0),d([m()],Bl.prototype,"_previewing",void 0),d([m()],Bl.prototype,"_accumulationRenderer",void 0),d([m()],Bl.prototype,"_isRefining",null),d([m()],Bl.prototype,"_isActive",null),d([m()],Bl.prototype,"canAccumulate",null),d([m()],Bl.prototype,"_isDoneAccumulating",null),d([m()],Bl.prototype,"_opacityFromElevation",null),d([m()],Bl.prototype,"running",null),Bl=d([V("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],Bl);const DOt=6,Y0e="renderView",X0e=new Uint8Array(1),Z0e=gy();let NOt=class{constructor(){this._plane=gy()}get isEnabled(){return!kSe(this.plane,Z0e)}get plane(){return this._plane}set plane(e){$2(e||Z0e,this._plane)}};function FOt(t,e){const r=-t[0],i=-t[1],n=-t[2],s=e[3],o=e[7],a=e[11],l=e[15];e[0]+=s*r,e[1]+=s*i,e[2]+=s*n,e[4]+=o*r,e[5]+=o*i,e[6]+=o*n,e[8]+=a*r,e[9]+=a*i,e[10]+=a*n,e[12]+=l*r,e[13]+=l*i,e[14]+=l*n}function kOt(t,e){const r=t[0],i=t[1],n=t[2];e[12]+=r*e[0]+i*e[4]+n*e[8],e[13]+=r*e[1]+i*e[5]+n*e[9],e[14]+=r*e[2]+i*e[6]+n*e[10],e[14]+=r*e[3]+i*e[7]+n*e[11]}let zOt=class{constructor(e){this._factory=e,this._originData=new Map}acquire(e){return this.register(this._factory.getOrigin(e))}register(e){const r=this._originData.get(e.id)||new UOt(e);return r.refCount++,this._originData.has(r.origin.id)||this._originData.set(r.origin.id,r),r}release(e){e.refCount--,e.refCount===0&&this._originData.delete(e.origin.id)}updateViewMatrices(e){this._originData.forEach(r=>{Zn(r.viewMatrix,e),kOt(r.origin.vec3,r.viewMatrix)})}},UOt=class{constructor(e){this.origin=e,this.refCount=0,this.viewMatrix=xe()}},BOt=class extends $Ae{constructor(e,r){super(),this.distanceFalloffFactor=e,this.transparency=r,this.transformNormalViewFromGlobal=li()}},VOt=class extends IAe{constructor(){super(...arguments),this.transformNormalViewFromGlobal=li(),this.slicePlaneLocalOrigin=C(),this.transformNormalGlobalFromModel=li()}};function GOt(t){const e=T`bool isNaN( float val )
{
return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true;
}`;t.code.add(e)}const jOt=lr(.5,-4e-4);function HOt(t,e){const r=t.vertex;r.include(GOt),r.constants.add("depthBias","vec2",jOt),r.uniforms.add(new ti("inverseViewport",(i,n)=>n.inverseViewport)),e.legacy?(r.uniforms.add(new ln("proj",(i,n)=>n.camera.projectionMatrix)),r.code.add(T`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = proj * localView * vec4(globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)):(r.uniforms.add(new sh("transformNormalViewFromGlobal",i=>i.transformNormalViewFromGlobal),new ln("transformProjFromView",i=>i.transformProjFromView)),r.code.add(T`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = transformProjFromView * vec4(transformNormalViewFromGlobal * globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)),r.code.add(T`float _calculateProjectedBiasZ(vec4 projPos) {
float offsetZ = depthBias.y;
return sqrt(max(projPos.z,0.0)) * offsetZ;
}
vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {
vec2 offsetXY = calculateProjectedBiasXY(projPos, worldNormal);
if (!isNaN(offsetXY.x) && !isNaN(offsetXY.y)) {
projPos.xy += offsetXY;
}
projPos.z += _calculateProjectedBiasZ(projPos);
return projPos;
}`)}function WOt(t){const e=t.fragment;e.constants.add("coverageTestThreshold","float",.01),e.code.add(T`#define discardByCoverage(radius, coverage) { if (coverage < coverageTestThreshold) discard; }`)}function qOt(t,e){const r=t.vertex;e.silhouette?(r.code.add(T`bool isSilhouetteEdge(vec3 viewDir, vec3 normalA, vec3 normalB) {
float faceAVisible = dot(viewDir, normalA);
float faceBVisible = dot(viewDir, normalB);
return faceAVisible * faceBVisible < 0.0;
}`),e.legacy?r.code.add(T`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos, ComponentData data) {
vec3 viewNormalA = _modelToViewNormal(data.normal);
vec3 viewNormalB = _modelToViewNormal(data.normal2);
vec3 viewDir = -viewPos;
if (isSilhouetteEdge(viewDir, viewNormalA, viewNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`):r.code.add(T`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos, ComponentData data) {
vec3 worldNormalA = _modelToWorldNormal(data.normal);
vec3 worldNormalB = _modelToWorldNormal(data.normal2);
vec3 viewDir = -worldPos;
if (isSilhouetteEdge(viewDir, worldNormalA, worldNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`)):r.code.add(T`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos, ComponentData data) {
return false;
}`)}function YOt(t,e){const r=t.vertex;r.include(Td),t.include(K3,e),r.uniforms.add(new $e("distanceFalloffFactor",i=>i.distanceFalloffFactor)),r.code.add(T`float distanceBasedPerspectiveFactor(float distance) {
return clamp(sqrt(distanceFalloffFactor / distance), 0.0, 1.0);
}`),r.uniforms.add(new id("componentDataTex",i=>i.componentDataTexture)),t.attributes.add(R.COMPONENTINDEX,"float"),r.constants.add("componentColorFieldOffset","float",0),r.constants.add("componentOtherFieldOffset","float",1),r.constants.add("componentVerticalOffsetFieldOffset","float",2),r.constants.add("componentFieldCount","float",3),r.constants.add("lineWidthFractionFactor","float",8),r.constants.add("extensionLengthOffset","float",128),r.constants.add("verticalOffsetScale","float",2*Wne),r.code.add(T`
    vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
      float fieldIndex = componentFieldCount * componentIndex + fieldOffset;
      float texSize = float(textureSize(componentDataTex, 0).x);
      float colIndex = mod(fieldIndex, texSize);
      float rowIndex = floor(fieldIndex / texSize);

      return vec2(colIndex, rowIndex) + 0.5;
    }

    struct ComponentData {
      vec4 color;
      vec3 normal;
      vec3 normal2;
      float lineWidth;
      float extensionLength;
      float type;
      float verticalOffset;
    };

    ComponentData readComponentData() {
      vec2 colorIndex = _componentTextureCoords(componentIndex, componentColorFieldOffset);
      vec2 otherIndex = _componentTextureCoords(componentIndex, componentOtherFieldOffset);
      vec2 verticalOffsetIndex = _componentTextureCoords(componentIndex, componentVerticalOffsetFieldOffset);
      vec3 normal = normalModel();
      vec3 normal2 = ${e.silhouette?T`decompressNormal(normal2Compressed)`:T`normal`};

      vec4 colorValue = texelFetch(componentDataTex, ivec2(colorIndex), 0);
      vec4 otherValue = texelFetch(componentDataTex, ivec2(otherIndex), 0);
      float verticalOffset = (rgba2float(texelFetch(componentDataTex, ivec2(verticalOffsetIndex), 0)) - 0.5) * verticalOffsetScale;

      return ComponentData(
        vec4(colorValue.rgb, colorValue.a * otherValue.w), // otherValue.w stores separate opacity
        normal, normal2,
        otherValue.x * (255.0 / lineWidthFractionFactor),
        otherValue.y * 255.0 - extensionLengthOffset,
        -(otherValue.z * 255.0) + 0.5, // SOLID (=0/255) needs to be > 0.0, SKETCHY (=1/255) needs to be <= 0;
        verticalOffset
      );
    }
  `),e.legacy?r.code.add(T`vec3 _modelToWorldNormal(vec3 normal) {
return (model * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (localView * model * vec4(normal, 0.0)).xyz;
}`):(r.uniforms.add(new W6("transformNormalGlobalFromModel",i=>i.transformNormalGlobalFromModel)),r.code.add(T`vec3 _modelToWorldNormal(vec3 normal) {
return transformNormalGlobalFromModel * normal;
}`)),e.silhouette?(t.attributes.add(R.NORMAL2COMPRESSED,"vec2"),r.code.add(T`vec3 worldNormal(ComponentData data) {
return _modelToWorldNormal(normalize(data.normal + data.normal2));
}`)):r.code.add(T`vec3 worldNormal(ComponentData data) {
return _modelToWorldNormal(data.normal);
}`),e.legacy?r.code.add(T`void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
worldPos = (model * vec4(modelPos, 1.0)).xyz;
viewPos = (localView * vec4(worldPos, 1.0)).xyz;
}`):(r.include(cre,e),r.uniforms.add(new sh("transformViewFromCameraRelativeRS",i=>i.transformViewFromCameraRelativeRS),new W6("transformWorldFromModelRS",i=>i.transformWorldFromModelRS),new Xu("transformWorldFromModelTL",i=>i.transformWorldFromModelTL),new Xu("transformWorldFromModelTH",i=>i.transformWorldFromModelTH),new Ft("transformWorldFromViewTL",i=>i.transformWorldFromViewTL),new Ft("transformWorldFromViewTH",i=>i.transformWorldFromViewTH)),r.code.add(T`
      void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
        vec3 rotatedModelPosition = transformWorldFromModelRS * modelPos;

        vec3 transformCameraRelativeFromModel = dpAdd(
          transformWorldFromModelTL,
          transformWorldFromModelTH,
          -transformWorldFromViewTL,
          -transformWorldFromViewTH
        );

        worldPos = transformCameraRelativeFromModel + rotatedModelPosition;

        if (verticalOffset != 0.0) {
          vec3 vUp = ${e.spherical?T`normalize(transformWorldFromModelTL + rotatedModelPosition);`:T`vec3(0.0, 0.0, 1.0);`}
          worldPos += verticalOffset * vUp;
        }

        viewPos = transformViewFromCameraRelativeRS * worldPos;
      }
    `)),r.uniforms.add(new ln("transformProjFromView",(i,n)=>n.camera.projectionMatrix)),r.code.add(T`vec4 projFromViewPosition(vec3 position) {
return transformProjFromView * vec4(position, 1.0);
}`),r.code.add(T`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)}function XOt(t){return t.mode===Fs.SKETCH||t.mode===Fs.MIXED}var Fs,tx;(function(t){t[t.SOLID=0]="SOLID",t[t.SKETCH=1]="SKETCH",t[t.MIXED=2]="MIXED",t[t.COUNT=3]="COUNT"})(Fs||(Fs={})),function(t){t[t.REGULAR=0]="REGULAR",t[t.SILHOUETTE=1]="SILHOUETTE"}(tx||(tx={}));function ise(t,e){const r=t.vertex;switch(t.attributes.add(R.SIDENESS,"vec2"),e.mode===Fs.MIXED?r.code.add(T`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
float type;
};`):r.code.add(T`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
};`),e.mode){case Fs.MIXED:r.code.add(T`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float fType = component.type;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
if (fType <= 0.0) {
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
}
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);
}`);break;case Fs.SKETCH:r.code.add(T`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case Fs.SOLID:r.code.add(T`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case Fs.COUNT:break;default:e.mode}}function ZOt(t,e){const r=t.vertex;switch(t.include(ise,e),e.mode){case Fs.SOLID:r.code.add(T`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return 0.0;
}`);break;case Fs.SKETCH:r.uniforms.add(new Dx("strokesAmplitude",i=>i.strokesTexture.amplitude)),r.code.add(T`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return strokesAmplitude;
}`);break;case Fs.MIXED:r.uniforms.add(new Dx("strokesAmplitude",i=>i.strokesTexture.amplitude)),r.code.add(T`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
float type = unpackedAttributes.type;
if (type <= 0.0) {
return strokesAmplitude;
}
else {
return 0.0;
}
}`)}}function JOt(t,e){t.include(ise,e);const{vertex:r,fragment:i}=t;switch(XOt(e)&&(r.uniforms.add(new id("strokesTexture",n=>n.strokesTexture.texture)),r.uniforms.add(new Dx("strokesLog2Resolution",n=>Math.log2(n.strokesTexture.resolution)),new Dx("strokeVariants",n=>n.strokesTexture.variants)),t.varyings.add("vStrokeUV","vec2"),i.uniforms.add(new id("strokesTexture",n=>n.strokesTexture.texture),new Dx("strokesNormalizationScale",n=>n.strokesTexture.normalizationScale)),r.code.add(T`void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {
vec2 sidenessNorm = unpackedAttributes.sidenessNorm;
float lineIndex = clamp(ceil(log2(lineLength)), 0.0, strokesLog2Resolution);
vStrokeUV = vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * strokeVariants + variantStroke + 0.5) / vec2(textureSize(strokesTexture, 0));
vStrokeUV.x += variantOffset;
}`),t.fragment.include(Td),i.code.add(T`float calculateLineOffsetSketch() {
float offsetNorm = rgba2float(texture(strokesTexture, vStrokeUV));
return (offsetNorm - 0.5) * strokesNormalizationScale;
}
float calculateLinePressureSketch() {
return rgba2float(texture(strokesTexture, vStrokeUV + vec2(0.0, 0.5)));
}`)),e.mode){case Fs.SOLID:r.code.add(T`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes) {}`),i.code.add(T`float calculateLineOffset() {
return 0.0;
}
float calculateLinePressure() {
return 1.0;
}`);break;case Fs.SKETCH:r.code.add(T`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}`),i.code.add(T`float calculateLineOffset() {
return calculateLineOffsetSketch();
}
float calculateLinePressure() {
return calculateLinePressureSketch();
}`);break;case Fs.MIXED:t.varyings.add("vType","float"),r.code.add(T`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
vType = unpackedAttributes.type;
if (unpackedAttributes.type <= 0.0) {
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}
}`),i.code.add(T`float calculateLineOffset() {
if (vType <= 0.0) {
return calculateLineOffsetSketch();
}
else {
return 0.0;
}
}
float calculateLinePressure() {
if (vType <= 0.0) {
return calculateLinePressureSketch();
}
else {
return 1.0;
}
}`)}}function H5e(t){const e=new Or,{vertex:r,fragment:i}=e;return t.legacy&&r.uniforms.add(new J0e("model"),new J0e("localView")),e.include(HOt,t),e.include(YOt,t),e.include(ZOt,t),e.include(ise,t),e.include(JOt,t),e.include(Fn,t),e.include(qOt,t),e.include(WOt,t),e.include(iu,t),e.varyings.add("vColor","vec4"),e.varyings.add("vRadius","float"),e.varyings.add("vPosition","vec3"),e.varyings.add("vWorldPosition","vec3"),t.multipassEnabled&&e.varyings.add("vViewPos","vec3"),e.varyings.add("vLineLengthPixels","float"),e.varyings.add("vSizeFalloffFactor","float"),r.uniforms.add(new ti("pixelToNDC",(n,s)=>cr(QOt,2/s.camera.fullViewport[2],2/s.camera.fullViewport[3])),new xr("viewport",(n,s)=>s.camera.fullViewport),new $e("pixelRatio",(n,s)=>s.camera.pixelRatio)),e.attributes.add(R.POSITION0,"vec3"),e.attributes.add(R.POSITION1,"vec3"),e.attributes.add(R.VARIANTOFFSET,"float"),e.attributes.add(R.VARIANTSTROKE,"float"),e.attributes.add(R.VARIANTEXTENSION,"float"),r.code.add(T`
    const float opaqueCutoff = 1.0 / 255.0;

    void calculateGeometricOutputs(vec3 viewPosV0, vec3 viewPosV1, vec3 worldPosV0, vec3 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {
      vec2 sideness = unpackedAttributes.sideness;
      vec2 sidenessNorm = unpackedAttributes.sidenessNorm;

      vWorldPosition = mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;

      vec3 viewPos = mix(viewPosV0, viewPosV1, sidenessNorm.y);
      ${t.multipassEnabled?"vViewPos = viewPos;":""}

      vec4 projPosV0 = projFromViewPosition(viewPosV0);
      vec4 projPosV1 = projFromViewPosition(viewPosV1);
      vec4 projPos = projFromViewPosition(viewPos);

      vec3 screenSpaceLineNDC = (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);
      vec2 ndcToPixel = viewport.zw * 0.5;
      vec2 screenSpaceLinePixels = screenSpaceLineNDC.xy * ndcToPixel;
      float lineLengthPixels = length(screenSpaceLinePixels);

      float dzPerPixel = screenSpaceLineNDC.z / lineLengthPixels;
      vec2 screenSpaceDirection = screenSpaceLinePixels / lineLengthPixels;
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;

      float falloffFactor = distanceBasedPerspectiveFactor(-viewPos.z) * pixelRatio;
      float lineWidthPixels = unpackedAttributes.lineWidthPixels * falloffFactor;

      float extensionLengthPixels = calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;
      float lineAmplitudePixels = calculateLineAmplitude(unpackedAttributes) * pixelRatio;

      vSizeFalloffFactor = falloffFactor;

      float lineWidthAndAmplitudePixels = lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;
      float extendedLineLengthPixels = lineLengthPixels + extensionLengthPixels + extensionLengthPixels;

      const float aaPaddingPixels = 1.0;

      // Line size with padding
      float halfAAPaddedLineWidthAndAmplitudePixels = lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;
      float aaPaddedRoundedCapSizePixels = lineWidthPixels * 0.5 + aaPaddingPixels;

      // Half line width in NDC including padding for anti aliasing
      vec2 halfAAPaddedLineWidthAndAmplitudeNDC = halfAAPaddedLineWidthAndAmplitudePixels * pixelToNDC;
      vec2 aaPaddedRoundedCapSizeNDC = aaPaddedRoundedCapSizePixels * pixelToNDC;
      vec2 extensionLengthNDC = extensionLengthPixels * pixelToNDC;

      // Compute screen space position of vertex, offsetting for line size and end caps
      vec2 ndcOffset = (
          screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)
        + perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC
      );

      projPos.xy += ndcOffset * projPos.w;
      projPos.z += (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;

      projPos = adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));

      // Line length with end caps
      float aaPaddedLineWithCapsLengthPixels = extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;

      float pixelPositionAlongLine = aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;

      // Position in pixels with origin at first vertex of line segment
      vPosition = vec3(
        halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,
        pixelPositionAlongLine,
        pixelPositionAlongLine / extendedLineLengthPixels
      );

      // The line width radius in pixels
      vRadius = lineWidthPixels * 0.5;
      vLineLengthPixels = extendedLineLengthPixels;

      // discard short edges below a certain length threshold
      ${t.mode===Fs.SKETCH?T`
        if (lineLengthPixels <= 3.0) {
          gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
          return;
        }`:t.mode===Fs.MIXED?T`
        if (lineLengthPixels <= 3.0 && unpackedAttributes.type <= 0.0) {
           gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
           return;
        }`:""}
      gl_Position = projPos;
    }

    void main() {
      ComponentData component = readComponentData();
      UnpackedAttributes unpackedAttributes = unpackAttributes(component);

      vec3 worldPosV0, worldPosV1, viewPosV0, viewPosV1;
      worldAndViewFromModelPosition(position0, component.verticalOffset, worldPosV0, viewPosV0);
      worldAndViewFromModelPosition(position1, component.verticalOffset, worldPosV1, viewPosV1);

      // Component color
      vColor = component.color;

      // Discard fully transparent edges
      if (vColor.a < opaqueCutoff) {
        gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
        return;
      }

      if (discardNonSilhouetteEdges(viewPosV0, worldPosV0, component)) {
        return;
      }

      // General geometric computation for all types of edges
      calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal(component), unpackedAttributes);

      // Specific computation for different edge styles
      calculateStyleOutputs(unpackedAttributes);
    }
  `),i.code.add(T`
    vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {
      float positionX = position.x - calculateLineOffset();

      if (radius < 1.0) {
        float coverageX = clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);
        float coverageY = clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);
        return vec2(0.5 - min(coverageX, coverageY), 0.0);
      }
      else {
        // Between -radius -> 0 for start cap, 0 for line, 0 -> radius
        float positionOnCap = position.y - clamp(position.y, 0.0, lineLength);

        vec2 lineToPosition = vec2(positionX, positionOnCap);
        return vec2(length(lineToPosition) - radius, positionOnCap / radius);
      }
    }

    void main() {
      ${t.multipassEnabled?"terrainDepthTest(vViewPos.z);":""}
      float radius = vRadius * calculateLinePressure();

      vec2 distance = lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);
      float coverage = clamp(0.5 - distance.x, 0.0, 1.0);

      discardByCoverage(radius, coverage);
      discardBySlice(vWorldPosition);

      fragColor = vec4(vColor.rgb, vColor.a * coverage);
    }
  `),e}const QOt=He();let J0e=class extends vn{constructor(e){super(e,"mat4")}};const KOt=Object.freeze(Object.defineProperty({__proto__:null,build:H5e},Symbol.toStringTag,{value:"Module"}));let W5e=class q5e extends Vr{initializeProgram(e){return new Lr(e.rctx,q5e.shader.get().build(this.configuration),t5e)}initializePipeline(e){return kt({blending:Wo(Se.ONE,Se.ONE,Se.ZERO,Se.ONE,ug.ADD,e.rctx.gl.MAX),depthTest:{func:Xr.LEQUAL},colorWrite:Yt})}};W5e.shader=new Ir(KOt,()=>ge(()=>Promise.resolve().then(()=>v4t),void 0));let lp=class extends vl{constructor(){super(...arguments),this.mode=Fs.SOLID,this.hasSlicePlane=!1,this.silhouette=!1,this.legacy=!1,this.doublePrecisionRequiresObfuscation=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.spherical=!1}};d([j({count:Fs.COUNT})],lp.prototype,"mode",void 0),d([j()],lp.prototype,"hasSlicePlane",void 0),d([j()],lp.prototype,"silhouette",void 0),d([j()],lp.prototype,"legacy",void 0),d([j()],lp.prototype,"doublePrecisionRequiresObfuscation",void 0),d([j()],lp.prototype,"multipassEnabled",void 0),d([j()],lp.prototype,"cullAboveGround",void 0),d([j()],lp.prototype,"spherical",void 0),d([j({constValue:!1})],lp.prototype,"occlusionPass",void 0),d([j({constValue:$r.Compressed})],lp.prototype,"normalType",void 0);const eRt=8,Ej=128,tRt={type:"uber",hasSlicePlane:!1,strokesTexture:null,legacy:!0,spherical:!0},rRt={solid:Fs.SOLID,sketch:Fs.SKETCH,uber:Fs.MIXED};let Pj=class Y5e{constructor(e,r,i){this._rctx=e,this._shaderTechniqueRepository=r,this._configuration=new lp,this.refCount=0,this._renderables=new Set,this._sortedRenderables={[Xt.TRANSPARENT]:{[Xt.TRANSPARENT]:new Vt,[Xt.OPAQUE]:new Vt},[Xt.OPAQUE]:{[Xt.TRANSPARENT]:new Vt,[Xt.OPAQUE]:new Vt}},this._renderablesDirty=!1,this._drawParameters=new VOt,this._settings={...tRt,...i},this.key=Y5e.getKey(this._settings.type,this._settings.hasSlicePlane,this._settings.legacy);const n=this._settings.strokesTexture.variants;this.writerSettings={variants:n,reducedPrecision:yi.TESTS_DISABLE_OPTIMIZATIONS},this._configuration.legacy=this._settings.legacy,this._configuration.mode=rRt[this._settings.type],this._configuration.silhouette=!1,this._configuration.hasSlicePlane=this._settings.hasSlicePlane,this._configuration.doublePrecisionRequiresObfuscation=e.driverTest.doublePrecisionRequiresObfuscation.result,this._configuration.spherical=i.spherical}dispose(){this._technique=tr(this._technique)}addRenderable(e){this._renderables.add(e),this._renderablesDirty=!0}removeRenderable(e){this._renderables.delete(e),this._renderablesDirty=!0}setRenderablesDirty(){this._renderablesDirty=!0}forEachRenderable(e,r){this._renderablesDirty&&this._sortRenderables();const i=this._sortedRenderables[r];i[Xt.TRANSPARENT].forAll(e),i[Xt.OPAQUE].forAll(e)}updateTechnique(e,r){return this._configuration.multipassEnabled=!!e.multipassEnabled,this._configuration.cullAboveGround=!!e.multipassTerrain.cullAboveGround,this._configuration.silhouette=r,this._technique=this._shaderTechniqueRepository.releaseAndAcquire(W5e,this._configuration,this._technique),this._technique}bindRegularEdges(e,r){return this._lastOriginId=null,this._rctx.bindTechnique(this.updateTechnique(r,!1),r,e)}bindSilhouetteEdges(e,r){return this._lastOriginId=null,this._rctx.bindTechnique(this.updateTechnique(r,!0),r,e)}renderRegularEdges(e,r,i,n,s){this._render(e,r,r.regular.vao,i,n,s)}renderSilhouetteEdges(e,r,i,n,s){this._render(e,r,r.silhouette.vao,i,n,s)}_render(e,r,i,n,s,o){o>0&&(this._bindDraw(e,r,n,s),this._rctx.bindVAO(i),this._rctx.drawArraysInstanced(sr.TRIANGLE_FAN,0,4,o))}_bindDraw(e,r,i,n){if(this._drawParameters.componentDataTexture=r.components.buffer.textureBuffer.texture,this._drawParameters.strokesTexture=this._settings.strokesTexture,"origin"in r.transform)this._lastOriginId!==r.transform.origin.origin.id&&(e.setUniformMatrix4fv("localView",r.transform.origin.viewMatrix),this._lastOriginId=r.transform.origin.origin.id),e.setUniformMatrix4fv("model",r.transform.modelMatrix),this._drawParameters.slicePlaneLocalOrigin=r.transform.origin.origin.vec3;else{const s=new sB(r.transform.position),o=gd(Q0e,L2(Q0e,r.transform.rotationScale));this._drawParameters.transformWorldFromModelTL=s.low,this._drawParameters.transformWorldFromModelTH=s.high,this._drawParameters.transformWorldFromModelRS=r.transform.rotationScale,this._drawParameters.transformNormalGlobalFromModel=o;const a=n.camera.viewInverseTransposeMatrix;ie(this._drawParameters.slicePlaneLocalOrigin,a[3],a[7],a[11])}e.bindDraw(this._drawParameters,n,i)}_sortRenderables(){this._renderablesDirty=!1,this._sortedRenderables[Xt.TRANSPARENT][Xt.TRANSPARENT].clear(),this._sortedRenderables[Xt.TRANSPARENT][Xt.OPAQUE].clear(),this._sortedRenderables[Xt.OPAQUE][Xt.TRANSPARENT].clear(),this._sortedRenderables[Xt.OPAQUE][Xt.OPAQUE].clear(),this._renderables.forEach(r=>{r.objectTransparency!==Xt.INVISIBLE&&r.edgeTransparency!==Xt.INVISIBLE&&this._sortedRenderables[r.objectTransparency][r.edgeTransparency].push(r)});const e=(r,i)=>"origin"in r.transform?"origin"in i.transform?r.transform.origin.origin.id<i.transform.origin.origin.id?-1:r.transform.origin.origin.id>i.transform.origin.origin.id?1:0:1:0;this._sortedRenderables[Xt.TRANSPARENT][Xt.TRANSPARENT].sort(e),this._sortedRenderables[Xt.TRANSPARENT][Xt.OPAQUE].sort(e),this._sortedRenderables[Xt.OPAQUE][Xt.TRANSPARENT].sort(e),this._sortedRenderables[Xt.OPAQUE][Xt.OPAQUE].sort(e)}static getKey(e,r,i){return`edges-t:${e}:${r}:${i}`}};const Q0e=Jm();function eQt(t,e){return e.push(t.buffer),{buffer:t.buffer,layout:new lst(t.layout)}}function M4(t){return new XAe(t.layout).createView(t.buffer)}let iRt=class extends GNe{constructor(e){super("EdgeProcessingWorker","extract",{extract:r=>[r.dataBuffer],extractComponentsEdgeLocations:r=>[r.dataBuffer],extractEdgeLocations:r=>[r.dataBuffer]},e)}async process(e,r,i){if(i)return _Mt(e);const n=await this.invoke(new Aj(e),r);return this._unpackOutput(n)}async extractEdgeLocations(e,r){const i=await this.invokeMethod("extractEdgeLocations",new Aj(e),r);return M4(i)}async extractComponentsEdgeLocations(e,r){const i=await this.invokeMethod("extractComponentsEdgeLocations",new Aj(e),r);return M4(i)}_unpackOutput(e){return{regular:{instancesData:M4(e.regular.instancesData),lodInfo:{lengths:new Float32Array(e.regular.lodInfo.lengths)}},silhouette:{instancesData:M4(e.silhouette.instancesData),lodInfo:{lengths:new Float32Array(e.silhouette.lodInfo.lengths)}},averageEdgeLength:e.averageEdgeLength}}},Aj=class{constructor(e){this.dataBuffer=e.data.buffer,this.writerSettings=e.writerSettings,this.skipDeduplicate=e.skipDeduplicate,this.indices=cd(e.indices)?e.indices:e.indices.buffer,this.indicesType=cd(e.indices)?"Array":Mz(e.indices)?"Uint32Array":"Uint16Array",this.indicesLength=e.indicesLength}};function nRt(t){const r=xA.resolution,i=r/2,n=new Uint8Array(4*r*r),s=4*r*i,o=xA.amplitude,a=2*o,l=4*r,c=Math.log2(r)+1,u=xA.strokes.length;let h=(c-1)*u*l;for(const{distance:f,pressure:g}of xA.strokes){let _=f,v=g,b=h;for(let w=0;w<c;w++){w!==0&&(_=K0e(_,uI.DISTANCE),v=K0e(v,uI.PRESSURE));for(let x=0;x<xA.resolution;x++){const S=.5+(_?_[x%_.length]/a:0),E=v?v[x%v.length]:1;Z$(S,n,b),Z$(E,n,b+s),b+=4}b-=l*(u+1)}h+=l}const p=new Sr(t,new ri(r),n);return new oRt(r,a,o,u,p)}function K0e(t,e){if(!t)return null;const r=t.length/2,i=sRt*r,n=new Array(r);let s=0;const o=e===uI.PRESSURE;for(let a=0;a<t.length;a+=2){const l=(t[a]+t[a+1])/2;n[s++]=o?Math.min(i,1-(1-l)*eye):Math.min(i,l*eye)}return n}var uI;(function(t){t[t.DISTANCE=0]="DISTANCE",t[t.PRESSURE=1]="PRESSURE"})(uI||(uI={}));const sRt=.1,eye=.5;let oRt=class{constructor(e,r,i,n,s){this.resolution=e,this.normalizationScale=r,this.amplitude=i,this.variants=n,this.texture=s}dispose(){this.texture=gt(this.texture)}};const xA={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-76e-5,27e-5,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]};function tye(t){let e=null;for(const r of t){const i=r.type;if(aRt(r)){if(e==null)e=i;else if(e!==i)return"uber"}}return e??"uber"}function rye(t){let e=Xt.INVISIBLE;for(const{material:r}of t)if(X5e(r)){if(r.color[3]*r.opacity<1)return Xt.TRANSPARENT;e=Xt.OPAQUE}return e}function iye(t){let e=Xt.INVISIBLE;for(const{material:r}of t)if(X5e(r)){switch(r.objectTransparency){case Xt.TRANSPARENT:case Xt.INVISIBLE:return Xt.TRANSPARENT;case Xt.OPAQUE:if(r.opacity<1)return Xt.TRANSPARENT}e=Xt.OPAQUE}return e}function X5e(t){return t.size*t.color[3]*t.opacity>0}function aRt(t){return t.size*t.color[3]>0}function nye(t,e,r,i){for(let n=0;n<t.length;n++){const s=t[n].index,o=e[n],a=e[n+1];if(i)for(let l=o;l<a;l++){const c=i[l];r.set(c,s)}else for(let l=o;l<a;l++)r.set(l,s)}}let cp=class extends Ae{constructor(t){super(t),this._updatingHandles=new Jp,this._perObjectData=new Map,this._perObjectDataEvictionCache=new Set,this._renderers=new Map,this._gpuMemoryUsage=0,this._workerAbort=new AbortController,this._tmpModelPosition=C(),this._localOrigins=new zOt(new Lie(t.renderSR))}initialize(){this._worker=new iRt(this.schedule),this._componentColorManager=new n5e(this.rctx,3);const t=e5e.createBuffer(4);for(let e=0;e<4;e++)t.sideness.set(e,0,e===0||e===3?0:1),t.sideness.set(e,1,e===0||e===1?0:1);this._verticesBufferObject=Wr.createVertex(this.rctx,Ar.STATIC_DRAW,t.buffer)}destroy(){this.destroyed||(this._perObjectData.forEach(t=>this._discardObjectEntry(t)),this._perObjectData.clear(),this._strokesTexture=gt(this._strokesTexture),this._componentColorManager=Pe(this._componentColorManager),this._workerAbort.abort(),this._worker.destroy(),this._verticesBufferObject=gt(this._verticesBufferObject),this._renderers.clear(),this._updatingHandles.destroy(),this._set("schedule",dRt))}get updating(){return this._updatingHandles.updating}get usedMemory(){return this._gpuMemoryUsage}shouldRender(){return this._renderers.size>0}async addComponentObject(t,e,r,i,n,s){if(this.hasObject(t))return this.getObjectMemoryUsage(t);let o;const a=new oye(new Promise(c=>o=c),t.obb.center,t.obb.radius);this._perObjectData.set(t,a);const l=await this._updatingHandles.addPromise(this._addComponentGeometry(t.transform,a,e,r,i,n,s));return this.setNeedsRender(),o(),l}async addOrUpdateObject3D(t,e,r,i){if(this.destroyed)return void re.getLogger(this).warn("Attempt to add an object to a destroyed instance");const n=this._perObjectData.get(t);let s;(n==null?void 0:n.renderables.length)>0&&this._perObjectDataEvictionCache.add(n);const o=t.boundingVolumeWorldSpace.bounds,a=new oye(new Promise(c=>s=c),o,N0(o));this._perObjectData.set(t,a);const l=new Array;if(r.mergeGeometries&&t.geometries.length>1&&lRt(t))l.push(this._addObjectMergedGeometries(t,a,e,r,i));else for(let c=0;c<t.geometries.length;c++){const u=t.geometries[c];u.material.supportsEdges&&l.push(this._addGeometry(t,a,u,e[0],r,i))}await this._updatingHandles.addPromise(Promise.all(l)),this._perObjectDataEvictionCache.delete(a),this._discardObjectEntry(n),this.setNeedsRender(),s()}fastUpdateObject3DEdgesTransform(t){if(this.destroyed)return!1;const e=this._perObjectData.get(t);if(!e)return!1;const{geometries:r}=t,{renderables:i}=e;if(r.length===0||i.length===0)return!0;if(i.length>1)return!1;const[n]=i,s=n.transform;if(!(s instanceof Mj))return!1;const[o]=r;if(o.localOrigin!==s.origin.origin)return!1;const a=xe(),l=this._computeModelTransformWithLocalOrigin(t,o,a);return n.transform=new Mj(a,l),this.setNeedsRender(),!0}_discardObjectEntry(t){t&&(t.renderables.length&&(t.renderables.forEach(e=>this._removeRenderable(e)),this.setNeedsRender()),t.loaded=null)}hasObject(t){return this._perObjectData.has(t)}async updateAllComponentOpacities(t,e){const r=await this._updatingHandles.addPromise(this._getObjectEntry(t));if(r==null)return;const i=e instanceof Array?n=>e[n]:()=>e;r.renderables.forEach(n=>{const s=n.components.meta.length;for(let o=0;o<s;o++){const a=i(o),l=n.components.meta[o],c=l.index;l.material.opacity=a,n.components.buffer.textureBuffer.setDataElement(c,1,3,255*a)}this._updateTransparency(n)}),this.setNeedsRender()}async getObjectMemoryUsage(t){const e=await this._getObjectEntry(t);return e!=null?e.renderables.reduce((r,i)=>r+i.statistics.gpuMemoryUsage,0):0}async updateAllComponentMaterials(t,e,r,i){const n=t instanceof Ey,s=!!r.hasSlicePlane,o=tye(e),a=Pj.getKey(o,s,n),l=await this._updatingHandles.addPromise(this._getObjectEntry(t));l!=null&&(l.renderables.forEach(c=>{if(a!==c.rendererKey){const u=this._renderers.get(c.rendererKey),h=this._acquireRenderer(o,s,n);u.removeRenderable(c),--u.refCount,c.rendererKey=a,h.addRenderable(c)}for(let u=0;u<e.length;u++)c.components.meta[u].material=e[u];i&&this._updateComponentBuffer(c.components),this._updateTransparency(c)}),this.setNeedsRender())}async updateAllVerticalOffsets(t,e){const r=await this._updatingHandles.addPromise(this._getObjectEntry(t));r!=null&&(r.renderables.forEach(i=>{const n=i.components.meta;for(let s=0;s<n.length;s++)i.components.meta[s].verticalOffset=(e==null?void 0:e[s])??0;this._updateComponentBuffer(i.components)}),this.setNeedsRender())}async updateObjectVisibility(t,e){const r=await this._updatingHandles.addPromise(this._getObjectEntry(t));r!=null&&(r.renderables.forEach(i=>i.visible=e),this.setNeedsRender())}removeObject(t){const e=this._perObjectData.get(t);e&&(this._perObjectData.delete(t),this._discardObjectEntry(e))}async _getObjectEntry(t){const e=this._perObjectData.get(t);if(!e)throw new Error("no object");return await e.loaded,e.loaded==null?null:e}render(t,e){if(this._componentColorManager==null)return;this._localOrigins.updateViewMatrices(t.camera.viewMatrix);const r=t.camera.viewInverseTransposeMatrix,i=C(),n=new sB;let s=0,o=0;if(this._renderers.forEach(l=>{if(l.refCount===0)return this._renderers.delete(l.key),void l.dispose();let c=!0,u=!0;l.forEachRenderable(h=>{h.visible&&(s+=h.statistics.averageEdgeLength,o++,c&&h.regular&&(l.updateTechnique(t,!1),c=!1),u&&h.silhouette&&(l.updateTechnique(t,!0),u=!1))},e)}),this._componentColorManager.garbageCollect(),this._componentColorManager.updateTextures(),o===0)return;const a=new BOt(40*s/o,e);ie(i,r[3],r[7],r[11]),n.set(i),ce(a.transformWorldFromViewTH,n.high),ce(a.transformWorldFromViewTL,n.low),th(a.transformViewFromCameraRelativeRS,t.camera.viewMatrix),gd(uye,a.transformViewFromCameraRelativeRS),L2(a.transformNormalViewFromGlobal,uye),a.transformProjFromView=t.camera.projectionMatrix,this._updateObjectCameraDistances(t),this._renderers.forEach(l=>{this._renderRegularEdges(l,t,a),this._renderSilhouetteEdges(l,t,a)})}_updateTransparency(t){const e=rye(t.components.meta),r=iye(t.components.meta);e===t.edgeTransparency&&r===t.objectTransparency||(t.edgeTransparency=e,t.objectTransparency=r,this._renderers.get(t.rendererKey).setRenderablesDirty())}_computeModelTransformWithLocalOrigin(t,e,r){t.getCombinedShaderTransformation(e,r);const i=e.localOrigin!=null?this._localOrigins.register(e.localOrigin):this._localOrigins.acquire(ie(this._tmpModelPosition,r[12],r[13],r[14]));return e.localOrigin=i.origin,FOt(i.origin.vec3,r),i}_updateComponentBuffer(t){const{meta:e,buffer:r}=t,i=new Uint8Array(4);for(let n=0;n<e.length;n++){const s=e[n].material,o=e[n].index,a=we(Math.round(s.size*eRt),0,255),l=we(s.extensionLength,-Ej,255-Ej)+Ej,c=s.type==="solid"?K8.SOLID:K8.SKETCH,u=255*s.opacity,h=s.color,p=255*h[0],f=255*h[1],g=255*h[2],_=255*h[3];r.textureBuffer.setData(o,0,p,f,g,_),r.textureBuffer.setData(o,1,a,l,c,u),X4e(e[n].verticalOffset,i),r.textureBuffer.setData(o,2,i[0],i[1],i[2],i[3])}}_createComponentBuffers(t){if(this._componentColorManager==null)return null;const e=new Array,r=this._componentColorManager.getBuffer(t.length);for(let n=0;n<t.length;n++){const s=t[n],o=r.acquireIndex();e.push({index:o,verticalOffset:0,material:s})}const i=new cRt(r,e);return this._updateComponentBuffer(i),i}_extractEdges(t,e,r,i,n,s=n.length){return this._worker.process({data:e,indices:n,indicesLength:s,writerSettings:t,skipDeduplicate:r},this._workerAbort.signal,i)}_createRenderable(t,e,r,i,n){const s=c=>this._verticesBufferObject!=null?new uRt(new _f(this.rctx,t5e,{vertices:aMt,instances:c===tx.REGULAR?J8.glLayout:Q8.glLayout},{vertices:this._verticesBufferObject,instances:Wr.createVertex(this.rctx,Ar.STATIC_DRAW,c===tx.REGULAR?t.regular.instancesData.buffer:t.silhouette.instancesData.buffer)}),c===tx.REGULAR?t.regular.lodInfo:t.silhouette.lodInfo):null,o=t.regular.lodInfo.lengths.length>0?s(tx.REGULAR):null,a=t.silhouette.lodInfo.lengths.length>0?s(tx.SILHOUETTE):null,l=((o==null?void 0:o.vao.usedMemory)??0)+((a==null?void 0:a.vao.usedMemory)??0);return new hRt(o,a,{gpuMemoryUsage:l,externalMemoryUsage:n,averageEdgeLength:t.averageEdgeLength},r,rye(e.meta),iye(e.meta),e,i)}async _addGeometry(t,e,r,i,n,s){if(r.edgeIndicesLength<=0)return;const o=r.attributes.get(R.POSITION),a=xe(),l=this._computeModelTransformWithLocalOrigin(t,r,a),c=new cye(o,a,l);return this._addPositionData(e,c,r.edgeIndicesLength,i,n,s)}async _addPositionData(t,e,r,i,n,s=!1){if(t.loaded==null)return;const o=this._createComponentBuffers([i]);if(o==null)return;const a=this._acquireRenderer(i.type,!!n.hasSlicePlane,!0),{modelTransform:l,origin:c}=e,u=e.position.indices,h=e.position,p=h.data.length/h.size,f=X8.createBuffer(p);for(let v=0;v<p;v++)f.position.set(v,0,h.data[v*h.size]),f.position.set(v,1,h.data[v*h.size+1]),f.position.set(v,2,h.data[v*h.size+2]);nye(o.meta,[0,f.componentIndex.count],f.componentIndex);const g=await this._updatingHandles.addPromise(this._extractEdges(a.writerSettings,f,!1,s,u,r));if(t.loaded==null)return;const _=this._createRenderable(g,o,new Mj(l,c),a.key,!1);t.renderables.push(_),a.addRenderable(_),this._gpuMemoryUsage+=_.statistics.gpuMemoryUsage}async _addComponentGeometry(t,e,r,i,n,s,o){if(e.loaded==null)return 0;const a=this._createComponentBuffers(s);if(a==null)return 0;const l=tye(s),c=this._acquireRenderer(l,o.hasSlicePlane||!1,!1),u=X8.createBuffer(r.length/3);pL(u.position.typedBuffer,r,u.position.typedBufferStride,3),nye(a.meta,n,u.componentIndex,i);const h=!0,p=c.writerSettings,f=await this._updatingHandles.addPromise(this._extractEdges(p,u,h,!1,i));if(e.loaded==null)return 0;const g=this._createRenderable(f,a,t,c.key,!0);return e.renderables.push(g),c.addRenderable(g),g.statistics.gpuMemoryUsage}async _addObjectMergedGeometries(t,e,r,i,n){const s=new Map;let o=0,a=null,l=0;const c=t.geometries.filter(w=>{if(w.edgeIndicesLength<=0||!w.material.supportsEdges)return!1;!a&&w.localOrigin&&(a=w);const x=w.attributes.get(R.POSITION);return l+=x.data.length/x.size,o+=w.edgeIndicesLength,!0});if(c.length===0)return;const u=l>=65536?Uint32Array:Uint16Array,h=o?new u(o):null,p=[];let f=0;c.forEach(w=>{const x=w.attributes.get(R.POSITION),S=x.indices;let E=s.get(x.data);if(E==null){E=p.length/3;for(let A=0;A<x.data.length;A+=x.size)p.push(x.data[A]),p.push(x.data[A+1]),p.push(x.data[A+2]);s.set(x.data,E)}for(let A=0;A<w.edgeIndicesLength;A++)h[f++]=E+S[A]});const g=a||t.geometries[0],_=xe(),v=this._computeModelTransformWithLocalOrigin(t,g,_);for(let w=0;w<t.geometries.length;w++)t.geometries[w].localOrigin=v.origin;const b=new cye(new Ye(p,h,3),_,v);await this._updatingHandles.addPromise(this._addPositionData(e,b,h.length,r[0],i,n))}_acquireRenderer(t,e,r){const i=Pj.getKey(t,e,r);let n=this._renderers.get(i);return this._strokesTexture==null&&(this._strokesTexture=nRt(this.rctx)),n||(n=new Pj(this.rctx,this.techniqueRepository,{type:t,hasSlicePlane:e,strokesTexture:this._strokesTexture,legacy:r,spherical:this.viewingMode===De.Global}),this._renderers.set(i,n)),++n.refCount,n}_removeRenderable(t){sye(t.regular),sye(t.silhouette);const e=this._renderers.get(t.rendererKey);if(e){e.removeRenderable(t),--e.refCount,"origin"in t.transform&&this._localOrigins.release(t.transform.origin),this._gpuMemoryUsage-=t.statistics.externalMemoryUsage?0:t.statistics.gpuMemoryUsage;for(const r of t.components.meta)t.components.buffer.releaseIndex(r.index)}}_updateObjectCameraDistances(t){const e=t.camera.eye,r=t.camera.viewForward,i=C(),n=s=>{Yi(i,s.center,e);const o=de(i,r),a=s.radius,l=o<-a?1/0:o<a?0:o-a;s.renderables.forEach(c=>c.distanceToCamera=l)};this._perObjectData.forEach(n),this._perObjectDataEvictionCache.forEach(n)}_renderRegularEdges(t,e,r){const i=t.bindRegularEdges(r,e),n=r.transparency,s=e.camera.perScreenPixelRatio;t.forEachRenderable(o=>{if(!aye(o)||!o.visible)return;const a=O4(o.regular.lod.lengths,o.distanceToCamera,s);t.renderRegularEdges(i,o,r,e,a)},n)}_renderSilhouetteEdges(t,e,r){const i=t.bindSilhouetteEdges(r,e),n=r.transparency,s=e.camera.perScreenPixelRatio;t.forEachRenderable(o=>{if(!lye(o)||!o.visible)return;const a=O4(o.silhouette.lod.lengths,o.distanceToCamera,s);t.renderSilhouetteEdges(i,o,r,e,a)},n)}get test(){return{hasRenderedPrimitives:t=>{let e=!1;const r=t.perScreenPixelRatio,i=(n,s)=>n.forEachRenderable(o=>{o.visible&&!e&&(aye(o)&&(e=O4(o.regular.lod.lengths,o.distanceToCamera,r)>0),!e&&lye(o)&&(e=O4(o.silhouette.lod.lengths,o.distanceToCamera,r)>0))},s);return this._renderers.forEach(n=>{e||(i(n,Xt.OPAQUE),i(n,Xt.TRANSPARENT))}),e},getObjectData:t=>this._perObjectData.get(t)}}};function sye(t){t!=null&&(t.vao.vertexBuffers.instances.dispose(),t.vao.disposeVAOOnly(),t.vao=null)}function lRt(t){let e=null,r=null;for(let i=0;i<t.geometries.length;i++){const n=t.geometries[i];if(n.material.supportsEdges){if(e){if(!tg(e,n.transformation))return!1}else e=n.transformation;if(r||n.localOrigin==null){if((r==null?void 0:r.localOrigin)!=null&&n.localOrigin!=null&&r.localOrigin.id!==n.localOrigin.id)return!1}else r=n}}return!0}d([m({constructOnly:!0})],cp.prototype,"rctx",void 0),d([m({constructOnly:!0})],cp.prototype,"renderSR",void 0),d([m({constructOnly:!0})],cp.prototype,"viewingMode",void 0),d([m({constructOnly:!0})],cp.prototype,"techniqueRepository",void 0),d([m({constructOnly:!0})],cp.prototype,"setNeedsRender",void 0),d([m({constructOnly:!0})],cp.prototype,"schedule",void 0),d([m({readOnly:!0})],cp.prototype,"_updatingHandles",void 0),d([m({readOnly:!0})],cp.prototype,"updating",null),cp=d([V("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView")],cp);class oye{constructor(e,r,i){this.radius=i,this.renderables=new Array,this.loaded=e,this.loaded.then(()=>{this.loaded!=null&&(this.loaded=!0)}),this.center=Zi(r)}}class cRt{constructor(e,r){this.buffer=e,this.meta=r}}class uRt{constructor(e,r){this.vao=e,this.lod=r}}class Mj{constructor(e,r){this.modelMatrix=e,this.origin=r}}class hRt{constructor(e,r,i,n,s,o,a,l){this.regular=e,this.silhouette=r,this.statistics=i,this.transform=n,this.edgeTransparency=s,this.objectTransparency=o,this.components=a,this.rendererKey=l,this.distanceToCamera=0,this.visible=!0}}function aye(t){return t.regular!=null}function lye(t){return t.silhouette!=null}function O4(t,e,r){const i=e*r,n=fze(t,i,!0);return n===-1?i<t[0]?t.length:0:t.length-n}let cye=class{constructor(e,r,i){this.position=e,this.modelTransform=r,this.origin=i}};const uye=li(),dRt=()=>Promise.reject();let hye=class{constructor(e,r,i,n,s,o,a,l,c){this.createQuery=e,this.deleteQuery=r,this.resultAvailable=i,this.getResult=n,this.disjoint=s,this.beginTimeElapsed=o,this.endTimeElapsed=a,this.createTimestamp=l,this.timestampBits=c}},a0=!1;function pRt(t,e){if(e.disjointTimerQuery)return null;let r=t.getExtension("EXT_disjoint_timer_query_webgl2");return r?new hye(()=>t.createQuery(),i=>{t.deleteQuery(i),a0=!1},i=>t.getQueryParameter(i,t.QUERY_RESULT_AVAILABLE),i=>t.getQueryParameter(i,t.QUERY_RESULT),()=>t.getParameter(r.GPU_DISJOINT_EXT),i=>{a0||(a0=!0,t.beginQuery(r.TIME_ELAPSED_EXT,i))},()=>{t.endQuery(r.TIME_ELAPSED_EXT),a0=!1},i=>r.queryCounterEXT(i,r.TIMESTAMP_EXT),()=>t.getQuery(r.TIMESTAMP_EXT,r.QUERY_COUNTER_BITS_EXT)):(r=t.getExtension("EXT_disjoint_timer_query"),r?new hye(()=>r.createQueryEXT(),i=>{r.deleteQueryEXT(i),a0=!1},i=>r.getQueryObjectEXT(i,r.QUERY_RESULT_AVAILABLE_EXT),i=>r.getQueryObjectEXT(i,r.QUERY_RESULT_EXT),()=>t.getParameter(r.GPU_DISJOINT_EXT),i=>{a0||(a0=!0,r.beginQueryEXT(r.TIME_ELAPSED_EXT,i))},()=>{r.endQueryEXT(r.TIME_ELAPSED_EXT),a0=!1},i=>r.queryCounterEXT(i,r.TIMESTAMP_EXT),()=>r.getQueryEXT(r.TIMESTAMP_EXT,r.QUERY_COUNTER_BITS_EXT)):null)}function fRt(t,e){const r=t.capabilities.disjointTimerQuery;return r==null?null:new mRt(r,e)}let mRt=class{constructor(e,r){this._timer=e,this._queryPool=new Array,this._queryResults=new Map,this._currentQuery=null,r.forEach(i=>{const n=this._timer.createQuery(),s=this._timer.createQuery();this._queryPool.push(n,s),this._queryResults.set(i,null)})}start(){a0||(this._currentQuery=this._queryPool.pop(),this._currentQuery!=null&&(this._timer.disjoint(),this._timer.beginTimeElapsed(this._currentQuery)))}stop(e){if(this._timer.disjoint()||this._currentQuery==null||!this._queryResults.has(e))return this.abort(),null;this._timer.endTimeElapsed();const r=this._queryResults.get(e);if(r==null)return this._queryResults.set(e,this._currentQuery),this._currentQuery=null,null;if(!this._timer.resultAvailable(r))return this._queryPool.unshift(this._currentQuery),this._currentQuery=null,null;const i=this._timer.getResult(r)/1e6;return this._queryPool.unshift(r),this._queryResults.set(e,this._currentQuery),this._currentQuery=null,i}abort(){this._currentQuery!=null&&(this._timer.deleteQuery(this._currentQuery),this._queryPool.unshift(this._timer.createQuery()),this._currentQuery=null)}dispose(){this._currentQuery!=null&&this._timer.deleteQuery(this._currentQuery),this._queryPool.forEach(e=>{this._timer.deleteQuery(e)}),this._queryResults.forEach(e=>{e!=null&&this._timer.deleteQuery(e)})}};var Ri;(function(t){t.OVERLAY="overlay",t.PREPARE="prepare",t.SHADOW_MAP="shadow map",t.LINEAR_DEPTH="linear depth",t.ACCUMULATED_SHADOWS="accumulated shadows",t.OBJECT_AND_LAYER_ID_COLOR="object/layer id color",t.NORMALS="normals",t.SSAO="SSAO",t.OPAQUE="opaque",t.OPAQUE_EDGES="opaque edges",t.VOXEL="voxel",t.TRANSPARENT="transparent",t.TRANSPARENT_EDGES="transparent edges",t.HUD_VISIBILITY="HUD visibility",t.TRANSPARENT_TERRAIN="transparent terrain",t.ENVIRONMENT="environment",t.LASER_LINES="laser lines",t.OCCLUDED="occluded",t.ANTIALIASING="antialiasing",t.HIGHLIGHTS="highlights",t.HUD="HUD",t.HUD_OCCLUDED="HUD occluded",t.FINISH="finish"})(Ri||(Ri={}));const dye="Total";let gRt=class{constructor(e){this._rctx=e,this._startTimeStampCPU=0,this._lastTimeStampCPU=0,this._totalCPUTime=new A0(dye),this._cpuTimeSamplers=new Map(Object.values(Ri).map(r=>[r,new A0(r)])),this._enableGPUTimer=0,this._totalGPUTime=new A0("GPU"),this._gpuTimeSamplers=new Map(Object.values(Ri).map(r=>[r,new A0(r)])),this._totalTime=0,this._totalFrameCount=0}get totalCPUTimeSampler(){return this._totalCPUTime}get cpuTimeSamplers(){return Array.from(this._cpuTimeSamplers.values())}get totalGPUTimeSampler(){return this._totalGPUTime}get gpuTimeSamplers(){return Array.from(this._gpuTimeSamplers.values())}get gpuSamplingEnabled(){return this._gpuTimerPool!=null}get totalTime(){return this._totalTime}get totalFrameCount(){return this._totalFrameCount}get elapsedTime(){return performance.now()-this._startTimeStampCPU}enableGPUPerformanceInfo(){if(this._gpuTimerPool==null){const r=[...Object.values(Ri),dye];this._gpuTimerPool=fRt(this._rctx,r)}if(this._gpuTimerPool==null)return{hasGPUTimerSupport:!1,remove:()=>{}};++this._enableGPUTimer;let e=!1;return{hasGPUTimerSupport:!0,remove:()=>{e||(e=!0,--this._enableGPUTimer,this._enableGPUTimer===0&&(this._gpuTimerPool=gt(this._gpuTimerPool)))}}}startFrame(){this._startTimeStampCPU=this._lastTimeStampCPU=performance.now(),this._gpuTimerPool&&this._gpuTimerPool.start()}advance(e){const r=performance.now();if(this._cpuTimeSamplers.get(e).record(r-this._lastTimeStampCPU),this._lastTimeStampCPU=r,this._gpuTimerPool){const i=this._gpuTimerPool.stop(e);this._gpuTimeSamplers.get(e).record(i),this._gpuTimerPool.start()}}finishFrame(){if(this._gpuTimerPool){const r=this._gpuTimerPool.stop(Ri.FINISH);this._gpuTimeSamplers.get(Ri.FINISH).record(r),this._rctx.gl.flush()}const e=performance.now()-this._startTimeStampCPU;this._totalTime=this._totalTime+e,this._totalCPUTime.record(e),this._gpuTimerPool&&this._totalGPUTime.record(this.gpuTimeSamplers.reduce((r,i)=>r+(i.last||0),0)),++this._totalFrameCount}};class FS{constructor(e,r,i,n,s,o,a,l){this._stage=e,this._techniqueRepository=n,this._rctx=s,this._compositingHelper=o,this._magnifierHelper=a,this._requestRender=l,this._pluginsHas={hudElements:!1,water:!1},this._hasOverlayWater=!1,this.renderOverlay=c=>{},this._isRendering=!1,this._backgroundColor=Bt(0,0,0,1),this._sliceHelper=new NOt,this._state=Wm(Ur.IDLE),this._highQualityTransparencyEnabled=!0,this._terrainTransparency=fl.Opaque,this._ssrEnabled=!1,this._hasAnimations=!1,this._animationTimestep=new wOt,this._reprojectionMatrixVersion=Wm(0),this._renderHiddenTransparentEdges=()=>{},this._pluginInput=new Map,this._releaseNormals=c=>{var u;(u=c.find(({name:h})=>h==="normals"))!=null&&u.release()&&this._pluginInput.delete("normals")},this._debugLinearDepth=!1,this.fboCache=new rOt(s),this._renderStateFeatures=Wm(g7(!se("disable-feature:high-quality-idle"),e.view.qualityProfile)),this._offscreen=new POt(this.fboCache,this._compositingHelper),this.performanceInfo=new gRt(this._rctx),this._shadowMap=new Die(this.fboCache,e.viewingMode),this._highlight=new xO({view:e.view}),this._shadowHighlight=new NS({view:e.view,viewingMode:e.viewingMode}),this._shadowAccumulator=new Bl(this.fboCache,n,e,c=>{const u=this.shadowsEnabled;this._shadowMap.enabled=!0,this._ensureBindParametersCamera(c.camera,c.contentCamera),this._plugins.prepareRender(),this._shadowMap.enabled=u},(c,u,h)=>{const p=this._stage.view.qualitySettings.maximumPixelRatio;c.shadowMap.start(c.camera,u,h,!0,p),this._renderShadowCascades(U.Shadow,c.shadowMap),c.shadowMap.finish(),c.camera.setGLViewport(this._rctx),this._ensureBindParametersCamera(c.camera,c.contentCamera)},l),this._ssao=new LM({view:this._stage.view}),this._renderContext=new agt(this._rctx,this._offscreen,this._shadowMap,this._sliceHelper),this._nodes=new iOt(this._renderContext),this._plugins=new nOt({renderContext:this._renderContext,techniqueRepository:n,textureRepository:i,materialRepository:r,requestRender:l,controller:e,fbos:this.fboCache,isFeatureEnabled:c=>this.isFeatureEnabled(c)}),this.renderPassManager=new YJ,this._plugins.add(this.renderPassManager),this._smaa=new Mw({view:this._stage.view}),this._plugins.add(this._smaa),this._blit=new DS({opacity:1,alphaMode:Aa.None}),this._plugins.add(this._blit),this._plugins.add(this._ssao),this._plugins.add(this._highlight),this._plugins.add(this._shadowHighlight),this._handles=[he(()=>this._stage.view.state.camera,()=>l(),Kr),he(()=>yi.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES,c=>{this._renderHiddenTransparentEdges=c?()=>this._renderEdges(Xt.TRANSPARENT):()=>{},l()},gi),he(()=>{var c;return(c=this._stage.view.environment.background)==null?void 0:c.color},c=>{const u=c?I$(c):qu;nn(this._backgroundColor,u[0]*u[3],u[1]*u[3],u[2]*u[3],u[3]),l()},Kr)]}destroy(){this._handles.forEach(e=>e.remove()),this._gpuTimerHandle=wi(this._gpuTimerHandle),this._nodes.destroy(),this._offscreen.dispose(),this._shadowMap.dispose(),this._highlight.dispose(),this._shadowAccumulator.dispose(),this._edgeView=Pe(this._edgeView),this.renderPassManager.dispose(),this._releaseFBOs(),this._disposeOffscreenBuffers(),this.fboCache.destroy(),this._plugins.destroy(),tMe.prune()}get _bindParameters(){return this._renderContext.bindParameters}updateRenderFeatures(e=null,r=!se("disable-feature:high-quality-idle")){this._renderStateFeatures.value=g7(r,e),this._plugins.renderFeatureChanged(),this._requestRender()}isFeatureEnabled(e,r=this._state.value){return this._renderStateFeatures.value.get(r,e)??!1}setFeatureEnabled(e,r,i){this._renderStateFeatures.mutate(n=>n.set(r,e,i)),this._requestRender()}get _highQualityTransparency(){return this._highQualityTransparencyEnabled||this.isFeatureEnabled(Rs.HighQualityTransparency)}get hasReflections(){return(this._pluginsHas.water||this._hasOverlayWater)&&(this._ssrEnabled||this.isFeatureEnabled(Rs.WaterReflection))}get hasDecorations(){return this._plugins.hasDecorations}get hasHighlights(){return this._plugins.produces(ue.OPAQUE_MATERIAL,U.Highlight)||this._plugins.produces(ue.TRANSPARENT_MATERIAL,U.Highlight)||this._plugins.produces(ue.DRAPED_MATERIAL,U.Highlight)}get _magnifierEnabled(){return this._bindParameters.decorations===Xl.ON&&this._magnifierHelper.enabled}get fullResolutionAtmosphere(){return this._stage.view.qualitySettings.highResolutionAtmosphere||this.isFeatureEnabled(Rs.HighResolutionAtmosphere)}_releaseFBOs(){this._bindParameters.ssr.lastFrameColor=tr(this._bindParameters.ssr.lastFrameColor),this._bindParameters.multipassTerrain.linearDepth=tr(this._bindParameters.multipassTerrain.linearDepth),this._bindParameters.multipassGeometry.linearDepth=tr(this._bindParameters.multipassGeometry.linearDepth)}_disposeOffscreenBuffers(){this._offscreen.dispose(),this._disposeBindBuffers()}_disposeBindBuffers(){this._shadowMap.disposeOffscreenBuffers(),this._bindParameters.linearDepth=tr(this._bindParameters.linearDepth),this._bindParameters.hudVisibility=tr(this._bindParameters.hudVisibility)}get updating(){return this._smaa.updating||this._edgeView!=null&&this._edgeView.updating||this._shadowAccumulator.running||this._plugins.updating||!this.isCameraFinal}ensureEdgeView(){if(this._edgeView==null){const e=this._stage.view.resourceController;this._edgeView=new cp({rctx:this._rctx,renderSR:this._stage.view.renderSpatialReference,viewingMode:this._stage.viewingMode,techniqueRepository:this._techniqueRepository,setNeedsRender:()=>this._requestRender(),schedule:yRt(e)}),this._handles.push(he(()=>{var r;return(r=this._edgeView)==null?void 0:r.updating},()=>this._requestRender(),Qr)),this._requestRender()}return this._edgeView}get edgeView(){return this._edgeView}get isCameraFinal(){return this._reprojectionMatrixVersion.value>=0&&r9(this._bindParameters.ssr.reprojectionMatrix,sn)}set _reprojectionMatrix(e){ebe(this._bindParameters.ssr.reprojectionMatrix,e)&&this._reprojectionMatrixVersion.value++}get shadowsEnabled(){var e;return!!((e=this._shadowMap)!=null&&e.enabled)}setParameters(e){var n;const{_shadowMap:r,_bindParameters:i}=this;if(((n=e.qualitySettings)==null?void 0:n.reflections)!==void 0&&this._ssrEnabled!==e.qualitySettings.reflections&&(this._ssrEnabled=e.qualitySettings.reflections,this._requestRender()),e.shadowMap!==void 0&&this._shadowMap.enabled!==e.shadowMap&&(this._shadowMap.enabled=e.shadowMap,this._requestRender()),e.shadowMapMaxCascades!==void 0&&r.maxCascades!==e.shadowMapMaxCascades&&(r.maxCascades=e.shadowMapMaxCascades,this._requestRender()),e.environment!=null){e.environment.weather!=null&&(this._bindParameters.weather=e.environment.weather,this._bindParameters.weatherVisible=!!e.weatherVisible);const s=e.environment.lighting.type!=="virtual";i.enableFillLights!==s&&(i.enableFillLights=s,this._requestRender())}e.highQualityTransparency!==void 0&&this._highQualityTransparencyEnabled!==e.highQualityTransparency&&(this._highQualityTransparencyEnabled=e.highQualityTransparency,this._requestRender()),e.hasOverlayWater!==void 0&&this._hasOverlayWater!==e.hasOverlayWater&&(this._hasOverlayWater=e.hasOverlayWater,this._requestRender()),e.slicePlane!==void 0&&this._sliceHelper.plane!==e.slicePlane&&(this._sliceHelper.plane=e.slicePlane,this._requestRender()),e.terrainTransparency!==void 0&&this._terrainTransparency!==e.terrainTransparency&&(this._terrainTransparency=e.terrainTransparency,this._requestRender()),e.shadowCastOptions!==void 0&&this._shadowAccumulator.setOptions(e.shadowCastOptions)}get hasSlicePlane(){return!!this._sliceHelper.plane}get plugins(){return this._plugins}get _hasOITSupport(){return this._rctx.driverTest.floatBufferBlend.result}get _oitEnabled(){return this._highQualityTransparency&&this._hasOITSupport}modify(e,r){this._isRendering&&console.warn("Renderer.modify called while rendering");const{adds:i,removes:n,updates:s}=e;if(i.length===0&&n.length===0&&s.length===0)return;const o=xIe(e);let a=!1;o.forEach((l,c)=>{if(r.done)return;let u=this._plugins.getMaterialRenderer(c);if(u==null&&l.adds.length>0){const h=new vR({material:c});h.initializeRenderContext(this._plugins._context),u=h,this._plugins.add(u)}u&&(u.modify(l),u.numGeometries===0&&(a=!0)),l.removes.forEach(h=>e.removes.removeUnordered(h)),l.adds.forEach(h=>e.adds.removeUnordered(h)),l.updates.forEach(h=>e.updates.removeUnordered(h)),r.madeProgress()}),a&&this._plugins.removeEmptyMaterialRenderers(),this._updateHasFlags(),this._requestRender()}_updateHasFlags(){const e=this._pluginsHas;e.hudElements=this._plugins.produces(ue.LINE_CALLOUTS_HUD_DEPTH)||this._plugins.produces(ue.HUD_MATERIAL)||this._plugins.produces(ue.LABEL_MATERIAL),e.water=this._plugins.produces(ue.DRAPED_WATER,U.Normal),this._bindParameters.hasOccludees=this._plugins.hasOccludees}updateAnimation(e){const r=this._hasAnimations;return this._hasAnimations=this._plugins.updateAnimation(e),this._hasAnimations=this._nodes.updateAnimation()||this._hasAnimations,this._hasAnimations!==r&&(this._gpuTimerHandle=r?wi(this._gpuTimerHandle):this.performanceInfo.enableGPUPerformanceInfo()),this._hasAnimations}get animationTimestep(){return this._animationTimestep.value}get animationTimeDilation(){return this._animationTimestep.timeDilation}resetAnimation(){this._animationTimestep.clear()}tick(){this.fboCache.clean()}render(e,r,i=Op.Default,n=Xl.ON){this._isRendering=!0,this.performanceInfo.startFrame(),this.fboCache.frameStart(),this._disposeBindBuffers();const s=this._offscreen,{camera:o,contentCamera:a,mode:l,alignPixelEnabled:c}=e;this._state.value=l,this._bindParameters.overlay=this.renderOverlay(r),this.performanceInfo.advance(Ri.OVERLAY),this._renderContext.time=r,this._bindParameters.transparencyPassType=ft.NONE,this._bindParameters.alignPixelEnabled=c,this._bindParameters.decorations=n,this._bindParameters.mainColor=this._bindParameters.mainDepth=null;const u=gy(this._sliceHelper.plane);n===Xl.OFF&&(this._sliceHelper.plane=null),o.setGLViewport(this._rctx);const h=s.initializeFrame(o,this._backgroundColor,i);this.hasReflections?this._bindParameters.ssr.lastFrameColor=h:h==null||h.release(),this._ensureBindParametersCamera(o,a),this._plugins.prepareRender(),this.performanceInfo.advance(Ri.PREPARE);const p=this._computeDepthRange(o);this._renderShadowMap(o,this._bindParameters.lighting.mainLight.direction,p),this.performanceInfo.advance(Ri.SHADOW_MAP),this._ensureBindParametersCamera(o,a);const f=this._plugins.produces(ue.OPAQUE_TERRAIN)&&(this._terrainTransparency===fl.Semitransparent||this._terrainTransparency===fl.TransparentWithDraped),g=this._highQualityTransparency&&f,_=this._plugins.produces(ue.TRANSPARENT_MATERIAL,U.Color);this._prepareShaders(g,_),this._pluginInput.set("normals",this._renderNormals()),this.performanceInfo.advance(Ri.NORMALS),this._renderSSAO(),this.performanceInfo.advance(Ri.SSAO),this._renderLinearDepth(),this.performanceInfo.advance(Ri.LINEAR_DEPTH),this._renderShadowAccumulation(p,o,a),this.performanceInfo.advance(Ri.ACCUMULATED_SHADOWS),this._ensureBindParametersSSR(r),this._renderContext.output=U.Color,s.bindFbo(),this._bindParameters.mainColor=s.colorTexture,this._bindParameters.mainDepth=s.depthTexture,this._renderOpaqueGeometry(),this._offscreen.updateColor(O=>this._invokeRenderNodes(O),"opaque-color"),this._plugins.render(ue.ENVIRONMENT_OPAQUE),this.performanceInfo.advance(Ri.OPAQUE),this.fboCache.debugCallback&&this.fboCache.debugCallback("opaque-color",this._offscreen.color.fbo),this._renderTerrainLinearDepth(g),this._setMultipassTerrain(g),this._renderEdges(Xt.OPAQUE),this.performanceInfo.advance(Ri.OPAQUE_EDGES),s.bindFbo(),this._plugins.render(ue.VOXEL),this.performanceInfo.advance(Ri.VOXEL),this._renderHiddenTransparentEdges(),_&&(this._oitEnabled?this._renderOITPass(EC.Geometry):this._renderTransparentMaterial()),this._offscreen.updateColor(O=>this._invokeRenderNodes(O),"transparent-color"),this.performanceInfo.advance(Ri.TRANSPARENT);const v=this._renderGeometryLinearDepth(g);this._renderHUDVisibility(v),g||this._plugins.render(ue.LINE_CALLOUTS),this.performanceInfo.advance(Ri.HUD_VISIBILITY);const b=i===Op.ObjectAndLayerID?this._renderObjectAndLayerIdColor():null;this.performanceInfo.advance(Ri.OBJECT_AND_LAYER_ID_COLOR),this._renderEdges(Xt.TRANSPARENT,v),v==null||v.release(),this.performanceInfo.advance(Ri.TRANSPARENT_EDGES);const w=f?this._renderTransparentTerrain():null;w&&this._bindParameters.hudVisibility&&(g?this._renderLineCallouts(Ec.Occluded):s.compositeToHUDVisibility(this._bindParameters,w.getTexture()),this._renderHUD(Ec.Occluded,s.color),this.performanceInfo.advance(Ri.HUD_OCCLUDED)),this.performanceInfo.advance(Ri.TRANSPARENT_TERRAIN),this._setTerrainCulling(!1),w&&(s.compositeToFramebuffer(this._bindParameters,w.getTexture(),Aa.PremultipliedAlpha,1),w.release(),g&&(this._renderEdges(Xt.OPAQUE),this.performanceInfo.advance(Ri.OPAQUE_EDGES),_&&(this._oitEnabled?this._renderOITPass(EC.Geometry):this._renderTransparentMaterial()),this.performanceInfo.advance(Ri.TRANSPARENT),this._renderEdges(Xt.TRANSPARENT),this.performanceInfo.advance(Ri.TRANSPARENT_EDGES))),this._bindParameters.ssao=tr(this._bindParameters.ssao),g&&this._renderLineCallouts(Ec.NotOccluded),this._setMultipassEnabled(!1),this._shadowAccumulator.render(this._bindParameters),s.bindFbo(),this._plugins.render(ue.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),this._plugins.render(ue.ENVIRONMENT_TRANSPARENT),this.performanceInfo.advance(Ri.ENVIRONMENT),this._renderLaserlines(),this.performanceInfo.advance(Ri.LASER_LINES),this._renderOccluded(),this.performanceInfo.advance(Ri.OCCLUDED);let x=this._renderHighlightPrepass();x&&this._renderShadowHighlights(x,this._bindParameters);const S=this._magnifierEnabled&&i===Op.Default?this.fboCache.acquire(this._offscreen.width,this._offscreen.height,"magnifier"):null,E=i!==Op.Default?this.fboCache.acquire(this._offscreen.width,this._offscreen.height,"screenshot"):null,A=this._renderComposite(S??E,x)??E;return this.performanceInfo.advance(Ri.ANTIALIASING),this._renderHUD(Ec.NotOccluded,A),this.performanceInfo.advance(Ri.HUD),x&&(this._renderHighlights(A,x,this._bindParameters),x=tr(x)),this.performanceInfo.advance(Ri.HIGHLIGHTS),this._magnifierEnabled&&this._magnifierHelper.render(this._rctx,this._bindParameters),A!==E&&(this._rctx.bindFramebuffer(E==null?void 0:E.fbo),this._compositingHelper.composite(this._bindParameters,S==null?void 0:S.getTexture(),Aa.None)),i===Op.Default&&(S==null||S.release()),this.onPostRender&&this.onPostRender(),this._releaseFBOs(),this._offscreen.releaseBuffers(),this._renderContext.lastFrameCamera.copyFrom(this._bindParameters.camera),this._sliceHelper.plane=u,this._isRendering=!1,this.fboCache.frameEnd(),this.performanceInfo.finishFrame(),i!==Op.Default&&(this._releaseFBOs(),this._disposeOffscreenBuffers()),{screen:E,oid:b}}_prepareShaders(e,r){this._renderContext.output=U.Color,this._prepareOpaqueGeometry(),this._setMultipassTerrain(e),this._plugins.prepare(ue.TRANSPARENT_TERRAIN),this._setMultipassTerrain(!1),e||this._plugins.prepare(ue.LINE_CALLOUTS),r&&this._prepareTransparencySlots(),this._plugins.prepare(ue.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),this._plugins.prepare(ue.ENVIRONMENT_TRANSPARENT),this._plugins.prepare(ue.LASERLINES),this._rctx.gl.flush()}_renderObjectAndLayerIdColor(){if(!se("enable-feature:objectAndLayerId-rendering"))return;const e=this._renderContext.output,r=this.fboCache.acquire(this._offscreen.width,this._offscreen.height,"oid");return r.acquireDepth(ra.DEPTH_STENCIL_TEXTURE),this._rctx.bindFramebuffer(r.fbo),this.fboCache.rctx.clearFramebuffer([0,0,0,0],!0,!0),this._renderAllGeometry(U.ObjectAndLayerIdColor),this._rctx.bindFramebuffer(r.fbo),this.fboCache.rctx.clearFramebuffer(void 0,!0,!0),this._bindParameters.hudRenderStyle=Ec.NotOccluded,this._plugins.render(ue.HUD_MATERIAL),this._renderContext.output=e,r}finish(e){this._hasAnimations||this._animationTimestep.clear();const r=this.performanceInfo.gpuSamplingEnabled,i=e===Dn.BACKGROUND;if(i||r){const n=i?this.performanceInfo.elapsedTime:0,s=r?this.performanceInfo.totalGPUTimeSampler.last:this._rctx.gl.getError(),o=Math.max(n,s);this._animationTimestep.frame(o,i)}}readDepthPixels(e,r,i){var a;const n=(a=this._bindParameters.linearDepth)==null?void 0:a.fbo;if(n!=null&&n.colorTexture)return void n.readPixels(r[0],r[1],r[2],r[3],Tt.RGBA,ks.UNSIGNED_BYTE,i);const s=this.fboCache.acquire(this._offscreen.width,this._offscreen.height,"depth").acquireDepth(ra.DEPTH16_BUFFER);this._rctx.bindFramebuffer(s.fbo),this._ensureBindParametersCamera(e,e),this._bindParameters.camera.setGLViewport(this._rctx),this._rctx.setClearColor(0,0,0,0);const o=Ci.COLOR_BUFFER_BIT|Ci.DEPTH_BUFFER_BIT|Ci.STENCIL_BUFFER_BIT;this._rctx.clearSafe(o),this._renderAllGeometry(U.LinearDepth),s.fbo.readPixels(r[0],r[1],r[2],r[3],Tt.RGBA,ks.UNSIGNED_BYTE,i),s.release()}readHUDVisibility(e,r,i,n,s){var o;(o=this._bindParameters.hudVisibility)==null||o.fbo.readPixels(e,r,i,n,Tt.RGBA,ks.UNSIGNED_BYTE,s)}readAccumulatedShadow(e){return this._shadowAccumulator.readAccumulatedShadow(e[0],e[1])}_setMultipassTerrain(e){this._setMultipassEnabled(e),this._setTerrainCulling(e)}_setMultipassEnabled(e){this._bindParameters.multipassEnabled=e}_setTerrainCulling(e){this._bindParameters.multipassTerrain.cullAboveGround=e}_renderEdges(e,r){const i=this._edgeView;if(i!=null&&i.shouldRender()){const{width:n,height:s,depth:o}=this._offscreen,a=this.fboCache.acquire(n,s,"edges"),l=()=>i.render(this._bindParameters,e);this._offscreen.renderToTargets(l,a,r??o,pye),this._offscreen.compositeToFramebuffer(this._bindParameters,a.getTexture(),Aa.Alpha,1),a.release()}}_renderShadowMap(e,r,i){const n=this._shadowMap;n.enabled&&(n.start(e,r,i,this.isFeatureEnabled(Rs.HighResolutionShadows),this._stage.view.qualitySettings.maximumPixelRatio),this._shadowHighlight.updateParameters(e,r),this._needsShadowHighlight?(this._renderShadowCascades(U.ShadowHighlight,this._shadowMap),n.moveSnapshot(v2.Highlight),this._renderShadowCascades(U.ShadowExcludeHighlight,this._shadowMap),n.copySnapshot(v2.ExcludeHighlight),this._renderShadowCascades(U.ShadowHighlight,this._shadowMap)):this._renderShadowCascades(U.Shadow),n.finish(),e.setGLViewport(this._rctx))}_renderShadowCascades(e,r=this._shadowMap){for(const i of r.cascades)i.camera.setGLViewport(this._rctx),this._ensureBindParametersCamera(i.camera,i.camera),this._renderAllGeometry(e)}get _needsLinearDepth(){return this._plugins.consumes(U.LinearDepth)||this.hasReflections||this._needsShadowHighlight||this._needsShadowCast||this._debugLinearDepth}_renderLinearDepth(){this._needsLinearDepth?(this._bindParameters.linearDepth=this._offscreen.renderToCachedFBO(this._bindParameters.linearDepth,"linear-depth",()=>this._renderAllGeometry(U.LinearDepth),[0,0,0,0],qi.RGBA,ra.DEPTH_STENCIL_TEXTURE),this._bindParameters.linearDepth.detachDepth()):this._bindParameters.linearDepth=tr(this._bindParameters.linearDepth)}_renderTerrainLinearDepth(e){if(e){const r=this._renderContext.output;this._renderContext.output=U.LinearDepth,this._bindParameters.multipassTerrain.linearDepth=this._offscreen.renderToCachedFBO(this._bindParameters.multipassTerrain.linearDepth,"terrain depth",()=>this._renderTransparentTerrain(),[-1e10,-1e10,-1e10,1]),this._bindParameters.multipassTerrain.linearDepth.detachDepth(),this._renderContext.output=r}else this._bindParameters.multipassTerrain.linearDepth=tr(this._bindParameters.multipassTerrain.linearDepth)}_renderGeometryLinearDepth(e){if(!e)return void(this._bindParameters.multipassGeometry.linearDepth=tr(this._bindParameters.multipassGeometry.linearDepth));const r=this._renderContext.output;this._bindParameters.multipassGeometry.linearDepth=this._offscreen.renderToCachedFBO(this._bindParameters.multipassGeometry.linearDepth,"geometry depth",()=>this._renderOpaqueGeometryAndTransparentMaterial(U.LinearDepth),[1,1,1,1]),this._renderContext.output=r;const i=this._bindParameters.multipassGeometry.linearDepth.getAttachment(n3);return i==null||i.retain(),this._bindParameters.multipassGeometry.linearDepth.detachDepth(),i}get _needsDepthRange(){return this._shadowMap.enabled||this._needsShadowCast}_computeDepthRange(e){if(!this._needsDepthRange)return BJ;const r=FMt(e,this._plugins.plugins,this._stage.layers);return w3(r,this._plugins.queryDepthRange(e)),r.near=Math.max(e.near,r.near),r.far=Math.min(e.far,r.far),r}_renderNormals(){const e=this._plugins.produces(ue.SSAO),r=this._nodes.require("normals","composite-color")+this._nodes.require("normals","opaque-color")+this._nodes.require("normals","transparent-color");let i=(e?1:0)+r+(e||r>0?this._nodes.optional("normals","composite-color")+this._nodes.optional("normals","opaque-color")+this._nodes.optional("normals","transparent-color"):0);if(i===0)return;const n=this._offscreen.renderToCachedFBO(null,"normals",()=>this._renderGeometryForSSAO(U.Normal),[0,0,0,0],qi.RGBA,ra.DEPTH_STENCIL_TEXTURE);for(;--i>0;)n.retain();return n}_renderSSAO(){const e=this._pluginInput.get("normals");this._plugins.produces(ue.SSAO)&&e&&(this._bindParameters.ssao=this._plugins.render(ue.SSAO,this._pluginInput),e.detachDepth(),e.release()&&this._pluginInput.delete("normals"))}_renderAllGeometry(e){this._renderContext.output=e,this._plugins.prepare(ue.TRANSPARENT_TERRAIN),this._renderOpaqueGeometryAndTransparentMaterial(e),this._renderTransparentTerrain()}_renderOpaqueGeometryAndTransparentMaterial(e){this._renderContext.output=e,this._plugins.prepare(ue.TRANSPARENT_MATERIAL),this._plugins.prepare(ue.TRANSPARENT_NO_SSAO_DEPTH),this._renderOpaqueGeometry(),this._renderTransparentMaterial()}_renderGeometryForSSAO(e){this._renderContext.output=e,this._plugins.render(ue.INTEGRATED_MESH),this._plugins.render(ue.OPAQUE_TERRAIN),this._plugins.render(ue.OPAQUE_MATERIAL),this._plugins.render(ue.TRANSPARENT_MATERIAL),this._renderTransparentTerrain()}_prepareOpaqueGeometry(){this._plugins.prepare(ue.INTEGRATED_MESH),this._plugins.prepare(ue.OPAQUE_TERRAIN),this._plugins.prepare(ue.OPAQUE_MATERIAL),this._plugins.prepare(ue.OPAQUE_NO_SSAO_DEPTH),this._plugins.prepare(ue.ENVIRONMENT_OPAQUE)}_renderOpaqueGeometry(){this._plugins.render(ue.INTEGRATED_MESH),this._plugins.render(ue.OPAQUE_TERRAIN),this._plugins.render(ue.OPAQUE_MATERIAL),this._plugins.render(ue.OPAQUE_NO_SSAO_DEPTH)}_renderTransparentMaterial(){this._plugins.render(ue.TRANSPARENT_MATERIAL),this._plugins.render(ue.TRANSPARENT_NO_SSAO_DEPTH)}_renderTransparentTerrain(){if(!this._plugins.produces(ue.TRANSPARENT_TERRAIN))return;const e=()=>this._plugins.render(ue.TRANSPARENT_TERRAIN,null);if(this._renderContext.output!==U.Color)return void e();const{width:r,height:i,depth:n}=this._offscreen,s=this.fboCache.acquire(r,i,"transparent terrain");return this._offscreen.renderToTargets(e,s,n,[0,0,0,0]),s}_renderHUDVisibility(e){this._plugins.produces(ue.OCCLUSION_PIXELS)?(this._bindParameters.hudVisibility=this._offscreen.renderHUDVisibility(this._bindParameters.hudVisibility,()=>this._plugins.render(ue.OCCLUSION_PIXELS),e),this._offscreen.bindFbo()):this._bindParameters.hudVisibility=tr(this._bindParameters.hudVisibility)}_renderLineCallouts(e){if(this._bindParameters.hudRenderStyle=e,e===Ec.Occluded){const r=()=>{this._plugins.render(ue.LINE_CALLOUTS)},{width:i,height:n,color:s}=this._offscreen,o=this.fboCache.acquireDepth(ra.DEPTH16_BUFFER,i,n,"line callouts");this._offscreen.renderToTargets(r,s,o,void 0,!0,!0),o.release()}else this._plugins.render(ue.LINE_CALLOUTS)}_renderLaserlines(){if(this._plugins.render(ue.LASERLINES),this._plugins.produces(ue.LASERLINES_CONTRAST_CONTROL)){const e=this._offscreen,{width:r,height:i,depth:n}=e,s=this.fboCache.acquire(r,i,"laser lines"),o=()=>this._plugins.render(ue.LASERLINES_CONTRAST_CONTROL);e.renderToTargets(o,s,n,pye),e.compositeToFramebuffer(this._bindParameters,s.getTexture(),Aa.PremultipliedAlpha,1),s.release()}}_renderHUD(e,r){if(this._pluginsHas.hudElements)if(this._oitEnabled){const i=this._renderOITPass(EC.HUD,e);this._rctx.bindFramebuffer(r==null?void 0:r.fbo),this._compositingHelper.composite(this._bindParameters,i.getTexture(),Aa.PremultipliedAlpha),i.release()}else if(e===Ec.Occluded){this._renderContext.output=U.Color;const i=()=>this._renderHUDElements(e),{width:n,height:s,color:o}=this._offscreen,a=this.fboCache.acquireDepth(ra.DEPTH16_BUFFER,n,s,"hud");this._offscreen.renderToTargets(i,o,a,void 0,!0,!0),a.release()}else this._renderContext.output=U.Color,this._rctx.bindFramebuffer(null),r==null||r.acquireDepth(ra.DEPTH16_BUFFER),this._rctx.bindFramebuffer(r==null?void 0:r.fbo),this._renderHUDElements(e),r==null||r.detachDepth()}_renderHUDElements(e){this._bindParameters.hudRenderStyle=e,this._plugins.prepare(ue.LINE_CALLOUTS_HUD_DEPTH),this._plugins.prepare(ue.HUD_MATERIAL),this._plugins.prepare(ue.LABEL_MATERIAL),this._plugins.render(ue.LINE_CALLOUTS_HUD_DEPTH),this._plugins.render(ue.HUD_MATERIAL),this._plugins.render(ue.LABEL_MATERIAL)}get _needsShadowHighlight(){return this._shadowMap.enabled&&this._plugins.produces(ue.SHADOW_HIGHLIGHT)&&this._plugins.produces(ue.OPAQUE_MATERIAL,U.ShadowHighlight)}_renderHighlightPrepass(){if(!this.hasHighlights)return;const e=()=>{this._renderAllGeometry(U.Highlight),this._rctx.clearSafe(Ci.DEPTH_BUFFER_BIT),this._renderHUDElements(Ec.Both)},r=this._offscreen.renderToCachedFBO(null,"highlights",e,[0,0,0,0],qi.RGBA4,ra.DEPTH_STENCIL_TEXTURE);return r.detachDepth(),r}_renderShadowHighlights(e,r){this.hasHighlights&&r.decorations!==Xl.OFF&&this._needsShadowHighlight&&this._offscreen.updateColor(i=>(this._pluginInput.set("highlights",e),this._plugins.render(ue.SHADOW_HIGHLIGHT,this._pluginInput,i),i),"transparent-color")}_renderHighlights(e,r,i){this.hasHighlights&&i.decorations!==Xl.OFF&&this._plugins.produces(ue.HIGHLIGHT)&&(this._pluginInput.set("highlights",r),this._plugins.render(ue.HIGHLIGHT,this._pluginInput,e))}get _needsShadowCast(){return this._shadowAccumulator.isAccumulating}_renderShadowAccumulation(e,r,i){var n;this._needsShadowCast&&((n=this._bindParameters.linearDepth)!=null&&n.getTexture())&&this._shadowAccumulator.renderAccumulation(this._bindParameters.linearDepth,e,r,i)}_prepareTransparencySlots(){this._renderContext.output=U.Alpha,this._bindParameters.transparencyPassType=ft.Alpha,this._plugins.prepare(ue.TRANSPARENT_MATERIAL),this._renderContext.output=U.Color,this._bindParameters.transparencyPassType=ft.Color,this._plugins.prepare(ue.TRANSPARENT_MATERIAL),this._bindParameters.transparencyPassType=ft.FrontFace,this._plugins.prepare(ue.TRANSPARENT_MATERIAL),this._bindParameters.transparencyPassType=ft.NONE}_renderOITPass(e,r=Ec.Both){const i=e===EC.HUD,n=i?this.fboCache.acquire(this._offscreen.width,this._offscreen.height,"oit hud composite"):null,s=i?()=>this._renderHUDElements(r):()=>this._renderTransparentMaterial(),o=this._renderContext.output;this._renderContext.output=U.Alpha,this._bindParameters.transparencyPassType=ft.Alpha;const a=this._offscreen.renderOITPass(s,ft.Alpha,i);this._renderContext.output=U.Color,this._bindParameters.transparencyPassType=ft.Color;const l=this._offscreen.renderOITPass(s,ft.Color,i);this._bindParameters.transparencyPassType=ft.FrontFace;const c=this._offscreen.renderOITPass(s,ft.FrontFace,i);return this._offscreen.compositeTransparentOntoOpaque(this._bindParameters,l,a,c,n),n==null||n.detachDepth(),c.release(),l.release(),a.release(),this._bindParameters.transparencyPassType=ft.NONE,this._renderContext.output=o,n}_renderOccluded(){let e=0;Hd.clear(),this._plugins.plugins.forAll(a=>{a.materialReference&&a.queryRenderOccludedState(kr.OccludeAndTransparentStencil)&&(e|=kr.OccludeAndTransparentStencil,Hd.push(a))});const r=this._offscreen,i=(a,l,c,u,h)=>{if(!(e&l))return;const{width:p,height:f,depth:g}=r,_=this.fboCache.acquire(p,f,"tmp color");r.renderToTargets(c,_,g,[0,0,0,0],u,h),r.compositeToFramebuffer(this._bindParameters,_.getTexture(),Aa.PremultipliedAlpha,a),_.release()},n=(a,l)=>{this._bindParameters.slot=a,l.forAll(c=>{if(uZ(c)){const u=c.prepareTechnique(this._renderContext);u&&c.renderNode(this._renderContext,u)}})};Hd.length!==0&&(n(ue.OCCLUDER_MATERIAL,Hd),i(.5,kr.OccludeAndTransparentStencil,()=>n(ue.TRANSPARENT_OCCLUDER_MATERIAL,Hd),!1,!1)),Hd.clear(),this._plugins.plugins.forAll(a=>{if(!a.materialReference)return;const l=a.queryRenderOccludedState(kr.OccludeAndTransparent),c=a.queryRenderOccludedState(kr.Transparent),u=a.queryRenderOccludedState(kr.Opaque);(l||c||u)&&(e|=l?kr.OccludeAndTransparent:c?kr.Transparent:kr.Opaque,Hd.push(a))});const s=this._plugins.renderOccludedFlags;if(e|=s,!e)return;const o=a=>{this._renderContext.renderOccludedMask=a,s>kr.Occlude&&this._plugins.render(ue.OCCLUDED_TERRAIN),n(ue.OPAQUE_MATERIAL,Hd),n(ue.TRANSPARENT_MATERIAL,Hd),n(ue.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,Hd),this._renderContext.renderOccludedMask=T8};this._renderContext.output=U.Color,i(.5,kr.OccludeAndTransparent,()=>o(kr.OccludeAndTransparent),!0,tc.OutlineVisualElementMask),i(.5,kr.Transparent,()=>o(kr.Transparent),!0,tc.OutlineVisualElementMask),i(1,kr.Opaque,()=>o(kr.Opaque),!0,tc.OutlineVisualElementMask),Hd.clear()}_invokeRenderNodes(e){return this._nodes.render(e,this._pluginInput,this._releaseNormals)}_renderComposite(e,r){this._offscreen.updateColor(n=>(this._pluginInput.set("highlights",r),n=this._nodes.render(n,this._pluginInput,this._releaseNormals),this._pluginInput.set(n.name,n),this._pluginInput.delete("highlights"),n),"composite-color");const i=this._plugins.produces(ue.ANTIALIASING);return this._plugins.render(i?ue.ANTIALIASING:ue.BLIT,this._pluginInput,e)}_ensureBindParametersCamera(e,r){this._bindParameters.camera=e,this._bindParameters.contentCamera=r}_ensureBindParametersSSR(e){if(this._bindParameters.ssr.lastFrameColor){this._ssrEnableTime==null&&(this._ssrEnableTime=e),this._renderContext.lastFrameCamera.equals(this._bindParameters.camera)?this._reprojectionMatrix=sn:(os(mye,this._bindParameters.camera.viewMatrix),os(fye,this._bindParameters.camera.projectionMatrix),Hr(eS,mye,fye),Hr(eS,this._renderContext.lastFrameCamera.viewMatrix,eS),Hr(eS,this._renderContext.lastFrameCamera.projectionMatrix,eS),this._reprojectionMatrix=eS);const r=this._stage.view.qualitySettings.fadeDuration;this._bindParameters.ssr.fadeFactor=r>0?Math.min(r,e-this._ssrEnableTime)/r:1,this._bindParameters.ssr.fadeFactor<1&&this._requestRender()}else this._reprojectionMatrix=sn,this._ssrEnableTime=null}addRenderNode(e){this._nodes.add(e),this._requestRender()}removeRenderNode(e){this._nodes.remove(e),this._requestRender()}get usedMemory(){var e;return{fbos:this.fboCache.usedMemory,plugins:this._plugins.usedMemory,edges:((e=this.edgeView)==null?void 0:e.usedMemory)??0}}get test(){return{offscreen:this._offscreen,shadowMap:this._shadowMap,highlight:this._highlight,lighting:this._bindParameters.lighting,renderPlugins:this._plugins,shadowAccumulator:this._shadowAccumulator,weatherIsFading:this._bindParameters.cloudsFade.isFading,resetRenderStateFeatures:()=>{this._renderStateFeatures.value=g7(),this._plugins.renderFeatureChanged(),this._requestRender()},getFramebufferTexture:e=>{var r,i;switch(e){case PC.Color:return this._offscreen.colorTexture;case PC.LinearDepth:return(r=this._bindParameters.linearDepth)==null?void 0:r.getTexture();case PC.ShadowMap:return this._shadowMap.depthTexture;case PC.HudVisibility:return(i=this._bindParameters.hudVisibility)==null?void 0:i.getTexture()}},debugLinearDepth:e=>{this._debugLinearDepth=e,this._requestRender()}}}}var EC,PC;d([m({readOnly:!0})],FS.prototype,"fullResolutionAtmosphere",null),d([m()],FS.prototype,"_smaa",void 0),d([m()],FS.prototype,"_blit",void 0),d([m()],FS.prototype,"_edgeView",void 0),d([m()],FS.prototype,"updating",null),function(t){t[t.Geometry=0]="Geometry",t[t.HUD=1]="HUD"}(EC||(EC={})),function(t){t[t.Color=0]="Color",t[t.LinearDepth=1]="LinearDepth",t[t.ShadowMap=2]="ShadowMap",t[t.HudVisibility=3]="HudVisibility"}(PC||(PC={}));const pye=[0,0,0,0],Hd=new Vt,fye=xe(),mye=xe(),eS=xe();function yRt(t){return e=>t.immediate.schedule(e)}let _Rt=class{constructor(e){this._rctx=e,this._vao=vRt(e)}destroy(){this._vao=gt(this._vao)}draw(){this._vao!=null&&(this._rctx.bindVAO(this._vao),this._rctx.drawArrays(sr.TRIANGLES,0,3))}get test(){var e,r,i,n;return{cachedWebGLObjects:Oj((e=this._vao)==null?void 0:e.glName)+Oj((i=(r=this._vao)==null?void 0:r.indexBuffer)==null?void 0:i.glName)+Oj((n=this._vao)==null?void 0:n.vertexBuffers.geometry)}}};function vRt(t,e=Xte,r=Mr){const i=new Float32Array([-1,-1,3,-1,-1,3]);return new _f(t,r,{geometry:e},{geometry:Wr.createVertex(t,Ar.STATIC_DRAW,i)})}function Oj(t){return t!=null?1:0}let Z5e=class J5e{constructor(e){this._rctx=e,this._indexBuffer=this._createIndexbuffer(),this._program=this._createHelperProgram()}static getShaderSources(){return{vertex:`#version 300 es
    precision highp float;

    void main(void) {
      gl_Position = vec4(0.0, 0.0, float(gl_VertexID)-2.0, 1.0);
    }`,fragment:`#version 300 es
    precision highp float;

    out vec4 fragColor;

    void main(void) {
      fragColor = vec4(0.0, 0.0, 0.0, 1.0);
    }`}}_createHelperProgram(){const e=J5e.getShaderSources();return this._rctx.programCache.acquire(e.vertex,e.fragment,new Map([]))}_createIndexbuffer(){return Wr.createIndex(this._rctx,Ar.STATIC_DRAW,new Uint32Array([0]))}run(){this._program.compiled&&this._indexBuffer&&(this._rctx.bindVAO(null),this._rctx.useProgram(this._program),this._rctx.bindBuffer(this._indexBuffer,_t.ELEMENT_ARRAY_BUFFER),this._rctx.drawElements(sr.POINTS,1,qe.UNSIGNED_INT,0))}dispose(){this._program.dispose(),this._indexBuffer.dispose()}get test(){var e;return{cachedWebGLObjects:(e=this._indexBuffer)!=null&&e.glName?1:0}}},gye=class{constructor(){this.blend=!1,this.blendColor={r:0,g:0,b:0,a:0},this.blendFunction={srcRGB:Se.ONE,dstRGB:Se.ZERO,srcAlpha:Se.ONE,dstAlpha:Se.ZERO},this.blendEquation={mode:ug.ADD,modeAlpha:ug.ADD},this.colorMask={r:!0,g:!0,b:!0,a:!0},this.faceCulling=!1,this.cullFace=Up.BACK,this.frontFace=i3.CCW,this.scissorTest=!1,this.scissorRect={x:0,y:0,width:0,height:0},this.depthTest=!1,this.depthFunction=Xr.LESS,this.clearDepth=1,this.depthWrite=!0,this.depthRange={zNear:0,zFar:1},this.viewport=null,this.stencilTest=!1,this.polygonOffsetFill=!1,this.polygonOffset=[0,0],this.stencilFunction={face:Up.FRONT_AND_BACK,func:Xr.ALWAYS,ref:0,mask:1},this.clearStencil=0,this.stencilWriteMask=1,this.stencilOperation={face:Up.FRONT_AND_BACK,fail:cn.KEEP,zFail:cn.KEEP,zPass:cn.KEEP},this.clearColor={r:0,g:0,b:0,a:0},this.program=null,this.vertexBuffer=null,this.indexBuffer=null,this.uniformBuffer=null,this.pixelPackBuffer=null,this.pixelUnpackBuffer=null,this.copyReadBuffer=null,this.copyWriteBuffer=null,this.transformFeedbackBuffer=null,this.uniformBufferBindingPoints=new Array,this.transformBufferBindingPoints=new Array,this.readFramebuffer=null,this.drawFramebuffer=null,this.renderbuffer=null,this.activeTexture=0,this.textureUnitMap=new Array,this.vertexArrayObject=null}},bRt=class{constructor(){for(this._current=new Array,this._allocations=null;this._current.length<Wn.COUNT;)this._current.push(0)}increment(e,r,i=1){var n;this._current[e]+=i,(n=this._allocations)==null||n.add(r)}decrement(e,r,i=1){var n;this._current[e]-=i,(n=this._allocations)==null||n.remove(r)}get current(){return this._current}get total(){return this.current.reduce((e,r,i)=>e+(i<Wn.UNCOUNTED?r:0),0)}get resourceInformation(){var r;let e="";if(this.total>0){e+=`Live objects:
`;for(let i=0;i<Wn.COUNT;++i){const n=this._current[i];n>0&&(e+=`${Wn[i]}: ${n}
`)}}return e+=(r=this._allocations)==null?void 0:r.resetLog(),e}},wRt=class{constructor(e,r,i){const n=r.textureFilterAnisotropic,s=i.maxAnisotropy??1/0;this.versionString=e.getParameter(e.VERSION),this.maxVertexTextureImageUnits=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this.maxVertexAttributes=e.getParameter(e.MAX_VERTEX_ATTRIBS),this.maxMaxAnisotropy=n?Math.min(e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY),s):1,this.maxTextureImageUnits=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.maxRenderbufferSize=e.getParameter(e.MAX_RENDERBUFFER_SIZE),this.maxViewportDims=e.getParameter(e.MAX_VIEWPORT_DIMS),this.maxUniformBufferBindings=e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS),this.maxVertexUniformBlocks=e.getParameter(e.MAX_VERTEX_UNIFORM_BLOCKS),this.maxFragmentUniformBlocks=e.getParameter(e.MAX_FRAGMENT_UNIFORM_BLOCKS),this.maxUniformBlockSize=e.getParameter(e.MAX_UNIFORM_BLOCK_SIZE),this.uniformBufferOffsetAlignment=e.getParameter(e.UNIFORM_BUFFER_OFFSET_ALIGNMENT),this.maxArrayTextureLayers=e.getParameter(e.MAX_ARRAY_TEXTURE_LAYERS),this.maxSamples=e.getParameter(e.MAX_SAMPLES)}};const xRt=["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"];var yye,Q5e={exports:{}};(yye=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"])!==void 0&&(Q5e.exports=yye);const TRt=XI(Q5e.exports);var _ye,K5e={exports:{}};_ye=K5e,function(t){var e=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"];e!==void 0&&(_ye.exports=e)}();const vye=XI(K5e.exports);var eFe={exports:{}};(function(t){(function(e){var r=function(){return["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT","textureSize","texelFetch"]}();r!==void 0&&(t.exports=r)})()})(eFe);const SRt=XI(eFe.exports);var Wd=999,bye=9999,Rj=0,$j=1,wye=2,xye=3,Tye=4,R4=5,CRt=6,ERt=7,PRt=8,Sye=9,ARt=10,Cye=11,MRt=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function ORt(){var t,e,r,i=0,n=0,s=Wd,o=[],a=[],l=1,c=0,u=0,h=!1,p=!1,f="";return function(B){return a=[],B!==null?_(B.replace?B.replace(/\r\n/g,`
`):B):v()};function g(B){B.length&&a.push({type:MRt[s],data:B,position:u,line:l,column:c})}function _(B){var J;for(i=0,r=(f+=B).length;t=f[i],i<r;){switch(J=i,s){case Rj:i=E();break;case $j:i=S();break;case wye:i=x();break;case xye:i=A();break;case Tye:i=z();break;case Cye:i=L();break;case R4:i=k();break;case bye:i=q();break;case Sye:i=w();break;case Wd:i=b()}J!==i&&(f[J]===`
`?(c=0,++l):++c)}return n+=i,f=f.slice(i),a}function v(B){return o.length&&g(o.join("")),s=ARt,g("(eof)"),a}function b(){return o=o.length?[]:o,e==="/"&&t==="*"?(u=n+i-1,s=Rj,e=t,i+1):e==="/"&&t==="/"?(u=n+i-1,s=$j,e=t,i+1):t==="#"?(s=wye,u=n+i,i):/\s/.test(t)?(s=Sye,u=n+i,i):(h=/\d/.test(t),p=/[^\w_]/.test(t),u=n+i,s=h?Tye:p?xye:bye,i)}function w(){return/[^\s]/g.test(t)?(g(o.join("")),s=Wd,i):(o.push(t),e=t,i+1)}function x(){return t!=="\r"&&t!==`
`||e==="\\"?(o.push(t),e=t,i+1):(g(o.join("")),s=Wd,i)}function S(){return x()}function E(){return t==="/"&&e==="*"?(o.push(t),g(o.join("")),s=Wd,i+1):(o.push(t),e=t,i+1)}function A(){if(e==="."&&/\d/.test(t))return s=R4,i;if(e==="/"&&t==="*")return s=Rj,i;if(e==="/"&&t==="/")return s=$j,i;if(t==="."&&o.length){for(;O(o););return s=R4,i}if(t===";"||t===")"||t==="("){if(o.length)for(;O(o););return g(t),s=Wd,i+1}var B=o.length===2&&t!=="=";if(/[\w_\d\s]/.test(t)||B){for(;O(o););return s=Wd,i}return o.push(t),e=t,i+1}function O(B){for(var J,W,Y=0;;){if(J=vye.indexOf(B.slice(0,B.length+Y).join("")),W=vye[J],J===-1){if(Y--+B.length>0)continue;W=B.slice(0,1).join("")}return g(W),u+=W.length,(o=o.slice(W.length)).length}}function L(){return/[^a-fA-F0-9]/.test(t)?(g(o.join("")),s=Wd,i):(o.push(t),e=t,i+1)}function z(){return t==="."||/[eE]/.test(t)?(o.push(t),s=R4,e=t,i+1):t==="x"&&o.length===1&&o[0]==="0"?(s=Cye,o.push(t),e=t,i+1):/[^\d]/.test(t)?(g(o.join("")),s=Wd,i):(o.push(t),e=t,i+1)}function k(){return t==="f"&&(o.push(t),e=t,i+=1),/[eE]/.test(t)||t==="-"&&/[eE]/.test(e)?(o.push(t),e=t,i+1):/[^\d]/.test(t)?(g(o.join("")),s=Wd,i):(o.push(t),e=t,i+1)}function q(){if(/[^\d\w_]/.test(t)){var B=o.join("");return s=TRt.indexOf(B)>-1?PRt:SRt.indexOf(B)>-1?ERt:CRt,g(o.join("")),s=Wd,i}return o.push(t),e=t,i+1}}function RRt(t){var e=ORt(),r=[];return r=(r=r.concat(e(t))).concat(e(null))}function $Rt(t){return RRt(t)}function IRt(t){return t.map(e=>e.type!=="eof"?e.data:"").join("")}const Ij=new Set(["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"]);function LRt(t,e="100",r="300 es"){const i=/^\s*\#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const n of t)if(n.type==="preprocessor"){const s=i.exec(n.data);if(s){const o=s[1].replaceAll(/\s\s+/g," ");if(o===r)return o;if(o===e)return n.data="#version "+r,e;throw new Error("unknown glsl version: "+o)}}return t.splice(0,0,{type:"preprocessor",data:"#version "+r},{type:"whitespace",data:`
`}),null}function DRt(t,e){for(let r=e-1;r>=0;r--){const i=t[r];if(i.type!=="whitespace"&&i.type!=="block-comment"){if(i.type!=="keyword")break;if(i.data==="attribute"||i.data==="in")return!0}}return!1}function TO(t,e,r,i){i=i||r;for(const n of t)if(n.type==="ident"&&n.data===r)return i in e?e[i]++:e[i]=0,TO(t,e,i+"_"+e[i],i);return r}function tFe(t,e,r="afterVersion"){function i(l,c){for(let u=c;u<l.length;u++){const h=l[u];if(h.type==="operator"&&h.data===";")return u}return null}function n(l){let c=-1,u=0,h=-1;for(let p=0;p<l.length;p++){const f=l[p];if(f.type==="preprocessor"&&(/\#(if|ifdef|ifndef)\s+.+/.test(f.data)?++u:/\#endif\s*.*/.test(f.data)&&--u),r!=="afterVersion"&&r!=="afterPrecision"||f.type==="preprocessor"&&f.data.startsWith("#version")&&(h=Math.max(h,p)),r==="afterPrecision"&&f.type==="keyword"&&f.data==="precision"){const g=i(l,p);if(g===null)throw new Error("precision statement not followed by any semicolons!");h=Math.max(h,g)}c<h&&u===0&&(c=p)}return c+1}const s={data:`
`,type:"whitespace"},o=l=>l<t.length&&/[^\r\n]$/.test(t[l].data);let a=n(t);o(a-1)&&t.splice(a++,0,s);for(const l of e)t.splice(a++,0,l);o(a-1)&&o(a)&&t.splice(a,0,s)}function NRt(t,e,r,i="lowp"){tFe(t,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function FRt(t,e,r,i,n="lowp"){tFe(t,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"="},{type:"whitespace",data:" "},{type:"integer",data:i.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:n},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function kRt(t,e){let r,i,n=-1;for(let s=e;s<t.length;s++){const o=t[s];if(o.type==="operator"&&(o.data==="["&&(r=s),o.data==="]")){i=s;break}o.type==="integer"&&(n=parseInt(o.data,10))}return r&&i&&t.splice(r,i-r+1),n}function Eye(t,e){if(t.startsWith("#version 300"))return t;const r=$Rt(t);if(LRt(r,"100","300 es")==="300 es")return t;let i=null,n=null;const s={},o={};for(let a=0;a<r.length;++a){const l=r[a];switch(l.type){case"keyword":e===Lu.VERTEX_SHADER&&l.data==="attribute"?l.data="in":l.data==="varying"&&(l.data=e===Lu.VERTEX_SHADER?"out":"in");break;case"builtin":if(/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(l.data.trim())&&(l.data=l.data.replaceAll(/(2D|Cube|EXT)/g,"")),e===Lu.FRAGMENT_SHADER&&l.data==="gl_FragColor"&&(i||(i=TO(r,s,"fragColor"),NRt(r,i,"vec4")),l.data=i),e===Lu.FRAGMENT_SHADER&&l.data==="gl_FragData"){const c=kRt(r,a+1),u=TO(r,s,"fragData");FRt(r,u,"vec4",c,"mediump"),l.data=u}else e===Lu.FRAGMENT_SHADER&&l.data==="gl_FragDepthEXT"&&(n||(n=TO(r,s,"gl_FragDepth")),l.data=n);break;case"ident":if(xRt.includes(l.data)){if(e===Lu.VERTEX_SHADER&&DRt(r,a))throw new Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");l.data in o||(o[l.data]=TO(r,s,l.data)),l.data=o[l.data]}}}for(let a=r.length-1;a>=0;--a){const l=r[a];if(l.type==="preprocessor"){const c=l.data.match(/\#extension\s+(.*)\:/);if(c&&c[1]&&Ij.has(c[1].trim())){const p=r[a+1];r.splice(a,p&&p.type==="whitespace"?2:1)}const u=l.data.match(/\#ifdef\s+(.*)/);u&&u[1]&&Ij.has(u[1].trim())&&(l.data="#if 1");const h=l.data.match(/\#ifndef\s+(.*)/);h&&h[1]&&Ij.has(h[1].trim())&&(l.data="#if 0")}}return zRt(t,IRt(r))}function zRt(t,e){return e}const URt=4294967295;let BRt=class{constructor(e,r,i,n,s=new Map,o=[]){var c;this._context=e,this._locations=n,this._uniformBlockBindings=s,this._transformFeedbackVaryings=o,this._refCount=1,this._compiled=!1,this._linesOfCode=0,this._nameToUniformLocation=new Map,this._nameToUniform1=new Map,this._nameToUniform1v=new Map,this._nameToUniform2=new Map,this._nameToUniform3=new Map,this._nameToUniform4=new Map,this._nameToUniformMatrix3=new Map,this._nameToUniformMatrix4=new Map,e||console.error("RenderingContext isn't initialized!"),r.length===0&&console.error("Shaders source should not be empty!"),r=Eye(r,Lu.VERTEX_SHADER),i=Eye(i,Lu.FRAGMENT_SHADER),this._vShader=Pye(this._context,Lu.VERTEX_SHADER,r),this._fShader=Pye(this._context,Lu.FRAGMENT_SHADER,i),this._vShader&&this._fShader||console.error("Error loading shaders!"),this._context.instanceCounter.increment(Wn.Shader,this),pX()&&(this.vertexShader=r,this.fragmentShader=i),this.usedMemory=r.length+i.length;const a=this._context.gl,l=a.createProgram();a.attachShader(l,this._vShader),a.attachShader(l,this._fShader),this._locations.forEach((u,h)=>a.bindAttribLocation(l,u,h)),(c=this._transformFeedbackVaryings)!=null&&c.length&&a.transformFeedbackVaryings(l,this._transformFeedbackVaryings,a.SEPARATE_ATTRIBS),a.linkProgram(l),pX()&&!a.getProgramParameter(l,a.LINK_STATUS)&&console.error(`Could not link shader
validated: ${a.getProgramParameter(l,a.VALIDATE_STATUS)}, gl error ${a.getError()}, vertex: ${a.getShaderParameter(this._vShader,a.COMPILE_STATUS)}, fragment: ${a.getShaderParameter(this._fShader,a.COMPILE_STATUS)}, info log: ${a.getProgramInfoLog(l)}, vertex source: ${this.vertexShader}, fragment source: ${this.fragmentShader}`);for(const[u,h]of this._uniformBlockBindings){const p=a.getUniformBlockIndex(l,u);p<URt&&a.uniformBlockBinding(l,p,h)}this._glName=l,this._context.instanceCounter.increment(Wn.Program,this)}get glName(){return this._glName}get hasGLName(){return this._glName!=null}get hasTransformFeedbackVaryings(){var e;return!!((e=this._transformFeedbackVaryings)!=null&&e.length)}get compiled(){if(this._compiled)return!0;const e=this._context.gl.getExtension("KHR_parallel_shader_compile");return e==null||this.glName==null?(this._compiled=!0,!0):(this._compiled=!!this._context.gl.getProgramParameter(this.glName,e.COMPLETION_STATUS_KHR),this._compiled)}dispose(){if(--this._refCount>0)return;const e=this._context.gl,r=this._context.instanceCounter;this._nameToUniformLocation.forEach(i=>i&&r.decrement(Wn.Uniform,i)),this._nameToUniformLocation.clear(),this._vShader&&(this._linesOfCode>0&&(r.decrement(Wn.LinesOfCode,this._vShader,this._linesOfCode),this._linesOfCode=0),e.deleteShader(this._vShader),this._vShader=null,r.decrement(Wn.Shader,this)),this._fShader&&(e.deleteShader(this._fShader),this._fShader=null),this._glName&&(e.deleteProgram(this._glName),this._glName=null,r.decrement(Wn.Program,this))}ref(){++this._refCount}_getUniformLocation(e){const r=this._nameToUniformLocation.get(e);if(r!==void 0)return r;if(this.glName){const i=this._context.gl.getUniformLocation(this.glName,e);return this._nameToUniformLocation.set(e,i),i&&this._context.instanceCounter.increment(Wn.Uniform,i),i}return null}hasUniform(e){return this._getUniformLocation(e)!=null}setUniform1i(e,r){const i=this._nameToUniform1.get(e);i!==void 0&&r===i||(this._context.gl.uniform1i(this._getUniformLocation(e),r),this._nameToUniform1.set(e,r))}setUniform1iv(e,r){Hf(this._nameToUniform1v,e,r)&&this._context.gl.uniform1iv(this._getUniformLocation(e),r)}setUniform2iv(e,r){Hf(this._nameToUniform2,e,r)&&this._context.gl.uniform2iv(this._getUniformLocation(e),r)}setUniform3iv(e,r){Hf(this._nameToUniform3,e,r)&&this._context.gl.uniform3iv(this._getUniformLocation(e),r)}setUniform4iv(e,r){Hf(this._nameToUniform4,e,r)&&this._context.gl.uniform4iv(this._getUniformLocation(e),r)}setUniform1f(e,r){const i=this._nameToUniform1.get(e);i!==void 0&&r===i||(this._context.gl.uniform1f(this._getUniformLocation(e),r),this._nameToUniform1.set(e,r))}setUniform1fv(e,r){Hf(this._nameToUniform1v,e,r)&&this._context.gl.uniform1fv(this._getUniformLocation(e),r)}setUniform2f(e,r,i){const n=this._nameToUniform2.get(e);n===void 0?(this._context.gl.uniform2f(this._getUniformLocation(e),r,i),this._nameToUniform2.set(e,[r,i])):r===n[0]&&i===n[1]||(this._context.gl.uniform2f(this._getUniformLocation(e),r,i),n[0]=r,n[1]=i)}setUniform2fv(e,r){Hf(this._nameToUniform2,e,r)&&this._context.gl.uniform2fv(this._getUniformLocation(e),r)}setUniform3f(e,r,i,n){const s=this._nameToUniform3.get(e);s===void 0?(this._context.gl.uniform3f(this._getUniformLocation(e),r,i,n),this._nameToUniform3.set(e,[r,i,n])):r===s[0]&&i===s[1]&&n===s[2]||(this._context.gl.uniform3f(this._getUniformLocation(e),r,i,n),s[0]=r,s[1]=i,s[2]=n)}setUniform3fv(e,r){const i=this._getUniformLocation(e);i!=null&&Hf(this._nameToUniform3,e,r)&&this._context.gl.uniform3fv(i,r)}setUniform4f(e,r,i,n,s){const o=this._nameToUniform4.get(e);o===void 0?(this._context.gl.uniform4f(this._getUniformLocation(e),r,i,n,s),this._nameToUniform4.set(e,[r,i,n,s])):o!==void 0&&r===o[0]&&i===o[1]&&n===o[2]&&s===o[3]||(this._context.gl.uniform4f(this._getUniformLocation(e),r,i,n,s),o[0]=r,o[1]=i,o[2]=n,o[3]=s)}setUniform4fv(e,r){const i=this._getUniformLocation(e);i!=null&&Hf(this._nameToUniform4,e,r)&&this._context.gl.uniform4fv(i,r)}setUniformMatrix3fv(e,r,i=!1){const n=this._getUniformLocation(e);n!=null&&Hf(this._nameToUniformMatrix3,e,r)&&this._context.gl.uniformMatrix3fv(n,i,r)}setUniformMatrix4fv(e,r,i=!1){const n=this._getUniformLocation(e);n!=null&&Hf(this._nameToUniformMatrix4,e,r)&&this._context.gl.uniformMatrix4fv(n,i,r)}stop(){}};function Pye(t,e,r){const i=t.gl,n=i.createShader(e);return i.shaderSource(n,r),i.compileShader(n),pX()&&!i.getShaderParameter(n,i.COMPILE_STATUS)&&(console.error("Compile error in ".concat(e===Lu.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(i.getShaderInfoLog(n)),console.error(VRt(r))),n}function VRt(t){let e=2;return t.replaceAll(`
`,()=>`
`+GRt(e++)+":")}function GRt(t){return t>=1e3?t.toString():("  "+t).slice(-3)}function Hf(t,e,r){const i=t.get(e);if(!i)return t.set(e,Array.from(r)),!0;const n=r.length;if(i.length!==n)return t.set(e,Array.from(r)),!0;for(let s=0;s<n;++s){const o=r[s];if(i[s]!==o){for(i[s]=o;s<n;++s)i[s]=r[s];return!0}}return!1}let jRt=class{constructor(e){this._rctx=e,this._store=new xv}dispose(){this._store.forEach(e=>e.forEach(r=>r.dispose())),this._store.clear()}acquire(e,r,i,n){const s=this._store.get(e,r);if(s!=null)return s.ref(),s;const o=new BRt(this._rctx,e,r,i,n);return o.ref(),this._store.set(e,r,o),o}get test(){let e=0;return this._store.forEach(r=>r.forEach(i=>e+=i.hasGLName?2:1)),{cachedWebGLProgramObjects:e}}},yL=class{constructor(){this._result=!1}dispose(){this._program=gt(this._program)}get result(){return this._program!=null&&(this._result=this._test(this._program),this.dispose()),this._result}},HRt=class extends yL{constructor(e){super(),this._rctx=e,this._helperProgram=null,se("mac")&&se("chrome")&&(this._program=this._prepareProgram(),this._helperProgram=this._prepareHelperProgram())}dispose(){var e;super.dispose(),(e=this._helperProgram)==null||e.dispose(),this._helperProgram=null}_test(e){const r=this._rctx,i=r.getBoundFramebufferObject(),{x:n,y:s,width:o,height:a}=r.getViewport();r.resetState();const l=new ri(1);l.wrapMode=Jt.CLAMP_TO_EDGE,l.samplingMode=Ht.NEAREST;const c=new bf(r,l),u=Wr.createIndex(this._rctx,Ar.STATIC_DRAW,new Uint8Array([0]));r.bindFramebuffer(c),r.setViewport(0,0,1,1),r.useProgram(this._helperProgram),r.bindBuffer(u,_t.ELEMENT_ARRAY_BUFFER),r.drawElements(sr.POINTS,1,qe.UNSIGNED_BYTE,0),r.useProgram(e),r.bindVAO(null),r.drawArrays(sr.TRIANGLES,0,258);const h=new Uint8Array(4);return c.readPixels(0,0,1,1,Tt.RGBA,ks.UNSIGNED_BYTE,h),r.setViewport(n,s,o,a),r.bindFramebuffer(i),c.dispose(),u.dispose(),h[0]===255}_prepareProgram(){const r=`#version 300 es
    precision highp float;

    out float triangleId;

    const vec3 triangleVertices[3] = vec3[3](vec3(-0.5, -0.5, 0.0), vec3(0.5, -0.5, 0.0), vec3(0.0, 0.5, 0.0));

    void main(void) {
      triangleId = floor(float(gl_VertexID)/3.0);

      vec3 position = triangleVertices[gl_VertexID % 3];
      float offset = triangleId / ${T.float(85)};
      position.z = 0.5 - offset;

      gl_Position = vec4(position, 1.0);
    }
    `,i=`#version 300 es
    precision highp float;

    in float triangleId;

    out vec4 fragColor;

    void main(void) {
      fragColor = triangleId == ${T.float(85)} ? vec4(0.0, 1.0, 0.0, 1.0) : vec4(1.0, 0.0, 0.0, 1.0);
    }
    `;return this._rctx.programCache.acquire(r,i,new Map([]))}_prepareHelperProgram(){const e=Z5e.getShaderSources();return this._rctx.programCache.acquire(e.vertex,e.fragment,new Map([]))}},WRt=class extends yL{constructor(e){super(),this._rctx=e,this._program=Aye(this._rctx,!1),this._obfuscated=Aye(this._rctx,!0)}dispose(){super.dispose(),this._obfuscated=gt(this._obfuscated)}_test(e){if(se("force-double-precision-obfuscation"))return!0;if(this._obfuscated==null)return!1;const r=this._rctx,i=r.getBoundFramebufferObject(),{x:n,y:s,width:o,height:a}=r.getViewport(),l=this._runProgram(e),c=this._runProgram(this._obfuscated);return r.setViewport(n,s,o,a),r.bindFramebuffer(i),l!==0&&(c===0||l/c>5)}_runProgram(e){const r=this._rctx;r.resetState();const i=new ri(1);i.wrapMode=Jt.CLAMP_TO_EDGE,i.samplingMode=Ht.NEAREST;const n=new bf(r,i),s=Wr.createVertex(r,Ar.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new _d(r,new Map([["position",0]]),{geometry:[new jo("position",2,qe.UNSIGNED_SHORT,0,4)]},{geometry:s}),a=Ce(5633261287538229e-9,2626832878767164e-9,1.4349880495278358e6),l=Ce(563327146742708e-8,2.6268736381334523e6,1434963231608387e-9),c=new Float32Array(6);bX(a,c,3);const u=new Float32Array(6);bX(l,u,3),r.useProgram(e),e.setUniform3f("u_highA",c[0],c[2],c[4]),e.setUniform3f("u_lowA",c[1],c[3],c[5]),e.setUniform3f("u_highB",u[0],u[2],u[4]),e.setUniform3f("u_lowB",u[1],u[3],u[5]),r.bindFramebuffer(n),r.setViewport(0,0,1,1),r.bindVAO(o),r.drawArrays(sr.TRIANGLE_STRIP,0,4);const h=new Uint8Array(4);n.readPixels(0,0,1,1,Tt.RGBA,ks.UNSIGNED_BYTE,h),o.dispose(),n.dispose();const p=(a[2]-l[2])/25,f=Mie(h);return Math.abs(p-f)}};function Aye(t,e){const r=`

  precision highp float;

  attribute vec2 position;

  uniform vec3 u_highA;
  uniform vec3 u_lowA;
  uniform vec3 u_highB;
  uniform vec3 u_lowB;

  varying vec4 v_color;

  ${e?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}

  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION

  vec3 dpPlusFrc(vec3 a, vec3 b) {
    return mix(a, a + b, vec3(notEqual(b, vec3(0))));
  }

  vec3 dpMinusFrc(vec3 a, vec3 b) {
    return mix(vec3(0), a - b, vec3(notEqual(a, b)));
  }

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = dpPlusFrc(hiA, hiB);
    vec3 e = dpMinusFrc(t1, hiA);
    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
    return t1 + t2;
  }

  #else

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = hiA + hiB;
    vec3 e = t1 - hiA;
    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
    return t1 + t2;
  }

  #endif

  const float MAX_RGBA_FLOAT =
    255.0 / 256.0 +
    255.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 / 256.0;

  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);

  vec4 float2rgba(const float value) {
    // Make sure value is in the domain we can represent
    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);

    // Decompose value in 32bit fixed point parts represented as
    // uint8 rgba components. Decomposition uses the fractional part after multiplying
    // by a power of 256 (this removes the bits that are represented in the previous
    // component) and then converts the fractional part to 8bits.
    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);

    // Convert uint8 values (from 0 to 255) to floating point representation for
    // the shader
    const float toU8AsFloat = 1.0 / 255.0;

    return fixedPointU8 * toU8AsFloat;
  }

  void main() {
    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);

    v_color = float2rgba(val.z / 25.0);

    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);
  }
  `;return t.programCache.acquire(r,`
  precision highp float;

  varying vec4 v_color;

  void main() {
    gl_FragColor = v_color;
  }
  `,new Map([["position",0]]))}let qRt=class extends yL{constructor(e){var n,s;if(super(),this._rctx=e,!e.gl||!((n=e.capabilities.colorBufferFloat)!=null&&n.textureFloat&&((s=e.capabilities.colorBufferFloat)!=null&&s.floatBlend)))return;const r=`
    precision highp float;
    attribute vec2 a_pos;

    void main() {
      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
    }
    `,i=`
     precision highp float;

     void main() {
      gl_FragColor = vec4(0.5, 0.5, 0.5, 0.5);
     }
    `;this._program=e.programCache.acquire(r,i,new Map([["a_pos",0]]))}_test(e){const r=this._rctx,i=new ri(1);i.wrapMode=Jt.CLAMP_TO_EDGE,i.dataType=ks.FLOAT,i.internalFormat=tt.RGBA32F,i.samplingMode=Ht.NEAREST;const n=new bf(r,i),s=Wr.createVertex(r,Ar.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new _d(r,new Map([["a_pos",0]]),{geometry:[new jo("a_pos",2,qe.UNSIGNED_SHORT,0,4)]},{geometry:s});r.useProgram(e);const a=r.getBoundFramebufferObject(),{x:l,y:c,width:u,height:h}=r.getViewport();r.bindFramebuffer(n),r.setViewport(0,0,1,1),r.bindVAO(o),r.drawArrays(sr.TRIANGLE_STRIP,0,4);const p=kt({blending:WOe});r.setPipelineState(p),r.drawArrays(sr.TRIANGLE_STRIP,0,4);const f=r.gl.getError();return r.setViewport(l,c,u,h),r.bindFramebuffer(a),o.dispose(),n.dispose(),f!==1282||(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1)}},YRt=class extends yL{constructor(e){super(),this._rctx=e;const r=`
      precision highp float;
      attribute vec2 a_pos;
      uniform highp sampler2D u_texture;
      varying vec4 v_color;

      float getBit(in float bitset, in int bitIndex) {
        float offset = pow(2.0, float(bitIndex));
        return mod(floor(bitset / offset), 2.0);
      }

      void main() {
        vec4 value = texture2D(u_texture, vec2(0.0));
        float bit = getBit(value.x * 255.0, 1);

        v_color = bit * vec4(1.0);
        gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
      }
      `,i=`
      precision highp float;
      varying vec4 v_color;

      void main() {
        gl_FragColor = v_color;
      }
      `;this._program=e.programCache.acquire(r,i,new Map([["a_pos",0]]))}_test(e){const r=this._rctx,i=new ri(1);i.wrapMode=Jt.CLAMP_TO_EDGE,i.samplingMode=Ht.NEAREST;const n=new bf(r,i),s=new Uint8Array(4),o=Wr.createVertex(r,Ar.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),a=new _d(r,new Map([["a_position",0]]),{geometry:[new jo("a_position",2,qe.SHORT,0,4)]},{geometry:o});r.useProgram(e);const l=new Sr(r,i,new Uint8Array([2,255,0,0]));e.setUniform1i("u_texture",0),r.bindTexture(l,0);const c=r.getBoundFramebufferObject();r.bindFramebuffer(n),r.useProgram(e);const{x:u,y:h,width:p,height:f}=r.getViewport();r.setViewport(0,0,1,1),r.bindVAO(a),r.drawArrays(sr.TRIANGLE_STRIP,0,4),r.setViewport(u,h,p,f),n.readPixels(0,0,1,1,Tt.RGBA,ks.UNSIGNED_BYTE,s),a.dispose(),n.dispose();const g=s[0]!==255||s[1]!==255||s[2]!==255||s[3]!==255;return g&&re.getLogger("esri.views.webgl.testSamplerPrecision").warn(`A problem was detected with your graphics driver. Your driver does not appear to honor sampler precision specifiers, which may result in rendering issues due to numerical instability. We recommend ensuring that your drivers have been updated to the latest version. Applying lowp sampler workaround. [${s[0]}.${s[1]}.${s[2]}.${s[3]}]`),r.bindFramebuffer(c),g}};new jo("a_pos",2,qe.BYTE,0,2);new jo("a_pos",2,qe.BYTE,0,4),new jo("a_tex",2,qe.BYTE,2,4);const XRt={geometry:[new jo("a_pos",2,qe.UNSIGNED_SHORT,0,4)]};let ZRt=class extends yL{constructor(e){super(),this._rctx=e;const r=`
    precision highp float;

    attribute vec2 a_pos;
    varying vec2 v_uv;

    void main() {
      v_uv = a_pos;
      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
    }
    `,i=`
    precision highp float;

    varying vec2 v_uv;

    uniform sampler2D u_texture;

    void main() {
      gl_FragColor = texture2D(u_texture, v_uv);
    }
    `;this._program=e.programCache.acquire(r,i,new Map([["a_pos",0]]))}dispose(){super.dispose()}_test(e){const r=this._rctx;if(!r.gl)return e.dispose(),!0;const i=new ri(1);i.wrapMode=Jt.CLAMP_TO_EDGE,i.samplingMode=Ht.NEAREST;const n=new bf(r,i),s=Wr.createVertex(r,Ar.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new _d(r,new Map([["a_pos",0]]),XRt,{geometry:s}),a=new ri;a.samplingMode=Ht.LINEAR,a.wrapMode=Jt.CLAMP_TO_EDGE;const l=new Sr(r,a,SO);r.useProgram(e),r.bindTexture(l,0),e.setUniform1i("u_texture",0);const c=r.getBoundFramebufferObject(),{x:u,y:h,width:p,height:f}=r.getViewport();r.bindFramebuffer(n),r.setViewport(0,0,1,1),r.setClearColor(0,0,0,0),r.setBlendingEnabled(!1),r.clearSafe(Ci.COLOR_BUFFER_BIT),r.bindVAO(o),r.drawArrays(sr.TRIANGLE_STRIP,0,4);const g=new Uint8Array(4);return n.readPixels(0,0,1,1,Tt.RGBA,ks.UNSIGNED_BYTE,g),o.dispose(),n.dispose(),l.dispose(),r.setViewport(u,h,p,f),r.bindFramebuffer(c),g[0]!==255}};const SO=new Image;SO.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",SO.width=5,SO.height=5,SO.decode();let JRt=class{constructor(e){this.rctx=e,this.floatBufferBlend=new qRt(e),this.svgPremultipliesAlpha=new ZRt(e),this.doublePrecisionRequiresObfuscation=new WRt(e),this.ignoresSamplerPrecision=new YRt(e),this.drawArraysRequiresIndicesTypeReset=new HRt(e)}dispose(){this.ignoresSamplerPrecision.dispose(),this.doublePrecisionRequiresObfuscation.dispose(),this.svgPremultipliesAlpha.dispose(),this.floatBufferBlend.dispose(),this.drawArraysRequiresIndicesTypeReset.dispose()}};function QRt(t,e){if(e.compressedTextureETC)return null;const r=t.getExtension("WEBGL_compressed_texture_etc");return r?{COMPRESSED_R11_EAC:r.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:r.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:r.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:r.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:r.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:r.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:r.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:r.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null}function KRt(t,e){if(e.compressedTextureS3TC)return null;const r=t.getExtension("WEBGL_compressed_texture_s3tc");return r?{COMPRESSED_RGB_S3TC_DXT1:r.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:r.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:r.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:r.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}function e$t(t,e){if(e.textureFilterAnisotropic)return null;const r=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");return r?{MAX_TEXTURE_MAX_ANISOTROPY:r.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:r.TEXTURE_MAX_ANISOTROPY_EXT}:null}function t$t(t,e){const r=!e.colorBufferHalfFloat&&t.getExtension("EXT_color_buffer_half_float")||!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_float"),i=!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_float"),n=!e.floatBlend&&!e.colorBufferFloat&&t.getExtension("EXT_float_blend");return r||i||n?{textureFloat:!!i,textureHalfFloat:!!r,floatBlend:!!n,R16F:t.R16F,RG16F:t.RG16F,RGBA16F:t.RGBA16F,R32F:t.R32F,RG32F:t.RG32F,RGBA32F:t.RGBA32F,R11F_G11F_B10F:t.R11F_G11F_B10F,RGB16F:t.RGB16F}:null}function Mye(t,e,r,i,n){if(i)return!0;if(e[r])return!1;for(const s of n)if(t.getExtension(s))return!0;return!1}function r$t(t,e){if(e.textureNorm16)return null;const r=t.getExtension("EXT_texture_norm16");return r?{R16:r.R16_EXT,RG16:r.RG16_EXT,RGB16:r.RGB16_EXT,RGBA16:r.RGBA16_EXT,R16_SNORM:r.R16_SNORM_EXT,RG16_SNORM:r.RG16_SNORM_EXT,RGB16_SNORM:r.RGB16_SNORM_EXT,RGBA16_SNORM:r.RGBA16_SNORM_EXT}:null}function i$t(t,e){const r=e.loseContext&&t.getExtension("WEBGL_lose_context");return r?{loseRenderingContext:()=>r.loseContext()}:null}let n$t=class{constructor(e,r){this._gl=e,this._compressedTextureETC=null,this._compressedTextureS3TC=null,this._textureFilterAnisotropic=null,this._textureFloat=null,this._colorBufferFloat=null,this._loseContext=null,this._textureNorm16=null,this._depthTexture=null,this._textureFloatLinear=null,this._disabledExtensions=r.disabledExtensions||{},this._debugWebGLExtensions=r.debugWebGLExtensions||{}}get compressedTextureETC(){return this._compressedTextureETC||(this._compressedTextureETC=QRt(this._gl,this._disabledExtensions)),this._compressedTextureETC}get compressedTextureS3TC(){return this._compressedTextureS3TC||(this._compressedTextureS3TC=KRt(this._gl,this._disabledExtensions)),this._compressedTextureS3TC}get textureFilterAnisotropic(){return this._textureFilterAnisotropic||(this._textureFilterAnisotropic=e$t(this._gl,this._disabledExtensions)),this._textureFilterAnisotropic}get disjointTimerQuery(){return this._disjointTimerQuery||(this._disjointTimerQuery=pRt(this._gl,this._disabledExtensions)),this._disjointTimerQuery}get textureFloat(){if(!this._textureFloat){const{textureFloatLinear:e}=this._disabledExtensions;this._textureFloat={textureFloatLinear:!e&&!!this._gl.getExtension("OES_texture_float_linear")}}return this._textureFloat}get colorBufferFloat(){return this._colorBufferFloat||(this._colorBufferFloat=t$t(this._gl,this._disabledExtensions)),this._colorBufferFloat}get depthTexture(){return this._depthTexture===null&&(this._depthTexture=Mye(this._gl,this._disabledExtensions,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"])),this._depthTexture}get loseContext(){return this._loseContext||(this._loseContext=i$t(this._gl,this._debugWebGLExtensions)),this._loseContext}get textureNorm16(){return this._textureNorm16||(this._textureNorm16=r$t(this._gl,this._disabledExtensions)),this._textureNorm16}get textureFloatLinear(){return this._textureFloatLinear===null&&(this._textureFloatLinear=Mye(this._gl,this._disabledExtensions,"textureFloatLinear",!1,["OES_texture_float_linear"])),this._textureFloatLinear}enable(e){return this[e]}},s$t=class{constructor(e,r){this.gl=e,this.instanceCounter=new bRt,this.programCache=new jRt(this),this._transformFeedbackRequestInfo=null,this._state=new gye,this._numOfDrawCalls=0,this._numOfTriangles=0,this._loadExtensions(),this.configure(r)}configure(e){this._capabilities=new n$t(this.gl,e),this._parameters=new wRt(this.gl,this._capabilities,e),Sr.TEXTURE_UNIT_FOR_UPDATES=this._parameters.maxTextureImageUnits-1;const r=this.gl.getParameter(this.gl.VIEWPORT);this._state=new gye,this._state.viewport={x:r[0],y:r[1],width:r[2],height:r[3]},this._stateTracker=new Sit({setBlending:i=>{if(i){this.setBlendingEnabled(!0),this.setBlendEquationSeparate(i.opRgb,i.opAlpha),this.setBlendFunctionSeparate(i.srcRgb,i.dstRgb,i.srcAlpha,i.dstAlpha);const n=i.color;this.setBlendColor(n.r,n.g,n.b,n.a)}else this.setBlendingEnabled(!1)},setCulling:i=>{i?(this.setFaceCullingEnabled(!0),this.setCullFace(i.face),this.setFrontFace(i.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:i=>{i?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(i.factor,i.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:i=>{i?(this.setDepthTestEnabled(!0),this.setDepthFunction(i.func)):this.setDepthTestEnabled(!1)},setStencilTest:i=>{if(i){this.setStencilTestEnabled(!0);const n=i.function;this.setStencilFunction(n.func,n.ref,n.mask);const s=i.operation;this.setStencilOp(s.fail,s.zFail,s.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:i=>{i?(this.setDepthWriteEnabled(!0),this.setDepthRange(i.zNear,i.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:i=>{i?this.setColorMask(i.r,i.g,i.b,i.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:i=>{i?this.setStencilWriteMask(i.mask):this.setStencilWriteMask(0)},setDrawBuffers:i=>{const{gl:n}=this;if(i)n.drawBuffers(i.buffers);else{const{drawFramebuffer:s}=this._state;s===null||s.colorAttachments.length===0?n.drawBuffers([hX.BACK]):n.drawBuffers([cl.COLOR_ATTACHMENT0])}}}),this.enforceState(),gt(this._driverTest),this._driverTest=new JRt(this)}dispose(){gt(this._driverTest),this.programCache.dispose(),this.bindVAO(null),this.unbindBuffer(_t.ARRAY_BUFFER),this.unbindBuffer(_t.ELEMENT_ARRAY_BUFFER),this.unbindBuffer(_t.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(_t.PIXEL_PACK_BUFFER),this.unbindBuffer(_t.PIXEL_UNPACK_BUFFER),this.unbindBuffer(_t.COPY_READ_BUFFER),this.unbindBuffer(_t.COPY_WRITE_BUFFER),this._state.textureUnitMap.length=0,bp()&&console.log(this.instanceCounter.resourceInformation)}get driverTest(){return this._driverTest}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){return this._parameters}setPipelineState(e){this._stateTracker.setPipeline(e)}setBlendingEnabled(e){this._state.blend!==e&&(e===!0?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=e,this._stateTracker.invalidateBlending())}externalProgramUpdate(){var e;(e=this._state.program)==null||e.stop(),this._state.program=null}externalTextureUnitUpdate(e,r){for(let i=0;i<e.length;++i)this._state.textureUnitMap[e[i]]=null;r>=0&&(this._state.activeTexture=r)}externalVertexArrayObjectUpdate(){this.gl.bindVertexArray(null),this._state.vertexArrayObject=null,this._state.vertexBuffer=null,this._state.indexBuffer=null}externalVertexBufferUpdate(){this._state.vertexBuffer=null}externalIndexBufferUpdate(){this._state.indexBuffer=null}setBlendColor(e,r,i,n){e===this._state.blendColor.r&&r===this._state.blendColor.g&&i===this._state.blendColor.b&&n===this._state.blendColor.a||(this.gl.blendColor(e,r,i,n),this._state.blendColor.r=e,this._state.blendColor.g=r,this._state.blendColor.b=i,this._state.blendColor.a=n,this._stateTracker.invalidateBlending())}setBlendFunction(e,r){e===this._state.blendFunction.srcRGB&&r===this._state.blendFunction.dstRGB||(this.gl.blendFunc(e,r),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=e,this._state.blendFunction.dstRGB=r,this._state.blendFunction.dstAlpha=r,this._stateTracker.invalidateBlending())}setBlendFunctionSeparate(e,r,i,n){this._state.blendFunction.srcRGB===e&&this._state.blendFunction.srcAlpha===i&&this._state.blendFunction.dstRGB===r&&this._state.blendFunction.dstAlpha===n||(this.gl.blendFuncSeparate(e,r,i,n),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=i,this._state.blendFunction.dstRGB=r,this._state.blendFunction.dstAlpha=n,this._stateTracker.invalidateBlending())}setBlendEquation(e){this._state.blendEquation.mode!==e&&(this.gl.blendEquation(e),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=e,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(e,r){this._state.blendEquation.mode===e&&this._state.blendEquation.modeAlpha===r||(this.gl.blendEquationSeparate(e,r),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=r,this._stateTracker.invalidateBlending())}setColorMask(e,r,i,n){this._state.colorMask.r===e&&this._state.colorMask.g===r&&this._state.colorMask.b===i&&this._state.colorMask.a===n||(this.gl.colorMask(e,r,i,n),this._state.colorMask.r=e,this._state.colorMask.g=r,this._state.colorMask.b=i,this._state.colorMask.a=n,this._stateTracker.invalidateColorWrite())}setClearColor(e,r,i,n){this._state.clearColor.r===e&&this._state.clearColor.g===r&&this._state.clearColor.b===i&&this._state.clearColor.a===n||(this.gl.clearColor(e,r,i,n),this._state.clearColor.r=e,this._state.clearColor.g=r,this._state.clearColor.b=i,this._state.clearColor.a=n)}setFaceCullingEnabled(e){this._state.faceCulling!==e&&(e===!0?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=e,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(e){this._state.polygonOffsetFill!==e&&(e===!0?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=e,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(e,r){this._state.polygonOffset[0]===e&&this._state.polygonOffset[1]===r||(this._state.polygonOffset[0]=e,this._state.polygonOffset[1]=r,this.gl.polygonOffset(e,r),this._stateTracker.invalidatePolygonOffset())}setCullFace(e){this._state.cullFace!==e&&(this.gl.cullFace(e),this._state.cullFace=e,this._stateTracker.invalidateCulling())}setFrontFace(e){this._state.frontFace!==e&&(this.gl.frontFace(e),this._state.frontFace=e,this._stateTracker.invalidateCulling())}setScissorTestEnabled(e){this._state.scissorTest!==e&&(e===!0?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=e)}setScissorRect(e,r,i,n){this._state.scissorRect.x===e&&this._state.scissorRect.y===r&&this._state.scissorRect.width===i&&this._state.scissorRect.height===n||(this.gl.scissor(e,r,i,n),this._state.scissorRect.x=e,this._state.scissorRect.y=r,this._state.scissorRect.width=i,this._state.scissorRect.height=n)}setDepthTestEnabled(e){this._state.depthTest!==e&&(e===!0?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=e,this._stateTracker.invalidateDepthTest())}setClearDepth(e){this._state.clearDepth!==e&&(this.gl.clearDepth(e),this._state.clearDepth=e)}setDepthFunction(e){this._state.depthFunction!==e&&(this.gl.depthFunc(e),this._state.depthFunction=e,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(e){this._state.depthWrite!==e&&(this.gl.depthMask(e),this._state.depthWrite=e,this._stateTracker.invalidateDepthWrite())}setDepthRange(e,r){this._state.depthRange.zNear===e&&this._state.depthRange.zFar===r||(this.gl.depthRange(e,r),this._state.depthRange.zNear=e,this._state.depthRange.zFar=r,this._stateTracker.invalidateDepthWrite())}setStencilTestEnabled(e){this._state.stencilTest!==e&&(e===!0?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=e,this._stateTracker.invalidateStencilTest())}setClearStencil(e){e!==this._state.clearStencil&&(this.gl.clearStencil(e),this._state.clearStencil=e)}setStencilFunction(e,r,i){this._state.stencilFunction.func===e&&this._state.stencilFunction.ref===r&&this._state.stencilFunction.mask===i||(this.gl.stencilFunc(e,r,i),this._state.stencilFunction.face=Up.FRONT_AND_BACK,this._state.stencilFunction.func=e,this._state.stencilFunction.ref=r,this._state.stencilFunction.mask=i,this._stateTracker.invalidateStencilTest())}setStencilFunctionSeparate(e,r,i,n){this._state.stencilFunction.face===e&&this._state.stencilFunction.func===r&&this._state.stencilFunction.ref===i&&this._state.stencilFunction.mask===n||(this.gl.stencilFuncSeparate(e,r,i,n),this._state.stencilFunction.face=e,this._state.stencilFunction.func=r,this._state.stencilFunction.ref=i,this._state.stencilFunction.mask=n,this._stateTracker.invalidateStencilTest())}setStencilWriteMask(e){this._state.stencilWriteMask!==e&&(this.gl.stencilMask(e),this._state.stencilWriteMask=e,this._stateTracker.invalidateStencilWrite())}setStencilOp(e,r,i){this._state.stencilOperation.face===Up.FRONT_AND_BACK&&this._state.stencilOperation.fail===e&&this._state.stencilOperation.zFail===r&&this._state.stencilOperation.zPass===i||(this.gl.stencilOp(e,r,i),this._state.stencilOperation.face=Up.FRONT_AND_BACK,this._state.stencilOperation.fail=e,this._state.stencilOperation.zFail=r,this._state.stencilOperation.zPass=i,this._stateTracker.invalidateStencilTest())}setStencilOpSeparate(e,r,i,n){this._state.stencilOperation.face===e&&this._state.stencilOperation.fail===r&&this._state.stencilOperation.zFail===i&&this._state.stencilOperation.zPass===n||(this.gl.stencilOpSeparate(e,r,i,n),this._state.stencilOperation.face=e,this._state.stencilOperation.fail=r,this._state.stencilOperation.zFail=i,this._state.stencilOperation.zPass=n,this._stateTracker.invalidateStencilTest())}setActiveTexture(e,r=!1){const i=this._state.activeTexture;return e>=0&&(r||e!==this._state.activeTexture)&&(this.gl.activeTexture(FV+e),this._state.activeTexture=e),i}clear(e){e&&this.gl.clear(e)}clearSafe(e,r=255){e&&(e&Ci.COLOR_BUFFER_BIT&&this.setColorMask(!0,!0,!0,!0),e&Ci.DEPTH_BUFFER_BIT&&this.setDepthWriteEnabled(!0),e&Ci.STENCIL_BUFFER_BIT&&this.setStencilWriteMask(r),this.gl.clear(e))}clearFramebuffer(e,r=!1,i=!1){let n=0;if(e){const o=Math.max(1e-13,e[3]);this.setClearColor(e[0],e[1],e[2],o),n|=Ci.COLOR_BUFFER_BIT}r&&(n|=Ci.DEPTH_BUFFER_BIT),i===!1?i=0:(i===!0&&(i=255),n|=Ci.STENCIL_BUFFER_BIT),n&&this.clearSafe(n,i)}drawArrays(e,r,i){var n,s;if(this._transformFeedbackRequestInfo){if(e!==this._transformFeedbackRequestInfo.primitiveType)throw new Error("DrawArrays called during transform feedback, but primitiveType does not match that of the current transform feedback request");if(((n=this._state.program)==null?void 0:n.hasTransformFeedbackVaryings)==null)throw new Error("DrawArrays called during transform feedback, but the shader program was not linked with a transform feedback varying")}if(bp()){this._numOfDrawCalls++,this._numOfTriangles+=Oye(e,i);const o=this._state.textureUnitMap;for(let a=0;a<o.length;a++){const l=o[a];if(l!=null&&l===((s=this._state.drawFramebuffer)==null?void 0:s.colorTexture))throw new Error(`Detected readWrite. Texture already bound at index ${a}`)}}this.gl.drawArrays(e,r,i),Pm(this.gl)}drawArraysInstanced(e,r,i,n){this.gl.drawArraysInstanced(e,r,i,n),Pm(this.gl)}drawElements(e,r,i,n){if(this._transformFeedbackRequestInfo)throw new Error("Cannot called drawElements during a transform feedback request");if(bp()&&(this._numOfDrawCalls++,this._numOfTriangles+=Oye(e,r)),this.gl.drawElements(e,r,i,n),bp()){const s=kPe(this);if(s){const o=this.getBoundVAO(),a=o==null?void 0:o.indexBuffer,l=o==null?void 0:o.vertexBuffers,c={indexBuffer:a,vertexBuffers:l},u={mode:e,count:r,type:i,offset:n},h=(a==null?void 0:a.size)??0,p=n+r,f=h<p?`. Buffer is too small. Attempted to draw index ${p} of ${h}`:"";console.error(`drawElements: ${s}${f}`,{args:u,vao:c})}}}logInfo(){bp()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)}resetInfo(){bp()&&(this._numOfDrawCalls=0,this._numOfTriangles=0)}get capabilities(){return this._capabilities}setViewport(e,r,i,n){i=Math.max(Math.round(i),1),n=Math.max(Math.round(n),1);const s=this._state.viewport;s.x===e&&s.y===r&&s.width===i&&s.height===n||(s.x=e,s.y=r,s.width=i,s.height=n,this.gl.viewport(e,r,i,n))}setViewport4fv(e){this.setViewport(e[0],e[1],e[2],e[3])}restoreViewport({x:e,y:r,width:i,height:n}){this.setViewport(e,r,i,n)}getViewport(){const e=this._state.viewport;return{x:e.x,y:e.y,width:e.width,height:e.height}}useProgram(e){var r;this._state.program!==e&&((r=this._state.program)==null||r.stop(),this._state.program=e,this.gl.useProgram((e==null?void 0:e.glName)??null))}bindTexture(e,r,i=!1){(r>=this.parameters.maxTextureImageUnits||r<0)&&console.error("Input texture unit is out of range of available units!");const n=this._state.textureUnitMap[r];return(e==null?void 0:e.glName)==null?(n!=null&&(this.setActiveTexture(r,i),this.gl.bindTexture(n.descriptor.target,null)),this._state.textureUnitMap[r]=null,n):i||n!==e?(this.setActiveTexture(r,i),this.gl.bindTexture(e.descriptor.target,e.glName),e.applyChanges(),this._state.textureUnitMap[r]=e,n):(e.isDirty&&(this.setActiveTexture(r,i),e.applyChanges()),n)}unbindTexture(e){if(e!=null)for(let r=0;r<this.parameters.maxTextureImageUnits;r++)this._state.textureUnitMap[r]===e&&(this.bindTexture(null,r),this._state.textureUnitMap[r]=null)}bindFramebuffer(e,r=!1){if(r||this._state.readFramebuffer!==e||this._state.drawFramebuffer!==e){if(this._stateTracker.invalidateDrawBuffers(),e==null)return this.gl.bindFramebuffer(Sa.FRAMEBUFFER,null),void(this._state.readFramebuffer=this._state.drawFramebuffer=null);e.initializeAndBind(Sa.FRAMEBUFFER),this._state.readFramebuffer=e,this._state.drawFramebuffer=e}}bindFramebufferSeparate(e,r,i=!1){const n=r===Sa.READ_FRAMEBUFFER,s=n?this._state.readFramebuffer:this._state.drawFramebuffer;(i||s!==e)&&(e==null?this.gl.bindFramebuffer(r,null):e.initializeAndBind(r),n?this._state.readFramebuffer=e??null:this._state.drawFramebuffer=e??null)}blitFramebuffer(e,r,i=0,n=0,s=e.width,o=e.height,a=0,l=0,c=r.width,u=r.height,h=Ci.COLOR_BUFFER_BIT,p=Ht.NEAREST){this.bindFramebufferSeparate(e,Sa.READ_FRAMEBUFFER),this.bindFramebufferSeparate(r,Sa.DRAW_FRAMEBUFFER),this.gl.blitFramebuffer(i,n,s,o,a,l,c,u,h,p)}bindBuffer(e,r){if(e)switch(r??(r=e.bufferType),r){case _t.ARRAY_BUFFER:this._state.vertexBuffer=Ll(this.gl,e,r,this._state.vertexBuffer);break;case _t.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=Ll(this.gl,e,r,this._state.indexBuffer);break;case _t.UNIFORM_BUFFER:this._state.uniformBuffer=Ll(this.gl,e,r,this._state.uniformBuffer);break;case _t.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=Ll(this.gl,e,r,this._state.pixelPackBuffer);break;case _t.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=Ll(this.gl,e,r,this._state.pixelUnpackBuffer);break;case _t.COPY_READ_BUFFER:this._state.copyReadBuffer=Ll(this.gl,e,r,this._state.copyReadBuffer);break;case _t.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=Ll(this.gl,e,r,this._state.copyWriteBuffer);break;case _t.TRANSFORM_FEEDBACK_BUFFER:this._state.transformFeedbackBuffer=Ll(this.gl,e,r,this._state.transformFeedbackBuffer)}}bindRenderbuffer(e){const r=this.gl;e||(r.bindRenderbuffer(r.RENDERBUFFER,null),this._state.renderbuffer=null),this._state.renderbuffer!==e&&(r.bindRenderbuffer(r.RENDERBUFFER,e.glName),this._state.renderbuffer=e)}_getBufferBinding(e,r){if(r>=this.parameters.maxUniformBufferBindings||r<0)return console.error("Uniform buffer binding point is out of range!"),null;const i=e===_t.UNIFORM_BUFFER?this._state.uniformBufferBindingPoints:this._state.transformBufferBindingPoints;let n=i[r];return n==null&&(n={buffer:null,offset:0,size:0},i[r]=n),n}bindBufferBase(e,r,i){const n=this._getBufferBinding(e,r);n!=null&&(n.buffer===i&&n.offset===0&&n.size===0||(this.gl.bindBufferBase(e,r,i?i.glName:null),n.buffer=i,n.offset=0,n.size=0))}bindBufferRange(e,r,i,n,s){const o=this._getBufferBinding(e,r);o!=null&&(o.buffer===i&&o.offset===n&&o.size===s||(n%this._parameters.uniformBufferOffsetAlignment==0?(this.gl.bindBufferRange(e,r,i.glName,n,s),o.buffer=i,o.offset=n,o.size=s):console.error("Uniform buffer binding offset is not a multiple of the context offset alignment")))}bindUBO(e,r,i,n){r!=null?(bp()&&(n??r.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),r.initialize(),i!==void 0&&n!==void 0?this.bindBufferRange(_t.UNIFORM_BUFFER,e,r.buffer,i,n):this.bindBufferBase(_t.UNIFORM_BUFFER,e,r.buffer)):this.bindBufferBase(_t.UNIFORM_BUFFER,e,null)}unbindUBO(e){for(let r=0,i=this._state.uniformBufferBindingPoints.length;r<i;r++){const n=this._state.uniformBufferBindingPoints[r];n!=null&&n.buffer===e.buffer&&this.bindBufferBase(_t.UNIFORM_BUFFER,r,null)}}unbindBuffer(e){switch(e){case _t.ARRAY_BUFFER:this._state.vertexBuffer=Ll(this.gl,null,e,this._state.vertexBuffer);break;case _t.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=Ll(this.gl,null,e,this._state.indexBuffer);break;case _t.UNIFORM_BUFFER:this._state.uniformBuffer=Ll(this.gl,null,e,this._state.uniformBuffer);break;case _t.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=Ll(this.gl,null,e,this._state.pixelPackBuffer);break;case _t.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=Ll(this.gl,null,e,this._state.pixelUnpackBuffer);break;case _t.COPY_READ_BUFFER:this._state.copyReadBuffer=Ll(this.gl,null,e,this._state.copyReadBuffer);break;case _t.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=Ll(this.gl,null,e,this._state.copyWriteBuffer)}}bindVAO(e=null){e!=null?this._state.vertexArrayObject!==e&&(e.bind(),this._state.vertexArrayObject=e):this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null)}bindTransformFeedback(e){const{gl:r}=this;r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,e.glName)}beginTransformFeedback(e,r){if(this._transformFeedbackRequestInfo)throw new Error("Already in a transform feedback request");const{gl:i}=this;i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,e.glName),i.beginTransformFeedback(r),this._transformFeedbackRequestInfo={primitiveType:r}}endTransformFeedback(){if(!this._transformFeedbackRequestInfo)throw new Error("Not in a transform feedback request");const{gl:e}=this;e.endTransformFeedback(),e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),this._transformFeedbackRequestInfo=null}async clientWaitAsync(e=10){const{gl:r}=this,i=r.fenceSync(dX.SYNC_GPU_COMMANDS_COMPLETE,0);if(!i)throw new Error("Client wait failed, could not create sync object");let n;this.instanceCounter.increment(Wn.Sync,i),r.flush();do await i$(e),n=r.clientWaitSync(i,0,0);while(n===z6.TIMEOUT_EXPIRED);if(this.instanceCounter.decrement(Wn.Sync,i),r.deleteSync(i),n===z6.WAIT_FAILED)throw new Error("Client wait failed")}getBoundFramebufferObject(e=Sa.FRAMEBUFFER){return e===Sa.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer}getBoundVAO(){return this._state.vertexArrayObject}resetState(){this.useProgram(null),this.bindVAO(null),this.bindFramebuffer(null,!0),this.unbindBuffer(_t.ARRAY_BUFFER),this.unbindBuffer(_t.ELEMENT_ARRAY_BUFFER),this.unbindBuffer(_t.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(_t.PIXEL_PACK_BUFFER),this.unbindBuffer(_t.PIXEL_UNPACK_BUFFER),this.unbindBuffer(_t.COPY_READ_BUFFER),this.unbindBuffer(_t.COPY_WRITE_BUFFER);for(let e=0;e<this.parameters.maxTextureImageUnits;++e)this.bindTexture(null,e);this.setBlendingEnabled(!1),this.setBlendFunction(Se.ONE,Se.ZERO),this.setBlendEquation(ug.ADD),this.setBlendColor(0,0,0,0),this.setFaceCullingEnabled(!1),this.setCullFace(Up.BACK),this.setFrontFace(i3.CCW),this.setPolygonOffsetFillEnabled(!1),this.setPolygonOffset(0,0),this.setScissorTestEnabled(!1),this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height),this.setDepthTestEnabled(!1),this.setDepthFunction(Xr.LESS),this.setDepthRange(0,1),this.setStencilTestEnabled(!1),this.setStencilFunction(Xr.ALWAYS,0,0),this.setStencilOp(cn.KEEP,cn.KEEP,cn.KEEP),this.setClearColor(0,0,0,0),this.setClearDepth(1),this.setClearStencil(0),this.setColorMask(!0,!0,!0,!0),this.setStencilWriteMask(4294967295),this.setDepthWriteEnabled(!0),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){var i,n,s;const{gl:e}=this;e.bindVertexArray(null);for(let o=0;o<this.parameters.maxVertexAttributes;o++)e.disableVertexAttribArray(o);this._state.vertexBuffer?e.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):e.bindBuffer(_t.ARRAY_BUFFER,null),this._state.indexBuffer?e.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):e.bindBuffer(_t.ELEMENT_ARRAY_BUFFER,null),this._state.uniformBuffer?e.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):e.bindBuffer(_t.UNIFORM_BUFFER,null);for(let o=0;o<this._parameters.maxUniformBufferBindings;o++){const a=this._state.uniformBufferBindingPoints[o];if(a!=null){const{buffer:l,offset:c,size:u}=a;l!==null?c===0&&u===0?e.bindBufferBase(_t.UNIFORM_BUFFER,o,l.glName):e.bindBufferRange(_t.UNIFORM_BUFFER,o,l.glName,c,u):e.bindBufferBase(_t.UNIFORM_BUFFER,o,null)}}if(this._state.pixelPackBuffer?e.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):e.bindBuffer(_t.PIXEL_PACK_BUFFER,null),this._state.pixelUnpackBuffer?e.bindBuffer(this._state.pixelUnpackBuffer.bufferType,this._state.pixelUnpackBuffer.glName):e.bindBuffer(_t.PIXEL_UNPACK_BUFFER,null),this._state.copyReadBuffer?e.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):e.bindBuffer(_t.COPY_READ_BUFFER,null),this._state.copyWriteBuffer?e.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):e.bindBuffer(_t.COPY_WRITE_BUFFER,null),e.bindFramebuffer(Sa.READ_FRAMEBUFFER,null),e.readBuffer(e.BACK),this._state.readFramebuffer&&(e.bindFramebuffer(Sa.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),e.readBuffer(cl.COLOR_ATTACHMENT0)),e.bindFramebuffer(Sa.DRAW_FRAMEBUFFER,((i=this._state.drawFramebuffer)==null?void 0:i.glName)??null),this._state.vertexArrayObject){const o=this._state.vertexArrayObject;this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null),this.bindVAO(o)}e.useProgram(((n=this._state.program)==null?void 0:n.glName)??null),e.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a),e.bindRenderbuffer(e.RENDERBUFFER,((s=this._state.renderbuffer)==null?void 0:s.glName)??null),this._state.blend===!0?e.enable(this.gl.BLEND):e.disable(this.gl.BLEND),e.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha),e.blendFuncSeparate(this._state.blendFunction.srcRGB,this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha),e.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a),e.clearDepth(this._state.clearDepth),e.clearStencil(this._state.clearStencil),e.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a),e.cullFace(this._state.cullFace),e.depthFunc(this._state.depthFunction),e.depthRange(this._state.depthRange.zNear,this._state.depthRange.zFar),this._state.depthTest===!0?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),e.depthMask(this._state.depthWrite),e.frontFace(this._state.frontFace),e.lineWidth(1),this._state.faceCulling===!0?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),e.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]),this._state.polygonOffsetFill===!0?e.enable(e.POLYGON_OFFSET_FILL):e.disable(e.POLYGON_OFFSET_FILL),e.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,this._state.scissorRect.height),this._state.scissorTest===!0?e.enable(e.SCISSOR_TEST):e.disable(e.SCISSOR_TEST),e.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask),e.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass),this._state.stencilTest===!0?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),e.stencilMask(this._state.stencilWriteMask);for(let o=0;o<this.parameters.maxTextureImageUnits;o++){e.activeTexture(FV+o),e.bindTexture(Sn.TEXTURE_2D,null),e.bindTexture(Sn.TEXTURE_CUBE_MAP,null),e.bindTexture(Sn.TEXTURE_3D,null),e.bindTexture(Sn.TEXTURE_2D_ARRAY,null);const a=this._state.textureUnitMap[o];a!=null&&e.bindTexture(a.descriptor.target,a.glName)}e.activeTexture(FV+this._state.activeTexture);const r=this._state.viewport;e.viewport(r.x,r.y,r.width,r.height),this.resetInfo()}_loadExtensions(){this.gl.getExtension("KHR_parallel_shader_compile")}};function Ll(t,e,r,i){return e?i!==e&&t.bindBuffer(r,e.glName):t.bindBuffer(r,null),e}function Oye(t,e){switch(t){case sr.POINTS:return 2*e;case sr.TRIANGLES:return e/3;case sr.TRIANGLE_STRIP:case sr.TRIANGLE_FAN:return e-2;default:return 0}}let o$t=class extends s$t{constructor(e,r,i){super(e,r),this.gl=e,this.newCache=i,this._appleAmdDriverHelper=null,this._refCount=1,this.screen=new _Rt(this)}destroy(){--this._refCount>0||this.dispose()}ref(){++this._refCount}dispose(){var e;super.dispose(),(e=this._appleAmdDriverHelper)==null||e.dispose(),this.screen.destroy()}bindTechnique(e,r,i,n,s){return this.useProgram(e.program),this.setPipelineState(e.getPipeline(!!s)),e.program.bindPass(i,r),n&&e.program.bindDraw(n,r,i),e.program}runAppleAmdDriverHelper(){this.driverTest.drawArraysRequiresIndicesTypeReset.result&&(this._appleAmdDriverHelper??(this._appleAmdDriverHelper=new Z5e(this)),this._appleAmdDriverHelper.run())}get test(){var e;return{cachedWebGLObjects:this.programCache.test.cachedWebGLProgramObjects+this.screen.test.cachedWebGLObjects+(((e=this._appleAmdDriverHelper)==null?void 0:e.test.cachedWebGLObjects)??0)}}};function Rye(t){return!!t.frameUpdate}let kS=class extends Ae{constructor(e,r,i){super({}),this._stage=e,this._techniqueRepository=r,this._rctx=i,this._textures=new Map,this._loadingCount=0,this._frameUpdates=new Map,this.events=new Qn,this._frameTask=e.view.resourceController.scheduler.registerTask(bt.TEXTURE_UNLOAD)}normalizeCtorArgs(){return{}}destroy(){this._frameTask.remove(),this._stage.forEachOfType(Cn.Texture,e=>e.unload())}get updating(){return this._loadingCount>0||this._frameTask.updating}get textureTechnique(){return this._textureTechnique==null&&(this._textureTechnique=this._techniqueRepository.acquire(Fie,new kie)),this._textureTechnique}acquire(e){const r=this._textures.get(e);return r?(r.ref(),r.loadingPromise??r):this._createNewRef(e)}update(){let e=!1;this._frameUpdates.forEach(r=>{const i=r.texture.frameUpdate(r.previousToken);i>=0&&i!==r.previousToken&&(r.previousToken=i,e=!0)}),e&&this.events.emit("changed",Dn.BACKGROUND)}_createNewRef(e){const r=this._stage.getObject(e);if(r==null)return pt(r!==void 0),null;const i=r.events.on("unloaded",()=>{i.remove(),this._onTextureUnloaded(e)}),n=new a$t(e,()=>{this._frameTask.schedule(()=>{n.isUnreferenced&&r.unload()})});return this._textures.set(e,n),n.ref(),r.glTexture?(this._updateGLTexture(n,r.glTexture),Rye(r)&&this._frameUpdates.set(e,{texture:r,previousToken:-1}),n):(this._loadingCount++,n.loadingPromise=this._stage.schedule(()=>{const s=r.load(this._rctx),o=l=>(this._loadingCount--,n.loadingPromise=null,this._updateGLTexture(n,l),Rye(r)&&this._frameUpdates.set(e,{texture:r,previousToken:-1}),n),a=l=>(this._loadingCount--,n.loadingPromise=null,_s(l)||re.getLogger(this).error(l),null);return nu(s)?s.then(o,a):o(s)}),n.loadingPromise)}_updateGLTexture(e,r){e.glTexture=r,this.events.emit("changed",Dn.UPDATE)}_onTextureUnloaded(e){this._textures.delete(e),this._frameUpdates.delete(e)}};d([m()],kS.prototype,"_loadingCount",void 0),d([m()],kS.prototype,"_frameTask",void 0),d([m()],kS.prototype,"updating",null),kS=d([V("esri.views.3d.webgl-engine.lib.TextureRepository")],kS);let a$t=class{constructor(e,r){this.id=e,this._release=r,this._refCount=0}get isUnreferenced(){return this._refCount===0}ref(){++this._refCount}release(){--this._refCount,this._refCount>0||(this._refCount!==0?(re.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository.RefCountedTextureImpl").error("Cannot dereference texture that has no references!"),this._refCount=0):this._release())}};function l$t(t,e){return new Q$e(r=>Zmt(r,t),r=>r,e)}let CO=class extends Ae{constructor(){super(...arguments),this._passParameters=new c$t,this._resourcesTask=null}get passParameters(){return this._passParameters}destroy(){this._resourcesTask=wl(this._resourcesTask),this._passParameters.waveNormal=gt(this._passParameters.waveNormal),this._passParameters.wavePerturbation=gt(this._passParameters.wavePerturbation)}get updating(){return!!this._resourcesTask&&!this._resourcesTask.finished}ensureResources(e){return this._resourcesTask||(this._resourcesTask=dy(async r=>{await Promise.allSettled([this._loadImageResource(e,ii("esri/images/materials/water/normals.jpg"),i=>this._passParameters.waveNormal=i,r),this._loadImageResource(e,ii("esri/images/materials/water/perturbation.jpg"),i=>this._passParameters.wavePerturbation=i,r)])})),this._resourcesTask.finished?gv.LOADED:gv.LOADING}async _loadImageResource(e,r,i,n){try{const s=await cy(r,{signal:n});vt(n);const o=new ri(s.width,s.height);o.pixelFormat=Tt.RGB,o.samplingMode=Ht.LINEAR_MIPMAP_LINEAR,o.hasMipmap=!0,o.maxAnisotropy=8,i(new Sr(e,o,s))}catch(s){re.getLogger(this).error("Failed to load water material normal texture.",s)}}};d([m()],CO.prototype,"_resourcesTask",void 0),d([m({type:Boolean,readOnly:!0})],CO.prototype,"updating",null),CO=d([V("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],CO);let c$t=class extends Ai{};const $ye=2048,u$t=1.5,h$t=8;function d$t(t,e){const{format:r,quality:i,rotation:n,disableDecorations:s}=t||{},o=nse(t,e.padding),a=v$t(t,{width:e.width-o.left-o.right,height:e.height-o.top-o.bottom}),{width:l,height:c}=_$t(t,a),u=x$t(r),h=P$t[u];return{format:u,quality:we(i??h,0,100),area:a,width:l,height:c,rotation:n,disableDecorations:!!s,ignoreBackground:!!(t!=null&&t.ignoreBackground),ignorePadding:!!(t!=null&&t.ignorePadding)}}function p$t(t,e){const r=d$t(t,e),i=r.area,n=r.width/i.width,s=nse(r,e.padding),o=s.left+s.right,a=s.top+s.bottom,l=e.width-o,c=e.height-a,u=Math.floor(l*n+o),h=Math.floor(c*n+a),p=(t==null?void 0:t.layers)??[],f=r.ignoreBackground,g=r.ignorePadding;return{framebufferWidth:u,framebufferHeight:h,region:{x:Math.floor(i.x*n)+s.left,y:Math.floor(i.y*n)+s.top,width:r.width,height:r.height},format:r.format,quality:r.quality,rotation:r.rotation,pixelRatio:n,layers:p,disableDecorations:r.disableDecorations,ignoreBackground:f,ignorePadding:g,objectAndLayerIdColor:!1}}function Lj(t,e,r){const{ctx:i,canvas:n}=rFe(t,r),s=i.getImageData(0,0,t.width,t.height),o=m$t(n,e);return iFe(n),{dataUrl:o,data:s}}function Dj(t,e){const{ctx:r,canvas:i}=rFe(t,e),n=r.getImageData(0,0,t.width,t.height);return iFe(i),n}function rFe(t,e){const r=f$t();e.premultipliedAlpha&&S$t(t),r.width=t.width,r.height=t.height;const i=r.getContext("2d",{willReadFrequently:!0});return i.putImageData(t,0,0),e.flipY&&T$t(i),{ctx:i,canvas:r}}function iFe(t){t.width=0,t.height=0}function f$t(){return Nj==null&&(Nj=document.createElement("canvas")),Nj}let Nj=null;function m$t(t,e){const r=C$t[e.format],i=e.quality/100;return t.toDataURL(r,i)}function g$t(t,e,r,i=0,n=0,s=t.width-i,o=t.height-n,a=!1){const{data:l}=t,{width:c,height:u,data:h}=e,p=s/c,f=o/u,g=Math.ceil(p/2),_=Math.ceil(f/2),v=t.width;for(let b=0;b<u;b++)for(let w=0;w<c;w++){const x=4*(w+(a?u-b-1:b)*c);let S=0,E=0,A=0,O=0,L=0,z=0;const k=(b+.5)*f;for(let q=Math.floor(b*f);q<(b+1)*f;q++){const B=Math.abs(k-(q+.5))/_,J=(w+.5)*p,W=B*B;for(let Y=Math.floor(w*p);Y<(w+1)*p;Y++){const le=Math.abs(J-(Y+.5))/g,D=Math.sqrt(W+le*le);if(D>=1)continue;let I=2*D*D*D-3*D*D+1;const F=4*(i+Y+(n+q)*v);z+=I*l[F+3],E+=I,!r&&l[F+3]<255&&(I=I*l[F+3]/255),A+=I*l[F],O+=I*l[F+1],L+=I*l[F+2],S+=I}}h[x]=A/S,h[x+1]=O/S,h[x+2]=L/S,h[x+3]=z/E}return e}function y$t(t,e,r){if(!e)return t;const{framebufferWidth:i,framebufferHeight:n,pixelRatio:s,region:o}=t,a=nse(t,r),l=a.left+a.right,c=a.top+a.bottom,u=i-l,h=n-c,p=Math.min(h$t,Math.min(($ye-l)/u,($ye-c)/h));return p<u$t?t:{...t,framebufferWidth:Math.round(u*p)+l,framebufferHeight:Math.round(h*p)+c,pixelRatio:s*p,resample:{region:{x:Math.round((o.x-a.left)*p)+a.left,y:Math.round((o.y-a.top)*p)+a.top,width:Math.round(o.width*p),height:Math.round(o.height*p)},width:i,height:n}}}function _$t(t,e){if(!t)return e;const r=t.width,i=t.height;if(r!=null&&i!=null)return{width:Math.floor(r),height:Math.floor(i)};if(r==null&&i==null)return e;const n=e.width/e.height;return i==null?{width:Math.floor(r),height:Math.floor(r/n)}:{width:Math.floor(i*n),height:Math.floor(i)}}function v$t(t,e){const r={x:0,y:0,width:e.width,height:e.height};if(t!=null&&t.area){t.area.x!=null&&(r.x=Math.floor(t.area.x)),t.area.y!=null&&(r.y=Math.floor(t.area.y));const i=t.area.width!=null?Math.floor(t.area.width):null,n=t.area.height!=null?Math.floor(t.area.height):null;if(r.width=e.width-r.x,r.height=e.height-r.y,i!=null&&n!=null)r.width=Math.min(r.width,i),r.height=Math.min(r.height,n);else if(i==null&&n!=null){const s=Math.min(r.width,i);r.height=s/r.width*r.height,r.width=s}else if(i!=null&&n==null){const s=Math.min(r.height,n);r.width=s/r.height*r.width,r.height=s}}return b$t(w$t(r,t),e)}function b$t(t,e){const r=Math.floor(Math.max(t.x,0)),i=Math.floor(Math.max(t.y,0)),n={x:r,y:i,width:Math.floor(Math.min(t.width,e.width-r)),height:Math.floor(Math.min(t.height,e.height-i))},s=n.width/n.height,o=t.width/t.height;if(o===s)return n;if(o>s){const c=Math.floor(n.width/o),u=n.height-c;return{x:n.x,y:Math.floor(n.y+u/2),width:n.width,height:c}}const a=Math.floor(n.height*o),l=n.width-a;return{x:Math.floor(n.x+l/2),y:n.y,width:a,height:n.height}}function w$t(t,e){if((e==null?void 0:e.width)==null||e.height==null)return t;const r=e.width/e.height,i=t.width/t.height;if(i===r)return t;if(i<r){const s=Math.floor(t.height*r);return t.x-=(s-t.width)/2,t.width=s,t}const n=Math.floor(t.width/r);return t.y-=(n-t.height)/2,t.height=n,t}function nse(t,e){return!e||t&&t.ignorePadding?A$t:e}function x$t(t){switch(t){case"png":case"jpg":case"jpeg":return t;default:return E$t}}function T$t(t){t.save(),t.globalCompositeOperation="copy",t.scale(1,-1),t.translate(0,-t.canvas.height),t.drawImage(t.canvas,0,0),t.restore()}function S$t(t){const e=t.data,r=e.length;for(let i=0;i<r;i+=4){const n=e[i+3];if(n!==255&&n>0){const s=255/n;e[i]=e[i]*s,e[i+1]=e[i+1]*s,e[i+2]=e[i+2]*s}}}const C$t={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},Iye=98,E$t="png",P$t={png:100,jpg:Iye,jpeg:Iye},A$t={top:0,right:0,bottom:0,left:0};let M$t=class{constructor(e,r,i){this.parameters=e,this.frameHasDecorations=r,this.fbos=i}},O$t=class{constructor(e,r,i){this._rctx=e,this._renderFunctions=r,this._forceCameraHook=i,this.supersample=!0,this._screenshotQueue=new Array}destroy(){this._rctx=null}async takeScreenshot(e){await this._renderFunctions.prepareOverlay(),this._renderFunctions.requestRenderScene(Dn.BACKGROUND);const r=ha();return this._screenshotQueue.push({settings:e,resolver:r}),r.promise}update(e,r){for(const i of this._screenshotQueue){if(this._rctx==null){i.resolver.reject();continue}const n={...i.settings,pixelRatio:i.settings.pixelRatio*e.parameters.camera.pixelRatio},s=this._renderScreenshot(e,n,r);i.resolver(s)}this._screenshotQueue.length=0}_renderScreenshotOverlay(e,r,i){e.width=r.width,e.height=r.height;const n=e.getContext("2d"),s=i.pixelRatio;return n.save(),n.translate(0,r.height),n.scale(1,-1),i.region&&n.translate(-i.region.x,-i.region.y),n.scale(s,s),r=this._renderFunctions.renderOverlay(e,i.disableDecorations?Xl.OFF:Xl.ON,r),n.restore(),r}_readbackScreenshot(e,r){return e.resample?this._readbackScreenshotResampled({...e,resample:e.resample},r):this._readbackScreenshotImmediate(e,r)}_readbackScreenshotResampled(e,r){const{framebufferWidth:i,framebufferHeight:n,region:s,resample:o}=e,a=this._ensureScreenshotEncodeCanvas();let l=xG(i,n,a);this._rctx.gl.readPixels(0,0,i,n,Tt.RGBA,qe.UNSIGNED_BYTE,new Uint8Array(l.data.buffer)),r(),l=this._renderScreenshotOverlay(a,l,{...e,region:void 0});const c=xG(s.width,s.height,a);return g$t(l,c,!0,o.region.x,n-(o.region.y+o.region.height),o.region.width,o.region.height)}_readbackScreenshotImmediate(e,r){const{framebufferHeight:i,region:n}=e,s=this._ensureScreenshotEncodeCanvas(),o=xG(n.width,n.height,s);return this._rctx.gl.readPixels(n.x,i-(n.y+n.height),n.width,n.height,Tt.RGBA,qe.UNSIGNED_BYTE,new Uint8Array(o.data.buffer)),r(),this._renderScreenshotOverlay(s,o,e)}_renderScreenshot(e,r,i){const n=e.parameters.camera,s={width:r.framebufferWidth,height:r.framebufferHeight};px(s,Math.min(this._rctx.parameters.maxTextureSize,this._rctx.parameters.maxRenderbufferSize));let o=!1;const a=r.disableDecorations&&e.frameHasDecorations,l=s.width!==n.fullWidth||s.height!==n.fullHeight,c=r.ignorePadding&&n.pixelRatio!==r.pixelRatio,u=l||a||c||r.objectAndLayerIdColor;let h=null,p=null;if(u){const v=n.clone();if(r.ignorePadding){const E=NI(v.padding);for(let A=0;A<4;A++)E[A]=Math.round(E[A]/v.pixelRatio*r.pixelRatio);v.padding=E}v.fullWidth=s.width,v.fullHeight=s.height,v.pixelRatio=r.pixelRatio;const b=n.fovX-v.fovX,w=n.fovY-v.fovY;b<0&&b<w?v.fovX=n.fovX:w<0&&w<b&&(v.fovY=n.fovY);const x={camera:v,contentCamera:v,mode:Ur.IDLE,alignPixelEnabled:!0,contentPixelRatio:v.pixelRatio};this._forceCameraHook(x),o=!0;const S=this._renderFunctions.renderScene(x,i,r.objectAndLayerIdColor?Op.ObjectAndLayerID:Op.Screenshot,r.disableDecorations?Xl.OFF:Xl.ON);p=S.screen,h=S.oid}const f=()=>{this._rctx.bindFramebuffer(null),p==null||p.release()};this._rctx.bindFramebuffer(p==null?void 0:p.fbo);const g=this._readbackScreenshot(r,f);let _=null;if(r.objectAndLayerIdColor){const v=()=>{this._rctx.bindFramebuffer(null),h==null||h.release()};this._rctx.bindFramebuffer(h==null?void 0:h.fbo),_=this._readbackScreenshot(r,v),this._rctx.bindFramebuffer(null)}if(u&&!this._rctx.contextAttributes.alpha)for(let v=3;v<g.data.length;v+=4)g.data[v]=255;if(_&&!this._rctx.contextAttributes.alpha)for(let v=3;v<_.data.length;v+=4)_.data[v]=255;return o&&this._forceCameraHook(e.parameters),[g,_]}_ensureScreenshotEncodeCanvas(){return this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas")),this._screenshotEncodeCanvas}};function ZJ(t,e={}){return t.getContext("webgl2",e)||null}let Ro=class extends Ae{constructor(t){super({}),this.events=new Qn,this.waterTextures=new CO,this._magnifierHelper=new LS,this.objectAndLayerIdRenderHelper=se("enable-feature:objectAndLayerId-rendering")?new KMt:null,this._needsUpdate=!0,this._needsRender=!0,this._idleSuspend=!0,this._needsWaterReflectionUpdate=!1,this._lastAnimationUpdate=0,this._container=t.container,this._viewingMode=t.viewingMode;try{this._initializeContext(t)}catch(i){return void console.error("Failed to initialize context",i)}this.addHandles([he(()=>{var i;return(i=this.waterTextures)==null?void 0:i.updating},()=>this.requestRender(),gi),he(()=>t.view.qualityProfile,i=>{var n;return(n=this.renderer)==null?void 0:n.updateRenderFeatures(i)},Kr),this._magnifierHelper.events.on("request-render",()=>this.requestRender())]);const{memoryController:e}=t.view.resourceController;this.stippleTextures=smt(this._rctx,e),this.markerTextures=l$t(this._rctx,e),this._shaderTechniques=new W$e({rctx:this._rctx,viewingMode:t.viewingMode,stippleTextureRepository:this.stippleTextures,waterTextureRepository:this.waterTextures,markerTextureRepository:this.markerTextures}),this._textures=new kS(t,this._shaderTechniques,this._rctx),this.addHandles(this._textures.events.on("changed",i=>this.requestRender(i))),this._materialRepository=new q$e(this._textures,this._shaderTechniques,()=>this.requestRender(),()=>this.requestRender()),this._compositingHelper=new RMt(this._rctx,this._shaderTechniques),this.renderer=new FS(t,this._materialRepository,this._textures,this._shaderTechniques,this._rctx,this._compositingHelper,this._magnifierHelper,i=>this.requestRender(i));const r={renderScene:(i,n,s,o)=>this.renderer.render(i,n,s,o),requestRenderScene:i=>this.requestRender(i),prepareOverlay:()=>t.options.screenshot.prepareOverlay(),renderOverlay:(i,n,s)=>t.options.screenshot.renderOverlay(i,n,s)};this._screenshotManager=new O$t(this._rctx,r,i=>this.events.emit("force-camera-for-screenshot",i)),this._registerFrameTask(t)}normalizeCtorArgs(){return{}}destroy(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas),this._frameTask=wi(this._frameTask),this._shaderTechniques=Pe(this._shaderTechniques),this._componentObjects=Pe(this._componentObjects),this._screenshotManager=Pe(this._screenshotManager),Pe(this.renderer),this._textures=Pe(this._textures),Pe(this._magnifierHelper),Pe(this.waterTextures),Pe(this.markerTextures),Pe(this.stippleTextures),this._canvas=null,this._container=null,this._rctx=Pe(this._rctx)}requestRender(t=Dn.UPDATE){this._needsRender=!0,t===Dn.UPDATE&&(this._needsUpdate=!0)}get updating(){return this._needsUpdate||this._needsWaterReflectionUpdate||this.renderer.updating||this._textures.updating||this.waterTextures.updating||this._magnifierHelper.updating}get textureRepository(){return this._textures}get compositingHelper(){return this._compositingHelper}set magnifier(t){this._magnifierHelper.magnifier=t}setIdleSuspend(t){this._idleSuspend!==t&&(this._idleSuspend=t,this.requestRender())}get renderingContext(){return this._rctx}get capabilities(){return this._rctx.capabilities}get canvas(){return this._canvas}takeScreenshot(t){return this._screenshotManager.takeScreenshot(t).then(e=>e[0])}takeScreenshotWithOID(t){return t.objectAndLayerIdColor=!0,this._screenshotManager.takeScreenshot(t)}getAlpha(){return!!this._rctx.contextAttributes.alpha}getMinimalDepthForArea(t,e,r,i,n,s=n){const o=i.constrainWindowSize(e,r,n*i.pixelRatio,s*i.pixelRatio),a=this._ensureDepthBuffer(o);this.renderer.readDepthPixels(i,o,a);let l=Number.MAX_VALUE;for(let c=0;c<o[2]*o[3];c++){const u=NMt(4*c,a,i.nearFar);l>u&&u!==i.nearFar[0]&&u!==i.nearFar[1]&&(l=u)}if(t){const c=t.pickDepth(e*i.pixelRatio,r*i.pixelRatio,i);c!=null&&l>c&&c!==i.nearFar[0]&&c!==i.nearFar[1]&&(l=c)}return l===Number.MAX_VALUE?void 0:l}_ensureDepthBuffer(t){const e=4*t[2]*t[3];return(this._tmpDepthBuffer==null||this._tmpDepthBuffer.byteLength<e)&&(this._tmpDepthBuffer=new Uint8Array(e)),this._tmpDepthBuffer}async reloadShaders(){QNe(),await this._shaderTechniques.reloadAll(),this.requestRender()}_registerFrameTask(t){const e=t.view.state;let r=!1,i=Dn.BACKGROUND,n=!1;const s={preRender:({time:o})=>{r=this.updating,i=this._needsUpdate?Dn.UPDATE:Dn.BACKGROUND,t.commitSyncLayers();const a=o-this._lastAnimationUpdate;if(a>this.renderer.animationTimestep||e.forcedAnimationTime!=null||r||this._needsRender){const l=a/this.renderer.animationTimeDilation,c=new OOe(e.camera,l,e.forcedAnimationTime);this.renderer.updateAnimation(c)&&this.requestRender(Dn.BACKGROUND),this._lastAnimationUpdate=o}},render:({time:o})=>{if((this._needsRender||!this._idleSuspend||!this.renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&e.camera.fullWidth>0&&e.camera.fullHeight>0){const a=this._needsUpdate&&this._idleSuspend&&this.renderer.isCameraFinal;this._needsRender=!1,this._needsUpdate=!1,this._needsWaterReflectionUpdate=!1,this.renderer.render(e,o),n=!0,a&&this.renderer.hasReflections&&(this.requestRender(Dn.BACKGROUND),this._needsWaterReflectionUpdate=!0)}},update:({time:o})=>{const a=this.renderer.hasSlicePlane||this._magnifierHelper.enabled||this.renderer.hasDecorations||this.renderer.hasHighlights,l=new M$t(e,a,this.renderer.fboCache);this._textures.update(),this._screenshotManager.update(l,o)},finish:()=>{n&&(this.renderer.finish(e.mode===Ur.IDLE?i:Dn.UPDATE),n=!1)}};this._frameTask=qx(s)}_initializeContext(t){const e=t.options;this._canvas=e.canvas,this._canvas||(this._canvas=document.createElement("canvas")),this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");const r={alpha:e.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:e.stencil??!0,powerPreference:"high-performance",preserveDrawingBuffer:e.preserveDrawingBuffer??!1},i=ZJ(this._canvas,r);i!=null?(this._rctx=this._newRenderingContext(i,t),this._loadShaderOnlyExtensions(),!e.alpha&&this._rctx.contextAttributes.alpha&&re.getLogger(this).error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&se("safari")>=11&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas)):re.getLogger(this).error("A WebGL2 context could not be created.")}_newRenderingContext(t,e){const r={disabledExtensions:e.options.deactivatedWebGLExtensions||{},debugWebGLExtensions:e.options.debugWebGLExtensions||{},maxAnisotropy:8},i=(n,s)=>e.view.resourceController.memoryController.newCache(n,s);return new o$t(t,r,i)}_loadShaderOnlyExtensions(){this._rctx.capabilities.enable("textureFloat")}getObjectAndLayerIdColor(t){return this.objectAndLayerIdRenderHelper!=null?this.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor(t):null}get componentObjectCollection(){return this._componentObjects==null&&(this._componentObjects=new CMt(this.renderer.renderPassManager,this._viewingMode)),this._componentObjects}set componentObjectCollection(t){this._componentObjects=t}};d([m({type:Boolean,readOnly:!0})],Ro.prototype,"updating",null),d([m()],Ro.prototype,"_rctx",void 0),d([m()],Ro.prototype,"_container",void 0),d([m()],Ro.prototype,"_canvas",void 0),d([m()],Ro.prototype,"stippleTextures",void 0),d([m()],Ro.prototype,"markerTextures",void 0),d([m()],Ro.prototype,"waterTextures",void 0),d([m()],Ro.prototype,"_magnifierHelper",void 0),d([m({readOnly:!0})],Ro.prototype,"objectAndLayerIdRenderHelper",void 0),d([m()],Ro.prototype,"_textures",void 0),d([m({readOnly:!0})],Ro.prototype,"renderer",void 0),d([m()],Ro.prototype,"_screenshotManager",void 0),d([m()],Ro.prototype,"componentObjectCollection",null),d([m()],Ro.prototype,"_componentObjects",void 0),d([m()],Ro.prototype,"_needsUpdate",void 0),d([m()],Ro.prototype,"_needsWaterReflectionUpdate",void 0),Ro=d([V("esri.views.3d.webgl-engine.parts.RenderView")],Ro);let xu=class extends Ae{constructor(e){super(e),this._model=new kF,this._layers=new Vt,this._asyncChangeSet=new BZ,this._syncChangeSet=new BZ,this._layerSyncSet=new Set}initialize(){this._set("renderView",new Ro(this)),this._frameTask=this.view.resourceController.scheduler.registerTask(bt.STAGE,this),this.addHandles(this._frameTask)}destroy(){this.renderView.destroy()}get viewingMode(){return this.view.state.viewingMode}get updating(){return this.running||this.renderView.updating||this._frameTask.updating}get renderer(){var e;return(e=this.renderView)==null?void 0:e.renderer}add(e){this._model.add(e),w8(e)&&this._addLayer(e),this.renderView.requestRender()}remove(e){e!=null&&!this.destroyed&&this._model.remove(e)&&(w8(e)&&this._removeLayer(e),this.renderView.requestRender())}addMany(e){e!=null&&(this._model.addMany(e),this.renderView.requestRender())}removeMany(e){var r,i;e!=null&&((r=this._model)==null||r.removeMany(e),(i=this.renderView)==null||i.requestRender())}forEachOfType(e,r){this._model.forEachOfType(e,r)}handleEvent(e,r){this.destroyed||(this._model.dirtySet[e](r),this.renderView.requestRender())}get running(){return this._model.dirtySet.dirty||!this._asyncChangeSet.empty}runTask(e){if(this._frameTask.processQueue(e),this._commit(e),!e.hasProgressed)return Ho}_commit(e){const r=this._model.dirtySet;this._asyncChangeSet.empty||e.done||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(i=>{if(e.done)return;const n=this._layerSyncSet.has(i.id)||i.updatePolicy===q1.SYNC,s=n?this._syncChangeSet:this._asyncChangeSet;r.commitLayer(i.id,s),this._layerSyncSet.delete(i.id),s.empty||(this.renderer.modify(s,n?yl:e),this.renderView.requestRender(),e.madeProgress())}),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,yl),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(i=>{e.done||this._layerSyncSet.has(i.id)||i.updatePolicy!==q1.ASYNC||(r.commitLayer(i.id,this._asyncChangeSet),this._asyncChangeSet.empty||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()))}),this._layerSyncSet.clear(),this.notifyChange("running")}commitSyncLayers(){const e=this._model.dirtySet;this._layers.forAll(r=>{this._layerSyncSet.has(r.id)||r.updatePolicy===q1.SYNC?(e.commitLayer(r.id,this._syncChangeSet),this._layerSyncSet.delete(r.id)):e.commitSyncUpdates(r.id,this._syncChangeSet)});for(const r of this._layerSyncSet)e.commitLayer(r,this._syncChangeSet);this._layerSyncSet.clear(),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,yl),this.renderView.requestRender())}_commitLayer(e){this._model.dirtySet.commitLayer(e.id,this._syncChangeSet),this._layerSyncSet.delete(e.id),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,yl),this.renderView.requestRender())}schedule(e,r){return this._frameTask.schedule(e,r)}reschedule(e,r){return this._frameTask.reschedule(e,r)}syncLayer(e){this._layerSyncSet.add(e),this.renderView.requestRender()}getObject(e){return this._model.getObject(e)}get layers(){return this._layers}_addLayer(e){this._layers.includes(e)||this._layers.push(e)}_removeLayer(e){this._commitLayer(e),this._layers.removeUnordered(e)!=null&&(this._model.dirtySet.getResidentRenderGeometries(e.id,this._syncChangeSet.removes),this.renderer.modify(this._syncChangeSet,yl))}addRenderPlugin(e,r){const i=this.renderer.plugins.add(e,r),n=()=>{Age(e)&&this.view.sceneIntersectionHelper.addIntersectionHandler(e)};if(nu(i))return i.then(n);n()}removeRenderPlugin(e){this.destroyed||(Age(e)&&this.view.sceneIntersectionHelper.removeIntersectionHandler(e),this.renderer.plugins.remove(e))}get performanceInfo(){return this._model.getStats()}get test(){const e=this;return{getCount:r=>e._model.test.content.filter(i=>i.type===r).length,model:e._model}}};xu.DebugSettings={endFrameContentValidation:!1},d([m({constructOnly:!0})],xu.prototype,"view",void 0),d([m({constructOnly:!0})],xu.prototype,"options",void 0),d([m({readOnly:!0})],xu.prototype,"viewingMode",null),d([m({constructOnly:!0})],xu.prototype,"container",void 0),d([m({readOnly:!0})],xu.prototype,"updating",null),d([m({constructOnly:!0})],xu.prototype,"_model",void 0),d([m()],xu.prototype,"renderView",void 0),d([m({readOnly:!0})],xu.prototype,"renderer",null),d([m({readOnly:!0})],xu.prototype,"running",null),xu=d([V("esri.views.3d.webgl-engine.Stage")],xu);function RQt(t){return t&&typeof t.highlight=="function"}function R$t(t){return t&&typeof t.maskOccludee=="function"}function $Qt(t,e,r){return t==null||t>r&&(e===0||t<e)}function IQt(t,e){return t!=null&&t>0||e!=null&&e>0}function LQt(t){const e=t.effectiveScaleRange;return{minScale:(e==null?void 0:e.minScale)??0,maxScale:(e==null?void 0:e.maxScale)??0}}let Fj;function $$t(){return Fj||(Fj=D$t()),Fj}let I$t=class{constructor(){this.available=!1,this.majorPerformanceCaveat=!1,this.maxTextureSize=0,this.supportsVertexShaderSamplers=!1,this.supportsHighPrecisionFragment=!1,this.supportsColorBufferFloat=!1,this.supportsColorBufferFloatBlend=!1,this.supportsColorBufferHalfFloat=!1}};function L$t(t){if(typeof WebGL2RenderingContext>"u")return null;const e=document.createElement("canvas");if(!e)return null;let r=ZJ(e,{failIfMajorPerformanceCaveat:!0});if(r==null&&(r=ZJ(e),r!=null&&(t.majorPerformanceCaveat=!0)),r==null)return r;t.available=!0,t.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),t.supportsVertexShaderSamplers=r.getParameter(r.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;const i=r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.HIGH_FLOAT);return i&&(t.supportsHighPrecisionFragment=i.precision>0),r}function D$t(){const t=new I$t,e=L$t(t);return e==null||(t.supportsColorBufferFloat=e.getExtension("EXT_color_buffer_float")!==null,t.supportsColorBufferFloatBlend=e.getExtension("EXT_float_blend")!==null,t.supportsColorBufferHalfFloat=t.supportsColorBufferFloat||e.getExtension("EXT_color_buffer_half_float")!==null),t}function N$t(t){const e=$$t();return e.available?t==="3d"&&e.majorPerformanceCaveat?new K("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist."):e.supportsHighPrecisionFragment?e.supportsVertexShaderSamplers?null:new K("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported."):new K("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported."):new K("webgl:required","WebGL2 is required but not supported.",new Error().stack)}function F$t(t){return t&&"nodeType"in t}function k$t(t){return t&&typeof t.render=="function"}const Lye={component:"esri-component"};let Ow=class extends Ae{constructor(){super(...arguments),this.widget=null}destroy(){var e;this.node=null,(e=this.widget)==null||e.destroy()}get id(){var e,r;return this._get("id")??((e=this.widget)==null?void 0:e.id)??((r=this.node)==null?void 0:r.id)}set id(e){this._set("id",e)}set node(e){const r=this._get("node");e!==r&&(e&&e.classList.add(Lye.component),r&&r.classList.remove(Lye.component),this._set("node",e))}castNode(e){var r;return(r=this.widget)==null||r.destroy(),e?typeof e=="string"||F$t(e)?(this._set("widget",null),d9(e)):(k$t(e)&&!e.domNode&&(e.domNode=document.createElement("div")),this._set("widget",e),e.domNode):(this._set("widget",null),null)}};d([m()],Ow.prototype,"id",null),d([m()],Ow.prototype,"node",null),d([ai("node")],Ow.prototype,"castNode",null),d([m({readOnly:!0})],Ow.prototype,"widget",void 0),Ow=d([V("esri.views.ui.Component")],Ow);const WF=Ow,nFe="calcite-mode-";function z$t(){return getComputedStyle(document.body).getPropertyValue("--esri-calcite-mode-name").replaceAll(/\s|'|"/g,"")}function U$t(){return z$t().startsWith("dark")}function B$t(){return`${nFe}${U$t()?"dark":"light"}`}function V$t(t){G$t(t),t.classList.add(B$t())}function G$t(t){Array.from(t.classList).forEach(e=>{e.startsWith(nFe)&&t.classList.remove(e)})}const j$t={left:0,top:0,bottom:0,right:0},sFe={bottom:30,top:15,right:15,left:15},jg="esri-ui",_c={ui:jg,corner:`${jg}-corner`,innerContainer:`${jg}-inner-container`,manualContainer:`${jg}-manual-container`,cornerContainer:`${jg}-corner-container`,topLeft:`${jg}-top-left`,topRight:`${jg}-top-right`,bottomLeft:`${jg}-bottom-left`,bottomRight:`${jg}-bottom-right`};function H$t(t){return t&&!t._started&&typeof t.postMixInProperties=="function"&&typeof t.buildRendering=="function"&&typeof t.postCreate=="function"&&typeof t.startup=="function"}function $4(t){return t===0?"0":`${t}px`}function kj(t){const e=typeof t=="object"&&t!==null&&Object.getPrototypeOf(t);return(e===null||e===Object.prototype)&&("component"in t||"index"in t||"position"in t)?t:null}function zj(t,{top:e,bottom:r,left:i,right:n}){t.style.top=e,t.style.bottom=r,t.style.left=i,t.style.right=n}let pm=class extends Qn.EventedAccessor{constructor(e){super(e),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentMap=new Map,this._locale=Hu(),this.view=null,this._applyViewPadding=()=>{const r=this.container;r&&zj(r,this._toPixelPosition(this._getViewPadding()))},this._applyUIPadding=()=>{const r=this._innerContainer;r&&zj(r,this._toPixelPosition(this.padding))},this._initContainers()}initialize(){this.addHandles([he(()=>{var e;return[(e=this.view)==null?void 0:e.padding,this.container]},this._applyViewPadding,gi),he(()=>this.padding,this._applyUIPadding,gi),he(()=>[this.container,this._locale],([e,r])=>{e&&e.setAttribute("lang",r)},gi),KK(e=>{this._locale=e})])}destroy(){this.container=null;for(const e of this._components)e.destroy();this._components.length=0,this._componentMap.clear()}set container(e){const r=this._get("container");e!==r&&(e&&(e.classList.add(_c.ui),V$t(e),this._attachContainers(e)),r&&(r.classList.remove(_c.ui),zj(r,{top:"",bottom:"",left:"",right:""}),T2e(r)),this._set("container",e))}get height(){var s;const e=((s=this.view)==null?void 0:s.height)??0;if(e===0)return e;const r=this._getViewPadding(),{top:i,bottom:n}=r;return Math.max(e-i-n,0)}get padding(){return this._get("padding")}set padding(e){this._overrideIfSome("padding",e)}castPadding(e){return typeof e=="number"?{bottom:e,top:e,right:e,left:e}:{...sFe,...e}}get width(){var s;const e=((s=this.view)==null?void 0:s.width)??0;if(e===0)return e;const r=this._getViewPadding(),{left:i,right:n}=r;return Math.max(e-i-n,0)}add(e,r){let i,n,s;if(Array.isArray(e))return void e.forEach(a=>this.add(a,r));const o=kj(e);o&&({index:i,position:r,component:e,key:n}=o),r&&typeof r=="object"&&({index:i,key:n,position:r,internal:s}=r),!e||r&&!this._isValidPosition(r)||this._add(e,r,i,n,s)}remove(e,r){var n;if(!e)return;if(Array.isArray(e))return e.map(s=>this.remove(s,r));const i=this._find(e);if(i){if(this._componentMap.has(i)&&((n=this._componentMap.get(i))==null?void 0:n.key)!==r)return;const s=this._components.indexOf(i),o=i.node.parentNode;return o==null||o.removeChild(i.node),this._componentMap.delete(i),this._components.splice(s,1)[0]}}empty(e,r={removeInternal:!1}){if(Array.isArray(e)){for(const s of e)this.empty(s,r);return}const i=this._positionNameToContainerLookup[e??"manual"],n=Array.prototype.slice.call(i.children).map(s=>this._findByNode(s)).filter(s=>{var o;return s==null?!1:!(((o=this._componentMap.get(s))==null?void 0:o.internal)??!1)||r.removeInternal});for(const s of n)this.remove(s)}move(e,r){if(Array.isArray(e)&&e.forEach(o=>this.move(o,r)),!e)return;let i;const n=kj(e)||kj(r);if(n&&(i=n.index,r=n.position,e=n.component||e),r&&!this._isValidPosition(r))return;const s=this.remove(e);s&&this.add(s,{position:r,index:i})}find(e){if(!e)return null;const r=this._findById(e);return r&&(r.widget||r.node)}getComponents(e,r={includeInternal:!1}){return e?Array.isArray(e)?e.flatMap(i=>this._getComponentsAtPosition(i,r)):this._getComponentsAtPosition(e,r):this._components.filter(i=>{var n;return r.includeInternal||!((n=this._componentMap.get(i))!=null&&n.internal)}).map(({widget:i,node:n})=>i??n)}getPosition(e){for(const r in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[r].contains(e))return r;return null}_add(e,r,i,n,s){e instanceof WF||(e=new WF({node:e})),this._place({component:e,position:r,index:i}),this._components.push(e),this._componentMap.set(e,{key:n,internal:s})}_find(e){return e?e instanceof WF?this._findByComponent(e):typeof e=="string"?this._findById(e):this._findByNode(e.domNode||e):null}_getViewPadding(){var e;return((e=this.view)==null?void 0:e.padding)??j$t}_attachContainers(e){e.appendChild(this._innerContainer),e.appendChild(this._manualContainer)}_initContainers(){const e=document.createElement("div");e.classList.add(_c.innerContainer,_c.cornerContainer);const r=document.createElement("div");r.classList.add(_c.innerContainer,_c.manualContainer);const i=document.createElement("div");i.classList.add(_c.topLeft,_c.corner),e.appendChild(i);const n=document.createElement("div");n.classList.add(_c.topRight,_c.corner),e.appendChild(n);const s=document.createElement("div");s.classList.add(_c.bottomLeft,_c.corner),e.appendChild(s);const o=document.createElement("div");o.classList.add(_c.bottomRight,_c.corner),e.appendChild(o),this._innerContainer=e,this._manualContainer=r;const a=oZe();this._cornerNameToContainerLookup={"top-left":i,"top-right":n,"bottom-left":s,"bottom-right":o,"top-leading":a?n:i,"top-trailing":a?i:n,"bottom-leading":a?o:s,"bottom-trailing":a?s:o},this._positionNameToContainerLookup={manual:r,...this._cornerNameToContainerLookup}}_isValidPosition(e){return!!this._positionNameToContainerLookup[e]}_place(e){const r=e.position??"manual",{component:i,index:n}=e,s=this._positionNameToContainerLookup[r],o=n!=null&&n>-1;if(H$t(i.widget)&&i.widget.startup(),!o)return void s.appendChild(i.node);const a=Array.from(s.children);if(n===0)return void(s.firstChild?jae(i.node,s.firstChild):s.appendChild(i.node));n>=a.length?s.appendChild(i.node):jae(i.node,a[n])}_toPixelPosition(e){return{top:$4(e.top),left:$4(e.left),right:$4(e.right),bottom:$4(e.bottom)}}_findByComponent(e){return this._components.find(r=>r===e)??null}_findById(e){return this._components.find(({id:r})=>r===e)??null}_findByNode(e){return this._components.find(({node:r})=>r===e)??null}_getComponentsAtPosition(e,r){const i=this._positionNameToContainerLookup[e];return Array.prototype.slice.call(i.children).map(n=>this._findByNode(n)).filter(P3).filter(n=>{var s;return r.includeInternal||!((s=this._componentMap.get(n))!=null&&s.internal)}).map(({widget:n,node:s})=>n??s)}};d([m()],pm.prototype,"_locale",void 0),d([m()],pm.prototype,"container",null),d([m()],pm.prototype,"height",null),d([m({value:sFe})],pm.prototype,"padding",null),d([ai("padding")],pm.prototype,"castPadding",null),d([m()],pm.prototype,"view",void 0),d([m()],pm.prototype,"width",null),pm=d([V("esri.views.ui.UI")],pm);const W$t=pm,q$t="randomUUID"in crypto;function sse(){if(q$t)return crypto.randomUUID();const t=crypto.getRandomValues(new Uint16Array(8));t[3]=4095&t[3]|16384,t[4]=16383&t[4]|32768;const e=r=>t[r].toString(16).padStart(4,"0");return e(0)+e(1)+"-"+e(2)+"-"+e(3)+"-"+e(4)+"-"+e(5)+e(6)+e(7)}function kQt(){return`{${sse().toUpperCase()}}`}function zQt(){return`{${sse()}}`}const Y$t={handleInterceptedEvent:(t,e,r,i)=>(t.scheduleRender(),e.properties[`on${i.type}`].apply(e.properties.bind||r,[i]))},X$t={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(t,e,r)=>{e.charAt(0)==="-"?t.style.setProperty(e,r):t.style[e]=r}},Z$t=t=>({...X$t,...t}),J$t=(t,e)=>{const r=[];for(;t&&t!==e;)r.push(t),t=t.parentNode;return r},Q$t=(t,e)=>t.find(e),Dye=(t,e,r=!1)=>{let i=t;return e.forEach((n,s)=>{const o=i!=null&&i.children?Q$t(i.children,a=>a.domNode===n):void 0;r&&!o&&s!==e.length-1||(i=o)}),i},K$t=t=>{let e;const r={...Y$t,...t},i=Z$t(r),n=i.performanceLogger;let s,o=!0,a=!1;const l=[],c=[],u=(p,f,g)=>{var b;let _;i.eventHandlerInterceptor=(w,x,S,E)=>function(A){let O;n("domEvent",A);const L=J$t(A.currentTarget,_.domNode),z=L.some(q=>{var B;return customElements.get((B=q==null?void 0:q.tagName)==null?void 0:B.toLowerCase())});if(A.eventPhase===Event.CAPTURING_PHASE||!z)L.reverse(),O=Dye(_.getLastRender(),L);else{const q=A.composedPath(),B=q.slice(q.indexOf(A.currentTarget),q.indexOf(_.domNode)).reverse();O=Dye(_.getLastRender(),B,!0)}let k;return O&&(k=r.handleInterceptedEvent(e,O,this,A)),n("domEventProcessed",A),k},(b=r.postProcessProjectionOptions)==null||b.call(r,i);const v=g();_=p(f,v,i),i.eventHandlerInterceptor=void 0,l.push(_),c.push(g),r.afterFirstVNodeRendered&&r.afterFirstVNodeRendered(_,v)};let h=()=>{if(s=void 0,o){o=!1,n("renderStart",void 0);for(let p=0;p<l.length;p++){const f=c[p]();n("rendered",void 0),l[p].update(f),n("patched",void 0)}n("renderDone",void 0),o=!0}};return r.modifyDoRenderImplementation&&(h=r.modifyDoRenderImplementation(h,l,c)),e={renderNow:h,scheduleRender:()=>{s||a||(s=requestAnimationFrame(h))},stop:()=>{s&&(cancelAnimationFrame(s),s=void 0),a=!0},resume:()=>{a=!1,o=!0,e.scheduleRender()},append:(p,f)=>{u(S1.append,p,f)},insertBefore:(p,f)=>{u(S1.insertBefore,p,f)},merge:(p,f)=>{u(S1.merge,p,f)},replace:(p,f)=>{u(S1.replace,p,f)},detach:p=>{for(let f=0;f<c.length;f++)if(c[f]===p)return c.splice(f,1),l.splice(f,1)[0];throw new Error("renderFunction was not found")}},e};/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v2.6.0
 */const oFe="calcite-mode-auto",aFe="calcite-mode-dark",eIt="calcite-mode-light",UQt={autoMode:oFe,darkMode:aFe,lightMode:eIt,rtl:"calcite--rtl",calciteAnimate:"calcite-animate",calciteAnimateIn:"calcite-animate__in",calciteAnimateInUp:"calcite-animate__in-up",calciteAnimateInDown:"calcite-animate__in-down",calciteAnimateInRight:"calcite-animate__in-right",calciteAnimateInLeft:"calcite-animate__in-left",calciteAnimateInScale:"calcite-animate__in-scale"},rx={allRenderFn:!1,cmpDidLoad:!0,cmpDidUnload:!1,cmpDidUpdate:!0,cmpDidRender:!0,cmpWillLoad:!0,cmpWillUpdate:!0,cmpWillRender:!0,connectedCallback:!0,disconnectedCallback:!0,element:!0,event:!0,hasRenderFn:!0,lifecycle:!0,hostListener:!0,hostListenerTargetWindow:!0,hostListenerTargetDocument:!0,hostListenerTargetBody:!0,hostListenerTargetParent:!1,hostListenerTarget:!0,member:!0,method:!0,mode:!0,observeAttribute:!0,prop:!0,propMutable:!0,reflect:!0,scoped:!0,shadowDom:!0,slot:!0,cssAnnotations:!0,state:!0,style:!0,formAssociated:!1,svg:!0,updatable:!0,vdomAttribute:!0,vdomXlink:!0,vdomClass:!0,vdomFunctional:!0,vdomKey:!0,vdomListener:!0,vdomRef:!0,vdomPropOrAttr:!0,vdomRender:!0,vdomStyle:!0,vdomText:!0,watchCallback:!0,taskQueue:!0,hotModuleReplacement:!1,isDebug:!1,isDev:!1,isTesting:!1,hydrateServerSide:!1,hydrateClientSide:!1,lifecycleDOMEvents:!1,lazyLoad:!1,profile:!1,slotRelocation:!0,appendChildSlotFix:!1,cloneNodeFix:!1,hydratedAttribute:!1,hydratedClass:!0,scriptDataOpts:!1,scopedSlotTextContentFix:!1,shadowDomShim:!1,slotChildNodesFix:!1,invisiblePrehydration:!0,propBoolean:!0,propNumber:!0,propString:!0,constructableCSS:!0,cmpShouldUpdate:!0,devTools:!1,shadowDelegatesFocus:!0,initializeNextTick:!1,asyncLoading:!1,asyncQueue:!1,transformTagName:!1,attachStyles:!0,experimentalSlotFixes:!1};let zS,lFe,aB,cFe=!1,tz=!1,ose=!1,$u=!1,Nye=null,JJ=!1;const tIt=t=>{const e=new URL(t,pa.$resourcesUrl$);return e.origin!==vL.location.origin?e.href:e.pathname},rIt=t=>pa.$resourcesUrl$=t,T2=(t,e="")=>()=>{},iIt="slot-fb{display:contents}slot-fb[hidden]{display:none}",Fye="http://www.w3.org/1999/xlink",kye={},nIt="http://www.w3.org/2000/svg",sIt="http://www.w3.org/1999/xhtml",oIt=t=>t!=null,ase=t=>(t=typeof t,t==="object"||t==="function");function aIt(t){var e,r,i;return(i=(r=(e=t.head)===null||e===void 0?void 0:e.querySelector('meta[name="csp-nonce"]'))===null||r===void 0?void 0:r.getAttribute("content"))!==null&&i!==void 0?i:void 0}const uFe=(t,e,...r)=>{let i=null,n=null,s=null,o=!1,a=!1;const l=[],c=h=>{for(let p=0;p<h.length;p++)i=h[p],Array.isArray(i)?c(i):i!=null&&typeof i!="boolean"&&((o=typeof t!="function"&&!ase(i))&&(i=String(i)),o&&a?l[l.length-1].$text$+=i:l.push(o?rz(null,i):i),a=o)};if(c(r),e){e.key&&(n=e.key),e.name&&(s=e.name);{const h=e.className||e.class;h&&(e.class=typeof h!="object"?h:Object.keys(h).filter(p=>h[p]).join(" "))}}if(typeof t=="function")return t(e===null?{}:e,l,uIt);const u=rz(t,null);return u.$attrs$=e,l.length>0&&(u.$children$=l),u.$key$=n,u.$name$=s,u},rz=(t,e)=>{const r={$flags$:0,$tag$:t,$text$:e,$elm$:null,$children$:null};return r.$attrs$=null,r.$key$=null,r.$name$=null,r},lIt={},cIt=t=>t&&t.$tag$===lIt,uIt={forEach:(t,e)=>t.map(zye).forEach(e),map:(t,e)=>t.map(zye).map(e).map(hIt)},zye=t=>({vattrs:t.$attrs$,vchildren:t.$children$,vkey:t.$key$,vname:t.$name$,vtag:t.$tag$,vtext:t.$text$}),hIt=t=>{if(typeof t.vtag=="function"){const r=Object.assign({},t.vattrs);return t.vkey&&(r.key=t.vkey),t.vname&&(r.name=t.vname),uFe(t.vtag,r,...t.vchildren||[])}const e=rz(t.vtag,t.vtext);return e.$attrs$=t.vattrs,e.$children$=t.vchildren,e.$key$=t.vkey,e.$name$=t.vname,e},dIt=t=>UIt.map(e=>e(t)).find(e=>!!e),pIt=(t,e)=>t!=null&&!ase(t)?e&4?t==="false"?!1:t===""||!!t:e&2?parseFloat(t):e&1?String(t):t:t,fIt=t=>t,BQt=(t,e,r)=>{const i=fIt(t);return{emit:n=>mIt(i,e,{bubbles:!!(r&4),composed:!!(r&2),cancelable:!!(r&1),detail:n})}},mIt=(t,e,r)=>{const i=pa.ce(e,r);return t.dispatchEvent(i),i},Uye=new WeakMap,gIt=(t,e,r)=>{let i=nz.get(t);GIt&&r?(i=i||new CSSStyleSheet,typeof i=="string"?i=e:i.replaceSync(e)):i=e,nz.set(t,i)},yIt=(t,e,r)=>{var i;const n=hFe(e,r),s=nz.get(n);if(t=t.nodeType===11?t:tf,s)if(typeof s=="string"){t=t.head||t;let o=Uye.get(t),a;if(o||Uye.set(t,o=new Set),!o.has(n)){{a=tf.createElement("style"),a.innerHTML=s;const l=(i=pa.$nonce$)!==null&&i!==void 0?i:aIt(tf);l!=null&&a.setAttribute("nonce",l),t.insertBefore(a,t.querySelector("link"))}e.$flags$&4&&(a.innerHTML+=iIt),o&&o.add(n)}}else t.adoptedStyleSheets.includes(s)||(t.adoptedStyleSheets=[...t.adoptedStyleSheets,s]);return n},_It=t=>{const e=t.$cmpMeta$,r=t.$hostElement$,i=e.$flags$,n=T2("attachStyles",e.$tagName$),s=yIt(r.shadowRoot?r.shadowRoot:r.getRootNode(),e,t.$modeName$);i&10&&(r["s-sc"]=s,r.classList.add(s+"-h"),i&2&&r.classList.add(s+"-s")),n()},hFe=(t,e)=>"sc-"+(e&&t.$flags$&32?t.$tagName$+"-"+e:t.$tagName$),Bye=(t,e,r,i,n,s)=>{if(r!==i){let o=Wye(t,e),a=e.toLowerCase();if(e==="class"){const l=t.classList,c=Vye(r),u=Vye(i);l.remove(...c.filter(h=>h&&!u.includes(h))),l.add(...u.filter(h=>h&&!c.includes(h)))}else if(e==="style"){for(const l in r)(!i||i[l]==null)&&(l.includes("-")?t.style.removeProperty(l):t.style[l]="");for(const l in i)(!r||i[l]!==r[l])&&(l.includes("-")?t.style.setProperty(l,i[l]):t.style[l]=i[l])}else if(e!=="key")if(e==="ref")i&&i(t);else if(!t.__lookupSetter__(e)&&e[0]==="o"&&e[1]==="n"){if(e[2]==="-"?e=e.slice(3):Wye(vL,a)?e=a.slice(2):e=a[2]+e.slice(3),r||i){const l=e.endsWith(dFe);e=e.replace(bIt,""),r&&pa.rel(t,e,r,l),i&&pa.ael(t,e,i,l)}}else{const l=ase(i);if((o||l&&i!==null)&&!n)try{if(t.tagName.includes("-"))t[e]=i;else{const u=i??"";e==="list"?o=!1:(r==null||t[e]!=u)&&(t[e]=u)}}catch{}let c=!1;a!==(a=a.replace(/^xlink\:?/,""))&&(e=a,c=!0),i==null||i===!1?(i!==!1||t.getAttribute(e)==="")&&(c?t.removeAttributeNS(Fye,e):t.removeAttribute(e)):(!o||s&4||n)&&!l&&(i=i===!0?"":i,c?t.setAttributeNS(Fye,e,i):t.setAttribute(e,i))}}},vIt=/\s/,Vye=t=>t?t.split(vIt):[],dFe="Capture",bIt=new RegExp(dFe+"$"),pFe=(t,e,r,i)=>{const n=e.$elm$.nodeType===11&&e.$elm$.host?e.$elm$.host:e.$elm$,s=t&&t.$attrs$||kye,o=e.$attrs$||kye;for(i in s)i in o||Bye(n,i,s[i],void 0,r,e.$flags$);for(i in o)Bye(n,i,s[i],o[i],r,e.$flags$)},iz=(t,e,r,i)=>{var n;const s=e.$children$[r];let o=0,a,l,c;if(cFe||(ose=!0,s.$tag$==="slot"&&(zS&&i.classList.add(zS+"-s"),s.$flags$|=s.$children$?2:1)),s.$text$!==null)a=s.$elm$=tf.createTextNode(s.$text$);else if(s.$flags$&1)a=s.$elm$=tf.createTextNode("");else{if($u||($u=s.$tag$==="svg"),a=s.$elm$=tf.createElementNS($u?nIt:sIt,s.$flags$&2?"slot-fb":s.$tag$),$u&&s.$tag$==="foreignObject"&&($u=!1),pFe(null,s,$u),oIt(zS)&&a["s-si"]!==zS&&a.classList.add(a["s-si"]=zS),s.$children$)for(o=0;o<s.$children$.length;++o)l=iz(t,s,o,a),l&&a.appendChild(l);s.$tag$==="svg"?$u=!1:a.tagName==="foreignObject"&&($u=!0)}return a["s-hn"]=aB,s.$flags$&3&&(a["s-sr"]=!0,a["s-fs"]=(n=s.$attrs$)===null||n===void 0?void 0:n.slot,a["s-cr"]=lFe,a["s-sn"]=s.$name$||"",c=t&&t.$children$&&t.$children$[r],c&&c.$tag$===s.$tag$&&t.$elm$&&hI(t.$elm$,!1)),a},hI=(t,e)=>{var r;pa.$flags$|=1;const i=t.childNodes;for(let n=i.length-1;n>=0;n--){const s=i[n];s["s-hn"]!==aB&&s["s-ol"]&&(gFe(s).insertBefore(s,lse(s)),s["s-ol"].remove(),s["s-ol"]=void 0,s["s-sh"]=void 0,s.nodeType===1&&s.setAttribute("slot",(r=s["s-sn"])!==null&&r!==void 0?r:""),ose=!0),e&&hI(s,e)}pa.$flags$&=-2},fFe=(t,e,r,i,n,s)=>{let o=t["s-cr"]&&t["s-cr"].parentNode||t,a;for(o.shadowRoot&&o.tagName===aB&&(o=o.shadowRoot);n<=s;++n)i[n]&&(a=iz(null,r,n,t),a&&(i[n].$elm$=a,o.insertBefore(a,lse(e))))},mFe=(t,e,r)=>{for(let i=e;i<=r;++i){const n=t[i];if(n){const s=n.$elm$;vFe(n),s&&(tz=!0,s["s-ol"]?s["s-ol"].remove():hI(s,!0),s.remove())}}},wIt=(t,e,r,i,n=!1)=>{let s=0,o=0,a=0,l=0,c=e.length-1,u=e[0],h=e[c],p=i.length-1,f=i[0],g=i[p],_,v;for(;s<=c&&o<=p;)if(u==null)u=e[++s];else if(h==null)h=e[--c];else if(f==null)f=i[++o];else if(g==null)g=i[--p];else if(I4(u,f,n))US(u,f,n),u=e[++s],f=i[++o];else if(I4(h,g,n))US(h,g,n),h=e[--c],g=i[--p];else if(I4(u,g,n))(u.$tag$==="slot"||g.$tag$==="slot")&&hI(u.$elm$.parentNode,!1),US(u,g,n),t.insertBefore(u.$elm$,h.$elm$.nextSibling),u=e[++s],g=i[--p];else if(I4(h,f,n))(u.$tag$==="slot"||g.$tag$==="slot")&&hI(h.$elm$.parentNode,!1),US(h,f,n),t.insertBefore(h.$elm$,u.$elm$),h=e[--c],f=i[++o];else{for(a=-1,l=s;l<=c;++l)if(e[l]&&e[l].$key$!==null&&e[l].$key$===f.$key$){a=l;break}a>=0?(v=e[a],v.$tag$!==f.$tag$?_=iz(e&&e[o],r,a,t):(US(v,f,n),e[a]=void 0,_=v.$elm$),f=i[++o]):(_=iz(e&&e[o],r,o,t),f=i[++o]),_&&gFe(u.$elm$).insertBefore(_,lse(u.$elm$))}s>c?fFe(t,i[p+1]==null?null:i[p+1].$elm$,r,i,o,p):o>p&&mFe(e,s,c)},I4=(t,e,r=!1)=>t.$tag$===e.$tag$?t.$tag$==="slot"?t.$name$===e.$name$:r?!0:t.$key$===e.$key$:!1,lse=t=>t&&t["s-ol"]||t,gFe=t=>(t["s-ol"]?t["s-ol"]:t).parentNode,US=(t,e,r=!1)=>{const i=e.$elm$=t.$elm$,n=t.$children$,s=e.$children$,o=e.$tag$,a=e.$text$;let l;a===null?($u=o==="svg"?!0:o==="foreignObject"?!1:$u,o==="slot"||pFe(t,e,$u),n!==null&&s!==null?wIt(i,n,e,s,r):s!==null?(t.$text$!==null&&(i.textContent=""),fFe(i,null,e,s,0,s.length-1)):n!==null&&mFe(n,0,n.length-1),$u&&o==="svg"&&($u=!1)):(l=i["s-cr"])?l.parentNode.textContent=a:t.$text$!==a&&(i.data=a)},yFe=t=>{const e=t.childNodes;for(const r of e)if(r.nodeType===1){if(r["s-sr"]){const i=r["s-sn"];r.hidden=!1;for(const n of e)if(n!==r){if(n["s-hn"]!==r["s-hn"]||i!==""){if(n.nodeType===1&&(i===n.getAttribute("slot")||i===n["s-sn"])){r.hidden=!0;break}}else if(n.nodeType===1||n.nodeType===3&&n.textContent.trim()!==""){r.hidden=!0;break}}}yFe(r)}},x0=[],_Fe=t=>{let e,r,i;for(const n of t.childNodes){if(n["s-sr"]&&(e=n["s-cr"])&&e.parentNode){r=e.parentNode.childNodes;const s=n["s-sn"];for(i=r.length-1;i>=0;i--)if(e=r[i],!e["s-cn"]&&!e["s-nr"]&&e["s-hn"]!==n["s-hn"]&&!rx.experimentalSlotFixes)if(Gye(e,s)){let o=x0.find(a=>a.$nodeToRelocate$===e);tz=!0,e["s-sn"]=e["s-sn"]||s,o?(o.$nodeToRelocate$["s-sh"]=n["s-hn"],o.$slotRefNode$=n):(e["s-sh"]=n["s-hn"],x0.push({$slotRefNode$:n,$nodeToRelocate$:e})),e["s-sr"]&&x0.map(a=>{Gye(a.$nodeToRelocate$,e["s-sn"])&&(o=x0.find(l=>l.$nodeToRelocate$===e),o&&!a.$slotRefNode$&&(a.$slotRefNode$=o.$slotRefNode$))})}else x0.some(o=>o.$nodeToRelocate$===e)||x0.push({$nodeToRelocate$:e})}n.nodeType===1&&_Fe(n)}},Gye=(t,e)=>t.nodeType===1?t.getAttribute("slot")===null&&e===""||t.getAttribute("slot")===e:t["s-sn"]===e?!0:e==="",vFe=t=>{t.$attrs$&&t.$attrs$.ref&&t.$attrs$.ref(null),t.$children$&&t.$children$.map(vFe)},xIt=(t,e,r=!1)=>{var i,n,s,o;const a=t.$hostElement$,l=t.$cmpMeta$,c=t.$vnode$||rz(null,null),u=cIt(e)?e:uFe(null,null,e);if(aB=a.tagName,l.$attrsToReflect$&&(u.$attrs$=u.$attrs$||{},l.$attrsToReflect$.map(([h,p])=>u.$attrs$[p]=a[h])),r&&u.$attrs$)for(const h of Object.keys(u.$attrs$))a.hasAttribute(h)&&!["key","ref","style","class"].includes(h)&&(u.$attrs$[h]=a[h]);u.$tag$=null,u.$flags$|=4,t.$vnode$=u,u.$elm$=c.$elm$=a.shadowRoot||a,zS=a["s-sc"],lFe=a["s-cr"],cFe=(l.$flags$&1)!==0,tz=!1,US(c,u,r);{if(pa.$flags$|=1,ose){_Fe(u.$elm$);for(const h of x0){const p=h.$nodeToRelocate$;if(!p["s-ol"]){const f=tf.createTextNode("");f["s-nr"]=p,p.parentNode.insertBefore(p["s-ol"]=f,p)}}for(const h of x0){const p=h.$nodeToRelocate$,f=h.$slotRefNode$;if(f){const g=f.parentNode;let _=f.nextSibling;{let v=(i=p["s-ol"])===null||i===void 0?void 0:i.previousSibling;for(;v;){let b=(n=v["s-nr"])!==null&&n!==void 0?n:null;if(b&&b["s-sn"]===p["s-sn"]&&g===b.parentNode&&(b=b.nextSibling,!b||!b["s-nr"])){_=b;break}v=v.previousSibling}}(!_&&g!==p.parentNode||p.nextSibling!==_)&&p!==_&&(!p["s-hn"]&&p["s-ol"]&&(p["s-hn"]=p["s-ol"].parentNode.nodeName),g.insertBefore(p,_),p.nodeType===1&&(p.hidden=(s=p["s-ih"])!==null&&s!==void 0?s:!1))}else p.nodeType===1&&(r&&(p["s-ih"]=(o=p.hidden)!==null&&o!==void 0?o:!1),p.hidden=!0)}}tz&&yFe(u.$elm$),pa.$flags$&=-2,x0.length=0}},TIt=(t,e)=>{},cse=(t,e)=>(t.$flags$|=16,TIt(t,t.$ancestorComponent$),HIt(()=>SIt(t,e))),SIt=(t,e)=>{const r=t.$hostElement$,i=T2("scheduleUpdate",t.$cmpMeta$.$tagName$),n=r;let s;return e?s=dE(n,"componentWillLoad"):s=dE(n,"componentWillUpdate"),s=jye(s,()=>dE(n,"componentWillRender")),i(),jye(s,()=>EIt(t,n,e))},jye=(t,e)=>CIt(t)?t.then(e):e(),CIt=t=>t instanceof Promise||t&&t.then&&typeof t.then=="function",EIt=async(t,e,r)=>{const i=t.$hostElement$,n=T2("update",t.$cmpMeta$.$tagName$);i["s-rc"],r&&_It(t);const s=T2("render",t.$cmpMeta$.$tagName$);PIt(t,e,i,r),s(),n(),AIt(t)},PIt=(t,e,r,i)=>{try{Nye=e,e=e.render&&e.render(),t.$flags$&=-17,t.$flags$|=2,(rx.hasRenderFn||rx.reflect)&&(rx.vdomRender||rx.reflect)&&(rx.hydrateServerSide||xIt(t,e,i))}catch(l){_L(l,t.$hostElement$)}return Nye=null,null},AIt=t=>{const e=t.$cmpMeta$.$tagName$,r=t.$hostElement$,i=T2("postUpdate",e),n=r;t.$ancestorComponent$,dE(n,"componentDidRender"),t.$flags$&64?(dE(n,"componentDidUpdate"),i()):(t.$flags$|=64,dE(n,"componentDidLoad"),i())},VQt=t=>{{const e=sP(t),r=e.$hostElement$.isConnected;return r&&(e.$flags$&18)===2&&cse(e,!1),r}},dE=(t,e,r)=>{if(t&&t[e])try{return t[e](r)}catch(i){_L(i)}},MIt=(t,e)=>sP(t).$instanceValues$.get(e),OIt=(t,e,r,i)=>{const n=sP(t),s=t,o=n.$instanceValues$.get(e),a=n.$flags$,l=s;r=pIt(r,i.$members$[e][0]);const c=Number.isNaN(o)&&Number.isNaN(r);if(r!==o&&!c){n.$instanceValues$.set(e,r);{if(i.$watchers$&&a&128){const h=i.$watchers$[e];h&&h.map(p=>{try{l[p](r,o,e)}catch(f){_L(f,s)}})}if((a&18)===2){if(l.componentShouldUpdate&&l.componentShouldUpdate(r,o,e)===!1)return;cse(n,!1)}}}},RIt=(t,e,r)=>{var i;const n=t.prototype;if(e.$members$){t.watchers&&(e.$watchers$=t.watchers);const s=Object.entries(e.$members$);s.map(([o,[a]])=>{(a&31||a&32)&&Object.defineProperty(n,o,{get(){return MIt(this,o)},set(l){OIt(this,o,l,e)},configurable:!0,enumerable:!0})});{const o=new Map;n.attributeChangedCallback=function(a,l,c){pa.jmp(()=>{var u;const h=o.get(a);if(this.hasOwnProperty(h))c=this[h],delete this[h];else{if(n.hasOwnProperty(h)&&typeof this[h]=="number"&&this[h]==c)return;if(h==null){const p=sP(this),f=p==null?void 0:p.$flags$;if(f&&!(f&8)&&f&128&&c!==l){const _=this,v=(u=e.$watchers$)===null||u===void 0?void 0:u[a];v==null||v.forEach(b=>{_[b]!=null&&_[b].call(_,c,l,a)})}return}}this[h]=c===null&&typeof this[h]=="boolean"?!1:c})},t.observedAttributes=Array.from(new Set([...Object.keys((i=e.$watchers$)!==null&&i!==void 0?i:{}),...s.filter(([a,l])=>l[0]&15).map(([a,l])=>{var c;const u=l[1]||a;return o.set(u,a),l[0]&512&&((c=e.$attrsToReflect$)===null||c===void 0||c.push([a,u])),u})]))}}return t},$It=async(t,e,r,i)=>{let n;if(!(e.$flags$&32)&&(e.$flags$|=32,n=t.constructor,customElements.whenDefined(r.$tagName$).then(()=>e.$flags$|=128),n.style)){let o=n.style;typeof o!="string"&&(o=o[e.$modeName$=dIt(t)]);const a=hFe(r,e.$modeName$);if(!nz.has(a)){const l=T2("registerStyles",r.$tagName$);gIt(a,o,!!(r.$flags$&1)),l()}}e.$ancestorComponent$,cse(e,!0)},Hye=t=>{},IIt=t=>{if(!(pa.$flags$&1)){const e=sP(t),r=e.$cmpMeta$,i=T2("connectedCallback",r.$tagName$);e.$flags$&1?(bFe(t,e,r.$listeners$),e!=null&&e.$lazyInstance$?Hye(e.$lazyInstance$):e!=null&&e.$onReadyPromise$&&e.$onReadyPromise$.then(()=>Hye(e.$lazyInstance$))):(e.$flags$|=1,r.$flags$&12&&LIt(t),r.$members$&&Object.entries(r.$members$).map(([n,[s]])=>{if(s&31&&t.hasOwnProperty(n)){const o=t[n];delete t[n],t[n]=o}}),$It(t,e,r)),i()}},LIt=t=>{const e=t["s-cr"]=tf.createComment("");e["s-cn"]=!0,t.insertBefore(e,t.firstChild)},DIt=async t=>{if(!(pa.$flags$&1)){const e=sP(t);e.$rmListeners$&&(e.$rmListeners$.map(r=>r()),e.$rmListeners$=void 0)}},GQt=(t,e)=>{const r={$flags$:e[0],$tagName$:e[1]};r.$members$=e[2],r.$listeners$=e[3],r.$watchers$=t.$watchers$,r.$attrsToReflect$=[];const i=t.prototype.connectedCallback,n=t.prototype.disconnectedCallback;return Object.assign(t.prototype,{__registerHost(){zIt(this,r)},connectedCallback(){IIt(this),i&&i.call(this)},disconnectedCallback(){DIt(this),n&&n.call(this)},__attachShadow(){this.attachShadow({mode:"open",delegatesFocus:!!(r.$flags$&16)})}}),t.is=r.$tagName$,RIt(t,r)},jQt=(t,e)=>e,bFe=(t,e,r,i)=>{r&&r.map(([n,s,o])=>{const a=FIt(t,n),l=NIt(e,o),c=kIt(n);pa.ael(a,s,l,c),(e.$rmListeners$=e.$rmListeners$||[]).push(()=>pa.rel(a,s,l,c))})},NIt=(t,e)=>r=>{try{rx.lazyLoad||t.$hostElement$[e](r)}catch(i){_L(i)}},FIt=(t,e)=>e&4?tf:e&8?vL:e&16?tf.body:t,kIt=t=>BIt?{passive:(t&1)!==0,capture:(t&2)!==0}:(t&2)!==0,wFe=new WeakMap,sP=t=>wFe.get(t),zIt=(t,e)=>{const r={$flags$:0,$hostElement$:t,$cmpMeta$:e,$instanceValues$:new Map};return bFe(t,r,e.$listeners$),wFe.set(t,r)},Wye=(t,e)=>e in t,_L=(t,e)=>(0,console.error)(t,e),nz=new Map,UIt=[],vL=typeof window<"u"?window:{},tf=vL.document||{head:{}},HQt=vL.HTMLElement||class{},pa={$flags$:0,$resourcesUrl$:"",jmp:t=>t(),raf:t=>requestAnimationFrame(t),ael:(t,e,r,i)=>t.addEventListener(e,r,i),rel:(t,e,r,i)=>t.removeEventListener(e,r,i),ce:(t,e)=>new CustomEvent(t,e)},BIt=(()=>{let t=!1;try{tf.addEventListener("e",null,Object.defineProperty({},"passive",{get(){t=!0}}))}catch{}return t})(),VIt=t=>Promise.resolve(t),GIt=(()=>{try{return new CSSStyleSheet,typeof new CSSStyleSheet().replaceSync=="function"}catch{}return!1})(),QJ=[],xFe=[],TFe=(t,e)=>r=>{t.push(r),JJ||(JJ=!0,e&&pa.$flags$&4?jIt(KJ):pa.raf(KJ))},qye=t=>{for(let e=0;e<t.length;e++)try{t[e](performance.now())}catch(r){_L(r)}t.length=0},KJ=()=>{qye(QJ),qye(xFe),(JJ=QJ.length>0)&&pa.raf(KJ)},jIt=t=>VIt().then(t),WQt=TFe(QJ,!1),HIt=TFe(xFe,!0);/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-design-system/blob/main/LICENSE.md for details.
 * v2.6.0
 */function Yye(){const{classList:t}=document.body,e=window.matchMedia("(prefers-color-scheme: dark)").matches,r=()=>t.contains(aFe)||t.contains(oFe)&&e?"dark":"light",i=o=>document.body.dispatchEvent(new CustomEvent("calciteModeChange",{bubbles:!0,detail:{mode:o}})),n=o=>{s!==o&&i(o),s=o};let s=r();i(s),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",o=>n(o.matches?"dark":"light")),new MutationObserver(()=>n(r())).observe(document.body,{attributes:!0,attributeFilter:["class"]})}function WIt(){typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document&&(document.readyState==="interactive"?Yye():document.addEventListener("DOMContentLoaded",()=>Yye(),{once:!0}))}const qIt=WIt;qIt();let SFe;function YIt(){try{tIt(".")}catch{rIt(Du(ii(SFe)))}}function use(t){var r;const e=[];for(const i of Object.keys(t))customElements.get(`calcite-${i}`)||e.push((r=t[i])==null?void 0:r.call(t));return e.length>0?Promise.all(e):null}SFe="components/assets";const CFe=Symbol("widget"),EFe=Symbol("widget-test-data"),XIt=[],ZIt={},sz=new WeakMap;function PFe(t,e){let r=e.children;if(r!=null&&r.length)for(let n=0;n<r.length;++n)r[n]=PFe(t,r[n]);else r=XIt;const i=e.vnodeSelector;if(oz(i)){const n=e.properties||ZIt,s=n.key||i;return{vnodeSelector:"div",properties:{key:s,afterCreate:JIt,afterUpdate:QIt,afterRemoved:AFe,parentWidget:t,widgetConstructor:i,widgetProperties:{...n,key:s,children:r}},children:void 0,text:void 0,domNode:null}}return e}function JIt(t,e,r,{parentWidget:i,widgetConstructor:n,widgetProperties:s}){var a;const o=new n(s);o.container=t,sz.set(t,o),(a=o.afterCreate)==null||a.call(o,o,t),i.addHandles(Zr(()=>AFe(t))),queueMicrotask(()=>{o[EFe].projector.renderNow()})}function QIt(t,e,r,{widgetProperties:i}){var s;const n=sz.get(t);n&&(n.set(i),(s=n.afterUpdate)==null||s.call(n,n,t))}function AFe(t){var r;const e=sz.get(t);e&&((r=e.afterRemoved)==null||r.call(e,e,t),e.destroy(),sz.delete(t))}function oz(t){return typeof t=="function"&&t[CFe]}const bL={arrowDown:"esri-icon-arrow-down",arrowUp:"esri-icon-arrow-up",basemap:"esri-icon-basemap",bookmark:"esri-icon-bookmark",calendar:"esri-icon-calendar",checkMark:"esri-icon-check-mark",checkboxUnchecked:"esri-icon-checkbox-unchecked",close:"esri-icon-close",collapse:"esri-icon-collapse",defaultAction:"esri-icon-default-action",description:"esri-icon-description",directions:"esri-icon-directions",dockBottom:"esri-icon-dock-bottom",dockLeft:"esri-icon-dock-left",dockRight:"esri-icon-dock-right",down:"esri-icon-down",downArrow:"esri-icon-down-arrow",download:"esri-icon-download",dragHorizontal:"esri-icon-drag-horizontal",dragVertical:"esri-icon-drag-vertical",duplicate:"esri-icon-duplicate",edit:"esri-icon-edit",elevationProfile:"esri-icon-elevation-profile",environmentSettings:"esri-icon-environment-settings",erase:"esri-icon-erase",error:"esri-icon-error",expand:"esri-icon-expand",fontFallbackText:"esri-icon-font-fallback-text",forward:"esri-icon-forward",gear:"esri-icon-gear",handleHorizontal:"esri-icon-handle-horizontal",handleVertical:"esri-icon-handle-vertical",home:"esri-icon-home",icon:"esri-icon",launchLinkExternal:"esri-icon-launch-link-external",layerList:"esri-icon-layer-list",layers:"esri-icon-layers",left:"esri-icon-left",leftArrows:"esri-icon-left-arrow",leftTriangleArrow:"esri-icon-left-triangle-arrow",lineOfSight:"esri-icon-line-of-sight",link:"esri-icon-link",linkExternal:"esri-icon-link-external",linkHorizontal:"esri-icon-link-horizontal",loadingIndicator:"esri-icon-loading-indicator",locate:"esri-icon-locate",locateCircled:"esri-icon-locate-circled",locked:"esri-icon-locked",mapPin:"esri-icon-map-pin",maximize:"esri-icon-maximize",measure:"esri-icon-measure",measureArea:"esri-icon-measure-area",measureBuildingHeightShadow:"esri-icon-measure-building-height-shadow",measureLine:"esri-icon-measure-line",menu:"esri-icon-menu",minimize:"esri-icon-minimize",minus:"esri-icon-minus",nonVisible:"esri-icon-non-visible",northNavigation:"esri-icon-north-navigation",noticeTriangle:"esri-icon-notice-triangle",organization:"esri-icon-organization",pan:"esri-icon-pan",pan2:"esri-icon-pan2",partlyCloudy:"esri-icon-partly-cloudy",pause:"esri-icon-pause",play:"esri-icon-play",playCircled:"esri-icon-play-circled",plus:"esri-icon-plus",polyline:"esri-icon-polyline",printer:"esri-icon-printer",radioChecked:"esri-icon-radio-checked",radioUnchecked:"esri-icon-radio-unchecked",refresh:"esri-icon-refresh",reverse:"esri-icon-reverse",right:"esri-icon-right",rightArrow:"esri-icon-right-arrow",rightTriangleArrow:"esri-icon-right-triangle-arrow",rotate:"esri-icon-rotate",save:"esri-icon-save",search:"esri-icon-search",settings2:"esri-icon-settings2",slice:"esri-icon-slice",swap:"esri-icon-swap",table:"esri-icon-table",timeClock:"esri-icon-time-clock",tracking:"esri-icon-tracking",trash:"esri-icon-trash",unlockedLinkHorizontal:"esri-icon-unlocked-link-horizontal",up:"esri-icon-up",upArrow:"esri-icon-up-arrow",upDownArrows:"esri-icon-up-down-arrows",urbanModel:"esri-icon-urban-model",vertexGps:"esri-icon-vertex-gps",visible:"esri-icon-visible",zoomInFixed:"esri-icon-zoom-in-fixed",zoomInMagnifyingGlass:"esri-icon-zoom-in-magnifying-glass",zoomOutFixed:"esri-icon-zoom-out-fixed",zoomToObject:"esri-icon-zoom-to-object"},Xye=new Set;function KIt(t){Xye.add(t),t.finally(()=>Xye.delete(t))}var MFe;const eLt="esri.widgets.Widget";let tLt=0;const rLt={widgetIcon:bL.checkboxUnchecked};function OFe(t,e){for(const r in e)t[r]!=null&&(typeof t[r]=="object"&&typeof e[r]=="object"?OFe(t[r],e==null?void 0:e[r]):t[r]=e[r]);return t}const iLt=K$t({postProcessProjectionOptions(t){const e=t.eventHandlerInterceptor,r=/capture$/i;t.eventHandlerInterceptor=(i,n,s,o)=>{const a=e==null?void 0:e(i,n,s,o),l=r.test(i);if(!((i=i.replace(r,"")).toLowerCase()in s)||l){const c=i[2].toLowerCase()+i.slice(3),u=f=>a==null?void 0:a.call(s,f);s.addEventListener(c,u,l);const h=()=>s.removeEventListener(c,u,l),p=o.afterRemoved;o.afterRemoved=f=>{p==null||p(f),h()}}return a}},handleInterceptedEvent(t,e,r,i){const{eventPhase:n,type:s}=i,o=n===Event.CAPTURING_PHASE;let a=`on${s}${o?"capture":""}`;const l=e.properties;(l&&a in l||(a=`on${s[0].toUpperCase()}${s.slice(1)}${o?"Capture":""}`,l&&a in l))&&(pCe(),t.scheduleRender(),l[a].call(l.bind||r,i))}});let Uj=!1,ho=class extends Gz(Qn.EventedAccessor){constructor(e,r){super(e,r),this._attached=!1,this._projector=iLt,this._readyForTrueRender=!1,this.iconClass=rLt.widgetIcon,this.icon=null,this.key=this,this.autoRenderingEnabled=!0,this._loadLocale=Fbe(async()=>{var a;if((a=this._messageBundleProps)!=null&&a.length){const l=await Promise.allSettled(this._messageBundleProps.map(async({bundlePath:c,propertyName:u})=>{if(this.destroyed)return;let h=await iee(c);this.uiStrings&&Object.keys(this.uiStrings)&&(h=OFe(_e(h),this.uiStrings)),this[u]=h}));if(this.destroyed)return;for(const c of l)c.status==="rejected"&&re.getLogger(this).error("widget-intl:locale-error",this.declaredClass,c.reason)}await this.loadLocale()}),YIt();const i="esri-widget-uid-"+sse(),n=this.render.bind(this);this._trackingTarget=new Nz(()=>{this.autoRenderingEnabled&&this.scheduleRender()});const s=()=>{var h;if(!this._readyForTrueRender||this.destroyed)return null;const a=n();let l=a.properties;l||(a.properties=l={});const{key:c}=l;if(c||(l.key=i),oz(a.vnodeSelector)){if(!this.visible)return{vnodeSelector:"div",properties:{key:`${i}-hidden`,class:"",styles:{display:"none"}},domNode:null,children:void 0,text:void 0}}else this.visible?l.styles||(l.styles={}):(l.class="",l.styles={display:"none"}),l.styles.display||(l.styles.display="");let u=0;return(h=a.children)==null||h.forEach(p=>{if(oz(p.vnodeSelector))return;let{properties:f}=p;f||(p.properties=f={}),f.key||(f.key=`${this.id}--${u++}`)}),PFe(this,a)};this.render=()=>{if(Uj)return s();let a=rZe(this)??null;if(a)return a;this._trackingTarget.clear(),Uj=!0;try{a=Z0(this._trackingTarget,s)}catch(l){throw console.error(l),l}finally{Uj=!1}return a&&iZe(this,a),a};const o=this.beforeFirstRender();o?this._resourcesFetch=o.then(()=>{this._readyForTrueRender=!0,this._postInitialize()}):(this._resourcesFetch=Promise.resolve().then(()=>{this._postInitialize()}),this._readyForTrueRender=!0),this.addResolvingPromise(this._resourcesFetch),KIt(this._resourcesFetch)}normalizeCtorArgs(e,r){const i={...e};return r&&(i.container=r),i}postInitialize(){}beforeFirstRender(){var r;const e=this.loadDependencies();return(r=this._messageBundleProps)!=null&&r.length||e?Promise.all([e,this._loadLocale()]).then(()=>{}).catch(Yoe):null}loadDependencies(){return null}loadLocale(){return null}destroy(){this.destroyed||(Pe(this._trackingTarget),Pe(this.viewModel),this._detach(this.container),this._set("container",null),this._emitter.clear(),this.render=()=>null,this._projector=null,mV(this))}set container(e){this._get("container")||this._set("container",e)}castContainer(e){return d9(e)}get domNode(){return this.container}set domNode(e){this.container=e}get id(){var e;return this._get("id")||((e=this.container)==null?void 0:e.id)||Date.now().toString(16)+"-widget-"+tLt++}set id(e){e&&this._set("id",e)}get label(){return this.declaredClass.split(".").pop()}set label(e){this._overrideIfSome("label",e)}get renderable(){return this._resourcesFetch}get visible(){return this._get("visible")}set visible(e){this._set("visible",e)}get[(MFe=CFe,EFe)](){return{projector:this._projector}}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||(mV(this),this._projector.scheduleRender())}own(e){EK(re.getLogger(this),"`Widget.own()` is deprecated in favor of 'Widget.addHandles()'",{replacement:"Widget.addHandles()",version:"4.28"}),this.addHandles(e)}classes(...e){return sZe.apply(this,e)}renderNow(){mV(this),this._projector.renderNow()}_postInitialize(){var r;if(this.destroyed)return;this.scheduleRender(),(r=this._delegatedEventNames)!=null&&r.length&&this.addHandles(he(()=>this.viewModel,(i,n)=>{n&&this.removeHandles("delegated-events"),i&&Iz(i)&&this.addHandles(this._delegatedEventNames.map(s=>A3(i,s,o=>{this.emit(s,o)})),"delegated-events")},Kr)),this.postInitialize();const e=async()=>{await this._loadLocale().catch(Yoe),this.scheduleRender()};this.addHandles([KK(e),he(()=>this.uiStrings,e),fd(()=>this.container,i=>{this.destroyed||this._attach(i)},{initial:!0,once:!0})])}_attach(e){e&&(this._projector.merge(e,this.render),this._attached=!0)}_detach(e){var r;this._attached&&(this._projector.detach(this.render),this._attached=!1),(r=e==null?void 0:e.parentNode)==null||r.removeChild(e)}};ho[MFe]=!0,d([m()],ho.prototype,"_readyForTrueRender",void 0),d([m({value:null})],ho.prototype,"container",null),d([ai("container")],ho.prototype,"castContainer",null),d([m()],ho.prototype,"iconClass",void 0),d([m()],ho.prototype,"icon",void 0),d([m()],ho.prototype,"id",null),d([m()],ho.prototype,"label",null),d([m()],ho.prototype,"renderable",null),d([m()],ho.prototype,"uiStrings",void 0),d([m()],ho.prototype,"viewModel",void 0),d([m({value:!0})],ho.prototype,"visible",null),d([m()],ho.prototype,"key",void 0),d([m()],ho.prototype,"children",void 0),d([m()],ho.prototype,"afterCreate",void 0),d([m()],ho.prototype,"afterUpdate",void 0),d([m()],ho.prototype,"afterRemoved",void 0),ho=d([V(eLt)],ho);const lB=ho;let qF,YF=null;const pE=new Map;async function YQt(t){YF==null&&(qF==null&&(qF=ge(()=>import("./Lyr3DWasmPerSceneView-3Rp1NSzU.js"),__vite__mapDeps([217,83,84,148,149,150,151,75,76,69,123,106,152,92,153,154,155,156,157,126,58,158,90,89,40,38,21,41,33,34,135,103,133,35,36,37,28,39,20,22,23,24,31,32,140,128,49,47,48,50,159,9,102,130,131,160,161,112,162,163,74]))),YF=await qF);const e=t.view;let r=pE.get(e);return r||(r=new YF.default({view:e}),pE.set(e,r)),await r.initializeWasm(),r.add3DTilesLayerView(t)}function nLt(t){return pE.get(t)}function XQt(t){const e=t.view,r=pE.get(e);r&&r.remove3DTilesLayerView(t)<1&&(pE.delete(e),pE.size===0&&(qF=null,YF=null))}function Zye(t,e){return t&&"copyright"in t&&(!e||typeof t.originOf=="function"&&t.originOf("copyright")==="user")}function sLt(t,e){return t.length!==e.length||t.some((r,i)=>r.text!==e[i].text)}function TA(t,e,r){!r||!e||t.find(i=>i.layerView===e&&i.text===r)||t.push({text:r,layerView:e})}function oLt(t){return t.type==="bing-maps"}const Hg=[];let BS=class extends Ae{constructor(e){super(e),this._clear=()=>{this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.removeHandles("suspension"),this.notifyChange("state")},this._pendingAttributions=new Set,this._fetchedAttributionData=new Map,this.items=new $t,this.view=null,this._allLayerViewsChange=r=>{var n;this.removeHandles("suspension"),this.removeHandles("visible-geometry-changed");const i=(n=this.view)==null?void 0:n.allLayerViews;i&&(this.addHandles(i.map(s=>he(()=>{var o;return[s.suspended,(o=s.layer)==null?void 0:o.attributionVisible]},()=>this._updateAttributionItems())).toArray(),"suspension"),i.forEach(s=>{s.declaredClass==="esri.views.3d.layers.Tiles3DLayerView3D"&&this.addHandles(s.on("visible-geometry-changed",()=>this._updateAttributionItems()),"visible-geometry-changed")})),r!=null&&r.removed&&r.removed.forEach(s=>{this._pendingAttributions.delete(s),this._fetchedAttributionData.delete(s)}),this._updateAttributionItems()},this.addHandles([Vo(()=>{var r;return(r=this.view)==null?void 0:r.allLayerViews},"change",r=>this._allLayerViewsChange(r),{onListenerAdd:()=>this._allLayerViewsChange(),onListenerRemove:this._clear}),fd(()=>{var r;return((r=this.view)==null?void 0:r.stationary)===!0},()=>this._updateAttributionItems())])}destroy(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}get state(){var e;return(e=this.view)!=null&&e.ready?this._pendingAttributions.size>0?"loading":"ready":"disabled"}_updateAttributionItems(){const e=this.view,r=e==null?void 0:e.allLayerViews;if(Hg.length=0,!e||!r)return void this._clear();r.forEach(n=>{var a,l;if(n.suspended||!((a=n.layer)!=null&&a.attributionVisible))return;const s=n.layer;if(Zye(s,"user"))return void TA(Hg,n,s.copyright);if(s.hasAttributionData){if(this._fetchedAttributionData.has(n)){const c=this._fetchedAttributionData.get(n);return void(c?TA(Hg,n,this._getDynamicAttribution(c,e,s)):Zye(s)&&TA(Hg,n,s.copyright))}return void this._fetchAttributionData(n)}const o="portalItem"in s?(l=s.portalItem)==null?void 0:l.accessInformation:void 0;TA(Hg,n,o||s.copyright)});const i=r.find(n=>{var s;return((s=n.layer)==null?void 0:s.type)==="integrated-mesh-3dtiles"});if(this.view&&i){const n=nLt(this.view);if(n){const s=n.getAttributionText();for(let o=0;o<s.length;++o)TA(Hg,i,s[o])}}sLt(this.items,Hg)&&(this.items.removeAll(),this.items.addMany(Hg)),Hg.length=0,this.notifyChange("state")}async _fetchAttributionData(e){if(this._pendingAttributions.has(e))return;this._pendingAttributions.add(e);const r=await sg(e.layer.fetchAttributionData());if(this._pendingAttributions.has(e)){const i=r.ok?this._createContributionIndex(r.value,oLt(e.layer)):null;this._pendingAttributions.delete(e),this._fetchedAttributionData.set(e,i)}this._updateAttributionItems()}_createContributionIndex(e,r){const i=e.contributors,n={};if(!i)return n;for(let s=0;s<i.length;s++){const o=i[s],a=o.coverageAreas;if(!a)return;for(const l of a){const c=l.bbox,u=l.zoomMin-(r&&l.zoomMin?1:0),h=l.zoomMax-(r&&l.zoomMax?1:0),p=new ei({xmin:c[1],ymin:c[0],xmax:c[3],ymax:c[2],spatialReference:lt.WGS84}),f={extent:z1(p),attribution:o.attribution||"",score:l.score!=null?l.score:100,id:s};for(let g=u;g<=h;g++)n[g]??(n[g]=[]),n[g].push(f)}}return n.maxKey=Math.max.apply(null,Object.keys(n)),n}_getDynamicAttribution(e,r,i){var u;const{extent:n,scale:s}=r;let o=((u=i.tileInfo)==null?void 0:u.scaleToZoom(s))??0;if(o=Math.min(e.maxKey??0,Math.round(o)),!n||o==null||o<=-1)return"";const a=e[o],l=PI(n.center.clone().normalize(),r.spatialReference),c=new Set;return a?a.filter(h=>{const p=h.id,f=!c.has(p)&&l&&h.extent&&QK(h.extent,l);return f&&c.add(p),f}).sort((h,p)=>p.score-h.score||h.objectId-p.objectId).map(h=>h.attribution).join(", "):""}};d([m({readOnly:!0,type:$t})],BS.prototype,"items",void 0),d([m({readOnly:!0})],BS.prototype,"state",null),d([m()],BS.prototype,"view",void 0),BS=d([V("esri.widgets.Attribution.AttributionViewModel")],BS);const RFe=BS,eg={anchor:"esri-widget__anchor",anchorDisabled:"esri-widget__anchor--disabled",button:"esri-button",buttonDisabled:"esri-button--disabled",buttonHalf:"esri-button--half",buttonSecondary:"esri-button--secondary",buttonSmall:"esri-button--small",buttonTertiary:"esri-button--tertiary",buttonThird:"esri-button--third",disabled:"esri-disabled",disabledElement:"esri-disabled-element",empty:"esri-widget__content--empty",emptyIllustration:"esri-widget__content-illustration--empty",heading:"esri-widget__heading",hidden:"esri-hidden",input:"esri-input",interactive:"esri-interactive",loader:"esri-widget__loader",loaderAnimation:"esri-widget__loader-animation",loaderText:"esri-widget__loader-text",menu:"esri-menu",menuHeader:"esri-menu__header",menuItem:"esri-menu__list-item",menuItemActive:"esri-menu__list-item--active",menuItemFocus:"esri-menu__list-item--focus",menuList:"esri-menu__list",noBookmarksIcon:"esri-widget__no-bookmark-icon",panel:"esri-widget--panel",panelHeightOnly:"esri-widget--panel-height-only",primaryTick:"primary-tick",primaryTickAmPm:"primary-tick__ampm",primaryTickLabel:"primary-tick__label",rotating:"esri-rotating",secondaryTick:"secondary-tick",select:"esri-select",table:"esri-widget__table",widget:"esri-widget",widgetButton:"esri-widget--button",widgetButtonActive:"esri-widget--button-active",widgetDisabled:"esri-widget--disabled"};function aLt(){return function(t,e){if(!t[e])throw new TypeError(`Cannot auto bind undefined function '${String(e)}'`);return{value:cLt(t[e])}}}function lLt(t){const e=t==null?void 0:t.type;return t instanceof KeyboardEvent||e==="keyup"||e==="keydown"||e==="keypress"}function cLt(t){return function(e,...r){lLt(e)?uZe(e.key)&&(e.preventDefault(),e.stopPropagation(),e.target.click()):t.call(this,e,...r)}}function cB(t){return(e,r)=>{e.hasOwnProperty("_messageBundleProps")||(e._messageBundleProps=e._messageBundleProps?e._messageBundleProps.slice():[]),e._messageBundleProps.push({bundlePath:t,propertyName:r})}}var uLt=function(t){return{vnodeSelector:"",properties:void 0,children:void 0,text:t.toString(),domNode:null}},$Fe=function(t,e){for(var r=0,i=t.length;r<i;r++){var n=t[r];Array.isArray(n)?$Fe(n,e):n!=null&&n!==!1&&(n.hasOwnProperty("vnodeSelector")||(n=uLt(n)),e.push(n))}},hLt=function(t,e){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(r.length===1&&typeof r[0]=="string")return{vnodeSelector:t,properties:e||void 0,children:void 0,text:r[0],domNode:null};var n=[];return $Fe(r,n),{vnodeSelector:t,properties:e||void 0,children:n,text:void 0,domNode:null}};function Wc(t,e,...r){return typeof t!="function"||oz(t)?hLt(t,e,...r):t(e,...r)}function JQt(...t){return t}const tS="esri-attribution",Nb={base:tS,poweredBy:`${tS}__powered-by`,sources:`${tS}__sources`,open:`${tS}--open`,sourcesOpen:`${tS}__sources--open`,link:`${tS}__link`,widgetIcon:bL.description};let nl=class extends lB{constructor(e,r){super(e,r),this._isOpen=!1,this._attributionTextOverflowed=!1,this._prevSourceNodeHeight=0,this._resizeObserver=new ResizeObserver(i=>i.forEach(({target:n})=>this._checkSourceTextOverflow(n))),this.iconClass=Nb.widgetIcon,this.icon=null,this.itemDelimiter=" | ",this.messages=null,this.viewModel=new RFe}initialize(){this.addHandles(Vo(()=>{var e;return(e=this.viewModel)==null?void 0:e.items},"change",()=>this.scheduleRender()))}destroy(){var e;(e=this._resizeObserver)==null||e.disconnect()}get _isInteractive(){return this._isOpen||this._attributionTextOverflowed}get attributionText(){return this.viewModel.items.reduce((e,r)=>(e.includes(r.text)||e.push(r.text),e),[]).join(this.itemDelimiter)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e={[Nb.open]:this._isOpen};return Wc("div",{bind:this,class:this.classes(Nb.base,eg.widget,e),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this._renderSourcesNode(),this._renderPoweredBy())}_renderPoweredBy(){return Wc("div",{class:Nb.poweredBy},"Powered by"," ",Wc("a",{class:Nb.link,href:"https://www.esri.com/",rel:"noreferrer",target:"_blank"},"Esri"))}_renderSourcesNode(){const e=this._isOpen,r=this._isInteractive,i=r?0:void 0,{attributionText:n}=this,s={[Nb.sourcesOpen]:e,[eg.interactive]:r};return Wc("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes(Nb.sources,s),innerHTML:n,tabIndex:i})}_afterSourcesNodeCreate(e){this._prevSourceNodeHeight=e.clientWidth,this._resizeObserver.observe(e)}_checkSourceTextOverflow(e){let r=!1;const{clientHeight:i,clientWidth:n,scrollWidth:s}=e,o=s>n,a=this._attributionTextOverflowed!==o;if(this._attributionTextOverflowed=o,a&&(r=!0),this._isOpen){const l=i<this._prevSourceNodeHeight;this._prevSourceNodeHeight=i,l&&(this._isOpen=!1,r=!0)}r&&this.scheduleRender()}_toggleState(){this._isInteractive&&(this._isOpen=!this._isOpen)}};d([m()],nl.prototype,"_isOpen",void 0),d([m()],nl.prototype,"_isInteractive",null),d([m()],nl.prototype,"_attributionTextOverflowed",void 0),d([m()],nl.prototype,"_prevSourceNodeHeight",void 0),d([m({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],nl.prototype,"attributionText",null),d([m()],nl.prototype,"iconClass",void 0),d([m()],nl.prototype,"icon",void 0),d([m()],nl.prototype,"itemDelimiter",void 0),d([m()],nl.prototype,"label",null),d([m(),cB("esri/widgets/Attribution/t9n/Attribution")],nl.prototype,"messages",void 0),d([m()],nl.prototype,"view",null),d([m({type:RFe})],nl.prototype,"viewModel",void 0),d([aLt()],nl.prototype,"_toggleState",null),nl=d([V("esri.widgets.Attribution")],nl);const dLt=nl;function pLt(t){var e,r;return((e=t==null?void 0:t.spatialReference)==null?void 0:e.isWebMercator)||((r=t==null?void 0:t.spatialReference)==null?void 0:r.isGeographic)||!1}const fLt=t=>{let e=class extends t{constructor(...r){super(...r),this.goToOverride=null,this.view=null}callGoTo(r){const{view:i}=this;return Rz(i),this.goToOverride?this.goToOverride(i,r):i.goTo(r.target,r.options)}};return d([m()],e.prototype,"goToOverride",void 0),d([m()],e.prototype,"view",void 0),e=d([V("esri.widgets.support.GoTo")],e),e},mLt="esri.widgets.CompassViewModel";let Rw=class extends fLt(Ae){constructor(e){super(e),this.orientation={x:0,y:0,z:0},this.view=null,this._updateForCamera=this._updateForCamera.bind(this),this._updateForRotation=this._updateForRotation.bind(this),this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this.addHandles(he(()=>this.view,this._updateRotationWatcher,gi))}destroy(){this.view=null}get canShowNorth(){return pLt(this.view)}get state(){var e;return!((e=this.view)!=null&&e.ready)||this.view.type==="2d"&&!this.view.constraints.rotationEnabled?"disabled":this.canShowNorth?"compass":"rotation"}reset(){var r,i;if(!((r=this.view)!=null&&r.ready))return;const e={};((i=this.view)==null?void 0:i.type)==="2d"?e.rotation=0:e.heading=0,this.callGoTo({target:e})}_updateForRotation(e){e!=null&&(this.orientation={z:e})}_updateForCamera(e){if(!e)return;const r=-e.heading;this.orientation={x:0,y:0,z:r}}_updateRotationWatcher(e){this.removeAllHandles(),e&&this.addHandles(e.type==="2d"?he(()=>e==null?void 0:e.rotation,this._updateForRotation,gi):he(()=>e==null?void 0:e.camera,this._updateForCamera,gi))}};d([m({readOnly:!0})],Rw.prototype,"canShowNorth",null),d([m()],Rw.prototype,"orientation",void 0),d([m({readOnly:!0})],Rw.prototype,"state",null),d([m()],Rw.prototype,"view",void 0),Rw=d([V(mLt)],Rw);const IFe=Rw,Jye="esri-compass",Bj={base:Jye,widgetIcon:bL.locateCircled,iconContainer:`${Jye}__icon-container`};let fm=class extends lB{constructor(e,r){super(e,r),this.iconClass=Bj.widgetIcon,this.icon=null,this.messages=null,this.viewModel=new IFe,this._reset=()=>{this.viewModel.reset()},this._toRotationTransform=i=>({transform:`rotateZ(${i.z}deg)`})}loadDependencies(){return use({button:()=>ge(()=>import("./calcite-button-DXst4bK7.js"),__vite__mapDeps([218,219,220,221,222,223,224,225,226,227,228,229])),icon:()=>ge(()=>import("./calcite-icon-DTT2i1Ja.js"),__vite__mapDeps([230,228,220,221,227]))})}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}reset(){return this.viewModel.reset()}render(){const{orientation:e,state:r}=this.viewModel,i=r==="rotation"?"arrow-up":"compass-needle",n=this.icon??i,{messages:s}=this;return Wc("div",{class:this.classes(Bj.base,eg.widget)},Wc("calcite-button",{class:eg.widgetButton,disabled:r==="disabled",kind:"neutral",label:s.reset,onclick:this._reset,round:!0,scale:"s",title:s.reset},Wc("div",{"aria-hidden":"true",class:Bj.iconContainer,title:s.reset},Wc("calcite-icon",{icon:n,scale:"m",styles:this._toRotationTransform(e)}))))}};d([m()],fm.prototype,"goToOverride",null),d([m()],fm.prototype,"iconClass",void 0),d([m()],fm.prototype,"icon",void 0),d([m()],fm.prototype,"label",null),d([m(),cB("esri/widgets/Compass/t9n/Compass")],fm.prototype,"messages",void 0),d([m()],fm.prototype,"view",null),d([m({type:IFe})],fm.prototype,"viewModel",void 0),fm=d([V("esri.widgets.Compass")],fm);const gLt=fm,Qye="esri-navigation-toggle",Vj={base:Qye,widgetIcon:bL.pan2,isLayoutHorizontal:`${Qye}--horizontal`};let VS=class extends Ae{constructor(e){super(e),this.navigationMode="pan",this.view=null}initialize(){this.addHandles(fd(()=>{var e;return(e=this.view)==null?void 0:e.inputManager},()=>this._setNavigationMode()))}destroy(){this.view=null}get state(){var e,r;return(e=this.view)!=null&&e.ready&&((r=this.view)==null?void 0:r.type)==="3d"?"ready":"disabled"}toggle(){this.state!=="disabled"&&(this.navigationMode=this.navigationMode!=="pan"?"pan":"rotate",this._setNavigationMode())}_setNavigationMode(){var r;const e=(r=this.view)==null?void 0:r.inputManager;e&&(e.primaryDragAction=this.navigationMode==="pan"?"pan":"rotate")}};d([m({readOnly:!0})],VS.prototype,"state",null),d([m()],VS.prototype,"navigationMode",void 0),d([m()],VS.prototype,"view",void 0),VS=d([V("esri.widgets.NavigationToggleViewModel")],VS);const LFe=VS;let mm=class extends lB{constructor(e,r){super(e,r),this.iconClass=Vj.widgetIcon,this.icon=null,this.messages=null,this.viewModel=new LFe,this.toggle=()=>this.viewModel.toggle(),this._panButton=null,this._rotateButton=null,this._toggle=()=>{var n;const i=((n=this.viewModel)==null?void 0:n.navigationMode)==="pan"?this._rotateButton:this._panButton;i==null||i.setFocus(),this.toggle()}}loadDependencies(){return use({button:()=>ge(()=>import("./calcite-button-DXst4bK7.js"),__vite__mapDeps([218,219,220,221,222,223,224,225,226,227,228,229]))})}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){var n,s;const e=((n=this.viewModel)==null?void 0:n.state)==="disabled",r=((s=this.viewModel)==null?void 0:s.navigationMode)==="pan",i=this.messages.toggle;return Wc("div",{class:this.classes(Vj.base,eg.widget,{[Vj.isLayoutHorizontal]:this.layout==="horizontal"})},Wc("calcite-button",{afterCreate:o=>{this._panButton=o},appearance:r?"outline-fill":"solid",class:eg.widgetButton,disabled:e,iconStart:"move",kind:"neutral",label:i,onclick:this._toggle,tabIndex:r?void 0:-1,title:i}),Wc("calcite-button",{afterCreate:o=>{this._rotateButton=o},appearance:r?"solid":"outline-fill",class:eg.widgetButton,disabled:e,iconStart:"rotate",kind:"neutral",label:i,onclick:this._toggle,tabIndex:r?-1:void 0,title:i}))}};d([m()],mm.prototype,"iconClass",void 0),d([m()],mm.prototype,"icon",void 0),d([m()],mm.prototype,"label",null),d([m({value:"vertical"})],mm.prototype,"layout",null),d([m(),cB("esri/widgets/NavigationToggle/t9n/NavigationToggle")],mm.prototype,"messages",void 0),d([m()],mm.prototype,"view",null),d([m({type:LFe})],mm.prototype,"viewModel",void 0),mm=d([V("esri.widgets.NavigationToggle")],mm);const yLt=mm;let $w=class extends Ae{get canZoomIn(){var i,n,s;if(!((i=this.view)==null?void 0:i.ready))return!1;const r=(s=(n=this.view)==null?void 0:n.constraints)==null?void 0:s.effectiveMaxScale;return r===0||this._scale>r}get canZoomOut(){var n;const{view:e}=this;if(!(e==null?void 0:e.ready))return!1;const i=(n=e.constraints)==null?void 0:n.effectiveMinScale;return i===0||this._scale<i}get _scale(){var r,i,n;const e=(i=(r=this.view)==null?void 0:r.animation)==null?void 0:i.target;return(e&&"then"in e||e==null?void 0:e.scale)??((n=this.view)==null?void 0:n.scale)??0}};d([m({readOnly:!0})],$w.prototype,"canZoomIn",null),d([m({readOnly:!0})],$w.prototype,"canZoomOut",null),d([m()],$w.prototype,"view",void 0),d([m()],$w.prototype,"_scale",null),$w=d([V("esri.widgets.Zoom.ZoomConditions2D")],$w);const _Lt=$w;let GS=class extends Ae{get canZoomIn(){return!!this.view.ready}get canZoomOut(){return!!this.view.ready}};d([m({readOnly:!0})],GS.prototype,"canZoomIn",null),d([m({readOnly:!0})],GS.prototype,"canZoomOut",null),d([m()],GS.prototype,"view",void 0),GS=d([V("esri.widgets.Zoom.ZoomConditions3D")],GS);const vLt=GS;let V_=class extends Ae{constructor(e){super(e)}destroy(){this.view=null}get canZoomIn(){return this._zoomConditions!=null&&this._zoomConditions.canZoomIn}get canZoomOut(){var e;return this._zoomConditions!=null&&((e=this._zoomConditions)==null?void 0:e.canZoomOut)}get state(){var e;return(e=this.view)!=null&&e.ready?"ready":"disabled"}set view(e){e?e.type==="2d"?this._zoomConditions=new _Lt({view:e}):e.type==="3d"&&(this._zoomConditions=new vLt({view:e})):this._zoomConditions=null,this._set("view",e)}zoomIn(){if(!this.canZoomIn)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomIn():r$(e.goTo({zoomFactor:2}))}zoomOut(){if(!this.canZoomOut)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomOut():r$(e.goTo({zoomFactor:.5}))}};d([m()],V_.prototype,"_zoomConditions",void 0),d([m()],V_.prototype,"canZoomIn",null),d([m()],V_.prototype,"canZoomOut",null),d([m({readOnly:!0})],V_.prototype,"state",null),d([m()],V_.prototype,"view",null),V_=d([V("esri.widgets.Zoom.ZoomViewModel")],V_);const DFe=V_,Gj={base:"esri-zoom",widgetIcon:bL.zoomInMagnifyingGlass,horizontalLayout:"esri-zoom--horizontal"};let gm=class extends lB{constructor(e,r){super(e,r),this.iconClass=Gj.widgetIcon,this.icon=null,this.messages=null,this.viewModel=new DFe,this.zoomIn=()=>this.viewModel.zoomIn(),this.zoomOut=()=>this.viewModel.zoomOut()}loadDependencies(){return use({button:()=>ge(()=>import("./calcite-button-DXst4bK7.js"),__vite__mapDeps([218,219,220,221,222,223,224,225,226,227,228,229]))})}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}set view(e){this.viewModel.view=e}get view(){return this.viewModel.view}render(){const e={[Gj.horizontalLayout]:this.layout==="horizontal"},{canZoomIn:r,canZoomOut:i}=this.viewModel,{zoomIn:n,zoomOut:s}=this.messages;return Wc("div",{class:this.classes(Gj.base,eg.widget,e)},Wc("calcite-button",{class:eg.widgetButton,disabled:!r,iconStart:"plus",kind:"neutral",label:n,onclick:this.zoomIn,title:n}),Wc("calcite-button",{class:eg.widgetButton,disabled:!i,iconStart:"minus",kind:"neutral",label:s,onclick:this.zoomOut,title:s}))}};d([m()],gm.prototype,"iconClass",void 0),d([m()],gm.prototype,"icon",void 0),d([m()],gm.prototype,"label",null),d([m({value:"vertical"})],gm.prototype,"layout",null),d([m(),cB("esri/widgets/Zoom/t9n/Zoom")],gm.prototype,"messages",void 0),d([m()],gm.prototype,"view",null),d([m({type:DFe})],gm.prototype,"viewModel",void 0),gm=d([V("esri.widgets.Zoom")],gm);const bLt=gm;function wLt(t){return(t==null?void 0:t.view)!==void 0}let XF=class extends W$t{constructor(e){super(e),this._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"},this.components=[],this._updateViewAwareWidgets=r=>{this.components.forEach(i=>{const n=this._find(i),s=n==null?void 0:n.widget;wLt(s)&&(s.view=r)})},this._componentsWatcher=(r,i)=>{this._removeComponents(i),this._addComponents(r),this._adjustPadding(r)}}initialize(){this.addHandles([he(()=>this.components,this._componentsWatcher,gi),he(()=>this.view,this._updateViewAwareWidgets,gi)])}_add(e,r,i,n,s){let o=e;if(typeof e=="string"&&this._defaultPositionLookup[e]){if(this._find(e))return;o=this._createComponent(e)}super._add(o,r,i,n,s)}_removeComponents(e){e.forEach(r=>{const i=this._find(r);i&&(this.remove(i),i.destroy())})}_adjustPadding(e){if(!e.includes("attribution")&&!this._isOverridden("padding")){const{top:r}=this.padding;this.padding=r}}_addComponents(e){this.constructed&&e.forEach(r=>this.add(this._createComponent(r),this._defaultPositionLookup[r]))}_createComponent(e){const r=this._createWidget(e);return new WF({id:e,node:r})}_createWidget(e){const{view:r}=this;switch(e){case"attribution":return new dLt({view:r});case"compass":return new gLt({view:r});case"navigation-toggle":return new yLt({view:r});case"zoom":return new bLt({view:r})}}};d([m()],XF.prototype,"components",void 0),XF=d([V("esri.views.ui.DefaultUI")],XF);const NFe=XF;let ZF=class extends NFe{constructor(e){super(e),this.components=["attribution","zoom","navigation-toggle","compass"]}};d([m()],ZF.prototype,"components",void 0),ZF=d([V("esri.views.ui.3d.DefaultUI3D")],ZF);const FFe=ZF;let Ze=class extends cXe(nKe(CZe(Htt))){constructor(t){super(t),this._userClippingArea=null,this._clippingArea=null,this._initialDefaultSpatialReference=null,this._createGraphicsViewController=null,this._resolveWhenReady=[],this._propertiesPool=new ny({slicePlane:RSe},this),this._resourceController=sCt(this),this._defaultToMapOptions={include:new Set},this._defaultHitTestOptions={exclude:new Set},this.deconflictor=new OZ({view:this}),this.labeler=new Sw({view:this,deconflictor:this.deconflictor.labels}),this.sharedSymbolResources=null,this.analyses=new YE,this.basemapTerrain=null,this.elevationProvider=null,this.canvas=null,this.constraints=new jw,this.environment=new CS,this.environmentManager=new tp,this.floors=new $t,this.fullOpacity=1,this.graphicsView=null,this.analysisViewManager=new Ytt({view:this}),this.groundView=null,this.map=null,this.screenSizePerspectiveEnabled=!0,this.state=new aSt,this.spatialReference=null,this.alphaCompositingEnabled=!1,this.preserveDrawingBufferEnabled=!1,this.supersampleScreenshotsEnabled=!0,this.type="3d",this.ui=new FFe,this._numUpdating=0,this._lastUpdateTime=0,this.updatingProgress=.5,this.highlightOptions=new NNe,jWe();const e=(r=null)=>{r!=null&&r.type===vi.MOVE||(this._updatingChanged(),this.map&&this.map.allLayers.forEach(async i=>{try{await i.when()}catch{}this._updatingChanged()}))};this.addHandles([Vo(()=>{var r;return(r=this.map)==null?void 0:r.allLayers},"after-changes",r=>e(r),{onListenerAdd:()=>e(),onListenerRemove:()=>e(),sync:!0}),this.allLayerViews.on("after-changes",r=>this._updateUpdatingMonitors(r)),he(()=>this.map,r=>{r&&"load"in r&&r.load&&r.load().catch(()=>{})})]),this.inputManager=new Gct({view:this}),this.stateManager=new es({view:this})}initialize(){this.groundView=new HQe({view:this}),this._updateUpdatingMonitors();const t=()=>this._updateDefaultToMapOptions();this.addHandles(Vo(()=>{var e;return(e=this.map)==null?void 0:e.allLayers},"after-changes",t,{onListenerAdd:t,onListenerRemove:t})),this.updatingHandles.add(()=>this.qualitySettings.memoryLimit,e=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=e)},gi),this.updatingHandles.add(()=>this.qualitySettings.additionalCacheMemory,e=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=e)},gi),this.updatingHandles.add(()=>this.qualitySettings.frameRate??0,e=>p9e(e>0?1e3/Math.ceil(e):0),gi),this.updatingHandles.add(()=>{var e;return(e=this.map)==null?void 0:e.ground},t,Kr),this.updatingHandles.add(()=>{var e,r;return(r=(e=this.map)==null?void 0:e.ground)==null?void 0:r.opacity},()=>this._updateDefaultHitTestOptions(),Kr),this.addHandles(he(()=>this.spatialReference,()=>this.notifyChange("clippingArea"),Qr))}destroy(){var t;this.destroyed||(this.updatingHandles.removeAll(),this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources=Pe(this.sharedSymbolResources),this._set("labeler",Pe(this.labeler)),this._set("deconflictor",Pe(this.deconflictor)),this._resourceController=Pe(this._resourceController),this._set("stateManager",Pe(this.stateManager)),this._set("inputManager",Pe(this.inputManager)),this.state.destroy(),this._propertiesPool.destroy(),this.removeHandles("updatingMonitors"),this._set("environmentManager",Pe(this.environmentManager)),this._set("environment",Pe(this.environment)),this.groundView=Pe(this.groundView),this._exitBasemapTerrain(),(t=this._stage)==null||t.destroy())}get renderSpatialReference(){return this.renderCoordsHelper&&this.renderCoordsHelper.spatialReference}get basemapSpatialReference(){var t;return(t=this.basemapTerrain)==null?void 0:t.spatialReference}get animation(){var t;return(t=this.state)==null?void 0:t.animation}get camera(){var t;return(t=this.stateManager)==null?void 0:t.camera}set camera(t){this.stateManager&&(this.stateManager.camera=t)}get contentCamera(){var t;return(t=this.stateManager)==null?void 0:t.contentCamera}set contentCamera(t){this.stateManager&&(this.stateManager.contentCamera=t)}installContentCameraReset(t={sticky:!1}){return this.stateManager.installContentCameraReset(t)}get center(){var t;return(t=this.stateManager)==null?void 0:t.center}set center(t){this.stateManager&&(this.stateManager.center=t)}get clippingArea(){if(this.viewingMode==="global")return null;const t=this.map;let e=this._userClippingArea||zoe(t,"clippingArea");return!this._userClippingArea&&!zoe(t,"clippingEnabled")||e==null?(this._clippingArea=null,null):e instanceof ei?this.spatialReference&&(e=L4(e,this.spatialReference),e==null)?(re.getLogger(this).error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea):(e=e.clone(),e.intersection(this._groundAndLayersExtent)==null&&(e.xmin=e.xmax,e.ymin=e.ymax),e.zmin=void 0,e.zmax=void 0,e.equals(this._clippingArea)||(this._clippingArea=e),this._clippingArea):(re.getLogger(this).error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea)}set clippingArea(t){this.ready&&this.viewingMode==="global"&&t!=null?re.getLogger(this).error("#clippingArea=","Clipping area is only supported in local viewingMode"):this._userClippingArea=t}get renderDataExtent(){if(this.state.viewingMode===De.Global)return null;const t=this.renderSpatialReference,e=this.dataExtent;return e==null||t==null||e.spatialReference.equals(t)?e:L4(e,t)}get dataExtent(){let t=this._groundAndLayersExtent;const e=this.spatialReference||lt.WGS84,r=L4(this.clippingArea,e);r!=null&&(t=t!=null?t.intersection(r):r);const i=this._get("dataExtent");return t!=null&&t.equals(i)?i:t}get _groundAndLayersExtent(){const t=this.spatialReference||lt.WGS84;let e;const r=s=>{const o=L4(s,t);o!=null&&(e!=null?e.union(o):e=o.clone())},i=this.basemapTerrain;if(i!=null&&i.spatialReference){const s=i.groundExtent;r(new ei({xmin:s[0],ymin:s[1],zmin:0,xmax:s[2],ymax:s[3],zmax:0,spatialReference:i.spatialReference}))}if(this.map){const s=o=>{o.fullExtent==null||o.type==="graphics"&&o.internal||r(o.fullExtent)};this.map.allLayers.forEach(o=>s(o))}if(e==null)return null;e.hasZ?(e.zmin=Math.min(0,e.zmin??0),e.zmax=Math.max(0,e.zmax??0)):(e.zmin=0,e.zmax=0);const n=this._get("_groundAndLayersExtent");return e.equals(n)?n:e}castEnvironment(t){var e;return t?t instanceof CS?t:t instanceof sPe?((e=this.environment)==null?void 0:e.cloneWithWebsceneEnvironment(t))??CS.fromWebsceneEnvironment(t):Na(CS,t):new CS}get extent(){var t;return(t=this.stateManager)==null?void 0:t.extent}set extent(t){this.stateManager&&(this.stateManager.extent=t)}get screenCenter(){var t;return(t=this.stateManager)==null?void 0:t.screenCenter}get frustum(){var t;return(t=this.stateManager)==null?void 0:t.frustum}get initialExtentRequired(){return this.stateManager&&!this.stateManager.hasInitialView}get _defaultsFromMapSettings(){return{required:{tileInfo:!1,heightModelInfo:!0,extent:!1}}}get interacting(){var t;return this.navigating||(((t=this.toolViewManager)==null?void 0:t.interacting)??!1)}get stationary(){return!this.animation&&!this.resizing&&(this.state==null||this.state.stationary)}get navigating(){var t;return((t=this.state)==null?void 0:t.navigating)??!1}get padding(){var t;return(t=this.stateManager)==null?void 0:t.padding}set padding(t){this.stateManager&&(this.stateManager.padding=t)}set qualityProfile(t){AF.isValidProfile(t)&&(AF.apply(t,this.qualitySettings),this._set("qualityProfile",t))}get qualityProfile(){return this._get("qualityProfile")||AF.getDefaultProfile()}set slicePlane(t){if(this._stage!=null&&this._stage.renderer.setParameters({slicePlane:t}),t==null)return void this._set("slicePlane",null);const e=this._propertiesPool.get("slicePlane");$2(t,e),this._set("slicePlane",e)}get typeSpecificPreconditionsReady(){return!!this.viewingMode&&this.stateManager.preinit(this.spatialReference)}get resolution(){return this.spatialReference!=null?nXe(this.scale,this.spatialReference):0}get scale(){var t;return(t=this.stateManager)==null?void 0:t.scale}set scale(t){this.stateManager&&(this.stateManager.scale=t)}get heightModelInfo(){const t=this.getDefaultHeightModelInfo();return t!=null?DI.deriveUnitFromSR(t,this.spatialReference):null}get updating(){var n,s,o,a;if(this.destroyed)return!1;let t=0,e=this.layerViewManager.updating,r=e?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach(l=>{if(l.isFulfilled()){if(l.updating){if(e=!0,l.suspended||EJ(l))return;++r,t+=l.updatingProgress}}else++r});for(const l of this._updatingObjects)l!=null&&l.updating&&(r+=.1,t+=.5*.1);for(const l of this._updatingObjectsWithProgress)l!=null&&l.updating&&(++r,t+=l.updatingProgress);const i=!this.stateManager.test.updatingIgnoreRenderState&&this.state.updating;if(e=!!(e||r>0||this.updatingHandles.updating||!this.ready||!this.stationary||i||this._createGraphicsViewController||(n=this.inputManager)!=null&&n.updating||(o=(s=this.map)==null?void 0:s.allLayers)!=null&&o.some(l=>!l.isFulfilled())||(a=this.textures)!=null&&a.updating),e?(this._numUpdating=Math.max(r,this._numUpdating),t+=this._numUpdating-r):this._numUpdating=0,this._numUpdating>0?t/=this._numUpdating:t=e?0:1,this._get("updatingProgress")!==t){const l=performance.now();if(t<1){const c=Math.min((l-this._lastUpdateTime)/2e3,1);t=this.updatingProgress*(1-c)+t*c}this._set("updatingProgress",t),this._lastUpdateTime=e&&t<1?l:0}return e}get _updatingObjects(){return[this.graphicsView,this.basemapView,this._resourceController,this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this._featureTreeDebugger,this.toolViewManager,this.analysisViewManager]}get _updatingObjectsWithProgress(){return[this.deconflictor,this.labeler,this.basemapTerrain]}get viewingMode(){var r;const t=this._predeterminedViewingMode;if(t!=null)return _V(t);const e=this.spatialReference;return e?((r=this.defaultsFromMap)==null?void 0:r.viewingMode)!=null&&e.equals(this.defaultsFromMap.spatialReference)?_V(this.defaultsFromMap.viewingMode):xq(e,De.Global)?"global":"local":"global"}set viewingMode(t){this.ready?re.getLogger(this).error("#viewingMode","viewingMode cannot be set once view is ready"):this._overrideIfSome("viewingMode",t)}get viewpoint(){var t;return(t=this.stateManager)==null?void 0:t.viewpoint}set viewpoint(t){this.stateManager&&(this.stateManager.viewpoint=t)}get zoom(){return this.stateManager.zoom}set zoom(t){this.stateManager&&(this.stateManager.zoom=t)}get resourceController(){return this._resourceController}get quality(){var t,e;return((e=(t=this._resourceController)==null?void 0:t.memoryController)==null?void 0:e.memoryFactor)??1}get resolutionScale(){return Math.sqrt(Math.min(1,this.quality/.75))}get performanceInfo(){return new lCt(this)}on(t,e,r,i){return this.viewEvents.on(t,e,r,i)||super.on(t,e)}hasEventListener(t){return super.hasEventListener(t)||this.viewEvents.hasHandler(t)}toMap(t,e){if(!this.ready)return re.getLogger(this).error("#toMap()","Scene view cannot be used before it is ready"),null;const r=Qce(t)?Jce(this,t):t;return xSt(this,r,e,this._defaultToMapOptions)}toScreen(t){if(!this.ready)return re.getLogger(this).error("#toScreen()","Scene view cannot be used before it is ready"),null;const e=(t.z==null?Lm(this.elevationProvider,t):null)??0;return _n(t,D4,this.renderSpatialReference,e),this.state.camera.projectToScreen(D4,jj),dd(jj[0],jj[1])}pixelSizeAt(t){return this.ready?t?(_n(t,D4,this.renderSpatialReference),this.state.camera.computeScreenPixelSizeAt(D4)):0:(re.getLogger(this).error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null)}overlayPixelSizeInMapUnits(t){const e=this.basemapTerrain.overlayManager;return e?e.overlayPixelSizeInMapUnits(t,()=>this.pixelSizeAt(t)):1}hitTest(t,e){if(!this.ready)return re.getLogger(this).error("#hitTest()","Scene view cannot be used before it is ready"),null;const r=Qce(t)?Jce(this,t):t;return wSt(this,r,e,this._defaultHitTestOptions)}async popupHitTest(t){return zSt(this,t)}goTo(t,e){return this.updatingHandles.addPromise(this.stateManager.goTo(t,e))}async whenAnalysisView(t){if(t.parent==null)throw new K("view:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:t});switch(t.parent.type){case"line-of-sight":case"dimension":return(await this.whenLayerView(t.parent)).whenAnalysisView();default:return this.analysisViewManager.whenAnalysisView(t)}}whenLayerView(t){return super.whenLayerView(t)}async takeScreenshot(t){const e=this._completeSettings(t);await this.whenReady();const r=await this._stage.renderView.takeScreenshot(e);return Lj(r,e,this._pixelFormat())}async _takeScreenshot(t){const e=this._completeSettings(t);await this.whenReady();const r=await this._stage.renderView.takeScreenshot(e);return Dj(r,this._pixelFormat())}async _takeScreenshotWithObjectAndLayerId(t){const e=this._completeSettings(t);await this.whenReady();const r=await this._stage.renderView.takeScreenshotWithOID(e);return[Dj(r[0],this._pixelFormat()),Dj(r[1],this._pixelFormat())]}_completeSettings(t){const e=p$t(t,this);return e.pixelRatio/=this.state.pixelRatio,y$t(e,this.supersampleScreenshotsEnabled,this.padding)}_pixelFormat(){return{flipY:!0,premultipliedAlpha:this._stage.renderView.getAlpha()}}get test(){return{takeScreenshot:t=>this._takeScreenshot(t),takeScreenshotWithObjectAndLayerId:t=>this._takeScreenshotWithObjectAndLayerId(t)}}async takeScreenshotWithObjectAndLayerId(t){if(!se("enable-feature:objectAndLayerId-rendering"))throw new Error("has enable-feature:objectAndLayerId-rendering must be true");const e=this._completeSettings(t);await this.whenReady();const r=await this._stage.renderView.takeScreenshotWithOID(e),i=Lj(r[0],e,this._pixelFormat()),n=this._completeSettings(t);return n.format="png",[i,Lj(r[1],n,this._pixelFormat())]}getColorToObjectAndLayerIdMapping(){if(this._stage.renderView.objectAndLayerIdRenderHelper==null)throw new Error("has enable-feature:objectAndLayerId-rendering must be true");return this._stage.renderView.objectAndLayerIdRenderHelper.getColorToObjectAndLayerIdMapping()}addUpdatingPromise(t){return this.updatingHandles.addPromise(t)}importLayerView(t){return oue.importLayerView(t)}hasLayerViewModule(t){return oue.hasLayerViewModule(t)}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){var t,e,r;return this.map&&"initialViewProperties"in this.map&&((t=this.map.initialViewProperties)==null?void 0:t.spatialReference)||((e=this.defaultsFromMap)==null?void 0:e.spatialReference)||((r=this.defaultsFromMap)==null?void 0:r.ready)&&this._initialDefaultSpatialReference||null}async validate(){let t=N$t(this.type);const e=se("safari");if(e&&e<9&&(t=new K("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:e})),t!=null)throw re.getLogger(this).warn("#validate()",t.message),t}get _predeterminedViewingMode(){var e;const t=this._isOverridden("viewingMode")?this._get("viewingMode"):(this.map&&"initialViewProperties"in this.map?(e=this.map.initialViewProperties)==null?void 0:e.viewingMode:null)??null;return t!=null?nce(t):null}getSpatialReferenceSupport({spatialReference:t,layer:e}){const r=this._predeterminedViewingMode;if(r!=null)return this._validateSpatialReferenceForViewingMode(t,e,r)?{constraints:this._makeSpatialReferenceConstraints(t,e,r)}:null;const i=this._validateSpatialReferenceForViewingMode(t,e,De.Local),n=this._validateSpatialReferenceForViewingMode(t,e,De.Global);return i||n?i&&n?{constraints:this._makeSpatialReferenceConstraints(t,e,null)}:i?{constraints:this._makeSpatialReferenceConstraints(t,e,De.Local)}:{constraints:this._makeSpatialReferenceConstraints(t,e,De.Global)}:null}_validateSpatialReferenceForViewingMode(t,e,r){return!!xq(t,r)&&(e==null||!!Aae(e)||(!HO(e)||iB(e,t,r)!=null)&&(!Pae(e)||r!==De.Global))}_makeSpatialReferenceConstraints(t,e,r){if(e==null)return[{spatialReference:t,viewingMode:r}];const i=t.isWebMercator,n=t.isWGS84;return Aae(e)&&(i||n)?!n||r===De.Local||Ene(e.tileInfo,e.fullExtent,t,De.Global)===null?[{spatialReference:t,viewingMode:r},{spatialReference:lt.WebMercator,viewingMode:r}]:[{spatialReference:i?lt.WGS84:lt.WebMercator,viewingMode:r}]:HO(e)||Pae(e)||!i&&!n?HO(e)&&i&&r!==De.Global?[{spatialReference:t,viewingMode:r},{spatialReference:lt.WGS84,viewingMode:De.Local}]:[{spatialReference:t,viewingMode:r}]:[{spatialReference:t,viewingMode:r},{spatialReference:i?lt.WGS84:lt.WebMercator,viewingMode:r}]}_validateSpatialReference(t){const e=this.getSpatialReferenceSupport({spatialReference:t})!=null,r=this._predeterminedViewingMode;return e||(r!=null?re.getLogger(this).warnOnce(`Spatial reference defined on view not supported in ${_V(r)} viewing mode.`):t.isGeographic&&re.getLogger(this).warnOnce("Spatial reference is geographic but not supported.")),e}whenReady(){return new Promise(t=>{this.ready?t(this):this._resolveWhenReady.push(t)})}trackGraphicState(t){if(!t.graphic)return re.getLogger(this).error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;const e=this.getViewForGraphic(t.graphic);let r=null,i=!1;const n=s=>{var o;!i&&s!=null&&"processor"in s&&((o=s.processor)==null?void 0:o.type)==="graphics-3d"&&s.processor.graphicsCore&&(r=s.processor.graphicsCore.trackGraphicState(t))};return e!=null?n(e):this.whenViewForGraphic(t.graphic,{waitForLayer:!0}).then(s=>n(s),()=>{}).catch(()=>{}),Zr(()=>{i=!0,r!=null&&(r.remove(),r=null)})}highlight(t){if(Array.isArray(t))return Hx(t.map(r=>this.highlight(r)));if($t.isCollection(t))return Hx(t.toArray().map(r=>this.highlight(r)));const e=this.getViewForGraphic(t);return e&&"highlight"in e?e.highlight(t):Zr()}maskOccludee(t){if(!t)return re.getLogger(this).error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;const e=this.getViewForGraphic(t);let r=null,i=!1;const n=s=>{!i&&s!=null&&R$t(s)&&(r=s.maskOccludee(t))};return e!=null?n(e):this.whenViewForGraphic(t,{waitForLayer:!0}).then(s=>n(s),()=>{}).catch(()=>{}),Zr(()=>{i=!0,r!=null&&(r.remove(),r=null)})}getViewForGraphic(t){return t.layer===this.graphics?this.graphicsView:t.layer?this.allLayerViews.find(e=>e.layer===t.layer):null}graphicChanged(t){this.graphicsView!=null&&this.graphicsView.graphicChanged(t)}async whenViewForGraphic(t,e){if(t.layer===this)return await UE(()=>this.graphicsView),this.graphicsView;if(!t.layer||!this.map)throw new K("no-view-for-graphic");return e&&e.waitForLayer&&!this.map.allLayers.includes(t.layer)?new Promise((r,i)=>{const n=this.map.allLayers.on("change",s=>{s.added.includes(t.layer)&&(n.remove(),this.whenLayerView(t.layer).then(r,i))})}):this.whenLayerView(t.layer)}_initBasemapTerrain(){this._set("basemapTerrain",new oAt({view:this})),this._set("elevationProvider",new pO({view:this})),this.elevationProvider.register("ground",this.basemapTerrain)}_exitBasemapTerrain(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))}_initGlobe(){this._initCoordinateSystem(),this.state.createInitialCamera(),this._initBasemapTerrain(),this._set("pointsOfInterest",new Vl({view:this})),this._set("featureTiles",new $o({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.cameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));const t=()=>{var r;const e=(r=this.basemapTerrain)==null?void 0:r.extent;if(this.clippingArea||e)if(e&&this.basemapTerrain.spatialReference){const i=this.basemapTerrain.extent!=null&&this.basemapTerrain.spatialReference!=null?M2(a9(this.basemapTerrain.extent,this.basemapTerrain.spatialReference),this.spatialReference):null;this.clippingArea!=null?this.featureTiles.filterExtent=this.clippingArea.intersection(i):this.featureTiles.filterExtent=i}else this.featureTiles.filterExtent=this.clippingArea;else this.featureTiles.filterExtent=null};this.addHandles([this.updatingHandles.add(()=>yi.FEATURE_TILE_TREE_SHOW_TILES,e=>{e&&this.featureTiles&&!this._featureTreeDebugger?this.updatingHandles.addPromise(ge(()=>import("./FeatureTileTree3DDebugger-C9JebYuf.js"),__vite__mapDeps([231,216]))).then(({FeatureTileTree3DDebugger:r})=>{!this._featureTreeDebugger&&yi.FEATURE_TILE_TREE_SHOW_TILES&&(this._featureTreeDebugger=new r({view:this}))}):e||!this._featureTreeDebugger||yi.FEATURE_TILE_TREE_SHOW_TILES||(this._featureTreeDebugger.destroy(),this._featureTreeDebugger=null)},Kr),this.updatingHandles.add(()=>this.clippingArea,t,Kr),this.updatingHandles.add(()=>this.basemapTerrain.extent,t,Kr)],"feature-tiles"),this.stateManager.init()}_exitGlobe(){this.state&&(this.stateManager.exit(),this.removeHandles("render-coords-helper"),this.removeHandles("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",null),this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null),this._exitBasemapTerrain(),this.state.exit(),this._exitCoordinateSystem())}_initCoordinateSystem(){if(this.spatialReference){const t=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(t)||this._set("mapCoordsHelper",new NSt(this.map,t));const e=this.state.isGlobal,r=iXe(e,t);r!==this.renderSpatialReference&&(this._set("renderCoordsHelper",GSt.create(this.state.viewingMode,r)),e||this.addHandles(he(()=>{var i;return(i=this.basemapTerrain)==null?void 0:i.extent},i=>{const n=this.renderCoordsHelper.spatialReference;i==null||i[0]===0&&i[1]===0&&i[2]===0&&i[3]===0||!S9(i,this.basemapTerrain.spatialReference,Kye,n)||(this.renderCoordsHelper.extent=Kye)},Qr),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(QE/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null)}_exitCoordinateSystem(){this.mapCoordsHelper&&(this.removeHandles("render-coords-helper"),this._set("renderCoordsHelper",null),this._set("mapCoordsHelper",null))}_updatingChanged(){this.notifyChange("updating")}_updateUpdatingMonitors(t=null){t!=null&&t.type===vi.MOVE||(this.removeHandles("updatingMonitors"),this.allLayerViews.forEach(e=>{e.destroyed||(this.addHandles(he(()=>[e.updating,e.updatingProgress],()=>this._updatingChanged(),Qr),"updatingMonitors"),e.when(()=>this._updatingChanged(),()=>this._updatingChanged()))}),this._updatingChanged())}async _prepareScreenshotOverlay(){this.overlay&&await this.overlay.prepare()}_renderScreenshotOverlay(t,e,r){if(!this.overlay||!this.overlay.hasVisibleItems)return r;const i=t.getContext("2d");return i.putImageData(r,0,0),this.overlay.renderCanvas(t,{disableDecorations:e===Xl.OFF}),i.getImageData(0,0,r.width,r.height)}_initStage(){const t={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,preserveDrawingBuffer:this.preserveDrawingBufferEnabled,canvas:this.renderCanvas,screenshot:{prepareOverlay:()=>this._prepareScreenshotOverlay(),renderOverlay:(i,n,s)=>this._renderScreenshotOverlay(i,n,s)}},e=new CSt(this.state.viewingMode,i=>this._stage.layers.forAll(i),this);this._set("sceneIntersectionHelper",e);const r=d9(this.surface);this._stage=new xu({view:this,options:t,container:r}),this._stage.renderer.setParameters({slicePlane:this.slicePlane}),this.addHandles([this.updatingHandles.add(()=>this.qualitySettings.highQualityTransparency,i=>this._stage.renderer.setParameters({highQualityTransparency:i}),gi),he(()=>this.magnifier,i=>this._stage.renderView.magnifier=i,Kr),this.on("pointer-move",()=>{var i;return(i=this._stage)==null?void 0:i.renderer.resetAnimation()}),A3(this._stage.renderView.canvas,"webglcontextlost",i=>{this.fatalError=new K("webgl-context-lost",i.statusMessage)})],"stage"),this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(QE/this.renderCoordsHelper.unitInMeters),this._set("canvas",this._stage.renderView.canvas)}_exitStage(){this._set("sceneIntersectionHelper",null),this._stage=Pe(this._stage),this.removeHandles("stage"),this._set("canvas",null)}_initSurface(t){this._exitSurface(),this.state.init(t,this.spatialReference),this._initStage(),this._initGlobe(),this.sharedSymbolResources=new hCt({view:this,viewingMode:t,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state})}_exitSurface(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())}_createGraphicsViewIfNeeded(){if(this.graphicsView||this._createGraphicsViewController||this.graphics.length===0)return;this.removeHandles("graphics-view"),this._createGraphicsViewController=new AbortController;const t=()=>{this._createGraphicsViewController=null,this._updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(t,t),this._updatingChanged()}async _createGraphicsViewAsync(t){const e=(await ge(()=>import("./GraphicsView3D-DQnEYNx5.js"),__vite__mapDeps([232,170,58,158,90,89,40,38,21,41,33,34,135]))).default;vt(t),await UE(()=>{var r;return(r=this.basemapTerrain)==null?void 0:r.ready},t),this._set("graphicsView",new e({view:this}))}_disposeGraphicsView(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null),this.removeHandles("graphics-view"),this.graphicsView!=null&&(this.removeHandles(this.graphicsView.processor.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null))}_startup(){var i;const t=nce(this.viewingMode);t===De.Global&&(this._clippingArea=null),this._initSurface(t),this._set("ready",!0),this.addHandles(Vo(()=>this.graphics,"after-changes",()=>this._createGraphicsViewIfNeeded()),"graphics-view"),this._createGraphicsViewIfNeeded();const e=this.map&&"initialViewProperties"in this.map?(i=this.map.initialViewProperties)==null?void 0:i.environment:void 0;e&&DTe(this.environment,e),this.labeler.setup(),this.environmentManager.connectView(this),this.inputManager.connect(),this._set("textures",new TC(this._stage,this.resourceController.scheduler));const r=this._resolveWhenReady;this._resolveWhenReady=[],r.forEach(n=>n(this))}_teardown(){this._initialDefaultSpatialReference=null,this.inputManager.disconnect(),this.environmentManager.disconnectView(),this.labeler.dispose(),this._disposeGraphicsView(),this.removeHandles("graphics-view"),this._set("textures",Pe(this.textures)),this._exitSurface(),this._set("ready",!1)}_updateDefaultToMapOptions(){if(this._defaultToMapOptions.include.clear(),this.map){this.map.ground&&this._defaultToMapOptions.include.add(pv);for(const t of this.map.allLayers.items)m$(t.type)&&this._defaultToMapOptions.include.add(t.uid)}}_updateDefaultHitTestOptions(){if(this._defaultHitTestOptions.exclude.clear(),this.map){this.map.ground&&this.map.ground.opacity<1&&this._defaultHitTestOptions.exclude.add(pv);for(const t of this.map.allLayers.items)m$(t.type)&&t.opacity<1&&this._defaultHitTestOptions.exclude.add(t.uid)}}};function L4(t,e){return t!=null&&md(t.spatialReference,e)?M2(t,e):null}Ze.type="3d",d([m()],Ze.prototype,"_userClippingArea",void 0),d([m()],Ze.prototype,"_resourceController",void 0),d([m()],Ze.prototype,"_stage",void 0),d([m({readOnly:!0})],Ze.prototype,"deconflictor",void 0),d([m({readOnly:!0})],Ze.prototype,"labeler",void 0),d([m(p6(YE,"analyses"))],Ze.prototype,"analyses",void 0),d([m({type:r3,readOnly:!0})],Ze.prototype,"animation",null),d([m({readOnly:!0})],Ze.prototype,"basemapTerrain",void 0),d([m({readOnly:!0})],Ze.prototype,"elevationProvider",void 0),d([m()],Ze.prototype,"camera",null),d([m({type:eu})],Ze.prototype,"contentCamera",null),d([m({readOnly:!0})],Ze.prototype,"canvas",void 0),d([m({type:ke})],Ze.prototype,"center",null),d([m({type:ei})],Ze.prototype,"clippingArea",null),d([m({type:jw})],Ze.prototype,"constraints",void 0),d([m({type:ei,readOnly:!0})],Ze.prototype,"renderDataExtent",null),d([m({type:ei,readOnly:!0})],Ze.prototype,"dataExtent",null),d([m({type:ei,readOnly:!0})],Ze.prototype,"_groundAndLayersExtent",null),d([m({type:CS})],Ze.prototype,"environment",void 0),d([ai("environment")],Ze.prototype,"castEnvironment",null),d([m({readOnly:!0})],Ze.prototype,"environmentManager",void 0),d([m({type:ei})],Ze.prototype,"extent",null),d([m()],Ze.prototype,"floors",void 0),d([m()],Ze.prototype,"screenCenter",null),d([m()],Ze.prototype,"frustum",null),d([m({type:Number,readOnly:!0})],Ze.prototype,"fullOpacity",void 0),d([m({readOnly:!0})],Ze.prototype,"graphicsView",void 0),d([m({readOnly:!0})],Ze.prototype,"analysisViewManager",void 0),d([m()],Ze.prototype,"groundView",void 0),d([m({type:Boolean})],Ze.prototype,"initialExtentRequired",null),d([m()],Ze.prototype,"_defaultsFromMapSettings",null),d([m()],Ze.prototype,"interacting",null),d([m()],Ze.prototype,"stationary",null),d([m()],Ze.prototype,"navigating",null),d([m()],Ze.prototype,"map",void 0),d([m({readOnly:!0})],Ze.prototype,"mapCoordsHelper",void 0),d([m()],Ze.prototype,"padding",null),d([m({type:Vl,readOnly:!0})],Ze.prototype,"pointsOfInterest",void 0),d([m({type:$o,readOnly:!0})],Ze.prototype,"featureTiles",void 0),d([m()],Ze.prototype,"_featureTreeDebugger",void 0),d([m({type:Boolean})],Ze.prototype,"screenSizePerspectiveEnabled",void 0),d([m({constructOnly:!0})],Ze.prototype,"deactivatedWebGLExtensions",void 0),d([m({constructOnly:!0})],Ze.prototype,"debugWebGLExtensions",void 0),d([m({constructOnly:!0})],Ze.prototype,"renderCanvas",void 0),d([m({constructOnly:!0})],Ze.prototype,"state",void 0),d([m({readOnly:!0})],Ze.prototype,"inputManager",void 0),d([m({readOnly:!0})],Ze.prototype,"stateManager",void 0),d([m({type:["low","medium","high"]})],Ze.prototype,"qualityProfile",null),d([m({type:Mge,get(){let t=this._get("qualitySettings");return t||(t=new Mge,AF.apply(this.qualityProfile,t)),t}})],Ze.prototype,"qualitySettings",void 0),d([m()],Ze.prototype,"slicePlane",null),d([m({readOnly:!0})],Ze.prototype,"typeSpecificPreconditionsReady",null),d([m({readOnly:!0})],Ze.prototype,"renderCoordsHelper",void 0),d([m({readOnly:!0})],Ze.prototype,"sceneIntersectionHelper",void 0),d([m({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],Ze.prototype,"resolution",null),d([m({type:Number})],Ze.prototype,"scale",null),d([m()],Ze.prototype,"heightModelInfo",null),d([m()],Ze.prototype,"spatialReference",void 0),d([m({type:Boolean,constructOnly:!0})],Ze.prototype,"alphaCompositingEnabled",void 0),d([m({constructOnly:!0})],Ze.prototype,"preserveDrawingBufferEnabled",void 0),d([m({type:Boolean})],Ze.prototype,"supersampleScreenshotsEnabled",void 0),d([m({readOnly:!0})],Ze.prototype,"type",void 0),d([m(),ai(t=>t instanceof NFe?t:Yx(FFe,t))],Ze.prototype,"ui",void 0),d([m({type:Boolean,readOnly:!0,dependsOn:["graphicsView.updating","basemapView.updating","basemapTerrain.updating","layerViewManager.updating","layerViewManager.updatingRemaining","_resourceController.updating","_stage.updating","featureTiles.updating","pointsOfInterest.updating","environmentManager.updating","overlay.updating","updatingHandles.updating","featureTreeDebugger.updating","labeler.updating","deconflictor.updating","ready","stationary","inputManager.updating","toolViewManager.updating","analysisViewManager.updating","state.updating","textures.updating"]})],Ze.prototype,"updating",null),d([m()],Ze.prototype,"_updatingObjects",null),d([m()],Ze.prototype,"_updatingObjectsWithProgress",null),d([m({type:Number,readOnly:!0,dependsOn:["updating"]})],Ze.prototype,"updatingProgress",void 0),d([m({type:["global","local"]})],Ze.prototype,"viewingMode",null),d([m({type:sf})],Ze.prototype,"viewpoint",null),d([m({type:Number})],Ze.prototype,"zoom",null),d([m({type:NNe})],Ze.prototype,"highlightOptions",void 0),d([m({readOnly:!0})],Ze.prototype,"quality",null),d([m({readOnly:!0})],Ze.prototype,"resolutionScale",null),d([m()],Ze.prototype,"textures",void 0),Ze=d([V("esri.views.SceneView")],Ze);const D4=C(),jj=pn(),Kye=Wt(),xLt=Ze,e_e={read:{reader:w1t},write:{allowNull:!0,writer:x1t}},TLt=t=>{let e=class extends t{constructor(){super(...arguments),this.blendMode="normal",this.effect=null}};return d([m({type:["average","color-burn","color-dodge","color","darken","destination-atop","destination-in","destination-out","destination-over","difference","exclusion","hard-light","hue","invert","lighten","lighter","luminosity","minus","multiply","normal","overlay","plus","reflect","saturation","screen","soft-light","source-atop","source-in","source-out","vivid-light","xor"],nonNullable:!0,json:{read:!1,write:!1,origins:{"web-map":{read:!0,write:!0},"portal-item":{read:!0,write:!0}}}})],e.prototype,"blendMode",void 0),d([m({json:{read:!1,write:!1,origins:{"web-map":e_e,"portal-item":e_e}}})],e.prototype,"effect",void 0),e=d([V("esri.layers.mixins.BlendLayer")],e),e},SLt=t=>{let e=class extends t{constructor(){super(...arguments),this.minScale=0,this.maxScale=0}get effectiveScaleRange(){const r={minScale:this.minScale,maxScale:this.maxScale},i=this.parent;i&&"effectiveScaleRange"in i&&CLt(r,i.effectiveScaleRange);const n=this._get("effectiveScaleRange");return n&&n.minScale===r.minScale&&n.maxScale===r.maxScale?n:r}};return d([m({type:Number,nonNullable:!0,json:{write:!0}})],e.prototype,"minScale",void 0),d([m({type:Number,nonNullable:!0,json:{write:!0}})],e.prototype,"maxScale",void 0),d([m({readOnly:!0})],e.prototype,"effectiveScaleRange",null),e=d([V("esri.layers.mixins.ScaleRangeLayer")],e),e};function CLt(t,e){return t.minScale=t.minScale>0?e.minScale>0?Math.min(t.minScale,e.minScale):t.minScale:e.minScale,t.maxScale=t.maxScale>0?e.maxScale>0?Math.max(t.maxScale,e.maxScale):t.maxScale:e.maxScale,t}var eQ;let EO=eQ=class extends ze{constructor(t){super(t)}async collectRequiredFields(t,e){return sy(t,e,this.expression)}clone(){return new eQ({expression:this.expression,title:this.title})}equals(t){return this.expression===t.expression&&this.title===t.title}};d([m({type:String,json:{write:!0}})],EO.prototype,"expression",void 0),d([m({type:String,json:{write:!0}})],EO.prototype,"title",void 0),EO=eQ=d([V("esri.layers.support.FeatureExpressionInfo")],EO);const t_e=EO;var tQ;const N4=ac()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),r_e=new yn({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"});let l0=tQ=class extends ze{constructor(t){super(t),this.offset=null}readFeatureExpressionInfo(t,e){return t??(e.featureExpression&&e.featureExpression.value===0?{expression:"0"}:void 0)}writeFeatureExpressionInfo(t,e,r,i){e[r]=t.write({},i),t.expression==="0"&&(e.featureExpression={value:0})}get mode(){const{offset:t,featureExpressionInfo:e}=this;return this._isOverridden("mode")?this._get("mode"):t!=null||e?"relative-to-ground":"on-the-ground"}set mode(t){this._override("mode",t)}set unit(t){this._set("unit",t)}write(t,e){return this.offset||this.mode||this.featureExpressionInfo||this.unit?super.write(t,e):null}clone(){return new tQ({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})}equals(t){return this.mode===t.mode&&this.offset===t.offset&&this.unit===t.unit&&Rze(this.featureExpressionInfo,t.featureExpressionInfo)}};d([m({type:t_e,json:{write:!0}})],l0.prototype,"featureExpressionInfo",void 0),d([Tr("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],l0.prototype,"readFeatureExpressionInfo",null),d([hr("featureExpressionInfo",{featureExpressionInfo:{type:t_e},"featureExpression.value":{type:[0]}})],l0.prototype,"writeFeatureExpressionInfo",null),d([m({type:N4.apiValues,nonNullable:!0,json:{type:N4.jsonValues,read:N4.read,write:{writer:N4.write,isRequired:!0}}})],l0.prototype,"mode",null),d([m({type:Number,json:{write:!0}})],l0.prototype,"offset",void 0),d([m({type:jht,json:{type:String,read:r_e.read,write:r_e.write}})],l0.prototype,"unit",null),l0=tQ=d([V("esri.layers.support.ElevationInfo")],l0);const ELt=l0;let c0=class extends TLt(SLt(b2e)){constructor(e){super(e),this.elevationInfo=null,this.graphics=new Ox,this.screenSizePerspectiveEnabled=!0,this.type="graphics",this.internal=!1}destroy(){this.removeAll(),this.graphics.destroy()}add(e){return this.graphics.add(e),this}addMany(e){return this.graphics.addMany(e),this}removeAll(){return this.graphics.removeAll(),this}remove(e){this.graphics.remove(e)}removeMany(e){this.graphics.removeMany(e)}on(e,r){return super.on(e,r)}graphicChanged(e){this.emit("graphic-update",e)}};d([m({type:ELt})],c0.prototype,"elevationInfo",void 0),d([m(p6(Ox,"graphics"))],c0.prototype,"graphics",void 0),d([m({type:["show","hide"]})],c0.prototype,"listMode",void 0),d([m()],c0.prototype,"screenSizePerspectiveEnabled",void 0),d([m({readOnly:!0})],c0.prototype,"type",void 0),d([m({constructOnly:!0})],c0.prototype,"internal",void 0),c0=d([V("esri.layers.GraphicsLayer")],c0);const PLt=c0,ALt="Mesh must be loaded before applying operations",MLt="Provided component is not part of the list of components",OLt="Expected polygon to be a Polygon instance",PO="Expected location to be a Point instance";let i_e=class extends K{constructor(){super("invalid-input:location",PO)}};function RLt([t,e,r,i,n,s],o,a,l){n_e??(n_e=new Float64Array(24));const c=n_e;return c[0]=t,c[1]=e,c[2]=r,c[3]=t,c[4]=n,c[5]=r,c[6]=i,c[7]=n,c[8]=r,c[9]=i,c[10]=e,c[11]=r,c[12]=t,c[13]=e,c[14]=s,c[15]=t,c[16]=n,c[17]=s,c[18]=i,c[19]=n,c[20]=s,c[21]=i,c[22]=e,c[23]=s,sne({positions:c,transform:o,vertexSpace:a,inSpatialReference:l,outSpatialReference:l,outPositions:c}),zFe(c,l)}let n_e=null;function kFe(t){if(t.length===0)return Lte;const e=vs([Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,-Number.POSITIVE_INFINITY,-Number.POSITIVE_INFINITY,-Number.POSITIVE_INFINITY]);return Hc(e,t),e}function zFe(t,e){const[r,i,n,s,o,a]=kFe(t);return new ei({xmin:r,ymin:i,zmin:n,xmax:s,ymax:o,zmax:a,spatialReference:e})}const dI="esri.geometry.support.meshUtils.centerAt";function $Lt(t,e,r){var a;if(!((a=t.vertexAttributes)!=null&&a.position))return;const{vertexSpace:i}=t,n=(r==null?void 0:r.origin)??t.anchor,s=r==null?void 0:r.geographic,o=Kie(dI,i,n.spatialReference,s);gf(i)?ILt(t,e,n):o?LLt(t,e,n):DLt(t,e,n)}function ILt(t,e,r){const{vertexSpace:i}=t;if(!gf(i))return;const n=BFe,s=UFe;if(!_n(e,s,t.spatialReference))return void re.getLogger(dI).error(`Failed to project centerAt location (wkid:${e.spatialReference.wkid}) to mesh spatial reference (wkid:${t.spatialReference.wkid}). Projection may be possible after calling projection.load().`);if(!_n(r,n,t.spatialReference)){const a=t.origin;n[0]=a.x,n[1]=a.y,n[2]=a.z,re.getLogger(dI).error(`Failed to project specified origin (wkid:${r.spatialReference.wkid}) to mesh spatial reference (wkid:${t.spatialReference.wkid}). Projection may be possible after calling projection.load().`)}const o=ye(FLt,s,n);i.origin=fe(C(),i.origin,o)}function LLt(t,e,r){const i=one(t.vertexAttributes,r),{position:n,normal:s,tangent:o}=QU(i,e,!1);t.vertexAttributes.position=n,t.vertexAttributes.normal=s,t.vertexAttributes.tangent=o,t.vertexAttributesChanged()}function DLt(t,e,r){const i=BFe,n=UFe;if(_n(e,n,t.spatialReference)){if(!_n(r,i,t.spatialReference)){const s=t.origin;i[0]=s.x,i[1]=s.y,i[2]=s.z,re.getLogger(dI).error(`Failed to project specified origin (wkid:${r.spatialReference.wkid}) to mesh spatial reference (wkid:${t.spatialReference.wkid}). Projection may be possible after calling projection.load().`)}NLt(t.vertexAttributes.position,n,i),t.vertexAttributesChanged()}else re.getLogger(dI).error(`Failed to project centerAt location (wkid:${e.spatialReference.wkid}) to mesh spatial reference (wkid:${t.spatialReference.wkid}). Projection may be possible after calling projection.load().`)}function NLt(t,e,r){if(t)for(let i=0;i<t.length;i+=3)for(let n=0;n<3;n++)t[i+n]+=e[n]-r[n]}const UFe=C(),BFe=C(),FLt=C();async function kLt(t,e,r){const{source:i}=e,{loadGLTFMesh:n}=await AK(ge(()=>import("./loadGLTFMesh-BRsO50CG.js"),__vite__mapDeps([])),r),s=await ULt(i,r);vt(r);const o=n(new ke({x:0,y:0,z:0,spatialReference:t.spatialReference}),s.url,{resolveFile:zLt(s),signal:r==null?void 0:r.signal,expectedType:s.type});o.then(()=>s.dispose(),()=>s.dispose());const{vertexAttributes:a,components:l}=await o;t.vertexAttributes=a,t.components=l}function zLt(t){const e=Vz(t.url);return r=>{const i=Uz(r,e,e),n=i?i.replace(/^ *\.\//,""):null;return(n?t.files.get(n):null)??r}}async function ULt(t,e){if(Array.isArray(t)){if(!t.length)throw new K("mesh-load-external:missing-assets","There must be at least one file to load");return t[0]instanceof File?VLt(t):GLt(t,e)}return VFe(t)}async function BLt(t,e){const{parts:r,assetMimeType:i,assetName:n}=t;if(r.length===1)return new az(r[0].partUrl);const s=await t.toBlob(e);return vt(e),az.fromBlob(s,qFe(n,i))}function VFe(t){return az.fromBlob(t,qFe(t.name,t.type))}function VLt(t){return HFe(t.map(e=>({name:e.name,mimeType:e.type,source:VFe(e)})))}async function GLt(t,e){const r=await $k(t.map(async i=>{const n=await BLt(i);return vt(e),{name:i.assetName,mimeType:i.assetMimeType,source:n}}));if(Ls(e))throw r.forEach(i=>i.source.dispose()),dr();return HFe(r)}const GFe=/^model\/gltf\+json$/,jFe=/^model\/gltf-binary$/,rQ=/\.gltf$/i,jLt=/\.glb$/i;function HFe(t){const e=new Map;let r,i=null;for(const{name:n,mimeType:s,source:o}of t)i===null&&(GFe.test(s)||rQ.test(n)?(i=o.url,r="gltf"):(jFe.test(s)||jLt.test(n))&&(i=o.url,r="glb")),e.set(n,o.url),o.files.forEach((a,l)=>e.set(l,a));if(i==null)throw new K("mesh-load-external:missing-files","Missing files to load external mesh source");return new az(i,()=>t.forEach(({source:n})=>n.dispose()),e,r)}let az=class WFe{constructor(e,r=()=>{},i=new Map,n){this.url=e,this.dispose=r,this.files=i,this.type=n}static fromBlob(e,r){const i=URL.createObjectURL(e);return new WFe(i,()=>URL.revokeObjectURL(i),void 0,r)}};function qFe(t,e){return GFe.test(e)||rQ.test(t)?"gltf":jFe.test(e)||rQ.test(t)?"glb":void 0}const HLt=[["binary","application/octet-stream","bin",""]];function hKt(t,e){return JFe(e.name,(t==null?void 0:t.supportedFormats)??[])!=null}function dKt(t,e){if(!t)return!1;const r=ZFe(e,t.supportedFormats??[]);return r!=null&&t.editFormats.includes(r)}function YFe(t,e){return dse(qLt(t,e))}function XFe(t,e){return dse(JFe(t,e))}function pKt(t,e){return QFe(WLt(t,e))}function ZFe(t,e){return XFe(t.name,e)??YFe(t.type,e)}function hse(t){return[...HLt,...t]}function WLt(t,e){return hse(e).find(r=>dse(r)===t)}function qLt(t,e){const r=t.toLowerCase();return hse(e).find(i=>QFe(i)===r)}function JFe(t,e){const r=t.toLowerCase();return hse(e).find(i=>YLt(i).some(n=>r.endsWith(n)))}function dse(t){return t==null?void 0:t[0]}function QFe(t){return t==null?void 0:t[1].toLowerCase()}function YLt(t){return(t==null?void 0:t[2].split(",").map(e=>e.toLowerCase()))??[]}function fKt(t){var e;return(e=t.tables)==null?void 0:e.find(r=>r.role==="assetMaps")}let KFe=class{constructor(e,r,i){this.assetName=e,this.assetMimeType=r,this.parts=i}equals(e){return this===e||this.assetName===e.assetName&&this.assetMimeType===e.assetMimeType&&tg(this.parts,e.parts,(r,i)=>r.equals(i))}isOnService(e){return this.parts.every(r=>r.isOnService(e))}makeHash(){let e="";for(const r of this.parts)e+=r.partHash;return e}async toBlob(e){const{parts:r}=this;if(r.length===1)return r[0].toBlob(e);const i=await Promise.all(r.map(n=>n.toBlob(e)));return vt(e),new Blob(i)}};class gKt{constructor(e,r){this.partUrl=e,this.partHash=r}equals(e){return this===e||this.partUrl===e.partUrl&&this.partHash===e.partHash}isOnService(e){return this.partUrl.startsWith(`${e.path}/assets/`)}async toBlob(e){const{data:r}=await Xi(this.partUrl,{responseType:"blob"});return vt(e),r}}function s_e(t){return XLt(t==null?void 0:t.source)}function o_e(t){return Array.isArray(t)?t.every(e=>e instanceof KFe):!1}const a_e=/^(model\/gltf\+json)|(model\/gltf-binary)$/,l_e=/\.(gltf|glb)/i;function XLt(t){return t?Array.isArray(t)?t.some(c_e):c_e(t):!1}function c_e(t){if(t instanceof File){const{type:e,name:r}=t;return a_e.test(e)||l_e.test(r)}return a_e.test(t.assetMimeType)||l_e.test(t.assetName)}function ZLt(t,e){if(!t)return!1;const{source:r}=t;return QLt(r,e)}function JLt(t,e){if(t===e)return!0;const{source:r}=t,{source:i}=e;if(r===i)return!0;if(o_e(r)&&o_e(i)){if(r.length!==i.length)return!1;const n=(a,l)=>a.assetName<l.assetName?-1:a.assetName>l.assetName?1:0,s=[...r].sort(n),o=[...i].sort(n);for(let a=0;a<s.length;++a)if(!s[a].equals(o[a]))return!1;return!0}return!1}function QLt(t,e){if(Array.isArray(t)){const r=t;return r.length>0&&r.every(i=>u_e(i,e))}return u_e(t,e)}function u_e(t,e){return t instanceof KFe&&t.isOnService(e)}function yKt(t,e){return t instanceof File?ZFe(t,e):YFe(t.assetMimeType,e)??XFe(t.assetName,e)}function _Kt(t){return Array.isArray(t)?t:[t]}function vKt(t){return!!t.original}let i1=class extends nv{constructor(){super(),this.externalSources=new $t,this._explicitDisplaySource=null,this.addHandles(Vo(()=>this.externalSources,"after-remove",({item:e})=>{e===this._explicitDisplaySource&&(this._explicitDisplaySource=null)},{sync:!0,onListenerRemove:()=>this._explicitDisplaySource=null}))}get displaySource(){return this._explicitDisplaySource??this._implicitDisplaySource}set displaySource(e){if(e!=null&&!s_e(e))throw new Error("Cannot use this source for display: it is not in a supported format.");this._explicitDisplaySource=e,e&&this.externalSources.every(r=>!JLt(r,e))&&this.externalSources.add(e)}clearSources(){this.externalSources.removeAll()}getExternalSourcesOnService(e){return this.externalSources.items.filter(r=>ZLt(r,e))}get _implicitDisplaySource(){return this.externalSources.find(s_e)}};d([m()],i1.prototype,"externalSources",void 0),d([m()],i1.prototype,"displaySource",null),d([m()],i1.prototype,"_implicitDisplaySource",null),d([m()],i1.prototype,"_explicitDisplaySource",void 0),i1=d([V("esri.geometry.support.meshUtils.Metadata")],i1);function KLt(){const{faceDescriptions:t,faceVertexOffsets:e,uvScales:r}=lDt,i=4*t.length,n=new Float64Array(3*i),s=new Float32Array(3*i),o=new Float32Array(2*i),a=new Uint32Array(2*t.length*3);let l=0,c=0,u=0,h=0;for(let p=0;p<t.length;p++){const f=t[p],g=l/3;for(const v of e)a[h++]=g+v;const _=f.corners;for(let v=0;v<4;v++){const b=_[v];let w=0;o[u++]=.25*r[v][0]+f.uvOrigin[0],o[u++]=f.uvOrigin[1]-.25*r[v][1];for(let x=0;x<3;x++)f.axis[x]!==0?(n[l++]=.5*f.axis[x],s[c++]=f.axis[x]):(n[l++]=.5*b[w++],s[c++]=0)}}return{position:n,normal:s,uv:o,faces:a}}function eDt(t,e){const r=t.components[0],i=r.faces,n=cDt[e],s=6*n,o=new Array(6),a=new Array(i.length-6);let l=0,c=0;for(let u=0;u<i.length;u++)u>=s&&u<s+6?o[l++]=i[u]:a[c++]=i[u];if(t.vertexAttributes.uv!=null){const u=new Float32Array(t.vertexAttributes.uv),h=4*n*2,p=[0,1,1,1,1,0,0,0];for(let f=0;f<p.length;f++)u[h+f]=p[f];t.vertexAttributes.uv=u}return t.components=[new b2({faces:o,material:r.material}),new b2({faces:a})],t}function tDt(t=0){const e=Math.round(8*2**t),r=2*e,i=(e-1)*(r+1)+2*r,n=new Float64Array(3*i),s=new Float32Array(3*i),o=new Float32Array(2*i),a=new Uint32Array(3*((e-1)*r*2));let l=0,c=0,u=0,h=0;for(let p=0;p<=e;p++){const f=p/e*Math.PI+.5*Math.PI,g=Math.cos(f),_=Math.sin(f);yo[2]=_;const v=p===0||p===e,b=v?r-1:r;for(let w=0;w<=b;w++){const x=w/b*2*Math.PI;yo[0]=-Math.sin(x)*g,yo[1]=Math.cos(x)*g;for(let S=0;S<3;S++)n[l]=.5*yo[S],s[l]=yo[S],++l;o[c++]=(w+(v?.5:0))/r,o[c++]=p/e,p!==0&&w!==r&&(p!==e&&(a[u++]=h,a[u++]=h+1,a[u++]=h-r),p!==1&&(a[u++]=h,a[u++]=h-r,a[u++]=h-r-1)),h++}}return{position:n,normal:s,uv:o,faces:a}}function rDt(t=0){const r=Math.round(16*2**t),i=4*(r+1)+2*r,n=new Float64Array(3*i),s=new Float32Array(3*i),o=new Float32Array(2*i),a=new Uint32Array(3*(4*r));let l=0,c=0,u=0,h=0,p=0;for(let f=0;f<=5;f++){const g=f===0||f===5,_=f<=1||f>=4,v=f===2||f===4,b=g?r-1:r;for(let w=0;w<=b;w++){const x=w/b*2*Math.PI,S=g?0:.5;yo[0]=S*Math.sin(x),yo[1]=S*-Math.cos(x),yo[2]=f<=2?.5:-.5;for(let E=0;E<3;E++)n[l++]=yo[E],s[c++]=_?E===2?f<=1?1:-1:0:E===2?0:yo[E]/S;o[u++]=(w+(g?.5:0))/r,o[u++]=f<=1?1*f/3:f<=3?1*(f-2)/3+1/3:1*(f-4)/3+2/3,v||f===0||w===r||(f!==5&&(a[h++]=p,a[h++]=p+1,a[h++]=p-r),f!==1&&(a[h++]=p,a[h++]=p-r,a[h++]=p-r-1)),p++}}return{position:n,normal:s,uv:o,faces:a}}function iDt(t,e){const r=typeof e=="number"?e:e!=null?e.width:1,i=typeof e=="number"?e:e!=null?e.height:1;switch(t){case"up":case"down":return{width:r,depth:i};case"north":case"south":return{width:r,height:i};case"east":case"west":return{depth:r,height:i}}}function nDt(t){const e=SA.facingAxisOrderSwap[t],r=SA.position,i=SA.normal,n=new Float64Array(r.length),s=new Float32Array(i.length);let o=0;for(let a=0;a<4;a++){const l=o;for(let c=0;c<3;c++){const u=e[c],h=Math.abs(u)-1,p=u>=0?1:-1;n[o]=r[l+h]*p,s[o]=i[l+h]*p,o++}}return{position:n,normal:s,uv:new Float32Array(SA.uv),faces:new Uint32Array(SA.faces),isPlane:!0}}const rS=1,iS=2,nS=3,SA={position:[-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0],normal:[0,0,1,0,0,1,0,0,1,0,0,1],uv:[0,1,1,1,1,0,0,0],faces:[0,1,2,0,2,3],facingAxisOrderSwap:{east:[nS,rS,iS],west:[-nS,-rS,iS],north:[-rS,nS,iS],south:[rS,-nS,iS],up:[rS,iS,nS],down:[rS,-iS,-nS]}};function F4(t,e,r){t.isPlane||sDt(t),aDt(t,oDt(r==null?void 0:r.size,r==null?void 0:r.unit,e.spatialReference));const{vertexAttributes:i,vertexSpace:n,transform:s}=aDe(t,e,{vertexSpace:r==null?void 0:r.vertexSpace,geographic:r==null?void 0:r.geographic});return{vertexAttributes:new ll({...i,uv:t.uv}),vertexSpace:n,transform:s,components:[new b2({faces:t.faces,material:(r==null?void 0:r.material)||null})],spatialReference:e.spatialReference}}function sDt(t){for(let e=0;e<t.position.length;e+=3)t.position[e+2]+=.5}function oDt(t,e,r){const i=dL(e,r);if(t==null&&i===1)return null;if(t==null)return[i,i,i];if(typeof t=="number"){const n=t*i;return[n,n,n]}return[t.width!=null?t.width*i:i,t.depth!=null?t.depth*i:i,t.height!=null?t.height*i:i]}function aDt(t,e){if(e!=null){m_[0]=e[0],m_[4]=e[1],m_[8]=e[2];for(let r=0;r<t.position.length;r+=3){for(let i=0;i<3;i++)yo[i]=t.position[r+i];Zs(yo,yo,m_);for(let i=0;i<3;i++)t.position[r+i]=yo[i]}if(e[0]!==e[1]||e[1]!==e[2]){m_[0]=1/e[0],m_[4]=1/e[1],m_[8]=1/e[2];for(let r=0;r<t.normal.length;r+=3){for(let i=0;i<3;i++)yo[i]=t.normal[r+i];Zs(yo,yo,m_),pe(yo,yo);for(let i=0;i<3;i++)t.normal[r+i]=yo[i]}}}}const lDt={faceDescriptions:[{axis:[0,-1,0],uvOrigin:[0,.625],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[1,0,0],uvOrigin:[.25,.625],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[0,1,0],uvOrigin:[.5,.625],corners:[[1,-1],[-1,-1],[-1,1],[1,1]]},{axis:[-1,0,0],uvOrigin:[.75,.625],corners:[[1,-1],[-1,-1],[-1,1],[1,1]]},{axis:[0,0,1],uvOrigin:[0,.375],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[0,0,-1],uvOrigin:[0,.875],corners:[[-1,1],[1,1],[1,-1],[-1,-1]]}],uvScales:[[0,0],[1,0],[1,1],[0,1]],faceVertexOffsets:[0,1,2,0,2,3]},cDt={south:0,east:1,north:2,west:3,up:4,down:5},yo=C(),m_=li();function eke(t,e,{vertexSpace:r,spatialReference:i}){if(r.type==="georeferenced"){const c=t;if(!_n(e,c,i))return!1;const{origin:u}=r;return ye(t,c,u),!0}const n=nc(i),s=t;if(!_n(e,s,n))return!1;const{origin:o}=r,a=h_e;if(!La(i,o,a,n))return!1;const l=os(h_e,a);return l!=null&&(Ge(t,s,l),!0)}const h_e=xe(),pse="esri.geometry.support.meshUtils.rotate";function uDt(t,e,r){var l;if(!((l=t.vertexAttributes)!=null&&l.position)||e[3]===0)return;const{spatialReference:i,vertexSpace:n}=t,s=(r==null?void 0:r.origin)??t.anchor,o=r==null?void 0:r.geographic,a=Kie(pse,n,i,o);KLe(t)?hDt(t,e,s):a?dDt(t,e,s):pDt(t,e,s)}function hDt(t,e,r){t.transform??(t.transform=new w2);const{vertexSpace:i,transform:n,spatialReference:s}=t,[o,a,l]=i.origin,c=new ke({x:o,y:a,z:l,spatialReference:s}),u=AC;if(c.equals(r))ie(u,0,0,0);else if(!eke(u,r,t))return void re.getLogger(pse).error(`Failed to project specified origin (wkid:${r.spatialReference.wkid}) to mesh (wkid:${s.wkid}) ${i.type} vertex space. Projection may be possible after calling projection.load().`);ZE(m_e,e,D$(e));const h=dee(d_e,m_e,zn,Im,u),{localMatrix:p}=n,f=Hr(d_e,h,p);n.scale=e9(C(),f),P2(f,f,cee(AC,n.scale)),n.rotation=YPe(f),n.translation=NE(C(),f)}function dDt(t,e,r){const i=t.spatialReference,n=nc(i),s=tke;_n(r,s,n)||_n(t.origin,s,n);const o=t.vertexAttributes.position,a=t.vertexAttributes.normal,l=t.vertexAttributes.tangent,c=new Float64Array(o.length),u=a!=null?new Float32Array(a.length):null,h=l!=null?new Float32Array(l.length):null;La(n,s,lz,n),th(f_e,lz);const p=p_e;Zs(p_e,e,f_e),p[3]=e[3],tne(o,i,c),a!=null&&u!=null&&YU(a,o,c,i,u),l!=null&&h!=null&&XU(l,o,c,i,h),fE(c,p,3,s),rne(c,o,i),a!=null&&u!=null&&(fE(u,p,3),ene(u,o,c,i,a)),l!=null&&h!=null&&(fE(h,p,4),ine(h,o,c,i,l)),t.vertexAttributesChanged()}function pDt(t,e,r){const i=tke;if(!_n(r,i,t.spatialReference)){const n=t.origin;i[0]=n.x,i[1]=n.y,i[2]=n.z,re.getLogger(pse).error(`Failed to project specified origin (wkid:${r.spatialReference.wkid}) to mesh spatial reference (wkid:${t.spatialReference.wkid}). Projection may be possible after calling projection.load().`)}fE(t.vertexAttributes.position,e,3,i),fE(t.vertexAttributes.normal,e,3),fE(t.vertexAttributes.tangent,e,4),t.vertexAttributesChanged()}function fE(t,e,r,i=zn){if(t!=null){Kc(lz,D$(e),e);for(let n=0;n<t.length;n+=r){for(let s=0;s<3;s++)AC[s]=t[n+s]-i[s];Ge(AC,AC,lz);for(let s=0;s<3;s++)t[n+s]=AC[s]+i[s]}}}const AC=C(),d_e=xe(),p_e=vf(),lz=xe(),f_e=li(),tke=C(),m_e=lc(),fse="esri.geometry.support.meshUtils.scale";function fDt(t,e,r){var l;if(!((l=t.vertexAttributes)!=null&&l.position))return;const{vertexSpace:i,spatialReference:n}=t,s=(r==null?void 0:r.origin)??t.anchor,o=r==null?void 0:r.geographic,a=Kie(fse,i,n,o);KLe(t)?mDt(t,e,s):a?gDt(t,e,s):yDt(t,e,s)}function mDt(t,e,r){t.transform??(t.transform=new w2);const{vertexSpace:i,transform:n,spatialReference:s}=t,[o,a,l]=i.origin,c=new ke({x:o,y:a,z:l,spatialReference:s}),u=MC;if(c.equals(r))ie(u,0,0,0);else if(!eke(u,r,t))return void re.getLogger(fse).error(`Failed to project specified origin (wkid:${r.spatialReference.wkid}) to mesh (wkid:${s.wkid}) ${i.type} vertex space. Projection may be possible after calling projection.load().`);const h=ie(_Dt,e,e,e),p=dee(g_e,C9,zn,h,u),{localMatrix:f}=n,g=Hr(g_e,p,f);n.scale=e9(C(),g),P2(g,g,cee(MC,n.scale)),n.rotation=YPe(g),n.translation=NE(C(),g)}function gDt(t,e,r){const i=t.spatialReference,n=nc(i),s=ike;_n(r,s,n)||_n(t.origin,s,n);const o=t.vertexAttributes.position,a=t.vertexAttributes.normal,l=t.vertexAttributes.tangent,c=new Float64Array(o.length),u=a!=null?new Float32Array(a.length):null,h=l!=null?new Float32Array(l.length):null;tne(o,i,c),a!=null&&u!=null&&YU(a,o,c,i,u),l!=null&&h!=null&&XU(l,o,c,i,h),rke(c,e,s),rne(c,o,i),a!=null&&u!=null&&ene(u,o,c,i,a),l!=null&&h!=null&&ine(h,o,c,i,l),t.vertexAttributesChanged()}function yDt(t,e,r){const i=ike;if(!_n(r,i,t.spatialReference)){const n=t.origin;i[0]=n.x,i[1]=n.y,i[2]=n.z,re.getLogger(fse).error(`Failed to project specified origin (wkid:${r.spatialReference.wkid}) to mesh spatial reference (wkid:${t.spatialReference.wkid}). Projection may be possible after calling projection.load().`)}rke(t.vertexAttributes.position,e,i),t.vertexAttributesChanged()}function rke(t,e,r=zn){if(t)for(let i=0;i<t.length;i+=3){for(let n=0;n<3;n++)MC[n]=t[i+n]-r[n];ne(MC,MC,e);for(let n=0;n<3;n++)t[i+n]=MC[n]+r[n]}}const MC=C(),_Dt=C(),g_e=xe(),ike=C();var Mh;const nke="esri.geometry.Mesh";function Wf(){return re.getLogger(nke)}const vDt={base:null,key:"type",defaultKeyValue:"georeferenced",typeMap:{georeferenced:R0,local:CR}};let sl=Mh=class extends Q0.LoadableMixin(Gz(py)){constructor(t){super(t),this.components=null,this.vertexSpace=new R0,this.transform=null,this.metadata=new i1,this.hasZ=!0,this.hasM=!1,this.vertexAttributes=new ll,this.type="mesh"}initialize(){(this.metadata.externalSources.length===0||this.vertexAttributes.position.length)&&(this.loadStatus="loaded"),this.when(()=>{this.addHandles(he(()=>{var t;return{vertexAttributes:this.vertexAttributes,components:(t=this.components)==null?void 0:t.map(e=>e.clone())}},()=>this._clearSources(),{once:!0,sync:!0}))})}get hasExtent(){var t;return this.loaded?this.vertexAttributes.position.length>0&&(!this.components||this.components.length>0):((t=this.metadata.displaySource)==null?void 0:t.extent)!=null}get _transformedExtent(){const{components:t,spatialReference:e,vertexAttributes:r,vertexSpace:i}=this,n=r.position;if(n.length===0||t&&t.length===0)return new ei({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0,spatialReference:e});if(gf(i)){const{_untransformedBounds:s,transform:o}=this;return RLt(s,o,i,e)}return zFe(n,e)}get _untransformedBounds(){return kFe(this.vertexAttributes.position)}get anchor(){const t=D8(this.vertexSpace,this.spatialReference);if(t!=null)return t;const{center:e,zmin:r}=this._transformedExtent;return new ke({x:e.x,y:e.y,z:r,spatialReference:this.spatialReference})}get origin(){const t=D8(this.vertexSpace,this.spatialReference);return t??this._transformedExtent.center}get extent(){var t,e;return this.loaded||((e=(t=this.metadata)==null?void 0:t.displaySource)==null?void 0:e.extent)==null?this._transformedExtent:this.metadata.displaySource.extent.clone()}addComponent(t){this._checkIfLoaded("addComponent()")&&(this.components||(this.components=[]),this.components.push(b2.from(t)),this.notifyChange("components"))}removeComponent(t){if(this._checkIfLoaded("removeComponent()")){if(this.components){const e=this.components.indexOf(t);if(e!==-1)return this.components.splice(e,1),void this.notifyChange("components")}Wf().error("removeComponent()",MLt)}}rotate(t,e,r,i){return Vit(t,e,r,y_e),uDt(this,y_e,i),this}offset(t,e,r){if(!this._checkIfLoaded("offset()"))return this;const{vertexSpace:i,vertexAttributes:n}=this,s=n==null?void 0:n.position;if(!s)return this;if(gf(i)){const[o,a,l]=i.origin;i.origin=Ce(o+t,a+e,l+r)}else{for(let o=0;o<s.length;o+=3)s[o]+=t,s[o+1]+=e,s[o+2]+=r;this.vertexAttributesChanged()}return this}scale(t,e){return this._checkIfLoaded("scale()")?(fDt(this,t,e),this):this}centerAt(t,e){return this._checkIfLoaded("centerAt()")?($Lt(this,t,e),this):this}load(t){const{metadata:{displaySource:e}}=this;return e&&this.addResolvingPromise(kLt(this,e,t)),Promise.resolve(this)}addExternalSources(t){this.metadata.externalSources.addMany(t)}updateDisplaySource(t){this.metadata.displaySource=t}clone(){return this.cloneWithVertexSpace(this.vertexSpace.clone())}cloneWithVertexSpace(t){var i;let e=null;if(this.components){const n=new Map,s=new Map;e=this.components.map(o=>o.cloneWithDeduplication(n,s))}const r={components:e,spatialReference:this.spatialReference,vertexAttributes:this.vertexAttributes.clone(),vertexSpace:t,transform:((i=this.transform)==null?void 0:i.clone())??null,metadata:this.metadata.clone()};return new Mh(r)}cloneShallow(){return new Mh({components:this.components,spatialReference:this.spatialReference,vertexAttributes:this.vertexAttributes,vertexSpace:this.vertexSpace.clone(),transform:this.transform,metadata:this.metadata})}vertexAttributesChanged(){this.notifyChange("vertexAttributes")}async toBinaryGLTF(t){const e=ge(()=>import("./gltfexport-CzeiLXub.js"),__vite__mapDeps([])),r=this.load(),i=await Promise.all([e,r]),{toBinaryGLTF:n}=i[0];return n(this,t)}get memoryUsage(){let t=0;if(t+=this.vertexAttributes.memoryUsage,this.components!=null)for(const e of this.components)t+=e.memoryUsage;return t}_clearSources(){this.metadata.clearSources()}_checkIfLoaded(t){return!!this.loaded||(Wf().error(t,ALt),!1)}static createBox(t,e){if(!(t instanceof ke))return Wf().error(".createBox()",PO),null;const r=new Mh(F4(KLt(),t,e));return e!=null&&e.imageFace&&e.imageFace!=="all"?eDt(r,e.imageFace):r}static createSphere(t,e){return t instanceof ke?new Mh(F4(tDt((e==null?void 0:e.densificationFactor)||0),t,e)):(Wf().error(".createSphere()",PO),null)}static createCylinder(t,e){return t instanceof ke?new Mh(F4(rDt((e==null?void 0:e.densificationFactor)||0),t,e)):(Wf().error(".createCylinder()",PO),null)}static createPlane(t,e){if(!(t instanceof ke))return Wf().error(".createPlane()",PO),null;const r=(e==null?void 0:e.facing)??"up",i=iDt(r,e==null?void 0:e.size);return new Mh(F4(nDt(r),t,{...e,size:i}))}static createFromPolygon(t,e){if(!(t instanceof nf))return Wf().error(".createFromPolygon()",OLt),null;const r=Aft(t);return new Mh({vertexAttributes:new ll({position:r.position}),components:[new b2({faces:r.faces,shading:"flat",material:(e==null?void 0:e.material)??null})],spatialReference:t.spatialReference,vertexSpace:new R0})}static async createFromGLTF(t,e,r){if(!(t instanceof ke)){const n=new i_e;throw Wf().error(".createfromGLTF()",n.message),n}const{loadGLTFMesh:i}=await AK(ge(()=>import("./loadGLTFMesh-BRsO50CG.js"),__vite__mapDeps([])),r);return new Mh(await i(t,e,r))}static async createFromFiles(t,e,r){EK(Wf(),"`Mesh.createFromFiles` is deprecated in favor of 'SceneLayer.convertMesh'",{replacement:"SceneLayer.convertMesh",version:"4.29"});const i=n=>Wf().error(".createFromFiles()",n.message);if(!(t instanceof ke)){const n=new i_e;throw i(n),n}if(!(r!=null&&r.layer))throw new K("invalid:no-layer","SceneLayer required for file to mesh conversion.");return r.layer.convertMesh(e,{location:t,...r})}static createWithExternalSource(t,e,r){var f;const i=(r==null?void 0:r.extent)??null,{x:n,y:s,z:o,spatialReference:a}=t,l=((f=r==null?void 0:r.transform)==null?void 0:f.clone())??new w2,c=Ce(n,s,o??0),u=ume((r==null?void 0:r.vertexSpace)??cme(a),c),h={source:e,extent:i},p=new i1;return p.externalSources.push(h),new Mh({metadata:p,transform:l,vertexSpace:u,spatialReference:a})}static createIncomplete(t,e){var u;const{x:r,y:i,z:n,spatialReference:s}=t,o=((u=e==null?void 0:e.transform)==null?void 0:u.clone())??new w2,a=Ce(r,i,n??0),l=ume((e==null?void 0:e.vertexSpace)??cme(s),a),c=new Mh({transform:o,vertexSpace:l,spatialReference:s});return c.addResolvingPromise(Promise.reject(new K("mesh-incomplete","Mesh resources are not complete"))),c}};d([m({type:[b2],json:{write:!0}})],sl.prototype,"components",void 0),d([m({nonNullable:!0,types:vDt,constructOnly:!0,json:{write:!0}})],sl.prototype,"vertexSpace",void 0),d([m({type:w2,json:{write:!0}})],sl.prototype,"transform",void 0),d([m({constructOnly:!0})],sl.prototype,"metadata",void 0),d([m()],sl.prototype,"hasExtent",null),d([m()],sl.prototype,"_transformedExtent",null),d([m()],sl.prototype,"_untransformedBounds",null),d([m()],sl.prototype,"anchor",null),d([m()],sl.prototype,"origin",null),d([m({readOnly:!0,json:{read:!1}})],sl.prototype,"extent",null),d([m({readOnly:!0,json:{read:!1,write:!0,default:!0}})],sl.prototype,"hasZ",void 0),d([m({readOnly:!0,json:{read:!1,write:!0,default:!1}})],sl.prototype,"hasM",void 0),d([m({type:ll,nonNullable:!0,json:{write:!0}})],sl.prototype,"vertexAttributes",void 0),sl=Mh=d([V(nke)],sl);const y_e=vf(),bDt=sl,Z1=20;function wDt(t,{x:e,y:r}){const i=TDt(xDt(t)),n=SDt(i),s=CDt(i,n),o=Z1*.75,a=Z1*.55;return new ke({x:s.x*e*o+n.x*r*a,y:s.y*e*o+n.y*r*a,z:s.z*e*o+n.z*r*a})}const xDt=({centerPoint:t,startPoint:e})=>new ke({x:t.x-e.x,y:t.y-e.y,z:t.z-e.z});function TDt(t){const e=EDt(t);return new ke({x:t.x/e,y:t.y/e,z:t.z/e})}const SDt=t=>new ke({x:0,y:-t.z,z:t.x}),CDt=(t,e)=>new ke({x:t.y*e.z-t.z*e.y,y:t.z*e.x-t.x*e.z,z:t.x*e.y-t.y*e.x}),EDt=t=>Math.sqrt(t.x**2+t.y**2+t.z**2);function ske(t,e,r){const i=t.geometry;t.geometry=i.rotate(0,0,e,{origin:r.centerPoint}).clone()}function PDt(t,e,r,i={x:0,y:0}){const n=wDt(r,i),{centerPoint:s}=r,o=r.startPoint.clone(),a=ADt.bind(void 0,r.blockPosition);o.x=a(s.x,r.startPoint.x)-n.x,o.y=a(s.y,r.startPoint.y)-n.y,o.z=a(s.z,r.startPoint.z)-n.z;const l=MDt(o,e,r.sketchEdges);return ske(l,r.initialAngle,r),t.add(l),l}const ADt=(t,e,r)=>e*(1-t)+r*t;function MDt(t,e,r=!1){const i=bDt.createBox(t,{size:{width:Z1/2,height:Z1/2,depth:Z1/2}});return new fv({geometry:i,symbol:oke(e,r)})}function oke(t,e){const r=new G3({symbolLayers:[new k2({material:{color:Hj(t,.5)},edges:t==="_"?void 0:e?new Mte({size:Z1*.5,color:Hj(t,.9)}):new XEe({size:Z1*.15,color:Hj(t,.9)})})]});return Object.defineProperty(r,"shape",{value:t}),r}const ODt=100,RDt=40;function Hj(t,e=1){const r=vI[t].color[0];return iQ(r,ODt,t==="_"?100:RDt,t==="_"?e*.6:e)}const iQ=(t,e,r,i=1)=>Xe.fromRgb(["hsla(",t,", ",e,"%, ",r,"%, ",i,")"].join(""));function $Dt(t,e,r){t.symbol.shape!==e&&(t.symbol=oke(e,r.sketchEdges))}function IDt(t,e,r,i){const n=Si.useMemo(()=>t===void 0?void 0:LDt(t,r),[t,r]),s=r.type==="animated";Si.useEffect(()=>{if(!(n===void 0||!s||i))return n.start(),n.stop},[n,s,i]),Si.useEffect(()=>{n!==void 0&&e.forEach((o,a)=>o.forEach((l,c)=>n.spawnBox(l,c,a)))},[n,e])}function LDt(t,e){const r=new PLt;function i(c,u=c){B8e(Object.values(n).map(h=>Object.values(h??{})).flat()).forEach(h=>ske(h,u,e)),e.rotateCamera(t,c)}const n={};function s(c,u=0,h=0){var f;n[h]??(n[h]={}),(f=n[h])[u]??(f[u]=PDt(r,c,e,{x:-(_I/2)+u,y:yK/2-h}));const p=n[h][u];return $Dt(p,c,e),p}t.map.add(r);let o;return{start:()=>o=setInterval(()=>i(-.04),FDt),stop:()=>clearInterval(o),spawnBox:s}}const DDt=1e3,NDt=60,FDt=DDt/NDt,CA=270;function kDt(t){const e=t==="animated",r=new ke({spatialReference:{wkid:102100},x:-8238833+(e?0:-500),y:4969413+(e?0:-500),z:e?250:120}),i=e?2500:800,n=e?CA:CA-30,s=o(n,CA,90);function o(c,u,h){const{x:p,y:f}=zDt(CA-u+c,i),g=r.clone();return g.x+=p,g.y+=f,new eu({position:g,heading:u-c,tilt:h})}const a=(c,u)=>void c.goTo(o(u,c.camera.heading,c.camera.tilt),{animate:!1}),l=o(0,CA,90).position;return{type:t,centerPoint:r,initialCamera:s,rotateCamera:a,sketchEdges:!e,initialAngle:n,startPoint:l,blockPosition:e?.7:.2}}function zDt(t,e){const r=t*Math.PI/180;return{x:e*Math.cos(r),y:e*Math.sin(r)}}var nQ;let AO=nQ=class extends ze{constructor(t){super(t),this.minValue=0,this.maxValue=0}clone(){return new nQ({minValue:this.minValue,maxValue:this.maxValue})}};d([m({type:Number,json:{write:!0}})],AO.prototype,"minValue",void 0),d([m({type:Number,json:{write:!0}})],AO.prototype,"maxValue",void 0),AO=nQ=d([V("esri.renderer.support.AuthoringInfoClassBreakInfo")],AO);var sQ;let n1=sQ=class extends ze{constructor(t){super(t),this.field="",this.normalizationField="",this.label="",this.classBreakInfos=[]}clone(){return new sQ({field:this.field,normalizationField:this.normalizationField,label:this.label,classBreakInfos:_e(this.classBreakInfos)})}};d([m({type:String,json:{write:!0}})],n1.prototype,"field",void 0),d([m({type:String,json:{write:!0}})],n1.prototype,"normalizationField",void 0),d([m({type:String,json:{write:!0}})],n1.prototype,"label",void 0),d([m({type:[AO],json:{write:!0}})],n1.prototype,"classBreakInfos",void 0),n1=sQ=d([V("esri.renderers.support.AuthoringInfoFieldInfo")],n1);var oQ;const k4=new yn({percentTotal:"percent-of-total",ratio:"ratio",percent:"percent"}),z4=new yn({sizeInfo:"size",colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation"}),__e={key:t=>typeof t=="number"?"number":"string",typeMap:{number:Number,string:String},base:null},v_e=["high-to-low","above-and-below","centered-on","extremes"],b_e=[...new Set(["high-to-low","above-and-below","centered-on","extremes","90-10","above","below","high-to-low","above-and-below","90-10","above","below"])],w_e=["seconds","minutes","hours","days","months","years"];let bc=oQ=class extends ze{constructor(t){super(t),this.endTime=null,this.field=null,this.maxSliderValue=null,this.minSliderValue=null,this.startTime=null,this.type=null,this.units=null}castEndTime(t){return typeof t=="string"||typeof t=="number"?t:null}castStartTime(t){return typeof t=="string"||typeof t=="number"?t:null}get style(){return this.type==="color"?this._get("style"):null}set style(t){this._set("style",t)}get theme(){return this.type==="color"||this.type==="size"?this._get("theme")||"high-to-low":null}set theme(t){this._set("theme",t)}clone(){return new oQ({endTime:this.endTime,field:this.field,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,startTime:this.startTime,style:this.style,theme:this.theme,type:this.type,units:this.units})}};d([m({types:__e,json:{write:!0}})],bc.prototype,"endTime",void 0),d([ai("endTime")],bc.prototype,"castEndTime",null),d([m({type:String,json:{write:!0}})],bc.prototype,"field",void 0),d([m({type:Number,json:{write:!0}})],bc.prototype,"maxSliderValue",void 0),d([m({type:Number,json:{write:!0}})],bc.prototype,"minSliderValue",void 0),d([m({types:__e,json:{write:!0}})],bc.prototype,"startTime",void 0),d([ai("startTime")],bc.prototype,"castStartTime",null),d([m({type:k4.apiValues,value:null,json:{type:k4.jsonValues,read:k4.read,write:k4.write}})],bc.prototype,"style",null),d([m({type:b_e,value:null,json:{type:b_e,origins:{"web-scene":{type:v_e,write:{writer:(t,e)=>{v_e.includes(t)&&(e.theme=t)}}}},write:!0}})],bc.prototype,"theme",null),d([m({type:z4.apiValues,json:{type:z4.jsonValues,read:z4.read,write:z4.write}})],bc.prototype,"type",void 0),d([m({type:w_e,json:{type:w_e,write:!0}})],bc.prototype,"units",void 0),bc=oQ=d([V("esri.renderers.support.AuthoringInfoVisualVariable")],bc);const UDt=bc;let JF=class extends ze{constructor(e){super(e),this.type=null}};d([m({readOnly:!0,json:{read:!1,write:!0}})],JF.prototype,"type",void 0),JF=d([V("esri.rest.support.ColorRamp")],JF);const mse=JF;var aQ;let Iw=aQ=class extends mse{constructor(t){super(t),this.algorithm=null,this.fromColor=null,this.toColor=null,this.type="algorithmic"}clone(){return new aQ({fromColor:_e(this.fromColor),toColor:_e(this.toColor),algorithm:this.algorithm})}};d([It({esriCIELabAlgorithm:"cie-lab",esriHSVAlgorithm:"hsv",esriLabLChAlgorithm:"lab-lch"})],Iw.prototype,"algorithm",void 0),d([m({type:Xe,json:{type:[fn],write:!0}})],Iw.prototype,"fromColor",void 0),d([m({type:Xe,json:{type:[fn],write:!0}})],Iw.prototype,"toColor",void 0),d([m({type:["algorithmic"]})],Iw.prototype,"type",void 0),Iw=aQ=d([V("esri.rest.support.AlgorithmicColorRamp")],Iw);const gse=Iw;var lQ;let MO=lQ=class extends mse{constructor(t){super(t),this.colorRamps=null,this.type="multipart"}clone(){return new lQ({colorRamps:_e(this.colorRamps)})}};d([m({type:[gse],json:{write:!0}})],MO.prototype,"colorRamps",void 0),d([m({type:["multipart"]})],MO.prototype,"type",void 0),MO=lQ=d([V("esri.rest.support.MultipartColorRamp")],MO);const ake=MO,BDt={key:"type",base:mse,typeMap:{algorithmic:gse,multipart:ake}};function VDt(t){return t!=null&&t.type?t.type==="algorithmic"?gse.fromJSON(t):t.type==="multipart"?ake.fromJSON(t):null:null}var cQ;const Fb=new yn({esriClassifyDefinedInterval:"defined-interval",esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation"}),U4=new yn({pieChart:"pie-chart",classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density",flow:"flow"}),x_e=new yn({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density"}),T_e=["inches","feet","yards","miles","nautical-miles","millimeters","centimeters","decimeters","meters","kilometers","decimal-degrees"],GDt=["high-to-low","above-and-below","above","below","90-10"],jDt=["flow-line","wave-front"],HDt=["caret","circle-caret","arrow","circle-arrow","plus-minus","circle-plus-minus","square","circle","triangle","happy-sad","thumb","custom"];let cs=cQ=class extends ze{constructor(t){super(t),this.colorRamp=null,this.fadeRatio=null,this.isAutoGenerated=!1,this.lengthUnit=null,this.maxSliderValue=null,this.minSliderValue=null,this.visualVariables=null}get classificationMethod(){const t=this._get("classificationMethod"),e=this.type;return e&&e!=="relationship"?e==="class-breaks-size"||e==="class-breaks-color"?t||"manual":null:t}set classificationMethod(t){this._set("classificationMethod",t)}readColorRamp(t){return t?VDt(t):void 0}get fields(){return this.type&&this.type!=="predominance"?null:this._get("fields")}set fields(t){this._set("fields",t)}get field1(){return this.type&&this.type!=="relationship"?null:this._get("field1")}set field1(t){this._set("field1",t)}get field2(){return this.type&&this.type!=="relationship"?null:this._get("field2")}set field2(t){this._set("field2",t)}get flowTheme(){return this.type==="flow"?this._get("flowTheme"):null}set flowTheme(t){this._set("flowTheme",t)}get focus(){return this.type&&this.type!=="relationship"?null:this._get("focus")}set focus(t){this._set("focus",t)}get numClasses(){return this.type&&this.type!=="relationship"?null:this._get("numClasses")}set numClasses(t){this._set("numClasses",t)}get statistics(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("statistics"):null}set statistics(t){this._set("statistics",t)}get standardDeviationInterval(){const t=this.type;return t&&t!=="relationship"&&t!=="class-breaks-size"&&t!=="class-breaks-color"||this.classificationMethod&&this.classificationMethod!=="standard-deviation"?null:this._get("standardDeviationInterval")}set standardDeviationInterval(t){this._set("standardDeviationInterval",t)}get type(){return this._get("type")}set type(t){let e=t;t==="classed-size"?e="class-breaks-size":t==="classed-color"&&(e="class-breaks-color"),this._set("type",e)}get univariateSymbolStyle(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("univariateSymbolStyle"):null}set univariateSymbolStyle(t){this._set("univariateSymbolStyle",t)}get univariateTheme(){return this.type==="univariate-color-size"?this._get("univariateTheme"):null}set univariateTheme(t){this._set("univariateTheme",t)}clone(){var t;return new cQ({classificationMethod:this.classificationMethod,colorRamp:_e(this.colorRamp),fadeRatio:_e(this.fadeRatio),fields:(t=this.fields)==null?void 0:t.slice(0),field1:_e(this.field1),field2:_e(this.field2),isAutoGenerated:this.isAutoGenerated,focus:this.focus,numClasses:this.numClasses,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,lengthUnit:this.lengthUnit,statistics:this.statistics,standardDeviationInterval:this.standardDeviationInterval,type:this.type,visualVariables:this.visualVariables&&this.visualVariables.map(e=>e.clone()),univariateSymbolStyle:this.univariateSymbolStyle,univariateTheme:this.univariateTheme,flowTheme:this.flowTheme})}};d([m({type:Fb.apiValues,value:null,json:{type:Fb.jsonValues,read:Fb.read,write:Fb.write,origins:{"web-document":{default:"manual",type:Fb.jsonValues,read:Fb.read,write:Fb.write}}}})],cs.prototype,"classificationMethod",null),d([m({types:BDt,json:{write:!0}})],cs.prototype,"colorRamp",void 0),d([Tr("colorRamp")],cs.prototype,"readColorRamp",null),d([m({json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],cs.prototype,"fadeRatio",void 0),d([m({type:[String],value:null,json:{write:!0}})],cs.prototype,"fields",null),d([m({type:n1,value:null,json:{write:!0}})],cs.prototype,"field1",null),d([m({type:n1,value:null,json:{write:!0}})],cs.prototype,"field2",null),d([m({type:jDt,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],cs.prototype,"flowTheme",null),d([m({type:["HH","HL","LH","LL"],value:null,json:{write:!0}})],cs.prototype,"focus",null),d([m({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1}}}})],cs.prototype,"isAutoGenerated",void 0),d([m({type:Number,value:null,json:{type:fn,write:!0}})],cs.prototype,"numClasses",null),d([m({type:T_e,json:{type:T_e,read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],cs.prototype,"lengthUnit",void 0),d([m({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],cs.prototype,"maxSliderValue",void 0),d([m({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],cs.prototype,"minSliderValue",void 0),d([m({type:Object,value:null,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],cs.prototype,"statistics",null),d([m({type:[.25,.33,.5,1],value:null,json:{type:[.25,.33,.5,1],write:!0}})],cs.prototype,"standardDeviationInterval",null),d([m({type:U4.apiValues,value:null,json:{type:U4.jsonValues,read:U4.read,write:U4.write,origins:{"web-scene":{type:x_e.jsonValues,write:{writer:x_e.write,overridePolicy:t=>({enabled:t!=="flow"})}}}}})],cs.prototype,"type",null),d([m({type:[UDt],json:{write:!0}})],cs.prototype,"visualVariables",void 0),d([m({type:HDt,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],cs.prototype,"univariateSymbolStyle",null),d([m({type:GDt,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],cs.prototype,"univariateTheme",null),cs=cQ=d([V("esri.renderers.support.AuthoringInfo")],cs);const WDt=cs,Wj=new yn({simple:"simple",uniqueValue:"unique-value",classBreaks:"class-breaks",heatmap:"heatmap",dotDensity:"dot-density",dictionary:"dictionary",pieChart:"pie-chart"},{ignoreUnknown:!0});let OO=class extends ze{constructor(e){super(e),this.authoringInfo=null,this.type=null}async getRequiredFields(e){if(!this.collectRequiredFields)return[];const r=new Set;return await this.collectRequiredFields(r,e),Array.from(r).sort()}getSymbol(e,r){}async getSymbolAsync(e,r){}getSymbols(){return[]}getAttributeHash(){return JSON.stringify(this)}getMeshHash(){return JSON.stringify(this)}};d([m({type:WDt,json:{write:!0}})],OO.prototype,"authoringInfo",void 0),d([m({type:Wj.apiValues,readOnly:!0,json:{type:Wj.jsonValues,read:!1,write:{writer:Wj.write,ignoreOrigin:!0}}})],OO.prototype,"type",void 0),OO=d([V("esri.renderers.Renderer")],OO);const qDt=OO;function YDt(t){var e,r;return((r=(e=t.match(XDt))==null?void 0:e[1])==null?void 0:r.replace(/\\'/g,"'"))??null}const XDt=/^hash\(\$feature\['((\\'|[^'])+)'\]\) \* 8\.381e-8$/;var uQ;let QF=uQ=class extends ze{constructor(){super(...arguments),this.title=null}clone(){return new uQ({title:this.title})}};d([m({type:String,json:{write:!0}})],QF.prototype,"title",void 0),QF=uQ=d([V("esri.renderers.support.LegendOptions")],QF);var hQ;let KF=hQ=class extends QF{constructor(){super(...arguments),this.showLegend=null}clone(){return new hQ({title:this.title,showLegend:this.showLegend})}};d([m({type:Boolean,json:{write:!0}})],KF.prototype,"showLegend",void 0),KF=hQ=d([V("esri.renderers.visualVariables.support.VisualVariableLegendOptions")],KF);const lke=KF,qj=new yn({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"});let up=class extends ze{constructor(e){super(e),this.index=null,this.type=null,this.field=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null}castField(e){return e==null?e:typeof e=="function"?(re.getLogger(this).error(".field: field must be a string value"),null):Ybe(e)}get arcadeRequired(){return!!this.valueExpression}clone(){}getAttributeHash(){return`${this.type}-${this.field}-${this.valueExpression}`}};d([m()],up.prototype,"index",void 0),d([m({type:qj.apiValues,readOnly:!0,json:{read:qj.read,write:qj.write}})],up.prototype,"type",void 0),d([m({type:String,json:{write:!0}})],up.prototype,"field",void 0),d([ai("field")],up.prototype,"castField",null),d([m({type:String,json:{write:!0}})],up.prototype,"valueExpression",void 0),d([m({type:String,json:{write:!0}})],up.prototype,"valueExpressionTitle",void 0),d([m({readOnly:!0})],up.prototype,"arcadeRequired",null),d([m({type:lke,json:{write:!0}})],up.prototype,"legendOptions",void 0),up=d([V("esri.renderers.visualVariables.VisualVariable")],up);const wL=up;var dQ;let Lw=dQ=class extends ze{constructor(t){super(t),this.color=null,this.label=null,this.value=null}writeValue(t,e,r){e[r]=t??0}clone(){return new dQ({color:this.color&&this.color.clone(),label:this.label,value:this.value})}};d([m({type:Xe,json:{type:[fn],write:!0}})],Lw.prototype,"color",void 0),d([m({type:String,json:{write:!0}})],Lw.prototype,"label",void 0),d([m({type:Number,json:{write:{writerEnsuresNonNull:!0}}})],Lw.prototype,"value",void 0),d([hr("value")],Lw.prototype,"writeValue",null),Lw=dQ=d([V("esri.renderers.visualVariables.support.ColorStop")],Lw);const ZDt=Lw;var pQ;let Dw=pQ=class extends wL{constructor(t){super(t),this.type="color",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(t){t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,r)=>e.value-r.value),this._set("stops",t)}clone(){var t;return new pQ({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(e=>e.clone()),legendOptions:(t=this.legendOptions)==null?void 0:t.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(t=>t.value||0)}};d([m({readOnly:!0})],Dw.prototype,"cache",null),d([m({type:["color"],json:{type:["colorInfo"]}})],Dw.prototype,"type",void 0),d([m({type:String,json:{write:!0}})],Dw.prototype,"normalizationField",void 0),d([m({type:[ZDt],json:{write:!0}})],Dw.prototype,"stops",null),Dw=pQ=d([V("esri.renderers.visualVariables.ColorVariable")],Dw);const cke=Dw;var fQ;let G_=fQ=class extends ze{constructor(t){super(t),this.label=null,this.opacity=null,this.value=null}readOpacity(t,e){return hee(e.transparency)}writeOpacity(t,e,r){e[r]=uee(t)}clone(){return new fQ({label:this.label,opacity:this.opacity,value:this.value})}};d([m({type:String,json:{write:!0}})],G_.prototype,"label",void 0),d([m({type:Number,json:{type:fn,write:{target:"transparency"}}})],G_.prototype,"opacity",void 0),d([Tr("opacity",["transparency"])],G_.prototype,"readOpacity",null),d([hr("opacity")],G_.prototype,"writeOpacity",null),d([m({type:Number,json:{write:!0}})],G_.prototype,"value",void 0),G_=fQ=d([V("esri.renderers.visualVariables.support.OpacityStop")],G_);const JDt=G_;var mQ;let Nw=mQ=class extends wL{constructor(t){super(t),this.type="opacity",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(t){t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,r)=>e.value-r.value),this._set("stops",t)}clone(){var t;return new mQ({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(e=>e.clone()),legendOptions:(t=this.legendOptions)==null?void 0:t.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(t=>t.value||0)}};d([m({readOnly:!0})],Nw.prototype,"cache",null),d([m({type:["opacity"],json:{type:["transparencyInfo"]}})],Nw.prototype,"type",void 0),d([m({type:String,json:{write:!0}})],Nw.prototype,"normalizationField",void 0),d([m({type:[JDt],json:{write:!0}})],Nw.prototype,"stops",null),Nw=mQ=d([V("esri.renderers.visualVariables.OpacityVariable")],Nw);const uke=Nw;var gQ;let u0=gQ=class extends wL{constructor(t){super(t),this.axis=null,this.type="rotation",this.rotationType="geographic",this.valueExpressionTitle=null}get cache(){return{hasExpression:!!this.valueExpression,compiledFunc:null}}writeValueExpressionTitleWebScene(t,e,r,i){if(i!=null&&i.messages){const n=`visualVariables[${this.index}]`;i.messages.push(new K("property:unsupported",this.type+"VisualVariable.valueExpressionTitle is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:n+".valueExpressionTitle",context:i}))}}clone(){var t;return new gQ({axis:this.axis,rotationType:this.rotationType,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,legendOptions:(t=this.legendOptions)==null?void 0:t.clone()})}};d([m({readOnly:!0})],u0.prototype,"cache",null),d([m({type:["heading","tilt","roll"],json:{origins:{"web-scene":{default:"heading",write:!0}}}})],u0.prototype,"axis",void 0),d([m({type:["rotation"],json:{type:["rotationInfo"]}})],u0.prototype,"type",void 0),d([m({type:["geographic","arithmetic"],json:{write:!0,origins:{"web-document":{write:!0,default:"geographic"}}}})],u0.prototype,"rotationType",void 0),d([m({type:String,json:{write:!0}})],u0.prototype,"valueExpressionTitle",void 0),d([hr("web-scene","valueExpressionTitle")],u0.prototype,"writeValueExpressionTitleWebScene",null),u0=gQ=d([V("esri.renderers.visualVariables.RotationVariable")],u0);const hke=u0;var yQ;let j_=yQ=class extends ze{constructor(t){super(t),this.label=null,this.size=null,this.value=null,this.useMinValue=null,this.useMaxValue=null}clone(){return new yQ({label:this.label,size:this.size,value:this.value,useMaxValue:this.useMaxValue,useMinValue:this.useMinValue})}};d([m({type:String,json:{write:!0}})],j_.prototype,"label",void 0),d([m({type:Number,cast:kn,json:{write:!0}})],j_.prototype,"size",void 0),d([m({type:Number,json:{write:!0}})],j_.prototype,"value",void 0),d([m({type:Boolean,json:{write:!1}})],j_.prototype,"useMinValue",void 0),d([m({type:Boolean,json:{write:!1}})],j_.prototype,"useMaxValue",void 0),j_=yQ=d([V("esri.renderers.visualVariables.support.SizeStop")],j_);const QDt=j_;var _Q;let ek=_Q=class extends lke{constructor(){super(...arguments),this.customValues=null}clone(){var t;return new _Q({title:this.title,showLegend:this.showLegend,customValues:(t=this.customValues)==null?void 0:t.slice(0)})}};d([m({type:[Number],json:{write:!0}})],ek.prototype,"customValues",void 0),ek=_Q=d([V("esri.renderers.visualVariables.support.SizeVariableLegendOptions")],ek);const KDt=ek;var vQ;const B4=new yn({width:"width",depth:"depth",height:"height",widthAndDepth:"width-and-depth",all:"all"}),bQ=new yn({unknown:"unknown",inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers","decimal-degree":"decimal-degrees"});function S_e(t){if(t!=null)return typeof t=="string"||typeof t=="number"?kn(t):t.type==="size"?mC(t)?t:(delete(t={...t}).type,new xi(t)):void 0}function C_e(t,e,r){if(typeof t!="object")return t;const i=new xi;return i.read(t,r),i}let xi=vQ=class extends wL{constructor(t){super(t),this.axis=null,this.legendOptions=null,this.normalizationField=null,this.scaleBy=null,this.target=null,this.type="size",this.useSymbolValue=null,this.valueExpression=null,this.valueRepresentation=null,this.valueUnit=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null,isScaleDriven:this.valueExpression!=null&&N$e.test(this.valueExpression)}}set expression(t){re.getLogger(this).warn("'expression' is deprecated since version 4.2. Use 'valueExpression' instead. The only supported expression is 'view.scale'."),t==="view.scale"?(this.valueExpression="$view.scale",this._set("expression",t)):this._set("expression",null)}set index(t){mC(this.maxSize)&&(this.maxSize.index=`visualVariables[${t}].maxSize`),mC(this.minSize)&&(this.minSize.index=`visualVariables[${t}].minSize`),this._set("index",t)}get inputValueType(){return D$e(this)}set maxDataValue(t){t&&this.stops&&(re.getLogger(this).warn("cannot set maxDataValue when stops is not null."),t=null),this._set("maxDataValue",t)}set maxSize(t){t&&this.stops&&(re.getLogger(this).warn("cannot set maxSize when stops is not null."),t=null),this._set("maxSize",t)}castMaxSize(t){return S_e(t)}readMaxSize(t,e,r){return C_e(t,e,r)}set minDataValue(t){t&&this.stops&&(re.getLogger(this).warn("cannot set minDataValue when stops is not null."),t=null),this._set("minDataValue",t)}set minSize(t){t&&this.stops&&(re.getLogger(this).warn("cannot set minSize when stops is not null."),t=null),this._set("minSize",t)}castMinSize(t){return S_e(t)}readMinSize(t,e,r){return C_e(t,e,r)}get arcadeRequired(){return!!this.valueExpression||this.minSize!=null&&typeof this.minSize=="object"&&this.minSize.arcadeRequired||this.maxSize!=null&&typeof this.maxSize=="object"&&this.maxSize.arcadeRequired}set stops(t){this.minDataValue==null&&this.maxDataValue==null&&this.minSize==null&&this.maxSize==null?t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,r)=>e.value-r.value):t&&(re.getLogger(this).warn("cannot set stops when one of minDataValue, maxDataValue, minSize or maxSize is not null."),t=null),this._set("stops",t)}get transformationType(){return lft(this,this.inputValueType)}readValueExpression(t,e){return t||e.expression&&"$view.scale"}writeValueExpressionWebScene(t,e,r,i){if(t==="$view.scale"){if(i!=null&&i.messages){const n=this.index,s=typeof n=="string"?n:`visualVariables[${n}]`;i.messages.push(new K("property:unsupported",this.type+"VisualVariable.valueExpression = '$view.scale' is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:s+".valueExpression",context:i}))}}else e[r]=t}readValueUnit(t){return t?bQ.read(t):null}clone(){var t,e;return new vQ({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:mC(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:mC(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:(t=this.stops)==null?void 0:t.map(r=>r.clone()),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:(e=this.legendOptions)==null?void 0:e.clone()})}flipSizes(){if(this.transformationType===Do.ClampedLinear){const{minSize:t,maxSize:e}=this;return this.minSize=e,this.maxSize=t,this}if(this.transformationType===Do.Stops){const t=this.stops;if(!t)return this;const e=t.map(i=>i.size).reverse(),r=t.length;for(let i=0;i<r;i++)t[i].size=e[i];return this}return this}getAttributeHash(){return`${super.getAttributeHash()}-${this.target}-${this.normalizationField}`}_interpolateData(){var t;return(t=this.stops)==null?void 0:t.map(e=>e.value||0)}};d([m({readOnly:!0})],xi.prototype,"cache",null),d([m({type:B4.apiValues,json:{type:B4.jsonValues,origins:{"web-map":{read:!1}},read:B4.read,write:B4.write}})],xi.prototype,"axis",void 0),d([m({type:String,value:null,json:{read:!1}})],xi.prototype,"expression",null),d([m()],xi.prototype,"index",null),d([m({type:String,readOnly:!0})],xi.prototype,"inputValueType",null),d([m({type:KDt,json:{write:!0}})],xi.prototype,"legendOptions",void 0),d([m({type:Number,value:null,json:{write:!0}})],xi.prototype,"maxDataValue",null),d([m({type:Number,value:null,json:{write:!0}})],xi.prototype,"maxSize",null),d([ai("maxSize")],xi.prototype,"castMaxSize",null),d([Tr("maxSize")],xi.prototype,"readMaxSize",null),d([m({type:Number,value:null,json:{write:!0}})],xi.prototype,"minDataValue",null),d([m({type:Number,value:null,json:{write:!0}})],xi.prototype,"minSize",null),d([ai("minSize")],xi.prototype,"castMinSize",null),d([Tr("minSize")],xi.prototype,"readMinSize",null),d([m({type:String,json:{write:!0}})],xi.prototype,"normalizationField",void 0),d([m({readOnly:!0})],xi.prototype,"arcadeRequired",null),d([m({type:String})],xi.prototype,"scaleBy",void 0),d([m({type:[QDt],value:null,json:{write:!0}})],xi.prototype,"stops",null),d([m({type:["outline"],json:{write:!0}})],xi.prototype,"target",void 0),d([m({type:String,readOnly:!0})],xi.prototype,"transformationType",null),d([m({type:["size"],json:{type:["sizeInfo"]}})],xi.prototype,"type",void 0),d([m({type:Boolean,json:{write:!0,origins:{"web-map":{read:!1}}}})],xi.prototype,"useSymbolValue",void 0),d([m({type:String,json:{write:!0}})],xi.prototype,"valueExpression",void 0),d([Tr("valueExpression",["valueExpression","expression"])],xi.prototype,"readValueExpression",null),d([hr("web-scene","valueExpression")],xi.prototype,"writeValueExpressionWebScene",null),d([m({type:["radius","diameter","area","width","distance"],json:{write:!0}})],xi.prototype,"valueRepresentation",void 0),d([m({type:bQ.apiValues,json:{write:bQ.write,origins:{"web-map":{read:!1},"web-scene":{write:!0},"portal-item":{write:!0}}}})],xi.prototype,"valueUnit",void 0),d([Tr("valueUnit")],xi.prototype,"readValueUnit",null),xi=vQ=d([V("esri.renderers.visualVariables.SizeVariable")],xi);const dke=xi,eNt={color:cke,size:dke,opacity:uke,rotation:hke},tNt=new yn({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"}),rNt=/^\[([^\]]+)\]$/i;let tk=class extends Ae{constructor(){super(...arguments),this.colorVariables=null,this.opacityVariables=null,this.rotationVariables=null,this.sizeVariables=null}set visualVariables(e){if(this._resetVariables(),e=e&&e.filter(r=>!!r),e==null?void 0:e.length){for(const r of e)switch(r.type){case"color":this.colorVariables.push(r);break;case"opacity":this.opacityVariables.push(r);break;case"rotation":this.rotationVariables.push(r);break;case"size":this.sizeVariables.push(r)}this.sizeVariables.length&&this.sizeVariables.some(r=>!!r.target)&&e.sort((r,i)=>{let n=null;return n=r.target===i.target?0:r.target?1:-1,n});for(let r=0;r<e.length;r++)e[r].index=r;this._set("visualVariables",e)}else this._set("visualVariables",e)}readVariables(e,r,i){const{rotationExpression:n,rotationType:s}=r,o=n==null?void 0:n.match(rNt),a=o==null?void 0:o[1];if(a&&(e||(e=[]),e.push({type:"rotationInfo",rotationType:s,field:a})),e)return e.map(l=>{const c=tNt.read(l.type),u=eNt[c];u||(re.getLogger(this).warn(`Unknown variable type: ${c}`),i!=null&&i.messages&&i.messages.push(new tv("visual-variable:unsupported",`visualVariable of type '${c}' is not supported`,{definition:l,context:i})));const h=new u;return h.read(l,i),h})}writeVariables(e,r){const i=[];for(const n of e){const s=n.toJSON(r);s&&i.push(s)}return i}_resetVariables(){this.colorVariables=[],this.opacityVariables=[],this.rotationVariables=[],this.sizeVariables=[]}};d([m()],tk.prototype,"visualVariables",null),tk=d([V("esri.renderers.visualVariables.VisualVariableFactory")],tk);const iNt=tk,nNt={base:wL,key:"type",typeMap:{opacity:uke,color:cke,rotation:hke,size:dke}},sNt=t=>{let e=class extends t{constructor(){super(...arguments),this._vvFactory=new iNt}set visualVariables(r){this._vvFactory.visualVariables=r,this._set("visualVariables",this._vvFactory.visualVariables)}readVisualVariables(r,i,n){return this._vvFactory.readVariables(r,i,n)}writeVisualVariables(r,i,n,s){i[n]=this._vvFactory.writeVariables(r,s)}get arcadeRequiredForVisualVariables(){if(!this.visualVariables)return!1;for(const r of this.visualVariables)if(r.arcadeRequired)return!0;return!1}hasVisualVariables(r,i){return r?this.getVisualVariablesForType(r,i).length>0:this.getVisualVariablesForType("size",i).length>0||this.getVisualVariablesForType("color",i).length>0||this.getVisualVariablesForType("opacity",i).length>0||this.getVisualVariablesForType("rotation",i).length>0}getVisualVariablesForType(r,i){const n=this.visualVariables;return n?n.filter(s=>s.type===r&&(typeof i=="string"?s.target===i:i!==!1||!s.target)):[]}async collectVVRequiredFields(r,i){let n=[];this.visualVariables&&(n=n.concat(this.visualVariables));for(const s of n)s&&(s.field&&c2(r,i,s.field),s.normalizationField&&c2(r,i,s.normalizationField),s.valueExpression&&(oNt(s.valueExpression,r,i)||await sy(r,i,s.valueExpression)))}};return d([m({types:[nNt],value:null,json:{write:!0}})],e.prototype,"visualVariables",null),d([Tr("visualVariables",["visualVariables","rotationType","rotationExpression"])],e.prototype,"readVisualVariables",null),d([hr("visualVariables")],e.prototype,"writeVisualVariables",null),e=d([V("esri.renderers.mixins.VisualVariablesMixin")],e),e};function oNt(t,e,r){const i=YDt(t);return i!=null&&(c2(e,r,i),!0)}const aNt={types:ntt,json:{write:{writer:F8},origins:{"web-scene":{types:Bce,write:{writer:F8},read:{reader:kz({types:Bce})}}}}},lNt=gbe({json:{origins:{"web-scene":{write:{isRequired:!0}}}}},aNt),CKt={types:{base:su,key:"type",typeMap:{"simple-fill":ZC.typeMap["simple-fill"],"picture-fill":ZC.typeMap["picture-fill"],"polygon-3d":ZC.typeMap["polygon-3d"]}},json:{write:{writer:F8},origins:{"web-scene":{type:BI,write:{writer:F8}}}}},EKt={cast:t=>t==null||typeof t=="string"||typeof t=="number"?t:`${t}`,json:{type:String,write:{writer:(t,e)=>{e.value=t==null?void 0:t.toString()}}}};var wQ;let Fw=wQ=class extends sNt(qDt){constructor(t){super(t),this.description=null,this.label=null,this.symbol=null,this.type="simple"}async collectRequiredFields(t,e){await Promise.all([this.collectSymbolFields(t,e),this.collectVVRequiredFields(t,e)])}async collectSymbolFields(t,e){await Promise.all(this.getSymbols().map(r=>r.collectRequiredFields(t,e)))}getSymbol(t,e){return this.symbol}async getSymbolAsync(t,e){return this.symbol}getSymbols(){return this.symbol?[this.symbol]:[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((t,e)=>t+JSON.stringify(e),"")}get arcadeRequired(){return this.arcadeRequiredForVisualVariables}clone(){return new wQ({description:this.description,label:this.label,symbol:this.symbol&&this.symbol.clone(),visualVariables:_e(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}};d([m({type:String,json:{write:!0}})],Fw.prototype,"description",void 0),d([m({type:String,json:{write:!0}})],Fw.prototype,"label",void 0),d([m(lNt)],Fw.prototype,"symbol",void 0),d([It({simple:"simple"})],Fw.prototype,"type",void 0),Fw=wQ=d([V("esri.renderers.SimpleRenderer")],Fw);const cNt=Fw;function uNt(t,e){Si.useEffect(()=>{t!==void 0&&hNt(t)},[t,e])}function hNt(t){dNt(t),mNt(t),gNt(t)}function dNt(t){const e=t.map.allLayers.find(({title:r})=>r==="Buildings");e!==void 0&&(e.renderer=pNt())}const pNt=(t=Math.floor(Math.random()*365))=>new cNt({symbol:new G3({symbolLayers:[new k2({material:{color:iQ(t,100,90),colorMixMode:"replace"},edges:new Mte({size:Z1*.15,color:iQ(t,100,90,.3)})})]})}),fNt=Cz(Array.from({length:24},(t,e)=>e));function mNt(t){const e=new Date;e.setHours(fNt()),t.environment.lighting.date=e}function gNt(t){t.environment.weather=_Nt()()}const yNt=[()=>new N6({cloudCover:Math.random()}),()=>new Q3e({cloudCover:Math.random()}),()=>new ePe({cloudCover:Math.random(),precipitation:Math.random()}),()=>new tPe({cloudCover:Math.random(),precipitation:Math.random()}),()=>new K3e({fogStrength:Math.min(Math.random(),.9)})],_Nt=Cz(yNt),pke=t=>function({isPaused:r,board:i,nextShapes:n,score:s}){const o=Si.useMemo(()=>kDt(t),[t]),[a,l]=Si.useState(null),[c,u]=Si.useState(void 0);Si.useEffect(()=>{if(a===null)return;const g=new w2e({basemap:new UC({portalItem:{id:"0560e29930dc4d5ebeb58c635c0909c9"}})}),_=new xLt({container:a,map:g,environment:{lighting:{directShadowsEnabled:!0}},camera:o.initialCamera,qualityProfile:"high"});return _.ui.remove(_.ui.getComponents()),_.when(()=>{const v=_.map.allLayers.find(({title:b})=>b==="Places and Labels");v&&(v.visible=!1),u(_)}),()=>_.destroy()},[a,o]);const h=Si.useRef(s),p=h.current>s,f=Si.useRef(0);return p&&t==="stationary"&&(f.current+=1),h.current=s,Si.useEffect(()=>{c!==void 0&&(c.camera=o.initialCamera)},[c,o,f.current]),IDt(c,i,o,r),uNt(c,s),yt.jsxs(yt.Fragment,{children:[yt.jsx("div",{className:"w-full h-full",ref:l}),yt.jsx("div",{className:"absolute top-0 right-0 drop-shadow-[0_1px_2px_#000]",children:yt.jsx(Kve,{score:s,nextShapes:n})})]})},vNt=pke("animated"),bNt=pke("stationary"),mE="bg-white hover:bg-gray-200 p-4 rounded text-black",wNt={[qs.sceneryRenderer]:bNt,[qs.panoramaRenderer]:vNt,[qs.gridRenderer]:sze};function xNt({onSelect:t}){return yt.jsxs("div",{className:"flex flex-col gap-8 h-full p-8",children:[yt.jsx("span",{className:"flex-1"}),yt.jsxs("div",{className:"flex flex-col gap-8",children:[yt.jsx("h1",{className:"text-5xl",children:qs.title}),yt.jsx("div",{className:"flex gap-4",children:Object.entries(wNt).map(([e,r])=>yt.jsx("button",{className:mE,type:"button",onClick:()=>t(r),children:e},e))})]}),yt.jsx("div",{className:"flex-1 flex justify-end items-end text-end",children:yt.jsxs("span",{children:[yt.jsx("a",{href:"https://github.com/maxpatiiuk/tetris-react/",className:"text-blue-500",target:"_blank",rel:"noopener",children:qs.sourceCode}),yt.jsx("br",{}),qs.inspiredBy(e=>yt.jsx("a",{href:"https://youtu.be/PFVL6t8IHE8?si=qjVQxbNN9RQQmnud&t=21",className:"text-blue-500",target:"_blank",rel:"noopener",children:e})),yt.jsx("br",{}),qs.instructions]})})]})}function TNt({score:t,onRestart:e,onChangeMap:r}){const[i,n]=Qve(),s=Si.useRef(i).current;return Si.useEffect(()=>n(Math.max(i,t)),[t,i]),yt.jsx("div",{className:"absolute inset-0 bg-black/70 flex items-center justify-center text-3xl text-center",children:yt.jsxs("span",{className:"flex flex-col gap-4",children:[yt.jsx("h1",{className:"pb-4 text-6xl",children:qs.gameOver}),yt.jsxs("h2",{children:[qs.yourScore," ",t]}),yt.jsxs("h2",{children:[qs.yourBestScore," ",s]}),yt.jsxs("div",{className:"flex gap-4",children:[yt.jsx("button",{className:mE,type:"button",onClick:e,children:qs.playAgain}),yt.jsx("button",{className:mE,type:"button",onClick:r,children:qs.changeMap})]})]})})}function SNt({onSave:t,onLoad:e,onChangeMap:r}){return yt.jsx("div",{className:"absolute inset-0 flex items-center justify-center w-screen h-screen text-4xl text-center bg-black/70",children:yt.jsxs("div",{className:"flex flex-col gap-8",children:[qs.paused,yt.jsx("span",{children:qs.pressKeyToResume(yt.jsx("span",{className:"rounded-xl p-px text-black bg-white",children:qs.esc}))}),yt.jsxs("div",{className:"flex gap-4",children:[yt.jsx("button",{className:mE,type:"button",onClick:t,children:qs.saveGame}),yt.jsx("button",{className:mE,type:"button",onClick:e,children:qs.loadGame}),yt.jsx("button",{className:mE,type:"button",onClick:r,children:qs.changeMap})]})]})})}const CNt=Object.values({1984:"1YjETQrefLDU6gUdVdjkxK","Starlight Infinite <area X>":"3ICMKtmOim2EQWPGZQlJvm","Singularity X <area X>":"3GR0kABoqo4yYwb0E7CRbt","Butterfly Effect <area X>":"38TW4C6Ozqvpc93ay4E1xO","Butterfly Effect<area X> - Instrumental Mix":"63unOawz5mnIJLhTNdY0B2","Cycle of Silence <area X>":"0y1KtxudTFGVauom0OAw4a","Awakening <area X>":"0Axjc4z6NuEvnI33yfL2Jd","Midnight Sky (Moon Lounge Mix)":"3ObVJtrHe9m1pD0kQjFlnL","1989, Pt. 2":"2FPOAypb6OTKPcVmjs6Fg7",Deserve:"38us10664RE7LzKuP0fubG","Into the Darkness":"17GpTGIlK1wj9sTHkmEBVf",Roses:"1JtdpEnMkAlRHaqAFZWaiE","Midnight Sky":"35S2ehMIqht4nyMC9trphK",Pusher:"0e9Pc6OTaRYbLzAbQcjwD9","Mind Echoes":"3FJ9a6f0Q0onNzAsB1mbqc","Lion Garden":"2yikQFeZTqEVY3pwvOTdKE","All on You":"2zh9jc1IJtUeJoqxK70rki","Deep Dream":"7c9bKzkJ3VcNtmvbzYRFNC",Hope:"0gJ3TBmlm3uvbg7w1A47p3","Drowning Valley":"1bQGr0Yb814NklGQLwtJkz",Walls:"1ySshlSe4XTK8h9aV7cHlu","Two of Us":"1ebNrHTKWLTacblm1AKjKC","Connected (Yours Forever)":"0QpNG88fUtqBFv3jSPKFzH","World of Colors":"6s6wJWlQOrhutApxBjALcL","Like Never Before":"5rwd85f9zKqEqrLkJy21jl",Here:"5DysxV3wWy5BFDjLyKpwJR",Hometown:"1afYzACckpTdtIcd6a1jWE","'Aumakua":"0ES5svcsn175HeltIe3w2y",Chains:"53YBoGEL4eoqHaiDE2rdFG",Snows:"2mXWsRaFeA6MQk51lS4Wgc","3 Senses":"63wf92i45hD2svEtZFaMXi",Boscage:"6XtFtwIRnkUMnj6skKX0vF",Temptation:"70272Cf8IvttxP4k0dEcI5","New Beginnings":"0a2gqb08h29F854LOcodDi","You and I":"5gbll0kKGZ33zLxS4tP1Ah","Lunar Discourse":"1UguHfmcgaEvZcAXAbPsTI",Flames:"0M6lfckrMvgq8tJm9rAfBd","Spring Field":"5V79CYii3UmXypu0ARb8XF","Bright Shadow":"7Bk8zpZzbM3fKk5IEdxvaT",Joy:"6XJGtJDhnAZJkNUpEpzmRA","Next Chapter":"1ikwQqffDGOvNWZTC6VodQ","Connected (Yours Forever) [In-Game Mix]":"781SaJ3m5CzRWtx7yycM0e","Connected (Yours Forever) [Obvious Sky Mix]":"0SIGIMjkTPT4msCRdEAf8g","Always Been but Never Dreamed":"0T4pRzSKGRCtq7ZqA3RHdV","So They Say":"2oOB6hUcj70AekyncV54sE","World of Colors (In-Game Mix)":"3uc5T2QGpCtsVsFQ8J7Jlm","Look Up":"01YImcxm3FqgmFSTvDagLc",Unfold:"1FzV8n4LhHE06a2lopplyj"}),ENt=Cz(CNt,1);function PNt(){return Si.useCallback(()=>`spotify:track:${ENt()}`,[])}const yse=document.createElement("script");yse.src="https://open.spotify.com/embed-podcast/iframe-api/v1";yse.async=!0;document.body.appendChild(yse);Object.defineProperty(window,"onSpotifyIframeApiReady",{configurable:!0,value:t=>{fke=t,rk==null||rk(t)}});let rk,fke;function ANt(){const[t,e]=Si.useState(null),[r,i]=Si.useState(fke),[n,s]=Si.useState(void 0),o=PNt();return rk=i,Si.useEffect(()=>t===null||r===void 0?void 0:r.createController(document.createElement("div"),{uri:o(),theme:"dark"},a=>{t.append(a.iframeElement),a.play(),s(a)}),[t,r,o]),Si.useEffect(()=>{if(n===void 0)return;const a=n.on("playback_update",({data:{position:l,duration:c}})=>{l===0||l!==c||(n.loadUri(o()),n.play())});return()=>{a(),n==null||n.destroy()}},[n]),yt.jsx("div",{ref:e,className:`
        h-20 z-10 absolute top-0 left-0 w-[min(100%,25rem)]
        [&>iframe]:h-full flex flex-row-reverse align-center bg-[#282828]
        rounded-tl-none rounded-lg
      `,children:yt.jsx("button",{title:qs.nextSong,"aria-label":qs.nextSong,className:"w-12 h-full p-2 hover:brightness-75",onClick:()=>{n==null||n.loadUri(o()),n==null||n.play()},children:MNt})})}const MNt=yt.jsx("svg",{fill:"none",stroke:"currentColor",strokeWidth:1.5,viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:yt.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 8.688c0-.864.933-1.405 1.683-.977l7.108 4.062a1.125 1.125 0 010 1.953l-7.108 4.062A1.125 1.125 0 013 16.81V8.688zM12.75 8.688c0-.864.933-1.405 1.683-.977l7.108 4.062a1.125 1.125 0 010 1.953l-7.108 4.062a1.125 1.125 0 01-1.683-.977V8.688z"})});function ONt(){const[t,e]=Si.useState(),[r,i]=Si.useState(!1);return yt.jsxs(yt.Fragment,{children:[t===void 0?yt.jsx(xNt,{onSelect:n=>{i(!0),e(()=>n)}}):yt.jsx(RNt,{renderer:t,onChangeMap:()=>e(void 0)}),r&&yt.jsx(ANt,{})]})}function RNt({renderer:t,onChangeMap:e}){const[r,i]=Si.useState();return yt.jsxs(yt.Fragment,{children:[yt.jsx($Nt,{isGameOver:typeof r=="number",renderer:t,onGameOver:i,onChangeMap:e}),typeof r=="number"&&yt.jsx(TNt,{score:r,onChangeMap:e,onRestart:()=>i(void 0)})]})}function $Nt({renderer:t,isGameOver:e,onGameOver:r,onChangeMap:i}){const[n,s]=Si.useState(()=>q_.initial(Array.from({length:5},e5))),o=Si.useRef(n);o.current=n;const[a,l]=nze(),c=Object.keys(n.currentShapeLocation).length===0,u=Si.useRef(c),h=Si.useRef(0);return c&&!u.current&&(h.current+=1),u.current=c,Si.useEffect(()=>{if(e)return;function p(){const{isGameOver:g=!1,..._}=q_.gravity(o.current,e5());g&&r(o.current.score),s(_)}p();const f=setInterval(p,V8e/Math.log(3+n.score/Xve));return()=>clearInterval(f)},[h.current,e]),Si.useEffect(()=>{if(e)return;s(q_.initial(Array.from({length:5},e5))),document.addEventListener("keydown",p,{capture:!0});function p(x){x.key!==f&&clearTimeout(g),x.key in E_e?(_.add(x.key),f!==x.key&&(f=x.key,b()),x.preventDefault(),x.stopPropagation()):(f=void 0,x.key==="Escape"||x.key==="p"?s(q_.togglePause(o.current)):x.key===" "&&s(q_.hardDrop(o.current)))}let f,g;const _=new Set,v=100;function b(){f!==void 0&&(s(q_.move(o.current,E_e[f])),f!=="ArrowUp"&&(g=setTimeout(b,v)))}document.addEventListener("keyup",w,{capture:!0});function w(x){_.delete(x.key),x.key===f&&(f=Array.from(_)[0],clearTimeout(g),b())}return()=>{f=void 0,document.removeEventListener("keydown",p,{capture:!0}),document.removeEventListener("keyup",w,{capture:!0})}},[e]),yt.jsxs("div",{className:"flex items-center justify-center w-screen h-screen text-white bg-black",children:[yt.jsx(t,{board:n.board,nextShapes:n.nextShapes,score:n.score,isPaused:n.isPaused||e}),n.isPaused&&yt.jsx(SNt,{onLoad:()=>s({...a,isPaused:!1}),onSave:()=>l(n),onChangeMap:i})]})}const E_e={ArrowUp:ns.UP,ArrowDown:ns.DOWN,ArrowLeft:ns.LEFT,ArrowRight:ns.RIGHT,w:ns.UP,s:ns.DOWN,a:ns.LEFT,d:ns.RIGHT,k:ns.UP,j:ns.DOWN,h:ns.LEFT,l:ns.RIGHT};Yj.createRoot(document.getElementById("root")).render(yt.jsx(Si.StrictMode,{children:yt.jsx(ONt,{})}));const INt=Object.freeze(Object.defineProperty({__proto__:null,betaRayleigh:JC,build:EPe},Symbol.toStringTag,{value:"Module"})),LNt=Object.freeze(Object.defineProperty({__proto__:null,AtmosphereCompositingPassParameters:Kte,build:GPe},Symbol.toStringTag,{value:"Module"})),DNt=Object.freeze(Object.defineProperty({__proto__:null,build:QPe},Symbol.toStringTag,{value:"Module"})),NNt=Object.freeze(Object.defineProperty({__proto__:null,CloudsPassParameters:sre,build:sAe},Symbol.toStringTag,{value:"Module"})),FNt=Object.freeze(Object.defineProperty({__proto__:null,NoiseTextureAtlasPassParameters:ore,build:lAe},Symbol.toStringTag,{value:"Module"})),kNt=Object.freeze(Object.defineProperty({__proto__:null,FogPassParameters:lre,build:CAe},Symbol.toStringTag,{value:"Module"})),zNt=Object.freeze(Object.defineProperty({__proto__:null,SilhouetteCircle:hre,SimpleAtmospherePassParameters:oU,build:LAe},Symbol.toStringTag,{value:"Module"})),UNt=Object.freeze(Object.defineProperty({__proto__:null,build:oMe},Symbol.toStringTag,{value:"Module"})),BNt=Object.freeze(Object.defineProperty({__proto__:null,build:cMe},Symbol.toStringTag,{value:"Module"})),VNt=Object.freeze(Object.defineProperty({__proto__:null,build:jOe,calculateAnchorPosForRendering:j$},Symbol.toStringTag,{value:"Module"})),GNt=Object.freeze(Object.defineProperty({__proto__:null,build:kRe},Symbol.toStringTag,{value:"Module"})),jNt=Object.freeze(Object.defineProperty({__proto__:null,build:BRe,getRadius:DU},Symbol.toStringTag,{value:"Module"})),HNt=Object.freeze(Object.defineProperty({__proto__:null,build:HRe},Symbol.toStringTag,{value:"Module"})),WNt=Object.freeze(Object.defineProperty({__proto__:null,build:qRe},Symbol.toStringTag,{value:"Module"})),qNt=Object.freeze(Object.defineProperty({__proto__:null,build:l$e},Symbol.toStringTag,{value:"Module"})),YNt=Object.freeze(Object.defineProperty({__proto__:null,build:mIe,ribbonlineNumRoundJoinSubdivisions:J$},Symbol.toStringTag,{value:"Module"})),XNt=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:Aie,build:H$e},Symbol.toStringTag,{value:"Module"})),ZNt=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:zie,build:AIe},Symbol.toStringTag,{value:"Module"})),JNt=Object.freeze(Object.defineProperty({__proto__:null,build:jLe},Symbol.toStringTag,{value:"Module"})),QNt=Object.freeze(Object.defineProperty({__proto__:null,build:dDe},Symbol.toStringTag,{value:"Module"})),KNt=Object.freeze(Object.defineProperty({__proto__:null,build:WDe},Symbol.toStringTag,{value:"Module"})),e4t=Object.freeze(Object.defineProperty({__proto__:null,build:KDe},Symbol.toStringTag,{value:"Module"})),t4t=Object.freeze(Object.defineProperty({__proto__:null,build:rNe},Symbol.toStringTag,{value:"Module"})),r4t=Object.freeze(Object.defineProperty({__proto__:null,build:pNe},Symbol.toStringTag,{value:"Module"})),i4t=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:Ine,build:d4e},Symbol.toStringTag,{value:"Module"})),n4t=Object.freeze(Object.defineProperty({__proto__:null,get BackgroundMode(){return Av},build:L4e},Symbol.toStringTag,{value:"Module"})),s4t=Object.freeze(Object.defineProperty({__proto__:null,ColorizerHillshadeUniforms:u4e,ColorizerStretchUniforms:c4e,ColorizerUniforms:fL,build:h4e},Symbol.toStringTag,{value:"Module"})),o4t=Object.freeze(Object.defineProperty({__proto__:null,build:Z4e},Symbol.toStringTag,{value:"Module"})),a4t=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:oB,build:s5e},Symbol.toStringTag,{value:"Module"})),l4t=Object.freeze(Object.defineProperty({__proto__:null,HUDCompositingPassParameters:Zne,build:a5e},Symbol.toStringTag,{value:"Module"})),c4t=Object.freeze(Object.defineProperty({__proto__:null,OITCompositingPassParameters:Jne,build:u5e},Symbol.toStringTag,{value:"Module"})),u4t=Object.freeze(Object.defineProperty({__proto__:null,build:_5e},Symbol.toStringTag,{value:"Module"})),h4t=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:ese,build:w5e},Symbol.toStringTag,{value:"Module"})),d4t=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:Qne,blurSize:Kne,build:y5e,gridCellPixelSize:mp,outlineSize:cI},Symbol.toStringTag,{value:"Module"})),p4t=Object.freeze(Object.defineProperty({__proto__:null,build:E5e},Symbol.toStringTag,{value:"Module"})),f4t=Object.freeze(Object.defineProperty({__proto__:null,build:M5e},Symbol.toStringTag,{value:"Module"})),m4t=Object.freeze(Object.defineProperty({__proto__:null,build:$5e},Symbol.toStringTag,{value:"Module"})),g4t=Object.freeze(Object.defineProperty({__proto__:null,build:D5e},Symbol.toStringTag,{value:"Module"})),y4t=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastVisualizePassParameters:rse,build:z5e},Symbol.toStringTag,{value:"Module"})),_4t=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastMaxSamples:gL,build:k5e},Symbol.toStringTag,{value:"Module"})),v4t=Object.freeze(Object.defineProperty({__proto__:null,build:H5e},Symbol.toStringTag,{value:"Module"}));export{gs as $,he as A,Qr as B,q1 as C,Xx as D,se as E,FZ as F,fv as G,md as H,rEt as I,Kr as J,dy as K,wl as L,Ls as M,gR as N,Fbe as O,gi as P,Zr as Q,Vo as R,Ae as S,a9 as T,Xi as U,$t as V,en as W,Hx as X,xbe as Y,nu as Z,ge as _,K as a,F8t as a$,R as a0,Ye as a1,v3 as a2,Is as a3,Uie as a4,Pv as a5,Jt as a6,li as a7,sg as a8,tv as a9,S6t as aA,$Ee as aB,xl as aC,fs as aD,Yee as aE,Zt as aF,we as aG,Vt as aH,VH as aI,tbe as aJ,GKe as aK,zEe as aL,I6t as aM,L6t as aN,A6t as aO,T$ as aP,Iee as aQ,_l as aR,$K as aS,af as aT,$6t as aU,cW as aV,m6t as aW,yWe as aX,XI as aY,RI as aZ,A5 as a_,Vte as aa,uxe as ab,ud as ac,Gi as ad,IA as ae,lt as af,T9 as ag,M2 as ah,VI as ai,Xe as aj,E1 as ak,Ute as al,y3e as am,Qet as an,z2 as ao,H3 as ap,Rt as aq,_s as ar,D7t as as,N7t as at,hht as au,oy as av,Hce as aw,dVt as ax,CHt as ay,rg as az,DCt as b,Ene as b$,hr as b0,mi as b1,sFt as b2,m5t as b3,L0 as b4,axe as b5,kUe as b6,Xoe as b7,Bz as b8,w5t as b9,kz as bA,ntt as bB,CEe as bC,cNt as bD,$5t as bE,nh as bF,ptt as bG,N8t as bH,fet as bI,BEe as bJ,C6t as bK,z6t as bL,eet as bM,$6 as bN,R6 as bO,v6t as bP,E6t as bQ,p$ as bR,To as bS,rqe as bT,E2 as bU,w1t as bV,x1t as bW,Btt as bX,UE as bY,B8t as bZ,_Xt as b_,ke as ba,Np as bb,$3 as bc,ei as bd,EI as be,Lt as bf,O6t as bg,R6t as bh,UFt as bi,CWe as bj,GFt as bk,VFt as bl,BFt as bm,f0 as bn,Na as bo,ze as bp,_e as bq,FNe as br,ua as bs,yn as bt,D3e as bu,h9 as bv,n2 as bw,zc as bx,SEe as by,y6t as bz,V as c,Li as c$,Gz as c0,Qn as c1,Ba as c2,oi as c3,PI as c4,LSt as c5,ABe as c6,It as c7,fqe as c8,B8 as c9,Xp as cA,a7t as cB,Mce as cC,Tte as cD,vs as cE,P3 as cF,r8t as cG,P7t as cH,Wt as cI,Ku as cJ,d6t as cK,bkt as cL,Zx as cM,T4 as cN,zE as cO,Cx as cP,$p as cQ,Ip as cR,kGe as cS,k4e as cT,yFt as cU,_x as cV,_6t as cW,JKe as cX,CUt as cY,G$ as cZ,EUt as c_,HSe as ca,Bt as cb,ewe as cc,$z as cd,tee as ce,OE as cf,f$ as cg,Abe as ch,ju as ci,DVe as cj,l$ as ck,NVe as cl,sse as cm,y5t as cn,eFt as co,bDt as cp,w2 as cq,pKt as cr,gKt as cs,KFe as ct,sWt as cu,QVe as cv,Wm as cw,vi as cx,n5 as cy,DBe as cz,J0 as d,Fa as d$,ka as d0,lf as d1,Je as d2,pe as d3,ie as d4,C as d5,$Qt as d6,v$ as d7,aWt as d8,bt as d9,vMt as dA,hMt as dB,eQt as dC,X8 as dD,rJt as dE,wMt as dF,gf as dG,oDe as dH,Hwe as dI,ftt as dJ,M6t as dK,Ypt as dL,Xpt as dM,OI as dN,R$e as dO,w7t as dP,b7t as dQ,u$ as dR,g3 as dS,wd as dT,jKe as dU,F6t as dV,VKe as dW,N6t as dX,$m as dY,L7e as dZ,O$e as d_,F3 as da,HE as db,mW as dc,Hn as dd,fW as de,yW as df,Xk as dg,ZTe as dh,ZVe as di,ktt as dj,b5t as dk,da as dl,iFt as dm,uFe as dn,VQt as dp,GQt as dq,HQt as dr,lIt as ds,tIt as dt,E_t as du,P_t as dv,A_t as dw,Hu as dx,A4t as dy,_Mt as dz,d as e,ce as e$,Yr as e0,Du as e1,BB as e2,x7t as e3,Rpt as e4,OA as e5,LCe as e6,Ji as e7,fX as e8,G1 as e9,XFe as eA,D6t as eB,XK as eC,CI as eD,TLt as eE,VYt as eF,SLt as eG,su as eH,vy as eI,J9 as eJ,j3 as eK,vkt as eL,Zk as eM,Fwe as eN,zFt as eO,fn as eP,V1 as eQ,lqe as eR,Sx as eS,BW as eT,PLt as eU,Pp as eV,ai as eW,Ce as eX,ye as eY,fe as eZ,Ge as e_,Oc as ea,lc as eb,kc as ec,m6 as ed,$4t as ee,VUe as ef,CE as eg,jK as eh,Oze as ei,_2e as ej,L8t as ek,ii as el,W4t as em,cUt as en,P1t as eo,$D as ep,Fet as eq,j4t as er,MK as es,Pwe as et,ha as eu,e7e as ev,rv as ew,kQt as ex,bPt as ey,YFe as ez,LCt as f,sVt as f$,Ywe as f0,wxe as f1,xxe as f2,Yi as f3,kqt as f4,Dqt as f5,Fqt as f6,M3 as f7,BQt as f8,WQt as f9,Bae as fA,dr as fB,PCt as fC,u5t as fD,c5t as fE,bV as fF,hee as fG,r2 as fH,ELt as fI,wW as fJ,mo as fK,wJ as fL,HBe as fM,WBe as fN,qBe as fO,YBe as fP,zQt as fQ,bht as fR,kn as fS,h8t as fT,d8t as fU,lWt as fV,YVe as fW,nHt as fX,nVt as fY,tRe as fZ,rie as f_,HWe as fa,w4t as fb,tg as fc,BH as fd,nFt as fe,OSt as ff,RSt as fg,Yx as fh,Z7e as fi,xe as fj,Lqt as fk,AK as fl,$k as fm,THt as fn,t$ as fo,py as fp,xne as fq,zNe as fr,z1 as fs,f5t as ft,S5t as fu,iEt as fv,qkt as fw,r2e as fx,Rz as fy,NQe as fz,vt as g,nv as g$,oVt as g0,$a as g1,Jl as g2,H9t as g3,c9 as g4,xo as g5,mn as g6,jz as g7,yi as g8,ca as g9,tEt as gA,yd as gB,Go as gC,kee as gD,eqe as gE,zi as gF,nC as gG,VE as gH,Nt as gI,uVt as gJ,cVt as gK,Nv as gL,Oqt as gM,g6 as gN,Tv as gO,f8 as gP,tL as gQ,Zs as gR,gd as gS,cr as gT,XE as gU,OZe as gV,cte as gW,u3t as gX,$$t as gY,xee as gZ,Ep as g_,ey as ga,us as gb,IQt as gc,zW as gd,La as ge,Br as gf,udt as gg,wK as gh,xK as gi,fze as gj,T4t as gk,nc as gl,ydt as gm,Ns as gn,cdt as go,os as gp,mee as gq,IJe as gr,DYe as gs,Q0 as gt,S$ as gu,HTe as gv,tqe as gw,Q as gx,Te as gy,Fle as gz,Jp as h,bUe as h$,rC as h0,sq as h1,h7t as h2,Opt as h3,Zde as h4,hFt as h5,l7t as h6,Gu as h7,Bjt as h8,WZ as h9,x5t as hA,i$ as hB,BHt as hC,vKt as hD,fKt as hE,g6t as hF,QGe as hG,JGe as hH,bGe as hI,Oae as hJ,t2 as hK,u2 as hL,K6t as hM,uSt as hN,EFt as hO,kC as hP,qUe as hQ,ng as hR,qDt as hS,iHt as hT,I_t as hU,rHt as hV,KUe as hW,D4t as hX,dUe as hY,yUe as hZ,qH as h_,qZ as ha,Xs as hb,Di as hc,Jn as hd,Bp as he,yf as hf,Ax as hg,skt as hh,GYe as hi,Zi as hj,GNe as hk,qx as hl,aRe as hm,FHt as hn,N0t as ho,_jt as hp,aO as hq,vG as hr,x_t as hs,xw as ht,D8t as hu,H3e as hv,k8t as hw,z8t as hx,JO as hy,xW as hz,Tr as i,th as i$,Gm as i0,Qu as i1,K1 as i2,S4t as i3,J4t as i4,ac as i5,u6t as i6,_7t as i7,R0 as i8,CR as i9,iXe as iA,u1 as iB,Rs as iC,mte as iD,Gqt as iE,XTe as iF,kce as iG,SFt as iH,t3 as iI,i8t as iJ,M4t as iK,KU as iL,IK as iM,h2 as iN,_S as iO,U8t as iP,wi as iQ,iRt as iR,sr as iS,fi as iT,Pi as iU,Hqt as iV,YQt as iW,nLt as iX,XQt as iY,Ea as iZ,qwe as i_,U9t as ia,ff as ib,FU as ic,Zh as id,gFt as ie,zn as ig,KAe as ih,hVe as ii,ME as ij,f7t as ik,gSt as il,U3 as im,Rze as io,CK as ip,V2 as iq,ue as ir,Bi as is,Xr as it,Up as iu,cn as iv,st as iw,si as ix,GSt as iy,De as iz,nf as j,x6t as j$,L2 as j0,O2 as j1,ic as j2,NE as j3,on as j4,YAt as j5,Cut as j6,Hs as j7,GZt as j8,F0 as j9,QLe as jA,iwt as jB,b2 as jC,ift as jD,iy as jE,L$e as jF,uFt as jG,sft as jH,Rbt as jI,Cbt as jJ,Ebt as jK,Ibt as jL,Abt as jM,Mbt as jN,Pbt as jO,$bt as jP,nft as jQ,Obt as jR,vd as jS,uE as jT,$T as jU,kbe as jV,q4t as jW,ZLt as jX,yKt as jY,_Kt as jZ,P6t as j_,uf as ja,za as jb,WI as jc,Qs as jd,uU as je,dU as jf,U2 as jg,qGt as jh,BAe as ji,pU as jj,hU as jk,Iwe as jl,ZC as jm,uee as jn,qz as jo,o9 as jp,JB as jq,$te as jr,er as js,Xue as jt,vDe as ju,wDe as jv,aDe as jw,ll as jx,SR as jy,ER as jz,DI as k,S7t as k$,Yoe as k0,uv as k1,Lm as k2,Zn as k3,Z$e as k4,Ey as k5,gC as k6,kr as k7,MI as k8,NI as k9,zz as kA,T5t as kB,P4t as kC,nXe as kD,M$ as kE,H5t as kF,W5t as kG,_9e as kH,p7t as kI,b6t as kJ,w6t as kK,T6t as kL,c2 as kM,k6t as kN,Mpt as kO,QOe as kP,Js as kQ,Rp as kR,mFt as kS,ikt as kT,Ire as kU,R2 as kV,pv as kW,pn as kX,Bbe as kY,K4t as kZ,Q4t as k_,RHt as ka,aJ as kb,_8 as kc,Cn as kd,Kh as ke,Xme as kf,zo as kg,q9t as kh,Be as ki,P2 as kj,dKt as kk,hKt as kl,Nqt as km,N as kn,k5t as ko,UQt as kp,cB as kq,lB as kr,use as ks,Wc as kt,B$t as ku,hbe as kv,zK as kw,g5t as kx,A3 as ky,SUe as kz,b2e as l,lFt as l$,T7t as l0,y9e as l1,nbe as l2,bze as l3,bFt as l4,jQt as l5,lNt as l6,sNt as l7,Ybe as l8,p8t as l9,L$ as lA,Iqt as lB,Axe as lC,$v as lD,vp as lE,Uc as lF,Wte as lG,Hte as lH,oa as lI,ni as lJ,ne as lK,ukt as lL,Qqe as lM,av as lN,cbe as lO,uy as lP,wwe as lQ,Vz as lR,p5t as lS,Wwe as lT,oae as lU,lxe as lV,QO as lW,Ort as lX,Vh as lY,He as lZ,lr as l_,sy as la,CKt as lb,aNt as lc,QF as ld,EKt as le,ADe as lf,W3 as lg,gbe as lh,u8t as li,WDt as lj,dke as lk,QDt as ll,gy as lm,ISe as ln,_Ye as lo,Wl as lp,qVe as lq,r$ as lr,Vnt as ls,set as lt,j5t as lu,XFt as lv,JFt as lw,ZFt as lx,dd as ly,Em as lz,Oz as m,CFt as m$,Zz as m0,PFt as m1,mg as m2,_5t as m3,Nbe as m4,vVe as m5,p6t as m6,ZDt as m7,i2 as m8,gkt as m9,_qe as mA,Im as mB,sn as mC,sDe as mD,Uvt as mE,_K as mF,eJe as mG,v5t as mH,ZEe as mI,vyt as mJ,f6t as mK,zfe as mL,q9 as mM,y1 as mN,E7t as mO,Xde as mP,A7t as mQ,v7t as mR,P$e as mS,M$e as mT,C$e as mU,VO as mV,a5 as mW,tpe as mX,aft as mY,o7t as mZ,g2e as m_,Uo as ma,eB as mb,b6 as mc,ySt as md,fgt as me,qqt as mf,MSe as mg,s3 as mh,Xqt as mi,Yqt as mj,D0 as mk,dSt as ml,S9 as mm,xFt as mn,wFt as mo,rzt as mp,ozt as mq,j9t as mr,Zce as ms,Yce as mt,nm as mu,Rqt as mv,$qt as mw,qe as mx,uJe as my,C9 as mz,AWe as n,ou as n$,Kxe as n0,_Ft as n1,gVe as n2,TVe as n3,QK as n4,X5t as n5,CIe as n6,Tgt as n7,Lz as n8,Y9 as n9,Pc as nA,$qe as nB,g$ as nC,P1 as nD,IYe as nE,Ra as nF,fAe as nG,Rm as nH,Bnt as nI,nce as nJ,vNe as nK,Uae as nL,LQt as nM,HSt as nN,Oge as nO,ibe as nP,vK as nQ,C5t as nR,Hc as nS,Lte as nT,mbe as nU,gze as nV,cFt as nW,_ce as nX,Bqt as nY,n4 as nZ,rIe as n_,yl as na,wtt as nb,PRe as nc,cie as nd,Fit as ne,hDe as nf,Awe as ng,jSe as nh,GZ as ni,oWt as nj,a2 as nk,jYe as nl,AVt as nm,IU as nn,d8 as no,I5t as np,Dz as nq,H4t as nr,N$ as ns,h$ as nt,lv as nu,lVt as nv,mAe as nw,de as nx,Mht as ny,DCe as nz,Gae as o,bi as o$,vqe as o0,QFt as o1,B9t as o2,Xm as o3,WE as o4,Hr as o5,nn as o6,V3 as o7,Xt as o8,F$e as o9,$c as oA,Dc as oB,y3 as oC,DJ as oD,IJ as oE,NJ as oF,LJ as oG,uHt as oH,h0t as oI,dHt as oJ,j0t as oK,rjt as oL,Fge as oM,mv as oN,sSe as oO,eo as oP,vPe as oQ,Bee as oR,o2 as oS,Srt as oT,As as oU,gPe as oV,zr as oW,fy as oX,P9 as oY,Bo as oZ,FI as o_,k$e as oa,pVt as ob,N0 as oc,jo as od,hHt as oe,tzt as of,jte as og,ezt as oh,xp as oi,Nge as oj,gHt as ok,pHt as ol,fHt as om,mHt as on,$J as oo,jd as op,W8 as oq,Ca as or,aHt as os,pXt as ot,qie as ou,q8 as ov,sHt as ow,lHt as ox,PLe as oy,oHt as oz,v9 as p,K8t as p$,KO as p0,A9 as p1,ASe as p2,pkt as p3,fkt as p4,Irt as p5,Rwt as p6,cA as p7,Z9 as p8,BI as p9,Xht as pA,X9 as pB,H2t as pC,sie as pD,Xn as pE,i2e as pF,aTt as pG,jCt as pH,EVe as pI,F5t as pJ,BDt as pK,VDt as pL,hke as pM,wHt as pN,_ft as pO,xHt as pP,z$e as pQ,o5t as pR,ake as pS,ZE as pT,_7e as pU,B9 as pV,r6 as pW,Jz as pX,dtt as pY,YEe as pZ,ig as p_,G3 as pa,k2 as pb,ELe as pc,XEe as pd,tHt as pe,JTe as pf,j2t as pg,_pt as ph,gpt as pi,Vrt as pj,YVt as pk,qVt as pl,ny as pm,R7t as pn,vo as po,sa as pp,Kqt as pq,Lie as pr,Ho as ps,i5t as pt,kp as pu,Iu as pv,y7t as pw,kle as px,gt as py,u7t as pz,re as q,AYe as q$,wx as q0,ri as q1,Tt as q2,Sr as q3,Z$ as q4,nXt as q5,fXt as q6,NCt as q7,ex as q8,zge as q9,j9e as qA,jFt as qB,eg as qC,Skt as qD,Tkt as qE,oZe as qF,bL as qG,sZe as qH,vHt as qI,Pz as qJ,tet as qK,U$t as qL,KKe as qM,I6 as qN,D6 as qO,O4t as qP,og as qQ,JQt as qR,tce as qS,SHt as qT,bHt as qU,Pte as qV,cet as qW,uet as qX,fLt as qY,RQt as qZ,IW as q_,aXt as qa,iXt as qb,oXt as qc,Kw as qd,tXt as qe,XYt as qf,KG as qg,FCt as qh,Jm as qi,Ht as qj,Vjt as qk,Wr as ql,Ar as qm,_d as qn,jjt as qo,oFt as qp,t$e as qq,Gh as qr,Gjt as qs,Se as qt,SEt as qu,CEt as qv,p5 as qw,e6 as qx,q5t as qy,btt as qz,SK as r,__t as r$,_kt as r0,G5t as r1,nrt as r2,U5t as r3,z5t as r4,hn as r5,Kc as r6,fht as r7,tje as r8,izt as r9,F6 as rA,$E as rB,Ma as rC,RYe as rD,nte as rE,rFt as rF,DFt as rG,Rrt as rH,xqe as rI,ov as rJ,KGe as rK,SE as rL,NHt as rM,TK as rN,E8t as rO,SI as rP,wvt as rQ,_2 as rR,qu as rS,KK as rT,iee as rU,Yjt as rV,Xjt as rW,Dp as rX,wLe as rY,n_t as rZ,_Le as r_,Xce as ra,Ymt as rb,pd as rc,iU as rd,jC as re,_nt as rf,o9t as rg,n9t as rh,s9t as ri,okt as rj,fSt as rk,h6t as rl,j1 as rm,mSt as rn,rRe as ro,U1 as rp,Va as rq,Drt as rr,mkt as rs,ckt as rt,i6 as ru,ty as rv,aYe as rw,SSe as rx,kYe as ry,hd as rz,bee as s,Cy as s$,N_ as s0,Hie as s1,jie as s2,Njt as s3,yHt as s4,qyt as s5,q0t as s6,zs as s7,n9 as s8,td as s9,Vyt as sA,M7t as sB,JK as sC,Upt as sD,qjt as sE,Wfe as sF,C7t as sG,dje as sH,W5 as sI,vtt as sJ,Or as sK,Zc as sL,Kl as sM,T as sN,Fn as sO,iu as sP,ct as sQ,$e as sR,U as sS,xg as sT,ft as sU,Ir as sV,tu as sW,j as sX,Vr as sY,Lr as sZ,kt as s_,zm as sa,Wjt as sb,Qyt as sc,cHt as sd,kjt as se,Fjt as sf,Rr as sg,pt as sh,ks as si,BRt as sj,x4t as sk,b4t as sl,Yyt as sm,vjt as sn,Zjt as so,Jjt as sp,zjt as sq,Ujt as sr,n5t as ss,Kpe as st,Hjt as su,t_t as sv,OEe as sw,vht as sx,Aht as sy,Ret as sz,tr as t,jee as t$,rU as t0,Gv as t1,ru as t2,EU as t3,Yt as t4,pg as t5,Cv as t6,jv as t7,MU as t8,vl as t9,mMe as tA,s3e as tB,Rte as tC,_f as tD,zqt as tE,Pqt as tF,yJ as tG,$3e as tH,hM as tI,PSe as tJ,hkt as tK,_n as tL,srt as tM,dv as tN,dkt as tO,lkt as tP,gst as tQ,xr as tR,Wo as tS,zv as tT,I$ as tU,sX as tV,aFt as tW,V5t as tX,B5t as tY,Qe as tZ,iVt as t_,mne as ta,z0 as tb,tst as tc,PU as td,ibt as te,tre as tf,eP as tg,aU as th,jBt as ti,Zre as tj,e8t as tk,Oet as tl,Z6 as tm,Ai as tn,n8t as to,HBt as tp,MAe as tq,ln as tr,FRe as ts,ti as tt,Xu as tu,f2 as tv,sU as tw,Td as tx,Vv as ty,Mr as tz,Pe as u,LU as u$,pFt as u0,akt as u1,wNe as u2,gg as u3,Fee as u4,MCe as u5,cf as u6,o3 as u7,Ft as u8,Fo as u9,dJe as uA,Aqe as uB,Kue as uC,W9t as uD,$2 as uE,TUt as uF,W7e as uG,m7t as uH,TFt as uI,E4t as uJ,$Xt as uK,vFt as uL,g7t as uM,Fc as uN,G4t as uO,YDt as uP,Ga as uQ,bdt as uR,Tu as uS,bf as uT,wg as uU,Ci as uV,k0 as uW,ug as uX,tt as uY,B2 as uZ,cg as u_,Zu as ua,AU as ub,Bv as uc,jV as ud,TOe as ue,Qi as uf,DOe as ug,Jre as uh,t8t as ui,Gee as uj,szt as uk,R$ as ul,nzt as um,cc as un,C$ as uo,Jee as up,DE as uq,fFt as ur,slt as us,Qee as ut,Oxe as uu,LE as uv,ESe as uw,xYe as ux,ry as uy,O9 as uz,a$ as v,jc as v0,dMe as v1,nkt as v2,but as v3,eh as v4,Oqe as v5,zmt as v6,Umt as v7,p3 as v8,oZ as v9,$ie as va,KFt as vb,tkt as vc,L7t as vd,VHt as ve,nWt as vf,fd as w,TYt as x,m as y,Dwe as z};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/IdentityManager-D0o8fAjj.js","assets/substitute-BkGQLKvO.js","assets/ElevationLayer-CmzccZP2.js","assets/MultiOriginJSONSupport-BZQTWpeF.js","assets/ArcGISCachedService-fj1Nq4oo.js","assets/TileInfoTilemapCache-CWMVE5gY.js","assets/TilemapCache-1A4vVhtU.js","assets/ArcGISService-uQPwYVuT.js","assets/OperationalLayer-CgleBBYh.js","assets/commonProperties-71l2LJ6s.js","assets/PortalLayer-DaNsTDLt.js","assets/portalItemUtils-JWUEQXnE.js","assets/layersCreator-KYKl-zWh.js","assets/portalLayers-DI_yw6bM.js","assets/associatedFeatureServiceUtils-ClJUwXCV.js","assets/lazyLayerLoader-CJAJQz5y.js","assets/styleUtils-B6WLKgkA.js","assets/arcgisLayers-BUG19XMB.js","assets/fetchService-C31SQE3Q.js","assets/statsWorker-Dea2Zhor.js","assets/utils-DpxLp-CG.js","assets/heatmapUtils-CpfvS1IE.js","assets/utils-DuuxkxDB.js","assets/utils-CNh-hAjn.js","assets/ClassBreaksDefinition-BI_2pPxM.js","assets/geometryEngineWorker-BikrlNW5.js","assets/geometryEngineJSON-DtHYPzsN.js","assets/geometryEngineBase-DlPZ98f0.js","assets/json-Wa8cmqdu.js","assets/CSVSourceWorker-DurlFq09.js","assets/date-M6n_RqpC.js","assets/FeatureStore-DfMqUozf.js","assets/BoundsStore-sO8GTsfn.js","assets/PooledRBush-1Fb0hpVC.js","assets/quickselect-BfFUODyN.js","assets/QueryEngine-DfAP_JpM.js","assets/WhereClause-DN7niXzF.js","assets/TimeOnly-B0m-iz0l.js","assets/UnknownTimeZone-81r46adS.js","assets/QueryEngineCapabilities-CTDe3LlQ.js","assets/FieldsIndex-j25pkYvJ.js","assets/optimizedFeatureQueryEngineAdapter-DJZQbCrA.js","assets/number-BciFTi3o.js","assets/clientSideDefaults-H6zD17YE.js","assets/ElevationSamplerWorker-CekdSq-_.js","assets/FeatureServiceSnappingSourceWorker-CSFFIKcE.js","assets/symbologySnappingCandidates-C4o1y5aC.js","assets/pbfQueryUtils-CqZlBXBb.js","assets/pbf-lkSPrDyg.js","assets/query-Cal2QOnU.js","assets/queryZScale-DalU9HM9.js","assets/GeoJSONSourceWorker-DblEb6od.js","assets/geojson-D0Tx971m.js","assets/sourceUtils-CGA1gswm.js","assets/MemorySourceWorker-D3ymhpCp.js","assets/objectIdUtils-4dd1rf9p.js","assets/PBFDecoderWorker-C6EZfdWz.js","assets/FeaturePipelineWorker-BCPnu1XD.js","assets/diffUtils-D_LMLEpD.js","assets/TurboLine-CxQlp93D.js","assets/constants-D5zmR9t2.js","assets/Rect-BAnET0xx.js","assets/geohashUtils-xKNGzc6P.js","assets/ogcFeatureUtils-wP2t27X8.js","assets/StreamFeatureManager-BhH3yx5R.js","assets/createConnection-CrwNk-TZ.js","assets/PointCloudWorker-CHSwgkTf.js","assets/PointCloudWorkerUtil-DmayABs6.js","assets/PointCloudUniqueValueRenderer-CAdBY5WK.js","assets/I3SBinaryReader-DZo_O6Xi.js","assets/RasterWorker-By1CZxzv.js","assets/dataUtils-tOrpKPXg.js","assets/utils-D3i6CC6-.js","assets/rasterProjectionHelper-C2k94LqZ.js","assets/SceneLayerWorker-DtoiTn-Z.js","assets/I3SNode-Bar3BKqs.js","assets/I3SUtil-CS_iMtLE.js","assets/WFSSourceWorker-Ce6r7QoY.js","assets/wfsUtils-D7Nrvpsz.js","assets/xmlUtils-CtUoQO7q.js","assets/WorkerTileHandler-Bh3X65lw.js","assets/StyleRepository-C8YFuEOG.js","assets/Lyr3DWorker-CGcjlDJZ.js","assets/ILyr3DWasmPerSceneView-vPx4somd.js","assets/Lyr3DModule-Bd4S9Vwp.js","assets/Popup-pcxysF_X.js","assets/unitFormatUtils-CrXkRIq7.js","assets/AttachmentInfo-Cmf2SmkX.js","assets/AttachmentQuery-B5Jh59Bx.js","assets/jsonUtils-CvVppPa6.js","assets/UniqueValueRenderer-C8B84zcF.js","assets/executeQueryJSON-ClxeSi8X.js","assets/FeatureSet-DZOCMyA1.js","assets/RelationshipQuery-QRZ1tsX4.js","assets/TopFeaturesQuery-DK9IN5Vy.js","assets/FeatureLayer-Bl4Oa2Ns.js","assets/FormTemplate-FSyxNdA8.js","assets/editsZScale-BIAQdbBN.js","assets/APIKeyMixin-0dcGhBjP.js","assets/CustomParametersMixin-DKqLR8tC.js","assets/EditBusLayer-CAsf3J8a.js","assets/FeatureEffectLayer-xcthoMRe.js","assets/FeatureEffect-DsB_OIRS.js","assets/FeatureFilter-x-ktONiu.js","assets/FeatureLayerBase-DdVIldVS.js","assets/featureLayerUtils-pwhGpgI4.js","assets/featureQueryAll-Dvpwrv0X.js","assets/LayerFloorInfo-D_j1_8Sf.js","assets/serviceCapabilitiesUtils-JAuO7eFe.js","assets/FeatureReductionLayer-CENesjyy.js","assets/FeatureReductionSelection-CsTr2Kpw.js","assets/LabelClass-DPzxJqvN.js","assets/MD5-C9MwAd2G.js","assets/OrderedLayer-CeeaGzzr.js","assets/TemporalLayer-C1KR7WBT.js","assets/TimeInfo-Cqort3EX.js","assets/FeatureTemplate-BU0tvyV1.js","assets/FeatureType-BD0awc-y.js","assets/fieldProperties-QeW_-2Ss.js","assets/labelingInfo-B67D2ZxN.js","assets/versionUtils-C_5-kApp.js","assets/popupUtils-Cu5Z_JS9.js","assets/interfaces-CL2NbQte.js","assets/ReactiveSet-EOjVMIaT.js","assets/arcadeUtils-9U9h2sVX.js","assets/ImmutableArray-BlMso3qf.js","assets/hash-CcEbRgUF.js","assets/TileLayerView3D-TxxDwqh-.js","assets/LayerView3D-BHAdUlxy.js","assets/TiledLayerView3D-D6_3wV1r.js","assets/LayerView-xIua26SL.js","assets/RefreshableLayerView-ByEXgiMo.js","assets/MapServiceLayerViewHelper-BxCjZWnv.js","assets/floorFilterUtils-DZ5C6FQv.js","assets/sublayerUtils-BA9xuOZk.js","assets/popupUtils-D-6l6-mq.js","assets/drapedUtils-aoEEgHJS.js","assets/ElevationLayerView3D-Cc9AmKc2.js","assets/BaseDynamicLayerView3D-B8u8C6tl.js","assets/DynamicLayerView3D-BkWtl3DK.js","assets/projectExtentUtils-jytcdcl1.js","assets/ImageMaterial.glsl-B_fxTFoc.js","assets/BuildingSceneLayerView3D-BQoOiU4W.js","assets/BuildingGroupSublayer-CAmO_Jyo.js","assets/BuildingComponentSublayer-D20R9pYM.js","assets/capabilities-CVH7PnKh.js","assets/I3SIndexInfo-C9hHhxPX.js","assets/I3SLayerDefinitions-mJYKJt0E.js","assets/I3SMeshView3D-DXxZXspw.js","assets/LayerElevationProvider-BpPRWdGg.js","assets/RenderTexture-j1XTTCSj.js","assets/I3SOverrides-jdHne-Ni.js","assets/meshFeatureSet-BwhRaEUF.js","assets/FeatureLayerView3D-DcDFWJ4a.js","assets/FeatureLayerViewBase3D-CeOqo5ru.js","assets/HeatmapDensity.glsl-DVt7Ha1B.js","assets/dehydratedFeatureComparison-BQojOjzo.js","assets/queryForSymbologySnapping-qvXsfuzP.js","assets/Graphics3DObjectStates-r07NC4gs.js","assets/EventedSet-DaMEJEva.js","assets/SceneModification-CqCsboWN.js","assets/persistable-CqahfBmp.js","assets/multiOriginJSONSupportUtils-C0wm8_Yw.js","assets/resourceExtension-DX05oFmI.js","assets/I3SQueryFeatureStore-CjbuQXDg.js","assets/TemporalSceneLayerView-DjYsJaHQ.js","assets/CSVLayerView3D-DahsZgDd.js","assets/DimensionLayerView3D-DodwrSdt.js","assets/GeoJSONLayerView3D-DURE-ePf.js","assets/GraphicsLayerView3D-CpDe5lBY.js","assets/GraphicsProcessor-CEJV8uEd.js","assets/GroupLayerView-39Rky0QM.js","assets/ImageryLayerView3D-wuBpkCZC.js","assets/IntegratedMeshLayerView3D-B6SKy_xl.js","assets/IntegratedMesh3DTilesLayerView3D-DJZGNcXH.js","assets/LineOfSightLayerView3D-AzTNXhI9.js","assets/MapImageLayerView3D-2yfCqGlp.js","assets/ExportImageParameters-dIEgPVH2.js","assets/MediaLayerView3D-DgGJ75Fk.js","assets/MediaElementView-C3Jzxn2_.js","assets/normalizeUtilsSync-hw6TMy5M.js","assets/OGCFeatureLayerView3D-0zVBZjz9.js","assets/PointCloudLayerView3D-C4u6SxmH.js","assets/PopupSceneLayerView-CFBFQ1zF.js","assets/VoxelLayerView3D-V179zpnr.js","assets/RouteLayerView3D-qfQsaKel.js","assets/Stop-BhcnPyuM.js","assets/SceneLayerView3D-yAh8KGjD.js","assets/SceneLayerView-B4oh7lH2.js","assets/SceneLayerGraphicsView3D-54gP3uC2.js","assets/StreamLayerView3D-Dn1vr92q.js","assets/ImageryTileLayerView3D-DYej-teh.js","assets/VectorTileLayerView3D-Cl3IYcKz.js","assets/vec4f32-CjrfB-0a.js","assets/WFSLayerView3D-BukLiMOV.js","assets/WMSLayerView3D-2N9k8cP-.js","assets/ExportWMSImageParameters-oP84eWiR.js","assets/WMTSLayerView3D-CYEDd0c7.js","assets/AreaMeasurementAnalysisView3D-D02-cmVo.js","assets/UnitNormalizer-Bx_h0ZpG.js","assets/Segment-CNSGf7Bh.js","assets/LineVisualElement-BA2FWRBH.js","assets/geometryEngine-DM06toa8.js","assets/hydrated-k8s1tmfD.js","assets/EditGeometryOperations-DfElYoDB.js","assets/DimensionAnalysisView3D-D2aIUzKu.js","assets/LengthDimension-3241MIUx.js","assets/RightAngleQuadVisualElement-BIwVXGBk.js","assets/ShadedColorMaterial.glsl-Cak3Vz2U.js","assets/ToolIntersector-DHrjlBzv.js","assets/Laserlines.glsl-CW436qzp.js","assets/DirectLineMeasurementAnalysisView3D-CtZnRphp.js","assets/LineOfSightAnalysisView3D-C9N84sgw.js","assets/LineOfSightAnalysisTarget-DuX2cHd3.js","assets/SliceAnalysisView3D-BztPzci8.js","assets/TerrainTileTree3DDebugger-DbgLkkcm.js","assets/TileTreeDebugger-Csj5aKb9.js","assets/Lyr3DWasmPerSceneView-3Rp1NSzU.js","assets/calcite-button-DXst4bK7.js","assets/form-E8ni51Jz.js","assets/dom-CANncBEs.js","assets/guid-Cgw_FQNn.js","assets/interactive-Bs1Navis.js","assets/label2-3Q-v-41t.js","assets/component-CiBiWYk6.js","assets/loadable-BfxIqWjz.js","assets/t9n-B00uso4j.js","assets/observers-DkYdSM1S.js","assets/icon-C4obEzpS.js","assets/loader-DtezzzVx.js","assets/calcite-icon-DTT2i1Ja.js","assets/FeatureTileTree3DDebugger-C9JebYuf.js","assets/GraphicsView3D-DQnEYNx5.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
