import{bt as F,bA as j,bB as O,a as s,_ as q,aw as m,bC as P,bD as E,bE as x,ad as f,b2 as R}from"./index-Bv0Hohk0.js";import{r as S}from"./featureQueryAll-Dvpwrv0X.js";import{A as L}from"./UniqueValueRenderer-C8B84zcF.js";import{c as _}from"./AttachmentQuery-B5Jh59Bx.js";import A from"./RelationshipQuery-QRZ1tsX4.js";const $=new F({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"});async function Q(e,t,r,n){const a=await y(e);if(await w(e,t,n),!a.addAttachment)throw new s(n,"Layer source does not support addAttachment capability");return a.addAttachment(t,r)}function w(e,t,r){var o,i;const{attributes:n}=t,{objectIdField:a}=e;return(i=(o=e.capabilities)==null?void 0:o.data)!=null&&i.supportsAttachment?t?n?a&&n[a]?Promise.resolve():Promise.reject(new s(r,`feature is missing the identifying attribute ${a}`)):Promise.reject(new s(r,"'attributes' are required on a feature to query attachments")):Promise.reject(new s(r,"A feature is required to add/delete/update attachments")):Promise.reject(new s(r,"this layer doesn't support attachments"))}async function U(e,t,r,n,a){const o=await y(e);if(await w(e,t,a),!o.updateAttachment)throw new s(a,"Layer source does not support updateAttachment capability");return o.updateAttachment(t,r,n)}async function J(e,t,r){const{applyEdits:n}=await q(()=>import("./editingSupport-BPET0oPi.js"),__vite__mapDeps([0,1,2,3])),a=await e.load(),{source:o,globalIdField:i}=a;let l=r;return a.type==="feature"&&a.infoFor3D&&t.deleteFeatures!=null&&i!=null&&(l={...l,globalIdToObjectId:await M(e,t.deleteFeatures,i)}),n(a,o,t,r)}async function N(e,t,r){const{uploadAssets:n}=await q(()=>import("./editingSupport-BPET0oPi.js"),__vite__mapDeps([0,1,2,3])),a=await e.load();return n(a,a.source,t,r)}async function Z(e,t,r,n){const a=await y(e);if(await w(e,t,n),!a.deleteAttachments)throw new s(n,"Layer source does not support deleteAttachments capability");return a.deleteAttachments(t,r)}async function k(e,t,r){const n=(await e.load({signal:t==null?void 0:t.signal})).source;if(!n.fetchRecomputedExtents)throw new s(r,"Layer source does not support fetchUpdates capability");return n.fetchRecomputedExtents(t)}async function H(e,t,r,n){var g,I;t=_.from(t),await e.load();const a=e.source,o=e.capabilities;if(!((g=o==null?void 0:o.data)!=null&&g.supportsAttachment))throw new s(n,"this layer doesn't support attachments");const{attachmentTypes:i,objectIds:l,globalIds:p,num:u,size:c,start:d,where:b}=t;if(!((I=o==null?void 0:o.operations)!=null&&I.supportsQueryAttachments)&&((i==null?void 0:i.length)>0||(p==null?void 0:p.length)>0||(c==null?void 0:c.length)>0||u||d||b))throw new s(n,"when 'capabilities.operations.supportsQueryAttachments' is false, only objectIds is supported",t);if(!(l!=null&&l.length||p!=null&&p.length||b))throw new s(n,"'objectIds', 'globalIds', or 'where' are required to perform attachment query",t);if(!a.queryAttachments)throw new s(n,"Layer source does not support queryAttachments capability",t);return a.queryAttachments(t)}async function z(e,t,r,n){const a=await y(e);if(!a.queryObjectIds)throw new s(n,"Layer source does not support queryObjectIds capability");return a.queryObjectIds(m.from(t)??e.createQuery(),r)}async function B(e,t,r,n){const a=await y(e);if(!a.queryFeatureCount)throw new s(n,"Layer source does not support queryFeatureCount capability");return a.queryFeatureCount(m.from(t)??e.createQuery(),r)}async function K(e,t,r,n){const a=await y(e);if(!a.queryExtent)throw new s(n,"Layer source does not support queryExtent capability");return a.queryExtent(m.from(t)??e.createQuery(),r)}async function W(e,t,r,n){const a=await y(e);if(!a.queryRelatedFeatures)throw new s(n,"Layer source does not support queryRelatedFeatures capability");return a.queryRelatedFeatures(A.from(t),r)}async function X(e,t,r,n){const a=await y(e);if(!a.queryRelatedFeaturesCount)throw new s(n,"Layer source does not support queryRelatedFeaturesCount capability");return a.queryRelatedFeaturesCount(A.from(t),r)}async function Y(e){const t=e.source;if(t!=null&&t.refresh)try{const{dataChanged:r,updates:n}=await t.refresh();if(n!=null&&(e.sourceJSON={...e.sourceJSON,...n},e.read(n,{origin:"service",url:e.parsedUrl})),r)return!0}catch{}if(e.definitionExpression)try{return(await P(e.definitionExpression,e.fieldsIndex)).hasDateFunctions}catch{}return!1}function ee(e){var i,l;const t=new m,r=(i=e.capabilities)==null?void 0:i.data,n=(l=e.capabilities)==null?void 0:l.query;t.historicMoment=e.historicMoment,t.gdbVersion=e.gdbVersion,t.returnGeometry=!0,n&&(t.compactGeometryEnabled=n.supportsCompactGeometry,t.defaultSpatialReferenceEnabled=n.supportsDefaultSpatialReference),r&&(r.supportsZ&&e.returnZ!=null&&(t.returnZ=e.returnZ),r.supportsM&&e.returnM!=null&&(t.returnM=e.returnM)),t.outFields=["*"];const{timeOffset:a,timeExtent:o}=e;return t.timeExtent=a!=null&&o!=null?o.offset(-a.value,a.unit):o||null,t.multipatchOption=e.geometryType==="multipatch"?"xyFootprint":null,t}function te(e){const{globalIdField:t,fields:r}=e;if(t)return t;if(r){for(const n of r)if(n.type==="esriFieldTypeGlobalID")return n.name}}function ne(e){const{objectIdField:t,fields:r}=e;if(t)return t;if(r){for(const n of r)if(n.type==="esriFieldTypeOID")return n.name}}function re(e){return e.currentVersion?e.currentVersion:e.hasOwnProperty("capabilities")||e.hasOwnProperty("drawingInfo")||e.hasOwnProperty("hasAttachments")||e.hasOwnProperty("htmlPopupType")||e.hasOwnProperty("relationships")||e.hasOwnProperty("timeInfo")||e.hasOwnProperty("typeIdField")||e.hasOwnProperty("types")?10:9.3}async function y(e){return(await e.load()).source}async function C(e,t){if(!f||f.findCredential(e))return;let r;try{const n=await R(e,t);n&&(r=await f.checkSignInStatus(`${n}/sharing`))}catch{}if(r)try{const n=t!=null?t.signal:null;await f.getCredential(e,{signal:n})}catch{}}async function ae(e,t,r){var a;const n=(a=e.parsedUrl)==null?void 0:a.path;n&&e.authenticationTriggerEvent===t&&await C(n,r)}function oe(e){var t;return!((t=e.sourceJSON)!=null&&t.isMultiServicesView)&&(e.userHasUpdateItemPrivileges||e.editingEnabled)}const h=j({types:O});function se(e,t){var r;if(e.defaultSymbol)return(r=e.types)!=null&&r.length?new L({defaultSymbol:h(e.defaultSymbol,e,t),field:e.typeIdField,uniqueValueInfos:e.types.map(n=>({id:n.id,symbol:h(n.symbol,n,t)}))}):new E({symbol:h(e.defaultSymbol,e,t)})}function ie(e){var n,a,o;let t=(n=e.sourceJSON)==null?void 0:n.cacheMaxAge;if(!t)return!1;const r=(o=(a=e.editingInfo)==null?void 0:a.lastEditDate)==null?void 0:o.getTime();return r==null||(t*=1e3,Date.now()-r<t)}async function M(e,t,r){if(t==null)return null;const n=[],{objectIdField:a}=e;if(t.forEach(u=>{let c=null;if("attributes"in u){const{attributes:d}=u;c={globalId:d[r],objectId:d[a]!=null&&d[a]!==-1?d[a]:null}}else c={globalId:u.globalId,objectId:u.objectId!=null&&u.objectId!==-1?u.objectId:null};c.globalId!=null&&(c.objectId!=null&&c.objectId!==-1||n.push(c.globalId))}),n.length===0)return null;const o=e.createQuery();o.where=n.map(u=>`${r}='${u}'`).join(" OR "),o.returnGeometry=!1,o.outFields=[a,r],o.cacheHint=!1;const i=await x(S(e,o));if(!i.ok)return null;const l=new Map,p=i.value.features;for(const u of p){const c=u.attributes[r],d=u.attributes[a];c!=null&&d!=null&&d!==-1&&l.set(c,d)}return l}export{B as A,re as C,se as D,X as E,z as F,k as I,ne as M,K as O,W as P,ae as Q,te as R,Y as S,oe as T,ie as U,M as V,J as b,$ as f,N as g,Z as j,Q as m,H as q,U as w,ee as x};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/editingSupport-BPET0oPi.js","assets/index-Bv0Hohk0.js","assets/index-85K7yr-5.css","assets/EditBusLayer-CAsf3J8a.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
